[
  {
    "id": "ai-RAG-rag-vs-fine-tuning-1",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "Benefits of RAG",
    "title": "RAG vs. Fine-tuning",
    "subtitle": "Benefits of RAG",
    "contentHtml": "<ul>\n  <li>The table below <a href=\"https://arxiv.org/pdf/2312.10997v1.pdf\">(source)</a> compares RAG vs. fine-tuning.</li>\n</ul>\n<p><img src=\"../../../images/papers/RAGvsFT.jpg\" alt=\"\"></p>\n<ul>\n  <li>To summarize the above table:\n    <ol>\n      <li>RAG offers Large Language Models (LLMs) access to factual, access-controlled, timely information. This integration enables LLMs to fetch precise and verified facts directly from relevant databases and knowledge repositories in real-time. While fine-tuning can address some of these aspects by adapting the model to specific data, RAG excels at providing up-to-date and specific information without the substantial costs associated with fine-tuning. Moreover, RAG enhances the model’s ability to remain current and relevant by dynamically accessing and retrieving the latest data, thus ensuring the responses are accurate and contextually appropriate. Additionally, RAG’s approach to leveraging external sources can be more flexible and scalable, allowing for easy updates and adjustments without the need for extensive retraining.</li>\n      <li>Fine-tuning adapts the style, tone, and vocabulary of LLMs so that your linguistic “paint brush” matches the desired domain and style. RAG does not provide this level of customization in terms of linguistic style and vocabulary.</li>\n      <li>Focus on RAG first. A successful LLM application typically involves connecting specialized data to the LLM workflow. Once you have a functional application, you can add fine-tuning to enhance the style and vocabulary of the system.</li>\n    </ol>\n  </li>\n</ul>\n<ol>\n      <li>RAG offers Large Language Models (LLMs) access to factual, access-controlled, timely information. This integration enables LLMs to fetch precise and verified facts directly from relevant databases and knowledge repositories in real-time. While fine-tuning can address some of these aspects by adapting the model to specific data, RAG excels at providing up-to-date and specific information without the substantial costs associated with fine-tuning. Moreover, RAG enhances the model’s ability to remain current and relevant by dynamically accessing and retrieving the latest data, thus ensuring the responses are accurate and contextually appropriate. Additionally, RAG’s approach to leveraging external sources can be more flexible and scalable, allowing for easy updates and adjustments without the need for extensive retraining.</li>\n      <li>Fine-tuning adapts the style, tone, and vocabulary of LLMs so that your linguistic “paint brush” matches the desired domain and style. RAG does not provide this level of customization in terms of linguistic style and vocabulary.</li>\n      <li>Focus on RAG first. A successful LLM application typically involves connecting specialized data to the LLM workflow. Once you have a functional application, you can add fine-tuning to enhance the style and vocabulary of the system.</li>\n    </ol>",
    "contentMarkdown": "*   The table below [(source)](https://arxiv.org/pdf/2312.10997v1.pdf) compares RAG vs. fine-tuning.\n\n![](../../../images/papers/RAGvsFT.jpg)\n\n*   To summarize the above table:\n    1.  RAG offers Large Language Models (LLMs) access to factual, access-controlled, timely information. This integration enables LLMs to fetch precise and verified facts directly from relevant databases and knowledge repositories in real-time. While fine-tuning can address some of these aspects by adapting the model to specific data, RAG excels at providing up-to-date and specific information without the substantial costs associated with fine-tuning. Moreover, RAG enhances the model’s ability to remain current and relevant by dynamically accessing and retrieving the latest data, thus ensuring the responses are accurate and contextually appropriate. Additionally, RAG’s approach to leveraging external sources can be more flexible and scalable, allowing for easy updates and adjustments without the need for extensive retraining.\n    2.  Fine-tuning adapts the style, tone, and vocabulary of LLMs so that your linguistic “paint brush” matches the desired domain and style. RAG does not provide this level of customization in terms of linguistic style and vocabulary.\n    3.  Focus on RAG first. A successful LLM application typically involves connecting specialized data to the LLM workflow. Once you have a functional application, you can add fine-tuning to enhance the style and vocabulary of the system.\n\n1.  RAG offers Large Language Models (LLMs) access to factual, access-controlled, timely information. This integration enables LLMs to fetch precise and verified facts directly from relevant databases and knowledge repositories in real-time. While fine-tuning can address some of these aspects by adapting the model to specific data, RAG excels at providing up-to-date and specific information without the substantial costs associated with fine-tuning. Moreover, RAG enhances the model’s ability to remain current and relevant by dynamically accessing and retrieving the latest data, thus ensuring the responses are accurate and contextually appropriate. Additionally, RAG’s approach to leveraging external sources can be more flexible and scalable, allowing for easy updates and adjustments without the need for extensive retraining.\n2.  Fine-tuning adapts the style, tone, and vocabulary of LLMs so that your linguistic “paint brush” matches the desired domain and style. RAG does not provide this level of customization in terms of linguistic style and vocabulary.\n3.  Focus on RAG first. A successful LLM application typically involves connecting specialized data to the LLM workflow. Once you have a functional application, you can add fine-tuning to enhance the style and vocabulary of the system.",
    "order": 1,
    "orderInChapter": 1,
    "difficulty": 2,
    "estimatedMinutes": 2,
    "tags": [
      "nlpllms",
      "llm",
      "fine-tuning"
    ],
    "metadata": {
      "hasCode": false,
      "hasMath": false,
      "hasImages": true,
      "wordCount": 394,
      "contentLength": 2953
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#rag-vs.-fine-tuning",
    "scrapedAt": "2025-12-28T11:54:28.273Z"
  },
  {
    "id": "ai-RAG-ingestion-2",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "Building a RAG Pipeline",
    "title": "Ingestion",
    "subtitle": "Building a RAG Pipeline",
    "contentHtml": "<h4 id=\"chunking\">Chunking</h4>\n<ul>\n  <li>Chunking is the process of dividing the prompts and/or the documents to be retrieved, into smaller, manageable segments or chunks. These chunks can be defined either by a fixed size, such as a specific number of characters, sentences, or paragraphs. The choice of chunking strategy plays a critical role in determining both the performance and efficiency of your RAG system.</li>\n  <li>Each chunk is encoded into an embedding vector for retrieval. Smaller, more precise chunks lead to a finer match between the user’s query and the content, enhancing the accuracy and relevance of the information retrieved.</li>\n  <li>Larger chunks might include irrelevant information, introducing noise and potentially reducing the retrieval accuracy. By controlling the chunk size, RAG can maintain a balance between comprehensiveness and precision.</li>\n  <li>So the next natural question that comes up is, how do you choose the right chunk size for your use case? The choice of chunk size in RAG is crucial. It needs to be small enough to ensure relevance and reduce noise but large enough to maintain the context’s integrity. Let’s look at a few methods below referred from <a href=\"https://www.pinecone.io/learn/chunking-strategies/\">Pinecone</a>:\n    <ul>\n      <li><strong>Fixed-size Chunking:</strong> Simply decide the number of tokens in our chunk along with whether there should be overlap between them or not. Overlap between chunks guarantees there to be minimal semantic context loss between chunks. This option is computationally cheap and simple to implement.\n        <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code0\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code0\"><span class=\"n\">text</span> <span class=\"o\">=</span> <span class=\"s\">\"...\"</span> <span class=\"c1\"># your text\n</span><span class=\"kn\">from</span> <span class=\"nn\">langchain.text_splitter</span> <span class=\"kn\">import</span> <span class=\"n\">CharacterTextSplitter</span>\n<span class=\"n\">text_splitter</span> <span class=\"o\">=</span> <span class=\"n\">CharacterTextSplitter</span><span class=\"p\">(</span>\n    <span class=\"n\">separator</span> <span class=\"o\">=</span> <span class=\"s\">\"</span><span class=\"se\">\\n\\n</span><span class=\"s\">\"</span><span class=\"p\">,</span>\n    <span class=\"n\">chunk_size</span> <span class=\"o\">=</span> <span class=\"mi\">256</span><span class=\"p\">,</span>\n    <span class=\"n\">chunk_overlap</span>  <span class=\"o\">=</span> <span class=\"mi\">20</span>\n<span class=\"p\">)</span>\n<span class=\"n\">docs</span> <span class=\"o\">=</span> <span class=\"n\">text_splitter</span><span class=\"p\">.</span><span class=\"n\">create_documents</span><span class=\"p\">([</span><span class=\"n\">text</span><span class=\"p\">])</span>\n</code></pre></div>        </div>\n      </li>\n      <li><strong>Context-aware Chunking:</strong> Content-aware chunking leverages the intrinsic structure of the text to create chunks that are more meaningful and contextually relevant. Here are several approaches to achieving this:\n        <ol>\n          <li><strong>Sentence Splitting</strong>: This method aligns with models optimized for embedding sentence-level content. Different tools and techniques can be used for sentence splitting:\n            <ul>\n              <li><strong>Naive Splitting:</strong> A basic method where sentences are split using periods and new lines. Example:\n                <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code1\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code1\">   <span class=\"n\">text</span> <span class=\"o\">=</span> <span class=\"s\">\"...\"</span>  <span class=\"c1\"># Your text\n</span>   <span class=\"n\">docs</span> <span class=\"o\">=</span> <span class=\"n\">text</span><span class=\"p\">.</span><span class=\"n\">split</span><span class=\"p\">(</span><span class=\"s\">\".\"</span><span class=\"p\">)</span>\n</code></pre></div>                </div>\n                <ul>\n                  <li>This method is quick but may overlook complex sentence structures.</li>\n                </ul>\n              </li>\n              <li><strong>NLTK (Natural Language Toolkit):</strong> A comprehensive Python library for language processing. NLTK includes a sentence tokenizer that effectively splits text into sentences. Example:\n                <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code2\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code2\"><span class=\"n\">text</span> <span class=\"o\">=</span> <span class=\"s\">\"...\"</span>  <span class=\"c1\"># Your text\n</span><span class=\"kn\">from</span> <span class=\"nn\">langchain.text_splitter</span> <span class=\"kn\">import</span> <span class=\"n\">NLTKTextSplitter</span>\n<span class=\"n\">text_splitter</span> <span class=\"o\">=</span> <span class=\"n\">NLTKTextSplitter</span><span class=\"p\">()</span>\n<span class=\"n\">docs</span> <span class=\"o\">=</span> <span class=\"n\">text_splitter</span><span class=\"p\">.</span><span class=\"n\">split_text</span><span class=\"p\">(</span><span class=\"n\">text</span><span class=\"p\">)</span>\n</code></pre></div>                </div>\n              </li>\n              <li><strong>spaCy:</strong> An advanced Python library for NLP tasks, spaCy offers efficient sentence segmentation. Example:\n                <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code3\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code3\"><span class=\"n\">text</span> <span class=\"o\">=</span> <span class=\"s\">\"...\"</span>  <span class=\"c1\"># Your text\n</span><span class=\"kn\">from</span> <span class=\"nn\">langchain.text_splitter</span> <span class=\"kn\">import</span> <span class=\"n\">SpacyTextSplitter</span>\n<span class=\"n\">text_splitter</span> <span class=\"o\">=</span> <span class=\"n\">SpacyTextSplitter</span><span class=\"p\">()</span>\n<span class=\"n\">docs</span> <span class=\"o\">=</span> <span class=\"n\">text_splitter</span><span class=\"p\">.</span><span class=\"n\">split_text</span><span class=\"p\">(</span><span class=\"n\">text</span><span class=\"p\">)</span>\n</code></pre></div>                </div>\n              </li>\n            </ul>\n          </li>\n          <li><strong>Recursive Chunking:</strong> Recursive chunking is an iterative method that splits text hierarchically using various separators. It adapts to create chunks of similar size or structure by recursively applying different criteria. Example using LangChain:\n            <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code4\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code4\">   <span class=\"n\">text</span> <span class=\"o\">=</span> <span class=\"s\">\"...\"</span>  <span class=\"c1\"># Your text\n</span>   <span class=\"kn\">from</span> <span class=\"nn\">langchain.text_splitter</span> <span class=\"kn\">import</span> <span class=\"n\">RecursiveCharacterTextSplitter</span>\n   <span class=\"n\">text_splitter</span> <span class=\"o\">=</span> <span class=\"n\">RecursiveCharacterTextSplitter</span><span class=\"p\">(</span>\n       <span class=\"n\">chunk_size</span> <span class=\"o\">=</span> <span class=\"mi\">256</span><span class=\"p\">,</span>\n       <span class=\"n\">chunk_overlap</span> <span class=\"o\">=</span> <span class=\"mi\">20</span>\n   <span class=\"p\">)</span>\n   <span class=\"n\">docs</span> <span class=\"o\">=</span> <span class=\"n\">text_splitter</span><span class=\"p\">.</span><span class=\"n\">create_documents</span><span class=\"p\">([</span><span class=\"n\">text</span><span class=\"p\">])</span>\n</code></pre></div>            </div>\n          </li>\n          <li><strong>Structure-based Chunking:</strong> For formatted content like Markdown, HTML, or LaTeX, specialized chunking can be applied to maintain the original structure:\n            <ul>\n              <li><strong>Markdown Chunking:</strong> Recognizes markdown syntax and divides content based on structure. Example:\n                <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code5\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code5\"><span class=\"kn\">from</span> <span class=\"nn\">langchain.text_splitter</span> <span class=\"kn\">import</span> <span class=\"n\">MarkdownTextSplitter</span>\n<span class=\"n\">markdown_text</span> <span class=\"o\">=</span> <span class=\"s\">\"...\"</span>\n<span class=\"n\">markdown_splitter</span> <span class=\"o\">=</span> <span class=\"n\">MarkdownTextSplitter</span><span class=\"p\">(</span><span class=\"n\">chunk_size</span><span class=\"o\">=</span><span class=\"mi\">100</span><span class=\"p\">,</span> <span class=\"n\">chunk_overlap</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">)</span>\n<span class=\"n\">docs</span> <span class=\"o\">=</span> <span class=\"n\">markdown_splitter</span><span class=\"p\">.</span><span class=\"n\">create_documents</span><span class=\"p\">([</span><span class=\"n\">markdown_text</span><span class=\"p\">])</span>\n</code></pre></div>                </div>\n              </li>\n              <li><strong>HTML Chunking:</strong> Leverages HTML tags (such as headings, sections, and semantic elements) to segment content while preserving document hierarchy and structural meaning.</li>\n              <li><strong>LaTeX Chunking:</strong> Parses LaTeX commands and environments to chunk content while preserving its logical organization.</li>\n            </ul>\n          </li>\n          <li><strong>Semantic Chunking:</strong> Segment text based on semantic similarity. This means that sentences with the strongest semantic connections are grouped together, while sentences that move to another topic or theme are separated into distinct chunks. For an implementation of semantic chunking, please refer to <a href=\"https://github.com/FullStackRetrieval-com/RetrievalTutorials/blob/main/tutorials/LevelsOfTextSplitting/5_Levels_Of_Text_Splitting.ipynb\">this</a> notebook.\n            <ul>\n              <li>Semantic chunking can be summarized in four steps:\n                <ol>\n                  <li>Split the text into sentences, paragraphs, or other rule-based units.</li>\n                  <li>Vectorize a window of sentences or other units.</li>\n                  <li>Calculate the cosine distance between the embedded windows.</li>\n                  <li>Merge sentences or units until the cosine similarity value reaches a specific threshold.</li>\n                </ol>\n              </li>\n              <li>The following figure (<a href=\"https://www.linkedin.com/in/edwardschmuhl\">source</a>) visually summarizes the overall process:\n <img src=\"/primers/ai/assets/RAG/semc.jpg\" alt=\"\"></li>\n            </ul>\n          </li>\n        </ol>\n      </li>\n    </ul>\n  </li>\n  <li>As a rule of thumb, if the chunk of text makes sense without the surrounding context to a human, it will make sense to the language model as well. Therefore, finding the optimal chunk size for the documents in the corpus is crucial to ensuring that the search results are accurate and relevant.</li>\n</ul>\n<ul>\n      <li><strong>Fixed-size Chunking:</strong> Simply decide the number of tokens in our chunk along with whether there should be overlap between them or not. Overlap between chunks guarantees there to be minimal semantic context loss between chunks. This option is computationally cheap and simple to implement.\n        <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code0\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code0\"><span class=\"n\">text</span> <span class=\"o\">=</span> <span class=\"s\">\"...\"</span> <span class=\"c1\"># your text\n</span><span class=\"kn\">from</span> <span class=\"nn\">langchain.text_splitter</span> <span class=\"kn\">import</span> <span class=\"n\">CharacterTextSplitter</span>\n<span class=\"n\">text_splitter</span> <span class=\"o\">=</span> <span class=\"n\">CharacterTextSplitter</span><span class=\"p\">(</span>\n    <span class=\"n\">separator</span> <span class=\"o\">=</span> <span class=\"s\">\"</span><span class=\"se\">\\n\\n</span><span class=\"s\">\"</span><span class=\"p\">,</span>\n    <span class=\"n\">chunk_size</span> <span class=\"o\">=</span> <span class=\"mi\">256</span><span class=\"p\">,</span>\n    <span class=\"n\">chunk_overlap</span>  <span class=\"o\">=</span> <span class=\"mi\">20</span>\n<span class=\"p\">)</span>\n<span class=\"n\">docs</span> <span class=\"o\">=</span> <span class=\"n\">text_splitter</span><span class=\"p\">.</span><span class=\"n\">create_documents</span><span class=\"p\">([</span><span class=\"n\">text</span><span class=\"p\">])</span>\n</code></pre></div>        </div>\n      </li>\n      <li><strong>Context-aware Chunking:</strong> Content-aware chunking leverages the intrinsic structure of the text to create chunks that are more meaningful and contextually relevant. Here are several approaches to achieving this:\n        <ol>\n          <li><strong>Sentence Splitting</strong>: This method aligns with models optimized for embedding sentence-level content. Different tools and techniques can be used for sentence splitting:\n            <ul>\n              <li><strong>Naive Splitting:</strong> A basic method where sentences are split using periods and new lines. Example:\n                <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code1\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code1\">   <span class=\"n\">text</span> <span class=\"o\">=</span> <span class=\"s\">\"...\"</span>  <span class=\"c1\"># Your text\n</span>   <span class=\"n\">docs</span> <span class=\"o\">=</span> <span class=\"n\">text</span><span class=\"p\">.</span><span class=\"n\">split</span><span class=\"p\">(</span><span class=\"s\">\".\"</span><span class=\"p\">)</span>\n</code></pre></div>                </div>\n                <ul>\n                  <li>This method is quick but may overlook complex sentence structures.</li>\n                </ul>\n              </li>\n              <li><strong>NLTK (Natural Language Toolkit):</strong> A comprehensive Python library for language processing. NLTK includes a sentence tokenizer that effectively splits text into sentences. Example:\n                <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code2\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code2\"><span class=\"n\">text</span> <span class=\"o\">=</span> <span class=\"s\">\"...\"</span>  <span class=\"c1\"># Your text\n</span><span class=\"kn\">from</span> <span class=\"nn\">langchain.text_splitter</span> <span class=\"kn\">import</span> <span class=\"n\">NLTKTextSplitter</span>\n<span class=\"n\">text_splitter</span> <span class=\"o\">=</span> <span class=\"n\">NLTKTextSplitter</span><span class=\"p\">()</span>\n<span class=\"n\">docs</span> <span class=\"o\">=</span> <span class=\"n\">text_splitter</span><span class=\"p\">.</span><span class=\"n\">split_text</span><span class=\"p\">(</span><span class=\"n\">text</span><span class=\"p\">)</span>\n</code></pre></div>                </div>\n              </li>\n              <li><strong>spaCy:</strong> An advanced Python library for NLP tasks, spaCy offers efficient sentence segmentation. Example:\n                <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code3\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code3\"><span class=\"n\">text</span> <span class=\"o\">=</span> <span class=\"s\">\"...\"</span>  <span class=\"c1\"># Your text\n</span><span class=\"kn\">from</span> <span class=\"nn\">langchain.text_splitter</span> <span class=\"kn\">import</span> <span class=\"n\">SpacyTextSplitter</span>\n<span class=\"n\">text_splitter</span> <span class=\"o\">=</span> <span class=\"n\">SpacyTextSplitter</span><span class=\"p\">()</span>\n<span class=\"n\">docs</span> <span class=\"o\">=</span> <span class=\"n\">text_splitter</span><span class=\"p\">.</span><span class=\"n\">split_text</span><span class=\"p\">(</span><span class=\"n\">text</span><span class=\"p\">)</span>\n</code></pre></div>                </div>\n              </li>\n            </ul>\n          </li>\n          <li><strong>Recursive Chunking:</strong> Recursive chunking is an iterative method that splits text hierarchically using various separators. It adapts to create chunks of similar size or structure by recursively applying different criteria. Example using LangChain:\n            <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code4\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code4\">   <span class=\"n\">text</span> <span class=\"o\">=</span> <span class=\"s\">\"...\"</span>  <span class=\"c1\"># Your text\n</span>   <span class=\"kn\">from</span> <span class=\"nn\">langchain.text_splitter</span> <span class=\"kn\">import</span> <span class=\"n\">RecursiveCharacterTextSplitter</span>\n   <span class=\"n\">text_splitter</span> <span class=\"o\">=</span> <span class=\"n\">RecursiveCharacterTextSplitter</span><span class=\"p\">(</span>\n       <span class=\"n\">chunk_size</span> <span class=\"o\">=</span> <span class=\"mi\">256</span><span class=\"p\">,</span>\n       <span class=\"n\">chunk_overlap</span> <span class=\"o\">=</span> <span class=\"mi\">20</span>\n   <span class=\"p\">)</span>\n   <span class=\"n\">docs</span> <span class=\"o\">=</span> <span class=\"n\">text_splitter</span><span class=\"p\">.</span><span class=\"n\">create_documents</span><span class=\"p\">([</span><span class=\"n\">text</span><span class=\"p\">])</span>\n</code></pre></div>            </div>\n          </li>\n          <li><strong>Structure-based Chunking:</strong> For formatted content like Markdown, HTML, or LaTeX, specialized chunking can be applied to maintain the original structure:\n            <ul>\n              <li><strong>Markdown Chunking:</strong> Recognizes markdown syntax and divides content based on structure. Example:\n                <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code5\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code5\"><span class=\"kn\">from</span> <span class=\"nn\">langchain.text_splitter</span> <span class=\"kn\">import</span> <span class=\"n\">MarkdownTextSplitter</span>\n<span class=\"n\">markdown_text</span> <span class=\"o\">=</span> <span class=\"s\">\"...\"</span>\n<span class=\"n\">markdown_splitter</span> <span class=\"o\">=</span> <span class=\"n\">MarkdownTextSplitter</span><span class=\"p\">(</span><span class=\"n\">chunk_size</span><span class=\"o\">=</span><span class=\"mi\">100</span><span class=\"p\">,</span> <span class=\"n\">chunk_overlap</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">)</span>\n<span class=\"n\">docs</span> <span class=\"o\">=</span> <span class=\"n\">markdown_splitter</span><span class=\"p\">.</span><span class=\"n\">create_documents</span><span class=\"p\">([</span><span class=\"n\">markdown_text</span><span class=\"p\">])</span>\n</code></pre></div>                </div>\n              </li>\n              <li><strong>HTML Chunking:</strong> Leverages HTML tags (such as headings, sections, and semantic elements) to segment content while preserving document hierarchy and structural meaning.</li>\n              <li><strong>LaTeX Chunking:</strong> Parses LaTeX commands and environments to chunk content while preserving its logical organization.</li>\n            </ul>\n          </li>\n          <li><strong>Semantic Chunking:</strong> Segment text based on semantic similarity. This means that sentences with the strongest semantic connections are grouped together, while sentences that move to another topic or theme are separated into distinct chunks. For an implementation of semantic chunking, please refer to <a href=\"https://github.com/FullStackRetrieval-com/RetrievalTutorials/blob/main/tutorials/LevelsOfTextSplitting/5_Levels_Of_Text_Splitting.ipynb\">this</a> notebook.\n            <ul>\n              <li>Semantic chunking can be summarized in four steps:\n                <ol>\n                  <li>Split the text into sentences, paragraphs, or other rule-based units.</li>\n                  <li>Vectorize a window of sentences or other units.</li>\n                  <li>Calculate the cosine distance between the embedded windows.</li>\n                  <li>Merge sentences or units until the cosine similarity value reaches a specific threshold.</li>\n                </ol>\n              </li>\n              <li>The following figure (<a href=\"https://www.linkedin.com/in/edwardschmuhl\">source</a>) visually summarizes the overall process:\n <img src=\"/primers/ai/assets/RAG/semc.jpg\" alt=\"\"></li>\n            </ul>\n          </li>\n        </ol>\n      </li>\n    </ul>\n<pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code0\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code0\"><span class=\"n\">text</span> <span class=\"o\">=</span> <span class=\"s\">\"...\"</span> <span class=\"c1\"># your text\n</span><span class=\"kn\">from</span> <span class=\"nn\">langchain.text_splitter</span> <span class=\"kn\">import</span> <span class=\"n\">CharacterTextSplitter</span>\n<span class=\"n\">text_splitter</span> <span class=\"o\">=</span> <span class=\"n\">CharacterTextSplitter</span><span class=\"p\">(</span>\n    <span class=\"n\">separator</span> <span class=\"o\">=</span> <span class=\"s\">\"</span><span class=\"se\">\\n\\n</span><span class=\"s\">\"</span><span class=\"p\">,</span>\n    <span class=\"n\">chunk_size</span> <span class=\"o\">=</span> <span class=\"mi\">256</span><span class=\"p\">,</span>\n    <span class=\"n\">chunk_overlap</span>  <span class=\"o\">=</span> <span class=\"mi\">20</span>\n<span class=\"p\">)</span>\n<span class=\"n\">docs</span> <span class=\"o\">=</span> <span class=\"n\">text_splitter</span><span class=\"p\">.</span><span class=\"n\">create_documents</span><span class=\"p\">([</span><span class=\"n\">text</span><span class=\"p\">])</span>\n</code></pre>\n<ol>\n          <li><strong>Sentence Splitting</strong>: This method aligns with models optimized for embedding sentence-level content. Different tools and techniques can be used for sentence splitting:\n            <ul>\n              <li><strong>Naive Splitting:</strong> A basic method where sentences are split using periods and new lines. Example:\n                <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code1\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code1\">   <span class=\"n\">text</span> <span class=\"o\">=</span> <span class=\"s\">\"...\"</span>  <span class=\"c1\"># Your text\n</span>   <span class=\"n\">docs</span> <span class=\"o\">=</span> <span class=\"n\">text</span><span class=\"p\">.</span><span class=\"n\">split</span><span class=\"p\">(</span><span class=\"s\">\".\"</span><span class=\"p\">)</span>\n</code></pre></div>                </div>\n                <ul>\n                  <li>This method is quick but may overlook complex sentence structures.</li>\n                </ul>\n              </li>\n              <li><strong>NLTK (Natural Language Toolkit):</strong> A comprehensive Python library for language processing. NLTK includes a sentence tokenizer that effectively splits text into sentences. Example:\n                <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code2\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code2\"><span class=\"n\">text</span> <span class=\"o\">=</span> <span class=\"s\">\"...\"</span>  <span class=\"c1\"># Your text\n</span><span class=\"kn\">from</span> <span class=\"nn\">langchain.text_splitter</span> <span class=\"kn\">import</span> <span class=\"n\">NLTKTextSplitter</span>\n<span class=\"n\">text_splitter</span> <span class=\"o\">=</span> <span class=\"n\">NLTKTextSplitter</span><span class=\"p\">()</span>\n<span class=\"n\">docs</span> <span class=\"o\">=</span> <span class=\"n\">text_splitter</span><span class=\"p\">.</span><span class=\"n\">split_text</span><span class=\"p\">(</span><span class=\"n\">text</span><span class=\"p\">)</span>\n</code></pre></div>                </div>\n              </li>\n              <li><strong>spaCy:</strong> An advanced Python library for NLP tasks, spaCy offers efficient sentence segmentation. Example:\n                <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code3\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code3\"><span class=\"n\">text</span> <span class=\"o\">=</span> <span class=\"s\">\"...\"</span>  <span class=\"c1\"># Your text\n</span><span class=\"kn\">from</span> <span class=\"nn\">langchain.text_splitter</span> <span class=\"kn\">import</span> <span class=\"n\">SpacyTextSplitter</span>\n<span class=\"n\">text_splitter</span> <span class=\"o\">=</span> <span class=\"n\">SpacyTextSplitter</span><span class=\"p\">()</span>\n<span class=\"n\">docs</span> <span class=\"o\">=</span> <span class=\"n\">text_splitter</span><span class=\"p\">.</span><span class=\"n\">split_text</span><span class=\"p\">(</span><span class=\"n\">text</span><span class=\"p\">)</span>\n</code></pre></div>                </div>\n              </li>\n            </ul>\n          </li>\n          <li><strong>Recursive Chunking:</strong> Recursive chunking is an iterative method that splits text hierarchically using various separators. It adapts to create chunks of similar size or structure by recursively applying different criteria. Example using LangChain:\n            <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code4\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code4\">   <span class=\"n\">text</span> <span class=\"o\">=</span> <span class=\"s\">\"...\"</span>  <span class=\"c1\"># Your text\n</span>   <span class=\"kn\">from</span> <span class=\"nn\">langchain.text_splitter</span> <span class=\"kn\">import</span> <span class=\"n\">RecursiveCharacterTextSplitter</span>\n   <span class=\"n\">text_splitter</span> <span class=\"o\">=</span> <span class=\"n\">RecursiveCharacterTextSplitter</span><span class=\"p\">(</span>\n       <span class=\"n\">chunk_size</span> <span class=\"o\">=</span> <span class=\"mi\">256</span><span class=\"p\">,</span>\n       <span class=\"n\">chunk_overlap</span> <span class=\"o\">=</span> <span class=\"mi\">20</span>\n   <span class=\"p\">)</span>\n   <span class=\"n\">docs</span> <span class=\"o\">=</span> <span class=\"n\">text_splitter</span><span class=\"p\">.</span><span class=\"n\">create_documents</span><span class=\"p\">([</span><span class=\"n\">text</span><span class=\"p\">])</span>\n</code></pre></div>            </div>\n          </li>\n          <li><strong>Structure-based Chunking:</strong> For formatted content like Markdown, HTML, or LaTeX, specialized chunking can be applied to maintain the original structure:\n            <ul>\n              <li><strong>Markdown Chunking:</strong> Recognizes markdown syntax and divides content based on structure. Example:\n                <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code5\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code5\"><span class=\"kn\">from</span> <span class=\"nn\">langchain.text_splitter</span> <span class=\"kn\">import</span> <span class=\"n\">MarkdownTextSplitter</span>\n<span class=\"n\">markdown_text</span> <span class=\"o\">=</span> <span class=\"s\">\"...\"</span>\n<span class=\"n\">markdown_splitter</span> <span class=\"o\">=</span> <span class=\"n\">MarkdownTextSplitter</span><span class=\"p\">(</span><span class=\"n\">chunk_size</span><span class=\"o\">=</span><span class=\"mi\">100</span><span class=\"p\">,</span> <span class=\"n\">chunk_overlap</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">)</span>\n<span class=\"n\">docs</span> <span class=\"o\">=</span> <span class=\"n\">markdown_splitter</span><span class=\"p\">.</span><span class=\"n\">create_documents</span><span class=\"p\">([</span><span class=\"n\">markdown_text</span><span class=\"p\">])</span>\n</code></pre></div>                </div>\n              </li>\n              <li><strong>HTML Chunking:</strong> Leverages HTML tags (such as headings, sections, and semantic elements) to segment content while preserving document hierarchy and structural meaning.</li>\n              <li><strong>LaTeX Chunking:</strong> Parses LaTeX commands and environments to chunk content while preserving its logical organization.</li>\n            </ul>\n          </li>\n          <li><strong>Semantic Chunking:</strong> Segment text based on semantic similarity. This means that sentences with the strongest semantic connections are grouped together, while sentences that move to another topic or theme are separated into distinct chunks. For an implementation of semantic chunking, please refer to <a href=\"https://github.com/FullStackRetrieval-com/RetrievalTutorials/blob/main/tutorials/LevelsOfTextSplitting/5_Levels_Of_Text_Splitting.ipynb\">this</a> notebook.\n            <ul>\n              <li>Semantic chunking can be summarized in four steps:\n                <ol>\n                  <li>Split the text into sentences, paragraphs, or other rule-based units.</li>\n                  <li>Vectorize a window of sentences or other units.</li>\n                  <li>Calculate the cosine distance between the embedded windows.</li>\n                  <li>Merge sentences or units until the cosine similarity value reaches a specific threshold.</li>\n                </ol>\n              </li>\n              <li>The following figure (<a href=\"https://www.linkedin.com/in/edwardschmuhl\">source</a>) visually summarizes the overall process:\n <img src=\"/primers/ai/assets/RAG/semc.jpg\" alt=\"\"></li>\n            </ul>\n          </li>\n        </ol>\n<ul>\n              <li><strong>Naive Splitting:</strong> A basic method where sentences are split using periods and new lines. Example:\n                <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code1\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code1\">   <span class=\"n\">text</span> <span class=\"o\">=</span> <span class=\"s\">\"...\"</span>  <span class=\"c1\"># Your text\n</span>   <span class=\"n\">docs</span> <span class=\"o\">=</span> <span class=\"n\">text</span><span class=\"p\">.</span><span class=\"n\">split</span><span class=\"p\">(</span><span class=\"s\">\".\"</span><span class=\"p\">)</span>\n</code></pre></div>                </div>\n                <ul>\n                  <li>This method is quick but may overlook complex sentence structures.</li>\n                </ul>\n              </li>\n              <li><strong>NLTK (Natural Language Toolkit):</strong> A comprehensive Python library for language processing. NLTK includes a sentence tokenizer that effectively splits text into sentences. Example:\n                <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code2\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code2\"><span class=\"n\">text</span> <span class=\"o\">=</span> <span class=\"s\">\"...\"</span>  <span class=\"c1\"># Your text\n</span><span class=\"kn\">from</span> <span class=\"nn\">langchain.text_splitter</span> <span class=\"kn\">import</span> <span class=\"n\">NLTKTextSplitter</span>\n<span class=\"n\">text_splitter</span> <span class=\"o\">=</span> <span class=\"n\">NLTKTextSplitter</span><span class=\"p\">()</span>\n<span class=\"n\">docs</span> <span class=\"o\">=</span> <span class=\"n\">text_splitter</span><span class=\"p\">.</span><span class=\"n\">split_text</span><span class=\"p\">(</span><span class=\"n\">text</span><span class=\"p\">)</span>\n</code></pre></div>                </div>\n              </li>\n              <li><strong>spaCy:</strong> An advanced Python library for NLP tasks, spaCy offers efficient sentence segmentation. Example:\n                <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code3\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code3\"><span class=\"n\">text</span> <span class=\"o\">=</span> <span class=\"s\">\"...\"</span>  <span class=\"c1\"># Your text\n</span><span class=\"kn\">from</span> <span class=\"nn\">langchain.text_splitter</span> <span class=\"kn\">import</span> <span class=\"n\">SpacyTextSplitter</span>\n<span class=\"n\">text_splitter</span> <span class=\"o\">=</span> <span class=\"n\">SpacyTextSplitter</span><span class=\"p\">()</span>\n<span class=\"n\">docs</span> <span class=\"o\">=</span> <span class=\"n\">text_splitter</span><span class=\"p\">.</span><span class=\"n\">split_text</span><span class=\"p\">(</span><span class=\"n\">text</span><span class=\"p\">)</span>\n</code></pre></div>                </div>\n              </li>\n            </ul>\n<pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code1\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code1\">   <span class=\"n\">text</span> <span class=\"o\">=</span> <span class=\"s\">\"...\"</span>  <span class=\"c1\"># Your text\n</span>   <span class=\"n\">docs</span> <span class=\"o\">=</span> <span class=\"n\">text</span><span class=\"p\">.</span><span class=\"n\">split</span><span class=\"p\">(</span><span class=\"s\">\".\"</span><span class=\"p\">)</span>\n</code></pre>\n<ul>\n                  <li>This method is quick but may overlook complex sentence structures.</li>\n                </ul>\n<pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code2\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code2\"><span class=\"n\">text</span> <span class=\"o\">=</span> <span class=\"s\">\"...\"</span>  <span class=\"c1\"># Your text\n</span><span class=\"kn\">from</span> <span class=\"nn\">langchain.text_splitter</span> <span class=\"kn\">import</span> <span class=\"n\">NLTKTextSplitter</span>\n<span class=\"n\">text_splitter</span> <span class=\"o\">=</span> <span class=\"n\">NLTKTextSplitter</span><span class=\"p\">()</span>\n<span class=\"n\">docs</span> <span class=\"o\">=</span> <span class=\"n\">text_splitter</span><span class=\"p\">.</span><span class=\"n\">split_text</span><span class=\"p\">(</span><span class=\"n\">text</span><span class=\"p\">)</span>\n</code></pre>\n<pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code3\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code3\"><span class=\"n\">text</span> <span class=\"o\">=</span> <span class=\"s\">\"...\"</span>  <span class=\"c1\"># Your text\n</span><span class=\"kn\">from</span> <span class=\"nn\">langchain.text_splitter</span> <span class=\"kn\">import</span> <span class=\"n\">SpacyTextSplitter</span>\n<span class=\"n\">text_splitter</span> <span class=\"o\">=</span> <span class=\"n\">SpacyTextSplitter</span><span class=\"p\">()</span>\n<span class=\"n\">docs</span> <span class=\"o\">=</span> <span class=\"n\">text_splitter</span><span class=\"p\">.</span><span class=\"n\">split_text</span><span class=\"p\">(</span><span class=\"n\">text</span><span class=\"p\">)</span>\n</code></pre>\n<pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code4\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code4\">   <span class=\"n\">text</span> <span class=\"o\">=</span> <span class=\"s\">\"...\"</span>  <span class=\"c1\"># Your text\n</span>   <span class=\"kn\">from</span> <span class=\"nn\">langchain.text_splitter</span> <span class=\"kn\">import</span> <span class=\"n\">RecursiveCharacterTextSplitter</span>\n   <span class=\"n\">text_splitter</span> <span class=\"o\">=</span> <span class=\"n\">RecursiveCharacterTextSplitter</span><span class=\"p\">(</span>\n       <span class=\"n\">chunk_size</span> <span class=\"o\">=</span> <span class=\"mi\">256</span><span class=\"p\">,</span>\n       <span class=\"n\">chunk_overlap</span> <span class=\"o\">=</span> <span class=\"mi\">20</span>\n   <span class=\"p\">)</span>\n   <span class=\"n\">docs</span> <span class=\"o\">=</span> <span class=\"n\">text_splitter</span><span class=\"p\">.</span><span class=\"n\">create_documents</span><span class=\"p\">([</span><span class=\"n\">text</span><span class=\"p\">])</span>\n</code></pre>\n<ul>\n              <li><strong>Markdown Chunking:</strong> Recognizes markdown syntax and divides content based on structure. Example:\n                <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code5\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code5\"><span class=\"kn\">from</span> <span class=\"nn\">langchain.text_splitter</span> <span class=\"kn\">import</span> <span class=\"n\">MarkdownTextSplitter</span>\n<span class=\"n\">markdown_text</span> <span class=\"o\">=</span> <span class=\"s\">\"...\"</span>\n<span class=\"n\">markdown_splitter</span> <span class=\"o\">=</span> <span class=\"n\">MarkdownTextSplitter</span><span class=\"p\">(</span><span class=\"n\">chunk_size</span><span class=\"o\">=</span><span class=\"mi\">100</span><span class=\"p\">,</span> <span class=\"n\">chunk_overlap</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">)</span>\n<span class=\"n\">docs</span> <span class=\"o\">=</span> <span class=\"n\">markdown_splitter</span><span class=\"p\">.</span><span class=\"n\">create_documents</span><span class=\"p\">([</span><span class=\"n\">markdown_text</span><span class=\"p\">])</span>\n</code></pre></div>                </div>\n              </li>\n              <li><strong>HTML Chunking:</strong> Leverages HTML tags (such as headings, sections, and semantic elements) to segment content while preserving document hierarchy and structural meaning.</li>\n              <li><strong>LaTeX Chunking:</strong> Parses LaTeX commands and environments to chunk content while preserving its logical organization.</li>\n            </ul>\n<pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code5\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code5\"><span class=\"kn\">from</span> <span class=\"nn\">langchain.text_splitter</span> <span class=\"kn\">import</span> <span class=\"n\">MarkdownTextSplitter</span>\n<span class=\"n\">markdown_text</span> <span class=\"o\">=</span> <span class=\"s\">\"...\"</span>\n<span class=\"n\">markdown_splitter</span> <span class=\"o\">=</span> <span class=\"n\">MarkdownTextSplitter</span><span class=\"p\">(</span><span class=\"n\">chunk_size</span><span class=\"o\">=</span><span class=\"mi\">100</span><span class=\"p\">,</span> <span class=\"n\">chunk_overlap</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">)</span>\n<span class=\"n\">docs</span> <span class=\"o\">=</span> <span class=\"n\">markdown_splitter</span><span class=\"p\">.</span><span class=\"n\">create_documents</span><span class=\"p\">([</span><span class=\"n\">markdown_text</span><span class=\"p\">])</span>\n</code></pre>\n<ul>\n              <li>Semantic chunking can be summarized in four steps:\n                <ol>\n                  <li>Split the text into sentences, paragraphs, or other rule-based units.</li>\n                  <li>Vectorize a window of sentences or other units.</li>\n                  <li>Calculate the cosine distance between the embedded windows.</li>\n                  <li>Merge sentences or units until the cosine similarity value reaches a specific threshold.</li>\n                </ol>\n              </li>\n              <li>The following figure (<a href=\"https://www.linkedin.com/in/edwardschmuhl\">source</a>) visually summarizes the overall process:\n <img src=\"/primers/ai/assets/RAG/semc.jpg\" alt=\"\"></li>\n            </ul>\n<ol>\n                  <li>Split the text into sentences, paragraphs, or other rule-based units.</li>\n                  <li>Vectorize a window of sentences or other units.</li>\n                  <li>Calculate the cosine distance between the embedded windows.</li>\n                  <li>Merge sentences or units until the cosine similarity value reaches a specific threshold.</li>\n                </ol>\n<h5 id=\"figuring-out-the-ideal-chunk-size\">Figuring Out the Ideal Chunk Size</h5>\n<ul>\n  <li>Choosing the right chunk size is foundational to building an effective RAG system. It directly influences retrieval quality, model efficiency, and how well the system captures relevant context for downstream tasks. Poor chunking can lead to fragmented information or excessive context loss, undermining overall performance.</li>\n  <li>\n    <p>Building a RAG system involves determining the ideal chunk sizes for the documents that the retriever component will process. The ideal chunk size depends on several factors:</p>\n\n    <ol>\n      <li>\n        <p><strong>Data Characteristics</strong>: The nature of your data is crucial. For text documents, consider the average length of paragraphs or sections. If the documents are well-structured with distinct sections, these natural divisions might serve as a good basis for chunking.</p>\n      </li>\n      <li>\n        <p><strong>Retriever Constraints</strong>: The retriever model you choose (like BM25, TF-IDF, or a neural retriever like DPR) might have limitations on the input length. It’s essential to ensure that the chunks are compatible with these constraints.</p>\n      </li>\n      <li>\n        <p><strong>Memory and Computational Resources</strong>: Larger chunk sizes can lead to higher memory usage and computational overhead. Balance the chunk size with the available resources to ensure efficient processing.</p>\n      </li>\n      <li>\n        <p><strong>Task Requirements</strong>: The nature of the task (e.g., question answering, document summarization) can influence the ideal chunk size. For detailed tasks, smaller chunks might be more effective to capture specific details, while broader tasks might benefit from larger chunks to capture more context.</p>\n      </li>\n      <li>\n        <p><strong>Experimentation</strong>: Often, the best way to determine the ideal chunk size is through empirical testing. Run experiments with different chunk sizes and evaluate the performance on a validation set to find the optimal balance between granularity and context.</p>\n      </li>\n      <li>\n        <p><strong>Overlap Consideration</strong>: Sometimes, it’s beneficial to have overlap between chunks to ensure that no important information is missed at the boundaries. Decide on an appropriate overlap size based on the task and data characteristics.</p>\n      </li>\n    </ol>\n  </li>\n  <li>To summarize, determining the ideal chunk size for a RAG system is a balancing act that involves considering the characteristics of your data, the limitations of your retriever model, the resources at your disposal, the specific requirements of your task, and empirical experimentation. It’s a process that may require iteration and fine-tuning to achieve the best results.</li>\n</ul>\n<p>Building a RAG system involves determining the ideal chunk sizes for the documents that the retriever component will process. The ideal chunk size depends on several factors:</p>\n<ol>\n      <li>\n        <p><strong>Data Characteristics</strong>: The nature of your data is crucial. For text documents, consider the average length of paragraphs or sections. If the documents are well-structured with distinct sections, these natural divisions might serve as a good basis for chunking.</p>\n      </li>\n      <li>\n        <p><strong>Retriever Constraints</strong>: The retriever model you choose (like BM25, TF-IDF, or a neural retriever like DPR) might have limitations on the input length. It’s essential to ensure that the chunks are compatible with these constraints.</p>\n      </li>\n      <li>\n        <p><strong>Memory and Computational Resources</strong>: Larger chunk sizes can lead to higher memory usage and computational overhead. Balance the chunk size with the available resources to ensure efficient processing.</p>\n      </li>\n      <li>\n        <p><strong>Task Requirements</strong>: The nature of the task (e.g., question answering, document summarization) can influence the ideal chunk size. For detailed tasks, smaller chunks might be more effective to capture specific details, while broader tasks might benefit from larger chunks to capture more context.</p>\n      </li>\n      <li>\n        <p><strong>Experimentation</strong>: Often, the best way to determine the ideal chunk size is through empirical testing. Run experiments with different chunk sizes and evaluate the performance on a validation set to find the optimal balance between granularity and context.</p>\n      </li>\n      <li>\n        <p><strong>Overlap Consideration</strong>: Sometimes, it’s beneficial to have overlap between chunks to ensure that no important information is missed at the boundaries. Decide on an appropriate overlap size based on the task and data characteristics.</p>\n      </li>\n    </ol>\n<p><strong>Data Characteristics</strong>: The nature of your data is crucial. For text documents, consider the average length of paragraphs or sections. If the documents are well-structured with distinct sections, these natural divisions might serve as a good basis for chunking.</p>\n<p><strong>Retriever Constraints</strong>: The retriever model you choose (like BM25, TF-IDF, or a neural retriever like DPR) might have limitations on the input length. It’s essential to ensure that the chunks are compatible with these constraints.</p>\n<p><strong>Memory and Computational Resources</strong>: Larger chunk sizes can lead to higher memory usage and computational overhead. Balance the chunk size with the available resources to ensure efficient processing.</p>\n<p><strong>Task Requirements</strong>: The nature of the task (e.g., question answering, document summarization) can influence the ideal chunk size. For detailed tasks, smaller chunks might be more effective to capture specific details, while broader tasks might benefit from larger chunks to capture more context.</p>\n<p><strong>Experimentation</strong>: Often, the best way to determine the ideal chunk size is through empirical testing. Run experiments with different chunk sizes and evaluate the performance on a validation set to find the optimal balance between granularity and context.</p>\n<p><strong>Overlap Consideration</strong>: Sometimes, it’s beneficial to have overlap between chunks to ensure that no important information is missed at the boundaries. Decide on an appropriate overlap size based on the task and data characteristics.</p>\n<h6 id=\"retriever-ensembling-and-re-ranking\">Retriever Ensembling and Re-ranking</h6>\n<ul>\n  <li>In some scenarios, it may be beneficial to simultaneously utilize multiple chunk sizes and apply a re-ranking mechanism to refine the retrieved results. A detailed discourse on re-ranking is available in the <a href=\"#re-ranking\">Re-ranking</a> section.</li>\n  <li>This approach serves two primary purposes:\n    <ul>\n      <li>It potentially improves the quality of retrieved content—albeit at increased computational cost—by aggregating outputs from multiple chunking strategies, provided the re-ranker performs with a reasonable degree of accuracy.</li>\n      <li>It enables systematic comparison of different retrieval methods relative to the re-ranker’s effectiveness.</li>\n    </ul>\n  </li>\n  <li>\n    <p>The methodology proceeds as follows:</p>\n\n    <ul>\n      <li>Segment the same source document using various chunk sizes, for example: 128, 256, 512, and 1024 tokens.</li>\n      <li>During the retrieval phase, extract relevant segments from each retrieval method, thereby forming an ensemble of retrievers.</li>\n      <li>Apply a re-ranking model to prioritize and filter the aggregated results.</li>\n    </ul>\n  </li>\n  <li>The following diagram <a href=\"https://www.linkedin.com/posts/llamaindex_a-big-pain-point-when-trying-to-build-rag-activity-7113307664616484864-RT6n/\">(source)</a> illustrates the process.</li>\n</ul>\n<ul>\n      <li>It potentially improves the quality of retrieved content—albeit at increased computational cost—by aggregating outputs from multiple chunking strategies, provided the re-ranker performs with a reasonable degree of accuracy.</li>\n      <li>It enables systematic comparison of different retrieval methods relative to the re-ranker’s effectiveness.</li>\n    </ul>\n<p>The methodology proceeds as follows:</p>\n<ul>\n      <li>Segment the same source document using various chunk sizes, for example: 128, 256, 512, and 1024 tokens.</li>\n      <li>During the retrieval phase, extract relevant segments from each retrieval method, thereby forming an ensemble of retrievers.</li>\n      <li>Apply a re-ranking model to prioritize and filter the aggregated results.</li>\n    </ul>\n<p><img src=\"/primers/ai/assets/RAG/RetrieverEnsembling.jpg\" alt=\"\"></p>\n<ul>\n  <li>According to <a href=\"https://docs.llamaindex.ai/en/latest/examples/retrievers/ensemble_retrieval.html\">evaluation data provided by LlamaIndex</a>, the ensemble retrieval strategy leads to a modest improvement in faithfulness metrics, suggesting slightly enhanced relevance of retrieved content. However, pairwise comparisons show equal preference between the ensembled and baseline approaches, thereby leaving the superiority of ensembling open to debate.</li>\n  <li>It is important to note that this ensembling methodology is not limited to variations in chunk size. It can also be extended to other dimensions of a RAG pipeline, including vector-based, keyword-based, and hybrid search strategies.</li>\n</ul>\n<h4 id=\"embeddings\">Embeddings</h4>\n<ul>\n  <li>Once you have your prompt chunked appropriately, the next step is to embed it. Embedding prompts and documents in RAG involves transforming both the user’s query (prompt) and the documents in the knowledge base into a format that can be effectively compared for relevance. This process is critical for RAG’s ability to retrieve the most relevant information from its knowledge base in response to a user query. Here’s how it typically works:</li>\n  <li>One option to help pick which embedding model would be best suited for your task is to look at <a href=\"https://huggingface.co/spaces/mteb/leaderboard\">HuggingFace’s Massive Text Embedding Benchmark (MTEB) leaderboard</a>. There is a question of whether a dense or sparse embedding can be used so let’s look into benefits of each below:</li>\n  <li><strong>Sparse embedding:</strong> Sparse embeddings such as TF-IDF are great for lexical matching the prompt with the documents. Best for applications where keyword relevance is crucial. It’s computationally less intensive but may not capture the deeper semantic meanings in the text.</li>\n  <li><strong>Semantic embedding:</strong> Semantic embeddings, such as BERT or SentenceBERT lend themselves naturally to the RAG use-case.\n    <ul>\n      <li><strong>BERT:</strong> Suitable for capturing contextual nuances in both the documents and queries. Requires more computational resources compared to sparse embeddings but offers more semantically rich embeddings.</li>\n      <li><strong>SentenceBERT:</strong> Ideal for scenarios where the context and meaning at the sentence level are important. It strikes a balance between the deep contextual understanding of BERT and the need for concise, meaningful sentence representations. This is usually the preferred route for RAG.</li>\n    </ul>\n  </li>\n</ul>\n<ul>\n      <li><strong>BERT:</strong> Suitable for capturing contextual nuances in both the documents and queries. Requires more computational resources compared to sparse embeddings but offers more semantically rich embeddings.</li>\n      <li><strong>SentenceBERT:</strong> Ideal for scenarios where the context and meaning at the sentence level are important. It strikes a balance between the deep contextual understanding of BERT and the need for concise, meaningful sentence representations. This is usually the preferred route for RAG.</li>\n    </ul>\n<h4 id=\"naive-chunking-vs-late-chunking-vs-late-interaction-colbert-and-colpali\">Naive Chunking vs. Late Chunking vs. Late Interaction (<a href=\"https://arxiv.org/abs/2004.12832\">ColBERT</a> and <a href=\"https://arxiv.org/abs/2407.01449\">ColPali</a>)</h4>\n<ul>\n  <li>\n    <p>The choice between naive chunking, late chunking, and late interaction (<a href=\"https://arxiv.org/abs/2004.12832\">ColBERT</a> and <a href=\"https://arxiv.org/abs/2407.01449\">ColPali</a>) depends on the specific requirements of the retrieval task:</p>\n\n    <ul>\n      <li><strong>Naive Chunking</strong> is suitable for scenarios with strict resource constraints but where retrieval precision is less critical.</li>\n      <li><strong>Late Chunking</strong>, introduced by <a href=\"https://jina.ai\">JinaAI</a>, offers an attractive middle ground, maintaining context and providing improved retrieval accuracy without incurring significant additional costs. Put simply, late chunking balances the trade-offs between cost and precision, making it an excellent option for building scalable and effective RAG systems, particularly in long-context retrieval scenarios.</li>\n      <li><strong>Late Interaction (<a href=\"https://arxiv.org/abs/2004.12832\">ColBERT</a> and <a href=\"https://arxiv.org/abs/2407.01449\">ColPali</a>)</strong> is best suited for applications where retrieval precision is paramount and resource costs are less of a concern.</li>\n    </ul>\n  </li>\n  <li>\n    <p>Let’s explore the differences between three primary strategies: Naive Chunking, Late Chunking, and Late Interaction (<a href=\"https://arxiv.org/abs/2004.12832\">ColBERT</a> and <a href=\"https://arxiv.org/abs/2407.01449\">ColPali</a>), focusing on their methodologies, advantages, and trade-offs.</p>\n  </li>\n</ul>\n<p>The choice between naive chunking, late chunking, and late interaction (<a href=\"https://arxiv.org/abs/2004.12832\">ColBERT</a> and <a href=\"https://arxiv.org/abs/2407.01449\">ColPali</a>) depends on the specific requirements of the retrieval task:</p>\n<ul>\n      <li><strong>Naive Chunking</strong> is suitable for scenarios with strict resource constraints but where retrieval precision is less critical.</li>\n      <li><strong>Late Chunking</strong>, introduced by <a href=\"https://jina.ai\">JinaAI</a>, offers an attractive middle ground, maintaining context and providing improved retrieval accuracy without incurring significant additional costs. Put simply, late chunking balances the trade-offs between cost and precision, making it an excellent option for building scalable and effective RAG systems, particularly in long-context retrieval scenarios.</li>\n      <li><strong>Late Interaction (<a href=\"https://arxiv.org/abs/2004.12832\">ColBERT</a> and <a href=\"https://arxiv.org/abs/2407.01449\">ColPali</a>)</strong> is best suited for applications where retrieval precision is paramount and resource costs are less of a concern.</li>\n    </ul>\n<p>Let’s explore the differences between three primary strategies: Naive Chunking, Late Chunking, and Late Interaction (<a href=\"https://arxiv.org/abs/2004.12832\">ColBERT</a> and <a href=\"https://arxiv.org/abs/2407.01449\">ColPali</a>), focusing on their methodologies, advantages, and trade-offs.</p>\n<h5 id=\"overview-1\">Overview</h5>\n<ul>\n  <li>Long-context retrieval presents a challenge when balancing precision, context retention, and cost efficiency. Solutions range from simple and low-cost, like Naive Chunking, to more sophisticated and resource-intensive approaches, such as Late Interaction (<a href=\"https://arxiv.org/abs/2004.12832\">ColBERT</a> and <a href=\"https://arxiv.org/abs/2407.01449\">ColPali</a>). <a href=\"https://jina.ai/news/late-chunking-in-long-context-embedding-models/\">Late Chunking</a>, a novel approach by <a href=\"https://jina.ai\">JinaAI</a>, offers a middle ground, preserving context with efficiency comparable to Naive Chunking.</li>\n</ul>\n<p><img src=\"/primers/ai/assets/RAG/chunking-strategies.png\" alt=\"\"></p>\n<h5 id=\"naivevanilla-chunking\">Naive/Vanilla Chunking</h5>\n<h6 id=\"what-is-naivevanilla-chunking\">What is Naive/Vanilla Chunking?</h6>\n<ul>\n  <li>As discussed in the <a href=\"#chunking\">Chunking</a> section, naive/vanilla chunking divides a document into fixed-size chunks based on metrics like sentence boundaries or token count (e.g., 512 tokens per chunk).</li>\n  <li>Each chunk is independently embedded into a vector without considering the context of neighboring chunks.</li>\n</ul>\n<h6 id=\"example\">Example</h6>\n<ul>\n  <li>\n    <p>Consider the following paragraph: <em>Alice went for a walk in the woods one day and on her walk, she spotted something. She saw a rabbit hole at the base of a large tree. She fell into the hole and found herself in a strange new world.</em></p>\n  </li>\n  <li>\n    <p>If chunked by sentences:</p>\n    <ul>\n      <li><strong>Chunk 1</strong>: “Alice went for a walk in the woods one day and on her walk, she spotted something.”</li>\n      <li><strong>Chunk 2</strong>: “She saw a rabbit hole at the base of a large tree.”</li>\n      <li><strong>Chunk 3</strong>: “She fell into the hole and found herself in a strange new world.”</li>\n    </ul>\n  </li>\n</ul>\n<p>Consider the following paragraph: <em>Alice went for a walk in the woods one day and on her walk, she spotted something. She saw a rabbit hole at the base of a large tree. She fell into the hole and found herself in a strange new world.</em></p>\n<p>If chunked by sentences:</p>\n<ul>\n      <li><strong>Chunk 1</strong>: “Alice went for a walk in the woods one day and on her walk, she spotted something.”</li>\n      <li><strong>Chunk 2</strong>: “She saw a rabbit hole at the base of a large tree.”</li>\n      <li><strong>Chunk 3</strong>: “She fell into the hole and found herself in a strange new world.”</li>\n    </ul>\n<h6 id=\"advantages-and-limitations\">Advantages and Limitations</h6>\n<ul>\n  <li><strong>Advantages</strong>:\n    <ul>\n      <li>Efficient in terms of storage and computation.</li>\n      <li>Simple to implement and integrate with most retrieval pipelines.</li>\n    </ul>\n  </li>\n  <li><strong>Limitations</strong>:\n    <ul>\n      <li><strong>Context Loss</strong>: Each chunk is processed independently, leading to a loss of contextual relationships. For example, the connection between “she” and “Alice” would be lost, reducing retrieval accuracy for context-heavy queries like “Where did Alice fall?”.</li>\n      <li><strong>Fragmented Meaning</strong>: Splitting paragraphs or semantically related sections can dilute the meaning of each chunk, reducing retrieval precision.</li>\n    </ul>\n  </li>\n</ul>\n<ul>\n      <li>Efficient in terms of storage and computation.</li>\n      <li>Simple to implement and integrate with most retrieval pipelines.</li>\n    </ul>\n<ul>\n      <li><strong>Context Loss</strong>: Each chunk is processed independently, leading to a loss of contextual relationships. For example, the connection between “she” and “Alice” would be lost, reducing retrieval accuracy for context-heavy queries like “Where did Alice fall?”.</li>\n      <li><strong>Fragmented Meaning</strong>: Splitting paragraphs or semantically related sections can dilute the meaning of each chunk, reducing retrieval precision.</li>\n    </ul>\n<h5 id=\"late-chunking\">Late Chunking</h5>\n<h6 id=\"what-is-late-chunking\">What is Late Chunking?</h6>\n<ul>\n  <li>Late Chunking flips the order of vectorizing (i.e., embedding generation) and chunking compared to naive/vanilla chunking. In other words, it delays the chunking process until after the entire document has been embedded into token-level representations. This allows chunks to retain context from the full document, leading to richer, more contextually aware embeddings.</li>\n</ul>\n<h6 id=\"how-late-chunking-works\">How Late Chunking Works</h6>\n<ol>\n  <li><strong>Embedding First</strong>: The entire document is embedded into token-level representations using a long context model.</li>\n  <li><strong>Chunking After</strong>: After embedding, the token-level representations are pooled into chunks based on a predefined chunking strategy (e.g., 512-token chunks).</li>\n  <li><strong>Context Retention</strong>: Each chunk retains contextual information from the full document, allowing for improved retrieval precision without increasing storage costs.</li>\n</ol>\n<h6 id=\"example-1\">Example</h6>\n<ul>\n  <li>Using the same paragraph:\n    <ul>\n      <li>The entire paragraph is first embedded as a whole, preserving the relationships between all sentences.</li>\n      <li>The document is then split into chunks after embedding, ensuring that chunks like “She fell into the hole…” are contextually aware of the mention of “Alice” from earlier sentences.</li>\n    </ul>\n  </li>\n</ul>\n<ul>\n      <li>The entire paragraph is first embedded as a whole, preserving the relationships between all sentences.</li>\n      <li>The document is then split into chunks after embedding, ensuring that chunks like “She fell into the hole…” are contextually aware of the mention of “Alice” from earlier sentences.</li>\n    </ul>\n<h6 id=\"advantages-and-trade-offs\">Advantages and Trade-offs</h6>\n<ul>\n  <li><strong>Advantages</strong>:\n    <ul>\n      <li><strong>Context Preservation</strong>: Late chunking ensures that the relationship between tokens across different chunks is maintained.</li>\n      <li><strong>Efficiency</strong>: Late chunking requires the same amount of storage as naive chunking while significantly improving retrieval accuracy.</li>\n    </ul>\n  </li>\n  <li><strong>Trade-offs</strong>:\n    <ul>\n      <li><strong>Requires Long Context Models</strong>: To embed the entire document at once, a model with long-context capabilities (e.g., supporting up to 8192 tokens) is necessary.</li>\n      <li><strong>Slightly Higher Compute Costs</strong>: Late chunking introduces an extra pooling step after embedding, although it’s more efficient than late interaction approaches like <a href=\"https://arxiv.org/abs/2004.12832\">ColBERT</a>.</li>\n    </ul>\n  </li>\n</ul>\n<ul>\n      <li><strong>Context Preservation</strong>: Late chunking ensures that the relationship between tokens across different chunks is maintained.</li>\n      <li><strong>Efficiency</strong>: Late chunking requires the same amount of storage as naive chunking while significantly improving retrieval accuracy.</li>\n    </ul>\n<ul>\n      <li><strong>Requires Long Context Models</strong>: To embed the entire document at once, a model with long-context capabilities (e.g., supporting up to 8192 tokens) is necessary.</li>\n      <li><strong>Slightly Higher Compute Costs</strong>: Late chunking introduces an extra pooling step after embedding, although it’s more efficient than late interaction approaches like <a href=\"https://arxiv.org/abs/2004.12832\">ColBERT</a>.</li>\n    </ul>\n<h5 id=\"late-interaction\">Late Interaction</h5>\n<h6 id=\"what-is-late-interaction\">What is Late Interaction?</h6>\n<ul>\n  <li>Late Interaction refers to a retrieval approach where token embeddings for both the document and the query are computed separately and compared at the token level, without any pooling operation. The key advantage is fine-grained, token-level matching, which improves retrieval accuracy.</li>\n</ul>\n<h6 id=\"colbert-late-interaction-in-practice\"><a href=\"https://arxiv.org/abs/2004.12832\">ColBERT</a>: Late Interaction in Practice</h6>\n<ul>\n  <li><a href=\"https://arxiv.org/abs/2004.12832\">ColBERT</a> (Contextualized Late Interaction over BERT) by Khattab et al. (2020) uses late interaction to compare individual token embeddings from the query and document using a MaxSim operator. This allows for granular, token-to-token comparisons, which results in highly precise matches but at a significantly higher storage cost.</li>\n</ul>\n<h6 id=\"maxsim-a-key-component-of-colbert\">MaxSim: a Key Component of <a href=\"https://arxiv.org/abs/2004.12832\">ColBERT</a></h6>\n<ul>\n  <li><a href=\"https://stackoverflow.com/questions/74972472/how-to-perform-the-maxsim-operator-leveraging-torch-procedures\">MaxSim</a> (Maximum Similarity) is a core component of the <a href=\"https://arxiv.org/abs/2004.12832\">ColBERT</a> retrieval framework. It refers to a specific way of calculating the similarity between token embeddings of a query and document during retrieval.</li>\n  <li>Here’s a step-by-step breakdown of how MaxSim works:\n    <ol>\n      <li><strong>Token-level Embedding Comparisons</strong>:\n        <ul>\n          <li>When a query is processed, it is tokenized and each token is embedded separately (e.g., “apple” and “sweet”).</li>\n          <li>The document is already indexed at the token level, meaning that each token in the document also has its own embedding.</li>\n        </ul>\n      </li>\n      <li><strong>Similarity Computation</strong>:\n        <ul>\n          <li>At query time, the system compares each query token embedding to every token embedding in the document. The similarity between two token embeddings is often measured using a dot product or cosine similarity.</li>\n          <li>For example, given a query token <code class=\"language-plaintext highlighter-rouge\">\"apple\"</code> and a document containing tokens like <code class=\"language-plaintext highlighter-rouge\">\"apple\"</code>, <code class=\"language-plaintext highlighter-rouge\">\"banana\"</code>, and <code class=\"language-plaintext highlighter-rouge\">\"fruit\"</code>, the system computes the similarity of <code class=\"language-plaintext highlighter-rouge\">\"apple\"</code> to each of these tokens.</li>\n        </ul>\n      </li>\n      <li><strong>Selecting Maximum Similarity (MaxSim)</strong>:\n        <ul>\n          <li>The system selects the highest similarity score between the query token and the document tokens. This is known as the MaxSim operation.</li>\n          <li>In the above example, the system compares the similarity of <code class=\"language-plaintext highlighter-rouge\">\"apple\"</code> (query token) with all document tokens and selects the highest similarity score, say between <code class=\"language-plaintext highlighter-rouge\">\"apple\"</code> and the corresponding token <code class=\"language-plaintext highlighter-rouge\">\"apple\"</code> in the document.</li>\n        </ul>\n      </li>\n      <li><strong>MaxSim Aggregation</strong>:\n        <blockquote>\n          <p>The MaxSim scores for each token in the query are aggregated (i.e., summed up) to calculate a final relevance score for the document with respect to the query.</p>\n        </blockquote>\n        <ul>\n          <li>This approach allows for token-level precision, capturing subtle nuances in the document-query matching that would be lost with traditional pooling methods.</li>\n        </ul>\n      </li>\n    </ol>\n  </li>\n</ul>\n<ol>\n      <li><strong>Token-level Embedding Comparisons</strong>:\n        <ul>\n          <li>When a query is processed, it is tokenized and each token is embedded separately (e.g., “apple” and “sweet”).</li>\n          <li>The document is already indexed at the token level, meaning that each token in the document also has its own embedding.</li>\n        </ul>\n      </li>\n      <li><strong>Similarity Computation</strong>:\n        <ul>\n          <li>At query time, the system compares each query token embedding to every token embedding in the document. The similarity between two token embeddings is often measured using a dot product or cosine similarity.</li>\n          <li>For example, given a query token <code class=\"language-plaintext highlighter-rouge\">\"apple\"</code> and a document containing tokens like <code class=\"language-plaintext highlighter-rouge\">\"apple\"</code>, <code class=\"language-plaintext highlighter-rouge\">\"banana\"</code>, and <code class=\"language-plaintext highlighter-rouge\">\"fruit\"</code>, the system computes the similarity of <code class=\"language-plaintext highlighter-rouge\">\"apple\"</code> to each of these tokens.</li>\n        </ul>\n      </li>\n      <li><strong>Selecting Maximum Similarity (MaxSim)</strong>:\n        <ul>\n          <li>The system selects the highest similarity score between the query token and the document tokens. This is known as the MaxSim operation.</li>\n          <li>In the above example, the system compares the similarity of <code class=\"language-plaintext highlighter-rouge\">\"apple\"</code> (query token) with all document tokens and selects the highest similarity score, say between <code class=\"language-plaintext highlighter-rouge\">\"apple\"</code> and the corresponding token <code class=\"language-plaintext highlighter-rouge\">\"apple\"</code> in the document.</li>\n        </ul>\n      </li>\n      <li><strong>MaxSim Aggregation</strong>:\n        <blockquote>\n          <p>The MaxSim scores for each token in the query are aggregated (i.e., summed up) to calculate a final relevance score for the document with respect to the query.</p>\n        </blockquote>\n        <ul>\n          <li>This approach allows for token-level precision, capturing subtle nuances in the document-query matching that would be lost with traditional pooling methods.</li>\n        </ul>\n      </li>\n    </ol>\n<ul>\n          <li>When a query is processed, it is tokenized and each token is embedded separately (e.g., “apple” and “sweet”).</li>\n          <li>The document is already indexed at the token level, meaning that each token in the document also has its own embedding.</li>\n        </ul>\n<ul>\n          <li>At query time, the system compares each query token embedding to every token embedding in the document. The similarity between two token embeddings is often measured using a dot product or cosine similarity.</li>\n          <li>For example, given a query token <code class=\"language-plaintext highlighter-rouge\">\"apple\"</code> and a document containing tokens like <code class=\"language-plaintext highlighter-rouge\">\"apple\"</code>, <code class=\"language-plaintext highlighter-rouge\">\"banana\"</code>, and <code class=\"language-plaintext highlighter-rouge\">\"fruit\"</code>, the system computes the similarity of <code class=\"language-plaintext highlighter-rouge\">\"apple\"</code> to each of these tokens.</li>\n        </ul>\n<ul>\n          <li>The system selects the highest similarity score between the query token and the document tokens. This is known as the MaxSim operation.</li>\n          <li>In the above example, the system compares the similarity of <code class=\"language-plaintext highlighter-rouge\">\"apple\"</code> (query token) with all document tokens and selects the highest similarity score, say between <code class=\"language-plaintext highlighter-rouge\">\"apple\"</code> and the corresponding token <code class=\"language-plaintext highlighter-rouge\">\"apple\"</code> in the document.</li>\n        </ul>\n<blockquote>\n          <p>The MaxSim scores for each token in the query are aggregated (i.e., summed up) to calculate a final relevance score for the document with respect to the query.</p>\n        </blockquote>\n<p>The MaxSim scores for each token in the query are aggregated (i.e., summed up) to calculate a final relevance score for the document with respect to the query.</p>\n<ul>\n          <li>This approach allows for token-level precision, capturing subtle nuances in the document-query matching that would be lost with traditional pooling methods.</li>\n        </ul>\n<h6 id=\"example-2\">Example</h6>\n<ul>\n  <li>\n    <p>Consider the query <code class=\"language-plaintext highlighter-rouge\">\"sweet apple\"</code> and two documents:</p>\n\n    <ul>\n      <li><strong>Document 1</strong>: “The apple is sweet and crisp.”</li>\n      <li><strong>Document 2</strong>: “The banana is ripe and yellow.”</li>\n    </ul>\n  </li>\n  <li>\n    <p>Each query token, <code class=\"language-plaintext highlighter-rouge\">\"sweet\"</code> and <code class=\"language-plaintext highlighter-rouge\">\"apple\"</code>, is compared with every token in both documents:</p>\n\n    <ul>\n      <li>For <strong>Document 1</strong>, <code class=\"language-plaintext highlighter-rouge\">\"sweet\"</code> has a high similarity with <code class=\"language-plaintext highlighter-rouge\">\"sweet\"</code> in the document, and <code class=\"language-plaintext highlighter-rouge\">\"apple\"</code> has a high similarity with <code class=\"language-plaintext highlighter-rouge\">\"apple\"</code>.</li>\n      <li>For <strong>Document 2</strong>, <code class=\"language-plaintext highlighter-rouge\">\"sweet\"</code> does not have a strong match with any token, and <code class=\"language-plaintext highlighter-rouge\">\"apple\"</code> does not appear.</li>\n    </ul>\n  </li>\n  <li>\n    <p>Using MaxSim, Document 1 would have a higher relevance score for the query than Document 2 because the most similar tokens in Document 1 (i.e., <code class=\"language-plaintext highlighter-rouge\">\"sweet\"</code> and <code class=\"language-plaintext highlighter-rouge\">\"apple\"</code>) align more closely with the query tokens.</p>\n  </li>\n</ul>\n<p>Consider the query <code class=\"language-plaintext highlighter-rouge\">\"sweet apple\"</code> and two documents:</p>\n<ul>\n      <li><strong>Document 1</strong>: “The apple is sweet and crisp.”</li>\n      <li><strong>Document 2</strong>: “The banana is ripe and yellow.”</li>\n    </ul>\n<p>Each query token, <code class=\"language-plaintext highlighter-rouge\">\"sweet\"</code> and <code class=\"language-plaintext highlighter-rouge\">\"apple\"</code>, is compared with every token in both documents:</p>\n<ul>\n      <li>For <strong>Document 1</strong>, <code class=\"language-plaintext highlighter-rouge\">\"sweet\"</code> has a high similarity with <code class=\"language-plaintext highlighter-rouge\">\"sweet\"</code> in the document, and <code class=\"language-plaintext highlighter-rouge\">\"apple\"</code> has a high similarity with <code class=\"language-plaintext highlighter-rouge\">\"apple\"</code>.</li>\n      <li>For <strong>Document 2</strong>, <code class=\"language-plaintext highlighter-rouge\">\"sweet\"</code> does not have a strong match with any token, and <code class=\"language-plaintext highlighter-rouge\">\"apple\"</code> does not appear.</li>\n    </ul>\n<p>Using MaxSim, Document 1 would have a higher relevance score for the query than Document 2 because the most similar tokens in Document 1 (i.e., <code class=\"language-plaintext highlighter-rouge\">\"sweet\"</code> and <code class=\"language-plaintext highlighter-rouge\">\"apple\"</code>) align more closely with the query tokens.</p>\n<h6 id=\"advantages-and-trade-offs-1\">Advantages and Trade-offs</h6>\n<ul>\n  <li><strong>Advantages</strong>:\n    <ul>\n      <li><strong>High Precision</strong>: <a href=\"https://arxiv.org/abs/2004.12832\">ColBERT</a>’s token-level comparisons, facilitated by MaxSim, lead to highly accurate retrieval, particularly for specific or complex queries.</li>\n      <li><strong>Flexible Query Matching</strong>: By calculating similarity at the token level, <a href=\"https://arxiv.org/abs/2004.12832\">ColBERT</a> can capture fine-grained relationships that simpler models might overlook.</li>\n    </ul>\n  </li>\n  <li><strong>Trade-offs</strong>:\n    <ul>\n      <li><strong>Storage Intensive</strong>: Storing all token embeddings for each document can be extremely costly. For example, storing token embeddings for a corpus of 100,000 documents could require upwards of 2.46 TB.</li>\n      <li><strong>Computational Complexity</strong>: While precise, MaxSim increases computational demands at query time, as each token in the query must be compared to all tokens in the document.</li>\n    </ul>\n  </li>\n</ul>\n<ul>\n      <li><strong>High Precision</strong>: <a href=\"https://arxiv.org/abs/2004.12832\">ColBERT</a>’s token-level comparisons, facilitated by MaxSim, lead to highly accurate retrieval, particularly for specific or complex queries.</li>\n      <li><strong>Flexible Query Matching</strong>: By calculating similarity at the token level, <a href=\"https://arxiv.org/abs/2004.12832\">ColBERT</a> can capture fine-grained relationships that simpler models might overlook.</li>\n    </ul>\n<ul>\n      <li><strong>Storage Intensive</strong>: Storing all token embeddings for each document can be extremely costly. For example, storing token embeddings for a corpus of 100,000 documents could require upwards of 2.46 TB.</li>\n      <li><strong>Computational Complexity</strong>: While precise, MaxSim increases computational demands at query time, as each token in the query must be compared to all tokens in the document.</li>\n    </ul>\n<h5 id=\"colpali-expanding-to-multimodal-late-interaction-retrieval\"><a href=\"https://arxiv.org/abs/2407.01449\">ColPali</a>: Expanding to Multimodal Late-Interaction Retrieval</h5>\n<ul>\n  <li><a href=\"https://arxiv.org/abs/2407.01449\">ColPali</a> by Faysse et al. (2024) integrates the late interaction mechanism from <a href=\"https://arxiv.org/abs/2004.12832\">ColBERT</a> with a Vision Language Model (VLM) called PaliGemma to handle multimodal documents, such as PDFs with text, images, and tables. Instead of relying on OCR and layout parsing, <a href=\"https://arxiv.org/abs/2407.01449\">ColPali</a> uses screenshots of PDF pages to directly embed both visual and textual content. This enables powerful multimodal retrieval in complex documents.</li>\n</ul>\n<h6 id=\"example-3\">Example</h6>\n<ul>\n  <li>Consider a complex PDF with both text and images. <a href=\"https://arxiv.org/abs/2407.01449\">ColPali</a> treats each page as an image and embeds it using a VLM. When a user queries the system, the query is matched with embedded screenshots via late interaction, improving the ability to retrieve relevant pages based on both visual and textual content.</li>\n</ul>\n<p><img src=\"/primers/ai/assets/RAG/ColPali.jpg\" alt=\"\"></p>\n<h5 id=\"comparative-analysis\">Comparative Analysis</h5>\n<div align=\"center\">\n<table class=\"tg\">\n <thead>\n<tr>\n<th class=\"tg-hcenter-valign-first\"><strong>Metric</strong></th>\n<th class=\"tg-hcenter-valign-first\"><strong>Naive Chunking</strong></th>\n<th class=\"tg-hcenter-valign-first\"><strong>Late Chunking</strong></th>\n<th class=\"tg-hcenter-valign-second\"><strong>Late Interaction</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td class=\"tg-tleft-valign-first\">Storage Requirements</td>\n<td class=\"tg-tleft-valign-first\">Minimal storage, ~4.9 GB for 100,000 documents</td>\n<td class=\"tg-tleft-valign-first\">Same as naive chunking, ~4.9 GB for 100,000 documents</td>\n<td class=\"tg-tleft-valign-second\">Extremely high storage, ~2.46 TB for 100,000 documents</td>\n</tr>\n<tr>\n<td class=\"tg-tleft-valign-first\">Retrieval Precision</td>\n<td class=\"tg-tleft-valign-first\">Lower precision due to context fragmentation</td>\n<td class=\"tg-tleft-valign-first\">Improved precision by retaining context across chunks</td>\n<td class=\"tg-tleft-valign-second\">Highest precision with token-level matching</td>\n</tr>\n<tr>\n<td class=\"tg-tleft-valign-first\">Complexity and Cost</td>\n<td class=\"tg-tleft-valign-first\">Simple implementation, minimal resources</td>\n<td class=\"tg-tleft-valign-first\">Moderately more complex, efficient in compute and storage</td>\n<td class=\"tg-tleft-valign-second\">Highly complex, resource-intensive in both storage and computation</td>\n</tr>\n</tbody>\n</table>\n</div>\n<table class=\"tg\">\n <thead>\n<tr>\n<th class=\"tg-hcenter-valign-first\"><strong>Metric</strong></th>\n<th class=\"tg-hcenter-valign-first\"><strong>Naive Chunking</strong></th>\n<th class=\"tg-hcenter-valign-first\"><strong>Late Chunking</strong></th>\n<th class=\"tg-hcenter-valign-second\"><strong>Late Interaction</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td class=\"tg-tleft-valign-first\">Storage Requirements</td>\n<td class=\"tg-tleft-valign-first\">Minimal storage, ~4.9 GB for 100,000 documents</td>\n<td class=\"tg-tleft-valign-first\">Same as naive chunking, ~4.9 GB for 100,000 documents</td>\n<td class=\"tg-tleft-valign-second\">Extremely high storage, ~2.46 TB for 100,000 documents</td>\n</tr>\n<tr>\n<td class=\"tg-tleft-valign-first\">Retrieval Precision</td>\n<td class=\"tg-tleft-valign-first\">Lower precision due to context fragmentation</td>\n<td class=\"tg-tleft-valign-first\">Improved precision by retaining context across chunks</td>\n<td class=\"tg-tleft-valign-second\">Highest precision with token-level matching</td>\n</tr>\n<tr>\n<td class=\"tg-tleft-valign-first\">Complexity and Cost</td>\n<td class=\"tg-tleft-valign-first\">Simple implementation, minimal resources</td>\n<td class=\"tg-tleft-valign-first\">Moderately more complex, efficient in compute and storage</td>\n<td class=\"tg-tleft-valign-second\">Highly complex, resource-intensive in both storage and computation</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"sentence-embeddings-the-what-and-why\">Sentence Embeddings: the What and Why</h4>\n<ul>\n  <li><strong>Motivation:</strong>\n    <ul>\n      <li>Before the introduction of Sentence-BERT (SBERT), applying BERT to semantic similarity or retrieval tasks was computationally infeasible at scale. BERT operated as a <em>cross-encoder</em>, where each sentence pair required a joint forward pass with full cross-attention, resulting in <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-2-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-4\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.201em, 1002.29em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-5\"><span class=\"mi\" id=\"MathJax-Span-6\" style=\"font-family: STIXGeneral-Italic;\">O</span><span class=\"mo\" id=\"MathJax-Span-7\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"msubsup\" id=\"MathJax-Span-8\"><span style=\"display: inline-block; position: relative; width: 0.94em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-9\" style=\"font-family: STIXGeneral-Italic;\">n</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.372em; left: 0.523em;\"><span class=\"mn\" id=\"MathJax-Span-10\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-11\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.378em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>O</mi><mo stretchy=\"false\">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-2\">O(n^2)</script> complexity. Using raw BERT embeddings—such as averaging token vectors or taking the <code class=\"language-plaintext highlighter-rouge\">[CLS]</code> output—performed worse than earlier static embedding models like GloVe, meaning embeddings couldn’t be precomputed or efficiently compared. Consequently, BERT was limited to re-ranking a small number of candidate sentences rather than performing large-scale semantic retrieval.</li>\n      <li>SBERT addressed this limitation by fine-tuning BERT in a Siamese or triplet configuration, enabling independent computation of sentence embeddings. This allowed <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-3-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><mi>n</mi><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-12\" style=\"width: 2.294em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.878em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1001.83em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-13\"><span class=\"mi\" id=\"MathJax-Span-14\" style=\"font-family: STIXGeneral-Italic;\">O</span><span class=\"mo\" id=\"MathJax-Span-15\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-16\" style=\"font-family: STIXGeneral-Italic;\">n</span><span class=\"mo\" id=\"MathJax-Span-17\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-3\">O(n)</script> embedding computations followed by lightweight cosine similarity comparisons, reducing semantic search computation from roughly 65 hours to 5 seconds while preserving accuracy. This breakthrough laid the foundation for modern <strong>dense retrieval</strong>, <strong>dual-encoder architectures</strong>, and <strong>retrieval-augmented generation (RAG)</strong> systems, all of which depend on scalable, precomputable embeddings.</li>\n    </ul>\n  </li>\n</ul>\n<ul>\n      <li>Before the introduction of Sentence-BERT (SBERT), applying BERT to semantic similarity or retrieval tasks was computationally infeasible at scale. BERT operated as a <em>cross-encoder</em>, where each sentence pair required a joint forward pass with full cross-attention, resulting in <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-2-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-4\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.201em, 1002.29em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-5\"><span class=\"mi\" id=\"MathJax-Span-6\" style=\"font-family: STIXGeneral-Italic;\">O</span><span class=\"mo\" id=\"MathJax-Span-7\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"msubsup\" id=\"MathJax-Span-8\"><span style=\"display: inline-block; position: relative; width: 0.94em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-9\" style=\"font-family: STIXGeneral-Italic;\">n</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.372em; left: 0.523em;\"><span class=\"mn\" id=\"MathJax-Span-10\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-11\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.378em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>O</mi><mo stretchy=\"false\">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-2\">O(n^2)</script> complexity. Using raw BERT embeddings—such as averaging token vectors or taking the <code class=\"language-plaintext highlighter-rouge\">[CLS]</code> output—performed worse than earlier static embedding models like GloVe, meaning embeddings couldn’t be precomputed or efficiently compared. Consequently, BERT was limited to re-ranking a small number of candidate sentences rather than performing large-scale semantic retrieval.</li>\n      <li>SBERT addressed this limitation by fine-tuning BERT in a Siamese or triplet configuration, enabling independent computation of sentence embeddings. This allowed <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-3-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><mi>n</mi><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-12\" style=\"width: 2.294em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.878em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1001.83em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-13\"><span class=\"mi\" id=\"MathJax-Span-14\" style=\"font-family: STIXGeneral-Italic;\">O</span><span class=\"mo\" id=\"MathJax-Span-15\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-16\" style=\"font-family: STIXGeneral-Italic;\">n</span><span class=\"mo\" id=\"MathJax-Span-17\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-3\">O(n)</script> embedding computations followed by lightweight cosine similarity comparisons, reducing semantic search computation from roughly 65 hours to 5 seconds while preserving accuracy. This breakthrough laid the foundation for modern <strong>dense retrieval</strong>, <strong>dual-encoder architectures</strong>, and <strong>retrieval-augmented generation (RAG)</strong> systems, all of which depend on scalable, precomputable embeddings.</li>\n    </ul>\n<h5 id=\"background-differences-compared-to-token-level-models-like-bert\">Background: Differences Compared to Token-Level Models Like BERT</h5>\n<ul>\n  <li>\n    <p>As an overview, let’s look into how sentence transformers differ compared to token-level embedding models such as BERT.</p>\n  </li>\n  <li>\n    <p>Sentence Transformers are a modification of the traditional BERT model, tailored specifically for generating embeddings of entire sentences (i.e., sentence embeddings). The key differences in their training approaches are:</p>\n\n    <ol>\n      <li><strong>Objective</strong>: BERT is trained to predict masked words and next sentence prediction. Sentence Transformers, as introduced in <a href=\"https://arxiv.org/abs/1908.10084\">Sentence-BERT</a> by Reimers and Gurevych (2019), are fine-tuned specifically to understand relationships between sentences. They produce embeddings where semantically similar sentences are close in vector space, typically using cosine similarity as the comparison metric.</li>\n      <li><strong>Level of Embedding</strong>: BERT provides contextualized token embeddings, while Sentence Transformers produce a single, semantically meaningful embedding for the entire sentence by applying a pooling operation to the transformer’s output.</li>\n      <li><strong>Training Data and Tasks</strong>: SBERT is fine-tuned using datasets like SNLI and MultiNLI, which contain labeled sentence pairs (entailment, contradiction, neutral). This contrastive supervision enables it to learn sentence-level semantics that generalize well to similarity tasks.</li>\n      <li><strong>Siamese and Triplet Network Structures</strong>: SBERT introduces a siamese or triplet architecture where two or three BERT models (sharing weights) encode input sentences into embeddings. During training, these embeddings are optimized so that semantically close sentences have higher cosine similarity and dissimilar ones have lower similarity.</li>\n      <li><strong>Pooling Strategies</strong>: To obtain a fixed-size vector, SBERT applies pooling over the last hidden layer of BERT. The paper experiments with three strategies—mean pooling, max pooling, and using the <code class=\"language-plaintext highlighter-rouge\">[CLS]</code> token output—with mean pooling performing best.</li>\n      <li><strong>Fine-Tuning Objectives</strong>: Depending on available supervision, SBERT can use classification (softmax over concatenated embeddings and element-wise differences), regression (cosine similarity with mean-squared error), or triplet loss objectives to align embeddings of related sentences.\n        <ul>\n          <li>For the classification objective, the embeddings <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-4-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>u</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-18\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-19\"><span class=\"mi\" id=\"MathJax-Span-20\" style=\"font-family: STIXGeneral-Italic;\">u</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>u</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-4\">u</script> and <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-5-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>v</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-21\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-22\"><span class=\"mi\" id=\"MathJax-Span-23\" style=\"font-family: STIXGeneral-Italic;\">v</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>v</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-5\">v</script> are concatenated with their element-wise absolute difference <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-6-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>&amp;#x2223;</mo><mi>u</mi><mo>&amp;#x2212;</mo><mi>v</mi><mo stretchy=&quot;false&quot;>&amp;#x2223;</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-24\" style=\"width: 3.128em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.607em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1002.5em, 2.607em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-25\"><span class=\"mo\" id=\"MathJax-Span-26\" style=\"font-family: STIXGeneral-Regular;\">∣</span><span class=\"mi\" id=\"MathJax-Span-27\" style=\"font-family: STIXGeneral-Italic;\">u</span><span class=\"mo\" id=\"MathJax-Span-28\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">−</span><span class=\"mi\" id=\"MathJax-Span-29\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.263em;\">v</span><span class=\"mo\" id=\"MathJax-Span-30\" style=\"font-family: STIXGeneral-Regular;\">∣</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mo stretchy=\"false\">∣</mo><mi>u</mi><mo>−</mo><mi>v</mi><mo stretchy=\"false\">∣</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-6\">\\mid u - v \\mid</script>, forming a vector of size <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-7-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>3</mn><mi>n</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-31\" style=\"width: 1.201em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.992em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.99em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-32\"><span class=\"mn\" id=\"MathJax-Span-33\" style=\"font-family: STIXGeneral-Regular;\">3</span><span class=\"mi\" id=\"MathJax-Span-34\" style=\"font-family: STIXGeneral-Italic;\">n</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mn>3</mn><mi>n</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-7\">3n</script>. This is passed through a fully connected linear layer with weight matrix <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-8-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>W</mi><mi>t</mi></msub><mo>&amp;#x2208;</mo><msup><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi mathvariant=&quot;double-struck&quot;>R</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>3</mn><mi>n</mi><mo>&amp;#x00D7;</mo><mi>k</mi></mrow></msup></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-35\" style=\"width: 5.523em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 4.586em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.201em, 1004.59em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-36\"><span class=\"msubsup\" id=\"MathJax-Span-37\"><span style=\"display: inline-block; position: relative; width: 1.096em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-38\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mi\" id=\"MathJax-Span-39\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">t<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-40\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">∈</span><span class=\"msubsup\" id=\"MathJax-Span-41\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 2.294em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.73em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"texatom\" id=\"MathJax-Span-42\"><span class=\"mrow\" id=\"MathJax-Span-43\"><span class=\"mi\" id=\"MathJax-Span-44\" style=\"font-family: STIXGeneral-Regular;\">ℝ</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.372em; left: 0.732em;\"><span class=\"texatom\" id=\"MathJax-Span-45\"><span class=\"mrow\" id=\"MathJax-Span-46\"><span class=\"mn\" id=\"MathJax-Span-47\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">3</span><span class=\"mi\" id=\"MathJax-Span-48\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">n</span><span class=\"mo\" id=\"MathJax-Span-49\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">×</span><span class=\"mi\" id=\"MathJax-Span-50\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.378em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>W</mi><mi>t</mi></msub><mo>∈</mo><msup><mrow class=\"MJX-TeXAtom-ORD\"><mi mathvariant=\"double-struck\">R</mi></mrow><mrow class=\"MJX-TeXAtom-ORD\"><mn>3</mn><mi>n</mi><mo>×</mo><mi>k</mi></mrow></msup></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-8\">W_t \\in \\mathbb{R}^{3n \\times k}</script> before applying softmax <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-9-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>o</mi><mo>=</mo><mtext>softmax</mtext><mo stretchy=&quot;false&quot;>(</mo><msub><mi>W</mi><mi>t</mi></msub><mo stretchy=&quot;false&quot;>[</mo><mi>u</mi><mo>;</mo><mi>v</mi><mo>;</mo><mo>&amp;#x2223;</mo><mi>u</mi><mo>&amp;#x2212;</mo><mi>v</mi><mo>&amp;#x2223;</mo><mo stretchy=&quot;false&quot;>]</mo><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-51\" style=\"width: 15.107em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 12.555em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1012.5em, 2.607em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-52\"><span class=\"mi\" id=\"MathJax-Span-53\" style=\"font-family: STIXGeneral-Italic;\">o</span><span class=\"mo\" id=\"MathJax-Span-54\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mtext\" id=\"MathJax-Span-55\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">softmax</span><span class=\"mo\" id=\"MathJax-Span-56\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"msubsup\" id=\"MathJax-Span-57\"><span style=\"display: inline-block; position: relative; width: 1.096em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-58\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mi\" id=\"MathJax-Span-59\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">t<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-60\" style=\"font-family: STIXGeneral-Regular;\">[</span><span class=\"mi\" id=\"MathJax-Span-61\" style=\"font-family: STIXGeneral-Italic;\">u</span><span class=\"mo\" id=\"MathJax-Span-62\" style=\"font-family: STIXGeneral-Regular;\">;</span><span class=\"mi\" id=\"MathJax-Span-63\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.211em;\">v</span><span class=\"mo\" id=\"MathJax-Span-64\" style=\"font-family: STIXGeneral-Regular;\">;</span><span class=\"mo\" id=\"MathJax-Span-65\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">∣</span><span class=\"mi\" id=\"MathJax-Span-66\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">u</span><span class=\"mo\" id=\"MathJax-Span-67\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">−</span><span class=\"mi\" id=\"MathJax-Span-68\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.263em;\">v</span><span class=\"mo\" id=\"MathJax-Span-69\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">∣</span><span class=\"mo\" id=\"MathJax-Span-70\" style=\"font-family: STIXGeneral-Regular;\">]</span><span class=\"mo\" id=\"MathJax-Span-71\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>o</mi><mo>=</mo><mtext>softmax</mtext><mo stretchy=\"false\">(</mo><msub><mi>W</mi><mi>t</mi></msub><mo stretchy=\"false\">[</mo><mi>u</mi><mo>;</mo><mi>v</mi><mo>;</mo><mo>∣</mo><mi>u</mi><mo>−</mo><mi>v</mi><mo>∣</mo><mo stretchy=\"false\">]</mo><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-9\">o = \\text{softmax}(W_t [u; v; \\mid u - v \\mid])</script>, where <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-10-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-72\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-73\"><span class=\"mi\" id=\"MathJax-Span-74\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-10\">k</script> is the number of output classes (since the <a href=\"https://arxiv.org/abs/1908.10084\">SBERT paper</a> focused on NLI, they were entailment, contradiction, and neutral). This projection layer provides the learned transformation before softmax classification. By removing the softmax head at inference time, SBERT reduces similarity computation from <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-11-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-75\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.201em, 1002.29em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-76\"><span class=\"mi\" id=\"MathJax-Span-77\" style=\"font-family: STIXGeneral-Italic;\">O</span><span class=\"mo\" id=\"MathJax-Span-78\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"msubsup\" id=\"MathJax-Span-79\"><span style=\"display: inline-block; position: relative; width: 0.94em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-80\" style=\"font-family: STIXGeneral-Italic;\">n</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.372em; left: 0.523em;\"><span class=\"mn\" id=\"MathJax-Span-81\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-82\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.378em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>O</mi><mo stretchy=\"false\">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-11\">O(n^2)</script> pairwise comparisons to <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-12-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><mi>n</mi><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-83\" style=\"width: 2.294em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.878em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1001.83em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-84\"><span class=\"mi\" id=\"MathJax-Span-85\" style=\"font-family: STIXGeneral-Italic;\">O</span><span class=\"mo\" id=\"MathJax-Span-86\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-87\" style=\"font-family: STIXGeneral-Italic;\">n</span><span class=\"mo\" id=\"MathJax-Span-88\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-12\">O(n)</script> independent embedding computations followed by lightweight cosine similarity scoring—enabling massive speedups in retrieval. During training, the softmax classifier makes the model <strong>close-ended</strong>, restricted to a fixed set of <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-13-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-89\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-90\"><span class=\"mi\" id=\"MathJax-Span-91\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-13\">k</script> output classes (e.g., entailment, contradiction, neutral). In contrast, inference is <strong>open-ended</strong>: without the softmax constraint, SBERT functions as a general-purpose feature extractor whose embeddings can be compared across unseen categories using cosine similarity, optionally followed by thresholding on the score <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-14-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>sim</mtext><mo stretchy=&quot;false&quot;>(</mo><mi>u</mi><mo>,</mo><mi>v</mi><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mfrac><mrow><mi>u</mi><mo>&amp;#x22C5;</mo><mi>v</mi></mrow><mrow><mo stretchy=&quot;false&quot;>&amp;#x2223;</mo><mi>u</mi><mo>&amp;#x2223;&amp;#x2223;</mo><mi>v</mi><mo stretchy=&quot;false&quot;>&amp;#x2223;</mo></mrow></mfrac></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-92\" style=\"width: 7.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 6.513em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1006.51em, 2.867em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-93\"><span class=\"mtext\" id=\"MathJax-Span-94\" style=\"font-family: STIXGeneral-Regular;\">sim</span><span class=\"mo\" id=\"MathJax-Span-95\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-96\" style=\"font-family: STIXGeneral-Italic;\">u</span><span class=\"mo\" id=\"MathJax-Span-97\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mi\" id=\"MathJax-Span-98\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.211em;\">v</span><span class=\"mo\" id=\"MathJax-Span-99\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-100\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-101\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 1.513em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.544em, 1000.84em, 4.169em, -999.997em); top: -4.424em; left: 50%; margin-left: -0.414em;\"><span class=\"mrow\" id=\"MathJax-Span-102\"><span class=\"mi\" id=\"MathJax-Span-103\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">u</span><span class=\"mo\" id=\"MathJax-Span-104\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">⋅</span><span class=\"mi\" id=\"MathJax-Span-105\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">v</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1001.3em, 4.326em, -999.997em); top: -3.591em; left: 50%; margin-left: -0.674em;\"><span class=\"mrow\" id=\"MathJax-Span-106\"><span class=\"mo\" id=\"MathJax-Span-107\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">∣</span><span class=\"mi\" id=\"MathJax-Span-108\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">u</span><span class=\"mo\" id=\"MathJax-Span-109\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">∣<span style=\"font-family: STIXGeneral-Regular; font-style: normal; font-weight: normal;\">∣</span></span><span class=\"mi\" id=\"MathJax-Span-110\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">v</span><span class=\"mo\" id=\"MathJax-Span-111\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">∣</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1001.51em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.513em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.684em; border-left: 0px solid; width: 0px; height: 1.628em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mtext>sim</mtext><mo stretchy=\"false\">(</mo><mi>u</mi><mo>,</mo><mi>v</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><mrow><mi>u</mi><mo>⋅</mo><mi>v</mi></mrow><mrow><mo stretchy=\"false\">∣</mo><mi>u</mi><mo>∣∣</mo><mi>v</mi><mo stretchy=\"false\">∣</mo></mrow></mfrac></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-14\">\\text{sim}(u, v) = \\frac{u \\cdot v}{\\mid u \\mid \\mid v \\mid}</script> for binary decisions (e.g., “similar” vs. “not similar”).</li>\n          <li>Although the original SBERT paper did not employ it, this triplet framework can be <strong>extended to Multiple Negatives Ranking Loss (MNRL)</strong>, where each batch provides multiple implicit negatives for every anchor–positive pair. MNRL improves efficiency by leveraging all non-matching pairs within a batch as negatives, making training more stable and scalable for large datasets.</li>\n        </ul>\n      </li>\n      <li><strong>Efficiency in Generating Sentence Embeddings or Similarity Tasks</strong>: In the standard BERT model, sentence embeddings are generated using the <code class=\"language-plaintext highlighter-rouge\">[CLS]</code> vector from the last layer, which performs poorly for semantic similarity (correlations as low as 0.29 on STS tasks). In contrast, SBERT dramatically improves both accuracy and computational efficiency: semantic similarity searches that would take ~65 hours with BERT can be done in about 5 seconds with SBERT.</li>\n      <li><strong>Applicability</strong>: While BERT excels at tasks requiring token-level understanding (e.g., named entity recognition, question answering), Sentence Transformers are optimized for semantic similarity, clustering, and retrieval tasks.</li>\n    </ol>\n  </li>\n  <li>The left half of the following figure (<a href=\"https://arxiv.org/abs/1908.10084\">source</a>) shows the SBERT architecture with the classification objective function, e.g., for fine-tuning on SNLI dataset. The two BERT networks have tied weights (siamese network structure).\n    <ul>\n      <li>This figure illustrates the <strong>training phase</strong>, where two tied-weight BERT encoders process sentences A and B to produce embeddings <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-15-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>u</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-112\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-113\"><span class=\"mi\" id=\"MathJax-Span-114\" style=\"font-family: STIXGeneral-Italic;\">u</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>u</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-15\">u</script> and <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-16-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>v</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-115\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-116\"><span class=\"mi\" id=\"MathJax-Span-117\" style=\"font-family: STIXGeneral-Italic;\">v</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>v</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-16\">v</script>. These embeddings are concatenated with their <strong>element-wise absolute difference <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-17-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>&amp;#x2223;</mo><mi>u</mi><mo>&amp;#x2212;</mo><mi>v</mi><mo stretchy=&quot;false&quot;>&amp;#x2223;</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-118\" style=\"width: 3.153em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.585em; height: 0px; font-size: 121%;\"><span style=\"position: absolute; clip: rect(1.397em, 1002.48em, 2.585em, -999.997em); top: -2.218em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-119\"><span class=\"mo\" id=\"MathJax-Span-120\" style=\"font-family: STIXGeneral-Regular;\">∣</span><span class=\"mi\" id=\"MathJax-Span-121\" style=\"font-family: STIXGeneral-Italic;\">u</span><span class=\"mo\" id=\"MathJax-Span-122\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.261em;\">−</span><span class=\"mi\" id=\"MathJax-Span-123\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.261em;\">v</span><span class=\"mo\" id=\"MathJax-Span-124\" style=\"font-family: STIXGeneral-Regular;\">∣</span></span><span style=\"display: inline-block; width: 0px; height: 2.224em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mo stretchy=\"false\">∣</mo><mi>u</mi><mo>−</mo><mi>v</mi><mo stretchy=\"false\">∣</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-17\">\\mid u - v \\mid</script></strong> and passed through a <strong>linear projection layer <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-18-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>W</mi><mi>t</mi></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-125\" style=\"width: 1.397em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.139em; height: 0px; font-size: 121%;\"><span style=\"position: absolute; clip: rect(1.294em, 1001.14em, 2.43em, -999.997em); top: -2.115em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-126\"><span class=\"msubsup\" id=\"MathJax-Span-127\"><span style=\"display: inline-block; position: relative; width: 1.139em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.153em, 1000.93em, 4.135em, -999.997em); top: -3.975em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-128\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.054em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 3.98em;\"></span></span><span style=\"position: absolute; top: -3.82em; left: 0.829em;\"><span class=\"mi\" id=\"MathJax-Span-129\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">t<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 3.98em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.12em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>W</mi><mi>t</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-18\">W_t</script></strong> before a softmax classifier predicts relational labels such as entailment or contradiction. The softmax layer is critical during training because it provides a supervised learning signal (with discrete classification labels) that guides the model to map semantically related sentences close together in embedding space.</li>\n    </ul>\n  </li>\n  <li>The right half of the following figure (<a href=\"https://arxiv.org/abs/1908.10084\">source</a>) shows the SBERT architecture during inference, for example, to compute similarity scores. This architecture is also used with the regression objective function.\n    <ul>\n      <li>This figure depicts the <strong>inference phase</strong>, where the trained encoders are used without the softmax classification head. Instead, embeddings are generated independently for each sentence and compared using <strong>cosine similarity</strong>, optionally followed by thresholding to make binary similarity decisions.</li>\n      <li>The removal of the softmax layer is essential because, if retained, it would require concatenating pairs of embeddings and performing a new forward pass for each pair—reintroducing the <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-19-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-130\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.201em, 1002.29em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-131\"><span class=\"mi\" id=\"MathJax-Span-132\" style=\"font-family: STIXGeneral-Italic;\">O</span><span class=\"mo\" id=\"MathJax-Span-133\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"msubsup\" id=\"MathJax-Span-134\"><span style=\"display: inline-block; position: relative; width: 0.94em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-135\" style=\"font-family: STIXGeneral-Italic;\">n</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.372em; left: 0.523em;\"><span class=\"mn\" id=\"MathJax-Span-136\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-137\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.378em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>O</mi><mo stretchy=\"false\">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-19\">O(n^2)</script> cost of cross-encoding. Without the softmax layer, embeddings can be computed once per sentence (offline or on-demand), allowing fast vector-based retrieval and comparison. In other words, omitting the softmax during inference enables the key property that makes SBERT efficient: sentence embeddings become <strong>independent representations</strong> that can be precomputed and compared directly using cosine similarity, without needing joint inference over pairs.</li>\n    </ul>\n  </li>\n</ul>\n<p>As an overview, let’s look into how sentence transformers differ compared to token-level embedding models such as BERT.</p>\n<p>Sentence Transformers are a modification of the traditional BERT model, tailored specifically for generating embeddings of entire sentences (i.e., sentence embeddings). The key differences in their training approaches are:</p>\n<ol>\n      <li><strong>Objective</strong>: BERT is trained to predict masked words and next sentence prediction. Sentence Transformers, as introduced in <a href=\"https://arxiv.org/abs/1908.10084\">Sentence-BERT</a> by Reimers and Gurevych (2019), are fine-tuned specifically to understand relationships between sentences. They produce embeddings where semantically similar sentences are close in vector space, typically using cosine similarity as the comparison metric.</li>\n      <li><strong>Level of Embedding</strong>: BERT provides contextualized token embeddings, while Sentence Transformers produce a single, semantically meaningful embedding for the entire sentence by applying a pooling operation to the transformer’s output.</li>\n      <li><strong>Training Data and Tasks</strong>: SBERT is fine-tuned using datasets like SNLI and MultiNLI, which contain labeled sentence pairs (entailment, contradiction, neutral). This contrastive supervision enables it to learn sentence-level semantics that generalize well to similarity tasks.</li>\n      <li><strong>Siamese and Triplet Network Structures</strong>: SBERT introduces a siamese or triplet architecture where two or three BERT models (sharing weights) encode input sentences into embeddings. During training, these embeddings are optimized so that semantically close sentences have higher cosine similarity and dissimilar ones have lower similarity.</li>\n      <li><strong>Pooling Strategies</strong>: To obtain a fixed-size vector, SBERT applies pooling over the last hidden layer of BERT. The paper experiments with three strategies—mean pooling, max pooling, and using the <code class=\"language-plaintext highlighter-rouge\">[CLS]</code> token output—with mean pooling performing best.</li>\n      <li><strong>Fine-Tuning Objectives</strong>: Depending on available supervision, SBERT can use classification (softmax over concatenated embeddings and element-wise differences), regression (cosine similarity with mean-squared error), or triplet loss objectives to align embeddings of related sentences.\n        <ul>\n          <li>For the classification objective, the embeddings <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-4-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>u</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-18\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-19\"><span class=\"mi\" id=\"MathJax-Span-20\" style=\"font-family: STIXGeneral-Italic;\">u</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>u</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-4\">u</script> and <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-5-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>v</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-21\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-22\"><span class=\"mi\" id=\"MathJax-Span-23\" style=\"font-family: STIXGeneral-Italic;\">v</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>v</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-5\">v</script> are concatenated with their element-wise absolute difference <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-6-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>&amp;#x2223;</mo><mi>u</mi><mo>&amp;#x2212;</mo><mi>v</mi><mo stretchy=&quot;false&quot;>&amp;#x2223;</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-24\" style=\"width: 3.128em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.607em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1002.5em, 2.607em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-25\"><span class=\"mo\" id=\"MathJax-Span-26\" style=\"font-family: STIXGeneral-Regular;\">∣</span><span class=\"mi\" id=\"MathJax-Span-27\" style=\"font-family: STIXGeneral-Italic;\">u</span><span class=\"mo\" id=\"MathJax-Span-28\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">−</span><span class=\"mi\" id=\"MathJax-Span-29\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.263em;\">v</span><span class=\"mo\" id=\"MathJax-Span-30\" style=\"font-family: STIXGeneral-Regular;\">∣</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mo stretchy=\"false\">∣</mo><mi>u</mi><mo>−</mo><mi>v</mi><mo stretchy=\"false\">∣</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-6\">\\mid u - v \\mid</script>, forming a vector of size <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-7-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>3</mn><mi>n</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-31\" style=\"width: 1.201em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.992em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.99em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-32\"><span class=\"mn\" id=\"MathJax-Span-33\" style=\"font-family: STIXGeneral-Regular;\">3</span><span class=\"mi\" id=\"MathJax-Span-34\" style=\"font-family: STIXGeneral-Italic;\">n</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mn>3</mn><mi>n</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-7\">3n</script>. This is passed through a fully connected linear layer with weight matrix <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-8-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>W</mi><mi>t</mi></msub><mo>&amp;#x2208;</mo><msup><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi mathvariant=&quot;double-struck&quot;>R</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>3</mn><mi>n</mi><mo>&amp;#x00D7;</mo><mi>k</mi></mrow></msup></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-35\" style=\"width: 5.523em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 4.586em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.201em, 1004.59em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-36\"><span class=\"msubsup\" id=\"MathJax-Span-37\"><span style=\"display: inline-block; position: relative; width: 1.096em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-38\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mi\" id=\"MathJax-Span-39\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">t<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-40\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">∈</span><span class=\"msubsup\" id=\"MathJax-Span-41\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 2.294em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.73em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"texatom\" id=\"MathJax-Span-42\"><span class=\"mrow\" id=\"MathJax-Span-43\"><span class=\"mi\" id=\"MathJax-Span-44\" style=\"font-family: STIXGeneral-Regular;\">ℝ</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.372em; left: 0.732em;\"><span class=\"texatom\" id=\"MathJax-Span-45\"><span class=\"mrow\" id=\"MathJax-Span-46\"><span class=\"mn\" id=\"MathJax-Span-47\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">3</span><span class=\"mi\" id=\"MathJax-Span-48\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">n</span><span class=\"mo\" id=\"MathJax-Span-49\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">×</span><span class=\"mi\" id=\"MathJax-Span-50\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.378em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>W</mi><mi>t</mi></msub><mo>∈</mo><msup><mrow class=\"MJX-TeXAtom-ORD\"><mi mathvariant=\"double-struck\">R</mi></mrow><mrow class=\"MJX-TeXAtom-ORD\"><mn>3</mn><mi>n</mi><mo>×</mo><mi>k</mi></mrow></msup></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-8\">W_t \\in \\mathbb{R}^{3n \\times k}</script> before applying softmax <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-9-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>o</mi><mo>=</mo><mtext>softmax</mtext><mo stretchy=&quot;false&quot;>(</mo><msub><mi>W</mi><mi>t</mi></msub><mo stretchy=&quot;false&quot;>[</mo><mi>u</mi><mo>;</mo><mi>v</mi><mo>;</mo><mo>&amp;#x2223;</mo><mi>u</mi><mo>&amp;#x2212;</mo><mi>v</mi><mo>&amp;#x2223;</mo><mo stretchy=&quot;false&quot;>]</mo><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-51\" style=\"width: 15.107em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 12.555em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1012.5em, 2.607em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-52\"><span class=\"mi\" id=\"MathJax-Span-53\" style=\"font-family: STIXGeneral-Italic;\">o</span><span class=\"mo\" id=\"MathJax-Span-54\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mtext\" id=\"MathJax-Span-55\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">softmax</span><span class=\"mo\" id=\"MathJax-Span-56\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"msubsup\" id=\"MathJax-Span-57\"><span style=\"display: inline-block; position: relative; width: 1.096em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-58\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mi\" id=\"MathJax-Span-59\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">t<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-60\" style=\"font-family: STIXGeneral-Regular;\">[</span><span class=\"mi\" id=\"MathJax-Span-61\" style=\"font-family: STIXGeneral-Italic;\">u</span><span class=\"mo\" id=\"MathJax-Span-62\" style=\"font-family: STIXGeneral-Regular;\">;</span><span class=\"mi\" id=\"MathJax-Span-63\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.211em;\">v</span><span class=\"mo\" id=\"MathJax-Span-64\" style=\"font-family: STIXGeneral-Regular;\">;</span><span class=\"mo\" id=\"MathJax-Span-65\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">∣</span><span class=\"mi\" id=\"MathJax-Span-66\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">u</span><span class=\"mo\" id=\"MathJax-Span-67\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">−</span><span class=\"mi\" id=\"MathJax-Span-68\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.263em;\">v</span><span class=\"mo\" id=\"MathJax-Span-69\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">∣</span><span class=\"mo\" id=\"MathJax-Span-70\" style=\"font-family: STIXGeneral-Regular;\">]</span><span class=\"mo\" id=\"MathJax-Span-71\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>o</mi><mo>=</mo><mtext>softmax</mtext><mo stretchy=\"false\">(</mo><msub><mi>W</mi><mi>t</mi></msub><mo stretchy=\"false\">[</mo><mi>u</mi><mo>;</mo><mi>v</mi><mo>;</mo><mo>∣</mo><mi>u</mi><mo>−</mo><mi>v</mi><mo>∣</mo><mo stretchy=\"false\">]</mo><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-9\">o = \\text{softmax}(W_t [u; v; \\mid u - v \\mid])</script>, where <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-10-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-72\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-73\"><span class=\"mi\" id=\"MathJax-Span-74\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-10\">k</script> is the number of output classes (since the <a href=\"https://arxiv.org/abs/1908.10084\">SBERT paper</a> focused on NLI, they were entailment, contradiction, and neutral). This projection layer provides the learned transformation before softmax classification. By removing the softmax head at inference time, SBERT reduces similarity computation from <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-11-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-75\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.201em, 1002.29em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-76\"><span class=\"mi\" id=\"MathJax-Span-77\" style=\"font-family: STIXGeneral-Italic;\">O</span><span class=\"mo\" id=\"MathJax-Span-78\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"msubsup\" id=\"MathJax-Span-79\"><span style=\"display: inline-block; position: relative; width: 0.94em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-80\" style=\"font-family: STIXGeneral-Italic;\">n</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.372em; left: 0.523em;\"><span class=\"mn\" id=\"MathJax-Span-81\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-82\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.378em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>O</mi><mo stretchy=\"false\">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-11\">O(n^2)</script> pairwise comparisons to <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-12-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><mi>n</mi><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-83\" style=\"width: 2.294em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.878em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1001.83em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-84\"><span class=\"mi\" id=\"MathJax-Span-85\" style=\"font-family: STIXGeneral-Italic;\">O</span><span class=\"mo\" id=\"MathJax-Span-86\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-87\" style=\"font-family: STIXGeneral-Italic;\">n</span><span class=\"mo\" id=\"MathJax-Span-88\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-12\">O(n)</script> independent embedding computations followed by lightweight cosine similarity scoring—enabling massive speedups in retrieval. During training, the softmax classifier makes the model <strong>close-ended</strong>, restricted to a fixed set of <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-13-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-89\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-90\"><span class=\"mi\" id=\"MathJax-Span-91\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-13\">k</script> output classes (e.g., entailment, contradiction, neutral). In contrast, inference is <strong>open-ended</strong>: without the softmax constraint, SBERT functions as a general-purpose feature extractor whose embeddings can be compared across unseen categories using cosine similarity, optionally followed by thresholding on the score <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-14-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>sim</mtext><mo stretchy=&quot;false&quot;>(</mo><mi>u</mi><mo>,</mo><mi>v</mi><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mfrac><mrow><mi>u</mi><mo>&amp;#x22C5;</mo><mi>v</mi></mrow><mrow><mo stretchy=&quot;false&quot;>&amp;#x2223;</mo><mi>u</mi><mo>&amp;#x2223;&amp;#x2223;</mo><mi>v</mi><mo stretchy=&quot;false&quot;>&amp;#x2223;</mo></mrow></mfrac></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-92\" style=\"width: 7.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 6.513em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1006.51em, 2.867em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-93\"><span class=\"mtext\" id=\"MathJax-Span-94\" style=\"font-family: STIXGeneral-Regular;\">sim</span><span class=\"mo\" id=\"MathJax-Span-95\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-96\" style=\"font-family: STIXGeneral-Italic;\">u</span><span class=\"mo\" id=\"MathJax-Span-97\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mi\" id=\"MathJax-Span-98\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.211em;\">v</span><span class=\"mo\" id=\"MathJax-Span-99\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-100\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-101\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 1.513em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.544em, 1000.84em, 4.169em, -999.997em); top: -4.424em; left: 50%; margin-left: -0.414em;\"><span class=\"mrow\" id=\"MathJax-Span-102\"><span class=\"mi\" id=\"MathJax-Span-103\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">u</span><span class=\"mo\" id=\"MathJax-Span-104\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">⋅</span><span class=\"mi\" id=\"MathJax-Span-105\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">v</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1001.3em, 4.326em, -999.997em); top: -3.591em; left: 50%; margin-left: -0.674em;\"><span class=\"mrow\" id=\"MathJax-Span-106\"><span class=\"mo\" id=\"MathJax-Span-107\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">∣</span><span class=\"mi\" id=\"MathJax-Span-108\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">u</span><span class=\"mo\" id=\"MathJax-Span-109\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">∣<span style=\"font-family: STIXGeneral-Regular; font-style: normal; font-weight: normal;\">∣</span></span><span class=\"mi\" id=\"MathJax-Span-110\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">v</span><span class=\"mo\" id=\"MathJax-Span-111\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">∣</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1001.51em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.513em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.684em; border-left: 0px solid; width: 0px; height: 1.628em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mtext>sim</mtext><mo stretchy=\"false\">(</mo><mi>u</mi><mo>,</mo><mi>v</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><mrow><mi>u</mi><mo>⋅</mo><mi>v</mi></mrow><mrow><mo stretchy=\"false\">∣</mo><mi>u</mi><mo>∣∣</mo><mi>v</mi><mo stretchy=\"false\">∣</mo></mrow></mfrac></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-14\">\\text{sim}(u, v) = \\frac{u \\cdot v}{\\mid u \\mid \\mid v \\mid}</script> for binary decisions (e.g., “similar” vs. “not similar”).</li>\n          <li>Although the original SBERT paper did not employ it, this triplet framework can be <strong>extended to Multiple Negatives Ranking Loss (MNRL)</strong>, where each batch provides multiple implicit negatives for every anchor–positive pair. MNRL improves efficiency by leveraging all non-matching pairs within a batch as negatives, making training more stable and scalable for large datasets.</li>\n        </ul>\n      </li>\n      <li><strong>Efficiency in Generating Sentence Embeddings or Similarity Tasks</strong>: In the standard BERT model, sentence embeddings are generated using the <code class=\"language-plaintext highlighter-rouge\">[CLS]</code> vector from the last layer, which performs poorly for semantic similarity (correlations as low as 0.29 on STS tasks). In contrast, SBERT dramatically improves both accuracy and computational efficiency: semantic similarity searches that would take ~65 hours with BERT can be done in about 5 seconds with SBERT.</li>\n      <li><strong>Applicability</strong>: While BERT excels at tasks requiring token-level understanding (e.g., named entity recognition, question answering), Sentence Transformers are optimized for semantic similarity, clustering, and retrieval tasks.</li>\n    </ol>\n<ul>\n          <li>For the classification objective, the embeddings <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-4-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>u</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-18\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-19\"><span class=\"mi\" id=\"MathJax-Span-20\" style=\"font-family: STIXGeneral-Italic;\">u</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>u</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-4\">u</script> and <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-5-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>v</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-21\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-22\"><span class=\"mi\" id=\"MathJax-Span-23\" style=\"font-family: STIXGeneral-Italic;\">v</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>v</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-5\">v</script> are concatenated with their element-wise absolute difference <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-6-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>&amp;#x2223;</mo><mi>u</mi><mo>&amp;#x2212;</mo><mi>v</mi><mo stretchy=&quot;false&quot;>&amp;#x2223;</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-24\" style=\"width: 3.128em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.607em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1002.5em, 2.607em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-25\"><span class=\"mo\" id=\"MathJax-Span-26\" style=\"font-family: STIXGeneral-Regular;\">∣</span><span class=\"mi\" id=\"MathJax-Span-27\" style=\"font-family: STIXGeneral-Italic;\">u</span><span class=\"mo\" id=\"MathJax-Span-28\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">−</span><span class=\"mi\" id=\"MathJax-Span-29\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.263em;\">v</span><span class=\"mo\" id=\"MathJax-Span-30\" style=\"font-family: STIXGeneral-Regular;\">∣</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mo stretchy=\"false\">∣</mo><mi>u</mi><mo>−</mo><mi>v</mi><mo stretchy=\"false\">∣</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-6\">\\mid u - v \\mid</script>, forming a vector of size <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-7-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>3</mn><mi>n</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-31\" style=\"width: 1.201em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.992em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.99em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-32\"><span class=\"mn\" id=\"MathJax-Span-33\" style=\"font-family: STIXGeneral-Regular;\">3</span><span class=\"mi\" id=\"MathJax-Span-34\" style=\"font-family: STIXGeneral-Italic;\">n</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mn>3</mn><mi>n</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-7\">3n</script>. This is passed through a fully connected linear layer with weight matrix <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-8-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>W</mi><mi>t</mi></msub><mo>&amp;#x2208;</mo><msup><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi mathvariant=&quot;double-struck&quot;>R</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>3</mn><mi>n</mi><mo>&amp;#x00D7;</mo><mi>k</mi></mrow></msup></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-35\" style=\"width: 5.523em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 4.586em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.201em, 1004.59em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-36\"><span class=\"msubsup\" id=\"MathJax-Span-37\"><span style=\"display: inline-block; position: relative; width: 1.096em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-38\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mi\" id=\"MathJax-Span-39\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">t<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-40\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">∈</span><span class=\"msubsup\" id=\"MathJax-Span-41\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 2.294em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.73em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"texatom\" id=\"MathJax-Span-42\"><span class=\"mrow\" id=\"MathJax-Span-43\"><span class=\"mi\" id=\"MathJax-Span-44\" style=\"font-family: STIXGeneral-Regular;\">ℝ</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.372em; left: 0.732em;\"><span class=\"texatom\" id=\"MathJax-Span-45\"><span class=\"mrow\" id=\"MathJax-Span-46\"><span class=\"mn\" id=\"MathJax-Span-47\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">3</span><span class=\"mi\" id=\"MathJax-Span-48\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">n</span><span class=\"mo\" id=\"MathJax-Span-49\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">×</span><span class=\"mi\" id=\"MathJax-Span-50\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.378em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>W</mi><mi>t</mi></msub><mo>∈</mo><msup><mrow class=\"MJX-TeXAtom-ORD\"><mi mathvariant=\"double-struck\">R</mi></mrow><mrow class=\"MJX-TeXAtom-ORD\"><mn>3</mn><mi>n</mi><mo>×</mo><mi>k</mi></mrow></msup></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-8\">W_t \\in \\mathbb{R}^{3n \\times k}</script> before applying softmax <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-9-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>o</mi><mo>=</mo><mtext>softmax</mtext><mo stretchy=&quot;false&quot;>(</mo><msub><mi>W</mi><mi>t</mi></msub><mo stretchy=&quot;false&quot;>[</mo><mi>u</mi><mo>;</mo><mi>v</mi><mo>;</mo><mo>&amp;#x2223;</mo><mi>u</mi><mo>&amp;#x2212;</mo><mi>v</mi><mo>&amp;#x2223;</mo><mo stretchy=&quot;false&quot;>]</mo><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-51\" style=\"width: 15.107em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 12.555em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1012.5em, 2.607em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-52\"><span class=\"mi\" id=\"MathJax-Span-53\" style=\"font-family: STIXGeneral-Italic;\">o</span><span class=\"mo\" id=\"MathJax-Span-54\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mtext\" id=\"MathJax-Span-55\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">softmax</span><span class=\"mo\" id=\"MathJax-Span-56\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"msubsup\" id=\"MathJax-Span-57\"><span style=\"display: inline-block; position: relative; width: 1.096em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-58\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mi\" id=\"MathJax-Span-59\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">t<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-60\" style=\"font-family: STIXGeneral-Regular;\">[</span><span class=\"mi\" id=\"MathJax-Span-61\" style=\"font-family: STIXGeneral-Italic;\">u</span><span class=\"mo\" id=\"MathJax-Span-62\" style=\"font-family: STIXGeneral-Regular;\">;</span><span class=\"mi\" id=\"MathJax-Span-63\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.211em;\">v</span><span class=\"mo\" id=\"MathJax-Span-64\" style=\"font-family: STIXGeneral-Regular;\">;</span><span class=\"mo\" id=\"MathJax-Span-65\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">∣</span><span class=\"mi\" id=\"MathJax-Span-66\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">u</span><span class=\"mo\" id=\"MathJax-Span-67\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">−</span><span class=\"mi\" id=\"MathJax-Span-68\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.263em;\">v</span><span class=\"mo\" id=\"MathJax-Span-69\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">∣</span><span class=\"mo\" id=\"MathJax-Span-70\" style=\"font-family: STIXGeneral-Regular;\">]</span><span class=\"mo\" id=\"MathJax-Span-71\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>o</mi><mo>=</mo><mtext>softmax</mtext><mo stretchy=\"false\">(</mo><msub><mi>W</mi><mi>t</mi></msub><mo stretchy=\"false\">[</mo><mi>u</mi><mo>;</mo><mi>v</mi><mo>;</mo><mo>∣</mo><mi>u</mi><mo>−</mo><mi>v</mi><mo>∣</mo><mo stretchy=\"false\">]</mo><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-9\">o = \\text{softmax}(W_t [u; v; \\mid u - v \\mid])</script>, where <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-10-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-72\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-73\"><span class=\"mi\" id=\"MathJax-Span-74\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-10\">k</script> is the number of output classes (since the <a href=\"https://arxiv.org/abs/1908.10084\">SBERT paper</a> focused on NLI, they were entailment, contradiction, and neutral). This projection layer provides the learned transformation before softmax classification. By removing the softmax head at inference time, SBERT reduces similarity computation from <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-11-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-75\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.201em, 1002.29em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-76\"><span class=\"mi\" id=\"MathJax-Span-77\" style=\"font-family: STIXGeneral-Italic;\">O</span><span class=\"mo\" id=\"MathJax-Span-78\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"msubsup\" id=\"MathJax-Span-79\"><span style=\"display: inline-block; position: relative; width: 0.94em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-80\" style=\"font-family: STIXGeneral-Italic;\">n</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.372em; left: 0.523em;\"><span class=\"mn\" id=\"MathJax-Span-81\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-82\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.378em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>O</mi><mo stretchy=\"false\">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-11\">O(n^2)</script> pairwise comparisons to <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-12-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><mi>n</mi><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-83\" style=\"width: 2.294em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.878em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1001.83em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-84\"><span class=\"mi\" id=\"MathJax-Span-85\" style=\"font-family: STIXGeneral-Italic;\">O</span><span class=\"mo\" id=\"MathJax-Span-86\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-87\" style=\"font-family: STIXGeneral-Italic;\">n</span><span class=\"mo\" id=\"MathJax-Span-88\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-12\">O(n)</script> independent embedding computations followed by lightweight cosine similarity scoring—enabling massive speedups in retrieval. During training, the softmax classifier makes the model <strong>close-ended</strong>, restricted to a fixed set of <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-13-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-89\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-90\"><span class=\"mi\" id=\"MathJax-Span-91\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-13\">k</script> output classes (e.g., entailment, contradiction, neutral). In contrast, inference is <strong>open-ended</strong>: without the softmax constraint, SBERT functions as a general-purpose feature extractor whose embeddings can be compared across unseen categories using cosine similarity, optionally followed by thresholding on the score <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-14-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>sim</mtext><mo stretchy=&quot;false&quot;>(</mo><mi>u</mi><mo>,</mo><mi>v</mi><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mfrac><mrow><mi>u</mi><mo>&amp;#x22C5;</mo><mi>v</mi></mrow><mrow><mo stretchy=&quot;false&quot;>&amp;#x2223;</mo><mi>u</mi><mo>&amp;#x2223;&amp;#x2223;</mo><mi>v</mi><mo stretchy=&quot;false&quot;>&amp;#x2223;</mo></mrow></mfrac></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-92\" style=\"width: 7.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 6.513em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1006.51em, 2.867em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-93\"><span class=\"mtext\" id=\"MathJax-Span-94\" style=\"font-family: STIXGeneral-Regular;\">sim</span><span class=\"mo\" id=\"MathJax-Span-95\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-96\" style=\"font-family: STIXGeneral-Italic;\">u</span><span class=\"mo\" id=\"MathJax-Span-97\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mi\" id=\"MathJax-Span-98\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.211em;\">v</span><span class=\"mo\" id=\"MathJax-Span-99\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-100\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-101\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 1.513em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.544em, 1000.84em, 4.169em, -999.997em); top: -4.424em; left: 50%; margin-left: -0.414em;\"><span class=\"mrow\" id=\"MathJax-Span-102\"><span class=\"mi\" id=\"MathJax-Span-103\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">u</span><span class=\"mo\" id=\"MathJax-Span-104\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">⋅</span><span class=\"mi\" id=\"MathJax-Span-105\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">v</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1001.3em, 4.326em, -999.997em); top: -3.591em; left: 50%; margin-left: -0.674em;\"><span class=\"mrow\" id=\"MathJax-Span-106\"><span class=\"mo\" id=\"MathJax-Span-107\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">∣</span><span class=\"mi\" id=\"MathJax-Span-108\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">u</span><span class=\"mo\" id=\"MathJax-Span-109\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">∣<span style=\"font-family: STIXGeneral-Regular; font-style: normal; font-weight: normal;\">∣</span></span><span class=\"mi\" id=\"MathJax-Span-110\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">v</span><span class=\"mo\" id=\"MathJax-Span-111\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">∣</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1001.51em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.513em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.684em; border-left: 0px solid; width: 0px; height: 1.628em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mtext>sim</mtext><mo stretchy=\"false\">(</mo><mi>u</mi><mo>,</mo><mi>v</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><mrow><mi>u</mi><mo>⋅</mo><mi>v</mi></mrow><mrow><mo stretchy=\"false\">∣</mo><mi>u</mi><mo>∣∣</mo><mi>v</mi><mo stretchy=\"false\">∣</mo></mrow></mfrac></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-14\">\\text{sim}(u, v) = \\frac{u \\cdot v}{\\mid u \\mid \\mid v \\mid}</script> for binary decisions (e.g., “similar” vs. “not similar”).</li>\n          <li>Although the original SBERT paper did not employ it, this triplet framework can be <strong>extended to Multiple Negatives Ranking Loss (MNRL)</strong>, where each batch provides multiple implicit negatives for every anchor–positive pair. MNRL improves efficiency by leveraging all non-matching pairs within a batch as negatives, making training more stable and scalable for large datasets.</li>\n        </ul>\n<ul>\n      <li>This figure illustrates the <strong>training phase</strong>, where two tied-weight BERT encoders process sentences A and B to produce embeddings <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-15-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>u</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-112\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-113\"><span class=\"mi\" id=\"MathJax-Span-114\" style=\"font-family: STIXGeneral-Italic;\">u</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>u</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-15\">u</script> and <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-16-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>v</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-115\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-116\"><span class=\"mi\" id=\"MathJax-Span-117\" style=\"font-family: STIXGeneral-Italic;\">v</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>v</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-16\">v</script>. These embeddings are concatenated with their <strong>element-wise absolute difference <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-17-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>&amp;#x2223;</mo><mi>u</mi><mo>&amp;#x2212;</mo><mi>v</mi><mo stretchy=&quot;false&quot;>&amp;#x2223;</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-118\" style=\"width: 3.153em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.585em; height: 0px; font-size: 121%;\"><span style=\"position: absolute; clip: rect(1.397em, 1002.48em, 2.585em, -999.997em); top: -2.218em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-119\"><span class=\"mo\" id=\"MathJax-Span-120\" style=\"font-family: STIXGeneral-Regular;\">∣</span><span class=\"mi\" id=\"MathJax-Span-121\" style=\"font-family: STIXGeneral-Italic;\">u</span><span class=\"mo\" id=\"MathJax-Span-122\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.261em;\">−</span><span class=\"mi\" id=\"MathJax-Span-123\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.261em;\">v</span><span class=\"mo\" id=\"MathJax-Span-124\" style=\"font-family: STIXGeneral-Regular;\">∣</span></span><span style=\"display: inline-block; width: 0px; height: 2.224em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mo stretchy=\"false\">∣</mo><mi>u</mi><mo>−</mo><mi>v</mi><mo stretchy=\"false\">∣</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-17\">\\mid u - v \\mid</script></strong> and passed through a <strong>linear projection layer <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-18-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>W</mi><mi>t</mi></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-125\" style=\"width: 1.397em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.139em; height: 0px; font-size: 121%;\"><span style=\"position: absolute; clip: rect(1.294em, 1001.14em, 2.43em, -999.997em); top: -2.115em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-126\"><span class=\"msubsup\" id=\"MathJax-Span-127\"><span style=\"display: inline-block; position: relative; width: 1.139em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.153em, 1000.93em, 4.135em, -999.997em); top: -3.975em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-128\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.054em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 3.98em;\"></span></span><span style=\"position: absolute; top: -3.82em; left: 0.829em;\"><span class=\"mi\" id=\"MathJax-Span-129\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">t<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 3.98em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.12em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>W</mi><mi>t</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-18\">W_t</script></strong> before a softmax classifier predicts relational labels such as entailment or contradiction. The softmax layer is critical during training because it provides a supervised learning signal (with discrete classification labels) that guides the model to map semantically related sentences close together in embedding space.</li>\n    </ul>\n<ul>\n      <li>This figure depicts the <strong>inference phase</strong>, where the trained encoders are used without the softmax classification head. Instead, embeddings are generated independently for each sentence and compared using <strong>cosine similarity</strong>, optionally followed by thresholding to make binary similarity decisions.</li>\n      <li>The removal of the softmax layer is essential because, if retained, it would require concatenating pairs of embeddings and performing a new forward pass for each pair—reintroducing the <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-19-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-130\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.201em, 1002.29em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-131\"><span class=\"mi\" id=\"MathJax-Span-132\" style=\"font-family: STIXGeneral-Italic;\">O</span><span class=\"mo\" id=\"MathJax-Span-133\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"msubsup\" id=\"MathJax-Span-134\"><span style=\"display: inline-block; position: relative; width: 0.94em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-135\" style=\"font-family: STIXGeneral-Italic;\">n</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.372em; left: 0.523em;\"><span class=\"mn\" id=\"MathJax-Span-136\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-137\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.378em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>O</mi><mo stretchy=\"false\">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-19\">O(n^2)</script> cost of cross-encoding. Without the softmax layer, embeddings can be computed once per sentence (offline or on-demand), allowing fast vector-based retrieval and comparison. In other words, omitting the softmax during inference enables the key property that makes SBERT efficient: sentence embeddings become <strong>independent representations</strong> that can be precomputed and compared directly using cosine similarity, without needing joint inference over pairs.</li>\n    </ul>\n<p><img src=\"../../../images/papers/sbert.jpg\" alt=\"\"></p>\n<ul>\n  <li>In summary, while BERT is a general-purpose contextual language model, Sentence Transformers like SBERT are optimized for semantic comparison at the sentence level, producing dense, meaningful embeddings well-suited for similarity-based tasks.</li>\n</ul>\n<h5 id=\"training-process-for-sentence-transformers-vs-token-level-embedding-models\">Training Process for Sentence Transformers vs. Token-Level Embedding Models</h5>\n<ul>\n  <li>\n    <p>Sentence Transformers are trained differently from token-level models such as BERT. Their process focuses on aligning sentence meanings rather than predicting masked words.</p>\n\n    <ol>\n      <li><strong>Model Architecture</strong>: SBERT builds on pretrained BERT or RoBERTa models by adding a pooling layer that converts token-level outputs into a single sentence embedding.</li>\n      <li><strong>Training Data</strong>: SBERT is fine-tuned on Natural Language Inference (NLI) datasets like SNLI and MultiNLI, containing hundreds of thousands of labeled sentence pairs that capture semantic relations.</li>\n      <li><strong>Training Objectives</strong>:\n        <ul>\n          <li><strong>Classification Objective</strong>: Concatenates embeddings of two sentences <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-20-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>(</mo><mi>u</mi><mo>,</mo><mi>v</mi><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-138\" style=\"width: 2.607em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.138em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1002.09em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-139\"><span class=\"mo\" id=\"MathJax-Span-140\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-141\" style=\"font-family: STIXGeneral-Italic;\">u</span><span class=\"mo\" id=\"MathJax-Span-142\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mi\" id=\"MathJax-Span-143\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.211em;\">v</span><span class=\"mo\" id=\"MathJax-Span-144\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mo stretchy=\"false\">(</mo><mi>u</mi><mo>,</mo><mi>v</mi><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-20\">(u, v)</script> with their element-wise absolute difference <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-21-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>&amp;#x2223;</mo><mi>u</mi><mo>&amp;#x2212;</mo><mi>v</mi><mo stretchy=&quot;false&quot;>&amp;#x2223;</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-145\" style=\"width: 3.128em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.607em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1002.5em, 2.607em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-146\"><span class=\"mo\" id=\"MathJax-Span-147\" style=\"font-family: STIXGeneral-Regular;\">∣</span><span class=\"mi\" id=\"MathJax-Span-148\" style=\"font-family: STIXGeneral-Italic;\">u</span><span class=\"mo\" id=\"MathJax-Span-149\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">−</span><span class=\"mi\" id=\"MathJax-Span-150\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.263em;\">v</span><span class=\"mo\" id=\"MathJax-Span-151\" style=\"font-family: STIXGeneral-Regular;\">∣</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mo stretchy=\"false\">∣</mo><mi>u</mi><mo>−</mo><mi>v</mi><mo stretchy=\"false\">∣</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-21\">\\mid u - v \\mid</script>, projects the resulting <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-22-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>3</mn><mi>n</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-152\" style=\"width: 1.201em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.992em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.99em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-153\"><span class=\"mn\" id=\"MathJax-Span-154\" style=\"font-family: STIXGeneral-Regular;\">3</span><span class=\"mi\" id=\"MathJax-Span-155\" style=\"font-family: STIXGeneral-Italic;\">n</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mn>3</mn><mi>n</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-22\">3n</script>-dimensional vector through a linear layer <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-23-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>W</mi><mi>t</mi></msub><mo>&amp;#x2208;</mo><msup><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi mathvariant=&quot;double-struck&quot;>R</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>3</mn><mi>n</mi><mo>&amp;#x00D7;</mo><mi>k</mi></mrow></msup></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-156\" style=\"width: 5.523em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 4.586em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.201em, 1004.59em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-157\"><span class=\"msubsup\" id=\"MathJax-Span-158\"><span style=\"display: inline-block; position: relative; width: 1.096em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-159\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mi\" id=\"MathJax-Span-160\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">t<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-161\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">∈</span><span class=\"msubsup\" id=\"MathJax-Span-162\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 2.294em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.73em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"texatom\" id=\"MathJax-Span-163\"><span class=\"mrow\" id=\"MathJax-Span-164\"><span class=\"mi\" id=\"MathJax-Span-165\" style=\"font-family: STIXGeneral-Regular;\">ℝ</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.372em; left: 0.732em;\"><span class=\"texatom\" id=\"MathJax-Span-166\"><span class=\"mrow\" id=\"MathJax-Span-167\"><span class=\"mn\" id=\"MathJax-Span-168\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">3</span><span class=\"mi\" id=\"MathJax-Span-169\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">n</span><span class=\"mo\" id=\"MathJax-Span-170\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">×</span><span class=\"mi\" id=\"MathJax-Span-171\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.378em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>W</mi><mi>t</mi></msub><mo>∈</mo><msup><mrow class=\"MJX-TeXAtom-ORD\"><mi mathvariant=\"double-struck\">R</mi></mrow><mrow class=\"MJX-TeXAtom-ORD\"><mn>3</mn><mi>n</mi><mo>×</mo><mi>k</mi></mrow></msup></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-23\">W_t \\in \\mathbb{R}^{3n \\times k}</script>, and applies softmax to obtain class probabilities. This setup makes training <strong>close-ended</strong>, restricted to the predefined NLI labels, whereas inference is <strong>open-ended</strong>, since embeddings can later be compared beyond those classes using cosine similarity and thresholding.</li>\n          <li><strong>Regression Objective</strong>: Minimizes mean-squared error between cosine similarity of embeddings and human-annotated similarity scores.</li>\n          <li><strong>Triplet Objective</strong>: Minimizes the margin between anchor–positive and anchor–negative pairs, ensuring semantically close sentences are closer in embedding space. Although the original paper did not use it, this triplet loss can naturally extend to <strong>Multiple Negatives Ranking Loss (MNRL)</strong>, which treats every non-matching sentence in the same batch as a negative sample—improving data efficiency and convergence for large-scale contrastive learning.</li>\n        </ul>\n      </li>\n      <li><strong>Pooling and Representation</strong>: The final sentence embedding is typically the mean of all token embeddings from the last hidden layer, which captures overall sentence meaning better than using only the <code class=\"language-plaintext highlighter-rouge\">[CLS]</code> token.</li>\n      <li><strong>Efficiency Gains</strong>: SBERT reduces the number of required pairwise comparisons from <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-24-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-172\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.201em, 1002.29em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-173\"><span class=\"mi\" id=\"MathJax-Span-174\" style=\"font-family: STIXGeneral-Italic;\">O</span><span class=\"mo\" id=\"MathJax-Span-175\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"msubsup\" id=\"MathJax-Span-176\"><span style=\"display: inline-block; position: relative; width: 0.94em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-177\" style=\"font-family: STIXGeneral-Italic;\">n</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.372em; left: 0.523em;\"><span class=\"mn\" id=\"MathJax-Span-178\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-179\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.378em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>O</mi><mo stretchy=\"false\">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-24\">O(n^2)</script> to <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-25-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><mi>n</mi><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-180\" style=\"width: 2.294em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.878em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1001.83em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-181\"><span class=\"mi\" id=\"MathJax-Span-182\" style=\"font-family: STIXGeneral-Italic;\">O</span><span class=\"mo\" id=\"MathJax-Span-183\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-184\" style=\"font-family: STIXGeneral-Italic;\">n</span><span class=\"mo\" id=\"MathJax-Span-185\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-25\">O(n)</script>, since sentence embeddings can be precomputed and compared using cosine similarity. This makes it suitable for large-scale applications like semantic search or clustering.</li>\n      <li><strong>Evaluation and Performance</strong>: SBERT achieves state-of-the-art performance on multiple STS benchmarks, outperforming models like InferSent and Universal Sentence Encoder by significant margins (average correlation improvements of 5–12 points).</li>\n    </ol>\n  </li>\n  <li>\n    <p><strong>Practical Impact on Retrieval Systems</strong>: SBERT’s dual-encoder setup—where sentences are encoded independently and compared via cosine similarity—became the cornerstone of dense retrieval. Removing the softmax layer in inference is precisely what enables offline precomputation and real-time similarity search across massive corpora. This innovation allowed embedding-based retrieval systems, approximate nearest neighbor (ANN) search, and RAG pipelines to become scalable and efficient at industrial scale.</p>\n  </li>\n  <li>\n    <p>In summary, Sentence-BERT extends BERT with architecture and training modifications that produce semantically rich, scalable, and efficient sentence representations suitable for similarity and clustering tasks.</p>\n  </li>\n</ul>\n<p>Sentence Transformers are trained differently from token-level models such as BERT. Their process focuses on aligning sentence meanings rather than predicting masked words.</p>\n<ol>\n      <li><strong>Model Architecture</strong>: SBERT builds on pretrained BERT or RoBERTa models by adding a pooling layer that converts token-level outputs into a single sentence embedding.</li>\n      <li><strong>Training Data</strong>: SBERT is fine-tuned on Natural Language Inference (NLI) datasets like SNLI and MultiNLI, containing hundreds of thousands of labeled sentence pairs that capture semantic relations.</li>\n      <li><strong>Training Objectives</strong>:\n        <ul>\n          <li><strong>Classification Objective</strong>: Concatenates embeddings of two sentences <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-20-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>(</mo><mi>u</mi><mo>,</mo><mi>v</mi><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-138\" style=\"width: 2.607em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.138em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1002.09em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-139\"><span class=\"mo\" id=\"MathJax-Span-140\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-141\" style=\"font-family: STIXGeneral-Italic;\">u</span><span class=\"mo\" id=\"MathJax-Span-142\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mi\" id=\"MathJax-Span-143\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.211em;\">v</span><span class=\"mo\" id=\"MathJax-Span-144\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mo stretchy=\"false\">(</mo><mi>u</mi><mo>,</mo><mi>v</mi><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-20\">(u, v)</script> with their element-wise absolute difference <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-21-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>&amp;#x2223;</mo><mi>u</mi><mo>&amp;#x2212;</mo><mi>v</mi><mo stretchy=&quot;false&quot;>&amp;#x2223;</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-145\" style=\"width: 3.128em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.607em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1002.5em, 2.607em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-146\"><span class=\"mo\" id=\"MathJax-Span-147\" style=\"font-family: STIXGeneral-Regular;\">∣</span><span class=\"mi\" id=\"MathJax-Span-148\" style=\"font-family: STIXGeneral-Italic;\">u</span><span class=\"mo\" id=\"MathJax-Span-149\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">−</span><span class=\"mi\" id=\"MathJax-Span-150\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.263em;\">v</span><span class=\"mo\" id=\"MathJax-Span-151\" style=\"font-family: STIXGeneral-Regular;\">∣</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mo stretchy=\"false\">∣</mo><mi>u</mi><mo>−</mo><mi>v</mi><mo stretchy=\"false\">∣</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-21\">\\mid u - v \\mid</script>, projects the resulting <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-22-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>3</mn><mi>n</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-152\" style=\"width: 1.201em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.992em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.99em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-153\"><span class=\"mn\" id=\"MathJax-Span-154\" style=\"font-family: STIXGeneral-Regular;\">3</span><span class=\"mi\" id=\"MathJax-Span-155\" style=\"font-family: STIXGeneral-Italic;\">n</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mn>3</mn><mi>n</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-22\">3n</script>-dimensional vector through a linear layer <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-23-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>W</mi><mi>t</mi></msub><mo>&amp;#x2208;</mo><msup><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi mathvariant=&quot;double-struck&quot;>R</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>3</mn><mi>n</mi><mo>&amp;#x00D7;</mo><mi>k</mi></mrow></msup></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-156\" style=\"width: 5.523em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 4.586em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.201em, 1004.59em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-157\"><span class=\"msubsup\" id=\"MathJax-Span-158\"><span style=\"display: inline-block; position: relative; width: 1.096em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-159\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mi\" id=\"MathJax-Span-160\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">t<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-161\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">∈</span><span class=\"msubsup\" id=\"MathJax-Span-162\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 2.294em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.73em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"texatom\" id=\"MathJax-Span-163\"><span class=\"mrow\" id=\"MathJax-Span-164\"><span class=\"mi\" id=\"MathJax-Span-165\" style=\"font-family: STIXGeneral-Regular;\">ℝ</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.372em; left: 0.732em;\"><span class=\"texatom\" id=\"MathJax-Span-166\"><span class=\"mrow\" id=\"MathJax-Span-167\"><span class=\"mn\" id=\"MathJax-Span-168\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">3</span><span class=\"mi\" id=\"MathJax-Span-169\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">n</span><span class=\"mo\" id=\"MathJax-Span-170\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">×</span><span class=\"mi\" id=\"MathJax-Span-171\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.378em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>W</mi><mi>t</mi></msub><mo>∈</mo><msup><mrow class=\"MJX-TeXAtom-ORD\"><mi mathvariant=\"double-struck\">R</mi></mrow><mrow class=\"MJX-TeXAtom-ORD\"><mn>3</mn><mi>n</mi><mo>×</mo><mi>k</mi></mrow></msup></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-23\">W_t \\in \\mathbb{R}^{3n \\times k}</script>, and applies softmax to obtain class probabilities. This setup makes training <strong>close-ended</strong>, restricted to the predefined NLI labels, whereas inference is <strong>open-ended</strong>, since embeddings can later be compared beyond those classes using cosine similarity and thresholding.</li>\n          <li><strong>Regression Objective</strong>: Minimizes mean-squared error between cosine similarity of embeddings and human-annotated similarity scores.</li>\n          <li><strong>Triplet Objective</strong>: Minimizes the margin between anchor–positive and anchor–negative pairs, ensuring semantically close sentences are closer in embedding space. Although the original paper did not use it, this triplet loss can naturally extend to <strong>Multiple Negatives Ranking Loss (MNRL)</strong>, which treats every non-matching sentence in the same batch as a negative sample—improving data efficiency and convergence for large-scale contrastive learning.</li>\n        </ul>\n      </li>\n      <li><strong>Pooling and Representation</strong>: The final sentence embedding is typically the mean of all token embeddings from the last hidden layer, which captures overall sentence meaning better than using only the <code class=\"language-plaintext highlighter-rouge\">[CLS]</code> token.</li>\n      <li><strong>Efficiency Gains</strong>: SBERT reduces the number of required pairwise comparisons from <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-24-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-172\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.201em, 1002.29em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-173\"><span class=\"mi\" id=\"MathJax-Span-174\" style=\"font-family: STIXGeneral-Italic;\">O</span><span class=\"mo\" id=\"MathJax-Span-175\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"msubsup\" id=\"MathJax-Span-176\"><span style=\"display: inline-block; position: relative; width: 0.94em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-177\" style=\"font-family: STIXGeneral-Italic;\">n</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.372em; left: 0.523em;\"><span class=\"mn\" id=\"MathJax-Span-178\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-179\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.378em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>O</mi><mo stretchy=\"false\">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-24\">O(n^2)</script> to <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-25-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><mi>n</mi><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-180\" style=\"width: 2.294em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.878em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1001.83em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-181\"><span class=\"mi\" id=\"MathJax-Span-182\" style=\"font-family: STIXGeneral-Italic;\">O</span><span class=\"mo\" id=\"MathJax-Span-183\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-184\" style=\"font-family: STIXGeneral-Italic;\">n</span><span class=\"mo\" id=\"MathJax-Span-185\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-25\">O(n)</script>, since sentence embeddings can be precomputed and compared using cosine similarity. This makes it suitable for large-scale applications like semantic search or clustering.</li>\n      <li><strong>Evaluation and Performance</strong>: SBERT achieves state-of-the-art performance on multiple STS benchmarks, outperforming models like InferSent and Universal Sentence Encoder by significant margins (average correlation improvements of 5–12 points).</li>\n    </ol>\n<ul>\n          <li><strong>Classification Objective</strong>: Concatenates embeddings of two sentences <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-20-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>(</mo><mi>u</mi><mo>,</mo><mi>v</mi><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-138\" style=\"width: 2.607em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.138em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1002.09em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-139\"><span class=\"mo\" id=\"MathJax-Span-140\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-141\" style=\"font-family: STIXGeneral-Italic;\">u</span><span class=\"mo\" id=\"MathJax-Span-142\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mi\" id=\"MathJax-Span-143\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.211em;\">v</span><span class=\"mo\" id=\"MathJax-Span-144\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mo stretchy=\"false\">(</mo><mi>u</mi><mo>,</mo><mi>v</mi><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-20\">(u, v)</script> with their element-wise absolute difference <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-21-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>&amp;#x2223;</mo><mi>u</mi><mo>&amp;#x2212;</mo><mi>v</mi><mo stretchy=&quot;false&quot;>&amp;#x2223;</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-145\" style=\"width: 3.128em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.607em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1002.5em, 2.607em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-146\"><span class=\"mo\" id=\"MathJax-Span-147\" style=\"font-family: STIXGeneral-Regular;\">∣</span><span class=\"mi\" id=\"MathJax-Span-148\" style=\"font-family: STIXGeneral-Italic;\">u</span><span class=\"mo\" id=\"MathJax-Span-149\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">−</span><span class=\"mi\" id=\"MathJax-Span-150\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.263em;\">v</span><span class=\"mo\" id=\"MathJax-Span-151\" style=\"font-family: STIXGeneral-Regular;\">∣</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mo stretchy=\"false\">∣</mo><mi>u</mi><mo>−</mo><mi>v</mi><mo stretchy=\"false\">∣</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-21\">\\mid u - v \\mid</script>, projects the resulting <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-22-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>3</mn><mi>n</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-152\" style=\"width: 1.201em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.992em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.99em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-153\"><span class=\"mn\" id=\"MathJax-Span-154\" style=\"font-family: STIXGeneral-Regular;\">3</span><span class=\"mi\" id=\"MathJax-Span-155\" style=\"font-family: STIXGeneral-Italic;\">n</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mn>3</mn><mi>n</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-22\">3n</script>-dimensional vector through a linear layer <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-23-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>W</mi><mi>t</mi></msub><mo>&amp;#x2208;</mo><msup><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi mathvariant=&quot;double-struck&quot;>R</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>3</mn><mi>n</mi><mo>&amp;#x00D7;</mo><mi>k</mi></mrow></msup></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-156\" style=\"width: 5.523em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 4.586em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.201em, 1004.59em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-157\"><span class=\"msubsup\" id=\"MathJax-Span-158\"><span style=\"display: inline-block; position: relative; width: 1.096em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-159\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mi\" id=\"MathJax-Span-160\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">t<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-161\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">∈</span><span class=\"msubsup\" id=\"MathJax-Span-162\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 2.294em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.73em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"texatom\" id=\"MathJax-Span-163\"><span class=\"mrow\" id=\"MathJax-Span-164\"><span class=\"mi\" id=\"MathJax-Span-165\" style=\"font-family: STIXGeneral-Regular;\">ℝ</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.372em; left: 0.732em;\"><span class=\"texatom\" id=\"MathJax-Span-166\"><span class=\"mrow\" id=\"MathJax-Span-167\"><span class=\"mn\" id=\"MathJax-Span-168\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">3</span><span class=\"mi\" id=\"MathJax-Span-169\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">n</span><span class=\"mo\" id=\"MathJax-Span-170\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">×</span><span class=\"mi\" id=\"MathJax-Span-171\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.378em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>W</mi><mi>t</mi></msub><mo>∈</mo><msup><mrow class=\"MJX-TeXAtom-ORD\"><mi mathvariant=\"double-struck\">R</mi></mrow><mrow class=\"MJX-TeXAtom-ORD\"><mn>3</mn><mi>n</mi><mo>×</mo><mi>k</mi></mrow></msup></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-23\">W_t \\in \\mathbb{R}^{3n \\times k}</script>, and applies softmax to obtain class probabilities. This setup makes training <strong>close-ended</strong>, restricted to the predefined NLI labels, whereas inference is <strong>open-ended</strong>, since embeddings can later be compared beyond those classes using cosine similarity and thresholding.</li>\n          <li><strong>Regression Objective</strong>: Minimizes mean-squared error between cosine similarity of embeddings and human-annotated similarity scores.</li>\n          <li><strong>Triplet Objective</strong>: Minimizes the margin between anchor–positive and anchor–negative pairs, ensuring semantically close sentences are closer in embedding space. Although the original paper did not use it, this triplet loss can naturally extend to <strong>Multiple Negatives Ranking Loss (MNRL)</strong>, which treats every non-matching sentence in the same batch as a negative sample—improving data efficiency and convergence for large-scale contrastive learning.</li>\n        </ul>\n<p><strong>Practical Impact on Retrieval Systems</strong>: SBERT’s dual-encoder setup—where sentences are encoded independently and compared via cosine similarity—became the cornerstone of dense retrieval. Removing the softmax layer in inference is precisely what enables offline precomputation and real-time similarity search across massive corpora. This innovation allowed embedding-based retrieval systems, approximate nearest neighbor (ANN) search, and RAG pipelines to become scalable and efficient at industrial scale.</p>\n<p>In summary, Sentence-BERT extends BERT with architecture and training modifications that produce semantically rich, scalable, and efficient sentence representations suitable for similarity and clustering tasks.</p>\n<h5 id=\"applying-sentence-transformers-for-rag\">Applying Sentence Transformers for RAG</h5>\n<ul>\n  <li>Now, let’s look into why sentence transformers are the numero uno choice of models to generate embeddings for RAG.</li>\n  <li>RAG leverages Sentence Transformers for their ability to understand and compare the semantic content of sentences. This integration is particularly useful in scenarios where the model needs to retrieve relevant information before generating a response. Here’s how Sentence Transformers are useful in a RAG setting:\n    <ol>\n      <li><strong>Improved Document Retrieval</strong>: Sentence Transformers are trained to generate embeddings that capture the semantic meaning of sentences. In a RAG setting, these embeddings can be used to match a query (like a user’s question) with the most relevant documents or passages in a database. This is critical because the quality of the generated response often depends on the relevance of the retrieved information.</li>\n      <li><strong>Efficient Semantic Search</strong>: Traditional keyword-based search methods might struggle with understanding the context or the semantic nuances of a query. Sentence Transformers, by providing semantically meaningful embeddings, enable more nuanced searches that go beyond keyword matching. This means that the retrieval component of RAG can find documents that are semantically related to the query, even if they don’t contain the exact keywords.</li>\n      <li><strong>Contextual Understanding for Better Responses</strong>: By using Sentence Transformers, the RAG model can better understand the context and nuances of both the input query and the content of potential source documents. This leads to more accurate and contextually appropriate responses, as the generation component of the model has more relevant and well-understood information to work with.</li>\n      <li><strong>Scalability in Information Retrieval</strong>: Sentence Transformers can efficiently handle large databases of documents by pre-computing embeddings for all documents. This makes the retrieval process faster and more scalable, as the model only needs to compute the embedding for the query at runtime and then quickly find the closest document embeddings.</li>\n      <li><strong>Enhancing the Generation Process</strong>: In a RAG setup, the generation component benefits from the retrieval component’s ability to provide relevant, semantically-rich information. This allows the language model to generate responses that are not only contextually accurate but also informed by a broader range of information than what the model itself was trained on.</li>\n    </ol>\n  </li>\n  <li>In summary, Sentence Transformers enhance the retrieval capabilities of RAG models with LLMs by enabling more effective semantic search and retrieval of information. This leads to improved performance in tasks that require understanding and generating responses based on large volumes of text data, such as question answering, chatbots, and information extraction.</li>\n</ul>\n<ol>\n      <li><strong>Improved Document Retrieval</strong>: Sentence Transformers are trained to generate embeddings that capture the semantic meaning of sentences. In a RAG setting, these embeddings can be used to match a query (like a user’s question) with the most relevant documents or passages in a database. This is critical because the quality of the generated response often depends on the relevance of the retrieved information.</li>\n      <li><strong>Efficient Semantic Search</strong>: Traditional keyword-based search methods might struggle with understanding the context or the semantic nuances of a query. Sentence Transformers, by providing semantically meaningful embeddings, enable more nuanced searches that go beyond keyword matching. This means that the retrieval component of RAG can find documents that are semantically related to the query, even if they don’t contain the exact keywords.</li>\n      <li><strong>Contextual Understanding for Better Responses</strong>: By using Sentence Transformers, the RAG model can better understand the context and nuances of both the input query and the content of potential source documents. This leads to more accurate and contextually appropriate responses, as the generation component of the model has more relevant and well-understood information to work with.</li>\n      <li><strong>Scalability in Information Retrieval</strong>: Sentence Transformers can efficiently handle large databases of documents by pre-computing embeddings for all documents. This makes the retrieval process faster and more scalable, as the model only needs to compute the embedding for the query at runtime and then quickly find the closest document embeddings.</li>\n      <li><strong>Enhancing the Generation Process</strong>: In a RAG setup, the generation component benefits from the retrieval component’s ability to provide relevant, semantically-rich information. This allows the language model to generate responses that are not only contextually accurate but also informed by a broader range of information than what the model itself was trained on.</li>\n    </ol>",
    "contentMarkdown": "#### Chunking\n\n*   Chunking is the process of dividing the prompts and/or the documents to be retrieved, into smaller, manageable segments or chunks. These chunks can be defined either by a fixed size, such as a specific number of characters, sentences, or paragraphs. The choice of chunking strategy plays a critical role in determining both the performance and efficiency of your RAG system.\n*   Each chunk is encoded into an embedding vector for retrieval. Smaller, more precise chunks lead to a finer match between the user’s query and the content, enhancing the accuracy and relevance of the information retrieved.\n*   Larger chunks might include irrelevant information, introducing noise and potentially reducing the retrieval accuracy. By controlling the chunk size, RAG can maintain a balance between comprehensiveness and precision.\n*   So the next natural question that comes up is, how do you choose the right chunk size for your use case? The choice of chunk size in RAG is crucial. It needs to be small enough to ensure relevance and reduce noise but large enough to maintain the context’s integrity. Let’s look at a few methods below referred from [Pinecone](https://www.pinecone.io/learn/chunking-strategies/):\n    *   **Fixed-size Chunking:** Simply decide the number of tokens in our chunk along with whether there should be overlap between them or not. Overlap between chunks guarantees there to be minimal semantic context loss between chunks. This option is computationally cheap and simple to implement.\n        \n        ![](https://aman.ai/images/copy.png)\n        \n        `text = \"...\" # your text from langchain.text_splitter import CharacterTextSplitter text_splitter = CharacterTextSplitter(     separator = \"\\n\\n\",     chunk_size = 256,     chunk_overlap  = 20 ) docs = text_splitter.create_documents([text])`\n        \n    *   **Context-aware Chunking:** Content-aware chunking leverages the intrinsic structure of the text to create chunks that are more meaningful and contextually relevant. Here are several approaches to achieving this:\n        1.  **Sentence Splitting**: This method aligns with models optimized for embedding sentence-level content. Different tools and techniques can be used for sentence splitting:\n            *   **Naive Splitting:** A basic method where sentences are split using periods and new lines. Example:\n                \n                ![](https://aman.ai/images/copy.png)\n                \n                   `text = \"...\"  # Your text    docs = text.split(\".\")`\n                \n                *   This method is quick but may overlook complex sentence structures.\n            *   **NLTK (Natural Language Toolkit):** A comprehensive Python library for language processing. NLTK includes a sentence tokenizer that effectively splits text into sentences. Example:\n                \n                ![](https://aman.ai/images/copy.png)\n                \n                `text = \"...\"  # Your text from langchain.text_splitter import NLTKTextSplitter text_splitter = NLTKTextSplitter() docs = text_splitter.split_text(text)`\n                \n            *   **spaCy:** An advanced Python library for NLP tasks, spaCy offers efficient sentence segmentation. Example:\n                \n                ![](https://aman.ai/images/copy.png)\n                \n                `text = \"...\"  # Your text from langchain.text_splitter import SpacyTextSplitter text_splitter = SpacyTextSplitter() docs = text_splitter.split_text(text)`\n                \n        2.  **Recursive Chunking:** Recursive chunking is an iterative method that splits text hierarchically using various separators. It adapts to create chunks of similar size or structure by recursively applying different criteria. Example using LangChain:\n            \n            ![](https://aman.ai/images/copy.png)\n            \n               `text = \"...\"  # Your text    from langchain.text_splitter import RecursiveCharacterTextSplitter    text_splitter = RecursiveCharacterTextSplitter(        chunk_size = 256,        chunk_overlap = 20    )    docs = text_splitter.create_documents([text])`\n            \n        3.  **Structure-based Chunking:** For formatted content like Markdown, HTML, or LaTeX, specialized chunking can be applied to maintain the original structure:\n            *   **Markdown Chunking:** Recognizes markdown syntax and divides content based on structure. Example:\n                \n                ![](https://aman.ai/images/copy.png)\n                \n                `from langchain.text_splitter import MarkdownTextSplitter markdown_text = \"...\" markdown_splitter = MarkdownTextSplitter(chunk_size=100, chunk_overlap=0) docs = markdown_splitter.create_documents([markdown_text])`\n                \n            *   **HTML Chunking:** Leverages HTML tags (such as headings, sections, and semantic elements) to segment content while preserving document hierarchy and structural meaning.\n            *   **LaTeX Chunking:** Parses LaTeX commands and environments to chunk content while preserving its logical organization.\n        4.  **Semantic Chunking:** Segment text based on semantic similarity. This means that sentences with the strongest semantic connections are grouped together, while sentences that move to another topic or theme are separated into distinct chunks. For an implementation of semantic chunking, please refer to [this](https://github.com/FullStackRetrieval-com/RetrievalTutorials/blob/main/tutorials/LevelsOfTextSplitting/5_Levels_Of_Text_Splitting.ipynb) notebook.\n            *   Semantic chunking can be summarized in four steps:\n                1.  Split the text into sentences, paragraphs, or other rule-based units.\n                2.  Vectorize a window of sentences or other units.\n                3.  Calculate the cosine distance between the embedded windows.\n                4.  Merge sentences or units until the cosine similarity value reaches a specific threshold.\n            *   The following figure ([source](https://www.linkedin.com/in/edwardschmuhl)) visually summarizes the overall process: ![](/primers/ai/assets/RAG/semc.jpg)\n*   As a rule of thumb, if the chunk of text makes sense without the surrounding context to a human, it will make sense to the language model as well. Therefore, finding the optimal chunk size for the documents in the corpus is crucial to ensuring that the search results are accurate and relevant.\n\n*   **Fixed-size Chunking:** Simply decide the number of tokens in our chunk along with whether there should be overlap between them or not. Overlap between chunks guarantees there to be minimal semantic context loss between chunks. This option is computationally cheap and simple to implement.\n    \n    ![](https://aman.ai/images/copy.png)\n    \n    `text = \"...\" # your text from langchain.text_splitter import CharacterTextSplitter text_splitter = CharacterTextSplitter(     separator = \"\\n\\n\",     chunk_size = 256,     chunk_overlap  = 20 ) docs = text_splitter.create_documents([text])`\n    \n*   **Context-aware Chunking:** Content-aware chunking leverages the intrinsic structure of the text to create chunks that are more meaningful and contextually relevant. Here are several approaches to achieving this:\n    1.  **Sentence Splitting**: This method aligns with models optimized for embedding sentence-level content. Different tools and techniques can be used for sentence splitting:\n        *   **Naive Splitting:** A basic method where sentences are split using periods and new lines. Example:\n            \n            ![](https://aman.ai/images/copy.png)\n            \n               `text = \"...\"  # Your text    docs = text.split(\".\")`\n            \n            *   This method is quick but may overlook complex sentence structures.\n        *   **NLTK (Natural Language Toolkit):** A comprehensive Python library for language processing. NLTK includes a sentence tokenizer that effectively splits text into sentences. Example:\n            \n            ![](https://aman.ai/images/copy.png)\n            \n            `text = \"...\"  # Your text from langchain.text_splitter import NLTKTextSplitter text_splitter = NLTKTextSplitter() docs = text_splitter.split_text(text)`\n            \n        *   **spaCy:** An advanced Python library for NLP tasks, spaCy offers efficient sentence segmentation. Example:\n            \n            ![](https://aman.ai/images/copy.png)\n            \n            `text = \"...\"  # Your text from langchain.text_splitter import SpacyTextSplitter text_splitter = SpacyTextSplitter() docs = text_splitter.split_text(text)`\n            \n    2.  **Recursive Chunking:** Recursive chunking is an iterative method that splits text hierarchically using various separators. It adapts to create chunks of similar size or structure by recursively applying different criteria. Example using LangChain:\n        \n        ![](https://aman.ai/images/copy.png)\n        \n           `text = \"...\"  # Your text    from langchain.text_splitter import RecursiveCharacterTextSplitter    text_splitter = RecursiveCharacterTextSplitter(        chunk_size = 256,        chunk_overlap = 20    )    docs = text_splitter.create_documents([text])`\n        \n    3.  **Structure-based Chunking:** For formatted content like Markdown, HTML, or LaTeX, specialized chunking can be applied to maintain the original structure:\n        *   **Markdown Chunking:** Recognizes markdown syntax and divides content based on structure. Example:\n            \n            ![](https://aman.ai/images/copy.png)\n            \n            `from langchain.text_splitter import MarkdownTextSplitter markdown_text = \"...\" markdown_splitter = MarkdownTextSplitter(chunk_size=100, chunk_overlap=0) docs = markdown_splitter.create_documents([markdown_text])`\n            \n        *   **HTML Chunking:** Leverages HTML tags (such as headings, sections, and semantic elements) to segment content while preserving document hierarchy and structural meaning.\n        *   **LaTeX Chunking:** Parses LaTeX commands and environments to chunk content while preserving its logical organization.\n    4.  **Semantic Chunking:** Segment text based on semantic similarity. This means that sentences with the strongest semantic connections are grouped together, while sentences that move to another topic or theme are separated into distinct chunks. For an implementation of semantic chunking, please refer to [this](https://github.com/FullStackRetrieval-com/RetrievalTutorials/blob/main/tutorials/LevelsOfTextSplitting/5_Levels_Of_Text_Splitting.ipynb) notebook.\n        *   Semantic chunking can be summarized in four steps:\n            1.  Split the text into sentences, paragraphs, or other rule-based units.\n            2.  Vectorize a window of sentences or other units.\n            3.  Calculate the cosine distance between the embedded windows.\n            4.  Merge sentences or units until the cosine similarity value reaches a specific threshold.\n        *   The following figure ([source](https://www.linkedin.com/in/edwardschmuhl)) visually summarizes the overall process: ![](/primers/ai/assets/RAG/semc.jpg)\n\n![](https://aman.ai/images/copy.png)\n\n`text = \"...\" # your text from langchain.text_splitter import CharacterTextSplitter text_splitter = CharacterTextSplitter(     separator = \"\\n\\n\",     chunk_size = 256,     chunk_overlap  = 20 ) docs = text_splitter.create_documents([text])`\n\n1.  **Sentence Splitting**: This method aligns with models optimized for embedding sentence-level content. Different tools and techniques can be used for sentence splitting:\n    *   **Naive Splitting:** A basic method where sentences are split using periods and new lines. Example:\n        \n        ![](https://aman.ai/images/copy.png)\n        \n           `text = \"...\"  # Your text    docs = text.split(\".\")`\n        \n        *   This method is quick but may overlook complex sentence structures.\n    *   **NLTK (Natural Language Toolkit):** A comprehensive Python library for language processing. NLTK includes a sentence tokenizer that effectively splits text into sentences. Example:\n        \n        ![](https://aman.ai/images/copy.png)\n        \n        `text = \"...\"  # Your text from langchain.text_splitter import NLTKTextSplitter text_splitter = NLTKTextSplitter() docs = text_splitter.split_text(text)`\n        \n    *   **spaCy:** An advanced Python library for NLP tasks, spaCy offers efficient sentence segmentation. Example:\n        \n        ![](https://aman.ai/images/copy.png)\n        \n        `text = \"...\"  # Your text from langchain.text_splitter import SpacyTextSplitter text_splitter = SpacyTextSplitter() docs = text_splitter.split_text(text)`\n        \n2.  **Recursive Chunking:** Recursive chunking is an iterative method that splits text hierarchically using various separators. It adapts to create chunks of similar size or structure by recursively applying different criteria. Example using LangChain:\n    \n    ![](https://aman.ai/images/copy.png)\n    \n       `text = \"...\"  # Your text    from langchain.text_splitter import RecursiveCharacterTextSplitter    text_splitter = RecursiveCharacterTextSplitter(        chunk_size = 256,        chunk_overlap = 20    )    docs = text_splitter.create_documents([text])`\n    \n3.  **Structure-based Chunking:** For formatted content like Markdown, HTML, or LaTeX, specialized chunking can be applied to maintain the original structure:\n    *   **Markdown Chunking:** Recognizes markdown syntax and divides content based on structure. Example:\n        \n        ![](https://aman.ai/images/copy.png)\n        \n        `from langchain.text_splitter import MarkdownTextSplitter markdown_text = \"...\" markdown_splitter = MarkdownTextSplitter(chunk_size=100, chunk_overlap=0) docs = markdown_splitter.create_documents([markdown_text])`\n        \n    *   **HTML Chunking:** Leverages HTML tags (such as headings, sections, and semantic elements) to segment content while preserving document hierarchy and structural meaning.\n    *   **LaTeX Chunking:** Parses LaTeX commands and environments to chunk content while preserving its logical organization.\n4.  **Semantic Chunking:** Segment text based on semantic similarity. This means that sentences with the strongest semantic connections are grouped together, while sentences that move to another topic or theme are separated into distinct chunks. For an implementation of semantic chunking, please refer to [this](https://github.com/FullStackRetrieval-com/RetrievalTutorials/blob/main/tutorials/LevelsOfTextSplitting/5_Levels_Of_Text_Splitting.ipynb) notebook.\n    *   Semantic chunking can be summarized in four steps:\n        1.  Split the text into sentences, paragraphs, or other rule-based units.\n        2.  Vectorize a window of sentences or other units.\n        3.  Calculate the cosine distance between the embedded windows.\n        4.  Merge sentences or units until the cosine similarity value reaches a specific threshold.\n    *   The following figure ([source](https://www.linkedin.com/in/edwardschmuhl)) visually summarizes the overall process: ![](/primers/ai/assets/RAG/semc.jpg)\n\n*   **Naive Splitting:** A basic method where sentences are split using periods and new lines. Example:\n    \n    ![](https://aman.ai/images/copy.png)\n    \n       `text = \"...\"  # Your text    docs = text.split(\".\")`\n    \n    *   This method is quick but may overlook complex sentence structures.\n*   **NLTK (Natural Language Toolkit):** A comprehensive Python library for language processing. NLTK includes a sentence tokenizer that effectively splits text into sentences. Example:\n    \n    ![](https://aman.ai/images/copy.png)\n    \n    `text = \"...\"  # Your text from langchain.text_splitter import NLTKTextSplitter text_splitter = NLTKTextSplitter() docs = text_splitter.split_text(text)`\n    \n*   **spaCy:** An advanced Python library for NLP tasks, spaCy offers efficient sentence segmentation. Example:\n    \n    ![](https://aman.ai/images/copy.png)\n    \n    `text = \"...\"  # Your text from langchain.text_splitter import SpacyTextSplitter text_splitter = SpacyTextSplitter() docs = text_splitter.split_text(text)`\n    \n\n![](https://aman.ai/images/copy.png)\n\n   `text = \"...\"  # Your text    docs = text.split(\".\")`\n\n*   This method is quick but may overlook complex sentence structures.\n\n![](https://aman.ai/images/copy.png)\n\n`text = \"...\"  # Your text from langchain.text_splitter import NLTKTextSplitter text_splitter = NLTKTextSplitter() docs = text_splitter.split_text(text)`\n\n![](https://aman.ai/images/copy.png)\n\n`text = \"...\"  # Your text from langchain.text_splitter import SpacyTextSplitter text_splitter = SpacyTextSplitter() docs = text_splitter.split_text(text)`\n\n![](https://aman.ai/images/copy.png)\n\n   `text = \"...\"  # Your text    from langchain.text_splitter import RecursiveCharacterTextSplitter    text_splitter = RecursiveCharacterTextSplitter(        chunk_size = 256,        chunk_overlap = 20    )    docs = text_splitter.create_documents([text])`\n\n*   **Markdown Chunking:** Recognizes markdown syntax and divides content based on structure. Example:\n    \n    ![](https://aman.ai/images/copy.png)\n    \n    `from langchain.text_splitter import MarkdownTextSplitter markdown_text = \"...\" markdown_splitter = MarkdownTextSplitter(chunk_size=100, chunk_overlap=0) docs = markdown_splitter.create_documents([markdown_text])`\n    \n*   **HTML Chunking:** Leverages HTML tags (such as headings, sections, and semantic elements) to segment content while preserving document hierarchy and structural meaning.\n*   **LaTeX Chunking:** Parses LaTeX commands and environments to chunk content while preserving its logical organization.\n\n![](https://aman.ai/images/copy.png)\n\n`from langchain.text_splitter import MarkdownTextSplitter markdown_text = \"...\" markdown_splitter = MarkdownTextSplitter(chunk_size=100, chunk_overlap=0) docs = markdown_splitter.create_documents([markdown_text])`\n\n*   Semantic chunking can be summarized in four steps:\n    1.  Split the text into sentences, paragraphs, or other rule-based units.\n    2.  Vectorize a window of sentences or other units.\n    3.  Calculate the cosine distance between the embedded windows.\n    4.  Merge sentences or units until the cosine similarity value reaches a specific threshold.\n*   The following figure ([source](https://www.linkedin.com/in/edwardschmuhl)) visually summarizes the overall process: ![](/primers/ai/assets/RAG/semc.jpg)\n\n1.  Split the text into sentences, paragraphs, or other rule-based units.\n2.  Vectorize a window of sentences or other units.\n3.  Calculate the cosine distance between the embedded windows.\n4.  Merge sentences or units until the cosine similarity value reaches a specific threshold.\n\n##### Figuring Out the Ideal Chunk Size\n\n*   Choosing the right chunk size is foundational to building an effective RAG system. It directly influences retrieval quality, model efficiency, and how well the system captures relevant context for downstream tasks. Poor chunking can lead to fragmented information or excessive context loss, undermining overall performance.\n*   Building a RAG system involves determining the ideal chunk sizes for the documents that the retriever component will process. The ideal chunk size depends on several factors:\n    \n    1.  **Data Characteristics**: The nature of your data is crucial. For text documents, consider the average length of paragraphs or sections. If the documents are well-structured with distinct sections, these natural divisions might serve as a good basis for chunking.\n        \n    2.  **Retriever Constraints**: The retriever model you choose (like BM25, TF-IDF, or a neural retriever like DPR) might have limitations on the input length. It’s essential to ensure that the chunks are compatible with these constraints.\n        \n    3.  **Memory and Computational Resources**: Larger chunk sizes can lead to higher memory usage and computational overhead. Balance the chunk size with the available resources to ensure efficient processing.\n        \n    4.  **Task Requirements**: The nature of the task (e.g., question answering, document summarization) can influence the ideal chunk size. For detailed tasks, smaller chunks might be more effective to capture specific details, while broader tasks might benefit from larger chunks to capture more context.\n        \n    5.  **Experimentation**: Often, the best way to determine the ideal chunk size is through empirical testing. Run experiments with different chunk sizes and evaluate the performance on a validation set to find the optimal balance between granularity and context.\n        \n    6.  **Overlap Consideration**: Sometimes, it’s beneficial to have overlap between chunks to ensure that no important information is missed at the boundaries. Decide on an appropriate overlap size based on the task and data characteristics.\n        \n*   To summarize, determining the ideal chunk size for a RAG system is a balancing act that involves considering the characteristics of your data, the limitations of your retriever model, the resources at your disposal, the specific requirements of your task, and empirical experimentation. It’s a process that may require iteration and fine-tuning to achieve the best results.\n\nBuilding a RAG system involves determining the ideal chunk sizes for the documents that the retriever component will process. The ideal chunk size depends on several factors:\n\n1.  **Data Characteristics**: The nature of your data is crucial. For text documents, consider the average length of paragraphs or sections. If the documents are well-structured with distinct sections, these natural divisions might serve as a good basis for chunking.\n    \n2.  **Retriever Constraints**: The retriever model you choose (like BM25, TF-IDF, or a neural retriever like DPR) might have limitations on the input length. It’s essential to ensure that the chunks are compatible with these constraints.\n    \n3.  **Memory and Computational Resources**: Larger chunk sizes can lead to higher memory usage and computational overhead. Balance the chunk size with the available resources to ensure efficient processing.\n    \n4.  **Task Requirements**: The nature of the task (e.g., question answering, document summarization) can influence the ideal chunk size. For detailed tasks, smaller chunks might be more effective to capture specific details, while broader tasks might benefit from larger chunks to capture more context.\n    \n5.  **Experimentation**: Often, the best way to determine the ideal chunk size is through empirical testing. Run experiments with different chunk sizes and evaluate the performance on a validation set to find the optimal balance between granularity and context.\n    \n6.  **Overlap Consideration**: Sometimes, it’s beneficial to have overlap between chunks to ensure that no important information is missed at the boundaries. Decide on an appropriate overlap size based on the task and data characteristics.\n    \n\n**Data Characteristics**: The nature of your data is crucial. For text documents, consider the average length of paragraphs or sections. If the documents are well-structured with distinct sections, these natural divisions might serve as a good basis for chunking.\n\n**Retriever Constraints**: The retriever model you choose (like BM25, TF-IDF, or a neural retriever like DPR) might have limitations on the input length. It’s essential to ensure that the chunks are compatible with these constraints.\n\n**Memory and Computational Resources**: Larger chunk sizes can lead to higher memory usage and computational overhead. Balance the chunk size with the available resources to ensure efficient processing.\n\n**Task Requirements**: The nature of the task (e.g., question answering, document summarization) can influence the ideal chunk size. For detailed tasks, smaller chunks might be more effective to capture specific details, while broader tasks might benefit from larger chunks to capture more context.\n\n**Experimentation**: Often, the best way to determine the ideal chunk size is through empirical testing. Run experiments with different chunk sizes and evaluate the performance on a validation set to find the optimal balance between granularity and context.\n\n**Overlap Consideration**: Sometimes, it’s beneficial to have overlap between chunks to ensure that no important information is missed at the boundaries. Decide on an appropriate overlap size based on the task and data characteristics.\n\n###### Retriever Ensembling and Re-ranking\n\n*   In some scenarios, it may be beneficial to simultaneously utilize multiple chunk sizes and apply a re-ranking mechanism to refine the retrieved results. A detailed discourse on re-ranking is available in the [Re-ranking](#re-ranking) section.\n*   This approach serves two primary purposes:\n    *   It potentially improves the quality of retrieved content—albeit at increased computational cost—by aggregating outputs from multiple chunking strategies, provided the re-ranker performs with a reasonable degree of accuracy.\n    *   It enables systematic comparison of different retrieval methods relative to the re-ranker’s effectiveness.\n*   The methodology proceeds as follows:\n    \n    *   Segment the same source document using various chunk sizes, for example: 128, 256, 512, and 1024 tokens.\n    *   During the retrieval phase, extract relevant segments from each retrieval method, thereby forming an ensemble of retrievers.\n    *   Apply a re-ranking model to prioritize and filter the aggregated results.\n*   The following diagram [(source)](https://www.linkedin.com/posts/llamaindex_a-big-pain-point-when-trying-to-build-rag-activity-7113307664616484864-RT6n/) illustrates the process.\n\n*   It potentially improves the quality of retrieved content—albeit at increased computational cost—by aggregating outputs from multiple chunking strategies, provided the re-ranker performs with a reasonable degree of accuracy.\n*   It enables systematic comparison of different retrieval methods relative to the re-ranker’s effectiveness.\n\nThe methodology proceeds as follows:\n\n*   Segment the same source document using various chunk sizes, for example: 128, 256, 512, and 1024 tokens.\n*   During the retrieval phase, extract relevant segments from each retrieval method, thereby forming an ensemble of retrievers.\n*   Apply a re-ranking model to prioritize and filter the aggregated results.\n\n![](/primers/ai/assets/RAG/RetrieverEnsembling.jpg)\n\n*   According to [evaluation data provided by LlamaIndex](https://docs.llamaindex.ai/en/latest/examples/retrievers/ensemble_retrieval.html), the ensemble retrieval strategy leads to a modest improvement in faithfulness metrics, suggesting slightly enhanced relevance of retrieved content. However, pairwise comparisons show equal preference between the ensembled and baseline approaches, thereby leaving the superiority of ensembling open to debate.\n*   It is important to note that this ensembling methodology is not limited to variations in chunk size. It can also be extended to other dimensions of a RAG pipeline, including vector-based, keyword-based, and hybrid search strategies.\n\n#### Embeddings\n\n*   Once you have your prompt chunked appropriately, the next step is to embed it. Embedding prompts and documents in RAG involves transforming both the user’s query (prompt) and the documents in the knowledge base into a format that can be effectively compared for relevance. This process is critical for RAG’s ability to retrieve the most relevant information from its knowledge base in response to a user query. Here’s how it typically works:\n*   One option to help pick which embedding model would be best suited for your task is to look at [HuggingFace’s Massive Text Embedding Benchmark (MTEB) leaderboard](https://huggingface.co/spaces/mteb/leaderboard). There is a question of whether a dense or sparse embedding can be used so let’s look into benefits of each below:\n*   **Sparse embedding:** Sparse embeddings such as TF-IDF are great for lexical matching the prompt with the documents. Best for applications where keyword relevance is crucial. It’s computationally less intensive but may not capture the deeper semantic meanings in the text.\n*   **Semantic embedding:** Semantic embeddings, such as BERT or SentenceBERT lend themselves naturally to the RAG use-case.\n    *   **BERT:** Suitable for capturing contextual nuances in both the documents and queries. Requires more computational resources compared to sparse embeddings but offers more semantically rich embeddings.\n    *   **SentenceBERT:** Ideal for scenarios where the context and meaning at the sentence level are important. It strikes a balance between the deep contextual understanding of BERT and the need for concise, meaningful sentence representations. This is usually the preferred route for RAG.\n\n*   **BERT:** Suitable for capturing contextual nuances in both the documents and queries. Requires more computational resources compared to sparse embeddings but offers more semantically rich embeddings.\n*   **SentenceBERT:** Ideal for scenarios where the context and meaning at the sentence level are important. It strikes a balance between the deep contextual understanding of BERT and the need for concise, meaningful sentence representations. This is usually the preferred route for RAG.\n\n#### Naive Chunking vs. Late Chunking vs. Late Interaction ([ColBERT](https://arxiv.org/abs/2004.12832) and [ColPali](https://arxiv.org/abs/2407.01449))\n\n*   The choice between naive chunking, late chunking, and late interaction ([ColBERT](https://arxiv.org/abs/2004.12832) and [ColPali](https://arxiv.org/abs/2407.01449)) depends on the specific requirements of the retrieval task:\n    \n    *   **Naive Chunking** is suitable for scenarios with strict resource constraints but where retrieval precision is less critical.\n    *   **Late Chunking**, introduced by [JinaAI](https://jina.ai), offers an attractive middle ground, maintaining context and providing improved retrieval accuracy without incurring significant additional costs. Put simply, late chunking balances the trade-offs between cost and precision, making it an excellent option for building scalable and effective RAG systems, particularly in long-context retrieval scenarios.\n    *   **Late Interaction ([ColBERT](https://arxiv.org/abs/2004.12832) and [ColPali](https://arxiv.org/abs/2407.01449))** is best suited for applications where retrieval precision is paramount and resource costs are less of a concern.\n*   Let’s explore the differences between three primary strategies: Naive Chunking, Late Chunking, and Late Interaction ([ColBERT](https://arxiv.org/abs/2004.12832) and [ColPali](https://arxiv.org/abs/2407.01449)), focusing on their methodologies, advantages, and trade-offs.\n    \n\nThe choice between naive chunking, late chunking, and late interaction ([ColBERT](https://arxiv.org/abs/2004.12832) and [ColPali](https://arxiv.org/abs/2407.01449)) depends on the specific requirements of the retrieval task:\n\n*   **Naive Chunking** is suitable for scenarios with strict resource constraints but where retrieval precision is less critical.\n*   **Late Chunking**, introduced by [JinaAI](https://jina.ai), offers an attractive middle ground, maintaining context and providing improved retrieval accuracy without incurring significant additional costs. Put simply, late chunking balances the trade-offs between cost and precision, making it an excellent option for building scalable and effective RAG systems, particularly in long-context retrieval scenarios.\n*   **Late Interaction ([ColBERT](https://arxiv.org/abs/2004.12832) and [ColPali](https://arxiv.org/abs/2407.01449))** is best suited for applications where retrieval precision is paramount and resource costs are less of a concern.\n\nLet’s explore the differences between three primary strategies: Naive Chunking, Late Chunking, and Late Interaction ([ColBERT](https://arxiv.org/abs/2004.12832) and [ColPali](https://arxiv.org/abs/2407.01449)), focusing on their methodologies, advantages, and trade-offs.\n\n##### Overview\n\n*   Long-context retrieval presents a challenge when balancing precision, context retention, and cost efficiency. Solutions range from simple and low-cost, like Naive Chunking, to more sophisticated and resource-intensive approaches, such as Late Interaction ([ColBERT](https://arxiv.org/abs/2004.12832) and [ColPali](https://arxiv.org/abs/2407.01449)). [Late Chunking](https://jina.ai/news/late-chunking-in-long-context-embedding-models/), a novel approach by [JinaAI](https://jina.ai), offers a middle ground, preserving context with efficiency comparable to Naive Chunking.\n\n![](/primers/ai/assets/RAG/chunking-strategies.png)\n\n##### Naive/Vanilla Chunking\n\n###### What is Naive/Vanilla Chunking?\n\n*   As discussed in the [Chunking](#chunking) section, naive/vanilla chunking divides a document into fixed-size chunks based on metrics like sentence boundaries or token count (e.g., 512 tokens per chunk).\n*   Each chunk is independently embedded into a vector without considering the context of neighboring chunks.\n\n###### Example\n\n*   Consider the following paragraph: _Alice went for a walk in the woods one day and on her walk, she spotted something. She saw a rabbit hole at the base of a large tree. She fell into the hole and found herself in a strange new world._\n    \n*   If chunked by sentences:\n    \n    *   **Chunk 1**: “Alice went for a walk in the woods one day and on her walk, she spotted something.”\n    *   **Chunk 2**: “She saw a rabbit hole at the base of a large tree.”\n    *   **Chunk 3**: “She fell into the hole and found herself in a strange new world.”\n\nConsider the following paragraph: _Alice went for a walk in the woods one day and on her walk, she spotted something. She saw a rabbit hole at the base of a large tree. She fell into the hole and found herself in a strange new world._\n\nIf chunked by sentences:\n\n*   **Chunk 1**: “Alice went for a walk in the woods one day and on her walk, she spotted something.”\n*   **Chunk 2**: “She saw a rabbit hole at the base of a large tree.”\n*   **Chunk 3**: “She fell into the hole and found herself in a strange new world.”\n\n###### Advantages and Limitations\n\n*   **Advantages**:\n    *   Efficient in terms of storage and computation.\n    *   Simple to implement and integrate with most retrieval pipelines.\n*   **Limitations**:\n    *   **Context Loss**: Each chunk is processed independently, leading to a loss of contextual relationships. For example, the connection between “she” and “Alice” would be lost, reducing retrieval accuracy for context-heavy queries like “Where did Alice fall?”.\n    *   **Fragmented Meaning**: Splitting paragraphs or semantically related sections can dilute the meaning of each chunk, reducing retrieval precision.\n\n*   Efficient in terms of storage and computation.\n*   Simple to implement and integrate with most retrieval pipelines.\n\n*   **Context Loss**: Each chunk is processed independently, leading to a loss of contextual relationships. For example, the connection between “she” and “Alice” would be lost, reducing retrieval accuracy for context-heavy queries like “Where did Alice fall?”.\n*   **Fragmented Meaning**: Splitting paragraphs or semantically related sections can dilute the meaning of each chunk, reducing retrieval precision.\n\n##### Late Chunking\n\n###### What is Late Chunking?\n\n*   Late Chunking flips the order of vectorizing (i.e., embedding generation) and chunking compared to naive/vanilla chunking. In other words, it delays the chunking process until after the entire document has been embedded into token-level representations. This allows chunks to retain context from the full document, leading to richer, more contextually aware embeddings.\n\n###### How Late Chunking Works\n\n1.  **Embedding First**: The entire document is embedded into token-level representations using a long context model.\n2.  **Chunking After**: After embedding, the token-level representations are pooled into chunks based on a predefined chunking strategy (e.g., 512-token chunks).\n3.  **Context Retention**: Each chunk retains contextual information from the full document, allowing for improved retrieval precision without increasing storage costs.\n\n###### Example\n\n*   Using the same paragraph:\n    *   The entire paragraph is first embedded as a whole, preserving the relationships between all sentences.\n    *   The document is then split into chunks after embedding, ensuring that chunks like “She fell into the hole…” are contextually aware of the mention of “Alice” from earlier sentences.\n\n*   The entire paragraph is first embedded as a whole, preserving the relationships between all sentences.\n*   The document is then split into chunks after embedding, ensuring that chunks like “She fell into the hole…” are contextually aware of the mention of “Alice” from earlier sentences.\n\n###### Advantages and Trade-offs\n\n*   **Advantages**:\n    *   **Context Preservation**: Late chunking ensures that the relationship between tokens across different chunks is maintained.\n    *   **Efficiency**: Late chunking requires the same amount of storage as naive chunking while significantly improving retrieval accuracy.\n*   **Trade-offs**:\n    *   **Requires Long Context Models**: To embed the entire document at once, a model with long-context capabilities (e.g., supporting up to 8192 tokens) is necessary.\n    *   **Slightly Higher Compute Costs**: Late chunking introduces an extra pooling step after embedding, although it’s more efficient than late interaction approaches like [ColBERT](https://arxiv.org/abs/2004.12832).\n\n*   **Context Preservation**: Late chunking ensures that the relationship between tokens across different chunks is maintained.\n*   **Efficiency**: Late chunking requires the same amount of storage as naive chunking while significantly improving retrieval accuracy.\n\n*   **Requires Long Context Models**: To embed the entire document at once, a model with long-context capabilities (e.g., supporting up to 8192 tokens) is necessary.\n*   **Slightly Higher Compute Costs**: Late chunking introduces an extra pooling step after embedding, although it’s more efficient than late interaction approaches like [ColBERT](https://arxiv.org/abs/2004.12832).\n\n##### Late Interaction\n\n###### What is Late Interaction?\n\n*   Late Interaction refers to a retrieval approach where token embeddings for both the document and the query are computed separately and compared at the token level, without any pooling operation. The key advantage is fine-grained, token-level matching, which improves retrieval accuracy.\n\n###### [ColBERT](https://arxiv.org/abs/2004.12832): Late Interaction in Practice\n\n*   [ColBERT](https://arxiv.org/abs/2004.12832) (Contextualized Late Interaction over BERT) by Khattab et al. (2020) uses late interaction to compare individual token embeddings from the query and document using a MaxSim operator. This allows for granular, token-to-token comparisons, which results in highly precise matches but at a significantly higher storage cost.\n\n###### MaxSim: a Key Component of [ColBERT](https://arxiv.org/abs/2004.12832)\n\n*   [MaxSim](https://stackoverflow.com/questions/74972472/how-to-perform-the-maxsim-operator-leveraging-torch-procedures) (Maximum Similarity) is a core component of the [ColBERT](https://arxiv.org/abs/2004.12832) retrieval framework. It refers to a specific way of calculating the similarity between token embeddings of a query and document during retrieval.\n*   Here’s a step-by-step breakdown of how MaxSim works:\n    1.  **Token-level Embedding Comparisons**:\n        *   When a query is processed, it is tokenized and each token is embedded separately (e.g., “apple” and “sweet”).\n        *   The document is already indexed at the token level, meaning that each token in the document also has its own embedding.\n    2.  **Similarity Computation**:\n        *   At query time, the system compares each query token embedding to every token embedding in the document. The similarity between two token embeddings is often measured using a dot product or cosine similarity.\n        *   For example, given a query token `\"apple\"` and a document containing tokens like `\"apple\"`, `\"banana\"`, and `\"fruit\"`, the system computes the similarity of `\"apple\"` to each of these tokens.\n    3.  **Selecting Maximum Similarity (MaxSim)**:\n        *   The system selects the highest similarity score between the query token and the document tokens. This is known as the MaxSim operation.\n        *   In the above example, the system compares the similarity of `\"apple\"` (query token) with all document tokens and selects the highest similarity score, say between `\"apple\"` and the corresponding token `\"apple\"` in the document.\n    4.  **MaxSim Aggregation**:\n        \n        > The MaxSim scores for each token in the query are aggregated (i.e., summed up) to calculate a final relevance score for the document with respect to the query.\n        \n        *   This approach allows for token-level precision, capturing subtle nuances in the document-query matching that would be lost with traditional pooling methods.\n\n1.  **Token-level Embedding Comparisons**:\n    *   When a query is processed, it is tokenized and each token is embedded separately (e.g., “apple” and “sweet”).\n    *   The document is already indexed at the token level, meaning that each token in the document also has its own embedding.\n2.  **Similarity Computation**:\n    *   At query time, the system compares each query token embedding to every token embedding in the document. The similarity between two token embeddings is often measured using a dot product or cosine similarity.\n    *   For example, given a query token `\"apple\"` and a document containing tokens like `\"apple\"`, `\"banana\"`, and `\"fruit\"`, the system computes the similarity of `\"apple\"` to each of these tokens.\n3.  **Selecting Maximum Similarity (MaxSim)**:\n    *   The system selects the highest similarity score between the query token and the document tokens. This is known as the MaxSim operation.\n    *   In the above example, the system compares the similarity of `\"apple\"` (query token) with all document tokens and selects the highest similarity score, say between `\"apple\"` and the corresponding token `\"apple\"` in the document.\n4.  **MaxSim Aggregation**:\n    \n    > The MaxSim scores for each token in the query are aggregated (i.e., summed up) to calculate a final relevance score for the document with respect to the query.\n    \n    *   This approach allows for token-level precision, capturing subtle nuances in the document-query matching that would be lost with traditional pooling methods.\n\n*   When a query is processed, it is tokenized and each token is embedded separately (e.g., “apple” and “sweet”).\n*   The document is already indexed at the token level, meaning that each token in the document also has its own embedding.\n\n*   At query time, the system compares each query token embedding to every token embedding in the document. The similarity between two token embeddings is often measured using a dot product or cosine similarity.\n*   For example, given a query token `\"apple\"` and a document containing tokens like `\"apple\"`, `\"banana\"`, and `\"fruit\"`, the system computes the similarity of `\"apple\"` to each of these tokens.\n\n*   The system selects the highest similarity score between the query token and the document tokens. This is known as the MaxSim operation.\n*   In the above example, the system compares the similarity of `\"apple\"` (query token) with all document tokens and selects the highest similarity score, say between `\"apple\"` and the corresponding token `\"apple\"` in the document.\n\n> The MaxSim scores for each token in the query are aggregated (i.e., summed up) to calculate a final relevance score for the document with respect to the query.\n\nThe MaxSim scores for each token in the query are aggregated (i.e., summed up) to calculate a final relevance score for the document with respect to the query.\n\n*   This approach allows for token-level precision, capturing subtle nuances in the document-query matching that would be lost with traditional pooling methods.\n\n###### Example\n\n*   Consider the query `\"sweet apple\"` and two documents:\n    \n    *   **Document 1**: “The apple is sweet and crisp.”\n    *   **Document 2**: “The banana is ripe and yellow.”\n*   Each query token, `\"sweet\"` and `\"apple\"`, is compared with every token in both documents:\n    \n    *   For **Document 1**, `\"sweet\"` has a high similarity with `\"sweet\"` in the document, and `\"apple\"` has a high similarity with `\"apple\"`.\n    *   For **Document 2**, `\"sweet\"` does not have a strong match with any token, and `\"apple\"` does not appear.\n*   Using MaxSim, Document 1 would have a higher relevance score for the query than Document 2 because the most similar tokens in Document 1 (i.e., `\"sweet\"` and `\"apple\"`) align more closely with the query tokens.\n    \n\nConsider the query `\"sweet apple\"` and two documents:\n\n*   **Document 1**: “The apple is sweet and crisp.”\n*   **Document 2**: “The banana is ripe and yellow.”\n\nEach query token, `\"sweet\"` and `\"apple\"`, is compared with every token in both documents:\n\n*   For **Document 1**, `\"sweet\"` has a high similarity with `\"sweet\"` in the document, and `\"apple\"` has a high similarity with `\"apple\"`.\n*   For **Document 2**, `\"sweet\"` does not have a strong match with any token, and `\"apple\"` does not appear.\n\nUsing MaxSim, Document 1 would have a higher relevance score for the query than Document 2 because the most similar tokens in Document 1 (i.e., `\"sweet\"` and `\"apple\"`) align more closely with the query tokens.\n\n###### Advantages and Trade-offs\n\n*   **Advantages**:\n    *   **High Precision**: [ColBERT](https://arxiv.org/abs/2004.12832)’s token-level comparisons, facilitated by MaxSim, lead to highly accurate retrieval, particularly for specific or complex queries.\n    *   **Flexible Query Matching**: By calculating similarity at the token level, [ColBERT](https://arxiv.org/abs/2004.12832) can capture fine-grained relationships that simpler models might overlook.\n*   **Trade-offs**:\n    *   **Storage Intensive**: Storing all token embeddings for each document can be extremely costly. For example, storing token embeddings for a corpus of 100,000 documents could require upwards of 2.46 TB.\n    *   **Computational Complexity**: While precise, MaxSim increases computational demands at query time, as each token in the query must be compared to all tokens in the document.\n\n*   **High Precision**: [ColBERT](https://arxiv.org/abs/2004.12832)’s token-level comparisons, facilitated by MaxSim, lead to highly accurate retrieval, particularly for specific or complex queries.\n*   **Flexible Query Matching**: By calculating similarity at the token level, [ColBERT](https://arxiv.org/abs/2004.12832) can capture fine-grained relationships that simpler models might overlook.\n\n*   **Storage Intensive**: Storing all token embeddings for each document can be extremely costly. For example, storing token embeddings for a corpus of 100,000 documents could require upwards of 2.46 TB.\n*   **Computational Complexity**: While precise, MaxSim increases computational demands at query time, as each token in the query must be compared to all tokens in the document.\n\n##### [ColPali](https://arxiv.org/abs/2407.01449): Expanding to Multimodal Late-Interaction Retrieval\n\n*   [ColPali](https://arxiv.org/abs/2407.01449) by Faysse et al. (2024) integrates the late interaction mechanism from [ColBERT](https://arxiv.org/abs/2004.12832) with a Vision Language Model (VLM) called PaliGemma to handle multimodal documents, such as PDFs with text, images, and tables. Instead of relying on OCR and layout parsing, [ColPali](https://arxiv.org/abs/2407.01449) uses screenshots of PDF pages to directly embed both visual and textual content. This enables powerful multimodal retrieval in complex documents.\n\n###### Example\n\n*   Consider a complex PDF with both text and images. [ColPali](https://arxiv.org/abs/2407.01449) treats each page as an image and embeds it using a VLM. When a user queries the system, the query is matched with embedded screenshots via late interaction, improving the ability to retrieve relevant pages based on both visual and textual content.\n\n![](/primers/ai/assets/RAG/ColPali.jpg)\n\n##### Comparative Analysis\n\n**Metric**\n\n**Naive Chunking**\n\n**Late Chunking**\n\n**Late Interaction**\n\nStorage Requirements\n\nMinimal storage, ~4.9 GB for 100,000 documents\n\nSame as naive chunking, ~4.9 GB for 100,000 documents\n\nExtremely high storage, ~2.46 TB for 100,000 documents\n\nRetrieval Precision\n\nLower precision due to context fragmentation\n\nImproved precision by retaining context across chunks\n\nHighest precision with token-level matching\n\nComplexity and Cost\n\nSimple implementation, minimal resources\n\nModerately more complex, efficient in compute and storage\n\nHighly complex, resource-intensive in both storage and computation\n\n**Metric**\n\n**Naive Chunking**\n\n**Late Chunking**\n\n**Late Interaction**\n\nStorage Requirements\n\nMinimal storage, ~4.9 GB for 100,000 documents\n\nSame as naive chunking, ~4.9 GB for 100,000 documents\n\nExtremely high storage, ~2.46 TB for 100,000 documents\n\nRetrieval Precision\n\nLower precision due to context fragmentation\n\nImproved precision by retaining context across chunks\n\nHighest precision with token-level matching\n\nComplexity and Cost\n\nSimple implementation, minimal resources\n\nModerately more complex, efficient in compute and storage\n\nHighly complex, resource-intensive in both storage and computation\n\n#### Sentence Embeddings: the What and Why\n\n*   **Motivation:**\n    *   Before the introduction of Sentence-BERT (SBERT), applying BERT to semantic similarity or retrieval tasks was computationally infeasible at scale. BERT operated as a _cross-encoder_, where each sentence pair required a joint forward pass with full cross-attention, resulting in O(n2)O(n2)O(n^2) complexity. Using raw BERT embeddings—such as averaging token vectors or taking the `[CLS]` output—performed worse than earlier static embedding models like GloVe, meaning embeddings couldn’t be precomputed or efficiently compared. Consequently, BERT was limited to re-ranking a small number of candidate sentences rather than performing large-scale semantic retrieval.\n    *   SBERT addressed this limitation by fine-tuning BERT in a Siamese or triplet configuration, enabling independent computation of sentence embeddings. This allowed O(n)O(n)O(n) embedding computations followed by lightweight cosine similarity comparisons, reducing semantic search computation from roughly 65 hours to 5 seconds while preserving accuracy. This breakthrough laid the foundation for modern **dense retrieval**, **dual-encoder architectures**, and **retrieval-augmented generation (RAG)** systems, all of which depend on scalable, precomputable embeddings.\n\n*   Before the introduction of Sentence-BERT (SBERT), applying BERT to semantic similarity or retrieval tasks was computationally infeasible at scale. BERT operated as a _cross-encoder_, where each sentence pair required a joint forward pass with full cross-attention, resulting in O(n2)O(n2)O(n^2) complexity. Using raw BERT embeddings—such as averaging token vectors or taking the `[CLS]` output—performed worse than earlier static embedding models like GloVe, meaning embeddings couldn’t be precomputed or efficiently compared. Consequently, BERT was limited to re-ranking a small number of candidate sentences rather than performing large-scale semantic retrieval.\n*   SBERT addressed this limitation by fine-tuning BERT in a Siamese or triplet configuration, enabling independent computation of sentence embeddings. This allowed O(n)O(n)O(n) embedding computations followed by lightweight cosine similarity comparisons, reducing semantic search computation from roughly 65 hours to 5 seconds while preserving accuracy. This breakthrough laid the foundation for modern **dense retrieval**, **dual-encoder architectures**, and **retrieval-augmented generation (RAG)** systems, all of which depend on scalable, precomputable embeddings.\n\n##### Background: Differences Compared to Token-Level Models Like BERT\n\n*   As an overview, let’s look into how sentence transformers differ compared to token-level embedding models such as BERT.\n    \n*   Sentence Transformers are a modification of the traditional BERT model, tailored specifically for generating embeddings of entire sentences (i.e., sentence embeddings). The key differences in their training approaches are:\n    \n    1.  **Objective**: BERT is trained to predict masked words and next sentence prediction. Sentence Transformers, as introduced in [Sentence-BERT](https://arxiv.org/abs/1908.10084) by Reimers and Gurevych (2019), are fine-tuned specifically to understand relationships between sentences. They produce embeddings where semantically similar sentences are close in vector space, typically using cosine similarity as the comparison metric.\n    2.  **Level of Embedding**: BERT provides contextualized token embeddings, while Sentence Transformers produce a single, semantically meaningful embedding for the entire sentence by applying a pooling operation to the transformer’s output.\n    3.  **Training Data and Tasks**: SBERT is fine-tuned using datasets like SNLI and MultiNLI, which contain labeled sentence pairs (entailment, contradiction, neutral). This contrastive supervision enables it to learn sentence-level semantics that generalize well to similarity tasks.\n    4.  **Siamese and Triplet Network Structures**: SBERT introduces a siamese or triplet architecture where two or three BERT models (sharing weights) encode input sentences into embeddings. During training, these embeddings are optimized so that semantically close sentences have higher cosine similarity and dissimilar ones have lower similarity.\n    5.  **Pooling Strategies**: To obtain a fixed-size vector, SBERT applies pooling over the last hidden layer of BERT. The paper experiments with three strategies—mean pooling, max pooling, and using the `[CLS]` token output—with mean pooling performing best.\n    6.  **Fine-Tuning Objectives**: Depending on available supervision, SBERT can use classification (softmax over concatenated embeddings and element-wise differences), regression (cosine similarity with mean-squared error), or triplet loss objectives to align embeddings of related sentences.\n        *   For the classification objective, the embeddings uuu and vvv are concatenated with their element-wise absolute difference ∣u−v∣∣u−v∣\\\\mid u - v \\\\mid, forming a vector of size 3n3n3n. This is passed through a fully connected linear layer with weight matrix Wt∈ℝ3n×kWt∈R3n×kW\\_t \\\\in \\\\mathbb{R}^{3n \\\\times k} before applying softmax o\\=softmax(Wt\\[u;v;∣u−v∣\\])o\\=softmax(Wt\\[u;v;∣u−v∣\\])o = \\\\text{softmax}(W\\_t \\[u; v; \\\\mid u - v \\\\mid\\]), where kkk is the number of output classes (since the [SBERT paper](https://arxiv.org/abs/1908.10084) focused on NLI, they were entailment, contradiction, and neutral). This projection layer provides the learned transformation before softmax classification. By removing the softmax head at inference time, SBERT reduces similarity computation from O(n2)O(n2)O(n^2) pairwise comparisons to O(n)O(n)O(n) independent embedding computations followed by lightweight cosine similarity scoring—enabling massive speedups in retrieval. During training, the softmax classifier makes the model **close-ended**, restricted to a fixed set of kkk output classes (e.g., entailment, contradiction, neutral). In contrast, inference is **open-ended**: without the softmax constraint, SBERT functions as a general-purpose feature extractor whose embeddings can be compared across unseen categories using cosine similarity, optionally followed by thresholding on the score sim(u,v)\\=u⋅v∣u∣∣v∣sim(u,v)\\=u⋅v∣u∣∣v∣\\\\text{sim}(u, v) = \\\\frac{u \\\\cdot v}{\\\\mid u \\\\mid \\\\mid v \\\\mid} for binary decisions (e.g., “similar” vs. “not similar”).\n        *   Although the original SBERT paper did not employ it, this triplet framework can be **extended to Multiple Negatives Ranking Loss (MNRL)**, where each batch provides multiple implicit negatives for every anchor–positive pair. MNRL improves efficiency by leveraging all non-matching pairs within a batch as negatives, making training more stable and scalable for large datasets.\n    7.  **Efficiency in Generating Sentence Embeddings or Similarity Tasks**: In the standard BERT model, sentence embeddings are generated using the `[CLS]` vector from the last layer, which performs poorly for semantic similarity (correlations as low as 0.29 on STS tasks). In contrast, SBERT dramatically improves both accuracy and computational efficiency: semantic similarity searches that would take ~65 hours with BERT can be done in about 5 seconds with SBERT.\n    8.  **Applicability**: While BERT excels at tasks requiring token-level understanding (e.g., named entity recognition, question answering), Sentence Transformers are optimized for semantic similarity, clustering, and retrieval tasks.\n*   The left half of the following figure ([source](https://arxiv.org/abs/1908.10084)) shows the SBERT architecture with the classification objective function, e.g., for fine-tuning on SNLI dataset. The two BERT networks have tied weights (siamese network structure).\n    *   This figure illustrates the **training phase**, where two tied-weight BERT encoders process sentences A and B to produce embeddings uuu and vvv. These embeddings are concatenated with their **element-wise absolute difference ∣u−v∣∣u−v∣\\\\mid u - v \\\\mid** and passed through a **linear projection layer WtWtW\\_t** before a softmax classifier predicts relational labels such as entailment or contradiction. The softmax layer is critical during training because it provides a supervised learning signal (with discrete classification labels) that guides the model to map semantically related sentences close together in embedding space.\n*   The right half of the following figure ([source](https://arxiv.org/abs/1908.10084)) shows the SBERT architecture during inference, for example, to compute similarity scores. This architecture is also used with the regression objective function.\n    *   This figure depicts the **inference phase**, where the trained encoders are used without the softmax classification head. Instead, embeddings are generated independently for each sentence and compared using **cosine similarity**, optionally followed by thresholding to make binary similarity decisions.\n    *   The removal of the softmax layer is essential because, if retained, it would require concatenating pairs of embeddings and performing a new forward pass for each pair—reintroducing the O(n2)O(n2)O(n^2) cost of cross-encoding. Without the softmax layer, embeddings can be computed once per sentence (offline or on-demand), allowing fast vector-based retrieval and comparison. In other words, omitting the softmax during inference enables the key property that makes SBERT efficient: sentence embeddings become **independent representations** that can be precomputed and compared directly using cosine similarity, without needing joint inference over pairs.\n\nAs an overview, let’s look into how sentence transformers differ compared to token-level embedding models such as BERT.\n\nSentence Transformers are a modification of the traditional BERT model, tailored specifically for generating embeddings of entire sentences (i.e., sentence embeddings). The key differences in their training approaches are:\n\n1.  **Objective**: BERT is trained to predict masked words and next sentence prediction. Sentence Transformers, as introduced in [Sentence-BERT](https://arxiv.org/abs/1908.10084) by Reimers and Gurevych (2019), are fine-tuned specifically to understand relationships between sentences. They produce embeddings where semantically similar sentences are close in vector space, typically using cosine similarity as the comparison metric.\n2.  **Level of Embedding**: BERT provides contextualized token embeddings, while Sentence Transformers produce a single, semantically meaningful embedding for the entire sentence by applying a pooling operation to the transformer’s output.\n3.  **Training Data and Tasks**: SBERT is fine-tuned using datasets like SNLI and MultiNLI, which contain labeled sentence pairs (entailment, contradiction, neutral). This contrastive supervision enables it to learn sentence-level semantics that generalize well to similarity tasks.\n4.  **Siamese and Triplet Network Structures**: SBERT introduces a siamese or triplet architecture where two or three BERT models (sharing weights) encode input sentences into embeddings. During training, these embeddings are optimized so that semantically close sentences have higher cosine similarity and dissimilar ones have lower similarity.\n5.  **Pooling Strategies**: To obtain a fixed-size vector, SBERT applies pooling over the last hidden layer of BERT. The paper experiments with three strategies—mean pooling, max pooling, and using the `[CLS]` token output—with mean pooling performing best.\n6.  **Fine-Tuning Objectives**: Depending on available supervision, SBERT can use classification (softmax over concatenated embeddings and element-wise differences), regression (cosine similarity with mean-squared error), or triplet loss objectives to align embeddings of related sentences.\n    *   For the classification objective, the embeddings uuu and vvv are concatenated with their element-wise absolute difference ∣u−v∣∣u−v∣\\\\mid u - v \\\\mid, forming a vector of size 3n3n3n. This is passed through a fully connected linear layer with weight matrix Wt∈ℝ3n×kWt∈R3n×kW\\_t \\\\in \\\\mathbb{R}^{3n \\\\times k} before applying softmax o\\=softmax(Wt\\[u;v;∣u−v∣\\])o\\=softmax(Wt\\[u;v;∣u−v∣\\])o = \\\\text{softmax}(W\\_t \\[u; v; \\\\mid u - v \\\\mid\\]), where kkk is the number of output classes (since the [SBERT paper](https://arxiv.org/abs/1908.10084) focused on NLI, they were entailment, contradiction, and neutral). This projection layer provides the learned transformation before softmax classification. By removing the softmax head at inference time, SBERT reduces similarity computation from O(n2)O(n2)O(n^2) pairwise comparisons to O(n)O(n)O(n) independent embedding computations followed by lightweight cosine similarity scoring—enabling massive speedups in retrieval. During training, the softmax classifier makes the model **close-ended**, restricted to a fixed set of kkk output classes (e.g., entailment, contradiction, neutral). In contrast, inference is **open-ended**: without the softmax constraint, SBERT functions as a general-purpose feature extractor whose embeddings can be compared across unseen categories using cosine similarity, optionally followed by thresholding on the score sim(u,v)\\=u⋅v∣u∣∣v∣sim(u,v)\\=u⋅v∣u∣∣v∣\\\\text{sim}(u, v) = \\\\frac{u \\\\cdot v}{\\\\mid u \\\\mid \\\\mid v \\\\mid} for binary decisions (e.g., “similar” vs. “not similar”).\n    *   Although the original SBERT paper did not employ it, this triplet framework can be **extended to Multiple Negatives Ranking Loss (MNRL)**, where each batch provides multiple implicit negatives for every anchor–positive pair. MNRL improves efficiency by leveraging all non-matching pairs within a batch as negatives, making training more stable and scalable for large datasets.\n7.  **Efficiency in Generating Sentence Embeddings or Similarity Tasks**: In the standard BERT model, sentence embeddings are generated using the `[CLS]` vector from the last layer, which performs poorly for semantic similarity (correlations as low as 0.29 on STS tasks). In contrast, SBERT dramatically improves both accuracy and computational efficiency: semantic similarity searches that would take ~65 hours with BERT can be done in about 5 seconds with SBERT.\n8.  **Applicability**: While BERT excels at tasks requiring token-level understanding (e.g., named entity recognition, question answering), Sentence Transformers are optimized for semantic similarity, clustering, and retrieval tasks.\n\n*   For the classification objective, the embeddings uuu and vvv are concatenated with their element-wise absolute difference ∣u−v∣∣u−v∣\\\\mid u - v \\\\mid, forming a vector of size 3n3n3n. This is passed through a fully connected linear layer with weight matrix Wt∈ℝ3n×kWt∈R3n×kW\\_t \\\\in \\\\mathbb{R}^{3n \\\\times k} before applying softmax o\\=softmax(Wt\\[u;v;∣u−v∣\\])o\\=softmax(Wt\\[u;v;∣u−v∣\\])o = \\\\text{softmax}(W\\_t \\[u; v; \\\\mid u - v \\\\mid\\]), where kkk is the number of output classes (since the [SBERT paper](https://arxiv.org/abs/1908.10084) focused on NLI, they were entailment, contradiction, and neutral). This projection layer provides the learned transformation before softmax classification. By removing the softmax head at inference time, SBERT reduces similarity computation from O(n2)O(n2)O(n^2) pairwise comparisons to O(n)O(n)O(n) independent embedding computations followed by lightweight cosine similarity scoring—enabling massive speedups in retrieval. During training, the softmax classifier makes the model **close-ended**, restricted to a fixed set of kkk output classes (e.g., entailment, contradiction, neutral). In contrast, inference is **open-ended**: without the softmax constraint, SBERT functions as a general-purpose feature extractor whose embeddings can be compared across unseen categories using cosine similarity, optionally followed by thresholding on the score sim(u,v)\\=u⋅v∣u∣∣v∣sim(u,v)\\=u⋅v∣u∣∣v∣\\\\text{sim}(u, v) = \\\\frac{u \\\\cdot v}{\\\\mid u \\\\mid \\\\mid v \\\\mid} for binary decisions (e.g., “similar” vs. “not similar”).\n*   Although the original SBERT paper did not employ it, this triplet framework can be **extended to Multiple Negatives Ranking Loss (MNRL)**, where each batch provides multiple implicit negatives for every anchor–positive pair. MNRL improves efficiency by leveraging all non-matching pairs within a batch as negatives, making training more stable and scalable for large datasets.\n\n*   This figure illustrates the **training phase**, where two tied-weight BERT encoders process sentences A and B to produce embeddings uuu and vvv. These embeddings are concatenated with their **element-wise absolute difference ∣u−v∣∣u−v∣\\\\mid u - v \\\\mid** and passed through a **linear projection layer WtWtW\\_t** before a softmax classifier predicts relational labels such as entailment or contradiction. The softmax layer is critical during training because it provides a supervised learning signal (with discrete classification labels) that guides the model to map semantically related sentences close together in embedding space.\n\n*   This figure depicts the **inference phase**, where the trained encoders are used without the softmax classification head. Instead, embeddings are generated independently for each sentence and compared using **cosine similarity**, optionally followed by thresholding to make binary similarity decisions.\n*   The removal of the softmax layer is essential because, if retained, it would require concatenating pairs of embeddings and performing a new forward pass for each pair—reintroducing the O(n2)O(n2)O(n^2) cost of cross-encoding. Without the softmax layer, embeddings can be computed once per sentence (offline or on-demand), allowing fast vector-based retrieval and comparison. In other words, omitting the softmax during inference enables the key property that makes SBERT efficient: sentence embeddings become **independent representations** that can be precomputed and compared directly using cosine similarity, without needing joint inference over pairs.\n\n![](../../../images/papers/sbert.jpg)\n\n*   In summary, while BERT is a general-purpose contextual language model, Sentence Transformers like SBERT are optimized for semantic comparison at the sentence level, producing dense, meaningful embeddings well-suited for similarity-based tasks.\n\n##### Training Process for Sentence Transformers vs. Token-Level Embedding Models\n\n*   Sentence Transformers are trained differently from token-level models such as BERT. Their process focuses on aligning sentence meanings rather than predicting masked words.\n    \n    1.  **Model Architecture**: SBERT builds on pretrained BERT or RoBERTa models by adding a pooling layer that converts token-level outputs into a single sentence embedding.\n    2.  **Training Data**: SBERT is fine-tuned on Natural Language Inference (NLI) datasets like SNLI and MultiNLI, containing hundreds of thousands of labeled sentence pairs that capture semantic relations.\n    3.  **Training Objectives**:\n        *   **Classification Objective**: Concatenates embeddings of two sentences (u,v)(u,v)(u, v) with their element-wise absolute difference ∣u−v∣∣u−v∣\\\\mid u - v \\\\mid, projects the resulting 3n3n3n\\-dimensional vector through a linear layer Wt∈ℝ3n×kWt∈R3n×kW\\_t \\\\in \\\\mathbb{R}^{3n \\\\times k}, and applies softmax to obtain class probabilities. This setup makes training **close-ended**, restricted to the predefined NLI labels, whereas inference is **open-ended**, since embeddings can later be compared beyond those classes using cosine similarity and thresholding.\n        *   **Regression Objective**: Minimizes mean-squared error between cosine similarity of embeddings and human-annotated similarity scores.\n        *   **Triplet Objective**: Minimizes the margin between anchor–positive and anchor–negative pairs, ensuring semantically close sentences are closer in embedding space. Although the original paper did not use it, this triplet loss can naturally extend to **Multiple Negatives Ranking Loss (MNRL)**, which treats every non-matching sentence in the same batch as a negative sample—improving data efficiency and convergence for large-scale contrastive learning.\n    4.  **Pooling and Representation**: The final sentence embedding is typically the mean of all token embeddings from the last hidden layer, which captures overall sentence meaning better than using only the `[CLS]` token.\n    5.  **Efficiency Gains**: SBERT reduces the number of required pairwise comparisons from O(n2)O(n2)O(n^2) to O(n)O(n)O(n), since sentence embeddings can be precomputed and compared using cosine similarity. This makes it suitable for large-scale applications like semantic search or clustering.\n    6.  **Evaluation and Performance**: SBERT achieves state-of-the-art performance on multiple STS benchmarks, outperforming models like InferSent and Universal Sentence Encoder by significant margins (average correlation improvements of 5–12 points).\n*   **Practical Impact on Retrieval Systems**: SBERT’s dual-encoder setup—where sentences are encoded independently and compared via cosine similarity—became the cornerstone of dense retrieval. Removing the softmax layer in inference is precisely what enables offline precomputation and real-time similarity search across massive corpora. This innovation allowed embedding-based retrieval systems, approximate nearest neighbor (ANN) search, and RAG pipelines to become scalable and efficient at industrial scale.\n    \n*   In summary, Sentence-BERT extends BERT with architecture and training modifications that produce semantically rich, scalable, and efficient sentence representations suitable for similarity and clustering tasks.\n    \n\nSentence Transformers are trained differently from token-level models such as BERT. Their process focuses on aligning sentence meanings rather than predicting masked words.\n\n1.  **Model Architecture**: SBERT builds on pretrained BERT or RoBERTa models by adding a pooling layer that converts token-level outputs into a single sentence embedding.\n2.  **Training Data**: SBERT is fine-tuned on Natural Language Inference (NLI) datasets like SNLI and MultiNLI, containing hundreds of thousands of labeled sentence pairs that capture semantic relations.\n3.  **Training Objectives**:\n    *   **Classification Objective**: Concatenates embeddings of two sentences (u,v)(u,v)(u, v) with their element-wise absolute difference ∣u−v∣∣u−v∣\\\\mid u - v \\\\mid, projects the resulting 3n3n3n\\-dimensional vector through a linear layer Wt∈ℝ3n×kWt∈R3n×kW\\_t \\\\in \\\\mathbb{R}^{3n \\\\times k}, and applies softmax to obtain class probabilities. This setup makes training **close-ended**, restricted to the predefined NLI labels, whereas inference is **open-ended**, since embeddings can later be compared beyond those classes using cosine similarity and thresholding.\n    *   **Regression Objective**: Minimizes mean-squared error between cosine similarity of embeddings and human-annotated similarity scores.\n    *   **Triplet Objective**: Minimizes the margin between anchor–positive and anchor–negative pairs, ensuring semantically close sentences are closer in embedding space. Although the original paper did not use it, this triplet loss can naturally extend to **Multiple Negatives Ranking Loss (MNRL)**, which treats every non-matching sentence in the same batch as a negative sample—improving data efficiency and convergence for large-scale contrastive learning.\n4.  **Pooling and Representation**: The final sentence embedding is typically the mean of all token embeddings from the last hidden layer, which captures overall sentence meaning better than using only the `[CLS]` token.\n5.  **Efficiency Gains**: SBERT reduces the number of required pairwise comparisons from O(n2)O(n2)O(n^2) to O(n)O(n)O(n), since sentence embeddings can be precomputed and compared using cosine similarity. This makes it suitable for large-scale applications like semantic search or clustering.\n6.  **Evaluation and Performance**: SBERT achieves state-of-the-art performance on multiple STS benchmarks, outperforming models like InferSent and Universal Sentence Encoder by significant margins (average correlation improvements of 5–12 points).\n\n*   **Classification Objective**: Concatenates embeddings of two sentences (u,v)(u,v)(u, v) with their element-wise absolute difference ∣u−v∣∣u−v∣\\\\mid u - v \\\\mid, projects the resulting 3n3n3n\\-dimensional vector through a linear layer Wt∈ℝ3n×kWt∈R3n×kW\\_t \\\\in \\\\mathbb{R}^{3n \\\\times k}, and applies softmax to obtain class probabilities. This setup makes training **close-ended**, restricted to the predefined NLI labels, whereas inference is **open-ended**, since embeddings can later be compared beyond those classes using cosine similarity and thresholding.\n*   **Regression Objective**: Minimizes mean-squared error between cosine similarity of embeddings and human-annotated similarity scores.\n*   **Triplet Objective**: Minimizes the margin between anchor–positive and anchor–negative pairs, ensuring semantically close sentences are closer in embedding space. Although the original paper did not use it, this triplet loss can naturally extend to **Multiple Negatives Ranking Loss (MNRL)**, which treats every non-matching sentence in the same batch as a negative sample—improving data efficiency and convergence for large-scale contrastive learning.\n\n**Practical Impact on Retrieval Systems**: SBERT’s dual-encoder setup—where sentences are encoded independently and compared via cosine similarity—became the cornerstone of dense retrieval. Removing the softmax layer in inference is precisely what enables offline precomputation and real-time similarity search across massive corpora. This innovation allowed embedding-based retrieval systems, approximate nearest neighbor (ANN) search, and RAG pipelines to become scalable and efficient at industrial scale.\n\nIn summary, Sentence-BERT extends BERT with architecture and training modifications that produce semantically rich, scalable, and efficient sentence representations suitable for similarity and clustering tasks.\n\n##### Applying Sentence Transformers for RAG\n\n*   Now, let’s look into why sentence transformers are the numero uno choice of models to generate embeddings for RAG.\n*   RAG leverages Sentence Transformers for their ability to understand and compare the semantic content of sentences. This integration is particularly useful in scenarios where the model needs to retrieve relevant information before generating a response. Here’s how Sentence Transformers are useful in a RAG setting:\n    1.  **Improved Document Retrieval**: Sentence Transformers are trained to generate embeddings that capture the semantic meaning of sentences. In a RAG setting, these embeddings can be used to match a query (like a user’s question) with the most relevant documents or passages in a database. This is critical because the quality of the generated response often depends on the relevance of the retrieved information.\n    2.  **Efficient Semantic Search**: Traditional keyword-based search methods might struggle with understanding the context or the semantic nuances of a query. Sentence Transformers, by providing semantically meaningful embeddings, enable more nuanced searches that go beyond keyword matching. This means that the retrieval component of RAG can find documents that are semantically related to the query, even if they don’t contain the exact keywords.\n    3.  **Contextual Understanding for Better Responses**: By using Sentence Transformers, the RAG model can better understand the context and nuances of both the input query and the content of potential source documents. This leads to more accurate and contextually appropriate responses, as the generation component of the model has more relevant and well-understood information to work with.\n    4.  **Scalability in Information Retrieval**: Sentence Transformers can efficiently handle large databases of documents by pre-computing embeddings for all documents. This makes the retrieval process faster and more scalable, as the model only needs to compute the embedding for the query at runtime and then quickly find the closest document embeddings.\n    5.  **Enhancing the Generation Process**: In a RAG setup, the generation component benefits from the retrieval component’s ability to provide relevant, semantically-rich information. This allows the language model to generate responses that are not only contextually accurate but also informed by a broader range of information than what the model itself was trained on.\n*   In summary, Sentence Transformers enhance the retrieval capabilities of RAG models with LLMs by enabling more effective semantic search and retrieval of information. This leads to improved performance in tasks that require understanding and generating responses based on large volumes of text data, such as question answering, chatbots, and information extraction.\n\n1.  **Improved Document Retrieval**: Sentence Transformers are trained to generate embeddings that capture the semantic meaning of sentences. In a RAG setting, these embeddings can be used to match a query (like a user’s question) with the most relevant documents or passages in a database. This is critical because the quality of the generated response often depends on the relevance of the retrieved information.\n2.  **Efficient Semantic Search**: Traditional keyword-based search methods might struggle with understanding the context or the semantic nuances of a query. Sentence Transformers, by providing semantically meaningful embeddings, enable more nuanced searches that go beyond keyword matching. This means that the retrieval component of RAG can find documents that are semantically related to the query, even if they don’t contain the exact keywords.\n3.  **Contextual Understanding for Better Responses**: By using Sentence Transformers, the RAG model can better understand the context and nuances of both the input query and the content of potential source documents. This leads to more accurate and contextually appropriate responses, as the generation component of the model has more relevant and well-understood information to work with.\n4.  **Scalability in Information Retrieval**: Sentence Transformers can efficiently handle large databases of documents by pre-computing embeddings for all documents. This makes the retrieval process faster and more scalable, as the model only needs to compute the embedding for the query at runtime and then quickly find the closest document embeddings.\n5.  **Enhancing the Generation Process**: In a RAG setup, the generation component benefits from the retrieval component’s ability to provide relevant, semantically-rich information. This allows the language model to generate responses that are not only contextually accurate but also informed by a broader range of information than what the model itself was trained on.",
    "order": 2,
    "orderInChapter": 1,
    "difficulty": 4,
    "estimatedMinutes": 52,
    "tags": [
      "nlpllms",
      "transformer",
      "attention",
      "embedding",
      "bert",
      "llm",
      "nlp",
      "supervised learning"
    ],
    "metadata": {
      "hasCode": true,
      "hasMath": true,
      "hasImages": true,
      "wordCount": 10309,
      "contentLength": 247329
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#ingestion",
    "scrapedAt": "2025-12-28T11:54:28.274Z"
  },
  {
    "id": "ai-RAG-retrieval-3",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "Building a RAG Pipeline",
    "title": "Retrieval",
    "subtitle": "Building a RAG Pipeline",
    "contentHtml": "<ul>\n  <li>Retrieval is the core mechanism that enables RAG systems to ground language model outputs in external knowledge by selecting a small, relevant subset of documents or passages from a large corpus to condition generation.</li>\n  <li>Lexical, semantic, and hybrid retrieval methods define how queries are mapped to candidate context, directly influencing what information the language model can and cannot use when generating an answer.</li>\n  <li>A solid understanding of retrieval techniques is critical for RAG because retrieval failures (missing key facts, retrieving irrelevant context, or violating constraints) propagate downstream and manifest as hallucinations, inaccuracies, or unsafe outputs during generation.</li>\n  <li>A detailed discourse of retrieval (also known as the information retrieval problem) is available in our <a href=\"../../../recsys/search\">Search</a> primer.</li>\n</ul>\n<h4 id=\"lexical-retrieval\">Lexical Retrieval</h4>\n<ul>\n  <li>Lexical retrieval, also referred to as sparse retrieval, term-based retrieval, or keyword-based retrieval, is the classical foundation of information retrieval systems. It operates purely on observable text signals, relying on exact token matches between a query and documents. Relevance is estimated using statistical properties of terms within documents and across the corpus, without attempting to model meaning or intent.</li>\n  <li>At its core, lexical retrieval assumes that relevance correlates with how frequently and distinctively query terms appear in a document.</li>\n</ul>\n<h5 id=\"core-assumptions\">Core Assumptions</h5>\n<ul>\n  <li>\n    <p>Lexical retrieval is deterministic, interpretable, and highly efficient at scale because of the following assumptions:</p>\n\n    <ul>\n      <li>Words are treated as discrete symbols (tokens).</li>\n      <li>Matching is based on an exact match overlap.</li>\n      <li>Importance is inferred from distributional statistics, not semantics.</li>\n      <li>Query intent is approximated by the literal terms provided.</li>\n    </ul>\n  </li>\n</ul>\n<p>Lexical retrieval is deterministic, interpretable, and highly efficient at scale because of the following assumptions:</p>\n<ul>\n      <li>Words are treated as discrete symbols (tokens).</li>\n      <li>Matching is based on an exact match overlap.</li>\n      <li>Importance is inferred from distributional statistics, not semantics.</li>\n      <li>Query intent is approximated by the literal terms provided.</li>\n    </ul>\n<h5 id=\"tf-idf-term-frequencyinverse-document-frequency\">TF-IDF (Term Frequency–Inverse Document Frequency)</h5>\n<ul>\n  <li>\n    <p>TF-IDF is one of the earliest and most influential scoring schemes in information retrieval. It decomposes relevance into two components:</p>\n\n    <ol>\n      <li>\n        <p><strong>Term Frequency (TF)</strong>: Measures how often a term appears in a document. The intuition is that repeated mentions indicate topical relevance.</p>\n      </li>\n      <li>\n        <p><strong>Inverse Document Frequency (IDF)</strong>: Downweights terms that appear frequently across the corpus, under the assumption that common words carry less discriminative power.</p>\n      </li>\n    </ol>\n  </li>\n  <li>\n    <p>A standard formulation is:</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-26-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>TF-IDF</mtext><mo stretchy=&quot;false&quot;>(</mo><mi>t</mi><mo>,</mo><mi>d</mi><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mtext>TF</mtext><mo stretchy=&quot;false&quot;>(</mo><mi>t</mi><mo>,</mo><mi>d</mi><mo stretchy=&quot;false&quot;>)</mo><mo>&amp;#x22C5;</mo><mi>log</mi><mo>&amp;#x2061;</mo><mrow><mo>(</mo><mfrac><mi>N</mi><mrow><mtext>DF</mtext><mo stretchy=&quot;false&quot;>(</mo><mi>t</mi><mo stretchy=&quot;false&quot;>)</mo></mrow></mfrac><mo>)</mo></mrow></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-186\" style=\"width: 18.648em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 15.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(2.294em, 1015.37em, 4.846em, -999.997em); top: -3.799em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-187\"><span class=\"mtext\" id=\"MathJax-Span-188\" style=\"font-family: STIXGeneral-Regular;\">TF-IDF</span><span class=\"mo\" id=\"MathJax-Span-189\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-190\" style=\"font-family: STIXGeneral-Italic;\">t<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-191\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mi\" id=\"MathJax-Span-192\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.211em;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-193\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-194\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mtext\" id=\"MathJax-Span-195\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">TF</span><span class=\"mo\" id=\"MathJax-Span-196\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-197\" style=\"font-family: STIXGeneral-Italic;\">t<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-198\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mi\" id=\"MathJax-Span-199\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.211em;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-200\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-201\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"mi\" id=\"MathJax-Span-202\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">log</span><span class=\"mo\" id=\"MathJax-Span-203\"></span><span class=\"mrow\" id=\"MathJax-Span-204\"><span class=\"mo\" id=\"MathJax-Span-205\" style=\"vertical-align: -0.466em;\"><span><span style=\"font-size: 111%; font-family: STIXSizeTwoSym;\">(</span></span></span><span class=\"mfrac\" id=\"MathJax-Span-206\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.73em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.362em;\"><span class=\"mi\" id=\"MathJax-Span-207\" style=\"font-family: STIXGeneral-Italic;\">N<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1002.19em, 4.326em, -999.997em); top: -3.331em; left: 50%; margin-left: -1.143em;\"><span class=\"mrow\" id=\"MathJax-Span-208\"><span class=\"mtext\" id=\"MathJax-Span-209\" style=\"font-family: STIXGeneral-Regular;\">DF</span><span class=\"mo\" id=\"MathJax-Span-210\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-211\" style=\"font-family: STIXGeneral-Italic;\">t<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-212\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1002.35em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.346em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-213\" style=\"vertical-align: -0.466em;\"><span><span style=\"font-size: 111%; font-family: STIXSizeTwoSym;\">)</span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 3.805em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -1.122em; border-left: 0px solid; width: 0px; height: 2.753em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>TF-IDF</mtext><mo stretchy=\"false\">(</mo><mi>t</mi><mo>,</mo><mi>d</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mtext>TF</mtext><mo stretchy=\"false\">(</mo><mi>t</mi><mo>,</mo><mi>d</mi><mo stretchy=\"false\">)</mo><mo>⋅</mo><mi>log</mi><mo>⁡</mo><mrow><mo>(</mo><mfrac><mi>N</mi><mrow><mtext>DF</mtext><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo></mrow></mfrac><mo>)</mo></mrow></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-26\">\\text{TF-IDF}(t, d) = \\text{TF}(t, d) \\cdot \\log\\left(\\frac{N}{\\text{DF}(t)}\\right)</script>\n\n    <ul>\n      <li>\n        <p>where:</p>\n\n        <ul>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-27-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>t</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-214\" style=\"width: 0.315em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.263em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.513em, 1000.26em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-215\"><span class=\"mi\" id=\"MathJax-Span-216\" style=\"font-family: STIXGeneral-Italic;\">t<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.816em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>t</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-27\">t</script> is a term,</li>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-28-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>d</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-217\" style=\"width: 0.732em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.576em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.58em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-218\"><span class=\"mi\" id=\"MathJax-Span-219\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>d</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-28\">d</script> is a document,</li>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-29-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>N</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-220\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-221\"><span class=\"mi\" id=\"MathJax-Span-222\" style=\"font-family: STIXGeneral-Italic;\">N<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>N</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-29\">N</script> is the total number of documents,</li>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-30-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>DF</mtext><mo stretchy=&quot;false&quot;>(</mo><mi>t</mi><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-223\" style=\"width: 2.711em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.242em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1002.19em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-224\"><span class=\"mtext\" id=\"MathJax-Span-225\" style=\"font-family: STIXGeneral-Regular;\">DF</span><span class=\"mo\" id=\"MathJax-Span-226\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-227\" style=\"font-family: STIXGeneral-Italic;\">t<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-228\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mtext>DF</mtext><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-30\">\\text{DF}(t)</script> is the number of documents containing <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-31-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>t</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-229\" style=\"width: 0.315em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.263em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.513em, 1000.26em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-230\"><span class=\"mi\" id=\"MathJax-Span-231\" style=\"font-family: STIXGeneral-Italic;\">t<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.816em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>t</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-31\">t</script>.</li>\n        </ul>\n      </li>\n    </ul>\n  </li>\n</ul>\n<p>TF-IDF is one of the earliest and most influential scoring schemes in information retrieval. It decomposes relevance into two components:</p>\n<ol>\n      <li>\n        <p><strong>Term Frequency (TF)</strong>: Measures how often a term appears in a document. The intuition is that repeated mentions indicate topical relevance.</p>\n      </li>\n      <li>\n        <p><strong>Inverse Document Frequency (IDF)</strong>: Downweights terms that appear frequently across the corpus, under the assumption that common words carry less discriminative power.</p>\n      </li>\n    </ol>\n<p><strong>Term Frequency (TF)</strong>: Measures how often a term appears in a document. The intuition is that repeated mentions indicate topical relevance.</p>\n<p><strong>Inverse Document Frequency (IDF)</strong>: Downweights terms that appear frequently across the corpus, under the assumption that common words carry less discriminative power.</p>\n<p>A standard formulation is:</p>\n<ul>\n      <li>\n        <p>where:</p>\n\n        <ul>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-27-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>t</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-214\" style=\"width: 0.315em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.263em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.513em, 1000.26em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-215\"><span class=\"mi\" id=\"MathJax-Span-216\" style=\"font-family: STIXGeneral-Italic;\">t<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.816em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>t</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-27\">t</script> is a term,</li>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-28-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>d</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-217\" style=\"width: 0.732em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.576em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.58em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-218\"><span class=\"mi\" id=\"MathJax-Span-219\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>d</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-28\">d</script> is a document,</li>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-29-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>N</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-220\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-221\"><span class=\"mi\" id=\"MathJax-Span-222\" style=\"font-family: STIXGeneral-Italic;\">N<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>N</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-29\">N</script> is the total number of documents,</li>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-30-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>DF</mtext><mo stretchy=&quot;false&quot;>(</mo><mi>t</mi><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-223\" style=\"width: 2.711em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.242em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1002.19em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-224\"><span class=\"mtext\" id=\"MathJax-Span-225\" style=\"font-family: STIXGeneral-Regular;\">DF</span><span class=\"mo\" id=\"MathJax-Span-226\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-227\" style=\"font-family: STIXGeneral-Italic;\">t<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-228\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mtext>DF</mtext><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-30\">\\text{DF}(t)</script> is the number of documents containing <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-31-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>t</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-229\" style=\"width: 0.315em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.263em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.513em, 1000.26em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-230\"><span class=\"mi\" id=\"MathJax-Span-231\" style=\"font-family: STIXGeneral-Italic;\">t<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.816em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>t</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-31\">t</script>.</li>\n        </ul>\n      </li>\n    </ul>\n<p>where:</p>\n<ul>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-27-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>t</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-214\" style=\"width: 0.315em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.263em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.513em, 1000.26em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-215\"><span class=\"mi\" id=\"MathJax-Span-216\" style=\"font-family: STIXGeneral-Italic;\">t<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.816em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>t</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-27\">t</script> is a term,</li>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-28-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>d</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-217\" style=\"width: 0.732em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.576em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.58em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-218\"><span class=\"mi\" id=\"MathJax-Span-219\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>d</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-28\">d</script> is a document,</li>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-29-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>N</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-220\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-221\"><span class=\"mi\" id=\"MathJax-Span-222\" style=\"font-family: STIXGeneral-Italic;\">N<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>N</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-29\">N</script> is the total number of documents,</li>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-30-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>DF</mtext><mo stretchy=&quot;false&quot;>(</mo><mi>t</mi><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-223\" style=\"width: 2.711em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.242em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1002.19em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-224\"><span class=\"mtext\" id=\"MathJax-Span-225\" style=\"font-family: STIXGeneral-Regular;\">DF</span><span class=\"mo\" id=\"MathJax-Span-226\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-227\" style=\"font-family: STIXGeneral-Italic;\">t<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-228\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mtext>DF</mtext><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-30\">\\text{DF}(t)</script> is the number of documents containing <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-31-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>t</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-229\" style=\"width: 0.315em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.263em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.513em, 1000.26em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-230\"><span class=\"mi\" id=\"MathJax-Span-231\" style=\"font-family: STIXGeneral-Italic;\">t<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.816em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>t</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-31\">t</script>.</li>\n        </ul>\n<h5 id=\"strengths-of-tf-idf\">Strengths of TF-IDF</h5>\n<ul>\n  <li>Simple and fast to compute.</li>\n  <li>Strong baseline for keyword-heavy queries.</li>\n  <li>Fully interpretable scoring.</li>\n  <li>Requires no training data.</li>\n</ul>\n<h5 id=\"limitations-of-tf-idf\">Limitations of TF-IDF</h5>\n<ul>\n  <li>\n    <p>These limitations motivated more refined probabilistic ranking functions.</p>\n\n    <ul>\n      <li>Linear growth of TF causes term repetition to dominate scores.</li>\n      <li>No document length normalization.</li>\n      <li>Treats all term positions equally.</li>\n      <li>Performs poorly on long documents and verbose queries.</li>\n      <li>Fails completely on synonymy and paraphrasing.</li>\n    </ul>\n  </li>\n</ul>\n<p>These limitations motivated more refined probabilistic ranking functions.</p>\n<ul>\n      <li>Linear growth of TF causes term repetition to dominate scores.</li>\n      <li>No document length normalization.</li>\n      <li>Treats all term positions equally.</li>\n      <li>Performs poorly on long documents and verbose queries.</li>\n      <li>Fails completely on synonymy and paraphrasing.</li>\n    </ul>\n<h5 id=\"bm25-best-matching-25\">BM25 (Best Matching 25)</h5>\n<ul>\n  <li>\n    <p>BM25 is a probabilistic retrieval model that improves upon TF-IDF by addressing its key weaknesses. It introduces two critical refinements:</p>\n\n    <ol>\n      <li>\n        <p><strong>Term frequency saturation</strong>: Additional occurrences of a term provide diminishing returns rather than linear gains.</p>\n      </li>\n      <li>\n        <p><strong>Document length normalization</strong>: Longer documents are normalized to prevent unfair advantage due to sheer volume of text.</p>\n      </li>\n    </ol>\n  </li>\n  <li>\n    <p>A common BM25 formulation is:</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-32-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>BM25</mtext><mo stretchy=&quot;false&quot;>(</mo><mi>q</mi><mo>,</mo><mi>d</mi><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><munder><mo>&amp;#x2211;</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>t</mi><mo>&amp;#x2208;</mo><mi>q</mi></mrow></munder><mtext>IDF</mtext><mo stretchy=&quot;false&quot;>(</mo><mi>t</mi><mo stretchy=&quot;false&quot;>)</mo><mo>&amp;#x22C5;</mo><mfrac><mrow><mi>f</mi><mo stretchy=&quot;false&quot;>(</mo><mi>t</mi><mo>,</mo><mi>d</mi><mo stretchy=&quot;false&quot;>)</mo><mo>&amp;#x22C5;</mo><mo stretchy=&quot;false&quot;>(</mo><msub><mi>k</mi><mn>1</mn></msub><mo>+</mo><mn>1</mn><mo stretchy=&quot;false&quot;>)</mo></mrow><mrow><mi>f</mi><mo stretchy=&quot;false&quot;>(</mo><mi>t</mi><mo>,</mo><mi>d</mi><mo stretchy=&quot;false&quot;>)</mo><mo>+</mo><msub><mi>k</mi><mn>1</mn></msub><mo>&amp;#x22C5;</mo><mrow><mo>(</mo><mrow><mn>1</mn><mo>&amp;#x2212;</mo><mi>b</mi><mo>+</mo><mi>b</mi><mo>&amp;#x22C5;</mo><mfrac><mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow></mrow><mtext>avgdl</mtext></mfrac></mrow><mo>)</mo></mrow></mrow></mfrac></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-232\" style=\"width: 29.326em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 24.43em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.732em, 1024.43em, 4.221em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-233\"><span class=\"mtext\" id=\"MathJax-Span-234\" style=\"font-family: STIXGeneral-Regular;\">BM25</span><span class=\"mo\" id=\"MathJax-Span-235\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-236\" style=\"font-family: STIXGeneral-Italic;\">q</span><span class=\"mo\" id=\"MathJax-Span-237\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mi\" id=\"MathJax-Span-238\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.211em;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-239\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-240\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"munderover\" id=\"MathJax-Span-241\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 1.305em; height: 0px;\"><span style=\"position: absolute; clip: rect(2.867em, 1001.2em, 4.638em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mo\" id=\"MathJax-Span-242\" style=\"font-family: STIXSizeOneSym; vertical-align: -0.518em;\">∑</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.492em, 1001.04em, 4.43em, -999.997em); top: -2.862em; left: 0.107em;\"><span class=\"texatom\" id=\"MathJax-Span-243\"><span class=\"mrow\" id=\"MathJax-Span-244\"><span class=\"mi\" id=\"MathJax-Span-245\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">t<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-246\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">∈</span><span class=\"mi\" id=\"MathJax-Span-247\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">q</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mtext\" id=\"MathJax-Span-248\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">IDF</span><span class=\"mo\" id=\"MathJax-Span-249\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-250\" style=\"font-family: STIXGeneral-Italic;\">t<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-251\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-252\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"mfrac\" id=\"MathJax-Span-253\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 13.232em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1006.41em, 4.378em, -999.997em); top: -4.685em; left: 50%; margin-left: -3.227em;\"><span class=\"mrow\" id=\"MathJax-Span-254\"><span class=\"mi\" id=\"MathJax-Span-255\" style=\"font-family: STIXGeneral-Italic;\">f<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.159em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-256\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-257\" style=\"font-family: STIXGeneral-Italic;\">t<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-258\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mi\" id=\"MathJax-Span-259\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.211em;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-260\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-261\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"mo\" id=\"MathJax-Span-262\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">(</span><span class=\"msubsup\" id=\"MathJax-Span-263\"><span style=\"display: inline-block; position: relative; width: 0.888em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-264\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"mn\" id=\"MathJax-Span-265\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-266\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mn\" id=\"MathJax-Span-267\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">1</span><span class=\"mo\" id=\"MathJax-Span-268\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(2.659em, 1013.02em, 4.846em, -999.997em); top: -2.862em; left: 50%; margin-left: -6.56em;\"><span class=\"mrow\" id=\"MathJax-Span-269\"><span class=\"mi\" id=\"MathJax-Span-270\" style=\"font-family: STIXGeneral-Italic;\">f<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.159em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-271\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-272\" style=\"font-family: STIXGeneral-Italic;\">t<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-273\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mi\" id=\"MathJax-Span-274\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.211em;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-275\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-276\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"msubsup\" id=\"MathJax-Span-277\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 0.888em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-278\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"mn\" id=\"MathJax-Span-279\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-280\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"mrow\" id=\"MathJax-Span-281\" style=\"padding-left: 0.263em;\"><span class=\"mo\" id=\"MathJax-Span-282\" style=\"vertical-align: -0.414em;\"><span style=\"font-family: STIXSizeTwoSym;\">(</span></span><span class=\"mrow\" id=\"MathJax-Span-283\"><span class=\"mn\" id=\"MathJax-Span-284\" style=\"font-family: STIXGeneral-Regular;\">1</span><span class=\"mo\" id=\"MathJax-Span-285\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">−</span><span class=\"mi\" id=\"MathJax-Span-286\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.263em;\">b</span><span class=\"mo\" id=\"MathJax-Span-287\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mi\" id=\"MathJax-Span-288\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.263em;\">b</span><span class=\"mo\" id=\"MathJax-Span-289\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"mfrac\" id=\"MathJax-Span-290\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 1.669em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.388em, 1000.73em, 4.326em, -999.997em); top: -4.529em; left: 50%; margin-left: -0.414em;\"><span class=\"mrow\" id=\"MathJax-Span-291\"><span class=\"texatom\" id=\"MathJax-Span-292\"><span class=\"mrow\" id=\"MathJax-Span-293\"><span class=\"mo\" id=\"MathJax-Span-294\" style=\"font-size: 70.7%; font-family: STIXVariants;\">|</span></span></span><span class=\"mi\" id=\"MathJax-Span-295\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"texatom\" id=\"MathJax-Span-296\"><span class=\"mrow\" id=\"MathJax-Span-297\"><span class=\"mo\" id=\"MathJax-Span-298\" style=\"font-size: 70.7%; font-family: STIXVariants;\">|</span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1001.57em, 4.326em, -999.997em); top: -3.643em; left: 50%; margin-left: -0.779em;\"><span class=\"mtext\" id=\"MathJax-Span-299\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">avgdl</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1001.67em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.669em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-300\" style=\"vertical-align: -0.414em;\"><span style=\"font-family: STIXSizeTwoSym;\">)</span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1013.23em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 13.232em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -2.247em; border-left: 0px solid; width: 0px; height: 3.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>BM25</mtext><mo stretchy=\"false\">(</mo><mi>q</mi><mo>,</mo><mi>d</mi><mo stretchy=\"false\">)</mo><mo>=</mo><munder><mo>∑</mo><mrow class=\"MJX-TeXAtom-ORD\"><mi>t</mi><mo>∈</mo><mi>q</mi></mrow></munder><mtext>IDF</mtext><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo><mo>⋅</mo><mfrac><mrow><mi>f</mi><mo stretchy=\"false\">(</mo><mi>t</mi><mo>,</mo><mi>d</mi><mo stretchy=\"false\">)</mo><mo>⋅</mo><mo stretchy=\"false\">(</mo><msub><mi>k</mi><mn>1</mn></msub><mo>+</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow><mrow><mi>f</mi><mo stretchy=\"false\">(</mo><mi>t</mi><mo>,</mo><mi>d</mi><mo stretchy=\"false\">)</mo><mo>+</mo><msub><mi>k</mi><mn>1</mn></msub><mo>⋅</mo><mrow><mo>(</mo><mrow><mn>1</mn><mo>−</mo><mi>b</mi><mo>+</mo><mi>b</mi><mo>⋅</mo><mfrac><mrow><mrow class=\"MJX-TeXAtom-ORD\"><mo stretchy=\"false\">|</mo></mrow><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mo stretchy=\"false\">|</mo></mrow></mrow><mtext>avgdl</mtext></mfrac></mrow><mo>)</mo></mrow></mrow></mfrac></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-32\">\\text{BM25}(q, d) =\n\\sum_{t \\in q}\n\\text{IDF}(t) \\cdot\n\\frac{f(t,d) \\cdot (k_1 + 1)}\n{f(t,d) + k_1 \\cdot \\left(1 - b + b \\cdot \\frac{|d|}{\\text{avgdl}}\\right)}</script>\n\n    <ul>\n      <li>\n        <p>where:</p>\n\n        <ul>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-33-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>f</mi><mo stretchy=&quot;false&quot;>(</mo><mi>t</mi><mo>,</mo><mi>d</mi><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-301\" style=\"width: 2.971em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.451em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1002.4em, 2.555em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-302\"><span class=\"mi\" id=\"MathJax-Span-303\" style=\"font-family: STIXGeneral-Italic;\">f<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.159em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-304\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-305\" style=\"font-family: STIXGeneral-Italic;\">t<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-306\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mi\" id=\"MathJax-Span-307\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.211em;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-308\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>f</mi><mo stretchy=\"false\">(</mo><mi>t</mi><mo>,</mo><mi>d</mi><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-33\">f(t,d)</script> is the frequency of term <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-34-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>t</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-309\" style=\"width: 0.315em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.263em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.513em, 1000.26em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-310\"><span class=\"mi\" id=\"MathJax-Span-311\" style=\"font-family: STIXGeneral-Italic;\">t<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.816em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>t</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-34\">t</script> in document <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-35-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>d</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-312\" style=\"width: 0.732em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.576em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.58em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-313\"><span class=\"mi\" id=\"MathJax-Span-314\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>d</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-35\">d</script>,</li>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-36-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>&amp;#x2223;</mo><mi>d</mi><mo stretchy=&quot;false&quot;>&amp;#x2223;</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-315\" style=\"width: 1.253em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.044em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1000.94em, 2.607em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-316\"><span class=\"mo\" id=\"MathJax-Span-317\" style=\"font-family: STIXGeneral-Regular;\">∣</span><span class=\"mi\" id=\"MathJax-Span-318\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-319\" style=\"font-family: STIXGeneral-Regular;\">∣</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mo stretchy=\"false\">∣</mo><mi>d</mi><mo stretchy=\"false\">∣</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-36\">\\mid d \\mid</script> is the document length,</li>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-37-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>avgdl</mtext></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-320\" style=\"width: 2.711em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.242em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1002.24em, 2.555em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-321\"><span class=\"mtext\" id=\"MathJax-Span-322\" style=\"font-family: STIXGeneral-Regular;\">avgdl</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mtext>avgdl</mtext></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-37\">\\text{avgdl}</script> is the average document length,</li>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-38-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>k</mi><mn>1</mn></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-323\" style=\"width: 1.096em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.888em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1000.89em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-324\"><span class=\"msubsup\" id=\"MathJax-Span-325\"><span style=\"display: inline-block; position: relative; width: 0.888em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-326\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"mn\" id=\"MathJax-Span-327\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>k</mi><mn>1</mn></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-38\">k_1</script> controls TF saturation (typically <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-39-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>1.2</mn><mo>&amp;#x2264;</mo><msub><mi>k</mi><mn>1</mn></msub><mo>&amp;#x2264;</mo><mn>2.0</mn></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-328\" style=\"width: 6.878em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 5.732em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1005.73em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-329\"><span class=\"mn\" id=\"MathJax-Span-330\" style=\"font-family: STIXGeneral-Regular;\">1.2</span><span class=\"mo\" id=\"MathJax-Span-331\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">≤</span><span class=\"msubsup\" id=\"MathJax-Span-332\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 0.888em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-333\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"mn\" id=\"MathJax-Span-334\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-335\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">≤</span><span class=\"mn\" id=\"MathJax-Span-336\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">2.0</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mn>1.2</mn><mo>≤</mo><msub><mi>k</mi><mn>1</mn></msub><mo>≤</mo><mn>2.0</mn></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-39\">1.2 \\le k_1 \\le 2.0</script>),</li>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-40-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>b</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-337\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.47em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-338\"><span class=\"mi\" id=\"MathJax-Span-339\" style=\"font-family: STIXGeneral-Italic;\">b</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>b</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-40\">b</script> controls length normalization (typically <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-41-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>b</mi><mo>&amp;#x2248;</mo><mn>0.75</mn></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-340\" style=\"width: 4.169em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 3.44em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1003.39em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-341\"><span class=\"mi\" id=\"MathJax-Span-342\" style=\"font-family: STIXGeneral-Italic;\">b</span><span class=\"mo\" id=\"MathJax-Span-343\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">≈</span><span class=\"mn\" id=\"MathJax-Span-344\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">0.75</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>b</mi><mo>≈</mo><mn>0.75</mn></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-41\">b \\approx 0.75</script>).</li>\n        </ul>\n      </li>\n    </ul>\n  </li>\n</ul>\n<p>BM25 is a probabilistic retrieval model that improves upon TF-IDF by addressing its key weaknesses. It introduces two critical refinements:</p>\n<ol>\n      <li>\n        <p><strong>Term frequency saturation</strong>: Additional occurrences of a term provide diminishing returns rather than linear gains.</p>\n      </li>\n      <li>\n        <p><strong>Document length normalization</strong>: Longer documents are normalized to prevent unfair advantage due to sheer volume of text.</p>\n      </li>\n    </ol>\n<p><strong>Term frequency saturation</strong>: Additional occurrences of a term provide diminishing returns rather than linear gains.</p>\n<p><strong>Document length normalization</strong>: Longer documents are normalized to prevent unfair advantage due to sheer volume of text.</p>\n<p>A common BM25 formulation is:</p>\n<ul>\n      <li>\n        <p>where:</p>\n\n        <ul>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-33-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>f</mi><mo stretchy=&quot;false&quot;>(</mo><mi>t</mi><mo>,</mo><mi>d</mi><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-301\" style=\"width: 2.971em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.451em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1002.4em, 2.555em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-302\"><span class=\"mi\" id=\"MathJax-Span-303\" style=\"font-family: STIXGeneral-Italic;\">f<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.159em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-304\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-305\" style=\"font-family: STIXGeneral-Italic;\">t<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-306\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mi\" id=\"MathJax-Span-307\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.211em;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-308\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>f</mi><mo stretchy=\"false\">(</mo><mi>t</mi><mo>,</mo><mi>d</mi><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-33\">f(t,d)</script> is the frequency of term <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-34-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>t</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-309\" style=\"width: 0.315em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.263em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.513em, 1000.26em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-310\"><span class=\"mi\" id=\"MathJax-Span-311\" style=\"font-family: STIXGeneral-Italic;\">t<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.816em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>t</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-34\">t</script> in document <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-35-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>d</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-312\" style=\"width: 0.732em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.576em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.58em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-313\"><span class=\"mi\" id=\"MathJax-Span-314\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>d</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-35\">d</script>,</li>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-36-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>&amp;#x2223;</mo><mi>d</mi><mo stretchy=&quot;false&quot;>&amp;#x2223;</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-315\" style=\"width: 1.253em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.044em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1000.94em, 2.607em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-316\"><span class=\"mo\" id=\"MathJax-Span-317\" style=\"font-family: STIXGeneral-Regular;\">∣</span><span class=\"mi\" id=\"MathJax-Span-318\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-319\" style=\"font-family: STIXGeneral-Regular;\">∣</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mo stretchy=\"false\">∣</mo><mi>d</mi><mo stretchy=\"false\">∣</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-36\">\\mid d \\mid</script> is the document length,</li>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-37-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>avgdl</mtext></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-320\" style=\"width: 2.711em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.242em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1002.24em, 2.555em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-321\"><span class=\"mtext\" id=\"MathJax-Span-322\" style=\"font-family: STIXGeneral-Regular;\">avgdl</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mtext>avgdl</mtext></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-37\">\\text{avgdl}</script> is the average document length,</li>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-38-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>k</mi><mn>1</mn></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-323\" style=\"width: 1.096em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.888em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1000.89em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-324\"><span class=\"msubsup\" id=\"MathJax-Span-325\"><span style=\"display: inline-block; position: relative; width: 0.888em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-326\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"mn\" id=\"MathJax-Span-327\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>k</mi><mn>1</mn></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-38\">k_1</script> controls TF saturation (typically <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-39-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>1.2</mn><mo>&amp;#x2264;</mo><msub><mi>k</mi><mn>1</mn></msub><mo>&amp;#x2264;</mo><mn>2.0</mn></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-328\" style=\"width: 6.878em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 5.732em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1005.73em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-329\"><span class=\"mn\" id=\"MathJax-Span-330\" style=\"font-family: STIXGeneral-Regular;\">1.2</span><span class=\"mo\" id=\"MathJax-Span-331\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">≤</span><span class=\"msubsup\" id=\"MathJax-Span-332\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 0.888em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-333\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"mn\" id=\"MathJax-Span-334\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-335\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">≤</span><span class=\"mn\" id=\"MathJax-Span-336\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">2.0</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mn>1.2</mn><mo>≤</mo><msub><mi>k</mi><mn>1</mn></msub><mo>≤</mo><mn>2.0</mn></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-39\">1.2 \\le k_1 \\le 2.0</script>),</li>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-40-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>b</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-337\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.47em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-338\"><span class=\"mi\" id=\"MathJax-Span-339\" style=\"font-family: STIXGeneral-Italic;\">b</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>b</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-40\">b</script> controls length normalization (typically <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-41-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>b</mi><mo>&amp;#x2248;</mo><mn>0.75</mn></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-340\" style=\"width: 4.169em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 3.44em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1003.39em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-341\"><span class=\"mi\" id=\"MathJax-Span-342\" style=\"font-family: STIXGeneral-Italic;\">b</span><span class=\"mo\" id=\"MathJax-Span-343\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">≈</span><span class=\"mn\" id=\"MathJax-Span-344\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">0.75</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>b</mi><mo>≈</mo><mn>0.75</mn></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-41\">b \\approx 0.75</script>).</li>\n        </ul>\n      </li>\n    </ul>\n<p>where:</p>\n<ul>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-33-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>f</mi><mo stretchy=&quot;false&quot;>(</mo><mi>t</mi><mo>,</mo><mi>d</mi><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-301\" style=\"width: 2.971em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.451em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1002.4em, 2.555em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-302\"><span class=\"mi\" id=\"MathJax-Span-303\" style=\"font-family: STIXGeneral-Italic;\">f<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.159em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-304\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-305\" style=\"font-family: STIXGeneral-Italic;\">t<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-306\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mi\" id=\"MathJax-Span-307\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.211em;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-308\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>f</mi><mo stretchy=\"false\">(</mo><mi>t</mi><mo>,</mo><mi>d</mi><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-33\">f(t,d)</script> is the frequency of term <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-34-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>t</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-309\" style=\"width: 0.315em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.263em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.513em, 1000.26em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-310\"><span class=\"mi\" id=\"MathJax-Span-311\" style=\"font-family: STIXGeneral-Italic;\">t<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.816em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>t</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-34\">t</script> in document <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-35-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>d</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-312\" style=\"width: 0.732em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.576em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.58em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-313\"><span class=\"mi\" id=\"MathJax-Span-314\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>d</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-35\">d</script>,</li>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-36-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>&amp;#x2223;</mo><mi>d</mi><mo stretchy=&quot;false&quot;>&amp;#x2223;</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-315\" style=\"width: 1.253em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.044em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1000.94em, 2.607em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-316\"><span class=\"mo\" id=\"MathJax-Span-317\" style=\"font-family: STIXGeneral-Regular;\">∣</span><span class=\"mi\" id=\"MathJax-Span-318\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-319\" style=\"font-family: STIXGeneral-Regular;\">∣</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mo stretchy=\"false\">∣</mo><mi>d</mi><mo stretchy=\"false\">∣</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-36\">\\mid d \\mid</script> is the document length,</li>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-37-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>avgdl</mtext></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-320\" style=\"width: 2.711em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.242em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1002.24em, 2.555em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-321\"><span class=\"mtext\" id=\"MathJax-Span-322\" style=\"font-family: STIXGeneral-Regular;\">avgdl</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mtext>avgdl</mtext></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-37\">\\text{avgdl}</script> is the average document length,</li>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-38-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>k</mi><mn>1</mn></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-323\" style=\"width: 1.096em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.888em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1000.89em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-324\"><span class=\"msubsup\" id=\"MathJax-Span-325\"><span style=\"display: inline-block; position: relative; width: 0.888em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-326\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"mn\" id=\"MathJax-Span-327\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>k</mi><mn>1</mn></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-38\">k_1</script> controls TF saturation (typically <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-39-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>1.2</mn><mo>&amp;#x2264;</mo><msub><mi>k</mi><mn>1</mn></msub><mo>&amp;#x2264;</mo><mn>2.0</mn></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-328\" style=\"width: 6.878em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 5.732em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1005.73em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-329\"><span class=\"mn\" id=\"MathJax-Span-330\" style=\"font-family: STIXGeneral-Regular;\">1.2</span><span class=\"mo\" id=\"MathJax-Span-331\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">≤</span><span class=\"msubsup\" id=\"MathJax-Span-332\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 0.888em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-333\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"mn\" id=\"MathJax-Span-334\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-335\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">≤</span><span class=\"mn\" id=\"MathJax-Span-336\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">2.0</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mn>1.2</mn><mo>≤</mo><msub><mi>k</mi><mn>1</mn></msub><mo>≤</mo><mn>2.0</mn></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-39\">1.2 \\le k_1 \\le 2.0</script>),</li>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-40-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>b</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-337\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.47em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-338\"><span class=\"mi\" id=\"MathJax-Span-339\" style=\"font-family: STIXGeneral-Italic;\">b</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>b</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-40\">b</script> controls length normalization (typically <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-41-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>b</mi><mo>&amp;#x2248;</mo><mn>0.75</mn></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-340\" style=\"width: 4.169em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 3.44em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1003.39em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-341\"><span class=\"mi\" id=\"MathJax-Span-342\" style=\"font-family: STIXGeneral-Italic;\">b</span><span class=\"mo\" id=\"MathJax-Span-343\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">≈</span><span class=\"mn\" id=\"MathJax-Span-344\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">0.75</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>b</mi><mo>≈</mo><mn>0.75</mn></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-41\">b \\approx 0.75</script>).</li>\n        </ul>\n<h5 id=\"why-bm25-outperforms-tf-idf\">Why BM25 Outperforms TF-IDF</h5>\n<ul>\n  <li>\n    <p>BM25 remains the default lexical ranking function in most production search engines. It outperforms TF-IDF along the following dimensions:</p>\n\n    <ul>\n      <li>Prevents term stuffing from dominating rankings.</li>\n      <li>Fairly compares short and long documents.</li>\n      <li>More stable across heterogeneous corpora.</li>\n      <li>Empirically strong across many domains without tuning.</li>\n    </ul>\n  </li>\n</ul>\n<p>BM25 remains the default lexical ranking function in most production search engines. It outperforms TF-IDF along the following dimensions:</p>\n<ul>\n      <li>Prevents term stuffing from dominating rankings.</li>\n      <li>Fairly compares short and long documents.</li>\n      <li>More stable across heterogeneous corpora.</li>\n      <li>Empirically strong across many domains without tuning.</li>\n    </ul>\n<h5 id=\"operational-characteristics-of-lexical-retrieval\">Operational Characteristics of Lexical Retrieval</h5>\n<ul>\n  <li>\n    <p><strong>Performance and scalability</strong>:</p>\n\n    <ul>\n      <li>Sub-millisecond scoring per document.</li>\n      <li>Efficient inverted index structures.</li>\n      <li>Scales to billions of documents.</li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Determinism</strong>:</p>\n\n    <ul>\n      <li>Identical inputs always produce identical rankings.</li>\n      <li>No stochastic components or model drift.</li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Explainability</strong>:</p>\n\n    <ul>\n      <li>Rankings can be justified via term overlap and weights.</li>\n      <li>Essential for regulated or high-stakes systems.</li>\n    </ul>\n  </li>\n</ul>\n<p><strong>Performance and scalability</strong>:</p>\n<ul>\n      <li>Sub-millisecond scoring per document.</li>\n      <li>Efficient inverted index structures.</li>\n      <li>Scales to billions of documents.</li>\n    </ul>\n<p><strong>Determinism</strong>:</p>\n<ul>\n      <li>Identical inputs always produce identical rankings.</li>\n      <li>No stochastic components or model drift.</li>\n    </ul>\n<p><strong>Explainability</strong>:</p>\n<ul>\n      <li>Rankings can be justified via term overlap and weights.</li>\n      <li>Essential for regulated or high-stakes systems.</li>\n    </ul>\n<h5 id=\"advantages-of-lexical-retrieval\">Advantages of Lexical Retrieval</h5>\n<ul>\n  <li>Extremely fast and resource-efficient.</li>\n  <li>Robust to rare, technical, or newly introduced terms.</li>\n  <li>Guarantees recall for exact matches.</li>\n  <li>Transparent scoring behavior.</li>\n  <li>Works exceptionally well for:\n    <ul>\n      <li>Identifiers (product IDs, SKUs, error codes, etc.)</li>\n      <li>Entity names (proper nouns, etc.)</li>\n      <li>Dates (timestamps, ranges, etc.)</li>\n      <li>Abbreviations (e.g., API, HTTP, JWT, etc.)</li>\n      <li>Domain-specific jargon (e.g., medicine names, chemical compounds, etc.)</li>\n      <li>Legal clauses (e.g., “Section 3.2.1”, etc.) and citations (e.g., “17 U.S.C. § 512”, etc.)</li>\n      <li>Short or underspecified queries</li>\n    </ul>\n  </li>\n</ul>\n<ul>\n      <li>Identifiers (product IDs, SKUs, error codes, etc.)</li>\n      <li>Entity names (proper nouns, etc.)</li>\n      <li>Dates (timestamps, ranges, etc.)</li>\n      <li>Abbreviations (e.g., API, HTTP, JWT, etc.)</li>\n      <li>Domain-specific jargon (e.g., medicine names, chemical compounds, etc.)</li>\n      <li>Legal clauses (e.g., “Section 3.2.1”, etc.) and citations (e.g., “17 U.S.C. § 512”, etc.)</li>\n      <li>Short or underspecified queries</li>\n    </ul>\n<h5 id=\"limitations-of-lexical-retrieval\">Limitations of Lexical Retrieval</h5>\n<ul>\n  <li>Lexical retrieval limitations are structural, not implementation flaws, and they are the primary reason semantic and hybrid retrieval methods emerged:\n    <ul>\n      <li>No understanding of meaning or intent.</li>\n      <li>Cannot match synonyms or paraphrases.</li>\n      <li>Sensitive to vocabulary mismatch.</li>\n      <li>Brittle for natural language questions.</li>\n      <li>Poor recall for descriptive or conversational queries.</li>\n    </ul>\n  </li>\n</ul>\n<ul>\n      <li>No understanding of meaning or intent.</li>\n      <li>Cannot match synonyms or paraphrases.</li>\n      <li>Sensitive to vocabulary mismatch.</li>\n      <li>Brittle for natural language questions.</li>\n      <li>Poor recall for descriptive or conversational queries.</li>\n    </ul>\n<h4 id=\"semantic-retrieval\">Semantic Retrieval</h4>\n<ul>\n  <li>\n    <p>Semantic retrieval, also commonly referred to as dense retrieval, neural retrieval, or embedding-based retrieval, is a modern approach to information retrieval that attempts to model the meaning and intent behind queries and documents rather than relying on exact lexical overlap.</p>\n  </li>\n  <li>\n    <p>Instead of treating text as discrete symbols, semantic retrieval represents text as continuous vectors in a high-dimensional space. Relevance is determined by geometric proximity in this space, under the assumption that semantically similar texts lie close to each other.</p>\n  </li>\n</ul>\n<p>Semantic retrieval, also commonly referred to as dense retrieval, neural retrieval, or embedding-based retrieval, is a modern approach to information retrieval that attempts to model the meaning and intent behind queries and documents rather than relying on exact lexical overlap.</p>\n<p>Instead of treating text as discrete symbols, semantic retrieval represents text as continuous vectors in a high-dimensional space. Relevance is determined by geometric proximity in this space, under the assumption that semantically similar texts lie close to each other.</p>\n<h5 id=\"core-idea\">Core Idea</h5>\n<ul>\n  <li>\n    <p>Semantic retrieval reframes search as a similarity problem in vector space:</p>\n\n    <ul>\n      <li>Queries and documents are encoded into dense vectors.</li>\n      <li>Similarity between vectors approximates semantic relatedness.</li>\n      <li>Retrieval becomes a nearest-neighbor search problem.</li>\n    </ul>\n  </li>\n  <li>\n    <p>A common similarity measure is cosine similarity:</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-42-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>cosine_sim</mtext><mo stretchy=&quot;false&quot;>(</mo><mi>q</mi><mo>,</mo><mi>d</mi><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mfrac><mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mover><mi>q</mi><mo stretchy=&quot;false&quot;>&amp;#x2192;</mo></mover></mrow><mo>&amp;#x22C5;</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mover><mi>d</mi><mo stretchy=&quot;false&quot;>&amp;#x2192;</mo></mover></mrow></mrow><mrow><mo stretchy=&quot;false&quot;>&amp;#x2223;</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mover><mi>q</mi><mo stretchy=&quot;false&quot;>&amp;#x2192;</mo></mover></mrow><mo>&amp;#x2223;&amp;#x2223;</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mover><mi>d</mi><mo stretchy=&quot;false&quot;>&amp;#x2192;</mo></mover></mrow><mo stretchy=&quot;false&quot;>&amp;#x2223;</mo></mrow></mfrac></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-345\" style=\"width: 13.128em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 10.94em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.315em, 1010.94em, 3.544em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-346\"><span class=\"mtext\" id=\"MathJax-Span-347\" style=\"font-family: STIXGeneral-Regular;\">cosine_sim</span><span class=\"mo\" id=\"MathJax-Span-348\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-349\" style=\"font-family: STIXGeneral-Italic;\">q</span><span class=\"mo\" id=\"MathJax-Span-350\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mi\" id=\"MathJax-Span-351\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.211em;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-352\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-353\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-354\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 2.867em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(2.815em, 1001.83em, 4.378em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.935em;\"><span class=\"mrow\" id=\"MathJax-Span-355\"><span class=\"texatom\" id=\"MathJax-Span-356\"><span class=\"mrow\" id=\"MathJax-Span-357\"><span class=\"munderover\" id=\"MathJax-Span-358\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.378em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-359\" style=\"font-family: STIXGeneral-Italic;\">q</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.008em; left: 0.055em;\"><span style=\"height: 0em; vertical-align: 0em; width: 0.471em; display: inline-block; overflow: hidden;\"></span><span class=\"mo\" id=\"MathJax-Span-360\" style=\"font-family: STIXGeneral-Regular;\">⃗&nbsp;<span style=\"height: 0em; vertical-align: 0em; margin-left: -0.258em;\"></span></span><span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0em;\"></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-361\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"texatom\" id=\"MathJax-Span-362\" style=\"padding-left: 0.263em;\"><span class=\"mrow\" id=\"MathJax-Span-363\"><span class=\"munderover\" id=\"MathJax-Span-364\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-365\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.268em; left: 0.107em;\"><span style=\"height: 0em; vertical-align: 0em; width: 0.471em; display: inline-block; overflow: hidden;\"></span><span class=\"mo\" id=\"MathJax-Span-366\" style=\"font-family: STIXGeneral-Regular;\">⃗&nbsp;<span style=\"height: 0em; vertical-align: 0em; margin-left: -0.258em;\"></span></span><span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0em;\"></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(2.815em, 1002.61em, 4.378em, -999.997em); top: -3.018em; left: 50%; margin-left: -1.352em;\"><span class=\"mrow\" id=\"MathJax-Span-367\"><span class=\"mo\" id=\"MathJax-Span-368\" style=\"font-family: STIXGeneral-Regular;\">∣</span><span class=\"texatom\" id=\"MathJax-Span-369\"><span class=\"mrow\" id=\"MathJax-Span-370\"><span class=\"munderover\" id=\"MathJax-Span-371\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.378em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-372\" style=\"font-family: STIXGeneral-Italic;\">q</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.008em; left: 0.055em;\"><span style=\"height: 0em; vertical-align: 0em; width: 0.471em; display: inline-block; overflow: hidden;\"></span><span class=\"mo\" id=\"MathJax-Span-373\" style=\"font-family: STIXGeneral-Regular;\">⃗&nbsp;<span style=\"height: 0em; vertical-align: 0em; margin-left: -0.258em;\"></span></span><span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0em;\"></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-374\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">∣<span style=\"font-family: STIXGeneral-Regular; font-style: normal; font-weight: normal;\">∣</span></span><span class=\"texatom\" id=\"MathJax-Span-375\" style=\"padding-left: 0.315em;\"><span class=\"mrow\" id=\"MathJax-Span-376\"><span class=\"munderover\" id=\"MathJax-Span-377\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-378\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.268em; left: 0.107em;\"><span style=\"height: 0em; vertical-align: 0em; width: 0.471em; display: inline-block; overflow: hidden;\"></span><span class=\"mo\" id=\"MathJax-Span-379\" style=\"font-family: STIXGeneral-Regular;\">⃗&nbsp;<span style=\"height: 0em; vertical-align: 0em; margin-left: -0.258em;\"></span></span><span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0em;\"></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-380\" style=\"font-family: STIXGeneral-Regular;\">∣</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1002.87em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.867em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -1.497em; border-left: 0px solid; width: 0px; height: 3.628em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>cosine_sim</mtext><mo stretchy=\"false\">(</mo><mi>q</mi><mo>,</mo><mi>d</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><mrow><mrow class=\"MJX-TeXAtom-ORD\"><mover><mi>q</mi><mo stretchy=\"false\">→</mo></mover></mrow><mo>⋅</mo><mrow class=\"MJX-TeXAtom-ORD\"><mover><mi>d</mi><mo stretchy=\"false\">→</mo></mover></mrow></mrow><mrow><mo stretchy=\"false\">∣</mo><mrow class=\"MJX-TeXAtom-ORD\"><mover><mi>q</mi><mo stretchy=\"false\">→</mo></mover></mrow><mo>∣∣</mo><mrow class=\"MJX-TeXAtom-ORD\"><mover><mi>d</mi><mo stretchy=\"false\">→</mo></mover></mrow><mo stretchy=\"false\">∣</mo></mrow></mfrac></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-42\">\\text{cosine_sim}(q, d) =\n\\frac{\\vec{q} \\cdot \\vec{d}}\n{\\mid\\vec{q}\\mid \\mid\\vec{d}\\mid}</script>\n\n    <ul>\n      <li>\n        <p>where:</p>\n\n        <ul>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-43-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mover><mi>q</mi><mo stretchy=&quot;false&quot;>&amp;#x2192;</mo></mover></mrow></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-381\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.201em, 1000.52em, 2.503em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-382\"><span class=\"texatom\" id=\"MathJax-Span-383\"><span class=\"mrow\" id=\"MathJax-Span-384\"><span class=\"munderover\" id=\"MathJax-Span-385\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.378em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-386\" style=\"font-family: STIXGeneral-Italic;\">q</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.008em; left: 0.055em;\"><span style=\"height: 0em; vertical-align: 0em; width: 0.471em; display: inline-block; overflow: hidden;\"></span><span class=\"mo\" id=\"MathJax-Span-387\" style=\"font-family: STIXGeneral-Regular;\">⃗&nbsp;<span style=\"height: 0em; vertical-align: 0em; margin-left: -0.258em;\"></span></span><span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0em;\"></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.316em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mrow class=\"MJX-TeXAtom-ORD\"><mover><mi>q</mi><mo stretchy=\"false\">→</mo></mover></mrow></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-43\">\\vec{q}</script> is the query embedding,</li>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-44-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mover><mi>d</mi><mo stretchy=&quot;false&quot;>&amp;#x2192;</mo></mover></mrow></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-388\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.94em, 1000.52em, 2.294em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-389\"><span class=\"texatom\" id=\"MathJax-Span-390\"><span class=\"mrow\" id=\"MathJax-Span-391\"><span class=\"munderover\" id=\"MathJax-Span-392\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-393\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.268em; left: 0.107em;\"><span style=\"height: 0em; vertical-align: 0em; width: 0.471em; display: inline-block; overflow: hidden;\"></span><span class=\"mo\" id=\"MathJax-Span-394\" style=\"font-family: STIXGeneral-Regular;\">⃗&nbsp;<span style=\"height: 0em; vertical-align: 0em; margin-left: -0.258em;\"></span></span><span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0em;\"></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.378em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mrow class=\"MJX-TeXAtom-ORD\"><mover><mi>d</mi><mo stretchy=\"false\">→</mo></mover></mrow></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-44\">\\vec{d}</script> is the document embedding.</li>\n        </ul>\n      </li>\n    </ul>\n  </li>\n</ul>\n<p>Semantic retrieval reframes search as a similarity problem in vector space:</p>\n<ul>\n      <li>Queries and documents are encoded into dense vectors.</li>\n      <li>Similarity between vectors approximates semantic relatedness.</li>\n      <li>Retrieval becomes a nearest-neighbor search problem.</li>\n    </ul>\n<p>A common similarity measure is cosine similarity:</p>\n<ul>\n      <li>\n        <p>where:</p>\n\n        <ul>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-43-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mover><mi>q</mi><mo stretchy=&quot;false&quot;>&amp;#x2192;</mo></mover></mrow></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-381\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.201em, 1000.52em, 2.503em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-382\"><span class=\"texatom\" id=\"MathJax-Span-383\"><span class=\"mrow\" id=\"MathJax-Span-384\"><span class=\"munderover\" id=\"MathJax-Span-385\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.378em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-386\" style=\"font-family: STIXGeneral-Italic;\">q</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.008em; left: 0.055em;\"><span style=\"height: 0em; vertical-align: 0em; width: 0.471em; display: inline-block; overflow: hidden;\"></span><span class=\"mo\" id=\"MathJax-Span-387\" style=\"font-family: STIXGeneral-Regular;\">⃗&nbsp;<span style=\"height: 0em; vertical-align: 0em; margin-left: -0.258em;\"></span></span><span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0em;\"></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.316em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mrow class=\"MJX-TeXAtom-ORD\"><mover><mi>q</mi><mo stretchy=\"false\">→</mo></mover></mrow></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-43\">\\vec{q}</script> is the query embedding,</li>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-44-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mover><mi>d</mi><mo stretchy=&quot;false&quot;>&amp;#x2192;</mo></mover></mrow></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-388\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.94em, 1000.52em, 2.294em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-389\"><span class=\"texatom\" id=\"MathJax-Span-390\"><span class=\"mrow\" id=\"MathJax-Span-391\"><span class=\"munderover\" id=\"MathJax-Span-392\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-393\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.268em; left: 0.107em;\"><span style=\"height: 0em; vertical-align: 0em; width: 0.471em; display: inline-block; overflow: hidden;\"></span><span class=\"mo\" id=\"MathJax-Span-394\" style=\"font-family: STIXGeneral-Regular;\">⃗&nbsp;<span style=\"height: 0em; vertical-align: 0em; margin-left: -0.258em;\"></span></span><span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0em;\"></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.378em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mrow class=\"MJX-TeXAtom-ORD\"><mover><mi>d</mi><mo stretchy=\"false\">→</mo></mover></mrow></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-44\">\\vec{d}</script> is the document embedding.</li>\n        </ul>\n      </li>\n    </ul>\n<p>where:</p>\n<ul>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-43-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mover><mi>q</mi><mo stretchy=&quot;false&quot;>&amp;#x2192;</mo></mover></mrow></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-381\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.201em, 1000.52em, 2.503em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-382\"><span class=\"texatom\" id=\"MathJax-Span-383\"><span class=\"mrow\" id=\"MathJax-Span-384\"><span class=\"munderover\" id=\"MathJax-Span-385\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.378em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-386\" style=\"font-family: STIXGeneral-Italic;\">q</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.008em; left: 0.055em;\"><span style=\"height: 0em; vertical-align: 0em; width: 0.471em; display: inline-block; overflow: hidden;\"></span><span class=\"mo\" id=\"MathJax-Span-387\" style=\"font-family: STIXGeneral-Regular;\">⃗&nbsp;<span style=\"height: 0em; vertical-align: 0em; margin-left: -0.258em;\"></span></span><span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0em;\"></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.316em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mrow class=\"MJX-TeXAtom-ORD\"><mover><mi>q</mi><mo stretchy=\"false\">→</mo></mover></mrow></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-43\">\\vec{q}</script> is the query embedding,</li>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-44-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mover><mi>d</mi><mo stretchy=&quot;false&quot;>&amp;#x2192;</mo></mover></mrow></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-388\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.94em, 1000.52em, 2.294em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-389\"><span class=\"texatom\" id=\"MathJax-Span-390\"><span class=\"mrow\" id=\"MathJax-Span-391\"><span class=\"munderover\" id=\"MathJax-Span-392\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-393\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.268em; left: 0.107em;\"><span style=\"height: 0em; vertical-align: 0em; width: 0.471em; display: inline-block; overflow: hidden;\"></span><span class=\"mo\" id=\"MathJax-Span-394\" style=\"font-family: STIXGeneral-Regular;\">⃗&nbsp;<span style=\"height: 0em; vertical-align: 0em; margin-left: -0.258em;\"></span></span><span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0em;\"></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.378em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mrow class=\"MJX-TeXAtom-ORD\"><mover><mi>d</mi><mo stretchy=\"false\">→</mo></mover></mrow></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-44\">\\vec{d}</script> is the document embedding.</li>\n        </ul>\n<h5 id=\"vector-encoding\">Vector Encoding</h5>\n<ul>\n  <li><strong>Encoder models</strong>:\n    <ul>\n      <li>\n        <p>Queries and documents are passed through neural encoders, typically based on transformer architectures. Common encoder types include:</p>\n\n        <ul>\n          <li>Dual encoders (bi-encoders)</li>\n          <li><a href=\"http://sbert.net/\">Sentence transformers</a></li>\n          <li>Domain-specific fine-tuned encoders</li>\n        </ul>\n      </li>\n      <li>\n        <p>In most production systems, queries and documents are encoded independently to allow precomputation of document embeddings.</p>\n      </li>\n    </ul>\n  </li>\n  <li><strong>Training signal</strong>:\n    <ul>\n      <li>\n        <p>Encoders are trained using contrastive objectives that:</p>\n\n        <ul>\n          <li>Pull relevant query–document pairs closer</li>\n          <li>Push irrelevant pairs farther apart</li>\n        </ul>\n      </li>\n      <li>\n        <p>A simplified contrastive loss can be expressed as:</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-45-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;>L</mi></mrow><mo>=</mo><mo>&amp;#x2212;</mo><mi>log</mi><mo>&amp;#x2061;</mo><mfrac><mrow><mi>exp</mi><mo>&amp;#x2061;</mo><mo stretchy=&quot;false&quot;>(</mo><mtext>sim</mtext><mo stretchy=&quot;false&quot;>(</mo><mi>q</mi><mo>,</mo><msup><mi>d</mi><mo>+</mo></msup><mo stretchy=&quot;false&quot;>)</mo><mo stretchy=&quot;false&quot;>)</mo></mrow><mrow><mi>exp</mi><mo>&amp;#x2061;</mo><mo stretchy=&quot;false&quot;>(</mo><mtext>sim</mtext><mo stretchy=&quot;false&quot;>(</mo><mi>q</mi><mo>,</mo><msup><mi>d</mi><mo>+</mo></msup><mo stretchy=&quot;false&quot;>)</mo><mo stretchy=&quot;false&quot;>)</mo><mo>+</mo><munder><mo>&amp;#x2211;</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msup><mi>d</mi><mo>&amp;#x2212;</mo></msup></mrow></munder><mi>exp</mi><mo>&amp;#x2061;</mo><mo stretchy=&quot;false&quot;>(</mo><mtext>sim</mtext><mo stretchy=&quot;false&quot;>(</mo><mi>q</mi><mo>,</mo><msup><mi>d</mi><mo>&amp;#x2212;</mo></msup><mo stretchy=&quot;false&quot;>)</mo><mo stretchy=&quot;false&quot;>)</mo></mrow></mfrac></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-395\" style=\"width: 24.482em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 20.367em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.576em, 1020.37em, 3.388em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-396\"><span class=\"texatom\" id=\"MathJax-Span-397\"><span class=\"mrow\" id=\"MathJax-Span-398\"><span class=\"mi\" id=\"MathJax-Span-399\" style=\"font-family: STIXNonUnicode-Italic;\"></span></span></span><span class=\"mo\" id=\"MathJax-Span-400\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mo\" id=\"MathJax-Span-401\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">−</span><span class=\"mi\" id=\"MathJax-Span-402\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">log</span><span class=\"mo\" id=\"MathJax-Span-403\"></span><span class=\"mfrac\" id=\"MathJax-Span-404\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 15.992em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.128em, 1006.3em, 4.378em, -999.997em); top: -4.685em; left: 50%; margin-left: -3.174em;\"><span class=\"mrow\" id=\"MathJax-Span-405\"><span class=\"mi\" id=\"MathJax-Span-406\" style=\"font-family: STIXGeneral-Regular;\">exp</span><span class=\"mo\" id=\"MathJax-Span-407\"></span><span class=\"mo\" id=\"MathJax-Span-408\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mtext\" id=\"MathJax-Span-409\" style=\"font-family: STIXGeneral-Regular;\">sim</span><span class=\"mo\" id=\"MathJax-Span-410\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-411\" style=\"font-family: STIXGeneral-Italic;\">q</span><span class=\"mo\" id=\"MathJax-Span-412\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-413\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-414\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.372em; left: 0.576em;\"><span class=\"mo\" id=\"MathJax-Span-415\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">+</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-416\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-417\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.076em, 1015.84em, 4.482em, -999.997em); top: -3.279em; left: 50%; margin-left: -7.966em;\"><span class=\"mrow\" id=\"MathJax-Span-418\"><span class=\"mi\" id=\"MathJax-Span-419\" style=\"font-family: STIXGeneral-Regular;\">exp</span><span class=\"mo\" id=\"MathJax-Span-420\"></span><span class=\"mo\" id=\"MathJax-Span-421\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mtext\" id=\"MathJax-Span-422\" style=\"font-family: STIXGeneral-Regular;\">sim</span><span class=\"mo\" id=\"MathJax-Span-423\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-424\" style=\"font-family: STIXGeneral-Italic;\">q</span><span class=\"mo\" id=\"MathJax-Span-425\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-426\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-427\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.32em; left: 0.576em;\"><span class=\"mo\" id=\"MathJax-Span-428\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">+</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-429\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-430\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-431\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"munderover\" id=\"MathJax-Span-432\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 1.826em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.076em, 1000.84em, 4.43em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mo\" id=\"MathJax-Span-433\" style=\"font-family: STIXGeneral-Regular; vertical-align: 0.003em;\">∑</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.695em; left: 0.94em;\"><span class=\"texatom\" id=\"MathJax-Span-434\"><span class=\"mrow\" id=\"MathJax-Span-435\"><span class=\"msubsup\" id=\"MathJax-Span-436\"><span style=\"display: inline-block; position: relative; width: 0.836em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.388em, 1000.37em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-437\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.32em; left: 0.419em;\"><span class=\"mo\" id=\"MathJax-Span-438\" style=\"font-size: 50%; font-family: STIXGeneral-Regular;\">−</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mi\" id=\"MathJax-Span-439\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">exp</span><span class=\"mo\" id=\"MathJax-Span-440\"></span><span class=\"mo\" id=\"MathJax-Span-441\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mtext\" id=\"MathJax-Span-442\" style=\"font-family: STIXGeneral-Regular;\">sim</span><span class=\"mo\" id=\"MathJax-Span-443\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-444\" style=\"font-family: STIXGeneral-Italic;\">q</span><span class=\"mo\" id=\"MathJax-Span-445\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-446\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-447\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.32em; left: 0.576em;\"><span class=\"mo\" id=\"MathJax-Span-448\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">−</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-449\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-450\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1015.99em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 15.992em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -1.309em; border-left: 0px solid; width: 0px; height: 3.066em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mrow class=\"MJX-TeXAtom-ORD\"><mi class=\"MJX-tex-caligraphic\" mathvariant=\"script\">L</mi></mrow><mo>=</mo><mo>−</mo><mi>log</mi><mo>⁡</mo><mfrac><mrow><mi>exp</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><mtext>sim</mtext><mo stretchy=\"false\">(</mo><mi>q</mi><mo>,</mo><msup><mi>d</mi><mo>+</mo></msup><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">)</mo></mrow><mrow><mi>exp</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><mtext>sim</mtext><mo stretchy=\"false\">(</mo><mi>q</mi><mo>,</mo><msup><mi>d</mi><mo>+</mo></msup><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">)</mo><mo>+</mo><munder><mo>∑</mo><mrow class=\"MJX-TeXAtom-ORD\"><msup><mi>d</mi><mo>−</mo></msup></mrow></munder><mi>exp</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><mtext>sim</mtext><mo stretchy=\"false\">(</mo><mi>q</mi><mo>,</mo><msup><mi>d</mi><mo>−</mo></msup><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">)</mo></mrow></mfrac></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-45\">\\mathcal{L} = -\\log\\frac{\\exp(\\text{sim}(q, d^+))}{\\exp(\\text{sim}(q, d^+)) + \\sum_{d^-} \\exp(\\text{sim}(q, d^-))}</script>\n\n        <ul>\n          <li>where <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-46-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msup><mi>d</mi><mo>+</mo></msup></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-451\" style=\"width: 1.409em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.253em, 1001.15em, 2.294em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-452\"><span class=\"msubsup\" id=\"MathJax-Span-453\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-454\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.372em; left: 0.576em;\"><span class=\"mo\" id=\"MathJax-Span-455\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">+</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.066em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msup><mi>d</mi><mo>+</mo></msup></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-46\">d^+</script> is a relevant document and <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-47-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msup><mi>d</mi><mo>&amp;#x2212;</mo></msup></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-456\" style=\"width: 1.409em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.253em, 1001.15em, 2.294em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-457\"><span class=\"msubsup\" id=\"MathJax-Span-458\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-459\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.372em; left: 0.576em;\"><span class=\"mo\" id=\"MathJax-Span-460\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">−</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.066em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msup><mi>d</mi><mo>−</mo></msup></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-47\">d^-</script> are negatives.</li>\n        </ul>\n      </li>\n    </ul>\n  </li>\n  <li><strong>Representation properties</strong>:\n    <ul>\n      <li>\n        <p>Good semantic embeddings capture:</p>\n\n        <ul>\n          <li>Synonymy and paraphrasing</li>\n          <li>Conceptual similarity</li>\n          <li>Contextual meaning</li>\n          <li>Cross-lingual alignment (in multilingual models)</li>\n        </ul>\n      </li>\n    </ul>\n  </li>\n</ul>\n<ul>\n      <li>\n        <p>Queries and documents are passed through neural encoders, typically based on transformer architectures. Common encoder types include:</p>\n\n        <ul>\n          <li>Dual encoders (bi-encoders)</li>\n          <li><a href=\"http://sbert.net/\">Sentence transformers</a></li>\n          <li>Domain-specific fine-tuned encoders</li>\n        </ul>\n      </li>\n      <li>\n        <p>In most production systems, queries and documents are encoded independently to allow precomputation of document embeddings.</p>\n      </li>\n    </ul>\n<p>Queries and documents are passed through neural encoders, typically based on transformer architectures. Common encoder types include:</p>\n<ul>\n          <li>Dual encoders (bi-encoders)</li>\n          <li><a href=\"http://sbert.net/\">Sentence transformers</a></li>\n          <li>Domain-specific fine-tuned encoders</li>\n        </ul>\n<p>In most production systems, queries and documents are encoded independently to allow precomputation of document embeddings.</p>\n<ul>\n      <li>\n        <p>Encoders are trained using contrastive objectives that:</p>\n\n        <ul>\n          <li>Pull relevant query–document pairs closer</li>\n          <li>Push irrelevant pairs farther apart</li>\n        </ul>\n      </li>\n      <li>\n        <p>A simplified contrastive loss can be expressed as:</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-45-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;>L</mi></mrow><mo>=</mo><mo>&amp;#x2212;</mo><mi>log</mi><mo>&amp;#x2061;</mo><mfrac><mrow><mi>exp</mi><mo>&amp;#x2061;</mo><mo stretchy=&quot;false&quot;>(</mo><mtext>sim</mtext><mo stretchy=&quot;false&quot;>(</mo><mi>q</mi><mo>,</mo><msup><mi>d</mi><mo>+</mo></msup><mo stretchy=&quot;false&quot;>)</mo><mo stretchy=&quot;false&quot;>)</mo></mrow><mrow><mi>exp</mi><mo>&amp;#x2061;</mo><mo stretchy=&quot;false&quot;>(</mo><mtext>sim</mtext><mo stretchy=&quot;false&quot;>(</mo><mi>q</mi><mo>,</mo><msup><mi>d</mi><mo>+</mo></msup><mo stretchy=&quot;false&quot;>)</mo><mo stretchy=&quot;false&quot;>)</mo><mo>+</mo><munder><mo>&amp;#x2211;</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msup><mi>d</mi><mo>&amp;#x2212;</mo></msup></mrow></munder><mi>exp</mi><mo>&amp;#x2061;</mo><mo stretchy=&quot;false&quot;>(</mo><mtext>sim</mtext><mo stretchy=&quot;false&quot;>(</mo><mi>q</mi><mo>,</mo><msup><mi>d</mi><mo>&amp;#x2212;</mo></msup><mo stretchy=&quot;false&quot;>)</mo><mo stretchy=&quot;false&quot;>)</mo></mrow></mfrac></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-395\" style=\"width: 24.482em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 20.367em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.576em, 1020.37em, 3.388em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-396\"><span class=\"texatom\" id=\"MathJax-Span-397\"><span class=\"mrow\" id=\"MathJax-Span-398\"><span class=\"mi\" id=\"MathJax-Span-399\" style=\"font-family: STIXNonUnicode-Italic;\"></span></span></span><span class=\"mo\" id=\"MathJax-Span-400\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mo\" id=\"MathJax-Span-401\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">−</span><span class=\"mi\" id=\"MathJax-Span-402\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">log</span><span class=\"mo\" id=\"MathJax-Span-403\"></span><span class=\"mfrac\" id=\"MathJax-Span-404\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 15.992em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.128em, 1006.3em, 4.378em, -999.997em); top: -4.685em; left: 50%; margin-left: -3.174em;\"><span class=\"mrow\" id=\"MathJax-Span-405\"><span class=\"mi\" id=\"MathJax-Span-406\" style=\"font-family: STIXGeneral-Regular;\">exp</span><span class=\"mo\" id=\"MathJax-Span-407\"></span><span class=\"mo\" id=\"MathJax-Span-408\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mtext\" id=\"MathJax-Span-409\" style=\"font-family: STIXGeneral-Regular;\">sim</span><span class=\"mo\" id=\"MathJax-Span-410\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-411\" style=\"font-family: STIXGeneral-Italic;\">q</span><span class=\"mo\" id=\"MathJax-Span-412\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-413\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-414\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.372em; left: 0.576em;\"><span class=\"mo\" id=\"MathJax-Span-415\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">+</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-416\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-417\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.076em, 1015.84em, 4.482em, -999.997em); top: -3.279em; left: 50%; margin-left: -7.966em;\"><span class=\"mrow\" id=\"MathJax-Span-418\"><span class=\"mi\" id=\"MathJax-Span-419\" style=\"font-family: STIXGeneral-Regular;\">exp</span><span class=\"mo\" id=\"MathJax-Span-420\"></span><span class=\"mo\" id=\"MathJax-Span-421\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mtext\" id=\"MathJax-Span-422\" style=\"font-family: STIXGeneral-Regular;\">sim</span><span class=\"mo\" id=\"MathJax-Span-423\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-424\" style=\"font-family: STIXGeneral-Italic;\">q</span><span class=\"mo\" id=\"MathJax-Span-425\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-426\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-427\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.32em; left: 0.576em;\"><span class=\"mo\" id=\"MathJax-Span-428\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">+</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-429\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-430\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-431\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"munderover\" id=\"MathJax-Span-432\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 1.826em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.076em, 1000.84em, 4.43em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mo\" id=\"MathJax-Span-433\" style=\"font-family: STIXGeneral-Regular; vertical-align: 0.003em;\">∑</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.695em; left: 0.94em;\"><span class=\"texatom\" id=\"MathJax-Span-434\"><span class=\"mrow\" id=\"MathJax-Span-435\"><span class=\"msubsup\" id=\"MathJax-Span-436\"><span style=\"display: inline-block; position: relative; width: 0.836em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.388em, 1000.37em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-437\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.32em; left: 0.419em;\"><span class=\"mo\" id=\"MathJax-Span-438\" style=\"font-size: 50%; font-family: STIXGeneral-Regular;\">−</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mi\" id=\"MathJax-Span-439\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">exp</span><span class=\"mo\" id=\"MathJax-Span-440\"></span><span class=\"mo\" id=\"MathJax-Span-441\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mtext\" id=\"MathJax-Span-442\" style=\"font-family: STIXGeneral-Regular;\">sim</span><span class=\"mo\" id=\"MathJax-Span-443\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-444\" style=\"font-family: STIXGeneral-Italic;\">q</span><span class=\"mo\" id=\"MathJax-Span-445\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-446\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-447\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.32em; left: 0.576em;\"><span class=\"mo\" id=\"MathJax-Span-448\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">−</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-449\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-450\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1015.99em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 15.992em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -1.309em; border-left: 0px solid; width: 0px; height: 3.066em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mrow class=\"MJX-TeXAtom-ORD\"><mi class=\"MJX-tex-caligraphic\" mathvariant=\"script\">L</mi></mrow><mo>=</mo><mo>−</mo><mi>log</mi><mo>⁡</mo><mfrac><mrow><mi>exp</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><mtext>sim</mtext><mo stretchy=\"false\">(</mo><mi>q</mi><mo>,</mo><msup><mi>d</mi><mo>+</mo></msup><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">)</mo></mrow><mrow><mi>exp</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><mtext>sim</mtext><mo stretchy=\"false\">(</mo><mi>q</mi><mo>,</mo><msup><mi>d</mi><mo>+</mo></msup><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">)</mo><mo>+</mo><munder><mo>∑</mo><mrow class=\"MJX-TeXAtom-ORD\"><msup><mi>d</mi><mo>−</mo></msup></mrow></munder><mi>exp</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><mtext>sim</mtext><mo stretchy=\"false\">(</mo><mi>q</mi><mo>,</mo><msup><mi>d</mi><mo>−</mo></msup><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">)</mo></mrow></mfrac></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-45\">\\mathcal{L} = -\\log\\frac{\\exp(\\text{sim}(q, d^+))}{\\exp(\\text{sim}(q, d^+)) + \\sum_{d^-} \\exp(\\text{sim}(q, d^-))}</script>\n\n        <ul>\n          <li>where <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-46-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msup><mi>d</mi><mo>+</mo></msup></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-451\" style=\"width: 1.409em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.253em, 1001.15em, 2.294em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-452\"><span class=\"msubsup\" id=\"MathJax-Span-453\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-454\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.372em; left: 0.576em;\"><span class=\"mo\" id=\"MathJax-Span-455\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">+</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.066em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msup><mi>d</mi><mo>+</mo></msup></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-46\">d^+</script> is a relevant document and <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-47-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msup><mi>d</mi><mo>&amp;#x2212;</mo></msup></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-456\" style=\"width: 1.409em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.253em, 1001.15em, 2.294em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-457\"><span class=\"msubsup\" id=\"MathJax-Span-458\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-459\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.372em; left: 0.576em;\"><span class=\"mo\" id=\"MathJax-Span-460\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">−</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.066em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msup><mi>d</mi><mo>−</mo></msup></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-47\">d^-</script> are negatives.</li>\n        </ul>\n      </li>\n    </ul>\n<p>Encoders are trained using contrastive objectives that:</p>\n<ul>\n          <li>Pull relevant query–document pairs closer</li>\n          <li>Push irrelevant pairs farther apart</li>\n        </ul>\n<p>A simplified contrastive loss can be expressed as:</p>\n<ul>\n          <li>where <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-46-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msup><mi>d</mi><mo>+</mo></msup></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-451\" style=\"width: 1.409em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.253em, 1001.15em, 2.294em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-452\"><span class=\"msubsup\" id=\"MathJax-Span-453\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-454\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.372em; left: 0.576em;\"><span class=\"mo\" id=\"MathJax-Span-455\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">+</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.066em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msup><mi>d</mi><mo>+</mo></msup></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-46\">d^+</script> is a relevant document and <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-47-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msup><mi>d</mi><mo>&amp;#x2212;</mo></msup></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-456\" style=\"width: 1.409em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.253em, 1001.15em, 2.294em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-457\"><span class=\"msubsup\" id=\"MathJax-Span-458\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-459\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.372em; left: 0.576em;\"><span class=\"mo\" id=\"MathJax-Span-460\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">−</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.066em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msup><mi>d</mi><mo>−</mo></msup></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-47\">d^-</script> are negatives.</li>\n        </ul>\n<ul>\n      <li>\n        <p>Good semantic embeddings capture:</p>\n\n        <ul>\n          <li>Synonymy and paraphrasing</li>\n          <li>Conceptual similarity</li>\n          <li>Contextual meaning</li>\n          <li>Cross-lingual alignment (in multilingual models)</li>\n        </ul>\n      </li>\n    </ul>\n<p>Good semantic embeddings capture:</p>\n<ul>\n          <li>Synonymy and paraphrasing</li>\n          <li>Conceptual similarity</li>\n          <li>Contextual meaning</li>\n          <li>Cross-lingual alignment (in multilingual models)</li>\n        </ul>\n<h5 id=\"semantic-matching-and-retrieval\">Semantic Matching and Retrieval</h5>\n<ul>\n  <li>\n    <p>Once embeddings are computed:</p>\n\n    <ul>\n      <li>Documents are indexed in a vector index.</li>\n      <li>At query time, the query embedding is generated.</li>\n      <li>Approximate nearest neighbor search retrieves the top <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-48-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-461\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-462\"><span class=\"mi\" id=\"MathJax-Span-463\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-48\">K</script> closest document vectors.</li>\n    </ul>\n  </li>\n  <li>\n    <p>This enables matches even when there is zero keyword overlap between query and document.</p>\n  </li>\n</ul>\n<p>Once embeddings are computed:</p>\n<ul>\n      <li>Documents are indexed in a vector index.</li>\n      <li>At query time, the query embedding is generated.</li>\n      <li>Approximate nearest neighbor search retrieves the top <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-48-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-461\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-462\"><span class=\"mi\" id=\"MathJax-Span-463\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-48\">K</script> closest document vectors.</li>\n    </ul>\n<p>This enables matches even when there is zero keyword overlap between query and document.</p>\n<h5 id=\"approaches\">Approaches</h5>\n<ul>\n  <li>Let’s look at three different types of retrieval: standard, sentence window, and auto-merging. Each of these approaches has specific strengths and weaknesses, and their suitability depends on the requirements of the RAG task, including the nature of the dataset, the complexity of the queries, and the desired balance between specificity and contextual understanding in the responses.</li>\n</ul>\n<h6 id=\"standardnaive-approach\">Standard/Naive Approach</h6>\n<ul>\n  <li>As we see in the image below <a href=\"https://learn.deeplearning.ai/building-evaluating-advanced-rag/lesson/2/advanced-rag-pipeline\">(source)</a>, the standard pipeline uses the same text chunk for indexing/embedding as well as the output synthesis.</li>\n</ul>\n<p><img src=\"/primers/ai/assets/RAG/9.png\" alt=\"\"></p>\n<ul>\n  <li>\n    <p>In the context of RAG, the advantages and disadvantages of the three approaches are as follows:</p>\n  </li>\n  <li>\n    <p><strong>Advantages</strong>:</p>\n\n    <ul>\n      <li><strong>Simplicity and Efficiency</strong>: This method is straightforward and efficient, using the same text chunk for both embedding and synthesis, simplifying the retrieval process.</li>\n      <li><strong>Uniformity in Data Handling</strong>: It maintains consistency in the data used across both retrieval and synthesis phases.</li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Disadvantages</strong>:</p>\n\n    <ul>\n      <li><strong>Limited Contextual Understanding</strong>: LLMs may require a larger window for synthesis to generate better responses, which this approach may not adequately provide.</li>\n      <li><strong>Potential for Suboptimal Responses</strong>: Due to the limited context, the LLM might not have enough information to generate the most relevant and accurate responses.</li>\n    </ul>\n  </li>\n</ul>\n<p>In the context of RAG, the advantages and disadvantages of the three approaches are as follows:</p>\n<p><strong>Advantages</strong>:</p>\n<ul>\n      <li><strong>Simplicity and Efficiency</strong>: This method is straightforward and efficient, using the same text chunk for both embedding and synthesis, simplifying the retrieval process.</li>\n      <li><strong>Uniformity in Data Handling</strong>: It maintains consistency in the data used across both retrieval and synthesis phases.</li>\n    </ul>\n<p><strong>Disadvantages</strong>:</p>\n<ul>\n      <li><strong>Limited Contextual Understanding</strong>: LLMs may require a larger window for synthesis to generate better responses, which this approach may not adequately provide.</li>\n      <li><strong>Potential for Suboptimal Responses</strong>: Due to the limited context, the LLM might not have enough information to generate the most relevant and accurate responses.</li>\n    </ul>\n<h6 id=\"sentence-window-retrieval--small-to-large-retrieval\">Sentence-Window Retrieval / Small-to-Large Retrieval</h6>\n<ul>\n  <li>The sentence-window approach breaks down documents into smaller units, such as sentences or small groups of sentences.</li>\n  <li>It decouples the embeddings for retrieval tasks (which are smaller chunks stored in a Vector DB), but for synthesis it adds back in the context around the retrieved chunks, as seen in the image below <a href=\"https://learn.deeplearning.ai/building-evaluating-advanced-rag/lesson/2/advanced-rag-pipeline\">(source)</a>.</li>\n</ul>\n<p><img src=\"/primers/ai/assets/RAG/10.png\" alt=\"\"></p>\n<ul>\n  <li>During retrieval, we retrieve the sentences that are most relevant to the query via similarity search and replace the sentence with the full surrounding context (using a static sentence-window around the context, implemented by retrieving sentences surrounding the one being originally retrieved) as shown in the figure below <a href=\"https://learn.deeplearning.ai/building-evaluating-advanced-rag/lesson/2/advanced-rag-pipeline\">(source)</a>.</li>\n</ul>\n<p><img src=\"/primers/ai/assets/RAG/11.png\" alt=\"\"></p>\n<ul>\n  <li>\n    <p><strong>Advantages</strong>:</p>\n\n    <ul>\n      <li><strong>Enhanced Specificity in Retrieval</strong>: By breaking documents into smaller units, it enables more precise retrieval of segments directly relevant to a query.</li>\n      <li><strong>Context-Rich Synthesis</strong>: It reintroduces context around the retrieved chunks for synthesis, providing the LLM with a broader understanding to formulate responses.</li>\n      <li><strong>Balanced Approach</strong>: This method strikes a balance between focused retrieval and contextual richness, potentially improving response quality.</li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Disadvantages</strong>:</p>\n\n    <ul>\n      <li><strong>Increased Complexity</strong>: Managing separate processes for retrieval and synthesis adds complexity to the pipeline.</li>\n      <li><strong>Potential Contextual Gaps</strong>: There’s a risk of missing broader context if the surrounding information added back is not sufficiently comprehensive.</li>\n    </ul>\n  </li>\n</ul>\n<p><strong>Advantages</strong>:</p>\n<ul>\n      <li><strong>Enhanced Specificity in Retrieval</strong>: By breaking documents into smaller units, it enables more precise retrieval of segments directly relevant to a query.</li>\n      <li><strong>Context-Rich Synthesis</strong>: It reintroduces context around the retrieved chunks for synthesis, providing the LLM with a broader understanding to formulate responses.</li>\n      <li><strong>Balanced Approach</strong>: This method strikes a balance between focused retrieval and contextual richness, potentially improving response quality.</li>\n    </ul>\n<p><strong>Disadvantages</strong>:</p>\n<ul>\n      <li><strong>Increased Complexity</strong>: Managing separate processes for retrieval and synthesis adds complexity to the pipeline.</li>\n      <li><strong>Potential Contextual Gaps</strong>: There’s a risk of missing broader context if the surrounding information added back is not sufficiently comprehensive.</li>\n    </ul>\n<h6 id=\"auto-merging-retriever--hierarchical-retriever\">Auto-merging Retriever / Hierarchical Retriever</h6>\n<ul>\n  <li>The image below <a href=\"https://learn.deeplearning.ai/building-evaluating-advanced-rag/lesson/2/advanced-rag-pipeline\">(source)</a>, illustrates how auto-merging retrieval can work where it doesn’t retrieve a bunch of fragmented chunks as would happen with the naive approach.</li>\n</ul>\n<p><img src=\"/primers/ai/assets/RAG/6.png\" alt=\"\"></p>\n<ul>\n  <li>The fragmentation in the naive approach would be worse with smaller chunk sizes as shown below <a href=\"https://learn.deeplearning.ai/building-evaluating-advanced-rag/lesson/2/advanced-rag-pipeline\">(source)</a>.</li>\n</ul>\n<p><img src=\"/primers/ai/assets/RAG/12.png\" alt=\"\"></p>\n<ul>\n  <li>Auto-merging retrieval aims to combine (or merge) information from multiple sources or segments of text to create a more comprehensive and contextually relevant response to a query. This approach is particularly useful when no single document or segment fully answers the query but rather the answer lies in combining information from multiple sources.</li>\n  <li>It allows smaller chunks to be merged into bigger parent chunks. It does this via the following steps:\n    <ol>\n      <li>Define a hierarchy of smaller chunks linked to parent chunks.</li>\n      <li>If the set of smaller chunks linking to a parent chunk exceeds some threshold (say, cosine similarity), then “merge” smaller chunks into the bigger parent chunk.</li>\n    </ol>\n  </li>\n  <li>\n    <p>The method will finally retrieve the parent chunk for better context.</p>\n  </li>\n  <li>\n    <p><strong>Advantages</strong>:</p>\n\n    <ul>\n      <li><strong>Comprehensive Contextual Responses</strong>: By merging information from multiple sources, it creates responses that are more comprehensive and contextually relevant.</li>\n      <li><strong>Reduced Fragmentation</strong>: This approach addresses the issue of fragmented information retrieval, common in the naive approach, especially with smaller chunk sizes.</li>\n      <li><strong>Dynamic Content Integration</strong>: It dynamically combines smaller chunks into larger, more informative ones, enhancing the richness of the information provided to the LLM.</li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Disadvantages</strong>:</p>\n\n    <ul>\n      <li><strong>Complexity in Hierarchy and Threshold Management</strong>: The process of defining hierarchies and setting appropriate thresholds for merging is complex and critical for effective functioning.</li>\n      <li><strong>Risk of Over-generalization</strong>: There’s a possibility of merging too much or irrelevant information, leading to responses that are too broad or off-topic.</li>\n      <li><strong>Computational Intensity</strong>: This method might be more computationally intensive due to the additional steps in merging and managing the hierarchical structure of text chunks.</li>\n    </ul>\n  </li>\n</ul>\n<ol>\n      <li>Define a hierarchy of smaller chunks linked to parent chunks.</li>\n      <li>If the set of smaller chunks linking to a parent chunk exceeds some threshold (say, cosine similarity), then “merge” smaller chunks into the bigger parent chunk.</li>\n    </ol>\n<p>The method will finally retrieve the parent chunk for better context.</p>\n<p><strong>Advantages</strong>:</p>\n<ul>\n      <li><strong>Comprehensive Contextual Responses</strong>: By merging information from multiple sources, it creates responses that are more comprehensive and contextually relevant.</li>\n      <li><strong>Reduced Fragmentation</strong>: This approach addresses the issue of fragmented information retrieval, common in the naive approach, especially with smaller chunk sizes.</li>\n      <li><strong>Dynamic Content Integration</strong>: It dynamically combines smaller chunks into larger, more informative ones, enhancing the richness of the information provided to the LLM.</li>\n    </ul>\n<p><strong>Disadvantages</strong>:</p>\n<ul>\n      <li><strong>Complexity in Hierarchy and Threshold Management</strong>: The process of defining hierarchies and setting appropriate thresholds for merging is complex and critical for effective functioning.</li>\n      <li><strong>Risk of Over-generalization</strong>: There’s a possibility of merging too much or irrelevant information, leading to responses that are too broad or off-topic.</li>\n      <li><strong>Computational Intensity</strong>: This method might be more computationally intensive due to the additional steps in merging and managing the hierarchical structure of text chunks.</li>\n    </ul>\n<h6 id=\"contextual-retrieval\">Contextual Retrieval</h6>\n<ul>\n  <li>For LLMs to deliver relevant and accurate responses, they must retrieve the right information from a knowledge base. Traditional RAG improves model accuracy by fetching relevant text chunks and appending them to the prompt. However, such methods often remove crucial context when encoding information, leading to failed retrievals and suboptimal outputs.</li>\n  <li>Contextual Retrieval, introduced by <a href=\"https://www.anthropic.com/news/contextual-retrieval\">Anthropic</a>, is an advanced technique designed to improve this process by ensuring that retrieved chunks maintain their original context. It employs contextual embeddings – embeddings that incorporate chunk-specific background information and contextual BM25 – an enhanced BM25 ranking that considers the broader document context.</li>\n  <li>\n    <p>By prepending contextual metadata to each document chunk before embedding, Contextual Retrieval significantly enhances search accuracy. This approach reduces failed retrievals by 49% and, when combined with re-ranking, by 67%.</p>\n  </li>\n  <li><strong>Why Context Matters in Retrieval</strong>:\n    <ul>\n      <li>Traditional RAG solutions divide documents into small chunks for efficient retrieval. However, these fragments often lose critical context. For example, the statement “The company’s revenue grew by 3% over the previous quarter” lacks information about which company or quarter it refers to. Contextual Retrieval solves this by embedding relevant metadata into each chunk.</li>\n    </ul>\n  </li>\n  <li><strong>Implementation of Contextual Retrieval</strong>:\n    <ul>\n      <li>To implement Contextual Retrieval, a model like Claude 3 Haiku can generate concise context for each chunk. This context is then prepended before embedding and indexing, ensuring more precise retrieval. Developers can automate this process at scale using specialized retrieval pipelines.</li>\n    </ul>\n  </li>\n  <li><strong>Prompt Used for Contextual Retrieval</strong>:\n    <ul>\n      <li>Anthropic’s method involves using Claude to generate a short, document-specific context for each chunk using the following prompt:\n        <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code6\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code6\">  &lt;document&gt;  \n          \n  &lt;/document&gt;  \n\n  Here is the chunk we want to situate within the whole document:  \n\n  &lt;chunk&gt;  \n          \n  &lt;/chunk&gt;  \n\n  Please give a short, succinct context to situate this chunk within the overall document for the purposes of improving search retrieval of the chunk. Answer only with the succinct context and nothing else.\n</code></pre></div>        </div>\n      </li>\n      <li>This process automatically generates a concise contextualized description that is prepended to the chunk before embedding and indexing.</li>\n    </ul>\n  </li>\n  <li><strong>Combining Contextual Retrieval with Re-ranking</strong>:\n    <ul>\n      <li>For maximum performance, Contextual Retrieval can be paired with re-ranking models, which filter and reorder retrieved chunks based on their relevance. This additional step enhances retrieval precision, ensuring only the most relevant chunks are passed to the LLM.</li>\n    </ul>\n  </li>\n  <li>The following flowchart from Anthropic’s <a href=\"https://www.anthropic.com/news/contextual-retrieval\">blog</a> shows the combined contextual retrieval and re-ranking stages which seek to maximize retrieval accuracy.</li>\n</ul>\n<p>By prepending contextual metadata to each document chunk before embedding, Contextual Retrieval significantly enhances search accuracy. This approach reduces failed retrievals by 49% and, when combined with re-ranking, by 67%.</p>\n<ul>\n      <li>Traditional RAG solutions divide documents into small chunks for efficient retrieval. However, these fragments often lose critical context. For example, the statement “The company’s revenue grew by 3% over the previous quarter” lacks information about which company or quarter it refers to. Contextual Retrieval solves this by embedding relevant metadata into each chunk.</li>\n    </ul>\n<ul>\n      <li>To implement Contextual Retrieval, a model like Claude 3 Haiku can generate concise context for each chunk. This context is then prepended before embedding and indexing, ensuring more precise retrieval. Developers can automate this process at scale using specialized retrieval pipelines.</li>\n    </ul>\n<ul>\n      <li>Anthropic’s method involves using Claude to generate a short, document-specific context for each chunk using the following prompt:\n        <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code6\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code6\">  &lt;document&gt;  \n          \n  &lt;/document&gt;  \n\n  Here is the chunk we want to situate within the whole document:  \n\n  &lt;chunk&gt;  \n          \n  &lt;/chunk&gt;  \n\n  Please give a short, succinct context to situate this chunk within the overall document for the purposes of improving search retrieval of the chunk. Answer only with the succinct context and nothing else.\n</code></pre></div>        </div>\n      </li>\n      <li>This process automatically generates a concise contextualized description that is prepended to the chunk before embedding and indexing.</li>\n    </ul>\n<pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code6\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code6\">  &lt;document&gt;  \n          \n  &lt;/document&gt;  \n\n  Here is the chunk we want to situate within the whole document:  \n\n  &lt;chunk&gt;  \n          \n  &lt;/chunk&gt;  \n\n  Please give a short, succinct context to situate this chunk within the overall document for the purposes of improving search retrieval of the chunk. Answer only with the succinct context and nothing else.\n</code></pre>\n<ul>\n      <li>For maximum performance, Contextual Retrieval can be paired with re-ranking models, which filter and reorder retrieved chunks based on their relevance. This additional step enhances retrieval precision, ensuring only the most relevant chunks are passed to the LLM.</li>\n    </ul>\n<p><img src=\"/primers/ai/assets/RAG/contextual-retrieval.jpg\" alt=\"\"></p>\n<ul>\n  <li><strong>Key Takeaways</strong>:\n    <ul>\n      <li>Contextual Embeddings improve retrieval accuracy by preserving document meaning.</li>\n      <li>BM25 + Contextualization enhances exact-match retrieval.</li>\n      <li>Combining Contextual Retrieval with re-ranking further boosts retrieval effectiveness.</li>\n      <li>Developers can implement Contextual Retrieval using prompt-based preprocessing and automated pipelines.</li>\n    </ul>\n  </li>\n  <li>With Contextual Retrieval, LLM-powered knowledge systems can achieve greater accuracy, scalability, and relevance, unlocking new levels of performance in real-world applications.</li>\n</ul>\n<ul>\n      <li>Contextual Embeddings improve retrieval accuracy by preserving document meaning.</li>\n      <li>BM25 + Contextualization enhances exact-match retrieval.</li>\n      <li>Combining Contextual Retrieval with re-ranking further boosts retrieval effectiveness.</li>\n      <li>Developers can implement Contextual Retrieval using prompt-based preprocessing and automated pipelines.</li>\n    </ul>\n<h5 id=\"using-approximate-nearest-neighbors-ann-for-retrieval\">Using Approximate Nearest Neighbors (ANN) for Retrieval</h5>\n<ul>\n  <li>\n    <p>The next step is to consider which Approximate Nearest Neighbors (ANN) algorithm and library to choose for <strong>large-scale vector similarity search in retrieval systems</strong>. ANN is preferred over exact nearest neighbor search because:</p>\n\n    <ul>\n      <li>Exact search scales linearly with corpus size and becomes prohibitively slow and expensive for large embedding collections.</li>\n      <li>ANN trades a small, controllable loss in recall for orders-of-magnitude improvements in latency and throughput.</li>\n      <li>Modern ANN methods are designed to meet strict production constraints (low latency, bounded memory, high QPS), which are critical for real-time RAG pipelines.</li>\n    </ul>\n  </li>\n  <li>A useful way to compare and select an appropriate ANN approach is to reference <strong><a href=\"https://ann-benchmarks.com/\">ANN-Benchmarks</a></strong>, which provides standardized evaluations of different algorithms across accuracy, latency, and resource trade-offs.</li>\n  <li>A detailed discourse on the concept of ANN can be found in our <a href=\"../ann-similarity-search\">ANN primer</a>.</li>\n</ul>\n<p>The next step is to consider which Approximate Nearest Neighbors (ANN) algorithm and library to choose for <strong>large-scale vector similarity search in retrieval systems</strong>. ANN is preferred over exact nearest neighbor search because:</p>\n<ul>\n      <li>Exact search scales linearly with corpus size and becomes prohibitively slow and expensive for large embedding collections.</li>\n      <li>ANN trades a small, controllable loss in recall for orders-of-magnitude improvements in latency and throughput.</li>\n      <li>Modern ANN methods are designed to meet strict production constraints (low latency, bounded memory, high QPS), which are critical for real-time RAG pipelines.</li>\n    </ul>\n<h5 id=\"advantages-of-semantic-retrieval\">Advantages of Semantic Retrieval</h5>\n<ul>\n  <li>Strong handling of paraphrases and synonyms.</li>\n  <li>Robust to vocabulary mismatch.</li>\n  <li>Supports natural language and conversational queries.</li>\n  <li>Effective for long, descriptive queries.</li>\n  <li>Often works across languages without explicit translation.</li>\n  <li>Recovers relevant content missed by lexical methods.</li>\n</ul>\n<h5 id=\"challenges\">Challenges</h5>\n<ul>\n  <li>\n    <p><strong>Computational cost</strong>:</p>\n\n    <ul>\n      <li>Embedding generation is expensive relative to lexical scoring.</li>\n      <li>Nearest neighbor search is more complex than inverted index lookup.</li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Approximation trade-offs</strong>:</p>\n\n    <ul>\n      <li>Vector search typically uses approximate algorithms.</li>\n      <li>Recall may be sacrificed for latency at scale.</li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Model dependence</strong>:</p>\n\n    <ul>\n      <li>Retrieval quality depends heavily on training data.</li>\n      <li>Domain mismatch can degrade performance.</li>\n      <li>Biases in training data propagate into retrieval results.</li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Maintenance complexity</strong>:</p>\n\n    <ul>\n      <li>Document embeddings must be recomputed when:\n        <ul>\n          <li>The corpus changes significantly</li>\n          <li>The model is updated</li>\n        </ul>\n      </li>\n      <li>Versioning embeddings and models adds operational overhead.</li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Precision issues</strong>:</p>\n\n    <ul>\n      <li>Semantic similarity can over-generalize.</li>\n      <li>Exact constraints, identifiers, or negations may be missed.</li>\n      <li>Rare or newly introduced terms may not be well represented.</li>\n    </ul>\n  </li>\n</ul>\n<p><strong>Computational cost</strong>:</p>\n<ul>\n      <li>Embedding generation is expensive relative to lexical scoring.</li>\n      <li>Nearest neighbor search is more complex than inverted index lookup.</li>\n    </ul>\n<p><strong>Approximation trade-offs</strong>:</p>\n<ul>\n      <li>Vector search typically uses approximate algorithms.</li>\n      <li>Recall may be sacrificed for latency at scale.</li>\n    </ul>\n<p><strong>Model dependence</strong>:</p>\n<ul>\n      <li>Retrieval quality depends heavily on training data.</li>\n      <li>Domain mismatch can degrade performance.</li>\n      <li>Biases in training data propagate into retrieval results.</li>\n    </ul>\n<p><strong>Maintenance complexity</strong>:</p>\n<ul>\n      <li>Document embeddings must be recomputed when:\n        <ul>\n          <li>The corpus changes significantly</li>\n          <li>The model is updated</li>\n        </ul>\n      </li>\n      <li>Versioning embeddings and models adds operational overhead.</li>\n    </ul>\n<ul>\n          <li>The corpus changes significantly</li>\n          <li>The model is updated</li>\n        </ul>\n<p><strong>Precision issues</strong>:</p>\n<ul>\n      <li>Semantic similarity can over-generalize.</li>\n      <li>Exact constraints, identifiers, or negations may be missed.</li>\n      <li>Rare or newly introduced terms may not be well represented.</li>\n    </ul>\n<h5 id=\"use-cases-where-semantic-retrieval-excels\">Use-cases Where Semantic Retrieval Excels</h5>\n<ul>\n  <li>Exploratory or research-oriented search.</li>\n  <li>Natural language question answering.</li>\n  <li>Knowledge discovery and recall-heavy tasks.</li>\n  <li>User-facing search with ambiguous or verbose queries.</li>\n</ul>\n<h5 id=\"use-cases-where-semantic-retrieval-struggles\">Use-cases Where Semantic Retrieval Struggles</h5>\n<ul>\n  <li>\n    <p>These strengths and weaknesses are complementary to lexical retrieval, which is why semantic retrieval is rarely deployed alone in high-reliability systems. Specifically the areas where semantic search struggles are as follows:</p>\n\n    <ul>\n      <li>Queries dominated by symbols, codes, or IDs.</li>\n      <li>Legal, medical, or compliance-sensitive text requiring exact wording.</li>\n      <li>Short, underspecified queries with little context.</li>\n      <li>Scenarios demanding deterministic, explainable rankings.</li>\n    </ul>\n  </li>\n</ul>\n<p>These strengths and weaknesses are complementary to lexical retrieval, which is why semantic retrieval is rarely deployed alone in high-reliability systems. Specifically the areas where semantic search struggles are as follows:</p>\n<ul>\n      <li>Queries dominated by symbols, codes, or IDs.</li>\n      <li>Legal, medical, or compliance-sensitive text requiring exact wording.</li>\n      <li>Short, underspecified queries with little context.</li>\n      <li>Scenarios demanding deterministic, explainable rankings.</li>\n    </ul>\n<h4 id=\"hybrid-retrieval-lexical--semantic\">Hybrid Retrieval (Lexical + Semantic)</h4>\n<ul>\n  <li>\n    <p>Hybrid retrieval combines lexical (sparse) and semantic (dense) retrieval to leverage the complementary strengths of both approaches. The core motivation is simple: real-world queries simultaneously contain exact terms that must be respected and implicit intent that must be inferred.</p>\n  </li>\n  <li>\n    <p>A hybrid retrieval system combines the strengths of lexical and semantic methods to deliver more accurate and robust results by reducing the likelihood that either system’s blind spots dominate the final ranking.</p>\n  </li>\n  <li>\n    <p>Hybrid systems are designed to minimize worst-case failure modes by ensuring that neither exact matching nor semantic understanding is relied on exclusively.</p>\n  </li>\n</ul>\n<p>Hybrid retrieval combines lexical (sparse) and semantic (dense) retrieval to leverage the complementary strengths of both approaches. The core motivation is simple: real-world queries simultaneously contain exact terms that must be respected and implicit intent that must be inferred.</p>\n<p>A hybrid retrieval system combines the strengths of lexical and semantic methods to deliver more accurate and robust results by reducing the likelihood that either system’s blind spots dominate the final ranking.</p>\n<p>Hybrid systems are designed to minimize worst-case failure modes by ensuring that neither exact matching nor semantic understanding is relied on exclusively.</p>\n<h5 id=\"why-hybrid-retrieval-is-necessary\">Why Hybrid Retrieval is Necessary</h5>\n<ul>\n  <li>\n    <p>Lexical and semantic retrieval fail in opposite ways:</p>\n\n    <ul>\n      <li>Lexical retrieval fails when vocabulary mismatch occurs.</li>\n      <li>Semantic retrieval fails when exact wording, identifiers, or constraints matter.</li>\n    </ul>\n  </li>\n  <li>\n    <p>Hybrid retrieval exists to ensure:</p>\n\n    <ul>\n      <li>Exact matches are never lost.</li>\n      <li>Semantic relevance is still captured.</li>\n      <li>Recall and precision remain stable across query types.</li>\n    </ul>\n  </li>\n  <li>\n    <p>In practice, hybrid retrieval is not a single algorithm but a family of architectures.</p>\n  </li>\n</ul>\n<p>Lexical and semantic retrieval fail in opposite ways:</p>\n<ul>\n      <li>Lexical retrieval fails when vocabulary mismatch occurs.</li>\n      <li>Semantic retrieval fails when exact wording, identifiers, or constraints matter.</li>\n    </ul>\n<p>Hybrid retrieval exists to ensure:</p>\n<ul>\n      <li>Exact matches are never lost.</li>\n      <li>Semantic relevance is still captured.</li>\n      <li>Recall and precision remain stable across query types.</li>\n    </ul>\n<p>In practice, hybrid retrieval is not a single algorithm but a family of architectures.</p>\n<h5 id=\"common-hybrid-retrieval-architectures\">Common Hybrid Retrieval Architectures</h5>\n<ul>\n  <li>\n    <p><strong>Two-stage hybrid retrieval</strong>: Lexical retrieval is used first to generate a high-recall candidate set, which is then reranked by a semantic model. This design prioritizes efficiency and recall safety while allowing deep semantic reasoning to operate only where it matters.</p>\n  </li>\n  <li>\n    <p><strong>Parallel hybrid retrieval with fusion</strong>: Lexical and semantic retrievers run independently over the corpus, and their results are merged using score-based or rank-based fusion methods. This approach treats lexical and semantic signals as peers rather than stages in a pipeline.</p>\n  </li>\n  <li>\n    <p><strong>Native hybrid scoring</strong>: Some systems integrate sparse and dense signals directly into a single retrieval model or query interface, blending term-based and embedding-based evidence during initial retrieval rather than combining results afterward.</p>\n  </li>\n</ul>\n<p><strong>Two-stage hybrid retrieval</strong>: Lexical retrieval is used first to generate a high-recall candidate set, which is then reranked by a semantic model. This design prioritizes efficiency and recall safety while allowing deep semantic reasoning to operate only where it matters.</p>\n<p><strong>Parallel hybrid retrieval with fusion</strong>: Lexical and semantic retrievers run independently over the corpus, and their results are merged using score-based or rank-based fusion methods. This approach treats lexical and semantic signals as peers rather than stages in a pipeline.</p>\n<p><strong>Native hybrid scoring</strong>: Some systems integrate sparse and dense signals directly into a single retrieval model or query interface, blending term-based and embedding-based evidence during initial retrieval rather than combining results afterward.</p>\n<h6 id=\"the-dominant-production-architecture-lexical-retrieval--semantic-re-ranking\">The Dominant Production Architecture: Lexical Retrieval + Semantic Re-ranking</h6>\n<ul>\n  <li>\n    <p>The most common hybrid architecture is a two-stage pipeline:</p>\n\n    <ol>\n      <li><strong>Candidate generation (lexical)</strong>:\n        <ul>\n          <li>\n            <p>A lexical retriever (typically BM25) retrieves the top <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-49-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-464\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-465\"><span class=\"mi\" id=\"MathJax-Span-466\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-49\">K</script> candidates based on exact term overlap.</p>\n          </li>\n          <li>\n            <p>Typical values:</p>\n            <ul>\n              <li>\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-50-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>K</mi><mo>&amp;#x2208;</mo><mo stretchy=&quot;false&quot;>[</mo><mn>100</mn><mo>,</mo><mn>1000</mn><mo stretchy=&quot;false&quot;>]</mo></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-467\" style=\"width: 7.971em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 6.617em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1006.51em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-468\"><span class=\"mi\" id=\"MathJax-Span-469\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-470\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">∈</span><span class=\"mo\" id=\"MathJax-Span-471\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">[</span><span class=\"mn\" id=\"MathJax-Span-472\" style=\"font-family: STIXGeneral-Regular;\">100</span><span class=\"mo\" id=\"MathJax-Span-473\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mn\" id=\"MathJax-Span-474\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">1000</span><span class=\"mo\" id=\"MathJax-Span-475\" style=\"font-family: STIXGeneral-Regular;\">]</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mi>K</mi><mo>∈</mo><mo stretchy=\"false\">[</mo><mn>100</mn><mo>,</mo><mn>1000</mn><mo stretchy=\"false\">]</mo></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-50\">K \\in [100, 1000]</script>\n              </li>\n              <li>Chosen to maximize recall while keeping downstream cost manageable</li>\n            </ul>\n          </li>\n        </ul>\n      </li>\n      <li><strong>Semantic re-ranking (dense or cross-encoder)</strong>:\n        <ul>\n          <li>Semantic re-ranking models aim to improve the ordering of retrieved documents by more accurately modeling relevance between a query and a small candidate set.</li>\n          <li>In practice, these models are used after an initial retrieval step and can be grouped both by how they encode query–document interactions and by the type of signals they incorporate (semantic, instructional, or metadata-driven).</li>\n        </ul>\n      </li>\n    </ol>\n  </li>\n  <li>\n    <p>Conceptually:</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-51-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>Results</mtext><mo>=</mo><msub><mtext>Rerank</mtext><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>semantic</mtext></mrow></msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo maxsize=&quot;1.2em&quot; minsize=&quot;1.2em&quot;>(</mo></mrow><mtext>BM25</mtext><mo stretchy=&quot;false&quot;>(</mo><mtext>Docs</mtext><mo stretchy=&quot;false&quot;>)</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo maxsize=&quot;1.2em&quot; minsize=&quot;1.2em&quot;>)</mo></mrow></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-476\" style=\"width: 19.169em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 15.94em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(2.086em, 1015.78em, 3.753em, -999.997em); top: -3.174em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-477\"><span class=\"mtext\" id=\"MathJax-Span-478\" style=\"font-family: STIXGeneral-Regular;\">Results</span><span class=\"mo\" id=\"MathJax-Span-479\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"msubsup\" id=\"MathJax-Span-480\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 5.471em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1002.92em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mtext\" id=\"MathJax-Span-481\" style=\"font-family: STIXGeneral-Regular;\">Rerank</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 2.867em;\"><span class=\"texatom\" id=\"MathJax-Span-482\"><span class=\"mrow\" id=\"MathJax-Span-483\"><span class=\"mtext\" id=\"MathJax-Span-484\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">semantic</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"texatom\" id=\"MathJax-Span-485\"><span class=\"mrow\" id=\"MathJax-Span-486\"><span class=\"mo\" id=\"MathJax-Span-487\" style=\"vertical-align: -0.258em;\"><span><span style=\"font-size: 110%; font-family: STIXSizeOneSym;\">(</span></span></span></span></span><span class=\"mtext\" id=\"MathJax-Span-488\" style=\"font-family: STIXGeneral-Regular;\">BM25</span><span class=\"mo\" id=\"MathJax-Span-489\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mtext\" id=\"MathJax-Span-490\" style=\"font-family: STIXGeneral-Regular;\">Docs</span><span class=\"mo\" id=\"MathJax-Span-491\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"texatom\" id=\"MathJax-Span-492\"><span class=\"mrow\" id=\"MathJax-Span-493\"><span class=\"mo\" id=\"MathJax-Span-494\" style=\"vertical-align: -0.258em;\"><span><span style=\"font-size: 110%; font-family: STIXSizeOneSym;\">)</span></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 3.18em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.559em; border-left: 0px solid; width: 0px; height: 1.753em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>Results</mtext><mo>=</mo><msub><mtext>Rerank</mtext><mrow class=\"MJX-TeXAtom-ORD\"><mtext>semantic</mtext></mrow></msub><mrow class=\"MJX-TeXAtom-ORD\"><mo maxsize=\"1.2em\" minsize=\"1.2em\">(</mo></mrow><mtext>BM25</mtext><mo stretchy=\"false\">(</mo><mtext>Docs</mtext><mo stretchy=\"false\">)</mo><mrow class=\"MJX-TeXAtom-ORD\"><mo maxsize=\"1.2em\" minsize=\"1.2em\">)</mo></mrow></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-51\">\\text{Results} =\n\\text{Rerank}_{\\text{semantic}}\n\\big(\n\\text{BM25}(\\text{Docs})\n\\big)</script>\n  </li>\n  <li>\n    <p>This approach dominates because of its efficiency, recall-safety, easy of explainability, and compatibility with existing search infrastructure.</p>\n  </li>\n</ul>\n<p>The most common hybrid architecture is a two-stage pipeline:</p>\n<ol>\n      <li><strong>Candidate generation (lexical)</strong>:\n        <ul>\n          <li>\n            <p>A lexical retriever (typically BM25) retrieves the top <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-49-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-464\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-465\"><span class=\"mi\" id=\"MathJax-Span-466\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-49\">K</script> candidates based on exact term overlap.</p>\n          </li>\n          <li>\n            <p>Typical values:</p>\n            <ul>\n              <li>\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-50-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>K</mi><mo>&amp;#x2208;</mo><mo stretchy=&quot;false&quot;>[</mo><mn>100</mn><mo>,</mo><mn>1000</mn><mo stretchy=&quot;false&quot;>]</mo></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-467\" style=\"width: 7.971em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 6.617em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1006.51em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-468\"><span class=\"mi\" id=\"MathJax-Span-469\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-470\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">∈</span><span class=\"mo\" id=\"MathJax-Span-471\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">[</span><span class=\"mn\" id=\"MathJax-Span-472\" style=\"font-family: STIXGeneral-Regular;\">100</span><span class=\"mo\" id=\"MathJax-Span-473\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mn\" id=\"MathJax-Span-474\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">1000</span><span class=\"mo\" id=\"MathJax-Span-475\" style=\"font-family: STIXGeneral-Regular;\">]</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mi>K</mi><mo>∈</mo><mo stretchy=\"false\">[</mo><mn>100</mn><mo>,</mo><mn>1000</mn><mo stretchy=\"false\">]</mo></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-50\">K \\in [100, 1000]</script>\n              </li>\n              <li>Chosen to maximize recall while keeping downstream cost manageable</li>\n            </ul>\n          </li>\n        </ul>\n      </li>\n      <li><strong>Semantic re-ranking (dense or cross-encoder)</strong>:\n        <ul>\n          <li>Semantic re-ranking models aim to improve the ordering of retrieved documents by more accurately modeling relevance between a query and a small candidate set.</li>\n          <li>In practice, these models are used after an initial retrieval step and can be grouped both by how they encode query–document interactions and by the type of signals they incorporate (semantic, instructional, or metadata-driven).</li>\n        </ul>\n      </li>\n    </ol>\n<ul>\n          <li>\n            <p>A lexical retriever (typically BM25) retrieves the top <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-49-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-464\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-465\"><span class=\"mi\" id=\"MathJax-Span-466\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-49\">K</script> candidates based on exact term overlap.</p>\n          </li>\n          <li>\n            <p>Typical values:</p>\n            <ul>\n              <li>\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-50-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>K</mi><mo>&amp;#x2208;</mo><mo stretchy=&quot;false&quot;>[</mo><mn>100</mn><mo>,</mo><mn>1000</mn><mo stretchy=&quot;false&quot;>]</mo></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-467\" style=\"width: 7.971em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 6.617em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1006.51em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-468\"><span class=\"mi\" id=\"MathJax-Span-469\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-470\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">∈</span><span class=\"mo\" id=\"MathJax-Span-471\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">[</span><span class=\"mn\" id=\"MathJax-Span-472\" style=\"font-family: STIXGeneral-Regular;\">100</span><span class=\"mo\" id=\"MathJax-Span-473\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mn\" id=\"MathJax-Span-474\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">1000</span><span class=\"mo\" id=\"MathJax-Span-475\" style=\"font-family: STIXGeneral-Regular;\">]</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mi>K</mi><mo>∈</mo><mo stretchy=\"false\">[</mo><mn>100</mn><mo>,</mo><mn>1000</mn><mo stretchy=\"false\">]</mo></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-50\">K \\in [100, 1000]</script>\n              </li>\n              <li>Chosen to maximize recall while keeping downstream cost manageable</li>\n            </ul>\n          </li>\n        </ul>\n<p>A lexical retriever (typically BM25) retrieves the top <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-49-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-464\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-465\"><span class=\"mi\" id=\"MathJax-Span-466\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-49\">K</script> candidates based on exact term overlap.</p>\n<p>Typical values:</p>\n<ul>\n              <li>\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-50-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>K</mi><mo>&amp;#x2208;</mo><mo stretchy=&quot;false&quot;>[</mo><mn>100</mn><mo>,</mo><mn>1000</mn><mo stretchy=&quot;false&quot;>]</mo></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-467\" style=\"width: 7.971em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 6.617em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1006.51em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-468\"><span class=\"mi\" id=\"MathJax-Span-469\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-470\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">∈</span><span class=\"mo\" id=\"MathJax-Span-471\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">[</span><span class=\"mn\" id=\"MathJax-Span-472\" style=\"font-family: STIXGeneral-Regular;\">100</span><span class=\"mo\" id=\"MathJax-Span-473\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mn\" id=\"MathJax-Span-474\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">1000</span><span class=\"mo\" id=\"MathJax-Span-475\" style=\"font-family: STIXGeneral-Regular;\">]</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mi>K</mi><mo>∈</mo><mo stretchy=\"false\">[</mo><mn>100</mn><mo>,</mo><mn>1000</mn><mo stretchy=\"false\">]</mo></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-50\">K \\in [100, 1000]</script>\n              </li>\n              <li>Chosen to maximize recall while keeping downstream cost manageable</li>\n            </ul>\n<ul>\n          <li>Semantic re-ranking models aim to improve the ordering of retrieved documents by more accurately modeling relevance between a query and a small candidate set.</li>\n          <li>In practice, these models are used after an initial retrieval step and can be grouped both by how they encode query–document interactions and by the type of signals they incorporate (semantic, instructional, or metadata-driven).</li>\n        </ul>\n<p>Conceptually:</p>\n<p>This approach dominates because of its efficiency, recall-safety, easy of explainability, and compatibility with existing search infrastructure.</p>\n<h5 id=\"parallel-hybrid-retrieval-and-score-fusion\">Parallel Hybrid Retrieval and Score Fusion</h5>\n<ul>\n  <li>An alternative approach runs lexical and semantic retrieval independently, then fuses their rankings. This approach is common when re-ranking is too expensive or when vector databases expose native hybrid querying.</li>\n</ul>\n<h6 id=\"linear-score-fusion\">Linear Score Fusion</h6>\n<div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-52-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>score</mtext><mo stretchy=&quot;false&quot;>(</mo><mi>d</mi><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mi>&amp;#x03B1;</mi><mo>&amp;#x22C5;</mo><mtext>BM25</mtext><mo stretchy=&quot;false&quot;>(</mo><mi>d</mi><mo stretchy=&quot;false&quot;>)</mo><mo>+</mo><mo stretchy=&quot;false&quot;>(</mo><mn>1</mn><mo>&amp;#x2212;</mo><mi>&amp;#x03B1;</mi><mo stretchy=&quot;false&quot;>)</mo><mo>&amp;#x22C5;</mo><msub><mtext>sim</mtext><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>semantic</mtext></mrow></msub><mo stretchy=&quot;false&quot;>(</mo><mi>d</mi><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-495\" style=\"width: 24.065em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 20.055em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1020em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-496\"><span class=\"mtext\" id=\"MathJax-Span-497\" style=\"font-family: STIXGeneral-Regular;\">score</span><span class=\"mo\" id=\"MathJax-Span-498\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-499\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-500\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-501\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mi\" id=\"MathJax-Span-502\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">α</span><span class=\"mo\" id=\"MathJax-Span-503\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"mtext\" id=\"MathJax-Span-504\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">BM25</span><span class=\"mo\" id=\"MathJax-Span-505\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-506\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-507\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-508\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mo\" id=\"MathJax-Span-509\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">(</span><span class=\"mn\" id=\"MathJax-Span-510\" style=\"font-family: STIXGeneral-Regular;\">1</span><span class=\"mo\" id=\"MathJax-Span-511\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">−</span><span class=\"mi\" id=\"MathJax-Span-512\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.263em;\">α</span><span class=\"mo\" id=\"MathJax-Span-513\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-514\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"msubsup\" id=\"MathJax-Span-515\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 4.013em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1001.46em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mtext\" id=\"MathJax-Span-516\" style=\"font-family: STIXGeneral-Regular;\">sim</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 1.461em;\"><span class=\"texatom\" id=\"MathJax-Span-517\"><span class=\"mrow\" id=\"MathJax-Span-518\"><span class=\"mtext\" id=\"MathJax-Span-519\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">semantic</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-520\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-521\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-522\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>score</mtext><mo stretchy=\"false\">(</mo><mi>d</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi>α</mi><mo>⋅</mo><mtext>BM25</mtext><mo stretchy=\"false\">(</mo><mi>d</mi><mo stretchy=\"false\">)</mo><mo>+</mo><mo stretchy=\"false\">(</mo><mn>1</mn><mo>−</mo><mi>α</mi><mo stretchy=\"false\">)</mo><mo>⋅</mo><msub><mtext>sim</mtext><mrow class=\"MJX-TeXAtom-ORD\"><mtext>semantic</mtext></mrow></msub><mo stretchy=\"false\">(</mo><mi>d</mi><mo stretchy=\"false\">)</mo></math></span></span></div>\n<ul>\n  <li>\n    <p>Challenges:</p>\n\n    <ul>\n      <li>Scores must be normalized</li>\n      <li>Sensitive to scaling differences</li>\n      <li>Requires tuning <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-53-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>&amp;#x03B1;</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-523\" style=\"width: 0.784em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.63em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-524\"><span class=\"mi\" id=\"MathJax-Span-525\" style=\"font-family: STIXGeneral-Italic;\">α</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>α</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-53\">\\alpha</script></li>\n    </ul>\n  </li>\n</ul>\n<p>Challenges:</p>\n<ul>\n      <li>Scores must be normalized</li>\n      <li>Sensitive to scaling differences</li>\n      <li>Requires tuning <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-53-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>&amp;#x03B1;</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-523\" style=\"width: 0.784em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.63em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-524\"><span class=\"mi\" id=\"MathJax-Span-525\" style=\"font-family: STIXGeneral-Italic;\">α</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>α</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-53\">\\alpha</script></li>\n    </ul>\n<h6 id=\"reciprocal-rank-fusion-rrf\">Reciprocal Rank Fusion (RRF)</h6>\n<ul>\n  <li>\n    <p>One of the most popular and robust fusion techniques used in hybrid retrieval is Reciprocal Rank Fusion (RRF). RRF merges the rankings from different retrieval models (for example, BM25 and a neural retriever) by assigning higher scores to documents that consistently rank well across systems, rather than relying on raw scores.</p>\n  </li>\n  <li>\n    <p>RRF operates purely on rank positions, making it insensitive to score scale (i.e., it lacks the need for normalization unlike linear score fusion), distribution, or calibration differences between retrieval methods.</p>\n  </li>\n  <li>\n    <p><strong>How RRF works:</strong></p>\n\n    <ul>\n      <li>Each retrieval system independently produces a ranked list of documents.</li>\n      <li>Each document receives a contribution based on its rank position in each list.</li>\n      <li>\n        <p>Contributions are summed to produce a final fusion score.</p>\n      </li>\n      <li>\n        <p>The RRF scoring function is:</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-54-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>RRF Score</mtext><mo stretchy=&quot;false&quot;>(</mo><mi>d</mi><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><munderover><mo>&amp;#x2211;</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>n</mi></mrow></munderover><mfrac><mn>1</mn><mrow><mi>k</mi><mo>+</mo><msub><mtext>rank</mtext><mi>i</mi></msub><mo stretchy=&quot;false&quot;>(</mo><mi>d</mi><mo stretchy=&quot;false&quot;>)</mo></mrow></mfrac></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-526\" style=\"width: 16.357em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 13.596em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.419em, 1013.6em, 3.596em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-527\"><span class=\"mtext\" id=\"MathJax-Span-528\" style=\"font-family: STIXGeneral-Regular;\">RRF Score</span><span class=\"mo\" id=\"MathJax-Span-529\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-530\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-531\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-532\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"munderover\" id=\"MathJax-Span-533\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 1.305em; height: 0px;\"><span style=\"position: absolute; clip: rect(2.867em, 1001.2em, 4.638em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mo\" id=\"MathJax-Span-534\" style=\"font-family: STIXSizeOneSym; vertical-align: -0.518em;\">∑</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1000.94em, 4.273em, -999.997em); top: -2.862em; left: 0.107em;\"><span class=\"texatom\" id=\"MathJax-Span-535\"><span class=\"mrow\" id=\"MathJax-Span-536\"><span class=\"mi\" id=\"MathJax-Span-537\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">i</span><span class=\"mo\" id=\"MathJax-Span-538\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">=</span><span class=\"mn\" id=\"MathJax-Span-539\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.44em, 1000.32em, 4.169em, -999.997em); top: -5.206em; left: 0.471em;\"><span class=\"texatom\" id=\"MathJax-Span-540\"><span class=\"mrow\" id=\"MathJax-Span-541\"><span class=\"mi\" id=\"MathJax-Span-542\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">n</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mfrac\" id=\"MathJax-Span-543\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 5.055em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-544\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1004.85em, 4.326em, -999.997em); top: -3.331em; left: 50%; margin-left: -2.445em;\"><span class=\"mrow\" id=\"MathJax-Span-545\"><span class=\"mi\" id=\"MathJax-Span-546\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-547\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"msubsup\" id=\"MathJax-Span-548\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.034em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1001.77em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mtext\" id=\"MathJax-Span-549\" style=\"font-family: STIXGeneral-Regular;\">rank</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 1.773em;\"><span class=\"mi\" id=\"MathJax-Span-550\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-551\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-552\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-553\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1005.05em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 5.055em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -1.559em; border-left: 0px solid; width: 0px; height: 3.566em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>RRF Score</mtext><mo stretchy=\"false\">(</mo><mi>d</mi><mo stretchy=\"false\">)</mo><mo>=</mo><munderover><mo>∑</mo><mrow class=\"MJX-TeXAtom-ORD\"><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mrow class=\"MJX-TeXAtom-ORD\"><mi>n</mi></mrow></munderover><mfrac><mn>1</mn><mrow><mi>k</mi><mo>+</mo><msub><mtext>rank</mtext><mi>i</mi></msub><mo stretchy=\"false\">(</mo><mi>d</mi><mo stretchy=\"false\">)</mo></mrow></mfrac></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-54\">\\text{RRF Score}(d) =\n\\sum_{i=1}^{n}\n\\frac{1}{k + \\text{rank}_i(d)}</script>\n\n        <ul>\n          <li>\n            <p>where:</p>\n\n            <ul>\n              <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-55-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>d</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-554\" style=\"width: 0.732em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.576em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.58em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-555\"><span class=\"mi\" id=\"MathJax-Span-556\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>d</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-55\">d</script> is the document,</li>\n              <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-56-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mtext>rank</mtext><mi>i</mi></msub><mo stretchy=&quot;false&quot;>(</mo><mi>d</mi><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-557\" style=\"width: 3.961em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 3.284em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1003.23em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-558\"><span class=\"msubsup\" id=\"MathJax-Span-559\"><span style=\"display: inline-block; position: relative; width: 2.034em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1001.77em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mtext\" id=\"MathJax-Span-560\" style=\"font-family: STIXGeneral-Regular;\">rank</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 1.773em;\"><span class=\"mi\" id=\"MathJax-Span-561\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-562\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-563\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-564\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mtext>rank</mtext><mi>i</mi></msub><mo stretchy=\"false\">(</mo><mi>d</mi><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-56\">\\text{rank}_i(d)</script> is the rank position of document <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-57-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>d</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-565\" style=\"width: 0.732em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.576em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.58em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-566\"><span class=\"mi\" id=\"MathJax-Span-567\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>d</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-57\">d</script> in the <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-58-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msup><mi>i</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>th</mtext></mrow></msup></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-568\" style=\"width: 1.096em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.888em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.148em, 1000.89em, 2.294em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-569\"><span class=\"msubsup\" id=\"MathJax-Span-570\"><span style=\"display: inline-block; position: relative; width: 0.888em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.26em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-571\" style=\"font-family: STIXGeneral-Italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.372em; left: 0.263em;\"><span class=\"texatom\" id=\"MathJax-Span-572\"><span class=\"mrow\" id=\"MathJax-Span-573\"><span class=\"mtext\" id=\"MathJax-Span-574\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">th</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msup><mi>i</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>th</mtext></mrow></msup></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-58\">i^{\\text{th}}</script> ranked list,</li>\n              <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-59-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-575\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-576\"><span class=\"mi\" id=\"MathJax-Span-577\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-59\">k</script> is a smoothing constant (typically set to 60),</li>\n              <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-60-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>n</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-578\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-579\"><span class=\"mi\" id=\"MathJax-Span-580\" style=\"font-family: STIXGeneral-Italic;\">n</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>n</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-60\">n</script> is the number of retrieval systems.</li>\n            </ul>\n          </li>\n        </ul>\n      </li>\n      <li>\n        <p>The constant <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-61-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-581\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-582\"><span class=\"mi\" id=\"MathJax-Span-583\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-61\">k</script> ensures that:</p>\n\n        <ul>\n          <li>Top-ranked documents dominate the contribution</li>\n          <li>Differences among lower-ranked documents are compressed</li>\n          <li>Noise from deep rankings does not overwhelm the fusion</li>\n        </ul>\n      </li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Intuition behind RRF:</strong></p>\n\n    <ul>\n      <li>The intuition behind RRF being especially well suited for hybrid lexical–semantic retrieval is as follows:\n        <ul>\n          <li>Documents that appear near the top in multiple rankings are strongly favored.</li>\n          <li>A document that ranks moderately well in several systems often beats one that ranks extremely well in only one.</li>\n          <li>Systems with very different scoring behavior can still be combined reliably.</li>\n        </ul>\n      </li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Example:</strong></p>\n\n    <ul>\n      <li>\n        <p>Suppose two retrieval systems return the following output results for a query:</p>\n\n        <ul>\n          <li>BM25: <code class=\"language-plaintext highlighter-rouge\">[DocA, DocB, DocC, DocD, DocE]</code></li>\n          <li>Neural Retriever: <code class=\"language-plaintext highlighter-rouge\">[DocF, DocC, DocA, DocG, DocB]</code></li>\n        </ul>\n      </li>\n      <li>We use <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-62-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi><mo>=</mo><mn>60</mn></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-584\" style=\"width: 3.284em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.711em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1002.71em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-585\"><span class=\"mi\" id=\"MathJax-Span-586\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-587\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-588\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">60</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi><mo>=</mo><mn>60</mn></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-62\">k = 60</script>.</li>\n      <li>\n        <p>Note that if a document does not appear at a output of a retriever, it contributes <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-63-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>0</mn></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-589\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-590\"><span class=\"mn\" id=\"MathJax-Span-591\" style=\"font-family: STIXGeneral-Regular;\">0</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mn>0</mn></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-63\">0</script> from that list.</p>\n      </li>\n      <li>\n        <p>RRF scores are computed as follows:</p>\n\n        <ul>\n          <li>\n            <p><strong>DocA</strong> (Rank 1 in BM25, rank 3 in Neural Retriever):</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-64-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>RRF</mtext><mo stretchy=&quot;false&quot;>(</mo><mtext>DocA</mtext><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>1</mn></mrow></mfrac><mo>+</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>3</mn></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>61</mn></mfrac><mo>+</mo><mfrac><mn>1</mn><mn>63</mn></mfrac><mo>&amp;#x2248;</mo><mn>0.01639</mn><mo>+</mo><mn>0.01587</mn><mo>=</mo><mn>0.03226</mn></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-592\" style=\"width: 37.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 31.513em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.68em, 1031.46em, 3.076em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-593\"><span class=\"mtext\" id=\"MathJax-Span-594\" style=\"font-family: STIXGeneral-Regular;\">RRF</span><span class=\"mo\" id=\"MathJax-Span-595\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mtext\" id=\"MathJax-Span-596\" style=\"font-family: STIXGeneral-Regular;\">DocA</span><span class=\"mo\" id=\"MathJax-Span-597\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-598\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-599\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 2.815em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-600\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1002.61em, 4.221em, -999.997em); top: -3.331em; left: 50%; margin-left: -1.352em;\"><span class=\"mrow\" id=\"MathJax-Span-601\"><span class=\"mn\" id=\"MathJax-Span-602\" style=\"font-family: STIXGeneral-Regular;\">60</span><span class=\"mo\" id=\"MathJax-Span-603\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mn\" id=\"MathJax-Span-604\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">1</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1002.82em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.815em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-605\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mfrac\" id=\"MathJax-Span-606\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.815em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-607\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1002.66em, 4.221em, -999.997em); top: -3.331em; left: 50%; margin-left: -1.352em;\"><span class=\"mrow\" id=\"MathJax-Span-608\"><span class=\"mn\" id=\"MathJax-Span-609\" style=\"font-family: STIXGeneral-Regular;\">60</span><span class=\"mo\" id=\"MathJax-Span-610\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mn\" id=\"MathJax-Span-611\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">3</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1002.82em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.815em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-612\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-613\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-614\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -3.331em; left: 50%; margin-left: -0.518em;\"><span class=\"mn\" id=\"MathJax-Span-615\" style=\"font-family: STIXGeneral-Regular;\">61</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1001.15em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.148em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-616\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mfrac\" id=\"MathJax-Span-617\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-618\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1000.94em, 4.169em, -999.997em); top: -3.331em; left: 50%; margin-left: -0.518em;\"><span class=\"mn\" id=\"MathJax-Span-619\" style=\"font-family: STIXGeneral-Regular;\">63</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1001.15em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.148em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-620\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">≈</span><span class=\"mn\" id=\"MathJax-Span-621\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">0.01639</span><span class=\"mo\" id=\"MathJax-Span-622\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mn\" id=\"MathJax-Span-623\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">0.01587</span><span class=\"mo\" id=\"MathJax-Span-624\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-625\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">0.03226</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.934em; border-left: 0px solid; width: 0px; height: 2.628em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>RRF</mtext><mo stretchy=\"false\">(</mo><mtext>DocA</mtext><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>1</mn></mrow></mfrac><mo>+</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>3</mn></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>61</mn></mfrac><mo>+</mo><mfrac><mn>1</mn><mn>63</mn></mfrac><mo>≈</mo><mn>0.01639</mn><mo>+</mo><mn>0.01587</mn><mo>=</mo><mn>0.03226</mn></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-64\">\\text{RRF}(\\text{DocA})\n= \\frac{1}{60 + 1} + \\frac{1}{60 + 3}\n= \\frac{1}{61} + \\frac{1}{63}\n\\approx 0.01639 + 0.01587\n= 0.03226</script>\n          </li>\n          <li>\n            <p><strong>DocB</strong> (Rank 2 in BM25, rank 5 in Neural Retriever):</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-65-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>RRF</mtext><mo stretchy=&quot;false&quot;>(</mo><mtext>DocB</mtext><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>2</mn></mrow></mfrac><mo>+</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>5</mn></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>62</mn></mfrac><mo>+</mo><mfrac><mn>1</mn><mn>65</mn></mfrac><mo>&amp;#x2248;</mo><mn>0.01613</mn><mo>+</mo><mn>0.01538</mn><mo>=</mo><mn>0.03151</mn></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-626\" style=\"width: 37.763em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 31.461em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.68em, 1031.36em, 3.076em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-627\"><span class=\"mtext\" id=\"MathJax-Span-628\" style=\"font-family: STIXGeneral-Regular;\">RRF</span><span class=\"mo\" id=\"MathJax-Span-629\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mtext\" id=\"MathJax-Span-630\" style=\"font-family: STIXGeneral-Regular;\">DocB</span><span class=\"mo\" id=\"MathJax-Span-631\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-632\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-633\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 2.815em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-634\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1002.71em, 4.221em, -999.997em); top: -3.331em; left: 50%; margin-left: -1.352em;\"><span class=\"mrow\" id=\"MathJax-Span-635\"><span class=\"mn\" id=\"MathJax-Span-636\" style=\"font-family: STIXGeneral-Regular;\">60</span><span class=\"mo\" id=\"MathJax-Span-637\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mn\" id=\"MathJax-Span-638\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">2</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1002.82em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.815em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-639\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mfrac\" id=\"MathJax-Span-640\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.815em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-641\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1002.66em, 4.221em, -999.997em); top: -3.331em; left: 50%; margin-left: -1.352em;\"><span class=\"mrow\" id=\"MathJax-Span-642\"><span class=\"mn\" id=\"MathJax-Span-643\" style=\"font-family: STIXGeneral-Regular;\">60</span><span class=\"mo\" id=\"MathJax-Span-644\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mn\" id=\"MathJax-Span-645\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">5</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1002.82em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.815em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-646\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-647\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-648\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1000.99em, 4.169em, -999.997em); top: -3.331em; left: 50%; margin-left: -0.518em;\"><span class=\"mn\" id=\"MathJax-Span-649\" style=\"font-family: STIXGeneral-Regular;\">62</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1001.15em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.148em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-650\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mfrac\" id=\"MathJax-Span-651\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-652\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1000.94em, 4.169em, -999.997em); top: -3.331em; left: 50%; margin-left: -0.518em;\"><span class=\"mn\" id=\"MathJax-Span-653\" style=\"font-family: STIXGeneral-Regular;\">65</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1001.15em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.148em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-654\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">≈</span><span class=\"mn\" id=\"MathJax-Span-655\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">0.01613</span><span class=\"mo\" id=\"MathJax-Span-656\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mn\" id=\"MathJax-Span-657\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">0.01538</span><span class=\"mo\" id=\"MathJax-Span-658\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-659\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">0.03151</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.934em; border-left: 0px solid; width: 0px; height: 2.628em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>RRF</mtext><mo stretchy=\"false\">(</mo><mtext>DocB</mtext><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>2</mn></mrow></mfrac><mo>+</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>5</mn></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>62</mn></mfrac><mo>+</mo><mfrac><mn>1</mn><mn>65</mn></mfrac><mo>≈</mo><mn>0.01613</mn><mo>+</mo><mn>0.01538</mn><mo>=</mo><mn>0.03151</mn></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-65\">\\text{RRF}(\\text{DocB})\n= \\frac{1}{60 + 2} + \\frac{1}{60 + 5}\n= \\frac{1}{62} + \\frac{1}{65}\n\\approx 0.01613 + 0.01538\n= 0.03151</script>\n          </li>\n          <li>\n            <p><strong>DocC</strong> (Rank 3 in BM25, rank 2 in Neural Retriever):</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-66-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>RRF</mtext><mo stretchy=&quot;false&quot;>(</mo><mtext>DocC</mtext><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>3</mn></mrow></mfrac><mo>+</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>2</mn></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>63</mn></mfrac><mo>+</mo><mfrac><mn>1</mn><mn>62</mn></mfrac><mo>&amp;#x2248;</mo><mn>0.01587</mn><mo>+</mo><mn>0.01613</mn><mo>=</mo><mn>0.03200</mn></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-660\" style=\"width: 37.763em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 31.461em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.68em, 1031.46em, 3.076em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-661\"><span class=\"mtext\" id=\"MathJax-Span-662\" style=\"font-family: STIXGeneral-Regular;\">RRF</span><span class=\"mo\" id=\"MathJax-Span-663\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mtext\" id=\"MathJax-Span-664\" style=\"font-family: STIXGeneral-Regular;\">DocC</span><span class=\"mo\" id=\"MathJax-Span-665\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-666\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-667\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 2.815em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-668\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1002.66em, 4.221em, -999.997em); top: -3.331em; left: 50%; margin-left: -1.352em;\"><span class=\"mrow\" id=\"MathJax-Span-669\"><span class=\"mn\" id=\"MathJax-Span-670\" style=\"font-family: STIXGeneral-Regular;\">60</span><span class=\"mo\" id=\"MathJax-Span-671\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mn\" id=\"MathJax-Span-672\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">3</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1002.82em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.815em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-673\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mfrac\" id=\"MathJax-Span-674\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.815em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-675\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1002.71em, 4.221em, -999.997em); top: -3.331em; left: 50%; margin-left: -1.352em;\"><span class=\"mrow\" id=\"MathJax-Span-676\"><span class=\"mn\" id=\"MathJax-Span-677\" style=\"font-family: STIXGeneral-Regular;\">60</span><span class=\"mo\" id=\"MathJax-Span-678\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mn\" id=\"MathJax-Span-679\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">2</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1002.82em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.815em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-680\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-681\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-682\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1000.94em, 4.169em, -999.997em); top: -3.331em; left: 50%; margin-left: -0.518em;\"><span class=\"mn\" id=\"MathJax-Span-683\" style=\"font-family: STIXGeneral-Regular;\">63</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1001.15em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.148em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-684\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mfrac\" id=\"MathJax-Span-685\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-686\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1000.99em, 4.169em, -999.997em); top: -3.331em; left: 50%; margin-left: -0.518em;\"><span class=\"mn\" id=\"MathJax-Span-687\" style=\"font-family: STIXGeneral-Regular;\">62</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1001.15em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.148em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-688\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">≈</span><span class=\"mn\" id=\"MathJax-Span-689\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">0.01587</span><span class=\"mo\" id=\"MathJax-Span-690\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mn\" id=\"MathJax-Span-691\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">0.01613</span><span class=\"mo\" id=\"MathJax-Span-692\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-693\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">0.03200</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.934em; border-left: 0px solid; width: 0px; height: 2.628em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>RRF</mtext><mo stretchy=\"false\">(</mo><mtext>DocC</mtext><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>3</mn></mrow></mfrac><mo>+</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>2</mn></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>63</mn></mfrac><mo>+</mo><mfrac><mn>1</mn><mn>62</mn></mfrac><mo>≈</mo><mn>0.01587</mn><mo>+</mo><mn>0.01613</mn><mo>=</mo><mn>0.03200</mn></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-66\">\\text{RRF}(\\text{DocC})\n= \\frac{1}{60 + 3} + \\frac{1}{60 + 2}\n= \\frac{1}{63} + \\frac{1}{62}\n\\approx 0.01587 + 0.01613\n= 0.03200</script>\n          </li>\n          <li>\n            <p><strong>DocD</strong> (Rank 4 in BM25 only):</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-67-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>RRF</mtext><mo stretchy=&quot;false&quot;>(</mo><mtext>DocD</mtext><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>4</mn></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>64</mn></mfrac><mo>&amp;#x2248;</mo><mn>0.01563</mn></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-694\" style=\"width: 19.378em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 16.148em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.68em, 1016.1em, 3.076em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-695\"><span class=\"mtext\" id=\"MathJax-Span-696\" style=\"font-family: STIXGeneral-Regular;\">RRF</span><span class=\"mo\" id=\"MathJax-Span-697\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mtext\" id=\"MathJax-Span-698\" style=\"font-family: STIXGeneral-Regular;\">DocD</span><span class=\"mo\" id=\"MathJax-Span-699\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-700\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-701\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 2.815em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-702\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1002.71em, 4.221em, -999.997em); top: -3.331em; left: 50%; margin-left: -1.352em;\"><span class=\"mrow\" id=\"MathJax-Span-703\"><span class=\"mn\" id=\"MathJax-Span-704\" style=\"font-family: STIXGeneral-Regular;\">60</span><span class=\"mo\" id=\"MathJax-Span-705\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mn\" id=\"MathJax-Span-706\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">4</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1002.82em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.815em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-707\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-708\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-709\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1000.99em, 4.169em, -999.997em); top: -3.331em; left: 50%; margin-left: -0.518em;\"><span class=\"mn\" id=\"MathJax-Span-710\" style=\"font-family: STIXGeneral-Regular;\">64</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1001.15em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.148em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-711\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">≈</span><span class=\"mn\" id=\"MathJax-Span-712\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">0.01563</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.934em; border-left: 0px solid; width: 0px; height: 2.628em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>RRF</mtext><mo stretchy=\"false\">(</mo><mtext>DocD</mtext><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>4</mn></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>64</mn></mfrac><mo>≈</mo><mn>0.01563</mn></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-67\">\\text{RRF}(\\text{DocD})\n= \\frac{1}{60 + 4}\n= \\frac{1}{64}\n\\approx 0.01563</script>\n          </li>\n          <li>\n            <p><strong>DocE</strong> (Rank 5 in BM25 only):</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-68-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>RRF</mtext><mo stretchy=&quot;false&quot;>(</mo><mtext>DocE</mtext><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>5</mn></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>65</mn></mfrac><mo>&amp;#x2248;</mo><mn>0.01538</mn></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-713\" style=\"width: 19.273em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 16.044em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.68em, 1015.99em, 3.076em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-714\"><span class=\"mtext\" id=\"MathJax-Span-715\" style=\"font-family: STIXGeneral-Regular;\">RRF</span><span class=\"mo\" id=\"MathJax-Span-716\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mtext\" id=\"MathJax-Span-717\" style=\"font-family: STIXGeneral-Regular;\">DocE</span><span class=\"mo\" id=\"MathJax-Span-718\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-719\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-720\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 2.815em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-721\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1002.66em, 4.221em, -999.997em); top: -3.331em; left: 50%; margin-left: -1.352em;\"><span class=\"mrow\" id=\"MathJax-Span-722\"><span class=\"mn\" id=\"MathJax-Span-723\" style=\"font-family: STIXGeneral-Regular;\">60</span><span class=\"mo\" id=\"MathJax-Span-724\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mn\" id=\"MathJax-Span-725\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">5</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1002.82em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.815em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-726\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-727\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-728\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1000.94em, 4.169em, -999.997em); top: -3.331em; left: 50%; margin-left: -0.518em;\"><span class=\"mn\" id=\"MathJax-Span-729\" style=\"font-family: STIXGeneral-Regular;\">65</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1001.15em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.148em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-730\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">≈</span><span class=\"mn\" id=\"MathJax-Span-731\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">0.01538</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.934em; border-left: 0px solid; width: 0px; height: 2.628em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>RRF</mtext><mo stretchy=\"false\">(</mo><mtext>DocE</mtext><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>5</mn></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>65</mn></mfrac><mo>≈</mo><mn>0.01538</mn></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-68\">\\text{RRF}(\\text{DocE})\n= \\frac{1}{60 + 5}\n= \\frac{1}{65}\n\\approx 0.01538</script>\n          </li>\n          <li>\n            <p><strong>DocF</strong> (Rank 1 in Neural Retriever only):</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-69-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>RRF</mtext><mo stretchy=&quot;false&quot;>(</mo><mtext>DocF</mtext><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>1</mn></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>61</mn></mfrac><mo>&amp;#x2248;</mo><mn>0.01639</mn></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-732\" style=\"width: 19.221em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 15.992em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.68em, 1015.94em, 3.076em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-733\"><span class=\"mtext\" id=\"MathJax-Span-734\" style=\"font-family: STIXGeneral-Regular;\">RRF</span><span class=\"mo\" id=\"MathJax-Span-735\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mtext\" id=\"MathJax-Span-736\" style=\"font-family: STIXGeneral-Regular;\">DocF</span><span class=\"mo\" id=\"MathJax-Span-737\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-738\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-739\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 2.815em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-740\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1002.61em, 4.221em, -999.997em); top: -3.331em; left: 50%; margin-left: -1.352em;\"><span class=\"mrow\" id=\"MathJax-Span-741\"><span class=\"mn\" id=\"MathJax-Span-742\" style=\"font-family: STIXGeneral-Regular;\">60</span><span class=\"mo\" id=\"MathJax-Span-743\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mn\" id=\"MathJax-Span-744\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">1</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1002.82em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.815em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-745\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-746\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-747\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -3.331em; left: 50%; margin-left: -0.518em;\"><span class=\"mn\" id=\"MathJax-Span-748\" style=\"font-family: STIXGeneral-Regular;\">61</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1001.15em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.148em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-749\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">≈</span><span class=\"mn\" id=\"MathJax-Span-750\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">0.01639</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.934em; border-left: 0px solid; width: 0px; height: 2.628em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>RRF</mtext><mo stretchy=\"false\">(</mo><mtext>DocF</mtext><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>1</mn></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>61</mn></mfrac><mo>≈</mo><mn>0.01639</mn></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-69\">\\text{RRF}(\\text{DocF})\n= \\frac{1}{60 + 1}\n= \\frac{1}{61}\n\\approx 0.01639</script>\n          </li>\n          <li>\n            <p><strong>DocG</strong> (Rank 4 in Neural Retriever only):</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-70-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>RRF</mtext><mo stretchy=&quot;false&quot;>(</mo><mtext>DocG</mtext><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>4</mn></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>64</mn></mfrac><mo>&amp;#x2248;</mo><mn>0.01563</mn></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-751\" style=\"width: 19.378em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 16.148em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.68em, 1016.1em, 3.076em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-752\"><span class=\"mtext\" id=\"MathJax-Span-753\" style=\"font-family: STIXGeneral-Regular;\">RRF</span><span class=\"mo\" id=\"MathJax-Span-754\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mtext\" id=\"MathJax-Span-755\" style=\"font-family: STIXGeneral-Regular;\">DocG</span><span class=\"mo\" id=\"MathJax-Span-756\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-757\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-758\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 2.815em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-759\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1002.71em, 4.221em, -999.997em); top: -3.331em; left: 50%; margin-left: -1.352em;\"><span class=\"mrow\" id=\"MathJax-Span-760\"><span class=\"mn\" id=\"MathJax-Span-761\" style=\"font-family: STIXGeneral-Regular;\">60</span><span class=\"mo\" id=\"MathJax-Span-762\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mn\" id=\"MathJax-Span-763\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">4</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1002.82em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.815em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-764\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-765\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-766\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1000.99em, 4.169em, -999.997em); top: -3.331em; left: 50%; margin-left: -0.518em;\"><span class=\"mn\" id=\"MathJax-Span-767\" style=\"font-family: STIXGeneral-Regular;\">64</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1001.15em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.148em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-768\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">≈</span><span class=\"mn\" id=\"MathJax-Span-769\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">0.01563</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.934em; border-left: 0px solid; width: 0px; height: 2.628em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>RRF</mtext><mo stretchy=\"false\">(</mo><mtext>DocG</mtext><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>4</mn></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>64</mn></mfrac><mo>≈</mo><mn>0.01563</mn></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-70\">\\text{RRF}(\\text{DocG})\n= \\frac{1}{60 + 4}\n= \\frac{1}{64}\n\\approx 0.01563</script>\n          </li>\n        </ul>\n      </li>\n      <li>\n        <p>After computing scores for all documents, the final RRF ranking is obtained by sorting documents in descending order of their cumulative RRF scores.</p>\n      </li>\n      <li>This example illustrates the key property of RRF: documents that rank reasonably well across multiple retrieval systems (DocA, DocC, DocB) rise above documents that dominate only a single ranking, even if that dominance is at rank 1. Put simply, RRF rewards consistent relevance across retrieval strategies rather than dominance in a single system.</li>\n    </ul>\n  </li>\n</ul>\n<p>One of the most popular and robust fusion techniques used in hybrid retrieval is Reciprocal Rank Fusion (RRF). RRF merges the rankings from different retrieval models (for example, BM25 and a neural retriever) by assigning higher scores to documents that consistently rank well across systems, rather than relying on raw scores.</p>\n<p>RRF operates purely on rank positions, making it insensitive to score scale (i.e., it lacks the need for normalization unlike linear score fusion), distribution, or calibration differences between retrieval methods.</p>\n<p><strong>How RRF works:</strong></p>\n<ul>\n      <li>Each retrieval system independently produces a ranked list of documents.</li>\n      <li>Each document receives a contribution based on its rank position in each list.</li>\n      <li>\n        <p>Contributions are summed to produce a final fusion score.</p>\n      </li>\n      <li>\n        <p>The RRF scoring function is:</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-54-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>RRF Score</mtext><mo stretchy=&quot;false&quot;>(</mo><mi>d</mi><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><munderover><mo>&amp;#x2211;</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>n</mi></mrow></munderover><mfrac><mn>1</mn><mrow><mi>k</mi><mo>+</mo><msub><mtext>rank</mtext><mi>i</mi></msub><mo stretchy=&quot;false&quot;>(</mo><mi>d</mi><mo stretchy=&quot;false&quot;>)</mo></mrow></mfrac></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-526\" style=\"width: 16.357em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 13.596em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.419em, 1013.6em, 3.596em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-527\"><span class=\"mtext\" id=\"MathJax-Span-528\" style=\"font-family: STIXGeneral-Regular;\">RRF Score</span><span class=\"mo\" id=\"MathJax-Span-529\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-530\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-531\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-532\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"munderover\" id=\"MathJax-Span-533\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 1.305em; height: 0px;\"><span style=\"position: absolute; clip: rect(2.867em, 1001.2em, 4.638em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mo\" id=\"MathJax-Span-534\" style=\"font-family: STIXSizeOneSym; vertical-align: -0.518em;\">∑</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1000.94em, 4.273em, -999.997em); top: -2.862em; left: 0.107em;\"><span class=\"texatom\" id=\"MathJax-Span-535\"><span class=\"mrow\" id=\"MathJax-Span-536\"><span class=\"mi\" id=\"MathJax-Span-537\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">i</span><span class=\"mo\" id=\"MathJax-Span-538\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">=</span><span class=\"mn\" id=\"MathJax-Span-539\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.44em, 1000.32em, 4.169em, -999.997em); top: -5.206em; left: 0.471em;\"><span class=\"texatom\" id=\"MathJax-Span-540\"><span class=\"mrow\" id=\"MathJax-Span-541\"><span class=\"mi\" id=\"MathJax-Span-542\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">n</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mfrac\" id=\"MathJax-Span-543\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 5.055em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-544\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1004.85em, 4.326em, -999.997em); top: -3.331em; left: 50%; margin-left: -2.445em;\"><span class=\"mrow\" id=\"MathJax-Span-545\"><span class=\"mi\" id=\"MathJax-Span-546\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-547\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"msubsup\" id=\"MathJax-Span-548\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.034em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1001.77em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mtext\" id=\"MathJax-Span-549\" style=\"font-family: STIXGeneral-Regular;\">rank</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 1.773em;\"><span class=\"mi\" id=\"MathJax-Span-550\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-551\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-552\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-553\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1005.05em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 5.055em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -1.559em; border-left: 0px solid; width: 0px; height: 3.566em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>RRF Score</mtext><mo stretchy=\"false\">(</mo><mi>d</mi><mo stretchy=\"false\">)</mo><mo>=</mo><munderover><mo>∑</mo><mrow class=\"MJX-TeXAtom-ORD\"><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mrow class=\"MJX-TeXAtom-ORD\"><mi>n</mi></mrow></munderover><mfrac><mn>1</mn><mrow><mi>k</mi><mo>+</mo><msub><mtext>rank</mtext><mi>i</mi></msub><mo stretchy=\"false\">(</mo><mi>d</mi><mo stretchy=\"false\">)</mo></mrow></mfrac></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-54\">\\text{RRF Score}(d) =\n\\sum_{i=1}^{n}\n\\frac{1}{k + \\text{rank}_i(d)}</script>\n\n        <ul>\n          <li>\n            <p>where:</p>\n\n            <ul>\n              <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-55-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>d</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-554\" style=\"width: 0.732em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.576em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.58em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-555\"><span class=\"mi\" id=\"MathJax-Span-556\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>d</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-55\">d</script> is the document,</li>\n              <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-56-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mtext>rank</mtext><mi>i</mi></msub><mo stretchy=&quot;false&quot;>(</mo><mi>d</mi><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-557\" style=\"width: 3.961em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 3.284em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1003.23em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-558\"><span class=\"msubsup\" id=\"MathJax-Span-559\"><span style=\"display: inline-block; position: relative; width: 2.034em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1001.77em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mtext\" id=\"MathJax-Span-560\" style=\"font-family: STIXGeneral-Regular;\">rank</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 1.773em;\"><span class=\"mi\" id=\"MathJax-Span-561\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-562\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-563\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-564\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mtext>rank</mtext><mi>i</mi></msub><mo stretchy=\"false\">(</mo><mi>d</mi><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-56\">\\text{rank}_i(d)</script> is the rank position of document <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-57-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>d</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-565\" style=\"width: 0.732em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.576em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.58em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-566\"><span class=\"mi\" id=\"MathJax-Span-567\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>d</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-57\">d</script> in the <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-58-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msup><mi>i</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>th</mtext></mrow></msup></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-568\" style=\"width: 1.096em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.888em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.148em, 1000.89em, 2.294em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-569\"><span class=\"msubsup\" id=\"MathJax-Span-570\"><span style=\"display: inline-block; position: relative; width: 0.888em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.26em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-571\" style=\"font-family: STIXGeneral-Italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.372em; left: 0.263em;\"><span class=\"texatom\" id=\"MathJax-Span-572\"><span class=\"mrow\" id=\"MathJax-Span-573\"><span class=\"mtext\" id=\"MathJax-Span-574\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">th</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msup><mi>i</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>th</mtext></mrow></msup></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-58\">i^{\\text{th}}</script> ranked list,</li>\n              <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-59-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-575\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-576\"><span class=\"mi\" id=\"MathJax-Span-577\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-59\">k</script> is a smoothing constant (typically set to 60),</li>\n              <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-60-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>n</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-578\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-579\"><span class=\"mi\" id=\"MathJax-Span-580\" style=\"font-family: STIXGeneral-Italic;\">n</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>n</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-60\">n</script> is the number of retrieval systems.</li>\n            </ul>\n          </li>\n        </ul>\n      </li>\n      <li>\n        <p>The constant <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-61-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-581\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-582\"><span class=\"mi\" id=\"MathJax-Span-583\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-61\">k</script> ensures that:</p>\n\n        <ul>\n          <li>Top-ranked documents dominate the contribution</li>\n          <li>Differences among lower-ranked documents are compressed</li>\n          <li>Noise from deep rankings does not overwhelm the fusion</li>\n        </ul>\n      </li>\n    </ul>\n<p>Contributions are summed to produce a final fusion score.</p>\n<p>The RRF scoring function is:</p>\n<ul>\n          <li>\n            <p>where:</p>\n\n            <ul>\n              <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-55-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>d</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-554\" style=\"width: 0.732em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.576em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.58em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-555\"><span class=\"mi\" id=\"MathJax-Span-556\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>d</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-55\">d</script> is the document,</li>\n              <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-56-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mtext>rank</mtext><mi>i</mi></msub><mo stretchy=&quot;false&quot;>(</mo><mi>d</mi><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-557\" style=\"width: 3.961em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 3.284em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1003.23em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-558\"><span class=\"msubsup\" id=\"MathJax-Span-559\"><span style=\"display: inline-block; position: relative; width: 2.034em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1001.77em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mtext\" id=\"MathJax-Span-560\" style=\"font-family: STIXGeneral-Regular;\">rank</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 1.773em;\"><span class=\"mi\" id=\"MathJax-Span-561\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-562\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-563\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-564\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mtext>rank</mtext><mi>i</mi></msub><mo stretchy=\"false\">(</mo><mi>d</mi><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-56\">\\text{rank}_i(d)</script> is the rank position of document <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-57-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>d</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-565\" style=\"width: 0.732em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.576em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.58em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-566\"><span class=\"mi\" id=\"MathJax-Span-567\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>d</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-57\">d</script> in the <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-58-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msup><mi>i</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>th</mtext></mrow></msup></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-568\" style=\"width: 1.096em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.888em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.148em, 1000.89em, 2.294em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-569\"><span class=\"msubsup\" id=\"MathJax-Span-570\"><span style=\"display: inline-block; position: relative; width: 0.888em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.26em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-571\" style=\"font-family: STIXGeneral-Italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.372em; left: 0.263em;\"><span class=\"texatom\" id=\"MathJax-Span-572\"><span class=\"mrow\" id=\"MathJax-Span-573\"><span class=\"mtext\" id=\"MathJax-Span-574\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">th</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msup><mi>i</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>th</mtext></mrow></msup></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-58\">i^{\\text{th}}</script> ranked list,</li>\n              <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-59-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-575\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-576\"><span class=\"mi\" id=\"MathJax-Span-577\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-59\">k</script> is a smoothing constant (typically set to 60),</li>\n              <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-60-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>n</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-578\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-579\"><span class=\"mi\" id=\"MathJax-Span-580\" style=\"font-family: STIXGeneral-Italic;\">n</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>n</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-60\">n</script> is the number of retrieval systems.</li>\n            </ul>\n          </li>\n        </ul>\n<p>where:</p>\n<ul>\n              <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-55-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>d</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-554\" style=\"width: 0.732em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.576em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.58em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-555\"><span class=\"mi\" id=\"MathJax-Span-556\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>d</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-55\">d</script> is the document,</li>\n              <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-56-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mtext>rank</mtext><mi>i</mi></msub><mo stretchy=&quot;false&quot;>(</mo><mi>d</mi><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-557\" style=\"width: 3.961em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 3.284em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1003.23em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-558\"><span class=\"msubsup\" id=\"MathJax-Span-559\"><span style=\"display: inline-block; position: relative; width: 2.034em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1001.77em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mtext\" id=\"MathJax-Span-560\" style=\"font-family: STIXGeneral-Regular;\">rank</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 1.773em;\"><span class=\"mi\" id=\"MathJax-Span-561\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-562\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-563\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-564\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mtext>rank</mtext><mi>i</mi></msub><mo stretchy=\"false\">(</mo><mi>d</mi><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-56\">\\text{rank}_i(d)</script> is the rank position of document <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-57-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>d</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-565\" style=\"width: 0.732em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.576em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.58em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-566\"><span class=\"mi\" id=\"MathJax-Span-567\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>d</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-57\">d</script> in the <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-58-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msup><mi>i</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>th</mtext></mrow></msup></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-568\" style=\"width: 1.096em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.888em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.148em, 1000.89em, 2.294em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-569\"><span class=\"msubsup\" id=\"MathJax-Span-570\"><span style=\"display: inline-block; position: relative; width: 0.888em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.26em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-571\" style=\"font-family: STIXGeneral-Italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.372em; left: 0.263em;\"><span class=\"texatom\" id=\"MathJax-Span-572\"><span class=\"mrow\" id=\"MathJax-Span-573\"><span class=\"mtext\" id=\"MathJax-Span-574\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">th</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msup><mi>i</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>th</mtext></mrow></msup></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-58\">i^{\\text{th}}</script> ranked list,</li>\n              <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-59-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-575\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-576\"><span class=\"mi\" id=\"MathJax-Span-577\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-59\">k</script> is a smoothing constant (typically set to 60),</li>\n              <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-60-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>n</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-578\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-579\"><span class=\"mi\" id=\"MathJax-Span-580\" style=\"font-family: STIXGeneral-Italic;\">n</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>n</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-60\">n</script> is the number of retrieval systems.</li>\n            </ul>\n<p>The constant <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-61-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-581\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-582\"><span class=\"mi\" id=\"MathJax-Span-583\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-61\">k</script> ensures that:</p>\n<ul>\n          <li>Top-ranked documents dominate the contribution</li>\n          <li>Differences among lower-ranked documents are compressed</li>\n          <li>Noise from deep rankings does not overwhelm the fusion</li>\n        </ul>\n<p><strong>Intuition behind RRF:</strong></p>\n<ul>\n      <li>The intuition behind RRF being especially well suited for hybrid lexical–semantic retrieval is as follows:\n        <ul>\n          <li>Documents that appear near the top in multiple rankings are strongly favored.</li>\n          <li>A document that ranks moderately well in several systems often beats one that ranks extremely well in only one.</li>\n          <li>Systems with very different scoring behavior can still be combined reliably.</li>\n        </ul>\n      </li>\n    </ul>\n<ul>\n          <li>Documents that appear near the top in multiple rankings are strongly favored.</li>\n          <li>A document that ranks moderately well in several systems often beats one that ranks extremely well in only one.</li>\n          <li>Systems with very different scoring behavior can still be combined reliably.</li>\n        </ul>\n<p><strong>Example:</strong></p>\n<ul>\n      <li>\n        <p>Suppose two retrieval systems return the following output results for a query:</p>\n\n        <ul>\n          <li>BM25: <code class=\"language-plaintext highlighter-rouge\">[DocA, DocB, DocC, DocD, DocE]</code></li>\n          <li>Neural Retriever: <code class=\"language-plaintext highlighter-rouge\">[DocF, DocC, DocA, DocG, DocB]</code></li>\n        </ul>\n      </li>\n      <li>We use <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-62-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi><mo>=</mo><mn>60</mn></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-584\" style=\"width: 3.284em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.711em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1002.71em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-585\"><span class=\"mi\" id=\"MathJax-Span-586\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-587\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-588\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">60</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi><mo>=</mo><mn>60</mn></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-62\">k = 60</script>.</li>\n      <li>\n        <p>Note that if a document does not appear at a output of a retriever, it contributes <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-63-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>0</mn></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-589\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-590\"><span class=\"mn\" id=\"MathJax-Span-591\" style=\"font-family: STIXGeneral-Regular;\">0</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mn>0</mn></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-63\">0</script> from that list.</p>\n      </li>\n      <li>\n        <p>RRF scores are computed as follows:</p>\n\n        <ul>\n          <li>\n            <p><strong>DocA</strong> (Rank 1 in BM25, rank 3 in Neural Retriever):</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-64-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>RRF</mtext><mo stretchy=&quot;false&quot;>(</mo><mtext>DocA</mtext><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>1</mn></mrow></mfrac><mo>+</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>3</mn></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>61</mn></mfrac><mo>+</mo><mfrac><mn>1</mn><mn>63</mn></mfrac><mo>&amp;#x2248;</mo><mn>0.01639</mn><mo>+</mo><mn>0.01587</mn><mo>=</mo><mn>0.03226</mn></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-592\" style=\"width: 37.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 31.513em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.68em, 1031.46em, 3.076em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-593\"><span class=\"mtext\" id=\"MathJax-Span-594\" style=\"font-family: STIXGeneral-Regular;\">RRF</span><span class=\"mo\" id=\"MathJax-Span-595\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mtext\" id=\"MathJax-Span-596\" style=\"font-family: STIXGeneral-Regular;\">DocA</span><span class=\"mo\" id=\"MathJax-Span-597\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-598\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-599\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 2.815em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-600\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1002.61em, 4.221em, -999.997em); top: -3.331em; left: 50%; margin-left: -1.352em;\"><span class=\"mrow\" id=\"MathJax-Span-601\"><span class=\"mn\" id=\"MathJax-Span-602\" style=\"font-family: STIXGeneral-Regular;\">60</span><span class=\"mo\" id=\"MathJax-Span-603\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mn\" id=\"MathJax-Span-604\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">1</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1002.82em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.815em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-605\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mfrac\" id=\"MathJax-Span-606\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.815em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-607\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1002.66em, 4.221em, -999.997em); top: -3.331em; left: 50%; margin-left: -1.352em;\"><span class=\"mrow\" id=\"MathJax-Span-608\"><span class=\"mn\" id=\"MathJax-Span-609\" style=\"font-family: STIXGeneral-Regular;\">60</span><span class=\"mo\" id=\"MathJax-Span-610\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mn\" id=\"MathJax-Span-611\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">3</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1002.82em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.815em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-612\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-613\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-614\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -3.331em; left: 50%; margin-left: -0.518em;\"><span class=\"mn\" id=\"MathJax-Span-615\" style=\"font-family: STIXGeneral-Regular;\">61</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1001.15em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.148em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-616\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mfrac\" id=\"MathJax-Span-617\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-618\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1000.94em, 4.169em, -999.997em); top: -3.331em; left: 50%; margin-left: -0.518em;\"><span class=\"mn\" id=\"MathJax-Span-619\" style=\"font-family: STIXGeneral-Regular;\">63</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1001.15em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.148em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-620\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">≈</span><span class=\"mn\" id=\"MathJax-Span-621\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">0.01639</span><span class=\"mo\" id=\"MathJax-Span-622\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mn\" id=\"MathJax-Span-623\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">0.01587</span><span class=\"mo\" id=\"MathJax-Span-624\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-625\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">0.03226</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.934em; border-left: 0px solid; width: 0px; height: 2.628em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>RRF</mtext><mo stretchy=\"false\">(</mo><mtext>DocA</mtext><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>1</mn></mrow></mfrac><mo>+</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>3</mn></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>61</mn></mfrac><mo>+</mo><mfrac><mn>1</mn><mn>63</mn></mfrac><mo>≈</mo><mn>0.01639</mn><mo>+</mo><mn>0.01587</mn><mo>=</mo><mn>0.03226</mn></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-64\">\\text{RRF}(\\text{DocA})\n= \\frac{1}{60 + 1} + \\frac{1}{60 + 3}\n= \\frac{1}{61} + \\frac{1}{63}\n\\approx 0.01639 + 0.01587\n= 0.03226</script>\n          </li>\n          <li>\n            <p><strong>DocB</strong> (Rank 2 in BM25, rank 5 in Neural Retriever):</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-65-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>RRF</mtext><mo stretchy=&quot;false&quot;>(</mo><mtext>DocB</mtext><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>2</mn></mrow></mfrac><mo>+</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>5</mn></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>62</mn></mfrac><mo>+</mo><mfrac><mn>1</mn><mn>65</mn></mfrac><mo>&amp;#x2248;</mo><mn>0.01613</mn><mo>+</mo><mn>0.01538</mn><mo>=</mo><mn>0.03151</mn></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-626\" style=\"width: 37.763em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 31.461em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.68em, 1031.36em, 3.076em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-627\"><span class=\"mtext\" id=\"MathJax-Span-628\" style=\"font-family: STIXGeneral-Regular;\">RRF</span><span class=\"mo\" id=\"MathJax-Span-629\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mtext\" id=\"MathJax-Span-630\" style=\"font-family: STIXGeneral-Regular;\">DocB</span><span class=\"mo\" id=\"MathJax-Span-631\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-632\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-633\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 2.815em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-634\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1002.71em, 4.221em, -999.997em); top: -3.331em; left: 50%; margin-left: -1.352em;\"><span class=\"mrow\" id=\"MathJax-Span-635\"><span class=\"mn\" id=\"MathJax-Span-636\" style=\"font-family: STIXGeneral-Regular;\">60</span><span class=\"mo\" id=\"MathJax-Span-637\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mn\" id=\"MathJax-Span-638\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">2</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1002.82em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.815em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-639\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mfrac\" id=\"MathJax-Span-640\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.815em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-641\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1002.66em, 4.221em, -999.997em); top: -3.331em; left: 50%; margin-left: -1.352em;\"><span class=\"mrow\" id=\"MathJax-Span-642\"><span class=\"mn\" id=\"MathJax-Span-643\" style=\"font-family: STIXGeneral-Regular;\">60</span><span class=\"mo\" id=\"MathJax-Span-644\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mn\" id=\"MathJax-Span-645\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">5</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1002.82em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.815em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-646\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-647\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-648\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1000.99em, 4.169em, -999.997em); top: -3.331em; left: 50%; margin-left: -0.518em;\"><span class=\"mn\" id=\"MathJax-Span-649\" style=\"font-family: STIXGeneral-Regular;\">62</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1001.15em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.148em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-650\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mfrac\" id=\"MathJax-Span-651\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-652\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1000.94em, 4.169em, -999.997em); top: -3.331em; left: 50%; margin-left: -0.518em;\"><span class=\"mn\" id=\"MathJax-Span-653\" style=\"font-family: STIXGeneral-Regular;\">65</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1001.15em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.148em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-654\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">≈</span><span class=\"mn\" id=\"MathJax-Span-655\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">0.01613</span><span class=\"mo\" id=\"MathJax-Span-656\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mn\" id=\"MathJax-Span-657\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">0.01538</span><span class=\"mo\" id=\"MathJax-Span-658\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-659\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">0.03151</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.934em; border-left: 0px solid; width: 0px; height: 2.628em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>RRF</mtext><mo stretchy=\"false\">(</mo><mtext>DocB</mtext><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>2</mn></mrow></mfrac><mo>+</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>5</mn></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>62</mn></mfrac><mo>+</mo><mfrac><mn>1</mn><mn>65</mn></mfrac><mo>≈</mo><mn>0.01613</mn><mo>+</mo><mn>0.01538</mn><mo>=</mo><mn>0.03151</mn></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-65\">\\text{RRF}(\\text{DocB})\n= \\frac{1}{60 + 2} + \\frac{1}{60 + 5}\n= \\frac{1}{62} + \\frac{1}{65}\n\\approx 0.01613 + 0.01538\n= 0.03151</script>\n          </li>\n          <li>\n            <p><strong>DocC</strong> (Rank 3 in BM25, rank 2 in Neural Retriever):</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-66-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>RRF</mtext><mo stretchy=&quot;false&quot;>(</mo><mtext>DocC</mtext><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>3</mn></mrow></mfrac><mo>+</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>2</mn></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>63</mn></mfrac><mo>+</mo><mfrac><mn>1</mn><mn>62</mn></mfrac><mo>&amp;#x2248;</mo><mn>0.01587</mn><mo>+</mo><mn>0.01613</mn><mo>=</mo><mn>0.03200</mn></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-660\" style=\"width: 37.763em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 31.461em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.68em, 1031.46em, 3.076em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-661\"><span class=\"mtext\" id=\"MathJax-Span-662\" style=\"font-family: STIXGeneral-Regular;\">RRF</span><span class=\"mo\" id=\"MathJax-Span-663\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mtext\" id=\"MathJax-Span-664\" style=\"font-family: STIXGeneral-Regular;\">DocC</span><span class=\"mo\" id=\"MathJax-Span-665\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-666\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-667\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 2.815em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-668\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1002.66em, 4.221em, -999.997em); top: -3.331em; left: 50%; margin-left: -1.352em;\"><span class=\"mrow\" id=\"MathJax-Span-669\"><span class=\"mn\" id=\"MathJax-Span-670\" style=\"font-family: STIXGeneral-Regular;\">60</span><span class=\"mo\" id=\"MathJax-Span-671\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mn\" id=\"MathJax-Span-672\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">3</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1002.82em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.815em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-673\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mfrac\" id=\"MathJax-Span-674\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.815em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-675\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1002.71em, 4.221em, -999.997em); top: -3.331em; left: 50%; margin-left: -1.352em;\"><span class=\"mrow\" id=\"MathJax-Span-676\"><span class=\"mn\" id=\"MathJax-Span-677\" style=\"font-family: STIXGeneral-Regular;\">60</span><span class=\"mo\" id=\"MathJax-Span-678\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mn\" id=\"MathJax-Span-679\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">2</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1002.82em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.815em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-680\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-681\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-682\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1000.94em, 4.169em, -999.997em); top: -3.331em; left: 50%; margin-left: -0.518em;\"><span class=\"mn\" id=\"MathJax-Span-683\" style=\"font-family: STIXGeneral-Regular;\">63</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1001.15em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.148em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-684\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mfrac\" id=\"MathJax-Span-685\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-686\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1000.99em, 4.169em, -999.997em); top: -3.331em; left: 50%; margin-left: -0.518em;\"><span class=\"mn\" id=\"MathJax-Span-687\" style=\"font-family: STIXGeneral-Regular;\">62</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1001.15em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.148em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-688\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">≈</span><span class=\"mn\" id=\"MathJax-Span-689\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">0.01587</span><span class=\"mo\" id=\"MathJax-Span-690\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mn\" id=\"MathJax-Span-691\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">0.01613</span><span class=\"mo\" id=\"MathJax-Span-692\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-693\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">0.03200</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.934em; border-left: 0px solid; width: 0px; height: 2.628em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>RRF</mtext><mo stretchy=\"false\">(</mo><mtext>DocC</mtext><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>3</mn></mrow></mfrac><mo>+</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>2</mn></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>63</mn></mfrac><mo>+</mo><mfrac><mn>1</mn><mn>62</mn></mfrac><mo>≈</mo><mn>0.01587</mn><mo>+</mo><mn>0.01613</mn><mo>=</mo><mn>0.03200</mn></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-66\">\\text{RRF}(\\text{DocC})\n= \\frac{1}{60 + 3} + \\frac{1}{60 + 2}\n= \\frac{1}{63} + \\frac{1}{62}\n\\approx 0.01587 + 0.01613\n= 0.03200</script>\n          </li>\n          <li>\n            <p><strong>DocD</strong> (Rank 4 in BM25 only):</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-67-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>RRF</mtext><mo stretchy=&quot;false&quot;>(</mo><mtext>DocD</mtext><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>4</mn></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>64</mn></mfrac><mo>&amp;#x2248;</mo><mn>0.01563</mn></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-694\" style=\"width: 19.378em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 16.148em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.68em, 1016.1em, 3.076em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-695\"><span class=\"mtext\" id=\"MathJax-Span-696\" style=\"font-family: STIXGeneral-Regular;\">RRF</span><span class=\"mo\" id=\"MathJax-Span-697\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mtext\" id=\"MathJax-Span-698\" style=\"font-family: STIXGeneral-Regular;\">DocD</span><span class=\"mo\" id=\"MathJax-Span-699\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-700\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-701\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 2.815em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-702\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1002.71em, 4.221em, -999.997em); top: -3.331em; left: 50%; margin-left: -1.352em;\"><span class=\"mrow\" id=\"MathJax-Span-703\"><span class=\"mn\" id=\"MathJax-Span-704\" style=\"font-family: STIXGeneral-Regular;\">60</span><span class=\"mo\" id=\"MathJax-Span-705\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mn\" id=\"MathJax-Span-706\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">4</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1002.82em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.815em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-707\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-708\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-709\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1000.99em, 4.169em, -999.997em); top: -3.331em; left: 50%; margin-left: -0.518em;\"><span class=\"mn\" id=\"MathJax-Span-710\" style=\"font-family: STIXGeneral-Regular;\">64</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1001.15em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.148em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-711\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">≈</span><span class=\"mn\" id=\"MathJax-Span-712\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">0.01563</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.934em; border-left: 0px solid; width: 0px; height: 2.628em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>RRF</mtext><mo stretchy=\"false\">(</mo><mtext>DocD</mtext><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>4</mn></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>64</mn></mfrac><mo>≈</mo><mn>0.01563</mn></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-67\">\\text{RRF}(\\text{DocD})\n= \\frac{1}{60 + 4}\n= \\frac{1}{64}\n\\approx 0.01563</script>\n          </li>\n          <li>\n            <p><strong>DocE</strong> (Rank 5 in BM25 only):</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-68-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>RRF</mtext><mo stretchy=&quot;false&quot;>(</mo><mtext>DocE</mtext><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>5</mn></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>65</mn></mfrac><mo>&amp;#x2248;</mo><mn>0.01538</mn></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-713\" style=\"width: 19.273em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 16.044em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.68em, 1015.99em, 3.076em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-714\"><span class=\"mtext\" id=\"MathJax-Span-715\" style=\"font-family: STIXGeneral-Regular;\">RRF</span><span class=\"mo\" id=\"MathJax-Span-716\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mtext\" id=\"MathJax-Span-717\" style=\"font-family: STIXGeneral-Regular;\">DocE</span><span class=\"mo\" id=\"MathJax-Span-718\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-719\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-720\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 2.815em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-721\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1002.66em, 4.221em, -999.997em); top: -3.331em; left: 50%; margin-left: -1.352em;\"><span class=\"mrow\" id=\"MathJax-Span-722\"><span class=\"mn\" id=\"MathJax-Span-723\" style=\"font-family: STIXGeneral-Regular;\">60</span><span class=\"mo\" id=\"MathJax-Span-724\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mn\" id=\"MathJax-Span-725\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">5</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1002.82em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.815em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-726\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-727\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-728\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1000.94em, 4.169em, -999.997em); top: -3.331em; left: 50%; margin-left: -0.518em;\"><span class=\"mn\" id=\"MathJax-Span-729\" style=\"font-family: STIXGeneral-Regular;\">65</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1001.15em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.148em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-730\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">≈</span><span class=\"mn\" id=\"MathJax-Span-731\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">0.01538</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.934em; border-left: 0px solid; width: 0px; height: 2.628em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>RRF</mtext><mo stretchy=\"false\">(</mo><mtext>DocE</mtext><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>5</mn></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>65</mn></mfrac><mo>≈</mo><mn>0.01538</mn></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-68\">\\text{RRF}(\\text{DocE})\n= \\frac{1}{60 + 5}\n= \\frac{1}{65}\n\\approx 0.01538</script>\n          </li>\n          <li>\n            <p><strong>DocF</strong> (Rank 1 in Neural Retriever only):</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-69-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>RRF</mtext><mo stretchy=&quot;false&quot;>(</mo><mtext>DocF</mtext><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>1</mn></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>61</mn></mfrac><mo>&amp;#x2248;</mo><mn>0.01639</mn></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-732\" style=\"width: 19.221em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 15.992em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.68em, 1015.94em, 3.076em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-733\"><span class=\"mtext\" id=\"MathJax-Span-734\" style=\"font-family: STIXGeneral-Regular;\">RRF</span><span class=\"mo\" id=\"MathJax-Span-735\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mtext\" id=\"MathJax-Span-736\" style=\"font-family: STIXGeneral-Regular;\">DocF</span><span class=\"mo\" id=\"MathJax-Span-737\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-738\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-739\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 2.815em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-740\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1002.61em, 4.221em, -999.997em); top: -3.331em; left: 50%; margin-left: -1.352em;\"><span class=\"mrow\" id=\"MathJax-Span-741\"><span class=\"mn\" id=\"MathJax-Span-742\" style=\"font-family: STIXGeneral-Regular;\">60</span><span class=\"mo\" id=\"MathJax-Span-743\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mn\" id=\"MathJax-Span-744\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">1</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1002.82em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.815em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-745\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-746\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-747\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -3.331em; left: 50%; margin-left: -0.518em;\"><span class=\"mn\" id=\"MathJax-Span-748\" style=\"font-family: STIXGeneral-Regular;\">61</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1001.15em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.148em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-749\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">≈</span><span class=\"mn\" id=\"MathJax-Span-750\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">0.01639</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.934em; border-left: 0px solid; width: 0px; height: 2.628em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>RRF</mtext><mo stretchy=\"false\">(</mo><mtext>DocF</mtext><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>1</mn></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>61</mn></mfrac><mo>≈</mo><mn>0.01639</mn></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-69\">\\text{RRF}(\\text{DocF})\n= \\frac{1}{60 + 1}\n= \\frac{1}{61}\n\\approx 0.01639</script>\n          </li>\n          <li>\n            <p><strong>DocG</strong> (Rank 4 in Neural Retriever only):</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-70-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>RRF</mtext><mo stretchy=&quot;false&quot;>(</mo><mtext>DocG</mtext><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>4</mn></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>64</mn></mfrac><mo>&amp;#x2248;</mo><mn>0.01563</mn></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-751\" style=\"width: 19.378em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 16.148em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.68em, 1016.1em, 3.076em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-752\"><span class=\"mtext\" id=\"MathJax-Span-753\" style=\"font-family: STIXGeneral-Regular;\">RRF</span><span class=\"mo\" id=\"MathJax-Span-754\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mtext\" id=\"MathJax-Span-755\" style=\"font-family: STIXGeneral-Regular;\">DocG</span><span class=\"mo\" id=\"MathJax-Span-756\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-757\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-758\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 2.815em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-759\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1002.71em, 4.221em, -999.997em); top: -3.331em; left: 50%; margin-left: -1.352em;\"><span class=\"mrow\" id=\"MathJax-Span-760\"><span class=\"mn\" id=\"MathJax-Span-761\" style=\"font-family: STIXGeneral-Regular;\">60</span><span class=\"mo\" id=\"MathJax-Span-762\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mn\" id=\"MathJax-Span-763\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">4</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1002.82em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.815em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-764\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-765\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-766\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1000.99em, 4.169em, -999.997em); top: -3.331em; left: 50%; margin-left: -0.518em;\"><span class=\"mn\" id=\"MathJax-Span-767\" style=\"font-family: STIXGeneral-Regular;\">64</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1001.15em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.148em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-768\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">≈</span><span class=\"mn\" id=\"MathJax-Span-769\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">0.01563</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.934em; border-left: 0px solid; width: 0px; height: 2.628em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>RRF</mtext><mo stretchy=\"false\">(</mo><mtext>DocG</mtext><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>4</mn></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>64</mn></mfrac><mo>≈</mo><mn>0.01563</mn></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-70\">\\text{RRF}(\\text{DocG})\n= \\frac{1}{60 + 4}\n= \\frac{1}{64}\n\\approx 0.01563</script>\n          </li>\n        </ul>\n      </li>\n      <li>\n        <p>After computing scores for all documents, the final RRF ranking is obtained by sorting documents in descending order of their cumulative RRF scores.</p>\n      </li>\n      <li>This example illustrates the key property of RRF: documents that rank reasonably well across multiple retrieval systems (DocA, DocC, DocB) rise above documents that dominate only a single ranking, even if that dominance is at rank 1. Put simply, RRF rewards consistent relevance across retrieval strategies rather than dominance in a single system.</li>\n    </ul>\n<p>Suppose two retrieval systems return the following output results for a query:</p>\n<ul>\n          <li>BM25: <code class=\"language-plaintext highlighter-rouge\">[DocA, DocB, DocC, DocD, DocE]</code></li>\n          <li>Neural Retriever: <code class=\"language-plaintext highlighter-rouge\">[DocF, DocC, DocA, DocG, DocB]</code></li>\n        </ul>\n<p>Note that if a document does not appear at a output of a retriever, it contributes <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-63-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>0</mn></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-589\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-590\"><span class=\"mn\" id=\"MathJax-Span-591\" style=\"font-family: STIXGeneral-Regular;\">0</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mn>0</mn></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-63\">0</script> from that list.</p>\n<p>RRF scores are computed as follows:</p>\n<ul>\n          <li>\n            <p><strong>DocA</strong> (Rank 1 in BM25, rank 3 in Neural Retriever):</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-64-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>RRF</mtext><mo stretchy=&quot;false&quot;>(</mo><mtext>DocA</mtext><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>1</mn></mrow></mfrac><mo>+</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>3</mn></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>61</mn></mfrac><mo>+</mo><mfrac><mn>1</mn><mn>63</mn></mfrac><mo>&amp;#x2248;</mo><mn>0.01639</mn><mo>+</mo><mn>0.01587</mn><mo>=</mo><mn>0.03226</mn></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-592\" style=\"width: 37.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 31.513em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.68em, 1031.46em, 3.076em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-593\"><span class=\"mtext\" id=\"MathJax-Span-594\" style=\"font-family: STIXGeneral-Regular;\">RRF</span><span class=\"mo\" id=\"MathJax-Span-595\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mtext\" id=\"MathJax-Span-596\" style=\"font-family: STIXGeneral-Regular;\">DocA</span><span class=\"mo\" id=\"MathJax-Span-597\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-598\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-599\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 2.815em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-600\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1002.61em, 4.221em, -999.997em); top: -3.331em; left: 50%; margin-left: -1.352em;\"><span class=\"mrow\" id=\"MathJax-Span-601\"><span class=\"mn\" id=\"MathJax-Span-602\" style=\"font-family: STIXGeneral-Regular;\">60</span><span class=\"mo\" id=\"MathJax-Span-603\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mn\" id=\"MathJax-Span-604\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">1</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1002.82em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.815em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-605\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mfrac\" id=\"MathJax-Span-606\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.815em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-607\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1002.66em, 4.221em, -999.997em); top: -3.331em; left: 50%; margin-left: -1.352em;\"><span class=\"mrow\" id=\"MathJax-Span-608\"><span class=\"mn\" id=\"MathJax-Span-609\" style=\"font-family: STIXGeneral-Regular;\">60</span><span class=\"mo\" id=\"MathJax-Span-610\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mn\" id=\"MathJax-Span-611\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">3</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1002.82em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.815em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-612\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-613\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-614\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -3.331em; left: 50%; margin-left: -0.518em;\"><span class=\"mn\" id=\"MathJax-Span-615\" style=\"font-family: STIXGeneral-Regular;\">61</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1001.15em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.148em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-616\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mfrac\" id=\"MathJax-Span-617\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-618\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1000.94em, 4.169em, -999.997em); top: -3.331em; left: 50%; margin-left: -0.518em;\"><span class=\"mn\" id=\"MathJax-Span-619\" style=\"font-family: STIXGeneral-Regular;\">63</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1001.15em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.148em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-620\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">≈</span><span class=\"mn\" id=\"MathJax-Span-621\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">0.01639</span><span class=\"mo\" id=\"MathJax-Span-622\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mn\" id=\"MathJax-Span-623\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">0.01587</span><span class=\"mo\" id=\"MathJax-Span-624\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-625\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">0.03226</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.934em; border-left: 0px solid; width: 0px; height: 2.628em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>RRF</mtext><mo stretchy=\"false\">(</mo><mtext>DocA</mtext><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>1</mn></mrow></mfrac><mo>+</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>3</mn></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>61</mn></mfrac><mo>+</mo><mfrac><mn>1</mn><mn>63</mn></mfrac><mo>≈</mo><mn>0.01639</mn><mo>+</mo><mn>0.01587</mn><mo>=</mo><mn>0.03226</mn></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-64\">\\text{RRF}(\\text{DocA})\n= \\frac{1}{60 + 1} + \\frac{1}{60 + 3}\n= \\frac{1}{61} + \\frac{1}{63}\n\\approx 0.01639 + 0.01587\n= 0.03226</script>\n          </li>\n          <li>\n            <p><strong>DocB</strong> (Rank 2 in BM25, rank 5 in Neural Retriever):</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-65-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>RRF</mtext><mo stretchy=&quot;false&quot;>(</mo><mtext>DocB</mtext><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>2</mn></mrow></mfrac><mo>+</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>5</mn></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>62</mn></mfrac><mo>+</mo><mfrac><mn>1</mn><mn>65</mn></mfrac><mo>&amp;#x2248;</mo><mn>0.01613</mn><mo>+</mo><mn>0.01538</mn><mo>=</mo><mn>0.03151</mn></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-626\" style=\"width: 37.763em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 31.461em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.68em, 1031.36em, 3.076em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-627\"><span class=\"mtext\" id=\"MathJax-Span-628\" style=\"font-family: STIXGeneral-Regular;\">RRF</span><span class=\"mo\" id=\"MathJax-Span-629\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mtext\" id=\"MathJax-Span-630\" style=\"font-family: STIXGeneral-Regular;\">DocB</span><span class=\"mo\" id=\"MathJax-Span-631\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-632\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-633\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 2.815em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-634\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1002.71em, 4.221em, -999.997em); top: -3.331em; left: 50%; margin-left: -1.352em;\"><span class=\"mrow\" id=\"MathJax-Span-635\"><span class=\"mn\" id=\"MathJax-Span-636\" style=\"font-family: STIXGeneral-Regular;\">60</span><span class=\"mo\" id=\"MathJax-Span-637\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mn\" id=\"MathJax-Span-638\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">2</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1002.82em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.815em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-639\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mfrac\" id=\"MathJax-Span-640\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.815em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-641\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1002.66em, 4.221em, -999.997em); top: -3.331em; left: 50%; margin-left: -1.352em;\"><span class=\"mrow\" id=\"MathJax-Span-642\"><span class=\"mn\" id=\"MathJax-Span-643\" style=\"font-family: STIXGeneral-Regular;\">60</span><span class=\"mo\" id=\"MathJax-Span-644\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mn\" id=\"MathJax-Span-645\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">5</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1002.82em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.815em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-646\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-647\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-648\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1000.99em, 4.169em, -999.997em); top: -3.331em; left: 50%; margin-left: -0.518em;\"><span class=\"mn\" id=\"MathJax-Span-649\" style=\"font-family: STIXGeneral-Regular;\">62</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1001.15em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.148em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-650\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mfrac\" id=\"MathJax-Span-651\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-652\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1000.94em, 4.169em, -999.997em); top: -3.331em; left: 50%; margin-left: -0.518em;\"><span class=\"mn\" id=\"MathJax-Span-653\" style=\"font-family: STIXGeneral-Regular;\">65</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1001.15em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.148em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-654\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">≈</span><span class=\"mn\" id=\"MathJax-Span-655\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">0.01613</span><span class=\"mo\" id=\"MathJax-Span-656\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mn\" id=\"MathJax-Span-657\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">0.01538</span><span class=\"mo\" id=\"MathJax-Span-658\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-659\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">0.03151</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.934em; border-left: 0px solid; width: 0px; height: 2.628em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>RRF</mtext><mo stretchy=\"false\">(</mo><mtext>DocB</mtext><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>2</mn></mrow></mfrac><mo>+</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>5</mn></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>62</mn></mfrac><mo>+</mo><mfrac><mn>1</mn><mn>65</mn></mfrac><mo>≈</mo><mn>0.01613</mn><mo>+</mo><mn>0.01538</mn><mo>=</mo><mn>0.03151</mn></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-65\">\\text{RRF}(\\text{DocB})\n= \\frac{1}{60 + 2} + \\frac{1}{60 + 5}\n= \\frac{1}{62} + \\frac{1}{65}\n\\approx 0.01613 + 0.01538\n= 0.03151</script>\n          </li>\n          <li>\n            <p><strong>DocC</strong> (Rank 3 in BM25, rank 2 in Neural Retriever):</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-66-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>RRF</mtext><mo stretchy=&quot;false&quot;>(</mo><mtext>DocC</mtext><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>3</mn></mrow></mfrac><mo>+</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>2</mn></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>63</mn></mfrac><mo>+</mo><mfrac><mn>1</mn><mn>62</mn></mfrac><mo>&amp;#x2248;</mo><mn>0.01587</mn><mo>+</mo><mn>0.01613</mn><mo>=</mo><mn>0.03200</mn></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-660\" style=\"width: 37.763em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 31.461em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.68em, 1031.46em, 3.076em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-661\"><span class=\"mtext\" id=\"MathJax-Span-662\" style=\"font-family: STIXGeneral-Regular;\">RRF</span><span class=\"mo\" id=\"MathJax-Span-663\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mtext\" id=\"MathJax-Span-664\" style=\"font-family: STIXGeneral-Regular;\">DocC</span><span class=\"mo\" id=\"MathJax-Span-665\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-666\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-667\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 2.815em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-668\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1002.66em, 4.221em, -999.997em); top: -3.331em; left: 50%; margin-left: -1.352em;\"><span class=\"mrow\" id=\"MathJax-Span-669\"><span class=\"mn\" id=\"MathJax-Span-670\" style=\"font-family: STIXGeneral-Regular;\">60</span><span class=\"mo\" id=\"MathJax-Span-671\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mn\" id=\"MathJax-Span-672\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">3</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1002.82em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.815em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-673\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mfrac\" id=\"MathJax-Span-674\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.815em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-675\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1002.71em, 4.221em, -999.997em); top: -3.331em; left: 50%; margin-left: -1.352em;\"><span class=\"mrow\" id=\"MathJax-Span-676\"><span class=\"mn\" id=\"MathJax-Span-677\" style=\"font-family: STIXGeneral-Regular;\">60</span><span class=\"mo\" id=\"MathJax-Span-678\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mn\" id=\"MathJax-Span-679\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">2</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1002.82em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.815em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-680\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-681\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-682\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1000.94em, 4.169em, -999.997em); top: -3.331em; left: 50%; margin-left: -0.518em;\"><span class=\"mn\" id=\"MathJax-Span-683\" style=\"font-family: STIXGeneral-Regular;\">63</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1001.15em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.148em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-684\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mfrac\" id=\"MathJax-Span-685\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-686\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1000.99em, 4.169em, -999.997em); top: -3.331em; left: 50%; margin-left: -0.518em;\"><span class=\"mn\" id=\"MathJax-Span-687\" style=\"font-family: STIXGeneral-Regular;\">62</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1001.15em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.148em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-688\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">≈</span><span class=\"mn\" id=\"MathJax-Span-689\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">0.01587</span><span class=\"mo\" id=\"MathJax-Span-690\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mn\" id=\"MathJax-Span-691\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">0.01613</span><span class=\"mo\" id=\"MathJax-Span-692\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-693\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">0.03200</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.934em; border-left: 0px solid; width: 0px; height: 2.628em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>RRF</mtext><mo stretchy=\"false\">(</mo><mtext>DocC</mtext><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>3</mn></mrow></mfrac><mo>+</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>2</mn></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>63</mn></mfrac><mo>+</mo><mfrac><mn>1</mn><mn>62</mn></mfrac><mo>≈</mo><mn>0.01587</mn><mo>+</mo><mn>0.01613</mn><mo>=</mo><mn>0.03200</mn></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-66\">\\text{RRF}(\\text{DocC})\n= \\frac{1}{60 + 3} + \\frac{1}{60 + 2}\n= \\frac{1}{63} + \\frac{1}{62}\n\\approx 0.01587 + 0.01613\n= 0.03200</script>\n          </li>\n          <li>\n            <p><strong>DocD</strong> (Rank 4 in BM25 only):</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-67-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>RRF</mtext><mo stretchy=&quot;false&quot;>(</mo><mtext>DocD</mtext><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>4</mn></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>64</mn></mfrac><mo>&amp;#x2248;</mo><mn>0.01563</mn></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-694\" style=\"width: 19.378em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 16.148em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.68em, 1016.1em, 3.076em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-695\"><span class=\"mtext\" id=\"MathJax-Span-696\" style=\"font-family: STIXGeneral-Regular;\">RRF</span><span class=\"mo\" id=\"MathJax-Span-697\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mtext\" id=\"MathJax-Span-698\" style=\"font-family: STIXGeneral-Regular;\">DocD</span><span class=\"mo\" id=\"MathJax-Span-699\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-700\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-701\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 2.815em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-702\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1002.71em, 4.221em, -999.997em); top: -3.331em; left: 50%; margin-left: -1.352em;\"><span class=\"mrow\" id=\"MathJax-Span-703\"><span class=\"mn\" id=\"MathJax-Span-704\" style=\"font-family: STIXGeneral-Regular;\">60</span><span class=\"mo\" id=\"MathJax-Span-705\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mn\" id=\"MathJax-Span-706\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">4</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1002.82em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.815em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-707\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-708\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-709\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1000.99em, 4.169em, -999.997em); top: -3.331em; left: 50%; margin-left: -0.518em;\"><span class=\"mn\" id=\"MathJax-Span-710\" style=\"font-family: STIXGeneral-Regular;\">64</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1001.15em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.148em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-711\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">≈</span><span class=\"mn\" id=\"MathJax-Span-712\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">0.01563</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.934em; border-left: 0px solid; width: 0px; height: 2.628em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>RRF</mtext><mo stretchy=\"false\">(</mo><mtext>DocD</mtext><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>4</mn></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>64</mn></mfrac><mo>≈</mo><mn>0.01563</mn></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-67\">\\text{RRF}(\\text{DocD})\n= \\frac{1}{60 + 4}\n= \\frac{1}{64}\n\\approx 0.01563</script>\n          </li>\n          <li>\n            <p><strong>DocE</strong> (Rank 5 in BM25 only):</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-68-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>RRF</mtext><mo stretchy=&quot;false&quot;>(</mo><mtext>DocE</mtext><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>5</mn></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>65</mn></mfrac><mo>&amp;#x2248;</mo><mn>0.01538</mn></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-713\" style=\"width: 19.273em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 16.044em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.68em, 1015.99em, 3.076em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-714\"><span class=\"mtext\" id=\"MathJax-Span-715\" style=\"font-family: STIXGeneral-Regular;\">RRF</span><span class=\"mo\" id=\"MathJax-Span-716\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mtext\" id=\"MathJax-Span-717\" style=\"font-family: STIXGeneral-Regular;\">DocE</span><span class=\"mo\" id=\"MathJax-Span-718\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-719\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-720\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 2.815em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-721\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1002.66em, 4.221em, -999.997em); top: -3.331em; left: 50%; margin-left: -1.352em;\"><span class=\"mrow\" id=\"MathJax-Span-722\"><span class=\"mn\" id=\"MathJax-Span-723\" style=\"font-family: STIXGeneral-Regular;\">60</span><span class=\"mo\" id=\"MathJax-Span-724\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mn\" id=\"MathJax-Span-725\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">5</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1002.82em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.815em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-726\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-727\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-728\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1000.94em, 4.169em, -999.997em); top: -3.331em; left: 50%; margin-left: -0.518em;\"><span class=\"mn\" id=\"MathJax-Span-729\" style=\"font-family: STIXGeneral-Regular;\">65</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1001.15em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.148em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-730\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">≈</span><span class=\"mn\" id=\"MathJax-Span-731\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">0.01538</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.934em; border-left: 0px solid; width: 0px; height: 2.628em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>RRF</mtext><mo stretchy=\"false\">(</mo><mtext>DocE</mtext><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>5</mn></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>65</mn></mfrac><mo>≈</mo><mn>0.01538</mn></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-68\">\\text{RRF}(\\text{DocE})\n= \\frac{1}{60 + 5}\n= \\frac{1}{65}\n\\approx 0.01538</script>\n          </li>\n          <li>\n            <p><strong>DocF</strong> (Rank 1 in Neural Retriever only):</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-69-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>RRF</mtext><mo stretchy=&quot;false&quot;>(</mo><mtext>DocF</mtext><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>1</mn></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>61</mn></mfrac><mo>&amp;#x2248;</mo><mn>0.01639</mn></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-732\" style=\"width: 19.221em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 15.992em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.68em, 1015.94em, 3.076em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-733\"><span class=\"mtext\" id=\"MathJax-Span-734\" style=\"font-family: STIXGeneral-Regular;\">RRF</span><span class=\"mo\" id=\"MathJax-Span-735\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mtext\" id=\"MathJax-Span-736\" style=\"font-family: STIXGeneral-Regular;\">DocF</span><span class=\"mo\" id=\"MathJax-Span-737\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-738\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-739\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 2.815em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-740\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1002.61em, 4.221em, -999.997em); top: -3.331em; left: 50%; margin-left: -1.352em;\"><span class=\"mrow\" id=\"MathJax-Span-741\"><span class=\"mn\" id=\"MathJax-Span-742\" style=\"font-family: STIXGeneral-Regular;\">60</span><span class=\"mo\" id=\"MathJax-Span-743\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mn\" id=\"MathJax-Span-744\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">1</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1002.82em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.815em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-745\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-746\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-747\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -3.331em; left: 50%; margin-left: -0.518em;\"><span class=\"mn\" id=\"MathJax-Span-748\" style=\"font-family: STIXGeneral-Regular;\">61</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1001.15em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.148em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-749\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">≈</span><span class=\"mn\" id=\"MathJax-Span-750\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">0.01639</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.934em; border-left: 0px solid; width: 0px; height: 2.628em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>RRF</mtext><mo stretchy=\"false\">(</mo><mtext>DocF</mtext><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>1</mn></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>61</mn></mfrac><mo>≈</mo><mn>0.01639</mn></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-69\">\\text{RRF}(\\text{DocF})\n= \\frac{1}{60 + 1}\n= \\frac{1}{61}\n\\approx 0.01639</script>\n          </li>\n          <li>\n            <p><strong>DocG</strong> (Rank 4 in Neural Retriever only):</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-70-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>RRF</mtext><mo stretchy=&quot;false&quot;>(</mo><mtext>DocG</mtext><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>4</mn></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>64</mn></mfrac><mo>&amp;#x2248;</mo><mn>0.01563</mn></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-751\" style=\"width: 19.378em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 16.148em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.68em, 1016.1em, 3.076em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-752\"><span class=\"mtext\" id=\"MathJax-Span-753\" style=\"font-family: STIXGeneral-Regular;\">RRF</span><span class=\"mo\" id=\"MathJax-Span-754\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mtext\" id=\"MathJax-Span-755\" style=\"font-family: STIXGeneral-Regular;\">DocG</span><span class=\"mo\" id=\"MathJax-Span-756\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-757\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-758\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 2.815em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-759\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1002.71em, 4.221em, -999.997em); top: -3.331em; left: 50%; margin-left: -1.352em;\"><span class=\"mrow\" id=\"MathJax-Span-760\"><span class=\"mn\" id=\"MathJax-Span-761\" style=\"font-family: STIXGeneral-Regular;\">60</span><span class=\"mo\" id=\"MathJax-Span-762\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mn\" id=\"MathJax-Span-763\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">4</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1002.82em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.815em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-764\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-765\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-766\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1000.99em, 4.169em, -999.997em); top: -3.331em; left: 50%; margin-left: -0.518em;\"><span class=\"mn\" id=\"MathJax-Span-767\" style=\"font-family: STIXGeneral-Regular;\">64</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1001.15em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.148em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-768\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">≈</span><span class=\"mn\" id=\"MathJax-Span-769\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">0.01563</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.934em; border-left: 0px solid; width: 0px; height: 2.628em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>RRF</mtext><mo stretchy=\"false\">(</mo><mtext>DocG</mtext><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>60</mn><mo>+</mo><mn>4</mn></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>64</mn></mfrac><mo>≈</mo><mn>0.01563</mn></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-70\">\\text{RRF}(\\text{DocG})\n= \\frac{1}{60 + 4}\n= \\frac{1}{64}\n\\approx 0.01563</script>\n          </li>\n        </ul>\n<p><strong>DocA</strong> (Rank 1 in BM25, rank 3 in Neural Retriever):</p>\n<p><strong>DocB</strong> (Rank 2 in BM25, rank 5 in Neural Retriever):</p>\n<p><strong>DocC</strong> (Rank 3 in BM25, rank 2 in Neural Retriever):</p>\n<p><strong>DocD</strong> (Rank 4 in BM25 only):</p>\n<p><strong>DocE</strong> (Rank 5 in BM25 only):</p>\n<p><strong>DocF</strong> (Rank 1 in Neural Retriever only):</p>\n<p><strong>DocG</strong> (Rank 4 in Neural Retriever only):</p>\n<p>After computing scores for all documents, the final RRF ranking is obtained by sorting documents in descending order of their cumulative RRF scores.</p>\n<h5 id=\"advanced-variations\">Advanced Variations</h5>\n<ol>\n  <li>\n    <p><strong>Filtered parallel retrieval</strong>:</p>\n\n    <ul>\n      <li>Apply the same metadata filters</li>\n      <li>Run lexical and semantic retrieval in parallel</li>\n      <li>Fuse results with RRF</li>\n      <li>Optionally rerank the fused set</li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Filter-aware rerankers</strong>:</p>\n\n    <ul>\n      <li>Metadata fields are appended to document text</li>\n      <li>Allows rerankers to learn preferences (e.g., newer is better)</li>\n      <li>Still respects hard filters upstream</li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Adaptive hybrid strategies</strong>:</p>\n\n    <ul>\n      <li>Short queries bias toward lexical</li>\n      <li>Long natural language queries bias toward semantic</li>\n      <li>Query classifiers dynamically adjust retrieval strategy</li>\n    </ul>\n  </li>\n</ol>\n<p><strong>Filtered parallel retrieval</strong>:</p>\n<ul>\n      <li>Apply the same metadata filters</li>\n      <li>Run lexical and semantic retrieval in parallel</li>\n      <li>Fuse results with RRF</li>\n      <li>Optionally rerank the fused set</li>\n    </ul>\n<p><strong>Filter-aware rerankers</strong>:</p>\n<ul>\n      <li>Metadata fields are appended to document text</li>\n      <li>Allows rerankers to learn preferences (e.g., newer is better)</li>\n      <li>Still respects hard filters upstream</li>\n    </ul>\n<p><strong>Adaptive hybrid strategies</strong>:</p>\n<ul>\n      <li>Short queries bias toward lexical</li>\n      <li>Long natural language queries bias toward semantic</li>\n      <li>Query classifiers dynamically adjust retrieval strategy</li>\n    </ul>\n<h5 id=\"common-pitfalls\">Common Pitfalls</h5>\n<ul>\n  <li>Applying semantic retrieval before filtering, causing access violations</li>\n  <li>Treating metadata as a scoring feature instead of a constraint</li>\n  <li>Choosing <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-71-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-770\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-771\"><span class=\"mi\" id=\"MathJax-Span-772\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-71\">K</script> too small, harming recall</li>\n  <li>Over-relying on semantic similarity for exact-match queries</li>\n  <li>Ignoring explainability and audit requirements</li>\n</ul>\n<h5 id=\"mental-model\">Mental Model</h5>\n<ul>\n  <li>\n    <p>Think in layers:</p>\n\n    <ol>\n      <li>Which documents are allowed? (metadata filtering)</li>\n      <li>Which documents mention what the user said? (lexical recall)</li>\n      <li>Which of those best match what the user meant? (semantic ranking)</li>\n      <li>Which should be preferred? (re-ranking and boosting)</li>\n    </ol>\n  </li>\n  <li>\n    <p>Hybrid retrieval works because it preserves this separation of concerns.</p>\n  </li>\n</ul>\n<p>Think in layers:</p>\n<ol>\n      <li>Which documents are allowed? (metadata filtering)</li>\n      <li>Which documents mention what the user said? (lexical recall)</li>\n      <li>Which of those best match what the user meant? (semantic ranking)</li>\n      <li>Which should be preferred? (re-ranking and boosting)</li>\n    </ol>\n<p>Hybrid retrieval works because it preserves this separation of concerns.</p>\n<h5 id=\"system-tuning\">System Tuning</h5>\n<ul>\n  <li>Tuning a hybrid retrieval system is an exercise in balancing recall, precision, latency, cost, and operational complexity.</li>\n  <li>There is no universally optimal configuration; instead, production systems are tuned based on query distribution, corpus characteristics, and downstream task requirements.</li>\n</ul>\n<h6 id=\"choosing-the-candidate-set-size-k\">Choosing the Candidate Set Size (<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-72-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-773\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-774\"><span class=\"mi\" id=\"MathJax-Span-775\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-72\">K</script>)</h6>\n<ul>\n  <li>\n    <p>The parameter <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-73-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-776\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-777\"><span class=\"mi\" id=\"MathJax-Span-778\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-73\">K</script> controls how many documents are retrieved by the first-stage retriever (usually BM25) before semantic processing.</p>\n  </li>\n  <li>\n    <p><strong>Trade-offs</strong>:</p>\n\n    <ul>\n      <li>Smaller <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-74-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-779\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-780\"><span class=\"mi\" id=\"MathJax-Span-781\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-74\">K</script> leads to lower latency and cost but increases the risk of missing relevant documents, since the semantic reranker has limited ability to recover items not present in the candidate set.</li>\n      <li>Larger <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-75-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-782\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-783\"><span class=\"mi\" id=\"MathJax-Span-784\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-75\">K</script> improves recall but increases semantic compute cost and typically exhibits diminishing returns beyond a certain threshold.</li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Practical guidelines</strong>:</p>\n\n    <ul>\n      <li>\n        <p><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-76-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi><mo>&amp;#x2208;</mo><mo stretchy=&quot;false&quot;>[</mo><mn>50</mn><mo>,</mo><mn>100</mn><mo stretchy=&quot;false&quot;>]</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-785\" style=\"width: 6.773em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 5.628em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1005.52em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-786\"><span class=\"mi\" id=\"MathJax-Span-787\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-788\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">∈</span><span class=\"mo\" id=\"MathJax-Span-789\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">[</span><span class=\"mn\" id=\"MathJax-Span-790\" style=\"font-family: STIXGeneral-Regular;\">50</span><span class=\"mo\" id=\"MathJax-Span-791\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mn\" id=\"MathJax-Span-792\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">100</span><span class=\"mo\" id=\"MathJax-Span-793\" style=\"font-family: STIXGeneral-Regular;\">]</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi><mo>∈</mo><mo stretchy=\"false\">[</mo><mn>50</mn><mo>,</mo><mn>100</mn><mo stretchy=\"false\">]</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-76\">K \\in [50, 100]</script>: Suitable for narrow domains with high-quality lexical signals.</p>\n      </li>\n      <li>\n        <p><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-77-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi><mo>&amp;#x2208;</mo><mo stretchy=&quot;false&quot;>[</mo><mn>200</mn><mo>,</mo><mn>500</mn><mo stretchy=&quot;false&quot;>]</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-794\" style=\"width: 7.346em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 6.096em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1005.99em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-795\"><span class=\"mi\" id=\"MathJax-Span-796\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-797\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">∈</span><span class=\"mo\" id=\"MathJax-Span-798\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">[</span><span class=\"mn\" id=\"MathJax-Span-799\" style=\"font-family: STIXGeneral-Regular;\">200</span><span class=\"mo\" id=\"MathJax-Span-800\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mn\" id=\"MathJax-Span-801\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">500</span><span class=\"mo\" id=\"MathJax-Span-802\" style=\"font-family: STIXGeneral-Regular;\">]</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi><mo>∈</mo><mo stretchy=\"false\">[</mo><mn>200</mn><mo>,</mo><mn>500</mn><mo stretchy=\"false\">]</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-77\">K \\in [200, 500]</script>: Common default for general-purpose search and RAG.</p>\n      </li>\n      <li>\n        <p><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-78-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi><mo>&amp;#x2208;</mo><mo stretchy=&quot;false&quot;>[</mo><mn>1000</mn><mo>+</mo><mo stretchy=&quot;false&quot;>]</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-803\" style=\"width: 6.253em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 5.211em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1005.11em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-804\"><span class=\"mi\" id=\"MathJax-Span-805\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-806\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">∈</span><span class=\"mo\" id=\"MathJax-Span-807\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">[</span><span class=\"mn\" id=\"MathJax-Span-808\" style=\"font-family: STIXGeneral-Regular;\">1000</span><span class=\"mo\" id=\"MathJax-Span-809\" style=\"font-family: STIXGeneral-Regular;\">+</span><span class=\"mo\" id=\"MathJax-Span-810\" style=\"font-family: STIXGeneral-Regular;\">]</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi><mo>∈</mo><mo stretchy=\"false\">[</mo><mn>1000</mn><mo>+</mo><mo stretchy=\"false\">]</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-78\">K \\in [1000+]</script>: Used when recall is critical and latency budgets allow.</p>\n      </li>\n      <li>\n        <p>A useful mental model is:</p>\n      </li>\n    </ul>\n\n    <blockquote>\n      <p>If a document does not appear in the top <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-79-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-811\" style=\"width: 0.975em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.789em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.391em, 1000.79em, 2.317em, -999.998em); top: -2.174em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-812\"><span class=\"mi\" id=\"MathJax-Span-813\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.049em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.178em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left: 0px solid; width: 0px; height: 0.892em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-79\">K</script> lexical results, semantic re-ranking cannot recover it.</p>\n    </blockquote>\n  </li>\n</ul>\n<p>The parameter <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-73-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-776\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-777\"><span class=\"mi\" id=\"MathJax-Span-778\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-73\">K</script> controls how many documents are retrieved by the first-stage retriever (usually BM25) before semantic processing.</p>\n<p><strong>Trade-offs</strong>:</p>\n<ul>\n      <li>Smaller <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-74-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-779\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-780\"><span class=\"mi\" id=\"MathJax-Span-781\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-74\">K</script> leads to lower latency and cost but increases the risk of missing relevant documents, since the semantic reranker has limited ability to recover items not present in the candidate set.</li>\n      <li>Larger <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-75-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-782\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-783\"><span class=\"mi\" id=\"MathJax-Span-784\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-75\">K</script> improves recall but increases semantic compute cost and typically exhibits diminishing returns beyond a certain threshold.</li>\n    </ul>\n<p><strong>Practical guidelines</strong>:</p>\n<ul>\n      <li>\n        <p><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-76-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi><mo>&amp;#x2208;</mo><mo stretchy=&quot;false&quot;>[</mo><mn>50</mn><mo>,</mo><mn>100</mn><mo stretchy=&quot;false&quot;>]</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-785\" style=\"width: 6.773em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 5.628em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1005.52em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-786\"><span class=\"mi\" id=\"MathJax-Span-787\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-788\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">∈</span><span class=\"mo\" id=\"MathJax-Span-789\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">[</span><span class=\"mn\" id=\"MathJax-Span-790\" style=\"font-family: STIXGeneral-Regular;\">50</span><span class=\"mo\" id=\"MathJax-Span-791\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mn\" id=\"MathJax-Span-792\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">100</span><span class=\"mo\" id=\"MathJax-Span-793\" style=\"font-family: STIXGeneral-Regular;\">]</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi><mo>∈</mo><mo stretchy=\"false\">[</mo><mn>50</mn><mo>,</mo><mn>100</mn><mo stretchy=\"false\">]</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-76\">K \\in [50, 100]</script>: Suitable for narrow domains with high-quality lexical signals.</p>\n      </li>\n      <li>\n        <p><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-77-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi><mo>&amp;#x2208;</mo><mo stretchy=&quot;false&quot;>[</mo><mn>200</mn><mo>,</mo><mn>500</mn><mo stretchy=&quot;false&quot;>]</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-794\" style=\"width: 7.346em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 6.096em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1005.99em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-795\"><span class=\"mi\" id=\"MathJax-Span-796\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-797\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">∈</span><span class=\"mo\" id=\"MathJax-Span-798\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">[</span><span class=\"mn\" id=\"MathJax-Span-799\" style=\"font-family: STIXGeneral-Regular;\">200</span><span class=\"mo\" id=\"MathJax-Span-800\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mn\" id=\"MathJax-Span-801\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">500</span><span class=\"mo\" id=\"MathJax-Span-802\" style=\"font-family: STIXGeneral-Regular;\">]</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi><mo>∈</mo><mo stretchy=\"false\">[</mo><mn>200</mn><mo>,</mo><mn>500</mn><mo stretchy=\"false\">]</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-77\">K \\in [200, 500]</script>: Common default for general-purpose search and RAG.</p>\n      </li>\n      <li>\n        <p><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-78-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi><mo>&amp;#x2208;</mo><mo stretchy=&quot;false&quot;>[</mo><mn>1000</mn><mo>+</mo><mo stretchy=&quot;false&quot;>]</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-803\" style=\"width: 6.253em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 5.211em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1005.11em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-804\"><span class=\"mi\" id=\"MathJax-Span-805\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-806\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">∈</span><span class=\"mo\" id=\"MathJax-Span-807\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">[</span><span class=\"mn\" id=\"MathJax-Span-808\" style=\"font-family: STIXGeneral-Regular;\">1000</span><span class=\"mo\" id=\"MathJax-Span-809\" style=\"font-family: STIXGeneral-Regular;\">+</span><span class=\"mo\" id=\"MathJax-Span-810\" style=\"font-family: STIXGeneral-Regular;\">]</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi><mo>∈</mo><mo stretchy=\"false\">[</mo><mn>1000</mn><mo>+</mo><mo stretchy=\"false\">]</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-78\">K \\in [1000+]</script>: Used when recall is critical and latency budgets allow.</p>\n      </li>\n      <li>\n        <p>A useful mental model is:</p>\n      </li>\n    </ul>\n<p><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-76-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi><mo>&amp;#x2208;</mo><mo stretchy=&quot;false&quot;>[</mo><mn>50</mn><mo>,</mo><mn>100</mn><mo stretchy=&quot;false&quot;>]</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-785\" style=\"width: 6.773em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 5.628em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1005.52em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-786\"><span class=\"mi\" id=\"MathJax-Span-787\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-788\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">∈</span><span class=\"mo\" id=\"MathJax-Span-789\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">[</span><span class=\"mn\" id=\"MathJax-Span-790\" style=\"font-family: STIXGeneral-Regular;\">50</span><span class=\"mo\" id=\"MathJax-Span-791\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mn\" id=\"MathJax-Span-792\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">100</span><span class=\"mo\" id=\"MathJax-Span-793\" style=\"font-family: STIXGeneral-Regular;\">]</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi><mo>∈</mo><mo stretchy=\"false\">[</mo><mn>50</mn><mo>,</mo><mn>100</mn><mo stretchy=\"false\">]</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-76\">K \\in [50, 100]</script>: Suitable for narrow domains with high-quality lexical signals.</p>\n<p><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-77-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi><mo>&amp;#x2208;</mo><mo stretchy=&quot;false&quot;>[</mo><mn>200</mn><mo>,</mo><mn>500</mn><mo stretchy=&quot;false&quot;>]</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-794\" style=\"width: 7.346em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 6.096em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1005.99em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-795\"><span class=\"mi\" id=\"MathJax-Span-796\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-797\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">∈</span><span class=\"mo\" id=\"MathJax-Span-798\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">[</span><span class=\"mn\" id=\"MathJax-Span-799\" style=\"font-family: STIXGeneral-Regular;\">200</span><span class=\"mo\" id=\"MathJax-Span-800\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mn\" id=\"MathJax-Span-801\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">500</span><span class=\"mo\" id=\"MathJax-Span-802\" style=\"font-family: STIXGeneral-Regular;\">]</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi><mo>∈</mo><mo stretchy=\"false\">[</mo><mn>200</mn><mo>,</mo><mn>500</mn><mo stretchy=\"false\">]</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-77\">K \\in [200, 500]</script>: Common default for general-purpose search and RAG.</p>\n<p><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-78-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi><mo>&amp;#x2208;</mo><mo stretchy=&quot;false&quot;>[</mo><mn>1000</mn><mo>+</mo><mo stretchy=&quot;false&quot;>]</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-803\" style=\"width: 6.253em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 5.211em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1005.11em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-804\"><span class=\"mi\" id=\"MathJax-Span-805\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-806\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">∈</span><span class=\"mo\" id=\"MathJax-Span-807\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">[</span><span class=\"mn\" id=\"MathJax-Span-808\" style=\"font-family: STIXGeneral-Regular;\">1000</span><span class=\"mo\" id=\"MathJax-Span-809\" style=\"font-family: STIXGeneral-Regular;\">+</span><span class=\"mo\" id=\"MathJax-Span-810\" style=\"font-family: STIXGeneral-Regular;\">]</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi><mo>∈</mo><mo stretchy=\"false\">[</mo><mn>1000</mn><mo>+</mo><mo stretchy=\"false\">]</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-78\">K \\in [1000+]</script>: Used when recall is critical and latency budgets allow.</p>\n<p>A useful mental model is:</p>\n<blockquote>\n      <p>If a document does not appear in the top <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-79-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-811\" style=\"width: 0.975em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.789em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.391em, 1000.79em, 2.317em, -999.998em); top: -2.174em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-812\"><span class=\"mi\" id=\"MathJax-Span-813\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.049em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.178em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left: 0px solid; width: 0px; height: 0.892em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-79\">K</script> lexical results, semantic re-ranking cannot recover it.</p>\n    </blockquote>\n<p>If a document does not appear in the top <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-79-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-811\" style=\"width: 0.975em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.789em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.391em, 1000.79em, 2.317em, -999.998em); top: -2.174em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-812\"><span class=\"mi\" id=\"MathJax-Span-813\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.049em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.178em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left: 0px solid; width: 0px; height: 0.892em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-79\">K</script> lexical results, semantic re-ranking cannot recover it.</p>\n<h6 id=\"latency-and-cost-considerations\">Latency and Cost Considerations</h6>\n<ul>\n  <li>Hybrid retrieval latency is additive across stages:</li>\n</ul>\n<div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-80-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><msub><mi>T</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>total</mtext></mrow></msub><mo>=</mo><msub><mi>T</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>filter</mtext></mrow></msub><mo>+</mo><msub><mi>T</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>lexical</mtext></mrow></msub><mo>+</mo><msub><mi>T</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>semantic</mtext></mrow></msub><mo>+</mo><msub><mi>T</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>rerank</mtext></mrow></msub></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-814\" style=\"width: 19.794em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 16.461em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1016.46em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-815\"><span class=\"msubsup\" id=\"MathJax-Span-816\"><span style=\"display: inline-block; position: relative; width: 1.878em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.63em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-817\" style=\"font-family: STIXGeneral-Italic;\">T<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.576em;\"><span class=\"texatom\" id=\"MathJax-Span-818\"><span class=\"mrow\" id=\"MathJax-Span-819\"><span class=\"mtext\" id=\"MathJax-Span-820\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">total</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-821\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"msubsup\" id=\"MathJax-Span-822\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 2.034em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.63em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-823\" style=\"font-family: STIXGeneral-Italic;\">T<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.576em;\"><span class=\"texatom\" id=\"MathJax-Span-824\"><span class=\"mrow\" id=\"MathJax-Span-825\"><span class=\"mtext\" id=\"MathJax-Span-826\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">filter</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-827\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"msubsup\" id=\"MathJax-Span-828\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.503em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.63em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-829\" style=\"font-family: STIXGeneral-Italic;\">T<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.576em;\"><span class=\"texatom\" id=\"MathJax-Span-830\"><span class=\"mrow\" id=\"MathJax-Span-831\"><span class=\"mtext\" id=\"MathJax-Span-832\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">lexical</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-833\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"msubsup\" id=\"MathJax-Span-834\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 3.128em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.63em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-835\" style=\"font-family: STIXGeneral-Italic;\">T<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.576em;\"><span class=\"texatom\" id=\"MathJax-Span-836\"><span class=\"mrow\" id=\"MathJax-Span-837\"><span class=\"mtext\" id=\"MathJax-Span-838\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">semantic</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-839\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"msubsup\" id=\"MathJax-Span-840\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.451em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.63em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-841\" style=\"font-family: STIXGeneral-Italic;\">T<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.576em;\"><span class=\"texatom\" id=\"MathJax-Span-842\"><span class=\"mrow\" id=\"MathJax-Span-843\"><span class=\"mtext\" id=\"MathJax-Span-844\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">rerank</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><msub><mi>T</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>total</mtext></mrow></msub><mo>=</mo><msub><mi>T</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>filter</mtext></mrow></msub><mo>+</mo><msub><mi>T</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>lexical</mtext></mrow></msub><mo>+</mo><msub><mi>T</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>semantic</mtext></mrow></msub><mo>+</mo><msub><mi>T</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>rerank</mtext></mrow></msub></math></span></span></div>\n<ul>\n  <li>\n    <p>Key optimization strategies include:</p>\n\n    <ul>\n      <li>Early filtering to shrink candidate sets</li>\n      <li>Caching frequent query embeddings</li>\n      <li>Applying rerankers only to the top subset (e.g., top 50)</li>\n      <li>Adaptive pipelines based on query complexity</li>\n    </ul>\n  </li>\n  <li>\n    <p>Latency budgets often dictate architectural choices more than relevance metrics.</p>\n  </li>\n</ul>\n<p>Key optimization strategies include:</p>\n<ul>\n      <li>Early filtering to shrink candidate sets</li>\n      <li>Caching frequent query embeddings</li>\n      <li>Applying rerankers only to the top subset (e.g., top 50)</li>\n      <li>Adaptive pipelines based on query complexity</li>\n    </ul>\n<p>Latency budgets often dictate architectural choices more than relevance metrics.</p>\n<h6 id=\"query-aware-tuning\">Query-aware Tuning</h6>\n<ul>\n  <li>\n    <p>Many production systems dynamically adjust retrieval behavior:</p>\n\n    <ul>\n      <li>\n        <p><strong>Short keyword queries</strong>: Bias toward lexical retrieval and smaller <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-81-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-845\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-846\"><span class=\"mi\" id=\"MathJax-Span-847\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-81\">K</script></p>\n      </li>\n      <li>\n        <p><strong>Long natural language queries</strong>: Increase <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-82-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-848\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-849\"><span class=\"mi\" id=\"MathJax-Span-850\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-82\">K</script> and rely more on semantic re-ranking</p>\n      </li>\n      <li>\n        <p><strong>Identifier-heavy queries</strong>: Skip semantic stages entirely</p>\n      </li>\n    </ul>\n  </li>\n  <li>\n    <p>Query classifiers or heuristics are often sufficient to enable this adaptivity.</p>\n  </li>\n</ul>\n<p>Many production systems dynamically adjust retrieval behavior:</p>\n<ul>\n      <li>\n        <p><strong>Short keyword queries</strong>: Bias toward lexical retrieval and smaller <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-81-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-845\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-846\"><span class=\"mi\" id=\"MathJax-Span-847\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-81\">K</script></p>\n      </li>\n      <li>\n        <p><strong>Long natural language queries</strong>: Increase <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-82-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-848\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-849\"><span class=\"mi\" id=\"MathJax-Span-850\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-82\">K</script> and rely more on semantic re-ranking</p>\n      </li>\n      <li>\n        <p><strong>Identifier-heavy queries</strong>: Skip semantic stages entirely</p>\n      </li>\n    </ul>\n<p><strong>Short keyword queries</strong>: Bias toward lexical retrieval and smaller <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-81-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-845\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-846\"><span class=\"mi\" id=\"MathJax-Span-847\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-81\">K</script></p>\n<p><strong>Long natural language queries</strong>: Increase <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-82-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-848\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-849\"><span class=\"mi\" id=\"MathJax-Span-850\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-82\">K</script> and rely more on semantic re-ranking</p>\n<p><strong>Identifier-heavy queries</strong>: Skip semantic stages entirely</p>\n<p>Query classifiers or heuristics are often sufficient to enable this adaptivity.</p>\n<h6 id=\"evaluation-and-tuning-methodology\">Evaluation and Tuning Methodology</h6>\n<ul>\n  <li>\n    <p>Hybrid systems are tuned using:</p>\n\n    <ul>\n      <li>Offline relevance judgments (NDCG, MRR, Recall@<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-83-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-851\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-852\"><span class=\"mi\" id=\"MathJax-Span-853\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-83\">k</script>)</li>\n      <li>Online A/B testing</li>\n      <li>Query-level error analysis</li>\n    </ul>\n  </li>\n  <li>\n    <p>Important metrics include:</p>\n\n    <ul>\n      <li>Recall@<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-84-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-854\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-855\"><span class=\"mi\" id=\"MathJax-Span-856\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-84\">k</script> after lexical retrieval</li>\n      <li>Precision improvements from re-ranking</li>\n      <li>Latency percentiles (P50, P95, P99)</li>\n    </ul>\n  </li>\n  <li>\n    <p>Tuning is iterative and tightly coupled to real query logs.</p>\n  </li>\n</ul>\n<p>Hybrid systems are tuned using:</p>\n<ul>\n      <li>Offline relevance judgments (NDCG, MRR, Recall@<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-83-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-851\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-852\"><span class=\"mi\" id=\"MathJax-Span-853\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-83\">k</script>)</li>\n      <li>Online A/B testing</li>\n      <li>Query-level error analysis</li>\n    </ul>\n<p>Important metrics include:</p>\n<ul>\n      <li>Recall@<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-84-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-854\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-855\"><span class=\"mi\" id=\"MathJax-Span-856\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-84\">k</script> after lexical retrieval</li>\n      <li>Precision improvements from re-ranking</li>\n      <li>Latency percentiles (P50, P95, P99)</li>\n    </ul>\n<p>Tuning is iterative and tightly coupled to real query logs.</p>\n<h5 id=\"hybrid-retrieval-in-rag-architectures\">Hybrid Retrieval in RAG Architectures</h5>\n<ul>\n  <li>RAG systems rely on retrieval quality as a first-order determinant of generation quality. Hybrid retrieval has become the dominant retrieval strategy in RAG because it directly addresses the failure modes of both generation and retrieval models.</li>\n</ul>\n<h6 id=\"why-hybrid-retrieval-is-critical-for-rag\">Why Hybrid Retrieval is Critical for RAG</h6>\n<ul>\n  <li>\n    <p>Language models:</p>\n\n    <ul>\n      <li>Cannot invent missing facts reliably</li>\n      <li>Are sensitive to irrelevant or misleading context</li>\n      <li>Perform best when provided with precise, relevant grounding documents</li>\n    </ul>\n  </li>\n  <li>\n    <p>Hybrid retrieval ensures:</p>\n\n    <ul>\n      <li>Exact factual anchors are included</li>\n      <li>Conceptually relevant context is not missed</li>\n      <li>The model is not forced to hallucinate due to missing evidence</li>\n    </ul>\n  </li>\n</ul>\n<p>Language models:</p>\n<ul>\n      <li>Cannot invent missing facts reliably</li>\n      <li>Are sensitive to irrelevant or misleading context</li>\n      <li>Perform best when provided with precise, relevant grounding documents</li>\n    </ul>\n<p>Hybrid retrieval ensures:</p>\n<ul>\n      <li>Exact factual anchors are included</li>\n      <li>Conceptually relevant context is not missed</li>\n      <li>The model is not forced to hallucinate due to missing evidence</li>\n    </ul>\n<h6 id=\"canonical-rag-retrieval-pipeline\">Canonical RAG Retrieval Pipeline</h6>\n<ul>\n  <li>\n    <p>A typical hybrid RAG pipeline looks like:</p>\n\n    <ol>\n      <li>\n        <p><strong>Metadata filtering</strong>: Apply access, language, document type, and recency constraints.</p>\n      </li>\n      <li>\n        <p><strong>Lexical retrieval</strong>: Retrieve top <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-85-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-857\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-858\"><span class=\"mi\" id=\"MathJax-Span-859\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-85\">K</script> documents using BM25.</p>\n      </li>\n      <li>\n        <p><strong>Semantic re-ranking</strong>: Rerank candidates using a semantic model.</p>\n      </li>\n      <li>\n        <p><strong>Context selection</strong>: Select top <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-86-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>N</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-860\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-861\"><span class=\"mi\" id=\"MathJax-Span-862\" style=\"font-family: STIXGeneral-Italic;\">N<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>N</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-86\">N</script> documents or passages for generation.</p>\n      </li>\n    </ol>\n  </li>\n  <li>\n    <p>Formally:</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-87-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>Context</mtext><mo>=</mo><msub><mtext>Top</mtext><mi>N</mi></msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo maxsize=&quot;1.623em&quot; minsize=&quot;1.623em&quot;>(</mo></mrow><msub><mtext>Rerank</mtext><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>semantic</mtext></mrow></msub><mo stretchy=&quot;false&quot;>(</mo><mtext>BM25</mtext><mo stretchy=&quot;false&quot;>(</mo><mtext>Docs</mtext><mo>&amp;#x2223;</mo><mtext>filters</mtext><mo stretchy=&quot;false&quot;>)</mo><mo stretchy=&quot;false&quot;>)</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo maxsize=&quot;1.623em&quot; minsize=&quot;1.623em&quot;>)</mo></mrow></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-863\" style=\"width: 26.826em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 22.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(2.138em, 1022.24em, 4.326em, -999.997em); top: -3.487em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-864\"><span class=\"mtext\" id=\"MathJax-Span-865\" style=\"font-family: STIXGeneral-Regular;\">Context</span><span class=\"mo\" id=\"MathJax-Span-866\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"msubsup\" id=\"MathJax-Span-867\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 2.19em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1001.57em, 4.378em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mtext\" id=\"MathJax-Span-868\" style=\"font-family: STIXGeneral-Regular;\">Top</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.747em; left: 1.617em;\"><span class=\"mi\" id=\"MathJax-Span-869\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">N<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"texatom\" id=\"MathJax-Span-870\"><span class=\"mrow\" id=\"MathJax-Span-871\"><span class=\"mo\" id=\"MathJax-Span-872\" style=\"vertical-align: -0.414em;\"><span style=\"font-family: STIXSizeTwoSym;\">(</span></span></span></span><span class=\"msubsup\" id=\"MathJax-Span-873\"><span style=\"display: inline-block; position: relative; width: 5.471em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1002.92em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mtext\" id=\"MathJax-Span-874\" style=\"font-family: STIXGeneral-Regular;\">Rerank</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 2.867em;\"><span class=\"texatom\" id=\"MathJax-Span-875\"><span class=\"mrow\" id=\"MathJax-Span-876\"><span class=\"mtext\" id=\"MathJax-Span-877\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">semantic</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-878\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mtext\" id=\"MathJax-Span-879\" style=\"font-family: STIXGeneral-Regular;\">BM25</span><span class=\"mo\" id=\"MathJax-Span-880\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mtext\" id=\"MathJax-Span-881\" style=\"font-family: STIXGeneral-Regular;\">Docs</span><span class=\"mo\" id=\"MathJax-Span-882\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">∣</span><span class=\"mtext\" id=\"MathJax-Span-883\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">filters</span><span class=\"mo\" id=\"MathJax-Span-884\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-885\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"texatom\" id=\"MathJax-Span-886\"><span class=\"mrow\" id=\"MathJax-Span-887\"><span class=\"mo\" id=\"MathJax-Span-888\" style=\"vertical-align: -0.414em;\"><span style=\"font-family: STIXSizeTwoSym;\">)</span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 3.492em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.872em; border-left: 0px solid; width: 0px; height: 2.316em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>Context</mtext><mo>=</mo><msub><mtext>Top</mtext><mi>N</mi></msub><mrow class=\"MJX-TeXAtom-ORD\"><mo maxsize=\"1.623em\" minsize=\"1.623em\">(</mo></mrow><msub><mtext>Rerank</mtext><mrow class=\"MJX-TeXAtom-ORD\"><mtext>semantic</mtext></mrow></msub><mo stretchy=\"false\">(</mo><mtext>BM25</mtext><mo stretchy=\"false\">(</mo><mtext>Docs</mtext><mo>∣</mo><mtext>filters</mtext><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">)</mo><mrow class=\"MJX-TeXAtom-ORD\"><mo maxsize=\"1.623em\" minsize=\"1.623em\">)</mo></mrow></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-87\">\\text{Context} =\n\\text{Top}_N\n\\Big(\n\\text{Rerank}_{\\text{semantic}}\n(\n\\text{BM25}(\\text{Docs} \\mid \\text{filters})\n)\n\\Big)</script>\n  </li>\n</ul>\n<p>A typical hybrid RAG pipeline looks like:</p>\n<ol>\n      <li>\n        <p><strong>Metadata filtering</strong>: Apply access, language, document type, and recency constraints.</p>\n      </li>\n      <li>\n        <p><strong>Lexical retrieval</strong>: Retrieve top <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-85-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-857\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-858\"><span class=\"mi\" id=\"MathJax-Span-859\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-85\">K</script> documents using BM25.</p>\n      </li>\n      <li>\n        <p><strong>Semantic re-ranking</strong>: Rerank candidates using a semantic model.</p>\n      </li>\n      <li>\n        <p><strong>Context selection</strong>: Select top <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-86-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>N</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-860\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-861\"><span class=\"mi\" id=\"MathJax-Span-862\" style=\"font-family: STIXGeneral-Italic;\">N<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>N</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-86\">N</script> documents or passages for generation.</p>\n      </li>\n    </ol>\n<p><strong>Metadata filtering</strong>: Apply access, language, document type, and recency constraints.</p>\n<p><strong>Lexical retrieval</strong>: Retrieve top <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-85-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-857\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-858\"><span class=\"mi\" id=\"MathJax-Span-859\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-85\">K</script> documents using BM25.</p>\n<p><strong>Semantic re-ranking</strong>: Rerank candidates using a semantic model.</p>\n<p><strong>Context selection</strong>: Select top <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-86-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>N</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-860\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-861\"><span class=\"mi\" id=\"MathJax-Span-862\" style=\"font-family: STIXGeneral-Italic;\">N<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>N</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-86\">N</script> documents or passages for generation.</p>\n<p>Formally:</p>\n<h6 id=\"failure-modes-avoided-by-hybrid-rag\">Failure Modes Avoided by Hybrid RAG</h6>\n<ul>\n  <li>\n    <p><strong>Semantic-only retrieval</strong>: Misses exact facts, dates, or identifiers.</p>\n  </li>\n  <li>\n    <p><strong>Lexical-only retrieval</strong>: Misses paraphrased or implied information.</p>\n  </li>\n  <li>\n    <p><strong>Unfiltered retrieval</strong>: Causes data leakage or compliance violations.</p>\n  </li>\n  <li>\n    <p>Hybrid retrieval with three stages (<strong>metadata filtering, lexical retrieval, and semantic retrieval/ranking</strong>) minimizes all three.</p>\n  </li>\n</ul>\n<p><strong>Semantic-only retrieval</strong>: Misses exact facts, dates, or identifiers.</p>\n<p><strong>Lexical-only retrieval</strong>: Misses paraphrased or implied information.</p>\n<p><strong>Unfiltered retrieval</strong>: Causes data leakage or compliance violations.</p>\n<p>Hybrid retrieval with three stages (<strong>metadata filtering, lexical retrieval, and semantic retrieval/ranking</strong>) minimizes all three.</p>\n<h6 id=\"final-synthesis\">Final Synthesis</h6>\n<ul>\n  <li>Hybrid retrieval is not an optimization but an architectural necessity: lexical retrieval anchors the system to exact facts, identifiers, and wording; semantic retrieval captures the user’s underlying intent and conceptual meaning; metadata filtering enforces correctness, safety, and access constraints; and re-ranking (covered in the <a href=\"#re-ranking\">Re-ranking</a> section) maximizes usefulness by prioritizing the most relevant and coherent results for downstream consumption. Together, these components form a coherent pipeline in which each stage compensates for the limitations of the others, producing search behavior that is precise, robust, and reliable at scale.</li>\n  <li>In RAG systems, generation quality is bounded by retrieval quality. Hybrid retrieval raises that bound by ensuring the language model sees the right information, for the right reasons, under the right constraints.</li>\n</ul>\n<h4 id=\"metadata-filtering\">Metadata Filtering</h4>\n<ul>\n  <li>Metadata filtering is the process of restricting the searchable corpus using structured, non-textual attributes attached to documents (such as access rights, tenant identifiers, language, timestamps, or document type) before or during retrieval, so that only contextually valid documents are ever considered for ranking.</li>\n  <li>Metadata filtering is applicable to lexical retrieval, semantic retrieval, and hybrid retrieval alike, and is typically applied first as hard constraints, meaning documents that fail these conditions are excluded entirely rather than merely penalized in scoring.</li>\n  <li>Treating metadata as hard constraints is essential because constraints like access control, tenancy, jurisdiction, and language are correctness requirements, not relevance preferences, regardless of whether relevance is computed lexically, semantically, or via a hybrid approach.</li>\n  <li>Applying hard filters early improves system efficiency by shrinking the candidate set before lexical matching, vector search, or expensive semantic scoring and reranking, which often dominate latency and cost.</li>\n  <li>By separating hard constraints from ranking logic, metadata filtering simplifies auditing, debugging, and explainability, allowing the system to clearly state that relevance was computed only within an explicitly defined and policy-compliant subset of the corpus.</li>\n</ul>\n<h6 id=\"standard-pattern\">Standard Pattern</h6>\n<ol>\n  <li>\n    <p>Apply metadata filters</p>\n\n    <ul>\n      <li>\n        <p>Examples:</p>\n\n        <ul>\n          <li>tenant_id = <code class=\"language-plaintext highlighter-rouge\">X</code></li>\n          <li>language = <code class=\"language-plaintext highlighter-rouge\">\"en\"</code></li>\n          <li>date ≥ <code class=\"language-plaintext highlighter-rouge\">2024-01-01</code></li>\n          <li>access_level ≤ <code class=\"language-plaintext highlighter-rouge\">user_clearance</code></li>\n        </ul>\n      </li>\n    </ul>\n  </li>\n  <li>\n    <p>Perform retrieval within the filtered set</p>\n\n    <ul>\n      <li>Lexical retrieval operates only on allowed documents</li>\n      <li>Semantic retrieval or re-ranking is applied afterward (if used)</li>\n      <li>Hybrid retrieval combines both within the same filtered universe</li>\n    </ul>\n  </li>\n</ol>\n<p>Apply metadata filters</p>\n<ul>\n      <li>\n        <p>Examples:</p>\n\n        <ul>\n          <li>tenant_id = <code class=\"language-plaintext highlighter-rouge\">X</code></li>\n          <li>language = <code class=\"language-plaintext highlighter-rouge\">\"en\"</code></li>\n          <li>date ≥ <code class=\"language-plaintext highlighter-rouge\">2024-01-01</code></li>\n          <li>access_level ≤ <code class=\"language-plaintext highlighter-rouge\">user_clearance</code></li>\n        </ul>\n      </li>\n    </ul>\n<p>Examples:</p>\n<ul>\n          <li>tenant_id = <code class=\"language-plaintext highlighter-rouge\">X</code></li>\n          <li>language = <code class=\"language-plaintext highlighter-rouge\">\"en\"</code></li>\n          <li>date ≥ <code class=\"language-plaintext highlighter-rouge\">2024-01-01</code></li>\n          <li>access_level ≤ <code class=\"language-plaintext highlighter-rouge\">user_clearance</code></li>\n        </ul>\n<p>Perform retrieval within the filtered set</p>\n<ul>\n      <li>Lexical retrieval operates only on allowed documents</li>\n      <li>Semantic retrieval or re-ranking is applied afterward (if used)</li>\n      <li>Hybrid retrieval combines both within the same filtered universe</li>\n    </ul>\n<ul>\n  <li>Formally:</li>\n</ul>\n<div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-88-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>Results</mtext><mo>=</mo><mtext>Rank</mtext><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo maxsize=&quot;1.2em&quot; minsize=&quot;1.2em&quot;>(</mo></mrow><mtext>Docs</mtext><mo>&amp;#x2223;</mo><mtext>metadata filters</mtext><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo maxsize=&quot;1.2em&quot; minsize=&quot;1.2em&quot;>)</mo></mrow></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-889\" style=\"width: 19.638em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 16.357em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(2.086em, 1016.2em, 3.753em, -999.997em); top: -3.174em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-890\"><span class=\"mtext\" id=\"MathJax-Span-891\" style=\"font-family: STIXGeneral-Regular;\">Results</span><span class=\"mo\" id=\"MathJax-Span-892\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mtext\" id=\"MathJax-Span-893\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">Rank</span><span class=\"texatom\" id=\"MathJax-Span-894\"><span class=\"mrow\" id=\"MathJax-Span-895\"><span class=\"mo\" id=\"MathJax-Span-896\" style=\"vertical-align: -0.258em;\"><span><span style=\"font-size: 110%; font-family: STIXSizeOneSym;\">(</span></span></span></span></span><span class=\"mtext\" id=\"MathJax-Span-897\" style=\"font-family: STIXGeneral-Regular;\">Docs</span><span class=\"mo\" id=\"MathJax-Span-898\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">∣</span><span class=\"mtext\" id=\"MathJax-Span-899\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">metadata filters</span><span class=\"texatom\" id=\"MathJax-Span-900\"><span class=\"mrow\" id=\"MathJax-Span-901\"><span class=\"mo\" id=\"MathJax-Span-902\" style=\"vertical-align: -0.258em;\"><span><span style=\"font-size: 110%; font-family: STIXSizeOneSym;\">)</span></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 3.18em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.559em; border-left: 0px solid; width: 0px; height: 1.753em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>Results</mtext><mo>=</mo><mtext>Rank</mtext><mrow class=\"MJX-TeXAtom-ORD\"><mo maxsize=\"1.2em\" minsize=\"1.2em\">(</mo></mrow><mtext>Docs</mtext><mo>∣</mo><mtext>metadata filters</mtext><mrow class=\"MJX-TeXAtom-ORD\"><mo maxsize=\"1.2em\" minsize=\"1.2em\">)</mo></mrow></math></span></span></div>\n<ul>\n  <li>This guarantees correctness by preventing data leakage, improves efficiency by reducing the search space early, and enables simpler reasoning and auditing by cleanly separating constraints from relevance scoring.</li>\n</ul>\n<h6 id=\"hard-filters-metadata-filtering-vs-soft-boosts-metadata-re-ranking\">Hard Filters (Metadata Filtering) vs. Soft Boosts (Metadata Re-ranking)</h6>\n<ul>\n  <li>Hard filters are non-negotiable constraints such as access control, tenancy boundaries, jurisdictional limits, and language restrictions that must be satisfied for a document to be retrievable at all. These must be satisfied before retrieval, excluding documents entirely from the searchable corpus rather than affecting their rank.</li>\n  <li>Soft boosts are preference signals such as recency, source authority, and content type that influence ranking after retrieval without excluding documents outright. This post-retrieval adjustment is commonly referred to as <strong>metadata re-ranking</strong>, where structured signals modify relevance scores rather than filter candidates.</li>\n</ul>",
    "contentMarkdown": "*   Retrieval is the core mechanism that enables RAG systems to ground language model outputs in external knowledge by selecting a small, relevant subset of documents or passages from a large corpus to condition generation.\n*   Lexical, semantic, and hybrid retrieval methods define how queries are mapped to candidate context, directly influencing what information the language model can and cannot use when generating an answer.\n*   A solid understanding of retrieval techniques is critical for RAG because retrieval failures (missing key facts, retrieving irrelevant context, or violating constraints) propagate downstream and manifest as hallucinations, inaccuracies, or unsafe outputs during generation.\n*   A detailed discourse of retrieval (also known as the information retrieval problem) is available in our [Search](../../../recsys/search) primer.\n\n#### Lexical Retrieval\n\n*   Lexical retrieval, also referred to as sparse retrieval, term-based retrieval, or keyword-based retrieval, is the classical foundation of information retrieval systems. It operates purely on observable text signals, relying on exact token matches between a query and documents. Relevance is estimated using statistical properties of terms within documents and across the corpus, without attempting to model meaning or intent.\n*   At its core, lexical retrieval assumes that relevance correlates with how frequently and distinctively query terms appear in a document.\n\n##### Core Assumptions\n\n*   Lexical retrieval is deterministic, interpretable, and highly efficient at scale because of the following assumptions:\n    \n    *   Words are treated as discrete symbols (tokens).\n    *   Matching is based on an exact match overlap.\n    *   Importance is inferred from distributional statistics, not semantics.\n    *   Query intent is approximated by the literal terms provided.\n\nLexical retrieval is deterministic, interpretable, and highly efficient at scale because of the following assumptions:\n\n*   Words are treated as discrete symbols (tokens).\n*   Matching is based on an exact match overlap.\n*   Importance is inferred from distributional statistics, not semantics.\n*   Query intent is approximated by the literal terms provided.\n\n##### TF-IDF (Term Frequency–Inverse Document Frequency)\n\n*   TF-IDF is one of the earliest and most influential scoring schemes in information retrieval. It decomposes relevance into two components:\n    \n    1.  **Term Frequency (TF)**: Measures how often a term appears in a document. The intuition is that repeated mentions indicate topical relevance.\n        \n    2.  **Inverse Document Frequency (IDF)**: Downweights terms that appear frequently across the corpus, under the assumption that common words carry less discriminative power.\n        \n*   A standard formulation is:\n    \n    TF-IDF(t,d)\\=TF(t,d)⋅log(NDF(t))TF-IDF(t,d)\\=TF(t,d)⋅log⁡(NDF(t))\n    \n    \\\\text{TF-IDF}(t, d) = \\\\text{TF}(t, d) \\\\cdot \\\\log\\\\left(\\\\frac{N}{\\\\text{DF}(t)}\\\\right)\n    *   where:\n        \n        *   ttt is a term,\n        *   ddd is a document,\n        *   NNN is the total number of documents,\n        *   DF(t)DF(t)\\\\text{DF}(t) is the number of documents containing ttt.\n\nTF-IDF is one of the earliest and most influential scoring schemes in information retrieval. It decomposes relevance into two components:\n\n1.  **Term Frequency (TF)**: Measures how often a term appears in a document. The intuition is that repeated mentions indicate topical relevance.\n    \n2.  **Inverse Document Frequency (IDF)**: Downweights terms that appear frequently across the corpus, under the assumption that common words carry less discriminative power.\n    \n\n**Term Frequency (TF)**: Measures how often a term appears in a document. The intuition is that repeated mentions indicate topical relevance.\n\n**Inverse Document Frequency (IDF)**: Downweights terms that appear frequently across the corpus, under the assumption that common words carry less discriminative power.\n\nA standard formulation is:\n\n*   where:\n    \n    *   ttt is a term,\n    *   ddd is a document,\n    *   NNN is the total number of documents,\n    *   DF(t)DF(t)\\\\text{DF}(t) is the number of documents containing ttt.\n\nwhere:\n\n*   ttt is a term,\n*   ddd is a document,\n*   NNN is the total number of documents,\n*   DF(t)DF(t)\\\\text{DF}(t) is the number of documents containing ttt.\n\n##### Strengths of TF-IDF\n\n*   Simple and fast to compute.\n*   Strong baseline for keyword-heavy queries.\n*   Fully interpretable scoring.\n*   Requires no training data.\n\n##### Limitations of TF-IDF\n\n*   These limitations motivated more refined probabilistic ranking functions.\n    \n    *   Linear growth of TF causes term repetition to dominate scores.\n    *   No document length normalization.\n    *   Treats all term positions equally.\n    *   Performs poorly on long documents and verbose queries.\n    *   Fails completely on synonymy and paraphrasing.\n\nThese limitations motivated more refined probabilistic ranking functions.\n\n*   Linear growth of TF causes term repetition to dominate scores.\n*   No document length normalization.\n*   Treats all term positions equally.\n*   Performs poorly on long documents and verbose queries.\n*   Fails completely on synonymy and paraphrasing.\n\n##### BM25 (Best Matching 25)\n\n*   BM25 is a probabilistic retrieval model that improves upon TF-IDF by addressing its key weaknesses. It introduces two critical refinements:\n    \n    1.  **Term frequency saturation**: Additional occurrences of a term provide diminishing returns rather than linear gains.\n        \n    2.  **Document length normalization**: Longer documents are normalized to prevent unfair advantage due to sheer volume of text.\n        \n*   A common BM25 formulation is:\n    \n    BM25(q,d)\\=∑t∈qIDF(t)⋅f(t,d)⋅(k1+1)f(t,d)+k1⋅(1−b+b⋅|d|avgdl)BM25(q,d)\\=∑t∈qIDF(t)⋅f(t,d)⋅(k1+1)f(t,d)+k1⋅(1−b+b⋅|d|avgdl)\n    \n    \\\\text{BM25}(q, d) = \\\\sum\\_{t \\\\in q} \\\\text{IDF}(t) \\\\cdot \\\\frac{f(t,d) \\\\cdot (k\\_1 + 1)} {f(t,d) + k\\_1 \\\\cdot \\\\left(1 - b + b \\\\cdot \\\\frac{|d|}{\\\\text{avgdl}}\\\\right)}\n    *   where:\n        \n        *   f(t,d)f(t,d)f(t,d) is the frequency of term ttt in document ddd,\n        *   ∣d∣∣d∣\\\\mid d \\\\mid is the document length,\n        *   avgdlavgdl\\\\text{avgdl} is the average document length,\n        *   k1k1k\\_1 controls TF saturation (typically 1.2≤k1≤2.01.2≤k1≤2.01.2 \\\\le k\\_1 \\\\le 2.0),\n        *   bbb controls length normalization (typically b≈0.75b≈0.75b \\\\approx 0.75).\n\nBM25 is a probabilistic retrieval model that improves upon TF-IDF by addressing its key weaknesses. It introduces two critical refinements:\n\n1.  **Term frequency saturation**: Additional occurrences of a term provide diminishing returns rather than linear gains.\n    \n2.  **Document length normalization**: Longer documents are normalized to prevent unfair advantage due to sheer volume of text.\n    \n\n**Term frequency saturation**: Additional occurrences of a term provide diminishing returns rather than linear gains.\n\n**Document length normalization**: Longer documents are normalized to prevent unfair advantage due to sheer volume of text.\n\nA common BM25 formulation is:\n\n*   where:\n    \n    *   f(t,d)f(t,d)f(t,d) is the frequency of term ttt in document ddd,\n    *   ∣d∣∣d∣\\\\mid d \\\\mid is the document length,\n    *   avgdlavgdl\\\\text{avgdl} is the average document length,\n    *   k1k1k\\_1 controls TF saturation (typically 1.2≤k1≤2.01.2≤k1≤2.01.2 \\\\le k\\_1 \\\\le 2.0),\n    *   bbb controls length normalization (typically b≈0.75b≈0.75b \\\\approx 0.75).\n\nwhere:\n\n*   f(t,d)f(t,d)f(t,d) is the frequency of term ttt in document ddd,\n*   ∣d∣∣d∣\\\\mid d \\\\mid is the document length,\n*   avgdlavgdl\\\\text{avgdl} is the average document length,\n*   k1k1k\\_1 controls TF saturation (typically 1.2≤k1≤2.01.2≤k1≤2.01.2 \\\\le k\\_1 \\\\le 2.0),\n*   bbb controls length normalization (typically b≈0.75b≈0.75b \\\\approx 0.75).\n\n##### Why BM25 Outperforms TF-IDF\n\n*   BM25 remains the default lexical ranking function in most production search engines. It outperforms TF-IDF along the following dimensions:\n    \n    *   Prevents term stuffing from dominating rankings.\n    *   Fairly compares short and long documents.\n    *   More stable across heterogeneous corpora.\n    *   Empirically strong across many domains without tuning.\n\nBM25 remains the default lexical ranking function in most production search engines. It outperforms TF-IDF along the following dimensions:\n\n*   Prevents term stuffing from dominating rankings.\n*   Fairly compares short and long documents.\n*   More stable across heterogeneous corpora.\n*   Empirically strong across many domains without tuning.\n\n##### Operational Characteristics of Lexical Retrieval\n\n*   **Performance and scalability**:\n    \n    *   Sub-millisecond scoring per document.\n    *   Efficient inverted index structures.\n    *   Scales to billions of documents.\n*   **Determinism**:\n    \n    *   Identical inputs always produce identical rankings.\n    *   No stochastic components or model drift.\n*   **Explainability**:\n    \n    *   Rankings can be justified via term overlap and weights.\n    *   Essential for regulated or high-stakes systems.\n\n**Performance and scalability**:\n\n*   Sub-millisecond scoring per document.\n*   Efficient inverted index structures.\n*   Scales to billions of documents.\n\n**Determinism**:\n\n*   Identical inputs always produce identical rankings.\n*   No stochastic components or model drift.\n\n**Explainability**:\n\n*   Rankings can be justified via term overlap and weights.\n*   Essential for regulated or high-stakes systems.\n\n##### Advantages of Lexical Retrieval\n\n*   Extremely fast and resource-efficient.\n*   Robust to rare, technical, or newly introduced terms.\n*   Guarantees recall for exact matches.\n*   Transparent scoring behavior.\n*   Works exceptionally well for:\n    *   Identifiers (product IDs, SKUs, error codes, etc.)\n    *   Entity names (proper nouns, etc.)\n    *   Dates (timestamps, ranges, etc.)\n    *   Abbreviations (e.g., API, HTTP, JWT, etc.)\n    *   Domain-specific jargon (e.g., medicine names, chemical compounds, etc.)\n    *   Legal clauses (e.g., “Section 3.2.1”, etc.) and citations (e.g., “17 U.S.C. § 512”, etc.)\n    *   Short or underspecified queries\n\n*   Identifiers (product IDs, SKUs, error codes, etc.)\n*   Entity names (proper nouns, etc.)\n*   Dates (timestamps, ranges, etc.)\n*   Abbreviations (e.g., API, HTTP, JWT, etc.)\n*   Domain-specific jargon (e.g., medicine names, chemical compounds, etc.)\n*   Legal clauses (e.g., “Section 3.2.1”, etc.) and citations (e.g., “17 U.S.C. § 512”, etc.)\n*   Short or underspecified queries\n\n##### Limitations of Lexical Retrieval\n\n*   Lexical retrieval limitations are structural, not implementation flaws, and they are the primary reason semantic and hybrid retrieval methods emerged:\n    *   No understanding of meaning or intent.\n    *   Cannot match synonyms or paraphrases.\n    *   Sensitive to vocabulary mismatch.\n    *   Brittle for natural language questions.\n    *   Poor recall for descriptive or conversational queries.\n\n*   No understanding of meaning or intent.\n*   Cannot match synonyms or paraphrases.\n*   Sensitive to vocabulary mismatch.\n*   Brittle for natural language questions.\n*   Poor recall for descriptive or conversational queries.\n\n#### Semantic Retrieval\n\n*   Semantic retrieval, also commonly referred to as dense retrieval, neural retrieval, or embedding-based retrieval, is a modern approach to information retrieval that attempts to model the meaning and intent behind queries and documents rather than relying on exact lexical overlap.\n    \n*   Instead of treating text as discrete symbols, semantic retrieval represents text as continuous vectors in a high-dimensional space. Relevance is determined by geometric proximity in this space, under the assumption that semantically similar texts lie close to each other.\n    \n\nSemantic retrieval, also commonly referred to as dense retrieval, neural retrieval, or embedding-based retrieval, is a modern approach to information retrieval that attempts to model the meaning and intent behind queries and documents rather than relying on exact lexical overlap.\n\nInstead of treating text as discrete symbols, semantic retrieval represents text as continuous vectors in a high-dimensional space. Relevance is determined by geometric proximity in this space, under the assumption that semantically similar texts lie close to each other.\n\n##### Core Idea\n\n*   Semantic retrieval reframes search as a similarity problem in vector space:\n    \n    *   Queries and documents are encoded into dense vectors.\n    *   Similarity between vectors approximates semantic relatedness.\n    *   Retrieval becomes a nearest-neighbor search problem.\n*   A common similarity measure is cosine similarity:\n    \n    cosine\\_sim(q,d)\\=q⃗ ⋅d⃗ ∣q⃗ ∣∣d⃗ ∣cosine\\_sim(q,d)\\=q→⋅d→∣q→∣∣d→∣\n    \n    \\\\text{cosine\\_sim}(q, d) = \\\\frac{\\\\vec{q} \\\\cdot \\\\vec{d}} {\\\\mid\\\\vec{q}\\\\mid \\\\mid\\\\vec{d}\\\\mid}\n    *   where:\n        \n        *   q⃗ q→\\\\vec{q} is the query embedding,\n        *   d⃗ d→\\\\vec{d} is the document embedding.\n\nSemantic retrieval reframes search as a similarity problem in vector space:\n\n*   Queries and documents are encoded into dense vectors.\n*   Similarity between vectors approximates semantic relatedness.\n*   Retrieval becomes a nearest-neighbor search problem.\n\nA common similarity measure is cosine similarity:\n\n*   where:\n    \n    *   q⃗ q→\\\\vec{q} is the query embedding,\n    *   d⃗ d→\\\\vec{d} is the document embedding.\n\nwhere:\n\n*   q⃗ q→\\\\vec{q} is the query embedding,\n*   d⃗ d→\\\\vec{d} is the document embedding.\n\n##### Vector Encoding\n\n*   **Encoder models**:\n    *   Queries and documents are passed through neural encoders, typically based on transformer architectures. Common encoder types include:\n        \n        *   Dual encoders (bi-encoders)\n        *   [Sentence transformers](http://sbert.net/)\n        *   Domain-specific fine-tuned encoders\n    *   In most production systems, queries and documents are encoded independently to allow precomputation of document embeddings.\n        \n*   **Training signal**:\n    *   Encoders are trained using contrastive objectives that:\n        \n        *   Pull relevant query–document pairs closer\n        *   Push irrelevant pairs farther apart\n    *   A simplified contrastive loss can be expressed as:\n        \n        \\=−logexp(sim(q,d+))exp(sim(q,d+))+∑d−exp(sim(q,d−))L\\=−log⁡exp⁡(sim(q,d+))exp⁡(sim(q,d+))+∑d−exp⁡(sim(q,d−))\n        \n        \\\\mathcal{L} = -\\\\log\\\\frac{\\\\exp(\\\\text{sim}(q, d^+))}{\\\\exp(\\\\text{sim}(q, d^+)) + \\\\sum\\_{d^-} \\\\exp(\\\\text{sim}(q, d^-))}\n        *   where d+d+d^+ is a relevant document and d−d−d^- are negatives.\n*   **Representation properties**:\n    *   Good semantic embeddings capture:\n        \n        *   Synonymy and paraphrasing\n        *   Conceptual similarity\n        *   Contextual meaning\n        *   Cross-lingual alignment (in multilingual models)\n\n*   Queries and documents are passed through neural encoders, typically based on transformer architectures. Common encoder types include:\n    \n    *   Dual encoders (bi-encoders)\n    *   [Sentence transformers](http://sbert.net/)\n    *   Domain-specific fine-tuned encoders\n*   In most production systems, queries and documents are encoded independently to allow precomputation of document embeddings.\n    \n\nQueries and documents are passed through neural encoders, typically based on transformer architectures. Common encoder types include:\n\n*   Dual encoders (bi-encoders)\n*   [Sentence transformers](http://sbert.net/)\n*   Domain-specific fine-tuned encoders\n\nIn most production systems, queries and documents are encoded independently to allow precomputation of document embeddings.\n\n*   Encoders are trained using contrastive objectives that:\n    \n    *   Pull relevant query–document pairs closer\n    *   Push irrelevant pairs farther apart\n*   A simplified contrastive loss can be expressed as:\n    \n    \\=−logexp(sim(q,d+))exp(sim(q,d+))+∑d−exp(sim(q,d−))L\\=−log⁡exp⁡(sim(q,d+))exp⁡(sim(q,d+))+∑d−exp⁡(sim(q,d−))\n    \n    \\\\mathcal{L} = -\\\\log\\\\frac{\\\\exp(\\\\text{sim}(q, d^+))}{\\\\exp(\\\\text{sim}(q, d^+)) + \\\\sum\\_{d^-} \\\\exp(\\\\text{sim}(q, d^-))}\n    *   where d+d+d^+ is a relevant document and d−d−d^- are negatives.\n\nEncoders are trained using contrastive objectives that:\n\n*   Pull relevant query–document pairs closer\n*   Push irrelevant pairs farther apart\n\nA simplified contrastive loss can be expressed as:\n\n*   where d+d+d^+ is a relevant document and d−d−d^- are negatives.\n\n*   Good semantic embeddings capture:\n    \n    *   Synonymy and paraphrasing\n    *   Conceptual similarity\n    *   Contextual meaning\n    *   Cross-lingual alignment (in multilingual models)\n\nGood semantic embeddings capture:\n\n*   Synonymy and paraphrasing\n*   Conceptual similarity\n*   Contextual meaning\n*   Cross-lingual alignment (in multilingual models)\n\n##### Semantic Matching and Retrieval\n\n*   Once embeddings are computed:\n    \n    *   Documents are indexed in a vector index.\n    *   At query time, the query embedding is generated.\n    *   Approximate nearest neighbor search retrieves the top KKK closest document vectors.\n*   This enables matches even when there is zero keyword overlap between query and document.\n    \n\nOnce embeddings are computed:\n\n*   Documents are indexed in a vector index.\n*   At query time, the query embedding is generated.\n*   Approximate nearest neighbor search retrieves the top KKK closest document vectors.\n\nThis enables matches even when there is zero keyword overlap between query and document.\n\n##### Approaches\n\n*   Let’s look at three different types of retrieval: standard, sentence window, and auto-merging. Each of these approaches has specific strengths and weaknesses, and their suitability depends on the requirements of the RAG task, including the nature of the dataset, the complexity of the queries, and the desired balance between specificity and contextual understanding in the responses.\n\n###### Standard/Naive Approach\n\n*   As we see in the image below [(source)](https://learn.deeplearning.ai/building-evaluating-advanced-rag/lesson/2/advanced-rag-pipeline), the standard pipeline uses the same text chunk for indexing/embedding as well as the output synthesis.\n\n![](/primers/ai/assets/RAG/9.png)\n\n*   In the context of RAG, the advantages and disadvantages of the three approaches are as follows:\n    \n*   **Advantages**:\n    \n    *   **Simplicity and Efficiency**: This method is straightforward and efficient, using the same text chunk for both embedding and synthesis, simplifying the retrieval process.\n    *   **Uniformity in Data Handling**: It maintains consistency in the data used across both retrieval and synthesis phases.\n*   **Disadvantages**:\n    \n    *   **Limited Contextual Understanding**: LLMs may require a larger window for synthesis to generate better responses, which this approach may not adequately provide.\n    *   **Potential for Suboptimal Responses**: Due to the limited context, the LLM might not have enough information to generate the most relevant and accurate responses.\n\nIn the context of RAG, the advantages and disadvantages of the three approaches are as follows:\n\n**Advantages**:\n\n*   **Simplicity and Efficiency**: This method is straightforward and efficient, using the same text chunk for both embedding and synthesis, simplifying the retrieval process.\n*   **Uniformity in Data Handling**: It maintains consistency in the data used across both retrieval and synthesis phases.\n\n**Disadvantages**:\n\n*   **Limited Contextual Understanding**: LLMs may require a larger window for synthesis to generate better responses, which this approach may not adequately provide.\n*   **Potential for Suboptimal Responses**: Due to the limited context, the LLM might not have enough information to generate the most relevant and accurate responses.\n\n###### Sentence-Window Retrieval / Small-to-Large Retrieval\n\n*   The sentence-window approach breaks down documents into smaller units, such as sentences or small groups of sentences.\n*   It decouples the embeddings for retrieval tasks (which are smaller chunks stored in a Vector DB), but for synthesis it adds back in the context around the retrieved chunks, as seen in the image below [(source)](https://learn.deeplearning.ai/building-evaluating-advanced-rag/lesson/2/advanced-rag-pipeline).\n\n![](/primers/ai/assets/RAG/10.png)\n\n*   During retrieval, we retrieve the sentences that are most relevant to the query via similarity search and replace the sentence with the full surrounding context (using a static sentence-window around the context, implemented by retrieving sentences surrounding the one being originally retrieved) as shown in the figure below [(source)](https://learn.deeplearning.ai/building-evaluating-advanced-rag/lesson/2/advanced-rag-pipeline).\n\n![](/primers/ai/assets/RAG/11.png)\n\n*   **Advantages**:\n    \n    *   **Enhanced Specificity in Retrieval**: By breaking documents into smaller units, it enables more precise retrieval of segments directly relevant to a query.\n    *   **Context-Rich Synthesis**: It reintroduces context around the retrieved chunks for synthesis, providing the LLM with a broader understanding to formulate responses.\n    *   **Balanced Approach**: This method strikes a balance between focused retrieval and contextual richness, potentially improving response quality.\n*   **Disadvantages**:\n    \n    *   **Increased Complexity**: Managing separate processes for retrieval and synthesis adds complexity to the pipeline.\n    *   **Potential Contextual Gaps**: There’s a risk of missing broader context if the surrounding information added back is not sufficiently comprehensive.\n\n**Advantages**:\n\n*   **Enhanced Specificity in Retrieval**: By breaking documents into smaller units, it enables more precise retrieval of segments directly relevant to a query.\n*   **Context-Rich Synthesis**: It reintroduces context around the retrieved chunks for synthesis, providing the LLM with a broader understanding to formulate responses.\n*   **Balanced Approach**: This method strikes a balance between focused retrieval and contextual richness, potentially improving response quality.\n\n**Disadvantages**:\n\n*   **Increased Complexity**: Managing separate processes for retrieval and synthesis adds complexity to the pipeline.\n*   **Potential Contextual Gaps**: There’s a risk of missing broader context if the surrounding information added back is not sufficiently comprehensive.\n\n###### Auto-merging Retriever / Hierarchical Retriever\n\n*   The image below [(source)](https://learn.deeplearning.ai/building-evaluating-advanced-rag/lesson/2/advanced-rag-pipeline), illustrates how auto-merging retrieval can work where it doesn’t retrieve a bunch of fragmented chunks as would happen with the naive approach.\n\n![](/primers/ai/assets/RAG/6.png)\n\n*   The fragmentation in the naive approach would be worse with smaller chunk sizes as shown below [(source)](https://learn.deeplearning.ai/building-evaluating-advanced-rag/lesson/2/advanced-rag-pipeline).\n\n![](/primers/ai/assets/RAG/12.png)\n\n*   Auto-merging retrieval aims to combine (or merge) information from multiple sources or segments of text to create a more comprehensive and contextually relevant response to a query. This approach is particularly useful when no single document or segment fully answers the query but rather the answer lies in combining information from multiple sources.\n*   It allows smaller chunks to be merged into bigger parent chunks. It does this via the following steps:\n    1.  Define a hierarchy of smaller chunks linked to parent chunks.\n    2.  If the set of smaller chunks linking to a parent chunk exceeds some threshold (say, cosine similarity), then “merge” smaller chunks into the bigger parent chunk.\n*   The method will finally retrieve the parent chunk for better context.\n    \n*   **Advantages**:\n    \n    *   **Comprehensive Contextual Responses**: By merging information from multiple sources, it creates responses that are more comprehensive and contextually relevant.\n    *   **Reduced Fragmentation**: This approach addresses the issue of fragmented information retrieval, common in the naive approach, especially with smaller chunk sizes.\n    *   **Dynamic Content Integration**: It dynamically combines smaller chunks into larger, more informative ones, enhancing the richness of the information provided to the LLM.\n*   **Disadvantages**:\n    \n    *   **Complexity in Hierarchy and Threshold Management**: The process of defining hierarchies and setting appropriate thresholds for merging is complex and critical for effective functioning.\n    *   **Risk of Over-generalization**: There’s a possibility of merging too much or irrelevant information, leading to responses that are too broad or off-topic.\n    *   **Computational Intensity**: This method might be more computationally intensive due to the additional steps in merging and managing the hierarchical structure of text chunks.\n\n1.  Define a hierarchy of smaller chunks linked to parent chunks.\n2.  If the set of smaller chunks linking to a parent chunk exceeds some threshold (say, cosine similarity), then “merge” smaller chunks into the bigger parent chunk.\n\nThe method will finally retrieve the parent chunk for better context.\n\n**Advantages**:\n\n*   **Comprehensive Contextual Responses**: By merging information from multiple sources, it creates responses that are more comprehensive and contextually relevant.\n*   **Reduced Fragmentation**: This approach addresses the issue of fragmented information retrieval, common in the naive approach, especially with smaller chunk sizes.\n*   **Dynamic Content Integration**: It dynamically combines smaller chunks into larger, more informative ones, enhancing the richness of the information provided to the LLM.\n\n**Disadvantages**:\n\n*   **Complexity in Hierarchy and Threshold Management**: The process of defining hierarchies and setting appropriate thresholds for merging is complex and critical for effective functioning.\n*   **Risk of Over-generalization**: There’s a possibility of merging too much or irrelevant information, leading to responses that are too broad or off-topic.\n*   **Computational Intensity**: This method might be more computationally intensive due to the additional steps in merging and managing the hierarchical structure of text chunks.\n\n###### Contextual Retrieval\n\n*   For LLMs to deliver relevant and accurate responses, they must retrieve the right information from a knowledge base. Traditional RAG improves model accuracy by fetching relevant text chunks and appending them to the prompt. However, such methods often remove crucial context when encoding information, leading to failed retrievals and suboptimal outputs.\n*   Contextual Retrieval, introduced by [Anthropic](https://www.anthropic.com/news/contextual-retrieval), is an advanced technique designed to improve this process by ensuring that retrieved chunks maintain their original context. It employs contextual embeddings – embeddings that incorporate chunk-specific background information and contextual BM25 – an enhanced BM25 ranking that considers the broader document context.\n*   By prepending contextual metadata to each document chunk before embedding, Contextual Retrieval significantly enhances search accuracy. This approach reduces failed retrievals by 49% and, when combined with re-ranking, by 67%.\n    \n*   **Why Context Matters in Retrieval**:\n    *   Traditional RAG solutions divide documents into small chunks for efficient retrieval. However, these fragments often lose critical context. For example, the statement “The company’s revenue grew by 3% over the previous quarter” lacks information about which company or quarter it refers to. Contextual Retrieval solves this by embedding relevant metadata into each chunk.\n*   **Implementation of Contextual Retrieval**:\n    *   To implement Contextual Retrieval, a model like Claude 3 Haiku can generate concise context for each chunk. This context is then prepended before embedding and indexing, ensuring more precise retrieval. Developers can automate this process at scale using specialized retrieval pipelines.\n*   **Prompt Used for Contextual Retrieval**:\n    *   Anthropic’s method involves using Claude to generate a short, document-specific context for each chunk using the following prompt:\n        \n        ![](https://aman.ai/images/copy.png)\n        \n          `<document>                </document>      Here is the chunk we want to situate within the whole document:      <chunk>                </chunk>      Please give a short, succinct context to situate this chunk within the overall document for the purposes of improving search retrieval of the chunk. Answer only with the succinct context and nothing else.`\n        \n    *   This process automatically generates a concise contextualized description that is prepended to the chunk before embedding and indexing.\n*   **Combining Contextual Retrieval with Re-ranking**:\n    *   For maximum performance, Contextual Retrieval can be paired with re-ranking models, which filter and reorder retrieved chunks based on their relevance. This additional step enhances retrieval precision, ensuring only the most relevant chunks are passed to the LLM.\n*   The following flowchart from Anthropic’s [blog](https://www.anthropic.com/news/contextual-retrieval) shows the combined contextual retrieval and re-ranking stages which seek to maximize retrieval accuracy.\n\nBy prepending contextual metadata to each document chunk before embedding, Contextual Retrieval significantly enhances search accuracy. This approach reduces failed retrievals by 49% and, when combined with re-ranking, by 67%.\n\n*   Traditional RAG solutions divide documents into small chunks for efficient retrieval. However, these fragments often lose critical context. For example, the statement “The company’s revenue grew by 3% over the previous quarter” lacks information about which company or quarter it refers to. Contextual Retrieval solves this by embedding relevant metadata into each chunk.\n\n*   To implement Contextual Retrieval, a model like Claude 3 Haiku can generate concise context for each chunk. This context is then prepended before embedding and indexing, ensuring more precise retrieval. Developers can automate this process at scale using specialized retrieval pipelines.\n\n*   Anthropic’s method involves using Claude to generate a short, document-specific context for each chunk using the following prompt:\n    \n    ![](https://aman.ai/images/copy.png)\n    \n      `<document>                </document>      Here is the chunk we want to situate within the whole document:      <chunk>                </chunk>      Please give a short, succinct context to situate this chunk within the overall document for the purposes of improving search retrieval of the chunk. Answer only with the succinct context and nothing else.`\n    \n*   This process automatically generates a concise contextualized description that is prepended to the chunk before embedding and indexing.\n\n![](https://aman.ai/images/copy.png)\n\n  `<document>                </document>      Here is the chunk we want to situate within the whole document:      <chunk>                </chunk>      Please give a short, succinct context to situate this chunk within the overall document for the purposes of improving search retrieval of the chunk. Answer only with the succinct context and nothing else.`\n\n*   For maximum performance, Contextual Retrieval can be paired with re-ranking models, which filter and reorder retrieved chunks based on their relevance. This additional step enhances retrieval precision, ensuring only the most relevant chunks are passed to the LLM.\n\n![](/primers/ai/assets/RAG/contextual-retrieval.jpg)\n\n*   **Key Takeaways**:\n    *   Contextual Embeddings improve retrieval accuracy by preserving document meaning.\n    *   BM25 + Contextualization enhances exact-match retrieval.\n    *   Combining Contextual Retrieval with re-ranking further boosts retrieval effectiveness.\n    *   Developers can implement Contextual Retrieval using prompt-based preprocessing and automated pipelines.\n*   With Contextual Retrieval, LLM-powered knowledge systems can achieve greater accuracy, scalability, and relevance, unlocking new levels of performance in real-world applications.\n\n*   Contextual Embeddings improve retrieval accuracy by preserving document meaning.\n*   BM25 + Contextualization enhances exact-match retrieval.\n*   Combining Contextual Retrieval with re-ranking further boosts retrieval effectiveness.\n*   Developers can implement Contextual Retrieval using prompt-based preprocessing and automated pipelines.\n\n##### Using Approximate Nearest Neighbors (ANN) for Retrieval\n\n*   The next step is to consider which Approximate Nearest Neighbors (ANN) algorithm and library to choose for **large-scale vector similarity search in retrieval systems**. ANN is preferred over exact nearest neighbor search because:\n    \n    *   Exact search scales linearly with corpus size and becomes prohibitively slow and expensive for large embedding collections.\n    *   ANN trades a small, controllable loss in recall for orders-of-magnitude improvements in latency and throughput.\n    *   Modern ANN methods are designed to meet strict production constraints (low latency, bounded memory, high QPS), which are critical for real-time RAG pipelines.\n*   A useful way to compare and select an appropriate ANN approach is to reference **[ANN-Benchmarks](https://ann-benchmarks.com/)**, which provides standardized evaluations of different algorithms across accuracy, latency, and resource trade-offs.\n*   A detailed discourse on the concept of ANN can be found in our [ANN primer](../ann-similarity-search).\n\nThe next step is to consider which Approximate Nearest Neighbors (ANN) algorithm and library to choose for **large-scale vector similarity search in retrieval systems**. ANN is preferred over exact nearest neighbor search because:\n\n*   Exact search scales linearly with corpus size and becomes prohibitively slow and expensive for large embedding collections.\n*   ANN trades a small, controllable loss in recall for orders-of-magnitude improvements in latency and throughput.\n*   Modern ANN methods are designed to meet strict production constraints (low latency, bounded memory, high QPS), which are critical for real-time RAG pipelines.\n\n##### Advantages of Semantic Retrieval\n\n*   Strong handling of paraphrases and synonyms.\n*   Robust to vocabulary mismatch.\n*   Supports natural language and conversational queries.\n*   Effective for long, descriptive queries.\n*   Often works across languages without explicit translation.\n*   Recovers relevant content missed by lexical methods.\n\n##### Challenges\n\n*   **Computational cost**:\n    \n    *   Embedding generation is expensive relative to lexical scoring.\n    *   Nearest neighbor search is more complex than inverted index lookup.\n*   **Approximation trade-offs**:\n    \n    *   Vector search typically uses approximate algorithms.\n    *   Recall may be sacrificed for latency at scale.\n*   **Model dependence**:\n    \n    *   Retrieval quality depends heavily on training data.\n    *   Domain mismatch can degrade performance.\n    *   Biases in training data propagate into retrieval results.\n*   **Maintenance complexity**:\n    \n    *   Document embeddings must be recomputed when:\n        *   The corpus changes significantly\n        *   The model is updated\n    *   Versioning embeddings and models adds operational overhead.\n*   **Precision issues**:\n    \n    *   Semantic similarity can over-generalize.\n    *   Exact constraints, identifiers, or negations may be missed.\n    *   Rare or newly introduced terms may not be well represented.\n\n**Computational cost**:\n\n*   Embedding generation is expensive relative to lexical scoring.\n*   Nearest neighbor search is more complex than inverted index lookup.\n\n**Approximation trade-offs**:\n\n*   Vector search typically uses approximate algorithms.\n*   Recall may be sacrificed for latency at scale.\n\n**Model dependence**:\n\n*   Retrieval quality depends heavily on training data.\n*   Domain mismatch can degrade performance.\n*   Biases in training data propagate into retrieval results.\n\n**Maintenance complexity**:\n\n*   Document embeddings must be recomputed when:\n    *   The corpus changes significantly\n    *   The model is updated\n*   Versioning embeddings and models adds operational overhead.\n\n*   The corpus changes significantly\n*   The model is updated\n\n**Precision issues**:\n\n*   Semantic similarity can over-generalize.\n*   Exact constraints, identifiers, or negations may be missed.\n*   Rare or newly introduced terms may not be well represented.\n\n##### Use-cases Where Semantic Retrieval Excels\n\n*   Exploratory or research-oriented search.\n*   Natural language question answering.\n*   Knowledge discovery and recall-heavy tasks.\n*   User-facing search with ambiguous or verbose queries.\n\n##### Use-cases Where Semantic Retrieval Struggles\n\n*   These strengths and weaknesses are complementary to lexical retrieval, which is why semantic retrieval is rarely deployed alone in high-reliability systems. Specifically the areas where semantic search struggles are as follows:\n    \n    *   Queries dominated by symbols, codes, or IDs.\n    *   Legal, medical, or compliance-sensitive text requiring exact wording.\n    *   Short, underspecified queries with little context.\n    *   Scenarios demanding deterministic, explainable rankings.\n\nThese strengths and weaknesses are complementary to lexical retrieval, which is why semantic retrieval is rarely deployed alone in high-reliability systems. Specifically the areas where semantic search struggles are as follows:\n\n*   Queries dominated by symbols, codes, or IDs.\n*   Legal, medical, or compliance-sensitive text requiring exact wording.\n*   Short, underspecified queries with little context.\n*   Scenarios demanding deterministic, explainable rankings.\n\n#### Hybrid Retrieval (Lexical + Semantic)\n\n*   Hybrid retrieval combines lexical (sparse) and semantic (dense) retrieval to leverage the complementary strengths of both approaches. The core motivation is simple: real-world queries simultaneously contain exact terms that must be respected and implicit intent that must be inferred.\n    \n*   A hybrid retrieval system combines the strengths of lexical and semantic methods to deliver more accurate and robust results by reducing the likelihood that either system’s blind spots dominate the final ranking.\n    \n*   Hybrid systems are designed to minimize worst-case failure modes by ensuring that neither exact matching nor semantic understanding is relied on exclusively.\n    \n\nHybrid retrieval combines lexical (sparse) and semantic (dense) retrieval to leverage the complementary strengths of both approaches. The core motivation is simple: real-world queries simultaneously contain exact terms that must be respected and implicit intent that must be inferred.\n\nA hybrid retrieval system combines the strengths of lexical and semantic methods to deliver more accurate and robust results by reducing the likelihood that either system’s blind spots dominate the final ranking.\n\nHybrid systems are designed to minimize worst-case failure modes by ensuring that neither exact matching nor semantic understanding is relied on exclusively.\n\n##### Why Hybrid Retrieval is Necessary\n\n*   Lexical and semantic retrieval fail in opposite ways:\n    \n    *   Lexical retrieval fails when vocabulary mismatch occurs.\n    *   Semantic retrieval fails when exact wording, identifiers, or constraints matter.\n*   Hybrid retrieval exists to ensure:\n    \n    *   Exact matches are never lost.\n    *   Semantic relevance is still captured.\n    *   Recall and precision remain stable across query types.\n*   In practice, hybrid retrieval is not a single algorithm but a family of architectures.\n    \n\nLexical and semantic retrieval fail in opposite ways:\n\n*   Lexical retrieval fails when vocabulary mismatch occurs.\n*   Semantic retrieval fails when exact wording, identifiers, or constraints matter.\n\nHybrid retrieval exists to ensure:\n\n*   Exact matches are never lost.\n*   Semantic relevance is still captured.\n*   Recall and precision remain stable across query types.\n\nIn practice, hybrid retrieval is not a single algorithm but a family of architectures.\n\n##### Common Hybrid Retrieval Architectures\n\n*   **Two-stage hybrid retrieval**: Lexical retrieval is used first to generate a high-recall candidate set, which is then reranked by a semantic model. This design prioritizes efficiency and recall safety while allowing deep semantic reasoning to operate only where it matters.\n    \n*   **Parallel hybrid retrieval with fusion**: Lexical and semantic retrievers run independently over the corpus, and their results are merged using score-based or rank-based fusion methods. This approach treats lexical and semantic signals as peers rather than stages in a pipeline.\n    \n*   **Native hybrid scoring**: Some systems integrate sparse and dense signals directly into a single retrieval model or query interface, blending term-based and embedding-based evidence during initial retrieval rather than combining results afterward.\n    \n\n**Two-stage hybrid retrieval**: Lexical retrieval is used first to generate a high-recall candidate set, which is then reranked by a semantic model. This design prioritizes efficiency and recall safety while allowing deep semantic reasoning to operate only where it matters.\n\n**Parallel hybrid retrieval with fusion**: Lexical and semantic retrievers run independently over the corpus, and their results are merged using score-based or rank-based fusion methods. This approach treats lexical and semantic signals as peers rather than stages in a pipeline.\n\n**Native hybrid scoring**: Some systems integrate sparse and dense signals directly into a single retrieval model or query interface, blending term-based and embedding-based evidence during initial retrieval rather than combining results afterward.\n\n###### The Dominant Production Architecture: Lexical Retrieval + Semantic Re-ranking\n\n*   The most common hybrid architecture is a two-stage pipeline:\n    \n    1.  **Candidate generation (lexical)**:\n        *   A lexical retriever (typically BM25) retrieves the top KKK candidates based on exact term overlap.\n            \n        *   Typical values:\n            \n            *   K∈\\[100,1000\\]K∈\\[100,1000\\]\n                \n                K \\\\in \\[100, 1000\\]\n            *   Chosen to maximize recall while keeping downstream cost manageable\n    2.  **Semantic re-ranking (dense or cross-encoder)**:\n        *   Semantic re-ranking models aim to improve the ordering of retrieved documents by more accurately modeling relevance between a query and a small candidate set.\n        *   In practice, these models are used after an initial retrieval step and can be grouped both by how they encode query–document interactions and by the type of signals they incorporate (semantic, instructional, or metadata-driven).\n*   Conceptually:\n    \n    Results\\=Reranksemantic(BM25(Docs))Results\\=Reranksemantic(BM25(Docs))\n    \n    \\\\text{Results} = \\\\text{Rerank}\\_{\\\\text{semantic}} \\\\big( \\\\text{BM25}(\\\\text{Docs}) \\\\big)\n*   This approach dominates because of its efficiency, recall-safety, easy of explainability, and compatibility with existing search infrastructure.\n    \n\nThe most common hybrid architecture is a two-stage pipeline:\n\n1.  **Candidate generation (lexical)**:\n    *   A lexical retriever (typically BM25) retrieves the top KKK candidates based on exact term overlap.\n        \n    *   Typical values:\n        \n        *   K∈\\[100,1000\\]K∈\\[100,1000\\]\n            \n            K \\\\in \\[100, 1000\\]\n        *   Chosen to maximize recall while keeping downstream cost manageable\n2.  **Semantic re-ranking (dense or cross-encoder)**:\n    *   Semantic re-ranking models aim to improve the ordering of retrieved documents by more accurately modeling relevance between a query and a small candidate set.\n    *   In practice, these models are used after an initial retrieval step and can be grouped both by how they encode query–document interactions and by the type of signals they incorporate (semantic, instructional, or metadata-driven).\n\n*   A lexical retriever (typically BM25) retrieves the top KKK candidates based on exact term overlap.\n    \n*   Typical values:\n    \n    *   K∈\\[100,1000\\]K∈\\[100,1000\\]\n        \n        K \\\\in \\[100, 1000\\]\n    *   Chosen to maximize recall while keeping downstream cost manageable\n\nA lexical retriever (typically BM25) retrieves the top KKK candidates based on exact term overlap.\n\nTypical values:\n\n*   K∈\\[100,1000\\]K∈\\[100,1000\\]\n    \n    K \\\\in \\[100, 1000\\]\n*   Chosen to maximize recall while keeping downstream cost manageable\n\n*   Semantic re-ranking models aim to improve the ordering of retrieved documents by more accurately modeling relevance between a query and a small candidate set.\n*   In practice, these models are used after an initial retrieval step and can be grouped both by how they encode query–document interactions and by the type of signals they incorporate (semantic, instructional, or metadata-driven).\n\nConceptually:\n\nThis approach dominates because of its efficiency, recall-safety, easy of explainability, and compatibility with existing search infrastructure.\n\n##### Parallel Hybrid Retrieval and Score Fusion\n\n*   An alternative approach runs lexical and semantic retrieval independently, then fuses their rankings. This approach is common when re-ranking is too expensive or when vector databases expose native hybrid querying.\n\n###### Linear Score Fusion\n\nscore(d)\\=α⋅BM25(d)+(1−α)⋅simsemantic(d)score(d)\\=α⋅BM25(d)+(1−α)⋅simsemantic(d)\n\n*   Challenges:\n    \n    *   Scores must be normalized\n    *   Sensitive to scaling differences\n    *   Requires tuning αα\\\\alpha\n\nChallenges:\n\n*   Scores must be normalized\n*   Sensitive to scaling differences\n*   Requires tuning αα\\\\alpha\n\n###### Reciprocal Rank Fusion (RRF)\n\n*   One of the most popular and robust fusion techniques used in hybrid retrieval is Reciprocal Rank Fusion (RRF). RRF merges the rankings from different retrieval models (for example, BM25 and a neural retriever) by assigning higher scores to documents that consistently rank well across systems, rather than relying on raw scores.\n    \n*   RRF operates purely on rank positions, making it insensitive to score scale (i.e., it lacks the need for normalization unlike linear score fusion), distribution, or calibration differences between retrieval methods.\n    \n*   **How RRF works:**\n    \n    *   Each retrieval system independently produces a ranked list of documents.\n    *   Each document receives a contribution based on its rank position in each list.\n    *   Contributions are summed to produce a final fusion score.\n        \n    *   The RRF scoring function is:\n        \n        RRF Score(d)\\=∑i\\=1n1k+ranki(d)RRF Score(d)\\=∑i\\=1n1k+ranki(d)\n        \n        \\\\text{RRF Score}(d) = \\\\sum\\_{i=1}^{n} \\\\frac{1}{k + \\\\text{rank}\\_i(d)}\n        *   where:\n            \n            *   ddd is the document,\n            *   ranki(d)ranki(d)\\\\text{rank}\\_i(d) is the rank position of document ddd in the ithithi^{\\\\text{th}} ranked list,\n            *   kkk is a smoothing constant (typically set to 60),\n            *   nnn is the number of retrieval systems.\n    *   The constant kkk ensures that:\n        \n        *   Top-ranked documents dominate the contribution\n        *   Differences among lower-ranked documents are compressed\n        *   Noise from deep rankings does not overwhelm the fusion\n*   **Intuition behind RRF:**\n    \n    *   The intuition behind RRF being especially well suited for hybrid lexical–semantic retrieval is as follows:\n        *   Documents that appear near the top in multiple rankings are strongly favored.\n        *   A document that ranks moderately well in several systems often beats one that ranks extremely well in only one.\n        *   Systems with very different scoring behavior can still be combined reliably.\n*   **Example:**\n    \n    *   Suppose two retrieval systems return the following output results for a query:\n        \n        *   BM25: `[DocA, DocB, DocC, DocD, DocE]`\n        *   Neural Retriever: `[DocF, DocC, DocA, DocG, DocB]`\n    *   We use k\\=60k\\=60k = 60.\n    *   Note that if a document does not appear at a output of a retriever, it contributes 000 from that list.\n        \n    *   RRF scores are computed as follows:\n        \n        *   **DocA** (Rank 1 in BM25, rank 3 in Neural Retriever):\n            \n            RRF(DocA)\\=160+1+160+3\\=161+163≈0.01639+0.01587\\=0.03226RRF(DocA)\\=160+1+160+3\\=161+163≈0.01639+0.01587\\=0.03226\n            \n            \\\\text{RRF}(\\\\text{DocA}) = \\\\frac{1}{60 + 1} + \\\\frac{1}{60 + 3} = \\\\frac{1}{61} + \\\\frac{1}{63} \\\\approx 0.01639 + 0.01587 = 0.03226\n        *   **DocB** (Rank 2 in BM25, rank 5 in Neural Retriever):\n            \n            RRF(DocB)\\=160+2+160+5\\=162+165≈0.01613+0.01538\\=0.03151RRF(DocB)\\=160+2+160+5\\=162+165≈0.01613+0.01538\\=0.03151\n            \n            \\\\text{RRF}(\\\\text{DocB}) = \\\\frac{1}{60 + 2} + \\\\frac{1}{60 + 5} = \\\\frac{1}{62} + \\\\frac{1}{65} \\\\approx 0.01613 + 0.01538 = 0.03151\n        *   **DocC** (Rank 3 in BM25, rank 2 in Neural Retriever):\n            \n            RRF(DocC)\\=160+3+160+2\\=163+162≈0.01587+0.01613\\=0.03200RRF(DocC)\\=160+3+160+2\\=163+162≈0.01587+0.01613\\=0.03200\n            \n            \\\\text{RRF}(\\\\text{DocC}) = \\\\frac{1}{60 + 3} + \\\\frac{1}{60 + 2} = \\\\frac{1}{63} + \\\\frac{1}{62} \\\\approx 0.01587 + 0.01613 = 0.03200\n        *   **DocD** (Rank 4 in BM25 only):\n            \n            RRF(DocD)\\=160+4\\=164≈0.01563RRF(DocD)\\=160+4\\=164≈0.01563\n            \n            \\\\text{RRF}(\\\\text{DocD}) = \\\\frac{1}{60 + 4} = \\\\frac{1}{64} \\\\approx 0.01563\n        *   **DocE** (Rank 5 in BM25 only):\n            \n            RRF(DocE)\\=160+5\\=165≈0.01538RRF(DocE)\\=160+5\\=165≈0.01538\n            \n            \\\\text{RRF}(\\\\text{DocE}) = \\\\frac{1}{60 + 5} = \\\\frac{1}{65} \\\\approx 0.01538\n        *   **DocF** (Rank 1 in Neural Retriever only):\n            \n            RRF(DocF)\\=160+1\\=161≈0.01639RRF(DocF)\\=160+1\\=161≈0.01639\n            \n            \\\\text{RRF}(\\\\text{DocF}) = \\\\frac{1}{60 + 1} = \\\\frac{1}{61} \\\\approx 0.01639\n        *   **DocG** (Rank 4 in Neural Retriever only):\n            \n            RRF(DocG)\\=160+4\\=164≈0.01563RRF(DocG)\\=160+4\\=164≈0.01563\n            \n            \\\\text{RRF}(\\\\text{DocG}) = \\\\frac{1}{60 + 4} = \\\\frac{1}{64} \\\\approx 0.01563\n    *   After computing scores for all documents, the final RRF ranking is obtained by sorting documents in descending order of their cumulative RRF scores.\n        \n    *   This example illustrates the key property of RRF: documents that rank reasonably well across multiple retrieval systems (DocA, DocC, DocB) rise above documents that dominate only a single ranking, even if that dominance is at rank 1. Put simply, RRF rewards consistent relevance across retrieval strategies rather than dominance in a single system.\n\nOne of the most popular and robust fusion techniques used in hybrid retrieval is Reciprocal Rank Fusion (RRF). RRF merges the rankings from different retrieval models (for example, BM25 and a neural retriever) by assigning higher scores to documents that consistently rank well across systems, rather than relying on raw scores.\n\nRRF operates purely on rank positions, making it insensitive to score scale (i.e., it lacks the need for normalization unlike linear score fusion), distribution, or calibration differences between retrieval methods.\n\n**How RRF works:**\n\n*   Each retrieval system independently produces a ranked list of documents.\n*   Each document receives a contribution based on its rank position in each list.\n*   Contributions are summed to produce a final fusion score.\n    \n*   The RRF scoring function is:\n    \n    RRF Score(d)\\=∑i\\=1n1k+ranki(d)RRF Score(d)\\=∑i\\=1n1k+ranki(d)\n    \n    \\\\text{RRF Score}(d) = \\\\sum\\_{i=1}^{n} \\\\frac{1}{k + \\\\text{rank}\\_i(d)}\n    *   where:\n        \n        *   ddd is the document,\n        *   ranki(d)ranki(d)\\\\text{rank}\\_i(d) is the rank position of document ddd in the ithithi^{\\\\text{th}} ranked list,\n        *   kkk is a smoothing constant (typically set to 60),\n        *   nnn is the number of retrieval systems.\n*   The constant kkk ensures that:\n    \n    *   Top-ranked documents dominate the contribution\n    *   Differences among lower-ranked documents are compressed\n    *   Noise from deep rankings does not overwhelm the fusion\n\nContributions are summed to produce a final fusion score.\n\nThe RRF scoring function is:\n\n*   where:\n    \n    *   ddd is the document,\n    *   ranki(d)ranki(d)\\\\text{rank}\\_i(d) is the rank position of document ddd in the ithithi^{\\\\text{th}} ranked list,\n    *   kkk is a smoothing constant (typically set to 60),\n    *   nnn is the number of retrieval systems.\n\nwhere:\n\n*   ddd is the document,\n*   ranki(d)ranki(d)\\\\text{rank}\\_i(d) is the rank position of document ddd in the ithithi^{\\\\text{th}} ranked list,\n*   kkk is a smoothing constant (typically set to 60),\n*   nnn is the number of retrieval systems.\n\nThe constant kkk ensures that:\n\n*   Top-ranked documents dominate the contribution\n*   Differences among lower-ranked documents are compressed\n*   Noise from deep rankings does not overwhelm the fusion\n\n**Intuition behind RRF:**\n\n*   The intuition behind RRF being especially well suited for hybrid lexical–semantic retrieval is as follows:\n    *   Documents that appear near the top in multiple rankings are strongly favored.\n    *   A document that ranks moderately well in several systems often beats one that ranks extremely well in only one.\n    *   Systems with very different scoring behavior can still be combined reliably.\n\n*   Documents that appear near the top in multiple rankings are strongly favored.\n*   A document that ranks moderately well in several systems often beats one that ranks extremely well in only one.\n*   Systems with very different scoring behavior can still be combined reliably.\n\n**Example:**\n\n*   Suppose two retrieval systems return the following output results for a query:\n    \n    *   BM25: `[DocA, DocB, DocC, DocD, DocE]`\n    *   Neural Retriever: `[DocF, DocC, DocA, DocG, DocB]`\n*   We use k\\=60k\\=60k = 60.\n*   Note that if a document does not appear at a output of a retriever, it contributes 000 from that list.\n    \n*   RRF scores are computed as follows:\n    \n    *   **DocA** (Rank 1 in BM25, rank 3 in Neural Retriever):\n        \n        RRF(DocA)\\=160+1+160+3\\=161+163≈0.01639+0.01587\\=0.03226RRF(DocA)\\=160+1+160+3\\=161+163≈0.01639+0.01587\\=0.03226\n        \n        \\\\text{RRF}(\\\\text{DocA}) = \\\\frac{1}{60 + 1} + \\\\frac{1}{60 + 3} = \\\\frac{1}{61} + \\\\frac{1}{63} \\\\approx 0.01639 + 0.01587 = 0.03226\n    *   **DocB** (Rank 2 in BM25, rank 5 in Neural Retriever):\n        \n        RRF(DocB)\\=160+2+160+5\\=162+165≈0.01613+0.01538\\=0.03151RRF(DocB)\\=160+2+160+5\\=162+165≈0.01613+0.01538\\=0.03151\n        \n        \\\\text{RRF}(\\\\text{DocB}) = \\\\frac{1}{60 + 2} + \\\\frac{1}{60 + 5} = \\\\frac{1}{62} + \\\\frac{1}{65} \\\\approx 0.01613 + 0.01538 = 0.03151\n    *   **DocC** (Rank 3 in BM25, rank 2 in Neural Retriever):\n        \n        RRF(DocC)\\=160+3+160+2\\=163+162≈0.01587+0.01613\\=0.03200RRF(DocC)\\=160+3+160+2\\=163+162≈0.01587+0.01613\\=0.03200\n        \n        \\\\text{RRF}(\\\\text{DocC}) = \\\\frac{1}{60 + 3} + \\\\frac{1}{60 + 2} = \\\\frac{1}{63} + \\\\frac{1}{62} \\\\approx 0.01587 + 0.01613 = 0.03200\n    *   **DocD** (Rank 4 in BM25 only):\n        \n        RRF(DocD)\\=160+4\\=164≈0.01563RRF(DocD)\\=160+4\\=164≈0.01563\n        \n        \\\\text{RRF}(\\\\text{DocD}) = \\\\frac{1}{60 + 4} = \\\\frac{1}{64} \\\\approx 0.01563\n    *   **DocE** (Rank 5 in BM25 only):\n        \n        RRF(DocE)\\=160+5\\=165≈0.01538RRF(DocE)\\=160+5\\=165≈0.01538\n        \n        \\\\text{RRF}(\\\\text{DocE}) = \\\\frac{1}{60 + 5} = \\\\frac{1}{65} \\\\approx 0.01538\n    *   **DocF** (Rank 1 in Neural Retriever only):\n        \n        RRF(DocF)\\=160+1\\=161≈0.01639RRF(DocF)\\=160+1\\=161≈0.01639\n        \n        \\\\text{RRF}(\\\\text{DocF}) = \\\\frac{1}{60 + 1} = \\\\frac{1}{61} \\\\approx 0.01639\n    *   **DocG** (Rank 4 in Neural Retriever only):\n        \n        RRF(DocG)\\=160+4\\=164≈0.01563RRF(DocG)\\=160+4\\=164≈0.01563\n        \n        \\\\text{RRF}(\\\\text{DocG}) = \\\\frac{1}{60 + 4} = \\\\frac{1}{64} \\\\approx 0.01563\n*   After computing scores for all documents, the final RRF ranking is obtained by sorting documents in descending order of their cumulative RRF scores.\n    \n*   This example illustrates the key property of RRF: documents that rank reasonably well across multiple retrieval systems (DocA, DocC, DocB) rise above documents that dominate only a single ranking, even if that dominance is at rank 1. Put simply, RRF rewards consistent relevance across retrieval strategies rather than dominance in a single system.\n\nSuppose two retrieval systems return the following output results for a query:\n\n*   BM25: `[DocA, DocB, DocC, DocD, DocE]`\n*   Neural Retriever: `[DocF, DocC, DocA, DocG, DocB]`\n\nNote that if a document does not appear at a output of a retriever, it contributes 000 from that list.\n\nRRF scores are computed as follows:\n\n*   **DocA** (Rank 1 in BM25, rank 3 in Neural Retriever):\n    \n    RRF(DocA)\\=160+1+160+3\\=161+163≈0.01639+0.01587\\=0.03226RRF(DocA)\\=160+1+160+3\\=161+163≈0.01639+0.01587\\=0.03226\n    \n    \\\\text{RRF}(\\\\text{DocA}) = \\\\frac{1}{60 + 1} + \\\\frac{1}{60 + 3} = \\\\frac{1}{61} + \\\\frac{1}{63} \\\\approx 0.01639 + 0.01587 = 0.03226\n*   **DocB** (Rank 2 in BM25, rank 5 in Neural Retriever):\n    \n    RRF(DocB)\\=160+2+160+5\\=162+165≈0.01613+0.01538\\=0.03151RRF(DocB)\\=160+2+160+5\\=162+165≈0.01613+0.01538\\=0.03151\n    \n    \\\\text{RRF}(\\\\text{DocB}) = \\\\frac{1}{60 + 2} + \\\\frac{1}{60 + 5} = \\\\frac{1}{62} + \\\\frac{1}{65} \\\\approx 0.01613 + 0.01538 = 0.03151\n*   **DocC** (Rank 3 in BM25, rank 2 in Neural Retriever):\n    \n    RRF(DocC)\\=160+3+160+2\\=163+162≈0.01587+0.01613\\=0.03200RRF(DocC)\\=160+3+160+2\\=163+162≈0.01587+0.01613\\=0.03200\n    \n    \\\\text{RRF}(\\\\text{DocC}) = \\\\frac{1}{60 + 3} + \\\\frac{1}{60 + 2} = \\\\frac{1}{63} + \\\\frac{1}{62} \\\\approx 0.01587 + 0.01613 = 0.03200\n*   **DocD** (Rank 4 in BM25 only):\n    \n    RRF(DocD)\\=160+4\\=164≈0.01563RRF(DocD)\\=160+4\\=164≈0.01563\n    \n    \\\\text{RRF}(\\\\text{DocD}) = \\\\frac{1}{60 + 4} = \\\\frac{1}{64} \\\\approx 0.01563\n*   **DocE** (Rank 5 in BM25 only):\n    \n    RRF(DocE)\\=160+5\\=165≈0.01538RRF(DocE)\\=160+5\\=165≈0.01538\n    \n    \\\\text{RRF}(\\\\text{DocE}) = \\\\frac{1}{60 + 5} = \\\\frac{1}{65} \\\\approx 0.01538\n*   **DocF** (Rank 1 in Neural Retriever only):\n    \n    RRF(DocF)\\=160+1\\=161≈0.01639RRF(DocF)\\=160+1\\=161≈0.01639\n    \n    \\\\text{RRF}(\\\\text{DocF}) = \\\\frac{1}{60 + 1} = \\\\frac{1}{61} \\\\approx 0.01639\n*   **DocG** (Rank 4 in Neural Retriever only):\n    \n    RRF(DocG)\\=160+4\\=164≈0.01563RRF(DocG)\\=160+4\\=164≈0.01563\n    \n    \\\\text{RRF}(\\\\text{DocG}) = \\\\frac{1}{60 + 4} = \\\\frac{1}{64} \\\\approx 0.01563\n\n**DocA** (Rank 1 in BM25, rank 3 in Neural Retriever):\n\n**DocB** (Rank 2 in BM25, rank 5 in Neural Retriever):\n\n**DocC** (Rank 3 in BM25, rank 2 in Neural Retriever):\n\n**DocD** (Rank 4 in BM25 only):\n\n**DocE** (Rank 5 in BM25 only):\n\n**DocF** (Rank 1 in Neural Retriever only):\n\n**DocG** (Rank 4 in Neural Retriever only):\n\nAfter computing scores for all documents, the final RRF ranking is obtained by sorting documents in descending order of their cumulative RRF scores.\n\n##### Advanced Variations\n\n1.  **Filtered parallel retrieval**:\n    \n    *   Apply the same metadata filters\n    *   Run lexical and semantic retrieval in parallel\n    *   Fuse results with RRF\n    *   Optionally rerank the fused set\n2.  **Filter-aware rerankers**:\n    \n    *   Metadata fields are appended to document text\n    *   Allows rerankers to learn preferences (e.g., newer is better)\n    *   Still respects hard filters upstream\n3.  **Adaptive hybrid strategies**:\n    \n    *   Short queries bias toward lexical\n    *   Long natural language queries bias toward semantic\n    *   Query classifiers dynamically adjust retrieval strategy\n\n**Filtered parallel retrieval**:\n\n*   Apply the same metadata filters\n*   Run lexical and semantic retrieval in parallel\n*   Fuse results with RRF\n*   Optionally rerank the fused set\n\n**Filter-aware rerankers**:\n\n*   Metadata fields are appended to document text\n*   Allows rerankers to learn preferences (e.g., newer is better)\n*   Still respects hard filters upstream\n\n**Adaptive hybrid strategies**:\n\n*   Short queries bias toward lexical\n*   Long natural language queries bias toward semantic\n*   Query classifiers dynamically adjust retrieval strategy\n\n##### Common Pitfalls\n\n*   Applying semantic retrieval before filtering, causing access violations\n*   Treating metadata as a scoring feature instead of a constraint\n*   Choosing KKK too small, harming recall\n*   Over-relying on semantic similarity for exact-match queries\n*   Ignoring explainability and audit requirements\n\n##### Mental Model\n\n*   Think in layers:\n    \n    1.  Which documents are allowed? (metadata filtering)\n    2.  Which documents mention what the user said? (lexical recall)\n    3.  Which of those best match what the user meant? (semantic ranking)\n    4.  Which should be preferred? (re-ranking and boosting)\n*   Hybrid retrieval works because it preserves this separation of concerns.\n    \n\nThink in layers:\n\n1.  Which documents are allowed? (metadata filtering)\n2.  Which documents mention what the user said? (lexical recall)\n3.  Which of those best match what the user meant? (semantic ranking)\n4.  Which should be preferred? (re-ranking and boosting)\n\nHybrid retrieval works because it preserves this separation of concerns.\n\n##### System Tuning\n\n*   Tuning a hybrid retrieval system is an exercise in balancing recall, precision, latency, cost, and operational complexity.\n*   There is no universally optimal configuration; instead, production systems are tuned based on query distribution, corpus characteristics, and downstream task requirements.\n\n###### Choosing the Candidate Set Size (KKK)\n\n*   The parameter KKK controls how many documents are retrieved by the first-stage retriever (usually BM25) before semantic processing.\n    \n*   **Trade-offs**:\n    \n    *   Smaller KKK leads to lower latency and cost but increases the risk of missing relevant documents, since the semantic reranker has limited ability to recover items not present in the candidate set.\n    *   Larger KKK improves recall but increases semantic compute cost and typically exhibits diminishing returns beyond a certain threshold.\n*   **Practical guidelines**:\n    \n    *   K∈\\[50,100\\]K∈\\[50,100\\]K \\\\in \\[50, 100\\]: Suitable for narrow domains with high-quality lexical signals.\n        \n    *   K∈\\[200,500\\]K∈\\[200,500\\]K \\\\in \\[200, 500\\]: Common default for general-purpose search and RAG.\n        \n    *   K∈\\[1000+\\]K∈\\[1000+\\]K \\\\in \\[1000+\\]: Used when recall is critical and latency budgets allow.\n        \n    *   A useful mental model is:\n        \n    \n    > If a document does not appear in the top KKK lexical results, semantic re-ranking cannot recover it.\n    \n\nThe parameter KKK controls how many documents are retrieved by the first-stage retriever (usually BM25) before semantic processing.\n\n**Trade-offs**:\n\n*   Smaller KKK leads to lower latency and cost but increases the risk of missing relevant documents, since the semantic reranker has limited ability to recover items not present in the candidate set.\n*   Larger KKK improves recall but increases semantic compute cost and typically exhibits diminishing returns beyond a certain threshold.\n\n**Practical guidelines**:\n\n*   K∈\\[50,100\\]K∈\\[50,100\\]K \\\\in \\[50, 100\\]: Suitable for narrow domains with high-quality lexical signals.\n    \n*   K∈\\[200,500\\]K∈\\[200,500\\]K \\\\in \\[200, 500\\]: Common default for general-purpose search and RAG.\n    \n*   K∈\\[1000+\\]K∈\\[1000+\\]K \\\\in \\[1000+\\]: Used when recall is critical and latency budgets allow.\n    \n*   A useful mental model is:\n    \n\nK∈\\[50,100\\]K∈\\[50,100\\]K \\\\in \\[50, 100\\]: Suitable for narrow domains with high-quality lexical signals.\n\nK∈\\[200,500\\]K∈\\[200,500\\]K \\\\in \\[200, 500\\]: Common default for general-purpose search and RAG.\n\nK∈\\[1000+\\]K∈\\[1000+\\]K \\\\in \\[1000+\\]: Used when recall is critical and latency budgets allow.\n\nA useful mental model is:\n\n> If a document does not appear in the top KKK lexical results, semantic re-ranking cannot recover it.\n\nIf a document does not appear in the top KKK lexical results, semantic re-ranking cannot recover it.\n\n###### Latency and Cost Considerations\n\n*   Hybrid retrieval latency is additive across stages:\n\nTtotal\\=Tfilter+Tlexical+Tsemantic+TrerankTtotal\\=Tfilter+Tlexical+Tsemantic+Trerank\n\n*   Key optimization strategies include:\n    \n    *   Early filtering to shrink candidate sets\n    *   Caching frequent query embeddings\n    *   Applying rerankers only to the top subset (e.g., top 50)\n    *   Adaptive pipelines based on query complexity\n*   Latency budgets often dictate architectural choices more than relevance metrics.\n    \n\nKey optimization strategies include:\n\n*   Early filtering to shrink candidate sets\n*   Caching frequent query embeddings\n*   Applying rerankers only to the top subset (e.g., top 50)\n*   Adaptive pipelines based on query complexity\n\nLatency budgets often dictate architectural choices more than relevance metrics.\n\n###### Query-aware Tuning\n\n*   Many production systems dynamically adjust retrieval behavior:\n    \n    *   **Short keyword queries**: Bias toward lexical retrieval and smaller KKK\n        \n    *   **Long natural language queries**: Increase KKK and rely more on semantic re-ranking\n        \n    *   **Identifier-heavy queries**: Skip semantic stages entirely\n        \n*   Query classifiers or heuristics are often sufficient to enable this adaptivity.\n    \n\nMany production systems dynamically adjust retrieval behavior:\n\n*   **Short keyword queries**: Bias toward lexical retrieval and smaller KKK\n    \n*   **Long natural language queries**: Increase KKK and rely more on semantic re-ranking\n    \n*   **Identifier-heavy queries**: Skip semantic stages entirely\n    \n\n**Short keyword queries**: Bias toward lexical retrieval and smaller KKK\n\n**Long natural language queries**: Increase KKK and rely more on semantic re-ranking\n\n**Identifier-heavy queries**: Skip semantic stages entirely\n\nQuery classifiers or heuristics are often sufficient to enable this adaptivity.\n\n###### Evaluation and Tuning Methodology\n\n*   Hybrid systems are tuned using:\n    \n    *   Offline relevance judgments (NDCG, MRR, Recall@kkk)\n    *   Online A/B testing\n    *   Query-level error analysis\n*   Important metrics include:\n    \n    *   Recall@kkk after lexical retrieval\n    *   Precision improvements from re-ranking\n    *   Latency percentiles (P50, P95, P99)\n*   Tuning is iterative and tightly coupled to real query logs.\n    \n\nHybrid systems are tuned using:\n\n*   Offline relevance judgments (NDCG, MRR, Recall@kkk)\n*   Online A/B testing\n*   Query-level error analysis\n\nImportant metrics include:\n\n*   Recall@kkk after lexical retrieval\n*   Precision improvements from re-ranking\n*   Latency percentiles (P50, P95, P99)\n\nTuning is iterative and tightly coupled to real query logs.\n\n##### Hybrid Retrieval in RAG Architectures\n\n*   RAG systems rely on retrieval quality as a first-order determinant of generation quality. Hybrid retrieval has become the dominant retrieval strategy in RAG because it directly addresses the failure modes of both generation and retrieval models.\n\n###### Why Hybrid Retrieval is Critical for RAG\n\n*   Language models:\n    \n    *   Cannot invent missing facts reliably\n    *   Are sensitive to irrelevant or misleading context\n    *   Perform best when provided with precise, relevant grounding documents\n*   Hybrid retrieval ensures:\n    \n    *   Exact factual anchors are included\n    *   Conceptually relevant context is not missed\n    *   The model is not forced to hallucinate due to missing evidence\n\nLanguage models:\n\n*   Cannot invent missing facts reliably\n*   Are sensitive to irrelevant or misleading context\n*   Perform best when provided with precise, relevant grounding documents\n\nHybrid retrieval ensures:\n\n*   Exact factual anchors are included\n*   Conceptually relevant context is not missed\n*   The model is not forced to hallucinate due to missing evidence\n\n###### Canonical RAG Retrieval Pipeline\n\n*   A typical hybrid RAG pipeline looks like:\n    \n    1.  **Metadata filtering**: Apply access, language, document type, and recency constraints.\n        \n    2.  **Lexical retrieval**: Retrieve top KKK documents using BM25.\n        \n    3.  **Semantic re-ranking**: Rerank candidates using a semantic model.\n        \n    4.  **Context selection**: Select top NNN documents or passages for generation.\n        \n*   Formally:\n    \n    Context\\=TopN(Reranksemantic(BM25(Docs∣filters)))Context\\=TopN(Reranksemantic(BM25(Docs∣filters)))\n    \n    \\\\text{Context} = \\\\text{Top}\\_N \\\\Big( \\\\text{Rerank}\\_{\\\\text{semantic}} ( \\\\text{BM25}(\\\\text{Docs} \\\\mid \\\\text{filters}) ) \\\\Big)\n\nA typical hybrid RAG pipeline looks like:\n\n1.  **Metadata filtering**: Apply access, language, document type, and recency constraints.\n    \n2.  **Lexical retrieval**: Retrieve top KKK documents using BM25.\n    \n3.  **Semantic re-ranking**: Rerank candidates using a semantic model.\n    \n4.  **Context selection**: Select top NNN documents or passages for generation.\n    \n\n**Metadata filtering**: Apply access, language, document type, and recency constraints.\n\n**Lexical retrieval**: Retrieve top KKK documents using BM25.\n\n**Semantic re-ranking**: Rerank candidates using a semantic model.\n\n**Context selection**: Select top NNN documents or passages for generation.\n\nFormally:\n\n###### Failure Modes Avoided by Hybrid RAG\n\n*   **Semantic-only retrieval**: Misses exact facts, dates, or identifiers.\n    \n*   **Lexical-only retrieval**: Misses paraphrased or implied information.\n    \n*   **Unfiltered retrieval**: Causes data leakage or compliance violations.\n    \n*   Hybrid retrieval with three stages (**metadata filtering, lexical retrieval, and semantic retrieval/ranking**) minimizes all three.\n    \n\n**Semantic-only retrieval**: Misses exact facts, dates, or identifiers.\n\n**Lexical-only retrieval**: Misses paraphrased or implied information.\n\n**Unfiltered retrieval**: Causes data leakage or compliance violations.\n\nHybrid retrieval with three stages (**metadata filtering, lexical retrieval, and semantic retrieval/ranking**) minimizes all three.\n\n###### Final Synthesis\n\n*   Hybrid retrieval is not an optimization but an architectural necessity: lexical retrieval anchors the system to exact facts, identifiers, and wording; semantic retrieval captures the user’s underlying intent and conceptual meaning; metadata filtering enforces correctness, safety, and access constraints; and re-ranking (covered in the [Re-ranking](#re-ranking) section) maximizes usefulness by prioritizing the most relevant and coherent results for downstream consumption. Together, these components form a coherent pipeline in which each stage compensates for the limitations of the others, producing search behavior that is precise, robust, and reliable at scale.\n*   In RAG systems, generation quality is bounded by retrieval quality. Hybrid retrieval raises that bound by ensuring the language model sees the right information, for the right reasons, under the right constraints.\n\n#### Metadata Filtering\n\n*   Metadata filtering is the process of restricting the searchable corpus using structured, non-textual attributes attached to documents (such as access rights, tenant identifiers, language, timestamps, or document type) before or during retrieval, so that only contextually valid documents are ever considered for ranking.\n*   Metadata filtering is applicable to lexical retrieval, semantic retrieval, and hybrid retrieval alike, and is typically applied first as hard constraints, meaning documents that fail these conditions are excluded entirely rather than merely penalized in scoring.\n*   Treating metadata as hard constraints is essential because constraints like access control, tenancy, jurisdiction, and language are correctness requirements, not relevance preferences, regardless of whether relevance is computed lexically, semantically, or via a hybrid approach.\n*   Applying hard filters early improves system efficiency by shrinking the candidate set before lexical matching, vector search, or expensive semantic scoring and reranking, which often dominate latency and cost.\n*   By separating hard constraints from ranking logic, metadata filtering simplifies auditing, debugging, and explainability, allowing the system to clearly state that relevance was computed only within an explicitly defined and policy-compliant subset of the corpus.\n\n###### Standard Pattern\n\n1.  Apply metadata filters\n    \n    *   Examples:\n        \n        *   tenant\\_id = `X`\n        *   language = `\"en\"`\n        *   date ≥ `2024-01-01`\n        *   access\\_level ≤ `user_clearance`\n2.  Perform retrieval within the filtered set\n    \n    *   Lexical retrieval operates only on allowed documents\n    *   Semantic retrieval or re-ranking is applied afterward (if used)\n    *   Hybrid retrieval combines both within the same filtered universe\n\nApply metadata filters\n\n*   Examples:\n    \n    *   tenant\\_id = `X`\n    *   language = `\"en\"`\n    *   date ≥ `2024-01-01`\n    *   access\\_level ≤ `user_clearance`\n\nExamples:\n\n*   tenant\\_id = `X`\n*   language = `\"en\"`\n*   date ≥ `2024-01-01`\n*   access\\_level ≤ `user_clearance`\n\nPerform retrieval within the filtered set\n\n*   Lexical retrieval operates only on allowed documents\n*   Semantic retrieval or re-ranking is applied afterward (if used)\n*   Hybrid retrieval combines both within the same filtered universe\n\n*   Formally:\n\nResults\\=Rank(Docs∣metadata filters)Results\\=Rank(Docs∣metadata filters)\n\n*   This guarantees correctness by preventing data leakage, improves efficiency by reducing the search space early, and enables simpler reasoning and auditing by cleanly separating constraints from relevance scoring.\n\n###### Hard Filters (Metadata Filtering) vs. Soft Boosts (Metadata Re-ranking)\n\n*   Hard filters are non-negotiable constraints such as access control, tenancy boundaries, jurisdictional limits, and language restrictions that must be satisfied for a document to be retrievable at all. These must be satisfied before retrieval, excluding documents entirely from the searchable corpus rather than affecting their rank.\n*   Soft boosts are preference signals such as recency, source authority, and content type that influence ranking after retrieval without excluding documents outright. This post-retrieval adjustment is commonly referred to as **metadata re-ranking**, where structured signals modify relevance scores rather than filter candidates.",
    "order": 3,
    "orderInChapter": 2,
    "difficulty": 4,
    "estimatedMinutes": 48,
    "tags": [
      "nlpllms",
      "transformer",
      "embedding",
      "bert",
      "llm",
      "optimization"
    ],
    "metadata": {
      "hasCode": true,
      "hasMath": true,
      "hasImages": true,
      "wordCount": 9558,
      "contentLength": 529296
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#retrieval",
    "scrapedAt": "2025-12-28T11:54:28.275Z"
  },
  {
    "id": "ai-RAG-re-ranking-4",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "Building a RAG Pipeline",
    "title": "Re-ranking",
    "subtitle": "Building a RAG Pipeline",
    "contentHtml": "<ul>\n  <li>Re-ranking is a critical refinement stage in modern Retrieval-Augmented Generation (RAG) pipelines, responsible for reordering a small candidate set of retrieved documents or passages to ensure that the most relevant content is prioritized for inclusion in the final prompt presented to the language model. While retrieval focuses on recall at scale, re-ranking emphasizes precision, making it a key determinant of generation quality.</li>\n</ul>\n<h4 id=\"re-ranking-in-multistage-retrieval-pipelines\">Re-ranking in Multistage Retrieval Pipelines</h4>\n<ul>\n  <li>\n    <p>In practice, re-ranking is applied after an initial retrieval stage has narrowed the corpus to a manageable shortlist. Because the candidate set is small—typically tens to hundreds of documents—computationally intensive but highly accurate re-ranking techniques become feasible.</p>\n  </li>\n  <li>\n    <p>The figure below (<a href=\"https://weaviate.io/blog/cross-encoders-as-reranker\">source</a>) illustrates a common multistage search pipeline used in RAG systems. In the first stage, a bi-encoder efficiently retrieves a shortlist of candidate documents from a large corpus. In the second stage, a re-ranker—often implemented as a cross-encoder—is applied to this reduced set to reassess and reorder the results based on deeper query–document interactions. This two-stage design combines the scalability of bi-encoder retrieval with the higher relevance accuracy of cross-encoder re-ranking, making it practical to deploy on large-scale datasets while still achieving strong ranking quality.</p>\n  </li>\n</ul>\n<p>In practice, re-ranking is applied after an initial retrieval stage has narrowed the corpus to a manageable shortlist. Because the candidate set is small—typically tens to hundreds of documents—computationally intensive but highly accurate re-ranking techniques become feasible.</p>\n<p>The figure below (<a href=\"https://weaviate.io/blog/cross-encoders-as-reranker\">source</a>) illustrates a common multistage search pipeline used in RAG systems. In the first stage, a bi-encoder efficiently retrieves a shortlist of candidate documents from a large corpus. In the second stage, a re-ranker—often implemented as a cross-encoder—is applied to this reduced set to reassess and reorder the results based on deeper query–document interactions. This two-stage design combines the scalability of bi-encoder retrieval with the higher relevance accuracy of cross-encoder re-ranking, making it practical to deploy on large-scale datasets while still achieving strong ranking quality.</p>\n<p><img src=\"/primers/ai/assets/RAG/multistage-search-pipeline.jpg\" alt=\"\"></p>\n<ul>\n  <li>This multistage architecture is foundational to modern RAG systems and motivates the different classes of re-rankers used in practice.</li>\n</ul>\n<h4 id=\"classes-of-semantic-re-ranking-models\">Classes of Semantic Re-ranking Models</h4>\n<ul>\n  <li>\n    <p>Modern RAG systems typically rely on three complementary classes of re-rankers, each addressing a distinct dimension of relevance:</p>\n\n    <ul>\n      <li><strong>Neural Learning-to-Rank (LTR) re-rankers</strong>, which model semantic relevance between queries and documents using learned ranking objectives.</li>\n      <li><strong>Instruction-tuned re-rankers</strong>, which allow relevance criteria to be dynamically adjusted at runtime using natural language instructions.</li>\n      <li><strong>Metadata-based re-rankers</strong>, which incorporate structured signals such as recency, authority, provenance, or document type to enforce policy and domain-specific constraints.</li>\n    </ul>\n  </li>\n  <li>\n    <p>Together, these approaches form a layered re-ranking strategy in which semantic relevance is established first and then refined to better align with user intent, organizational rules, and real-world constraints.</p>\n  </li>\n</ul>\n<p>Modern RAG systems typically rely on three complementary classes of re-rankers, each addressing a distinct dimension of relevance:</p>\n<ul>\n      <li><strong>Neural Learning-to-Rank (LTR) re-rankers</strong>, which model semantic relevance between queries and documents using learned ranking objectives.</li>\n      <li><strong>Instruction-tuned re-rankers</strong>, which allow relevance criteria to be dynamically adjusted at runtime using natural language instructions.</li>\n      <li><strong>Metadata-based re-rankers</strong>, which incorporate structured signals such as recency, authority, provenance, or document type to enforce policy and domain-specific constraints.</li>\n    </ul>\n<p>Together, these approaches form a layered re-ranking strategy in which semantic relevance is established first and then refined to better align with user intent, organizational rules, and real-world constraints.</p>\n<h4 id=\"learning-to-rank-paradigms\">Learning-to-Rank Paradigms</h4>\n<ul>\n  <li>\n    <p>Most re-ranking techniques fall under the umbrella of Learning-to-Rank (LTR), which differs based on how relevance is modeled and optimized:</p>\n\n    <ul>\n      <li><strong>Pointwise methods</strong> score each query–document pair independently, estimating absolute relevance.</li>\n      <li><strong>Pairwise methods</strong> compare two documents at a time for a given query, learning relative preferences.</li>\n      <li><strong>Listwise methods</strong> consider an entire ranked list jointly, optimizing ranking quality at the list level using task-specific loss functions.</li>\n    </ul>\n  </li>\n  <li>\n    <p>These paradigms can be implemented using different neural architectures, with trade-offs between computational cost, expressiveness, and ranking accuracy.</p>\n  </li>\n</ul>\n<p>Most re-ranking techniques fall under the umbrella of Learning-to-Rank (LTR), which differs based on how relevance is modeled and optimized:</p>\n<ul>\n      <li><strong>Pointwise methods</strong> score each query–document pair independently, estimating absolute relevance.</li>\n      <li><strong>Pairwise methods</strong> compare two documents at a time for a given query, learning relative preferences.</li>\n      <li><strong>Listwise methods</strong> consider an entire ranked list jointly, optimizing ranking quality at the list level using task-specific loss functions.</li>\n    </ul>\n<p>These paradigms can be implemented using different neural architectures, with trade-offs between computational cost, expressiveness, and ranking accuracy.</p>\n<h4 id=\"neural-re-rankers\">Neural Re-rankers</h4>\n<ul>\n  <li>Neural re-rankers form the core semantic ranking layer in most RAG systems. They are trained with explicit ranking objectives (pointwise, pairwise, or listwise) and are most commonly implemented using <strong>bi-encoder</strong> or <strong>cross-encoder</strong> architectures.</li>\n  <li>Neural re-rankers can be structured based on the type of re-ranking mechanism they employ, reflecting both architectural choices and how relevance is computed. The most common category is cross-encoder–based re-rankers, within which different LTR paradigms—pointwise, pairwise, and listwise—are used. More recent architectures extend beyond traditional cross-encoders to support list-level reasoning and alternative decoding strategies.</li>\n  <li>In practice, these differences manifest in how queries and candidate documents are jointly encoded and how relevance is computed, ranging from independent scoring of single query–document pairs to holistic reasoning over entire candidate lists.</li>\n</ul>\n<h5 id=\"bi-encoder-re-rankers-early-stage-or-lightweight-re-ranking\">Bi-encoder Re-rankers (early-stage or Lightweight Re-ranking)</h5>\n<ul>\n  <li>\n    <p>Bi-encoders (also known as dual-encoders) encode queries and documents independently into dense vectors and compute relevance using vector similarity.</p>\n\n    <ul>\n      <li>They are fast, scalable, and suitable for scoring large candidate sets.</li>\n      <li>However, they cannot model fine-grained token-level interactions between query and document.</li>\n      <li>Bi-encoders are typically trained as pointwise rankers; even when trained with pairwise or contrastive losses, they still score documents independently at inference time.</li>\n      <li>While most commonly used at the retrieval stage, bi-encoders are also employed as an early re-ranking step (especially after a lexical retrieval stage), where efficient scoring over large candidate sets is required. Bi-encoders are also used as a lightweight re-ranking stage when latency constraints are strict, cross-encoders are too expensive, or infrastructure only supports embedding-based scoring. In these cases, the bi-encoder acts as a coarse reranker that improves ordering without the full cost of joint encoding.</li>\n    </ul>\n  </li>\n  <li>\n    <p>In these cases, the bi-encoder acts as a coarse semantic filter that improves ordering without incurring the cost of joint encoding.</p>\n  </li>\n</ul>\n<p>Bi-encoders (also known as dual-encoders) encode queries and documents independently into dense vectors and compute relevance using vector similarity.</p>\n<ul>\n      <li>They are fast, scalable, and suitable for scoring large candidate sets.</li>\n      <li>However, they cannot model fine-grained token-level interactions between query and document.</li>\n      <li>Bi-encoders are typically trained as pointwise rankers; even when trained with pairwise or contrastive losses, they still score documents independently at inference time.</li>\n      <li>While most commonly used at the retrieval stage, bi-encoders are also employed as an early re-ranking step (especially after a lexical retrieval stage), where efficient scoring over large candidate sets is required. Bi-encoders are also used as a lightweight re-ranking stage when latency constraints are strict, cross-encoders are too expensive, or infrastructure only supports embedding-based scoring. In these cases, the bi-encoder acts as a coarse reranker that improves ordering without the full cost of joint encoding.</li>\n    </ul>\n<p>In these cases, the bi-encoder acts as a coarse semantic filter that improves ordering without incurring the cost of joint encoding.</p>\n<h5 id=\"cross-encoder-re-rankers-late-stage-high-precision-re-ranking\">Cross-encoder Re-rankers (late-stage, High-precision Re-ranking)</h5>\n<ul>\n  <li>\n    <p>Cross-encoders jointly encode the query and document, allowing full attention between tokens and enabling highly accurate relevance estimation at the cost of higher computation.</p>\n\n    <ul>\n      <li>This allows them to capture fine-grained relevance signals such as negation, term dependencies, and contextual constraints.</li>\n      <li>Cross-encoders are significantly more accurate than bi-encoders but computationally expensive.</li>\n      <li>They are therefore applied only to small candidate sets (often dozens of documents) in the final re-ranking stage.</li>\n      <li>Cross-encoders can be trained using pointwise, pairwise, or listwise LTR objectives.</li>\n    </ul>\n  </li>\n  <li>\n    <p>As a result, cross-encoders are the most common architecture for high-quality neural re-ranking in production RAG pipelines.</p>\n  </li>\n</ul>\n<p>Cross-encoders jointly encode the query and document, allowing full attention between tokens and enabling highly accurate relevance estimation at the cost of higher computation.</p>\n<ul>\n      <li>This allows them to capture fine-grained relevance signals such as negation, term dependencies, and contextual constraints.</li>\n      <li>Cross-encoders are significantly more accurate than bi-encoders but computationally expensive.</li>\n      <li>They are therefore applied only to small candidate sets (often dozens of documents) in the final re-ranking stage.</li>\n      <li>Cross-encoders can be trained using pointwise, pairwise, or listwise LTR objectives.</li>\n    </ul>\n<p>As a result, cross-encoders are the most common architecture for high-quality neural re-ranking in production RAG pipelines.</p>\n<h5 id=\"example-models\">Example Models</h5>\n<ul>\n  <li>This section organizes neural re-rankers by architectural family and learning paradigm, highlighting how pointwise, pairwise, and listwise approaches are implemented in modern systems.</li>\n  <li>These formulations correspond to pointwise, pairwise, and listwise re-ranking approaches, each offering different trade-offs between expressiveness, computational cost, and ranking quality.</li>\n</ul>\n<h6 id=\"examples-cross-encoder-re-rankers\">Examples: Cross-encoder Re-rankers</h6>\n<ul>\n  <li>\n    <p><strong>Pointwise Re-ranker</strong>:</p>\n\n    <ul>\n      <li><strong>monoBERT</strong>, proposed by Nogueira et al. (2019) in <a href=\"https://arxiv.org/abs/1910.14424\">Multi-Stage Document Ranking with BERT</a>, scores each document–query pair independently using BERT as a cross-encoder. The query is provided as sentence A and the document as sentence B in a single concatenated input sequence, allowing full self-attention between query and document tokens. After encoding, the final <code class=\"language-plaintext highlighter-rouge\">[CLS]</code> representation is passed through a single linear layer followed by a sigmoid activation to produce a scalar relevance probability <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-89-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>s</mi><mi>i</mi></msub><mo>=</mo><mi>P</mi><mo stretchy=&quot;false&quot;>(</mo><mtext>relevant</mtext><mo>&amp;#x2223;</mo><mi>q</mi><mo>,</mo><msub><mi>d</mi><mi>i</mi></msub><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-903\" style=\"width: 10.784em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 8.961em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1008.91em, 2.607em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-904\"><span class=\"msubsup\" id=\"MathJax-Span-905\"><span style=\"display: inline-block; position: relative; width: 0.68em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.37em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-906\" style=\"font-family: STIXGeneral-Italic;\">s</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.367em;\"><span class=\"mi\" id=\"MathJax-Span-907\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-908\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mi\" id=\"MathJax-Span-909\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">P</span><span class=\"mo\" id=\"MathJax-Span-910\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mtext\" id=\"MathJax-Span-911\" style=\"font-family: STIXGeneral-Regular;\">relevant</span><span class=\"mo\" id=\"MathJax-Span-912\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">∣</span><span class=\"mi\" id=\"MathJax-Span-913\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">q</span><span class=\"mo\" id=\"MathJax-Span-914\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-915\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-916\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"mi\" id=\"MathJax-Span-917\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-918\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>s</mi><mi>i</mi></msub><mo>=</mo><mi>P</mi><mo stretchy=\"false\">(</mo><mtext>relevant</mtext><mo>∣</mo><mi>q</mi><mo>,</mo><msub><mi>d</mi><mi>i</mi></msub><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-89\">s_i = P(\\text{relevant}\\mid q, d_i)</script>. The model is trained with binary cross-entropy loss over relevant and non-relevant documents, making monoBERT a pointwise probabilistic relevance classifier with high effectiveness but high inference cost when applied to many document–query pairs.</li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Pairwise Re-ranker</strong>:</p>\n\n    <ul>\n      <li><strong>duoBERT</strong>, also proposed by Nogueira et al. (2019) in <a href=\"https://arxiv.org/abs/1910.14424\">Multi-Stage Document Ranking with BERT</a>, is likewise a cross-encoder (not a bi-encoder) but operates in a pairwise ranking setting. The input consists of a single concatenated sequence with the query as sentence A and two candidate documents as sentences B and C. The resulting <code class=\"language-plaintext highlighter-rouge\">[CLS]</code> representation is passed through a single linear layer followed by a sigmoid activation to produce a probability <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-90-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>p</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mo>,</mo><mi>j</mi></mrow></msub><mo>=</mo><mi>P</mi><mo stretchy=&quot;false&quot;>(</mo><msub><mi>d</mi><mi>i</mi></msub><mo>&amp;#x227B;</mo><msub><mi>d</mi><mi>j</mi></msub><mo>&amp;#x2223;</mo><mi>q</mi><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-919\" style=\"width: 9.273em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 7.711em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1007.66em, 2.711em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-920\"><span class=\"msubsup\" id=\"MathJax-Span-921\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.378em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-922\" style=\"font-family: STIXGeneral-Italic;\">p</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-923\"><span class=\"mrow\" id=\"MathJax-Span-924\"><span class=\"mi\" id=\"MathJax-Span-925\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">i</span><span class=\"mo\" id=\"MathJax-Span-926\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">,</span><span class=\"mi\" id=\"MathJax-Span-927\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">j<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-928\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mi\" id=\"MathJax-Span-929\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">P</span><span class=\"mo\" id=\"MathJax-Span-930\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"msubsup\" id=\"MathJax-Span-931\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-932\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"mi\" id=\"MathJax-Span-933\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-934\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">≻</span><span class=\"msubsup\" id=\"MathJax-Span-935\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-936\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"mi\" id=\"MathJax-Span-937\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">j<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-938\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">∣</span><span class=\"mi\" id=\"MathJax-Span-939\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">q</span><span class=\"mo\" id=\"MathJax-Span-940\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.316em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>p</mi><mrow class=\"MJX-TeXAtom-ORD\"><mi>i</mi><mo>,</mo><mi>j</mi></mrow></msub><mo>=</mo><mi>P</mi><mo stretchy=\"false\">(</mo><msub><mi>d</mi><mi>i</mi></msub><mo>≻</mo><msub><mi>d</mi><mi>j</mi></msub><mo>∣</mo><mi>q</mi><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-90\">p_{i,j} = P(d_i \\succ d_j \\mid q)</script>. Training uses binary cross-entropy loss applied to ordered (relevant, non-relevant) document pairs rather than individual documents, meaning the same loss form as monoBERT but in a pairwise preference formulation. This enables direct document–document comparisons under the same query, at an even higher computational cost than monoBERT.</li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Listwise Re-rankers</strong>:</p>\n\n    <ul>\n      <li>\n        <p>Listwise re-rankers move beyond independent or pairwise scoring by modeling relevance across an entire ranked list simultaneously. This enables direct optimization of ranking metrics and better captures inter-document dependencies.</p>\n      </li>\n      <li>\n        <p><strong>ListBERT</strong>, proposed by Kumar et al. (2022) in <a href=\"https://arxiv.org/abs/2206.15198\">ListBERT: Learning to Rank E-commerce products with Listwise BERT</a>, brings a listwise learning paradigm to transformer-based ranking. Instead of scoring documents independently or in pairs, ListBERT considers a full list of documents simultaneously. It uses listwise loss functions tailored for ranking tasks (e.g., ListMLE, Softmax Cross Entropy) and was originally applied in the context of e-commerce to rank products effectively.</p>\n      </li>\n    </ul>\n  </li>\n</ul>\n<p><strong>Pointwise Re-ranker</strong>:</p>\n<ul>\n      <li><strong>monoBERT</strong>, proposed by Nogueira et al. (2019) in <a href=\"https://arxiv.org/abs/1910.14424\">Multi-Stage Document Ranking with BERT</a>, scores each document–query pair independently using BERT as a cross-encoder. The query is provided as sentence A and the document as sentence B in a single concatenated input sequence, allowing full self-attention between query and document tokens. After encoding, the final <code class=\"language-plaintext highlighter-rouge\">[CLS]</code> representation is passed through a single linear layer followed by a sigmoid activation to produce a scalar relevance probability <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-89-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>s</mi><mi>i</mi></msub><mo>=</mo><mi>P</mi><mo stretchy=&quot;false&quot;>(</mo><mtext>relevant</mtext><mo>&amp;#x2223;</mo><mi>q</mi><mo>,</mo><msub><mi>d</mi><mi>i</mi></msub><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-903\" style=\"width: 10.784em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 8.961em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1008.91em, 2.607em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-904\"><span class=\"msubsup\" id=\"MathJax-Span-905\"><span style=\"display: inline-block; position: relative; width: 0.68em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.37em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-906\" style=\"font-family: STIXGeneral-Italic;\">s</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.367em;\"><span class=\"mi\" id=\"MathJax-Span-907\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-908\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mi\" id=\"MathJax-Span-909\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">P</span><span class=\"mo\" id=\"MathJax-Span-910\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mtext\" id=\"MathJax-Span-911\" style=\"font-family: STIXGeneral-Regular;\">relevant</span><span class=\"mo\" id=\"MathJax-Span-912\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">∣</span><span class=\"mi\" id=\"MathJax-Span-913\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">q</span><span class=\"mo\" id=\"MathJax-Span-914\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-915\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-916\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"mi\" id=\"MathJax-Span-917\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-918\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>s</mi><mi>i</mi></msub><mo>=</mo><mi>P</mi><mo stretchy=\"false\">(</mo><mtext>relevant</mtext><mo>∣</mo><mi>q</mi><mo>,</mo><msub><mi>d</mi><mi>i</mi></msub><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-89\">s_i = P(\\text{relevant}\\mid q, d_i)</script>. The model is trained with binary cross-entropy loss over relevant and non-relevant documents, making monoBERT a pointwise probabilistic relevance classifier with high effectiveness but high inference cost when applied to many document–query pairs.</li>\n    </ul>\n<p><strong>Pairwise Re-ranker</strong>:</p>\n<ul>\n      <li><strong>duoBERT</strong>, also proposed by Nogueira et al. (2019) in <a href=\"https://arxiv.org/abs/1910.14424\">Multi-Stage Document Ranking with BERT</a>, is likewise a cross-encoder (not a bi-encoder) but operates in a pairwise ranking setting. The input consists of a single concatenated sequence with the query as sentence A and two candidate documents as sentences B and C. The resulting <code class=\"language-plaintext highlighter-rouge\">[CLS]</code> representation is passed through a single linear layer followed by a sigmoid activation to produce a probability <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-90-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>p</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mo>,</mo><mi>j</mi></mrow></msub><mo>=</mo><mi>P</mi><mo stretchy=&quot;false&quot;>(</mo><msub><mi>d</mi><mi>i</mi></msub><mo>&amp;#x227B;</mo><msub><mi>d</mi><mi>j</mi></msub><mo>&amp;#x2223;</mo><mi>q</mi><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-919\" style=\"width: 9.273em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 7.711em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1007.66em, 2.711em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-920\"><span class=\"msubsup\" id=\"MathJax-Span-921\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.378em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-922\" style=\"font-family: STIXGeneral-Italic;\">p</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-923\"><span class=\"mrow\" id=\"MathJax-Span-924\"><span class=\"mi\" id=\"MathJax-Span-925\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">i</span><span class=\"mo\" id=\"MathJax-Span-926\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">,</span><span class=\"mi\" id=\"MathJax-Span-927\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">j<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-928\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mi\" id=\"MathJax-Span-929\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">P</span><span class=\"mo\" id=\"MathJax-Span-930\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"msubsup\" id=\"MathJax-Span-931\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-932\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"mi\" id=\"MathJax-Span-933\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-934\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">≻</span><span class=\"msubsup\" id=\"MathJax-Span-935\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-936\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"mi\" id=\"MathJax-Span-937\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">j<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-938\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">∣</span><span class=\"mi\" id=\"MathJax-Span-939\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">q</span><span class=\"mo\" id=\"MathJax-Span-940\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.316em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>p</mi><mrow class=\"MJX-TeXAtom-ORD\"><mi>i</mi><mo>,</mo><mi>j</mi></mrow></msub><mo>=</mo><mi>P</mi><mo stretchy=\"false\">(</mo><msub><mi>d</mi><mi>i</mi></msub><mo>≻</mo><msub><mi>d</mi><mi>j</mi></msub><mo>∣</mo><mi>q</mi><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-90\">p_{i,j} = P(d_i \\succ d_j \\mid q)</script>. Training uses binary cross-entropy loss applied to ordered (relevant, non-relevant) document pairs rather than individual documents, meaning the same loss form as monoBERT but in a pairwise preference formulation. This enables direct document–document comparisons under the same query, at an even higher computational cost than monoBERT.</li>\n    </ul>\n<p><strong>Listwise Re-rankers</strong>:</p>\n<ul>\n      <li>\n        <p>Listwise re-rankers move beyond independent or pairwise scoring by modeling relevance across an entire ranked list simultaneously. This enables direct optimization of ranking metrics and better captures inter-document dependencies.</p>\n      </li>\n      <li>\n        <p><strong>ListBERT</strong>, proposed by Kumar et al. (2022) in <a href=\"https://arxiv.org/abs/2206.15198\">ListBERT: Learning to Rank E-commerce products with Listwise BERT</a>, brings a listwise learning paradigm to transformer-based ranking. Instead of scoring documents independently or in pairs, ListBERT considers a full list of documents simultaneously. It uses listwise loss functions tailored for ranking tasks (e.g., ListMLE, Softmax Cross Entropy) and was originally applied in the context of e-commerce to rank products effectively.</p>\n      </li>\n    </ul>\n<p>Listwise re-rankers move beyond independent or pairwise scoring by modeling relevance across an entire ranked list simultaneously. This enables direct optimization of ranking metrics and better captures inter-document dependencies.</p>\n<p><strong>ListBERT</strong>, proposed by Kumar et al. (2022) in <a href=\"https://arxiv.org/abs/2206.15198\">ListBERT: Learning to Rank E-commerce products with Listwise BERT</a>, brings a listwise learning paradigm to transformer-based ranking. Instead of scoring documents independently or in pairs, ListBERT considers a full list of documents simultaneously. It uses listwise loss functions tailored for ranking tasks (e.g., ListMLE, Softmax Cross Entropy) and was originally applied in the context of e-commerce to rank products effectively.</p>\n<h6 id=\"examples-encoder-decoder--decoder-based-listwise-re-rankers-fusion-in-decoder-architectures\">Examples: Encoder-Decoder / Decoder-based Listwise Re-rankers (Fusion-in-Decoder Architectures)</h6>\n<ul>\n  <li>\n    <p>A more recent class of listwise re-rankers leverages encoder–decoder architectures to jointly reason over multiple documents during decoding, rather than relying solely on encoder-side interactions.</p>\n  </li>\n  <li>\n    <p>While <a href=\"https://arxiv.org/abs/1910.14424\">monoBERT</a> by Nogueira et al. (2019) and <a href=\"https://arxiv.org/abs/1910.14424\">duoBERT</a> by Nogueira et al. (2019) rely on traditional cross-encoder architectures, <a href=\"https://arxiv.org/abs/2206.15198\">ListBERT</a> by Zhuang et al. (2022) and <a href=\"https://arxiv.org/abs/2402.15838\">ListT5</a> by Yoon et al. (2024) introduce list-level reasoning through different mechanisms. ListBERT remains encoder-only with listwise loss functions, whereas ListT5 employs a Fusion-in-Decoder architecture adapted from T5, which is not a standard cross-encoder. Decoder-based listwise re-rankers are explained below:</p>\n\n    <ul>\n      <li>\n        <p><strong>ListT5</strong> by Yoon et al. (2024), proposed in <a href=\"https://arxiv.org/abs/2402.15838\">ListT5: Listwise Re-ranking with Fusion-in-Decoder Improves Zero-shot Retrieval</a>, advances listwise re-ranking by adapting the Fusion-in-Decoder (FiD) architecture from <a href=\"https://arxiv.org/abs/1910.10683\">T5</a> by Raffel et al. (2019). Each candidate document is encoded independently together with the query, but the decoder jointly attends over the encoded representations of all candidates to generate relevance-aware outputs, enabling true listwise reasoning at decoding time. This architecture allows interactions across all documents in the candidate list without quadratic encoder costs and has shown strong performance in zero-shot and low-supervision retrieval settings with minimal labeled data.</p>\n      </li>\n      <li>\n        <p><strong>REARANK</strong> by Zhang et al. (2025), introduced in <a href=\"https://arxiv.org/abs/2505.20046\">REARANK: Reasoning Re-ranking Agent via Reinforcement Learning</a>, is an LLM-based <strong>listwise reranking agent</strong> that explicitly reasons about entire candidate sets before producing a ranked ordering. It leverages reinforcement learning and data augmentation to optimize a listwise objective, demonstrating strong performance with relatively few annotated samples and interpretable reasoning steps.</p>\n      </li>\n      <li>\n        <p><strong>Rank-K</strong> by Yang et al. (2025), proposed in <a href=\"https://arxiv.org/abs/2505.14432\">Rank-K: Test-Time Reasoning for Listwise Reranking</a>, prioposes a listwise passage reranking model that leverages reasoning language models at test time to compare and order multiple passages jointly, improving retrieval effectiveness and showing strong multilingual behavior in ranking.</p>\n      </li>\n    </ul>\n  </li>\n  <li>\n    <p>These decoder-based listwise re-rankers differ fundamentally from cross-encoder models like monoBERT and duoBERT: rather than producing independent relevance scores or pairwise comparisons, they perform global reasoning over an entire candidate set during decoding, trading higher memory usage and decoding cost for richer list-level interactions.</p>\n  </li>\n</ul>\n<p>A more recent class of listwise re-rankers leverages encoder–decoder architectures to jointly reason over multiple documents during decoding, rather than relying solely on encoder-side interactions.</p>\n<p>While <a href=\"https://arxiv.org/abs/1910.14424\">monoBERT</a> by Nogueira et al. (2019) and <a href=\"https://arxiv.org/abs/1910.14424\">duoBERT</a> by Nogueira et al. (2019) rely on traditional cross-encoder architectures, <a href=\"https://arxiv.org/abs/2206.15198\">ListBERT</a> by Zhuang et al. (2022) and <a href=\"https://arxiv.org/abs/2402.15838\">ListT5</a> by Yoon et al. (2024) introduce list-level reasoning through different mechanisms. ListBERT remains encoder-only with listwise loss functions, whereas ListT5 employs a Fusion-in-Decoder architecture adapted from T5, which is not a standard cross-encoder. Decoder-based listwise re-rankers are explained below:</p>\n<ul>\n      <li>\n        <p><strong>ListT5</strong> by Yoon et al. (2024), proposed in <a href=\"https://arxiv.org/abs/2402.15838\">ListT5: Listwise Re-ranking with Fusion-in-Decoder Improves Zero-shot Retrieval</a>, advances listwise re-ranking by adapting the Fusion-in-Decoder (FiD) architecture from <a href=\"https://arxiv.org/abs/1910.10683\">T5</a> by Raffel et al. (2019). Each candidate document is encoded independently together with the query, but the decoder jointly attends over the encoded representations of all candidates to generate relevance-aware outputs, enabling true listwise reasoning at decoding time. This architecture allows interactions across all documents in the candidate list without quadratic encoder costs and has shown strong performance in zero-shot and low-supervision retrieval settings with minimal labeled data.</p>\n      </li>\n      <li>\n        <p><strong>REARANK</strong> by Zhang et al. (2025), introduced in <a href=\"https://arxiv.org/abs/2505.20046\">REARANK: Reasoning Re-ranking Agent via Reinforcement Learning</a>, is an LLM-based <strong>listwise reranking agent</strong> that explicitly reasons about entire candidate sets before producing a ranked ordering. It leverages reinforcement learning and data augmentation to optimize a listwise objective, demonstrating strong performance with relatively few annotated samples and interpretable reasoning steps.</p>\n      </li>\n      <li>\n        <p><strong>Rank-K</strong> by Yang et al. (2025), proposed in <a href=\"https://arxiv.org/abs/2505.14432\">Rank-K: Test-Time Reasoning for Listwise Reranking</a>, prioposes a listwise passage reranking model that leverages reasoning language models at test time to compare and order multiple passages jointly, improving retrieval effectiveness and showing strong multilingual behavior in ranking.</p>\n      </li>\n    </ul>\n<p><strong>ListT5</strong> by Yoon et al. (2024), proposed in <a href=\"https://arxiv.org/abs/2402.15838\">ListT5: Listwise Re-ranking with Fusion-in-Decoder Improves Zero-shot Retrieval</a>, advances listwise re-ranking by adapting the Fusion-in-Decoder (FiD) architecture from <a href=\"https://arxiv.org/abs/1910.10683\">T5</a> by Raffel et al. (2019). Each candidate document is encoded independently together with the query, but the decoder jointly attends over the encoded representations of all candidates to generate relevance-aware outputs, enabling true listwise reasoning at decoding time. This architecture allows interactions across all documents in the candidate list without quadratic encoder costs and has shown strong performance in zero-shot and low-supervision retrieval settings with minimal labeled data.</p>\n<p><strong>REARANK</strong> by Zhang et al. (2025), introduced in <a href=\"https://arxiv.org/abs/2505.20046\">REARANK: Reasoning Re-ranking Agent via Reinforcement Learning</a>, is an LLM-based <strong>listwise reranking agent</strong> that explicitly reasons about entire candidate sets before producing a ranked ordering. It leverages reinforcement learning and data augmentation to optimize a listwise objective, demonstrating strong performance with relatively few annotated samples and interpretable reasoning steps.</p>\n<p><strong>Rank-K</strong> by Yang et al. (2025), proposed in <a href=\"https://arxiv.org/abs/2505.14432\">Rank-K: Test-Time Reasoning for Listwise Reranking</a>, prioposes a listwise passage reranking model that leverages reasoning language models at test time to compare and order multiple passages jointly, improving retrieval effectiveness and showing strong multilingual behavior in ranking.</p>\n<p>These decoder-based listwise re-rankers differ fundamentally from cross-encoder models like monoBERT and duoBERT: rather than producing independent relevance scores or pairwise comparisons, they perform global reasoning over an entire candidate set during decoding, trading higher memory usage and decoding cost for richer list-level interactions.</p>\n<h5 id=\"domain-specific-adaptations\">Domain-Specific Adaptations</h5>\n<ul>\n  <li>\n    <p>Neural re-rankers can be further specialized through domain-specific adaptation, where models are fine-tuned or pretrained on corpora and relevance judgments drawn from a particular field. This aligns the re-ranker’s representations with domain-specific terminology, document structures, and relevance criteria that differ from general-purpose benchmarks (e.g., legal, healthcare, finance).</p>\n  </li>\n  <li>\n    <p>For example, <strong><a href=\"https://arxiv.org/abs/2010.02559\">Legal-BERT</a></strong> extends the BERT architecture through pretraining on large legal corpora and can be adapted as a re-ranker for tasks such as legal document ranking and case law search. Domain-aware ranking approaches that customize relevance based on industry semantics have shown improved performance in specialized fields like legal search. Additionally, models like <strong><a href=\"https://www.siliconflow.com/articles/en/Most-powerful-re-ranking-model-for-legal-documents\">Qwen3-Reranker</a></strong> demonstrate how legal-focused re-rankers with long-context capabilities can improve relevance for complex legal document tasks.</p>\n  </li>\n  <li>\n    <p>In the healthcare domain, dedicated models such as the ones proposed in <strong><a href=\"https://www.zeroentropy.dev/articles/best-reranker-healthcare\">ZeroEntropy Reranker for Healthcare AI</a></strong> provide domain-specific re-ranking tuned to prioritize clinical guidelines, electronic health records, and medical research documents, helping surface the most authoritative and clinically relevant information in RAG workflows.</p>\n  </li>\n  <li>\n    <p>Domain-specific rerankers are also emerging in finance and compliance applications, where tailored ranking models help improve fraud detection, policy retrieval, and compliance task relevance, demonstrating the broader applicability of specialized re-ranking beyond general semantic similarity.</p>\n  </li>\n  <li>\n    <p>Similar domain-adapted re-rankers are being developed in technical domains where relevance depends on specialized vocabulary, regulatory context, or evidence standards. In these settings, domain-specific re-ranking helps reduce false positives, surface authoritative sources, and ensure that highly specialized documents are correctly prioritized within the final ranked list.</p>\n  </li>\n</ul>\n<p>Neural re-rankers can be further specialized through domain-specific adaptation, where models are fine-tuned or pretrained on corpora and relevance judgments drawn from a particular field. This aligns the re-ranker’s representations with domain-specific terminology, document structures, and relevance criteria that differ from general-purpose benchmarks (e.g., legal, healthcare, finance).</p>\n<p>For example, <strong><a href=\"https://arxiv.org/abs/2010.02559\">Legal-BERT</a></strong> extends the BERT architecture through pretraining on large legal corpora and can be adapted as a re-ranker for tasks such as legal document ranking and case law search. Domain-aware ranking approaches that customize relevance based on industry semantics have shown improved performance in specialized fields like legal search. Additionally, models like <strong><a href=\"https://www.siliconflow.com/articles/en/Most-powerful-re-ranking-model-for-legal-documents\">Qwen3-Reranker</a></strong> demonstrate how legal-focused re-rankers with long-context capabilities can improve relevance for complex legal document tasks.</p>\n<p>In the healthcare domain, dedicated models such as the ones proposed in <strong><a href=\"https://www.zeroentropy.dev/articles/best-reranker-healthcare\">ZeroEntropy Reranker for Healthcare AI</a></strong> provide domain-specific re-ranking tuned to prioritize clinical guidelines, electronic health records, and medical research documents, helping surface the most authoritative and clinically relevant information in RAG workflows.</p>\n<p>Domain-specific rerankers are also emerging in finance and compliance applications, where tailored ranking models help improve fraud detection, policy retrieval, and compliance task relevance, demonstrating the broader applicability of specialized re-ranking beyond general semantic similarity.</p>\n<p>Similar domain-adapted re-rankers are being developed in technical domains where relevance depends on specialized vocabulary, regulatory context, or evidence standards. In these settings, domain-specific re-ranking helps reduce false positives, surface authoritative sources, and ensure that highly specialized documents are correctly prioritized within the final ranked list.</p>\n<h4 id=\"instruction-following-re-ranking\">Instruction-Following Re-ranking</h4>\n<ul>\n  <li>\n    <p>A growing frontier in re-ranking is instruction-following re-ranking, which augments neural re-rankers with the ability to condition ranking behavior on natural language instructions. Instead of relying on a fixed notion of relevance learned during training, these models allow relevance criteria to be specified or adjusted at runtime, enabling more flexible and context-aware ranking decisions. This capability is particularly valuable in enterprise and production RAG systems where relevance often depends on business rules, trust constraints, or temporal considerations rather than semantic similarity alone.</p>\n  </li>\n  <li>\n    <p>Instruction-following re-rankers are typically built on top of large language models or instruction-tuned cross-encoders, leveraging advances in instruction tuning and alignment. By treating ranking as a controllable task, they bridge the gap between traditional LTR objectives and prompt-based control paradigms discussed in work on instruction-tuned models such as <a href=\"https://arxiv.org/abs/2109.01652\">Instruction Tuning</a> and <a href=\"https://arxiv.org/abs/2210.11416\">FLAN</a>.</p>\n  </li>\n  <li>\n    <p><strong>Examples of Natural Language Instructions</strong>:</p>\n\n    <ul>\n      <li>“Prioritize internal documentation over third-party sources. Favor the most recent information.”</li>\n      <li>“Disregard news summaries. Emphasize detailed technical reports from trusted analysts.”</li>\n      <li>“Prefer primary sources and official standards documents over community blog posts.”</li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Advantages</strong>:</p>\n\n    <ul>\n      <li><strong>Dynamic Relevance Modeling</strong>: Instructions enable runtime control over what relevance means, allowing the same retrieved candidate set to be re-ranked differently depending on user intent, task context, or organizational policy.</li>\n      <li><strong>Conflict Resolution</strong>: Explicit instructions make it possible to resolve contradictory or overlapping sources by enforcing prioritization rules such as recency, authority, or provenance, complementing purely learned relevance signals.</li>\n      <li><strong>Prompt Optimization</strong>: By ensuring that higher-quality and policy-compliant content appears earlier in the ranked list, instruction-following re-ranking helps maximize the utility of the limited context window, where the language model’s attention is most concentrated.</li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Implementation and Deployment</strong>:</p>\n\n    <ul>\n      <li>Instruction-following re-rankers are commonly deployed as a post-retrieval scoring layer that operates on a small shortlist of candidate documents. They are often exposed as standalone APIs or integrated modules within RAG pipelines, similar to conventional cross-encoder re-rankers but with an additional instruction input.</li>\n      <li>A notable example is Contextual AI’s system described in <a href=\"https://contextual.ai/blog/introducing-instruction-following-reranker/\">Introducing the World’s First Instruction-Following Reranker</a>, which demonstrates how natural language instructions can be combined with neural re-ranking to enforce enterprise-specific relevance constraints in real-world deployments.</li>\n      <li>Instruction-following re-rankers can be combined with other techniques such as retriever ensembling, metadata-based filtering, or late chunking, effectively acting as the final curation layer before documents are assembled into the prompt sent to the language model.</li>\n    </ul>\n  </li>\n</ul>\n<p>A growing frontier in re-ranking is instruction-following re-ranking, which augments neural re-rankers with the ability to condition ranking behavior on natural language instructions. Instead of relying on a fixed notion of relevance learned during training, these models allow relevance criteria to be specified or adjusted at runtime, enabling more flexible and context-aware ranking decisions. This capability is particularly valuable in enterprise and production RAG systems where relevance often depends on business rules, trust constraints, or temporal considerations rather than semantic similarity alone.</p>\n<p>Instruction-following re-rankers are typically built on top of large language models or instruction-tuned cross-encoders, leveraging advances in instruction tuning and alignment. By treating ranking as a controllable task, they bridge the gap between traditional LTR objectives and prompt-based control paradigms discussed in work on instruction-tuned models such as <a href=\"https://arxiv.org/abs/2109.01652\">Instruction Tuning</a> and <a href=\"https://arxiv.org/abs/2210.11416\">FLAN</a>.</p>\n<p><strong>Examples of Natural Language Instructions</strong>:</p>\n<ul>\n      <li>“Prioritize internal documentation over third-party sources. Favor the most recent information.”</li>\n      <li>“Disregard news summaries. Emphasize detailed technical reports from trusted analysts.”</li>\n      <li>“Prefer primary sources and official standards documents over community blog posts.”</li>\n    </ul>\n<p><strong>Advantages</strong>:</p>\n<ul>\n      <li><strong>Dynamic Relevance Modeling</strong>: Instructions enable runtime control over what relevance means, allowing the same retrieved candidate set to be re-ranked differently depending on user intent, task context, or organizational policy.</li>\n      <li><strong>Conflict Resolution</strong>: Explicit instructions make it possible to resolve contradictory or overlapping sources by enforcing prioritization rules such as recency, authority, or provenance, complementing purely learned relevance signals.</li>\n      <li><strong>Prompt Optimization</strong>: By ensuring that higher-quality and policy-compliant content appears earlier in the ranked list, instruction-following re-ranking helps maximize the utility of the limited context window, where the language model’s attention is most concentrated.</li>\n    </ul>\n<p><strong>Implementation and Deployment</strong>:</p>\n<ul>\n      <li>Instruction-following re-rankers are commonly deployed as a post-retrieval scoring layer that operates on a small shortlist of candidate documents. They are often exposed as standalone APIs or integrated modules within RAG pipelines, similar to conventional cross-encoder re-rankers but with an additional instruction input.</li>\n      <li>A notable example is Contextual AI’s system described in <a href=\"https://contextual.ai/blog/introducing-instruction-following-reranker/\">Introducing the World’s First Instruction-Following Reranker</a>, which demonstrates how natural language instructions can be combined with neural re-ranking to enforce enterprise-specific relevance constraints in real-world deployments.</li>\n      <li>Instruction-following re-rankers can be combined with other techniques such as retriever ensembling, metadata-based filtering, or late chunking, effectively acting as the final curation layer before documents are assembled into the prompt sent to the language model.</li>\n    </ul>\n<h4 id=\"metadata-based-re-rankers\">Metadata-Based Re-rankers</h4>\n<ul>\n  <li>\n    <p>Metadata-based re-rankers incorporate structured, non-textual signals into the re-ranking stage to bias results toward documents that satisfy explicit criteria such as recency, authority, source type, or document provenance. Rather than replacing neural relevance scores, these signals are typically combined with semantic scores to produce a final ranking that better reflects practical relevance constraints in real-world systems.</p>\n  </li>\n  <li>\n    <p>Common metadata signals include timestamps, source identifiers, publisher reputation, document type, access level, and usage statistics. These features are especially valuable in enterprise and regulated settings, where the most semantically relevant document may not be the most trustworthy or up to date. This idea aligns with classical ranking work that blends multiple relevance signals, such as BM25 variants with field or freshness boosts, and modern hybrid ranking systems discussed in <a href=\"https://link.springer.com/book/10.1007/978-3-642-14267-3\">Learning to Rank for Information Retrieval</a> by Tie-Yan Liu.</p>\n  </li>\n  <li>\n    <p><strong>Typical Re-ranking Criteria</strong>:</p>\n\n    <ul>\n      <li><strong>Recency</strong>: Favor newer documents using timestamp-based decay functions, particularly important for fast-changing domains such as news, finance, or internal documentation.</li>\n      <li><strong>Authority and Source Trust</strong>: Prefer documents from curated or authoritative sources (e.g., internal wikis, official standards bodies) over third-party or user-generated content.</li>\n      <li><strong>Document Type and Provenance</strong>: Boost primary sources, specifications, or policies while demoting summaries, duplicates, or low-signal content.</li>\n    </ul>\n  </li>\n  <li>\n    <p>In practice, metadata-based re-ranking is often implemented using rule-based or learned scoring functions layered on top of neural relevance scores. Search platforms such as Elasticsearch and OpenSearch expose this pattern through mechanisms like Elastic’s <a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-function-score-query.html\">function score queries</a>, enabling explicit weighting of freshness, popularity, or source fields during re-ranking.</p>\n  </li>\n  <li>\n    <p>Metadata-based approaches are frequently combined with neural re-rankers rather than used in isolation. For example, a cross-encoder or instruction-following re-ranker may first score semantic relevance, after which metadata-based adjustments enforce hard or soft constraints on ordering. This hybrid strategy reflects best practices described in modern RAG system design discussions, including <a href=\"https://www.pinecone.io/learn/hybrid-search/\">Introducing the hybrid index to enable keyword-aware semantic search</a> by Pinecone.</p>\n  </li>\n  <li>\n    <p>Within RAG pipelines, metadata-based re-rankers often serve as a policy-enforcement layer, ensuring compliance with business rules and trust requirements while preserving the strengths of neural relevance modeling. When used alongside instruction-following re-rankers, metadata signals can either be encoded directly into instructions or applied as an explicit post-processing step, providing clear separation between semantic relevance and governance constraints.</p>\n  </li>\n</ul>\n<p>Metadata-based re-rankers incorporate structured, non-textual signals into the re-ranking stage to bias results toward documents that satisfy explicit criteria such as recency, authority, source type, or document provenance. Rather than replacing neural relevance scores, these signals are typically combined with semantic scores to produce a final ranking that better reflects practical relevance constraints in real-world systems.</p>\n<p>Common metadata signals include timestamps, source identifiers, publisher reputation, document type, access level, and usage statistics. These features are especially valuable in enterprise and regulated settings, where the most semantically relevant document may not be the most trustworthy or up to date. This idea aligns with classical ranking work that blends multiple relevance signals, such as BM25 variants with field or freshness boosts, and modern hybrid ranking systems discussed in <a href=\"https://link.springer.com/book/10.1007/978-3-642-14267-3\">Learning to Rank for Information Retrieval</a> by Tie-Yan Liu.</p>\n<p><strong>Typical Re-ranking Criteria</strong>:</p>\n<ul>\n      <li><strong>Recency</strong>: Favor newer documents using timestamp-based decay functions, particularly important for fast-changing domains such as news, finance, or internal documentation.</li>\n      <li><strong>Authority and Source Trust</strong>: Prefer documents from curated or authoritative sources (e.g., internal wikis, official standards bodies) over third-party or user-generated content.</li>\n      <li><strong>Document Type and Provenance</strong>: Boost primary sources, specifications, or policies while demoting summaries, duplicates, or low-signal content.</li>\n    </ul>\n<p>In practice, metadata-based re-ranking is often implemented using rule-based or learned scoring functions layered on top of neural relevance scores. Search platforms such as Elasticsearch and OpenSearch expose this pattern through mechanisms like Elastic’s <a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-function-score-query.html\">function score queries</a>, enabling explicit weighting of freshness, popularity, or source fields during re-ranking.</p>\n<p>Metadata-based approaches are frequently combined with neural re-rankers rather than used in isolation. For example, a cross-encoder or instruction-following re-ranker may first score semantic relevance, after which metadata-based adjustments enforce hard or soft constraints on ordering. This hybrid strategy reflects best practices described in modern RAG system design discussions, including <a href=\"https://www.pinecone.io/learn/hybrid-search/\">Introducing the hybrid index to enable keyword-aware semantic search</a> by Pinecone.</p>\n<p>Within RAG pipelines, metadata-based re-rankers often serve as a policy-enforcement layer, ensuring compliance with business rules and trust requirements while preserving the strengths of neural relevance modeling. When used alongside instruction-following re-rankers, metadata signals can either be encoded directly into instructions or applied as an explicit post-processing step, providing clear separation between semantic relevance and governance constraints.</p>",
    "contentMarkdown": "*   Re-ranking is a critical refinement stage in modern Retrieval-Augmented Generation (RAG) pipelines, responsible for reordering a small candidate set of retrieved documents or passages to ensure that the most relevant content is prioritized for inclusion in the final prompt presented to the language model. While retrieval focuses on recall at scale, re-ranking emphasizes precision, making it a key determinant of generation quality.\n\n#### Re-ranking in Multistage Retrieval Pipelines\n\n*   In practice, re-ranking is applied after an initial retrieval stage has narrowed the corpus to a manageable shortlist. Because the candidate set is small—typically tens to hundreds of documents—computationally intensive but highly accurate re-ranking techniques become feasible.\n    \n*   The figure below ([source](https://weaviate.io/blog/cross-encoders-as-reranker)) illustrates a common multistage search pipeline used in RAG systems. In the first stage, a bi-encoder efficiently retrieves a shortlist of candidate documents from a large corpus. In the second stage, a re-ranker—often implemented as a cross-encoder—is applied to this reduced set to reassess and reorder the results based on deeper query–document interactions. This two-stage design combines the scalability of bi-encoder retrieval with the higher relevance accuracy of cross-encoder re-ranking, making it practical to deploy on large-scale datasets while still achieving strong ranking quality.\n    \n\nIn practice, re-ranking is applied after an initial retrieval stage has narrowed the corpus to a manageable shortlist. Because the candidate set is small—typically tens to hundreds of documents—computationally intensive but highly accurate re-ranking techniques become feasible.\n\nThe figure below ([source](https://weaviate.io/blog/cross-encoders-as-reranker)) illustrates a common multistage search pipeline used in RAG systems. In the first stage, a bi-encoder efficiently retrieves a shortlist of candidate documents from a large corpus. In the second stage, a re-ranker—often implemented as a cross-encoder—is applied to this reduced set to reassess and reorder the results based on deeper query–document interactions. This two-stage design combines the scalability of bi-encoder retrieval with the higher relevance accuracy of cross-encoder re-ranking, making it practical to deploy on large-scale datasets while still achieving strong ranking quality.\n\n![](/primers/ai/assets/RAG/multistage-search-pipeline.jpg)\n\n*   This multistage architecture is foundational to modern RAG systems and motivates the different classes of re-rankers used in practice.\n\n#### Classes of Semantic Re-ranking Models\n\n*   Modern RAG systems typically rely on three complementary classes of re-rankers, each addressing a distinct dimension of relevance:\n    \n    *   **Neural Learning-to-Rank (LTR) re-rankers**, which model semantic relevance between queries and documents using learned ranking objectives.\n    *   **Instruction-tuned re-rankers**, which allow relevance criteria to be dynamically adjusted at runtime using natural language instructions.\n    *   **Metadata-based re-rankers**, which incorporate structured signals such as recency, authority, provenance, or document type to enforce policy and domain-specific constraints.\n*   Together, these approaches form a layered re-ranking strategy in which semantic relevance is established first and then refined to better align with user intent, organizational rules, and real-world constraints.\n    \n\nModern RAG systems typically rely on three complementary classes of re-rankers, each addressing a distinct dimension of relevance:\n\n*   **Neural Learning-to-Rank (LTR) re-rankers**, which model semantic relevance between queries and documents using learned ranking objectives.\n*   **Instruction-tuned re-rankers**, which allow relevance criteria to be dynamically adjusted at runtime using natural language instructions.\n*   **Metadata-based re-rankers**, which incorporate structured signals such as recency, authority, provenance, or document type to enforce policy and domain-specific constraints.\n\nTogether, these approaches form a layered re-ranking strategy in which semantic relevance is established first and then refined to better align with user intent, organizational rules, and real-world constraints.\n\n#### Learning-to-Rank Paradigms\n\n*   Most re-ranking techniques fall under the umbrella of Learning-to-Rank (LTR), which differs based on how relevance is modeled and optimized:\n    \n    *   **Pointwise methods** score each query–document pair independently, estimating absolute relevance.\n    *   **Pairwise methods** compare two documents at a time for a given query, learning relative preferences.\n    *   **Listwise methods** consider an entire ranked list jointly, optimizing ranking quality at the list level using task-specific loss functions.\n*   These paradigms can be implemented using different neural architectures, with trade-offs between computational cost, expressiveness, and ranking accuracy.\n    \n\nMost re-ranking techniques fall under the umbrella of Learning-to-Rank (LTR), which differs based on how relevance is modeled and optimized:\n\n*   **Pointwise methods** score each query–document pair independently, estimating absolute relevance.\n*   **Pairwise methods** compare two documents at a time for a given query, learning relative preferences.\n*   **Listwise methods** consider an entire ranked list jointly, optimizing ranking quality at the list level using task-specific loss functions.\n\nThese paradigms can be implemented using different neural architectures, with trade-offs between computational cost, expressiveness, and ranking accuracy.\n\n#### Neural Re-rankers\n\n*   Neural re-rankers form the core semantic ranking layer in most RAG systems. They are trained with explicit ranking objectives (pointwise, pairwise, or listwise) and are most commonly implemented using **bi-encoder** or **cross-encoder** architectures.\n*   Neural re-rankers can be structured based on the type of re-ranking mechanism they employ, reflecting both architectural choices and how relevance is computed. The most common category is cross-encoder–based re-rankers, within which different LTR paradigms—pointwise, pairwise, and listwise—are used. More recent architectures extend beyond traditional cross-encoders to support list-level reasoning and alternative decoding strategies.\n*   In practice, these differences manifest in how queries and candidate documents are jointly encoded and how relevance is computed, ranging from independent scoring of single query–document pairs to holistic reasoning over entire candidate lists.\n\n##### Bi-encoder Re-rankers (early-stage or Lightweight Re-ranking)\n\n*   Bi-encoders (also known as dual-encoders) encode queries and documents independently into dense vectors and compute relevance using vector similarity.\n    \n    *   They are fast, scalable, and suitable for scoring large candidate sets.\n    *   However, they cannot model fine-grained token-level interactions between query and document.\n    *   Bi-encoders are typically trained as pointwise rankers; even when trained with pairwise or contrastive losses, they still score documents independently at inference time.\n    *   While most commonly used at the retrieval stage, bi-encoders are also employed as an early re-ranking step (especially after a lexical retrieval stage), where efficient scoring over large candidate sets is required. Bi-encoders are also used as a lightweight re-ranking stage when latency constraints are strict, cross-encoders are too expensive, or infrastructure only supports embedding-based scoring. In these cases, the bi-encoder acts as a coarse reranker that improves ordering without the full cost of joint encoding.\n*   In these cases, the bi-encoder acts as a coarse semantic filter that improves ordering without incurring the cost of joint encoding.\n    \n\nBi-encoders (also known as dual-encoders) encode queries and documents independently into dense vectors and compute relevance using vector similarity.\n\n*   They are fast, scalable, and suitable for scoring large candidate sets.\n*   However, they cannot model fine-grained token-level interactions between query and document.\n*   Bi-encoders are typically trained as pointwise rankers; even when trained with pairwise or contrastive losses, they still score documents independently at inference time.\n*   While most commonly used at the retrieval stage, bi-encoders are also employed as an early re-ranking step (especially after a lexical retrieval stage), where efficient scoring over large candidate sets is required. Bi-encoders are also used as a lightweight re-ranking stage when latency constraints are strict, cross-encoders are too expensive, or infrastructure only supports embedding-based scoring. In these cases, the bi-encoder acts as a coarse reranker that improves ordering without the full cost of joint encoding.\n\nIn these cases, the bi-encoder acts as a coarse semantic filter that improves ordering without incurring the cost of joint encoding.\n\n##### Cross-encoder Re-rankers (late-stage, High-precision Re-ranking)\n\n*   Cross-encoders jointly encode the query and document, allowing full attention between tokens and enabling highly accurate relevance estimation at the cost of higher computation.\n    \n    *   This allows them to capture fine-grained relevance signals such as negation, term dependencies, and contextual constraints.\n    *   Cross-encoders are significantly more accurate than bi-encoders but computationally expensive.\n    *   They are therefore applied only to small candidate sets (often dozens of documents) in the final re-ranking stage.\n    *   Cross-encoders can be trained using pointwise, pairwise, or listwise LTR objectives.\n*   As a result, cross-encoders are the most common architecture for high-quality neural re-ranking in production RAG pipelines.\n    \n\nCross-encoders jointly encode the query and document, allowing full attention between tokens and enabling highly accurate relevance estimation at the cost of higher computation.\n\n*   This allows them to capture fine-grained relevance signals such as negation, term dependencies, and contextual constraints.\n*   Cross-encoders are significantly more accurate than bi-encoders but computationally expensive.\n*   They are therefore applied only to small candidate sets (often dozens of documents) in the final re-ranking stage.\n*   Cross-encoders can be trained using pointwise, pairwise, or listwise LTR objectives.\n\nAs a result, cross-encoders are the most common architecture for high-quality neural re-ranking in production RAG pipelines.\n\n##### Example Models\n\n*   This section organizes neural re-rankers by architectural family and learning paradigm, highlighting how pointwise, pairwise, and listwise approaches are implemented in modern systems.\n*   These formulations correspond to pointwise, pairwise, and listwise re-ranking approaches, each offering different trade-offs between expressiveness, computational cost, and ranking quality.\n\n###### Examples: Cross-encoder Re-rankers\n\n*   **Pointwise Re-ranker**:\n    \n    *   **monoBERT**, proposed by Nogueira et al. (2019) in [Multi-Stage Document Ranking with BERT](https://arxiv.org/abs/1910.14424), scores each document–query pair independently using BERT as a cross-encoder. The query is provided as sentence A and the document as sentence B in a single concatenated input sequence, allowing full self-attention between query and document tokens. After encoding, the final `[CLS]` representation is passed through a single linear layer followed by a sigmoid activation to produce a scalar relevance probability si\\=P(relevant∣q,di)si\\=P(relevant∣q,di)s\\_i = P(\\\\text{relevant}\\\\mid q, d\\_i). The model is trained with binary cross-entropy loss over relevant and non-relevant documents, making monoBERT a pointwise probabilistic relevance classifier with high effectiveness but high inference cost when applied to many document–query pairs.\n*   **Pairwise Re-ranker**:\n    \n    *   **duoBERT**, also proposed by Nogueira et al. (2019) in [Multi-Stage Document Ranking with BERT](https://arxiv.org/abs/1910.14424), is likewise a cross-encoder (not a bi-encoder) but operates in a pairwise ranking setting. The input consists of a single concatenated sequence with the query as sentence A and two candidate documents as sentences B and C. The resulting `[CLS]` representation is passed through a single linear layer followed by a sigmoid activation to produce a probability pi,j\\=P(di≻dj∣q)pi,j\\=P(di≻dj∣q)p\\_{i,j} = P(d\\_i \\\\succ d\\_j \\\\mid q). Training uses binary cross-entropy loss applied to ordered (relevant, non-relevant) document pairs rather than individual documents, meaning the same loss form as monoBERT but in a pairwise preference formulation. This enables direct document–document comparisons under the same query, at an even higher computational cost than monoBERT.\n*   **Listwise Re-rankers**:\n    \n    *   Listwise re-rankers move beyond independent or pairwise scoring by modeling relevance across an entire ranked list simultaneously. This enables direct optimization of ranking metrics and better captures inter-document dependencies.\n        \n    *   **ListBERT**, proposed by Kumar et al. (2022) in [ListBERT: Learning to Rank E-commerce products with Listwise BERT](https://arxiv.org/abs/2206.15198), brings a listwise learning paradigm to transformer-based ranking. Instead of scoring documents independently or in pairs, ListBERT considers a full list of documents simultaneously. It uses listwise loss functions tailored for ranking tasks (e.g., ListMLE, Softmax Cross Entropy) and was originally applied in the context of e-commerce to rank products effectively.\n        \n\n**Pointwise Re-ranker**:\n\n*   **monoBERT**, proposed by Nogueira et al. (2019) in [Multi-Stage Document Ranking with BERT](https://arxiv.org/abs/1910.14424), scores each document–query pair independently using BERT as a cross-encoder. The query is provided as sentence A and the document as sentence B in a single concatenated input sequence, allowing full self-attention between query and document tokens. After encoding, the final `[CLS]` representation is passed through a single linear layer followed by a sigmoid activation to produce a scalar relevance probability si\\=P(relevant∣q,di)si\\=P(relevant∣q,di)s\\_i = P(\\\\text{relevant}\\\\mid q, d\\_i). The model is trained with binary cross-entropy loss over relevant and non-relevant documents, making monoBERT a pointwise probabilistic relevance classifier with high effectiveness but high inference cost when applied to many document–query pairs.\n\n**Pairwise Re-ranker**:\n\n*   **duoBERT**, also proposed by Nogueira et al. (2019) in [Multi-Stage Document Ranking with BERT](https://arxiv.org/abs/1910.14424), is likewise a cross-encoder (not a bi-encoder) but operates in a pairwise ranking setting. The input consists of a single concatenated sequence with the query as sentence A and two candidate documents as sentences B and C. The resulting `[CLS]` representation is passed through a single linear layer followed by a sigmoid activation to produce a probability pi,j\\=P(di≻dj∣q)pi,j\\=P(di≻dj∣q)p\\_{i,j} = P(d\\_i \\\\succ d\\_j \\\\mid q). Training uses binary cross-entropy loss applied to ordered (relevant, non-relevant) document pairs rather than individual documents, meaning the same loss form as monoBERT but in a pairwise preference formulation. This enables direct document–document comparisons under the same query, at an even higher computational cost than monoBERT.\n\n**Listwise Re-rankers**:\n\n*   Listwise re-rankers move beyond independent or pairwise scoring by modeling relevance across an entire ranked list simultaneously. This enables direct optimization of ranking metrics and better captures inter-document dependencies.\n    \n*   **ListBERT**, proposed by Kumar et al. (2022) in [ListBERT: Learning to Rank E-commerce products with Listwise BERT](https://arxiv.org/abs/2206.15198), brings a listwise learning paradigm to transformer-based ranking. Instead of scoring documents independently or in pairs, ListBERT considers a full list of documents simultaneously. It uses listwise loss functions tailored for ranking tasks (e.g., ListMLE, Softmax Cross Entropy) and was originally applied in the context of e-commerce to rank products effectively.\n    \n\nListwise re-rankers move beyond independent or pairwise scoring by modeling relevance across an entire ranked list simultaneously. This enables direct optimization of ranking metrics and better captures inter-document dependencies.\n\n**ListBERT**, proposed by Kumar et al. (2022) in [ListBERT: Learning to Rank E-commerce products with Listwise BERT](https://arxiv.org/abs/2206.15198), brings a listwise learning paradigm to transformer-based ranking. Instead of scoring documents independently or in pairs, ListBERT considers a full list of documents simultaneously. It uses listwise loss functions tailored for ranking tasks (e.g., ListMLE, Softmax Cross Entropy) and was originally applied in the context of e-commerce to rank products effectively.\n\n###### Examples: Encoder-Decoder / Decoder-based Listwise Re-rankers (Fusion-in-Decoder Architectures)\n\n*   A more recent class of listwise re-rankers leverages encoder–decoder architectures to jointly reason over multiple documents during decoding, rather than relying solely on encoder-side interactions.\n    \n*   While [monoBERT](https://arxiv.org/abs/1910.14424) by Nogueira et al. (2019) and [duoBERT](https://arxiv.org/abs/1910.14424) by Nogueira et al. (2019) rely on traditional cross-encoder architectures, [ListBERT](https://arxiv.org/abs/2206.15198) by Zhuang et al. (2022) and [ListT5](https://arxiv.org/abs/2402.15838) by Yoon et al. (2024) introduce list-level reasoning through different mechanisms. ListBERT remains encoder-only with listwise loss functions, whereas ListT5 employs a Fusion-in-Decoder architecture adapted from T5, which is not a standard cross-encoder. Decoder-based listwise re-rankers are explained below:\n    \n    *   **ListT5** by Yoon et al. (2024), proposed in [ListT5: Listwise Re-ranking with Fusion-in-Decoder Improves Zero-shot Retrieval](https://arxiv.org/abs/2402.15838), advances listwise re-ranking by adapting the Fusion-in-Decoder (FiD) architecture from [T5](https://arxiv.org/abs/1910.10683) by Raffel et al. (2019). Each candidate document is encoded independently together with the query, but the decoder jointly attends over the encoded representations of all candidates to generate relevance-aware outputs, enabling true listwise reasoning at decoding time. This architecture allows interactions across all documents in the candidate list without quadratic encoder costs and has shown strong performance in zero-shot and low-supervision retrieval settings with minimal labeled data.\n        \n    *   **REARANK** by Zhang et al. (2025), introduced in [REARANK: Reasoning Re-ranking Agent via Reinforcement Learning](https://arxiv.org/abs/2505.20046), is an LLM-based **listwise reranking agent** that explicitly reasons about entire candidate sets before producing a ranked ordering. It leverages reinforcement learning and data augmentation to optimize a listwise objective, demonstrating strong performance with relatively few annotated samples and interpretable reasoning steps.\n        \n    *   **Rank-K** by Yang et al. (2025), proposed in [Rank-K: Test-Time Reasoning for Listwise Reranking](https://arxiv.org/abs/2505.14432), prioposes a listwise passage reranking model that leverages reasoning language models at test time to compare and order multiple passages jointly, improving retrieval effectiveness and showing strong multilingual behavior in ranking.\n        \n*   These decoder-based listwise re-rankers differ fundamentally from cross-encoder models like monoBERT and duoBERT: rather than producing independent relevance scores or pairwise comparisons, they perform global reasoning over an entire candidate set during decoding, trading higher memory usage and decoding cost for richer list-level interactions.\n    \n\nA more recent class of listwise re-rankers leverages encoder–decoder architectures to jointly reason over multiple documents during decoding, rather than relying solely on encoder-side interactions.\n\nWhile [monoBERT](https://arxiv.org/abs/1910.14424) by Nogueira et al. (2019) and [duoBERT](https://arxiv.org/abs/1910.14424) by Nogueira et al. (2019) rely on traditional cross-encoder architectures, [ListBERT](https://arxiv.org/abs/2206.15198) by Zhuang et al. (2022) and [ListT5](https://arxiv.org/abs/2402.15838) by Yoon et al. (2024) introduce list-level reasoning through different mechanisms. ListBERT remains encoder-only with listwise loss functions, whereas ListT5 employs a Fusion-in-Decoder architecture adapted from T5, which is not a standard cross-encoder. Decoder-based listwise re-rankers are explained below:\n\n*   **ListT5** by Yoon et al. (2024), proposed in [ListT5: Listwise Re-ranking with Fusion-in-Decoder Improves Zero-shot Retrieval](https://arxiv.org/abs/2402.15838), advances listwise re-ranking by adapting the Fusion-in-Decoder (FiD) architecture from [T5](https://arxiv.org/abs/1910.10683) by Raffel et al. (2019). Each candidate document is encoded independently together with the query, but the decoder jointly attends over the encoded representations of all candidates to generate relevance-aware outputs, enabling true listwise reasoning at decoding time. This architecture allows interactions across all documents in the candidate list without quadratic encoder costs and has shown strong performance in zero-shot and low-supervision retrieval settings with minimal labeled data.\n    \n*   **REARANK** by Zhang et al. (2025), introduced in [REARANK: Reasoning Re-ranking Agent via Reinforcement Learning](https://arxiv.org/abs/2505.20046), is an LLM-based **listwise reranking agent** that explicitly reasons about entire candidate sets before producing a ranked ordering. It leverages reinforcement learning and data augmentation to optimize a listwise objective, demonstrating strong performance with relatively few annotated samples and interpretable reasoning steps.\n    \n*   **Rank-K** by Yang et al. (2025), proposed in [Rank-K: Test-Time Reasoning for Listwise Reranking](https://arxiv.org/abs/2505.14432), prioposes a listwise passage reranking model that leverages reasoning language models at test time to compare and order multiple passages jointly, improving retrieval effectiveness and showing strong multilingual behavior in ranking.\n    \n\n**ListT5** by Yoon et al. (2024), proposed in [ListT5: Listwise Re-ranking with Fusion-in-Decoder Improves Zero-shot Retrieval](https://arxiv.org/abs/2402.15838), advances listwise re-ranking by adapting the Fusion-in-Decoder (FiD) architecture from [T5](https://arxiv.org/abs/1910.10683) by Raffel et al. (2019). Each candidate document is encoded independently together with the query, but the decoder jointly attends over the encoded representations of all candidates to generate relevance-aware outputs, enabling true listwise reasoning at decoding time. This architecture allows interactions across all documents in the candidate list without quadratic encoder costs and has shown strong performance in zero-shot and low-supervision retrieval settings with minimal labeled data.\n\n**REARANK** by Zhang et al. (2025), introduced in [REARANK: Reasoning Re-ranking Agent via Reinforcement Learning](https://arxiv.org/abs/2505.20046), is an LLM-based **listwise reranking agent** that explicitly reasons about entire candidate sets before producing a ranked ordering. It leverages reinforcement learning and data augmentation to optimize a listwise objective, demonstrating strong performance with relatively few annotated samples and interpretable reasoning steps.\n\n**Rank-K** by Yang et al. (2025), proposed in [Rank-K: Test-Time Reasoning for Listwise Reranking](https://arxiv.org/abs/2505.14432), prioposes a listwise passage reranking model that leverages reasoning language models at test time to compare and order multiple passages jointly, improving retrieval effectiveness and showing strong multilingual behavior in ranking.\n\nThese decoder-based listwise re-rankers differ fundamentally from cross-encoder models like monoBERT and duoBERT: rather than producing independent relevance scores or pairwise comparisons, they perform global reasoning over an entire candidate set during decoding, trading higher memory usage and decoding cost for richer list-level interactions.\n\n##### Domain-Specific Adaptations\n\n*   Neural re-rankers can be further specialized through domain-specific adaptation, where models are fine-tuned or pretrained on corpora and relevance judgments drawn from a particular field. This aligns the re-ranker’s representations with domain-specific terminology, document structures, and relevance criteria that differ from general-purpose benchmarks (e.g., legal, healthcare, finance).\n    \n*   For example, **[Legal-BERT](https://arxiv.org/abs/2010.02559)** extends the BERT architecture through pretraining on large legal corpora and can be adapted as a re-ranker for tasks such as legal document ranking and case law search. Domain-aware ranking approaches that customize relevance based on industry semantics have shown improved performance in specialized fields like legal search. Additionally, models like **[Qwen3-Reranker](https://www.siliconflow.com/articles/en/Most-powerful-re-ranking-model-for-legal-documents)** demonstrate how legal-focused re-rankers with long-context capabilities can improve relevance for complex legal document tasks.\n    \n*   In the healthcare domain, dedicated models such as the ones proposed in **[ZeroEntropy Reranker for Healthcare AI](https://www.zeroentropy.dev/articles/best-reranker-healthcare)** provide domain-specific re-ranking tuned to prioritize clinical guidelines, electronic health records, and medical research documents, helping surface the most authoritative and clinically relevant information in RAG workflows.\n    \n*   Domain-specific rerankers are also emerging in finance and compliance applications, where tailored ranking models help improve fraud detection, policy retrieval, and compliance task relevance, demonstrating the broader applicability of specialized re-ranking beyond general semantic similarity.\n    \n*   Similar domain-adapted re-rankers are being developed in technical domains where relevance depends on specialized vocabulary, regulatory context, or evidence standards. In these settings, domain-specific re-ranking helps reduce false positives, surface authoritative sources, and ensure that highly specialized documents are correctly prioritized within the final ranked list.\n    \n\nNeural re-rankers can be further specialized through domain-specific adaptation, where models are fine-tuned or pretrained on corpora and relevance judgments drawn from a particular field. This aligns the re-ranker’s representations with domain-specific terminology, document structures, and relevance criteria that differ from general-purpose benchmarks (e.g., legal, healthcare, finance).\n\nFor example, **[Legal-BERT](https://arxiv.org/abs/2010.02559)** extends the BERT architecture through pretraining on large legal corpora and can be adapted as a re-ranker for tasks such as legal document ranking and case law search. Domain-aware ranking approaches that customize relevance based on industry semantics have shown improved performance in specialized fields like legal search. Additionally, models like **[Qwen3-Reranker](https://www.siliconflow.com/articles/en/Most-powerful-re-ranking-model-for-legal-documents)** demonstrate how legal-focused re-rankers with long-context capabilities can improve relevance for complex legal document tasks.\n\nIn the healthcare domain, dedicated models such as the ones proposed in **[ZeroEntropy Reranker for Healthcare AI](https://www.zeroentropy.dev/articles/best-reranker-healthcare)** provide domain-specific re-ranking tuned to prioritize clinical guidelines, electronic health records, and medical research documents, helping surface the most authoritative and clinically relevant information in RAG workflows.\n\nDomain-specific rerankers are also emerging in finance and compliance applications, where tailored ranking models help improve fraud detection, policy retrieval, and compliance task relevance, demonstrating the broader applicability of specialized re-ranking beyond general semantic similarity.\n\nSimilar domain-adapted re-rankers are being developed in technical domains where relevance depends on specialized vocabulary, regulatory context, or evidence standards. In these settings, domain-specific re-ranking helps reduce false positives, surface authoritative sources, and ensure that highly specialized documents are correctly prioritized within the final ranked list.\n\n#### Instruction-Following Re-ranking\n\n*   A growing frontier in re-ranking is instruction-following re-ranking, which augments neural re-rankers with the ability to condition ranking behavior on natural language instructions. Instead of relying on a fixed notion of relevance learned during training, these models allow relevance criteria to be specified or adjusted at runtime, enabling more flexible and context-aware ranking decisions. This capability is particularly valuable in enterprise and production RAG systems where relevance often depends on business rules, trust constraints, or temporal considerations rather than semantic similarity alone.\n    \n*   Instruction-following re-rankers are typically built on top of large language models or instruction-tuned cross-encoders, leveraging advances in instruction tuning and alignment. By treating ranking as a controllable task, they bridge the gap between traditional LTR objectives and prompt-based control paradigms discussed in work on instruction-tuned models such as [Instruction Tuning](https://arxiv.org/abs/2109.01652) and [FLAN](https://arxiv.org/abs/2210.11416).\n    \n*   **Examples of Natural Language Instructions**:\n    \n    *   “Prioritize internal documentation over third-party sources. Favor the most recent information.”\n    *   “Disregard news summaries. Emphasize detailed technical reports from trusted analysts.”\n    *   “Prefer primary sources and official standards documents over community blog posts.”\n*   **Advantages**:\n    \n    *   **Dynamic Relevance Modeling**: Instructions enable runtime control over what relevance means, allowing the same retrieved candidate set to be re-ranked differently depending on user intent, task context, or organizational policy.\n    *   **Conflict Resolution**: Explicit instructions make it possible to resolve contradictory or overlapping sources by enforcing prioritization rules such as recency, authority, or provenance, complementing purely learned relevance signals.\n    *   **Prompt Optimization**: By ensuring that higher-quality and policy-compliant content appears earlier in the ranked list, instruction-following re-ranking helps maximize the utility of the limited context window, where the language model’s attention is most concentrated.\n*   **Implementation and Deployment**:\n    \n    *   Instruction-following re-rankers are commonly deployed as a post-retrieval scoring layer that operates on a small shortlist of candidate documents. They are often exposed as standalone APIs or integrated modules within RAG pipelines, similar to conventional cross-encoder re-rankers but with an additional instruction input.\n    *   A notable example is Contextual AI’s system described in [Introducing the World’s First Instruction-Following Reranker](https://contextual.ai/blog/introducing-instruction-following-reranker/), which demonstrates how natural language instructions can be combined with neural re-ranking to enforce enterprise-specific relevance constraints in real-world deployments.\n    *   Instruction-following re-rankers can be combined with other techniques such as retriever ensembling, metadata-based filtering, or late chunking, effectively acting as the final curation layer before documents are assembled into the prompt sent to the language model.\n\nA growing frontier in re-ranking is instruction-following re-ranking, which augments neural re-rankers with the ability to condition ranking behavior on natural language instructions. Instead of relying on a fixed notion of relevance learned during training, these models allow relevance criteria to be specified or adjusted at runtime, enabling more flexible and context-aware ranking decisions. This capability is particularly valuable in enterprise and production RAG systems where relevance often depends on business rules, trust constraints, or temporal considerations rather than semantic similarity alone.\n\nInstruction-following re-rankers are typically built on top of large language models or instruction-tuned cross-encoders, leveraging advances in instruction tuning and alignment. By treating ranking as a controllable task, they bridge the gap between traditional LTR objectives and prompt-based control paradigms discussed in work on instruction-tuned models such as [Instruction Tuning](https://arxiv.org/abs/2109.01652) and [FLAN](https://arxiv.org/abs/2210.11416).\n\n**Examples of Natural Language Instructions**:\n\n*   “Prioritize internal documentation over third-party sources. Favor the most recent information.”\n*   “Disregard news summaries. Emphasize detailed technical reports from trusted analysts.”\n*   “Prefer primary sources and official standards documents over community blog posts.”\n\n**Advantages**:\n\n*   **Dynamic Relevance Modeling**: Instructions enable runtime control over what relevance means, allowing the same retrieved candidate set to be re-ranked differently depending on user intent, task context, or organizational policy.\n*   **Conflict Resolution**: Explicit instructions make it possible to resolve contradictory or overlapping sources by enforcing prioritization rules such as recency, authority, or provenance, complementing purely learned relevance signals.\n*   **Prompt Optimization**: By ensuring that higher-quality and policy-compliant content appears earlier in the ranked list, instruction-following re-ranking helps maximize the utility of the limited context window, where the language model’s attention is most concentrated.\n\n**Implementation and Deployment**:\n\n*   Instruction-following re-rankers are commonly deployed as a post-retrieval scoring layer that operates on a small shortlist of candidate documents. They are often exposed as standalone APIs or integrated modules within RAG pipelines, similar to conventional cross-encoder re-rankers but with an additional instruction input.\n*   A notable example is Contextual AI’s system described in [Introducing the World’s First Instruction-Following Reranker](https://contextual.ai/blog/introducing-instruction-following-reranker/), which demonstrates how natural language instructions can be combined with neural re-ranking to enforce enterprise-specific relevance constraints in real-world deployments.\n*   Instruction-following re-rankers can be combined with other techniques such as retriever ensembling, metadata-based filtering, or late chunking, effectively acting as the final curation layer before documents are assembled into the prompt sent to the language model.\n\n#### Metadata-Based Re-rankers\n\n*   Metadata-based re-rankers incorporate structured, non-textual signals into the re-ranking stage to bias results toward documents that satisfy explicit criteria such as recency, authority, source type, or document provenance. Rather than replacing neural relevance scores, these signals are typically combined with semantic scores to produce a final ranking that better reflects practical relevance constraints in real-world systems.\n    \n*   Common metadata signals include timestamps, source identifiers, publisher reputation, document type, access level, and usage statistics. These features are especially valuable in enterprise and regulated settings, where the most semantically relevant document may not be the most trustworthy or up to date. This idea aligns with classical ranking work that blends multiple relevance signals, such as BM25 variants with field or freshness boosts, and modern hybrid ranking systems discussed in [Learning to Rank for Information Retrieval](https://link.springer.com/book/10.1007/978-3-642-14267-3) by Tie-Yan Liu.\n    \n*   **Typical Re-ranking Criteria**:\n    \n    *   **Recency**: Favor newer documents using timestamp-based decay functions, particularly important for fast-changing domains such as news, finance, or internal documentation.\n    *   **Authority and Source Trust**: Prefer documents from curated or authoritative sources (e.g., internal wikis, official standards bodies) over third-party or user-generated content.\n    *   **Document Type and Provenance**: Boost primary sources, specifications, or policies while demoting summaries, duplicates, or low-signal content.\n*   In practice, metadata-based re-ranking is often implemented using rule-based or learned scoring functions layered on top of neural relevance scores. Search platforms such as Elasticsearch and OpenSearch expose this pattern through mechanisms like Elastic’s [function score queries](https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-function-score-query.html), enabling explicit weighting of freshness, popularity, or source fields during re-ranking.\n    \n*   Metadata-based approaches are frequently combined with neural re-rankers rather than used in isolation. For example, a cross-encoder or instruction-following re-ranker may first score semantic relevance, after which metadata-based adjustments enforce hard or soft constraints on ordering. This hybrid strategy reflects best practices described in modern RAG system design discussions, including [Introducing the hybrid index to enable keyword-aware semantic search](https://www.pinecone.io/learn/hybrid-search/) by Pinecone.\n    \n*   Within RAG pipelines, metadata-based re-rankers often serve as a policy-enforcement layer, ensuring compliance with business rules and trust requirements while preserving the strengths of neural relevance modeling. When used alongside instruction-following re-rankers, metadata signals can either be encoded directly into instructions or applied as an explicit post-processing step, providing clear separation between semantic relevance and governance constraints.\n    \n\nMetadata-based re-rankers incorporate structured, non-textual signals into the re-ranking stage to bias results toward documents that satisfy explicit criteria such as recency, authority, source type, or document provenance. Rather than replacing neural relevance scores, these signals are typically combined with semantic scores to produce a final ranking that better reflects practical relevance constraints in real-world systems.\n\nCommon metadata signals include timestamps, source identifiers, publisher reputation, document type, access level, and usage statistics. These features are especially valuable in enterprise and regulated settings, where the most semantically relevant document may not be the most trustworthy or up to date. This idea aligns with classical ranking work that blends multiple relevance signals, such as BM25 variants with field or freshness boosts, and modern hybrid ranking systems discussed in [Learning to Rank for Information Retrieval](https://link.springer.com/book/10.1007/978-3-642-14267-3) by Tie-Yan Liu.\n\n**Typical Re-ranking Criteria**:\n\n*   **Recency**: Favor newer documents using timestamp-based decay functions, particularly important for fast-changing domains such as news, finance, or internal documentation.\n*   **Authority and Source Trust**: Prefer documents from curated or authoritative sources (e.g., internal wikis, official standards bodies) over third-party or user-generated content.\n*   **Document Type and Provenance**: Boost primary sources, specifications, or policies while demoting summaries, duplicates, or low-signal content.\n\nIn practice, metadata-based re-ranking is often implemented using rule-based or learned scoring functions layered on top of neural relevance scores. Search platforms such as Elasticsearch and OpenSearch expose this pattern through mechanisms like Elastic’s [function score queries](https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-function-score-query.html), enabling explicit weighting of freshness, popularity, or source fields during re-ranking.\n\nMetadata-based approaches are frequently combined with neural re-rankers rather than used in isolation. For example, a cross-encoder or instruction-following re-ranker may first score semantic relevance, after which metadata-based adjustments enforce hard or soft constraints on ordering. This hybrid strategy reflects best practices described in modern RAG system design discussions, including [Introducing the hybrid index to enable keyword-aware semantic search](https://www.pinecone.io/learn/hybrid-search/) by Pinecone.\n\nWithin RAG pipelines, metadata-based re-rankers often serve as a policy-enforcement layer, ensuring compliance with business rules and trust requirements while preserving the strengths of neural relevance modeling. When used alongside instruction-following re-rankers, metadata signals can either be encoded directly into instructions or applied as an explicit post-processing step, providing clear separation between semantic relevance and governance constraints.",
    "order": 4,
    "orderInChapter": 3,
    "difficulty": 4,
    "estimatedMinutes": 26,
    "tags": [
      "nlpllms",
      "transformer",
      "attention",
      "embedding",
      "bert",
      "llm",
      "reinforcement learning",
      "optimization"
    ],
    "metadata": {
      "hasCode": true,
      "hasMath": true,
      "hasImages": true,
      "wordCount": 5142,
      "contentLength": 63579
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#re-ranking",
    "scrapedAt": "2025-12-28T11:54:28.276Z"
  },
  {
    "id": "ai-RAG-response-generation-synthesis-5",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "Building a RAG Pipeline",
    "title": "Response Generation / Synthesis",
    "subtitle": "Building a RAG Pipeline",
    "contentHtml": "<ul>\n  <li>The last step of the RAG pipeline is to generate responses back to the user. In this step, the model synthesizes the retrieved information with its pre-trained knowledge to generate coherent and contextually relevant responses. This process involves integrating the insights gleaned from various sources, ensuring accuracy and relevance, and crafting a response that is not only informative but also aligns with the user’s original query, maintaining a natural and conversational tone.</li>\n  <li>Note that while creating the expanded prompt (with the retrieved top-<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-91-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-941\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-942\"><span class=\"mi\" id=\"MathJax-Span-943\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-91\">k</script> chunks) for an LLM to make an informed response generation, a strategic placement of vital information at the beginning or end of input sequences could enhance the RAG system’s effectiveness and thus make the system more performant. This is summarized in the paper below.</li>\n</ul>\n<h4 id=\"lost-in-the-middle-how-language-models-use-long-contexts\"><a href=\"https://arxiv.org/abs/2302.12345\">Lost in the Middle: How Language Models Use Long Contexts</a></h4>\n<ul>\n  <li>While recent language models have the ability to take long contexts as input, relatively little is known about how well the language models use longer context.</li>\n  <li>This paper by Liu et al. from Percy Liang’s lab at Stanford, UC Berkeley, and Samaya AI analyzes language model performance on two tasks that require identifying relevant information within their input contexts: multi-document question answering and key-value retrieval. Put simply, they analyze and evaluate how LLMs use the context by identifying relevant information within it.</li>\n  <li>They tested open-source (MPT-30B-Instruct, LongChat-13B) and closed-source (OpenAI’s GPT-3.5-Turbo and Anthropic’s Claude 1.3) models. They used multi-document question-answering where the context included multiple retrieved documents and one correct answer, whose position was shuffled around. Key-value pair retrieval was carried out to analyze if longer contexts impact performance.</li>\n  <li>They find that performance is often highest when relevant information occurs at the beginning or end of the input context, and significantly degrades when models must access relevant information in the middle of long contexts. In other words, their findings basically suggest that Retrieval-Augmentation (RAG) performance suffers when the relevant information to answer a query is presented in the middle of the context window with strong biases towards the beginning and the end of it.</li>\n  <li>A summary of their learnings is as follows:\n    <ul>\n      <li>Best performance when the relevant information is at the beginning.</li>\n      <li>Performance decreases with an increase in context length.</li>\n      <li>Too many retrieved documents harm performance.</li>\n      <li>Improving the retrieval and prompt creation step with a ranking stage could potentially boost performance by up to 20%.</li>\n      <li>Extended-context models (GPT-3.5-Turbo vs. GPT-3.5-Turbo (16K)) are not better if the prompt fits the original context.</li>\n    </ul>\n  </li>\n  <li>Considering that RAG retrieves information from an external database – which most commonly contains longer texts that are split into chunks. Even with split chunks, context windows get pretty large very quickly, at least much larger than a “normal” question or instruction. Furthermore, performance substantially decreases as the input context grows longer, even for explicitly long-context models. Their analysis provides a better understanding of how language models use their input context and provides new evaluation protocols for future long-context models.</li>\n  <li>“There is no specific inductive bias in transformer-based LLM architectures that explains why the retrieval performance should be worse for text in the middle of the document. I suspect it is all because of the training data and how humans write: the most important information is usually in the beginning or the end (think paper Abstracts and Conclusion sections), and it’s then how LLMs parameterize the attention weights during training.” <a href=\"https://www.linkedin.com/feed/update/urn:li:activity:7083427280605089792/\">(source)</a></li>\n  <li>In other words, human text artifacts are often constructed in a way where the beginning and the end of a long text matter the most which could be a potential explanation to the characteristics observed in this work.</li>\n  <li>You can also model this with the lens of two popular cognitive biases that humans face (primacy and recency bias), as in the following figure <a href=\"https://www.linkedin.com/feed/update/urn:li:activity:7083438672196362240/\">(source)</a>.</li>\n</ul>\n<ul>\n      <li>Best performance when the relevant information is at the beginning.</li>\n      <li>Performance decreases with an increase in context length.</li>\n      <li>Too many retrieved documents harm performance.</li>\n      <li>Improving the retrieval and prompt creation step with a ranking stage could potentially boost performance by up to 20%.</li>\n      <li>Extended-context models (GPT-3.5-Turbo vs. GPT-3.5-Turbo (16K)) are not better if the prompt fits the original context.</li>\n    </ul>\n<p><img src=\"../../../images/papers/LostMiddle2.jpeg\" alt=\"\"></p>\n<ul>\n  <li>The final conclusion is that combining retrieval with ranking (as in recommender systems) should yield the best performance in RAG for question answering.</li>\n  <li>The following figure <a href=\"https://www.linkedin.com/feed/update/urn:li:activity:7083427280605089792/\">(source)</a> shows an overview of the idea proposed in the paper: “LLMs are better at using info at beginning or end of input context”.</li>\n</ul>\n<p><img src=\"../../../images/papers/LostMiddle1.jpg\" alt=\"\"></p>\n<ul>\n  <li>The following figure from the paper illustrates the effect of changing the position of relevant information (document containing the answer) on multidocument question answering performance. Lower positions are closer to the start of the input context. Performance is generally highest when relevant information is positioned at the very start or very end of the context, and rapidly degrades when models must reason over information in the middle of their input context.</li>\n</ul>\n<p><img src=\"../../../images/papers/LostMiddle.jpg\" alt=\"\"></p>\n<h4 id=\"the-needle-in-a-haystack-test\">The “Needle in a Haystack” Test</h4>\n<ul>\n  <li>To understand the in-context retrieval ability of long-context LLMs over various parts of their prompt, a simple ‘needle in a haystack’ analysis could be conducted. This method involves embedding specific, targeted information (the ‘needle’) within a larger, more complex body of text (the ‘haystack’). The purpose is to test the LLM’s ability to identify and utilize this specific piece of information amidst a deluge of other data.</li>\n  <li>In practical terms, the analysis could involve inserting a unique fact or data point into a lengthy, seemingly unrelated text. The LLM would then be tasked with tasks or queries that require it to recall or apply this embedded information. This setup mimics real-world situations where essential details are often buried within extensive content, and the ability to retrieve such details is crucial.</li>\n  <li>The experiment could be structured to assess various aspects of the LLM’s performance. For instance, the placement of the ‘needle’ could be varied—early, middle, or late in the text—to see if the model’s retrieval ability changes based on information location. Additionally, the complexity of the surrounding ‘haystack’ can be modified to test the LLM’s performance under varying degrees of contextual difficulty. By analyzing how well the LLM performs in these scenarios, insights can be gained into its in-context retrieval capabilities and potential areas for improvement.</li>\n  <li>This can be accomplished using the <a href=\"https://github.com/gkamradt/LLMTest_NeedleInAHaystack\">Needle In A Haystack</a> library. The following plot shows OpenAI’s GPT-4-128K’s (top) and (bottom) performance with varying context length.</li>\n</ul>\n<p><img src=\"/primers/ai/assets/RAG/GPT4_haystack.jpg\" alt=\"\"></p>\n<p><img src=\"/primers/ai/assets/RAG/Claude_haystack.jpg\" alt=\"\"></p>\n<ul>\n  <li>The following figure <a href=\"https://www.anthropic.com/index/claude-2-1\">(source)</a> shows Claude 2.1’s long context question answering errors based on the areas of the prompt context length. On an average, Claude 2.1 demonstrated a 30% reduction in incorrect answers compared to Claude 2.</li>\n</ul>\n<p><img src=\"/primers/ai/assets/RAG/Claude_context.jpg\" alt=\"\"></p>\n<ul>\n  <li>However, in Anthropic’s <a href=\"https://www.anthropic.com/index/claude-2-1-prompting\">Long context prompting for Claude 2.1</a> blog, Anthropic noted that adding “Here is the most relevant sentence in the context:” to the start of Claude’s response raised the score from 27% to 98% on the original evaluation! The figure below from the blog shows that Claude 2.1’s performance when retrieving an individual sentence across its full 200K token context window. This experiment uses the aforementioned prompt technique to guide Claude in recalling the most relevant sentence.</li>\n</ul>\n<p><img src=\"/primers/ai/assets/RAG/Claude_haystack1.jpg\" alt=\"\"></p>",
    "contentMarkdown": "*   The last step of the RAG pipeline is to generate responses back to the user. In this step, the model synthesizes the retrieved information with its pre-trained knowledge to generate coherent and contextually relevant responses. This process involves integrating the insights gleaned from various sources, ensuring accuracy and relevance, and crafting a response that is not only informative but also aligns with the user’s original query, maintaining a natural and conversational tone.\n*   Note that while creating the expanded prompt (with the retrieved top-kkk chunks) for an LLM to make an informed response generation, a strategic placement of vital information at the beginning or end of input sequences could enhance the RAG system’s effectiveness and thus make the system more performant. This is summarized in the paper below.\n\n#### [Lost in the Middle: How Language Models Use Long Contexts](https://arxiv.org/abs/2302.12345)\n\n*   While recent language models have the ability to take long contexts as input, relatively little is known about how well the language models use longer context.\n*   This paper by Liu et al. from Percy Liang’s lab at Stanford, UC Berkeley, and Samaya AI analyzes language model performance on two tasks that require identifying relevant information within their input contexts: multi-document question answering and key-value retrieval. Put simply, they analyze and evaluate how LLMs use the context by identifying relevant information within it.\n*   They tested open-source (MPT-30B-Instruct, LongChat-13B) and closed-source (OpenAI’s GPT-3.5-Turbo and Anthropic’s Claude 1.3) models. They used multi-document question-answering where the context included multiple retrieved documents and one correct answer, whose position was shuffled around. Key-value pair retrieval was carried out to analyze if longer contexts impact performance.\n*   They find that performance is often highest when relevant information occurs at the beginning or end of the input context, and significantly degrades when models must access relevant information in the middle of long contexts. In other words, their findings basically suggest that Retrieval-Augmentation (RAG) performance suffers when the relevant information to answer a query is presented in the middle of the context window with strong biases towards the beginning and the end of it.\n*   A summary of their learnings is as follows:\n    *   Best performance when the relevant information is at the beginning.\n    *   Performance decreases with an increase in context length.\n    *   Too many retrieved documents harm performance.\n    *   Improving the retrieval and prompt creation step with a ranking stage could potentially boost performance by up to 20%.\n    *   Extended-context models (GPT-3.5-Turbo vs. GPT-3.5-Turbo (16K)) are not better if the prompt fits the original context.\n*   Considering that RAG retrieves information from an external database – which most commonly contains longer texts that are split into chunks. Even with split chunks, context windows get pretty large very quickly, at least much larger than a “normal” question or instruction. Furthermore, performance substantially decreases as the input context grows longer, even for explicitly long-context models. Their analysis provides a better understanding of how language models use their input context and provides new evaluation protocols for future long-context models.\n*   “There is no specific inductive bias in transformer-based LLM architectures that explains why the retrieval performance should be worse for text in the middle of the document. I suspect it is all because of the training data and how humans write: the most important information is usually in the beginning or the end (think paper Abstracts and Conclusion sections), and it’s then how LLMs parameterize the attention weights during training.” [(source)](https://www.linkedin.com/feed/update/urn:li:activity:7083427280605089792/)\n*   In other words, human text artifacts are often constructed in a way where the beginning and the end of a long text matter the most which could be a potential explanation to the characteristics observed in this work.\n*   You can also model this with the lens of two popular cognitive biases that humans face (primacy and recency bias), as in the following figure [(source)](https://www.linkedin.com/feed/update/urn:li:activity:7083438672196362240/).\n\n*   Best performance when the relevant information is at the beginning.\n*   Performance decreases with an increase in context length.\n*   Too many retrieved documents harm performance.\n*   Improving the retrieval and prompt creation step with a ranking stage could potentially boost performance by up to 20%.\n*   Extended-context models (GPT-3.5-Turbo vs. GPT-3.5-Turbo (16K)) are not better if the prompt fits the original context.\n\n![](../../../images/papers/LostMiddle2.jpeg)\n\n*   The final conclusion is that combining retrieval with ranking (as in recommender systems) should yield the best performance in RAG for question answering.\n*   The following figure [(source)](https://www.linkedin.com/feed/update/urn:li:activity:7083427280605089792/) shows an overview of the idea proposed in the paper: “LLMs are better at using info at beginning or end of input context”.\n\n![](../../../images/papers/LostMiddle1.jpg)\n\n*   The following figure from the paper illustrates the effect of changing the position of relevant information (document containing the answer) on multidocument question answering performance. Lower positions are closer to the start of the input context. Performance is generally highest when relevant information is positioned at the very start or very end of the context, and rapidly degrades when models must reason over information in the middle of their input context.\n\n![](../../../images/papers/LostMiddle.jpg)\n\n#### The “Needle in a Haystack” Test\n\n*   To understand the in-context retrieval ability of long-context LLMs over various parts of their prompt, a simple ‘needle in a haystack’ analysis could be conducted. This method involves embedding specific, targeted information (the ‘needle’) within a larger, more complex body of text (the ‘haystack’). The purpose is to test the LLM’s ability to identify and utilize this specific piece of information amidst a deluge of other data.\n*   In practical terms, the analysis could involve inserting a unique fact or data point into a lengthy, seemingly unrelated text. The LLM would then be tasked with tasks or queries that require it to recall or apply this embedded information. This setup mimics real-world situations where essential details are often buried within extensive content, and the ability to retrieve such details is crucial.\n*   The experiment could be structured to assess various aspects of the LLM’s performance. For instance, the placement of the ‘needle’ could be varied—early, middle, or late in the text—to see if the model’s retrieval ability changes based on information location. Additionally, the complexity of the surrounding ‘haystack’ can be modified to test the LLM’s performance under varying degrees of contextual difficulty. By analyzing how well the LLM performs in these scenarios, insights can be gained into its in-context retrieval capabilities and potential areas for improvement.\n*   This can be accomplished using the [Needle In A Haystack](https://github.com/gkamradt/LLMTest_NeedleInAHaystack) library. The following plot shows OpenAI’s GPT-4-128K’s (top) and (bottom) performance with varying context length.\n\n![](/primers/ai/assets/RAG/GPT4_haystack.jpg)\n\n![](/primers/ai/assets/RAG/Claude_haystack.jpg)\n\n*   The following figure [(source)](https://www.anthropic.com/index/claude-2-1) shows Claude 2.1’s long context question answering errors based on the areas of the prompt context length. On an average, Claude 2.1 demonstrated a 30% reduction in incorrect answers compared to Claude 2.\n\n![](/primers/ai/assets/RAG/Claude_context.jpg)\n\n*   However, in Anthropic’s [Long context prompting for Claude 2.1](https://www.anthropic.com/index/claude-2-1-prompting) blog, Anthropic noted that adding “Here is the most relevant sentence in the context:” to the start of Claude’s response raised the score from 27% to 98% on the original evaluation! The figure below from the blog shows that Claude 2.1’s performance when retrieving an individual sentence across its full 200K token context window. This experiment uses the aforementioned prompt technique to guide Claude in recalling the most relevant sentence.\n\n![](/primers/ai/assets/RAG/Claude_haystack1.jpg)",
    "order": 5,
    "orderInChapter": 4,
    "difficulty": 3,
    "estimatedMinutes": 7,
    "tags": [
      "nlpllms",
      "transformer",
      "attention",
      "embedding",
      "gpt",
      "llm"
    ],
    "metadata": {
      "hasCode": false,
      "hasMath": true,
      "hasImages": true,
      "wordCount": 1204,
      "contentLength": 10527
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#response-generation-/-synthesis",
    "scrapedAt": "2025-12-28T11:54:28.276Z"
  },
  {
    "id": "ai-RAG-embedding-the-latest-user-turn-only-6",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "RAG in Multi-Turn Chatbots: Embedding Queries for Retrieval",
    "title": "Embedding the Latest User Turn Only",
    "subtitle": "RAG in Multi-Turn Chatbots: Embedding Queries for Retrieval",
    "contentHtml": "<ul>\n  <li>The simplest approach is to embed just the latest user message. For example, if a user says, “What are the symptoms of Lyme disease?”, that exact sentence is passed to the retriever for embedding.</li>\n  <li><strong>Pros</strong>:\n    <ul>\n      <li>Fast and computationally cheap.</li>\n      <li>Reduces the risk of embedding irrelevant or stale context.</li>\n    </ul>\n  </li>\n  <li><strong>Cons</strong>:\n    <ul>\n      <li>Ignores conversational context and prior turns, which may contain critical disambiguating details (e.g., “Is it common in dogs?” following a discussion about pets).</li>\n    </ul>\n  </li>\n</ul>\n<ul>\n      <li>Fast and computationally cheap.</li>\n      <li>Reduces the risk of embedding irrelevant or stale context.</li>\n    </ul>\n<ul>\n      <li>Ignores conversational context and prior turns, which may contain critical disambiguating details (e.g., “Is it common in dogs?” following a discussion about pets).</li>\n    </ul>",
    "contentMarkdown": "*   The simplest approach is to embed just the latest user message. For example, if a user says, “What are the symptoms of Lyme disease?”, that exact sentence is passed to the retriever for embedding.\n*   **Pros**:\n    *   Fast and computationally cheap.\n    *   Reduces the risk of embedding irrelevant or stale context.\n*   **Cons**:\n    *   Ignores conversational context and prior turns, which may contain critical disambiguating details (e.g., “Is it common in dogs?” following a discussion about pets).\n\n*   Fast and computationally cheap.\n*   Reduces the risk of embedding irrelevant or stale context.\n\n*   Ignores conversational context and prior turns, which may contain critical disambiguating details (e.g., “Is it common in dogs?” following a discussion about pets).",
    "order": 6,
    "orderInChapter": 1,
    "difficulty": 2,
    "estimatedMinutes": 1,
    "tags": [
      "nlpllms",
      "embedding"
    ],
    "metadata": {
      "hasCode": false,
      "hasMath": false,
      "hasImages": false,
      "wordCount": 117,
      "contentLength": 962
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#embedding-the-latest-user-turn-only",
    "scrapedAt": "2025-12-28T11:54:28.276Z"
  },
  {
    "id": "ai-RAG-embedding-concatenated-recent-turns-truncated-dial-7",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "RAG in Multi-Turn Chatbots: Embedding Queries for Retrieval",
    "title": "Embedding Concatenated Recent Turns (Truncated Dialogue History)",
    "subtitle": "RAG in Multi-Turn Chatbots: Embedding Queries for Retrieval",
    "contentHtml": "<ul>\n  <li>A more nuanced approach involves embedding the current user message along with a sliding window of recent turns (usually alternating user and assistant messages).</li>\n  <li>For example:\n    <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code7\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code7\">User: My dog has been acting strange lately.\nAssistant: Can you describe the symptoms?\nUser: He’s tired, limping, and has a fever. Could it be Lyme disease?\n</code></pre></div>    </div>\n    <ul>\n      <li>The retriever input would include all or part of the above.</li>\n    </ul>\n  </li>\n  <li><strong>Pros</strong>:\n    <ul>\n      <li>Preserves immediate context that can significantly improve retrieval relevance.</li>\n      <li>Especially useful for resolving pronouns and follow-up queries.</li>\n    </ul>\n  </li>\n  <li><strong>Cons</strong>:\n    <ul>\n      <li>Can dilute the focus of the query if too many irrelevant prior turns are included.</li>\n      <li>Risk of exceeding input length limits for embedding models.</li>\n    </ul>\n  </li>\n</ul>\n<pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code7\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code7\">User: My dog has been acting strange lately.\nAssistant: Can you describe the symptoms?\nUser: He’s tired, limping, and has a fever. Could it be Lyme disease?\n</code></pre>\n<ul>\n      <li>The retriever input would include all or part of the above.</li>\n    </ul>\n<ul>\n      <li>Preserves immediate context that can significantly improve retrieval relevance.</li>\n      <li>Especially useful for resolving pronouns and follow-up queries.</li>\n    </ul>\n<ul>\n      <li>Can dilute the focus of the query if too many irrelevant prior turns are included.</li>\n      <li>Risk of exceeding input length limits for embedding models.</li>\n    </ul>",
    "contentMarkdown": "*   A more nuanced approach involves embedding the current user message along with a sliding window of recent turns (usually alternating user and assistant messages).\n*   For example:\n    \n    ![](https://aman.ai/images/copy.png)\n    \n    `User: My dog has been acting strange lately. Assistant: Can you describe the symptoms? User: He’s tired, limping, and has a fever. Could it be Lyme disease?`\n    \n    *   The retriever input would include all or part of the above.\n*   **Pros**:\n    *   Preserves immediate context that can significantly improve retrieval relevance.\n    *   Especially useful for resolving pronouns and follow-up queries.\n*   **Cons**:\n    *   Can dilute the focus of the query if too many irrelevant prior turns are included.\n    *   Risk of exceeding input length limits for embedding models.\n\n![](https://aman.ai/images/copy.png)\n\n`User: My dog has been acting strange lately. Assistant: Can you describe the symptoms? User: He’s tired, limping, and has a fever. Could it be Lyme disease?`\n\n*   The retriever input would include all or part of the above.\n\n*   Preserves immediate context that can significantly improve retrieval relevance.\n*   Especially useful for resolving pronouns and follow-up queries.\n\n*   Can dilute the focus of the query if too many irrelevant prior turns are included.\n*   Risk of exceeding input length limits for embedding models.",
    "order": 7,
    "orderInChapter": 2,
    "difficulty": 3,
    "estimatedMinutes": 2,
    "tags": [
      "nlpllms",
      "embedding"
    ],
    "metadata": {
      "hasCode": true,
      "hasMath": false,
      "hasImages": true,
      "wordCount": 202,
      "contentLength": 2212
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#embedding-concatenated-recent-turns-(truncated-dialogue-history)",
    "scrapedAt": "2025-12-28T11:54:28.276Z"
  },
  {
    "id": "ai-RAG-embedding-a-condensed-or-summarized-history-8",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "RAG in Multi-Turn Chatbots: Embedding Queries for Retrieval",
    "title": "Embedding a Condensed or Summarized History",
    "subtitle": "RAG in Multi-Turn Chatbots: Embedding Queries for Retrieval",
    "contentHtml": "<ul>\n  <li>In this strategy, prior turns are summarized into a condensed form before concatenation with the current turn. This reduces token count while preserving key context.</li>\n  <li>Can be achieved using simple heuristics, hand-written rules, or another lightweight LLM summarization pass.</li>\n  <li>For example:\n    <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code8\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code8\">Condensed history: The user is concerned about their dog's health, showing signs of fatigue and limping.\nCurrent query: Could it be Lyme disease?\n</code></pre></div>    </div>\n    <ul>\n      <li>Embed the concatenated string: “The user is concerned… Could it be Lyme disease?”</li>\n    </ul>\n  </li>\n  <li><strong>Pros</strong>:\n    <ul>\n      <li>Retains relevant prior context while minimizing noise.</li>\n      <li>Helps improve retrieval accuracy for ambiguous follow-up questions.</li>\n    </ul>\n  </li>\n  <li><strong>Cons</strong>:\n    <ul>\n      <li>Requires additional processing and potential summarization latency.</li>\n      <li>Summarization quality can affect retrieval quality.</li>\n    </ul>\n  </li>\n</ul>\n<pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code8\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code8\">Condensed history: The user is concerned about their dog's health, showing signs of fatigue and limping.\nCurrent query: Could it be Lyme disease?\n</code></pre>\n<ul>\n      <li>Embed the concatenated string: “The user is concerned… Could it be Lyme disease?”</li>\n    </ul>\n<ul>\n      <li>Retains relevant prior context while minimizing noise.</li>\n      <li>Helps improve retrieval accuracy for ambiguous follow-up questions.</li>\n    </ul>\n<ul>\n      <li>Requires additional processing and potential summarization latency.</li>\n      <li>Summarization quality can affect retrieval quality.</li>\n    </ul>",
    "contentMarkdown": "*   In this strategy, prior turns are summarized into a condensed form before concatenation with the current turn. This reduces token count while preserving key context.\n*   Can be achieved using simple heuristics, hand-written rules, or another lightweight LLM summarization pass.\n*   For example:\n    \n    ![](https://aman.ai/images/copy.png)\n    \n    `Condensed history: The user is concerned about their dog's health, showing signs of fatigue and limping. Current query: Could it be Lyme disease?`\n    \n    *   Embed the concatenated string: “The user is concerned… Could it be Lyme disease?”\n*   **Pros**:\n    *   Retains relevant prior context while minimizing noise.\n    *   Helps improve retrieval accuracy for ambiguous follow-up questions.\n*   **Cons**:\n    *   Requires additional processing and potential summarization latency.\n    *   Summarization quality can affect retrieval quality.\n\n![](https://aman.ai/images/copy.png)\n\n`Condensed history: The user is concerned about their dog's health, showing signs of fatigue and limping. Current query: Could it be Lyme disease?`\n\n*   Embed the concatenated string: “The user is concerned… Could it be Lyme disease?”\n\n*   Retains relevant prior context while minimizing noise.\n*   Helps improve retrieval accuracy for ambiguous follow-up questions.\n\n*   Requires additional processing and potential summarization latency.\n*   Summarization quality can affect retrieval quality.",
    "order": 8,
    "orderInChapter": 3,
    "difficulty": 3,
    "estimatedMinutes": 1,
    "tags": [
      "nlpllms",
      "llm"
    ],
    "metadata": {
      "hasCode": true,
      "hasMath": false,
      "hasImages": true,
      "wordCount": 188,
      "contentLength": 2268
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#embedding-a-condensed-or-summarized-history",
    "scrapedAt": "2025-12-28T11:54:28.276Z"
  },
  {
    "id": "ai-RAG-embedding-structured-dialogue-state-9",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "RAG in Multi-Turn Chatbots: Embedding Queries for Retrieval",
    "title": "Embedding Structured Dialogue State",
    "subtitle": "RAG in Multi-Turn Chatbots: Embedding Queries for Retrieval",
    "contentHtml": "<ul>\n  <li>This approach formalizes the conversation history into a structured format (like intent, entities, or user goals), which is then appended to the latest query before embedding.</li>\n  <li>For instance:\n    <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code9\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code9\">[Intent: Diagnose pet illness] [Entity: Dog] [Symptoms: fatigue, limping, fever]\nQuery: Could it be Lyme disease?\n</code></pre></div>    </div>\n  </li>\n  <li><strong>Pros</strong>:\n    <ul>\n      <li>Allows precision targeting of relevant documents, especially in domain-specific applications.</li>\n      <li>Supports advanced reasoning by aligning with KBs or ontology-driven retrieval.</li>\n    </ul>\n  </li>\n  <li><strong>Cons</strong>:\n    <ul>\n      <li>Requires reliable NLU and state-tracking pipelines.</li>\n      <li>Adds system complexity.</li>\n    </ul>\n  </li>\n</ul>\n<pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code9\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code9\">[Intent: Diagnose pet illness] [Entity: Dog] [Symptoms: fatigue, limping, fever]\nQuery: Could it be Lyme disease?\n</code></pre>\n<ul>\n      <li>Allows precision targeting of relevant documents, especially in domain-specific applications.</li>\n      <li>Supports advanced reasoning by aligning with KBs or ontology-driven retrieval.</li>\n    </ul>\n<ul>\n      <li>Requires reliable NLU and state-tracking pipelines.</li>\n      <li>Adds system complexity.</li>\n    </ul>",
    "contentMarkdown": "*   This approach formalizes the conversation history into a structured format (like intent, entities, or user goals), which is then appended to the latest query before embedding.\n*   For instance:\n    \n    ![](https://aman.ai/images/copy.png)\n    \n    `[Intent: Diagnose pet illness] [Entity: Dog] [Symptoms: fatigue, limping, fever] Query: Could it be Lyme disease?`\n    \n*   **Pros**:\n    *   Allows precision targeting of relevant documents, especially in domain-specific applications.\n    *   Supports advanced reasoning by aligning with KBs or ontology-driven retrieval.\n*   **Cons**:\n    *   Requires reliable NLU and state-tracking pipelines.\n    *   Adds system complexity.\n\n![](https://aman.ai/images/copy.png)\n\n`[Intent: Diagnose pet illness] [Entity: Dog] [Symptoms: fatigue, limping, fever] Query: Could it be Lyme disease?`\n\n*   Allows precision targeting of relevant documents, especially in domain-specific applications.\n*   Supports advanced reasoning by aligning with KBs or ontology-driven retrieval.\n\n*   Requires reliable NLU and state-tracking pipelines.\n*   Adds system complexity.",
    "order": 9,
    "orderInChapter": 4,
    "difficulty": 3,
    "estimatedMinutes": 1,
    "tags": [
      "nlpllms",
      "embedding"
    ],
    "metadata": {
      "hasCode": true,
      "hasMath": false,
      "hasImages": true,
      "wordCount": 134,
      "contentLength": 1880
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#embedding-structured-dialogue-state",
    "scrapedAt": "2025-12-28T11:54:28.276Z"
  },
  {
    "id": "ai-RAG-task-optimized-embedding-via-query-reformulation-10",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "RAG in Multi-Turn Chatbots: Embedding Queries for Retrieval",
    "title": "Task-Optimized Embedding Via Query Reformulation",
    "subtitle": "RAG in Multi-Turn Chatbots: Embedding Queries for Retrieval",
    "contentHtml": "<ul>\n  <li>Some systems apply a query rewriting model that reformulates the latest turn into a fully self-contained question, suitable for retrieval.</li>\n  <li>For example, turning “What about dogs?” into “What are the symptoms of Lyme disease in dogs?”</li>\n  <li>These reformulated queries are then embedded for retrieval.</li>\n  <li><strong>Pros</strong>:\n    <ul>\n      <li>Ensures clarity and focus in queries passed to the retriever.</li>\n      <li>Significantly boosts retrieval performance in ambiguous or shorthand follow-ups.</li>\n    </ul>\n  </li>\n  <li><strong>Cons</strong>:\n    <ul>\n      <li>Introduces dependency on a high-quality rewrite model.</li>\n      <li>Risk of introducing hallucination or incorrect reformulations.</li>\n    </ul>\n  </li>\n</ul>\n<ul>\n      <li>Ensures clarity and focus in queries passed to the retriever.</li>\n      <li>Significantly boosts retrieval performance in ambiguous or shorthand follow-ups.</li>\n    </ul>\n<ul>\n      <li>Introduces dependency on a high-quality rewrite model.</li>\n      <li>Risk of introducing hallucination or incorrect reformulations.</li>\n    </ul>",
    "contentMarkdown": "*   Some systems apply a query rewriting model that reformulates the latest turn into a fully self-contained question, suitable for retrieval.\n*   For example, turning “What about dogs?” into “What are the symptoms of Lyme disease in dogs?”\n*   These reformulated queries are then embedded for retrieval.\n*   **Pros**:\n    *   Ensures clarity and focus in queries passed to the retriever.\n    *   Significantly boosts retrieval performance in ambiguous or shorthand follow-ups.\n*   **Cons**:\n    *   Introduces dependency on a high-quality rewrite model.\n    *   Risk of introducing hallucination or incorrect reformulations.\n\n*   Ensures clarity and focus in queries passed to the retriever.\n*   Significantly boosts retrieval performance in ambiguous or shorthand follow-ups.\n\n*   Introduces dependency on a high-quality rewrite model.\n*   Risk of introducing hallucination or incorrect reformulations.",
    "order": 10,
    "orderInChapter": 5,
    "difficulty": 2,
    "estimatedMinutes": 1,
    "tags": [
      "nlpllms"
    ],
    "metadata": {
      "hasCode": false,
      "hasMath": false,
      "hasImages": false,
      "wordCount": 125,
      "contentLength": 1120
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#task-optimized-embedding-via-query-reformulation",
    "scrapedAt": "2025-12-28T11:54:28.276Z"
  },
  {
    "id": "ai-RAG-best-practices-and-considerations-11",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "RAG in Multi-Turn Chatbots: Embedding Queries for Retrieval",
    "title": "Best Practices and Considerations",
    "subtitle": "RAG in Multi-Turn Chatbots: Embedding Queries for Retrieval",
    "contentHtml": "<ul>\n  <li><strong>Window Size</strong>: Most systems use a sliding window of 1-3 previous turns depending on token limits and task specificity.</li>\n  <li><strong>Query Length vs. Clarity Tradeoff</strong>: Longer queries with more context may capture nuance but risk introducing noise. Condensed or reformulated queries can help mitigate this.</li>\n  <li><strong>Personalization</strong>: In some advanced setups, user profiles or long-term memory can be injected into the retrieval query, but this must be carefully curated to avoid privacy or relevance pitfalls.</li>\n  <li><strong>System Goals</strong>: If the chatbot is task-oriented (e.g., booking travel), structured state may be best. If it is open-domain (e.g., a virtual assistant), concatenated dialogue or rewrite strategies tend to perform better.</li>\n</ul>",
    "contentMarkdown": "*   **Window Size**: Most systems use a sliding window of 1-3 previous turns depending on token limits and task specificity.\n*   **Query Length vs. Clarity Tradeoff**: Longer queries with more context may capture nuance but risk introducing noise. Condensed or reformulated queries can help mitigate this.\n*   **Personalization**: In some advanced setups, user profiles or long-term memory can be injected into the retrieval query, but this must be carefully curated to avoid privacy or relevance pitfalls.\n*   **System Goals**: If the chatbot is task-oriented (e.g., booking travel), structured state may be best. If it is open-domain (e.g., a virtual assistant), concatenated dialogue or rewrite strategies tend to perform better.",
    "order": 11,
    "orderInChapter": 6,
    "difficulty": 2,
    "estimatedMinutes": 1,
    "tags": [
      "nlpllms"
    ],
    "metadata": {
      "hasCode": false,
      "hasMath": false,
      "hasImages": false,
      "wordCount": 109,
      "contentLength": 823
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#best-practices-and-considerations",
    "scrapedAt": "2025-12-28T11:54:28.276Z"
  },
  {
    "id": "ai-RAG-retrieval-metrics-12",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "Component-Wise Evaluation",
    "title": "Retrieval Metrics",
    "subtitle": "Component-Wise Evaluation",
    "contentHtml": "<ul>\n  <li>Evaluating the retrieval component of RAG in the context of LLMs involves assessing how effectively the system retrieves relevant information to support the generation of accurate and contextually appropriate responses.</li>\n</ul>\n<h4 id=\"context-precision\">Context Precision</h4>\n<ul>\n  <li>\n    <p><strong>Definition</strong>: Context Precision is a metric used to assess the accuracy of ranking ground-truth relevant items from the context higher in the results. It measures whether all the relevant chunks of information appear at the top ranks when responding to a query. Ideally all the relevant chunks must appear at the top ranks. The metric is scored between 0 and 1 using the question, ground truth, and the contexts, with higher scores indicating better precision.</p>\n  </li>\n  <li><strong>Evaluation Approach</strong>: Context Precision is calculated using the following steps:\n    <ol>\n      <li>For each chunk in the retrieved context, determine if it is relevant or not relevant based on the ground truth for the given question.</li>\n      <li>\n        <p>Compute Precision@<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-92-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-944\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-945\"><span class=\"mi\" id=\"MathJax-Span-946\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-92\">k</script> for each chunk in the context using the formula:</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-93-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>Precision@k</mtext><mo>=</mo><mfrac><mtext>true positives@k</mtext><mrow><mtext>true positives@k</mtext><mo>+</mo><mtext>false positives@k</mtext></mrow></mfrac></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-947\" style=\"width: 26.148em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 21.773em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.68em, 1021.77em, 3.232em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-948\"><span class=\"mtext\" id=\"MathJax-Span-949\" style=\"font-family: STIXGeneral-Regular;\">Precision@k</span><span class=\"mo\" id=\"MathJax-Span-950\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-951\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 15.211em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1006.77em, 4.378em, -999.997em); top: -4.685em; left: 50%; margin-left: -3.383em;\"><span class=\"mtext\" id=\"MathJax-Span-952\" style=\"font-family: STIXGeneral-Regular;\">true positives@k</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1015.11em, 4.378em, -999.997em); top: -3.331em; left: 50%; margin-left: -7.549em;\"><span class=\"mrow\" id=\"MathJax-Span-953\"><span class=\"mtext\" id=\"MathJax-Span-954\" style=\"font-family: STIXGeneral-Regular;\">true positives@k</span><span class=\"mo\" id=\"MathJax-Span-955\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mtext\" id=\"MathJax-Span-956\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">false positives@k</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1015.21em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 15.211em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -1.122em; border-left: 0px solid; width: 0px; height: 2.878em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>Precision@k</mtext><mo>=</mo><mfrac><mtext>true positives@k</mtext><mrow><mtext>true positives@k</mtext><mo>+</mo><mtext>false positives@k</mtext></mrow></mfrac></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-93\">\\text{Precision@k} = \\frac{\\text{true positives@k}}{\\text{true positives@k} + \\text{false positives@k}}</script>\n      </li>\n      <li>\n        <p>Calculate the Context Precision@<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-94-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-957\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-958\"><span class=\"mi\" id=\"MathJax-Span-959\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-94\">k</script> by averaging the Precision@<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-95-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-960\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-961\"><span class=\"mi\" id=\"MathJax-Span-962\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-95\">k</script> values for all relevant items in the top <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-96-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-963\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-964\"><span class=\"mi\" id=\"MathJax-Span-965\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-96\">K</script> results:</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-97-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>Context Precision@k</mtext><mo>=</mo><mfrac><mrow><munderover><mo>&amp;#x2211;</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mi>K</mi></munderover><mo stretchy=&quot;false&quot;>(</mo><mtext>Precision@k</mtext><mo>&amp;#x00D7;</mo><msub><mi>v</mi><mi>k</mi></msub><mo stretchy=&quot;false&quot;>)</mo></mrow><mrow><mtext>Total number of relevant items in the top&amp;#xA0;</mtext><mi>k</mi><mtext>&amp;#xA0;results</mtext></mrow></mfrac></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-966\" style=\"width: 36.096em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 30.055em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.315em, 1030.06em, 3.232em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-967\"><span class=\"mtext\" id=\"MathJax-Span-968\" style=\"font-family: STIXGeneral-Regular;\">Context Precision@k</span><span class=\"mo\" id=\"MathJax-Span-969\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-970\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 20.107em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(2.919em, 1009.95em, 4.482em, -999.997em); top: -4.789em; left: 50%; margin-left: -4.997em;\"><span class=\"mrow\" id=\"MathJax-Span-971\"><span class=\"munderover\" id=\"MathJax-Span-972\"><span style=\"display: inline-block; position: relative; width: 2.138em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.076em, 1000.84em, 4.43em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mo\" id=\"MathJax-Span-973\" style=\"font-family: STIXGeneral-Regular; vertical-align: 0.003em;\">∑</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1000.58em, 4.169em, -999.997em); top: -4.477em; left: 0.94em;\"><span class=\"mi\" id=\"MathJax-Span-974\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1001.25em, 4.169em, -999.997em); top: -3.695em; left: 0.94em;\"><span class=\"texatom\" id=\"MathJax-Span-975\"><span class=\"mrow\" id=\"MathJax-Span-976\"><span class=\"mi\" id=\"MathJax-Span-977\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-978\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">=</span><span class=\"mn\" id=\"MathJax-Span-979\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-980\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mtext\" id=\"MathJax-Span-981\" style=\"font-family: STIXGeneral-Regular;\">Precision@k</span><span class=\"mo\" id=\"MathJax-Span-982\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">×</span><span class=\"msubsup\" id=\"MathJax-Span-983\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 0.836em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-984\" style=\"font-family: STIXGeneral-Italic;\">v</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"mi\" id=\"MathJax-Span-985\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-986\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1019.95em, 4.378em, -999.997em); top: -3.331em; left: 50%; margin-left: -9.997em;\"><span class=\"mrow\" id=\"MathJax-Span-987\"><span class=\"mtext\" id=\"MathJax-Span-988\" style=\"font-family: STIXGeneral-Regular;\">Total number of relevant items in the top&nbsp;</span><span class=\"mi\" id=\"MathJax-Span-989\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mtext\" id=\"MathJax-Span-990\" style=\"font-family: STIXGeneral-Regular;\">&nbsp;results</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1020.11em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 20.107em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -1.122em; border-left: 0px solid; width: 0px; height: 3.253em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>Context Precision@k</mtext><mo>=</mo><mfrac><mrow><munderover><mo>∑</mo><mrow class=\"MJX-TeXAtom-ORD\"><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mi>K</mi></munderover><mo stretchy=\"false\">(</mo><mtext>Precision@k</mtext><mo>×</mo><msub><mi>v</mi><mi>k</mi></msub><mo stretchy=\"false\">)</mo></mrow><mrow><mtext>Total number of relevant items in the top&nbsp;</mtext><mi>k</mi><mtext>&nbsp;results</mtext></mrow></mfrac></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-97\">\\text{Context Precision@k} = \\frac{\\sum_{k=1}^K (\\text{Precision@k} \\times v_k)}{\\text{Total number of relevant items in the top } k \\text{ results}}</script>\n\n        <ul>\n          <li>where <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-98-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-991\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-992\"><span class=\"mi\" id=\"MathJax-Span-993\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-98\">k</script> is the total number of chunks in contexts and <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-99-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>v</mi><mi>k</mi></msub><mo>&amp;#x2208;</mo><mo fence=&quot;false&quot; stretchy=&quot;false&quot;>{</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo fence=&quot;false&quot; stretchy=&quot;false&quot;>}</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-994\" style=\"width: 5.419em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 4.482em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1004.38em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-995\"><span class=\"msubsup\" id=\"MathJax-Span-996\"><span style=\"display: inline-block; position: relative; width: 0.836em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-997\" style=\"font-family: STIXGeneral-Italic;\">v</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"mi\" id=\"MathJax-Span-998\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-999\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">∈</span><span class=\"mo\" id=\"MathJax-Span-1000\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">{</span><span class=\"mn\" id=\"MathJax-Span-1001\" style=\"font-family: STIXGeneral-Regular;\">0</span><span class=\"mo\" id=\"MathJax-Span-1002\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mn\" id=\"MathJax-Span-1003\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">1</span><span class=\"mo\" id=\"MathJax-Span-1004\" style=\"font-family: STIXGeneral-Regular;\">}</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>v</mi><mi>k</mi></msub><mo>∈</mo><mo fence=\"false\" stretchy=\"false\">{</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo fence=\"false\" stretchy=\"false\">}</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-99\">v_k \\in \\{0,1\\}</script> is the relevance indicator at rank <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-100-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1005\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1006\"><span class=\"mi\" id=\"MathJax-Span-1007\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-100\">k</script>.</li>\n        </ul>\n      </li>\n    </ol>\n  </li>\n  <li>\n    <p><strong>Example</strong> <a href=\"https://docs.ragas.io/en/latest/concepts/metrics/context_precision.html\">(source)</a>: Let’s consider an example of calculating context precision using a question and its corresponding ground truth.</p>\n\n    <ul>\n      <li><strong>Question</strong>: Where is France and what is its capital?</li>\n      <li><strong>Ground Truth</strong>: France is in Western Europe, and its capital is Paris.</li>\n      <li><strong>High Context Precision Example</strong>:\n        <ul>\n          <li>Contexts: <code class=\"language-plaintext highlighter-rouge\">[\"France, in Western Europe, encompasses medieval cities, alpine villages, and Mediterranean beaches. Paris, its capital, is famed for its fashion houses, classical art museums including the Louvre and monuments like the Eiffel Tower\", \"The country is also renowned for its wines and sophisticated cuisine. Lascaux's ancient cave drawings, Lyon's Roman theater and the vast Palace of Versailles attest to its rich history.\"]</code></li>\n        </ul>\n      </li>\n      <li><strong>Low Context Precision Example</strong>:\n        <ul>\n          <li>Contexts: <code class=\"language-plaintext highlighter-rouge\">[\"The country is also renowned for its wines and sophisticated cuisine. Lascaux's ancient cave drawings, Lyon's Roman theater and\", \"France, in Western Europe, encompasses medieval cities, alpine villages, and Mediterranean beaches. Paris, its capital, is famed for its fashion houses, classical art museums including the Louvre and monuments like the Eiffel Tower\"]</code></li>\n        </ul>\n      </li>\n      <li>In this example, the calculation of context precision involves identifying relevant chunks related to the question and their ranking in the contexts. For the low context precision example:\n        <ul>\n          <li><strong>Precision@1</strong> = <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-101-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mfrac><mn>0</mn><mn>1</mn></mfrac></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1008\" style=\"width: 0.836em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.68em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.096em, 1000.68em, 2.659em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1009\"><span class=\"mfrac\" id=\"MathJax-Span-1010\"><span style=\"display: inline-block; position: relative; width: 0.471em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.388em, 1000.32em, 4.169em, -999.997em); top: -4.424em; left: 50%; margin-left: -0.154em;\"><span class=\"mn\" id=\"MathJax-Span-1011\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">0</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1000.26em, 4.169em, -999.997em); top: -3.643em; left: 50%; margin-left: -0.154em;\"><span class=\"mn\" id=\"MathJax-Span-1012\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1000.47em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.471em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.497em; border-left: 0px solid; width: 0px; height: 1.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mfrac><mn>0</mn><mn>1</mn></mfrac></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-101\">\\frac{0}{1}</script> = 0</li>\n          <li><strong>Precision@2</strong> = <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-102-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mfrac><mn>1</mn><mn>2</mn></mfrac></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1013\" style=\"width: 0.836em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.68em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.096em, 1000.68em, 2.659em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1014\"><span class=\"mfrac\" id=\"MathJax-Span-1015\"><span style=\"display: inline-block; position: relative; width: 0.471em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.388em, 1000.26em, 4.169em, -999.997em); top: -4.424em; left: 50%; margin-left: -0.154em;\"><span class=\"mn\" id=\"MathJax-Span-1016\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1000.32em, 4.169em, -999.997em); top: -3.643em; left: 50%; margin-left: -0.154em;\"><span class=\"mn\" id=\"MathJax-Span-1017\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1000.47em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.471em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.497em; border-left: 0px solid; width: 0px; height: 1.628em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mfrac><mn>1</mn><mn>2</mn></mfrac></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-102\">\\frac{1}{2}</script> = 0.5</li>\n          <li><strong>Context Precision</strong> = <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-103-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mfrac><mrow><mo stretchy=&quot;false&quot;>(</mo><mn>0</mn><mo>+</mo><mn>0.5</mn><mo stretchy=&quot;false&quot;>)</mo></mrow><mn>1</mn></mfrac></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1018\" style=\"width: 3.023em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.503em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.94em, 1002.5em, 2.659em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1019\"><span class=\"mfrac\" id=\"MathJax-Span-1020\"><span style=\"display: inline-block; position: relative; width: 2.294em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.388em, 1002.14em, 4.273em, -999.997em); top: -4.529em; left: 50%; margin-left: -1.091em;\"><span class=\"mrow\" id=\"MathJax-Span-1021\"><span class=\"mo\" id=\"MathJax-Span-1022\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">(</span><span class=\"mn\" id=\"MathJax-Span-1023\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">0</span><span class=\"mo\" id=\"MathJax-Span-1024\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">+</span><span class=\"mn\" id=\"MathJax-Span-1025\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">0.5</span><span class=\"mo\" id=\"MathJax-Span-1026\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1000.26em, 4.169em, -999.997em); top: -3.643em; left: 50%; margin-left: -0.154em;\"><span class=\"mn\" id=\"MathJax-Span-1027\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1002.29em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.294em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.497em; border-left: 0px solid; width: 0px; height: 1.816em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mfrac><mrow><mo stretchy=\"false\">(</mo><mn>0</mn><mo>+</mo><mn>0.5</mn><mo stretchy=\"false\">)</mo></mrow><mn>1</mn></mfrac></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-103\">\\frac{(0 + 0.5)}{1}</script> = 0.5</li>\n        </ul>\n      </li>\n    </ul>\n  </li>\n</ul>\n<p><strong>Definition</strong>: Context Precision is a metric used to assess the accuracy of ranking ground-truth relevant items from the context higher in the results. It measures whether all the relevant chunks of information appear at the top ranks when responding to a query. Ideally all the relevant chunks must appear at the top ranks. The metric is scored between 0 and 1 using the question, ground truth, and the contexts, with higher scores indicating better precision.</p>\n<ol>\n      <li>For each chunk in the retrieved context, determine if it is relevant or not relevant based on the ground truth for the given question.</li>\n      <li>\n        <p>Compute Precision@<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-92-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-944\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-945\"><span class=\"mi\" id=\"MathJax-Span-946\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-92\">k</script> for each chunk in the context using the formula:</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-93-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>Precision@k</mtext><mo>=</mo><mfrac><mtext>true positives@k</mtext><mrow><mtext>true positives@k</mtext><mo>+</mo><mtext>false positives@k</mtext></mrow></mfrac></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-947\" style=\"width: 26.148em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 21.773em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.68em, 1021.77em, 3.232em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-948\"><span class=\"mtext\" id=\"MathJax-Span-949\" style=\"font-family: STIXGeneral-Regular;\">Precision@k</span><span class=\"mo\" id=\"MathJax-Span-950\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-951\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 15.211em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1006.77em, 4.378em, -999.997em); top: -4.685em; left: 50%; margin-left: -3.383em;\"><span class=\"mtext\" id=\"MathJax-Span-952\" style=\"font-family: STIXGeneral-Regular;\">true positives@k</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1015.11em, 4.378em, -999.997em); top: -3.331em; left: 50%; margin-left: -7.549em;\"><span class=\"mrow\" id=\"MathJax-Span-953\"><span class=\"mtext\" id=\"MathJax-Span-954\" style=\"font-family: STIXGeneral-Regular;\">true positives@k</span><span class=\"mo\" id=\"MathJax-Span-955\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mtext\" id=\"MathJax-Span-956\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">false positives@k</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1015.21em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 15.211em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -1.122em; border-left: 0px solid; width: 0px; height: 2.878em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>Precision@k</mtext><mo>=</mo><mfrac><mtext>true positives@k</mtext><mrow><mtext>true positives@k</mtext><mo>+</mo><mtext>false positives@k</mtext></mrow></mfrac></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-93\">\\text{Precision@k} = \\frac{\\text{true positives@k}}{\\text{true positives@k} + \\text{false positives@k}}</script>\n      </li>\n      <li>\n        <p>Calculate the Context Precision@<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-94-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-957\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-958\"><span class=\"mi\" id=\"MathJax-Span-959\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-94\">k</script> by averaging the Precision@<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-95-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-960\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-961\"><span class=\"mi\" id=\"MathJax-Span-962\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-95\">k</script> values for all relevant items in the top <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-96-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-963\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-964\"><span class=\"mi\" id=\"MathJax-Span-965\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-96\">K</script> results:</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-97-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>Context Precision@k</mtext><mo>=</mo><mfrac><mrow><munderover><mo>&amp;#x2211;</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mi>K</mi></munderover><mo stretchy=&quot;false&quot;>(</mo><mtext>Precision@k</mtext><mo>&amp;#x00D7;</mo><msub><mi>v</mi><mi>k</mi></msub><mo stretchy=&quot;false&quot;>)</mo></mrow><mrow><mtext>Total number of relevant items in the top&amp;#xA0;</mtext><mi>k</mi><mtext>&amp;#xA0;results</mtext></mrow></mfrac></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-966\" style=\"width: 36.096em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 30.055em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.315em, 1030.06em, 3.232em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-967\"><span class=\"mtext\" id=\"MathJax-Span-968\" style=\"font-family: STIXGeneral-Regular;\">Context Precision@k</span><span class=\"mo\" id=\"MathJax-Span-969\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-970\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 20.107em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(2.919em, 1009.95em, 4.482em, -999.997em); top: -4.789em; left: 50%; margin-left: -4.997em;\"><span class=\"mrow\" id=\"MathJax-Span-971\"><span class=\"munderover\" id=\"MathJax-Span-972\"><span style=\"display: inline-block; position: relative; width: 2.138em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.076em, 1000.84em, 4.43em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mo\" id=\"MathJax-Span-973\" style=\"font-family: STIXGeneral-Regular; vertical-align: 0.003em;\">∑</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1000.58em, 4.169em, -999.997em); top: -4.477em; left: 0.94em;\"><span class=\"mi\" id=\"MathJax-Span-974\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1001.25em, 4.169em, -999.997em); top: -3.695em; left: 0.94em;\"><span class=\"texatom\" id=\"MathJax-Span-975\"><span class=\"mrow\" id=\"MathJax-Span-976\"><span class=\"mi\" id=\"MathJax-Span-977\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-978\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">=</span><span class=\"mn\" id=\"MathJax-Span-979\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-980\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mtext\" id=\"MathJax-Span-981\" style=\"font-family: STIXGeneral-Regular;\">Precision@k</span><span class=\"mo\" id=\"MathJax-Span-982\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">×</span><span class=\"msubsup\" id=\"MathJax-Span-983\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 0.836em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-984\" style=\"font-family: STIXGeneral-Italic;\">v</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"mi\" id=\"MathJax-Span-985\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-986\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1019.95em, 4.378em, -999.997em); top: -3.331em; left: 50%; margin-left: -9.997em;\"><span class=\"mrow\" id=\"MathJax-Span-987\"><span class=\"mtext\" id=\"MathJax-Span-988\" style=\"font-family: STIXGeneral-Regular;\">Total number of relevant items in the top&nbsp;</span><span class=\"mi\" id=\"MathJax-Span-989\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mtext\" id=\"MathJax-Span-990\" style=\"font-family: STIXGeneral-Regular;\">&nbsp;results</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1020.11em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 20.107em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -1.122em; border-left: 0px solid; width: 0px; height: 3.253em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>Context Precision@k</mtext><mo>=</mo><mfrac><mrow><munderover><mo>∑</mo><mrow class=\"MJX-TeXAtom-ORD\"><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mi>K</mi></munderover><mo stretchy=\"false\">(</mo><mtext>Precision@k</mtext><mo>×</mo><msub><mi>v</mi><mi>k</mi></msub><mo stretchy=\"false\">)</mo></mrow><mrow><mtext>Total number of relevant items in the top&nbsp;</mtext><mi>k</mi><mtext>&nbsp;results</mtext></mrow></mfrac></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-97\">\\text{Context Precision@k} = \\frac{\\sum_{k=1}^K (\\text{Precision@k} \\times v_k)}{\\text{Total number of relevant items in the top } k \\text{ results}}</script>\n\n        <ul>\n          <li>where <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-98-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-991\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-992\"><span class=\"mi\" id=\"MathJax-Span-993\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-98\">k</script> is the total number of chunks in contexts and <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-99-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>v</mi><mi>k</mi></msub><mo>&amp;#x2208;</mo><mo fence=&quot;false&quot; stretchy=&quot;false&quot;>{</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo fence=&quot;false&quot; stretchy=&quot;false&quot;>}</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-994\" style=\"width: 5.419em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 4.482em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1004.38em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-995\"><span class=\"msubsup\" id=\"MathJax-Span-996\"><span style=\"display: inline-block; position: relative; width: 0.836em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-997\" style=\"font-family: STIXGeneral-Italic;\">v</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"mi\" id=\"MathJax-Span-998\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-999\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">∈</span><span class=\"mo\" id=\"MathJax-Span-1000\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">{</span><span class=\"mn\" id=\"MathJax-Span-1001\" style=\"font-family: STIXGeneral-Regular;\">0</span><span class=\"mo\" id=\"MathJax-Span-1002\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mn\" id=\"MathJax-Span-1003\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">1</span><span class=\"mo\" id=\"MathJax-Span-1004\" style=\"font-family: STIXGeneral-Regular;\">}</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>v</mi><mi>k</mi></msub><mo>∈</mo><mo fence=\"false\" stretchy=\"false\">{</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo fence=\"false\" stretchy=\"false\">}</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-99\">v_k \\in \\{0,1\\}</script> is the relevance indicator at rank <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-100-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1005\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1006\"><span class=\"mi\" id=\"MathJax-Span-1007\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-100\">k</script>.</li>\n        </ul>\n      </li>\n    </ol>\n<p>Compute Precision@<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-92-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-944\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-945\"><span class=\"mi\" id=\"MathJax-Span-946\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-92\">k</script> for each chunk in the context using the formula:</p>\n<p>Calculate the Context Precision@<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-94-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-957\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-958\"><span class=\"mi\" id=\"MathJax-Span-959\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-94\">k</script> by averaging the Precision@<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-95-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-960\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-961\"><span class=\"mi\" id=\"MathJax-Span-962\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-95\">k</script> values for all relevant items in the top <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-96-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-963\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-964\"><span class=\"mi\" id=\"MathJax-Span-965\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-96\">K</script> results:</p>\n<ul>\n          <li>where <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-98-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-991\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-992\"><span class=\"mi\" id=\"MathJax-Span-993\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-98\">k</script> is the total number of chunks in contexts and <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-99-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>v</mi><mi>k</mi></msub><mo>&amp;#x2208;</mo><mo fence=&quot;false&quot; stretchy=&quot;false&quot;>{</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo fence=&quot;false&quot; stretchy=&quot;false&quot;>}</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-994\" style=\"width: 5.419em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 4.482em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1004.38em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-995\"><span class=\"msubsup\" id=\"MathJax-Span-996\"><span style=\"display: inline-block; position: relative; width: 0.836em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-997\" style=\"font-family: STIXGeneral-Italic;\">v</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"mi\" id=\"MathJax-Span-998\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-999\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">∈</span><span class=\"mo\" id=\"MathJax-Span-1000\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">{</span><span class=\"mn\" id=\"MathJax-Span-1001\" style=\"font-family: STIXGeneral-Regular;\">0</span><span class=\"mo\" id=\"MathJax-Span-1002\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mn\" id=\"MathJax-Span-1003\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">1</span><span class=\"mo\" id=\"MathJax-Span-1004\" style=\"font-family: STIXGeneral-Regular;\">}</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>v</mi><mi>k</mi></msub><mo>∈</mo><mo fence=\"false\" stretchy=\"false\">{</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo fence=\"false\" stretchy=\"false\">}</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-99\">v_k \\in \\{0,1\\}</script> is the relevance indicator at rank <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-100-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1005\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1006\"><span class=\"mi\" id=\"MathJax-Span-1007\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-100\">k</script>.</li>\n        </ul>\n<p><strong>Example</strong> <a href=\"https://docs.ragas.io/en/latest/concepts/metrics/context_precision.html\">(source)</a>: Let’s consider an example of calculating context precision using a question and its corresponding ground truth.</p>\n<ul>\n      <li><strong>Question</strong>: Where is France and what is its capital?</li>\n      <li><strong>Ground Truth</strong>: France is in Western Europe, and its capital is Paris.</li>\n      <li><strong>High Context Precision Example</strong>:\n        <ul>\n          <li>Contexts: <code class=\"language-plaintext highlighter-rouge\">[\"France, in Western Europe, encompasses medieval cities, alpine villages, and Mediterranean beaches. Paris, its capital, is famed for its fashion houses, classical art museums including the Louvre and monuments like the Eiffel Tower\", \"The country is also renowned for its wines and sophisticated cuisine. Lascaux's ancient cave drawings, Lyon's Roman theater and the vast Palace of Versailles attest to its rich history.\"]</code></li>\n        </ul>\n      </li>\n      <li><strong>Low Context Precision Example</strong>:\n        <ul>\n          <li>Contexts: <code class=\"language-plaintext highlighter-rouge\">[\"The country is also renowned for its wines and sophisticated cuisine. Lascaux's ancient cave drawings, Lyon's Roman theater and\", \"France, in Western Europe, encompasses medieval cities, alpine villages, and Mediterranean beaches. Paris, its capital, is famed for its fashion houses, classical art museums including the Louvre and monuments like the Eiffel Tower\"]</code></li>\n        </ul>\n      </li>\n      <li>In this example, the calculation of context precision involves identifying relevant chunks related to the question and their ranking in the contexts. For the low context precision example:\n        <ul>\n          <li><strong>Precision@1</strong> = <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-101-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mfrac><mn>0</mn><mn>1</mn></mfrac></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1008\" style=\"width: 0.836em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.68em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.096em, 1000.68em, 2.659em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1009\"><span class=\"mfrac\" id=\"MathJax-Span-1010\"><span style=\"display: inline-block; position: relative; width: 0.471em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.388em, 1000.32em, 4.169em, -999.997em); top: -4.424em; left: 50%; margin-left: -0.154em;\"><span class=\"mn\" id=\"MathJax-Span-1011\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">0</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1000.26em, 4.169em, -999.997em); top: -3.643em; left: 50%; margin-left: -0.154em;\"><span class=\"mn\" id=\"MathJax-Span-1012\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1000.47em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.471em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.497em; border-left: 0px solid; width: 0px; height: 1.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mfrac><mn>0</mn><mn>1</mn></mfrac></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-101\">\\frac{0}{1}</script> = 0</li>\n          <li><strong>Precision@2</strong> = <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-102-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mfrac><mn>1</mn><mn>2</mn></mfrac></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1013\" style=\"width: 0.836em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.68em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.096em, 1000.68em, 2.659em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1014\"><span class=\"mfrac\" id=\"MathJax-Span-1015\"><span style=\"display: inline-block; position: relative; width: 0.471em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.388em, 1000.26em, 4.169em, -999.997em); top: -4.424em; left: 50%; margin-left: -0.154em;\"><span class=\"mn\" id=\"MathJax-Span-1016\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1000.32em, 4.169em, -999.997em); top: -3.643em; left: 50%; margin-left: -0.154em;\"><span class=\"mn\" id=\"MathJax-Span-1017\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1000.47em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.471em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.497em; border-left: 0px solid; width: 0px; height: 1.628em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mfrac><mn>1</mn><mn>2</mn></mfrac></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-102\">\\frac{1}{2}</script> = 0.5</li>\n          <li><strong>Context Precision</strong> = <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-103-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mfrac><mrow><mo stretchy=&quot;false&quot;>(</mo><mn>0</mn><mo>+</mo><mn>0.5</mn><mo stretchy=&quot;false&quot;>)</mo></mrow><mn>1</mn></mfrac></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1018\" style=\"width: 3.023em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.503em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.94em, 1002.5em, 2.659em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1019\"><span class=\"mfrac\" id=\"MathJax-Span-1020\"><span style=\"display: inline-block; position: relative; width: 2.294em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.388em, 1002.14em, 4.273em, -999.997em); top: -4.529em; left: 50%; margin-left: -1.091em;\"><span class=\"mrow\" id=\"MathJax-Span-1021\"><span class=\"mo\" id=\"MathJax-Span-1022\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">(</span><span class=\"mn\" id=\"MathJax-Span-1023\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">0</span><span class=\"mo\" id=\"MathJax-Span-1024\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">+</span><span class=\"mn\" id=\"MathJax-Span-1025\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">0.5</span><span class=\"mo\" id=\"MathJax-Span-1026\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1000.26em, 4.169em, -999.997em); top: -3.643em; left: 50%; margin-left: -0.154em;\"><span class=\"mn\" id=\"MathJax-Span-1027\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1002.29em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.294em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.497em; border-left: 0px solid; width: 0px; height: 1.816em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mfrac><mrow><mo stretchy=\"false\">(</mo><mn>0</mn><mo>+</mo><mn>0.5</mn><mo stretchy=\"false\">)</mo></mrow><mn>1</mn></mfrac></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-103\">\\frac{(0 + 0.5)}{1}</script> = 0.5</li>\n        </ul>\n      </li>\n    </ul>\n<ul>\n          <li>Contexts: <code class=\"language-plaintext highlighter-rouge\">[\"France, in Western Europe, encompasses medieval cities, alpine villages, and Mediterranean beaches. Paris, its capital, is famed for its fashion houses, classical art museums including the Louvre and monuments like the Eiffel Tower\", \"The country is also renowned for its wines and sophisticated cuisine. Lascaux's ancient cave drawings, Lyon's Roman theater and the vast Palace of Versailles attest to its rich history.\"]</code></li>\n        </ul>\n<ul>\n          <li>Contexts: <code class=\"language-plaintext highlighter-rouge\">[\"The country is also renowned for its wines and sophisticated cuisine. Lascaux's ancient cave drawings, Lyon's Roman theater and\", \"France, in Western Europe, encompasses medieval cities, alpine villages, and Mediterranean beaches. Paris, its capital, is famed for its fashion houses, classical art museums including the Louvre and monuments like the Eiffel Tower\"]</code></li>\n        </ul>\n<ul>\n          <li><strong>Precision@1</strong> = <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-101-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mfrac><mn>0</mn><mn>1</mn></mfrac></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1008\" style=\"width: 0.836em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.68em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.096em, 1000.68em, 2.659em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1009\"><span class=\"mfrac\" id=\"MathJax-Span-1010\"><span style=\"display: inline-block; position: relative; width: 0.471em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.388em, 1000.32em, 4.169em, -999.997em); top: -4.424em; left: 50%; margin-left: -0.154em;\"><span class=\"mn\" id=\"MathJax-Span-1011\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">0</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1000.26em, 4.169em, -999.997em); top: -3.643em; left: 50%; margin-left: -0.154em;\"><span class=\"mn\" id=\"MathJax-Span-1012\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1000.47em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.471em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.497em; border-left: 0px solid; width: 0px; height: 1.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mfrac><mn>0</mn><mn>1</mn></mfrac></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-101\">\\frac{0}{1}</script> = 0</li>\n          <li><strong>Precision@2</strong> = <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-102-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mfrac><mn>1</mn><mn>2</mn></mfrac></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1013\" style=\"width: 0.836em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.68em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.096em, 1000.68em, 2.659em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1014\"><span class=\"mfrac\" id=\"MathJax-Span-1015\"><span style=\"display: inline-block; position: relative; width: 0.471em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.388em, 1000.26em, 4.169em, -999.997em); top: -4.424em; left: 50%; margin-left: -0.154em;\"><span class=\"mn\" id=\"MathJax-Span-1016\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1000.32em, 4.169em, -999.997em); top: -3.643em; left: 50%; margin-left: -0.154em;\"><span class=\"mn\" id=\"MathJax-Span-1017\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1000.47em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.471em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.497em; border-left: 0px solid; width: 0px; height: 1.628em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mfrac><mn>1</mn><mn>2</mn></mfrac></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-102\">\\frac{1}{2}</script> = 0.5</li>\n          <li><strong>Context Precision</strong> = <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-103-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mfrac><mrow><mo stretchy=&quot;false&quot;>(</mo><mn>0</mn><mo>+</mo><mn>0.5</mn><mo stretchy=&quot;false&quot;>)</mo></mrow><mn>1</mn></mfrac></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1018\" style=\"width: 3.023em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.503em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.94em, 1002.5em, 2.659em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1019\"><span class=\"mfrac\" id=\"MathJax-Span-1020\"><span style=\"display: inline-block; position: relative; width: 2.294em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.388em, 1002.14em, 4.273em, -999.997em); top: -4.529em; left: 50%; margin-left: -1.091em;\"><span class=\"mrow\" id=\"MathJax-Span-1021\"><span class=\"mo\" id=\"MathJax-Span-1022\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">(</span><span class=\"mn\" id=\"MathJax-Span-1023\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">0</span><span class=\"mo\" id=\"MathJax-Span-1024\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">+</span><span class=\"mn\" id=\"MathJax-Span-1025\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">0.5</span><span class=\"mo\" id=\"MathJax-Span-1026\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1000.26em, 4.169em, -999.997em); top: -3.643em; left: 50%; margin-left: -0.154em;\"><span class=\"mn\" id=\"MathJax-Span-1027\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1002.29em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.294em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.497em; border-left: 0px solid; width: 0px; height: 1.816em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mfrac><mrow><mo stretchy=\"false\">(</mo><mn>0</mn><mo>+</mo><mn>0.5</mn><mo stretchy=\"false\">)</mo></mrow><mn>1</mn></mfrac></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-103\">\\frac{(0 + 0.5)}{1}</script> = 0.5</li>\n        </ul>\n<h4 id=\"context-recall\">Context Recall</h4>\n<ul>\n  <li>\n    <p><strong>Definition</strong>: Context Recall measures how well the retrieved context aligns with the annotated answer, treated as the ground truth. This metric is essential for assessing the accuracy of the retrieval system in identifying and ranking relevant information. It evaluate the performance of the retrieval system in identifying relevant information based on a sample query and its corresponding ground truth answer. The context recall score helps in understanding how much of the ground truth information is accurately retrieved from the context. The context recall score ranges from 0 to 1, with higher values indicating better performance.</p>\n  </li>\n  <li>\n    <p><strong>Evaluation Approach</strong>: To estimate context recall, each sentence in the ground truth answer is analyzed to determine whether it can be attributed to the retrieved context. The ideal scenario is when all sentences in the ground truth answer are attributable to the retrieved context. The formula used for calculating context recall is:</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-104-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>Context Recall</mtext><mo>=</mo><mfrac><mrow><mo stretchy=&quot;false&quot;>&amp;#x2223;</mo><mtext>GT sentences attributable to context</mtext><mo stretchy=&quot;false&quot;>&amp;#x2223;</mo></mrow><mrow><mo stretchy=&quot;false&quot;>&amp;#x2223;</mo><mtext>Total sentences in GT</mtext><mo stretchy=&quot;false&quot;>&amp;#x2223;</mo></mrow></mfrac></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1028\" style=\"width: 27.034em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 22.503em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.68em, 1022.5em, 3.232em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1029\"><span class=\"mtext\" id=\"MathJax-Span-1030\" style=\"font-family: STIXGeneral-Regular;\">Context Recall</span><span class=\"mo\" id=\"MathJax-Span-1031\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-1032\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 15.107em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1014.9em, 4.378em, -999.997em); top: -4.685em; left: 50%; margin-left: -7.497em;\"><span class=\"mrow\" id=\"MathJax-Span-1033\"><span class=\"mo\" id=\"MathJax-Span-1034\" style=\"font-family: STIXGeneral-Regular;\">∣</span><span class=\"mtext\" id=\"MathJax-Span-1035\" style=\"font-family: STIXGeneral-Regular;\">GT sentences attributable to context</span><span class=\"mo\" id=\"MathJax-Span-1036\" style=\"font-family: STIXGeneral-Regular;\">∣</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1009.22em, 4.378em, -999.997em); top: -3.331em; left: 50%; margin-left: -4.685em;\"><span class=\"mrow\" id=\"MathJax-Span-1037\"><span class=\"mo\" id=\"MathJax-Span-1038\" style=\"font-family: STIXGeneral-Regular;\">∣</span><span class=\"mtext\" id=\"MathJax-Span-1039\" style=\"font-family: STIXGeneral-Regular;\">Total sentences in GT</span><span class=\"mo\" id=\"MathJax-Span-1040\" style=\"font-family: STIXGeneral-Regular;\">∣</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1015.11em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 15.107em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -1.122em; border-left: 0px solid; width: 0px; height: 2.816em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>Context Recall</mtext><mo>=</mo><mfrac><mrow><mo stretchy=\"false\">∣</mo><mtext>GT sentences attributable to context</mtext><mo stretchy=\"false\">∣</mo></mrow><mrow><mo stretchy=\"false\">∣</mo><mtext>Total sentences in GT</mtext><mo stretchy=\"false\">∣</mo></mrow></mfrac></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-104\">\\text{Context Recall} = \\frac{\\mid \\text{GT sentences attributable to context} \\mid}{\\mid \\text{Total sentences in GT} \\mid}</script>\n  </li>\n  <li>\n    <p><strong>Example</strong> <a href=\"https://docs.ragas.io/en/latest/concepts/metrics/context_recall.html\">(source)</a>:</p>\n    <ul>\n      <li>Ground Truth Question: “Where is France and what is its capital?”</li>\n      <li>\n        <p>Ground Truth Answer: “France is in Western Europe and its capital is Paris.”</p>\n      </li>\n      <li><strong>High Context Recall Example</strong>:\n        <ul>\n          <li>Retrieved Context: “France, in Western Europe, encompasses medieval cities, alpine villages, and Mediterranean beaches. Paris, its capital, is famed for its fashion houses, classical art museums including the Louvre, and monuments like the Eiffel Tower.”</li>\n        </ul>\n      </li>\n      <li><strong>Low Context Recall Example</strong>:\n        <ul>\n          <li>Retrieved Context: “France, in Western Europe, encompasses medieval cities, alpine villages, and Mediterranean beaches. The country is also renowned for its wines and sophisticated cuisine. Lascaux’s ancient cave drawings, Lyon’s Roman theater, and the vast Palace of Versailles attest to its rich history.”</li>\n        </ul>\n      </li>\n      <li><strong>Calculation</strong>:\n        <ul>\n          <li><strong>Step 1</strong>: Break the ground truth answer into individual statements:\n            <ul>\n              <li>Statement 1: “France is in Western Europe.”</li>\n              <li>Statement 2: “Its capital is Paris.”</li>\n            </ul>\n          </li>\n          <li><strong>Step 2</strong>: Verify if each ground truth statement can be attributed to the retrieved context:\n            <ul>\n              <li>Statement 1: Yes (in both high and low context recall examples)</li>\n              <li>Statement 2: No (in the low context recall example)</li>\n            </ul>\n          </li>\n          <li>\n            <p><strong>Step 3</strong>: Calculate context recall using the formula:</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-105-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>Context Recall</mtext><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mo>=</mo><mn>0.5</mn><mspace width=&quot;1em&quot; /><mtext>(for the low context recall example)</mtext></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1041\" style=\"width: 31.148em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 25.94em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.68em, 1025.89em, 3.023em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1042\"><span class=\"mtext\" id=\"MathJax-Span-1043\" style=\"font-family: STIXGeneral-Regular;\">Context Recall</span><span class=\"mo\" id=\"MathJax-Span-1044\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-1045\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-1046\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1000.47em, 4.169em, -999.997em); top: -3.331em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-1047\" style=\"font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1000.63em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.628em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1048\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-1049\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">0.5</span><span class=\"mspace\" id=\"MathJax-Span-1050\" style=\"height: 0em; vertical-align: 0em; width: 1.148em; display: inline-block; overflow: hidden;\"></span><span class=\"mtext\" id=\"MathJax-Span-1051\" style=\"font-family: STIXGeneral-Regular;\">(for the low context recall example)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.872em; border-left: 0px solid; width: 0px; height: 2.566em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>Context Recall</mtext><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mo>=</mo><mn>0.5</mn><mspace width=\"1em\"></mspace><mtext>(for the low context recall example)</mtext></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-105\">\\text{Context Recall} = \\frac{1}{2} = 0.5 \\quad \\text{(for the low context recall example)}</script>\n          </li>\n        </ul>\n      </li>\n    </ul>\n  </li>\n</ul>\n<p><strong>Definition</strong>: Context Recall measures how well the retrieved context aligns with the annotated answer, treated as the ground truth. This metric is essential for assessing the accuracy of the retrieval system in identifying and ranking relevant information. It evaluate the performance of the retrieval system in identifying relevant information based on a sample query and its corresponding ground truth answer. The context recall score helps in understanding how much of the ground truth information is accurately retrieved from the context. The context recall score ranges from 0 to 1, with higher values indicating better performance.</p>\n<p><strong>Evaluation Approach</strong>: To estimate context recall, each sentence in the ground truth answer is analyzed to determine whether it can be attributed to the retrieved context. The ideal scenario is when all sentences in the ground truth answer are attributable to the retrieved context. The formula used for calculating context recall is:</p>\n<p><strong>Example</strong> <a href=\"https://docs.ragas.io/en/latest/concepts/metrics/context_recall.html\">(source)</a>:</p>\n<ul>\n      <li>Ground Truth Question: “Where is France and what is its capital?”</li>\n      <li>\n        <p>Ground Truth Answer: “France is in Western Europe and its capital is Paris.”</p>\n      </li>\n      <li><strong>High Context Recall Example</strong>:\n        <ul>\n          <li>Retrieved Context: “France, in Western Europe, encompasses medieval cities, alpine villages, and Mediterranean beaches. Paris, its capital, is famed for its fashion houses, classical art museums including the Louvre, and monuments like the Eiffel Tower.”</li>\n        </ul>\n      </li>\n      <li><strong>Low Context Recall Example</strong>:\n        <ul>\n          <li>Retrieved Context: “France, in Western Europe, encompasses medieval cities, alpine villages, and Mediterranean beaches. The country is also renowned for its wines and sophisticated cuisine. Lascaux’s ancient cave drawings, Lyon’s Roman theater, and the vast Palace of Versailles attest to its rich history.”</li>\n        </ul>\n      </li>\n      <li><strong>Calculation</strong>:\n        <ul>\n          <li><strong>Step 1</strong>: Break the ground truth answer into individual statements:\n            <ul>\n              <li>Statement 1: “France is in Western Europe.”</li>\n              <li>Statement 2: “Its capital is Paris.”</li>\n            </ul>\n          </li>\n          <li><strong>Step 2</strong>: Verify if each ground truth statement can be attributed to the retrieved context:\n            <ul>\n              <li>Statement 1: Yes (in both high and low context recall examples)</li>\n              <li>Statement 2: No (in the low context recall example)</li>\n            </ul>\n          </li>\n          <li>\n            <p><strong>Step 3</strong>: Calculate context recall using the formula:</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-105-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>Context Recall</mtext><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mo>=</mo><mn>0.5</mn><mspace width=&quot;1em&quot; /><mtext>(for the low context recall example)</mtext></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1041\" style=\"width: 31.148em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 25.94em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.68em, 1025.89em, 3.023em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1042\"><span class=\"mtext\" id=\"MathJax-Span-1043\" style=\"font-family: STIXGeneral-Regular;\">Context Recall</span><span class=\"mo\" id=\"MathJax-Span-1044\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-1045\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-1046\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1000.47em, 4.169em, -999.997em); top: -3.331em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-1047\" style=\"font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1000.63em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.628em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1048\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-1049\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">0.5</span><span class=\"mspace\" id=\"MathJax-Span-1050\" style=\"height: 0em; vertical-align: 0em; width: 1.148em; display: inline-block; overflow: hidden;\"></span><span class=\"mtext\" id=\"MathJax-Span-1051\" style=\"font-family: STIXGeneral-Regular;\">(for the low context recall example)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.872em; border-left: 0px solid; width: 0px; height: 2.566em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>Context Recall</mtext><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mo>=</mo><mn>0.5</mn><mspace width=\"1em\"></mspace><mtext>(for the low context recall example)</mtext></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-105\">\\text{Context Recall} = \\frac{1}{2} = 0.5 \\quad \\text{(for the low context recall example)}</script>\n          </li>\n        </ul>\n      </li>\n    </ul>\n<p>Ground Truth Answer: “France is in Western Europe and its capital is Paris.”</p>\n<ul>\n          <li>Retrieved Context: “France, in Western Europe, encompasses medieval cities, alpine villages, and Mediterranean beaches. Paris, its capital, is famed for its fashion houses, classical art museums including the Louvre, and monuments like the Eiffel Tower.”</li>\n        </ul>\n<ul>\n          <li>Retrieved Context: “France, in Western Europe, encompasses medieval cities, alpine villages, and Mediterranean beaches. The country is also renowned for its wines and sophisticated cuisine. Lascaux’s ancient cave drawings, Lyon’s Roman theater, and the vast Palace of Versailles attest to its rich history.”</li>\n        </ul>\n<ul>\n          <li><strong>Step 1</strong>: Break the ground truth answer into individual statements:\n            <ul>\n              <li>Statement 1: “France is in Western Europe.”</li>\n              <li>Statement 2: “Its capital is Paris.”</li>\n            </ul>\n          </li>\n          <li><strong>Step 2</strong>: Verify if each ground truth statement can be attributed to the retrieved context:\n            <ul>\n              <li>Statement 1: Yes (in both high and low context recall examples)</li>\n              <li>Statement 2: No (in the low context recall example)</li>\n            </ul>\n          </li>\n          <li>\n            <p><strong>Step 3</strong>: Calculate context recall using the formula:</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-105-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>Context Recall</mtext><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mo>=</mo><mn>0.5</mn><mspace width=&quot;1em&quot; /><mtext>(for the low context recall example)</mtext></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1041\" style=\"width: 31.148em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 25.94em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.68em, 1025.89em, 3.023em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1042\"><span class=\"mtext\" id=\"MathJax-Span-1043\" style=\"font-family: STIXGeneral-Regular;\">Context Recall</span><span class=\"mo\" id=\"MathJax-Span-1044\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-1045\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-1046\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1000.47em, 4.169em, -999.997em); top: -3.331em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-1047\" style=\"font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1000.63em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.628em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1048\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-1049\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">0.5</span><span class=\"mspace\" id=\"MathJax-Span-1050\" style=\"height: 0em; vertical-align: 0em; width: 1.148em; display: inline-block; overflow: hidden;\"></span><span class=\"mtext\" id=\"MathJax-Span-1051\" style=\"font-family: STIXGeneral-Regular;\">(for the low context recall example)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.872em; border-left: 0px solid; width: 0px; height: 2.566em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>Context Recall</mtext><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mo>=</mo><mn>0.5</mn><mspace width=\"1em\"></mspace><mtext>(for the low context recall example)</mtext></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-105\">\\text{Context Recall} = \\frac{1}{2} = 0.5 \\quad \\text{(for the low context recall example)}</script>\n          </li>\n        </ul>\n<ul>\n              <li>Statement 1: “France is in Western Europe.”</li>\n              <li>Statement 2: “Its capital is Paris.”</li>\n            </ul>\n<ul>\n              <li>Statement 1: Yes (in both high and low context recall examples)</li>\n              <li>Statement 2: No (in the low context recall example)</li>\n            </ul>\n<p><strong>Step 3</strong>: Calculate context recall using the formula:</p>\n<h4 id=\"context-relevance\">Context Relevance</h4>\n<ul>\n  <li><strong>Definition</strong>:\n    <ul>\n      <li>“Is the passage returned relevant for answering the given query?”</li>\n      <li>Measures how well the context retrieved by the RAG system aligns with the user’s query. It specifically evaluates whether the retrieved information is relevant and appropriate for the given query, ensuring that only essential information is included to address the query effectively.</li>\n    </ul>\n  </li>\n  <li><strong>Evaluation Approach</strong>: Involves a two-step procedure: first, the identification of relevant sentences using semantic similarity measures to produce a relevance score for each sentence. Can be measured with smaller BERT-style models, embedding distances, or with LLMs. The approach involves estimating the value of context relevance by identifying sentences within the retrieved context that are directly relevant for answering the given question. This is followed by the quantification of overall context relevance, where the final score is calculated using the formula:</li>\n</ul>\n<ul>\n      <li>“Is the passage returned relevant for answering the given query?”</li>\n      <li>Measures how well the context retrieved by the RAG system aligns with the user’s query. It specifically evaluates whether the retrieved information is relevant and appropriate for the given query, ensuring that only essential information is included to address the query effectively.</li>\n    </ul>\n<div class=\"MathJax_Display\"><span class=\"MathJax MathJax_FullWidth\" id=\"MathJax-Element-106-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>Context Relevance</mtext><mo>=</mo><mfrac><mtext>&amp;#xA0;Number of sentences that are relevant to the query within the retrieved context</mtext><mtext>&amp;#xA0;Total number of sentences in retrieved context</mtext></mfrac></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1052\" style=\"width: 100%; display: inline-block; min-width: 39.69em;\"><span style=\"display: inline-block; position: relative; width: 100%; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(3.44em, 1033.08em, 6.982em, -999.997em); top: -4.268em; left: 0em; width: 100%;\"><span class=\"mrow\" id=\"MathJax-Span-1053\"><span style=\"display: inline-block; position: relative; width: 100%; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1007.55em, 4.169em, -999.997em); top: -4.008em; left: 50%; margin-left: -3.799em;\"><span class=\"mtext\" id=\"MathJax-Span-1054\" style=\"font-family: STIXGeneral-Regular;\">Context Relevance</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(2.503em, 1033.08em, 4.846em, -999.997em); top: -2.133em; left: 50%; margin-left: -16.508em;\"><span class=\"mo\" id=\"MathJax-Span-1055\" style=\"font-family: STIXGeneral-Regular;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-1056\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 31.826em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1031.67em, 4.378em, -999.997em); top: -4.685em; left: 50%; margin-left: -15.831em;\"><span class=\"mtext\" id=\"MathJax-Span-1057\" style=\"font-family: STIXGeneral-Regular;\">&nbsp;Number of sentences that are relevant to the query within the retrieved context</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1018.86em, 4.169em, -999.997em); top: -3.331em; left: 50%; margin-left: -9.424em;\"><span class=\"mtext\" id=\"MathJax-Span-1058\" style=\"font-family: STIXGeneral-Regular;\">&nbsp;Total number of sentences in retrieved context</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1031.83em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 31.826em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.273em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -3.122em; border-left: 0px solid; width: 0px; height: 4.003em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>Context Relevance</mtext><mo>=</mo><mfrac><mtext>&nbsp;Number of sentences that are relevant to the query within the retrieved context</mtext><mtext>&nbsp;Total number of sentences in retrieved context</mtext></mfrac></math></span></span></div>\n<ul>\n  <li><strong>Examples</strong>:\n    <ul>\n      <li><em>High context relevance example</em>: For a question like “What is the capital of France?”, a highly relevant context would be “France, in Western Europe, encompasses medieval cities, alpine villages and Mediterranean beaches. Paris, its capital, is famed for its fashion houses, classical art museums including the Louvre and monuments like the Eiffel Tower.”</li>\n      <li><em>Low context relevance example</em>: For the same question, a less relevant context would include additional, unrelated information such as “The country is also renowned for its wines and sophisticated cuisine. Lascaux’s ancient cave drawings, Lyon’s Roman theater and the vast Palace of Versailles attest to its rich history.”</li>\n    </ul>\n  </li>\n  <li>This metric ensures that the RAG system provides concise and directly related information, enhancing the efficiency and accuracy of the response given to a specific query.</li>\n</ul>\n<ul>\n      <li><em>High context relevance example</em>: For a question like “What is the capital of France?”, a highly relevant context would be “France, in Western Europe, encompasses medieval cities, alpine villages and Mediterranean beaches. Paris, its capital, is famed for its fashion houses, classical art museums including the Louvre and monuments like the Eiffel Tower.”</li>\n      <li><em>Low context relevance example</em>: For the same question, a less relevant context would include additional, unrelated information such as “The country is also renowned for its wines and sophisticated cuisine. Lascaux’s ancient cave drawings, Lyon’s Roman theater and the vast Palace of Versailles attest to its rich history.”</li>\n    </ul>",
    "contentMarkdown": "*   Evaluating the retrieval component of RAG in the context of LLMs involves assessing how effectively the system retrieves relevant information to support the generation of accurate and contextually appropriate responses.\n\n#### Context Precision\n\n*   **Definition**: Context Precision is a metric used to assess the accuracy of ranking ground-truth relevant items from the context higher in the results. It measures whether all the relevant chunks of information appear at the top ranks when responding to a query. Ideally all the relevant chunks must appear at the top ranks. The metric is scored between 0 and 1 using the question, ground truth, and the contexts, with higher scores indicating better precision.\n    \n*   **Evaluation Approach**: Context Precision is calculated using the following steps:\n    1.  For each chunk in the retrieved context, determine if it is relevant or not relevant based on the ground truth for the given question.\n    2.  Compute Precision@kkk for each chunk in the context using the formula:\n        \n        Precision@k\\=true positives@ktrue positives@k+false positives@kPrecision@k\\=true positives@ktrue positives@k+false positives@k\n        \n        \\\\text{Precision@k} = \\\\frac{\\\\text{true positives@k}}{\\\\text{true positives@k} + \\\\text{false positives@k}}\n    3.  Calculate the Context Precision@kkk by averaging the Precision@kkk values for all relevant items in the top KKK results:\n        \n        Context Precision@k\\=∑Kk\\=1(Precision@k×vk)Total number of relevant items in the top k resultsContext Precision@k\\=∑k\\=1K(Precision@k×vk)Total number of relevant items in the top k results\n        \n        \\\\text{Context Precision@k} = \\\\frac{\\\\sum\\_{k=1}^K (\\\\text{Precision@k} \\\\times v\\_k)}{\\\\text{Total number of relevant items in the top } k \\\\text{ results}}\n        *   where kkk is the total number of chunks in contexts and vk∈{0,1}vk∈{0,1}v\\_k \\\\in \\\\{0,1\\\\} is the relevance indicator at rank kkk.\n*   **Example** [(source)](https://docs.ragas.io/en/latest/concepts/metrics/context_precision.html): Let’s consider an example of calculating context precision using a question and its corresponding ground truth.\n    \n    *   **Question**: Where is France and what is its capital?\n    *   **Ground Truth**: France is in Western Europe, and its capital is Paris.\n    *   **High Context Precision Example**:\n        *   Contexts: `[\"France, in Western Europe, encompasses medieval cities, alpine villages, and Mediterranean beaches. Paris, its capital, is famed for its fashion houses, classical art museums including the Louvre and monuments like the Eiffel Tower\", \"The country is also renowned for its wines and sophisticated cuisine. Lascaux's ancient cave drawings, Lyon's Roman theater and the vast Palace of Versailles attest to its rich history.\"]`\n    *   **Low Context Precision Example**:\n        *   Contexts: `[\"The country is also renowned for its wines and sophisticated cuisine. Lascaux's ancient cave drawings, Lyon's Roman theater and\", \"France, in Western Europe, encompasses medieval cities, alpine villages, and Mediterranean beaches. Paris, its capital, is famed for its fashion houses, classical art museums including the Louvre and monuments like the Eiffel Tower\"]`\n    *   In this example, the calculation of context precision involves identifying relevant chunks related to the question and their ranking in the contexts. For the low context precision example:\n        *   **Precision@1** = 0101\\\\frac{0}{1} = 0\n        *   **Precision@2** = 1212\\\\frac{1}{2} = 0.5\n        *   **Context Precision** = (0+0.5)1(0+0.5)1\\\\frac{(0 + 0.5)}{1} = 0.5\n\n**Definition**: Context Precision is a metric used to assess the accuracy of ranking ground-truth relevant items from the context higher in the results. It measures whether all the relevant chunks of information appear at the top ranks when responding to a query. Ideally all the relevant chunks must appear at the top ranks. The metric is scored between 0 and 1 using the question, ground truth, and the contexts, with higher scores indicating better precision.\n\n1.  For each chunk in the retrieved context, determine if it is relevant or not relevant based on the ground truth for the given question.\n2.  Compute Precision@kkk for each chunk in the context using the formula:\n    \n    Precision@k\\=true positives@ktrue positives@k+false positives@kPrecision@k\\=true positives@ktrue positives@k+false positives@k\n    \n    \\\\text{Precision@k} = \\\\frac{\\\\text{true positives@k}}{\\\\text{true positives@k} + \\\\text{false positives@k}}\n3.  Calculate the Context Precision@kkk by averaging the Precision@kkk values for all relevant items in the top KKK results:\n    \n    Context Precision@k\\=∑Kk\\=1(Precision@k×vk)Total number of relevant items in the top k resultsContext Precision@k\\=∑k\\=1K(Precision@k×vk)Total number of relevant items in the top k results\n    \n    \\\\text{Context Precision@k} = \\\\frac{\\\\sum\\_{k=1}^K (\\\\text{Precision@k} \\\\times v\\_k)}{\\\\text{Total number of relevant items in the top } k \\\\text{ results}}\n    *   where kkk is the total number of chunks in contexts and vk∈{0,1}vk∈{0,1}v\\_k \\\\in \\\\{0,1\\\\} is the relevance indicator at rank kkk.\n\nCompute Precision@kkk for each chunk in the context using the formula:\n\nCalculate the Context Precision@kkk by averaging the Precision@kkk values for all relevant items in the top KKK results:\n\n*   where kkk is the total number of chunks in contexts and vk∈{0,1}vk∈{0,1}v\\_k \\\\in \\\\{0,1\\\\} is the relevance indicator at rank kkk.\n\n**Example** [(source)](https://docs.ragas.io/en/latest/concepts/metrics/context_precision.html): Let’s consider an example of calculating context precision using a question and its corresponding ground truth.\n\n*   **Question**: Where is France and what is its capital?\n*   **Ground Truth**: France is in Western Europe, and its capital is Paris.\n*   **High Context Precision Example**:\n    *   Contexts: `[\"France, in Western Europe, encompasses medieval cities, alpine villages, and Mediterranean beaches. Paris, its capital, is famed for its fashion houses, classical art museums including the Louvre and monuments like the Eiffel Tower\", \"The country is also renowned for its wines and sophisticated cuisine. Lascaux's ancient cave drawings, Lyon's Roman theater and the vast Palace of Versailles attest to its rich history.\"]`\n*   **Low Context Precision Example**:\n    *   Contexts: `[\"The country is also renowned for its wines and sophisticated cuisine. Lascaux's ancient cave drawings, Lyon's Roman theater and\", \"France, in Western Europe, encompasses medieval cities, alpine villages, and Mediterranean beaches. Paris, its capital, is famed for its fashion houses, classical art museums including the Louvre and monuments like the Eiffel Tower\"]`\n*   In this example, the calculation of context precision involves identifying relevant chunks related to the question and their ranking in the contexts. For the low context precision example:\n    *   **Precision@1** = 0101\\\\frac{0}{1} = 0\n    *   **Precision@2** = 1212\\\\frac{1}{2} = 0.5\n    *   **Context Precision** = (0+0.5)1(0+0.5)1\\\\frac{(0 + 0.5)}{1} = 0.5\n\n*   Contexts: `[\"France, in Western Europe, encompasses medieval cities, alpine villages, and Mediterranean beaches. Paris, its capital, is famed for its fashion houses, classical art museums including the Louvre and monuments like the Eiffel Tower\", \"The country is also renowned for its wines and sophisticated cuisine. Lascaux's ancient cave drawings, Lyon's Roman theater and the vast Palace of Versailles attest to its rich history.\"]`\n\n*   Contexts: `[\"The country is also renowned for its wines and sophisticated cuisine. Lascaux's ancient cave drawings, Lyon's Roman theater and\", \"France, in Western Europe, encompasses medieval cities, alpine villages, and Mediterranean beaches. Paris, its capital, is famed for its fashion houses, classical art museums including the Louvre and monuments like the Eiffel Tower\"]`\n\n*   **Precision@1** = 0101\\\\frac{0}{1} = 0\n*   **Precision@2** = 1212\\\\frac{1}{2} = 0.5\n*   **Context Precision** = (0+0.5)1(0+0.5)1\\\\frac{(0 + 0.5)}{1} = 0.5\n\n#### Context Recall\n\n*   **Definition**: Context Recall measures how well the retrieved context aligns with the annotated answer, treated as the ground truth. This metric is essential for assessing the accuracy of the retrieval system in identifying and ranking relevant information. It evaluate the performance of the retrieval system in identifying relevant information based on a sample query and its corresponding ground truth answer. The context recall score helps in understanding how much of the ground truth information is accurately retrieved from the context. The context recall score ranges from 0 to 1, with higher values indicating better performance.\n    \n*   **Evaluation Approach**: To estimate context recall, each sentence in the ground truth answer is analyzed to determine whether it can be attributed to the retrieved context. The ideal scenario is when all sentences in the ground truth answer are attributable to the retrieved context. The formula used for calculating context recall is:\n    \n    Context Recall\\=∣GT sentences attributable to context∣∣Total sentences in GT∣Context Recall\\=∣GT sentences attributable to context∣∣Total sentences in GT∣\n    \n    \\\\text{Context Recall} = \\\\frac{\\\\mid \\\\text{GT sentences attributable to context} \\\\mid}{\\\\mid \\\\text{Total sentences in GT} \\\\mid}\n*   **Example** [(source)](https://docs.ragas.io/en/latest/concepts/metrics/context_recall.html):\n    \n    *   Ground Truth Question: “Where is France and what is its capital?”\n    *   Ground Truth Answer: “France is in Western Europe and its capital is Paris.”\n        \n    *   **High Context Recall Example**:\n        *   Retrieved Context: “France, in Western Europe, encompasses medieval cities, alpine villages, and Mediterranean beaches. Paris, its capital, is famed for its fashion houses, classical art museums including the Louvre, and monuments like the Eiffel Tower.”\n    *   **Low Context Recall Example**:\n        *   Retrieved Context: “France, in Western Europe, encompasses medieval cities, alpine villages, and Mediterranean beaches. The country is also renowned for its wines and sophisticated cuisine. Lascaux’s ancient cave drawings, Lyon’s Roman theater, and the vast Palace of Versailles attest to its rich history.”\n    *   **Calculation**:\n        *   **Step 1**: Break the ground truth answer into individual statements:\n            *   Statement 1: “France is in Western Europe.”\n            *   Statement 2: “Its capital is Paris.”\n        *   **Step 2**: Verify if each ground truth statement can be attributed to the retrieved context:\n            *   Statement 1: Yes (in both high and low context recall examples)\n            *   Statement 2: No (in the low context recall example)\n        *   **Step 3**: Calculate context recall using the formula:\n            \n            Context Recall\\=12\\=0.5(for the low context recall example)Context Recall\\=12\\=0.5(for the low context recall example)\n            \n            \\\\text{Context Recall} = \\\\frac{1}{2} = 0.5 \\\\quad \\\\text{(for the low context recall example)}\n\n**Definition**: Context Recall measures how well the retrieved context aligns with the annotated answer, treated as the ground truth. This metric is essential for assessing the accuracy of the retrieval system in identifying and ranking relevant information. It evaluate the performance of the retrieval system in identifying relevant information based on a sample query and its corresponding ground truth answer. The context recall score helps in understanding how much of the ground truth information is accurately retrieved from the context. The context recall score ranges from 0 to 1, with higher values indicating better performance.\n\n**Evaluation Approach**: To estimate context recall, each sentence in the ground truth answer is analyzed to determine whether it can be attributed to the retrieved context. The ideal scenario is when all sentences in the ground truth answer are attributable to the retrieved context. The formula used for calculating context recall is:\n\n**Example** [(source)](https://docs.ragas.io/en/latest/concepts/metrics/context_recall.html):\n\n*   Ground Truth Question: “Where is France and what is its capital?”\n*   Ground Truth Answer: “France is in Western Europe and its capital is Paris.”\n    \n*   **High Context Recall Example**:\n    *   Retrieved Context: “France, in Western Europe, encompasses medieval cities, alpine villages, and Mediterranean beaches. Paris, its capital, is famed for its fashion houses, classical art museums including the Louvre, and monuments like the Eiffel Tower.”\n*   **Low Context Recall Example**:\n    *   Retrieved Context: “France, in Western Europe, encompasses medieval cities, alpine villages, and Mediterranean beaches. The country is also renowned for its wines and sophisticated cuisine. Lascaux’s ancient cave drawings, Lyon’s Roman theater, and the vast Palace of Versailles attest to its rich history.”\n*   **Calculation**:\n    *   **Step 1**: Break the ground truth answer into individual statements:\n        *   Statement 1: “France is in Western Europe.”\n        *   Statement 2: “Its capital is Paris.”\n    *   **Step 2**: Verify if each ground truth statement can be attributed to the retrieved context:\n        *   Statement 1: Yes (in both high and low context recall examples)\n        *   Statement 2: No (in the low context recall example)\n    *   **Step 3**: Calculate context recall using the formula:\n        \n        Context Recall\\=12\\=0.5(for the low context recall example)Context Recall\\=12\\=0.5(for the low context recall example)\n        \n        \\\\text{Context Recall} = \\\\frac{1}{2} = 0.5 \\\\quad \\\\text{(for the low context recall example)}\n\nGround Truth Answer: “France is in Western Europe and its capital is Paris.”\n\n*   Retrieved Context: “France, in Western Europe, encompasses medieval cities, alpine villages, and Mediterranean beaches. Paris, its capital, is famed for its fashion houses, classical art museums including the Louvre, and monuments like the Eiffel Tower.”\n\n*   Retrieved Context: “France, in Western Europe, encompasses medieval cities, alpine villages, and Mediterranean beaches. The country is also renowned for its wines and sophisticated cuisine. Lascaux’s ancient cave drawings, Lyon’s Roman theater, and the vast Palace of Versailles attest to its rich history.”\n\n*   **Step 1**: Break the ground truth answer into individual statements:\n    *   Statement 1: “France is in Western Europe.”\n    *   Statement 2: “Its capital is Paris.”\n*   **Step 2**: Verify if each ground truth statement can be attributed to the retrieved context:\n    *   Statement 1: Yes (in both high and low context recall examples)\n    *   Statement 2: No (in the low context recall example)\n*   **Step 3**: Calculate context recall using the formula:\n    \n    Context Recall\\=12\\=0.5(for the low context recall example)Context Recall\\=12\\=0.5(for the low context recall example)\n    \n    \\\\text{Context Recall} = \\\\frac{1}{2} = 0.5 \\\\quad \\\\text{(for the low context recall example)}\n\n*   Statement 1: “France is in Western Europe.”\n*   Statement 2: “Its capital is Paris.”\n\n*   Statement 1: Yes (in both high and low context recall examples)\n*   Statement 2: No (in the low context recall example)\n\n**Step 3**: Calculate context recall using the formula:\n\n#### Context Relevance\n\n*   **Definition**:\n    *   “Is the passage returned relevant for answering the given query?”\n    *   Measures how well the context retrieved by the RAG system aligns with the user’s query. It specifically evaluates whether the retrieved information is relevant and appropriate for the given query, ensuring that only essential information is included to address the query effectively.\n*   **Evaluation Approach**: Involves a two-step procedure: first, the identification of relevant sentences using semantic similarity measures to produce a relevance score for each sentence. Can be measured with smaller BERT-style models, embedding distances, or with LLMs. The approach involves estimating the value of context relevance by identifying sentences within the retrieved context that are directly relevant for answering the given question. This is followed by the quantification of overall context relevance, where the final score is calculated using the formula:\n\n*   “Is the passage returned relevant for answering the given query?”\n*   Measures how well the context retrieved by the RAG system aligns with the user’s query. It specifically evaluates whether the retrieved information is relevant and appropriate for the given query, ensuring that only essential information is included to address the query effectively.\n\nContext Relevance\\= Number of sentences that are relevant to the query within the retrieved context Total number of sentences in retrieved contextContext Relevance\\= Number of sentences that are relevant to the query within the retrieved context Total number of sentences in retrieved context\n\n*   **Examples**:\n    *   _High context relevance example_: For a question like “What is the capital of France?”, a highly relevant context would be “France, in Western Europe, encompasses medieval cities, alpine villages and Mediterranean beaches. Paris, its capital, is famed for its fashion houses, classical art museums including the Louvre and monuments like the Eiffel Tower.”\n    *   _Low context relevance example_: For the same question, a less relevant context would include additional, unrelated information such as “The country is also renowned for its wines and sophisticated cuisine. Lascaux’s ancient cave drawings, Lyon’s Roman theater and the vast Palace of Versailles attest to its rich history.”\n*   This metric ensures that the RAG system provides concise and directly related information, enhancing the efficiency and accuracy of the response given to a specific query.\n\n*   _High context relevance example_: For a question like “What is the capital of France?”, a highly relevant context would be “France, in Western Europe, encompasses medieval cities, alpine villages and Mediterranean beaches. Paris, its capital, is famed for its fashion houses, classical art museums including the Louvre and monuments like the Eiffel Tower.”\n*   _Low context relevance example_: For the same question, a less relevant context would include additional, unrelated information such as “The country is also renowned for its wines and sophisticated cuisine. Lascaux’s ancient cave drawings, Lyon’s Roman theater and the vast Palace of Versailles attest to its rich history.”",
    "order": 12,
    "orderInChapter": 1,
    "difficulty": 3,
    "estimatedMinutes": 13,
    "tags": [
      "nlpllms",
      "embedding",
      "bert",
      "llm"
    ],
    "metadata": {
      "hasCode": true,
      "hasMath": true,
      "hasImages": false,
      "wordCount": 2568,
      "contentLength": 111923
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#retrieval-metrics",
    "scrapedAt": "2025-12-28T11:54:28.277Z"
  },
  {
    "id": "ai-RAG-generation-metrics-13",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "Component-Wise Evaluation",
    "title": "Generation Metrics",
    "subtitle": "Component-Wise Evaluation",
    "contentHtml": "<ul>\n  <li>Evaluating the generation component of RAG in the context of LLMs involves assessing the ability of the system to seamlessly integrate retrieved information into coherent, contextually relevant, and linguistically accurate responses, ensuring a harmonious blend of retrieved data and generative language skills. Put simply, these metrics collectively provide a nuanced and multidimensional approach to evaluating RAG systems, emphasizing not just the retrieval of information but its contextual relevance, factual accuracy, and semantic alignment with user queries.</li>\n</ul>\n<h4 id=\"groundedness-aka-faithfulness\">Groundedness (a.k.a. Faithfulness)</h4>\n<ul>\n  <li><strong>Definition</strong>: Groundedness (also known as Faithfulness) evaluates the factual consistency of a generated answer against a given context. It is measured based on the alignment between the answer and the retrieved context, with scores ranging from 0 to 1. A higher score indicates better factual consistency.</li>\n  <li><strong>Evaluation Approach</strong>:\n    <ul>\n      <li>The faithfulness of a generated answer is determined by checking if all the atomic (stand-alone) claims made in the answer can be inferred from the provided context. The process involves identifying a set of atomic claims from the answer and cross-referencing each claim with the context to confirm if it can be inferred. The faithfulness score is calculated using the formula:</li>\n    </ul>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\"><span class=\"MathJax MathJax_FullWidth\" id=\"MathJax-Element-107-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>Faithfulness score</mtext><mo>=</mo><mfrac><mtext>Number of claims in the generated answer that can be inferred from the given context</mtext><mtext>Total number of claims in the generated answer</mtext></mfrac></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1059\" style=\"width: 100%; display: inline-block; min-width: 42.763em;\"><span style=\"display: inline-block; position: relative; width: 100%; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(3.596em, 1035.63em, 7.346em, -999.997em); top: -4.424em; left: 0em; width: 100%;\"><span class=\"mrow\" id=\"MathJax-Span-1060\"><span style=\"display: inline-block; position: relative; width: 100%; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1007.24em, 4.169em, -999.997em); top: -4.008em; left: 50%; margin-left: -3.643em;\"><span class=\"mtext\" id=\"MathJax-Span-1061\" style=\"font-family: STIXGeneral-Regular;\">Faithfulness score</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(2.503em, 1035.63em, 5.055em, -999.997em); top: -2.133em; left: 50%; margin-left: -17.81em;\"><span class=\"mo\" id=\"MathJax-Span-1062\" style=\"font-family: STIXGeneral-Regular;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-1063\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 34.378em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1034.27em, 4.378em, -999.997em); top: -4.685em; left: 50%; margin-left: -17.133em;\"><span class=\"mtext\" id=\"MathJax-Span-1064\" style=\"font-family: STIXGeneral-Regular;\">Number of claims in the generated answer that can be inferred from the given context</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1019.07em, 4.378em, -999.997em); top: -3.331em; left: 50%; margin-left: -9.529em;\"><span class=\"mtext\" id=\"MathJax-Span-1065\" style=\"font-family: STIXGeneral-Regular;\">Total number of claims in the generated answer</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1034.38em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 34.378em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.43em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -3.372em; border-left: 0px solid; width: 0px; height: 4.253em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>Faithfulness score</mtext><mo>=</mo><mfrac><mtext>Number of claims in the generated answer that can be inferred from the given context</mtext><mtext>Total number of claims in the generated answer</mtext></mfrac></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-107\">\\text{Faithfulness score} = \\frac{\\text{Number of claims in the generated answer that can be inferred from the given context}}{\\text{Total number of claims in the generated answer}}</script>\n  </li>\n  <li>\n    <p><strong>Example</strong> <a href=\"https://docs.ragas.io/en/latest/concepts/metrics/faithfulness.html\">(source)</a>: \n<em>Question</em>: Where and when was Einstein born?\n<em>Context</em>: Albert Einstein (born 14 March 1879) was a German-born theoretical physicist, widely held to be one of the greatest and most influential scientists of all time.</p>\n\n    <ul>\n      <li><strong>High faithfulness answer</strong>: Einstein was born in Germany on 14th March 1879.</li>\n      <li>\n        <p><strong>Low faithfulness answer</strong>: Einstein was born in Germany on 20th March 1879.</p>\n      </li>\n      <li>For the low faithfulness answer:\n        <ul>\n          <li><strong>Step 1</strong>: Break the generated answer into individual statements.\n            <ul>\n              <li>Statement 1: “Einstein was born in Germany.”</li>\n              <li>Statement 2: “Einstein was born on 20th March 1879.”</li>\n            </ul>\n          </li>\n          <li><strong>Step 2</strong>: Verify if each statement can be inferred from the given context.\n            <ul>\n              <li>Statement 1: Yes</li>\n              <li>Statement 2: No</li>\n            </ul>\n          </li>\n          <li>\n            <p><strong>Step 3</strong>: Calculate the faithfulness score using the formula.</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-108-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>Faithfulness</mtext><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mo>=</mo><mn>0.5</mn></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1066\" style=\"width: 11.253em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 9.378em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.68em, 1009.33em, 3.023em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1067\"><span class=\"mtext\" id=\"MathJax-Span-1068\" style=\"font-family: STIXGeneral-Regular;\">Faithfulness</span><span class=\"mo\" id=\"MathJax-Span-1069\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-1070\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-1071\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1000.47em, 4.169em, -999.997em); top: -3.331em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-1072\" style=\"font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1000.63em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.628em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1073\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-1074\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">0.5</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.872em; border-left: 0px solid; width: 0px; height: 2.566em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>Faithfulness</mtext><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mo>=</mo><mn>0.5</mn></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-108\">\\text{Faithfulness} = \\frac{1}{2} = 0.5</script>\n          </li>\n        </ul>\n      </li>\n    </ul>\n  </li>\n</ul>\n<ul>\n      <li>The faithfulness of a generated answer is determined by checking if all the atomic (stand-alone) claims made in the answer can be inferred from the provided context. The process involves identifying a set of atomic claims from the answer and cross-referencing each claim with the context to confirm if it can be inferred. The faithfulness score is calculated using the formula:</li>\n    </ul>\n<p><strong>Example</strong> <a href=\"https://docs.ragas.io/en/latest/concepts/metrics/faithfulness.html\">(source)</a>: \n<em>Question</em>: Where and when was Einstein born?\n<em>Context</em>: Albert Einstein (born 14 March 1879) was a German-born theoretical physicist, widely held to be one of the greatest and most influential scientists of all time.</p>\n<ul>\n      <li><strong>High faithfulness answer</strong>: Einstein was born in Germany on 14th March 1879.</li>\n      <li>\n        <p><strong>Low faithfulness answer</strong>: Einstein was born in Germany on 20th March 1879.</p>\n      </li>\n      <li>For the low faithfulness answer:\n        <ul>\n          <li><strong>Step 1</strong>: Break the generated answer into individual statements.\n            <ul>\n              <li>Statement 1: “Einstein was born in Germany.”</li>\n              <li>Statement 2: “Einstein was born on 20th March 1879.”</li>\n            </ul>\n          </li>\n          <li><strong>Step 2</strong>: Verify if each statement can be inferred from the given context.\n            <ul>\n              <li>Statement 1: Yes</li>\n              <li>Statement 2: No</li>\n            </ul>\n          </li>\n          <li>\n            <p><strong>Step 3</strong>: Calculate the faithfulness score using the formula.</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-108-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>Faithfulness</mtext><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mo>=</mo><mn>0.5</mn></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1066\" style=\"width: 11.253em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 9.378em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.68em, 1009.33em, 3.023em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1067\"><span class=\"mtext\" id=\"MathJax-Span-1068\" style=\"font-family: STIXGeneral-Regular;\">Faithfulness</span><span class=\"mo\" id=\"MathJax-Span-1069\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-1070\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-1071\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1000.47em, 4.169em, -999.997em); top: -3.331em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-1072\" style=\"font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1000.63em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.628em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1073\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-1074\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">0.5</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.872em; border-left: 0px solid; width: 0px; height: 2.566em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>Faithfulness</mtext><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mo>=</mo><mn>0.5</mn></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-108\">\\text{Faithfulness} = \\frac{1}{2} = 0.5</script>\n          </li>\n        </ul>\n      </li>\n    </ul>\n<p><strong>Low faithfulness answer</strong>: Einstein was born in Germany on 20th March 1879.</p>\n<ul>\n          <li><strong>Step 1</strong>: Break the generated answer into individual statements.\n            <ul>\n              <li>Statement 1: “Einstein was born in Germany.”</li>\n              <li>Statement 2: “Einstein was born on 20th March 1879.”</li>\n            </ul>\n          </li>\n          <li><strong>Step 2</strong>: Verify if each statement can be inferred from the given context.\n            <ul>\n              <li>Statement 1: Yes</li>\n              <li>Statement 2: No</li>\n            </ul>\n          </li>\n          <li>\n            <p><strong>Step 3</strong>: Calculate the faithfulness score using the formula.</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-108-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>Faithfulness</mtext><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mo>=</mo><mn>0.5</mn></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1066\" style=\"width: 11.253em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 9.378em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.68em, 1009.33em, 3.023em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1067\"><span class=\"mtext\" id=\"MathJax-Span-1068\" style=\"font-family: STIXGeneral-Regular;\">Faithfulness</span><span class=\"mo\" id=\"MathJax-Span-1069\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-1070\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-1071\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1000.47em, 4.169em, -999.997em); top: -3.331em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-1072\" style=\"font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1000.63em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.628em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1073\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-1074\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">0.5</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.872em; border-left: 0px solid; width: 0px; height: 2.566em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>Faithfulness</mtext><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mo>=</mo><mn>0.5</mn></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-108\">\\text{Faithfulness} = \\frac{1}{2} = 0.5</script>\n          </li>\n        </ul>\n<ul>\n              <li>Statement 1: “Einstein was born in Germany.”</li>\n              <li>Statement 2: “Einstein was born on 20th March 1879.”</li>\n            </ul>\n<ul>\n              <li>Statement 1: Yes</li>\n              <li>Statement 2: No</li>\n            </ul>\n<p><strong>Step 3</strong>: Calculate the faithfulness score using the formula.</p>\n<h4 id=\"answer-relevance\">Answer Relevance</h4>\n<ul>\n  <li><strong>Definition</strong>:\n    <ul>\n      <li>The Answer Relevance metric evaluates how closely the generated answer aligns with the given query/prompt. This assessment focuses on the pertinence of the response, penalizing answers that are incomplete or contain redundant information. Higher scores indicate better relevance. The overarching concept behind answer relevance is that if the answer correctly addresses the question, it is likely that the original question can be accurately reconstructed from the answer alone.</li>\n      <li>Answer relevance is reference free metric. If you’re looking to compare ground truth answer with generated answer refer to <a href=\"#answer-correctness\">Answer Correctness</a>.</li>\n      <li>The image below <a href=\"https://learn.deeplearning.ai/building-evaluating-advanced-rag/lesson/2/advanced-rag-pipeline\">(source)</a> shows the output format of Answer Relevance.</li>\n    </ul>\n\n    <p><img src=\"/primers/ai/assets/RAG/7.png\" alt=\"\"></p>\n  </li>\n  <li><strong>Evaluation Approach</strong>:\n    <ul>\n      <li>Answer Relevance is quantified by calculating the mean cosine similarity between the original question and a set of generated questions based on the provided answer. Specifically, the metric is defined as follows:</li>\n    </ul>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\"><span class=\"MathJax\" id=\"MathJax-Element-109-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><merror><mtext>\\text{Answer&amp;#xA0;Relevance}&amp;#xA0;=&amp;#xA0;\\frac{1}{N}&amp;#xA0;\\sum_{i=1}^N&amp;#xA0;\\cos&amp;#xA0;(E_{g_i},&amp;#xA0;E_o)&amp;#xA0;\\\\=&amp;#xA0;\\frac{1}{N}&amp;#xA0;\\sum_{i=1}^N&amp;#xA0;\\frac{E_{g_i}&amp;#xA0;\\cdot&amp;#xA0;E_o}{\\left\\mid&amp;#xA0;E_{g_i}\\right\\mid&amp;#xA0;\\left\\mid&amp;#xA0;E_o\\right\\mid}</mtext></merror></math>\" role=\"presentation\" style=\"position: relative;\"><span class=\"math\" id=\"MathJax-Span-1075\" aria-hidden=\"true\" style=\"vertical-align: 0.211em;\"><span class=\"noError\" id=\"MathJax-Span-1076\" style=\"display: inline-block;\">\\text{Answer&nbsp;Relevance}&nbsp;=&nbsp;\\frac{1}{N}&nbsp;\\sum_{i=1}^N&nbsp;\\cos&nbsp;(E_{g_i},&nbsp;E_o)&nbsp;\\\\<br>=&nbsp;\\frac{1}{N}&nbsp;\\sum_{i=1}^N&nbsp;\\frac{E_{g_i}&nbsp;\\cdot&nbsp;E_o}{\\left\\mid&nbsp;E_{g_i}\\right\\mid&nbsp;\\left\\mid&nbsp;E_o\\right\\mid}</span></span><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><merror><mtext>\\text{Answer&nbsp;Relevance}&nbsp;=&nbsp;\\frac{1}{N}&nbsp;\\sum_{i=1}^N&nbsp;\\cos&nbsp;(E_{g_i},&nbsp;E_o)&nbsp;\\\\=&nbsp;\\frac{1}{N}&nbsp;\\sum_{i=1}^N&nbsp;\\frac{E_{g_i}&nbsp;\\cdot&nbsp;E_o}{\\left\\mid&nbsp;E_{g_i}\\right\\mid&nbsp;\\left\\mid&nbsp;E_o\\right\\mid}</mtext></merror></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-109\">\\text{Answer Relevance} = \\frac{1}{N} \\sum_{i=1}^N \\cos (E_{g_i}, E_o) \\\\\n= \\frac{1}{N} \\sum_{i=1}^N \\frac{E_{g_i} \\cdot E_o}{\\left\\mid E_{g_i}\\right\\mid \\left\\mid E_o\\right\\mid}</script>\n\n    <ul>\n      <li>where:\n        <ul>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-110-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>E</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>g</mi><mi>i</mi></msub></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1077\" style=\"width: 1.513em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.253em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1001.25em, 2.607em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1078\"><span class=\"msubsup\" id=\"MathJax-Span-1079\"><span style=\"display: inline-block; position: relative; width: 1.253em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.63em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1080\" style=\"font-family: STIXGeneral-Italic;\">E<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.628em;\"><span class=\"texatom\" id=\"MathJax-Span-1081\"><span class=\"mrow\" id=\"MathJax-Span-1082\"><span class=\"msubsup\" id=\"MathJax-Span-1083\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.544em, 1000.32em, 4.326em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1084\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">g</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.367em;\"><span class=\"mi\" id=\"MathJax-Span-1085\" style=\"font-size: 50%; font-family: STIXGeneral-Italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.316em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>E</mi><mrow class=\"MJX-TeXAtom-ORD\"><msub><mi>g</mi><mi>i</mi></msub></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-110\">E_{g_i}</script> is the embedding of the generated question <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-111-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>i</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1086\" style=\"width: 0.315em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.263em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.26em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1087\"><span class=\"mi\" id=\"MathJax-Span-1088\" style=\"font-family: STIXGeneral-Italic;\">i</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>i</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-111\">i</script>.</li>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-112-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>E</mi><mi>o</mi></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1089\" style=\"width: 1.253em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.044em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1001.04em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1090\"><span class=\"msubsup\" id=\"MathJax-Span-1091\"><span style=\"display: inline-block; position: relative; width: 1.044em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.63em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1092\" style=\"font-family: STIXGeneral-Italic;\">E<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.628em;\"><span class=\"mi\" id=\"MathJax-Span-1093\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">o</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>E</mi><mi>o</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-112\">E_o</script> is the embedding of the original question.</li>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-113-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>N</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1094\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1095\"><span class=\"mi\" id=\"MathJax-Span-1096\" style=\"font-family: STIXGeneral-Italic;\">N<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>N</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-113\">N</script> is the number of generated questions, typically set to 3 by default.</li>\n        </ul>\n      </li>\n      <li>It is important to note that although the score generally ranges from 0 to 1, it is not strictly limited to this range due to the cosine similarity measure, which can range from -1 to 1. This metric does not rely on a reference answer and is purely focused on the relevance of the generated answer to the original question. If comparing the ground truth answer with the generated answer is required, one should refer to the “answer correctness” metric.</li>\n      <li>An answer is considered relevant if it directly and appropriately responds to the original question. This metric does not consider the factual accuracy of the answer but rather penalizes cases where the answer is incomplete or contains unnecessary details. The process involves prompting a Large Language Model (LLM) to generate appropriate questions based on the provided answer and then measuring the mean cosine similarity between these questions and the original question. The idea is that a highly relevant answer should allow the LLM to generate questions that closely align with the original question.</li>\n    </ul>\n  </li>\n  <li><strong>Example</strong>:\n    <ul>\n      <li><strong>Question</strong>: Where is France and what is its capital?</li>\n      <li><strong>Low relevance answer</strong>: France is in Western Europe.</li>\n      <li><strong>High relevance answer</strong>: France is in Western Europe and Paris is its capital.</li>\n    </ul>\n  </li>\n  <li><strong>Calculation Steps</strong>:\n    <ol>\n      <li><strong>Step 1</strong>: Generate <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-114-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>n</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1097\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1098\"><span class=\"mi\" id=\"MathJax-Span-1099\" style=\"font-family: STIXGeneral-Italic;\">n</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>n</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-114\">n</script> variants of the question from the provided answer using an LLM. For example:\n        <ul>\n          <li>Question 1: “In which part of Europe is France located?”</li>\n          <li>Question 2: “What is the geographical location of France within Europe?”</li>\n          <li>Question 3: “Can you identify the region of Europe where France is situated?”</li>\n        </ul>\n      </li>\n      <li><strong>Step 2</strong>: Calculate the mean cosine similarity between these generated questions and the original question.</li>\n    </ol>\n  </li>\n</ul>\n<ul>\n      <li>The Answer Relevance metric evaluates how closely the generated answer aligns with the given query/prompt. This assessment focuses on the pertinence of the response, penalizing answers that are incomplete or contain redundant information. Higher scores indicate better relevance. The overarching concept behind answer relevance is that if the answer correctly addresses the question, it is likely that the original question can be accurately reconstructed from the answer alone.</li>\n      <li>Answer relevance is reference free metric. If you’re looking to compare ground truth answer with generated answer refer to <a href=\"#answer-correctness\">Answer Correctness</a>.</li>\n      <li>The image below <a href=\"https://learn.deeplearning.ai/building-evaluating-advanced-rag/lesson/2/advanced-rag-pipeline\">(source)</a> shows the output format of Answer Relevance.</li>\n    </ul>\n<p><img src=\"/primers/ai/assets/RAG/7.png\" alt=\"\"></p>\n<ul>\n      <li>Answer Relevance is quantified by calculating the mean cosine similarity between the original question and a set of generated questions based on the provided answer. Specifically, the metric is defined as follows:</li>\n    </ul>\n<ul>\n      <li>where:\n        <ul>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-110-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>E</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>g</mi><mi>i</mi></msub></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1077\" style=\"width: 1.513em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.253em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1001.25em, 2.607em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1078\"><span class=\"msubsup\" id=\"MathJax-Span-1079\"><span style=\"display: inline-block; position: relative; width: 1.253em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.63em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1080\" style=\"font-family: STIXGeneral-Italic;\">E<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.628em;\"><span class=\"texatom\" id=\"MathJax-Span-1081\"><span class=\"mrow\" id=\"MathJax-Span-1082\"><span class=\"msubsup\" id=\"MathJax-Span-1083\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.544em, 1000.32em, 4.326em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1084\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">g</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.367em;\"><span class=\"mi\" id=\"MathJax-Span-1085\" style=\"font-size: 50%; font-family: STIXGeneral-Italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.316em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>E</mi><mrow class=\"MJX-TeXAtom-ORD\"><msub><mi>g</mi><mi>i</mi></msub></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-110\">E_{g_i}</script> is the embedding of the generated question <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-111-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>i</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1086\" style=\"width: 0.315em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.263em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.26em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1087\"><span class=\"mi\" id=\"MathJax-Span-1088\" style=\"font-family: STIXGeneral-Italic;\">i</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>i</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-111\">i</script>.</li>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-112-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>E</mi><mi>o</mi></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1089\" style=\"width: 1.253em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.044em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1001.04em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1090\"><span class=\"msubsup\" id=\"MathJax-Span-1091\"><span style=\"display: inline-block; position: relative; width: 1.044em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.63em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1092\" style=\"font-family: STIXGeneral-Italic;\">E<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.628em;\"><span class=\"mi\" id=\"MathJax-Span-1093\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">o</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>E</mi><mi>o</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-112\">E_o</script> is the embedding of the original question.</li>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-113-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>N</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1094\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1095\"><span class=\"mi\" id=\"MathJax-Span-1096\" style=\"font-family: STIXGeneral-Italic;\">N<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>N</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-113\">N</script> is the number of generated questions, typically set to 3 by default.</li>\n        </ul>\n      </li>\n      <li>It is important to note that although the score generally ranges from 0 to 1, it is not strictly limited to this range due to the cosine similarity measure, which can range from -1 to 1. This metric does not rely on a reference answer and is purely focused on the relevance of the generated answer to the original question. If comparing the ground truth answer with the generated answer is required, one should refer to the “answer correctness” metric.</li>\n      <li>An answer is considered relevant if it directly and appropriately responds to the original question. This metric does not consider the factual accuracy of the answer but rather penalizes cases where the answer is incomplete or contains unnecessary details. The process involves prompting a Large Language Model (LLM) to generate appropriate questions based on the provided answer and then measuring the mean cosine similarity between these questions and the original question. The idea is that a highly relevant answer should allow the LLM to generate questions that closely align with the original question.</li>\n    </ul>\n<ul>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-110-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>E</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>g</mi><mi>i</mi></msub></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1077\" style=\"width: 1.513em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.253em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1001.25em, 2.607em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1078\"><span class=\"msubsup\" id=\"MathJax-Span-1079\"><span style=\"display: inline-block; position: relative; width: 1.253em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.63em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1080\" style=\"font-family: STIXGeneral-Italic;\">E<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.628em;\"><span class=\"texatom\" id=\"MathJax-Span-1081\"><span class=\"mrow\" id=\"MathJax-Span-1082\"><span class=\"msubsup\" id=\"MathJax-Span-1083\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.544em, 1000.32em, 4.326em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1084\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">g</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.367em;\"><span class=\"mi\" id=\"MathJax-Span-1085\" style=\"font-size: 50%; font-family: STIXGeneral-Italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.316em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>E</mi><mrow class=\"MJX-TeXAtom-ORD\"><msub><mi>g</mi><mi>i</mi></msub></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-110\">E_{g_i}</script> is the embedding of the generated question <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-111-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>i</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1086\" style=\"width: 0.315em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.263em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.26em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1087\"><span class=\"mi\" id=\"MathJax-Span-1088\" style=\"font-family: STIXGeneral-Italic;\">i</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>i</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-111\">i</script>.</li>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-112-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>E</mi><mi>o</mi></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1089\" style=\"width: 1.253em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.044em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1001.04em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1090\"><span class=\"msubsup\" id=\"MathJax-Span-1091\"><span style=\"display: inline-block; position: relative; width: 1.044em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.63em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1092\" style=\"font-family: STIXGeneral-Italic;\">E<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.628em;\"><span class=\"mi\" id=\"MathJax-Span-1093\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">o</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>E</mi><mi>o</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-112\">E_o</script> is the embedding of the original question.</li>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-113-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>N</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1094\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1095\"><span class=\"mi\" id=\"MathJax-Span-1096\" style=\"font-family: STIXGeneral-Italic;\">N<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>N</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-113\">N</script> is the number of generated questions, typically set to 3 by default.</li>\n        </ul>\n<ul>\n      <li><strong>Question</strong>: Where is France and what is its capital?</li>\n      <li><strong>Low relevance answer</strong>: France is in Western Europe.</li>\n      <li><strong>High relevance answer</strong>: France is in Western Europe and Paris is its capital.</li>\n    </ul>\n<ol>\n      <li><strong>Step 1</strong>: Generate <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-114-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>n</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1097\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1098\"><span class=\"mi\" id=\"MathJax-Span-1099\" style=\"font-family: STIXGeneral-Italic;\">n</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>n</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-114\">n</script> variants of the question from the provided answer using an LLM. For example:\n        <ul>\n          <li>Question 1: “In which part of Europe is France located?”</li>\n          <li>Question 2: “What is the geographical location of France within Europe?”</li>\n          <li>Question 3: “Can you identify the region of Europe where France is situated?”</li>\n        </ul>\n      </li>\n      <li><strong>Step 2</strong>: Calculate the mean cosine similarity between these generated questions and the original question.</li>\n    </ol>\n<ul>\n          <li>Question 1: “In which part of Europe is France located?”</li>\n          <li>Question 2: “What is the geographical location of France within Europe?”</li>\n          <li>Question 3: “Can you identify the region of Europe where France is situated?”</li>\n        </ul>\n<h4 id=\"answer-semantic-similarity\">Answer Semantic Similarity</h4>\n<ul>\n  <li><strong>Category</strong>: Answer Quality and Semantic Alignment</li>\n  <li><strong>Requirement</strong>: Access to ground truth answers is necessary to evaluate the semantic similarity of generated responses accurately.</li>\n  <li><strong>Definition</strong>: Evaluates the degree of semantic similarity between the generated answer by the RAG system and the ground truth. This metric specifically assesses how closely the meaning of the generated answer mirrors that of the ground truth.</li>\n  <li><strong>Measurement Methods</strong>: This metric is measured using cross-encoder models designed to calculate the semantic similarity score. These models analyze the semantic content of both the generated answer and the ground truth.</li>\n  <li>\n    <p><strong>Evaluation Approach</strong>: The approach involves comparing the generated answer with the ground truth to determine the extent of semantic overlap. The semantic similarity is quantified on a scale from 0 to 1, where higher scores indicate a greater alignment between the generated answer and the ground truth. The formula for Answer Semantic Similarity is implicitly based on the evaluation of semantic overlap rather than a direct formula.</p>\n  </li>\n  <li><strong>BERTScore</strong>:\n    <ul>\n      <li>Uses contextual embeddings from pre-trained BERT models to match tokens in the candidate and reference text.</li>\n      <li>Computes precision, recall, and F1 scores by aligning embeddings based on cosine similarity, capturing nuanced semantic overlap.</li>\n    </ul>\n  </li>\n  <li><strong>MoverScore</strong>:\n    <ul>\n      <li>Extends BERTScore by incorporating Earth Mover’s Distance (EMD) to assess the minimal semantic “effort” needed to transform one text into another.</li>\n      <li>Leverages both contextual embeddings and IDF weighting to emphasize important content over common filler words.</li>\n    </ul>\n  </li>\n  <li><strong>Advantages of MoverScore over BERTScore</strong>:\n    <ul>\n      <li>Better captures the global semantic flow between texts by considering word importance and distribution, not just local alignment.</li>\n      <li>More robust in handling paraphrased or reordered sentences, where BERTScore may undervalue semantic similarity due to token-level matching.</li>\n    </ul>\n  </li>\n  <li><strong>Example</strong>:\n    <ul>\n      <li><strong>Ground truth</strong>: Albert Einstein’s theory of relativity revolutionized our understanding of the universe.</li>\n      <li><strong>High similarity answer</strong>: Einstein’s groundbreaking theory of relativity transformed our comprehension of the cosmos.</li>\n      <li><strong>Low similarity answer</strong>: Isaac Newton’s laws of motion greatly influenced classical physics.</li>\n    </ul>\n  </li>\n  <li>In this metric, a higher score reflects a better quality of the generated response in terms of its semantic closeness to the ground truth, indicating a more accurate and contextually relevant answer.</li>\n</ul>\n<p><strong>Evaluation Approach</strong>: The approach involves comparing the generated answer with the ground truth to determine the extent of semantic overlap. The semantic similarity is quantified on a scale from 0 to 1, where higher scores indicate a greater alignment between the generated answer and the ground truth. The formula for Answer Semantic Similarity is implicitly based on the evaluation of semantic overlap rather than a direct formula.</p>\n<ul>\n      <li>Uses contextual embeddings from pre-trained BERT models to match tokens in the candidate and reference text.</li>\n      <li>Computes precision, recall, and F1 scores by aligning embeddings based on cosine similarity, capturing nuanced semantic overlap.</li>\n    </ul>\n<ul>\n      <li>Extends BERTScore by incorporating Earth Mover’s Distance (EMD) to assess the minimal semantic “effort” needed to transform one text into another.</li>\n      <li>Leverages both contextual embeddings and IDF weighting to emphasize important content over common filler words.</li>\n    </ul>\n<ul>\n      <li>Better captures the global semantic flow between texts by considering word importance and distribution, not just local alignment.</li>\n      <li>More robust in handling paraphrased or reordered sentences, where BERTScore may undervalue semantic similarity due to token-level matching.</li>\n    </ul>\n<ul>\n      <li><strong>Ground truth</strong>: Albert Einstein’s theory of relativity revolutionized our understanding of the universe.</li>\n      <li><strong>High similarity answer</strong>: Einstein’s groundbreaking theory of relativity transformed our comprehension of the cosmos.</li>\n      <li><strong>Low similarity answer</strong>: Isaac Newton’s laws of motion greatly influenced classical physics.</li>\n    </ul>\n<h4 id=\"bleu-score\">BLEU Score</h4>\n<ul>\n  <li><strong>Category</strong>: N-gram Precision-Based Evaluation</li>\n  <li><strong>Requirement</strong>: Access to ground truth references is necessary to evaluate the BLEU score.</li>\n  <li><strong>Definition</strong>: BLEU (Bilingual Evaluation Understudy) is a metric that evaluates the quality of text by comparing a candidate translation to one or more reference translations. It measures the precision of n-grams in the candidate text that appear in the reference texts, with a brevity penalty to penalize overly short translations.</li>\n  <li><strong>Measurement Methods</strong>: BLEU calculates modified n-gram precision for n-grams up to a specified length (commonly 4). It also applies a brevity penalty to account for short candidate translations that might otherwise score artificially high.</li>\n  <li>\n    <p><strong>Evaluation Approach</strong>: The BLEU score is computed using the formula:</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-115-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>BLEU</mtext><mo>=</mo><mtext>BP</mtext><mo>&amp;#x00D7;</mo><mi>exp</mi><mo>&amp;#x2061;</mo><mrow><mo>(</mo><mrow><munderover><mo>&amp;#x2211;</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>n</mi><mo>=</mo><mn>1</mn></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi></mrow></munderover><msub><mi>w</mi><mi>n</mi></msub><mi>log</mi><mo>&amp;#x2061;</mo><msub><mi>p</mi><mi>n</mi></msub></mrow><mo>)</mo></mrow></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1100\" style=\"width: 17.346em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 14.43em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(2.19em, 1014.33em, 5.576em, -999.997em); top: -4.112em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1101\"><span class=\"mtext\" id=\"MathJax-Span-1102\" style=\"font-family: STIXGeneral-Regular;\">BLEU</span><span class=\"mo\" id=\"MathJax-Span-1103\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mtext\" id=\"MathJax-Span-1104\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">BP</span><span class=\"mo\" id=\"MathJax-Span-1105\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">×</span><span class=\"mi\" id=\"MathJax-Span-1106\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">exp</span><span class=\"mo\" id=\"MathJax-Span-1107\"></span><span class=\"mrow\" id=\"MathJax-Span-1108\"><span class=\"mo\" id=\"MathJax-Span-1109\" style=\"vertical-align: -0.779em;\"><span style=\"font-family: STIXSizeFourSym;\">(</span></span><span class=\"mrow\" id=\"MathJax-Span-1110\"><span class=\"munderover\" id=\"MathJax-Span-1111\"><span style=\"display: inline-block; position: relative; width: 1.305em; height: 0px;\"><span style=\"position: absolute; clip: rect(2.867em, 1001.2em, 4.638em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mo\" id=\"MathJax-Span-1112\" style=\"font-family: STIXSizeOneSym; vertical-align: -0.518em;\">∑</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1001.1em, 4.273em, -999.997em); top: -2.862em; left: 0.055em;\"><span class=\"texatom\" id=\"MathJax-Span-1113\"><span class=\"mrow\" id=\"MathJax-Span-1114\"><span class=\"mi\" id=\"MathJax-Span-1115\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">n</span><span class=\"mo\" id=\"MathJax-Span-1116\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">=</span><span class=\"mn\" id=\"MathJax-Span-1117\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.284em, 1000.52em, 4.169em, -999.997em); top: -5.206em; left: 0.367em;\"><span class=\"texatom\" id=\"MathJax-Span-1118\"><span class=\"mrow\" id=\"MathJax-Span-1119\"><span class=\"mi\" id=\"MathJax-Span-1120\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">N<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"msubsup\" id=\"MathJax-Span-1121\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 1.096em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.63em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1122\" style=\"font-family: STIXGeneral-Italic;\">w</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.68em;\"><span class=\"mi\" id=\"MathJax-Span-1123\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">n</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mi\" id=\"MathJax-Span-1124\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">log</span><span class=\"mo\" id=\"MathJax-Span-1125\"></span><span class=\"msubsup\" id=\"MathJax-Span-1126\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 0.94em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.378em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1127\" style=\"font-family: STIXGeneral-Italic;\">p</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"mi\" id=\"MathJax-Span-1128\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">n</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1129\" style=\"vertical-align: -0.779em;\"><span style=\"font-family: STIXSizeFourSym;\">)</span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.117em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -1.622em; border-left: 0px solid; width: 0px; height: 3.816em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>BLEU</mtext><mo>=</mo><mtext>BP</mtext><mo>×</mo><mi>exp</mi><mo>⁡</mo><mrow><mo>(</mo><mrow><munderover><mo>∑</mo><mrow class=\"MJX-TeXAtom-ORD\"><mi>n</mi><mo>=</mo><mn>1</mn></mrow><mrow class=\"MJX-TeXAtom-ORD\"><mi>N</mi></mrow></munderover><msub><mi>w</mi><mi>n</mi></msub><mi>log</mi><mo>⁡</mo><msub><mi>p</mi><mi>n</mi></msub></mrow><mo>)</mo></mrow></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-115\">\\text{BLEU} = \\text{BP} \\times \\exp\\left( \\sum_{n=1}^{N} w_n \\log p_n \\right)</script>\n\n    <ul>\n      <li>where:\n        <ul>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-116-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>BP</mtext></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1130\" style=\"width: 1.461em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.201em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1001.2em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1131\"><span class=\"mtext\" id=\"MathJax-Span-1132\" style=\"font-family: STIXGeneral-Regular;\">BP</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mtext>BP</mtext></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-116\">\\text{BP}</script> is the brevity penalty.</li>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-117-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>p</mi><mi>n</mi></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1133\" style=\"width: 1.148em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.94em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.565em, 1000.94em, 2.503em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1134\"><span class=\"msubsup\" id=\"MathJax-Span-1135\"><span style=\"display: inline-block; position: relative; width: 0.94em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.378em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1136\" style=\"font-family: STIXGeneral-Italic;\">p</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"mi\" id=\"MathJax-Span-1137\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">n</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.878em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>p</mi><mi>n</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-117\">p_n</script> is the modified n-gram precision.</li>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-118-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>w</mi><mi>n</mi></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1138\" style=\"width: 1.357em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.096em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.565em, 1001.1em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1139\"><span class=\"msubsup\" id=\"MathJax-Span-1140\"><span style=\"display: inline-block; position: relative; width: 1.096em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.63em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1141\" style=\"font-family: STIXGeneral-Italic;\">w</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.68em;\"><span class=\"mi\" id=\"MathJax-Span-1142\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">n</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.816em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>w</mi><mi>n</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-118\">w_n</script> is the weight for each n-gram (typically uniform).</li>\n        </ul>\n      </li>\n    </ul>\n  </li>\n  <li><strong>Example</strong>:\n    <ul>\n      <li><strong>Reference</strong>: The cat is on the mat.</li>\n      <li><strong>Candidate</strong>: The cat is on mat.</li>\n      <li><strong>Unigram Precision</strong>: 5 matches out of 5 words = 1.0</li>\n      <li><strong>Bigram Precision</strong>: 4 matches out of 4 bigrams = 1.0</li>\n      <li><strong>Trigram Precision</strong>: 3 matches out of 3 trigrams = 1.0</li>\n      <li><strong>4-gram Precision</strong>: 2 matches out of 2 four-grams = 1.0</li>\n      <li><strong>Brevity Penalty</strong>: Applied due to shorter length.</li>\n      <li><strong>BLEU Score</strong>: Calculated by combining precisions and brevity penalty.</li>\n      <li>In this example, despite high n-gram precision, the brevity penalty reduces the BLEU score to account for the missing word “the” before “mat.”</li>\n    </ul>\n  </li>\n</ul>\n<p><strong>Evaluation Approach</strong>: The BLEU score is computed using the formula:</p>\n<ul>\n      <li>where:\n        <ul>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-116-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>BP</mtext></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1130\" style=\"width: 1.461em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.201em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1001.2em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1131\"><span class=\"mtext\" id=\"MathJax-Span-1132\" style=\"font-family: STIXGeneral-Regular;\">BP</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mtext>BP</mtext></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-116\">\\text{BP}</script> is the brevity penalty.</li>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-117-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>p</mi><mi>n</mi></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1133\" style=\"width: 1.148em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.94em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.565em, 1000.94em, 2.503em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1134\"><span class=\"msubsup\" id=\"MathJax-Span-1135\"><span style=\"display: inline-block; position: relative; width: 0.94em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.378em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1136\" style=\"font-family: STIXGeneral-Italic;\">p</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"mi\" id=\"MathJax-Span-1137\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">n</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.878em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>p</mi><mi>n</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-117\">p_n</script> is the modified n-gram precision.</li>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-118-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>w</mi><mi>n</mi></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1138\" style=\"width: 1.357em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.096em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.565em, 1001.1em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1139\"><span class=\"msubsup\" id=\"MathJax-Span-1140\"><span style=\"display: inline-block; position: relative; width: 1.096em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.63em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1141\" style=\"font-family: STIXGeneral-Italic;\">w</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.68em;\"><span class=\"mi\" id=\"MathJax-Span-1142\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">n</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.816em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>w</mi><mi>n</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-118\">w_n</script> is the weight for each n-gram (typically uniform).</li>\n        </ul>\n      </li>\n    </ul>\n<ul>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-116-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>BP</mtext></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1130\" style=\"width: 1.461em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.201em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1001.2em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1131\"><span class=\"mtext\" id=\"MathJax-Span-1132\" style=\"font-family: STIXGeneral-Regular;\">BP</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mtext>BP</mtext></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-116\">\\text{BP}</script> is the brevity penalty.</li>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-117-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>p</mi><mi>n</mi></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1133\" style=\"width: 1.148em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.94em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.565em, 1000.94em, 2.503em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1134\"><span class=\"msubsup\" id=\"MathJax-Span-1135\"><span style=\"display: inline-block; position: relative; width: 0.94em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.378em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1136\" style=\"font-family: STIXGeneral-Italic;\">p</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"mi\" id=\"MathJax-Span-1137\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">n</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.878em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>p</mi><mi>n</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-117\">p_n</script> is the modified n-gram precision.</li>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-118-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>w</mi><mi>n</mi></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1138\" style=\"width: 1.357em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.096em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.565em, 1001.1em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1139\"><span class=\"msubsup\" id=\"MathJax-Span-1140\"><span style=\"display: inline-block; position: relative; width: 1.096em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.63em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1141\" style=\"font-family: STIXGeneral-Italic;\">w</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.68em;\"><span class=\"mi\" id=\"MathJax-Span-1142\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">n</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.816em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>w</mi><mi>n</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-118\">w_n</script> is the weight for each n-gram (typically uniform).</li>\n        </ul>\n<ul>\n      <li><strong>Reference</strong>: The cat is on the mat.</li>\n      <li><strong>Candidate</strong>: The cat is on mat.</li>\n      <li><strong>Unigram Precision</strong>: 5 matches out of 5 words = 1.0</li>\n      <li><strong>Bigram Precision</strong>: 4 matches out of 4 bigrams = 1.0</li>\n      <li><strong>Trigram Precision</strong>: 3 matches out of 3 trigrams = 1.0</li>\n      <li><strong>4-gram Precision</strong>: 2 matches out of 2 four-grams = 1.0</li>\n      <li><strong>Brevity Penalty</strong>: Applied due to shorter length.</li>\n      <li><strong>BLEU Score</strong>: Calculated by combining precisions and brevity penalty.</li>\n      <li>In this example, despite high n-gram precision, the brevity penalty reduces the BLEU score to account for the missing word “the” before “mat.”</li>\n    </ul>\n<h4 id=\"rouge-score\">ROUGE Score</h4>\n<ul>\n  <li><strong>Category</strong>: Recall-Oriented N-gram Evaluation</li>\n  <li><strong>Requirement</strong>: Access to ground truth references is necessary to evaluate the ROUGE score.</li>\n  <li><strong>Definition</strong>: ROUGE (Recall-Oriented Understudy for Gisting Evaluation) is a set of metrics used to evaluate automatic summarization and machine translation by comparing the overlap of n-grams between the candidate and reference texts.</li>\n  <li><strong>Measurement Methods</strong>: Common variants include:\n    <ul>\n      <li><strong>ROUGE-N</strong>: Measures overlap of n-grams.</li>\n      <li><strong>ROUGE-L</strong>: Measures the longest common subsequence.</li>\n      <li><strong>ROUGE-S</strong>: Measures skip-bigram overlap.</li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Evaluation Approach</strong>: For ROUGE-N, the recall is calculated as:</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-119-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>ROUGE-N</mtext><mo>=</mo><mfrac><mtext>Number of matching n-grams</mtext><mtext>Total number of n-grams in reference</mtext></mfrac></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1143\" style=\"width: 25.263em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 21.044em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.68em, 1021.04em, 3.232em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1144\"><span class=\"mtext\" id=\"MathJax-Span-1145\" style=\"font-family: STIXGeneral-Regular;\">ROUGE-N</span><span class=\"mo\" id=\"MathJax-Span-1146\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-1147\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 15.159em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1011.83em, 4.378em, -999.997em); top: -4.685em; left: 50%; margin-left: -5.935em;\"><span class=\"mtext\" id=\"MathJax-Span-1148\" style=\"font-family: STIXGeneral-Regular;\">Number of matching n-grams</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1015em, 4.378em, -999.997em); top: -3.331em; left: 50%; margin-left: -7.497em;\"><span class=\"mtext\" id=\"MathJax-Span-1149\" style=\"font-family: STIXGeneral-Regular;\">Total number of n-grams in reference</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1015.16em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 15.159em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -1.122em; border-left: 0px solid; width: 0px; height: 2.878em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>ROUGE-N</mtext><mo>=</mo><mfrac><mtext>Number of matching n-grams</mtext><mtext>Total number of n-grams in reference</mtext></mfrac></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-119\">\\text{ROUGE-N} = \\frac{\\text{Number of matching n-grams}}{\\text{Total number of n-grams in reference}}</script>\n  </li>\n  <li><strong>Example</strong>:\n    <ul>\n      <li><strong>Reference</strong>: “The cat is on the mat.”</li>\n      <li><strong>Candidate</strong>: “The cat is on mat.”</li>\n      <li><strong>ROUGE-1 (Unigram) Recall</strong>: 5 matches out of 6 unigrams = 0.833</li>\n      <li><strong>ROUGE-2 (Bigram) Recall</strong>: 4 matches out of 5 bigrams = 0.8</li>\n      <li>In this example, the candidate misses the unigram “the” before “mat,” affecting the recall scores.</li>\n    </ul>\n  </li>\n</ul>\n<ul>\n      <li><strong>ROUGE-N</strong>: Measures overlap of n-grams.</li>\n      <li><strong>ROUGE-L</strong>: Measures the longest common subsequence.</li>\n      <li><strong>ROUGE-S</strong>: Measures skip-bigram overlap.</li>\n    </ul>\n<p><strong>Evaluation Approach</strong>: For ROUGE-N, the recall is calculated as:</p>\n<ul>\n      <li><strong>Reference</strong>: “The cat is on the mat.”</li>\n      <li><strong>Candidate</strong>: “The cat is on mat.”</li>\n      <li><strong>ROUGE-1 (Unigram) Recall</strong>: 5 matches out of 6 unigrams = 0.833</li>\n      <li><strong>ROUGE-2 (Bigram) Recall</strong>: 4 matches out of 5 bigrams = 0.8</li>\n      <li>In this example, the candidate misses the unigram “the” before “mat,” affecting the recall scores.</li>\n    </ul>\n<h4 id=\"string-presence\">String Presence</h4>\n<ul>\n  <li><strong>Category</strong>: Keyword or Phrase Matching</li>\n  <li><strong>Requirement</strong>: Access to ground truth references is necessary to evaluate string presence.</li>\n  <li><strong>Definition</strong>: The String Presence metric checks if the generated response contains specific reference text, such as certain keywords or phrases. It is useful in scenarios where ensuring the inclusion of particular content is essential.</li>\n  <li><strong>Measurement Methods</strong>: This is a binary metric that returns 1 if the reference string is present in the response and 0 otherwise.</li>\n  <li><strong>Evaluation Approach</strong>: The presence of the reference string is verified within the candidate response.</li>\n  <li><strong>Example</strong>:\n    <ul>\n      <li><strong>Reference</strong>: “climate change”</li>\n      <li><strong>Candidate</strong>: The recent study highlights the impacts of climate change on polar bears.</li>\n      <li><strong>String Presence Score</strong>: 1 (since “climate change” is present in the candidate).</li>\n    </ul>\n  </li>\n</ul>\n<ul>\n      <li><strong>Reference</strong>: “climate change”</li>\n      <li><strong>Candidate</strong>: The recent study highlights the impacts of climate change on polar bears.</li>\n      <li><strong>String Presence Score</strong>: 1 (since “climate change” is present in the candidate).</li>\n    </ul>\n<h4 id=\"exact-match\">Exact Match</h4>\n<ul>\n  <li><strong>Category</strong>: Strict Matching Evaluation</li>\n  <li><strong>Requirement</strong>: Access to ground truth references is necessary to evaluate exact matches.</li>\n  <li><strong>Definition</strong>: The Exact Match metric assesses whether the generated response is identical to the reference text. It is particularly useful in scenarios requiring precise outputs, such as predefined answers or specific commands.</li>\n  <li><strong>Measurement Methods</strong>: This binary metric returns 1 if the candidate text matches the reference text exactly and 0 otherwise.</li>\n  <li><strong>Evaluation Approach</strong>: A direct comparison is made between the candidate and reference texts.</li>\n  <li><strong>Example</strong>:\n    <ul>\n      <li><strong>Reference</strong>: <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-120-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>E</mi><mo>=</mo><mi>m</mi><msup><mi>c</mi><mn>2</mn></msup></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1150\" style=\"width: 4.221em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 3.492em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.201em, 1003.49em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1151\"><span class=\"mi\" id=\"MathJax-Span-1152\" style=\"font-family: STIXGeneral-Italic;\">E<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1153\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mi\" id=\"MathJax-Span-1154\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">m</span><span class=\"msubsup\" id=\"MathJax-Span-1155\"><span style=\"display: inline-block; position: relative; width: 0.888em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1156\" style=\"font-family: STIXGeneral-Italic;\">c</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.372em; left: 0.471em;\"><span class=\"mn\" id=\"MathJax-Span-1157\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>E</mi><mo>=</mo><mi>m</mi><msup><mi>c</mi><mn>2</mn></msup></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-120\">E=mc^2</script></li>\n      <li><strong>Candidate</strong>: <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-121-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>E</mi><mo>=</mo><mi>m</mi><msup><mi>c</mi><mn>2</mn></msup></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1158\" style=\"width: 4.221em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 3.492em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.201em, 1003.49em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1159\"><span class=\"mi\" id=\"MathJax-Span-1160\" style=\"font-family: STIXGeneral-Italic;\">E<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1161\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mi\" id=\"MathJax-Span-1162\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">m</span><span class=\"msubsup\" id=\"MathJax-Span-1163\"><span style=\"display: inline-block; position: relative; width: 0.888em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1164\" style=\"font-family: STIXGeneral-Italic;\">c</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.372em; left: 0.471em;\"><span class=\"mn\" id=\"MathJax-Span-1165\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>E</mi><mo>=</mo><mi>m</mi><msup><mi>c</mi><mn>2</mn></msup></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-121\">E=mc^2</script></li>\n      <li><strong>Exact Match Score</strong>: 1 (since the candidate matches the reference exactly).</li>\n    </ul>\n  </li>\n</ul>\n<ul>\n      <li><strong>Reference</strong>: <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-120-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>E</mi><mo>=</mo><mi>m</mi><msup><mi>c</mi><mn>2</mn></msup></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1150\" style=\"width: 4.221em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 3.492em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.201em, 1003.49em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1151\"><span class=\"mi\" id=\"MathJax-Span-1152\" style=\"font-family: STIXGeneral-Italic;\">E<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1153\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mi\" id=\"MathJax-Span-1154\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">m</span><span class=\"msubsup\" id=\"MathJax-Span-1155\"><span style=\"display: inline-block; position: relative; width: 0.888em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1156\" style=\"font-family: STIXGeneral-Italic;\">c</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.372em; left: 0.471em;\"><span class=\"mn\" id=\"MathJax-Span-1157\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>E</mi><mo>=</mo><mi>m</mi><msup><mi>c</mi><mn>2</mn></msup></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-120\">E=mc^2</script></li>\n      <li><strong>Candidate</strong>: <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-121-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>E</mi><mo>=</mo><mi>m</mi><msup><mi>c</mi><mn>2</mn></msup></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1158\" style=\"width: 4.221em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 3.492em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.201em, 1003.49em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1159\"><span class=\"mi\" id=\"MathJax-Span-1160\" style=\"font-family: STIXGeneral-Italic;\">E<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1161\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mi\" id=\"MathJax-Span-1162\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">m</span><span class=\"msubsup\" id=\"MathJax-Span-1163\"><span style=\"display: inline-block; position: relative; width: 0.888em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1164\" style=\"font-family: STIXGeneral-Italic;\">c</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.372em; left: 0.471em;\"><span class=\"mn\" id=\"MathJax-Span-1165\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>E</mi><mo>=</mo><mi>m</mi><msup><mi>c</mi><mn>2</mn></msup></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-121\">E=mc^2</script></li>\n      <li><strong>Exact Match Score</strong>: 1 (since the candidate matches the reference exactly).</li>\n    </ul>\n<h4 id=\"context-entities-recall\">Context Entities Recall</h4>\n<ul>\n  <li>\n    <p><strong>Definition</strong>: Context Entities Recall is a metric that measures the recall of entities from the retrieved context compared to the ground truth. It calculates the fraction of entities in the ground truth that are also present in the context. This metric is crucial for scenarios where accurate entity retrieval is essential, such as tourism help desks or historical question answering.</p>\n  </li>\n  <li><strong>Evaluation Approach</strong>:\n    <ul>\n      <li>To compute this metric, two sets are used:\n        <ul>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-122-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>G</mi><mi>E</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1166\" style=\"width: 1.669em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.357em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1001.36em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1167\"><span class=\"mi\" id=\"MathJax-Span-1168\" style=\"font-family: STIXGeneral-Italic;\">G</span><span class=\"mi\" id=\"MathJax-Span-1169\" style=\"font-family: STIXGeneral-Italic;\">E<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>G</mi><mi>E</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-122\">GE</script> (Ground Truth Entities): The set of entities present in the ground truth.</li>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-123-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>C</mi><mi>E</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1170\" style=\"width: 1.565em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.305em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1001.3em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1171\"><span class=\"mi\" id=\"MathJax-Span-1172\" style=\"font-family: STIXGeneral-Italic;\">C<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mi\" id=\"MathJax-Span-1173\" style=\"font-family: STIXGeneral-Italic;\">E<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>C</mi><mi>E</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-123\">CE</script> (Context Entities): The set of entities present in the retrieved context.</li>\n        </ul>\n      </li>\n      <li>\n        <p>The Context Entities Recall is calculated using the formula:</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-124-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>Context Entity Recall</mtext><mo>=</mo><mfrac><mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><mi>C</mi><mi>E</mi><mo>&amp;#x2229;</mo><mi>G</mi><mi>E</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow></mrow><mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><mi>G</mi><mi>E</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow></mrow></mfrac></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1174\" style=\"width: 17.607em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 14.638em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.68em, 1014.64em, 3.232em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1175\"><span class=\"mtext\" id=\"MathJax-Span-1176\" style=\"font-family: STIXGeneral-Regular;\">Context Entity Recall</span><span class=\"mo\" id=\"MathJax-Span-1177\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-1178\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 4.586em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1004.33em, 4.378em, -999.997em); top: -4.685em; left: 50%; margin-left: -2.237em;\"><span class=\"mrow\" id=\"MathJax-Span-1179\"><span class=\"texatom\" id=\"MathJax-Span-1180\"><span class=\"mrow\" id=\"MathJax-Span-1181\"><span class=\"mo\" id=\"MathJax-Span-1182\" style=\"font-family: STIXVariants;\">|</span></span></span><span class=\"mi\" id=\"MathJax-Span-1183\" style=\"font-family: STIXGeneral-Italic;\">C<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mi\" id=\"MathJax-Span-1184\" style=\"font-family: STIXGeneral-Italic;\">E<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1185\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">∩</span><span class=\"mi\" id=\"MathJax-Span-1186\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.263em;\">G</span><span class=\"mi\" id=\"MathJax-Span-1187\" style=\"font-family: STIXGeneral-Italic;\">E<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"texatom\" id=\"MathJax-Span-1188\"><span class=\"mrow\" id=\"MathJax-Span-1189\"><span class=\"mo\" id=\"MathJax-Span-1190\" style=\"font-family: STIXVariants;\">|</span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1001.88em, 4.378em, -999.997em); top: -3.331em; left: 50%; margin-left: -0.987em;\"><span class=\"mrow\" id=\"MathJax-Span-1191\"><span class=\"texatom\" id=\"MathJax-Span-1192\"><span class=\"mrow\" id=\"MathJax-Span-1193\"><span class=\"mo\" id=\"MathJax-Span-1194\" style=\"font-family: STIXVariants;\">|</span></span></span><span class=\"mi\" id=\"MathJax-Span-1195\" style=\"font-family: STIXGeneral-Italic;\">G</span><span class=\"mi\" id=\"MathJax-Span-1196\" style=\"font-family: STIXGeneral-Italic;\">E<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"texatom\" id=\"MathJax-Span-1197\"><span class=\"mrow\" id=\"MathJax-Span-1198\"><span class=\"mo\" id=\"MathJax-Span-1199\" style=\"font-family: STIXVariants;\">|</span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1004.59em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 4.586em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -1.122em; border-left: 0px solid; width: 0px; height: 2.816em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>Context Entity Recall</mtext><mo>=</mo><mfrac><mrow><mrow class=\"MJX-TeXAtom-ORD\"><mo stretchy=\"false\">|</mo></mrow><mi>C</mi><mi>E</mi><mo>∩</mo><mi>G</mi><mi>E</mi><mrow class=\"MJX-TeXAtom-ORD\"><mo stretchy=\"false\">|</mo></mrow></mrow><mrow><mrow class=\"MJX-TeXAtom-ORD\"><mo stretchy=\"false\">|</mo></mrow><mi>G</mi><mi>E</mi><mrow class=\"MJX-TeXAtom-ORD\"><mo stretchy=\"false\">|</mo></mrow></mrow></mfrac></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-124\">\\text{Context Entity Recall} = \\frac{|CE \\cap GE|}{|GE|}</script>\n\n        <ul>\n          <li>where, <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-125-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>&amp;#x2223;</mo><mi>C</mi><mi>E</mi><mo>&amp;#x2229;</mo><mi>G</mi><mi>E</mi><mo stretchy=&quot;false&quot;>&amp;#x2223;</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1200\" style=\"width: 5.263em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 4.378em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1004.27em, 2.607em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1201\"><span class=\"mo\" id=\"MathJax-Span-1202\" style=\"font-family: STIXGeneral-Regular;\">∣</span><span class=\"mi\" id=\"MathJax-Span-1203\" style=\"font-family: STIXGeneral-Italic;\">C<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mi\" id=\"MathJax-Span-1204\" style=\"font-family: STIXGeneral-Italic;\">E<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1205\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">∩</span><span class=\"mi\" id=\"MathJax-Span-1206\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.263em;\">G</span><span class=\"mi\" id=\"MathJax-Span-1207\" style=\"font-family: STIXGeneral-Italic;\">E<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1208\" style=\"font-family: STIXGeneral-Regular;\">∣</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mo stretchy=\"false\">∣</mo><mi>C</mi><mi>E</mi><mo>∩</mo><mi>G</mi><mi>E</mi><mo stretchy=\"false\">∣</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-125\">\\mid CE \\cap GE\\mid</script> represents the number of entities common to both the context and the ground truth, while <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-126-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>&amp;#x2223;</mo><mi>G</mi><mi>E</mi><mo stretchy=&quot;false&quot;>&amp;#x2223;</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1209\" style=\"width: 2.19em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.826em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1001.72em, 2.607em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1210\"><span class=\"mo\" id=\"MathJax-Span-1211\" style=\"font-family: STIXGeneral-Regular;\">∣</span><span class=\"mi\" id=\"MathJax-Span-1212\" style=\"font-family: STIXGeneral-Italic;\">G</span><span class=\"mi\" id=\"MathJax-Span-1213\" style=\"font-family: STIXGeneral-Italic;\">E<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1214\" style=\"font-family: STIXGeneral-Regular;\">∣</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mo stretchy=\"false\">∣</mo><mi>G</mi><mi>E</mi><mo stretchy=\"false\">∣</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-126\">\\mid GE\\mid</script> is the total number of entities in the ground truth.</li>\n        </ul>\n      </li>\n    </ul>\n  </li>\n  <li><strong>Example</strong> <a href=\"https://docs.ragas.io/en/latest/concepts/metrics/context_entities_recall.html\">(source)</a>:\n    <ul>\n      <li>\n        <p><strong>Ground Truth</strong>: The Taj Mahal is an ivory-white marble mausoleum on the right bank of the river Yamuna in the Indian city of Agra. It was commissioned in 1631 by the Mughal emperor Shah Jahan to house the tomb of his favorite wife, Mumtaz Mahal.</p>\n      </li>\n      <li>\n        <p><strong>High Entity Recall Context</strong>: The Taj Mahal is a symbol of love and architectural marvel located in Agra, India. It was built by the Mughal emperor Shah Jahan in memory of his beloved wife, Mumtaz Mahal. The structure is renowned for its intricate marble work and beautiful gardens surrounding it.</p>\n      </li>\n      <li>\n        <p><strong>Low Entity Recall Context</strong>: The Taj Mahal is an iconic monument in India. It is a UNESCO World Heritage Site and attracts millions of visitors annually. The intricate carvings and stunning architecture make it a must-visit destination.</p>\n      </li>\n      <li><strong>Calculation</strong>:\n        <ul>\n          <li><strong>Entities in Ground Truth (GE)</strong>: <code class=\"language-plaintext highlighter-rouge\">['Taj Mahal', 'Yamuna', 'Agra', '1631', 'Shah Jahan', 'Mumtaz Mahal']</code></li>\n          <li><strong>Entities in High Entity Recall Context (CE1)</strong>: <code class=\"language-plaintext highlighter-rouge\">['Taj Mahal', 'Agra', 'Shah Jahan', 'Mumtaz Mahal', 'India']</code></li>\n          <li><strong>Entities in Low Entity Recall Context (CE2)</strong>: <code class=\"language-plaintext highlighter-rouge\">['Taj Mahal', 'UNESCO', 'India']</code></li>\n        </ul>\n      </li>\n      <li>\n        <p><strong>Context Entity Recall - 1</strong>:</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-127-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>Context Entity Recall - 1</mtext><mo>=</mo><mfrac><mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><mi>C</mi><mi>E</mi><mn>1</mn><mo>&amp;#x2229;</mo><mi>G</mi><mi>E</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow></mrow><mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><mi>G</mi><mi>E</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow></mrow></mfrac><mo>=</mo><mfrac><mn>4</mn><mn>6</mn></mfrac><mo>=</mo><mn>0.666</mn></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1215\" style=\"width: 26.409em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 21.982em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.68em, 1021.93em, 3.232em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1216\"><span class=\"mtext\" id=\"MathJax-Span-1217\" style=\"font-family: STIXGeneral-Regular;\">Context Entity Recall - 1</span><span class=\"mo\" id=\"MathJax-Span-1218\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-1219\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 5.107em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1004.85em, 4.378em, -999.997em); top: -4.685em; left: 50%; margin-left: -2.497em;\"><span class=\"mrow\" id=\"MathJax-Span-1220\"><span class=\"texatom\" id=\"MathJax-Span-1221\"><span class=\"mrow\" id=\"MathJax-Span-1222\"><span class=\"mo\" id=\"MathJax-Span-1223\" style=\"font-family: STIXVariants;\">|</span></span></span><span class=\"mi\" id=\"MathJax-Span-1224\" style=\"font-family: STIXGeneral-Italic;\">C<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mi\" id=\"MathJax-Span-1225\" style=\"font-family: STIXGeneral-Italic;\">E<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mn\" id=\"MathJax-Span-1226\" style=\"font-family: STIXGeneral-Regular;\">1</span><span class=\"mo\" id=\"MathJax-Span-1227\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">∩</span><span class=\"mi\" id=\"MathJax-Span-1228\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.263em;\">G</span><span class=\"mi\" id=\"MathJax-Span-1229\" style=\"font-family: STIXGeneral-Italic;\">E<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"texatom\" id=\"MathJax-Span-1230\"><span class=\"mrow\" id=\"MathJax-Span-1231\"><span class=\"mo\" id=\"MathJax-Span-1232\" style=\"font-family: STIXVariants;\">|</span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1001.88em, 4.378em, -999.997em); top: -3.331em; left: 50%; margin-left: -0.987em;\"><span class=\"mrow\" id=\"MathJax-Span-1233\"><span class=\"texatom\" id=\"MathJax-Span-1234\"><span class=\"mrow\" id=\"MathJax-Span-1235\"><span class=\"mo\" id=\"MathJax-Span-1236\" style=\"font-family: STIXVariants;\">|</span></span></span><span class=\"mi\" id=\"MathJax-Span-1237\" style=\"font-family: STIXGeneral-Italic;\">G</span><span class=\"mi\" id=\"MathJax-Span-1238\" style=\"font-family: STIXGeneral-Italic;\">E<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"texatom\" id=\"MathJax-Span-1239\"><span class=\"mrow\" id=\"MathJax-Span-1240\"><span class=\"mo\" id=\"MathJax-Span-1241\" style=\"font-family: STIXVariants;\">|</span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1005.11em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 5.107em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1242\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-1243\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.47em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-1244\" style=\"font-family: STIXGeneral-Regular;\">4</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1000.47em, 4.169em, -999.997em); top: -3.331em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-1245\" style=\"font-family: STIXGeneral-Regular;\">6</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1000.63em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.628em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1246\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-1247\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">0.666</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -1.122em; border-left: 0px solid; width: 0px; height: 2.816em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>Context Entity Recall - 1</mtext><mo>=</mo><mfrac><mrow><mrow class=\"MJX-TeXAtom-ORD\"><mo stretchy=\"false\">|</mo></mrow><mi>C</mi><mi>E</mi><mn>1</mn><mo>∩</mo><mi>G</mi><mi>E</mi><mrow class=\"MJX-TeXAtom-ORD\"><mo stretchy=\"false\">|</mo></mrow></mrow><mrow><mrow class=\"MJX-TeXAtom-ORD\"><mo stretchy=\"false\">|</mo></mrow><mi>G</mi><mi>E</mi><mrow class=\"MJX-TeXAtom-ORD\"><mo stretchy=\"false\">|</mo></mrow></mrow></mfrac><mo>=</mo><mfrac><mn>4</mn><mn>6</mn></mfrac><mo>=</mo><mn>0.666</mn></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-127\">\\text{Context Entity Recall - 1} = \\frac{|CE1 \\cap GE|}{|GE|} = \\frac{4}{6} = 0.666</script>\n      </li>\n      <li>\n        <p><strong>Context Entity Recall - 2</strong>:</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-128-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>Context Entity Recall - 2</mtext><mo>=</mo><mfrac><mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><mi>C</mi><mi>E</mi><mn>2</mn><mo>&amp;#x2229;</mo><mi>G</mi><mi>E</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow></mrow><mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><mi>G</mi><mi>E</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>6</mn></mfrac><mo>=</mo><mn>0.166</mn></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1248\" style=\"width: 26.409em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 21.982em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.68em, 1021.93em, 3.232em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1249\"><span class=\"mtext\" id=\"MathJax-Span-1250\" style=\"font-family: STIXGeneral-Regular;\">Context Entity Recall - 2</span><span class=\"mo\" id=\"MathJax-Span-1251\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-1252\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 5.107em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1004.85em, 4.378em, -999.997em); top: -4.685em; left: 50%; margin-left: -2.497em;\"><span class=\"mrow\" id=\"MathJax-Span-1253\"><span class=\"texatom\" id=\"MathJax-Span-1254\"><span class=\"mrow\" id=\"MathJax-Span-1255\"><span class=\"mo\" id=\"MathJax-Span-1256\" style=\"font-family: STIXVariants;\">|</span></span></span><span class=\"mi\" id=\"MathJax-Span-1257\" style=\"font-family: STIXGeneral-Italic;\">C<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mi\" id=\"MathJax-Span-1258\" style=\"font-family: STIXGeneral-Italic;\">E<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mn\" id=\"MathJax-Span-1259\" style=\"font-family: STIXGeneral-Regular;\">2</span><span class=\"mo\" id=\"MathJax-Span-1260\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">∩</span><span class=\"mi\" id=\"MathJax-Span-1261\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.263em;\">G</span><span class=\"mi\" id=\"MathJax-Span-1262\" style=\"font-family: STIXGeneral-Italic;\">E<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"texatom\" id=\"MathJax-Span-1263\"><span class=\"mrow\" id=\"MathJax-Span-1264\"><span class=\"mo\" id=\"MathJax-Span-1265\" style=\"font-family: STIXVariants;\">|</span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1001.88em, 4.378em, -999.997em); top: -3.331em; left: 50%; margin-left: -0.987em;\"><span class=\"mrow\" id=\"MathJax-Span-1266\"><span class=\"texatom\" id=\"MathJax-Span-1267\"><span class=\"mrow\" id=\"MathJax-Span-1268\"><span class=\"mo\" id=\"MathJax-Span-1269\" style=\"font-family: STIXVariants;\">|</span></span></span><span class=\"mi\" id=\"MathJax-Span-1270\" style=\"font-family: STIXGeneral-Italic;\">G</span><span class=\"mi\" id=\"MathJax-Span-1271\" style=\"font-family: STIXGeneral-Italic;\">E<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"texatom\" id=\"MathJax-Span-1272\"><span class=\"mrow\" id=\"MathJax-Span-1273\"><span class=\"mo\" id=\"MathJax-Span-1274\" style=\"font-family: STIXVariants;\">|</span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1005.11em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 5.107em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1275\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-1276\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-1277\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1000.47em, 4.169em, -999.997em); top: -3.331em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-1278\" style=\"font-family: STIXGeneral-Regular;\">6</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1000.63em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.628em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1279\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-1280\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">0.166</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -1.122em; border-left: 0px solid; width: 0px; height: 2.816em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>Context Entity Recall - 2</mtext><mo>=</mo><mfrac><mrow><mrow class=\"MJX-TeXAtom-ORD\"><mo stretchy=\"false\">|</mo></mrow><mi>C</mi><mi>E</mi><mn>2</mn><mo>∩</mo><mi>G</mi><mi>E</mi><mrow class=\"MJX-TeXAtom-ORD\"><mo stretchy=\"false\">|</mo></mrow></mrow><mrow><mrow class=\"MJX-TeXAtom-ORD\"><mo stretchy=\"false\">|</mo></mrow><mi>G</mi><mi>E</mi><mrow class=\"MJX-TeXAtom-ORD\"><mo stretchy=\"false\">|</mo></mrow></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>6</mn></mfrac><mo>=</mo><mn>0.166</mn></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-128\">\\text{Context Entity Recall - 2} = \\frac{|CE2 \\cap GE|}{|GE|} = \\frac{1}{6} = 0.166</script>\n      </li>\n      <li>The first context demonstrates a higher entity recall, indicating better entity coverage in comparison to the ground truth. If these contexts were generated by different retrieval mechanisms, the first mechanism would be deemed superior for applications where entity accuracy is crucial.</li>\n    </ul>\n  </li>\n</ul>\n<p><strong>Definition</strong>: Context Entities Recall is a metric that measures the recall of entities from the retrieved context compared to the ground truth. It calculates the fraction of entities in the ground truth that are also present in the context. This metric is crucial for scenarios where accurate entity retrieval is essential, such as tourism help desks or historical question answering.</p>\n<ul>\n      <li>To compute this metric, two sets are used:\n        <ul>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-122-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>G</mi><mi>E</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1166\" style=\"width: 1.669em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.357em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1001.36em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1167\"><span class=\"mi\" id=\"MathJax-Span-1168\" style=\"font-family: STIXGeneral-Italic;\">G</span><span class=\"mi\" id=\"MathJax-Span-1169\" style=\"font-family: STIXGeneral-Italic;\">E<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>G</mi><mi>E</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-122\">GE</script> (Ground Truth Entities): The set of entities present in the ground truth.</li>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-123-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>C</mi><mi>E</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1170\" style=\"width: 1.565em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.305em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1001.3em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1171\"><span class=\"mi\" id=\"MathJax-Span-1172\" style=\"font-family: STIXGeneral-Italic;\">C<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mi\" id=\"MathJax-Span-1173\" style=\"font-family: STIXGeneral-Italic;\">E<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>C</mi><mi>E</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-123\">CE</script> (Context Entities): The set of entities present in the retrieved context.</li>\n        </ul>\n      </li>\n      <li>\n        <p>The Context Entities Recall is calculated using the formula:</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-124-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>Context Entity Recall</mtext><mo>=</mo><mfrac><mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><mi>C</mi><mi>E</mi><mo>&amp;#x2229;</mo><mi>G</mi><mi>E</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow></mrow><mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><mi>G</mi><mi>E</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow></mrow></mfrac></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1174\" style=\"width: 17.607em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 14.638em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.68em, 1014.64em, 3.232em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1175\"><span class=\"mtext\" id=\"MathJax-Span-1176\" style=\"font-family: STIXGeneral-Regular;\">Context Entity Recall</span><span class=\"mo\" id=\"MathJax-Span-1177\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-1178\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 4.586em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1004.33em, 4.378em, -999.997em); top: -4.685em; left: 50%; margin-left: -2.237em;\"><span class=\"mrow\" id=\"MathJax-Span-1179\"><span class=\"texatom\" id=\"MathJax-Span-1180\"><span class=\"mrow\" id=\"MathJax-Span-1181\"><span class=\"mo\" id=\"MathJax-Span-1182\" style=\"font-family: STIXVariants;\">|</span></span></span><span class=\"mi\" id=\"MathJax-Span-1183\" style=\"font-family: STIXGeneral-Italic;\">C<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mi\" id=\"MathJax-Span-1184\" style=\"font-family: STIXGeneral-Italic;\">E<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1185\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">∩</span><span class=\"mi\" id=\"MathJax-Span-1186\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.263em;\">G</span><span class=\"mi\" id=\"MathJax-Span-1187\" style=\"font-family: STIXGeneral-Italic;\">E<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"texatom\" id=\"MathJax-Span-1188\"><span class=\"mrow\" id=\"MathJax-Span-1189\"><span class=\"mo\" id=\"MathJax-Span-1190\" style=\"font-family: STIXVariants;\">|</span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1001.88em, 4.378em, -999.997em); top: -3.331em; left: 50%; margin-left: -0.987em;\"><span class=\"mrow\" id=\"MathJax-Span-1191\"><span class=\"texatom\" id=\"MathJax-Span-1192\"><span class=\"mrow\" id=\"MathJax-Span-1193\"><span class=\"mo\" id=\"MathJax-Span-1194\" style=\"font-family: STIXVariants;\">|</span></span></span><span class=\"mi\" id=\"MathJax-Span-1195\" style=\"font-family: STIXGeneral-Italic;\">G</span><span class=\"mi\" id=\"MathJax-Span-1196\" style=\"font-family: STIXGeneral-Italic;\">E<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"texatom\" id=\"MathJax-Span-1197\"><span class=\"mrow\" id=\"MathJax-Span-1198\"><span class=\"mo\" id=\"MathJax-Span-1199\" style=\"font-family: STIXVariants;\">|</span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1004.59em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 4.586em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -1.122em; border-left: 0px solid; width: 0px; height: 2.816em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>Context Entity Recall</mtext><mo>=</mo><mfrac><mrow><mrow class=\"MJX-TeXAtom-ORD\"><mo stretchy=\"false\">|</mo></mrow><mi>C</mi><mi>E</mi><mo>∩</mo><mi>G</mi><mi>E</mi><mrow class=\"MJX-TeXAtom-ORD\"><mo stretchy=\"false\">|</mo></mrow></mrow><mrow><mrow class=\"MJX-TeXAtom-ORD\"><mo stretchy=\"false\">|</mo></mrow><mi>G</mi><mi>E</mi><mrow class=\"MJX-TeXAtom-ORD\"><mo stretchy=\"false\">|</mo></mrow></mrow></mfrac></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-124\">\\text{Context Entity Recall} = \\frac{|CE \\cap GE|}{|GE|}</script>\n\n        <ul>\n          <li>where, <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-125-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>&amp;#x2223;</mo><mi>C</mi><mi>E</mi><mo>&amp;#x2229;</mo><mi>G</mi><mi>E</mi><mo stretchy=&quot;false&quot;>&amp;#x2223;</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1200\" style=\"width: 5.263em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 4.378em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1004.27em, 2.607em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1201\"><span class=\"mo\" id=\"MathJax-Span-1202\" style=\"font-family: STIXGeneral-Regular;\">∣</span><span class=\"mi\" id=\"MathJax-Span-1203\" style=\"font-family: STIXGeneral-Italic;\">C<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mi\" id=\"MathJax-Span-1204\" style=\"font-family: STIXGeneral-Italic;\">E<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1205\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">∩</span><span class=\"mi\" id=\"MathJax-Span-1206\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.263em;\">G</span><span class=\"mi\" id=\"MathJax-Span-1207\" style=\"font-family: STIXGeneral-Italic;\">E<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1208\" style=\"font-family: STIXGeneral-Regular;\">∣</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mo stretchy=\"false\">∣</mo><mi>C</mi><mi>E</mi><mo>∩</mo><mi>G</mi><mi>E</mi><mo stretchy=\"false\">∣</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-125\">\\mid CE \\cap GE\\mid</script> represents the number of entities common to both the context and the ground truth, while <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-126-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>&amp;#x2223;</mo><mi>G</mi><mi>E</mi><mo stretchy=&quot;false&quot;>&amp;#x2223;</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1209\" style=\"width: 2.19em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.826em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1001.72em, 2.607em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1210\"><span class=\"mo\" id=\"MathJax-Span-1211\" style=\"font-family: STIXGeneral-Regular;\">∣</span><span class=\"mi\" id=\"MathJax-Span-1212\" style=\"font-family: STIXGeneral-Italic;\">G</span><span class=\"mi\" id=\"MathJax-Span-1213\" style=\"font-family: STIXGeneral-Italic;\">E<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1214\" style=\"font-family: STIXGeneral-Regular;\">∣</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mo stretchy=\"false\">∣</mo><mi>G</mi><mi>E</mi><mo stretchy=\"false\">∣</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-126\">\\mid GE\\mid</script> is the total number of entities in the ground truth.</li>\n        </ul>\n      </li>\n    </ul>\n<ul>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-122-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>G</mi><mi>E</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1166\" style=\"width: 1.669em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.357em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1001.36em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1167\"><span class=\"mi\" id=\"MathJax-Span-1168\" style=\"font-family: STIXGeneral-Italic;\">G</span><span class=\"mi\" id=\"MathJax-Span-1169\" style=\"font-family: STIXGeneral-Italic;\">E<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>G</mi><mi>E</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-122\">GE</script> (Ground Truth Entities): The set of entities present in the ground truth.</li>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-123-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>C</mi><mi>E</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1170\" style=\"width: 1.565em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.305em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1001.3em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1171\"><span class=\"mi\" id=\"MathJax-Span-1172\" style=\"font-family: STIXGeneral-Italic;\">C<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mi\" id=\"MathJax-Span-1173\" style=\"font-family: STIXGeneral-Italic;\">E<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>C</mi><mi>E</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-123\">CE</script> (Context Entities): The set of entities present in the retrieved context.</li>\n        </ul>\n<p>The Context Entities Recall is calculated using the formula:</p>\n<ul>\n          <li>where, <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-125-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>&amp;#x2223;</mo><mi>C</mi><mi>E</mi><mo>&amp;#x2229;</mo><mi>G</mi><mi>E</mi><mo stretchy=&quot;false&quot;>&amp;#x2223;</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1200\" style=\"width: 5.263em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 4.378em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1004.27em, 2.607em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1201\"><span class=\"mo\" id=\"MathJax-Span-1202\" style=\"font-family: STIXGeneral-Regular;\">∣</span><span class=\"mi\" id=\"MathJax-Span-1203\" style=\"font-family: STIXGeneral-Italic;\">C<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mi\" id=\"MathJax-Span-1204\" style=\"font-family: STIXGeneral-Italic;\">E<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1205\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">∩</span><span class=\"mi\" id=\"MathJax-Span-1206\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.263em;\">G</span><span class=\"mi\" id=\"MathJax-Span-1207\" style=\"font-family: STIXGeneral-Italic;\">E<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1208\" style=\"font-family: STIXGeneral-Regular;\">∣</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mo stretchy=\"false\">∣</mo><mi>C</mi><mi>E</mi><mo>∩</mo><mi>G</mi><mi>E</mi><mo stretchy=\"false\">∣</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-125\">\\mid CE \\cap GE\\mid</script> represents the number of entities common to both the context and the ground truth, while <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-126-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>&amp;#x2223;</mo><mi>G</mi><mi>E</mi><mo stretchy=&quot;false&quot;>&amp;#x2223;</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1209\" style=\"width: 2.19em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.826em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1001.72em, 2.607em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1210\"><span class=\"mo\" id=\"MathJax-Span-1211\" style=\"font-family: STIXGeneral-Regular;\">∣</span><span class=\"mi\" id=\"MathJax-Span-1212\" style=\"font-family: STIXGeneral-Italic;\">G</span><span class=\"mi\" id=\"MathJax-Span-1213\" style=\"font-family: STIXGeneral-Italic;\">E<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1214\" style=\"font-family: STIXGeneral-Regular;\">∣</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mo stretchy=\"false\">∣</mo><mi>G</mi><mi>E</mi><mo stretchy=\"false\">∣</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-126\">\\mid GE\\mid</script> is the total number of entities in the ground truth.</li>\n        </ul>\n<ul>\n      <li>\n        <p><strong>Ground Truth</strong>: The Taj Mahal is an ivory-white marble mausoleum on the right bank of the river Yamuna in the Indian city of Agra. It was commissioned in 1631 by the Mughal emperor Shah Jahan to house the tomb of his favorite wife, Mumtaz Mahal.</p>\n      </li>\n      <li>\n        <p><strong>High Entity Recall Context</strong>: The Taj Mahal is a symbol of love and architectural marvel located in Agra, India. It was built by the Mughal emperor Shah Jahan in memory of his beloved wife, Mumtaz Mahal. The structure is renowned for its intricate marble work and beautiful gardens surrounding it.</p>\n      </li>\n      <li>\n        <p><strong>Low Entity Recall Context</strong>: The Taj Mahal is an iconic monument in India. It is a UNESCO World Heritage Site and attracts millions of visitors annually. The intricate carvings and stunning architecture make it a must-visit destination.</p>\n      </li>\n      <li><strong>Calculation</strong>:\n        <ul>\n          <li><strong>Entities in Ground Truth (GE)</strong>: <code class=\"language-plaintext highlighter-rouge\">['Taj Mahal', 'Yamuna', 'Agra', '1631', 'Shah Jahan', 'Mumtaz Mahal']</code></li>\n          <li><strong>Entities in High Entity Recall Context (CE1)</strong>: <code class=\"language-plaintext highlighter-rouge\">['Taj Mahal', 'Agra', 'Shah Jahan', 'Mumtaz Mahal', 'India']</code></li>\n          <li><strong>Entities in Low Entity Recall Context (CE2)</strong>: <code class=\"language-plaintext highlighter-rouge\">['Taj Mahal', 'UNESCO', 'India']</code></li>\n        </ul>\n      </li>\n      <li>\n        <p><strong>Context Entity Recall - 1</strong>:</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-127-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>Context Entity Recall - 1</mtext><mo>=</mo><mfrac><mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><mi>C</mi><mi>E</mi><mn>1</mn><mo>&amp;#x2229;</mo><mi>G</mi><mi>E</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow></mrow><mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><mi>G</mi><mi>E</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow></mrow></mfrac><mo>=</mo><mfrac><mn>4</mn><mn>6</mn></mfrac><mo>=</mo><mn>0.666</mn></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1215\" style=\"width: 26.409em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 21.982em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.68em, 1021.93em, 3.232em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1216\"><span class=\"mtext\" id=\"MathJax-Span-1217\" style=\"font-family: STIXGeneral-Regular;\">Context Entity Recall - 1</span><span class=\"mo\" id=\"MathJax-Span-1218\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-1219\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 5.107em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1004.85em, 4.378em, -999.997em); top: -4.685em; left: 50%; margin-left: -2.497em;\"><span class=\"mrow\" id=\"MathJax-Span-1220\"><span class=\"texatom\" id=\"MathJax-Span-1221\"><span class=\"mrow\" id=\"MathJax-Span-1222\"><span class=\"mo\" id=\"MathJax-Span-1223\" style=\"font-family: STIXVariants;\">|</span></span></span><span class=\"mi\" id=\"MathJax-Span-1224\" style=\"font-family: STIXGeneral-Italic;\">C<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mi\" id=\"MathJax-Span-1225\" style=\"font-family: STIXGeneral-Italic;\">E<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mn\" id=\"MathJax-Span-1226\" style=\"font-family: STIXGeneral-Regular;\">1</span><span class=\"mo\" id=\"MathJax-Span-1227\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">∩</span><span class=\"mi\" id=\"MathJax-Span-1228\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.263em;\">G</span><span class=\"mi\" id=\"MathJax-Span-1229\" style=\"font-family: STIXGeneral-Italic;\">E<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"texatom\" id=\"MathJax-Span-1230\"><span class=\"mrow\" id=\"MathJax-Span-1231\"><span class=\"mo\" id=\"MathJax-Span-1232\" style=\"font-family: STIXVariants;\">|</span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1001.88em, 4.378em, -999.997em); top: -3.331em; left: 50%; margin-left: -0.987em;\"><span class=\"mrow\" id=\"MathJax-Span-1233\"><span class=\"texatom\" id=\"MathJax-Span-1234\"><span class=\"mrow\" id=\"MathJax-Span-1235\"><span class=\"mo\" id=\"MathJax-Span-1236\" style=\"font-family: STIXVariants;\">|</span></span></span><span class=\"mi\" id=\"MathJax-Span-1237\" style=\"font-family: STIXGeneral-Italic;\">G</span><span class=\"mi\" id=\"MathJax-Span-1238\" style=\"font-family: STIXGeneral-Italic;\">E<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"texatom\" id=\"MathJax-Span-1239\"><span class=\"mrow\" id=\"MathJax-Span-1240\"><span class=\"mo\" id=\"MathJax-Span-1241\" style=\"font-family: STIXVariants;\">|</span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1005.11em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 5.107em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1242\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-1243\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.47em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-1244\" style=\"font-family: STIXGeneral-Regular;\">4</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1000.47em, 4.169em, -999.997em); top: -3.331em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-1245\" style=\"font-family: STIXGeneral-Regular;\">6</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1000.63em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.628em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1246\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-1247\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">0.666</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -1.122em; border-left: 0px solid; width: 0px; height: 2.816em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>Context Entity Recall - 1</mtext><mo>=</mo><mfrac><mrow><mrow class=\"MJX-TeXAtom-ORD\"><mo stretchy=\"false\">|</mo></mrow><mi>C</mi><mi>E</mi><mn>1</mn><mo>∩</mo><mi>G</mi><mi>E</mi><mrow class=\"MJX-TeXAtom-ORD\"><mo stretchy=\"false\">|</mo></mrow></mrow><mrow><mrow class=\"MJX-TeXAtom-ORD\"><mo stretchy=\"false\">|</mo></mrow><mi>G</mi><mi>E</mi><mrow class=\"MJX-TeXAtom-ORD\"><mo stretchy=\"false\">|</mo></mrow></mrow></mfrac><mo>=</mo><mfrac><mn>4</mn><mn>6</mn></mfrac><mo>=</mo><mn>0.666</mn></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-127\">\\text{Context Entity Recall - 1} = \\frac{|CE1 \\cap GE|}{|GE|} = \\frac{4}{6} = 0.666</script>\n      </li>\n      <li>\n        <p><strong>Context Entity Recall - 2</strong>:</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-128-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>Context Entity Recall - 2</mtext><mo>=</mo><mfrac><mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><mi>C</mi><mi>E</mi><mn>2</mn><mo>&amp;#x2229;</mo><mi>G</mi><mi>E</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow></mrow><mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><mi>G</mi><mi>E</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>6</mn></mfrac><mo>=</mo><mn>0.166</mn></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1248\" style=\"width: 26.409em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 21.982em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.68em, 1021.93em, 3.232em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1249\"><span class=\"mtext\" id=\"MathJax-Span-1250\" style=\"font-family: STIXGeneral-Regular;\">Context Entity Recall - 2</span><span class=\"mo\" id=\"MathJax-Span-1251\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-1252\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 5.107em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1004.85em, 4.378em, -999.997em); top: -4.685em; left: 50%; margin-left: -2.497em;\"><span class=\"mrow\" id=\"MathJax-Span-1253\"><span class=\"texatom\" id=\"MathJax-Span-1254\"><span class=\"mrow\" id=\"MathJax-Span-1255\"><span class=\"mo\" id=\"MathJax-Span-1256\" style=\"font-family: STIXVariants;\">|</span></span></span><span class=\"mi\" id=\"MathJax-Span-1257\" style=\"font-family: STIXGeneral-Italic;\">C<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mi\" id=\"MathJax-Span-1258\" style=\"font-family: STIXGeneral-Italic;\">E<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mn\" id=\"MathJax-Span-1259\" style=\"font-family: STIXGeneral-Regular;\">2</span><span class=\"mo\" id=\"MathJax-Span-1260\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">∩</span><span class=\"mi\" id=\"MathJax-Span-1261\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.263em;\">G</span><span class=\"mi\" id=\"MathJax-Span-1262\" style=\"font-family: STIXGeneral-Italic;\">E<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"texatom\" id=\"MathJax-Span-1263\"><span class=\"mrow\" id=\"MathJax-Span-1264\"><span class=\"mo\" id=\"MathJax-Span-1265\" style=\"font-family: STIXVariants;\">|</span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1001.88em, 4.378em, -999.997em); top: -3.331em; left: 50%; margin-left: -0.987em;\"><span class=\"mrow\" id=\"MathJax-Span-1266\"><span class=\"texatom\" id=\"MathJax-Span-1267\"><span class=\"mrow\" id=\"MathJax-Span-1268\"><span class=\"mo\" id=\"MathJax-Span-1269\" style=\"font-family: STIXVariants;\">|</span></span></span><span class=\"mi\" id=\"MathJax-Span-1270\" style=\"font-family: STIXGeneral-Italic;\">G</span><span class=\"mi\" id=\"MathJax-Span-1271\" style=\"font-family: STIXGeneral-Italic;\">E<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"texatom\" id=\"MathJax-Span-1272\"><span class=\"mrow\" id=\"MathJax-Span-1273\"><span class=\"mo\" id=\"MathJax-Span-1274\" style=\"font-family: STIXVariants;\">|</span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1005.11em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 5.107em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1275\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-1276\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-1277\" style=\"font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.18em, 1000.47em, 4.169em, -999.997em); top: -3.331em; left: 50%; margin-left: -0.258em;\"><span class=\"mn\" id=\"MathJax-Span-1278\" style=\"font-family: STIXGeneral-Regular;\">6</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1000.63em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.628em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1279\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-1280\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">0.166</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -1.122em; border-left: 0px solid; width: 0px; height: 2.816em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>Context Entity Recall - 2</mtext><mo>=</mo><mfrac><mrow><mrow class=\"MJX-TeXAtom-ORD\"><mo stretchy=\"false\">|</mo></mrow><mi>C</mi><mi>E</mi><mn>2</mn><mo>∩</mo><mi>G</mi><mi>E</mi><mrow class=\"MJX-TeXAtom-ORD\"><mo stretchy=\"false\">|</mo></mrow></mrow><mrow><mrow class=\"MJX-TeXAtom-ORD\"><mo stretchy=\"false\">|</mo></mrow><mi>G</mi><mi>E</mi><mrow class=\"MJX-TeXAtom-ORD\"><mo stretchy=\"false\">|</mo></mrow></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>6</mn></mfrac><mo>=</mo><mn>0.166</mn></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-128\">\\text{Context Entity Recall - 2} = \\frac{|CE2 \\cap GE|}{|GE|} = \\frac{1}{6} = 0.166</script>\n      </li>\n      <li>The first context demonstrates a higher entity recall, indicating better entity coverage in comparison to the ground truth. If these contexts were generated by different retrieval mechanisms, the first mechanism would be deemed superior for applications where entity accuracy is crucial.</li>\n    </ul>\n<p><strong>Ground Truth</strong>: The Taj Mahal is an ivory-white marble mausoleum on the right bank of the river Yamuna in the Indian city of Agra. It was commissioned in 1631 by the Mughal emperor Shah Jahan to house the tomb of his favorite wife, Mumtaz Mahal.</p>\n<p><strong>High Entity Recall Context</strong>: The Taj Mahal is a symbol of love and architectural marvel located in Agra, India. It was built by the Mughal emperor Shah Jahan in memory of his beloved wife, Mumtaz Mahal. The structure is renowned for its intricate marble work and beautiful gardens surrounding it.</p>\n<p><strong>Low Entity Recall Context</strong>: The Taj Mahal is an iconic monument in India. It is a UNESCO World Heritage Site and attracts millions of visitors annually. The intricate carvings and stunning architecture make it a must-visit destination.</p>\n<ul>\n          <li><strong>Entities in Ground Truth (GE)</strong>: <code class=\"language-plaintext highlighter-rouge\">['Taj Mahal', 'Yamuna', 'Agra', '1631', 'Shah Jahan', 'Mumtaz Mahal']</code></li>\n          <li><strong>Entities in High Entity Recall Context (CE1)</strong>: <code class=\"language-plaintext highlighter-rouge\">['Taj Mahal', 'Agra', 'Shah Jahan', 'Mumtaz Mahal', 'India']</code></li>\n          <li><strong>Entities in Low Entity Recall Context (CE2)</strong>: <code class=\"language-plaintext highlighter-rouge\">['Taj Mahal', 'UNESCO', 'India']</code></li>\n        </ul>\n<p><strong>Context Entity Recall - 1</strong>:</p>\n<p><strong>Context Entity Recall - 2</strong>:</p>",
    "contentMarkdown": "*   Evaluating the generation component of RAG in the context of LLMs involves assessing the ability of the system to seamlessly integrate retrieved information into coherent, contextually relevant, and linguistically accurate responses, ensuring a harmonious blend of retrieved data and generative language skills. Put simply, these metrics collectively provide a nuanced and multidimensional approach to evaluating RAG systems, emphasizing not just the retrieval of information but its contextual relevance, factual accuracy, and semantic alignment with user queries.\n\n#### Groundedness (a.k.a. Faithfulness)\n\n*   **Definition**: Groundedness (also known as Faithfulness) evaluates the factual consistency of a generated answer against a given context. It is measured based on the alignment between the answer and the retrieved context, with scores ranging from 0 to 1. A higher score indicates better factual consistency.\n*   **Evaluation Approach**:\n    \n    *   The faithfulness of a generated answer is determined by checking if all the atomic (stand-alone) claims made in the answer can be inferred from the provided context. The process involves identifying a set of atomic claims from the answer and cross-referencing each claim with the context to confirm if it can be inferred. The faithfulness score is calculated using the formula:\n    \n    Faithfulness score\\=Number of claims in the generated answer that can be inferred from the given contextTotal number of claims in the generated answerFaithfulness score\\=Number of claims in the generated answer that can be inferred from the given contextTotal number of claims in the generated answer\n    \n    \\\\text{Faithfulness score} = \\\\frac{\\\\text{Number of claims in the generated answer that can be inferred from the given context}}{\\\\text{Total number of claims in the generated answer}}\n*   **Example** [(source)](https://docs.ragas.io/en/latest/concepts/metrics/faithfulness.html): _Question_: Where and when was Einstein born? _Context_: Albert Einstein (born 14 March 1879) was a German-born theoretical physicist, widely held to be one of the greatest and most influential scientists of all time.\n    \n    *   **High faithfulness answer**: Einstein was born in Germany on 14th March 1879.\n    *   **Low faithfulness answer**: Einstein was born in Germany on 20th March 1879.\n        \n    *   For the low faithfulness answer:\n        *   **Step 1**: Break the generated answer into individual statements.\n            *   Statement 1: “Einstein was born in Germany.”\n            *   Statement 2: “Einstein was born on 20th March 1879.”\n        *   **Step 2**: Verify if each statement can be inferred from the given context.\n            *   Statement 1: Yes\n            *   Statement 2: No\n        *   **Step 3**: Calculate the faithfulness score using the formula.\n            \n            Faithfulness\\=12\\=0.5Faithfulness\\=12\\=0.5\n            \n            \\\\text{Faithfulness} = \\\\frac{1}{2} = 0.5\n\n*   The faithfulness of a generated answer is determined by checking if all the atomic (stand-alone) claims made in the answer can be inferred from the provided context. The process involves identifying a set of atomic claims from the answer and cross-referencing each claim with the context to confirm if it can be inferred. The faithfulness score is calculated using the formula:\n\n**Example** [(source)](https://docs.ragas.io/en/latest/concepts/metrics/faithfulness.html): _Question_: Where and when was Einstein born? _Context_: Albert Einstein (born 14 March 1879) was a German-born theoretical physicist, widely held to be one of the greatest and most influential scientists of all time.\n\n*   **High faithfulness answer**: Einstein was born in Germany on 14th March 1879.\n*   **Low faithfulness answer**: Einstein was born in Germany on 20th March 1879.\n    \n*   For the low faithfulness answer:\n    *   **Step 1**: Break the generated answer into individual statements.\n        *   Statement 1: “Einstein was born in Germany.”\n        *   Statement 2: “Einstein was born on 20th March 1879.”\n    *   **Step 2**: Verify if each statement can be inferred from the given context.\n        *   Statement 1: Yes\n        *   Statement 2: No\n    *   **Step 3**: Calculate the faithfulness score using the formula.\n        \n        Faithfulness\\=12\\=0.5Faithfulness\\=12\\=0.5\n        \n        \\\\text{Faithfulness} = \\\\frac{1}{2} = 0.5\n\n**Low faithfulness answer**: Einstein was born in Germany on 20th March 1879.\n\n*   **Step 1**: Break the generated answer into individual statements.\n    *   Statement 1: “Einstein was born in Germany.”\n    *   Statement 2: “Einstein was born on 20th March 1879.”\n*   **Step 2**: Verify if each statement can be inferred from the given context.\n    *   Statement 1: Yes\n    *   Statement 2: No\n*   **Step 3**: Calculate the faithfulness score using the formula.\n    \n    Faithfulness\\=12\\=0.5Faithfulness\\=12\\=0.5\n    \n    \\\\text{Faithfulness} = \\\\frac{1}{2} = 0.5\n\n*   Statement 1: “Einstein was born in Germany.”\n*   Statement 2: “Einstein was born on 20th March 1879.”\n\n*   Statement 1: Yes\n*   Statement 2: No\n\n**Step 3**: Calculate the faithfulness score using the formula.\n\n#### Answer Relevance\n\n*   **Definition**:\n    \n    *   The Answer Relevance metric evaluates how closely the generated answer aligns with the given query/prompt. This assessment focuses on the pertinence of the response, penalizing answers that are incomplete or contain redundant information. Higher scores indicate better relevance. The overarching concept behind answer relevance is that if the answer correctly addresses the question, it is likely that the original question can be accurately reconstructed from the answer alone.\n    *   Answer relevance is reference free metric. If you’re looking to compare ground truth answer with generated answer refer to [Answer Correctness](#answer-correctness).\n    *   The image below [(source)](https://learn.deeplearning.ai/building-evaluating-advanced-rag/lesson/2/advanced-rag-pipeline) shows the output format of Answer Relevance.\n    \n    ![](/primers/ai/assets/RAG/7.png)\n    \n*   **Evaluation Approach**:\n    \n    *   Answer Relevance is quantified by calculating the mean cosine similarity between the original question and a set of generated questions based on the provided answer. Specifically, the metric is defined as follows:\n    \n    \\\\text{Answer Relevance} = \\\\frac{1}{N} \\\\sum\\_{i=1}^N \\\\cos (E\\_{g\\_i}, E\\_o) \\\\\\\\  \n    \\= \\\\frac{1}{N} \\\\sum\\_{i=1}^N \\\\frac{E\\_{g\\_i} \\\\cdot E\\_o}{\\\\left\\\\mid E\\_{g\\_i}\\\\right\\\\mid \\\\left\\\\mid E\\_o\\\\right\\\\mid}\\\\text{Answer Relevance} = \\\\frac{1}{N} \\\\sum\\_{i=1}^N \\\\cos (E\\_{g\\_i}, E\\_o) \\\\\\\\= \\\\frac{1}{N} \\\\sum\\_{i=1}^N \\\\frac{E\\_{g\\_i} \\\\cdot E\\_o}{\\\\left\\\\mid E\\_{g\\_i}\\\\right\\\\mid \\\\left\\\\mid E\\_o\\\\right\\\\mid}\n    \n    \\\\text{Answer Relevance} = \\\\frac{1}{N} \\\\sum\\_{i=1}^N \\\\cos (E\\_{g\\_i}, E\\_o) \\\\\\\\ = \\\\frac{1}{N} \\\\sum\\_{i=1}^N \\\\frac{E\\_{g\\_i} \\\\cdot E\\_o}{\\\\left\\\\mid E\\_{g\\_i}\\\\right\\\\mid \\\\left\\\\mid E\\_o\\\\right\\\\mid}\n    *   where:\n        *   EgiEgiE\\_{g\\_i} is the embedding of the generated question iii.\n        *   EoEoE\\_o is the embedding of the original question.\n        *   NNN is the number of generated questions, typically set to 3 by default.\n    *   It is important to note that although the score generally ranges from 0 to 1, it is not strictly limited to this range due to the cosine similarity measure, which can range from -1 to 1. This metric does not rely on a reference answer and is purely focused on the relevance of the generated answer to the original question. If comparing the ground truth answer with the generated answer is required, one should refer to the “answer correctness” metric.\n    *   An answer is considered relevant if it directly and appropriately responds to the original question. This metric does not consider the factual accuracy of the answer but rather penalizes cases where the answer is incomplete or contains unnecessary details. The process involves prompting a Large Language Model (LLM) to generate appropriate questions based on the provided answer and then measuring the mean cosine similarity between these questions and the original question. The idea is that a highly relevant answer should allow the LLM to generate questions that closely align with the original question.\n*   **Example**:\n    *   **Question**: Where is France and what is its capital?\n    *   **Low relevance answer**: France is in Western Europe.\n    *   **High relevance answer**: France is in Western Europe and Paris is its capital.\n*   **Calculation Steps**:\n    1.  **Step 1**: Generate nnn variants of the question from the provided answer using an LLM. For example:\n        *   Question 1: “In which part of Europe is France located?”\n        *   Question 2: “What is the geographical location of France within Europe?”\n        *   Question 3: “Can you identify the region of Europe where France is situated?”\n    2.  **Step 2**: Calculate the mean cosine similarity between these generated questions and the original question.\n\n*   The Answer Relevance metric evaluates how closely the generated answer aligns with the given query/prompt. This assessment focuses on the pertinence of the response, penalizing answers that are incomplete or contain redundant information. Higher scores indicate better relevance. The overarching concept behind answer relevance is that if the answer correctly addresses the question, it is likely that the original question can be accurately reconstructed from the answer alone.\n*   Answer relevance is reference free metric. If you’re looking to compare ground truth answer with generated answer refer to [Answer Correctness](#answer-correctness).\n*   The image below [(source)](https://learn.deeplearning.ai/building-evaluating-advanced-rag/lesson/2/advanced-rag-pipeline) shows the output format of Answer Relevance.\n\n![](/primers/ai/assets/RAG/7.png)\n\n*   Answer Relevance is quantified by calculating the mean cosine similarity between the original question and a set of generated questions based on the provided answer. Specifically, the metric is defined as follows:\n\n*   where:\n    *   EgiEgiE\\_{g\\_i} is the embedding of the generated question iii.\n    *   EoEoE\\_o is the embedding of the original question.\n    *   NNN is the number of generated questions, typically set to 3 by default.\n*   It is important to note that although the score generally ranges from 0 to 1, it is not strictly limited to this range due to the cosine similarity measure, which can range from -1 to 1. This metric does not rely on a reference answer and is purely focused on the relevance of the generated answer to the original question. If comparing the ground truth answer with the generated answer is required, one should refer to the “answer correctness” metric.\n*   An answer is considered relevant if it directly and appropriately responds to the original question. This metric does not consider the factual accuracy of the answer but rather penalizes cases where the answer is incomplete or contains unnecessary details. The process involves prompting a Large Language Model (LLM) to generate appropriate questions based on the provided answer and then measuring the mean cosine similarity between these questions and the original question. The idea is that a highly relevant answer should allow the LLM to generate questions that closely align with the original question.\n\n*   EgiEgiE\\_{g\\_i} is the embedding of the generated question iii.\n*   EoEoE\\_o is the embedding of the original question.\n*   NNN is the number of generated questions, typically set to 3 by default.\n\n*   **Question**: Where is France and what is its capital?\n*   **Low relevance answer**: France is in Western Europe.\n*   **High relevance answer**: France is in Western Europe and Paris is its capital.\n\n1.  **Step 1**: Generate nnn variants of the question from the provided answer using an LLM. For example:\n    *   Question 1: “In which part of Europe is France located?”\n    *   Question 2: “What is the geographical location of France within Europe?”\n    *   Question 3: “Can you identify the region of Europe where France is situated?”\n2.  **Step 2**: Calculate the mean cosine similarity between these generated questions and the original question.\n\n*   Question 1: “In which part of Europe is France located?”\n*   Question 2: “What is the geographical location of France within Europe?”\n*   Question 3: “Can you identify the region of Europe where France is situated?”\n\n#### Answer Semantic Similarity\n\n*   **Category**: Answer Quality and Semantic Alignment\n*   **Requirement**: Access to ground truth answers is necessary to evaluate the semantic similarity of generated responses accurately.\n*   **Definition**: Evaluates the degree of semantic similarity between the generated answer by the RAG system and the ground truth. This metric specifically assesses how closely the meaning of the generated answer mirrors that of the ground truth.\n*   **Measurement Methods**: This metric is measured using cross-encoder models designed to calculate the semantic similarity score. These models analyze the semantic content of both the generated answer and the ground truth.\n*   **Evaluation Approach**: The approach involves comparing the generated answer with the ground truth to determine the extent of semantic overlap. The semantic similarity is quantified on a scale from 0 to 1, where higher scores indicate a greater alignment between the generated answer and the ground truth. The formula for Answer Semantic Similarity is implicitly based on the evaluation of semantic overlap rather than a direct formula.\n    \n*   **BERTScore**:\n    *   Uses contextual embeddings from pre-trained BERT models to match tokens in the candidate and reference text.\n    *   Computes precision, recall, and F1 scores by aligning embeddings based on cosine similarity, capturing nuanced semantic overlap.\n*   **MoverScore**:\n    *   Extends BERTScore by incorporating Earth Mover’s Distance (EMD) to assess the minimal semantic “effort” needed to transform one text into another.\n    *   Leverages both contextual embeddings and IDF weighting to emphasize important content over common filler words.\n*   **Advantages of MoverScore over BERTScore**:\n    *   Better captures the global semantic flow between texts by considering word importance and distribution, not just local alignment.\n    *   More robust in handling paraphrased or reordered sentences, where BERTScore may undervalue semantic similarity due to token-level matching.\n*   **Example**:\n    *   **Ground truth**: Albert Einstein’s theory of relativity revolutionized our understanding of the universe.\n    *   **High similarity answer**: Einstein’s groundbreaking theory of relativity transformed our comprehension of the cosmos.\n    *   **Low similarity answer**: Isaac Newton’s laws of motion greatly influenced classical physics.\n*   In this metric, a higher score reflects a better quality of the generated response in terms of its semantic closeness to the ground truth, indicating a more accurate and contextually relevant answer.\n\n**Evaluation Approach**: The approach involves comparing the generated answer with the ground truth to determine the extent of semantic overlap. The semantic similarity is quantified on a scale from 0 to 1, where higher scores indicate a greater alignment between the generated answer and the ground truth. The formula for Answer Semantic Similarity is implicitly based on the evaluation of semantic overlap rather than a direct formula.\n\n*   Uses contextual embeddings from pre-trained BERT models to match tokens in the candidate and reference text.\n*   Computes precision, recall, and F1 scores by aligning embeddings based on cosine similarity, capturing nuanced semantic overlap.\n\n*   Extends BERTScore by incorporating Earth Mover’s Distance (EMD) to assess the minimal semantic “effort” needed to transform one text into another.\n*   Leverages both contextual embeddings and IDF weighting to emphasize important content over common filler words.\n\n*   Better captures the global semantic flow between texts by considering word importance and distribution, not just local alignment.\n*   More robust in handling paraphrased or reordered sentences, where BERTScore may undervalue semantic similarity due to token-level matching.\n\n*   **Ground truth**: Albert Einstein’s theory of relativity revolutionized our understanding of the universe.\n*   **High similarity answer**: Einstein’s groundbreaking theory of relativity transformed our comprehension of the cosmos.\n*   **Low similarity answer**: Isaac Newton’s laws of motion greatly influenced classical physics.\n\n#### BLEU Score\n\n*   **Category**: N-gram Precision-Based Evaluation\n*   **Requirement**: Access to ground truth references is necessary to evaluate the BLEU score.\n*   **Definition**: BLEU (Bilingual Evaluation Understudy) is a metric that evaluates the quality of text by comparing a candidate translation to one or more reference translations. It measures the precision of n-grams in the candidate text that appear in the reference texts, with a brevity penalty to penalize overly short translations.\n*   **Measurement Methods**: BLEU calculates modified n-gram precision for n-grams up to a specified length (commonly 4). It also applies a brevity penalty to account for short candidate translations that might otherwise score artificially high.\n*   **Evaluation Approach**: The BLEU score is computed using the formula:\n    \n    BLEU\\=BP×exp(∑n\\=1Nwnlogpn)BLEU\\=BP×exp⁡(∑n\\=1Nwnlog⁡pn)\n    \n    \\\\text{BLEU} = \\\\text{BP} \\\\times \\\\exp\\\\left( \\\\sum\\_{n=1}^{N} w\\_n \\\\log p\\_n \\\\right)\n    *   where:\n        *   BPBP\\\\text{BP} is the brevity penalty.\n        *   pnpnp\\_n is the modified n-gram precision.\n        *   wnwnw\\_n is the weight for each n-gram (typically uniform).\n*   **Example**:\n    *   **Reference**: The cat is on the mat.\n    *   **Candidate**: The cat is on mat.\n    *   **Unigram Precision**: 5 matches out of 5 words = 1.0\n    *   **Bigram Precision**: 4 matches out of 4 bigrams = 1.0\n    *   **Trigram Precision**: 3 matches out of 3 trigrams = 1.0\n    *   **4-gram Precision**: 2 matches out of 2 four-grams = 1.0\n    *   **Brevity Penalty**: Applied due to shorter length.\n    *   **BLEU Score**: Calculated by combining precisions and brevity penalty.\n    *   In this example, despite high n-gram precision, the brevity penalty reduces the BLEU score to account for the missing word “the” before “mat.”\n\n**Evaluation Approach**: The BLEU score is computed using the formula:\n\n*   where:\n    *   BPBP\\\\text{BP} is the brevity penalty.\n    *   pnpnp\\_n is the modified n-gram precision.\n    *   wnwnw\\_n is the weight for each n-gram (typically uniform).\n\n*   BPBP\\\\text{BP} is the brevity penalty.\n*   pnpnp\\_n is the modified n-gram precision.\n*   wnwnw\\_n is the weight for each n-gram (typically uniform).\n\n*   **Reference**: The cat is on the mat.\n*   **Candidate**: The cat is on mat.\n*   **Unigram Precision**: 5 matches out of 5 words = 1.0\n*   **Bigram Precision**: 4 matches out of 4 bigrams = 1.0\n*   **Trigram Precision**: 3 matches out of 3 trigrams = 1.0\n*   **4-gram Precision**: 2 matches out of 2 four-grams = 1.0\n*   **Brevity Penalty**: Applied due to shorter length.\n*   **BLEU Score**: Calculated by combining precisions and brevity penalty.\n*   In this example, despite high n-gram precision, the brevity penalty reduces the BLEU score to account for the missing word “the” before “mat.”\n\n#### ROUGE Score\n\n*   **Category**: Recall-Oriented N-gram Evaluation\n*   **Requirement**: Access to ground truth references is necessary to evaluate the ROUGE score.\n*   **Definition**: ROUGE (Recall-Oriented Understudy for Gisting Evaluation) is a set of metrics used to evaluate automatic summarization and machine translation by comparing the overlap of n-grams between the candidate and reference texts.\n*   **Measurement Methods**: Common variants include:\n    *   **ROUGE-N**: Measures overlap of n-grams.\n    *   **ROUGE-L**: Measures the longest common subsequence.\n    *   **ROUGE-S**: Measures skip-bigram overlap.\n*   **Evaluation Approach**: For ROUGE-N, the recall is calculated as:\n    \n    ROUGE-N\\=Number of matching n-gramsTotal number of n-grams in referenceROUGE-N\\=Number of matching n-gramsTotal number of n-grams in reference\n    \n    \\\\text{ROUGE-N} = \\\\frac{\\\\text{Number of matching n-grams}}{\\\\text{Total number of n-grams in reference}}\n*   **Example**:\n    *   **Reference**: “The cat is on the mat.”\n    *   **Candidate**: “The cat is on mat.”\n    *   **ROUGE-1 (Unigram) Recall**: 5 matches out of 6 unigrams = 0.833\n    *   **ROUGE-2 (Bigram) Recall**: 4 matches out of 5 bigrams = 0.8\n    *   In this example, the candidate misses the unigram “the” before “mat,” affecting the recall scores.\n\n*   **ROUGE-N**: Measures overlap of n-grams.\n*   **ROUGE-L**: Measures the longest common subsequence.\n*   **ROUGE-S**: Measures skip-bigram overlap.\n\n**Evaluation Approach**: For ROUGE-N, the recall is calculated as:\n\n*   **Reference**: “The cat is on the mat.”\n*   **Candidate**: “The cat is on mat.”\n*   **ROUGE-1 (Unigram) Recall**: 5 matches out of 6 unigrams = 0.833\n*   **ROUGE-2 (Bigram) Recall**: 4 matches out of 5 bigrams = 0.8\n*   In this example, the candidate misses the unigram “the” before “mat,” affecting the recall scores.\n\n#### String Presence\n\n*   **Category**: Keyword or Phrase Matching\n*   **Requirement**: Access to ground truth references is necessary to evaluate string presence.\n*   **Definition**: The String Presence metric checks if the generated response contains specific reference text, such as certain keywords or phrases. It is useful in scenarios where ensuring the inclusion of particular content is essential.\n*   **Measurement Methods**: This is a binary metric that returns 1 if the reference string is present in the response and 0 otherwise.\n*   **Evaluation Approach**: The presence of the reference string is verified within the candidate response.\n*   **Example**:\n    *   **Reference**: “climate change”\n    *   **Candidate**: The recent study highlights the impacts of climate change on polar bears.\n    *   **String Presence Score**: 1 (since “climate change” is present in the candidate).\n\n*   **Reference**: “climate change”\n*   **Candidate**: The recent study highlights the impacts of climate change on polar bears.\n*   **String Presence Score**: 1 (since “climate change” is present in the candidate).\n\n#### Exact Match\n\n*   **Category**: Strict Matching Evaluation\n*   **Requirement**: Access to ground truth references is necessary to evaluate exact matches.\n*   **Definition**: The Exact Match metric assesses whether the generated response is identical to the reference text. It is particularly useful in scenarios requiring precise outputs, such as predefined answers or specific commands.\n*   **Measurement Methods**: This binary metric returns 1 if the candidate text matches the reference text exactly and 0 otherwise.\n*   **Evaluation Approach**: A direct comparison is made between the candidate and reference texts.\n*   **Example**:\n    *   **Reference**: E\\=mc2E\\=mc2E=mc^2\n    *   **Candidate**: E\\=mc2E\\=mc2E=mc^2\n    *   **Exact Match Score**: 1 (since the candidate matches the reference exactly).\n\n*   **Reference**: E\\=mc2E\\=mc2E=mc^2\n*   **Candidate**: E\\=mc2E\\=mc2E=mc^2\n*   **Exact Match Score**: 1 (since the candidate matches the reference exactly).\n\n#### Context Entities Recall\n\n*   **Definition**: Context Entities Recall is a metric that measures the recall of entities from the retrieved context compared to the ground truth. It calculates the fraction of entities in the ground truth that are also present in the context. This metric is crucial for scenarios where accurate entity retrieval is essential, such as tourism help desks or historical question answering.\n    \n*   **Evaluation Approach**:\n    *   To compute this metric, two sets are used:\n        *   GEGEGE (Ground Truth Entities): The set of entities present in the ground truth.\n        *   CECECE (Context Entities): The set of entities present in the retrieved context.\n    *   The Context Entities Recall is calculated using the formula:\n        \n        Context Entity Recall\\=|CE∩GE||GE|Context Entity Recall\\=|CE∩GE||GE|\n        \n        \\\\text{Context Entity Recall} = \\\\frac{|CE \\\\cap GE|}{|GE|}\n        *   where, ∣CE∩GE∣∣CE∩GE∣\\\\mid CE \\\\cap GE\\\\mid represents the number of entities common to both the context and the ground truth, while ∣GE∣∣GE∣\\\\mid GE\\\\mid is the total number of entities in the ground truth.\n*   **Example** [(source)](https://docs.ragas.io/en/latest/concepts/metrics/context_entities_recall.html):\n    *   **Ground Truth**: The Taj Mahal is an ivory-white marble mausoleum on the right bank of the river Yamuna in the Indian city of Agra. It was commissioned in 1631 by the Mughal emperor Shah Jahan to house the tomb of his favorite wife, Mumtaz Mahal.\n        \n    *   **High Entity Recall Context**: The Taj Mahal is a symbol of love and architectural marvel located in Agra, India. It was built by the Mughal emperor Shah Jahan in memory of his beloved wife, Mumtaz Mahal. The structure is renowned for its intricate marble work and beautiful gardens surrounding it.\n        \n    *   **Low Entity Recall Context**: The Taj Mahal is an iconic monument in India. It is a UNESCO World Heritage Site and attracts millions of visitors annually. The intricate carvings and stunning architecture make it a must-visit destination.\n        \n    *   **Calculation**:\n        *   **Entities in Ground Truth (GE)**: `['Taj Mahal', 'Yamuna', 'Agra', '1631', 'Shah Jahan', 'Mumtaz Mahal']`\n        *   **Entities in High Entity Recall Context (CE1)**: `['Taj Mahal', 'Agra', 'Shah Jahan', 'Mumtaz Mahal', 'India']`\n        *   **Entities in Low Entity Recall Context (CE2)**: `['Taj Mahal', 'UNESCO', 'India']`\n    *   **Context Entity Recall - 1**:\n        \n        Context Entity Recall - 1\\=|CE1∩GE||GE|\\=46\\=0.666Context Entity Recall - 1\\=|CE1∩GE||GE|\\=46\\=0.666\n        \n        \\\\text{Context Entity Recall - 1} = \\\\frac{|CE1 \\\\cap GE|}{|GE|} = \\\\frac{4}{6} = 0.666\n    *   **Context Entity Recall - 2**:\n        \n        Context Entity Recall - 2\\=|CE2∩GE||GE|\\=16\\=0.166Context Entity Recall - 2\\=|CE2∩GE||GE|\\=16\\=0.166\n        \n        \\\\text{Context Entity Recall - 2} = \\\\frac{|CE2 \\\\cap GE|}{|GE|} = \\\\frac{1}{6} = 0.166\n    *   The first context demonstrates a higher entity recall, indicating better entity coverage in comparison to the ground truth. If these contexts were generated by different retrieval mechanisms, the first mechanism would be deemed superior for applications where entity accuracy is crucial.\n\n**Definition**: Context Entities Recall is a metric that measures the recall of entities from the retrieved context compared to the ground truth. It calculates the fraction of entities in the ground truth that are also present in the context. This metric is crucial for scenarios where accurate entity retrieval is essential, such as tourism help desks or historical question answering.\n\n*   To compute this metric, two sets are used:\n    *   GEGEGE (Ground Truth Entities): The set of entities present in the ground truth.\n    *   CECECE (Context Entities): The set of entities present in the retrieved context.\n*   The Context Entities Recall is calculated using the formula:\n    \n    Context Entity Recall\\=|CE∩GE||GE|Context Entity Recall\\=|CE∩GE||GE|\n    \n    \\\\text{Context Entity Recall} = \\\\frac{|CE \\\\cap GE|}{|GE|}\n    *   where, ∣CE∩GE∣∣CE∩GE∣\\\\mid CE \\\\cap GE\\\\mid represents the number of entities common to both the context and the ground truth, while ∣GE∣∣GE∣\\\\mid GE\\\\mid is the total number of entities in the ground truth.\n\n*   GEGEGE (Ground Truth Entities): The set of entities present in the ground truth.\n*   CECECE (Context Entities): The set of entities present in the retrieved context.\n\nThe Context Entities Recall is calculated using the formula:\n\n*   where, ∣CE∩GE∣∣CE∩GE∣\\\\mid CE \\\\cap GE\\\\mid represents the number of entities common to both the context and the ground truth, while ∣GE∣∣GE∣\\\\mid GE\\\\mid is the total number of entities in the ground truth.\n\n*   **Ground Truth**: The Taj Mahal is an ivory-white marble mausoleum on the right bank of the river Yamuna in the Indian city of Agra. It was commissioned in 1631 by the Mughal emperor Shah Jahan to house the tomb of his favorite wife, Mumtaz Mahal.\n    \n*   **High Entity Recall Context**: The Taj Mahal is a symbol of love and architectural marvel located in Agra, India. It was built by the Mughal emperor Shah Jahan in memory of his beloved wife, Mumtaz Mahal. The structure is renowned for its intricate marble work and beautiful gardens surrounding it.\n    \n*   **Low Entity Recall Context**: The Taj Mahal is an iconic monument in India. It is a UNESCO World Heritage Site and attracts millions of visitors annually. The intricate carvings and stunning architecture make it a must-visit destination.\n    \n*   **Calculation**:\n    *   **Entities in Ground Truth (GE)**: `['Taj Mahal', 'Yamuna', 'Agra', '1631', 'Shah Jahan', 'Mumtaz Mahal']`\n    *   **Entities in High Entity Recall Context (CE1)**: `['Taj Mahal', 'Agra', 'Shah Jahan', 'Mumtaz Mahal', 'India']`\n    *   **Entities in Low Entity Recall Context (CE2)**: `['Taj Mahal', 'UNESCO', 'India']`\n*   **Context Entity Recall - 1**:\n    \n    Context Entity Recall - 1\\=|CE1∩GE||GE|\\=46\\=0.666Context Entity Recall - 1\\=|CE1∩GE||GE|\\=46\\=0.666\n    \n    \\\\text{Context Entity Recall - 1} = \\\\frac{|CE1 \\\\cap GE|}{|GE|} = \\\\frac{4}{6} = 0.666\n*   **Context Entity Recall - 2**:\n    \n    Context Entity Recall - 2\\=|CE2∩GE||GE|\\=16\\=0.166Context Entity Recall - 2\\=|CE2∩GE||GE|\\=16\\=0.166\n    \n    \\\\text{Context Entity Recall - 2} = \\\\frac{|CE2 \\\\cap GE|}{|GE|} = \\\\frac{1}{6} = 0.166\n*   The first context demonstrates a higher entity recall, indicating better entity coverage in comparison to the ground truth. If these contexts were generated by different retrieval mechanisms, the first mechanism would be deemed superior for applications where entity accuracy is crucial.\n\n**Ground Truth**: The Taj Mahal is an ivory-white marble mausoleum on the right bank of the river Yamuna in the Indian city of Agra. It was commissioned in 1631 by the Mughal emperor Shah Jahan to house the tomb of his favorite wife, Mumtaz Mahal.\n\n**High Entity Recall Context**: The Taj Mahal is a symbol of love and architectural marvel located in Agra, India. It was built by the Mughal emperor Shah Jahan in memory of his beloved wife, Mumtaz Mahal. The structure is renowned for its intricate marble work and beautiful gardens surrounding it.\n\n**Low Entity Recall Context**: The Taj Mahal is an iconic monument in India. It is a UNESCO World Heritage Site and attracts millions of visitors annually. The intricate carvings and stunning architecture make it a must-visit destination.\n\n*   **Entities in Ground Truth (GE)**: `['Taj Mahal', 'Yamuna', 'Agra', '1631', 'Shah Jahan', 'Mumtaz Mahal']`\n*   **Entities in High Entity Recall Context (CE1)**: `['Taj Mahal', 'Agra', 'Shah Jahan', 'Mumtaz Mahal', 'India']`\n*   **Entities in Low Entity Recall Context (CE2)**: `['Taj Mahal', 'UNESCO', 'India']`\n\n**Context Entity Recall - 1**:\n\n**Context Entity Recall - 2**:",
    "order": 13,
    "orderInChapter": 2,
    "difficulty": 3,
    "estimatedMinutes": 23,
    "tags": [
      "nlpllms",
      "embedding",
      "bert",
      "llm"
    ],
    "metadata": {
      "hasCode": true,
      "hasMath": true,
      "hasImages": true,
      "wordCount": 4410,
      "contentLength": 166014
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#generation-metrics",
    "scrapedAt": "2025-12-28T11:54:28.277Z"
  },
  {
    "id": "ai-RAG-flow-of-multimodal-input-14",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "Multimodal Input Handling",
    "title": "Flow of Multimodal Input",
    "subtitle": "Multimodal Input Handling",
    "contentHtml": "<ol>\n  <li><strong>Query Input</strong>:\n    <ul>\n      <li>The user submits a query comprising text and an image. For example, a user might upload a picture of a jacket alongside the text query, “Is this jacket available in waterproof material?”</li>\n    </ul>\n  </li>\n  <li><strong>Embedding Multimodal Input</strong>:\n    <ul>\n      <li>Both text and image inputs need to be converted into embeddings to capture their semantic essence. This typically involves:\n        <ul>\n          <li><strong>Text Embedding</strong>: Utilizing models like Sentence-BERT or GPT embeddings to create dense vectors representing the semantic meaning of the textual query.</li>\n          <li><strong>Image Embedding</strong>: Using visual embedding models such as CLIP (Contrastive Language-Image Pre-training), ViT (Vision Transformer), or ResNet variants. These models process images to create dense vector representations capturing visual features.</li>\n        </ul>\n      </li>\n      <li>The resulting embeddings are then concatenated or fused into a single multimodal embedding vector. This fusion captures both the textual semantics and the visual features coherently.</li>\n    </ul>\n  </li>\n  <li><strong>Storage and Retrieval from Vector Database</strong>:\n    <ul>\n      <li>The multimodal embeddings are stored in a vector database, similar to text-only scenarios.</li>\n      <li>During retrieval, multimodal embeddings derived from user queries are compared against the stored embeddings in the database.</li>\n    </ul>\n  </li>\n  <li><strong>Similarity Matching via Cosine Similarity</strong>:\n    <ul>\n      <li>Retrieval involves computing cosine similarity between the multimodal query embedding and the embeddings stored in the vector database.</li>\n      <li>Cosine similarity effectively measures semantic and visual similarity, ensuring retrieved items closely align with both textual context and visual content of the query.</li>\n    </ul>\n  </li>\n  <li><strong>Ranked Results and Response Generation</strong>:\n    <ul>\n      <li>Items with the highest similarity scores – provide specific product details (e.g., material information, waterproof ratings) – are retrieved and ranked according to relevance.</li>\n      <li>These ranked results are then fed into an LLM to synthesize contextually accurate and visually informed responses. The final response leverages the multimodal context to precisely answer queries such as material specifications or availability in different sizes or colors, with a coherent respons such ase: “Yes, this particular jacket model is made from Gore-Tex, which is fully waterproof.”</li>\n    </ul>\n  </li>\n</ol>\n<ul>\n      <li>The user submits a query comprising text and an image. For example, a user might upload a picture of a jacket alongside the text query, “Is this jacket available in waterproof material?”</li>\n    </ul>\n<ul>\n      <li>Both text and image inputs need to be converted into embeddings to capture their semantic essence. This typically involves:\n        <ul>\n          <li><strong>Text Embedding</strong>: Utilizing models like Sentence-BERT or GPT embeddings to create dense vectors representing the semantic meaning of the textual query.</li>\n          <li><strong>Image Embedding</strong>: Using visual embedding models such as CLIP (Contrastive Language-Image Pre-training), ViT (Vision Transformer), or ResNet variants. These models process images to create dense vector representations capturing visual features.</li>\n        </ul>\n      </li>\n      <li>The resulting embeddings are then concatenated or fused into a single multimodal embedding vector. This fusion captures both the textual semantics and the visual features coherently.</li>\n    </ul>\n<ul>\n          <li><strong>Text Embedding</strong>: Utilizing models like Sentence-BERT or GPT embeddings to create dense vectors representing the semantic meaning of the textual query.</li>\n          <li><strong>Image Embedding</strong>: Using visual embedding models such as CLIP (Contrastive Language-Image Pre-training), ViT (Vision Transformer), or ResNet variants. These models process images to create dense vector representations capturing visual features.</li>\n        </ul>\n<ul>\n      <li>The multimodal embeddings are stored in a vector database, similar to text-only scenarios.</li>\n      <li>During retrieval, multimodal embeddings derived from user queries are compared against the stored embeddings in the database.</li>\n    </ul>\n<ul>\n      <li>Retrieval involves computing cosine similarity between the multimodal query embedding and the embeddings stored in the vector database.</li>\n      <li>Cosine similarity effectively measures semantic and visual similarity, ensuring retrieved items closely align with both textual context and visual content of the query.</li>\n    </ul>\n<ul>\n      <li>Items with the highest similarity scores – provide specific product details (e.g., material information, waterproof ratings) – are retrieved and ranked according to relevance.</li>\n      <li>These ranked results are then fed into an LLM to synthesize contextually accurate and visually informed responses. The final response leverages the multimodal context to precisely answer queries such as material specifications or availability in different sizes or colors, with a coherent respons such ase: “Yes, this particular jacket model is made from Gore-Tex, which is fully waterproof.”</li>\n    </ul>",
    "contentMarkdown": "1.  **Query Input**:\n    *   The user submits a query comprising text and an image. For example, a user might upload a picture of a jacket alongside the text query, “Is this jacket available in waterproof material?”\n2.  **Embedding Multimodal Input**:\n    *   Both text and image inputs need to be converted into embeddings to capture their semantic essence. This typically involves:\n        *   **Text Embedding**: Utilizing models like Sentence-BERT or GPT embeddings to create dense vectors representing the semantic meaning of the textual query.\n        *   **Image Embedding**: Using visual embedding models such as CLIP (Contrastive Language-Image Pre-training), ViT (Vision Transformer), or ResNet variants. These models process images to create dense vector representations capturing visual features.\n    *   The resulting embeddings are then concatenated or fused into a single multimodal embedding vector. This fusion captures both the textual semantics and the visual features coherently.\n3.  **Storage and Retrieval from Vector Database**:\n    *   The multimodal embeddings are stored in a vector database, similar to text-only scenarios.\n    *   During retrieval, multimodal embeddings derived from user queries are compared against the stored embeddings in the database.\n4.  **Similarity Matching via Cosine Similarity**:\n    *   Retrieval involves computing cosine similarity between the multimodal query embedding and the embeddings stored in the vector database.\n    *   Cosine similarity effectively measures semantic and visual similarity, ensuring retrieved items closely align with both textual context and visual content of the query.\n5.  **Ranked Results and Response Generation**:\n    *   Items with the highest similarity scores – provide specific product details (e.g., material information, waterproof ratings) – are retrieved and ranked according to relevance.\n    *   These ranked results are then fed into an LLM to synthesize contextually accurate and visually informed responses. The final response leverages the multimodal context to precisely answer queries such as material specifications or availability in different sizes or colors, with a coherent respons such ase: “Yes, this particular jacket model is made from Gore-Tex, which is fully waterproof.”\n\n*   The user submits a query comprising text and an image. For example, a user might upload a picture of a jacket alongside the text query, “Is this jacket available in waterproof material?”\n\n*   Both text and image inputs need to be converted into embeddings to capture their semantic essence. This typically involves:\n    *   **Text Embedding**: Utilizing models like Sentence-BERT or GPT embeddings to create dense vectors representing the semantic meaning of the textual query.\n    *   **Image Embedding**: Using visual embedding models such as CLIP (Contrastive Language-Image Pre-training), ViT (Vision Transformer), or ResNet variants. These models process images to create dense vector representations capturing visual features.\n*   The resulting embeddings are then concatenated or fused into a single multimodal embedding vector. This fusion captures both the textual semantics and the visual features coherently.\n\n*   **Text Embedding**: Utilizing models like Sentence-BERT or GPT embeddings to create dense vectors representing the semantic meaning of the textual query.\n*   **Image Embedding**: Using visual embedding models such as CLIP (Contrastive Language-Image Pre-training), ViT (Vision Transformer), or ResNet variants. These models process images to create dense vector representations capturing visual features.\n\n*   The multimodal embeddings are stored in a vector database, similar to text-only scenarios.\n*   During retrieval, multimodal embeddings derived from user queries are compared against the stored embeddings in the database.\n\n*   Retrieval involves computing cosine similarity between the multimodal query embedding and the embeddings stored in the vector database.\n*   Cosine similarity effectively measures semantic and visual similarity, ensuring retrieved items closely align with both textual context and visual content of the query.\n\n*   Items with the highest similarity scores – provide specific product details (e.g., material information, waterproof ratings) – are retrieved and ranked according to relevance.\n*   These ranked results are then fed into an LLM to synthesize contextually accurate and visually informed responses. The final response leverages the multimodal context to precisely answer queries such as material specifications or availability in different sizes or colors, with a coherent respons such ase: “Yes, this particular jacket model is made from Gore-Tex, which is fully waterproof.”",
    "order": 14,
    "orderInChapter": 1,
    "difficulty": 2,
    "estimatedMinutes": 4,
    "tags": [
      "nlpllms",
      "transformer",
      "embedding",
      "bert",
      "gpt",
      "llm"
    ],
    "metadata": {
      "hasCode": false,
      "hasMath": false,
      "hasImages": false,
      "wordCount": 663,
      "contentLength": 5425
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#flow-of-multimodal-input",
    "scrapedAt": "2025-12-28T11:54:28.277Z"
  },
  {
    "id": "ai-RAG-benefits-of-multimodal-embeddings-in-rag-15",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "Multimodal Input Handling",
    "title": "Benefits of Multimodal Embeddings in RAG",
    "subtitle": "Multimodal Input Handling",
    "contentHtml": "<ul>\n  <li><strong>Enhanced User Experience</strong>: Allows users to naturally query using images, which often conveys more information than text alone.</li>\n  <li><strong>Precision and Relevance</strong>: Combining textual semantics and visual features significantly enhances retrieval accuracy.</li>\n  <li><strong>Scalable Solution</strong>: Multimodal embeddings can seamlessly integrate with existing vector databases, offering scalability and performance optimization.</li>\n</ul>",
    "contentMarkdown": "*   **Enhanced User Experience**: Allows users to naturally query using images, which often conveys more information than text alone.\n*   **Precision and Relevance**: Combining textual semantics and visual features significantly enhances retrieval accuracy.\n*   **Scalable Solution**: Multimodal embeddings can seamlessly integrate with existing vector databases, offering scalability and performance optimization.",
    "order": 15,
    "orderInChapter": 2,
    "difficulty": 2,
    "estimatedMinutes": 1,
    "tags": [
      "nlpllms",
      "embedding",
      "optimization"
    ],
    "metadata": {
      "hasCode": false,
      "hasMath": false,
      "hasImages": false,
      "wordCount": 50,
      "contentLength": 485
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#benefits-of-multimodal-embeddings-in-rag",
    "scrapedAt": "2025-12-28T11:54:28.277Z"
  },
  {
    "id": "ai-RAG-how-agentic-rag-works-16",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "Agentic Retrieval-Augmented Generation",
    "title": "How Agentic RAG Works",
    "subtitle": "Agentic Retrieval-Augmented Generation",
    "contentHtml": "<ul>\n  <li>\n    <p>In an agentic RAG system, AI agents play key roles in the retrieval process, using specialized tools to retrieve context-sensitive information. Unlike traditional RAG, where retrieval functions are static, agentic RAG allows dynamic selection and operation of tools based on query requirements. Retrieval agents may utilize tools such as:</p>\n\n    <ol>\n      <li><strong>Vector Search Engines</strong>: Retrieve information from vectorized data in databases.</li>\n      <li><strong>Web Search Tools</strong>: Access live web data for up-to-date, contextually relevant information.</li>\n      <li><strong>Calculators</strong>: Perform computations for queries that require accurate calculation.</li>\n      <li><strong>APIs for Software Programs</strong>: Programmatically retrieve information from applications like email or chat programs to access user-specific data.</li>\n    </ol>\n  </li>\n  <li>\n    <p>In the context of Agentic RAG, the retrieval process is “agentic,” meaning agents are capable of reasoning and decision-making regarding which sources and tools to use, based on the specific requirements of the query. This flexibility elevates their tool usage beyond simple retrieval, allowing for a more dynamic and adaptive response.</p>\n  </li>\n</ul>\n<p>In an agentic RAG system, AI agents play key roles in the retrieval process, using specialized tools to retrieve context-sensitive information. Unlike traditional RAG, where retrieval functions are static, agentic RAG allows dynamic selection and operation of tools based on query requirements. Retrieval agents may utilize tools such as:</p>\n<ol>\n      <li><strong>Vector Search Engines</strong>: Retrieve information from vectorized data in databases.</li>\n      <li><strong>Web Search Tools</strong>: Access live web data for up-to-date, contextually relevant information.</li>\n      <li><strong>Calculators</strong>: Perform computations for queries that require accurate calculation.</li>\n      <li><strong>APIs for Software Programs</strong>: Programmatically retrieve information from applications like email or chat programs to access user-specific data.</li>\n    </ol>\n<p>In the context of Agentic RAG, the retrieval process is “agentic,” meaning agents are capable of reasoning and decision-making regarding which sources and tools to use, based on the specific requirements of the query. This flexibility elevates their tool usage beyond simple retrieval, allowing for a more dynamic and adaptive response.</p>",
    "contentMarkdown": "*   In an agentic RAG system, AI agents play key roles in the retrieval process, using specialized tools to retrieve context-sensitive information. Unlike traditional RAG, where retrieval functions are static, agentic RAG allows dynamic selection and operation of tools based on query requirements. Retrieval agents may utilize tools such as:\n    \n    1.  **Vector Search Engines**: Retrieve information from vectorized data in databases.\n    2.  **Web Search Tools**: Access live web data for up-to-date, contextually relevant information.\n    3.  **Calculators**: Perform computations for queries that require accurate calculation.\n    4.  **APIs for Software Programs**: Programmatically retrieve information from applications like email or chat programs to access user-specific data.\n*   In the context of Agentic RAG, the retrieval process is “agentic,” meaning agents are capable of reasoning and decision-making regarding which sources and tools to use, based on the specific requirements of the query. This flexibility elevates their tool usage beyond simple retrieval, allowing for a more dynamic and adaptive response.\n    \n\nIn an agentic RAG system, AI agents play key roles in the retrieval process, using specialized tools to retrieve context-sensitive information. Unlike traditional RAG, where retrieval functions are static, agentic RAG allows dynamic selection and operation of tools based on query requirements. Retrieval agents may utilize tools such as:\n\n1.  **Vector Search Engines**: Retrieve information from vectorized data in databases.\n2.  **Web Search Tools**: Access live web data for up-to-date, contextually relevant information.\n3.  **Calculators**: Perform computations for queries that require accurate calculation.\n4.  **APIs for Software Programs**: Programmatically retrieve information from applications like email or chat programs to access user-specific data.\n\nIn the context of Agentic RAG, the retrieval process is “agentic,” meaning agents are capable of reasoning and decision-making regarding which sources and tools to use, based on the specific requirements of the query. This flexibility elevates their tool usage beyond simple retrieval, allowing for a more dynamic and adaptive response.",
    "order": 16,
    "orderInChapter": 1,
    "difficulty": 3,
    "estimatedMinutes": 2,
    "tags": [
      "nlpllms"
    ],
    "metadata": {
      "hasCode": false,
      "hasMath": false,
      "hasImages": false,
      "wordCount": 308,
      "contentLength": 2503
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#how-agentic-rag-works",
    "scrapedAt": "2025-12-28T11:54:28.277Z"
  },
  {
    "id": "ai-RAG-agentic-decision-making-in-retrieval-17",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "Agentic Retrieval-Augmented Generation",
    "title": "Agentic Decision-Making in Retrieval",
    "subtitle": "Agentic Retrieval-Augmented Generation",
    "contentHtml": "<ul>\n  <li>\n    <p>The decision-making process of retrieval agents encompasses several key actions, including:</p>\n\n    <ul>\n      <li><strong>Deciding Whether to Retrieve</strong>: Assessing if additional information is necessary for the query.</li>\n      <li><strong>Choosing the Appropriate Tool</strong>: Selecting the most suitable tool (e.g., a vector search engine or web search) based on the query.</li>\n      <li><strong>Query Formulation</strong>: Refining or rephrasing the query to enhance retrieval accuracy.</li>\n      <li><strong>Evaluating Retrieved Results</strong>: Reviewing the retrieved information to determine sufficiency, and whether further retrieval is needed.</li>\n    </ul>\n  </li>\n</ul>\n<p>The decision-making process of retrieval agents encompasses several key actions, including:</p>\n<ul>\n      <li><strong>Deciding Whether to Retrieve</strong>: Assessing if additional information is necessary for the query.</li>\n      <li><strong>Choosing the Appropriate Tool</strong>: Selecting the most suitable tool (e.g., a vector search engine or web search) based on the query.</li>\n      <li><strong>Query Formulation</strong>: Refining or rephrasing the query to enhance retrieval accuracy.</li>\n      <li><strong>Evaluating Retrieved Results</strong>: Reviewing the retrieved information to determine sufficiency, and whether further retrieval is needed.</li>\n    </ul>",
    "contentMarkdown": "*   The decision-making process of retrieval agents encompasses several key actions, including:\n    \n    *   **Deciding Whether to Retrieve**: Assessing if additional information is necessary for the query.\n    *   **Choosing the Appropriate Tool**: Selecting the most suitable tool (e.g., a vector search engine or web search) based on the query.\n    *   **Query Formulation**: Refining or rephrasing the query to enhance retrieval accuracy.\n    *   **Evaluating Retrieved Results**: Reviewing the retrieved information to determine sufficiency, and whether further retrieval is needed.\n\nThe decision-making process of retrieval agents encompasses several key actions, including:\n\n*   **Deciding Whether to Retrieve**: Assessing if additional information is necessary for the query.\n*   **Choosing the Appropriate Tool**: Selecting the most suitable tool (e.g., a vector search engine or web search) based on the query.\n*   **Query Formulation**: Refining or rephrasing the query to enhance retrieval accuracy.\n*   **Evaluating Retrieved Results**: Reviewing the retrieved information to determine sufficiency, and whether further retrieval is needed.",
    "order": 17,
    "orderInChapter": 2,
    "difficulty": 3,
    "estimatedMinutes": 1,
    "tags": [
      "nlpllms"
    ],
    "metadata": {
      "hasCode": false,
      "hasMath": false,
      "hasImages": false,
      "wordCount": 153,
      "contentLength": 1396
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#agentic-decision-making-in-retrieval",
    "scrapedAt": "2025-12-28T11:54:28.278Z"
  },
  {
    "id": "ai-RAG-agentic-rag-architectures-single-agent-vs-multi-ag-18",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "Agentic Retrieval-Augmented Generation",
    "title": "Agentic RAG Architectures: Single-Agent vs. Multi-Agent Systems",
    "subtitle": "Agentic Retrieval-Augmented Generation",
    "contentHtml": "<ul>\n  <li>Agentic RAG can be implemented with a single agent or multiple agents, each offering unique strengths.</li>\n</ul>\n<h4 id=\"single-agent-rag-router\">Single-Agent RAG (Router)</h4>\n<ul>\n  <li>The simplest implementation of agentic RAG involves a single agent functioning as a “router.” This agent determines the appropriate source or tool for retrieving information based on the query. The single agent toggles between different options, such as a vector database, web search, or an API. This setup provides a versatile retrieval process, enabling access to multiple data sources beyond a single vector search tool.</li>\n  <li>As shown in the figure below (<a href=\"https://weaviate.io/blog/what-is-agentic-rag\">source</a>), the single-agent RAG system (router) architecture involves a single agent serving as a “router,” dynamically selecting the best tool or source based on the query, enabling efficient information retrieval across multiple data channels.</li>\n</ul>\n<p><img src=\"/primers/ai/assets/agents/Single_Agent_RAG_System_Router.png\" alt=\"Agentic RAG Visual Summary\"></p>\n<h4 id=\"multi-agent-rag-systems\">Multi-Agent RAG Systems</h4>\n<ul>\n  <li>\n    <p>For more complex queries, multi-agent RAG systems provide additional flexibility. These systems feature a “master agent” that coordinates several specialized retrieval agents, such as:</p>\n\n    <ul>\n      <li><strong>Internal Data Retrieval Agent</strong>: Retrieves information from proprietary, internal databases.</li>\n      <li><strong>Personal Data Retrieval Agent</strong>: Accesses user-specific information, such as emails or chat history.</li>\n      <li><strong>Public Data Retrieval Agent</strong>: Conducts web searches for up-to-date public information.</li>\n    </ul>\n  </li>\n  <li>\n    <p>By utilizing multiple agents tailored to specific sources or tasks, multi-agent RAG systems can deliver comprehensive, accurate responses across diverse channels.</p>\n  </li>\n  <li>\n    <p>As shown in the figure below (<a href=\"https://weaviate.io/blog/what-is-agentic-rag\">source</a>), the multi-agent RAG system architecture utilizes multiple specialized retrieval agents to access different sources and tools, offering a flexible and comprehensive approach to complex queries.</p>\n  </li>\n</ul>\n<p>For more complex queries, multi-agent RAG systems provide additional flexibility. These systems feature a “master agent” that coordinates several specialized retrieval agents, such as:</p>\n<ul>\n      <li><strong>Internal Data Retrieval Agent</strong>: Retrieves information from proprietary, internal databases.</li>\n      <li><strong>Personal Data Retrieval Agent</strong>: Accesses user-specific information, such as emails or chat history.</li>\n      <li><strong>Public Data Retrieval Agent</strong>: Conducts web searches for up-to-date public information.</li>\n    </ul>\n<p>By utilizing multiple agents tailored to specific sources or tasks, multi-agent RAG systems can deliver comprehensive, accurate responses across diverse channels.</p>\n<p>As shown in the figure below (<a href=\"https://weaviate.io/blog/what-is-agentic-rag\">source</a>), the multi-agent RAG system architecture utilizes multiple specialized retrieval agents to access different sources and tools, offering a flexible and comprehensive approach to complex queries.</p>\n<p><img src=\"/primers/ai/assets/agents/Multi_Agent_RAG_System.png\" alt=\"Agentic RAG Visual Summary\"></p>",
    "contentMarkdown": "*   Agentic RAG can be implemented with a single agent or multiple agents, each offering unique strengths.\n\n#### Single-Agent RAG (Router)\n\n*   The simplest implementation of agentic RAG involves a single agent functioning as a “router.” This agent determines the appropriate source or tool for retrieving information based on the query. The single agent toggles between different options, such as a vector database, web search, or an API. This setup provides a versatile retrieval process, enabling access to multiple data sources beyond a single vector search tool.\n*   As shown in the figure below ([source](https://weaviate.io/blog/what-is-agentic-rag)), the single-agent RAG system (router) architecture involves a single agent serving as a “router,” dynamically selecting the best tool or source based on the query, enabling efficient information retrieval across multiple data channels.\n\n![Agentic RAG Visual Summary](/primers/ai/assets/agents/Single_Agent_RAG_System_Router.png)\n\n#### Multi-Agent RAG Systems\n\n*   For more complex queries, multi-agent RAG systems provide additional flexibility. These systems feature a “master agent” that coordinates several specialized retrieval agents, such as:\n    \n    *   **Internal Data Retrieval Agent**: Retrieves information from proprietary, internal databases.\n    *   **Personal Data Retrieval Agent**: Accesses user-specific information, such as emails or chat history.\n    *   **Public Data Retrieval Agent**: Conducts web searches for up-to-date public information.\n*   By utilizing multiple agents tailored to specific sources or tasks, multi-agent RAG systems can deliver comprehensive, accurate responses across diverse channels.\n    \n*   As shown in the figure below ([source](https://weaviate.io/blog/what-is-agentic-rag)), the multi-agent RAG system architecture utilizes multiple specialized retrieval agents to access different sources and tools, offering a flexible and comprehensive approach to complex queries.\n    \n\nFor more complex queries, multi-agent RAG systems provide additional flexibility. These systems feature a “master agent” that coordinates several specialized retrieval agents, such as:\n\n*   **Internal Data Retrieval Agent**: Retrieves information from proprietary, internal databases.\n*   **Personal Data Retrieval Agent**: Accesses user-specific information, such as emails or chat history.\n*   **Public Data Retrieval Agent**: Conducts web searches for up-to-date public information.\n\nBy utilizing multiple agents tailored to specific sources or tasks, multi-agent RAG systems can deliver comprehensive, accurate responses across diverse channels.\n\nAs shown in the figure below ([source](https://weaviate.io/blog/what-is-agentic-rag)), the multi-agent RAG system architecture utilizes multiple specialized retrieval agents to access different sources and tools, offering a flexible and comprehensive approach to complex queries.\n\n![Agentic RAG Visual Summary](/primers/ai/assets/agents/Multi_Agent_RAG_System.png)",
    "order": 18,
    "orderInChapter": 3,
    "difficulty": 3,
    "estimatedMinutes": 2,
    "tags": [
      "nlpllms"
    ],
    "metadata": {
      "hasCode": false,
      "hasMath": false,
      "hasImages": true,
      "wordCount": 371,
      "contentLength": 3425
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#agentic-rag-architectures:-single-agent-vs.-multi-agent-systems",
    "scrapedAt": "2025-12-28T11:54:28.278Z"
  },
  {
    "id": "ai-RAG-beyond-retrieval-expanding-agentic-rags-capabiliti-19",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "Agentic Retrieval-Augmented Generation",
    "title": "Beyond Retrieval: Expanding Agentic RAG’s Capabilities",
    "subtitle": "Agentic Retrieval-Augmented Generation",
    "contentHtml": "<ul>\n  <li>\n    <p>Agentic RAG systems can incorporate agents for tasks beyond retrieval, including:</p>\n\n    <ul>\n      <li><strong>Validating Information</strong>: Cross-referencing data across sources to ensure accuracy.</li>\n      <li><strong>Performing Multi-step Reasoning</strong>: Following logical steps to address complex queries before generating responses.</li>\n      <li><strong>Updating System Memory</strong>: Tracking and retaining user-specific preferences or past queries, enabling personalized and context-aware responses.</li>\n    </ul>\n  </li>\n  <li>\n    <p>By expanding its capabilities beyond simple retrieval, Agentic RAG delivers a powerful, context-sensitive AI solution capable of handling intricate, real-world applications.</p>\n  </li>\n</ul>\n<p>Agentic RAG systems can incorporate agents for tasks beyond retrieval, including:</p>\n<ul>\n      <li><strong>Validating Information</strong>: Cross-referencing data across sources to ensure accuracy.</li>\n      <li><strong>Performing Multi-step Reasoning</strong>: Following logical steps to address complex queries before generating responses.</li>\n      <li><strong>Updating System Memory</strong>: Tracking and retaining user-specific preferences or past queries, enabling personalized and context-aware responses.</li>\n    </ul>\n<p>By expanding its capabilities beyond simple retrieval, Agentic RAG delivers a powerful, context-sensitive AI solution capable of handling intricate, real-world applications.</p>",
    "contentMarkdown": "*   Agentic RAG systems can incorporate agents for tasks beyond retrieval, including:\n    \n    *   **Validating Information**: Cross-referencing data across sources to ensure accuracy.\n    *   **Performing Multi-step Reasoning**: Following logical steps to address complex queries before generating responses.\n    *   **Updating System Memory**: Tracking and retaining user-specific preferences or past queries, enabling personalized and context-aware responses.\n*   By expanding its capabilities beyond simple retrieval, Agentic RAG delivers a powerful, context-sensitive AI solution capable of handling intricate, real-world applications.\n    \n\nAgentic RAG systems can incorporate agents for tasks beyond retrieval, including:\n\n*   **Validating Information**: Cross-referencing data across sources to ensure accuracy.\n*   **Performing Multi-step Reasoning**: Following logical steps to address complex queries before generating responses.\n*   **Updating System Memory**: Tracking and retaining user-specific preferences or past queries, enabling personalized and context-aware responses.\n\nBy expanding its capabilities beyond simple retrieval, Agentic RAG delivers a powerful, context-sensitive AI solution capable of handling intricate, real-world applications.",
    "order": 19,
    "orderInChapter": 4,
    "difficulty": 3,
    "estimatedMinutes": 1,
    "tags": [
      "nlpllms"
    ],
    "metadata": {
      "hasCode": false,
      "hasMath": false,
      "hasImages": false,
      "wordCount": 148,
      "contentLength": 1487
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#beyond-retrieval:-expanding-agentic-rag’s-capabilities",
    "scrapedAt": "2025-12-28T11:54:28.278Z"
  },
  {
    "id": "ai-RAG-agentic-rag-vs-vanilla-rag-key-differences-20",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "Agentic Retrieval-Augmented Generation",
    "title": "Agentic RAG vs. Vanilla RAG: Key Differences",
    "subtitle": "Agentic Retrieval-Augmented Generation",
    "contentHtml": "<ul>\n  <li>While both vanilla and agentic RAG systems aim to retrieve information and generate responses, agentic RAG introduces several significant enhancements:</li>\n</ul>\n<div align=\"center\">\n<table class=\"tg\">\n <thead>\n<tr>\n<th class=\"tg-hcenter-valign-first\"><strong>Feature</strong></th>\n<th class=\"tg-hcenter-valign-first\"><strong>Vanilla RAG</strong></th>\n<th class=\"tg-hcenter-valign-second\"><strong>Agentic RAG</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td class=\"tg-tleft-valign-first\">Access to External Tools</td>\n<td class=\"tg-tleft-valign-first\">No</td>\n<td class=\"tg-tleft-valign-second\">Yes – Utilizes external tools like vector search engines, web search tools, calculators, and APIs.</td>\n</tr>\n<tr>\n<td class=\"tg-tleft-valign-first\">Query Pre-processing</td>\n<td class=\"tg-tleft-valign-first\">No</td>\n<td class=\"tg-tleft-valign-second\">Yes – Agents dynamically refine, rephrase, and adapt queries for optimized retrieval.</td>\n</tr>\n<tr>\n<td class=\"tg-tleft-valign-first\">Decision-making in Retrieval</td>\n<td class=\"tg-tleft-valign-first\">Limited to direct retrieval from knowledge base</td>\n<td class=\"tg-tleft-valign-second\">Agents autonomously decide if retrieval is needed, select tools, and adapt based on query complexity and source type.</td>\n</tr>\n<tr>\n<td class=\"tg-tleft-valign-first\">Multi-step Retrieval Process</td>\n<td class=\"tg-tleft-valign-first\">No</td>\n<td class=\"tg-tleft-valign-second\">Yes – Agents perform multi-step, adaptive retrieval processes involving various sources or tool combinations.</td>\n</tr>\n<tr>\n<td class=\"tg-tleft-valign-first\">Data Validation</td>\n<td class=\"tg-tleft-valign-first\">No</td>\n<td class=\"tg-tleft-valign-second\">Yes – Information is cross-referenced across sources to validate accuracy, supporting complex, real-world responses.</td>\n</tr>\n<tr>\n<td class=\"tg-tleft-valign-first\">Dynamic Tool Selection</td>\n<td class=\"tg-tleft-valign-first\">Static retrieval tools only</td>\n<td class=\"tg-tleft-valign-second\">Dynamic – Agents choose specific tools (e.g., vector search, APIs) based on query needs.</td>\n</tr>\n<tr>\n<td class=\"tg-tleft-valign-first\">Adaptability to Query</td>\n<td class=\"tg-tleft-valign-first\">Limited</td>\n<td class=\"tg-tleft-valign-second\">Highly adaptive – Agents select and operate tools based on real-time assessment of query requirements.</td>\n</tr>\n<tr>\n<td class=\"tg-tleft-valign-first\">Types of Agents</td>\n<td class=\"tg-tleft-valign-first\">Not applicable</td>\n<td class=\"tg-tleft-valign-second\">Multiple specialized agents, such as internal data retrieval, personal data retrieval, public data retrieval.</td>\n</tr>\n<tr>\n<td class=\"tg-tleft-valign-first\">Single-Agent vs. Multi-Agent System</td>\n<td class=\"tg-tleft-valign-first\">Not applicable</td>\n<td class=\"tg-tleft-valign-second\">Single-agent router or multi-agent systems, with “master” and specialized agents for complex queries.</td>\n</tr>\n<tr>\n<td class=\"tg-tleft-valign-first\">Reasoning and Logic Capability</td>\n<td class=\"tg-tleft-valign-first\">No</td>\n<td class=\"tg-tleft-valign-second\">Yes – Supports multi-step reasoning, allowing logical sequence handling before generating responses.</td>\n</tr>\n<tr>\n<td class=\"tg-tleft-valign-first\">Memory and Personalization</td>\n<td class=\"tg-tleft-valign-first\">Limited to immediate query</td>\n<td class=\"tg-tleft-valign-second\">Yes – Capable of updating memory to retain user preferences or history, allowing personalized responses.</td>\n</tr>\n<tr>\n<td class=\"tg-tleft-valign-first\">Real-world Applications</td>\n<td class=\"tg-tleft-valign-first\">Primarily static responses from a fixed database</td>\n<td class=\"tg-tleft-valign-second\">Supports a wide range of real-world applications by responding to complex, nuanced inquiries with context sensitivity.</td>\n</tr>\n</tbody>\n</table>\n</div>\n<table class=\"tg\">\n <thead>\n<tr>\n<th class=\"tg-hcenter-valign-first\"><strong>Feature</strong></th>\n<th class=\"tg-hcenter-valign-first\"><strong>Vanilla RAG</strong></th>\n<th class=\"tg-hcenter-valign-second\"><strong>Agentic RAG</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td class=\"tg-tleft-valign-first\">Access to External Tools</td>\n<td class=\"tg-tleft-valign-first\">No</td>\n<td class=\"tg-tleft-valign-second\">Yes – Utilizes external tools like vector search engines, web search tools, calculators, and APIs.</td>\n</tr>\n<tr>\n<td class=\"tg-tleft-valign-first\">Query Pre-processing</td>\n<td class=\"tg-tleft-valign-first\">No</td>\n<td class=\"tg-tleft-valign-second\">Yes – Agents dynamically refine, rephrase, and adapt queries for optimized retrieval.</td>\n</tr>\n<tr>\n<td class=\"tg-tleft-valign-first\">Decision-making in Retrieval</td>\n<td class=\"tg-tleft-valign-first\">Limited to direct retrieval from knowledge base</td>\n<td class=\"tg-tleft-valign-second\">Agents autonomously decide if retrieval is needed, select tools, and adapt based on query complexity and source type.</td>\n</tr>\n<tr>\n<td class=\"tg-tleft-valign-first\">Multi-step Retrieval Process</td>\n<td class=\"tg-tleft-valign-first\">No</td>\n<td class=\"tg-tleft-valign-second\">Yes – Agents perform multi-step, adaptive retrieval processes involving various sources or tool combinations.</td>\n</tr>\n<tr>\n<td class=\"tg-tleft-valign-first\">Data Validation</td>\n<td class=\"tg-tleft-valign-first\">No</td>\n<td class=\"tg-tleft-valign-second\">Yes – Information is cross-referenced across sources to validate accuracy, supporting complex, real-world responses.</td>\n</tr>\n<tr>\n<td class=\"tg-tleft-valign-first\">Dynamic Tool Selection</td>\n<td class=\"tg-tleft-valign-first\">Static retrieval tools only</td>\n<td class=\"tg-tleft-valign-second\">Dynamic – Agents choose specific tools (e.g., vector search, APIs) based on query needs.</td>\n</tr>\n<tr>\n<td class=\"tg-tleft-valign-first\">Adaptability to Query</td>\n<td class=\"tg-tleft-valign-first\">Limited</td>\n<td class=\"tg-tleft-valign-second\">Highly adaptive – Agents select and operate tools based on real-time assessment of query requirements.</td>\n</tr>\n<tr>\n<td class=\"tg-tleft-valign-first\">Types of Agents</td>\n<td class=\"tg-tleft-valign-first\">Not applicable</td>\n<td class=\"tg-tleft-valign-second\">Multiple specialized agents, such as internal data retrieval, personal data retrieval, public data retrieval.</td>\n</tr>\n<tr>\n<td class=\"tg-tleft-valign-first\">Single-Agent vs. Multi-Agent System</td>\n<td class=\"tg-tleft-valign-first\">Not applicable</td>\n<td class=\"tg-tleft-valign-second\">Single-agent router or multi-agent systems, with “master” and specialized agents for complex queries.</td>\n</tr>\n<tr>\n<td class=\"tg-tleft-valign-first\">Reasoning and Logic Capability</td>\n<td class=\"tg-tleft-valign-first\">No</td>\n<td class=\"tg-tleft-valign-second\">Yes – Supports multi-step reasoning, allowing logical sequence handling before generating responses.</td>\n</tr>\n<tr>\n<td class=\"tg-tleft-valign-first\">Memory and Personalization</td>\n<td class=\"tg-tleft-valign-first\">Limited to immediate query</td>\n<td class=\"tg-tleft-valign-second\">Yes – Capable of updating memory to retain user preferences or history, allowing personalized responses.</td>\n</tr>\n<tr>\n<td class=\"tg-tleft-valign-first\">Real-world Applications</td>\n<td class=\"tg-tleft-valign-first\">Primarily static responses from a fixed database</td>\n<td class=\"tg-tleft-valign-second\">Supports a wide range of real-world applications by responding to complex, nuanced inquiries with context sensitivity.</td>\n</tr>\n</tbody>\n</table>\n<ul>\n  <li>Drawing a parallel with problem-solving, agentic RAG offers capabilities akin to having a smartphone in hand—equipped with multiple apps and tools to help answer a question—whereas vanilla RAG is akin to being in a library with limited resources.</li>\n</ul>",
    "contentMarkdown": "*   While both vanilla and agentic RAG systems aim to retrieve information and generate responses, agentic RAG introduces several significant enhancements:\n\n**Feature**\n\n**Vanilla RAG**\n\n**Agentic RAG**\n\nAccess to External Tools\n\nNo\n\nYes – Utilizes external tools like vector search engines, web search tools, calculators, and APIs.\n\nQuery Pre-processing\n\nNo\n\nYes – Agents dynamically refine, rephrase, and adapt queries for optimized retrieval.\n\nDecision-making in Retrieval\n\nLimited to direct retrieval from knowledge base\n\nAgents autonomously decide if retrieval is needed, select tools, and adapt based on query complexity and source type.\n\nMulti-step Retrieval Process\n\nNo\n\nYes – Agents perform multi-step, adaptive retrieval processes involving various sources or tool combinations.\n\nData Validation\n\nNo\n\nYes – Information is cross-referenced across sources to validate accuracy, supporting complex, real-world responses.\n\nDynamic Tool Selection\n\nStatic retrieval tools only\n\nDynamic – Agents choose specific tools (e.g., vector search, APIs) based on query needs.\n\nAdaptability to Query\n\nLimited\n\nHighly adaptive – Agents select and operate tools based on real-time assessment of query requirements.\n\nTypes of Agents\n\nNot applicable\n\nMultiple specialized agents, such as internal data retrieval, personal data retrieval, public data retrieval.\n\nSingle-Agent vs. Multi-Agent System\n\nNot applicable\n\nSingle-agent router or multi-agent systems, with “master” and specialized agents for complex queries.\n\nReasoning and Logic Capability\n\nNo\n\nYes – Supports multi-step reasoning, allowing logical sequence handling before generating responses.\n\nMemory and Personalization\n\nLimited to immediate query\n\nYes – Capable of updating memory to retain user preferences or history, allowing personalized responses.\n\nReal-world Applications\n\nPrimarily static responses from a fixed database\n\nSupports a wide range of real-world applications by responding to complex, nuanced inquiries with context sensitivity.\n\n**Feature**\n\n**Vanilla RAG**\n\n**Agentic RAG**\n\nAccess to External Tools\n\nNo\n\nYes – Utilizes external tools like vector search engines, web search tools, calculators, and APIs.\n\nQuery Pre-processing\n\nNo\n\nYes – Agents dynamically refine, rephrase, and adapt queries for optimized retrieval.\n\nDecision-making in Retrieval\n\nLimited to direct retrieval from knowledge base\n\nAgents autonomously decide if retrieval is needed, select tools, and adapt based on query complexity and source type.\n\nMulti-step Retrieval Process\n\nNo\n\nYes – Agents perform multi-step, adaptive retrieval processes involving various sources or tool combinations.\n\nData Validation\n\nNo\n\nYes – Information is cross-referenced across sources to validate accuracy, supporting complex, real-world responses.\n\nDynamic Tool Selection\n\nStatic retrieval tools only\n\nDynamic – Agents choose specific tools (e.g., vector search, APIs) based on query needs.\n\nAdaptability to Query\n\nLimited\n\nHighly adaptive – Agents select and operate tools based on real-time assessment of query requirements.\n\nTypes of Agents\n\nNot applicable\n\nMultiple specialized agents, such as internal data retrieval, personal data retrieval, public data retrieval.\n\nSingle-Agent vs. Multi-Agent System\n\nNot applicable\n\nSingle-agent router or multi-agent systems, with “master” and specialized agents for complex queries.\n\nReasoning and Logic Capability\n\nNo\n\nYes – Supports multi-step reasoning, allowing logical sequence handling before generating responses.\n\nMemory and Personalization\n\nLimited to immediate query\n\nYes – Capable of updating memory to retain user preferences or history, allowing personalized responses.\n\nReal-world Applications\n\nPrimarily static responses from a fixed database\n\nSupports a wide range of real-world applications by responding to complex, nuanced inquiries with context sensitivity.\n\n*   Drawing a parallel with problem-solving, agentic RAG offers capabilities akin to having a smartphone in hand—equipped with multiple apps and tools to help answer a question—whereas vanilla RAG is akin to being in a library with limited resources.",
    "order": 20,
    "orderInChapter": 5,
    "difficulty": 3,
    "estimatedMinutes": 3,
    "tags": [
      "nlpllms"
    ],
    "metadata": {
      "hasCode": false,
      "hasMath": false,
      "hasImages": false,
      "wordCount": 550,
      "contentLength": 7654
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#agentic-rag-vs.-vanilla-rag:-key-differences",
    "scrapedAt": "2025-12-28T11:54:28.278Z"
  },
  {
    "id": "ai-RAG-implementing-agentic-rag-key-approaches-21",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "Agentic Retrieval-Augmented Generation",
    "title": "Implementing Agentic RAG: Key Approaches",
    "subtitle": "Agentic Retrieval-Augmented Generation",
    "contentHtml": "<ul>\n  <li>To implement agentic RAG, developers can use either language models with function calling or agent frameworks, each providing specific advantages in terms of flexibility and control.</li>\n  <li>Both methods—function calling in language models and agent frameworks—enable agentic RAG, though each has unique benefits:\n    <ul>\n      <li><strong>Function Calling</strong> provides control over each tool interaction, suitable for cases with specific tool chains or simple agent setups.</li>\n      <li><strong>Agent Frameworks</strong> offer pre-built integrations and routing logic, ideal for larger, multi-agent architectures.</li>\n    </ul>\n  </li>\n  <li>Using these implementations, developers can build flexible and adaptive agentic RAG pipelines, enhancing retrieval, reasoning, and response generation capabilities for AI-driven applications.</li>\n</ul>\n<ul>\n      <li><strong>Function Calling</strong> provides control over each tool interaction, suitable for cases with specific tool chains or simple agent setups.</li>\n      <li><strong>Agent Frameworks</strong> offer pre-built integrations and routing logic, ideal for larger, multi-agent architectures.</li>\n    </ul>\n<h4 id=\"language-models-with-function-calling\">Language Models with Function Calling</h4>\n<ul>\n  <li>Function calling allows language models to interact directly with external tools. For example, OpenAI’s function calling for GPT-4 or Cohere’s connectors API lets developers connect language models to databases, calculators, and other services. This interaction involves defining a function (such as querying a database), passing it to the model via a schema, and routing the model’s queries through the defined functions. This approach enables the model to leverage specific tools as needed, based on the query.</li>\n</ul>\n<h4 id=\"agent-frameworks\">Agent Frameworks</h4>\n<ul>\n  <li>Several agent frameworks—such as LangChain, LlamaIndex, CrewAI—simplify agentic RAG implementation by providing pre-built templates and tool integrations. Key features include:\n    <ul>\n      <li><strong>LangChain</strong>: Offers support for language model tools, and its LCEL and LangGraph frameworks integrate these tools seamlessly.</li>\n      <li><strong>LlamaIndex</strong>: Provides a QueryEngineTool to streamline retrieval tasks.</li>\n      <li><strong>CrewAI</strong>: A leading framework for multi-agent setups, which supports shared tool access among agents.</li>\n    </ul>\n  </li>\n</ul>\n<ul>\n      <li><strong>LangChain</strong>: Offers support for language model tools, and its LCEL and LangGraph frameworks integrate these tools seamlessly.</li>\n      <li><strong>LlamaIndex</strong>: Provides a QueryEngineTool to streamline retrieval tasks.</li>\n      <li><strong>CrewAI</strong>: A leading framework for multi-agent setups, which supports shared tool access among agents.</li>\n    </ul>",
    "contentMarkdown": "*   To implement agentic RAG, developers can use either language models with function calling or agent frameworks, each providing specific advantages in terms of flexibility and control.\n*   Both methods—function calling in language models and agent frameworks—enable agentic RAG, though each has unique benefits:\n    *   **Function Calling** provides control over each tool interaction, suitable for cases with specific tool chains or simple agent setups.\n    *   **Agent Frameworks** offer pre-built integrations and routing logic, ideal for larger, multi-agent architectures.\n*   Using these implementations, developers can build flexible and adaptive agentic RAG pipelines, enhancing retrieval, reasoning, and response generation capabilities for AI-driven applications.\n\n*   **Function Calling** provides control over each tool interaction, suitable for cases with specific tool chains or simple agent setups.\n*   **Agent Frameworks** offer pre-built integrations and routing logic, ideal for larger, multi-agent architectures.\n\n#### Language Models with Function Calling\n\n*   Function calling allows language models to interact directly with external tools. For example, OpenAI’s function calling for GPT-4 or Cohere’s connectors API lets developers connect language models to databases, calculators, and other services. This interaction involves defining a function (such as querying a database), passing it to the model via a schema, and routing the model’s queries through the defined functions. This approach enables the model to leverage specific tools as needed, based on the query.\n\n#### Agent Frameworks\n\n*   Several agent frameworks—such as LangChain, LlamaIndex, CrewAI—simplify agentic RAG implementation by providing pre-built templates and tool integrations. Key features include:\n    *   **LangChain**: Offers support for language model tools, and its LCEL and LangGraph frameworks integrate these tools seamlessly.\n    *   **LlamaIndex**: Provides a QueryEngineTool to streamline retrieval tasks.\n    *   **CrewAI**: A leading framework for multi-agent setups, which supports shared tool access among agents.\n\n*   **LangChain**: Offers support for language model tools, and its LCEL and LangGraph frameworks integrate these tools seamlessly.\n*   **LlamaIndex**: Provides a QueryEngineTool to streamline retrieval tasks.\n*   **CrewAI**: A leading framework for multi-agent setups, which supports shared tool access among agents.",
    "order": 21,
    "orderInChapter": 6,
    "difficulty": 3,
    "estimatedMinutes": 2,
    "tags": [
      "nlpllms",
      "gpt"
    ],
    "metadata": {
      "hasCode": false,
      "hasMath": false,
      "hasImages": false,
      "wordCount": 326,
      "contentLength": 2877
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#implementing-agentic-rag:-key-approaches",
    "scrapedAt": "2025-12-28T11:54:28.278Z"
  },
  {
    "id": "ai-RAG-enterprise-driven-adoption-22",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "Agentic Retrieval-Augmented Generation",
    "title": "Enterprise-driven Adoption",
    "subtitle": "Agentic Retrieval-Augmented Generation",
    "contentHtml": "<ul>\n  <li>Organizations are increasingly transitioning to agentic RAG to gain more autonomous and accurate AI-driven systems. Enterprises such as Microsoft and Replit have introduced agents to enhance task completion and software development assistance. With agentic RAG, companies can build AI applications capable of handling diverse, real-time data sources, providing robust and adaptable responses for complex queries and tasks.</li>\n</ul>",
    "contentMarkdown": "*   Organizations are increasingly transitioning to agentic RAG to gain more autonomous and accurate AI-driven systems. Enterprises such as Microsoft and Replit have introduced agents to enhance task completion and software development assistance. With agentic RAG, companies can build AI applications capable of handling diverse, real-time data sources, providing robust and adaptable responses for complex queries and tasks.",
    "order": 22,
    "orderInChapter": 7,
    "difficulty": 3,
    "estimatedMinutes": 1,
    "tags": [
      "nlpllms"
    ],
    "metadata": {
      "hasCode": false,
      "hasMath": false,
      "hasImages": false,
      "wordCount": 58,
      "contentLength": 444
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#enterprise-driven-adoption",
    "scrapedAt": "2025-12-28T11:54:28.278Z"
  },
  {
    "id": "ai-RAG-benefits-23",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "Agentic Retrieval-Augmented Generation",
    "title": "Benefits",
    "subtitle": "Agentic Retrieval-Augmented Generation",
    "contentHtml": "<ul>\n  <li>The primary benefits of agentic RAG include:\n    <ul>\n      <li><strong>Enhanced Retrieval Accuracy</strong>: By routing queries through specialized agents, agentic RAG can provide more accurate responses.</li>\n      <li><strong>Autonomous Task Performance</strong>: Agents can perform multi-step reasoning, independently solving complex problems.</li>\n      <li><strong>Improved Collaboration</strong>: These systems can better assist users by handling more varied and personalized queries.</li>\n    </ul>\n  </li>\n</ul>\n<ul>\n      <li><strong>Enhanced Retrieval Accuracy</strong>: By routing queries through specialized agents, agentic RAG can provide more accurate responses.</li>\n      <li><strong>Autonomous Task Performance</strong>: Agents can perform multi-step reasoning, independently solving complex problems.</li>\n      <li><strong>Improved Collaboration</strong>: These systems can better assist users by handling more varied and personalized queries.</li>\n    </ul>",
    "contentMarkdown": "*   The primary benefits of agentic RAG include:\n    *   **Enhanced Retrieval Accuracy**: By routing queries through specialized agents, agentic RAG can provide more accurate responses.\n    *   **Autonomous Task Performance**: Agents can perform multi-step reasoning, independently solving complex problems.\n    *   **Improved Collaboration**: These systems can better assist users by handling more varied and personalized queries.\n\n*   **Enhanced Retrieval Accuracy**: By routing queries through specialized agents, agentic RAG can provide more accurate responses.\n*   **Autonomous Task Performance**: Agents can perform multi-step reasoning, independently solving complex problems.\n*   **Improved Collaboration**: These systems can better assist users by handling more varied and personalized queries.",
    "order": 23,
    "orderInChapter": 8,
    "difficulty": 3,
    "estimatedMinutes": 1,
    "tags": [
      "nlpllms"
    ],
    "metadata": {
      "hasCode": false,
      "hasMath": false,
      "hasImages": false,
      "wordCount": 100,
      "contentLength": 989
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#benefits",
    "scrapedAt": "2025-12-28T11:54:28.278Z"
  },
  {
    "id": "ai-RAG-limitations-24",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "Agentic Retrieval-Augmented Generation",
    "title": "Limitations",
    "subtitle": "Agentic Retrieval-Augmented Generation",
    "contentHtml": "<ul>\n  <li>Agentic RAG does present challenges, such as:\n    <ul>\n      <li><strong>Increased Latency</strong>: Running multiple agents and interacting with tools can add delays to the response.</li>\n      <li><strong>Reliability of Agents</strong>: Depending on the LLM’s reasoning capabilities, agents may fail to complete certain tasks accurately.</li>\n      <li><strong>Complexity in Error Handling</strong>: Systems need robust fallback mechanisms to recover if an agent fails to retrieve or process data.</li>\n    </ul>\n  </li>\n</ul>\n<ul>\n      <li><strong>Increased Latency</strong>: Running multiple agents and interacting with tools can add delays to the response.</li>\n      <li><strong>Reliability of Agents</strong>: Depending on the LLM’s reasoning capabilities, agents may fail to complete certain tasks accurately.</li>\n      <li><strong>Complexity in Error Handling</strong>: Systems need robust fallback mechanisms to recover if an agent fails to retrieve or process data.</li>\n    </ul>",
    "contentMarkdown": "*   Agentic RAG does present challenges, such as:\n    *   **Increased Latency**: Running multiple agents and interacting with tools can add delays to the response.\n    *   **Reliability of Agents**: Depending on the LLM’s reasoning capabilities, agents may fail to complete certain tasks accurately.\n    *   **Complexity in Error Handling**: Systems need robust fallback mechanisms to recover if an agent fails to retrieve or process data.\n\n*   **Increased Latency**: Running multiple agents and interacting with tools can add delays to the response.\n*   **Reliability of Agents**: Depending on the LLM’s reasoning capabilities, agents may fail to complete certain tasks accurately.\n*   **Complexity in Error Handling**: Systems need robust fallback mechanisms to recover if an agent fails to retrieve or process data.",
    "order": 24,
    "orderInChapter": 9,
    "difficulty": 3,
    "estimatedMinutes": 1,
    "tags": [
      "nlpllms",
      "llm"
    ],
    "metadata": {
      "hasCode": false,
      "hasMath": false,
      "hasImages": false,
      "wordCount": 118,
      "contentLength": 1004
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#limitations",
    "scrapedAt": "2025-12-28T11:54:28.278Z"
  },
  {
    "id": "ai-RAG-code-25",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "Agentic Retrieval-Augmented Generation",
    "title": "Code",
    "subtitle": "Agentic Retrieval-Augmented Generation",
    "contentHtml": "<ul>\n  <li>Implementing agentic RAG requires setting up an agent framework capable of handling tool integrations and coordinating retrieval processes. This section walks through an example code setup, demonstrating both language models with function calling and agent frameworks for building an agentic RAG pipeline.</li>\n</ul>\n<h4 id=\"implementing-agentic-rag-with-function-calling\">Implementing Agentic RAG with Function Calling</h4>\n<ul>\n  <li>\n    <p>Function calling in language models allows them to interact with tools by defining functions that retrieve data from external sources. This method leverages API calls, database queries, and computation tools to enrich the response with dynamic data.</p>\n  </li>\n  <li>\n    <p>Here’s an example implementation using a function for retrieval from a database via the Weaviate vector search API.</p>\n  </li>\n</ul>\n<p>Function calling in language models allows them to interact with tools by defining functions that retrieve data from external sources. This method leverages API calls, database queries, and computation tools to enrich the response with dynamic data.</p>\n<p>Here’s an example implementation using a function for retrieval from a database via the Weaviate vector search API.</p>\n<h5 id=\"define-the-function-for-retrieval\">Define the Function for Retrieval</h5>\n<ul>\n  <li>To start, we define a function that uses Weaviate’s hybrid search to query a database and retrieve relevant results.</li>\n</ul>\n<div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code10\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code10\"><span class=\"k\">def</span> <span class=\"nf\">get_search_results</span><span class=\"p\">(</span><span class=\"n\">query</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"nb\">str</span><span class=\"p\">:</span>\n    <span class=\"s\">\"\"\"Sends a query to Weaviate's Hybrid Search. Parses the response into a formatted string.\"\"\"</span>\n\n    <span class=\"n\">response</span> <span class=\"o\">=</span> <span class=\"n\">blogs</span><span class=\"p\">.</span><span class=\"n\">query</span><span class=\"p\">.</span><span class=\"n\">hybrid</span><span class=\"p\">(</span><span class=\"n\">query</span><span class=\"p\">,</span> <span class=\"n\">limit</span><span class=\"o\">=</span><span class=\"mi\">5</span><span class=\"p\">)</span>  <span class=\"c1\"># Retrieve top 5 results based on the query\n</span>    <span class=\"n\">stringified_response</span> <span class=\"o\">=</span> <span class=\"s\">\"\"</span>\n    <span class=\"k\">for</span> <span class=\"n\">idx</span><span class=\"p\">,</span> <span class=\"n\">o</span> <span class=\"ow\">in</span> <span class=\"nb\">enumerate</span><span class=\"p\">(</span><span class=\"n\">response</span><span class=\"p\">.</span><span class=\"n\">objects</span><span class=\"p\">):</span>\n        <span class=\"n\">stringified_response</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s\">\"Search Result </span><span class=\"si\">{</span><span class=\"n\">idx</span><span class=\"o\">+</span><span class=\"mi\">1</span><span class=\"si\">}</span><span class=\"s\">:</span><span class=\"se\">\\n</span><span class=\"s\">\"</span>\n        <span class=\"k\">for</span> <span class=\"n\">prop</span> <span class=\"ow\">in</span> <span class=\"n\">o</span><span class=\"p\">.</span><span class=\"n\">properties</span><span class=\"p\">:</span>\n            <span class=\"n\">stringified_response</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s\">\"</span><span class=\"si\">{</span><span class=\"n\">prop</span><span class=\"si\">}</span><span class=\"s\">: </span><span class=\"si\">{</span><span class=\"n\">o</span><span class=\"p\">.</span><span class=\"n\">properties</span><span class=\"p\">[</span><span class=\"n\">prop</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s\">\"</span>\n        <span class=\"n\">stringified_response</span> <span class=\"o\">+=</span> <span class=\"s\">\"</span><span class=\"se\">\\n</span><span class=\"s\">\"</span>\n\n    <span class=\"k\">return</span> <span class=\"n\">stringified_response</span>\n</code></pre></div></div>\n<pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code10\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code10\"><span class=\"k\">def</span> <span class=\"nf\">get_search_results</span><span class=\"p\">(</span><span class=\"n\">query</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"nb\">str</span><span class=\"p\">:</span>\n    <span class=\"s\">\"\"\"Sends a query to Weaviate's Hybrid Search. Parses the response into a formatted string.\"\"\"</span>\n\n    <span class=\"n\">response</span> <span class=\"o\">=</span> <span class=\"n\">blogs</span><span class=\"p\">.</span><span class=\"n\">query</span><span class=\"p\">.</span><span class=\"n\">hybrid</span><span class=\"p\">(</span><span class=\"n\">query</span><span class=\"p\">,</span> <span class=\"n\">limit</span><span class=\"o\">=</span><span class=\"mi\">5</span><span class=\"p\">)</span>  <span class=\"c1\"># Retrieve top 5 results based on the query\n</span>    <span class=\"n\">stringified_response</span> <span class=\"o\">=</span> <span class=\"s\">\"\"</span>\n    <span class=\"k\">for</span> <span class=\"n\">idx</span><span class=\"p\">,</span> <span class=\"n\">o</span> <span class=\"ow\">in</span> <span class=\"nb\">enumerate</span><span class=\"p\">(</span><span class=\"n\">response</span><span class=\"p\">.</span><span class=\"n\">objects</span><span class=\"p\">):</span>\n        <span class=\"n\">stringified_response</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s\">\"Search Result </span><span class=\"si\">{</span><span class=\"n\">idx</span><span class=\"o\">+</span><span class=\"mi\">1</span><span class=\"si\">}</span><span class=\"s\">:</span><span class=\"se\">\\n</span><span class=\"s\">\"</span>\n        <span class=\"k\">for</span> <span class=\"n\">prop</span> <span class=\"ow\">in</span> <span class=\"n\">o</span><span class=\"p\">.</span><span class=\"n\">properties</span><span class=\"p\">:</span>\n            <span class=\"n\">stringified_response</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s\">\"</span><span class=\"si\">{</span><span class=\"n\">prop</span><span class=\"si\">}</span><span class=\"s\">: </span><span class=\"si\">{</span><span class=\"n\">o</span><span class=\"p\">.</span><span class=\"n\">properties</span><span class=\"p\">[</span><span class=\"n\">prop</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s\">\"</span>\n        <span class=\"n\">stringified_response</span> <span class=\"o\">+=</span> <span class=\"s\">\"</span><span class=\"se\">\\n</span><span class=\"s\">\"</span>\n\n    <span class=\"k\">return</span> <span class=\"n\">stringified_response</span>\n</code></pre>\n<h5 id=\"define-the-tools-schema\">Define the Tools Schema</h5>\n<ul>\n  <li>Next, we define a tools schema that connects the function to the language model. This schema tells the model how to use the function for retrieving data.</li>\n</ul>\n<div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code11\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code11\"><span class=\"n\">tools_schema</span> <span class=\"o\">=</span> <span class=\"p\">[{</span>\n    <span class=\"s\">'type'</span><span class=\"p\">:</span> <span class=\"s\">'function'</span><span class=\"p\">,</span>\n    <span class=\"s\">'function'</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n        <span class=\"s\">'name'</span><span class=\"p\">:</span> <span class=\"s\">'get_search_results'</span><span class=\"p\">,</span>\n        <span class=\"s\">'description'</span><span class=\"p\">:</span> <span class=\"s\">'Get search results for a provided query.'</span><span class=\"p\">,</span>\n        <span class=\"s\">'parameters'</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n          <span class=\"s\">'type'</span><span class=\"p\">:</span> <span class=\"s\">'object'</span><span class=\"p\">,</span>\n          <span class=\"s\">'properties'</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n            <span class=\"s\">'query'</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n              <span class=\"s\">'type'</span><span class=\"p\">:</span> <span class=\"s\">'string'</span><span class=\"p\">,</span>\n              <span class=\"s\">'description'</span><span class=\"p\">:</span> <span class=\"s\">'The search query.'</span><span class=\"p\">,</span>\n            <span class=\"p\">},</span>\n          <span class=\"p\">},</span>\n          <span class=\"s\">'required'</span><span class=\"p\">:</span> <span class=\"p\">[</span><span class=\"s\">'query'</span><span class=\"p\">],</span>\n        <span class=\"p\">},</span>\n    <span class=\"p\">},</span>\n<span class=\"p\">}]</span>\n</code></pre></div></div>\n<pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code11\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code11\"><span class=\"n\">tools_schema</span> <span class=\"o\">=</span> <span class=\"p\">[{</span>\n    <span class=\"s\">'type'</span><span class=\"p\">:</span> <span class=\"s\">'function'</span><span class=\"p\">,</span>\n    <span class=\"s\">'function'</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n        <span class=\"s\">'name'</span><span class=\"p\">:</span> <span class=\"s\">'get_search_results'</span><span class=\"p\">,</span>\n        <span class=\"s\">'description'</span><span class=\"p\">:</span> <span class=\"s\">'Get search results for a provided query.'</span><span class=\"p\">,</span>\n        <span class=\"s\">'parameters'</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n          <span class=\"s\">'type'</span><span class=\"p\">:</span> <span class=\"s\">'object'</span><span class=\"p\">,</span>\n          <span class=\"s\">'properties'</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n            <span class=\"s\">'query'</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n              <span class=\"s\">'type'</span><span class=\"p\">:</span> <span class=\"s\">'string'</span><span class=\"p\">,</span>\n              <span class=\"s\">'description'</span><span class=\"p\">:</span> <span class=\"s\">'The search query.'</span><span class=\"p\">,</span>\n            <span class=\"p\">},</span>\n          <span class=\"p\">},</span>\n          <span class=\"s\">'required'</span><span class=\"p\">:</span> <span class=\"p\">[</span><span class=\"s\">'query'</span><span class=\"p\">],</span>\n        <span class=\"p\">},</span>\n    <span class=\"p\">},</span>\n<span class=\"p\">}]</span>\n</code></pre>\n<h5 id=\"setting-up-the-interaction-loop\">Setting up the Interaction Loop</h5>\n<ul>\n  <li>To ensure the model can call the tool multiple times (if needed), we set up a loop that enables the model to interact with tools and retrieve data iteratively until it has all necessary information.</li>\n</ul>\n<div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code12\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code12\"><span class=\"k\">def</span> <span class=\"nf\">ollama_generation_with_tools</span><span class=\"p\">(</span><span class=\"n\">user_message</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">,</span> <span class=\"n\">tools_schema</span><span class=\"p\">:</span> <span class=\"nb\">list</span><span class=\"p\">,</span> <span class=\"n\">tool_mapping</span><span class=\"p\">:</span> <span class=\"nb\">dict</span><span class=\"p\">,</span> <span class=\"n\">model_name</span><span class=\"p\">:</span> <span class=\"nb\">str</span> <span class=\"o\">=</span> <span class=\"s\">\"llama3.1\"</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"nb\">str</span><span class=\"p\">:</span>\n    <span class=\"n\">messages</span> <span class=\"o\">=</span> <span class=\"p\">[{</span><span class=\"s\">\"role\"</span><span class=\"p\">:</span> <span class=\"s\">\"user\"</span><span class=\"p\">,</span> <span class=\"s\">\"content\"</span><span class=\"p\">:</span> <span class=\"n\">user_message</span><span class=\"p\">}]</span>\n    <span class=\"n\">response</span> <span class=\"o\">=</span> <span class=\"n\">ollama</span><span class=\"p\">.</span><span class=\"n\">chat</span><span class=\"p\">(</span><span class=\"n\">model</span><span class=\"o\">=</span><span class=\"n\">model_name</span><span class=\"p\">,</span> <span class=\"n\">messages</span><span class=\"o\">=</span><span class=\"n\">messages</span><span class=\"p\">,</span> <span class=\"n\">tools</span><span class=\"o\">=</span><span class=\"n\">tools_schema</span><span class=\"p\">)</span>\n    \n    <span class=\"c1\"># Check if the model needs to use a tool\n</span>    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">response</span><span class=\"p\">[</span><span class=\"s\">\"message\"</span><span class=\"p\">].</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s\">\"tool_calls\"</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"n\">response</span><span class=\"p\">[</span><span class=\"s\">\"message\"</span><span class=\"p\">][</span><span class=\"s\">\"content\"</span><span class=\"p\">]</span>\n    \n    <span class=\"c1\"># Handle tool calls and retrieve information\n</span>    <span class=\"k\">for</span> <span class=\"n\">tool</span> <span class=\"ow\">in</span> <span class=\"n\">response</span><span class=\"p\">[</span><span class=\"s\">\"message\"</span><span class=\"p\">][</span><span class=\"s\">\"tool_calls\"</span><span class=\"p\">]:</span>\n        <span class=\"n\">function_to_call</span> <span class=\"o\">=</span> <span class=\"n\">tool_mapping</span><span class=\"p\">[</span><span class=\"n\">tool</span><span class=\"p\">[</span><span class=\"s\">\"function\"</span><span class=\"p\">][</span><span class=\"s\">\"name\"</span><span class=\"p\">]]</span>\n        <span class=\"n\">function_response</span> <span class=\"o\">=</span> <span class=\"n\">function_to_call</span><span class=\"p\">(</span><span class=\"n\">tool</span><span class=\"p\">[</span><span class=\"s\">\"function\"</span><span class=\"p\">][</span><span class=\"s\">\"arguments\"</span><span class=\"p\">][</span><span class=\"s\">\"query\"</span><span class=\"p\">])</span>\n        <span class=\"n\">messages</span><span class=\"p\">.</span><span class=\"n\">append</span><span class=\"p\">({</span><span class=\"s\">\"role\"</span><span class=\"p\">:</span> <span class=\"s\">\"tool\"</span><span class=\"p\">,</span> <span class=\"s\">\"content\"</span><span class=\"p\">:</span> <span class=\"n\">function_response</span><span class=\"p\">})</span>\n    \n    <span class=\"c1\"># Generate final response after tool calls\n</span>    <span class=\"n\">final_response</span> <span class=\"o\">=</span> <span class=\"n\">ollama</span><span class=\"p\">.</span><span class=\"n\">chat</span><span class=\"p\">(</span><span class=\"n\">model</span><span class=\"o\">=</span><span class=\"n\">model_name</span><span class=\"p\">,</span> <span class=\"n\">messages</span><span class=\"o\">=</span><span class=\"n\">messages</span><span class=\"p\">)</span>\n    <span class=\"k\">return</span> <span class=\"n\">final_response</span><span class=\"p\">[</span><span class=\"s\">\"message\"</span><span class=\"p\">][</span><span class=\"s\">\"content\"</span><span class=\"p\">]</span>\n</code></pre></div></div>\n<pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code12\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code12\"><span class=\"k\">def</span> <span class=\"nf\">ollama_generation_with_tools</span><span class=\"p\">(</span><span class=\"n\">user_message</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">,</span> <span class=\"n\">tools_schema</span><span class=\"p\">:</span> <span class=\"nb\">list</span><span class=\"p\">,</span> <span class=\"n\">tool_mapping</span><span class=\"p\">:</span> <span class=\"nb\">dict</span><span class=\"p\">,</span> <span class=\"n\">model_name</span><span class=\"p\">:</span> <span class=\"nb\">str</span> <span class=\"o\">=</span> <span class=\"s\">\"llama3.1\"</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"nb\">str</span><span class=\"p\">:</span>\n    <span class=\"n\">messages</span> <span class=\"o\">=</span> <span class=\"p\">[{</span><span class=\"s\">\"role\"</span><span class=\"p\">:</span> <span class=\"s\">\"user\"</span><span class=\"p\">,</span> <span class=\"s\">\"content\"</span><span class=\"p\">:</span> <span class=\"n\">user_message</span><span class=\"p\">}]</span>\n    <span class=\"n\">response</span> <span class=\"o\">=</span> <span class=\"n\">ollama</span><span class=\"p\">.</span><span class=\"n\">chat</span><span class=\"p\">(</span><span class=\"n\">model</span><span class=\"o\">=</span><span class=\"n\">model_name</span><span class=\"p\">,</span> <span class=\"n\">messages</span><span class=\"o\">=</span><span class=\"n\">messages</span><span class=\"p\">,</span> <span class=\"n\">tools</span><span class=\"o\">=</span><span class=\"n\">tools_schema</span><span class=\"p\">)</span>\n    \n    <span class=\"c1\"># Check if the model needs to use a tool\n</span>    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">response</span><span class=\"p\">[</span><span class=\"s\">\"message\"</span><span class=\"p\">].</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s\">\"tool_calls\"</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"n\">response</span><span class=\"p\">[</span><span class=\"s\">\"message\"</span><span class=\"p\">][</span><span class=\"s\">\"content\"</span><span class=\"p\">]</span>\n    \n    <span class=\"c1\"># Handle tool calls and retrieve information\n</span>    <span class=\"k\">for</span> <span class=\"n\">tool</span> <span class=\"ow\">in</span> <span class=\"n\">response</span><span class=\"p\">[</span><span class=\"s\">\"message\"</span><span class=\"p\">][</span><span class=\"s\">\"tool_calls\"</span><span class=\"p\">]:</span>\n        <span class=\"n\">function_to_call</span> <span class=\"o\">=</span> <span class=\"n\">tool_mapping</span><span class=\"p\">[</span><span class=\"n\">tool</span><span class=\"p\">[</span><span class=\"s\">\"function\"</span><span class=\"p\">][</span><span class=\"s\">\"name\"</span><span class=\"p\">]]</span>\n        <span class=\"n\">function_response</span> <span class=\"o\">=</span> <span class=\"n\">function_to_call</span><span class=\"p\">(</span><span class=\"n\">tool</span><span class=\"p\">[</span><span class=\"s\">\"function\"</span><span class=\"p\">][</span><span class=\"s\">\"arguments\"</span><span class=\"p\">][</span><span class=\"s\">\"query\"</span><span class=\"p\">])</span>\n        <span class=\"n\">messages</span><span class=\"p\">.</span><span class=\"n\">append</span><span class=\"p\">({</span><span class=\"s\">\"role\"</span><span class=\"p\">:</span> <span class=\"s\">\"tool\"</span><span class=\"p\">,</span> <span class=\"s\">\"content\"</span><span class=\"p\">:</span> <span class=\"n\">function_response</span><span class=\"p\">})</span>\n    \n    <span class=\"c1\"># Generate final response after tool calls\n</span>    <span class=\"n\">final_response</span> <span class=\"o\">=</span> <span class=\"n\">ollama</span><span class=\"p\">.</span><span class=\"n\">chat</span><span class=\"p\">(</span><span class=\"n\">model</span><span class=\"o\">=</span><span class=\"n\">model_name</span><span class=\"p\">,</span> <span class=\"n\">messages</span><span class=\"o\">=</span><span class=\"n\">messages</span><span class=\"p\">)</span>\n    <span class=\"k\">return</span> <span class=\"n\">final_response</span><span class=\"p\">[</span><span class=\"s\">\"message\"</span><span class=\"p\">][</span><span class=\"s\">\"content\"</span><span class=\"p\">]</span>\n</code></pre>\n<h5 id=\"executing-the-agentic-rag-query\">Executing the Agentic RAG Query</h5>\n<ul>\n  <li>Finally, we run the function, allowing the language model to interact with the <code class=\"language-plaintext highlighter-rouge\">get_search_results</code> tool.</li>\n</ul>\n<div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code13\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code13\"><span class=\"n\">tool_mapping</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"s\">\"get_search_results\"</span><span class=\"p\">:</span> <span class=\"n\">get_search_results</span><span class=\"p\">}</span>  <span class=\"c1\"># Maps tool name to function\n</span><span class=\"n\">response</span> <span class=\"o\">=</span> <span class=\"n\">ollama_generation_with_tools</span><span class=\"p\">(</span>\n    <span class=\"s\">\"How is HNSW different from DiskANN?\"</span><span class=\"p\">,</span>\n    <span class=\"n\">tools_schema</span><span class=\"o\">=</span><span class=\"n\">tools_schema</span><span class=\"p\">,</span>\n    <span class=\"n\">tool_mapping</span><span class=\"o\">=</span><span class=\"n\">tool_mapping</span>\n<span class=\"p\">)</span>\n<span class=\"k\">print</span><span class=\"p\">(</span><span class=\"n\">response</span><span class=\"p\">)</span>\n</code></pre></div></div>\n<pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code13\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code13\"><span class=\"n\">tool_mapping</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"s\">\"get_search_results\"</span><span class=\"p\">:</span> <span class=\"n\">get_search_results</span><span class=\"p\">}</span>  <span class=\"c1\"># Maps tool name to function\n</span><span class=\"n\">response</span> <span class=\"o\">=</span> <span class=\"n\">ollama_generation_with_tools</span><span class=\"p\">(</span>\n    <span class=\"s\">\"How is HNSW different from DiskANN?\"</span><span class=\"p\">,</span>\n    <span class=\"n\">tools_schema</span><span class=\"o\">=</span><span class=\"n\">tools_schema</span><span class=\"p\">,</span>\n    <span class=\"n\">tool_mapping</span><span class=\"o\">=</span><span class=\"n\">tool_mapping</span>\n<span class=\"p\">)</span>\n<span class=\"k\">print</span><span class=\"p\">(</span><span class=\"n\">response</span><span class=\"p\">)</span>\n</code></pre>\n<ul>\n  <li>This setup enables the language model to retrieve dynamic information and perform tool-based retrievals as needed.</li>\n</ul>\n<h4 id=\"implementing-agentic-rag-with-agent-frameworks\">Implementing Agentic RAG with Agent Frameworks</h4>\n<ul>\n  <li>Using agent frameworks streamlines the implementation process by providing templates and pre-built modules for multi-agent orchestration. Here’s how to set up an agentic RAG pipeline using LangChain as an example.</li>\n</ul>\n<h5 id=\"step-1-define-agents-and-tools\">Step 1: Define Agents and Tools</h5>\n<ul>\n  <li>LangChain simplifies agentic RAG by managing tools and routing tasks. First, define the agents and register the tools they will use.</li>\n</ul>\n<div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code14\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code14\"><span class=\"kn\">from</span> <span class=\"nn\">langchain.tools</span> <span class=\"kn\">import</span> <span class=\"n\">WebSearchTool</span><span class=\"p\">,</span> <span class=\"n\">DatabaseTool</span><span class=\"p\">,</span> <span class=\"n\">CalculatorTool</span>\n<span class=\"kn\">from</span> <span class=\"nn\">langchain.agents</span> <span class=\"kn\">import</span> <span class=\"n\">Agent</span>\n\n<span class=\"c1\"># Define tools for retrieval\n</span><span class=\"n\">web_search_tool</span> <span class=\"o\">=</span> <span class=\"n\">WebSearchTool</span><span class=\"p\">(</span><span class=\"n\">api_key</span><span class=\"o\">=</span><span class=\"s\">\"YOUR_WEB_SEARCH_API_KEY\"</span><span class=\"p\">)</span>\n<span class=\"n\">database_tool</span> <span class=\"o\">=</span> <span class=\"n\">DatabaseTool</span><span class=\"p\">(</span><span class=\"n\">db_client</span><span class=\"o\">=</span><span class=\"s\">\"your_database_client\"</span><span class=\"p\">)</span>\n<span class=\"n\">calculator_tool</span> <span class=\"o\">=</span> <span class=\"n\">CalculatorTool</span><span class=\"p\">()</span>\n\n<span class=\"c1\"># Set up an agent with a routing function\n</span><span class=\"n\">retrieval_agent</span> <span class=\"o\">=</span> <span class=\"n\">Agent</span><span class=\"p\">(</span>\n    <span class=\"n\">tools</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"n\">web_search_tool</span><span class=\"p\">,</span> <span class=\"n\">database_tool</span><span class=\"p\">,</span> <span class=\"n\">calculator_tool</span><span class=\"p\">],</span>\n    <span class=\"n\">routing_function</span><span class=\"o\">=</span><span class=\"s\">\"retrieve_and_select_tool\"</span>\n<span class=\"p\">)</span>\n</code></pre></div></div>\n<pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code14\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code14\"><span class=\"kn\">from</span> <span class=\"nn\">langchain.tools</span> <span class=\"kn\">import</span> <span class=\"n\">WebSearchTool</span><span class=\"p\">,</span> <span class=\"n\">DatabaseTool</span><span class=\"p\">,</span> <span class=\"n\">CalculatorTool</span>\n<span class=\"kn\">from</span> <span class=\"nn\">langchain.agents</span> <span class=\"kn\">import</span> <span class=\"n\">Agent</span>\n\n<span class=\"c1\"># Define tools for retrieval\n</span><span class=\"n\">web_search_tool</span> <span class=\"o\">=</span> <span class=\"n\">WebSearchTool</span><span class=\"p\">(</span><span class=\"n\">api_key</span><span class=\"o\">=</span><span class=\"s\">\"YOUR_WEB_SEARCH_API_KEY\"</span><span class=\"p\">)</span>\n<span class=\"n\">database_tool</span> <span class=\"o\">=</span> <span class=\"n\">DatabaseTool</span><span class=\"p\">(</span><span class=\"n\">db_client</span><span class=\"o\">=</span><span class=\"s\">\"your_database_client\"</span><span class=\"p\">)</span>\n<span class=\"n\">calculator_tool</span> <span class=\"o\">=</span> <span class=\"n\">CalculatorTool</span><span class=\"p\">()</span>\n\n<span class=\"c1\"># Set up an agent with a routing function\n</span><span class=\"n\">retrieval_agent</span> <span class=\"o\">=</span> <span class=\"n\">Agent</span><span class=\"p\">(</span>\n    <span class=\"n\">tools</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"n\">web_search_tool</span><span class=\"p\">,</span> <span class=\"n\">database_tool</span><span class=\"p\">,</span> <span class=\"n\">calculator_tool</span><span class=\"p\">],</span>\n    <span class=\"n\">routing_function</span><span class=\"o\">=</span><span class=\"s\">\"retrieve_and_select_tool\"</span>\n<span class=\"p\">)</span>\n</code></pre>\n<h5 id=\"step-2-configure-agent-routing\">Step 2: Configure Agent Routing</h5>\n<ul>\n  <li>Set up the routing function to let the agent decide which tool to use based on the input query.</li>\n</ul>\n<div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code15\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code15\"><span class=\"k\">def</span> <span class=\"nf\">retrieve_and_select_tool</span><span class=\"p\">(</span><span class=\"n\">query</span><span class=\"p\">):</span>\n    <span class=\"k\">if</span> <span class=\"s\">\"calculate\"</span> <span class=\"ow\">in</span> <span class=\"n\">query</span><span class=\"p\">:</span>\n        <span class=\"k\">return</span> <span class=\"n\">calculator_tool</span>\n    <span class=\"k\">elif</span> <span class=\"s\">\"web\"</span> <span class=\"ow\">in</span> <span class=\"n\">query</span><span class=\"p\">:</span>\n        <span class=\"k\">return</span> <span class=\"n\">web_search_tool</span>\n    <span class=\"k\">else</span><span class=\"p\">:</span>\n        <span class=\"k\">return</span> <span class=\"n\">database_tool</span>\n</code></pre></div></div>\n<pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code15\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code15\"><span class=\"k\">def</span> <span class=\"nf\">retrieve_and_select_tool</span><span class=\"p\">(</span><span class=\"n\">query</span><span class=\"p\">):</span>\n    <span class=\"k\">if</span> <span class=\"s\">\"calculate\"</span> <span class=\"ow\">in</span> <span class=\"n\">query</span><span class=\"p\">:</span>\n        <span class=\"k\">return</span> <span class=\"n\">calculator_tool</span>\n    <span class=\"k\">elif</span> <span class=\"s\">\"web\"</span> <span class=\"ow\">in</span> <span class=\"n\">query</span><span class=\"p\">:</span>\n        <span class=\"k\">return</span> <span class=\"n\">web_search_tool</span>\n    <span class=\"k\">else</span><span class=\"p\">:</span>\n        <span class=\"k\">return</span> <span class=\"n\">database_tool</span>\n</code></pre>\n<h5 id=\"step-3-chain-agents-for-multi-agent-rag\">Step 3: Chain Agents for Multi-Agent RAG</h5>\n<ul>\n  <li>In multi-agent RAG, you might have a “master agent” that routes queries to specialized agents based on query type. Here’s how to set up a master agent to coordinate multiple agents.</li>\n</ul>\n<div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code16\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code16\"><span class=\"kn\">from</span> <span class=\"nn\">langchain.agents</span> <span class=\"kn\">import</span> <span class=\"n\">MultiAgent</span>\n\n<span class=\"c1\"># Define specialized agents\n</span><span class=\"n\">internal_agent</span> <span class=\"o\">=</span> <span class=\"n\">Agent</span><span class=\"p\">(</span><span class=\"n\">tools</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"n\">database_tool</span><span class=\"p\">],</span> <span class=\"n\">routing_function</span><span class=\"o\">=</span><span class=\"s\">\"database_retrieval\"</span><span class=\"p\">)</span>\n<span class=\"n\">public_agent</span> <span class=\"o\">=</span> <span class=\"n\">Agent</span><span class=\"p\">(</span><span class=\"n\">tools</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"n\">web_search_tool</span><span class=\"p\">],</span> <span class=\"n\">routing_function</span><span class=\"o\">=</span><span class=\"s\">\"web_retrieval\"</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># Create a master agent to coordinate retrieval\n</span><span class=\"n\">master_agent</span> <span class=\"o\">=</span> <span class=\"n\">MultiAgent</span><span class=\"p\">(</span><span class=\"n\">agents</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"n\">internal_agent</span><span class=\"p\">,</span> <span class=\"n\">public_agent</span><span class=\"p\">])</span>\n\n<span class=\"c1\"># Function to handle a query using master agent\n</span><span class=\"k\">def</span> <span class=\"nf\">handle_query_with_master_agent</span><span class=\"p\">(</span><span class=\"n\">query</span><span class=\"p\">):</span>\n    <span class=\"k\">return</span> <span class=\"n\">master_agent</span><span class=\"p\">.</span><span class=\"n\">handle_query</span><span class=\"p\">(</span><span class=\"n\">query</span><span class=\"p\">)</span>\n</code></pre></div></div>\n<pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code16\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code16\"><span class=\"kn\">from</span> <span class=\"nn\">langchain.agents</span> <span class=\"kn\">import</span> <span class=\"n\">MultiAgent</span>\n\n<span class=\"c1\"># Define specialized agents\n</span><span class=\"n\">internal_agent</span> <span class=\"o\">=</span> <span class=\"n\">Agent</span><span class=\"p\">(</span><span class=\"n\">tools</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"n\">database_tool</span><span class=\"p\">],</span> <span class=\"n\">routing_function</span><span class=\"o\">=</span><span class=\"s\">\"database_retrieval\"</span><span class=\"p\">)</span>\n<span class=\"n\">public_agent</span> <span class=\"o\">=</span> <span class=\"n\">Agent</span><span class=\"p\">(</span><span class=\"n\">tools</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"n\">web_search_tool</span><span class=\"p\">],</span> <span class=\"n\">routing_function</span><span class=\"o\">=</span><span class=\"s\">\"web_retrieval\"</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># Create a master agent to coordinate retrieval\n</span><span class=\"n\">master_agent</span> <span class=\"o\">=</span> <span class=\"n\">MultiAgent</span><span class=\"p\">(</span><span class=\"n\">agents</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"n\">internal_agent</span><span class=\"p\">,</span> <span class=\"n\">public_agent</span><span class=\"p\">])</span>\n\n<span class=\"c1\"># Function to handle a query using master agent\n</span><span class=\"k\">def</span> <span class=\"nf\">handle_query_with_master_agent</span><span class=\"p\">(</span><span class=\"n\">query</span><span class=\"p\">):</span>\n    <span class=\"k\">return</span> <span class=\"n\">master_agent</span><span class=\"p\">.</span><span class=\"n\">handle_query</span><span class=\"p\">(</span><span class=\"n\">query</span><span class=\"p\">)</span>\n</code></pre>\n<h5 id=\"running-the-multi-agent-query\">Running the Multi-Agent Query</h5>\n<ul>\n  <li>Finally, to test the system, input a query and let the master agent route it appropriately:</li>\n</ul>\n<div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code17\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code17\"><span class=\"n\">response</span> <span class=\"o\">=</span> <span class=\"n\">handle_query_with_master_agent</span><span class=\"p\">(</span><span class=\"s\">\"Find recent studies on neural networks\"</span><span class=\"p\">)</span>\n<span class=\"k\">print</span><span class=\"p\">(</span><span class=\"n\">response</span><span class=\"p\">)</span>\n</code></pre></div></div>\n<pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code17\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code17\"><span class=\"n\">response</span> <span class=\"o\">=</span> <span class=\"n\">handle_query_with_master_agent</span><span class=\"p\">(</span><span class=\"s\">\"Find recent studies on neural networks\"</span><span class=\"p\">)</span>\n<span class=\"k\">print</span><span class=\"p\">(</span><span class=\"n\">response</span><span class=\"p\">)</span>\n</code></pre>",
    "contentMarkdown": "*   Implementing agentic RAG requires setting up an agent framework capable of handling tool integrations and coordinating retrieval processes. This section walks through an example code setup, demonstrating both language models with function calling and agent frameworks for building an agentic RAG pipeline.\n\n#### Implementing Agentic RAG with Function Calling\n\n*   Function calling in language models allows them to interact with tools by defining functions that retrieve data from external sources. This method leverages API calls, database queries, and computation tools to enrich the response with dynamic data.\n    \n*   Here’s an example implementation using a function for retrieval from a database via the Weaviate vector search API.\n    \n\nFunction calling in language models allows them to interact with tools by defining functions that retrieve data from external sources. This method leverages API calls, database queries, and computation tools to enrich the response with dynamic data.\n\nHere’s an example implementation using a function for retrieval from a database via the Weaviate vector search API.\n\n##### Define the Function for Retrieval\n\n*   To start, we define a function that uses Weaviate’s hybrid search to query a database and retrieve relevant results.\n\n![](https://aman.ai/images/copy.png)\n\n`def get_search_results(query: str) -> str:     \"\"\"Sends a query to Weaviate's Hybrid Search. Parses the response into a formatted string.\"\"\"      response = blogs.query.hybrid(query, limit=5)  # Retrieve top 5 results based on the query     stringified_response = \"\"     for idx, o in enumerate(response.objects):         stringified_response += f\"Search Result {idx+1}:\\n\"         for prop in o.properties:             stringified_response += f\"{prop}: {o.properties[prop]}\\n\"         stringified_response += \"\\n\"      return stringified_response`\n\n![](https://aman.ai/images/copy.png)\n\n`def get_search_results(query: str) -> str:     \"\"\"Sends a query to Weaviate's Hybrid Search. Parses the response into a formatted string.\"\"\"      response = blogs.query.hybrid(query, limit=5)  # Retrieve top 5 results based on the query     stringified_response = \"\"     for idx, o in enumerate(response.objects):         stringified_response += f\"Search Result {idx+1}:\\n\"         for prop in o.properties:             stringified_response += f\"{prop}: {o.properties[prop]}\\n\"         stringified_response += \"\\n\"      return stringified_response`\n\n##### Define the Tools Schema\n\n*   Next, we define a tools schema that connects the function to the language model. This schema tells the model how to use the function for retrieving data.\n\n![](https://aman.ai/images/copy.png)\n\n`tools_schema = [{     'type': 'function',     'function': {         'name': 'get_search_results',         'description': 'Get search results for a provided query.',         'parameters': {           'type': 'object',           'properties': {             'query': {               'type': 'string',               'description': 'The search query.',             },           },           'required': ['query'],         },     }, }]`\n\n![](https://aman.ai/images/copy.png)\n\n`tools_schema = [{     'type': 'function',     'function': {         'name': 'get_search_results',         'description': 'Get search results for a provided query.',         'parameters': {           'type': 'object',           'properties': {             'query': {               'type': 'string',               'description': 'The search query.',             },           },           'required': ['query'],         },     }, }]`\n\n##### Setting up the Interaction Loop\n\n*   To ensure the model can call the tool multiple times (if needed), we set up a loop that enables the model to interact with tools and retrieve data iteratively until it has all necessary information.\n\n![](https://aman.ai/images/copy.png)\n\n`def ollama_generation_with_tools(user_message: str, tools_schema: list, tool_mapping: dict, model_name: str = \"llama3.1\") -> str:     messages = [{\"role\": \"user\", \"content\": user_message}]     response = ollama.chat(model=model_name, messages=messages, tools=tools_schema)          # Check if the model needs to use a tool     if not response[\"message\"].get(\"tool_calls\"):         return response[\"message\"][\"content\"]          # Handle tool calls and retrieve information     for tool in response[\"message\"][\"tool_calls\"]:         function_to_call = tool_mapping[tool[\"function\"][\"name\"]]         function_response = function_to_call(tool[\"function\"][\"arguments\"][\"query\"])         messages.append({\"role\": \"tool\", \"content\": function_response})          # Generate final response after tool calls     final_response = ollama.chat(model=model_name, messages=messages)     return final_response[\"message\"][\"content\"]`\n\n![](https://aman.ai/images/copy.png)\n\n`def ollama_generation_with_tools(user_message: str, tools_schema: list, tool_mapping: dict, model_name: str = \"llama3.1\") -> str:     messages = [{\"role\": \"user\", \"content\": user_message}]     response = ollama.chat(model=model_name, messages=messages, tools=tools_schema)          # Check if the model needs to use a tool     if not response[\"message\"].get(\"tool_calls\"):         return response[\"message\"][\"content\"]          # Handle tool calls and retrieve information     for tool in response[\"message\"][\"tool_calls\"]:         function_to_call = tool_mapping[tool[\"function\"][\"name\"]]         function_response = function_to_call(tool[\"function\"][\"arguments\"][\"query\"])         messages.append({\"role\": \"tool\", \"content\": function_response})          # Generate final response after tool calls     final_response = ollama.chat(model=model_name, messages=messages)     return final_response[\"message\"][\"content\"]`\n\n##### Executing the Agentic RAG Query\n\n*   Finally, we run the function, allowing the language model to interact with the `get_search_results` tool.\n\n![](https://aman.ai/images/copy.png)\n\n`tool_mapping = {\"get_search_results\": get_search_results}  # Maps tool name to function response = ollama_generation_with_tools(     \"How is HNSW different from DiskANN?\",     tools_schema=tools_schema,     tool_mapping=tool_mapping ) print(response)`\n\n![](https://aman.ai/images/copy.png)\n\n`tool_mapping = {\"get_search_results\": get_search_results}  # Maps tool name to function response = ollama_generation_with_tools(     \"How is HNSW different from DiskANN?\",     tools_schema=tools_schema,     tool_mapping=tool_mapping ) print(response)`\n\n*   This setup enables the language model to retrieve dynamic information and perform tool-based retrievals as needed.\n\n#### Implementing Agentic RAG with Agent Frameworks\n\n*   Using agent frameworks streamlines the implementation process by providing templates and pre-built modules for multi-agent orchestration. Here’s how to set up an agentic RAG pipeline using LangChain as an example.\n\n##### Step 1: Define Agents and Tools\n\n*   LangChain simplifies agentic RAG by managing tools and routing tasks. First, define the agents and register the tools they will use.\n\n![](https://aman.ai/images/copy.png)\n\n`from langchain.tools import WebSearchTool, DatabaseTool, CalculatorTool from langchain.agents import Agent  # Define tools for retrieval web_search_tool = WebSearchTool(api_key=\"YOUR_WEB_SEARCH_API_KEY\") database_tool = DatabaseTool(db_client=\"your_database_client\") calculator_tool = CalculatorTool()  # Set up an agent with a routing function retrieval_agent = Agent(     tools=[web_search_tool, database_tool, calculator_tool],     routing_function=\"retrieve_and_select_tool\" )`\n\n![](https://aman.ai/images/copy.png)\n\n`from langchain.tools import WebSearchTool, DatabaseTool, CalculatorTool from langchain.agents import Agent  # Define tools for retrieval web_search_tool = WebSearchTool(api_key=\"YOUR_WEB_SEARCH_API_KEY\") database_tool = DatabaseTool(db_client=\"your_database_client\") calculator_tool = CalculatorTool()  # Set up an agent with a routing function retrieval_agent = Agent(     tools=[web_search_tool, database_tool, calculator_tool],     routing_function=\"retrieve_and_select_tool\" )`\n\n##### Step 2: Configure Agent Routing\n\n*   Set up the routing function to let the agent decide which tool to use based on the input query.\n\n![](https://aman.ai/images/copy.png)\n\n`def retrieve_and_select_tool(query):     if \"calculate\" in query:         return calculator_tool     elif \"web\" in query:         return web_search_tool     else:         return database_tool`\n\n![](https://aman.ai/images/copy.png)\n\n`def retrieve_and_select_tool(query):     if \"calculate\" in query:         return calculator_tool     elif \"web\" in query:         return web_search_tool     else:         return database_tool`\n\n##### Step 3: Chain Agents for Multi-Agent RAG\n\n*   In multi-agent RAG, you might have a “master agent” that routes queries to specialized agents based on query type. Here’s how to set up a master agent to coordinate multiple agents.\n\n![](https://aman.ai/images/copy.png)\n\n`from langchain.agents import MultiAgent  # Define specialized agents internal_agent = Agent(tools=[database_tool], routing_function=\"database_retrieval\") public_agent = Agent(tools=[web_search_tool], routing_function=\"web_retrieval\")  # Create a master agent to coordinate retrieval master_agent = MultiAgent(agents=[internal_agent, public_agent])  # Function to handle a query using master agent def handle_query_with_master_agent(query):     return master_agent.handle_query(query)`\n\n![](https://aman.ai/images/copy.png)\n\n`from langchain.agents import MultiAgent  # Define specialized agents internal_agent = Agent(tools=[database_tool], routing_function=\"database_retrieval\") public_agent = Agent(tools=[web_search_tool], routing_function=\"web_retrieval\")  # Create a master agent to coordinate retrieval master_agent = MultiAgent(agents=[internal_agent, public_agent])  # Function to handle a query using master agent def handle_query_with_master_agent(query):     return master_agent.handle_query(query)`\n\n##### Running the Multi-Agent Query\n\n*   Finally, to test the system, input a query and let the master agent route it appropriately:\n\n![](https://aman.ai/images/copy.png)\n\n`response = handle_query_with_master_agent(\"Find recent studies on neural networks\") print(response)`\n\n![](https://aman.ai/images/copy.png)\n\n`response = handle_query_with_master_agent(\"Find recent studies on neural networks\") print(response)`",
    "order": 25,
    "orderInChapter": 10,
    "difficulty": 4,
    "estimatedMinutes": 6,
    "tags": [
      "nlpllms",
      "neural network"
    ],
    "metadata": {
      "hasCode": true,
      "hasMath": false,
      "hasImages": true,
      "wordCount": 1073,
      "contentLength": 35913
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#code",
    "scrapedAt": "2025-12-28T11:54:28.278Z"
  },
  {
    "id": "ai-RAG-disadvantages-of-agentic-rag-26",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "Agentic Retrieval-Augmented Generation",
    "title": "Disadvantages of Agentic RAG",
    "subtitle": "Agentic Retrieval-Augmented Generation",
    "contentHtml": "<ul>\n  <li>\n    <p>Despite its advantages, agentic RAG comes with several limitations that should be carefully considered, particularly for time-sensitive applications:</p>\n\n    <ol>\n      <li>\n        <p><strong>Increased Latency</strong>: The inherent complexity of agentic RAG often translates to longer response times. Each query may require multiple tool interactions and sequential retrieval steps, which increase the latency significantly. This can hinder the system’s usability in environments where quick responses are crucial, such as real-time support systems or conversational interfaces.</p>\n      </li>\n      <li>\n        <p><strong>Higher Computational Cost</strong>: Agentic RAG systems often involve multiple calls to LLMs and other external tools. These calls cumulatively drive up computational costs, making it less efficient and potentially prohibitive for high-traffic applications. This expense adds to operational concerns, especially if the system must process large volumes of queries.</p>\n      </li>\n      <li>\n        <p><strong>Production Feasibility</strong>: Due to the latency and cost concerns, agentic RAG may not be ideal for production applications requiring rapid and continuous output. In such cases, vanilla RAG, which offers more direct and faster response generation, might be more suitable.</p>\n      </li>\n    </ol>\n  </li>\n  <li>\n    <p>While these drawbacks limit agentic RAG’s use in certain scenarios, its capability to generate high-quality, well-researched responses can make it worthwhile in contexts where response time is less critical and information accuracy is paramount.</p>\n  </li>\n</ul>\n<p>Despite its advantages, agentic RAG comes with several limitations that should be carefully considered, particularly for time-sensitive applications:</p>\n<ol>\n      <li>\n        <p><strong>Increased Latency</strong>: The inherent complexity of agentic RAG often translates to longer response times. Each query may require multiple tool interactions and sequential retrieval steps, which increase the latency significantly. This can hinder the system’s usability in environments where quick responses are crucial, such as real-time support systems or conversational interfaces.</p>\n      </li>\n      <li>\n        <p><strong>Higher Computational Cost</strong>: Agentic RAG systems often involve multiple calls to LLMs and other external tools. These calls cumulatively drive up computational costs, making it less efficient and potentially prohibitive for high-traffic applications. This expense adds to operational concerns, especially if the system must process large volumes of queries.</p>\n      </li>\n      <li>\n        <p><strong>Production Feasibility</strong>: Due to the latency and cost concerns, agentic RAG may not be ideal for production applications requiring rapid and continuous output. In such cases, vanilla RAG, which offers more direct and faster response generation, might be more suitable.</p>\n      </li>\n    </ol>\n<p><strong>Increased Latency</strong>: The inherent complexity of agentic RAG often translates to longer response times. Each query may require multiple tool interactions and sequential retrieval steps, which increase the latency significantly. This can hinder the system’s usability in environments where quick responses are crucial, such as real-time support systems or conversational interfaces.</p>\n<p><strong>Higher Computational Cost</strong>: Agentic RAG systems often involve multiple calls to LLMs and other external tools. These calls cumulatively drive up computational costs, making it less efficient and potentially prohibitive for high-traffic applications. This expense adds to operational concerns, especially if the system must process large volumes of queries.</p>\n<p><strong>Production Feasibility</strong>: Due to the latency and cost concerns, agentic RAG may not be ideal for production applications requiring rapid and continuous output. In such cases, vanilla RAG, which offers more direct and faster response generation, might be more suitable.</p>\n<p>While these drawbacks limit agentic RAG’s use in certain scenarios, its capability to generate high-quality, well-researched responses can make it worthwhile in contexts where response time is less critical and information accuracy is paramount.</p>",
    "contentMarkdown": "*   Despite its advantages, agentic RAG comes with several limitations that should be carefully considered, particularly for time-sensitive applications:\n    \n    1.  **Increased Latency**: The inherent complexity of agentic RAG often translates to longer response times. Each query may require multiple tool interactions and sequential retrieval steps, which increase the latency significantly. This can hinder the system’s usability in environments where quick responses are crucial, such as real-time support systems or conversational interfaces.\n        \n    2.  **Higher Computational Cost**: Agentic RAG systems often involve multiple calls to LLMs and other external tools. These calls cumulatively drive up computational costs, making it less efficient and potentially prohibitive for high-traffic applications. This expense adds to operational concerns, especially if the system must process large volumes of queries.\n        \n    3.  **Production Feasibility**: Due to the latency and cost concerns, agentic RAG may not be ideal for production applications requiring rapid and continuous output. In such cases, vanilla RAG, which offers more direct and faster response generation, might be more suitable.\n        \n*   While these drawbacks limit agentic RAG’s use in certain scenarios, its capability to generate high-quality, well-researched responses can make it worthwhile in contexts where response time is less critical and information accuracy is paramount.\n    \n\nDespite its advantages, agentic RAG comes with several limitations that should be carefully considered, particularly for time-sensitive applications:\n\n1.  **Increased Latency**: The inherent complexity of agentic RAG often translates to longer response times. Each query may require multiple tool interactions and sequential retrieval steps, which increase the latency significantly. This can hinder the system’s usability in environments where quick responses are crucial, such as real-time support systems or conversational interfaces.\n    \n2.  **Higher Computational Cost**: Agentic RAG systems often involve multiple calls to LLMs and other external tools. These calls cumulatively drive up computational costs, making it less efficient and potentially prohibitive for high-traffic applications. This expense adds to operational concerns, especially if the system must process large volumes of queries.\n    \n3.  **Production Feasibility**: Due to the latency and cost concerns, agentic RAG may not be ideal for production applications requiring rapid and continuous output. In such cases, vanilla RAG, which offers more direct and faster response generation, might be more suitable.\n    \n\n**Increased Latency**: The inherent complexity of agentic RAG often translates to longer response times. Each query may require multiple tool interactions and sequential retrieval steps, which increase the latency significantly. This can hinder the system’s usability in environments where quick responses are crucial, such as real-time support systems or conversational interfaces.\n\n**Higher Computational Cost**: Agentic RAG systems often involve multiple calls to LLMs and other external tools. These calls cumulatively drive up computational costs, making it less efficient and potentially prohibitive for high-traffic applications. This expense adds to operational concerns, especially if the system must process large volumes of queries.\n\n**Production Feasibility**: Due to the latency and cost concerns, agentic RAG may not be ideal for production applications requiring rapid and continuous output. In such cases, vanilla RAG, which offers more direct and faster response generation, might be more suitable.\n\nWhile these drawbacks limit agentic RAG’s use in certain scenarios, its capability to generate high-quality, well-researched responses can make it worthwhile in contexts where response time is less critical and information accuracy is paramount.",
    "order": 26,
    "orderInChapter": 11,
    "difficulty": 3,
    "estimatedMinutes": 3,
    "tags": [
      "nlpllms",
      "llm"
    ],
    "metadata": {
      "hasCode": false,
      "hasMath": false,
      "hasImages": false,
      "wordCount": 532,
      "contentLength": 4311
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#disadvantages-of-agentic-rag",
    "scrapedAt": "2025-12-28T11:54:28.278Z"
  },
  {
    "id": "ai-RAG-summary-27",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "Agentic Retrieval-Augmented Generation",
    "title": "Summary",
    "subtitle": "Agentic Retrieval-Augmented Generation",
    "contentHtml": "<ul>\n  <li>Agentic RAG refers to an agent-based implementation of RAG. AI agents are entities tasked with accomplishing specific objectives. These agents are often equipped with memory and tools, which they can utilize to carry out their tasks effectively. Among these tools, one significant capability is the ability to retrieve information from various sources, such as web searches or internal documents.</li>\n  <li>In the context of agentic RAG, the “retrieval becomes agentic.” This implies that the AI agent is capable of reasoning and making decisions regarding which sources are most appropriate for retrieving the required information. The agent’s tool usage evolves beyond simple information retrieval, becoming more flexible and dynamic.</li>\n  <li>The distinction between standard and agentic RAG can be summarized as follows:\n    <ul>\n      <li><strong>Common RAG</strong>: The user input prompts a single call to a database, retrieving additional information in response to the query.</li>\n      <li><strong>Agentic RAG</strong>: The agent is able to deliberate on which source is the most suitable for retrieving information based on the query, providing a more sophisticated and adaptable approach.</li>\n    </ul>\n  </li>\n  <li>The following figure (<a href=\"https://www.linkedin.com/in/804250ab/\">source</a>) offers a visual summary of Agentic RAG:</li>\n</ul>\n<ul>\n      <li><strong>Common RAG</strong>: The user input prompts a single call to a database, retrieving additional information in response to the query.</li>\n      <li><strong>Agentic RAG</strong>: The agent is able to deliberate on which source is the most suitable for retrieving information based on the query, providing a more sophisticated and adaptable approach.</li>\n    </ul>\n<p><img src=\"/primers/ai/assets/RAG/AgenticRAG.jpg\" alt=\"\"></p>",
    "contentMarkdown": "*   Agentic RAG refers to an agent-based implementation of RAG. AI agents are entities tasked with accomplishing specific objectives. These agents are often equipped with memory and tools, which they can utilize to carry out their tasks effectively. Among these tools, one significant capability is the ability to retrieve information from various sources, such as web searches or internal documents.\n*   In the context of agentic RAG, the “retrieval becomes agentic.” This implies that the AI agent is capable of reasoning and making decisions regarding which sources are most appropriate for retrieving the required information. The agent’s tool usage evolves beyond simple information retrieval, becoming more flexible and dynamic.\n*   The distinction between standard and agentic RAG can be summarized as follows:\n    *   **Common RAG**: The user input prompts a single call to a database, retrieving additional information in response to the query.\n    *   **Agentic RAG**: The agent is able to deliberate on which source is the most suitable for retrieving information based on the query, providing a more sophisticated and adaptable approach.\n*   The following figure ([source](https://www.linkedin.com/in/804250ab/)) offers a visual summary of Agentic RAG:\n\n*   **Common RAG**: The user input prompts a single call to a database, retrieving additional information in response to the query.\n*   **Agentic RAG**: The agent is able to deliberate on which source is the most suitable for retrieving information based on the query, providing a more sophisticated and adaptable approach.\n\n![](/primers/ai/assets/RAG/AgenticRAG.jpg)",
    "order": 27,
    "orderInChapter": 12,
    "difficulty": 3,
    "estimatedMinutes": 2,
    "tags": [
      "nlpllms"
    ],
    "metadata": {
      "hasCode": false,
      "hasMath": false,
      "hasImages": true,
      "wordCount": 237,
      "contentLength": 1827
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#summary",
    "scrapedAt": "2025-12-28T11:54:28.278Z"
  },
  {
    "id": "ai-RAG-computational-cost-28",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "RAG vs. Long Context Windows",
    "title": "Computational Cost",
    "subtitle": "RAG vs. Long Context Windows",
    "contentHtml": "<ul>\n  <li>Processing extremely long contexts incurs substantial computational overhead. For instance, utilizing a 10 million token context window with state-of-the-art models like Llama 4 demands considerable hardware resources—approximately 32 H100 GPUs—which translates to over $100 per hour in inference costs. The key-value (KV) cache alone can exceed 1 terabyte of VRAM. These requirements pose a significant barrier to the practical deployment of long-context inference systems at scale, especially for organizations with limited infrastructure budgets.</li>\n</ul>",
    "contentMarkdown": "*   Processing extremely long contexts incurs substantial computational overhead. For instance, utilizing a 10 million token context window with state-of-the-art models like Llama 4 demands considerable hardware resources—approximately 32 H100 GPUs—which translates to over $100 per hour in inference costs. The key-value (KV) cache alone can exceed 1 terabyte of VRAM. These requirements pose a significant barrier to the practical deployment of long-context inference systems at scale, especially for organizations with limited infrastructure budgets.",
    "order": 28,
    "orderInChapter": 1,
    "difficulty": 3,
    "estimatedMinutes": 1,
    "tags": [
      "nlpllms"
    ],
    "metadata": {
      "hasCode": false,
      "hasMath": false,
      "hasImages": false,
      "wordCount": 74,
      "contentLength": 571
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#computational-cost",
    "scrapedAt": "2025-12-28T11:54:28.278Z"
  },
  {
    "id": "ai-RAG-inference-latency-and-throughput-29",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "RAG vs. Long Context Windows",
    "title": "Inference Latency and Throughput",
    "subtitle": "RAG vs. Long Context Windows",
    "contentHtml": "<ul>\n  <li>As the number of tokens increases, the latency of inference rises proportionally, often leading to a considerable decline in throughput. Even when hardware resources are available, this degradation in response time can negatively impact user experience in latency-sensitive applications such as virtual assistants, search engines, or real-time analytics systems.</li>\n</ul>",
    "contentMarkdown": "*   As the number of tokens increases, the latency of inference rises proportionally, often leading to a considerable decline in throughput. Even when hardware resources are available, this degradation in response time can negatively impact user experience in latency-sensitive applications such as virtual assistants, search engines, or real-time analytics systems.",
    "order": 29,
    "orderInChapter": 2,
    "difficulty": 3,
    "estimatedMinutes": 1,
    "tags": [
      "nlpllms"
    ],
    "metadata": {
      "hasCode": false,
      "hasMath": false,
      "hasImages": false,
      "wordCount": 50,
      "contentLength": 384
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#inference-latency-and-throughput",
    "scrapedAt": "2025-12-28T11:54:28.278Z"
  },
  {
    "id": "ai-RAG-contextual-comprehension-and-model-training-limita-30",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "RAG vs. Long Context Windows",
    "title": "Contextual Comprehension and Model Training Limitations",
    "subtitle": "RAG vs. Long Context Windows",
    "contentHtml": "<ul>\n  <li>Although large context windows are theoretically capable of accommodating vast amounts of input data, current LLMs are typically trained on much smaller maximum context lengths—commonly up to 128,000 tokens. Consequently, performance across the full extent of a 10 million token context window is unproven and likely suboptimal. Empirical studies suggest that retrieval accuracy tends to diminish for information placed in the middle of a long context due to a phenomenon informally referred to as the “Lost in the Middle” effect. Therefore, while long-context architectures offer the promise of expanded capacity, their practical utility is constrained by training regimes and architectural bottlenecks.</li>\n</ul>",
    "contentMarkdown": "*   Although large context windows are theoretically capable of accommodating vast amounts of input data, current LLMs are typically trained on much smaller maximum context lengths—commonly up to 128,000 tokens. Consequently, performance across the full extent of a 10 million token context window is unproven and likely suboptimal. Empirical studies suggest that retrieval accuracy tends to diminish for information placed in the middle of a long context due to a phenomenon informally referred to as the “Lost in the Middle” effect. Therefore, while long-context architectures offer the promise of expanded capacity, their practical utility is constrained by training regimes and architectural bottlenecks.",
    "order": 30,
    "orderInChapter": 3,
    "difficulty": 3,
    "estimatedMinutes": 1,
    "tags": [
      "nlpllms",
      "llm"
    ],
    "metadata": {
      "hasCode": false,
      "hasMath": false,
      "hasImages": false,
      "wordCount": 102,
      "contentLength": 726
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#contextual-comprehension-and-model-training-limitations",
    "scrapedAt": "2025-12-28T11:54:28.278Z"
  },
  {
    "id": "ai-RAG-rag-as-a-targeted-cost-efficient-solution-31",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "RAG vs. Long Context Windows",
    "title": "RAG As a Targeted, Cost-Efficient Solution",
    "subtitle": "RAG vs. Long Context Windows",
    "contentHtml": "<ul>\n  <li>In contrast, RAG provides a principled and efficient mechanism for narrowing down relevant content from a large corpus before conditioning the model’s generative process. By introducing a retrieval stage that identifies and ranks the most pertinent information, RAG minimizes unnecessary context, optimizes for response accuracy, and reduces memory and compute demands. This retrieval-first approach allows RAG systems to operate effectively within the token limitations of current LLMs, while maintaining scalability and affordability.</li>\n</ul>",
    "contentMarkdown": "*   In contrast, RAG provides a principled and efficient mechanism for narrowing down relevant content from a large corpus before conditioning the model’s generative process. By introducing a retrieval stage that identifies and ranks the most pertinent information, RAG minimizes unnecessary context, optimizes for response accuracy, and reduces memory and compute demands. This retrieval-first approach allows RAG systems to operate effectively within the token limitations of current LLMs, while maintaining scalability and affordability.",
    "order": 31,
    "orderInChapter": 4,
    "difficulty": 4,
    "estimatedMinutes": 1,
    "tags": [
      "nlpllms",
      "llm"
    ],
    "metadata": {
      "hasCode": false,
      "hasMath": false,
      "hasImages": false,
      "wordCount": 73,
      "contentLength": 558
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#rag-as-a-targeted,-cost-efficient-solution",
    "scrapedAt": "2025-12-28T11:54:28.278Z"
  },
  {
    "id": "ai-RAG-retrieval-only-evaluation-32",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "RAG Benchmarks",
    "title": "Retrieval-Only Evaluation",
    "subtitle": "RAG Benchmarks",
    "contentHtml": "<ul>\n  <li>\n    <p>These benchmarks are primarily used to evaluate retrieval quality in isolation, but are often components of RAG pipelines. The most common ones are listed below:</p>\n\n    <ul>\n      <li><strong>BEIR</strong>:\n        <ul>\n          <li>Introduced or proposed in <a href=\"https://arxiv.org/abs/2104.08663\">BEIR: A Heterogeneous Benchmark for Zero-shot Evaluation of Information Retrieval Models</a> by Thakur et al. (2021). A diverse suite of IR tasks designed to test retriever generalization across domains.</li>\n          <li><strong>Evaluation framework:</strong> <a href=\"https://github.com/beir-cellar/beir\">BEIR GitHub Repository</a></li>\n          <li><strong>Typical metrics:</strong> NDCG@10, Recall@<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-131-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1287\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1288\"><span class=\"mi\" id=\"MathJax-Span-1289\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-131\">k</script>, Precision@<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-132-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1290\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1291\"><span class=\"mi\" id=\"MathJax-Span-1292\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-132\">k</script></li>\n        </ul>\n      </li>\n      <li><strong>MS MARCO</strong>:\n        <ul>\n          <li>Introduced or proposed in <a href=\"https://arxiv.org/abs/2105.04021\">MS MARCO: Benchmarking Ranking Models in the Large-Data Regime</a> by Craswell et al. (2021). A large-scale passage and document ranking benchmark derived from real Bing search queries.</li>\n          <li><strong>Official leaderboards:</strong> <a href=\"https://microsoft.github.io/MSMARCO-Passage-Ranking-Submissions/leaderboard/\">MS MARCO Passage Ranking Leaderboard</a></li>\n          <li><strong>Typical metrics:</strong> MRR@10, NDCG@10, Recall@<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-133-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1293\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1294\"><span class=\"mi\" id=\"MathJax-Span-1295\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-133\">k</script></li>\n        </ul>\n      </li>\n    </ul>\n  </li>\n</ul>\n<p>These benchmarks are primarily used to evaluate retrieval quality in isolation, but are often components of RAG pipelines. The most common ones are listed below:</p>\n<ul>\n      <li><strong>BEIR</strong>:\n        <ul>\n          <li>Introduced or proposed in <a href=\"https://arxiv.org/abs/2104.08663\">BEIR: A Heterogeneous Benchmark for Zero-shot Evaluation of Information Retrieval Models</a> by Thakur et al. (2021). A diverse suite of IR tasks designed to test retriever generalization across domains.</li>\n          <li><strong>Evaluation framework:</strong> <a href=\"https://github.com/beir-cellar/beir\">BEIR GitHub Repository</a></li>\n          <li><strong>Typical metrics:</strong> NDCG@10, Recall@<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-131-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1287\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1288\"><span class=\"mi\" id=\"MathJax-Span-1289\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-131\">k</script>, Precision@<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-132-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1290\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1291\"><span class=\"mi\" id=\"MathJax-Span-1292\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-132\">k</script></li>\n        </ul>\n      </li>\n      <li><strong>MS MARCO</strong>:\n        <ul>\n          <li>Introduced or proposed in <a href=\"https://arxiv.org/abs/2105.04021\">MS MARCO: Benchmarking Ranking Models in the Large-Data Regime</a> by Craswell et al. (2021). A large-scale passage and document ranking benchmark derived from real Bing search queries.</li>\n          <li><strong>Official leaderboards:</strong> <a href=\"https://microsoft.github.io/MSMARCO-Passage-Ranking-Submissions/leaderboard/\">MS MARCO Passage Ranking Leaderboard</a></li>\n          <li><strong>Typical metrics:</strong> MRR@10, NDCG@10, Recall@<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-133-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1293\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1294\"><span class=\"mi\" id=\"MathJax-Span-1295\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-133\">k</script></li>\n        </ul>\n      </li>\n    </ul>\n<ul>\n          <li>Introduced or proposed in <a href=\"https://arxiv.org/abs/2104.08663\">BEIR: A Heterogeneous Benchmark for Zero-shot Evaluation of Information Retrieval Models</a> by Thakur et al. (2021). A diverse suite of IR tasks designed to test retriever generalization across domains.</li>\n          <li><strong>Evaluation framework:</strong> <a href=\"https://github.com/beir-cellar/beir\">BEIR GitHub Repository</a></li>\n          <li><strong>Typical metrics:</strong> NDCG@10, Recall@<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-131-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1287\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1288\"><span class=\"mi\" id=\"MathJax-Span-1289\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-131\">k</script>, Precision@<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-132-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1290\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1291\"><span class=\"mi\" id=\"MathJax-Span-1292\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-132\">k</script></li>\n        </ul>\n<ul>\n          <li>Introduced or proposed in <a href=\"https://arxiv.org/abs/2105.04021\">MS MARCO: Benchmarking Ranking Models in the Large-Data Regime</a> by Craswell et al. (2021). A large-scale passage and document ranking benchmark derived from real Bing search queries.</li>\n          <li><strong>Official leaderboards:</strong> <a href=\"https://microsoft.github.io/MSMARCO-Passage-Ranking-Submissions/leaderboard/\">MS MARCO Passage Ranking Leaderboard</a></li>\n          <li><strong>Typical metrics:</strong> MRR@10, NDCG@10, Recall@<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-133-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1293\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1294\"><span class=\"mi\" id=\"MathJax-Span-1295\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-133\">k</script></li>\n        </ul>",
    "contentMarkdown": "*   These benchmarks are primarily used to evaluate retrieval quality in isolation, but are often components of RAG pipelines. The most common ones are listed below:\n    \n    *   **BEIR**:\n        *   Introduced or proposed in [BEIR: A Heterogeneous Benchmark for Zero-shot Evaluation of Information Retrieval Models](https://arxiv.org/abs/2104.08663) by Thakur et al. (2021). A diverse suite of IR tasks designed to test retriever generalization across domains.\n        *   **Evaluation framework:** [BEIR GitHub Repository](https://github.com/beir-cellar/beir)\n        *   **Typical metrics:** NDCG@10, Recall@kkk, Precision@kkk\n    *   **MS MARCO**:\n        *   Introduced or proposed in [MS MARCO: Benchmarking Ranking Models in the Large-Data Regime](https://arxiv.org/abs/2105.04021) by Craswell et al. (2021). A large-scale passage and document ranking benchmark derived from real Bing search queries.\n        *   **Official leaderboards:** [MS MARCO Passage Ranking Leaderboard](https://microsoft.github.io/MSMARCO-Passage-Ranking-Submissions/leaderboard/)\n        *   **Typical metrics:** MRR@10, NDCG@10, Recall@kkk\n\nThese benchmarks are primarily used to evaluate retrieval quality in isolation, but are often components of RAG pipelines. The most common ones are listed below:\n\n*   **BEIR**:\n    *   Introduced or proposed in [BEIR: A Heterogeneous Benchmark for Zero-shot Evaluation of Information Retrieval Models](https://arxiv.org/abs/2104.08663) by Thakur et al. (2021). A diverse suite of IR tasks designed to test retriever generalization across domains.\n    *   **Evaluation framework:** [BEIR GitHub Repository](https://github.com/beir-cellar/beir)\n    *   **Typical metrics:** NDCG@10, Recall@kkk, Precision@kkk\n*   **MS MARCO**:\n    *   Introduced or proposed in [MS MARCO: Benchmarking Ranking Models in the Large-Data Regime](https://arxiv.org/abs/2105.04021) by Craswell et al. (2021). A large-scale passage and document ranking benchmark derived from real Bing search queries.\n    *   **Official leaderboards:** [MS MARCO Passage Ranking Leaderboard](https://microsoft.github.io/MSMARCO-Passage-Ranking-Submissions/leaderboard/)\n    *   **Typical metrics:** MRR@10, NDCG@10, Recall@kkk\n\n*   Introduced or proposed in [BEIR: A Heterogeneous Benchmark for Zero-shot Evaluation of Information Retrieval Models](https://arxiv.org/abs/2104.08663) by Thakur et al. (2021). A diverse suite of IR tasks designed to test retriever generalization across domains.\n*   **Evaluation framework:** [BEIR GitHub Repository](https://github.com/beir-cellar/beir)\n*   **Typical metrics:** NDCG@10, Recall@kkk, Precision@kkk\n\n*   Introduced or proposed in [MS MARCO: Benchmarking Ranking Models in the Large-Data Regime](https://arxiv.org/abs/2105.04021) by Craswell et al. (2021). A large-scale passage and document ranking benchmark derived from real Bing search queries.\n*   **Official leaderboards:** [MS MARCO Passage Ranking Leaderboard](https://microsoft.github.io/MSMARCO-Passage-Ranking-Submissions/leaderboard/)\n*   **Typical metrics:** MRR@10, NDCG@10, Recall@kkk",
    "order": 32,
    "orderInChapter": 1,
    "difficulty": 5,
    "estimatedMinutes": 2,
    "tags": [
      "nlpllms"
    ],
    "metadata": {
      "hasCode": false,
      "hasMath": true,
      "hasImages": false,
      "wordCount": 337,
      "contentLength": 15343
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#retrieval-only-evaluation",
    "scrapedAt": "2025-12-28T11:54:28.278Z"
  },
  {
    "id": "ai-RAG-end-to-end-evaluation-retrieval-generation-33",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "RAG Benchmarks",
    "title": "End-to-End Evaluation (Retrieval + Generation)",
    "subtitle": "RAG Benchmarks",
    "contentHtml": "<ul>\n  <li>\n    <p>These benchmarks evaluate retrieval as an integral part of the task and explicitly test grounded generation, reasoning, and faithfulness. The most common ones are listed below:</p>\n\n    <ul>\n      <li><strong>Natural Questions (Open-Domain QA)</strong>:\n        <ul>\n          <li>Introduced or proposed in <a href=\"https://aclanthology.org/Q19-1026.pdf\">Natural Questions: A Benchmark for Question Answering Research</a> by Kwiatkowski et al. (2019). Real Google search queries with annotated answers; commonly used in open-domain QA and RAG setups where retrieval recall directly affects generation quality.</li>\n          <li><strong>Community leaderboards:</strong> <a href=\"https://llm-stats.com/benchmarks/natural-questions\">Natural Questions on LLM-Stats</a></li>\n          <li><strong>Typical metrics:</strong> EM, F1, retrieval recall</li>\n        </ul>\n      </li>\n      <li><strong>TriviaQA</strong>:\n        <ul>\n          <li>Introduced or proposed in <a href=\"https://arxiv.org/abs/1705.03551\">TriviaQA: A Large-Scale Distantly Supervised Challenge Dataset for Reading Comprehension</a> by Joshi et al. (2017). Tests retrieval robustness and answer generation from noisy, long documents.</li>\n          <li><strong>Typical metrics:</strong> EM, F1, evidence recall</li>\n        </ul>\n      </li>\n      <li><strong>HotpotQA</strong>:\n        <ul>\n          <li>Introduced or proposed in <a href=\"https://arxiv.org/abs/1809.09600\">HotpotQA: A Dataset for Diverse, Explainable Multi-Hop Question Answering</a> by Yang et al. (2018). Requires multi-hop retrieval and reasoning across multiple documents, making retrieval errors directly visible in generation quality.</li>\n          <li><strong>Project page:</strong> <a href=\"https://hotpotqa.github.io/\">HotpotQA</a></li>\n          <li><strong>Typical metrics:</strong> EM, F1, supporting fact recall</li>\n        </ul>\n      </li>\n      <li><strong>KILT</strong>:\n        <ul>\n          <li>Introduced or proposed in <a href=\"https://arxiv.org/abs/2009.02252\">KILT: A Benchmark for Knowledge-Intensive Language Tasks</a> by Petroni et al. (2021). A unified benchmark that explicitly evaluates both answer correctness and evidence provenance across multiple tasks.</li>\n          <li><strong>Official benchmark and leaderboards:</strong> <a href=\"https://ai.meta.com/tools/kilt/\">KILT Benchmark Page</a></li>\n          <li><strong>Typical metrics:</strong> EM, F1, provenance precision and recall</li>\n        </ul>\n      </li>\n      <li><strong>FRAMES</strong>:\n        <ul>\n          <li>Introduced or proposed in <a href=\"https://arxiv.org/html/2409.12941v3\">FRAMES: Fact, Fetch, and Reason for RAG Evaluation</a> by Liu et al. (2024). Designed specifically for RAG, with a strong emphasis on factual grounding, evidence usage, and reasoning in long-form answers.</li>\n          <li><strong>Typical metrics:</strong> grounded answer accuracy, provenance correctness, faithfulness scores</li>\n        </ul>\n      </li>\n      <li><strong>RAGBench</strong>:\n        <ul>\n          <li>Introduced or proposed in <a href=\"https://arxiv.org/abs/2407.11005\">RAGBench: A Large-Scale Explainable Benchmark for Retrieval-Augmented Generation</a> by Friel et al. (2024). A large multi-domain benchmark aimed at holistic, explainable evaluation of retrieval and generation together.</li>\n          <li><strong>Typical metrics:</strong> answer correctness, explanation alignment, retrieval–generation interaction scores</li>\n        </ul>\n      </li>\n    </ul>\n  </li>\n</ul>\n<p>These benchmarks evaluate retrieval as an integral part of the task and explicitly test grounded generation, reasoning, and faithfulness. The most common ones are listed below:</p>\n<ul>\n      <li><strong>Natural Questions (Open-Domain QA)</strong>:\n        <ul>\n          <li>Introduced or proposed in <a href=\"https://aclanthology.org/Q19-1026.pdf\">Natural Questions: A Benchmark for Question Answering Research</a> by Kwiatkowski et al. (2019). Real Google search queries with annotated answers; commonly used in open-domain QA and RAG setups where retrieval recall directly affects generation quality.</li>\n          <li><strong>Community leaderboards:</strong> <a href=\"https://llm-stats.com/benchmarks/natural-questions\">Natural Questions on LLM-Stats</a></li>\n          <li><strong>Typical metrics:</strong> EM, F1, retrieval recall</li>\n        </ul>\n      </li>\n      <li><strong>TriviaQA</strong>:\n        <ul>\n          <li>Introduced or proposed in <a href=\"https://arxiv.org/abs/1705.03551\">TriviaQA: A Large-Scale Distantly Supervised Challenge Dataset for Reading Comprehension</a> by Joshi et al. (2017). Tests retrieval robustness and answer generation from noisy, long documents.</li>\n          <li><strong>Typical metrics:</strong> EM, F1, evidence recall</li>\n        </ul>\n      </li>\n      <li><strong>HotpotQA</strong>:\n        <ul>\n          <li>Introduced or proposed in <a href=\"https://arxiv.org/abs/1809.09600\">HotpotQA: A Dataset for Diverse, Explainable Multi-Hop Question Answering</a> by Yang et al. (2018). Requires multi-hop retrieval and reasoning across multiple documents, making retrieval errors directly visible in generation quality.</li>\n          <li><strong>Project page:</strong> <a href=\"https://hotpotqa.github.io/\">HotpotQA</a></li>\n          <li><strong>Typical metrics:</strong> EM, F1, supporting fact recall</li>\n        </ul>\n      </li>\n      <li><strong>KILT</strong>:\n        <ul>\n          <li>Introduced or proposed in <a href=\"https://arxiv.org/abs/2009.02252\">KILT: A Benchmark for Knowledge-Intensive Language Tasks</a> by Petroni et al. (2021). A unified benchmark that explicitly evaluates both answer correctness and evidence provenance across multiple tasks.</li>\n          <li><strong>Official benchmark and leaderboards:</strong> <a href=\"https://ai.meta.com/tools/kilt/\">KILT Benchmark Page</a></li>\n          <li><strong>Typical metrics:</strong> EM, F1, provenance precision and recall</li>\n        </ul>\n      </li>\n      <li><strong>FRAMES</strong>:\n        <ul>\n          <li>Introduced or proposed in <a href=\"https://arxiv.org/html/2409.12941v3\">FRAMES: Fact, Fetch, and Reason for RAG Evaluation</a> by Liu et al. (2024). Designed specifically for RAG, with a strong emphasis on factual grounding, evidence usage, and reasoning in long-form answers.</li>\n          <li><strong>Typical metrics:</strong> grounded answer accuracy, provenance correctness, faithfulness scores</li>\n        </ul>\n      </li>\n      <li><strong>RAGBench</strong>:\n        <ul>\n          <li>Introduced or proposed in <a href=\"https://arxiv.org/abs/2407.11005\">RAGBench: A Large-Scale Explainable Benchmark for Retrieval-Augmented Generation</a> by Friel et al. (2024). A large multi-domain benchmark aimed at holistic, explainable evaluation of retrieval and generation together.</li>\n          <li><strong>Typical metrics:</strong> answer correctness, explanation alignment, retrieval–generation interaction scores</li>\n        </ul>\n      </li>\n    </ul>\n<ul>\n          <li>Introduced or proposed in <a href=\"https://aclanthology.org/Q19-1026.pdf\">Natural Questions: A Benchmark for Question Answering Research</a> by Kwiatkowski et al. (2019). Real Google search queries with annotated answers; commonly used in open-domain QA and RAG setups where retrieval recall directly affects generation quality.</li>\n          <li><strong>Community leaderboards:</strong> <a href=\"https://llm-stats.com/benchmarks/natural-questions\">Natural Questions on LLM-Stats</a></li>\n          <li><strong>Typical metrics:</strong> EM, F1, retrieval recall</li>\n        </ul>\n<ul>\n          <li>Introduced or proposed in <a href=\"https://arxiv.org/abs/1705.03551\">TriviaQA: A Large-Scale Distantly Supervised Challenge Dataset for Reading Comprehension</a> by Joshi et al. (2017). Tests retrieval robustness and answer generation from noisy, long documents.</li>\n          <li><strong>Typical metrics:</strong> EM, F1, evidence recall</li>\n        </ul>\n<ul>\n          <li>Introduced or proposed in <a href=\"https://arxiv.org/abs/1809.09600\">HotpotQA: A Dataset for Diverse, Explainable Multi-Hop Question Answering</a> by Yang et al. (2018). Requires multi-hop retrieval and reasoning across multiple documents, making retrieval errors directly visible in generation quality.</li>\n          <li><strong>Project page:</strong> <a href=\"https://hotpotqa.github.io/\">HotpotQA</a></li>\n          <li><strong>Typical metrics:</strong> EM, F1, supporting fact recall</li>\n        </ul>\n<ul>\n          <li>Introduced or proposed in <a href=\"https://arxiv.org/abs/2009.02252\">KILT: A Benchmark for Knowledge-Intensive Language Tasks</a> by Petroni et al. (2021). A unified benchmark that explicitly evaluates both answer correctness and evidence provenance across multiple tasks.</li>\n          <li><strong>Official benchmark and leaderboards:</strong> <a href=\"https://ai.meta.com/tools/kilt/\">KILT Benchmark Page</a></li>\n          <li><strong>Typical metrics:</strong> EM, F1, provenance precision and recall</li>\n        </ul>\n<ul>\n          <li>Introduced or proposed in <a href=\"https://arxiv.org/html/2409.12941v3\">FRAMES: Fact, Fetch, and Reason for RAG Evaluation</a> by Liu et al. (2024). Designed specifically for RAG, with a strong emphasis on factual grounding, evidence usage, and reasoning in long-form answers.</li>\n          <li><strong>Typical metrics:</strong> grounded answer accuracy, provenance correctness, faithfulness scores</li>\n        </ul>\n<ul>\n          <li>Introduced or proposed in <a href=\"https://arxiv.org/abs/2407.11005\">RAGBench: A Large-Scale Explainable Benchmark for Retrieval-Augmented Generation</a> by Friel et al. (2024). A large multi-domain benchmark aimed at holistic, explainable evaluation of retrieval and generation together.</li>\n          <li><strong>Typical metrics:</strong> answer correctness, explanation alignment, retrieval–generation interaction scores</li>\n        </ul>",
    "contentMarkdown": "*   These benchmarks evaluate retrieval as an integral part of the task and explicitly test grounded generation, reasoning, and faithfulness. The most common ones are listed below:\n    \n    *   **Natural Questions (Open-Domain QA)**:\n        *   Introduced or proposed in [Natural Questions: A Benchmark for Question Answering Research](https://aclanthology.org/Q19-1026.pdf) by Kwiatkowski et al. (2019). Real Google search queries with annotated answers; commonly used in open-domain QA and RAG setups where retrieval recall directly affects generation quality.\n        *   **Community leaderboards:** [Natural Questions on LLM-Stats](https://llm-stats.com/benchmarks/natural-questions)\n        *   **Typical metrics:** EM, F1, retrieval recall\n    *   **TriviaQA**:\n        *   Introduced or proposed in [TriviaQA: A Large-Scale Distantly Supervised Challenge Dataset for Reading Comprehension](https://arxiv.org/abs/1705.03551) by Joshi et al. (2017). Tests retrieval robustness and answer generation from noisy, long documents.\n        *   **Typical metrics:** EM, F1, evidence recall\n    *   **HotpotQA**:\n        *   Introduced or proposed in [HotpotQA: A Dataset for Diverse, Explainable Multi-Hop Question Answering](https://arxiv.org/abs/1809.09600) by Yang et al. (2018). Requires multi-hop retrieval and reasoning across multiple documents, making retrieval errors directly visible in generation quality.\n        *   **Project page:** [HotpotQA](https://hotpotqa.github.io/)\n        *   **Typical metrics:** EM, F1, supporting fact recall\n    *   **KILT**:\n        *   Introduced or proposed in [KILT: A Benchmark for Knowledge-Intensive Language Tasks](https://arxiv.org/abs/2009.02252) by Petroni et al. (2021). A unified benchmark that explicitly evaluates both answer correctness and evidence provenance across multiple tasks.\n        *   **Official benchmark and leaderboards:** [KILT Benchmark Page](https://ai.meta.com/tools/kilt/)\n        *   **Typical metrics:** EM, F1, provenance precision and recall\n    *   **FRAMES**:\n        *   Introduced or proposed in [FRAMES: Fact, Fetch, and Reason for RAG Evaluation](https://arxiv.org/html/2409.12941v3) by Liu et al. (2024). Designed specifically for RAG, with a strong emphasis on factual grounding, evidence usage, and reasoning in long-form answers.\n        *   **Typical metrics:** grounded answer accuracy, provenance correctness, faithfulness scores\n    *   **RAGBench**:\n        *   Introduced or proposed in [RAGBench: A Large-Scale Explainable Benchmark for Retrieval-Augmented Generation](https://arxiv.org/abs/2407.11005) by Friel et al. (2024). A large multi-domain benchmark aimed at holistic, explainable evaluation of retrieval and generation together.\n        *   **Typical metrics:** answer correctness, explanation alignment, retrieval–generation interaction scores\n\nThese benchmarks evaluate retrieval as an integral part of the task and explicitly test grounded generation, reasoning, and faithfulness. The most common ones are listed below:\n\n*   **Natural Questions (Open-Domain QA)**:\n    *   Introduced or proposed in [Natural Questions: A Benchmark for Question Answering Research](https://aclanthology.org/Q19-1026.pdf) by Kwiatkowski et al. (2019). Real Google search queries with annotated answers; commonly used in open-domain QA and RAG setups where retrieval recall directly affects generation quality.\n    *   **Community leaderboards:** [Natural Questions on LLM-Stats](https://llm-stats.com/benchmarks/natural-questions)\n    *   **Typical metrics:** EM, F1, retrieval recall\n*   **TriviaQA**:\n    *   Introduced or proposed in [TriviaQA: A Large-Scale Distantly Supervised Challenge Dataset for Reading Comprehension](https://arxiv.org/abs/1705.03551) by Joshi et al. (2017). Tests retrieval robustness and answer generation from noisy, long documents.\n    *   **Typical metrics:** EM, F1, evidence recall\n*   **HotpotQA**:\n    *   Introduced or proposed in [HotpotQA: A Dataset for Diverse, Explainable Multi-Hop Question Answering](https://arxiv.org/abs/1809.09600) by Yang et al. (2018). Requires multi-hop retrieval and reasoning across multiple documents, making retrieval errors directly visible in generation quality.\n    *   **Project page:** [HotpotQA](https://hotpotqa.github.io/)\n    *   **Typical metrics:** EM, F1, supporting fact recall\n*   **KILT**:\n    *   Introduced or proposed in [KILT: A Benchmark for Knowledge-Intensive Language Tasks](https://arxiv.org/abs/2009.02252) by Petroni et al. (2021). A unified benchmark that explicitly evaluates both answer correctness and evidence provenance across multiple tasks.\n    *   **Official benchmark and leaderboards:** [KILT Benchmark Page](https://ai.meta.com/tools/kilt/)\n    *   **Typical metrics:** EM, F1, provenance precision and recall\n*   **FRAMES**:\n    *   Introduced or proposed in [FRAMES: Fact, Fetch, and Reason for RAG Evaluation](https://arxiv.org/html/2409.12941v3) by Liu et al. (2024). Designed specifically for RAG, with a strong emphasis on factual grounding, evidence usage, and reasoning in long-form answers.\n    *   **Typical metrics:** grounded answer accuracy, provenance correctness, faithfulness scores\n*   **RAGBench**:\n    *   Introduced or proposed in [RAGBench: A Large-Scale Explainable Benchmark for Retrieval-Augmented Generation](https://arxiv.org/abs/2407.11005) by Friel et al. (2024). A large multi-domain benchmark aimed at holistic, explainable evaluation of retrieval and generation together.\n    *   **Typical metrics:** answer correctness, explanation alignment, retrieval–generation interaction scores\n\n*   Introduced or proposed in [Natural Questions: A Benchmark for Question Answering Research](https://aclanthology.org/Q19-1026.pdf) by Kwiatkowski et al. (2019). Real Google search queries with annotated answers; commonly used in open-domain QA and RAG setups where retrieval recall directly affects generation quality.\n*   **Community leaderboards:** [Natural Questions on LLM-Stats](https://llm-stats.com/benchmarks/natural-questions)\n*   **Typical metrics:** EM, F1, retrieval recall\n\n*   Introduced or proposed in [TriviaQA: A Large-Scale Distantly Supervised Challenge Dataset for Reading Comprehension](https://arxiv.org/abs/1705.03551) by Joshi et al. (2017). Tests retrieval robustness and answer generation from noisy, long documents.\n*   **Typical metrics:** EM, F1, evidence recall\n\n*   Introduced or proposed in [HotpotQA: A Dataset for Diverse, Explainable Multi-Hop Question Answering](https://arxiv.org/abs/1809.09600) by Yang et al. (2018). Requires multi-hop retrieval and reasoning across multiple documents, making retrieval errors directly visible in generation quality.\n*   **Project page:** [HotpotQA](https://hotpotqa.github.io/)\n*   **Typical metrics:** EM, F1, supporting fact recall\n\n*   Introduced or proposed in [KILT: A Benchmark for Knowledge-Intensive Language Tasks](https://arxiv.org/abs/2009.02252) by Petroni et al. (2021). A unified benchmark that explicitly evaluates both answer correctness and evidence provenance across multiple tasks.\n*   **Official benchmark and leaderboards:** [KILT Benchmark Page](https://ai.meta.com/tools/kilt/)\n*   **Typical metrics:** EM, F1, provenance precision and recall\n\n*   Introduced or proposed in [FRAMES: Fact, Fetch, and Reason for RAG Evaluation](https://arxiv.org/html/2409.12941v3) by Liu et al. (2024). Designed specifically for RAG, with a strong emphasis on factual grounding, evidence usage, and reasoning in long-form answers.\n*   **Typical metrics:** grounded answer accuracy, provenance correctness, faithfulness scores\n\n*   Introduced or proposed in [RAGBench: A Large-Scale Explainable Benchmark for Retrieval-Augmented Generation](https://arxiv.org/abs/2407.11005) by Friel et al. (2024). A large multi-domain benchmark aimed at holistic, explainable evaluation of retrieval and generation together.\n*   **Typical metrics:** answer correctness, explanation alignment, retrieval–generation interaction scores",
    "order": 33,
    "orderInChapter": 2,
    "difficulty": 4,
    "estimatedMinutes": 5,
    "tags": [
      "nlpllms",
      "llm"
    ],
    "metadata": {
      "hasCode": false,
      "hasMath": false,
      "hasImages": false,
      "wordCount": 908,
      "contentLength": 10006
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#end-to-end-evaluation-(retrieval-+-generation)",
    "scrapedAt": "2025-12-28T11:54:28.278Z"
  },
  {
    "id": "ai-RAG-retrieval-augmented-generation-for-knowledge-inten-34",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "Selected Papers",
    "title": "Retrieval-Augmented Generation for Knowledge-Intensive NLP Tasks",
    "subtitle": "Selected Papers",
    "contentHtml": "<p><img src=\"/primers/ai/assets/RAG/2.png\" alt=\"\"></p>\n<ul>\n  <li>The paper by Lewis et al. from Facebook AI Research, University College London, and New York University, introduces Retrieval-Augmented Generation (RAG) models combining pre-trained parametric and non-parametric memory for language generation tasks.</li>\n  <li>Addressing limitations of large pre-trained language models, such as difficulty in accessing and precisely manipulating knowledge, RAG models merge a pre-trained sequence-to-sequence (seq2seq) model with a dense vector index of Wikipedia, accessed by a neural retriever.</li>\n  <li>The RAG framework encompasses two models: RAG-Sequence, using the same retrieved document for the entire sequence, and RAG-Token, allowing different passages for each token.</li>\n  <li>The retrieval component, Dense Passage Retriever (DPR), uses a bi-encoder architecture with BERT-based document and query encoders. The generator component utilizes BART-large, a pre-trained seq2seq transformer with 400M parameters.</li>\n  <li>RAG models were trained jointly on the retriever and generator components without direct supervision on which documents to retrieve, using stochastic gradient descent with Adam. The training used a Wikipedia dump as the non-parametric knowledge source, split into 21M 100-word chunks.</li>\n  <li>A summary of the methods and models used for query/document embedding and retrieval, as well as the end-to-end structure of the RAG framework is as below:\n    <ol>\n      <li><strong>Query/Document Embedding:</strong>\n        <ul>\n          <li>The retrieval component, Dense Passage Retriever (DPR), follows a bi-encoder architecture.</li>\n          <li>DPR uses BERTBASE as the foundation for both document and query encoders.</li>\n          <li>For a document <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-134-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>z</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1296\" style=\"width: 0.576em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.471em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.47em, 2.451em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1297\"><span class=\"mi\" id=\"MathJax-Span-1298\" style=\"font-family: STIXGeneral-Italic;\">z</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.184em; border-left: 0px solid; width: 0px; height: 0.753em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>z</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-134\">z</script>, a dense representation <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-135-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>d</mi><mo stretchy=&quot;false&quot;>(</mo><mi>z</mi><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1299\" style=\"width: 2.034em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.669em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1001.62em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1300\"><span class=\"mi\" id=\"MathJax-Span-1301\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1302\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-1303\" style=\"font-family: STIXGeneral-Italic;\">z</span><span class=\"mo\" id=\"MathJax-Span-1304\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>d</mi><mo stretchy=\"false\">(</mo><mi>z</mi><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-135\">d(z)</script> is produced by a document encoder, <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-136-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>B</mi><mi>E</mi><mi>R</mi><msub><mi>T</mi><mi>d</mi></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1305\" style=\"width: 3.544em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.919em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1002.92em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1306\"><span class=\"mi\" id=\"MathJax-Span-1307\" style=\"font-family: STIXGeneral-Italic;\">B</span><span class=\"mi\" id=\"MathJax-Span-1308\" style=\"font-family: STIXGeneral-Italic;\">E<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mi\" id=\"MathJax-Span-1309\" style=\"font-family: STIXGeneral-Italic;\">R</span><span class=\"msubsup\" id=\"MathJax-Span-1310\"><span style=\"display: inline-block; position: relative; width: 0.992em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.63em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1311\" style=\"font-family: STIXGeneral-Italic;\">T<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.576em;\"><span class=\"mi\" id=\"MathJax-Span-1312\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>B</mi><mi>E</mi><mi>R</mi><msub><mi>T</mi><mi>d</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-136\">BERT_d</script>.</li>\n          <li>For a query <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-137-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>x</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1313\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1314\"><span class=\"mi\" id=\"MathJax-Span-1315\" style=\"font-family: STIXGeneral-Italic;\">x<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>x</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-137\">x</script>, a query representation <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-138-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>q</mi><mo stretchy=&quot;false&quot;>(</mo><mi>x</mi><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1316\" style=\"width: 2.034em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.669em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1001.62em, 2.555em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1317\"><span class=\"mi\" id=\"MathJax-Span-1318\" style=\"font-family: STIXGeneral-Italic;\">q</span><span class=\"mo\" id=\"MathJax-Span-1319\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-1320\" style=\"font-family: STIXGeneral-Italic;\">x<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1321\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>q</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-138\">q(x)</script> is produced by a query encoder, <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-139-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>B</mi><mi>E</mi><mi>R</mi><msub><mi>T</mi><mi>q</mi></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1322\" style=\"width: 3.544em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.919em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1002.92em, 2.659em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1323\"><span class=\"mi\" id=\"MathJax-Span-1324\" style=\"font-family: STIXGeneral-Italic;\">B</span><span class=\"mi\" id=\"MathJax-Span-1325\" style=\"font-family: STIXGeneral-Italic;\">E<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mi\" id=\"MathJax-Span-1326\" style=\"font-family: STIXGeneral-Italic;\">R</span><span class=\"msubsup\" id=\"MathJax-Span-1327\"><span style=\"display: inline-block; position: relative; width: 0.992em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.63em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1328\" style=\"font-family: STIXGeneral-Italic;\">T<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.576em;\"><span class=\"mi\" id=\"MathJax-Span-1329\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">q</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.253em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>B</mi><mi>E</mi><mi>R</mi><msub><mi>T</mi><mi>q</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-139\">BERT_q</script>.</li>\n          <li>The embeddings are created such that relevant documents for a given query are close in the embedding space, allowing effective retrieval.</li>\n        </ul>\n      </li>\n      <li><strong>Retrieval Process:</strong>\n        <ul>\n          <li>The retrieval process involves calculating the top-<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-140-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1330\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1331\"><span class=\"mi\" id=\"MathJax-Span-1332\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-140\">k</script> documents with the highest prior probability, which is essentially a Maximum Inner Product Search (MIPS) problem.</li>\n          <li>The MIPS problem is solved approximately in sub-linear time to efficiently retrieve relevant documents.</li>\n        </ul>\n      </li>\n      <li><strong>End-to-End Structure:</strong>\n        <ul>\n          <li>The RAG model uses the input sequence <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-141-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>x</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1333\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1334\"><span class=\"mi\" id=\"MathJax-Span-1335\" style=\"font-family: STIXGeneral-Italic;\">x<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>x</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-141\">x</script> to retrieve text documents <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-142-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>z</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1336\" style=\"width: 0.576em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.471em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.47em, 2.451em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1337\"><span class=\"mi\" id=\"MathJax-Span-1338\" style=\"font-family: STIXGeneral-Italic;\">z</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.184em; border-left: 0px solid; width: 0px; height: 0.753em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>z</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-142\">z</script>, which are then used as additional context for generating the target sequence <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-143-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>y</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1339\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.555em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1340\"><span class=\"mi\" id=\"MathJax-Span-1341\" style=\"font-family: STIXGeneral-Italic;\">y</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.878em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>y</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-143\">y</script>.</li>\n          <li>The generator component is modeled using BART-large, a pre-trained seq2seq transformer with 400M parameters. BART-large combines the input <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-144-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>x</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1342\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1343\"><span class=\"mi\" id=\"MathJax-Span-1344\" style=\"font-family: STIXGeneral-Italic;\">x<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>x</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-144\">x</script>with the retrieved content <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-145-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>z</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1345\" style=\"width: 0.576em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.471em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.47em, 2.451em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1346\"><span class=\"mi\" id=\"MathJax-Span-1347\" style=\"font-family: STIXGeneral-Italic;\">z</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.184em; border-left: 0px solid; width: 0px; height: 0.753em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>z</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-145\">z</script> for generation.</li>\n          <li>The RAG-Sequence model uses the same retrieved document for generating the complete sequence, while the RAG-Token model can use different passages per token.</li>\n          <li>The training process involves jointly training the retriever and generator components without direct supervision on what document should be retrieved. The training minimizes the negative marginal log-likelihood of each target using stochastic gradient descent with Adam.</li>\n          <li>Notably, the document encoder BERTd is kept fixed during training, avoiding the need for periodic updates of the document index.</li>\n        </ul>\n      </li>\n    </ol>\n  </li>\n  <li>The following figure from the paper illustrates an overview of the proposed approach. They combine a pre-trained retriever (Query Encoder + Document Index) with a pre-trained seq2seq model (Generator) and fine-tune end-to-end. For query <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-146-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>x</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1348\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1349\"><span class=\"mi\" id=\"MathJax-Span-1350\" style=\"font-family: STIXGeneral-Italic;\">x<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>x</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-146\">x</script>, they use Maximum Inner Product Search (MIPS) to find the top-<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-147-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1351\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1352\"><span class=\"mi\" id=\"MathJax-Span-1353\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-147\">K</script> documents <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-148-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>z</mi><mi>i</mi></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1354\" style=\"width: 0.836em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.68em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.565em, 1000.68em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1355\"><span class=\"msubsup\" id=\"MathJax-Span-1356\"><span style=\"display: inline-block; position: relative; width: 0.68em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.37em, 4.273em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1357\" style=\"font-family: STIXGeneral-Italic;\">z</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.367em;\"><span class=\"mi\" id=\"MathJax-Span-1358\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.816em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>z</mi><mi>i</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-148\">z_i</script>. For final prediction <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-149-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>y</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1359\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.555em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1360\"><span class=\"mi\" id=\"MathJax-Span-1361\" style=\"font-family: STIXGeneral-Italic;\">y</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.878em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>y</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-149\">y</script>, they treat <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-150-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>z</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1362\" style=\"width: 0.576em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.471em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.47em, 2.451em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1363\"><span class=\"mi\" id=\"MathJax-Span-1364\" style=\"font-family: STIXGeneral-Italic;\">z</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.184em; border-left: 0px solid; width: 0px; height: 0.753em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>z</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-150\">z</script> as a latent variable and marginalize over seq2seq predictions given different documents.</li>\n</ul>\n<ol>\n      <li><strong>Query/Document Embedding:</strong>\n        <ul>\n          <li>The retrieval component, Dense Passage Retriever (DPR), follows a bi-encoder architecture.</li>\n          <li>DPR uses BERTBASE as the foundation for both document and query encoders.</li>\n          <li>For a document <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-134-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>z</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1296\" style=\"width: 0.576em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.471em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.47em, 2.451em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1297\"><span class=\"mi\" id=\"MathJax-Span-1298\" style=\"font-family: STIXGeneral-Italic;\">z</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.184em; border-left: 0px solid; width: 0px; height: 0.753em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>z</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-134\">z</script>, a dense representation <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-135-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>d</mi><mo stretchy=&quot;false&quot;>(</mo><mi>z</mi><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1299\" style=\"width: 2.034em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.669em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1001.62em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1300\"><span class=\"mi\" id=\"MathJax-Span-1301\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1302\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-1303\" style=\"font-family: STIXGeneral-Italic;\">z</span><span class=\"mo\" id=\"MathJax-Span-1304\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>d</mi><mo stretchy=\"false\">(</mo><mi>z</mi><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-135\">d(z)</script> is produced by a document encoder, <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-136-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>B</mi><mi>E</mi><mi>R</mi><msub><mi>T</mi><mi>d</mi></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1305\" style=\"width: 3.544em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.919em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1002.92em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1306\"><span class=\"mi\" id=\"MathJax-Span-1307\" style=\"font-family: STIXGeneral-Italic;\">B</span><span class=\"mi\" id=\"MathJax-Span-1308\" style=\"font-family: STIXGeneral-Italic;\">E<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mi\" id=\"MathJax-Span-1309\" style=\"font-family: STIXGeneral-Italic;\">R</span><span class=\"msubsup\" id=\"MathJax-Span-1310\"><span style=\"display: inline-block; position: relative; width: 0.992em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.63em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1311\" style=\"font-family: STIXGeneral-Italic;\">T<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.576em;\"><span class=\"mi\" id=\"MathJax-Span-1312\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>B</mi><mi>E</mi><mi>R</mi><msub><mi>T</mi><mi>d</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-136\">BERT_d</script>.</li>\n          <li>For a query <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-137-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>x</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1313\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1314\"><span class=\"mi\" id=\"MathJax-Span-1315\" style=\"font-family: STIXGeneral-Italic;\">x<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>x</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-137\">x</script>, a query representation <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-138-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>q</mi><mo stretchy=&quot;false&quot;>(</mo><mi>x</mi><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1316\" style=\"width: 2.034em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.669em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1001.62em, 2.555em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1317\"><span class=\"mi\" id=\"MathJax-Span-1318\" style=\"font-family: STIXGeneral-Italic;\">q</span><span class=\"mo\" id=\"MathJax-Span-1319\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-1320\" style=\"font-family: STIXGeneral-Italic;\">x<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1321\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>q</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-138\">q(x)</script> is produced by a query encoder, <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-139-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>B</mi><mi>E</mi><mi>R</mi><msub><mi>T</mi><mi>q</mi></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1322\" style=\"width: 3.544em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.919em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1002.92em, 2.659em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1323\"><span class=\"mi\" id=\"MathJax-Span-1324\" style=\"font-family: STIXGeneral-Italic;\">B</span><span class=\"mi\" id=\"MathJax-Span-1325\" style=\"font-family: STIXGeneral-Italic;\">E<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mi\" id=\"MathJax-Span-1326\" style=\"font-family: STIXGeneral-Italic;\">R</span><span class=\"msubsup\" id=\"MathJax-Span-1327\"><span style=\"display: inline-block; position: relative; width: 0.992em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.63em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1328\" style=\"font-family: STIXGeneral-Italic;\">T<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.576em;\"><span class=\"mi\" id=\"MathJax-Span-1329\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">q</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.253em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>B</mi><mi>E</mi><mi>R</mi><msub><mi>T</mi><mi>q</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-139\">BERT_q</script>.</li>\n          <li>The embeddings are created such that relevant documents for a given query are close in the embedding space, allowing effective retrieval.</li>\n        </ul>\n      </li>\n      <li><strong>Retrieval Process:</strong>\n        <ul>\n          <li>The retrieval process involves calculating the top-<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-140-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1330\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1331\"><span class=\"mi\" id=\"MathJax-Span-1332\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-140\">k</script> documents with the highest prior probability, which is essentially a Maximum Inner Product Search (MIPS) problem.</li>\n          <li>The MIPS problem is solved approximately in sub-linear time to efficiently retrieve relevant documents.</li>\n        </ul>\n      </li>\n      <li><strong>End-to-End Structure:</strong>\n        <ul>\n          <li>The RAG model uses the input sequence <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-141-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>x</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1333\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1334\"><span class=\"mi\" id=\"MathJax-Span-1335\" style=\"font-family: STIXGeneral-Italic;\">x<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>x</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-141\">x</script> to retrieve text documents <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-142-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>z</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1336\" style=\"width: 0.576em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.471em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.47em, 2.451em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1337\"><span class=\"mi\" id=\"MathJax-Span-1338\" style=\"font-family: STIXGeneral-Italic;\">z</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.184em; border-left: 0px solid; width: 0px; height: 0.753em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>z</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-142\">z</script>, which are then used as additional context for generating the target sequence <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-143-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>y</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1339\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.555em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1340\"><span class=\"mi\" id=\"MathJax-Span-1341\" style=\"font-family: STIXGeneral-Italic;\">y</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.878em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>y</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-143\">y</script>.</li>\n          <li>The generator component is modeled using BART-large, a pre-trained seq2seq transformer with 400M parameters. BART-large combines the input <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-144-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>x</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1342\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1343\"><span class=\"mi\" id=\"MathJax-Span-1344\" style=\"font-family: STIXGeneral-Italic;\">x<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>x</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-144\">x</script>with the retrieved content <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-145-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>z</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1345\" style=\"width: 0.576em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.471em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.47em, 2.451em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1346\"><span class=\"mi\" id=\"MathJax-Span-1347\" style=\"font-family: STIXGeneral-Italic;\">z</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.184em; border-left: 0px solid; width: 0px; height: 0.753em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>z</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-145\">z</script> for generation.</li>\n          <li>The RAG-Sequence model uses the same retrieved document for generating the complete sequence, while the RAG-Token model can use different passages per token.</li>\n          <li>The training process involves jointly training the retriever and generator components without direct supervision on what document should be retrieved. The training minimizes the negative marginal log-likelihood of each target using stochastic gradient descent with Adam.</li>\n          <li>Notably, the document encoder BERTd is kept fixed during training, avoiding the need for periodic updates of the document index.</li>\n        </ul>\n      </li>\n    </ol>\n<ul>\n          <li>The retrieval component, Dense Passage Retriever (DPR), follows a bi-encoder architecture.</li>\n          <li>DPR uses BERTBASE as the foundation for both document and query encoders.</li>\n          <li>For a document <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-134-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>z</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1296\" style=\"width: 0.576em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.471em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.47em, 2.451em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1297\"><span class=\"mi\" id=\"MathJax-Span-1298\" style=\"font-family: STIXGeneral-Italic;\">z</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.184em; border-left: 0px solid; width: 0px; height: 0.753em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>z</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-134\">z</script>, a dense representation <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-135-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>d</mi><mo stretchy=&quot;false&quot;>(</mo><mi>z</mi><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1299\" style=\"width: 2.034em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.669em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1001.62em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1300\"><span class=\"mi\" id=\"MathJax-Span-1301\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1302\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-1303\" style=\"font-family: STIXGeneral-Italic;\">z</span><span class=\"mo\" id=\"MathJax-Span-1304\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>d</mi><mo stretchy=\"false\">(</mo><mi>z</mi><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-135\">d(z)</script> is produced by a document encoder, <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-136-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>B</mi><mi>E</mi><mi>R</mi><msub><mi>T</mi><mi>d</mi></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1305\" style=\"width: 3.544em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.919em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1002.92em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1306\"><span class=\"mi\" id=\"MathJax-Span-1307\" style=\"font-family: STIXGeneral-Italic;\">B</span><span class=\"mi\" id=\"MathJax-Span-1308\" style=\"font-family: STIXGeneral-Italic;\">E<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mi\" id=\"MathJax-Span-1309\" style=\"font-family: STIXGeneral-Italic;\">R</span><span class=\"msubsup\" id=\"MathJax-Span-1310\"><span style=\"display: inline-block; position: relative; width: 0.992em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.63em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1311\" style=\"font-family: STIXGeneral-Italic;\">T<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.576em;\"><span class=\"mi\" id=\"MathJax-Span-1312\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>B</mi><mi>E</mi><mi>R</mi><msub><mi>T</mi><mi>d</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-136\">BERT_d</script>.</li>\n          <li>For a query <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-137-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>x</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1313\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1314\"><span class=\"mi\" id=\"MathJax-Span-1315\" style=\"font-family: STIXGeneral-Italic;\">x<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>x</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-137\">x</script>, a query representation <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-138-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>q</mi><mo stretchy=&quot;false&quot;>(</mo><mi>x</mi><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1316\" style=\"width: 2.034em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.669em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1001.62em, 2.555em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1317\"><span class=\"mi\" id=\"MathJax-Span-1318\" style=\"font-family: STIXGeneral-Italic;\">q</span><span class=\"mo\" id=\"MathJax-Span-1319\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-1320\" style=\"font-family: STIXGeneral-Italic;\">x<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1321\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>q</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-138\">q(x)</script> is produced by a query encoder, <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-139-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>B</mi><mi>E</mi><mi>R</mi><msub><mi>T</mi><mi>q</mi></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1322\" style=\"width: 3.544em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.919em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1002.92em, 2.659em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1323\"><span class=\"mi\" id=\"MathJax-Span-1324\" style=\"font-family: STIXGeneral-Italic;\">B</span><span class=\"mi\" id=\"MathJax-Span-1325\" style=\"font-family: STIXGeneral-Italic;\">E<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mi\" id=\"MathJax-Span-1326\" style=\"font-family: STIXGeneral-Italic;\">R</span><span class=\"msubsup\" id=\"MathJax-Span-1327\"><span style=\"display: inline-block; position: relative; width: 0.992em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.63em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1328\" style=\"font-family: STIXGeneral-Italic;\">T<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.576em;\"><span class=\"mi\" id=\"MathJax-Span-1329\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">q</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.253em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>B</mi><mi>E</mi><mi>R</mi><msub><mi>T</mi><mi>q</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-139\">BERT_q</script>.</li>\n          <li>The embeddings are created such that relevant documents for a given query are close in the embedding space, allowing effective retrieval.</li>\n        </ul>\n<ul>\n          <li>The retrieval process involves calculating the top-<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-140-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1330\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1331\"><span class=\"mi\" id=\"MathJax-Span-1332\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-140\">k</script> documents with the highest prior probability, which is essentially a Maximum Inner Product Search (MIPS) problem.</li>\n          <li>The MIPS problem is solved approximately in sub-linear time to efficiently retrieve relevant documents.</li>\n        </ul>\n<ul>\n          <li>The RAG model uses the input sequence <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-141-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>x</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1333\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1334\"><span class=\"mi\" id=\"MathJax-Span-1335\" style=\"font-family: STIXGeneral-Italic;\">x<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>x</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-141\">x</script> to retrieve text documents <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-142-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>z</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1336\" style=\"width: 0.576em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.471em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.47em, 2.451em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1337\"><span class=\"mi\" id=\"MathJax-Span-1338\" style=\"font-family: STIXGeneral-Italic;\">z</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.184em; border-left: 0px solid; width: 0px; height: 0.753em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>z</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-142\">z</script>, which are then used as additional context for generating the target sequence <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-143-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>y</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1339\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.555em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1340\"><span class=\"mi\" id=\"MathJax-Span-1341\" style=\"font-family: STIXGeneral-Italic;\">y</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.878em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>y</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-143\">y</script>.</li>\n          <li>The generator component is modeled using BART-large, a pre-trained seq2seq transformer with 400M parameters. BART-large combines the input <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-144-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>x</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1342\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1343\"><span class=\"mi\" id=\"MathJax-Span-1344\" style=\"font-family: STIXGeneral-Italic;\">x<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>x</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-144\">x</script>with the retrieved content <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-145-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>z</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1345\" style=\"width: 0.576em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.471em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.47em, 2.451em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1346\"><span class=\"mi\" id=\"MathJax-Span-1347\" style=\"font-family: STIXGeneral-Italic;\">z</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.184em; border-left: 0px solid; width: 0px; height: 0.753em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>z</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-145\">z</script> for generation.</li>\n          <li>The RAG-Sequence model uses the same retrieved document for generating the complete sequence, while the RAG-Token model can use different passages per token.</li>\n          <li>The training process involves jointly training the retriever and generator components without direct supervision on what document should be retrieved. The training minimizes the negative marginal log-likelihood of each target using stochastic gradient descent with Adam.</li>\n          <li>Notably, the document encoder BERTd is kept fixed during training, avoiding the need for periodic updates of the document index.</li>\n        </ul>\n<p><img src=\"../../../images/papers/RAG.jpg\" alt=\"\"></p>\n<ul>\n  <li>In open-domain QA tasks, RAG established new state-of-the-art results, outperforming both parametric seq2seq models and task-specific retrieve-and-extract architectures. RAG models showed the ability to generate correct answers even when the right answer wasn’t in any retrieved document.</li>\n  <li>RAG-Sequence surpassed BART in Open MS-MARCO NLG, indicating less hallucination and more factually correct text generation. RAG-Token outperformed RAG-Sequence in Jeopardy question generation, demonstrating higher factuality and specificity.</li>\n  <li>On the FEVER fact verification task, RAG models achieved results close to state-of-the-art models that require more complex architectures and intermediate retrieval supervision.</li>\n  <li>This study showcases the effectiveness of hybrid generation models, combining parametric and non-parametric memories, offering new directions in combining these components for a range of NLP tasks.</li>\n  <li><a href=\"https://github.com/huggingface/transformers/blob/master/examples/rag/\">Code</a>; <a href=\"https://huggingface.co/rag/\">interactive demo</a>.</li>\n</ul>",
    "contentMarkdown": "![](/primers/ai/assets/RAG/2.png)\n\n*   The paper by Lewis et al. from Facebook AI Research, University College London, and New York University, introduces Retrieval-Augmented Generation (RAG) models combining pre-trained parametric and non-parametric memory for language generation tasks.\n*   Addressing limitations of large pre-trained language models, such as difficulty in accessing and precisely manipulating knowledge, RAG models merge a pre-trained sequence-to-sequence (seq2seq) model with a dense vector index of Wikipedia, accessed by a neural retriever.\n*   The RAG framework encompasses two models: RAG-Sequence, using the same retrieved document for the entire sequence, and RAG-Token, allowing different passages for each token.\n*   The retrieval component, Dense Passage Retriever (DPR), uses a bi-encoder architecture with BERT-based document and query encoders. The generator component utilizes BART-large, a pre-trained seq2seq transformer with 400M parameters.\n*   RAG models were trained jointly on the retriever and generator components without direct supervision on which documents to retrieve, using stochastic gradient descent with Adam. The training used a Wikipedia dump as the non-parametric knowledge source, split into 21M 100-word chunks.\n*   A summary of the methods and models used for query/document embedding and retrieval, as well as the end-to-end structure of the RAG framework is as below:\n    1.  **Query/Document Embedding:**\n        *   The retrieval component, Dense Passage Retriever (DPR), follows a bi-encoder architecture.\n        *   DPR uses BERTBASE as the foundation for both document and query encoders.\n        *   For a document zzz, a dense representation d(z)d(z)d(z) is produced by a document encoder, BERTdBERTdBERT\\_d.\n        *   For a query xxx, a query representation q(x)q(x)q(x) is produced by a query encoder, BERTqBERTqBERT\\_q.\n        *   The embeddings are created such that relevant documents for a given query are close in the embedding space, allowing effective retrieval.\n    2.  **Retrieval Process:**\n        *   The retrieval process involves calculating the top-kkk documents with the highest prior probability, which is essentially a Maximum Inner Product Search (MIPS) problem.\n        *   The MIPS problem is solved approximately in sub-linear time to efficiently retrieve relevant documents.\n    3.  **End-to-End Structure:**\n        *   The RAG model uses the input sequence xxx to retrieve text documents zzz, which are then used as additional context for generating the target sequence yyy.\n        *   The generator component is modeled using BART-large, a pre-trained seq2seq transformer with 400M parameters. BART-large combines the input xxxwith the retrieved content zzz for generation.\n        *   The RAG-Sequence model uses the same retrieved document for generating the complete sequence, while the RAG-Token model can use different passages per token.\n        *   The training process involves jointly training the retriever and generator components without direct supervision on what document should be retrieved. The training minimizes the negative marginal log-likelihood of each target using stochastic gradient descent with Adam.\n        *   Notably, the document encoder BERTd is kept fixed during training, avoiding the need for periodic updates of the document index.\n*   The following figure from the paper illustrates an overview of the proposed approach. They combine a pre-trained retriever (Query Encoder + Document Index) with a pre-trained seq2seq model (Generator) and fine-tune end-to-end. For query xxx, they use Maximum Inner Product Search (MIPS) to find the top-KKK documents ziziz\\_i. For final prediction yyy, they treat zzz as a latent variable and marginalize over seq2seq predictions given different documents.\n\n1.  **Query/Document Embedding:**\n    *   The retrieval component, Dense Passage Retriever (DPR), follows a bi-encoder architecture.\n    *   DPR uses BERTBASE as the foundation for both document and query encoders.\n    *   For a document zzz, a dense representation d(z)d(z)d(z) is produced by a document encoder, BERTdBERTdBERT\\_d.\n    *   For a query xxx, a query representation q(x)q(x)q(x) is produced by a query encoder, BERTqBERTqBERT\\_q.\n    *   The embeddings are created such that relevant documents for a given query are close in the embedding space, allowing effective retrieval.\n2.  **Retrieval Process:**\n    *   The retrieval process involves calculating the top-kkk documents with the highest prior probability, which is essentially a Maximum Inner Product Search (MIPS) problem.\n    *   The MIPS problem is solved approximately in sub-linear time to efficiently retrieve relevant documents.\n3.  **End-to-End Structure:**\n    *   The RAG model uses the input sequence xxx to retrieve text documents zzz, which are then used as additional context for generating the target sequence yyy.\n    *   The generator component is modeled using BART-large, a pre-trained seq2seq transformer with 400M parameters. BART-large combines the input xxxwith the retrieved content zzz for generation.\n    *   The RAG-Sequence model uses the same retrieved document for generating the complete sequence, while the RAG-Token model can use different passages per token.\n    *   The training process involves jointly training the retriever and generator components without direct supervision on what document should be retrieved. The training minimizes the negative marginal log-likelihood of each target using stochastic gradient descent with Adam.\n    *   Notably, the document encoder BERTd is kept fixed during training, avoiding the need for periodic updates of the document index.\n\n*   The retrieval component, Dense Passage Retriever (DPR), follows a bi-encoder architecture.\n*   DPR uses BERTBASE as the foundation for both document and query encoders.\n*   For a document zzz, a dense representation d(z)d(z)d(z) is produced by a document encoder, BERTdBERTdBERT\\_d.\n*   For a query xxx, a query representation q(x)q(x)q(x) is produced by a query encoder, BERTqBERTqBERT\\_q.\n*   The embeddings are created such that relevant documents for a given query are close in the embedding space, allowing effective retrieval.\n\n*   The retrieval process involves calculating the top-kkk documents with the highest prior probability, which is essentially a Maximum Inner Product Search (MIPS) problem.\n*   The MIPS problem is solved approximately in sub-linear time to efficiently retrieve relevant documents.\n\n*   The RAG model uses the input sequence xxx to retrieve text documents zzz, which are then used as additional context for generating the target sequence yyy.\n*   The generator component is modeled using BART-large, a pre-trained seq2seq transformer with 400M parameters. BART-large combines the input xxxwith the retrieved content zzz for generation.\n*   The RAG-Sequence model uses the same retrieved document for generating the complete sequence, while the RAG-Token model can use different passages per token.\n*   The training process involves jointly training the retriever and generator components without direct supervision on what document should be retrieved. The training minimizes the negative marginal log-likelihood of each target using stochastic gradient descent with Adam.\n*   Notably, the document encoder BERTd is kept fixed during training, avoiding the need for periodic updates of the document index.\n\n![](../../../images/papers/RAG.jpg)\n\n*   In open-domain QA tasks, RAG established new state-of-the-art results, outperforming both parametric seq2seq models and task-specific retrieve-and-extract architectures. RAG models showed the ability to generate correct answers even when the right answer wasn’t in any retrieved document.\n*   RAG-Sequence surpassed BART in Open MS-MARCO NLG, indicating less hallucination and more factually correct text generation. RAG-Token outperformed RAG-Sequence in Jeopardy question generation, demonstrating higher factuality and specificity.\n*   On the FEVER fact verification task, RAG models achieved results close to state-of-the-art models that require more complex architectures and intermediate retrieval supervision.\n*   This study showcases the effectiveness of hybrid generation models, combining parametric and non-parametric memories, offering new directions in combining these components for a range of NLP tasks.\n*   [Code](https://github.com/huggingface/transformers/blob/master/examples/rag/); [interactive demo](https://huggingface.co/rag/).",
    "order": 34,
    "orderInChapter": 1,
    "difficulty": 5,
    "estimatedMinutes": 6,
    "tags": [
      "nlpllms",
      "transformer",
      "embedding",
      "bert",
      "nlp",
      "gradient descent"
    ],
    "metadata": {
      "hasCode": false,
      "hasMath": true,
      "hasImages": true,
      "wordCount": 1164,
      "contentLength": 69947
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#retrieval-augmented-generation-for-knowledge-intensive-nlp-tasks",
    "scrapedAt": "2025-12-28T11:54:28.278Z"
  },
  {
    "id": "ai-RAG-active-retrieval-augmented-generation-35",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "Selected Papers",
    "title": "Active Retrieval Augmented Generation",
    "subtitle": "Selected Papers",
    "contentHtml": "<ul>\n  <li>Despite the remarkable ability of large language models (LLMs) to comprehend and generate language, they have a tendency to hallucinate and create factually inaccurate output.</li>\n  <li>Augmenting LLMs by retrieving information from external knowledge resources is one promising solution. Most existing retrieval-augmented LLMs employ a retrieve-and-generate setup that only retrieves information once based on the input. This is limiting, however, in more general scenarios involving generation of long texts, where continually gathering information throughout the generation process is essential. There have been some past efforts to retrieve information multiple times while generating outputs, which mostly retrieve documents at fixed intervals using the previous context as queries.</li>\n  <li>This paper from Jiang et al. at CMU, Sea AI Lab, and Meta AI in EMNLP 2023 presents Forward-Looking Active REtrieval augmented generation (FLARE), a method addressing the tendency of large language models (LLMs) to produce factually inaccurate content.</li>\n  <li>FLARE iteratively uses predictions of upcoming sentences to actively decide when and what to retrieve across the generation process, enhancing LLMs with dynamic, multi-stage external information retrieval.</li>\n  <li>Unlike traditional retrieve-and-generate models that use fixed intervals or input-based retrieval, FLARE targets continual information gathering for long text generation, reducing hallucinations and factual inaccuracies.</li>\n  <li>The system triggers retrieval when generating low-confidence tokens, determined by a probability threshold. This anticipates future content, forming queries to retrieve relevant documents for regeneration.</li>\n  <li>The following figure from the paper illustrates FLARE. Starting with the user input <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-151-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>x</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1365\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1366\"><span class=\"mi\" id=\"MathJax-Span-1367\" style=\"font-family: STIXGeneral-Italic;\">x<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>x</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-151\">x</script> and initial retrieval results <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-152-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>D</mi><mi>x</mi></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1368\" style=\"width: 1.357em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.096em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1001.1em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1369\"><span class=\"msubsup\" id=\"MathJax-Span-1370\"><span style=\"display: inline-block; position: relative; width: 1.096em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.68em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1371\" style=\"font-family: STIXGeneral-Italic;\">D</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.732em;\"><span class=\"mi\" id=\"MathJax-Span-1372\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">x<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>D</mi><mi>x</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-152\">D_x</script>, FLARE iteratively generates a temporary next sentence (shown in gray italic) and check whether it contains low-probability tokens (indicated with underline). If so (step 2 and 3), the system retrieves relevant documents and regenerates the sentence.</li>\n</ul>\n<p><img src=\"../../../images/papers/ARAG.jpg\" alt=\"\"></p>\n<ul>\n  <li>FLARE was tested on four long-form, knowledge-intensive generation tasks/datasets, exhibiting superior or competitive performance, demonstrating its effectiveness in addressing the limitations of existing retrieval-augmented LLMs.</li>\n  <li>The model is adaptable to existing LLMs, as shown with its implementation on GPT-3.5, and employs off-the-shelf retrievers and the Bing search engine.</li>\n  <li><a href=\"https://github.com/jzbjyb/FLARE\">Code</a>.</li>\n</ul>",
    "contentMarkdown": "*   Despite the remarkable ability of large language models (LLMs) to comprehend and generate language, they have a tendency to hallucinate and create factually inaccurate output.\n*   Augmenting LLMs by retrieving information from external knowledge resources is one promising solution. Most existing retrieval-augmented LLMs employ a retrieve-and-generate setup that only retrieves information once based on the input. This is limiting, however, in more general scenarios involving generation of long texts, where continually gathering information throughout the generation process is essential. There have been some past efforts to retrieve information multiple times while generating outputs, which mostly retrieve documents at fixed intervals using the previous context as queries.\n*   This paper from Jiang et al. at CMU, Sea AI Lab, and Meta AI in EMNLP 2023 presents Forward-Looking Active REtrieval augmented generation (FLARE), a method addressing the tendency of large language models (LLMs) to produce factually inaccurate content.\n*   FLARE iteratively uses predictions of upcoming sentences to actively decide when and what to retrieve across the generation process, enhancing LLMs with dynamic, multi-stage external information retrieval.\n*   Unlike traditional retrieve-and-generate models that use fixed intervals or input-based retrieval, FLARE targets continual information gathering for long text generation, reducing hallucinations and factual inaccuracies.\n*   The system triggers retrieval when generating low-confidence tokens, determined by a probability threshold. This anticipates future content, forming queries to retrieve relevant documents for regeneration.\n*   The following figure from the paper illustrates FLARE. Starting with the user input xxx and initial retrieval results DxDxD\\_x, FLARE iteratively generates a temporary next sentence (shown in gray italic) and check whether it contains low-probability tokens (indicated with underline). If so (step 2 and 3), the system retrieves relevant documents and regenerates the sentence.\n\n![](../../../images/papers/ARAG.jpg)\n\n*   FLARE was tested on four long-form, knowledge-intensive generation tasks/datasets, exhibiting superior or competitive performance, demonstrating its effectiveness in addressing the limitations of existing retrieval-augmented LLMs.\n*   The model is adaptable to existing LLMs, as shown with its implementation on GPT-3.5, and employs off-the-shelf retrievers and the Bing search engine.\n*   [Code](https://github.com/jzbjyb/FLARE).",
    "order": 35,
    "orderInChapter": 2,
    "difficulty": 5,
    "estimatedMinutes": 2,
    "tags": [
      "nlpllms",
      "gpt",
      "llm",
      "nlp"
    ],
    "metadata": {
      "hasCode": false,
      "hasMath": true,
      "hasImages": true,
      "wordCount": 336,
      "contentLength": 5840
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#active-retrieval-augmented-generation",
    "scrapedAt": "2025-12-28T11:54:28.278Z"
  },
  {
    "id": "ai-RAG-murag-multimodal-retrieval-augmented-generator-36",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "Selected Papers",
    "title": "MuRAG: Multimodal Retrieval-Augmented Generator",
    "subtitle": "Selected Papers",
    "contentHtml": "<ul>\n  <li>This paper by Chen et al. from Google Research proposes Multimodal Retrieval-Augmented Transformer (MuRAG), which looks to extend the retrieval process beyond text to include other modalities like images or structured data, which can then be used alongside textual information to inform the generation process.</li>\n  <li>MuRAG’s magic lies in its two-phase training approach: pre-training and fine-tuning, each carefully crafted to build the model’s ability to tap into a vast expanse of multimodal knowledge.</li>\n  <li>The key goal of MuRAG is to incorporate both visual and textual knowledge into language models to improve their capability for multimodal question answering.</li>\n  <li>MuRAG is distinct in its ability to access an external non-parametric multimodal memory (images and texts) to enhance language generation, addressing the limitations of text-only retrieval in previous models.</li>\n  <li>MuRAG has a dual-encoder architecture combines pre-trained visual transformer (ViT) and a text encoder (T5) models to create a backbone encoder, enabling the encoding of image-text pairs, image-only, and text-only inputs into a unified/joint multimodal representation.</li>\n  <li>MuRAG is pre-trained on a mixture of image-text data (LAION, Conceptual Captions) and text-only data (PAQ, VQA). It uses a contrastive loss for retrieving relevant knowledge and a generation loss for answer prediction. It employs a two-stage training pipeline: initial training with small in-batch memory followed by training with a large global memory.</li>\n  <li>During the retriever stage, MuRAG takes a query <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-153-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>q</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1373\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.555em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1374\"><span class=\"mi\" id=\"MathJax-Span-1375\" style=\"font-family: STIXGeneral-Italic;\">q</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.878em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>q</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-153\">q</script> of any modality as input and retrieves from a memory <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-154-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;>M</mi></mrow></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1376\" style=\"width: 0.888em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.732em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.68em, 2.398em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1377\"><span class=\"texatom\" id=\"MathJax-Span-1378\"><span class=\"mrow\" id=\"MathJax-Span-1379\"><span class=\"mi\" id=\"MathJax-Span-1380\" style=\"font-family: STIXNonUnicode-Italic;\"></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.122em; border-left: 0px solid; width: 0px; height: 1.003em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mrow class=\"MJX-TeXAtom-ORD\"><mi class=\"MJX-tex-caligraphic\" mathvariant=\"script\">M</mi></mrow></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-154\">\\mathcal{M}</script> of image-text pairs. Specifically, we apply the backbone encoder <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-155-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>f</mi><mi>&amp;#x03B8;</mi></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1381\" style=\"width: 0.836em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.68em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1000.68em, 2.503em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1382\"><span class=\"msubsup\" id=\"MathJax-Span-1383\"><span style=\"display: inline-block; position: relative; width: 0.68em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.378em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1384\" style=\"font-family: STIXGeneral-Italic;\">f<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.159em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.263em;\"><span class=\"mi\" id=\"MathJax-Span-1385\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">θ<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>f</mi><mi>θ</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-155\">f_\\theta</script> to encode a query <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-156-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>q</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1386\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.555em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1387\"><span class=\"mi\" id=\"MathJax-Span-1388\" style=\"font-family: STIXGeneral-Italic;\">q</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.878em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>q</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-156\">q</script>, and use maximum inner product search (MIPS) over all of the memory candidates <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-157-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>m</mi><mo>&amp;#x2208;</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;>M</mi></mrow></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1389\" style=\"width: 3.284em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.711em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1002.66em, 2.451em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1390\"><span class=\"mi\" id=\"MathJax-Span-1391\" style=\"font-family: STIXGeneral-Italic;\">m</span><span class=\"mo\" id=\"MathJax-Span-1392\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">∈</span><span class=\"texatom\" id=\"MathJax-Span-1393\" style=\"padding-left: 0.315em;\"><span class=\"mrow\" id=\"MathJax-Span-1394\"><span class=\"mi\" id=\"MathJax-Span-1395\" style=\"font-family: STIXNonUnicode-Italic;\"></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.122em; border-left: 0px solid; width: 0px; height: 1.003em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>m</mi><mo>∈</mo><mrow class=\"MJX-TeXAtom-ORD\"><mi class=\"MJX-tex-caligraphic\" mathvariant=\"script\">M</mi></mrow></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-157\">m \\in \\mathcal{M}</script> to find the top-<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-158-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1396\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1397\"><span class=\"mi\" id=\"MathJax-Span-1398\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-158\">k</script> nearest neighbors <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-159-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>Top</mi><mi>K</mi></msub><mo>&amp;#x2061;</mo><mo stretchy=&quot;false&quot;>(</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;>M</mi></mrow><mo>&amp;#x2223;</mo><mi>q</mi><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mrow><mo>[</mo><mrow><msub><mi>m</mi><mn>1</mn></msub><mo>,</mo><mo>&amp;#x22EF;</mo><mo>,</mo><msub><mi>m</mi><mi>k</mi></msub></mrow><mo>]</mo></mrow></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1399\" style=\"width: 13.544em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 11.253em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.565em, 1011.15em, 2.815em, -999.997em); top: -2.393em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1400\"><span class=\"msubsup\" id=\"MathJax-Span-1401\"><span style=\"display: inline-block; position: relative; width: 2.19em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1001.57em, 4.378em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1402\" style=\"font-family: STIXGeneral-Regular;\">Top</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.747em; left: 1.617em;\"><span class=\"mi\" id=\"MathJax-Span-1403\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1404\"></span><span class=\"mo\" id=\"MathJax-Span-1405\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"texatom\" id=\"MathJax-Span-1406\"><span class=\"mrow\" id=\"MathJax-Span-1407\"><span class=\"mi\" id=\"MathJax-Span-1408\" style=\"font-family: STIXNonUnicode-Italic;\"></span></span></span><span class=\"mo\" id=\"MathJax-Span-1409\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">∣</span><span class=\"mi\" id=\"MathJax-Span-1410\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">q</span><span class=\"mo\" id=\"MathJax-Span-1411\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-1412\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mrow\" id=\"MathJax-Span-1413\" style=\"padding-left: 0.315em;\"><span class=\"mo\" id=\"MathJax-Span-1414\" style=\"vertical-align: 0.003em;\"><span style=\"font-family: STIXGeneral-Regular;\">[</span></span><span class=\"mrow\" id=\"MathJax-Span-1415\"><span class=\"msubsup\" id=\"MathJax-Span-1416\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.73em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1417\" style=\"font-family: STIXGeneral-Italic;\">m</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.732em;\"><span class=\"mn\" id=\"MathJax-Span-1418\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1419\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mo\" id=\"MathJax-Span-1420\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">⋯</span><span class=\"mo\" id=\"MathJax-Span-1421\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-1422\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.73em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1423\" style=\"font-family: STIXGeneral-Italic;\">m</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.732em;\"><span class=\"mi\" id=\"MathJax-Span-1424\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1425\" style=\"vertical-align: 0.003em;\"><span style=\"font-family: STIXGeneral-Regular;\">]</span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.398em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.253em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>Top</mi><mi>K</mi></msub><mo>⁡</mo><mo stretchy=\"false\">(</mo><mrow class=\"MJX-TeXAtom-ORD\"><mi class=\"MJX-tex-caligraphic\" mathvariant=\"script\">M</mi></mrow><mo>∣</mo><mi>q</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mrow><mo>[</mo><mrow><msub><mi>m</mi><mn>1</mn></msub><mo>,</mo><mo>⋯</mo><mo>,</mo><msub><mi>m</mi><mi>k</mi></msub></mrow><mo>]</mo></mrow></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-159\">\\operatorname{Top}_K(\\mathcal{M} \\mid q)=\\left[m_1, \\cdots, m_k\\right]</script>. Formally, we define <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-160-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>Top</mi><mi>K</mi></msub><mo>&amp;#x2061;</mo><mo stretchy=&quot;false&quot;>(</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;>M</mi></mrow><mo>&amp;#x2223;</mo><mi>q</mi><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1426\" style=\"width: 5.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 4.951em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1004.9em, 2.659em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1427\"><span class=\"msubsup\" id=\"MathJax-Span-1428\"><span style=\"display: inline-block; position: relative; width: 2.19em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1001.57em, 4.378em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1429\" style=\"font-family: STIXGeneral-Regular;\">Top</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.747em; left: 1.617em;\"><span class=\"mi\" id=\"MathJax-Span-1430\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1431\"></span><span class=\"mo\" id=\"MathJax-Span-1432\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"texatom\" id=\"MathJax-Span-1433\"><span class=\"mrow\" id=\"MathJax-Span-1434\"><span class=\"mi\" id=\"MathJax-Span-1435\" style=\"font-family: STIXNonUnicode-Italic;\"></span></span></span><span class=\"mo\" id=\"MathJax-Span-1436\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">∣</span><span class=\"mi\" id=\"MathJax-Span-1437\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">q</span><span class=\"mo\" id=\"MathJax-Span-1438\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.253em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>Top</mi><mi>K</mi></msub><mo>⁡</mo><mo stretchy=\"false\">(</mo><mrow class=\"MJX-TeXAtom-ORD\"><mi class=\"MJX-tex-caligraphic\" mathvariant=\"script\">M</mi></mrow><mo>∣</mo><mi>q</mi><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-160\">\\operatorname{Top}_K(\\mathcal{M} \\mid q)</script> as follows:</li>\n</ul>\n<div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-161-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><msub><mi>Top</mi><mi>K</mi></msub><mo>&amp;#x2061;</mo><mo stretchy=&quot;false&quot;>(</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;>M</mi></mrow><mo>&amp;#x2223;</mo><mi>q</mi><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><munder><mi>Top</mi><mrow><mi>m</mi><mo>&amp;#x2208;</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;>M</mi></mrow></mrow></munder><mspace width=&quot;1em&quot; /><msub><mi>f</mi><mi>&amp;#x03B8;</mi></msub><mo stretchy=&quot;false&quot;>(</mo><mi>q</mi><msub><mo stretchy=&quot;false&quot;>)</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>[</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi mathvariant=&quot;normal&quot;>C</mi><mi mathvariant=&quot;normal&quot;>L</mi><mi mathvariant=&quot;normal&quot;>S</mi></mrow><mo stretchy=&quot;false&quot;>]</mo></mrow></msub><mo>&amp;#x22C5;</mo><msub><mi>f</mi><mi>&amp;#x03B8;</mi></msub><mo stretchy=&quot;false&quot;>(</mo><mi>m</mi><msub><mo stretchy=&quot;false&quot;>)</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>[</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi mathvariant=&quot;normal&quot;>C</mi><mi mathvariant=&quot;normal&quot;>L</mi><mi mathvariant=&quot;normal&quot;>S</mi></mrow><mo stretchy=&quot;false&quot;>]</mo></mrow></msub></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1439\" style=\"width: 21.565em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 17.971em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1017.97em, 3.44em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1440\"><span class=\"msubsup\" id=\"MathJax-Span-1441\"><span style=\"display: inline-block; position: relative; width: 2.19em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1001.57em, 4.378em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1442\" style=\"font-family: STIXGeneral-Regular;\">Top</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.747em; left: 1.617em;\"><span class=\"mi\" id=\"MathJax-Span-1443\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1444\"></span><span class=\"mo\" id=\"MathJax-Span-1445\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"texatom\" id=\"MathJax-Span-1446\"><span class=\"mrow\" id=\"MathJax-Span-1447\"><span class=\"mi\" id=\"MathJax-Span-1448\" style=\"font-family: STIXNonUnicode-Italic;\"></span></span></span><span class=\"mo\" id=\"MathJax-Span-1449\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">∣</span><span class=\"mi\" id=\"MathJax-Span-1450\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">q</span><span class=\"mo\" id=\"MathJax-Span-1451\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-1452\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"munder\" id=\"MathJax-Span-1453\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 1.826em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1001.57em, 4.378em, -999.997em); top: -4.008em; left: 0.107em;\"><span class=\"mi\" id=\"MathJax-Span-1454\" style=\"font-family: STIXGeneral-Regular;\">Top</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1001.77em, 4.326em, -999.997em); top: -3.122em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1455\"><span class=\"mi\" id=\"MathJax-Span-1456\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">m</span><span class=\"mo\" id=\"MathJax-Span-1457\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">∈</span><span class=\"texatom\" id=\"MathJax-Span-1458\"><span class=\"mrow\" id=\"MathJax-Span-1459\"><span class=\"mi\" id=\"MathJax-Span-1460\" style=\"font-size: 70.7%; font-family: STIXNonUnicode-Italic;\"></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mspace\" id=\"MathJax-Span-1461\" style=\"height: 0em; vertical-align: 0em; width: 1.148em; display: inline-block; overflow: hidden;\"></span><span class=\"msubsup\" id=\"MathJax-Span-1462\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 0.68em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.378em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1463\" style=\"font-family: STIXGeneral-Italic;\">f<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.159em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.263em;\"><span class=\"mi\" id=\"MathJax-Span-1464\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">θ<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1465\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-1466\" style=\"font-family: STIXGeneral-Italic;\">q</span><span class=\"msubsup\" id=\"MathJax-Span-1467\"><span style=\"display: inline-block; position: relative; width: 2.19em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.26em, 4.326em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mo\" id=\"MathJax-Span-1468\" style=\"font-family: STIXGeneral-Regular;\">)</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.315em;\"><span class=\"texatom\" id=\"MathJax-Span-1469\"><span class=\"mrow\" id=\"MathJax-Span-1470\"><span class=\"mo\" id=\"MathJax-Span-1471\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">[</span><span class=\"texatom\" id=\"MathJax-Span-1472\"><span class=\"mrow\" id=\"MathJax-Span-1473\"><span class=\"mi\" id=\"MathJax-Span-1474\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">C</span><span class=\"mi\" id=\"MathJax-Span-1475\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">L</span><span class=\"mi\" id=\"MathJax-Span-1476\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">S</span></span></span><span class=\"mo\" id=\"MathJax-Span-1477\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">]</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1478\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"msubsup\" id=\"MathJax-Span-1479\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 0.68em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.378em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1480\" style=\"font-family: STIXGeneral-Italic;\">f<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.159em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.263em;\"><span class=\"mi\" id=\"MathJax-Span-1481\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">θ<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1482\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-1483\" style=\"font-family: STIXGeneral-Italic;\">m</span><span class=\"msubsup\" id=\"MathJax-Span-1484\"><span style=\"display: inline-block; position: relative; width: 2.19em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.26em, 4.326em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mo\" id=\"MathJax-Span-1485\" style=\"font-family: STIXGeneral-Regular;\">)</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.315em;\"><span class=\"texatom\" id=\"MathJax-Span-1486\"><span class=\"mrow\" id=\"MathJax-Span-1487\"><span class=\"mo\" id=\"MathJax-Span-1488\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">[</span><span class=\"texatom\" id=\"MathJax-Span-1489\"><span class=\"mrow\" id=\"MathJax-Span-1490\"><span class=\"mi\" id=\"MathJax-Span-1491\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">C</span><span class=\"mi\" id=\"MathJax-Span-1492\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">L</span><span class=\"mi\" id=\"MathJax-Span-1493\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">S</span></span></span><span class=\"mo\" id=\"MathJax-Span-1494\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">]</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -1.309em; border-left: 0px solid; width: 0px; height: 2.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><msub><mi>Top</mi><mi>K</mi></msub><mo>⁡</mo><mo stretchy=\"false\">(</mo><mrow class=\"MJX-TeXAtom-ORD\"><mi class=\"MJX-tex-caligraphic\" mathvariant=\"script\">M</mi></mrow><mo>∣</mo><mi>q</mi><mo stretchy=\"false\">)</mo><mo>=</mo><munder><mi>Top</mi><mrow><mi>m</mi><mo>∈</mo><mrow class=\"MJX-TeXAtom-ORD\"><mi class=\"MJX-tex-caligraphic\" mathvariant=\"script\">M</mi></mrow></mrow></munder><mspace width=\"1em\"></mspace><msub><mi>f</mi><mi>θ</mi></msub><mo stretchy=\"false\">(</mo><mi>q</mi><msub><mo stretchy=\"false\">)</mo><mrow class=\"MJX-TeXAtom-ORD\"><mo stretchy=\"false\">[</mo><mrow class=\"MJX-TeXAtom-ORD\"><mi mathvariant=\"normal\">C</mi><mi mathvariant=\"normal\">L</mi><mi mathvariant=\"normal\">S</mi></mrow><mo stretchy=\"false\">]</mo></mrow></msub><mo>⋅</mo><msub><mi>f</mi><mi>θ</mi></msub><mo stretchy=\"false\">(</mo><mi>m</mi><msub><mo stretchy=\"false\">)</mo><mrow class=\"MJX-TeXAtom-ORD\"><mo stretchy=\"false\">[</mo><mrow class=\"MJX-TeXAtom-ORD\"><mi mathvariant=\"normal\">C</mi><mi mathvariant=\"normal\">L</mi><mi mathvariant=\"normal\">S</mi></mrow><mo stretchy=\"false\">]</mo></mrow></msub></math></span></span></div>\n<ul>\n  <li>\n    <p>During the reader stage, the retrievals (the raw image patches) are combined with the query <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-162-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>q</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1495\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.555em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1496\"><span class=\"mi\" id=\"MathJax-Span-1497\" style=\"font-family: STIXGeneral-Italic;\">q</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.878em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>q</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-162\">q</script> as an augmented input <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-163-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mrow><mo>[</mo><mrow><msub><mi>m</mi><mn>1</mn></msub><mo>,</mo><mo>&amp;#x22EF;</mo><mo>,</mo><msub><mi>m</mi><mi>k</mi></msub><mo>,</mo><mi>q</mi></mrow><mo>]</mo></mrow></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1498\" style=\"width: 7.294em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 6.044em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.565em, 1005.94em, 2.763em, -999.997em); top: -2.393em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1499\"><span class=\"mrow\" id=\"MathJax-Span-1500\"><span class=\"mo\" id=\"MathJax-Span-1501\" style=\"vertical-align: 0.003em;\"><span style=\"font-family: STIXGeneral-Regular;\">[</span></span><span class=\"mrow\" id=\"MathJax-Span-1502\"><span class=\"msubsup\" id=\"MathJax-Span-1503\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.73em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1504\" style=\"font-family: STIXGeneral-Italic;\">m</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.732em;\"><span class=\"mn\" id=\"MathJax-Span-1505\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1506\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mo\" id=\"MathJax-Span-1507\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">⋯</span><span class=\"mo\" id=\"MathJax-Span-1508\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-1509\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.73em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1510\" style=\"font-family: STIXGeneral-Italic;\">m</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.732em;\"><span class=\"mi\" id=\"MathJax-Span-1511\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1512\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mi\" id=\"MathJax-Span-1513\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.211em;\">q</span></span><span class=\"mo\" id=\"MathJax-Span-1514\" style=\"vertical-align: 0.003em;\"><span style=\"font-family: STIXGeneral-Regular;\">]</span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.398em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mrow><mo>[</mo><mrow><msub><mi>m</mi><mn>1</mn></msub><mo>,</mo><mo>⋯</mo><mo>,</mo><msub><mi>m</mi><mi>k</mi></msub><mo>,</mo><mi>q</mi></mrow><mo>]</mo></mrow></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-163\">\\left[m_1, \\cdots, m_k, q\\right]</script>, which is fed to the backbone encoder <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-164-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>f</mi><mi>&amp;#x03B8;</mi></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1515\" style=\"width: 0.836em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.68em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1000.68em, 2.503em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1516\"><span class=\"msubsup\" id=\"MathJax-Span-1517\"><span style=\"display: inline-block; position: relative; width: 0.68em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.378em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1518\" style=\"font-family: STIXGeneral-Italic;\">f<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.159em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.263em;\"><span class=\"mi\" id=\"MathJax-Span-1519\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">θ<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>f</mi><mi>θ</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-164\">f_\\theta</script> to produce retrievalaugmented encoding. The decoder model <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-165-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>g</mi><mi>&amp;#x03B8;</mi></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1520\" style=\"width: 1.148em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.94em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.565em, 1000.94em, 2.503em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1521\"><span class=\"msubsup\" id=\"MathJax-Span-1522\"><span style=\"display: inline-block; position: relative; width: 0.94em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.378em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1523\" style=\"font-family: STIXGeneral-Italic;\">g</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"mi\" id=\"MathJax-Span-1524\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">θ<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.878em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>g</mi><mi>θ</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-165\">g_\\theta</script> uses attention over this representation to generate textual outputs <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-166-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi mathvariant=&quot;bold&quot;>y</mi></mrow><mo>=</mo><msub><mi>y</mi><mn>1</mn></msub><mo>,</mo><mo>&amp;#x22EF;</mo><mo>,</mo><msub><mi>y</mi><mi>n</mi></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1525\" style=\"width: 6.773em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 5.628em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.878em, 1005.63em, 2.867em, -999.997em); top: -2.497em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1526\"><span class=\"texatom\" id=\"MathJax-Span-1527\"><span class=\"mrow\" id=\"MathJax-Span-1528\"><span class=\"mi\" id=\"MathJax-Span-1529\" style=\"font-family: STIXGeneral; font-weight: bold;\">y</span></span></span><span class=\"mo\" id=\"MathJax-Span-1530\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"msubsup\" id=\"MathJax-Span-1531\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 0.888em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.42em, 4.378em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1532\" style=\"font-family: STIXGeneral-Italic;\">y</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"mn\" id=\"MathJax-Span-1533\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1534\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mo\" id=\"MathJax-Span-1535\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">⋯</span><span class=\"mo\" id=\"MathJax-Span-1536\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-1537\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 0.888em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.42em, 4.378em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1538\" style=\"font-family: STIXGeneral-Italic;\">y</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"mi\" id=\"MathJax-Span-1539\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">n</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.503em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mrow class=\"MJX-TeXAtom-ORD\"><mi mathvariant=\"bold\">y</mi></mrow><mo>=</mo><msub><mi>y</mi><mn>1</mn></msub><mo>,</mo><mo>⋯</mo><mo>,</mo><msub><mi>y</mi><mi>n</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-166\">\\mathbf{y}=y_1, \\cdots, y_n</script> token by token.</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-167-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>p</mi><mrow><mo>(</mo><mrow><msub><mi>y</mi><mi>i</mi></msub><mo>&amp;#x2223;</mo><msub><mi>y</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mo>&amp;#x2212;</mo><mn>1</mn></mrow></msub></mrow><mo>)</mo></mrow><mo>=</mo><msub><mi>g</mi><mi>&amp;#x03B8;</mi></msub><mrow><mo>(</mo><mrow><msub><mi>y</mi><mi>i</mi></msub><mo>&amp;#x2223;</mo><msub><mi>f</mi><mi>&amp;#x03B8;</mi></msub><mrow><mo>(</mo><mrow><msub><mi>Top</mi><mi>K</mi></msub><mo>&amp;#x2061;</mo><mo stretchy=&quot;false&quot;>(</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;>M</mi></mrow><mo>&amp;#x2223;</mo><mi>q</mi><mo stretchy=&quot;false&quot;>)</mo><mo>;</mo><mi>q</mi></mrow><mo>)</mo></mrow><mo>;</mo><msub><mi>y</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>1</mn><mo>:</mo><mi>i</mi><mo>&amp;#x2212;</mo><mn>1</mn></mrow></msub></mrow><mo>)</mo></mrow></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1540\" style=\"width: 24.326em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 20.263em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.878em, 1020.11em, 3.44em, -999.997em); top: -2.914em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1541\"><span class=\"mi\" id=\"MathJax-Span-1542\" style=\"font-family: STIXGeneral-Italic;\">p</span><span class=\"mrow\" id=\"MathJax-Span-1543\" style=\"padding-left: 0.211em;\"><span class=\"mo\" id=\"MathJax-Span-1544\" style=\"vertical-align: -0.206em;\"><span style=\"font-family: STIXSizeOneSym;\">(</span></span><span class=\"mrow\" id=\"MathJax-Span-1545\"><span class=\"msubsup\" id=\"MathJax-Span-1546\"><span style=\"display: inline-block; position: relative; width: 0.732em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.42em, 4.378em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1547\" style=\"font-family: STIXGeneral-Italic;\">y</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"mi\" id=\"MathJax-Span-1548\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1549\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">∣</span><span class=\"msubsup\" id=\"MathJax-Span-1550\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 1.565em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.42em, 4.378em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1551\" style=\"font-family: STIXGeneral-Italic;\">y</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"texatom\" id=\"MathJax-Span-1552\"><span class=\"mrow\" id=\"MathJax-Span-1553\"><span class=\"mi\" id=\"MathJax-Span-1554\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">i</span><span class=\"mo\" id=\"MathJax-Span-1555\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">−</span><span class=\"mn\" id=\"MathJax-Span-1556\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1557\" style=\"vertical-align: -0.206em;\"><span style=\"font-family: STIXSizeOneSym;\">)</span></span></span><span class=\"mo\" id=\"MathJax-Span-1558\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"msubsup\" id=\"MathJax-Span-1559\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 0.94em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.378em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1560\" style=\"font-family: STIXGeneral-Italic;\">g</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"mi\" id=\"MathJax-Span-1561\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">θ<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mrow\" id=\"MathJax-Span-1562\" style=\"padding-left: 0.211em;\"><span class=\"mo\" id=\"MathJax-Span-1563\" style=\"vertical-align: -0.206em;\"><span style=\"font-family: STIXSizeOneSym;\">(</span></span><span class=\"mrow\" id=\"MathJax-Span-1564\"><span class=\"msubsup\" id=\"MathJax-Span-1565\"><span style=\"display: inline-block; position: relative; width: 0.732em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.42em, 4.378em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1566\" style=\"font-family: STIXGeneral-Italic;\">y</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"mi\" id=\"MathJax-Span-1567\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1568\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">∣</span><span class=\"msubsup\" id=\"MathJax-Span-1569\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 0.68em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.378em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1570\" style=\"font-family: STIXGeneral-Italic;\">f<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.159em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.263em;\"><span class=\"mi\" id=\"MathJax-Span-1571\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">θ<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mrow\" id=\"MathJax-Span-1572\" style=\"padding-left: 0.211em;\"><span class=\"mo\" id=\"MathJax-Span-1573\" style=\"vertical-align: -0.206em;\"><span style=\"font-family: STIXSizeOneSym;\">(</span></span><span class=\"mrow\" id=\"MathJax-Span-1574\"><span class=\"msubsup\" id=\"MathJax-Span-1575\"><span style=\"display: inline-block; position: relative; width: 2.19em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1001.57em, 4.378em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1576\" style=\"font-family: STIXGeneral-Regular;\">Top</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.747em; left: 1.617em;\"><span class=\"mi\" id=\"MathJax-Span-1577\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1578\"></span><span class=\"mo\" id=\"MathJax-Span-1579\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"texatom\" id=\"MathJax-Span-1580\"><span class=\"mrow\" id=\"MathJax-Span-1581\"><span class=\"mi\" id=\"MathJax-Span-1582\" style=\"font-family: STIXNonUnicode-Italic;\"></span></span></span><span class=\"mo\" id=\"MathJax-Span-1583\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">∣</span><span class=\"mi\" id=\"MathJax-Span-1584\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">q</span><span class=\"mo\" id=\"MathJax-Span-1585\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-1586\" style=\"font-family: STIXGeneral-Regular;\">;</span><span class=\"mi\" id=\"MathJax-Span-1587\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.211em;\">q</span></span><span class=\"mo\" id=\"MathJax-Span-1588\" style=\"vertical-align: -0.206em;\"><span style=\"font-family: STIXSizeOneSym;\">)</span></span></span><span class=\"mo\" id=\"MathJax-Span-1589\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">;</span><span class=\"msubsup\" id=\"MathJax-Span-1590\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 2.086em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.42em, 4.378em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1591\" style=\"font-family: STIXGeneral-Italic;\">y</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"texatom\" id=\"MathJax-Span-1592\"><span class=\"mrow\" id=\"MathJax-Span-1593\"><span class=\"mn\" id=\"MathJax-Span-1594\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span><span class=\"mo\" id=\"MathJax-Span-1595\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">:</span><span class=\"mi\" id=\"MathJax-Span-1596\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">i</span><span class=\"mo\" id=\"MathJax-Span-1597\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">−</span><span class=\"mn\" id=\"MathJax-Span-1598\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1599\" style=\"vertical-align: -0.206em;\"><span style=\"font-family: STIXSizeOneSym;\">)</span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.919em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.497em; border-left: 0px solid; width: 0px; height: 1.628em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mi>p</mi><mrow><mo>(</mo><mrow><msub><mi>y</mi><mi>i</mi></msub><mo>∣</mo><msub><mi>y</mi><mrow class=\"MJX-TeXAtom-ORD\"><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow><mo>)</mo></mrow><mo>=</mo><msub><mi>g</mi><mi>θ</mi></msub><mrow><mo>(</mo><mrow><msub><mi>y</mi><mi>i</mi></msub><mo>∣</mo><msub><mi>f</mi><mi>θ</mi></msub><mrow><mo>(</mo><mrow><msub><mi>Top</mi><mi>K</mi></msub><mo>⁡</mo><mo stretchy=\"false\">(</mo><mrow class=\"MJX-TeXAtom-ORD\"><mi class=\"MJX-tex-caligraphic\" mathvariant=\"script\">M</mi></mrow><mo>∣</mo><mi>q</mi><mo stretchy=\"false\">)</mo><mo>;</mo><mi>q</mi></mrow><mo>)</mo></mrow><mo>;</mo><msub><mi>y</mi><mrow class=\"MJX-TeXAtom-ORD\"><mn>1</mn><mo>:</mo><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow><mo>)</mo></mrow></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-167\">p\\left(y_i \\mid y_{i-1}\\right)=g_\\theta\\left(y_i \\mid f_\\theta\\left(\\operatorname{Top}_K(\\mathcal{M} \\mid q) ; q\\right) ; y_{1: i-1}\\right)</script>\n\n    <ul>\n      <li>where <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-168-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>y</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1600\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.555em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1601\"><span class=\"mi\" id=\"MathJax-Span-1602\" style=\"font-family: STIXGeneral-Italic;\">y</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.878em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>y</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-168\">y</script> is decoded from a given vocabulary <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-169-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;>V</mi></mrow></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1603\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.398em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1604\"><span class=\"texatom\" id=\"MathJax-Span-1605\"><span class=\"mrow\" id=\"MathJax-Span-1606\"><span class=\"mi\" id=\"MathJax-Span-1607\" style=\"font-family: STIXNonUnicode-Italic;\"><span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.122em; border-left: 0px solid; width: 0px; height: 1.003em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mrow class=\"MJX-TeXAtom-ORD\"><mi class=\"MJX-tex-caligraphic\" mathvariant=\"script\">V</mi></mrow></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-169\">\\mathcal{V}</script>.</li>\n    </ul>\n  </li>\n  <li>\n    <p>The figure below from the original paper <a href=\"https://arxiv.org/abs/2210.02928\">(source)</a> shows how the model taps into an external repository to retrieve a diverse range of knowledge encapsulated within both images and textual fragments. This multimodal information is then employed to enhance the generative process. The upper section outlines the setup for the pre-training phase, whereas the lower section specifies the framework for the fine-tuning phase.</p>\n  </li>\n</ul>\n<p>During the reader stage, the retrievals (the raw image patches) are combined with the query <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-162-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>q</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1495\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.555em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1496\"><span class=\"mi\" id=\"MathJax-Span-1497\" style=\"font-family: STIXGeneral-Italic;\">q</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.878em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>q</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-162\">q</script> as an augmented input <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-163-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mrow><mo>[</mo><mrow><msub><mi>m</mi><mn>1</mn></msub><mo>,</mo><mo>&amp;#x22EF;</mo><mo>,</mo><msub><mi>m</mi><mi>k</mi></msub><mo>,</mo><mi>q</mi></mrow><mo>]</mo></mrow></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1498\" style=\"width: 7.294em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 6.044em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.565em, 1005.94em, 2.763em, -999.997em); top: -2.393em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1499\"><span class=\"mrow\" id=\"MathJax-Span-1500\"><span class=\"mo\" id=\"MathJax-Span-1501\" style=\"vertical-align: 0.003em;\"><span style=\"font-family: STIXGeneral-Regular;\">[</span></span><span class=\"mrow\" id=\"MathJax-Span-1502\"><span class=\"msubsup\" id=\"MathJax-Span-1503\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.73em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1504\" style=\"font-family: STIXGeneral-Italic;\">m</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.732em;\"><span class=\"mn\" id=\"MathJax-Span-1505\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1506\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mo\" id=\"MathJax-Span-1507\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">⋯</span><span class=\"mo\" id=\"MathJax-Span-1508\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-1509\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.73em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1510\" style=\"font-family: STIXGeneral-Italic;\">m</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.732em;\"><span class=\"mi\" id=\"MathJax-Span-1511\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1512\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mi\" id=\"MathJax-Span-1513\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.211em;\">q</span></span><span class=\"mo\" id=\"MathJax-Span-1514\" style=\"vertical-align: 0.003em;\"><span style=\"font-family: STIXGeneral-Regular;\">]</span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.398em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mrow><mo>[</mo><mrow><msub><mi>m</mi><mn>1</mn></msub><mo>,</mo><mo>⋯</mo><mo>,</mo><msub><mi>m</mi><mi>k</mi></msub><mo>,</mo><mi>q</mi></mrow><mo>]</mo></mrow></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-163\">\\left[m_1, \\cdots, m_k, q\\right]</script>, which is fed to the backbone encoder <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-164-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>f</mi><mi>&amp;#x03B8;</mi></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1515\" style=\"width: 0.836em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.68em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1000.68em, 2.503em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1516\"><span class=\"msubsup\" id=\"MathJax-Span-1517\"><span style=\"display: inline-block; position: relative; width: 0.68em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.42em, 4.378em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1518\" style=\"font-family: STIXGeneral-Italic;\">f<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.159em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.263em;\"><span class=\"mi\" id=\"MathJax-Span-1519\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">θ<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>f</mi><mi>θ</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-164\">f_\\theta</script> to produce retrievalaugmented encoding. The decoder model <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-165-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>g</mi><mi>&amp;#x03B8;</mi></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1520\" style=\"width: 1.148em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.94em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.565em, 1000.94em, 2.503em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1521\"><span class=\"msubsup\" id=\"MathJax-Span-1522\"><span style=\"display: inline-block; position: relative; width: 0.94em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.378em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1523\" style=\"font-family: STIXGeneral-Italic;\">g</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"mi\" id=\"MathJax-Span-1524\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">θ<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.878em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>g</mi><mi>θ</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-165\">g_\\theta</script> uses attention over this representation to generate textual outputs <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-166-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi mathvariant=&quot;bold&quot;>y</mi></mrow><mo>=</mo><msub><mi>y</mi><mn>1</mn></msub><mo>,</mo><mo>&amp;#x22EF;</mo><mo>,</mo><msub><mi>y</mi><mi>n</mi></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1525\" style=\"width: 6.773em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 5.628em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.878em, 1005.63em, 2.867em, -999.997em); top: -2.497em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1526\"><span class=\"texatom\" id=\"MathJax-Span-1527\"><span class=\"mrow\" id=\"MathJax-Span-1528\"><span class=\"mi\" id=\"MathJax-Span-1529\" style=\"font-family: STIXGeneral; font-weight: bold;\">y</span></span></span><span class=\"mo\" id=\"MathJax-Span-1530\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"msubsup\" id=\"MathJax-Span-1531\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 0.888em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.42em, 4.378em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1532\" style=\"font-family: STIXGeneral-Italic;\">y</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"mn\" id=\"MathJax-Span-1533\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1534\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mo\" id=\"MathJax-Span-1535\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">⋯</span><span class=\"mo\" id=\"MathJax-Span-1536\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-1537\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 0.888em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.42em, 4.378em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1538\" style=\"font-family: STIXGeneral-Italic;\">y</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"mi\" id=\"MathJax-Span-1539\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">n</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.503em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mrow class=\"MJX-TeXAtom-ORD\"><mi mathvariant=\"bold\">y</mi></mrow><mo>=</mo><msub><mi>y</mi><mn>1</mn></msub><mo>,</mo><mo>⋯</mo><mo>,</mo><msub><mi>y</mi><mi>n</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-166\">\\mathbf{y}=y_1, \\cdots, y_n</script> token by token.</p>\n<ul>\n      <li>where <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-168-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>y</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1600\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.555em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1601\"><span class=\"mi\" id=\"MathJax-Span-1602\" style=\"font-family: STIXGeneral-Italic;\">y</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.878em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>y</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-168\">y</script> is decoded from a given vocabulary <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-169-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;>V</mi></mrow></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1603\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.398em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1604\"><span class=\"texatom\" id=\"MathJax-Span-1605\"><span class=\"mrow\" id=\"MathJax-Span-1606\"><span class=\"mi\" id=\"MathJax-Span-1607\" style=\"font-family: STIXNonUnicode-Italic;\"><span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.122em; border-left: 0px solid; width: 0px; height: 1.003em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mrow class=\"MJX-TeXAtom-ORD\"><mi class=\"MJX-tex-caligraphic\" mathvariant=\"script\">V</mi></mrow></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-169\">\\mathcal{V}</script>.</li>\n    </ul>\n<p>The figure below from the original paper <a href=\"https://arxiv.org/abs/2210.02928\">(source)</a> shows how the model taps into an external repository to retrieve a diverse range of knowledge encapsulated within both images and textual fragments. This multimodal information is then employed to enhance the generative process. The upper section outlines the setup for the pre-training phase, whereas the lower section specifies the framework for the fine-tuning phase.</p>\n<p><img src=\"../../../images/papers/MuRAG.jpg\" alt=\"\"></p>\n<ul>\n  <li>The process can be summarized as follows:\n    <ul>\n      <li>For retrieval, MuRAG uses maximum inner product search to find the top-<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-170-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1608\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1609\"><span class=\"mi\" id=\"MathJax-Span-1610\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-170\">k</script> most relevant image-text pairs from the memory given a question. The “memory” here refers to the external knowledge base that the model can retrieve information from. Specifically, the memory contains a large collection of image-text pairs that are encoded offline by the backbone encoder prior to training.</li>\n      <li>During training and inference, given a question, MuRAG’s retriever module will search through this memory to find the most relevant image-text pairs using maximum inner product search.</li>\n      <li>The memory serves as the knowledge source and can contain various types of multimodal data like images with captions, passages of text, tables, etc. that are related to the downstream task.</li>\n      <li>For example, when fine-tuning on the WebQA dataset, the memory contains 1.1 million image-text pairs extracted from Wikipedia that the model can retrieve from to answer questions.</li>\n      <li>So in summary, the memory is the large non-parametric external knowledge base encoded in a multimodal space that MuRAG learns to retrieve relevant knowledge from given a question, in order to augment its language generation capabilities. The memory provides the world knowledge to complement what is stored implicitly in the model’s parameters.</li>\n      <li>For reading, the retrieved multimodal context is combined with the question embedding and fed into the decoder to generate an answer.</li>\n    </ul>\n  </li>\n  <li>MuRAG achieves state-of-the-art results on two multimodal QA datasets - WebQA and MultimodalQA, outperforming text-only methods by 10-20% accuracy. It demonstrates the value of incorporating both visual and textual knowledge.</li>\n  <li>Key limitations are the reliance on large-scale pre-training data, computational costs, and issues in visual reasoning like counting objects. But overall, MuRAG represents an important advance in building visually-grounded language models.</li>\n</ul>\n<ul>\n      <li>For retrieval, MuRAG uses maximum inner product search to find the top-<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-170-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1608\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1609\"><span class=\"mi\" id=\"MathJax-Span-1610\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-170\">k</script> most relevant image-text pairs from the memory given a question. The “memory” here refers to the external knowledge base that the model can retrieve information from. Specifically, the memory contains a large collection of image-text pairs that are encoded offline by the backbone encoder prior to training.</li>\n      <li>During training and inference, given a question, MuRAG’s retriever module will search through this memory to find the most relevant image-text pairs using maximum inner product search.</li>\n      <li>The memory serves as the knowledge source and can contain various types of multimodal data like images with captions, passages of text, tables, etc. that are related to the downstream task.</li>\n      <li>For example, when fine-tuning on the WebQA dataset, the memory contains 1.1 million image-text pairs extracted from Wikipedia that the model can retrieve from to answer questions.</li>\n      <li>So in summary, the memory is the large non-parametric external knowledge base encoded in a multimodal space that MuRAG learns to retrieve relevant knowledge from given a question, in order to augment its language generation capabilities. The memory provides the world knowledge to complement what is stored implicitly in the model’s parameters.</li>\n      <li>For reading, the retrieved multimodal context is combined with the question embedding and fed into the decoder to generate an answer.</li>\n    </ul>",
    "contentMarkdown": "*   This paper by Chen et al. from Google Research proposes Multimodal Retrieval-Augmented Transformer (MuRAG), which looks to extend the retrieval process beyond text to include other modalities like images or structured data, which can then be used alongside textual information to inform the generation process.\n*   MuRAG’s magic lies in its two-phase training approach: pre-training and fine-tuning, each carefully crafted to build the model’s ability to tap into a vast expanse of multimodal knowledge.\n*   The key goal of MuRAG is to incorporate both visual and textual knowledge into language models to improve their capability for multimodal question answering.\n*   MuRAG is distinct in its ability to access an external non-parametric multimodal memory (images and texts) to enhance language generation, addressing the limitations of text-only retrieval in previous models.\n*   MuRAG has a dual-encoder architecture combines pre-trained visual transformer (ViT) and a text encoder (T5) models to create a backbone encoder, enabling the encoding of image-text pairs, image-only, and text-only inputs into a unified/joint multimodal representation.\n*   MuRAG is pre-trained on a mixture of image-text data (LAION, Conceptual Captions) and text-only data (PAQ, VQA). It uses a contrastive loss for retrieving relevant knowledge and a generation loss for answer prediction. It employs a two-stage training pipeline: initial training with small in-batch memory followed by training with a large global memory.\n*   During the retriever stage, MuRAG takes a query qqq of any modality as input and retrieves from a memory M\\\\mathcal{M} of image-text pairs. Specifically, we apply the backbone encoder fθfθf\\_\\\\theta to encode a query qqq, and use maximum inner product search (MIPS) over all of the memory candidates m∈m∈Mm \\\\in \\\\mathcal{M} to find the top-kkk nearest neighbors TopK(∣q)\\=\\[m1,⋯,mk\\]TopK⁡(M∣q)\\=\\[m1,⋯,mk\\]\\\\operatorname{Top}\\_K(\\\\mathcal{M} \\\\mid q)=\\\\left\\[m\\_1, \\\\cdots, m\\_k\\\\right\\]. Formally, we define TopK(∣q)TopK⁡(M∣q)\\\\operatorname{Top}\\_K(\\\\mathcal{M} \\\\mid q) as follows:\n\nTopK(∣q)\\=Topm∈fθ(q)\\[CLS\\]⋅fθ(m)\\[CLS\\]TopK⁡(M∣q)\\=Topm∈Mfθ(q)\\[CLS\\]⋅fθ(m)\\[CLS\\]\n\n*   During the reader stage, the retrievals (the raw image patches) are combined with the query qqq as an augmented input \\[m1,⋯,mk,q\\]\\[m1,⋯,mk,q\\]\\\\left\\[m\\_1, \\\\cdots, m\\_k, q\\\\right\\], which is fed to the backbone encoder fθfθf\\_\\\\theta to produce retrievalaugmented encoding. The decoder model gθgθg\\_\\\\theta uses attention over this representation to generate textual outputs y\\=y1,⋯,yny\\=y1,⋯,yn\\\\mathbf{y}=y\\_1, \\\\cdots, y\\_n token by token.\n    \n    p(yi∣yi−1)\\=gθ(yi∣fθ(TopK(∣q);q);y1:i−1)p(yi∣yi−1)\\=gθ(yi∣fθ(TopK⁡(M∣q);q);y1:i−1)\n    \n    p\\\\left(y\\_i \\\\mid y\\_{i-1}\\\\right)=g\\_\\\\theta\\\\left(y\\_i \\\\mid f\\_\\\\theta\\\\left(\\\\operatorname{Top}\\_K(\\\\mathcal{M} \\\\mid q) ; q\\\\right) ; y\\_{1: i-1}\\\\right)\n    *   where yyy is decoded from a given vocabulary V\\\\mathcal{V}.\n*   The figure below from the original paper [(source)](https://arxiv.org/abs/2210.02928) shows how the model taps into an external repository to retrieve a diverse range of knowledge encapsulated within both images and textual fragments. This multimodal information is then employed to enhance the generative process. The upper section outlines the setup for the pre-training phase, whereas the lower section specifies the framework for the fine-tuning phase.\n    \n\nDuring the reader stage, the retrievals (the raw image patches) are combined with the query qqq as an augmented input \\[m1,⋯,mk,q\\]\\[m1,⋯,mk,q\\]\\\\left\\[m\\_1, \\\\cdots, m\\_k, q\\\\right\\], which is fed to the backbone encoder fθfθf\\_\\\\theta to produce retrievalaugmented encoding. The decoder model gθgθg\\_\\\\theta uses attention over this representation to generate textual outputs y\\=y1,⋯,yny\\=y1,⋯,yn\\\\mathbf{y}=y\\_1, \\\\cdots, y\\_n token by token.\n\n*   where yyy is decoded from a given vocabulary V\\\\mathcal{V}.\n\nThe figure below from the original paper [(source)](https://arxiv.org/abs/2210.02928) shows how the model taps into an external repository to retrieve a diverse range of knowledge encapsulated within both images and textual fragments. This multimodal information is then employed to enhance the generative process. The upper section outlines the setup for the pre-training phase, whereas the lower section specifies the framework for the fine-tuning phase.\n\n![](../../../images/papers/MuRAG.jpg)\n\n*   The process can be summarized as follows:\n    *   For retrieval, MuRAG uses maximum inner product search to find the top-kkk most relevant image-text pairs from the memory given a question. The “memory” here refers to the external knowledge base that the model can retrieve information from. Specifically, the memory contains a large collection of image-text pairs that are encoded offline by the backbone encoder prior to training.\n    *   During training and inference, given a question, MuRAG’s retriever module will search through this memory to find the most relevant image-text pairs using maximum inner product search.\n    *   The memory serves as the knowledge source and can contain various types of multimodal data like images with captions, passages of text, tables, etc. that are related to the downstream task.\n    *   For example, when fine-tuning on the WebQA dataset, the memory contains 1.1 million image-text pairs extracted from Wikipedia that the model can retrieve from to answer questions.\n    *   So in summary, the memory is the large non-parametric external knowledge base encoded in a multimodal space that MuRAG learns to retrieve relevant knowledge from given a question, in order to augment its language generation capabilities. The memory provides the world knowledge to complement what is stored implicitly in the model’s parameters.\n    *   For reading, the retrieved multimodal context is combined with the question embedding and fed into the decoder to generate an answer.\n*   MuRAG achieves state-of-the-art results on two multimodal QA datasets - WebQA and MultimodalQA, outperforming text-only methods by 10-20% accuracy. It demonstrates the value of incorporating both visual and textual knowledge.\n*   Key limitations are the reliance on large-scale pre-training data, computational costs, and issues in visual reasoning like counting objects. But overall, MuRAG represents an important advance in building visually-grounded language models.\n\n*   For retrieval, MuRAG uses maximum inner product search to find the top-kkk most relevant image-text pairs from the memory given a question. The “memory” here refers to the external knowledge base that the model can retrieve information from. Specifically, the memory contains a large collection of image-text pairs that are encoded offline by the backbone encoder prior to training.\n*   During training and inference, given a question, MuRAG’s retriever module will search through this memory to find the most relevant image-text pairs using maximum inner product search.\n*   The memory serves as the knowledge source and can contain various types of multimodal data like images with captions, passages of text, tables, etc. that are related to the downstream task.\n*   For example, when fine-tuning on the WebQA dataset, the memory contains 1.1 million image-text pairs extracted from Wikipedia that the model can retrieve from to answer questions.\n*   So in summary, the memory is the large non-parametric external knowledge base encoded in a multimodal space that MuRAG learns to retrieve relevant knowledge from given a question, in order to augment its language generation capabilities. The memory provides the world knowledge to complement what is stored implicitly in the model’s parameters.\n*   For reading, the retrieved multimodal context is combined with the question embedding and fed into the decoder to generate an answer.",
    "order": 36,
    "orderInChapter": 3,
    "difficulty": 5,
    "estimatedMinutes": 6,
    "tags": [
      "nlpllms",
      "transformer",
      "attention",
      "embedding",
      "fine-tuning"
    ],
    "metadata": {
      "hasCode": false,
      "hasMath": true,
      "hasImages": true,
      "wordCount": 1082,
      "contentLength": 80987
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#murag:-multimodal-retrieval-augmented-generator",
    "scrapedAt": "2025-12-28T11:54:28.279Z"
  },
  {
    "id": "ai-RAG-hypothetical-document-embeddings-hyde-37",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "Selected Papers",
    "title": "Hypothetical Document Embeddings (HyDE)",
    "subtitle": "Selected Papers",
    "contentHtml": "<ul>\n  <li>Published in <a href=\"https://arxiv.org/abs/2212.10496\">Precise Zero-Shot Dense Retrieval without Relevance Labels</a> by Gao et al. from CMU and University of Waterloo, proposes an innovative approach called Hypothetical Document Embeddings (HyDE) for effective zero-shot dense retrieval in the absence of relevance labels. HyDE leverages an instruction-following language model, such as InstructGPT, to generate a hypothetical document that captures relevance patterns, although it may contain factual inaccuracies. An unsupervised contrastive encoder, like Contriever, then encodes this document into an embedding vector to identify similar real documents in the corpus embedding space, effectively filtering out incorrect details.</li>\n  <li>The implementation of HyDE combines InstructGPT (a GPT-3 model) and Contriever models, utilizing OpenAI playground’s default temperature setting for generation. For English retrieval tasks, the English-only Contriever model was used, while for non-English tasks, the multilingual mContriever was employed.</li>\n  <li>The following image from the paper illustrates the HyDE model. Documents snippets are shown. HyDE serves all types of queries without changing the underlying GPT-3 and Contriever/mContriever models.</li>\n</ul>\n<p><img src=\"../../../images/papers/HyDE.jpg\" alt=\"\"></p>\n<ul>\n  <li>Experiments were conducted using the Pyserini toolkit. The results demonstrate HyDE’s significant improvement over the state-of-the-art unsupervised dense retriever Contriever, with strong performance comparable to fine-tuned retrievers across various tasks and languages. Specifically, in web search and low-resource tasks, HyDE showed sizable improvements in precision and recall-oriented metrics. It remained competitive even compared to fine-tuned models, particularly in terms of recall. In multilingual retrieval, HyDE improved the mContriever model and outperformed non-Contriever models fine-tuned on MS-MARCO. However, there were some performance gaps with fine-tuned mContrieverFT, likely due to under-training in non-English languages.</li>\n  <li>Further analysis explored the effects of using different generative models and fine-tuned encoders with HyDE. Larger language models brought greater improvements, and the use of fine-tuned encoders with HyDE showed that less powerful instruction language models could impact the performance of the fine-tuned retriever.</li>\n  <li>One possible pitfall of HyDE is that it can potentially “hallucinate” in the sense that it generates hypothetical documents that may contain invented or inaccurate details. This phenomenon occurs because HyDE uses an instruction-following language model, like InstructGPT, to generate a document based on a query. The generated document is intended to capture the relevance patterns of the query, but since it’s created without direct reference to real-world data, it can include false or fictional information. This aspect of HyDE is a trade-off for its ability to operate in zero-shot retrieval scenarios, where it creates a contextually relevant but not necessarily factually accurate document to guide the retrieval process.</li>\n  <li>In conclusion, the paper introduces a new paradigm of interaction between language models and dense encoders/retrievers, showing that relevance modeling and instruction understanding can be effectively handled by a powerful and flexible language model. This approach eliminates the need for relevance labels, offering practical utility in the initial stages of a search system’s life, and paving the way for further advancements in tasks like multi-hop retrieval/QA and conversational search.</li>\n</ul>",
    "contentMarkdown": "*   Published in [Precise Zero-Shot Dense Retrieval without Relevance Labels](https://arxiv.org/abs/2212.10496) by Gao et al. from CMU and University of Waterloo, proposes an innovative approach called Hypothetical Document Embeddings (HyDE) for effective zero-shot dense retrieval in the absence of relevance labels. HyDE leverages an instruction-following language model, such as InstructGPT, to generate a hypothetical document that captures relevance patterns, although it may contain factual inaccuracies. An unsupervised contrastive encoder, like Contriever, then encodes this document into an embedding vector to identify similar real documents in the corpus embedding space, effectively filtering out incorrect details.\n*   The implementation of HyDE combines InstructGPT (a GPT-3 model) and Contriever models, utilizing OpenAI playground’s default temperature setting for generation. For English retrieval tasks, the English-only Contriever model was used, while for non-English tasks, the multilingual mContriever was employed.\n*   The following image from the paper illustrates the HyDE model. Documents snippets are shown. HyDE serves all types of queries without changing the underlying GPT-3 and Contriever/mContriever models.\n\n![](../../../images/papers/HyDE.jpg)\n\n*   Experiments were conducted using the Pyserini toolkit. The results demonstrate HyDE’s significant improvement over the state-of-the-art unsupervised dense retriever Contriever, with strong performance comparable to fine-tuned retrievers across various tasks and languages. Specifically, in web search and low-resource tasks, HyDE showed sizable improvements in precision and recall-oriented metrics. It remained competitive even compared to fine-tuned models, particularly in terms of recall. In multilingual retrieval, HyDE improved the mContriever model and outperformed non-Contriever models fine-tuned on MS-MARCO. However, there were some performance gaps with fine-tuned mContrieverFT, likely due to under-training in non-English languages.\n*   Further analysis explored the effects of using different generative models and fine-tuned encoders with HyDE. Larger language models brought greater improvements, and the use of fine-tuned encoders with HyDE showed that less powerful instruction language models could impact the performance of the fine-tuned retriever.\n*   One possible pitfall of HyDE is that it can potentially “hallucinate” in the sense that it generates hypothetical documents that may contain invented or inaccurate details. This phenomenon occurs because HyDE uses an instruction-following language model, like InstructGPT, to generate a document based on a query. The generated document is intended to capture the relevance patterns of the query, but since it’s created without direct reference to real-world data, it can include false or fictional information. This aspect of HyDE is a trade-off for its ability to operate in zero-shot retrieval scenarios, where it creates a contextually relevant but not necessarily factually accurate document to guide the retrieval process.\n*   In conclusion, the paper introduces a new paradigm of interaction between language models and dense encoders/retrievers, showing that relevance modeling and instruction understanding can be effectively handled by a powerful and flexible language model. This approach eliminates the need for relevance labels, offering practical utility in the initial stages of a search system’s life, and paving the way for further advancements in tasks like multi-hop retrieval/QA and conversational search.",
    "order": 37,
    "orderInChapter": 4,
    "difficulty": 4,
    "estimatedMinutes": 3,
    "tags": [
      "nlpllms",
      "embedding",
      "gpt"
    ],
    "metadata": {
      "hasCode": false,
      "hasMath": false,
      "hasImages": true,
      "wordCount": 481,
      "contentLength": 3685
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#hypothetical-document-embeddings-(hyde)",
    "scrapedAt": "2025-12-28T11:54:28.279Z"
  },
  {
    "id": "ai-RAG-ragas-automated-evaluation-of-retrieval-augmented--38",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "Selected Papers",
    "title": "RAGAS: Automated Evaluation of Retrieval Augmented Generation",
    "subtitle": "Selected Papers",
    "contentHtml": "<ul>\n  <li>This paper by Es et al. from Exploding Gradients, Cardiff University, and AMPLYFI introduces RAGAS, a framework for reference-free evaluation of Retrieval Augmented Generation (RAG) systems.</li>\n  <li>RAGAS focuses on evaluating the performance of RAG systems in dimensions such as the effectiveness of the retrieval system in providing relevant context, the LLM’s ability to utilize this context, and the overall quality of generation.</li>\n  <li>The framework proposes a suite of metrics to evaluate these dimensions without relying on ground truth human annotations.</li>\n  <li>RAGAS focuses on three quality aspects: Faithfulness, Answer Relevance, and Context Relevance.\n    <ul>\n      <li><strong>Faithfulness</strong>: Defined as the extent to which the generated answer is grounded in the provided context. It’s measured using the formula:\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-171-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>F</mi><mo>=</mo><mfrac><mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><mi>V</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow></mrow><mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><mi>S</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow></mrow></mfrac></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1611\" style=\"width: 3.701em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 3.076em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.992em, 1003.08em, 2.867em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1612\"><span class=\"mi\" id=\"MathJax-Span-1613\" style=\"font-family: STIXGeneral-Italic;\">F<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1614\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-1615\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 1.044em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.388em, 1000.84em, 4.326em, -999.997em); top: -4.529em; left: 50%; margin-left: -0.466em;\"><span class=\"mrow\" id=\"MathJax-Span-1616\"><span class=\"texatom\" id=\"MathJax-Span-1617\"><span class=\"mrow\" id=\"MathJax-Span-1618\"><span class=\"mo\" id=\"MathJax-Span-1619\" style=\"font-size: 70.7%; font-family: STIXVariants;\">|</span></span></span><span class=\"mi\" id=\"MathJax-Span-1620\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"texatom\" id=\"MathJax-Span-1621\"><span class=\"mrow\" id=\"MathJax-Span-1622\"><span class=\"mo\" id=\"MathJax-Span-1623\" style=\"font-size: 70.7%; font-family: STIXVariants;\">|</span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1000.73em, 4.326em, -999.997em); top: -3.591em; left: 50%; margin-left: -0.414em;\"><span class=\"mrow\" id=\"MathJax-Span-1624\"><span class=\"texatom\" id=\"MathJax-Span-1625\"><span class=\"mrow\" id=\"MathJax-Span-1626\"><span class=\"mo\" id=\"MathJax-Span-1627\" style=\"font-size: 70.7%; font-family: STIXVariants;\">|</span></span></span><span class=\"mi\" id=\"MathJax-Span-1628\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">S<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"texatom\" id=\"MathJax-Span-1629\"><span class=\"mrow\" id=\"MathJax-Span-1630\"><span class=\"mo\" id=\"MathJax-Span-1631\" style=\"font-size: 70.7%; font-family: STIXVariants;\">|</span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1001.04em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.044em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.684em; border-left: 0px solid; width: 0px; height: 2.003em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>F</mi><mo>=</mo><mfrac><mrow><mrow class=\"MJX-TeXAtom-ORD\"><mo stretchy=\"false\">|</mo></mrow><mi>V</mi><mrow class=\"MJX-TeXAtom-ORD\"><mo stretchy=\"false\">|</mo></mrow></mrow><mrow><mrow class=\"MJX-TeXAtom-ORD\"><mo stretchy=\"false\">|</mo></mrow><mi>S</mi><mrow class=\"MJX-TeXAtom-ORD\"><mo stretchy=\"false\">|</mo></mrow></mrow></mfrac></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-171\">F = \\frac{|V|}{|S|}</script>\nwhere, <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-172-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><mi>V</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1632\" style=\"width: 1.721em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.409em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.669em, 1001.3em, 2.867em, -999.997em); top: -2.497em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1633\"><span class=\"texatom\" id=\"MathJax-Span-1634\"><span class=\"mrow\" id=\"MathJax-Span-1635\"><span class=\"mo\" id=\"MathJax-Span-1636\" style=\"font-family: STIXVariants;\">|</span></span></span><span class=\"mi\" id=\"MathJax-Span-1637\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"texatom\" id=\"MathJax-Span-1638\"><span class=\"mrow\" id=\"MathJax-Span-1639\"><span class=\"mo\" id=\"MathJax-Span-1640\" style=\"font-family: STIXVariants;\">|</span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.503em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mrow class=\"MJX-TeXAtom-ORD\"><mo stretchy=\"false\">|</mo></mrow><mi>V</mi><mrow class=\"MJX-TeXAtom-ORD\"><mo stretchy=\"false\">|</mo></mrow></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-172\">|V|</script> is the number of statements supported by the context and <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-173-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><mi>S</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1641\" style=\"width: 1.461em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.201em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.669em, 1001.1em, 2.867em, -999.997em); top: -2.497em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1642\"><span class=\"texatom\" id=\"MathJax-Span-1643\"><span class=\"mrow\" id=\"MathJax-Span-1644\"><span class=\"mo\" id=\"MathJax-Span-1645\" style=\"font-family: STIXVariants;\">|</span></span></span><span class=\"mi\" id=\"MathJax-Span-1646\" style=\"font-family: STIXGeneral-Italic;\">S<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"texatom\" id=\"MathJax-Span-1647\"><span class=\"mrow\" id=\"MathJax-Span-1648\"><span class=\"mo\" id=\"MathJax-Span-1649\" style=\"font-family: STIXVariants;\">|</span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.503em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mrow class=\"MJX-TeXAtom-ORD\"><mo stretchy=\"false\">|</mo></mrow><mi>S</mi><mrow class=\"MJX-TeXAtom-ORD\"><mo stretchy=\"false\">|</mo></mrow></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-173\">|S|</script> is the total number of statements extracted from the answer.</li>\n      <li><strong>Answer Relevance</strong>: This metric assesses how well the answer addresses the given question. It’s calculated by generating potential questions from the answer and measuring their similarity to the original question using the formula:\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-174-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>A</mi><mi>R</mi><mo>=</mo><mfrac><mn>1</mn><mi>n</mi></mfrac><munderover><mo>&amp;#x2211;</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>n</mi></mrow></munderover><mtext>sim</mtext><mo stretchy=&quot;false&quot;>(</mo><mi>q</mi><mo>,</mo><msub><mi>q</mi><mi>i</mi></msub><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1650\" style=\"width: 11.513em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 9.586em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.148em, 1009.53em, 2.711em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1651\"><span class=\"mi\" id=\"MathJax-Span-1652\" style=\"font-family: STIXGeneral-Italic;\">A</span><span class=\"mi\" id=\"MathJax-Span-1653\" style=\"font-family: STIXGeneral-Italic;\">R</span><span class=\"mo\" id=\"MathJax-Span-1654\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-1655\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 0.471em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.388em, 1000.26em, 4.169em, -999.997em); top: -4.424em; left: 50%; margin-left: -0.154em;\"><span class=\"mn\" id=\"MathJax-Span-1656\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.544em, 1000.32em, 4.169em, -999.997em); top: -3.643em; left: 50%; margin-left: -0.154em;\"><span class=\"mi\" id=\"MathJax-Span-1657\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">n</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1000.47em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.471em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"munderover\" id=\"MathJax-Span-1658\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 2.034em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.076em, 1000.84em, 4.43em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mo\" id=\"MathJax-Span-1659\" style=\"font-family: STIXGeneral-Regular; vertical-align: 0.003em;\">∑</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.544em, 1000.42em, 4.169em, -999.997em); top: -4.477em; left: 0.94em;\"><span class=\"texatom\" id=\"MathJax-Span-1660\"><span class=\"mrow\" id=\"MathJax-Span-1661\"><span class=\"mi\" id=\"MathJax-Span-1662\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">n</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1001.1em, 4.169em, -999.997em); top: -3.695em; left: 0.94em;\"><span class=\"texatom\" id=\"MathJax-Span-1663\"><span class=\"mrow\" id=\"MathJax-Span-1664\"><span class=\"mi\" id=\"MathJax-Span-1665\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">i</span><span class=\"mo\" id=\"MathJax-Span-1666\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">=</span><span class=\"mn\" id=\"MathJax-Span-1667\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mtext\" id=\"MathJax-Span-1668\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">sim</span><span class=\"mo\" id=\"MathJax-Span-1669\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-1670\" style=\"font-family: STIXGeneral-Italic;\">q</span><span class=\"mo\" id=\"MathJax-Span-1671\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-1672\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.378em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1673\" style=\"font-family: STIXGeneral-Italic;\">q</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"mi\" id=\"MathJax-Span-1674\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1675\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.497em; border-left: 0px solid; width: 0px; height: 1.628em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>A</mi><mi>R</mi><mo>=</mo><mfrac><mn>1</mn><mi>n</mi></mfrac><munderover><mo>∑</mo><mrow class=\"MJX-TeXAtom-ORD\"><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mrow class=\"MJX-TeXAtom-ORD\"><mi>n</mi></mrow></munderover><mtext>sim</mtext><mo stretchy=\"false\">(</mo><mi>q</mi><mo>,</mo><msub><mi>q</mi><mi>i</mi></msub><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-174\">AR = \\frac{1}{n} \\sum_{i=1}^{n} \\text{sim}(q, q_i)</script>\nwhere <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-175-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>q</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1676\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.555em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1677\"><span class=\"mi\" id=\"MathJax-Span-1678\" style=\"font-family: STIXGeneral-Italic;\">q</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.878em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>q</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-175\">q</script> is the original question, <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-176-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>q</mi><mi>i</mi></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1679\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.565em, 1000.78em, 2.503em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1680\"><span class=\"msubsup\" id=\"MathJax-Span-1681\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.378em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1682\" style=\"font-family: STIXGeneral-Italic;\">q</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"mi\" id=\"MathJax-Span-1683\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.878em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>q</mi><mi>i</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-176\">q_i</script> are the generated questions, and sim denotes the cosine similarity between their embeddings.</li>\n      <li><strong>Context Relevance</strong>: Measures the extent to which the retrieved context contains only the information necessary to answer the question. It is quantified using the proportion of extracted relevant sentences to the total sentences in the context:\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-177-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>C</mi><mi>R</mi><mo>=</mo><mfrac><mtext>number of extracted sentences</mtext><mrow><mtext>total number of sentences in&amp;#xA0;</mtext><mi>c</mi><mo stretchy=&quot;false&quot;>(</mo><mi>q</mi><mo stretchy=&quot;false&quot;>)</mo></mrow></mfrac></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1684\" style=\"width: 14.638em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 12.19em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.148em, 1012.19em, 2.867em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1685\"><span class=\"mi\" id=\"MathJax-Span-1686\" style=\"font-family: STIXGeneral-Italic;\">C<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mi\" id=\"MathJax-Span-1687\" style=\"font-family: STIXGeneral-Italic;\">R</span><span class=\"mo\" id=\"MathJax-Span-1688\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-1689\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 9.43em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.388em, 1008.54em, 4.169em, -999.997em); top: -4.424em; left: 50%; margin-left: -4.268em;\"><span class=\"mtext\" id=\"MathJax-Span-1690\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">number of extracted sentences</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1009.27em, 4.326em, -999.997em); top: -3.643em; left: 50%; margin-left: -4.633em;\"><span class=\"mrow\" id=\"MathJax-Span-1691\"><span class=\"mtext\" id=\"MathJax-Span-1692\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">total number of sentences in&nbsp;</span><span class=\"mi\" id=\"MathJax-Span-1693\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">c</span><span class=\"mo\" id=\"MathJax-Span-1694\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-1695\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">q</span><span class=\"mo\" id=\"MathJax-Span-1696\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1009.43em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 9.43em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.684em; border-left: 0px solid; width: 0px; height: 1.878em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>C</mi><mi>R</mi><mo>=</mo><mfrac><mtext>number of extracted sentences</mtext><mrow><mtext>total number of sentences in&nbsp;</mtext><mi>c</mi><mo stretchy=\"false\">(</mo><mi>q</mi><mo stretchy=\"false\">)</mo></mrow></mfrac></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-177\">CR = \\frac{\\text{number of extracted sentences}}{\\text{total number of sentences in } c(q)}</script></li>\n    </ul>\n  </li>\n  <li>The paper validates RAGAS using the WikiEval dataset, demonstrating its alignment with human judgments in evaluating these aspects.</li>\n  <li>The authors argue that RAGAS contributes to faster and more efficient evaluation cycles for RAG systems, which is vital due to the rapid adoption of LLMs.</li>\n  <li>RAGAS is validated using the WikiEval dataset, which includes question-context-answer triples annotated with human judgments for faithfulness, answer relevance, and context relevance.</li>\n  <li>The evaluation shows that RAGAS aligns closely with human judgments, particularly in assessing faithfulness and answer relevance.</li>\n  <li><a href=\"https://github.com/explodinggradients/ragas\">Code</a>.</li>\n</ul>\n<ul>\n      <li><strong>Faithfulness</strong>: Defined as the extent to which the generated answer is grounded in the provided context. It’s measured using the formula:\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-171-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>F</mi><mo>=</mo><mfrac><mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><mi>V</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow></mrow><mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><mi>S</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow></mrow></mfrac></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1611\" style=\"width: 3.701em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 3.076em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(0.992em, 1003.08em, 2.867em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1612\"><span class=\"mi\" id=\"MathJax-Span-1613\" style=\"font-family: STIXGeneral-Italic;\">F<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1614\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-1615\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 1.044em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.388em, 1000.84em, 4.326em, -999.997em); top: -4.529em; left: 50%; margin-left: -0.466em;\"><span class=\"mrow\" id=\"MathJax-Span-1616\"><span class=\"texatom\" id=\"MathJax-Span-1617\"><span class=\"mrow\" id=\"MathJax-Span-1618\"><span class=\"mo\" id=\"MathJax-Span-1619\" style=\"font-size: 70.7%; font-family: STIXVariants;\">|</span></span></span><span class=\"mi\" id=\"MathJax-Span-1620\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"texatom\" id=\"MathJax-Span-1621\"><span class=\"mrow\" id=\"MathJax-Span-1622\"><span class=\"mo\" id=\"MathJax-Span-1623\" style=\"font-size: 70.7%; font-family: STIXVariants;\">|</span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1000.73em, 4.326em, -999.997em); top: -3.591em; left: 50%; margin-left: -0.414em;\"><span class=\"mrow\" id=\"MathJax-Span-1624\"><span class=\"texatom\" id=\"MathJax-Span-1625\"><span class=\"mrow\" id=\"MathJax-Span-1626\"><span class=\"mo\" id=\"MathJax-Span-1627\" style=\"font-size: 70.7%; font-family: STIXVariants;\">|</span></span></span><span class=\"mi\" id=\"MathJax-Span-1628\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">S<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"texatom\" id=\"MathJax-Span-1629\"><span class=\"mrow\" id=\"MathJax-Span-1630\"><span class=\"mo\" id=\"MathJax-Span-1631\" style=\"font-size: 70.7%; font-family: STIXVariants;\">|</span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1001.04em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.044em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.684em; border-left: 0px solid; width: 0px; height: 2.003em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>F</mi><mo>=</mo><mfrac><mrow><mrow class=\"MJX-TeXAtom-ORD\"><mo stretchy=\"false\">|</mo></mrow><mi>V</mi><mrow class=\"MJX-TeXAtom-ORD\"><mo stretchy=\"false\">|</mo></mrow></mrow><mrow><mrow class=\"MJX-TeXAtom-ORD\"><mo stretchy=\"false\">|</mo></mrow><mi>S</mi><mrow class=\"MJX-TeXAtom-ORD\"><mo stretchy=\"false\">|</mo></mrow></mrow></mfrac></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-171\">F = \\frac{|V|}{|S|}</script>\nwhere, <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-172-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><mi>V</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1632\" style=\"width: 1.721em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.409em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.669em, 1001.3em, 2.867em, -999.997em); top: -2.497em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1633\"><span class=\"texatom\" id=\"MathJax-Span-1634\"><span class=\"mrow\" id=\"MathJax-Span-1635\"><span class=\"mo\" id=\"MathJax-Span-1636\" style=\"font-family: STIXVariants;\">|</span></span></span><span class=\"mi\" id=\"MathJax-Span-1637\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"texatom\" id=\"MathJax-Span-1638\"><span class=\"mrow\" id=\"MathJax-Span-1639\"><span class=\"mo\" id=\"MathJax-Span-1640\" style=\"font-family: STIXVariants;\">|</span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.503em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mrow class=\"MJX-TeXAtom-ORD\"><mo stretchy=\"false\">|</mo></mrow><mi>V</mi><mrow class=\"MJX-TeXAtom-ORD\"><mo stretchy=\"false\">|</mo></mrow></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-172\">|V|</script> is the number of statements supported by the context and <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-173-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><mi>S</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1641\" style=\"width: 1.461em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.201em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.669em, 1001.1em, 2.867em, -999.997em); top: -2.497em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1642\"><span class=\"texatom\" id=\"MathJax-Span-1643\"><span class=\"mrow\" id=\"MathJax-Span-1644\"><span class=\"mo\" id=\"MathJax-Span-1645\" style=\"font-family: STIXVariants;\">|</span></span></span><span class=\"mi\" id=\"MathJax-Span-1646\" style=\"font-family: STIXGeneral-Italic;\">S<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"texatom\" id=\"MathJax-Span-1647\"><span class=\"mrow\" id=\"MathJax-Span-1648\"><span class=\"mo\" id=\"MathJax-Span-1649\" style=\"font-family: STIXVariants;\">|</span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.503em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mrow class=\"MJX-TeXAtom-ORD\"><mo stretchy=\"false\">|</mo></mrow><mi>S</mi><mrow class=\"MJX-TeXAtom-ORD\"><mo stretchy=\"false\">|</mo></mrow></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-173\">|S|</script> is the total number of statements extracted from the answer.</li>\n      <li><strong>Answer Relevance</strong>: This metric assesses how well the answer addresses the given question. It’s calculated by generating potential questions from the answer and measuring their similarity to the original question using the formula:\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-174-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>A</mi><mi>R</mi><mo>=</mo><mfrac><mn>1</mn><mi>n</mi></mfrac><munderover><mo>&amp;#x2211;</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>n</mi></mrow></munderover><mtext>sim</mtext><mo stretchy=&quot;false&quot;>(</mo><mi>q</mi><mo>,</mo><msub><mi>q</mi><mi>i</mi></msub><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1650\" style=\"width: 11.513em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 9.586em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.148em, 1009.53em, 2.711em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1651\"><span class=\"mi\" id=\"MathJax-Span-1652\" style=\"font-family: STIXGeneral-Italic;\">A</span><span class=\"mi\" id=\"MathJax-Span-1653\" style=\"font-family: STIXGeneral-Italic;\">R</span><span class=\"mo\" id=\"MathJax-Span-1654\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-1655\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 0.471em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.388em, 1000.26em, 4.169em, -999.997em); top: -4.424em; left: 50%; margin-left: -0.154em;\"><span class=\"mn\" id=\"MathJax-Span-1656\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.544em, 1000.32em, 4.169em, -999.997em); top: -3.643em; left: 50%; margin-left: -0.154em;\"><span class=\"mi\" id=\"MathJax-Span-1657\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">n</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1000.47em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.471em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"munderover\" id=\"MathJax-Span-1658\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 2.034em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.076em, 1000.84em, 4.43em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mo\" id=\"MathJax-Span-1659\" style=\"font-family: STIXGeneral-Regular; vertical-align: 0.003em;\">∑</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.544em, 1000.42em, 4.169em, -999.997em); top: -4.477em; left: 0.94em;\"><span class=\"texatom\" id=\"MathJax-Span-1660\"><span class=\"mrow\" id=\"MathJax-Span-1661\"><span class=\"mi\" id=\"MathJax-Span-1662\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">n</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1001.1em, 4.169em, -999.997em); top: -3.695em; left: 0.94em;\"><span class=\"texatom\" id=\"MathJax-Span-1663\"><span class=\"mrow\" id=\"MathJax-Span-1664\"><span class=\"mi\" id=\"MathJax-Span-1665\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">i</span><span class=\"mo\" id=\"MathJax-Span-1666\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">=</span><span class=\"mn\" id=\"MathJax-Span-1667\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mtext\" id=\"MathJax-Span-1668\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">sim</span><span class=\"mo\" id=\"MathJax-Span-1669\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-1670\" style=\"font-family: STIXGeneral-Italic;\">q</span><span class=\"mo\" id=\"MathJax-Span-1671\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-1672\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.378em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1673\" style=\"font-family: STIXGeneral-Italic;\">q</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"mi\" id=\"MathJax-Span-1674\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1675\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.497em; border-left: 0px solid; width: 0px; height: 1.628em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>A</mi><mi>R</mi><mo>=</mo><mfrac><mn>1</mn><mi>n</mi></mfrac><munderover><mo>∑</mo><mrow class=\"MJX-TeXAtom-ORD\"><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mrow class=\"MJX-TeXAtom-ORD\"><mi>n</mi></mrow></munderover><mtext>sim</mtext><mo stretchy=\"false\">(</mo><mi>q</mi><mo>,</mo><msub><mi>q</mi><mi>i</mi></msub><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-174\">AR = \\frac{1}{n} \\sum_{i=1}^{n} \\text{sim}(q, q_i)</script>\nwhere <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-175-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>q</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1676\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.555em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1677\"><span class=\"mi\" id=\"MathJax-Span-1678\" style=\"font-family: STIXGeneral-Italic;\">q</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.878em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>q</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-175\">q</script> is the original question, <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-176-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>q</mi><mi>i</mi></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1679\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.565em, 1000.78em, 2.503em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1680\"><span class=\"msubsup\" id=\"MathJax-Span-1681\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.378em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1682\" style=\"font-family: STIXGeneral-Italic;\">q</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"mi\" id=\"MathJax-Span-1683\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.878em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>q</mi><mi>i</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-176\">q_i</script> are the generated questions, and sim denotes the cosine similarity between their embeddings.</li>\n      <li><strong>Context Relevance</strong>: Measures the extent to which the retrieved context contains only the information necessary to answer the question. It is quantified using the proportion of extracted relevant sentences to the total sentences in the context:\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-177-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>C</mi><mi>R</mi><mo>=</mo><mfrac><mtext>number of extracted sentences</mtext><mrow><mtext>total number of sentences in&amp;#xA0;</mtext><mi>c</mi><mo stretchy=&quot;false&quot;>(</mo><mi>q</mi><mo stretchy=&quot;false&quot;>)</mo></mrow></mfrac></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1684\" style=\"width: 14.638em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 12.19em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.148em, 1012.19em, 2.867em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1685\"><span class=\"mi\" id=\"MathJax-Span-1686\" style=\"font-family: STIXGeneral-Italic;\">C<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mi\" id=\"MathJax-Span-1687\" style=\"font-family: STIXGeneral-Italic;\">R</span><span class=\"mo\" id=\"MathJax-Span-1688\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-1689\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 9.43em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.388em, 1008.54em, 4.169em, -999.997em); top: -4.424em; left: 50%; margin-left: -4.268em;\"><span class=\"mtext\" id=\"MathJax-Span-1690\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">number of extracted sentences</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1009.27em, 4.326em, -999.997em); top: -3.643em; left: 50%; margin-left: -4.633em;\"><span class=\"mrow\" id=\"MathJax-Span-1691\"><span class=\"mtext\" id=\"MathJax-Span-1692\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">total number of sentences in&nbsp;</span><span class=\"mi\" id=\"MathJax-Span-1693\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">c</span><span class=\"mo\" id=\"MathJax-Span-1694\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-1695\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">q</span><span class=\"mo\" id=\"MathJax-Span-1696\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1009.43em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 9.43em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.684em; border-left: 0px solid; width: 0px; height: 1.878em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>C</mi><mi>R</mi><mo>=</mo><mfrac><mtext>number of extracted sentences</mtext><mrow><mtext>total number of sentences in&nbsp;</mtext><mi>c</mi><mo stretchy=\"false\">(</mo><mi>q</mi><mo stretchy=\"false\">)</mo></mrow></mfrac></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-177\">CR = \\frac{\\text{number of extracted sentences}}{\\text{total number of sentences in } c(q)}</script></li>\n    </ul>",
    "contentMarkdown": "*   This paper by Es et al. from Exploding Gradients, Cardiff University, and AMPLYFI introduces RAGAS, a framework for reference-free evaluation of Retrieval Augmented Generation (RAG) systems.\n*   RAGAS focuses on evaluating the performance of RAG systems in dimensions such as the effectiveness of the retrieval system in providing relevant context, the LLM’s ability to utilize this context, and the overall quality of generation.\n*   The framework proposes a suite of metrics to evaluate these dimensions without relying on ground truth human annotations.\n*   RAGAS focuses on three quality aspects: Faithfulness, Answer Relevance, and Context Relevance.\n    *   **Faithfulness**: Defined as the extent to which the generated answer is grounded in the provided context. It’s measured using the formula: F\\=|V||S|F\\=|V||S|F = \\\\frac{|V|}{|S|} where, |V||V||V| is the number of statements supported by the context and |S||S||S| is the total number of statements extracted from the answer.\n    *   **Answer Relevance**: This metric assesses how well the answer addresses the given question. It’s calculated by generating potential questions from the answer and measuring their similarity to the original question using the formula: AR\\=1n∑ni\\=1sim(q,qi)AR\\=1n∑i\\=1nsim(q,qi)AR = \\\\frac{1}{n} \\\\sum\\_{i=1}^{n} \\\\text{sim}(q, q\\_i) where qqq is the original question, qiqiq\\_i are the generated questions, and sim denotes the cosine similarity between their embeddings.\n    *   **Context Relevance**: Measures the extent to which the retrieved context contains only the information necessary to answer the question. It is quantified using the proportion of extracted relevant sentences to the total sentences in the context: CR\\=number of extracted sentencestotal number of sentences in c(q)CR\\=number of extracted sentencestotal number of sentences in c(q)CR = \\\\frac{\\\\text{number of extracted sentences}}{\\\\text{total number of sentences in } c(q)}\n*   The paper validates RAGAS using the WikiEval dataset, demonstrating its alignment with human judgments in evaluating these aspects.\n*   The authors argue that RAGAS contributes to faster and more efficient evaluation cycles for RAG systems, which is vital due to the rapid adoption of LLMs.\n*   RAGAS is validated using the WikiEval dataset, which includes question-context-answer triples annotated with human judgments for faithfulness, answer relevance, and context relevance.\n*   The evaluation shows that RAGAS aligns closely with human judgments, particularly in assessing faithfulness and answer relevance.\n*   [Code](https://github.com/explodinggradients/ragas).\n\n*   **Faithfulness**: Defined as the extent to which the generated answer is grounded in the provided context. It’s measured using the formula: F\\=|V||S|F\\=|V||S|F = \\\\frac{|V|}{|S|} where, |V||V||V| is the number of statements supported by the context and |S||S||S| is the total number of statements extracted from the answer.\n*   **Answer Relevance**: This metric assesses how well the answer addresses the given question. It’s calculated by generating potential questions from the answer and measuring their similarity to the original question using the formula: AR\\=1n∑ni\\=1sim(q,qi)AR\\=1n∑i\\=1nsim(q,qi)AR = \\\\frac{1}{n} \\\\sum\\_{i=1}^{n} \\\\text{sim}(q, q\\_i) where qqq is the original question, qiqiq\\_i are the generated questions, and sim denotes the cosine similarity between their embeddings.\n*   **Context Relevance**: Measures the extent to which the retrieved context contains only the information necessary to answer the question. It is quantified using the proportion of extracted relevant sentences to the total sentences in the context: CR\\=number of extracted sentencestotal number of sentences in c(q)CR\\=number of extracted sentencestotal number of sentences in c(q)CR = \\\\frac{\\\\text{number of extracted sentences}}{\\\\text{total number of sentences in } c(q)}",
    "order": 38,
    "orderInChapter": 5,
    "difficulty": 5,
    "estimatedMinutes": 3,
    "tags": [
      "nlpllms",
      "embedding",
      "llm"
    ],
    "metadata": {
      "hasCode": false,
      "hasMath": true,
      "hasImages": false,
      "wordCount": 531,
      "contentLength": 45593
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#ragas:-automated-evaluation-of-retrieval-augmented-generation",
    "scrapedAt": "2025-12-28T11:54:28.279Z"
  },
  {
    "id": "ai-RAG-fine-tuning-or-retrieval-comparing-knowledge-injec-39",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "Selected Papers",
    "title": "Fine-Tuning or Retrieval? Comparing Knowledge Injection in LLMs",
    "subtitle": "Selected Papers",
    "contentHtml": "<ul>\n  <li>This paper by Ovadia et al. from Microsoft presents an insightful comparison of knowledge injection methods in large language models (LLMs). The core question addressed is whether unsupervised fine-tuning (USFT) is more effective than retrieval-augmented generation (RAG) for improving LLM performance on knowledge-intensive tasks.</li>\n  <li>The researchers focus on LLMs’ ability to memorize, understand, and retrieve factual data, using a knowledge base scraped from Wikipedia and a dataset of current events questions created with GPT-4. The study employs models like Llama2-7B, Mistral-7B, and Orca2-7B, evaluating them on tasks from the Massively Multitask Language Understanding Evaluation (MMLU) benchmark and a current events dataset.</li>\n  <li>Two methods of knowledge injection are explored: fine-tuning, which continues the model’s pre-training process using task-specific data, and retrieval-augmented generation (RAG), which uses external knowledge sources to enhance LLMs’ responses. The paper also delves into supervised, unsupervised, and reinforcement learning-based fine-tuning methods.</li>\n  <li>The key finding is that RAG outperforms unsupervised fine-tuning in knowledge injection. RAG, which uses external knowledge sources, is notably more effective in terms of knowledge injection than USFT alone and even more so than a combination of RAG and fine-tuning, particularly in scenarios where questions directly corresponded to the auxiliary dataset. This suggests that USFT may not be as efficient in embedding new knowledge into the model’s parameters.</li>\n  <li>The figure below from the paper shows a visualization of the knowledge injection framework.</li>\n</ul>\n<p><img src=\"../../../images/papers/FTorRAG.jpg\" alt=\"\"></p>\n<ul>\n  <li>Note that USFT in this context is a direct continuation of pre-training (hence also called continued pre-training in literature), predicting the next token on the dataset. Interestingly, fine-tuning with multiple paraphrases of the same fact significantly improves the baseline performance, indicating the importance of repetition and varied presentation of information for effective knowledge assimilation.</li>\n  <li>The authors created a knowledge base by scraping Wikipedia articles relevant to various topics, which was used for both fine-tuning and RAG. Additionally, a dataset of multiple-choice questions about current events was generated using GPT-4, with paraphrases created to augment this dataset.</li>\n  <li>Limitations of the study include the exclusive focus on unsupervised fine-tuning, without exploring supervised fine-tuning or reinforcement learning from human feedback (RLHF). The study also notes a high variance in accuracy performance across experiments, making it challenging to ascertain the statistical significance of the results.</li>\n  <li>The paper also questions why baseline models don’t achieve a 25% accuracy rate for multiple-choice questions with four options, suggesting that the tasks may not represent truly “unseen” knowledge. Moreover, the research primarily assesses straightforward knowledge or fact tasks, without delving into reasoning capabilities.</li>\n  <li>In summary, while fine-tuning can be beneficial, RAG is identified as a superior method for knowledge injection in LLMs, especially for tasks involving new information. The results highlight the potential of using diverse fine-tuning techniques and auxiliary knowledge bases for further research in this domain.</li>\n</ul>",
    "contentMarkdown": "*   This paper by Ovadia et al. from Microsoft presents an insightful comparison of knowledge injection methods in large language models (LLMs). The core question addressed is whether unsupervised fine-tuning (USFT) is more effective than retrieval-augmented generation (RAG) for improving LLM performance on knowledge-intensive tasks.\n*   The researchers focus on LLMs’ ability to memorize, understand, and retrieve factual data, using a knowledge base scraped from Wikipedia and a dataset of current events questions created with GPT-4. The study employs models like Llama2-7B, Mistral-7B, and Orca2-7B, evaluating them on tasks from the Massively Multitask Language Understanding Evaluation (MMLU) benchmark and a current events dataset.\n*   Two methods of knowledge injection are explored: fine-tuning, which continues the model’s pre-training process using task-specific data, and retrieval-augmented generation (RAG), which uses external knowledge sources to enhance LLMs’ responses. The paper also delves into supervised, unsupervised, and reinforcement learning-based fine-tuning methods.\n*   The key finding is that RAG outperforms unsupervised fine-tuning in knowledge injection. RAG, which uses external knowledge sources, is notably more effective in terms of knowledge injection than USFT alone and even more so than a combination of RAG and fine-tuning, particularly in scenarios where questions directly corresponded to the auxiliary dataset. This suggests that USFT may not be as efficient in embedding new knowledge into the model’s parameters.\n*   The figure below from the paper shows a visualization of the knowledge injection framework.\n\n![](../../../images/papers/FTorRAG.jpg)\n\n*   Note that USFT in this context is a direct continuation of pre-training (hence also called continued pre-training in literature), predicting the next token on the dataset. Interestingly, fine-tuning with multiple paraphrases of the same fact significantly improves the baseline performance, indicating the importance of repetition and varied presentation of information for effective knowledge assimilation.\n*   The authors created a knowledge base by scraping Wikipedia articles relevant to various topics, which was used for both fine-tuning and RAG. Additionally, a dataset of multiple-choice questions about current events was generated using GPT-4, with paraphrases created to augment this dataset.\n*   Limitations of the study include the exclusive focus on unsupervised fine-tuning, without exploring supervised fine-tuning or reinforcement learning from human feedback (RLHF). The study also notes a high variance in accuracy performance across experiments, making it challenging to ascertain the statistical significance of the results.\n*   The paper also questions why baseline models don’t achieve a 25% accuracy rate for multiple-choice questions with four options, suggesting that the tasks may not represent truly “unseen” knowledge. Moreover, the research primarily assesses straightforward knowledge or fact tasks, without delving into reasoning capabilities.\n*   In summary, while fine-tuning can be beneficial, RAG is identified as a superior method for knowledge injection in LLMs, especially for tasks involving new information. The results highlight the potential of using diverse fine-tuning techniques and auxiliary knowledge bases for further research in this domain.",
    "order": 39,
    "orderInChapter": 6,
    "difficulty": 4,
    "estimatedMinutes": 3,
    "tags": [
      "nlpllms",
      "embedding",
      "gpt",
      "llm",
      "reinforcement learning",
      "fine-tuning"
    ],
    "metadata": {
      "hasCode": false,
      "hasMath": false,
      "hasImages": true,
      "wordCount": 467,
      "contentLength": 3506
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#fine-tuning-or-retrieval?-comparing-knowledge-injection-in-llms",
    "scrapedAt": "2025-12-28T11:54:28.279Z"
  },
  {
    "id": "ai-RAG-dense-x-retrieval-what-retrieval-granularity-shoul-40",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "Selected Papers",
    "title": "Dense X Retrieval: What Retrieval Granularity Should We Use?",
    "subtitle": "Selected Papers",
    "contentHtml": "<ul>\n  <li>One crucial choice in RAG pipeline design is chunking: should it be sentence level, passage level, or chapter level? This choice significantly impacts your retrieval and response generation performance.</li>\n  <li>This paper by Chen et al. from the University of Washington, Tencent AI Lab, University of Pennsylvania, Carnegie Mellon University introduces a novel approach to dense retrieval in open-domain NLP tasks by using “propositions” as retrieval units, instead of the traditional document passages or sentences. A proposition is defined as an atomic expression within text, encapsulating a distinct factoid in a concise, self-contained natural language format. This change in retrieval granularity has a significant impact on both retrieval and downstream task performances.</li>\n  <li>Propositions follow three key principles:\n    <ol>\n      <li>Each proposition encapsulates a distinct meaning, collectively representing the semantics of the entire text.</li>\n      <li>They are minimal and indivisible, ensuring precision and clarity.</li>\n      <li>Each proposition is contextualized and self-contained, including all necessary text context (like coreferences) for full understanding.</li>\n    </ol>\n  </li>\n  <li>The authors developed a text generation model, named “Propositionizer,” to segment Wikipedia pages into propositions. This model was fine-tuned in two steps, starting with prompting GPT-4 for paragraph-to-propositions pairs generation, followed by fine-tuning a Flan-T5-large model.</li>\n  <li>The effectiveness of propositions as retrieval units was evaluated using the FACTOIDWIKI dataset, a processed English Wikipedia dump segmented into passages, sentences, and propositions. Experiments were conducted on five open-domain QA datasets: Natural Questions (NQ), TriviaQA (TQA), Web Questions (WebQ), SQuAD, and Entity Questions (EQ). Six different dense retriever models were compared: SimCSE, Contriever, DPR, ANCE, TAS-B, and GTR.</li>\n  <li>The figure below from the paper illustrates the fact that that segmenting and indexing a retrieval corpus on the proposition level can be a simple yet effective strategy to increase dense retrievers’ generalization performance at inference time <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-178-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>(</mo><mi>A</mi><mo>,</mo><mi>B</mi><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1697\" style=\"width: 3.023em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.503em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1002.45em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1698\"><span class=\"mo\" id=\"MathJax-Span-1699\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-1700\" style=\"font-family: STIXGeneral-Italic;\">A</span><span class=\"mo\" id=\"MathJax-Span-1701\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mi\" id=\"MathJax-Span-1702\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.211em;\">B</span><span class=\"mo\" id=\"MathJax-Span-1703\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mo stretchy=\"false\">(</mo><mi>A</mi><mo>,</mo><mi>B</mi><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-178\">(A, B)</script>. We empirically compare the retrieval and downstream open-domain QA tasks performance when dense retrievers work with Wikipedia indexed at the level of 100-word passage, sentence or proposition <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-179-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>(</mo><mi>C</mi><mo>,</mo><mi>D</mi><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1704\" style=\"width: 3.023em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.503em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1002.45em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1705\"><span class=\"mo\" id=\"MathJax-Span-1706\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-1707\" style=\"font-family: STIXGeneral-Italic;\">C<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1708\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mi\" id=\"MathJax-Span-1709\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.211em;\">D</span><span class=\"mo\" id=\"MathJax-Span-1710\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mo stretchy=\"false\">(</mo><mi>C</mi><mo>,</mo><mi>D</mi><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-179\">(C, D)</script>.</li>\n</ul>\n<ol>\n      <li>Each proposition encapsulates a distinct meaning, collectively representing the semantics of the entire text.</li>\n      <li>They are minimal and indivisible, ensuring precision and clarity.</li>\n      <li>Each proposition is contextualized and self-contained, including all necessary text context (like coreferences) for full understanding.</li>\n    </ol>\n<p><img src=\"../../../images/papers/DXR.jpg\" alt=\"\"></p>\n<ul>\n  <li>Results:\n    <ol>\n      <li><strong>Passage Retrieval Performance:</strong> Proposition-based retrieval consistently outperformed sentence and passage-level retrieval across all datasets and models. This was particularly evident with unsupervised retrievers like SimCSE and Contriever, which showed an average Recall@5 improvement of 12.0% and 9.3%, respectively.</li>\n      <li><strong>Cross-Task Generalization:</strong> The advantage of proposition retrieval was most pronounced in cross-task generalization settings, especially for queries about less common entities. It showed significant improvement over other granularities in datasets not seen during the training of the retriever models.</li>\n      <li><strong>Downstream QA Performance:</strong> In the retrieve-then-read setting, proposition-based retrieval led to stronger downstream QA performance. This was true for both unsupervised and supervised retrievers, with notable improvements in exact match (EM) scores.</li>\n      <li><strong>Density of Question-Related Information:</strong> Propositions proved to offer a higher density of relevant information, resulting in the correct answers appearing more frequently within the top-l retrieved words. This was a significant advantage over sentence and passage retrieval, particularly in the range of 100-200 words.</li>\n      <li><strong>Error Analysis:</strong> The study also highlighted the types of errors typical to each retrieval granularity. For example, passage-level retrieval often struggled with entity ambiguity, while proposition retrieval faced challenges in multi-hop reasoning tasks.</li>\n    </ol>\n  </li>\n  <li>The figure plot from the paper shows that retrieving by propositions yields the best retrieval performance in both passage retrieval task and downstream open-domain QA task, e.g. with Contriever or GTR as the backbone retriever.</li>\n</ul>\n<ol>\n      <li><strong>Passage Retrieval Performance:</strong> Proposition-based retrieval consistently outperformed sentence and passage-level retrieval across all datasets and models. This was particularly evident with unsupervised retrievers like SimCSE and Contriever, which showed an average Recall@5 improvement of 12.0% and 9.3%, respectively.</li>\n      <li><strong>Cross-Task Generalization:</strong> The advantage of proposition retrieval was most pronounced in cross-task generalization settings, especially for queries about less common entities. It showed significant improvement over other granularities in datasets not seen during the training of the retriever models.</li>\n      <li><strong>Downstream QA Performance:</strong> In the retrieve-then-read setting, proposition-based retrieval led to stronger downstream QA performance. This was true for both unsupervised and supervised retrievers, with notable improvements in exact match (EM) scores.</li>\n      <li><strong>Density of Question-Related Information:</strong> Propositions proved to offer a higher density of relevant information, resulting in the correct answers appearing more frequently within the top-l retrieved words. This was a significant advantage over sentence and passage retrieval, particularly in the range of 100-200 words.</li>\n      <li><strong>Error Analysis:</strong> The study also highlighted the types of errors typical to each retrieval granularity. For example, passage-level retrieval often struggled with entity ambiguity, while proposition retrieval faced challenges in multi-hop reasoning tasks.</li>\n    </ol>\n<p><img src=\"../../../images/papers/DXR2.jpg\" alt=\"\"></p>\n<ul>\n  <li>The research demonstrates that using propositions as retrieval units significantly improves dense retrieval performance and downstream QA task accuracy, outperforming traditional passage and sentence-based methods. The introduction of FACTOIDWIKI, with its 250 million propositions, is expected to facilitate future research in information retrieval.</li>\n</ul>",
    "contentMarkdown": "*   One crucial choice in RAG pipeline design is chunking: should it be sentence level, passage level, or chapter level? This choice significantly impacts your retrieval and response generation performance.\n*   This paper by Chen et al. from the University of Washington, Tencent AI Lab, University of Pennsylvania, Carnegie Mellon University introduces a novel approach to dense retrieval in open-domain NLP tasks by using “propositions” as retrieval units, instead of the traditional document passages or sentences. A proposition is defined as an atomic expression within text, encapsulating a distinct factoid in a concise, self-contained natural language format. This change in retrieval granularity has a significant impact on both retrieval and downstream task performances.\n*   Propositions follow three key principles:\n    1.  Each proposition encapsulates a distinct meaning, collectively representing the semantics of the entire text.\n    2.  They are minimal and indivisible, ensuring precision and clarity.\n    3.  Each proposition is contextualized and self-contained, including all necessary text context (like coreferences) for full understanding.\n*   The authors developed a text generation model, named “Propositionizer,” to segment Wikipedia pages into propositions. This model was fine-tuned in two steps, starting with prompting GPT-4 for paragraph-to-propositions pairs generation, followed by fine-tuning a Flan-T5-large model.\n*   The effectiveness of propositions as retrieval units was evaluated using the FACTOIDWIKI dataset, a processed English Wikipedia dump segmented into passages, sentences, and propositions. Experiments were conducted on five open-domain QA datasets: Natural Questions (NQ), TriviaQA (TQA), Web Questions (WebQ), SQuAD, and Entity Questions (EQ). Six different dense retriever models were compared: SimCSE, Contriever, DPR, ANCE, TAS-B, and GTR.\n*   The figure below from the paper illustrates the fact that that segmenting and indexing a retrieval corpus on the proposition level can be a simple yet effective strategy to increase dense retrievers’ generalization performance at inference time (A,B)(A,B)(A, B). We empirically compare the retrieval and downstream open-domain QA tasks performance when dense retrievers work with Wikipedia indexed at the level of 100-word passage, sentence or proposition (C,D)(C,D)(C, D).\n\n1.  Each proposition encapsulates a distinct meaning, collectively representing the semantics of the entire text.\n2.  They are minimal and indivisible, ensuring precision and clarity.\n3.  Each proposition is contextualized and self-contained, including all necessary text context (like coreferences) for full understanding.\n\n![](../../../images/papers/DXR.jpg)\n\n*   Results:\n    1.  **Passage Retrieval Performance:** Proposition-based retrieval consistently outperformed sentence and passage-level retrieval across all datasets and models. This was particularly evident with unsupervised retrievers like SimCSE and Contriever, which showed an average Recall@5 improvement of 12.0% and 9.3%, respectively.\n    2.  **Cross-Task Generalization:** The advantage of proposition retrieval was most pronounced in cross-task generalization settings, especially for queries about less common entities. It showed significant improvement over other granularities in datasets not seen during the training of the retriever models.\n    3.  **Downstream QA Performance:** In the retrieve-then-read setting, proposition-based retrieval led to stronger downstream QA performance. This was true for both unsupervised and supervised retrievers, with notable improvements in exact match (EM) scores.\n    4.  **Density of Question-Related Information:** Propositions proved to offer a higher density of relevant information, resulting in the correct answers appearing more frequently within the top-l retrieved words. This was a significant advantage over sentence and passage retrieval, particularly in the range of 100-200 words.\n    5.  **Error Analysis:** The study also highlighted the types of errors typical to each retrieval granularity. For example, passage-level retrieval often struggled with entity ambiguity, while proposition retrieval faced challenges in multi-hop reasoning tasks.\n*   The figure plot from the paper shows that retrieving by propositions yields the best retrieval performance in both passage retrieval task and downstream open-domain QA task, e.g. with Contriever or GTR as the backbone retriever.\n\n1.  **Passage Retrieval Performance:** Proposition-based retrieval consistently outperformed sentence and passage-level retrieval across all datasets and models. This was particularly evident with unsupervised retrievers like SimCSE and Contriever, which showed an average Recall@5 improvement of 12.0% and 9.3%, respectively.\n2.  **Cross-Task Generalization:** The advantage of proposition retrieval was most pronounced in cross-task generalization settings, especially for queries about less common entities. It showed significant improvement over other granularities in datasets not seen during the training of the retriever models.\n3.  **Downstream QA Performance:** In the retrieve-then-read setting, proposition-based retrieval led to stronger downstream QA performance. This was true for both unsupervised and supervised retrievers, with notable improvements in exact match (EM) scores.\n4.  **Density of Question-Related Information:** Propositions proved to offer a higher density of relevant information, resulting in the correct answers appearing more frequently within the top-l retrieved words. This was a significant advantage over sentence and passage retrieval, particularly in the range of 100-200 words.\n5.  **Error Analysis:** The study also highlighted the types of errors typical to each retrieval granularity. For example, passage-level retrieval often struggled with entity ambiguity, while proposition retrieval faced challenges in multi-hop reasoning tasks.\n\n![](../../../images/papers/DXR2.jpg)\n\n*   The research demonstrates that using propositions as retrieval units significantly improves dense retrieval performance and downstream QA task accuracy, outperforming traditional passage and sentence-based methods. The introduction of FACTOIDWIKI, with its 250 million propositions, is expected to facilitate future research in information retrieval.",
    "order": 40,
    "orderInChapter": 7,
    "difficulty": 5,
    "estimatedMinutes": 5,
    "tags": [
      "nlpllms",
      "gpt",
      "nlp",
      "fine-tuning"
    ],
    "metadata": {
      "hasCode": false,
      "hasMath": true,
      "hasImages": true,
      "wordCount": 835,
      "contentLength": 10378
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#dense-x-retrieval:-what-retrieval-granularity-should-we-use?",
    "scrapedAt": "2025-12-28T11:54:28.279Z"
  },
  {
    "id": "ai-RAG-ares-an-automated-evaluation-framework-for-retriev-41",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "Selected Papers",
    "title": "ARES: an Automated Evaluation Framework for Retrieval-Augmented Generation Systems",
    "subtitle": "Selected Papers",
    "contentHtml": "<ul>\n  <li>This paper by Saad-Falcon et al. from Stanford University and UC Berkeley, the paper introduces ARES (Automated RAG Evaluation System) for evaluating Retrieval-Augmented Generation (RAG) systems in terms of context relevance, answer faithfulness, and answer relevance.</li>\n  <li>ARES generates synthetic training data using a language model and fine-tunes lightweight LM judges to assess individual RAG components. It utilizes a small set of human-annotated data points for prediction-powered inference (PPI), enabling statistical guarantees for its predictions.</li>\n  <li>The framework has three stages:\n    <ol>\n      <li><strong>LLM Generation of Synthetic Dataset</strong>: ARES uses generative LLMs (like FLAN-T5 XXL) to create synthetic datasets of question-answer pairs derived from target corpus passages. This stage includes both positive and negative examples for training.</li>\n      <li><strong>Preparing LLM Judges</strong>: Separate lightweight LM models are fine-tuned for three classification tasks - context relevance, answer faithfulness, and answer relevance - using the synthetic dataset. These models are tuned using a contrastive learning objective.</li>\n      <li><strong>Ranking RAG Systems with Confidence Intervals</strong>:\n        <ul>\n          <li>After preparing the LLM judges, the next step involves using them to score and rank various RAG systems. This process begins with ARES sampling in-domain query-document-answer triples from each RAG approach. The judges then label each triple, assessing context relevance, answer faithfulness, and answer relevance. These labels are averaged for each in-domain triple to evaluate the performance of the RAG systems across the three metrics.</li>\n          <li>While average scores could be reported as quality metrics for each RAG system, these scores are based on unlabeled data and predictions from synthetically-trained LLM judges, which may introduce noise. An alternative is to rely solely on a small human preference validation set for evaluation, examining the extent to which each RAG system aligns with human annotations. However, this method requires labeling outputs from each RAG system separately, which can be time-consuming and expensive.</li>\n          <li>To enhance the precision of the evaluation, ARES employs prediction-powered inference (PPI). PPI is a statistical method that narrows the confidence interval of predictions on a small annotated dataset by utilizing predictions on a larger, non-annotated dataset. It combines labeled datapoints and ARES judge predictions on non-annotated datapoints to construct tighter confidence intervals for RAG system performance.</li>\n          <li>PPI involves using LLM judges on the human preference validation set to learn a rectifier function. This function constructs a confidence set of the ML model’s performance, taking into account each ML prediction in the larger non-annotated dataset. The confidence set helps create a more precise confidence interval for the average performance of the ML model (e.g., its context relevance, answer faithfulness, or answer relevance accuracy). By integrating the human preference validation set with a larger set of datapoints with ML predictions, PPI develops reliable confidence intervals for ML model performance, outperforming traditional inference methods.</li>\n          <li>The PPI rectifier function addresses errors made by the LLM judge and generates confidence bounds for the success and failure rates of the RAG system. It estimates performances in context relevance, answer faithfulness, and answer relevance. PPI also allows for estimating confidence intervals with a specified probability level; in these experiments, a standard 95% alpha is used.</li>\n          <li>Finally, the accuracy confidence interval for each component of the RAG is determined, and the midpoints of these intervals are used to rank the RAG systems. This ranking enables a comparison of different RAG systems and configurations within the same system, aiding in identifying the optimal approach for a specific domain.\n            <ul>\n              <li>In summary, ARES employs PPI to score and rank RAG systems, using human preference validation sets to calculate confidence intervals. PPI operates by first generating predictions for a large sample of data points, followed by human annotation of a small subset. These annotations are used to calculate confidence intervals for the entire dataset, ensuring accuracy in the system’s evaluation capabilities.</li>\n            </ul>\n          </li>\n        </ul>\n      </li>\n    </ol>\n  </li>\n  <li>To implement ARES for scoring a RAG system and comparing to other RAG configurations, three components are needed:\n    <ul>\n      <li>A human preference validation set of annotated query, document, and answer triples for the evaluation criteria (e.g. context relevance, answer faithfulness, and/or answer relevance). There should be at least 50 examples but several hundred examples is ideal.</li>\n      <li>A set of few-shot examples for scoring context relevance, answer faithfulness, and/or answer relevance in your system.</li>\n      <li>A much larger set of unlabeled query-document-answer triples outputted by your RAG system for scoring.</li>\n    </ul>\n  </li>\n  <li>The figure below from the paper shows an overview of ARES: As inputs, the ARES pipeline requires an in-domain passage set, a human preference validation set of 150 annotated datapoints or more, and five few-shot examples of in-domain queries and answers, which are used for prompting LLMs in synthetic data generation. To prepare our LLM judges for evaluation, we first generate synthetic queries and answers from the corpus passages. Using our generated training triples and a constrastive learning framework, we fine-tune an LLM to classify query–passage–answer triples across three criteria: context relevance, answer faithfulness, and answer relevance. Finally, we use the LLM judge to evaluate RAG systems and generate confidence bounds for the ranking using PPI and the human preference validation set.</li>\n</ul>\n<ol>\n      <li><strong>LLM Generation of Synthetic Dataset</strong>: ARES uses generative LLMs (like FLAN-T5 XXL) to create synthetic datasets of question-answer pairs derived from target corpus passages. This stage includes both positive and negative examples for training.</li>\n      <li><strong>Preparing LLM Judges</strong>: Separate lightweight LM models are fine-tuned for three classification tasks - context relevance, answer faithfulness, and answer relevance - using the synthetic dataset. These models are tuned using a contrastive learning objective.</li>\n      <li><strong>Ranking RAG Systems with Confidence Intervals</strong>:\n        <ul>\n          <li>After preparing the LLM judges, the next step involves using them to score and rank various RAG systems. This process begins with ARES sampling in-domain query-document-answer triples from each RAG approach. The judges then label each triple, assessing context relevance, answer faithfulness, and answer relevance. These labels are averaged for each in-domain triple to evaluate the performance of the RAG systems across the three metrics.</li>\n          <li>While average scores could be reported as quality metrics for each RAG system, these scores are based on unlabeled data and predictions from synthetically-trained LLM judges, which may introduce noise. An alternative is to rely solely on a small human preference validation set for evaluation, examining the extent to which each RAG system aligns with human annotations. However, this method requires labeling outputs from each RAG system separately, which can be time-consuming and expensive.</li>\n          <li>To enhance the precision of the evaluation, ARES employs prediction-powered inference (PPI). PPI is a statistical method that narrows the confidence interval of predictions on a small annotated dataset by utilizing predictions on a larger, non-annotated dataset. It combines labeled datapoints and ARES judge predictions on non-annotated datapoints to construct tighter confidence intervals for RAG system performance.</li>\n          <li>PPI involves using LLM judges on the human preference validation set to learn a rectifier function. This function constructs a confidence set of the ML model’s performance, taking into account each ML prediction in the larger non-annotated dataset. The confidence set helps create a more precise confidence interval for the average performance of the ML model (e.g., its context relevance, answer faithfulness, or answer relevance accuracy). By integrating the human preference validation set with a larger set of datapoints with ML predictions, PPI develops reliable confidence intervals for ML model performance, outperforming traditional inference methods.</li>\n          <li>The PPI rectifier function addresses errors made by the LLM judge and generates confidence bounds for the success and failure rates of the RAG system. It estimates performances in context relevance, answer faithfulness, and answer relevance. PPI also allows for estimating confidence intervals with a specified probability level; in these experiments, a standard 95% alpha is used.</li>\n          <li>Finally, the accuracy confidence interval for each component of the RAG is determined, and the midpoints of these intervals are used to rank the RAG systems. This ranking enables a comparison of different RAG systems and configurations within the same system, aiding in identifying the optimal approach for a specific domain.\n            <ul>\n              <li>In summary, ARES employs PPI to score and rank RAG systems, using human preference validation sets to calculate confidence intervals. PPI operates by first generating predictions for a large sample of data points, followed by human annotation of a small subset. These annotations are used to calculate confidence intervals for the entire dataset, ensuring accuracy in the system’s evaluation capabilities.</li>\n            </ul>\n          </li>\n        </ul>\n      </li>\n    </ol>\n<ul>\n          <li>After preparing the LLM judges, the next step involves using them to score and rank various RAG systems. This process begins with ARES sampling in-domain query-document-answer triples from each RAG approach. The judges then label each triple, assessing context relevance, answer faithfulness, and answer relevance. These labels are averaged for each in-domain triple to evaluate the performance of the RAG systems across the three metrics.</li>\n          <li>While average scores could be reported as quality metrics for each RAG system, these scores are based on unlabeled data and predictions from synthetically-trained LLM judges, which may introduce noise. An alternative is to rely solely on a small human preference validation set for evaluation, examining the extent to which each RAG system aligns with human annotations. However, this method requires labeling outputs from each RAG system separately, which can be time-consuming and expensive.</li>\n          <li>To enhance the precision of the evaluation, ARES employs prediction-powered inference (PPI). PPI is a statistical method that narrows the confidence interval of predictions on a small annotated dataset by utilizing predictions on a larger, non-annotated dataset. It combines labeled datapoints and ARES judge predictions on non-annotated datapoints to construct tighter confidence intervals for RAG system performance.</li>\n          <li>PPI involves using LLM judges on the human preference validation set to learn a rectifier function. This function constructs a confidence set of the ML model’s performance, taking into account each ML prediction in the larger non-annotated dataset. The confidence set helps create a more precise confidence interval for the average performance of the ML model (e.g., its context relevance, answer faithfulness, or answer relevance accuracy). By integrating the human preference validation set with a larger set of datapoints with ML predictions, PPI develops reliable confidence intervals for ML model performance, outperforming traditional inference methods.</li>\n          <li>The PPI rectifier function addresses errors made by the LLM judge and generates confidence bounds for the success and failure rates of the RAG system. It estimates performances in context relevance, answer faithfulness, and answer relevance. PPI also allows for estimating confidence intervals with a specified probability level; in these experiments, a standard 95% alpha is used.</li>\n          <li>Finally, the accuracy confidence interval for each component of the RAG is determined, and the midpoints of these intervals are used to rank the RAG systems. This ranking enables a comparison of different RAG systems and configurations within the same system, aiding in identifying the optimal approach for a specific domain.\n            <ul>\n              <li>In summary, ARES employs PPI to score and rank RAG systems, using human preference validation sets to calculate confidence intervals. PPI operates by first generating predictions for a large sample of data points, followed by human annotation of a small subset. These annotations are used to calculate confidence intervals for the entire dataset, ensuring accuracy in the system’s evaluation capabilities.</li>\n            </ul>\n          </li>\n        </ul>\n<ul>\n              <li>In summary, ARES employs PPI to score and rank RAG systems, using human preference validation sets to calculate confidence intervals. PPI operates by first generating predictions for a large sample of data points, followed by human annotation of a small subset. These annotations are used to calculate confidence intervals for the entire dataset, ensuring accuracy in the system’s evaluation capabilities.</li>\n            </ul>\n<ul>\n      <li>A human preference validation set of annotated query, document, and answer triples for the evaluation criteria (e.g. context relevance, answer faithfulness, and/or answer relevance). There should be at least 50 examples but several hundred examples is ideal.</li>\n      <li>A set of few-shot examples for scoring context relevance, answer faithfulness, and/or answer relevance in your system.</li>\n      <li>A much larger set of unlabeled query-document-answer triples outputted by your RAG system for scoring.</li>\n    </ul>\n<p><img src=\"../../../images/papers/ARES.jpg\" alt=\"\"></p>\n<ul>\n  <li>Experiments conducted on datasets from KILT and SuperGLUE demonstrate ARES’s accuracy in evaluating RAG systems, outperforming existing automated evaluation approaches like RAGAS. ARES is effective across various domains, maintaining accuracy even with domain shifts in queries and documents.</li>\n  <li>The paper highlights the strengths of ARES in cross-domain applications and its limitations, such as its inability to generalize across drastic domain shifts (e.g., language changes, text-to-code). It also explores the potential of using GPT-4 for generating labels as a replacement for human annotations in the PPI process.</li>\n  <li>ARES code and datasets are available for replication and deployment at <a href=\"https://github.com/stanford-futuredata/ARES\">GitHub</a>.</li>\n  <li><a href=\"https://github.com/stanford-futuredata/ares\">Code</a></li>\n</ul>",
    "contentMarkdown": "*   This paper by Saad-Falcon et al. from Stanford University and UC Berkeley, the paper introduces ARES (Automated RAG Evaluation System) for evaluating Retrieval-Augmented Generation (RAG) systems in terms of context relevance, answer faithfulness, and answer relevance.\n*   ARES generates synthetic training data using a language model and fine-tunes lightweight LM judges to assess individual RAG components. It utilizes a small set of human-annotated data points for prediction-powered inference (PPI), enabling statistical guarantees for its predictions.\n*   The framework has three stages:\n    1.  **LLM Generation of Synthetic Dataset**: ARES uses generative LLMs (like FLAN-T5 XXL) to create synthetic datasets of question-answer pairs derived from target corpus passages. This stage includes both positive and negative examples for training.\n    2.  **Preparing LLM Judges**: Separate lightweight LM models are fine-tuned for three classification tasks - context relevance, answer faithfulness, and answer relevance - using the synthetic dataset. These models are tuned using a contrastive learning objective.\n    3.  **Ranking RAG Systems with Confidence Intervals**:\n        *   After preparing the LLM judges, the next step involves using them to score and rank various RAG systems. This process begins with ARES sampling in-domain query-document-answer triples from each RAG approach. The judges then label each triple, assessing context relevance, answer faithfulness, and answer relevance. These labels are averaged for each in-domain triple to evaluate the performance of the RAG systems across the three metrics.\n        *   While average scores could be reported as quality metrics for each RAG system, these scores are based on unlabeled data and predictions from synthetically-trained LLM judges, which may introduce noise. An alternative is to rely solely on a small human preference validation set for evaluation, examining the extent to which each RAG system aligns with human annotations. However, this method requires labeling outputs from each RAG system separately, which can be time-consuming and expensive.\n        *   To enhance the precision of the evaluation, ARES employs prediction-powered inference (PPI). PPI is a statistical method that narrows the confidence interval of predictions on a small annotated dataset by utilizing predictions on a larger, non-annotated dataset. It combines labeled datapoints and ARES judge predictions on non-annotated datapoints to construct tighter confidence intervals for RAG system performance.\n        *   PPI involves using LLM judges on the human preference validation set to learn a rectifier function. This function constructs a confidence set of the ML model’s performance, taking into account each ML prediction in the larger non-annotated dataset. The confidence set helps create a more precise confidence interval for the average performance of the ML model (e.g., its context relevance, answer faithfulness, or answer relevance accuracy). By integrating the human preference validation set with a larger set of datapoints with ML predictions, PPI develops reliable confidence intervals for ML model performance, outperforming traditional inference methods.\n        *   The PPI rectifier function addresses errors made by the LLM judge and generates confidence bounds for the success and failure rates of the RAG system. It estimates performances in context relevance, answer faithfulness, and answer relevance. PPI also allows for estimating confidence intervals with a specified probability level; in these experiments, a standard 95% alpha is used.\n        *   Finally, the accuracy confidence interval for each component of the RAG is determined, and the midpoints of these intervals are used to rank the RAG systems. This ranking enables a comparison of different RAG systems and configurations within the same system, aiding in identifying the optimal approach for a specific domain.\n            *   In summary, ARES employs PPI to score and rank RAG systems, using human preference validation sets to calculate confidence intervals. PPI operates by first generating predictions for a large sample of data points, followed by human annotation of a small subset. These annotations are used to calculate confidence intervals for the entire dataset, ensuring accuracy in the system’s evaluation capabilities.\n*   To implement ARES for scoring a RAG system and comparing to other RAG configurations, three components are needed:\n    *   A human preference validation set of annotated query, document, and answer triples for the evaluation criteria (e.g. context relevance, answer faithfulness, and/or answer relevance). There should be at least 50 examples but several hundred examples is ideal.\n    *   A set of few-shot examples for scoring context relevance, answer faithfulness, and/or answer relevance in your system.\n    *   A much larger set of unlabeled query-document-answer triples outputted by your RAG system for scoring.\n*   The figure below from the paper shows an overview of ARES: As inputs, the ARES pipeline requires an in-domain passage set, a human preference validation set of 150 annotated datapoints or more, and five few-shot examples of in-domain queries and answers, which are used for prompting LLMs in synthetic data generation. To prepare our LLM judges for evaluation, we first generate synthetic queries and answers from the corpus passages. Using our generated training triples and a constrastive learning framework, we fine-tune an LLM to classify query–passage–answer triples across three criteria: context relevance, answer faithfulness, and answer relevance. Finally, we use the LLM judge to evaluate RAG systems and generate confidence bounds for the ranking using PPI and the human preference validation set.\n\n1.  **LLM Generation of Synthetic Dataset**: ARES uses generative LLMs (like FLAN-T5 XXL) to create synthetic datasets of question-answer pairs derived from target corpus passages. This stage includes both positive and negative examples for training.\n2.  **Preparing LLM Judges**: Separate lightweight LM models are fine-tuned for three classification tasks - context relevance, answer faithfulness, and answer relevance - using the synthetic dataset. These models are tuned using a contrastive learning objective.\n3.  **Ranking RAG Systems with Confidence Intervals**:\n    *   After preparing the LLM judges, the next step involves using them to score and rank various RAG systems. This process begins with ARES sampling in-domain query-document-answer triples from each RAG approach. The judges then label each triple, assessing context relevance, answer faithfulness, and answer relevance. These labels are averaged for each in-domain triple to evaluate the performance of the RAG systems across the three metrics.\n    *   While average scores could be reported as quality metrics for each RAG system, these scores are based on unlabeled data and predictions from synthetically-trained LLM judges, which may introduce noise. An alternative is to rely solely on a small human preference validation set for evaluation, examining the extent to which each RAG system aligns with human annotations. However, this method requires labeling outputs from each RAG system separately, which can be time-consuming and expensive.\n    *   To enhance the precision of the evaluation, ARES employs prediction-powered inference (PPI). PPI is a statistical method that narrows the confidence interval of predictions on a small annotated dataset by utilizing predictions on a larger, non-annotated dataset. It combines labeled datapoints and ARES judge predictions on non-annotated datapoints to construct tighter confidence intervals for RAG system performance.\n    *   PPI involves using LLM judges on the human preference validation set to learn a rectifier function. This function constructs a confidence set of the ML model’s performance, taking into account each ML prediction in the larger non-annotated dataset. The confidence set helps create a more precise confidence interval for the average performance of the ML model (e.g., its context relevance, answer faithfulness, or answer relevance accuracy). By integrating the human preference validation set with a larger set of datapoints with ML predictions, PPI develops reliable confidence intervals for ML model performance, outperforming traditional inference methods.\n    *   The PPI rectifier function addresses errors made by the LLM judge and generates confidence bounds for the success and failure rates of the RAG system. It estimates performances in context relevance, answer faithfulness, and answer relevance. PPI also allows for estimating confidence intervals with a specified probability level; in these experiments, a standard 95% alpha is used.\n    *   Finally, the accuracy confidence interval for each component of the RAG is determined, and the midpoints of these intervals are used to rank the RAG systems. This ranking enables a comparison of different RAG systems and configurations within the same system, aiding in identifying the optimal approach for a specific domain.\n        *   In summary, ARES employs PPI to score and rank RAG systems, using human preference validation sets to calculate confidence intervals. PPI operates by first generating predictions for a large sample of data points, followed by human annotation of a small subset. These annotations are used to calculate confidence intervals for the entire dataset, ensuring accuracy in the system’s evaluation capabilities.\n\n*   After preparing the LLM judges, the next step involves using them to score and rank various RAG systems. This process begins with ARES sampling in-domain query-document-answer triples from each RAG approach. The judges then label each triple, assessing context relevance, answer faithfulness, and answer relevance. These labels are averaged for each in-domain triple to evaluate the performance of the RAG systems across the three metrics.\n*   While average scores could be reported as quality metrics for each RAG system, these scores are based on unlabeled data and predictions from synthetically-trained LLM judges, which may introduce noise. An alternative is to rely solely on a small human preference validation set for evaluation, examining the extent to which each RAG system aligns with human annotations. However, this method requires labeling outputs from each RAG system separately, which can be time-consuming and expensive.\n*   To enhance the precision of the evaluation, ARES employs prediction-powered inference (PPI). PPI is a statistical method that narrows the confidence interval of predictions on a small annotated dataset by utilizing predictions on a larger, non-annotated dataset. It combines labeled datapoints and ARES judge predictions on non-annotated datapoints to construct tighter confidence intervals for RAG system performance.\n*   PPI involves using LLM judges on the human preference validation set to learn a rectifier function. This function constructs a confidence set of the ML model’s performance, taking into account each ML prediction in the larger non-annotated dataset. The confidence set helps create a more precise confidence interval for the average performance of the ML model (e.g., its context relevance, answer faithfulness, or answer relevance accuracy). By integrating the human preference validation set with a larger set of datapoints with ML predictions, PPI develops reliable confidence intervals for ML model performance, outperforming traditional inference methods.\n*   The PPI rectifier function addresses errors made by the LLM judge and generates confidence bounds for the success and failure rates of the RAG system. It estimates performances in context relevance, answer faithfulness, and answer relevance. PPI also allows for estimating confidence intervals with a specified probability level; in these experiments, a standard 95% alpha is used.\n*   Finally, the accuracy confidence interval for each component of the RAG is determined, and the midpoints of these intervals are used to rank the RAG systems. This ranking enables a comparison of different RAG systems and configurations within the same system, aiding in identifying the optimal approach for a specific domain.\n    *   In summary, ARES employs PPI to score and rank RAG systems, using human preference validation sets to calculate confidence intervals. PPI operates by first generating predictions for a large sample of data points, followed by human annotation of a small subset. These annotations are used to calculate confidence intervals for the entire dataset, ensuring accuracy in the system’s evaluation capabilities.\n\n*   In summary, ARES employs PPI to score and rank RAG systems, using human preference validation sets to calculate confidence intervals. PPI operates by first generating predictions for a large sample of data points, followed by human annotation of a small subset. These annotations are used to calculate confidence intervals for the entire dataset, ensuring accuracy in the system’s evaluation capabilities.\n\n*   A human preference validation set of annotated query, document, and answer triples for the evaluation criteria (e.g. context relevance, answer faithfulness, and/or answer relevance). There should be at least 50 examples but several hundred examples is ideal.\n*   A set of few-shot examples for scoring context relevance, answer faithfulness, and/or answer relevance in your system.\n*   A much larger set of unlabeled query-document-answer triples outputted by your RAG system for scoring.\n\n![](../../../images/papers/ARES.jpg)\n\n*   Experiments conducted on datasets from KILT and SuperGLUE demonstrate ARES’s accuracy in evaluating RAG systems, outperforming existing automated evaluation approaches like RAGAS. ARES is effective across various domains, maintaining accuracy even with domain shifts in queries and documents.\n*   The paper highlights the strengths of ARES in cross-domain applications and its limitations, such as its inability to generalize across drastic domain shifts (e.g., language changes, text-to-code). It also explores the potential of using GPT-4 for generating labels as a replacement for human annotations in the PPI process.\n*   ARES code and datasets are available for replication and deployment at [GitHub](https://github.com/stanford-futuredata/ARES).\n*   [Code](https://github.com/stanford-futuredata/ares)",
    "order": 41,
    "orderInChapter": 8,
    "difficulty": 4,
    "estimatedMinutes": 11,
    "tags": [
      "nlpllms",
      "gpt",
      "llm"
    ],
    "metadata": {
      "hasCode": false,
      "hasMath": false,
      "hasImages": true,
      "wordCount": 2087,
      "contentLength": 15384
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#ares:-an-automated-evaluation-framework-for-retrieval-augmented-generation-systems",
    "scrapedAt": "2025-12-28T11:54:28.279Z"
  },
  {
    "id": "ai-RAG-seven-failure-points-when-engineering-a-retrieval--42",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "Selected Papers",
    "title": "Seven Failure Points When Engineering a Retrieval Augmented Generation System",
    "subtitle": "Selected Papers",
    "contentHtml": "<ul>\n  <li>This technical report by Barnett et al. from the Applied Artificial Intelligence Institute, Deakin University, Australia, explores failure points in the implementation of Retrieval Augmented Generation (RAG) systems. based on three case studies in diverse domains: research, education, and biomedical.</li>\n  <li>RAG systems, which integrate retrieval mechanisms with Large Language Models (LLMs) to generate contextually relevant responses, are scrutinized for their operational challenges. The paper identifies seven key failure points in RAG systems:\n    <ul>\n      <li><strong>FP1 Missing Relevant Content:</strong> The first failure case is when asking a question that cannot be answered from the available documents. In the happy case the RAG system will respond with something like “Sorry, I don’t know”. However, for questions that are related to the content but don’t have answers the system could be fooled into giving a response.</li>\n      <li><strong>FP2 Missed the Top Ranked Documents:</strong> The answer to the question is in the document but did not rank highly enough to be returned to the user. In theory, all documents are ranked and used in the next steps. However, in practice only the top <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-180-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1711\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1712\"><span class=\"mi\" id=\"MathJax-Span-1713\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-180\">K</script> documents are returned where <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-181-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1714\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1715\"><span class=\"mi\" id=\"MathJax-Span-1716\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-181\">K</script> is a value selected based on performance.</li>\n      <li><strong>FP3 Not in Context - Consolidation Strategy Limitations:</strong> Documents with the answer were retrieved from the database but did not make it into the context for generating an answer. This occurs when many documents are returned from the database and a consolidation process takes place to retrieve the answer.</li>\n      <li><strong>FP4 Not Extracted Here:</strong> the answer is present in the context, but the large language model failed to extract out the correct answer. Typically, this occurs when there is too much noise or contradicting information in the context.</li>\n      <li><strong>FP5 Wrong Format:</strong> The question involved extracting information in a certain format such as a table or list and the large language model ignored the instruction.</li>\n      <li><strong>FP6 Incorrect Specificity:</strong> The answer is returned in the response but is not specific enough or is too specific to address the user’s need. This occurs when the RAG system designers have a desired outcome for a given question such as teachers for students. In this case, specific educational content should be provided with answers not just the answer. Incorrect specificity also occurs when users are not sure how to ask a question and are too general.</li>\n      <li><strong>FP7 Incomplete Responses:</strong> Incomplete answers are not incorrect but miss some of the information even though that information was in the context and available for extraction. An example question such as “What are the key points covered in documents A, B and C?” A better approach is to ask these questions separately.</li>\n    </ul>\n  </li>\n  <li>The study also emphasizes the importance of real-time validation and the evolving robustness of RAG systems. It concludes with suggestions for future research directions, highlighting the significance of chunking, embeddings, and the trade-offs between RAG systems and fine-tuning LLMs.</li>\n  <li>The following image from the paper shows the Indexing and Query processes required for creating a Retrieval Augmented Generation (RAG) system. The indexing\nprocess is typically done at development time and queries at runtime. Failure points identified in this study are shown in red boxes. All required stages are underlined.</li>\n</ul>\n<ul>\n      <li><strong>FP1 Missing Relevant Content:</strong> The first failure case is when asking a question that cannot be answered from the available documents. In the happy case the RAG system will respond with something like “Sorry, I don’t know”. However, for questions that are related to the content but don’t have answers the system could be fooled into giving a response.</li>\n      <li><strong>FP2 Missed the Top Ranked Documents:</strong> The answer to the question is in the document but did not rank highly enough to be returned to the user. In theory, all documents are ranked and used in the next steps. However, in practice only the top <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-180-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1711\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1712\"><span class=\"mi\" id=\"MathJax-Span-1713\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-180\">K</script> documents are returned where <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-181-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1714\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1715\"><span class=\"mi\" id=\"MathJax-Span-1716\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-181\">K</script> is a value selected based on performance.</li>\n      <li><strong>FP3 Not in Context - Consolidation Strategy Limitations:</strong> Documents with the answer were retrieved from the database but did not make it into the context for generating an answer. This occurs when many documents are returned from the database and a consolidation process takes place to retrieve the answer.</li>\n      <li><strong>FP4 Not Extracted Here:</strong> the answer is present in the context, but the large language model failed to extract out the correct answer. Typically, this occurs when there is too much noise or contradicting information in the context.</li>\n      <li><strong>FP5 Wrong Format:</strong> The question involved extracting information in a certain format such as a table or list and the large language model ignored the instruction.</li>\n      <li><strong>FP6 Incorrect Specificity:</strong> The answer is returned in the response but is not specific enough or is too specific to address the user’s need. This occurs when the RAG system designers have a desired outcome for a given question such as teachers for students. In this case, specific educational content should be provided with answers not just the answer. Incorrect specificity also occurs when users are not sure how to ask a question and are too general.</li>\n      <li><strong>FP7 Incomplete Responses:</strong> Incomplete answers are not incorrect but miss some of the information even though that information was in the context and available for extraction. An example question such as “What are the key points covered in documents A, B and C?” A better approach is to ask these questions separately.</li>\n    </ul>\n<p><img src=\"../../../images/papers/RAG7.jpg\" alt=\"\"></p>\n<ul>\n  <li>Moreover, the paper provides insights into the challenges faced in implementing RAG systems, such as handling diverse document types, query preprocessing, and the need for continuous calibration and monitoring of these systems. These findings are derived from practical experiences and offer valuable guidance for practitioners in the field.</li>\n</ul>",
    "contentMarkdown": "*   This technical report by Barnett et al. from the Applied Artificial Intelligence Institute, Deakin University, Australia, explores failure points in the implementation of Retrieval Augmented Generation (RAG) systems. based on three case studies in diverse domains: research, education, and biomedical.\n*   RAG systems, which integrate retrieval mechanisms with Large Language Models (LLMs) to generate contextually relevant responses, are scrutinized for their operational challenges. The paper identifies seven key failure points in RAG systems:\n    *   **FP1 Missing Relevant Content:** The first failure case is when asking a question that cannot be answered from the available documents. In the happy case the RAG system will respond with something like “Sorry, I don’t know”. However, for questions that are related to the content but don’t have answers the system could be fooled into giving a response.\n    *   **FP2 Missed the Top Ranked Documents:** The answer to the question is in the document but did not rank highly enough to be returned to the user. In theory, all documents are ranked and used in the next steps. However, in practice only the top KKK documents are returned where KKK is a value selected based on performance.\n    *   **FP3 Not in Context - Consolidation Strategy Limitations:** Documents with the answer were retrieved from the database but did not make it into the context for generating an answer. This occurs when many documents are returned from the database and a consolidation process takes place to retrieve the answer.\n    *   **FP4 Not Extracted Here:** the answer is present in the context, but the large language model failed to extract out the correct answer. Typically, this occurs when there is too much noise or contradicting information in the context.\n    *   **FP5 Wrong Format:** The question involved extracting information in a certain format such as a table or list and the large language model ignored the instruction.\n    *   **FP6 Incorrect Specificity:** The answer is returned in the response but is not specific enough or is too specific to address the user’s need. This occurs when the RAG system designers have a desired outcome for a given question such as teachers for students. In this case, specific educational content should be provided with answers not just the answer. Incorrect specificity also occurs when users are not sure how to ask a question and are too general.\n    *   **FP7 Incomplete Responses:** Incomplete answers are not incorrect but miss some of the information even though that information was in the context and available for extraction. An example question such as “What are the key points covered in documents A, B and C?” A better approach is to ask these questions separately.\n*   The study also emphasizes the importance of real-time validation and the evolving robustness of RAG systems. It concludes with suggestions for future research directions, highlighting the significance of chunking, embeddings, and the trade-offs between RAG systems and fine-tuning LLMs.\n*   The following image from the paper shows the Indexing and Query processes required for creating a Retrieval Augmented Generation (RAG) system. The indexing process is typically done at development time and queries at runtime. Failure points identified in this study are shown in red boxes. All required stages are underlined.\n\n*   **FP1 Missing Relevant Content:** The first failure case is when asking a question that cannot be answered from the available documents. In the happy case the RAG system will respond with something like “Sorry, I don’t know”. However, for questions that are related to the content but don’t have answers the system could be fooled into giving a response.\n*   **FP2 Missed the Top Ranked Documents:** The answer to the question is in the document but did not rank highly enough to be returned to the user. In theory, all documents are ranked and used in the next steps. However, in practice only the top KKK documents are returned where KKK is a value selected based on performance.\n*   **FP3 Not in Context - Consolidation Strategy Limitations:** Documents with the answer were retrieved from the database but did not make it into the context for generating an answer. This occurs when many documents are returned from the database and a consolidation process takes place to retrieve the answer.\n*   **FP4 Not Extracted Here:** the answer is present in the context, but the large language model failed to extract out the correct answer. Typically, this occurs when there is too much noise or contradicting information in the context.\n*   **FP5 Wrong Format:** The question involved extracting information in a certain format such as a table or list and the large language model ignored the instruction.\n*   **FP6 Incorrect Specificity:** The answer is returned in the response but is not specific enough or is too specific to address the user’s need. This occurs when the RAG system designers have a desired outcome for a given question such as teachers for students. In this case, specific educational content should be provided with answers not just the answer. Incorrect specificity also occurs when users are not sure how to ask a question and are too general.\n*   **FP7 Incomplete Responses:** Incomplete answers are not incorrect but miss some of the information even though that information was in the context and available for extraction. An example question such as “What are the key points covered in documents A, B and C?” A better approach is to ask these questions separately.\n\n![](../../../images/papers/RAG7.jpg)\n\n*   Moreover, the paper provides insights into the challenges faced in implementing RAG systems, such as handling diverse document types, query preprocessing, and the need for continuous calibration and monitoring of these systems. These findings are derived from practical experiences and offer valuable guidance for practitioners in the field.",
    "order": 42,
    "orderInChapter": 9,
    "difficulty": 5,
    "estimatedMinutes": 5,
    "tags": [
      "nlpllms",
      "embedding",
      "llm",
      "fine-tuning"
    ],
    "metadata": {
      "hasCode": false,
      "hasMath": true,
      "hasImages": true,
      "wordCount": 947,
      "contentLength": 11477
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#seven-failure-points-when-engineering-a-retrieval-augmented-generation-system",
    "scrapedAt": "2025-12-28T11:54:28.279Z"
  },
  {
    "id": "ai-RAG-raptor-recursive-abstractive-processing-for-tree-o-43",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "Selected Papers",
    "title": "RAPTOR: Recursive Abstractive Processing for Tree-Organized Retrieval",
    "subtitle": "Selected Papers",
    "contentHtml": "<ul>\n  <li>This paper by Sarthi et al. from Manning’s Lab at Stanford, published in ICLR 2024, introduces RAPTOR, a novel approach for retrieval-augmented language models. RAPTOR addresses the limitation of existing retrieval methods that primarily fetch short text chunks, hindering comprehensive document understanding. It constructs a tree by recursively embedding, clustering, and summarizing text chunks, offering multi-level summarization and facilitating efficient information retrieval from extensive documents.</li>\n  <li>At its core, RAPTOR employs a tree structure starting from leaf nodes (text chunks) and builds up to the root through successive clustering and summarization. This method allows the model to access information at various abstraction levels, significantly enhancing performance on complex, multi-step reasoning tasks. When combined with GPT-4, RAPTOR achieved a 20% absolute accuracy improvement on the QuALITY benchmark over previous state-of-the-art models.</li>\n  <li>Some key insights into why using a tree-structure lets your RAG pipeline handle more complex questions:\n    <ol>\n      <li>Cluster semantically related chunks to dynamically identify distinct topics within your documents.</li>\n      <li>Create new chunks by summarizing clusters.</li>\n      <li>Mix high-level and low-level chunks during retrieval, to dynamically surface relevant information depending on the query.</li>\n    </ol>\n  </li>\n  <li>The model utilizes SBERT for embedding text chunks and Gaussian Mixture Models (GMMs) for clustering, allowing flexible groupings of related content. Summarization is performed by a language model (GPT-3.5-turbo), producing summaries that guide the construction of higher tree levels. This recursive process creates a scalable and computationally efficient system that linearly scales in both token expenditure and build time, as detailed in the scalability analysis.</li>\n  <li>Querying within RAPTOR’s tree employs two strategies: tree traversal and collapsed tree, with the latter showing superior flexibility and effectiveness in preliminary tests on the QASPER dataset. The model’s innovative clustering mechanism, highlighted in an ablation study, proves essential for capturing thematic content and outperforms standard retrieval methods.</li>\n  <li>The figure below from the paper shows the tree construction process: RAPTOR recursively clusters chunks of text based on their vector embeddings and generates text summaries of those clusters, constructing a tree from the bottom up. Nodes clustered together are siblings; a parent node contains the text summary of that cluster.</li>\n</ul>\n<ol>\n      <li>Cluster semantically related chunks to dynamically identify distinct topics within your documents.</li>\n      <li>Create new chunks by summarizing clusters.</li>\n      <li>Mix high-level and low-level chunks during retrieval, to dynamically surface relevant information depending on the query.</li>\n    </ol>\n<p><img src=\"../../../images/papers/RAPTOR.jpg\" alt=\"\"></p>\n<ul>\n  <li>Experimental results across various datasets (NarrativeQA, QASPER, QuALITY) demonstrate RAPTOR’s effectiveness, setting new benchmarks and outperforming existing retrieval-augmented models. The paper’s qualitative analysis illustrates RAPTOR’s ability to retrieve relevant information for thematic questions, showcasing its superiority over Dense Passage Retrieval (DPR) methods in handling complex queries.</li>\n  <li>The paper includes a comprehensive reproducibility statement, detailing the use of publicly available language models and datasets, ensuring that the community can replicate and extend upon RAPTOR’s findings.</li>\n</ul>",
    "contentMarkdown": "*   This paper by Sarthi et al. from Manning’s Lab at Stanford, published in ICLR 2024, introduces RAPTOR, a novel approach for retrieval-augmented language models. RAPTOR addresses the limitation of existing retrieval methods that primarily fetch short text chunks, hindering comprehensive document understanding. It constructs a tree by recursively embedding, clustering, and summarizing text chunks, offering multi-level summarization and facilitating efficient information retrieval from extensive documents.\n*   At its core, RAPTOR employs a tree structure starting from leaf nodes (text chunks) and builds up to the root through successive clustering and summarization. This method allows the model to access information at various abstraction levels, significantly enhancing performance on complex, multi-step reasoning tasks. When combined with GPT-4, RAPTOR achieved a 20% absolute accuracy improvement on the QuALITY benchmark over previous state-of-the-art models.\n*   Some key insights into why using a tree-structure lets your RAG pipeline handle more complex questions:\n    1.  Cluster semantically related chunks to dynamically identify distinct topics within your documents.\n    2.  Create new chunks by summarizing clusters.\n    3.  Mix high-level and low-level chunks during retrieval, to dynamically surface relevant information depending on the query.\n*   The model utilizes SBERT for embedding text chunks and Gaussian Mixture Models (GMMs) for clustering, allowing flexible groupings of related content. Summarization is performed by a language model (GPT-3.5-turbo), producing summaries that guide the construction of higher tree levels. This recursive process creates a scalable and computationally efficient system that linearly scales in both token expenditure and build time, as detailed in the scalability analysis.\n*   Querying within RAPTOR’s tree employs two strategies: tree traversal and collapsed tree, with the latter showing superior flexibility and effectiveness in preliminary tests on the QASPER dataset. The model’s innovative clustering mechanism, highlighted in an ablation study, proves essential for capturing thematic content and outperforms standard retrieval methods.\n*   The figure below from the paper shows the tree construction process: RAPTOR recursively clusters chunks of text based on their vector embeddings and generates text summaries of those clusters, constructing a tree from the bottom up. Nodes clustered together are siblings; a parent node contains the text summary of that cluster.\n\n1.  Cluster semantically related chunks to dynamically identify distinct topics within your documents.\n2.  Create new chunks by summarizing clusters.\n3.  Mix high-level and low-level chunks during retrieval, to dynamically surface relevant information depending on the query.\n\n![](../../../images/papers/RAPTOR.jpg)\n\n*   Experimental results across various datasets (NarrativeQA, QASPER, QuALITY) demonstrate RAPTOR’s effectiveness, setting new benchmarks and outperforming existing retrieval-augmented models. The paper’s qualitative analysis illustrates RAPTOR’s ability to retrieve relevant information for thematic questions, showcasing its superiority over Dense Passage Retrieval (DPR) methods in handling complex queries.\n*   The paper includes a comprehensive reproducibility statement, detailing the use of publicly available language models and datasets, ensuring that the community can replicate and extend upon RAPTOR’s findings.",
    "order": 43,
    "orderInChapter": 10,
    "difficulty": 4,
    "estimatedMinutes": 3,
    "tags": [
      "nlpllms",
      "embedding",
      "bert",
      "gpt"
    ],
    "metadata": {
      "hasCode": false,
      "hasMath": false,
      "hasImages": true,
      "wordCount": 466,
      "contentLength": 3677
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#raptor:-recursive-abstractive-processing-for-tree-organized-retrieval",
    "scrapedAt": "2025-12-28T11:54:28.279Z"
  },
  {
    "id": "ai-RAG-the-power-of-noise-redefining-retrieval-for-rag-sy-44",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "Selected Papers",
    "title": "The Power of Noise: Redefining Retrieval for RAG Systems",
    "subtitle": "Selected Papers",
    "contentHtml": "<ul>\n  <li>This paper by Cuconasu et al. from Sapienza University of Rome, Technology Innovation Institute, and University of Pisa introduces a comprehensive study on Retrieval-Augmented Generation (RAG) systems, highlighting the significant influence of Information Retrieval (IR) components on RAG’s performance, beyond the generative abilities of Large Language Models (LLMs).</li>\n  <li>Their research investigates the characteristics required in a retriever for optimal RAG prompt formulation, emphasizing the balance between relevant, related, and irrelevant documents.</li>\n  <li>The study reveals that including irrelevant documents surprisingly enhances RAG system performance by over 30% in accuracy, challenging the assumption that only relevant and related documents should be retrieved. This finding underscores the potential of integrating seemingly noise-adding strategies to improve RAG system outputs, thereby laying the groundwork for future research in IR and language model integration.</li>\n  <li>The experimental methodology employed involves a detailed examination of the Natural Questions dataset, testing various configurations of document relevance and placement within the RAG prompt. This methodological rigor allows the researchers to dissect the impact of document type (gold, relevant, related, irrelevant) and position on the accuracy of RAG system responses, with attention to how these factors influence LLM’s generative performance.</li>\n  <li>Insights from the experiments led to the formulation of strategies for optimizing RAG systems, proposing a nuanced approach to document retrieval that includes a mix of relevant and intentionally irrelevant documents. This approach aims to maximize system performance within the context size constraints of LLMs, offering a novel perspective on the integration of retrieval processes with generative language models for enhanced factual accuracy and context awareness.</li>\n  <li>The study’s findings challenge traditional IR strategies and suggest a paradigm shift towards the inclusion of controlled noise in the retrieval process for language generation tasks. The researchers advocate for further exploration into the mechanisms by which irrelevant documents improve RAG system performance, highlighting the need for new IR techniques tailored to the unique demands of language generation models.</li>\n</ul>",
    "contentMarkdown": "*   This paper by Cuconasu et al. from Sapienza University of Rome, Technology Innovation Institute, and University of Pisa introduces a comprehensive study on Retrieval-Augmented Generation (RAG) systems, highlighting the significant influence of Information Retrieval (IR) components on RAG’s performance, beyond the generative abilities of Large Language Models (LLMs).\n*   Their research investigates the characteristics required in a retriever for optimal RAG prompt formulation, emphasizing the balance between relevant, related, and irrelevant documents.\n*   The study reveals that including irrelevant documents surprisingly enhances RAG system performance by over 30% in accuracy, challenging the assumption that only relevant and related documents should be retrieved. This finding underscores the potential of integrating seemingly noise-adding strategies to improve RAG system outputs, thereby laying the groundwork for future research in IR and language model integration.\n*   The experimental methodology employed involves a detailed examination of the Natural Questions dataset, testing various configurations of document relevance and placement within the RAG prompt. This methodological rigor allows the researchers to dissect the impact of document type (gold, relevant, related, irrelevant) and position on the accuracy of RAG system responses, with attention to how these factors influence LLM’s generative performance.\n*   Insights from the experiments led to the formulation of strategies for optimizing RAG systems, proposing a nuanced approach to document retrieval that includes a mix of relevant and intentionally irrelevant documents. This approach aims to maximize system performance within the context size constraints of LLMs, offering a novel perspective on the integration of retrieval processes with generative language models for enhanced factual accuracy and context awareness.\n*   The study’s findings challenge traditional IR strategies and suggest a paradigm shift towards the inclusion of controlled noise in the retrieval process for language generation tasks. The researchers advocate for further exploration into the mechanisms by which irrelevant documents improve RAG system performance, highlighting the need for new IR techniques tailored to the unique demands of language generation models.",
    "order": 44,
    "orderInChapter": 11,
    "difficulty": 4,
    "estimatedMinutes": 2,
    "tags": [
      "nlpllms",
      "attention",
      "llm"
    ],
    "metadata": {
      "hasCode": false,
      "hasMath": false,
      "hasImages": false,
      "wordCount": 320,
      "contentLength": 2390
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#the-power-of-noise:-redefining-retrieval-for-rag-systems",
    "scrapedAt": "2025-12-28T11:54:28.279Z"
  },
  {
    "id": "ai-RAG-multihop-rag-benchmarking-retrieval-augmented-gene-45",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "Selected Papers",
    "title": "MultiHop-RAG: Benchmarking Retrieval-Augmented Generation for Multi-Hop Queries",
    "subtitle": "Selected Papers",
    "contentHtml": "<ul>\n  <li>This paper by Tang et al. from the Hong Kong University of Science and Technology introduces MultiHop-RAG, a novel dataset and benchmark for evaluating Retrieval-Augmented Generation (RAG) systems on multi-hop queries. These queries necessitate retrieving and reasoning over multiple pieces of evidence, a challenge not adequately addressed by existing RAG systems.</li>\n  <li>MultiHop-RAG consists of a knowledge base derived from English news articles, multi-hop queries, their answers, and the supporting evidence required for those answers. This dataset aims to mimic real-world applications where complex queries involving multiple pieces of information are common.</li>\n  <li>The figure below from the paper shows the RAG flow with a multi-hop query.</li>\n</ul>\n<p><img src=\"../../../images/papers/MultiHop-RAG.jpg\" alt=\"\"></p>\n<ul>\n  <li>The authors categorize multi-hop queries into four types: Inference, Comparison, Temporal, and Null queries. The first three types — Inference, Comparison, and Temporal — require the retrieval and analysis of evidence from multiple sources, encompassing tasks like inferring relationships, comparing data points, and sequencing events over time. The Null query represents a scenario where the query cannot be derived from the knowledge base. This category is crucial for assessing whether an LLM might hallucinate an answer to a multi-hop query when the retrieved text lacks relevance. Each type requires a distinct retrieval and reasoning strategy over the evidence, with Null queries designed to test the model’s ability to refrain from generating an answer when the query cannot be resolved with the available knowledge.</li>\n  <li>They define a multi-hop query as one that requires retrieving and reasoning over multiple pieces of supporting evidence to provide an answer. In other words, for a multi-hop query <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-182-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>q</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1717\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.555em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1718\"><span class=\"mi\" id=\"MathJax-Span-1719\" style=\"font-family: STIXGeneral-Italic;\">q</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.878em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>q</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-182\">q</script>, the chunks in the retrieval set <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-183-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;>R</mi></mrow><mi>q</mi></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1720\" style=\"width: 1.565em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.305em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1001.3em, 2.607em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1721\"><span class=\"msubsup\" id=\"MathJax-Span-1722\"><span style=\"display: inline-block; position: relative; width: 1.305em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.84em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"texatom\" id=\"MathJax-Span-1723\"><span class=\"mrow\" id=\"MathJax-Span-1724\"><span class=\"mi\" id=\"MathJax-Span-1725\" style=\"font-family: STIXNonUnicode-Italic;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mi\" id=\"MathJax-Span-1726\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">q</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.253em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mrow class=\"MJX-TeXAtom-ORD\"><mi class=\"MJX-tex-caligraphic\" mathvariant=\"script\">R</mi></mrow><mi>q</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-183\">\\mathcal{R}_q</script> collectively provide an answer to <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-184-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>q</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1727\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.555em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1728\"><span class=\"mi\" id=\"MathJax-Span-1729\" style=\"font-family: STIXGeneral-Italic;\">q</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.878em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>q</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-184\">q</script>. For example, the query “Which company among Google, Apple, and Nvidia reported the largest profit margins in their third-quarter reports for 2023?” requires 1) retrieving relevant pieces of evidence related to profit margins from the reports of the three companies; 2) generating an answer by comparing and reasoning from the multiple pieces of retrieved evidence. This differs from a singlehop query such as “What is Google’s profit margin in the third-quarter reports for 2023 ,” where the answer can be directly derived from a single piece of evidence.</li>\n  <li>Based on the queries commonly used in realworld RAG systems, they identify four types of multi-hop queries. For each type, they present a hypothetical query within the context of a financial RAG system, where the knowledge base consists of a collection of annual reports.\n    <ul>\n      <li><strong>Inference query:</strong> For such a query <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-185-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>q</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1730\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.555em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1731\"><span class=\"mi\" id=\"MathJax-Span-1732\" style=\"font-family: STIXGeneral-Italic;\">q</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.878em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>q</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-185\">q</script>, the answer is deduced through reasoning from the retrieval set <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-186-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;>R</mi></mrow><mi>q</mi></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1733\" style=\"width: 1.565em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.305em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1001.3em, 2.607em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1734\"><span class=\"msubsup\" id=\"MathJax-Span-1735\"><span style=\"display: inline-block; position: relative; width: 1.305em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.84em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"texatom\" id=\"MathJax-Span-1736\"><span class=\"mrow\" id=\"MathJax-Span-1737\"><span class=\"mi\" id=\"MathJax-Span-1738\" style=\"font-family: STIXNonUnicode-Italic;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mi\" id=\"MathJax-Span-1739\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">q</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.253em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mrow class=\"MJX-TeXAtom-ORD\"><mi class=\"MJX-tex-caligraphic\" mathvariant=\"script\">R</mi></mrow><mi>q</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-186\">\\mathcal{R}_q</script>. An example of an inference query might be: Which report discusses the supply chain risk of Apple, the 2019 annual report or the 2020 annual report?</li>\n      <li><strong>Comparison query:</strong> For such a query <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-187-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>q</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1740\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.555em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1741\"><span class=\"mi\" id=\"MathJax-Span-1742\" style=\"font-family: STIXGeneral-Italic;\">q</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.878em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>q</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-187\">q</script>, the answer requires a comparison of evidence within the retrieval set <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-188-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;>R</mi></mrow><mi>q</mi></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1743\" style=\"width: 1.565em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.305em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1001.3em, 2.607em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1744\"><span class=\"msubsup\" id=\"MathJax-Span-1745\"><span style=\"display: inline-block; position: relative; width: 1.305em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.84em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"texatom\" id=\"MathJax-Span-1746\"><span class=\"mrow\" id=\"MathJax-Span-1747\"><span class=\"mi\" id=\"MathJax-Span-1748\" style=\"font-family: STIXNonUnicode-Italic;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mi\" id=\"MathJax-Span-1749\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">q</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.253em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mrow class=\"MJX-TeXAtom-ORD\"><mi class=\"MJX-tex-caligraphic\" mathvariant=\"script\">R</mi></mrow><mi>q</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-188\">\\mathcal{R}_q</script>. For instance, a comparison query might ask: Did Netflix or Google report higher revenue for the year 2023?”</li>\n      <li><strong>Temporal query:</strong> For such a query <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-189-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>q</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1750\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.555em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1751\"><span class=\"mi\" id=\"MathJax-Span-1752\" style=\"font-family: STIXGeneral-Italic;\">q</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.878em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>q</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-189\">q</script>, the answer requires an analysis of the temporal information of the retrieved chunks. For example, a temporal query may ask: Did Apple introduce the AirTag tracking device before or after the launch of the 5th generation iPad Pro?</li>\n      <li><strong>Null query:</strong> For such as query <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-190-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>q</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1753\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.555em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1754\"><span class=\"mi\" id=\"MathJax-Span-1755\" style=\"font-family: STIXGeneral-Italic;\">q</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.878em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>q</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-190\">q</script>, the answer cannot be derived from the retrieved set <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-191-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;>R</mi></mrow><mi>q</mi></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1756\" style=\"width: 1.565em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.305em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1001.3em, 2.607em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1757\"><span class=\"msubsup\" id=\"MathJax-Span-1758\"><span style=\"display: inline-block; position: relative; width: 1.305em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.84em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"texatom\" id=\"MathJax-Span-1759\"><span class=\"mrow\" id=\"MathJax-Span-1760\"><span class=\"mi\" id=\"MathJax-Span-1761\" style=\"font-family: STIXNonUnicode-Italic;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mi\" id=\"MathJax-Span-1762\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">q</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.253em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mrow class=\"MJX-TeXAtom-ORD\"><mi class=\"MJX-tex-caligraphic\" mathvariant=\"script\">R</mi></mrow><mi>q</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-191\">\\mathcal{R}_q</script>. They include the null query to assess the generation quality, especially regarding the issue of hallucination. For a null query, even though a retrieved set is provided, an LLM should produce a null response instead of hallucinating an answer. For example, assuming ABCS is a non-existent company, a null query might ask: What are the sales of company ABCS as reported in its 2022 and 2023 annual reports?</li>\n    </ul>\n  </li>\n  <li>The dataset was created using GPT-4 to generate multi-hop queries from a pool of factual sentences extracted from news articles. The queries were then validated for quality and relevance. This process ensures the dataset’s utility in benchmarking the capability of RAG systems to handle complex queries beyond the capacity of current systems.</li>\n  <li>Experimental results demonstrate that existing RAG methods struggle with multi-hop query retrieval and answering, underscoring the necessity for advancements in this area. The benchmarking also explores the effectiveness of different embedding models for evidence retrieval and the reasoning capabilities of various state-of-the-art Large Language Models (LLMs) including GPT-4, PaLM, and Llama2-70B, revealing significant room for improvement.</li>\n  <li>The authors hope that MultiHop-RAG will encourage further research and development in RAG systems, particularly those capable of sophisticated multi-hop reasoning, thereby enhancing the practical utility of LLMs in complex information-seeking tasks.</li>\n  <li><a href=\"https://github.com/yixuantt/MultiHop-RAG/\">Code</a></li>\n</ul>\n<ul>\n      <li><strong>Inference query:</strong> For such a query <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-185-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>q</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1730\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.555em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1731\"><span class=\"mi\" id=\"MathJax-Span-1732\" style=\"font-family: STIXGeneral-Italic;\">q</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.878em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>q</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-185\">q</script>, the answer is deduced through reasoning from the retrieval set <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-186-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;>R</mi></mrow><mi>q</mi></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1733\" style=\"width: 1.565em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.305em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1001.3em, 2.607em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1734\"><span class=\"msubsup\" id=\"MathJax-Span-1735\"><span style=\"display: inline-block; position: relative; width: 1.305em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.84em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"texatom\" id=\"MathJax-Span-1736\"><span class=\"mrow\" id=\"MathJax-Span-1737\"><span class=\"mi\" id=\"MathJax-Span-1738\" style=\"font-family: STIXNonUnicode-Italic;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mi\" id=\"MathJax-Span-1739\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">q</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.253em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mrow class=\"MJX-TeXAtom-ORD\"><mi class=\"MJX-tex-caligraphic\" mathvariant=\"script\">R</mi></mrow><mi>q</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-186\">\\mathcal{R}_q</script>. An example of an inference query might be: Which report discusses the supply chain risk of Apple, the 2019 annual report or the 2020 annual report?</li>\n      <li><strong>Comparison query:</strong> For such a query <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-187-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>q</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1740\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.555em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1741\"><span class=\"mi\" id=\"MathJax-Span-1742\" style=\"font-family: STIXGeneral-Italic;\">q</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.878em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>q</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-187\">q</script>, the answer requires a comparison of evidence within the retrieval set <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-188-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;>R</mi></mrow><mi>q</mi></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1743\" style=\"width: 1.565em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.305em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1001.3em, 2.607em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1744\"><span class=\"msubsup\" id=\"MathJax-Span-1745\"><span style=\"display: inline-block; position: relative; width: 1.305em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.84em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"texatom\" id=\"MathJax-Span-1746\"><span class=\"mrow\" id=\"MathJax-Span-1747\"><span class=\"mi\" id=\"MathJax-Span-1748\" style=\"font-family: STIXNonUnicode-Italic;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mi\" id=\"MathJax-Span-1749\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">q</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.253em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mrow class=\"MJX-TeXAtom-ORD\"><mi class=\"MJX-tex-caligraphic\" mathvariant=\"script\">R</mi></mrow><mi>q</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-188\">\\mathcal{R}_q</script>. For instance, a comparison query might ask: Did Netflix or Google report higher revenue for the year 2023?”</li>\n      <li><strong>Temporal query:</strong> For such a query <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-189-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>q</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1750\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.555em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1751\"><span class=\"mi\" id=\"MathJax-Span-1752\" style=\"font-family: STIXGeneral-Italic;\">q</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.878em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>q</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-189\">q</script>, the answer requires an analysis of the temporal information of the retrieved chunks. For example, a temporal query may ask: Did Apple introduce the AirTag tracking device before or after the launch of the 5th generation iPad Pro?</li>\n      <li><strong>Null query:</strong> For such as query <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-190-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>q</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1753\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.555em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1754\"><span class=\"mi\" id=\"MathJax-Span-1755\" style=\"font-family: STIXGeneral-Italic;\">q</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.878em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>q</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-190\">q</script>, the answer cannot be derived from the retrieved set <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-191-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;>R</mi></mrow><mi>q</mi></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1756\" style=\"width: 1.565em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.305em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1001.3em, 2.607em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1757\"><span class=\"msubsup\" id=\"MathJax-Span-1758\"><span style=\"display: inline-block; position: relative; width: 1.305em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.84em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"texatom\" id=\"MathJax-Span-1759\"><span class=\"mrow\" id=\"MathJax-Span-1760\"><span class=\"mi\" id=\"MathJax-Span-1761\" style=\"font-family: STIXNonUnicode-Italic;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mi\" id=\"MathJax-Span-1762\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">q</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.253em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mrow class=\"MJX-TeXAtom-ORD\"><mi class=\"MJX-tex-caligraphic\" mathvariant=\"script\">R</mi></mrow><mi>q</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-191\">\\mathcal{R}_q</script>. They include the null query to assess the generation quality, especially regarding the issue of hallucination. For a null query, even though a retrieved set is provided, an LLM should produce a null response instead of hallucinating an answer. For example, assuming ABCS is a non-existent company, a null query might ask: What are the sales of company ABCS as reported in its 2022 and 2023 annual reports?</li>\n    </ul>",
    "contentMarkdown": "*   This paper by Tang et al. from the Hong Kong University of Science and Technology introduces MultiHop-RAG, a novel dataset and benchmark for evaluating Retrieval-Augmented Generation (RAG) systems on multi-hop queries. These queries necessitate retrieving and reasoning over multiple pieces of evidence, a challenge not adequately addressed by existing RAG systems.\n*   MultiHop-RAG consists of a knowledge base derived from English news articles, multi-hop queries, their answers, and the supporting evidence required for those answers. This dataset aims to mimic real-world applications where complex queries involving multiple pieces of information are common.\n*   The figure below from the paper shows the RAG flow with a multi-hop query.\n\n![](../../../images/papers/MultiHop-RAG.jpg)\n\n*   The authors categorize multi-hop queries into four types: Inference, Comparison, Temporal, and Null queries. The first three types — Inference, Comparison, and Temporal — require the retrieval and analysis of evidence from multiple sources, encompassing tasks like inferring relationships, comparing data points, and sequencing events over time. The Null query represents a scenario where the query cannot be derived from the knowledge base. This category is crucial for assessing whether an LLM might hallucinate an answer to a multi-hop query when the retrieved text lacks relevance. Each type requires a distinct retrieval and reasoning strategy over the evidence, with Null queries designed to test the model’s ability to refrain from generating an answer when the query cannot be resolved with the available knowledge.\n*   They define a multi-hop query as one that requires retrieving and reasoning over multiple pieces of supporting evidence to provide an answer. In other words, for a multi-hop query qqq, the chunks in the retrieval set qRq\\\\mathcal{R}\\_q collectively provide an answer to qqq. For example, the query “Which company among Google, Apple, and Nvidia reported the largest profit margins in their third-quarter reports for 2023?” requires 1) retrieving relevant pieces of evidence related to profit margins from the reports of the three companies; 2) generating an answer by comparing and reasoning from the multiple pieces of retrieved evidence. This differs from a singlehop query such as “What is Google’s profit margin in the third-quarter reports for 2023 ,” where the answer can be directly derived from a single piece of evidence.\n*   Based on the queries commonly used in realworld RAG systems, they identify four types of multi-hop queries. For each type, they present a hypothetical query within the context of a financial RAG system, where the knowledge base consists of a collection of annual reports.\n    *   **Inference query:** For such a query qqq, the answer is deduced through reasoning from the retrieval set qRq\\\\mathcal{R}\\_q. An example of an inference query might be: Which report discusses the supply chain risk of Apple, the 2019 annual report or the 2020 annual report?\n    *   **Comparison query:** For such a query qqq, the answer requires a comparison of evidence within the retrieval set qRq\\\\mathcal{R}\\_q. For instance, a comparison query might ask: Did Netflix or Google report higher revenue for the year 2023?”\n    *   **Temporal query:** For such a query qqq, the answer requires an analysis of the temporal information of the retrieved chunks. For example, a temporal query may ask: Did Apple introduce the AirTag tracking device before or after the launch of the 5th generation iPad Pro?\n    *   **Null query:** For such as query qqq, the answer cannot be derived from the retrieved set qRq\\\\mathcal{R}\\_q. They include the null query to assess the generation quality, especially regarding the issue of hallucination. For a null query, even though a retrieved set is provided, an LLM should produce a null response instead of hallucinating an answer. For example, assuming ABCS is a non-existent company, a null query might ask: What are the sales of company ABCS as reported in its 2022 and 2023 annual reports?\n*   The dataset was created using GPT-4 to generate multi-hop queries from a pool of factual sentences extracted from news articles. The queries were then validated for quality and relevance. This process ensures the dataset’s utility in benchmarking the capability of RAG systems to handle complex queries beyond the capacity of current systems.\n*   Experimental results demonstrate that existing RAG methods struggle with multi-hop query retrieval and answering, underscoring the necessity for advancements in this area. The benchmarking also explores the effectiveness of different embedding models for evidence retrieval and the reasoning capabilities of various state-of-the-art Large Language Models (LLMs) including GPT-4, PaLM, and Llama2-70B, revealing significant room for improvement.\n*   The authors hope that MultiHop-RAG will encourage further research and development in RAG systems, particularly those capable of sophisticated multi-hop reasoning, thereby enhancing the practical utility of LLMs in complex information-seeking tasks.\n*   [Code](https://github.com/yixuantt/MultiHop-RAG/)\n\n*   **Inference query:** For such a query qqq, the answer is deduced through reasoning from the retrieval set qRq\\\\mathcal{R}\\_q. An example of an inference query might be: Which report discusses the supply chain risk of Apple, the 2019 annual report or the 2020 annual report?\n*   **Comparison query:** For such a query qqq, the answer requires a comparison of evidence within the retrieval set qRq\\\\mathcal{R}\\_q. For instance, a comparison query might ask: Did Netflix or Google report higher revenue for the year 2023?”\n*   **Temporal query:** For such a query qqq, the answer requires an analysis of the temporal information of the retrieved chunks. For example, a temporal query may ask: Did Apple introduce the AirTag tracking device before or after the launch of the 5th generation iPad Pro?\n*   **Null query:** For such as query qqq, the answer cannot be derived from the retrieved set qRq\\\\mathcal{R}\\_q. They include the null query to assess the generation quality, especially regarding the issue of hallucination. For a null query, even though a retrieved set is provided, an LLM should produce a null response instead of hallucinating an answer. For example, assuming ABCS is a non-existent company, a null query might ask: What are the sales of company ABCS as reported in its 2022 and 2023 annual reports?",
    "order": 45,
    "orderInChapter": 12,
    "difficulty": 5,
    "estimatedMinutes": 5,
    "tags": [
      "nlpllms",
      "embedding",
      "gpt",
      "llm"
    ],
    "metadata": {
      "hasCode": false,
      "hasMath": true,
      "hasImages": true,
      "wordCount": 985,
      "contentLength": 33465
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#multihop-rag:-benchmarking-retrieval-augmented-generation-for-multi-hop-queries",
    "scrapedAt": "2025-12-28T11:54:28.279Z"
  },
  {
    "id": "ai-RAG-rag-vs-fine-tuning-pipelines-tradeoffs-and-a-case--46",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "Selected Papers",
    "title": "RAG vs. Fine-tuning: Pipelines, Tradeoffs, and a Case Study on Agriculture",
    "subtitle": "Selected Papers",
    "contentHtml": "<ul>\n  <li>This paper by Balaguer et al. from Microsoft, delves into two prevalent approaches for incorporating proprietary and domain-specific data into Large Language Models (LLMs): Retrieval-Augmented Generation (RAG) and Fine-Tuning. RAG augments prompts with external data, whereas Fine-Tuning embeds additional knowledge directly into the model. The paper outlines a comprehensive pipeline for both approaches, evaluating their effectiveness on multiple popular LLMs including Llama2-13B, GPT-3.5, and GPT-4.</li>\n  <li>The research particularly focuses on agriculture, an industry with relatively limited AI penetration, proposing a disruptive application: providing location-specific insights to farmers. The pipeline stages include data acquisition, PDF information extraction, question and answer generation using this data, and leveraging GPT-4 for result evaluation. Metrics are introduced to assess the performance of the RAG and Fine-Tuning pipeline stages.</li>\n  <li>The figure below from the paper shows the methodology pipeline. Domain-specific datasets are collected, and the content and structure of the documents are extracted. This information is then fed to the Q&amp;A generation step. Synthesized question-answer pairs are used to fine-tune the LLMs. Models are evaluated with and without RAG under different GPT-4-based metrics.</li>\n</ul>\n<p><img src=\"../../../images/papers/RAGvsFT2.jpg\" alt=\"\"></p>\n<ul>\n  <li>Experimental results from an agricultural dataset highlight the pipeline’s capability in capturing geography-specific knowledge. Fine-Tuning demonstrated a significant accuracy increase of over 6 percentage points, a benefit that accumulates with RAG, further enhancing accuracy by 5 percentage points. One experiment showcased the fine-tuned model’s ability to leverage information across geographies to answer specific questions, boosting answer similarity from 47% to 72%.</li>\n  <li>The paper presents an in-depth comparison of answers from GPT-4, Bing Chat, and agronomist experts to the same query across different U.S. states, revealing the models’ generic responses versus the experts’ nuanced, location-specific answers. This comparative analysis underscores the potential of fine-tuning and RAG in producing more contextually appropriate responses for industry-specific applications.</li>\n  <li>The proposed methodology aims at generating domain-specific questions and answers to create a valuable knowledge resource for industries requiring specific contextual and adaptive responses. Through an extensive evaluation involving benchmarks from major agriculture-producing countries, the study establishes a baseline understanding of model performance in the agricultural context and explores the impact of spatial shift on knowledge encoding and the benefits of spatially-scoped fine-tuning.</li>\n  <li>Additionally, the research investigates the implications of retrieval techniques and fine-tuning on LLM performance. It identifies RAG as particularly effective in contexts requiring domain-specific knowledge and fine-tuning as beneficial for imparting new skills to models, albeit at a higher initial cost. This work serves as a foundation for applying RAG and fine-tuning techniques across industries, demonstrating their utility in enhancing model efficiency from the Q&amp;A generation process onwards.</li>\n</ul>",
    "contentMarkdown": "*   This paper by Balaguer et al. from Microsoft, delves into two prevalent approaches for incorporating proprietary and domain-specific data into Large Language Models (LLMs): Retrieval-Augmented Generation (RAG) and Fine-Tuning. RAG augments prompts with external data, whereas Fine-Tuning embeds additional knowledge directly into the model. The paper outlines a comprehensive pipeline for both approaches, evaluating their effectiveness on multiple popular LLMs including Llama2-13B, GPT-3.5, and GPT-4.\n*   The research particularly focuses on agriculture, an industry with relatively limited AI penetration, proposing a disruptive application: providing location-specific insights to farmers. The pipeline stages include data acquisition, PDF information extraction, question and answer generation using this data, and leveraging GPT-4 for result evaluation. Metrics are introduced to assess the performance of the RAG and Fine-Tuning pipeline stages.\n*   The figure below from the paper shows the methodology pipeline. Domain-specific datasets are collected, and the content and structure of the documents are extracted. This information is then fed to the Q&A generation step. Synthesized question-answer pairs are used to fine-tune the LLMs. Models are evaluated with and without RAG under different GPT-4-based metrics.\n\n![](../../../images/papers/RAGvsFT2.jpg)\n\n*   Experimental results from an agricultural dataset highlight the pipeline’s capability in capturing geography-specific knowledge. Fine-Tuning demonstrated a significant accuracy increase of over 6 percentage points, a benefit that accumulates with RAG, further enhancing accuracy by 5 percentage points. One experiment showcased the fine-tuned model’s ability to leverage information across geographies to answer specific questions, boosting answer similarity from 47% to 72%.\n*   The paper presents an in-depth comparison of answers from GPT-4, Bing Chat, and agronomist experts to the same query across different U.S. states, revealing the models’ generic responses versus the experts’ nuanced, location-specific answers. This comparative analysis underscores the potential of fine-tuning and RAG in producing more contextually appropriate responses for industry-specific applications.\n*   The proposed methodology aims at generating domain-specific questions and answers to create a valuable knowledge resource for industries requiring specific contextual and adaptive responses. Through an extensive evaluation involving benchmarks from major agriculture-producing countries, the study establishes a baseline understanding of model performance in the agricultural context and explores the impact of spatial shift on knowledge encoding and the benefits of spatially-scoped fine-tuning.\n*   Additionally, the research investigates the implications of retrieval techniques and fine-tuning on LLM performance. It identifies RAG as particularly effective in contexts requiring domain-specific knowledge and fine-tuning as beneficial for imparting new skills to models, albeit at a higher initial cost. This work serves as a foundation for applying RAG and fine-tuning techniques across industries, demonstrating their utility in enhancing model efficiency from the Q&A generation process onwards.",
    "order": 46,
    "orderInChapter": 13,
    "difficulty": 4,
    "estimatedMinutes": 3,
    "tags": [
      "nlpllms",
      "gpt",
      "llm",
      "fine-tuning"
    ],
    "metadata": {
      "hasCode": false,
      "hasMath": false,
      "hasImages": true,
      "wordCount": 430,
      "contentLength": 3369
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#rag-vs.-fine-tuning:-pipelines,-tradeoffs,-and-a-case-study-on-agriculture",
    "scrapedAt": "2025-12-28T11:54:28.279Z"
  },
  {
    "id": "ai-RAG-raft-adapting-language-model-to-domain-specific-ra-47",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "Selected Papers",
    "title": "RAFT: Adapting Language Model to Domain Specific RAG",
    "subtitle": "Selected Papers",
    "contentHtml": "<ul>\n  <li>This paper by Zhang et al. from UC Berkeley introduces Retrieval Augmented Fine Tuning (RAFT) as a method to adapt pre-trained Large Language Models (LLMs) for domain-specific Retrieval Augmented Generation (RAG), focusing on “open-book” in-domain settings. By training the model to identify and ignore distractor documents while citing relevant information from pertinent documents, RAFT enhances the model’s reasoning capability and its ability to answer questions based on a specific set of documents.</li>\n  <li>The concept draws an analogy to preparing for an open-book exam, where RAFT simulates the conditions of such an exam by incorporating both relevant and irrelevant (distractor) documents during training. This contrasts with existing methods that either do not leverage the opportunity to learn from domain-specific documents or fail to prepare the model for the dynamics of RAG in an open-book test setting.</li>\n  <li>The figure below from the paper draws an analogy to how best to prepare for an exam? (a) Fine-tuning based approaches implement “studying” by either directly “memorizing” the input documents or answering practice QA without referencing the documents. (b) Alternatively, incontext retrieval methods fail to leverage the learning opportunity afforded by the fixed domain and are equivalent to taking an open-book exam without studying. While these approaches leverage in-domain learning, they fail to prepare for open-book tests. In contrast, (c) RAFT leverages fine-tuning with question-answer pairs while referencing the documents in a simulated imperfect retrieval setting — thereby effectively preparing for the open-book exam setting.</li>\n</ul>\n<p><img src=\"../../../images/papers/RAFT.jpg\" alt=\"\"></p>\n<ul>\n  <li>The methodology involves creating training data that includes a question, a set of documents (with one or more being relevant to the question), and a CoT-style answer derived from the relevant document(s). The paper explores the impact of including distractor documents in the training set and the proportion of training data that should contain the oracle document.</li>\n  <li>The figure below from the paper shows an overview of RAFT. The top-left figure depicts our approach of adapting LLMs to reading solution from a set of positive and negative documents in contrast to standard RAG setup where models are trained based on the retriever outputs, which is a mixture of both memorization and reading. At test time, all methods follow the standard RAG setting, provided with a top-k retrieved documents in the context.</li>\n</ul>\n<p><img src=\"../../../images/papers/RAFT2.jpg\" alt=\"\"></p>\n<ul>\n  <li>Experiments conducted across PubMed, HotpotQA, and Gorilla datasets demonstrate RAFT’s effectiveness. It consistently outperforms both supervised fine-tuning and RAG across these datasets, particularly highlighting the importance of the chain-of-thought (CoT) style responses in improving model performance.</li>\n  <li>Results from various experiments indicate that mixing a fraction of the training data without the oracle document in its context is beneficial for in-domain RAG tasks. Moreover, training with a balance of relevant and irrelevant documents at test time shows that RAFT can generalize well to different numbers of retrieved documents, enhancing robustness against inaccuracies in retrieval.</li>\n  <li>RAFT’s approach is compared against several baselines, including LLaMA-7B with and without RAG, domain-specific fine-tuning with 0-shot prompting (DSF), and DSF with RAG. Across different datasets, RAFT demonstrates significant improvements, underscoring its potential in domain-specific applications.</li>\n  <li>The paper also discusses related works, highlighting advancements in retrieval-augmented language models, memorization versus generalization in LLMs, and fine-tuning strategies for adapting LLMs to specific tasks. RAFT’s contribution lies in its focus on preparing LLMs for domain-specific RAG by effectively leveraging both relevant and distractor documents during training.</li>\n  <li>The study posits RAFT as a valuable strategy for adapting pre-trained LLMs to domain-specific tasks, especially where leveraging external documents is crucial. By training models to discern relevant information from distractors and generating CoT-style answers, RAFT significantly enhances the model’s ability to perform in open-book exam settings, paving the way for more nuanced and effective domain-specific applications of LLMs.</li>\n  <li><a href=\"https://gorilla.cs.berkeley.edu/blogs/9_raft.html\">Project page</a>; <a href=\"https://github.com/ShishirPatil/gorilla/tree/main/raft\">Code</a></li>\n</ul>",
    "contentMarkdown": "*   This paper by Zhang et al. from UC Berkeley introduces Retrieval Augmented Fine Tuning (RAFT) as a method to adapt pre-trained Large Language Models (LLMs) for domain-specific Retrieval Augmented Generation (RAG), focusing on “open-book” in-domain settings. By training the model to identify and ignore distractor documents while citing relevant information from pertinent documents, RAFT enhances the model’s reasoning capability and its ability to answer questions based on a specific set of documents.\n*   The concept draws an analogy to preparing for an open-book exam, where RAFT simulates the conditions of such an exam by incorporating both relevant and irrelevant (distractor) documents during training. This contrasts with existing methods that either do not leverage the opportunity to learn from domain-specific documents or fail to prepare the model for the dynamics of RAG in an open-book test setting.\n*   The figure below from the paper draws an analogy to how best to prepare for an exam? (a) Fine-tuning based approaches implement “studying” by either directly “memorizing” the input documents or answering practice QA without referencing the documents. (b) Alternatively, incontext retrieval methods fail to leverage the learning opportunity afforded by the fixed domain and are equivalent to taking an open-book exam without studying. While these approaches leverage in-domain learning, they fail to prepare for open-book tests. In contrast, (c) RAFT leverages fine-tuning with question-answer pairs while referencing the documents in a simulated imperfect retrieval setting — thereby effectively preparing for the open-book exam setting.\n\n![](../../../images/papers/RAFT.jpg)\n\n*   The methodology involves creating training data that includes a question, a set of documents (with one or more being relevant to the question), and a CoT-style answer derived from the relevant document(s). The paper explores the impact of including distractor documents in the training set and the proportion of training data that should contain the oracle document.\n*   The figure below from the paper shows an overview of RAFT. The top-left figure depicts our approach of adapting LLMs to reading solution from a set of positive and negative documents in contrast to standard RAG setup where models are trained based on the retriever outputs, which is a mixture of both memorization and reading. At test time, all methods follow the standard RAG setting, provided with a top-k retrieved documents in the context.\n\n![](../../../images/papers/RAFT2.jpg)\n\n*   Experiments conducted across PubMed, HotpotQA, and Gorilla datasets demonstrate RAFT’s effectiveness. It consistently outperforms both supervised fine-tuning and RAG across these datasets, particularly highlighting the importance of the chain-of-thought (CoT) style responses in improving model performance.\n*   Results from various experiments indicate that mixing a fraction of the training data without the oracle document in its context is beneficial for in-domain RAG tasks. Moreover, training with a balance of relevant and irrelevant documents at test time shows that RAFT can generalize well to different numbers of retrieved documents, enhancing robustness against inaccuracies in retrieval.\n*   RAFT’s approach is compared against several baselines, including LLaMA-7B with and without RAG, domain-specific fine-tuning with 0-shot prompting (DSF), and DSF with RAG. Across different datasets, RAFT demonstrates significant improvements, underscoring its potential in domain-specific applications.\n*   The paper also discusses related works, highlighting advancements in retrieval-augmented language models, memorization versus generalization in LLMs, and fine-tuning strategies for adapting LLMs to specific tasks. RAFT’s contribution lies in its focus on preparing LLMs for domain-specific RAG by effectively leveraging both relevant and distractor documents during training.\n*   The study posits RAFT as a valuable strategy for adapting pre-trained LLMs to domain-specific tasks, especially where leveraging external documents is crucial. By training models to discern relevant information from distractors and generating CoT-style answers, RAFT significantly enhances the model’s ability to perform in open-book exam settings, paving the way for more nuanced and effective domain-specific applications of LLMs.\n*   [Project page](https://gorilla.cs.berkeley.edu/blogs/9_raft.html); [Code](https://github.com/ShishirPatil/gorilla/tree/main/raft)",
    "order": 47,
    "orderInChapter": 14,
    "difficulty": 4,
    "estimatedMinutes": 4,
    "tags": [
      "nlpllms",
      "llm",
      "fine-tuning"
    ],
    "metadata": {
      "hasCode": false,
      "hasMath": false,
      "hasImages": true,
      "wordCount": 623,
      "contentLength": 4691
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#raft:-adapting-language-model-to-domain-specific-rag",
    "scrapedAt": "2025-12-28T11:54:28.280Z"
  },
  {
    "id": "ai-RAG-corrective-retrieval-augmented-generation-48",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "Selected Papers",
    "title": "Corrective Retrieval Augmented Generation",
    "subtitle": "Selected Papers",
    "contentHtml": "<ul>\n  <li>The paper by Yan et al. from the University of Science and Technology of China, UCLA, and Google Research, proposed Corrective Retrieval Augmented Generation (CRAG) which addresses the challenge of hallucinations and inaccuracies in large language models (LLMs) by proposing a novel framework that enhances the robustness of retrieval-augmented generation (RAG) methods.</li>\n  <li>CRAG introduces a lightweight retrieval evaluator that assesses the quality of documents retrieved for a query and triggers actions based on a confidence degree, aiming to correct or enhance the retrieval process. The framework also incorporates large-scale web searches to augment the pool of retrieved documents, ensuring a broader spectrum of relevant and accurate information.</li>\n  <li>A key feature of CRAG is its decompose-then-recompose algorithm, which processes the retrieved documents to highlight crucial information while discarding irrelevant content. This method significantly improves the model’s ability to utilize the retrieved documents effectively, enhancing the quality and accuracy of the generated text.</li>\n  <li>The figure below from the paper shows an overview of CRAG at inference. A retrieval evaluator is constructed to evaluate the relevance of the\nretrieved documents to the input, and estimate a confidence degree based on which different knowledge retrieval actions of <code class=\"language-plaintext highlighter-rouge\">{Correct, Incorrect, Ambiguous}</code> can be triggered.</li>\n</ul>\n<p><img src=\"../../../images/papers/CRAG.jpg\" alt=\"\"></p>\n<ul>\n  <li>CRAG is designed to be plug-and-play, allowing seamless integration with various RAG-based approaches. Extensive experiments across four datasets demonstrate CRAG’s ability to significantly enhance the performance of RAG-based methods in both short- and long-form generation tasks, showcasing its adaptability and generalizability.</li>\n  <li>The study identifies scenarios where conventional RAG approaches may falter due to inaccurate retrievals. CRAG addresses this by enabling self-correction and efficient utilization of retrieved documents, marking a significant step towards improving the reliability and effectiveness of RAG methods.</li>\n  <li>Limitations acknowledged include the ongoing challenge of accurately detecting and correcting erroneous knowledge. The necessity of fine-tuning a retrieval evaluator and the potential biases introduced by web searches are highlighted as areas for future improvement.</li>\n  <li><a href=\"https://github.com/HuskyInSalt/CRAG\">Code</a></li>\n</ul>",
    "contentMarkdown": "*   The paper by Yan et al. from the University of Science and Technology of China, UCLA, and Google Research, proposed Corrective Retrieval Augmented Generation (CRAG) which addresses the challenge of hallucinations and inaccuracies in large language models (LLMs) by proposing a novel framework that enhances the robustness of retrieval-augmented generation (RAG) methods.\n*   CRAG introduces a lightweight retrieval evaluator that assesses the quality of documents retrieved for a query and triggers actions based on a confidence degree, aiming to correct or enhance the retrieval process. The framework also incorporates large-scale web searches to augment the pool of retrieved documents, ensuring a broader spectrum of relevant and accurate information.\n*   A key feature of CRAG is its decompose-then-recompose algorithm, which processes the retrieved documents to highlight crucial information while discarding irrelevant content. This method significantly improves the model’s ability to utilize the retrieved documents effectively, enhancing the quality and accuracy of the generated text.\n*   The figure below from the paper shows an overview of CRAG at inference. A retrieval evaluator is constructed to evaluate the relevance of the retrieved documents to the input, and estimate a confidence degree based on which different knowledge retrieval actions of `{Correct, Incorrect, Ambiguous}` can be triggered.\n\n![](../../../images/papers/CRAG.jpg)\n\n*   CRAG is designed to be plug-and-play, allowing seamless integration with various RAG-based approaches. Extensive experiments across four datasets demonstrate CRAG’s ability to significantly enhance the performance of RAG-based methods in both short- and long-form generation tasks, showcasing its adaptability and generalizability.\n*   The study identifies scenarios where conventional RAG approaches may falter due to inaccurate retrievals. CRAG addresses this by enabling self-correction and efficient utilization of retrieved documents, marking a significant step towards improving the reliability and effectiveness of RAG methods.\n*   Limitations acknowledged include the ongoing challenge of accurately detecting and correcting erroneous knowledge. The necessity of fine-tuning a retrieval evaluator and the potential biases introduced by web searches are highlighted as areas for future improvement.\n*   [Code](https://github.com/HuskyInSalt/CRAG)",
    "order": 48,
    "orderInChapter": 15,
    "difficulty": 5,
    "estimatedMinutes": 2,
    "tags": [
      "nlpllms",
      "llm",
      "fine-tuning"
    ],
    "metadata": {
      "hasCode": true,
      "hasMath": false,
      "hasImages": true,
      "wordCount": 324,
      "contentLength": 2581
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#corrective-retrieval-augmented-generation",
    "scrapedAt": "2025-12-28T11:54:28.280Z"
  },
  {
    "id": "ai-RAG-fine-tuning-vs-retrieval-augmented-generation-for--49",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "Selected Papers",
    "title": "Fine Tuning vs. Retrieval Augmented Generation for Less Popular Knowledge",
    "subtitle": "Selected Papers",
    "contentHtml": "<ul>\n  <li>This paper by Soudani et al. from Radboud University and the University of Amsterdam investigates the efficacy of Retrieval Augmented Generation (RAG) and fine-tuning (FT) on enhancing the performance of large language models (LLMs) for question answering (QA) tasks involving low-frequency factual knowledge. The authors conducted a comprehensive comparison to determine which approach is more beneficial for customizing LLMs to handle less popular entities, using a dataset characterized by a wide range of entity popularity levels. They found that fine-tuning significantly improves performance across entities of varying popularity, with notable gains in the most and least popular groups. Conversely, RAG was observed to surpass other methods, particularly when combined with FT in smaller models, although its advantage diminishes in base models and is non-existent in larger models.</li>\n  <li>The evaluation setup included a diverse range of factors such as model size, retrieval models, quality of synthetic data generation, and fine-tuning method (PEFT vs. full fine-tuning). The findings underscored the importance of advancements in retrieval and data augmentation techniques for the success of both RAG and FT strategies. For FT, two data augmentation methods were used to generate synthetic training data: an End-to-End approach utilizing a model trained for paragraph-level QA generation and a Prompt method using LLMs for QA generation.</li>\n  <li>For RAG, various retrieval models were employed to enhance the LLM’s response generation by providing additional context from a document corpus. The performance of the retrieval models played a significant role in the effectiveness of the RAG approach. The study also highlighted the role of synthetic data quality over quantity, with models trained on prompt-generated data outperforming those trained on E2E-generated data.</li>\n  <li>The figure below from the paper shows a correlation between subject entity popularity in a question and the effects of RAG and FT on FlanT5-\nsmall performance in open-domain question answering. FT markedly improves accuracy in the initial and final buckets relative to others (indicated by the pink line).</li>\n</ul>\n<p><img src=\"../../../images/papers/FTvsRAG.jpg\" alt=\"\"></p>",
    "contentMarkdown": "*   This paper by Soudani et al. from Radboud University and the University of Amsterdam investigates the efficacy of Retrieval Augmented Generation (RAG) and fine-tuning (FT) on enhancing the performance of large language models (LLMs) for question answering (QA) tasks involving low-frequency factual knowledge. The authors conducted a comprehensive comparison to determine which approach is more beneficial for customizing LLMs to handle less popular entities, using a dataset characterized by a wide range of entity popularity levels. They found that fine-tuning significantly improves performance across entities of varying popularity, with notable gains in the most and least popular groups. Conversely, RAG was observed to surpass other methods, particularly when combined with FT in smaller models, although its advantage diminishes in base models and is non-existent in larger models.\n*   The evaluation setup included a diverse range of factors such as model size, retrieval models, quality of synthetic data generation, and fine-tuning method (PEFT vs. full fine-tuning). The findings underscored the importance of advancements in retrieval and data augmentation techniques for the success of both RAG and FT strategies. For FT, two data augmentation methods were used to generate synthetic training data: an End-to-End approach utilizing a model trained for paragraph-level QA generation and a Prompt method using LLMs for QA generation.\n*   For RAG, various retrieval models were employed to enhance the LLM’s response generation by providing additional context from a document corpus. The performance of the retrieval models played a significant role in the effectiveness of the RAG approach. The study also highlighted the role of synthetic data quality over quantity, with models trained on prompt-generated data outperforming those trained on E2E-generated data.\n*   The figure below from the paper shows a correlation between subject entity popularity in a question and the effects of RAG and FT on FlanT5- small performance in open-domain question answering. FT markedly improves accuracy in the initial and final buckets relative to others (indicated by the pink line).\n\n![](../../../images/papers/FTvsRAG.jpg)",
    "order": 49,
    "orderInChapter": 16,
    "difficulty": 4,
    "estimatedMinutes": 2,
    "tags": [
      "nlpllms",
      "llm",
      "fine-tuning",
      "data augmentation"
    ],
    "metadata": {
      "hasCode": false,
      "hasMath": false,
      "hasImages": true,
      "wordCount": 325,
      "contentLength": 2289
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#fine-tuning-vs.-retrieval-augmented-generation-for-less-popular-knowledge",
    "scrapedAt": "2025-12-28T11:54:28.280Z"
  },
  {
    "id": "ai-RAG-hgot-hierarchical-graph-of-thoughts-for-retrieval--50",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "Selected Papers",
    "title": "HGOT: Hierarchical Graph of Thoughts for Retrieval-Augmented In-Context Learning in Factuality Evaluation",
    "subtitle": "Selected Papers",
    "contentHtml": "<ul>\n  <li>This paper by Fang et al. from Queen’s University introduce a novel structured, multi-layered graph approach named Hierarchical Graph of Thoughts (HGOT). This framework aims to mitigate hallucinations in large language models (LLMs) by enhancing the retrieval of relevant information for in-context learning. HGOT uses emergent planning capabilities of LLMs to decompose complex queries into manageable sub-queries. The divide-and-conquer strategy simplifies problem-solving and improves the relevance and accuracy of retrieved information.</li>\n  <li>HGOT incorporates a unique self-consistency majority voting mechanism for answer selection. This mechanism uses citation recall and precision metrics to evaluate the quality of thoughts, thus directly linking the credibility of an answer to the thought’s quality. The approach employs a scoring mechanism for evaluating retrieved passages, considering citation frequency and quality, self-consistency confidence, and the retrieval module’s ranking.</li>\n  <li>The figure below from the paper shows an illustrative example of HGOT in answering a factual question. (The abbreviations employed are as\nfollows: Instr.: Instructions, Q: Question, Ctx.: Context or References, Resp.: ChatGPT’s Response, PL: Plan, D: Dependencies, CI: Confidence, Ans.: Answer, Thot.: Thought)</li>\n</ul>\n<p><img src=\"../../../images/papers/HGOT.jpg\" alt=\"\"></p>\n<ul>\n  <li>The effectiveness of HGOT is validated against several other retrieval-augmented methods like Demonstrate-Search-Predict (DSP) and ReAct, showing an improvement of up to 7% on datasets such as FEVER, Open-SQuAD, and HotPotQA. This demonstrates HGOT’s enhanced capability for factuality in LLM responses.</li>\n  <li>In terms of implementation, HGOT utilizes emergent planning abilities of LLMs to create hierarchical graphs, which organizes the thought process more efficiently and reduces the likelihood of error propagation across multiple reasoning layers. The framework adjusts majority voting by weighting responses based on the quality of their associated citations, and employs a scoring system that factors in multiple qualities of retrieved passages to ensure high-quality, relevant informational support for LLM responses.</li>\n</ul>",
    "contentMarkdown": "*   This paper by Fang et al. from Queen’s University introduce a novel structured, multi-layered graph approach named Hierarchical Graph of Thoughts (HGOT). This framework aims to mitigate hallucinations in large language models (LLMs) by enhancing the retrieval of relevant information for in-context learning. HGOT uses emergent planning capabilities of LLMs to decompose complex queries into manageable sub-queries. The divide-and-conquer strategy simplifies problem-solving and improves the relevance and accuracy of retrieved information.\n*   HGOT incorporates a unique self-consistency majority voting mechanism for answer selection. This mechanism uses citation recall and precision metrics to evaluate the quality of thoughts, thus directly linking the credibility of an answer to the thought’s quality. The approach employs a scoring mechanism for evaluating retrieved passages, considering citation frequency and quality, self-consistency confidence, and the retrieval module’s ranking.\n*   The figure below from the paper shows an illustrative example of HGOT in answering a factual question. (The abbreviations employed are as follows: Instr.: Instructions, Q: Question, Ctx.: Context or References, Resp.: ChatGPT’s Response, PL: Plan, D: Dependencies, CI: Confidence, Ans.: Answer, Thot.: Thought)\n\n![](../../../images/papers/HGOT.jpg)\n\n*   The effectiveness of HGOT is validated against several other retrieval-augmented methods like Demonstrate-Search-Predict (DSP) and ReAct, showing an improvement of up to 7% on datasets such as FEVER, Open-SQuAD, and HotPotQA. This demonstrates HGOT’s enhanced capability for factuality in LLM responses.\n*   In terms of implementation, HGOT utilizes emergent planning abilities of LLMs to create hierarchical graphs, which organizes the thought process more efficiently and reduces the likelihood of error propagation across multiple reasoning layers. The framework adjusts majority voting by weighting responses based on the quality of their associated citations, and employs a scoring system that factors in multiple qualities of retrieved passages to ensure high-quality, relevant informational support for LLM responses.",
    "order": 50,
    "orderInChapter": 17,
    "difficulty": 4,
    "estimatedMinutes": 2,
    "tags": [
      "nlpllms",
      "gpt",
      "llm"
    ],
    "metadata": {
      "hasCode": false,
      "hasMath": false,
      "hasImages": true,
      "wordCount": 292,
      "contentLength": 2256
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#hgot:-hierarchical-graph-of-thoughts-for-retrieval-augmented-in-context-learning-in-factuality-evaluation",
    "scrapedAt": "2025-12-28T11:54:28.280Z"
  },
  {
    "id": "ai-RAG-how-faithful-are-rag-models-quantifying-the-tug-of-51",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "Selected Papers",
    "title": "How Faithful are RAG Models? Quantifying the Tug-of-war Between RAG and LLMs’ Internal Prior",
    "subtitle": "Selected Papers",
    "contentHtml": "<ul>\n  <li>This paper by Wu et al. from from Stanford investigates the effectiveness of Retrieval Augmented Generation (RAG) frameworks in moderating the behavior of Large Language Models (LLMs) when confronted with conflicting information. It centers on the dynamic between an LLM’s pre-existing knowledge and the information retrieved via RAG, particularly when discrepancies arise.</li>\n  <li>The authors conducted a systematic study using models like GPT-4 and GPT-3.5, simulating scenarios where the models were provided with both accurate and deliberately perturbed information across six distinct datasets. The paper confirms that while correct information typically corrects LLM outputs (with a 94% accuracy rate), incorrect data leads to errors if the model’s internal prior is weak.</li>\n  <li>The study introduces a novel experimental setup where documents are systematically modified to test LLM reliance on prior knowledge versus retrieved content. Changes ranged from numerical modifications (e.g., altering drug dosages or dates by specific multipliers or intervals) to categorical shifts in names and locations, assessing model response variations.</li>\n  <li>The figure below from the paper shows a schematic of generating modified documents for each dataset. A question is posed to the LLM with and without a reference document containing information relevant to the query. This document is then perturbed to contain modified information and given as context to the LLM. They then observe whether the LLM prefers the modified information or its own prior answer.</li>\n</ul>\n<p><img src=\"../../../images/papers/RAGfaithful.jpg\" alt=\"\"></p>\n<ul>\n  <li>Key findings include an inverse correlation between the likelihood of an LLM adhering to retrieved information and its internal confidence, quantified through token probabilities. Models with stronger priors demonstrated greater resistance to misleading RAG content, reverting to their initial responses.</li>\n  <li>Additionally, the paper discusses the influence of different prompting strategies on RAG adherence. The ‘strict’ prompting led to higher reliance on retrieved content, whereas ‘loose’ prompting allowed more independent reasoning from the models, highlighting the importance of prompt design in RAG systems.</li>\n  <li>Results across the datasets illustrated varying degrees of RAG effectiveness, influenced by the model’s confidence level. This nuanced exploration of RAG dynamics provides insights into improving the reliability of LLMs in practical applications, emphasizing the delicate balance needed in integrating RAG to mitigate errors and hallucinations in model outputs.</li>\n</ul>",
    "contentMarkdown": "*   This paper by Wu et al. from from Stanford investigates the effectiveness of Retrieval Augmented Generation (RAG) frameworks in moderating the behavior of Large Language Models (LLMs) when confronted with conflicting information. It centers on the dynamic between an LLM’s pre-existing knowledge and the information retrieved via RAG, particularly when discrepancies arise.\n*   The authors conducted a systematic study using models like GPT-4 and GPT-3.5, simulating scenarios where the models were provided with both accurate and deliberately perturbed information across six distinct datasets. The paper confirms that while correct information typically corrects LLM outputs (with a 94% accuracy rate), incorrect data leads to errors if the model’s internal prior is weak.\n*   The study introduces a novel experimental setup where documents are systematically modified to test LLM reliance on prior knowledge versus retrieved content. Changes ranged from numerical modifications (e.g., altering drug dosages or dates by specific multipliers or intervals) to categorical shifts in names and locations, assessing model response variations.\n*   The figure below from the paper shows a schematic of generating modified documents for each dataset. A question is posed to the LLM with and without a reference document containing information relevant to the query. This document is then perturbed to contain modified information and given as context to the LLM. They then observe whether the LLM prefers the modified information or its own prior answer.\n\n![](../../../images/papers/RAGfaithful.jpg)\n\n*   Key findings include an inverse correlation between the likelihood of an LLM adhering to retrieved information and its internal confidence, quantified through token probabilities. Models with stronger priors demonstrated greater resistance to misleading RAG content, reverting to their initial responses.\n*   Additionally, the paper discusses the influence of different prompting strategies on RAG adherence. The ‘strict’ prompting led to higher reliance on retrieved content, whereas ‘loose’ prompting allowed more independent reasoning from the models, highlighting the importance of prompt design in RAG systems.\n*   Results across the datasets illustrated varying degrees of RAG effectiveness, influenced by the model’s confidence level. This nuanced exploration of RAG dynamics provides insights into improving the reliability of LLMs in practical applications, emphasizing the delicate balance needed in integrating RAG to mitigate errors and hallucinations in model outputs.",
    "order": 51,
    "orderInChapter": 18,
    "difficulty": 4,
    "estimatedMinutes": 2,
    "tags": [
      "nlpllms",
      "gpt",
      "llm"
    ],
    "metadata": {
      "hasCode": false,
      "hasMath": false,
      "hasImages": true,
      "wordCount": 364,
      "contentLength": 2674
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#how-faithful-are-rag-models?-quantifying-the-tug-of-war-between-rag-and-llms’-internal-prior",
    "scrapedAt": "2025-12-28T11:54:28.280Z"
  },
  {
    "id": "ai-RAG-adaptive-rag-learning-to-adapt-retrieval-augmented-52",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "Selected Papers",
    "title": "Adaptive-RAG: Learning to Adapt Retrieval-Augmented Large Language Models Through Question Complexity",
    "subtitle": "Selected Papers",
    "contentHtml": "<ul>\n  <li>This paper by Jeong et al. from KAIST presents a novel framework named Adaptive-RAG for dynamic adjustment of retrieval strategies in Large Language Models (LLMs) based on the complexity of incoming queries. This allows for efficient and accurate responses across different query complexities.</li>\n  <li>The system categorizes queries into simple, moderate, and complex, each requiring different retrieval strategies: non-retrieval, single-step retrieval, and multi-step retrieval, respectively. The determination of query complexity is facilitated by a classifier trained on automatically labeled data.</li>\n  <li>The figure below from the paper shows a conceptual comparison of different retrieval-augmented LLM approaches to question answering. (A) In response to a query, this single-step approach retrieves relevant documents and then generates an answer. However, it may not be sufficient for complex queries that require multi-step reasoning. (B) This multi-step approach iteratively retrieves documents and generates intermediate answers, which is powerful yet largely inefficient for the simple query since it requires multiple accesses to both LLMs and retrievers. (C) Their adaptive approach can select the most suitable strategy for retrieval-augmented LLMs, ranging from iterative, to single, to even no retrieval approaches, based on the complexity of given queries determined by our classifier.</li>\n</ul>\n<p><img src=\"../../../images/papers/Adaptive-RAG.jpg\" alt=\"\"></p>\n<ul>\n  <li>Adaptive-RAG was validated across multiple open-domain QA datasets, showing significant improvements in both efficiency and accuracy over existing models. It employs a blend of iterative and single-step retrieval processes tailored to the specific needs of a query, which optimizes resource use and response time.</li>\n  <li>The implementation utilizes a secondary smaller language model as a classifier to predict query complexity. The classifier is trained on datasets synthesized without human labeling, using model predictions and inherent dataset biases to automatically generate training labels.</li>\n  <li>Experimental results demonstrate that Adaptive-RAG efficiently allocates resources, handling complex queries with detailed retrieval while effectively answering simpler queries directly through the LLM, thus avoiding unnecessary computation.</li>\n  <li>Additionally, Adaptive-RAG’s flexibility is highlighted in its ability to interchange between different retrieval strategies without altering the underlying model architecture or parameters, providing a scalable solution adaptable to varied query complexities.</li>\n</ul>",
    "contentMarkdown": "*   This paper by Jeong et al. from KAIST presents a novel framework named Adaptive-RAG for dynamic adjustment of retrieval strategies in Large Language Models (LLMs) based on the complexity of incoming queries. This allows for efficient and accurate responses across different query complexities.\n*   The system categorizes queries into simple, moderate, and complex, each requiring different retrieval strategies: non-retrieval, single-step retrieval, and multi-step retrieval, respectively. The determination of query complexity is facilitated by a classifier trained on automatically labeled data.\n*   The figure below from the paper shows a conceptual comparison of different retrieval-augmented LLM approaches to question answering. (A) In response to a query, this single-step approach retrieves relevant documents and then generates an answer. However, it may not be sufficient for complex queries that require multi-step reasoning. (B) This multi-step approach iteratively retrieves documents and generates intermediate answers, which is powerful yet largely inefficient for the simple query since it requires multiple accesses to both LLMs and retrievers. (C) Their adaptive approach can select the most suitable strategy for retrieval-augmented LLMs, ranging from iterative, to single, to even no retrieval approaches, based on the complexity of given queries determined by our classifier.\n\n![](../../../images/papers/Adaptive-RAG.jpg)\n\n*   Adaptive-RAG was validated across multiple open-domain QA datasets, showing significant improvements in both efficiency and accuracy over existing models. It employs a blend of iterative and single-step retrieval processes tailored to the specific needs of a query, which optimizes resource use and response time.\n*   The implementation utilizes a secondary smaller language model as a classifier to predict query complexity. The classifier is trained on datasets synthesized without human labeling, using model predictions and inherent dataset biases to automatically generate training labels.\n*   Experimental results demonstrate that Adaptive-RAG efficiently allocates resources, handling complex queries with detailed retrieval while effectively answering simpler queries directly through the LLM, thus avoiding unnecessary computation.\n*   Additionally, Adaptive-RAG’s flexibility is highlighted in its ability to interchange between different retrieval strategies without altering the underlying model architecture or parameters, providing a scalable solution adaptable to varied query complexities.",
    "order": 52,
    "orderInChapter": 19,
    "difficulty": 4,
    "estimatedMinutes": 2,
    "tags": [
      "nlpllms",
      "llm"
    ],
    "metadata": {
      "hasCode": false,
      "hasMath": false,
      "hasImages": true,
      "wordCount": 339,
      "contentLength": 2647
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#adaptive-rag:-learning-to-adapt-retrieval-augmented-large-language-models-through-question-complexity",
    "scrapedAt": "2025-12-28T11:54:28.280Z"
  },
  {
    "id": "ai-RAG-richrag-crafting-rich-responses-for-multi-faceted--53",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "Selected Papers",
    "title": "RichRAG: Crafting Rich Responses for Multi-faceted Queries in Retrieval-Augmented Generation",
    "subtitle": "Selected Papers",
    "contentHtml": "<ul>\n  <li>This paper by Wang et al. from the Gaoling School of Artificial Intelligence, Renmin University of China, and Baichuan Intelligent Technology, addresses the need for rich and comprehensive responses to broad, open-ended queries in retrieval-augmented generation (RAG).</li>\n  <li>The authors propose a novel framework, RichRAG, to handle complex user queries that have multiple sub-intents. RichRAG consists of three main components: a sub-aspect explorer, a multi-faceted retriever, and a generative list-wise ranker.</li>\n  <li>The sub-aspect explorer identifies potential sub-aspects of the input queries. This module leverages large language models (LLMs) for their extensive world knowledge and language understanding capabilities. It generates sub-aspects by fine-tuning on training queries using a next token prediction (NTP) loss function.</li>\n  <li>The multi-faceted retriever builds a candidate pool of external documents related to the identified sub-aspects. It retrieves top-N documents for each sub-aspect and combines these into a diverse candidate pool, ensuring broad coverage of the query’s various aspects.</li>\n  <li>The generative list-wise ranker sorts the top-k most valuable documents from the candidate pool. Built on a seq-to-seq model structure (T5), it models global interactions among candidates and sub-aspects, using a parallel encoding process and a pooling operation to extract relevance representations. The ranker generates a list of document IDs optimized through supervised fine-tuning and reinforcement learning stages.</li>\n  <li>The supervised fine-tuning stage uses a greedy algorithm to build silver target ranking lists based on a coverage utility function, ensuring the ranker can generate comprehensive lists.</li>\n  <li>The reinforcement learning stage aligns the ranker’s output with LLM preferences by using a reward function based on the quality and coverage of the generated responses. The Direct Preference Optimization (DPO) algorithm is employed, with training pairs created through a unilateral significance sampling strategy (US3) to ensure valuable and reliable training data.</li>\n  <li>The figure below from the paper illustrates the overall framework of RichRAG. We describe the training stages of our ranker at the bottom.</li>\n</ul>\n<p><img src=\"../../../images/papers/RichRAG.jpg\" alt=\"\"></p>\n<ul>\n  <li>Experimental results on WikiPassageQA and WikiAsp datasets demonstrate RichRAG’s effectiveness in generating comprehensive responses. The framework shows superior performance in terms of Rouge and Com-Rouge scores compared to existing methods.</li>\n  <li>RichRAG significantly improves the quality of responses to multi-faceted queries by explicitly modeling sub-aspects and aligning ranking lists with LLM preferences. The efficiency and robustness of the ranker are validated through various experiments, confirming its advantage in handling complex search scenarios.</li>\n</ul>",
    "contentMarkdown": "*   This paper by Wang et al. from the Gaoling School of Artificial Intelligence, Renmin University of China, and Baichuan Intelligent Technology, addresses the need for rich and comprehensive responses to broad, open-ended queries in retrieval-augmented generation (RAG).\n*   The authors propose a novel framework, RichRAG, to handle complex user queries that have multiple sub-intents. RichRAG consists of three main components: a sub-aspect explorer, a multi-faceted retriever, and a generative list-wise ranker.\n*   The sub-aspect explorer identifies potential sub-aspects of the input queries. This module leverages large language models (LLMs) for their extensive world knowledge and language understanding capabilities. It generates sub-aspects by fine-tuning on training queries using a next token prediction (NTP) loss function.\n*   The multi-faceted retriever builds a candidate pool of external documents related to the identified sub-aspects. It retrieves top-N documents for each sub-aspect and combines these into a diverse candidate pool, ensuring broad coverage of the query’s various aspects.\n*   The generative list-wise ranker sorts the top-k most valuable documents from the candidate pool. Built on a seq-to-seq model structure (T5), it models global interactions among candidates and sub-aspects, using a parallel encoding process and a pooling operation to extract relevance representations. The ranker generates a list of document IDs optimized through supervised fine-tuning and reinforcement learning stages.\n*   The supervised fine-tuning stage uses a greedy algorithm to build silver target ranking lists based on a coverage utility function, ensuring the ranker can generate comprehensive lists.\n*   The reinforcement learning stage aligns the ranker’s output with LLM preferences by using a reward function based on the quality and coverage of the generated responses. The Direct Preference Optimization (DPO) algorithm is employed, with training pairs created through a unilateral significance sampling strategy (US3) to ensure valuable and reliable training data.\n*   The figure below from the paper illustrates the overall framework of RichRAG. We describe the training stages of our ranker at the bottom.\n\n![](../../../images/papers/RichRAG.jpg)\n\n*   Experimental results on WikiPassageQA and WikiAsp datasets demonstrate RichRAG’s effectiveness in generating comprehensive responses. The framework shows superior performance in terms of Rouge and Com-Rouge scores compared to existing methods.\n*   RichRAG significantly improves the quality of responses to multi-faceted queries by explicitly modeling sub-aspects and aligning ranking lists with LLM preferences. The efficiency and robustness of the ranker are validated through various experiments, confirming its advantage in handling complex search scenarios.",
    "order": 53,
    "orderInChapter": 20,
    "difficulty": 4,
    "estimatedMinutes": 2,
    "tags": [
      "nlpllms",
      "llm",
      "reinforcement learning",
      "optimization",
      "loss function",
      "fine-tuning"
    ],
    "metadata": {
      "hasCode": false,
      "hasMath": false,
      "hasImages": true,
      "wordCount": 392,
      "contentLength": 2958
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#richrag:-crafting-rich-responses-for-multi-faceted-queries-in-retrieval-augmented-generation",
    "scrapedAt": "2025-12-28T11:54:28.280Z"
  },
  {
    "id": "ai-RAG-hiqa-a-hierarchical-contextual-augmentation-rag-fo-54",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "Selected Papers",
    "title": "HiQA: a Hierarchical Contextual Augmentation RAG for Massive Documents QA",
    "subtitle": "Selected Papers",
    "contentHtml": "<ul>\n  <li>This paper by Chen et al. from introduces HiQA, an advanced multi-document question-answering (MDQA) framework to tackle the challenge of retrieving accurate information from extensive, indistinguishable documents. It incorporates cascading metadata and a multi-route retrieval mechanism to enhance the precision and relevance of knowledge retrieval.</li>\n  <li>The paper outlines the methodology comprising three main components: Markdown Formatter (MF), Hierarchical Contextual Augmentor (HCA), and Multi-Route Retriever (MRR). MF converts documents into markdown format, enriching them with structured metadata. HCA further augments document segments with hierarchical metadata, and MRR utilizes a combination of vector similarity, Elasticsearch, and keyword matching for improved retrieval accuracy.</li>\n  <li>The following figure from the paper illustrates of the proposed contextual text enhancement. The contextual structure can improve text alignment with the query for better matching in multi-documents scenarios.</li>\n</ul>\n<p><img src=\"../../../images/papers/HiQA.jpg\" alt=\"\"></p>\n<ul>\n  <li>A novel dataset, MasQA, is introduced to evaluate the performance of MDQA systems, highlighting the framework’s superiority in handling massive documents through extensive experiments.</li>\n  <li>Ablation studies demonstrate the individual contribution of each component to the system’s overall effectiveness, with a focus on the HCA’s role in improving retrieval precision.</li>\n  <li>Theoretical exploration into the impact of HCA on the distribution of document segments within the embedding space supports the framework’s approach, indicating enhanced retrieval accuracy and the avoidance of information loss associated with hard partitioning methods.</li>\n</ul>",
    "contentMarkdown": "*   This paper by Chen et al. from introduces HiQA, an advanced multi-document question-answering (MDQA) framework to tackle the challenge of retrieving accurate information from extensive, indistinguishable documents. It incorporates cascading metadata and a multi-route retrieval mechanism to enhance the precision and relevance of knowledge retrieval.\n*   The paper outlines the methodology comprising three main components: Markdown Formatter (MF), Hierarchical Contextual Augmentor (HCA), and Multi-Route Retriever (MRR). MF converts documents into markdown format, enriching them with structured metadata. HCA further augments document segments with hierarchical metadata, and MRR utilizes a combination of vector similarity, Elasticsearch, and keyword matching for improved retrieval accuracy.\n*   The following figure from the paper illustrates of the proposed contextual text enhancement. The contextual structure can improve text alignment with the query for better matching in multi-documents scenarios.\n\n![](../../../images/papers/HiQA.jpg)\n\n*   A novel dataset, MasQA, is introduced to evaluate the performance of MDQA systems, highlighting the framework’s superiority in handling massive documents through extensive experiments.\n*   Ablation studies demonstrate the individual contribution of each component to the system’s overall effectiveness, with a focus on the HCA’s role in improving retrieval precision.\n*   Theoretical exploration into the impact of HCA on the distribution of document segments within the embedding space supports the framework’s approach, indicating enhanced retrieval accuracy and the avoidance of information loss associated with hard partitioning methods.",
    "order": 54,
    "orderInChapter": 21,
    "difficulty": 4,
    "estimatedMinutes": 2,
    "tags": [
      "nlpllms",
      "embedding"
    ],
    "metadata": {
      "hasCode": false,
      "hasMath": false,
      "hasImages": true,
      "wordCount": 221,
      "contentLength": 1782
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#hiqa:-a-hierarchical-contextual-augmentation-rag-for-massive-documents-qa",
    "scrapedAt": "2025-12-28T11:54:28.280Z"
  },
  {
    "id": "ai-RAG-refrag-rethinking-rag-based-decoding-55",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "Selected Papers",
    "title": "REFRAG: Rethinking RAG Based Decoding",
    "subtitle": "Selected Papers",
    "contentHtml": "<ul>\n  <li>\n    <p>This paper by Lin et al. from Meta Superintelligence Labs, the National University of Singapore, and Rice University presents REpresentation For RAG <strong>(REFRAG)</strong>, a novel framework designed to accelerate decoding in RAG by compressing context tokens into chunk-level embeddings, significantly reducing latency and memory overhead without altering the underlying decoder architecture.</p>\n  </li>\n  <li>\n    <p><strong>Motivation</strong>: While large language models (LLMs) excel at contextual learning in tasks like RAG, long context sequences dramatically increase inference latency—especially the time-to-first-token (TTFT)—due to quadratic scaling in attention computation and key-value (KV) cache memory usage. In RAG specifically, the majority of the context consists of retrieved documents, many of which are only marginally relevant, leading to block-diagonal attention patterns that are sparsely connected. The authors argue that most of this computation is wasteful and propose a method to exploit this sparsity.</p>\n  </li>\n  <li>\n    <p><strong>Core Idea</strong>: Instead of feeding full tokenized contexts to the decoder, REFRAG replaces these with <strong>precomputed, compressed chunk embeddings</strong> derived from a lightweight encoder (e.g., RoBERTa). A selective RL-based policy determines which chunks need full token expansion and which can remain compressed. This greatly reduces the decoder input size and hence latency, especially TTFT.</p>\n  </li>\n  <li>\n    <p><strong>Architecture and Implementation</strong>:</p>\n\n    <ul>\n      <li>\n        <p><strong>Components</strong>:</p>\n\n        <ul>\n          <li><strong>Decoder</strong>: A standard decoder-only model (e.g., LLaMA-2).</li>\n          <li><strong>Encoder</strong>: Lightweight encoder (e.g., RoBERTa-Base or -Large) to compute chunk embeddings.</li>\n          <li><strong>Chunking</strong>: The context (retrieved passages) is divided into <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-192-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi><mo>=</mo><mfrac><mi>s</mi><mi>k</mi></mfrac></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1763\" style=\"width: 3.023em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.503em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.5em, 2.763em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1764\"><span class=\"mi\" id=\"MathJax-Span-1765\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1766\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-1767\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 0.471em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.544em, 1000.26em, 4.169em, -999.997em); top: -4.424em; left: 50%; margin-left: -0.154em;\"><span class=\"mi\" id=\"MathJax-Span-1768\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">s</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1000.32em, 4.169em, -999.997em); top: -3.643em; left: 50%; margin-left: -0.154em;\"><span class=\"mi\" id=\"MathJax-Span-1769\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1000.47em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.471em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.559em; border-left: 0px solid; width: 0px; height: 1.503em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>L</mi><mo>=</mo><mfrac><mi>s</mi><mi>k</mi></mfrac></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-192\">L = \\frac{s}{k}</script> chunks of size <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-193-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1770\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1771\"><span class=\"mi\" id=\"MathJax-Span-1772\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-193\">k</script> tokens. Each chunk is encoded into a vector representation via the encoder.</li>\n          <li><strong>Projection Layer</strong>: Aligns encoder outputs to the decoder’s token embedding dimension.</li>\n        </ul>\n      </li>\n      <li>\n        <p><strong>Input Pipeline</strong>:</p>\n\n        <ul>\n          <li>\n            <p>Given a prompt <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-194-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>x</mi><mo>=</mo><mo stretchy=&quot;false&quot;>[</mo><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><msub><mi>x</mi><mn>2</mn></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>x</mi><mi>q</mi></msub><mo stretchy=&quot;false&quot;>]</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1773\" style=\"width: 9.378em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 7.815em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1007.71em, 2.659em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1774\"><span class=\"mi\" id=\"MathJax-Span-1775\" style=\"font-family: STIXGeneral-Italic;\">x<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1776\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mo\" id=\"MathJax-Span-1777\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">[</span><span class=\"msubsup\" id=\"MathJax-Span-1778\"><span style=\"display: inline-block; position: relative; width: 0.888em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1779\" style=\"font-family: STIXGeneral-Italic;\">x<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"mn\" id=\"MathJax-Span-1780\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1781\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-1782\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 0.888em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1783\" style=\"font-family: STIXGeneral-Italic;\">x<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"mn\" id=\"MathJax-Span-1784\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1785\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mo\" id=\"MathJax-Span-1786\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1787\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1788\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1789\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-1790\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 0.888em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1791\" style=\"font-family: STIXGeneral-Italic;\">x<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"mi\" id=\"MathJax-Span-1792\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">q</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1793\" style=\"font-family: STIXGeneral-Regular;\">]</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.253em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>x</mi><mo>=</mo><mo stretchy=\"false\">[</mo><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><msub><mi>x</mi><mn>2</mn></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>x</mi><mi>q</mi></msub><mo stretchy=\"false\">]</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-194\">x = [x_1, x_2, ..., x_q]</script> and a context <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-195-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>[</mo><msub><mi>x</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>q</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>x</mi><mi>T</mi></msub><mo stretchy=&quot;false&quot;>]</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1794\" style=\"width: 6.826em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 5.68em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1005.58em, 2.659em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1795\"><span class=\"mo\" id=\"MathJax-Span-1796\" style=\"font-family: STIXGeneral-Regular;\">[</span><span class=\"msubsup\" id=\"MathJax-Span-1797\"><span style=\"display: inline-block; position: relative; width: 1.721em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1798\" style=\"font-family: STIXGeneral-Italic;\">x<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"texatom\" id=\"MathJax-Span-1799\"><span class=\"mrow\" id=\"MathJax-Span-1800\"><span class=\"mi\" id=\"MathJax-Span-1801\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">q</span><span class=\"mo\" id=\"MathJax-Span-1802\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">+</span><span class=\"mn\" id=\"MathJax-Span-1803\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1804\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mo\" id=\"MathJax-Span-1805\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1806\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1807\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1808\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-1809\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 0.992em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1810\" style=\"font-family: STIXGeneral-Italic;\">x<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"mi\" id=\"MathJax-Span-1811\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">T<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1812\" style=\"font-family: STIXGeneral-Regular;\">]</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.253em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mo stretchy=\"false\">[</mo><msub><mi>x</mi><mrow class=\"MJX-TeXAtom-ORD\"><mi>q</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>x</mi><mi>T</mi></msub><mo stretchy=\"false\">]</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-195\">[x_{q+1}, ..., x_T]</script>:</p>\n\n            <ul>\n              <li>The context is chunked into <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-196-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>C</mi><mi>i</mi></msub><mo>=</mo><mo stretchy=&quot;false&quot;>[</mo><msub><mi>x</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>q</mi><mo>+</mo><mi>k</mi><mo>&amp;#x2217;</mo><mi>i</mi></mrow></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>x</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>q</mi><mo>+</mo><mi>k</mi><mo>&amp;#x2217;</mo><mi>i</mi><mo>+</mo><mi>k</mi><mo>&amp;#x2212;</mo><mn>1</mn></mrow></msub><mo stretchy=&quot;false&quot;>]</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1813\" style=\"width: 13.544em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 11.253em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1011.15em, 2.659em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1814\"><span class=\"msubsup\" id=\"MathJax-Span-1815\"><span style=\"display: inline-block; position: relative; width: 0.94em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.68em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1816\" style=\"font-family: STIXGeneral-Italic;\">C<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.68em;\"><span class=\"mi\" id=\"MathJax-Span-1817\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1818\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mo\" id=\"MathJax-Span-1819\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">[</span><span class=\"msubsup\" id=\"MathJax-Span-1820\"><span style=\"display: inline-block; position: relative; width: 2.242em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1821\" style=\"font-family: STIXGeneral-Italic;\">x<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"texatom\" id=\"MathJax-Span-1822\"><span class=\"mrow\" id=\"MathJax-Span-1823\"><span class=\"mi\" id=\"MathJax-Span-1824\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">q</span><span class=\"mo\" id=\"MathJax-Span-1825\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">+</span><span class=\"mi\" id=\"MathJax-Span-1826\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1827\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">∗</span><span class=\"mi\" id=\"MathJax-Span-1828\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">i</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1829\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mo\" id=\"MathJax-Span-1830\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1831\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1832\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1833\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-1834\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 3.909em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1835\" style=\"font-family: STIXGeneral-Italic;\">x<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"texatom\" id=\"MathJax-Span-1836\"><span class=\"mrow\" id=\"MathJax-Span-1837\"><span class=\"mi\" id=\"MathJax-Span-1838\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">q</span><span class=\"mo\" id=\"MathJax-Span-1839\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">+</span><span class=\"mi\" id=\"MathJax-Span-1840\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1841\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">∗</span><span class=\"mi\" id=\"MathJax-Span-1842\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">i</span><span class=\"mo\" id=\"MathJax-Span-1843\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">+</span><span class=\"mi\" id=\"MathJax-Span-1844\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1845\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">−</span><span class=\"mn\" id=\"MathJax-Span-1846\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1847\" style=\"font-family: STIXGeneral-Regular;\">]</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.316em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>C</mi><mi>i</mi></msub><mo>=</mo><mo stretchy=\"false\">[</mo><msub><mi>x</mi><mrow class=\"MJX-TeXAtom-ORD\"><mi>q</mi><mo>+</mo><mi>k</mi><mo>∗</mo><mi>i</mi></mrow></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>x</mi><mrow class=\"MJX-TeXAtom-ORD\"><mi>q</mi><mo>+</mo><mi>k</mi><mo>∗</mo><mi>i</mi><mo>+</mo><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy=\"false\">]</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-196\">C_i = [x_{q+k*i}, ..., x_{q+k*i+k-1}]</script>.</li>\n              <li>The encoder produces a chunk embedding <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-197-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>c</mi><mi>i</mi></msub><mo>=</mo><msub><mi>M</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>e</mi><mi>n</mi><mi>c</mi></mrow></msub><mo stretchy=&quot;false&quot;>(</mo><msub><mi>C</mi><mi>i</mi></msub><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1848\" style=\"width: 6.513em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 5.419em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1005.37em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1849\"><span class=\"msubsup\" id=\"MathJax-Span-1850\"><span style=\"display: inline-block; position: relative; width: 0.732em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1851\" style=\"font-family: STIXGeneral-Italic;\">c</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"mi\" id=\"MathJax-Span-1852\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1853\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"msubsup\" id=\"MathJax-Span-1854\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 1.878em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1855\" style=\"font-family: STIXGeneral-Italic;\">M<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"texatom\" id=\"MathJax-Span-1856\"><span class=\"mrow\" id=\"MathJax-Span-1857\"><span class=\"mi\" id=\"MathJax-Span-1858\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">e</span><span class=\"mi\" id=\"MathJax-Span-1859\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">n</span><span class=\"mi\" id=\"MathJax-Span-1860\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">c</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1861\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"msubsup\" id=\"MathJax-Span-1862\"><span style=\"display: inline-block; position: relative; width: 0.94em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.68em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1863\" style=\"font-family: STIXGeneral-Italic;\">C<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.68em;\"><span class=\"mi\" id=\"MathJax-Span-1864\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1865\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>c</mi><mi>i</mi></msub><mo>=</mo><msub><mi>M</mi><mrow class=\"MJX-TeXAtom-ORD\"><mi>e</mi><mi>n</mi><mi>c</mi></mrow></msub><mo stretchy=\"false\">(</mo><msub><mi>C</mi><mi>i</mi></msub><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-197\">c_i = M_{enc}(C_i)</script>.</li>\n              <li>This is projected: <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-198-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>e</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>c</mi><mi>i</mi></msub></mrow></msub><mo>=</mo><mi>&amp;#x03D5;</mi><mo stretchy=&quot;false&quot;>(</mo><msub><mi>c</mi><mi>i</mi></msub><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1866\" style=\"width: 5.003em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 4.169em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1004.12em, 2.607em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1867\"><span class=\"msubsup\" id=\"MathJax-Span-1868\"><span style=\"display: inline-block; position: relative; width: 1.044em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1869\" style=\"font-family: STIXGeneral-Italic;\">e</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"texatom\" id=\"MathJax-Span-1870\"><span class=\"mrow\" id=\"MathJax-Span-1871\"><span class=\"msubsup\" id=\"MathJax-Span-1872\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.544em, 1000.32em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1873\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">c</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.904em; left: 0.315em;\"><span class=\"mi\" id=\"MathJax-Span-1874\" style=\"font-size: 50%; font-family: STIXGeneral-Italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1875\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mi\" id=\"MathJax-Span-1876\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">ϕ</span><span class=\"mo\" id=\"MathJax-Span-1877\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"msubsup\" id=\"MathJax-Span-1878\"><span style=\"display: inline-block; position: relative; width: 0.732em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1879\" style=\"font-family: STIXGeneral-Italic;\">c</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"mi\" id=\"MathJax-Span-1880\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1881\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.253em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>e</mi><mrow class=\"MJX-TeXAtom-ORD\"><msub><mi>c</mi><mi>i</mi></msub></mrow></msub><mo>=</mo><mi>ϕ</mi><mo stretchy=\"false\">(</mo><msub><mi>c</mi><mi>i</mi></msub><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-198\">e_{c_i} = \\phi(c_i)</script>.</li>\n              <li>The decoder then operates on <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-199-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>[</mo><msub><mi>e</mi><mn>1</mn></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>e</mi><mi>q</mi></msub><mo>,</mo><msub><mi>e</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>c</mi><mn>1</mn></msub></mrow></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>e</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>c</mi><mi>L</mi></msub></mrow></msub><mo stretchy=&quot;false&quot;>]</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1882\" style=\"width: 11.773em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 9.794em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1009.69em, 2.659em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1883\"><span class=\"mo\" id=\"MathJax-Span-1884\" style=\"font-family: STIXGeneral-Regular;\">[</span><span class=\"msubsup\" id=\"MathJax-Span-1885\"><span style=\"display: inline-block; position: relative; width: 0.888em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1886\" style=\"font-family: STIXGeneral-Italic;\">e</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"mn\" id=\"MathJax-Span-1887\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1888\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mo\" id=\"MathJax-Span-1889\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1890\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1891\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1892\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-1893\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 0.888em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1894\" style=\"font-family: STIXGeneral-Italic;\">e</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"mi\" id=\"MathJax-Span-1895\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">q</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1896\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-1897\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1898\" style=\"font-family: STIXGeneral-Italic;\">e</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"texatom\" id=\"MathJax-Span-1899\"><span class=\"mrow\" id=\"MathJax-Span-1900\"><span class=\"msubsup\" id=\"MathJax-Span-1901\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.544em, 1000.32em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1902\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">c</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.904em; left: 0.315em;\"><span class=\"mn\" id=\"MathJax-Span-1903\" style=\"font-size: 50%; font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1904\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mo\" id=\"MathJax-Span-1905\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1906\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1907\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1908\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-1909\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1910\" style=\"font-family: STIXGeneral-Italic;\">e</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"texatom\" id=\"MathJax-Span-1911\"><span class=\"mrow\" id=\"MathJax-Span-1912\"><span class=\"msubsup\" id=\"MathJax-Span-1913\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.544em, 1000.32em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1914\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">c</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.904em; left: 0.315em;\"><span class=\"mi\" id=\"MathJax-Span-1915\" style=\"font-size: 50%; font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1916\" style=\"font-family: STIXGeneral-Regular;\">]</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.253em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mo stretchy=\"false\">[</mo><msub><mi>e</mi><mn>1</mn></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>e</mi><mi>q</mi></msub><mo>,</mo><msub><mi>e</mi><mrow class=\"MJX-TeXAtom-ORD\"><msub><mi>c</mi><mn>1</mn></msub></mrow></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>e</mi><mrow class=\"MJX-TeXAtom-ORD\"><msub><mi>c</mi><mi>L</mi></msub></mrow></msub><mo stretchy=\"false\">]</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-199\">[e_1, ..., e_q, e_{c_1}, ..., e_{c_L}]</script>.</li>\n            </ul>\n          </li>\n        </ul>\n      </li>\n      <li>\n        <p><strong>Selective Compression</strong>:</p>\n\n        <ul>\n          <li>A lightweight RL policy (trained using next-paragraph prediction perplexity as a reward signal) decides which chunks should be expanded into full tokens versus retained as embeddings.</li>\n          <li>This enables flexible “compress-anywhere” capabilities without sacrificing autoregressiveness.</li>\n        </ul>\n      </li>\n      <li>\n        <p><strong>Training</strong>:</p>\n\n        <ol>\n          <li><strong>Reconstruction Task</strong>: Initially freezes the decoder and trains the encoder and projection layer to reconstruct original tokens from embeddings.</li>\n          <li><strong>Continual Pre-Training (CPT)</strong>: Uses next-paragraph prediction, allowing the decoder to learn from the encoder’s chunk representations.</li>\n          <li><strong>Curriculum Learning</strong>: Gradually increases chunk complexity during training.</li>\n          <li><strong>Instruction-Tuning</strong>: Adapts the model to specific downstream applications (RAG, multi-turn conversation, summarization).</li>\n        </ol>\n      </li>\n      <li>\n        <p><strong>Loss Function</strong>: Cross-entropy on next-token prediction during both reconstruction and CPT stages; policy gradients (e.g., PPO) for RL-based selective compression.</p>\n      </li>\n      <li>\n        <p><strong>Datasets</strong>:</p>\n\n        <ul>\n          <li>Pretraining: 20B tokens from SlimPajama’s Book and ArXiv subsets.</li>\n          <li>Evaluation: PG19, ProofPile, SlimPajama holdouts.</li>\n          <li>Fine-tuning: RAG benchmarks including MS MARCO, MMLU, BoolQ, CommonsenseQA, and others.</li>\n        </ul>\n      </li>\n      <li>\n        <p><strong>Benchmarking</strong>:</p>\n\n        <ul>\n          <li>Compared against CEPE, REPLUG, and LLaMA-2-7B (with or without full context).</li>\n          <li>Compression rates: <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-200-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi><mo>=</mo><mn>8</mn><mo>,</mo><mn>16</mn><mo>,</mo><mn>32</mn></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1917\" style=\"width: 6.148em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 5.107em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1005.11em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1918\"><span class=\"mi\" id=\"MathJax-Span-1919\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1920\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-1921\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">8</span><span class=\"mo\" id=\"MathJax-Span-1922\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mn\" id=\"MathJax-Span-1923\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">16</span><span class=\"mo\" id=\"MathJax-Span-1924\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mn\" id=\"MathJax-Span-1925\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">32</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi><mo>=</mo><mn>8</mn><mo>,</mo><mn>16</mn><mo>,</mo><mn>32</mn></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-200\">k = 8, 16, 32</script>.</li>\n          <li>Context lengths evaluated: 4096, 8192, 16384.</li>\n        </ul>\n      </li>\n      <li>\n        <p><strong>Performance</strong>:</p>\n\n        <ul>\n          <li>TTFT improved by <strong>30.85×</strong> over LLaMA and <strong>3.75×</strong> over CEPE at <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-201-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi><mo>=</mo><mn>32</mn></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1926\" style=\"width: 3.284em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.711em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1002.71em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1927\"><span class=\"mi\" id=\"MathJax-Span-1928\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1929\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-1930\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">32</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi><mo>=</mo><mn>32</mn></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-201\">k=32</script>.</li>\n          <li>Maintains or improves log-perplexity relative to CEPE across datasets.</li>\n          <li>Enables <strong>16× longer context</strong> with equal or better accuracy.</li>\n        </ul>\n      </li>\n      <li>\n        <p><strong>Generalization</strong>:</p>\n\n        <ul>\n          <li>Effective in RAG, multi-turn conversations, and long document summarization.</li>\n          <li>REFRAG16 with RL-based chunk selection often outperforms REFRAG8 trained with full compression, despite being trained at a higher compression rate.</li>\n        </ul>\n      </li>\n      <li>\n        <p><strong>Model Scalability</strong>:</p>\n\n        <ul>\n          <li>\n            <p>Tested with LLaMA-2-7B/13B and LLaMA-3 variants.</p>\n          </li>\n          <li>\n            <p>Larger decoders improve performance more than larger encoders, with limited benefit observed from encoder scaling beyond RoBERTa-Base.</p>\n          </li>\n        </ul>\n      </li>\n    </ul>\n  </li>\n  <li>\n    <p>The following figure from the paper shows the main design of REFRAG. The input context is chunked and processed by the light-weight encoder to produce chunk embeddings, which are precomputable for efficient reuse. A light-weight RL policy decide few chunks to expand. These chunk embeddings along with the token embeddings of the question input are fed to the decoder.</p>\n  </li>\n</ul>\n<p>This paper by Lin et al. from Meta Superintelligence Labs, the National University of Singapore, and Rice University presents REpresentation For RAG <strong>(REFRAG)</strong>, a novel framework designed to accelerate decoding in RAG by compressing context tokens into chunk-level embeddings, significantly reducing latency and memory overhead without altering the underlying decoder architecture.</p>\n<p><strong>Motivation</strong>: While large language models (LLMs) excel at contextual learning in tasks like RAG, long context sequences dramatically increase inference latency—especially the time-to-first-token (TTFT)—due to quadratic scaling in attention computation and key-value (KV) cache memory usage. In RAG specifically, the majority of the context consists of retrieved documents, many of which are only marginally relevant, leading to block-diagonal attention patterns that are sparsely connected. The authors argue that most of this computation is wasteful and propose a method to exploit this sparsity.</p>\n<p><strong>Core Idea</strong>: Instead of feeding full tokenized contexts to the decoder, REFRAG replaces these with <strong>precomputed, compressed chunk embeddings</strong> derived from a lightweight encoder (e.g., RoBERTa). A selective RL-based policy determines which chunks need full token expansion and which can remain compressed. This greatly reduces the decoder input size and hence latency, especially TTFT.</p>\n<p><strong>Architecture and Implementation</strong>:</p>\n<ul>\n      <li>\n        <p><strong>Components</strong>:</p>\n\n        <ul>\n          <li><strong>Decoder</strong>: A standard decoder-only model (e.g., LLaMA-2).</li>\n          <li><strong>Encoder</strong>: Lightweight encoder (e.g., RoBERTa-Base or -Large) to compute chunk embeddings.</li>\n          <li><strong>Chunking</strong>: The context (retrieved passages) is divided into <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-192-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi><mo>=</mo><mfrac><mi>s</mi><mi>k</mi></mfrac></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1763\" style=\"width: 3.023em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.503em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.5em, 2.763em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1764\"><span class=\"mi\" id=\"MathJax-Span-1765\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1766\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-1767\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 0.471em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.544em, 1000.26em, 4.169em, -999.997em); top: -4.424em; left: 50%; margin-left: -0.154em;\"><span class=\"mi\" id=\"MathJax-Span-1768\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">s</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1000.32em, 4.169em, -999.997em); top: -3.643em; left: 50%; margin-left: -0.154em;\"><span class=\"mi\" id=\"MathJax-Span-1769\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1000.47em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.471em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.559em; border-left: 0px solid; width: 0px; height: 1.503em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>L</mi><mo>=</mo><mfrac><mi>s</mi><mi>k</mi></mfrac></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-192\">L = \\frac{s}{k}</script> chunks of size <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-193-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1770\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1771\"><span class=\"mi\" id=\"MathJax-Span-1772\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-193\">k</script> tokens. Each chunk is encoded into a vector representation via the encoder.</li>\n          <li><strong>Projection Layer</strong>: Aligns encoder outputs to the decoder’s token embedding dimension.</li>\n        </ul>\n      </li>\n      <li>\n        <p><strong>Input Pipeline</strong>:</p>\n\n        <ul>\n          <li>\n            <p>Given a prompt <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-194-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>x</mi><mo>=</mo><mo stretchy=&quot;false&quot;>[</mo><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><msub><mi>x</mi><mn>2</mn></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>x</mi><mi>q</mi></msub><mo stretchy=&quot;false&quot;>]</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1773\" style=\"width: 9.378em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 7.815em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1007.71em, 2.659em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1774\"><span class=\"mi\" id=\"MathJax-Span-1775\" style=\"font-family: STIXGeneral-Italic;\">x<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1776\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mo\" id=\"MathJax-Span-1777\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">[</span><span class=\"msubsup\" id=\"MathJax-Span-1778\"><span style=\"display: inline-block; position: relative; width: 0.888em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1779\" style=\"font-family: STIXGeneral-Italic;\">x<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"mn\" id=\"MathJax-Span-1780\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1781\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-1782\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 0.888em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1783\" style=\"font-family: STIXGeneral-Italic;\">x<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"mn\" id=\"MathJax-Span-1784\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1785\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mo\" id=\"MathJax-Span-1786\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1787\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1788\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1789\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-1790\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 0.888em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1791\" style=\"font-family: STIXGeneral-Italic;\">x<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"mi\" id=\"MathJax-Span-1792\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">q</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1793\" style=\"font-family: STIXGeneral-Regular;\">]</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.253em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>x</mi><mo>=</mo><mo stretchy=\"false\">[</mo><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><msub><mi>x</mi><mn>2</mn></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>x</mi><mi>q</mi></msub><mo stretchy=\"false\">]</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-194\">x = [x_1, x_2, ..., x_q]</script> and a context <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-195-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>[</mo><msub><mi>x</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>q</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>x</mi><mi>T</mi></msub><mo stretchy=&quot;false&quot;>]</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1794\" style=\"width: 6.826em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 5.68em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1005.58em, 2.659em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1795\"><span class=\"mo\" id=\"MathJax-Span-1796\" style=\"font-family: STIXGeneral-Regular;\">[</span><span class=\"msubsup\" id=\"MathJax-Span-1797\"><span style=\"display: inline-block; position: relative; width: 1.721em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1798\" style=\"font-family: STIXGeneral-Italic;\">x<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"texatom\" id=\"MathJax-Span-1799\"><span class=\"mrow\" id=\"MathJax-Span-1800\"><span class=\"mi\" id=\"MathJax-Span-1801\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">q</span><span class=\"mo\" id=\"MathJax-Span-1802\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">+</span><span class=\"mn\" id=\"MathJax-Span-1803\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1804\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mo\" id=\"MathJax-Span-1805\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1806\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1807\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1808\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-1809\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 0.992em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1810\" style=\"font-family: STIXGeneral-Italic;\">x<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"mi\" id=\"MathJax-Span-1811\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">T<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1812\" style=\"font-family: STIXGeneral-Regular;\">]</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.253em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mo stretchy=\"false\">[</mo><msub><mi>x</mi><mrow class=\"MJX-TeXAtom-ORD\"><mi>q</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>x</mi><mi>T</mi></msub><mo stretchy=\"false\">]</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-195\">[x_{q+1}, ..., x_T]</script>:</p>\n\n            <ul>\n              <li>The context is chunked into <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-196-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>C</mi><mi>i</mi></msub><mo>=</mo><mo stretchy=&quot;false&quot;>[</mo><msub><mi>x</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>q</mi><mo>+</mo><mi>k</mi><mo>&amp;#x2217;</mo><mi>i</mi></mrow></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>x</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>q</mi><mo>+</mo><mi>k</mi><mo>&amp;#x2217;</mo><mi>i</mi><mo>+</mo><mi>k</mi><mo>&amp;#x2212;</mo><mn>1</mn></mrow></msub><mo stretchy=&quot;false&quot;>]</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1813\" style=\"width: 13.544em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 11.253em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1011.15em, 2.659em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1814\"><span class=\"msubsup\" id=\"MathJax-Span-1815\"><span style=\"display: inline-block; position: relative; width: 0.94em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.68em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1816\" style=\"font-family: STIXGeneral-Italic;\">C<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.68em;\"><span class=\"mi\" id=\"MathJax-Span-1817\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1818\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mo\" id=\"MathJax-Span-1819\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">[</span><span class=\"msubsup\" id=\"MathJax-Span-1820\"><span style=\"display: inline-block; position: relative; width: 2.242em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1821\" style=\"font-family: STIXGeneral-Italic;\">x<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"texatom\" id=\"MathJax-Span-1822\"><span class=\"mrow\" id=\"MathJax-Span-1823\"><span class=\"mi\" id=\"MathJax-Span-1824\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">q</span><span class=\"mo\" id=\"MathJax-Span-1825\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">+</span><span class=\"mi\" id=\"MathJax-Span-1826\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1827\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">∗</span><span class=\"mi\" id=\"MathJax-Span-1828\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">i</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1829\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mo\" id=\"MathJax-Span-1830\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1831\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1832\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1833\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-1834\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 3.909em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1835\" style=\"font-family: STIXGeneral-Italic;\">x<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"texatom\" id=\"MathJax-Span-1836\"><span class=\"mrow\" id=\"MathJax-Span-1837\"><span class=\"mi\" id=\"MathJax-Span-1838\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">q</span><span class=\"mo\" id=\"MathJax-Span-1839\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">+</span><span class=\"mi\" id=\"MathJax-Span-1840\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1841\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">∗</span><span class=\"mi\" id=\"MathJax-Span-1842\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">i</span><span class=\"mo\" id=\"MathJax-Span-1843\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">+</span><span class=\"mi\" id=\"MathJax-Span-1844\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1845\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">−</span><span class=\"mn\" id=\"MathJax-Span-1846\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1847\" style=\"font-family: STIXGeneral-Regular;\">]</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.316em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>C</mi><mi>i</mi></msub><mo>=</mo><mo stretchy=\"false\">[</mo><msub><mi>x</mi><mrow class=\"MJX-TeXAtom-ORD\"><mi>q</mi><mo>+</mo><mi>k</mi><mo>∗</mo><mi>i</mi></mrow></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>x</mi><mrow class=\"MJX-TeXAtom-ORD\"><mi>q</mi><mo>+</mo><mi>k</mi><mo>∗</mo><mi>i</mi><mo>+</mo><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy=\"false\">]</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-196\">C_i = [x_{q+k*i}, ..., x_{q+k*i+k-1}]</script>.</li>\n              <li>The encoder produces a chunk embedding <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-197-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>c</mi><mi>i</mi></msub><mo>=</mo><msub><mi>M</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>e</mi><mi>n</mi><mi>c</mi></mrow></msub><mo stretchy=&quot;false&quot;>(</mo><msub><mi>C</mi><mi>i</mi></msub><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1848\" style=\"width: 6.513em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 5.419em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1005.37em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1849\"><span class=\"msubsup\" id=\"MathJax-Span-1850\"><span style=\"display: inline-block; position: relative; width: 0.732em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1851\" style=\"font-family: STIXGeneral-Italic;\">c</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"mi\" id=\"MathJax-Span-1852\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1853\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"msubsup\" id=\"MathJax-Span-1854\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 1.878em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1855\" style=\"font-family: STIXGeneral-Italic;\">M<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"texatom\" id=\"MathJax-Span-1856\"><span class=\"mrow\" id=\"MathJax-Span-1857\"><span class=\"mi\" id=\"MathJax-Span-1858\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">e</span><span class=\"mi\" id=\"MathJax-Span-1859\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">n</span><span class=\"mi\" id=\"MathJax-Span-1860\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">c</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1861\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"msubsup\" id=\"MathJax-Span-1862\"><span style=\"display: inline-block; position: relative; width: 0.94em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.68em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1863\" style=\"font-family: STIXGeneral-Italic;\">C<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.68em;\"><span class=\"mi\" id=\"MathJax-Span-1864\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1865\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>c</mi><mi>i</mi></msub><mo>=</mo><msub><mi>M</mi><mrow class=\"MJX-TeXAtom-ORD\"><mi>e</mi><mi>n</mi><mi>c</mi></mrow></msub><mo stretchy=\"false\">(</mo><msub><mi>C</mi><mi>i</mi></msub><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-197\">c_i = M_{enc}(C_i)</script>.</li>\n              <li>This is projected: <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-198-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>e</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>c</mi><mi>i</mi></msub></mrow></msub><mo>=</mo><mi>&amp;#x03D5;</mi><mo stretchy=&quot;false&quot;>(</mo><msub><mi>c</mi><mi>i</mi></msub><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1866\" style=\"width: 5.003em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 4.169em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1004.12em, 2.607em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1867\"><span class=\"msubsup\" id=\"MathJax-Span-1868\"><span style=\"display: inline-block; position: relative; width: 1.044em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1869\" style=\"font-family: STIXGeneral-Italic;\">e</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"texatom\" id=\"MathJax-Span-1870\"><span class=\"mrow\" id=\"MathJax-Span-1871\"><span class=\"msubsup\" id=\"MathJax-Span-1872\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.544em, 1000.32em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1873\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">c</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.904em; left: 0.315em;\"><span class=\"mi\" id=\"MathJax-Span-1874\" style=\"font-size: 50%; font-family: STIXGeneral-Italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1875\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mi\" id=\"MathJax-Span-1876\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">ϕ</span><span class=\"mo\" id=\"MathJax-Span-1877\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"msubsup\" id=\"MathJax-Span-1878\"><span style=\"display: inline-block; position: relative; width: 0.732em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1879\" style=\"font-family: STIXGeneral-Italic;\">c</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"mi\" id=\"MathJax-Span-1880\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1881\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.253em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>e</mi><mrow class=\"MJX-TeXAtom-ORD\"><msub><mi>c</mi><mi>i</mi></msub></mrow></msub><mo>=</mo><mi>ϕ</mi><mo stretchy=\"false\">(</mo><msub><mi>c</mi><mi>i</mi></msub><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-198\">e_{c_i} = \\phi(c_i)</script>.</li>\n              <li>The decoder then operates on <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-199-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>[</mo><msub><mi>e</mi><mn>1</mn></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>e</mi><mi>q</mi></msub><mo>,</mo><msub><mi>e</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>c</mi><mn>1</mn></msub></mrow></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>e</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>c</mi><mi>L</mi></msub></mrow></msub><mo stretchy=&quot;false&quot;>]</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1882\" style=\"width: 11.773em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 9.794em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1009.69em, 2.659em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1883\"><span class=\"mo\" id=\"MathJax-Span-1884\" style=\"font-family: STIXGeneral-Regular;\">[</span><span class=\"msubsup\" id=\"MathJax-Span-1885\"><span style=\"display: inline-block; position: relative; width: 0.888em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1886\" style=\"font-family: STIXGeneral-Italic;\">e</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"mn\" id=\"MathJax-Span-1887\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1888\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mo\" id=\"MathJax-Span-1889\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1890\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1891\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1892\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-1893\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 0.888em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1894\" style=\"font-family: STIXGeneral-Italic;\">e</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"mi\" id=\"MathJax-Span-1895\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">q</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1896\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-1897\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1898\" style=\"font-family: STIXGeneral-Italic;\">e</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"texatom\" id=\"MathJax-Span-1899\"><span class=\"mrow\" id=\"MathJax-Span-1900\"><span class=\"msubsup\" id=\"MathJax-Span-1901\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.544em, 1000.32em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1902\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">c</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.904em; left: 0.315em;\"><span class=\"mn\" id=\"MathJax-Span-1903\" style=\"font-size: 50%; font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1904\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mo\" id=\"MathJax-Span-1905\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1906\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1907\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1908\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-1909\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1910\" style=\"font-family: STIXGeneral-Italic;\">e</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"texatom\" id=\"MathJax-Span-1911\"><span class=\"mrow\" id=\"MathJax-Span-1912\"><span class=\"msubsup\" id=\"MathJax-Span-1913\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.544em, 1000.32em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1914\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">c</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.904em; left: 0.315em;\"><span class=\"mi\" id=\"MathJax-Span-1915\" style=\"font-size: 50%; font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1916\" style=\"font-family: STIXGeneral-Regular;\">]</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.253em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mo stretchy=\"false\">[</mo><msub><mi>e</mi><mn>1</mn></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>e</mi><mi>q</mi></msub><mo>,</mo><msub><mi>e</mi><mrow class=\"MJX-TeXAtom-ORD\"><msub><mi>c</mi><mn>1</mn></msub></mrow></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>e</mi><mrow class=\"MJX-TeXAtom-ORD\"><msub><mi>c</mi><mi>L</mi></msub></mrow></msub><mo stretchy=\"false\">]</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-199\">[e_1, ..., e_q, e_{c_1}, ..., e_{c_L}]</script>.</li>\n            </ul>\n          </li>\n        </ul>\n      </li>\n      <li>\n        <p><strong>Selective Compression</strong>:</p>\n\n        <ul>\n          <li>A lightweight RL policy (trained using next-paragraph prediction perplexity as a reward signal) decides which chunks should be expanded into full tokens versus retained as embeddings.</li>\n          <li>This enables flexible “compress-anywhere” capabilities without sacrificing autoregressiveness.</li>\n        </ul>\n      </li>\n      <li>\n        <p><strong>Training</strong>:</p>\n\n        <ol>\n          <li><strong>Reconstruction Task</strong>: Initially freezes the decoder and trains the encoder and projection layer to reconstruct original tokens from embeddings.</li>\n          <li><strong>Continual Pre-Training (CPT)</strong>: Uses next-paragraph prediction, allowing the decoder to learn from the encoder’s chunk representations.</li>\n          <li><strong>Curriculum Learning</strong>: Gradually increases chunk complexity during training.</li>\n          <li><strong>Instruction-Tuning</strong>: Adapts the model to specific downstream applications (RAG, multi-turn conversation, summarization).</li>\n        </ol>\n      </li>\n      <li>\n        <p><strong>Loss Function</strong>: Cross-entropy on next-token prediction during both reconstruction and CPT stages; policy gradients (e.g., PPO) for RL-based selective compression.</p>\n      </li>\n      <li>\n        <p><strong>Datasets</strong>:</p>\n\n        <ul>\n          <li>Pretraining: 20B tokens from SlimPajama’s Book and ArXiv subsets.</li>\n          <li>Evaluation: PG19, ProofPile, SlimPajama holdouts.</li>\n          <li>Fine-tuning: RAG benchmarks including MS MARCO, MMLU, BoolQ, CommonsenseQA, and others.</li>\n        </ul>\n      </li>\n      <li>\n        <p><strong>Benchmarking</strong>:</p>\n\n        <ul>\n          <li>Compared against CEPE, REPLUG, and LLaMA-2-7B (with or without full context).</li>\n          <li>Compression rates: <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-200-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi><mo>=</mo><mn>8</mn><mo>,</mo><mn>16</mn><mo>,</mo><mn>32</mn></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1917\" style=\"width: 6.148em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 5.107em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1005.11em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1918\"><span class=\"mi\" id=\"MathJax-Span-1919\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1920\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-1921\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">8</span><span class=\"mo\" id=\"MathJax-Span-1922\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mn\" id=\"MathJax-Span-1923\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">16</span><span class=\"mo\" id=\"MathJax-Span-1924\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mn\" id=\"MathJax-Span-1925\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">32</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi><mo>=</mo><mn>8</mn><mo>,</mo><mn>16</mn><mo>,</mo><mn>32</mn></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-200\">k = 8, 16, 32</script>.</li>\n          <li>Context lengths evaluated: 4096, 8192, 16384.</li>\n        </ul>\n      </li>\n      <li>\n        <p><strong>Performance</strong>:</p>\n\n        <ul>\n          <li>TTFT improved by <strong>30.85×</strong> over LLaMA and <strong>3.75×</strong> over CEPE at <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-201-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi><mo>=</mo><mn>32</mn></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1926\" style=\"width: 3.284em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.711em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1002.71em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1927\"><span class=\"mi\" id=\"MathJax-Span-1928\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1929\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-1930\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">32</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi><mo>=</mo><mn>32</mn></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-201\">k=32</script>.</li>\n          <li>Maintains or improves log-perplexity relative to CEPE across datasets.</li>\n          <li>Enables <strong>16× longer context</strong> with equal or better accuracy.</li>\n        </ul>\n      </li>\n      <li>\n        <p><strong>Generalization</strong>:</p>\n\n        <ul>\n          <li>Effective in RAG, multi-turn conversations, and long document summarization.</li>\n          <li>REFRAG16 with RL-based chunk selection often outperforms REFRAG8 trained with full compression, despite being trained at a higher compression rate.</li>\n        </ul>\n      </li>\n      <li>\n        <p><strong>Model Scalability</strong>:</p>\n\n        <ul>\n          <li>\n            <p>Tested with LLaMA-2-7B/13B and LLaMA-3 variants.</p>\n          </li>\n          <li>\n            <p>Larger decoders improve performance more than larger encoders, with limited benefit observed from encoder scaling beyond RoBERTa-Base.</p>\n          </li>\n        </ul>\n      </li>\n    </ul>\n<p><strong>Components</strong>:</p>\n<ul>\n          <li><strong>Decoder</strong>: A standard decoder-only model (e.g., LLaMA-2).</li>\n          <li><strong>Encoder</strong>: Lightweight encoder (e.g., RoBERTa-Base or -Large) to compute chunk embeddings.</li>\n          <li><strong>Chunking</strong>: The context (retrieved passages) is divided into <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-192-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi><mo>=</mo><mfrac><mi>s</mi><mi>k</mi></mfrac></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1763\" style=\"width: 3.023em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.503em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.5em, 2.763em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1764\"><span class=\"mi\" id=\"MathJax-Span-1765\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1766\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mfrac\" id=\"MathJax-Span-1767\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 0.471em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.544em, 1000.26em, 4.169em, -999.997em); top: -4.424em; left: 50%; margin-left: -0.154em;\"><span class=\"mi\" id=\"MathJax-Span-1768\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">s</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1000.32em, 4.169em, -999.997em); top: -3.643em; left: 50%; margin-left: -0.154em;\"><span class=\"mi\" id=\"MathJax-Span-1769\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1000.47em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.471em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.559em; border-left: 0px solid; width: 0px; height: 1.503em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>L</mi><mo>=</mo><mfrac><mi>s</mi><mi>k</mi></mfrac></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-192\">L = \\frac{s}{k}</script> chunks of size <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-193-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1770\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1771\"><span class=\"mi\" id=\"MathJax-Span-1772\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-193\">k</script> tokens. Each chunk is encoded into a vector representation via the encoder.</li>\n          <li><strong>Projection Layer</strong>: Aligns encoder outputs to the decoder’s token embedding dimension.</li>\n        </ul>\n<p><strong>Input Pipeline</strong>:</p>\n<ul>\n          <li>\n            <p>Given a prompt <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-194-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>x</mi><mo>=</mo><mo stretchy=&quot;false&quot;>[</mo><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><msub><mi>x</mi><mn>2</mn></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>x</mi><mi>q</mi></msub><mo stretchy=&quot;false&quot;>]</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1773\" style=\"width: 9.378em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 7.815em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1007.71em, 2.659em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1774\"><span class=\"mi\" id=\"MathJax-Span-1775\" style=\"font-family: STIXGeneral-Italic;\">x<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1776\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mo\" id=\"MathJax-Span-1777\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">[</span><span class=\"msubsup\" id=\"MathJax-Span-1778\"><span style=\"display: inline-block; position: relative; width: 0.888em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1779\" style=\"font-family: STIXGeneral-Italic;\">x<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"mn\" id=\"MathJax-Span-1780\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1781\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-1782\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 0.888em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1783\" style=\"font-family: STIXGeneral-Italic;\">x<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"mn\" id=\"MathJax-Span-1784\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1785\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mo\" id=\"MathJax-Span-1786\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1787\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1788\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1789\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-1790\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 0.888em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1791\" style=\"font-family: STIXGeneral-Italic;\">x<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"mi\" id=\"MathJax-Span-1792\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">q</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1793\" style=\"font-family: STIXGeneral-Regular;\">]</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.253em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>x</mi><mo>=</mo><mo stretchy=\"false\">[</mo><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><msub><mi>x</mi><mn>2</mn></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>x</mi><mi>q</mi></msub><mo stretchy=\"false\">]</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-194\">x = [x_1, x_2, ..., x_q]</script> and a context <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-195-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>[</mo><msub><mi>x</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>q</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>x</mi><mi>T</mi></msub><mo stretchy=&quot;false&quot;>]</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1794\" style=\"width: 6.826em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 5.68em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1005.58em, 2.659em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1795\"><span class=\"mo\" id=\"MathJax-Span-1796\" style=\"font-family: STIXGeneral-Regular;\">[</span><span class=\"msubsup\" id=\"MathJax-Span-1797\"><span style=\"display: inline-block; position: relative; width: 1.721em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1798\" style=\"font-family: STIXGeneral-Italic;\">x<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"texatom\" id=\"MathJax-Span-1799\"><span class=\"mrow\" id=\"MathJax-Span-1800\"><span class=\"mi\" id=\"MathJax-Span-1801\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">q</span><span class=\"mo\" id=\"MathJax-Span-1802\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">+</span><span class=\"mn\" id=\"MathJax-Span-1803\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1804\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mo\" id=\"MathJax-Span-1805\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1806\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1807\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1808\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-1809\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 0.992em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1810\" style=\"font-family: STIXGeneral-Italic;\">x<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"mi\" id=\"MathJax-Span-1811\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">T<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1812\" style=\"font-family: STIXGeneral-Regular;\">]</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.253em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mo stretchy=\"false\">[</mo><msub><mi>x</mi><mrow class=\"MJX-TeXAtom-ORD\"><mi>q</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>x</mi><mi>T</mi></msub><mo stretchy=\"false\">]</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-195\">[x_{q+1}, ..., x_T]</script>:</p>\n\n            <ul>\n              <li>The context is chunked into <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-196-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>C</mi><mi>i</mi></msub><mo>=</mo><mo stretchy=&quot;false&quot;>[</mo><msub><mi>x</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>q</mi><mo>+</mo><mi>k</mi><mo>&amp;#x2217;</mo><mi>i</mi></mrow></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>x</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>q</mi><mo>+</mo><mi>k</mi><mo>&amp;#x2217;</mo><mi>i</mi><mo>+</mo><mi>k</mi><mo>&amp;#x2212;</mo><mn>1</mn></mrow></msub><mo stretchy=&quot;false&quot;>]</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1813\" style=\"width: 13.544em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 11.253em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1011.15em, 2.659em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1814\"><span class=\"msubsup\" id=\"MathJax-Span-1815\"><span style=\"display: inline-block; position: relative; width: 0.94em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.68em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1816\" style=\"font-family: STIXGeneral-Italic;\">C<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.68em;\"><span class=\"mi\" id=\"MathJax-Span-1817\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1818\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mo\" id=\"MathJax-Span-1819\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">[</span><span class=\"msubsup\" id=\"MathJax-Span-1820\"><span style=\"display: inline-block; position: relative; width: 2.242em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1821\" style=\"font-family: STIXGeneral-Italic;\">x<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"texatom\" id=\"MathJax-Span-1822\"><span class=\"mrow\" id=\"MathJax-Span-1823\"><span class=\"mi\" id=\"MathJax-Span-1824\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">q</span><span class=\"mo\" id=\"MathJax-Span-1825\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">+</span><span class=\"mi\" id=\"MathJax-Span-1826\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1827\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">∗</span><span class=\"mi\" id=\"MathJax-Span-1828\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">i</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1829\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mo\" id=\"MathJax-Span-1830\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1831\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1832\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1833\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-1834\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 3.909em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1835\" style=\"font-family: STIXGeneral-Italic;\">x<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"texatom\" id=\"MathJax-Span-1836\"><span class=\"mrow\" id=\"MathJax-Span-1837\"><span class=\"mi\" id=\"MathJax-Span-1838\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">q</span><span class=\"mo\" id=\"MathJax-Span-1839\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">+</span><span class=\"mi\" id=\"MathJax-Span-1840\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1841\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">∗</span><span class=\"mi\" id=\"MathJax-Span-1842\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">i</span><span class=\"mo\" id=\"MathJax-Span-1843\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">+</span><span class=\"mi\" id=\"MathJax-Span-1844\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1845\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">−</span><span class=\"mn\" id=\"MathJax-Span-1846\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1847\" style=\"font-family: STIXGeneral-Regular;\">]</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.316em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>C</mi><mi>i</mi></msub><mo>=</mo><mo stretchy=\"false\">[</mo><msub><mi>x</mi><mrow class=\"MJX-TeXAtom-ORD\"><mi>q</mi><mo>+</mo><mi>k</mi><mo>∗</mo><mi>i</mi></mrow></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>x</mi><mrow class=\"MJX-TeXAtom-ORD\"><mi>q</mi><mo>+</mo><mi>k</mi><mo>∗</mo><mi>i</mi><mo>+</mo><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy=\"false\">]</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-196\">C_i = [x_{q+k*i}, ..., x_{q+k*i+k-1}]</script>.</li>\n              <li>The encoder produces a chunk embedding <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-197-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>c</mi><mi>i</mi></msub><mo>=</mo><msub><mi>M</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>e</mi><mi>n</mi><mi>c</mi></mrow></msub><mo stretchy=&quot;false&quot;>(</mo><msub><mi>C</mi><mi>i</mi></msub><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1848\" style=\"width: 6.513em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 5.419em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1005.37em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1849\"><span class=\"msubsup\" id=\"MathJax-Span-1850\"><span style=\"display: inline-block; position: relative; width: 0.732em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1851\" style=\"font-family: STIXGeneral-Italic;\">c</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"mi\" id=\"MathJax-Span-1852\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1853\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"msubsup\" id=\"MathJax-Span-1854\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 1.878em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1855\" style=\"font-family: STIXGeneral-Italic;\">M<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"texatom\" id=\"MathJax-Span-1856\"><span class=\"mrow\" id=\"MathJax-Span-1857\"><span class=\"mi\" id=\"MathJax-Span-1858\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">e</span><span class=\"mi\" id=\"MathJax-Span-1859\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">n</span><span class=\"mi\" id=\"MathJax-Span-1860\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">c</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1861\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"msubsup\" id=\"MathJax-Span-1862\"><span style=\"display: inline-block; position: relative; width: 0.94em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.68em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1863\" style=\"font-family: STIXGeneral-Italic;\">C<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.68em;\"><span class=\"mi\" id=\"MathJax-Span-1864\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1865\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>c</mi><mi>i</mi></msub><mo>=</mo><msub><mi>M</mi><mrow class=\"MJX-TeXAtom-ORD\"><mi>e</mi><mi>n</mi><mi>c</mi></mrow></msub><mo stretchy=\"false\">(</mo><msub><mi>C</mi><mi>i</mi></msub><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-197\">c_i = M_{enc}(C_i)</script>.</li>\n              <li>This is projected: <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-198-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>e</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>c</mi><mi>i</mi></msub></mrow></msub><mo>=</mo><mi>&amp;#x03D5;</mi><mo stretchy=&quot;false&quot;>(</mo><msub><mi>c</mi><mi>i</mi></msub><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1866\" style=\"width: 5.003em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 4.169em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1004.12em, 2.607em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1867\"><span class=\"msubsup\" id=\"MathJax-Span-1868\"><span style=\"display: inline-block; position: relative; width: 1.044em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1869\" style=\"font-family: STIXGeneral-Italic;\">e</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"texatom\" id=\"MathJax-Span-1870\"><span class=\"mrow\" id=\"MathJax-Span-1871\"><span class=\"msubsup\" id=\"MathJax-Span-1872\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.544em, 1000.32em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1873\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">c</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.904em; left: 0.315em;\"><span class=\"mi\" id=\"MathJax-Span-1874\" style=\"font-size: 50%; font-family: STIXGeneral-Italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1875\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mi\" id=\"MathJax-Span-1876\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">ϕ</span><span class=\"mo\" id=\"MathJax-Span-1877\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"msubsup\" id=\"MathJax-Span-1878\"><span style=\"display: inline-block; position: relative; width: 0.732em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1879\" style=\"font-family: STIXGeneral-Italic;\">c</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"mi\" id=\"MathJax-Span-1880\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1881\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.253em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>e</mi><mrow class=\"MJX-TeXAtom-ORD\"><msub><mi>c</mi><mi>i</mi></msub></mrow></msub><mo>=</mo><mi>ϕ</mi><mo stretchy=\"false\">(</mo><msub><mi>c</mi><mi>i</mi></msub><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-198\">e_{c_i} = \\phi(c_i)</script>.</li>\n              <li>The decoder then operates on <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-199-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>[</mo><msub><mi>e</mi><mn>1</mn></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>e</mi><mi>q</mi></msub><mo>,</mo><msub><mi>e</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>c</mi><mn>1</mn></msub></mrow></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>e</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>c</mi><mi>L</mi></msub></mrow></msub><mo stretchy=&quot;false&quot;>]</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1882\" style=\"width: 11.773em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 9.794em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1009.69em, 2.659em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1883\"><span class=\"mo\" id=\"MathJax-Span-1884\" style=\"font-family: STIXGeneral-Regular;\">[</span><span class=\"msubsup\" id=\"MathJax-Span-1885\"><span style=\"display: inline-block; position: relative; width: 0.888em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1886\" style=\"font-family: STIXGeneral-Italic;\">e</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"mn\" id=\"MathJax-Span-1887\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1888\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mo\" id=\"MathJax-Span-1889\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1890\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1891\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1892\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-1893\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 0.888em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1894\" style=\"font-family: STIXGeneral-Italic;\">e</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"mi\" id=\"MathJax-Span-1895\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">q</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1896\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-1897\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1898\" style=\"font-family: STIXGeneral-Italic;\">e</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"texatom\" id=\"MathJax-Span-1899\"><span class=\"mrow\" id=\"MathJax-Span-1900\"><span class=\"msubsup\" id=\"MathJax-Span-1901\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.544em, 1000.32em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1902\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">c</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.904em; left: 0.315em;\"><span class=\"mn\" id=\"MathJax-Span-1903\" style=\"font-size: 50%; font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1904\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mo\" id=\"MathJax-Span-1905\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1906\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1907\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1908\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-1909\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1910\" style=\"font-family: STIXGeneral-Italic;\">e</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"texatom\" id=\"MathJax-Span-1911\"><span class=\"mrow\" id=\"MathJax-Span-1912\"><span class=\"msubsup\" id=\"MathJax-Span-1913\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.544em, 1000.32em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1914\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">c</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.904em; left: 0.315em;\"><span class=\"mi\" id=\"MathJax-Span-1915\" style=\"font-size: 50%; font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1916\" style=\"font-family: STIXGeneral-Regular;\">]</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.253em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mo stretchy=\"false\">[</mo><msub><mi>e</mi><mn>1</mn></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>e</mi><mi>q</mi></msub><mo>,</mo><msub><mi>e</mi><mrow class=\"MJX-TeXAtom-ORD\"><msub><mi>c</mi><mn>1</mn></msub></mrow></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>e</mi><mrow class=\"MJX-TeXAtom-ORD\"><msub><mi>c</mi><mi>L</mi></msub></mrow></msub><mo stretchy=\"false\">]</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-199\">[e_1, ..., e_q, e_{c_1}, ..., e_{c_L}]</script>.</li>\n            </ul>\n          </li>\n        </ul>\n<p>Given a prompt <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-194-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>x</mi><mo>=</mo><mo stretchy=&quot;false&quot;>[</mo><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><msub><mi>x</mi><mn>2</mn></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>x</mi><mi>q</mi></msub><mo stretchy=&quot;false&quot;>]</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1773\" style=\"width: 9.378em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 7.815em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1007.71em, 2.659em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1774\"><span class=\"mi\" id=\"MathJax-Span-1775\" style=\"font-family: STIXGeneral-Italic;\">x<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1776\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mo\" id=\"MathJax-Span-1777\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">[</span><span class=\"msubsup\" id=\"MathJax-Span-1778\"><span style=\"display: inline-block; position: relative; width: 0.888em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1779\" style=\"font-family: STIXGeneral-Italic;\">x<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"mn\" id=\"MathJax-Span-1780\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1781\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-1782\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 0.888em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1783\" style=\"font-family: STIXGeneral-Italic;\">x<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"mn\" id=\"MathJax-Span-1784\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1785\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mo\" id=\"MathJax-Span-1786\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1787\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1788\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1789\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-1790\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 0.888em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1791\" style=\"font-family: STIXGeneral-Italic;\">x<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"mi\" id=\"MathJax-Span-1792\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">q</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1793\" style=\"font-family: STIXGeneral-Regular;\">]</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.253em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>x</mi><mo>=</mo><mo stretchy=\"false\">[</mo><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><msub><mi>x</mi><mn>2</mn></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>x</mi><mi>q</mi></msub><mo stretchy=\"false\">]</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-194\">x = [x_1, x_2, ..., x_q]</script> and a context <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-195-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>[</mo><msub><mi>x</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>q</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>x</mi><mi>T</mi></msub><mo stretchy=&quot;false&quot;>]</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1794\" style=\"width: 6.826em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 5.68em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1005.58em, 2.659em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1795\"><span class=\"mo\" id=\"MathJax-Span-1796\" style=\"font-family: STIXGeneral-Regular;\">[</span><span class=\"msubsup\" id=\"MathJax-Span-1797\"><span style=\"display: inline-block; position: relative; width: 1.721em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1798\" style=\"font-family: STIXGeneral-Italic;\">x<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"texatom\" id=\"MathJax-Span-1799\"><span class=\"mrow\" id=\"MathJax-Span-1800\"><span class=\"mi\" id=\"MathJax-Span-1801\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">q</span><span class=\"mo\" id=\"MathJax-Span-1802\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">+</span><span class=\"mn\" id=\"MathJax-Span-1803\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1804\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mo\" id=\"MathJax-Span-1805\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1806\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1807\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1808\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-1809\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 0.992em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1810\" style=\"font-family: STIXGeneral-Italic;\">x<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"mi\" id=\"MathJax-Span-1811\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">T<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1812\" style=\"font-family: STIXGeneral-Regular;\">]</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.253em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mo stretchy=\"false\">[</mo><msub><mi>x</mi><mrow class=\"MJX-TeXAtom-ORD\"><mi>q</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>x</mi><mi>T</mi></msub><mo stretchy=\"false\">]</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-195\">[x_{q+1}, ..., x_T]</script>:</p>\n<ul>\n              <li>The context is chunked into <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-196-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>C</mi><mi>i</mi></msub><mo>=</mo><mo stretchy=&quot;false&quot;>[</mo><msub><mi>x</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>q</mi><mo>+</mo><mi>k</mi><mo>&amp;#x2217;</mo><mi>i</mi></mrow></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>x</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>q</mi><mo>+</mo><mi>k</mi><mo>&amp;#x2217;</mo><mi>i</mi><mo>+</mo><mi>k</mi><mo>&amp;#x2212;</mo><mn>1</mn></mrow></msub><mo stretchy=&quot;false&quot;>]</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1813\" style=\"width: 13.544em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 11.253em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1011.15em, 2.659em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1814\"><span class=\"msubsup\" id=\"MathJax-Span-1815\"><span style=\"display: inline-block; position: relative; width: 0.94em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.68em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1816\" style=\"font-family: STIXGeneral-Italic;\">C<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.68em;\"><span class=\"mi\" id=\"MathJax-Span-1817\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1818\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mo\" id=\"MathJax-Span-1819\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">[</span><span class=\"msubsup\" id=\"MathJax-Span-1820\"><span style=\"display: inline-block; position: relative; width: 2.242em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1821\" style=\"font-family: STIXGeneral-Italic;\">x<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"texatom\" id=\"MathJax-Span-1822\"><span class=\"mrow\" id=\"MathJax-Span-1823\"><span class=\"mi\" id=\"MathJax-Span-1824\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">q</span><span class=\"mo\" id=\"MathJax-Span-1825\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">+</span><span class=\"mi\" id=\"MathJax-Span-1826\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1827\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">∗</span><span class=\"mi\" id=\"MathJax-Span-1828\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">i</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1829\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mo\" id=\"MathJax-Span-1830\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1831\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1832\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1833\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-1834\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 3.909em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1835\" style=\"font-family: STIXGeneral-Italic;\">x<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"texatom\" id=\"MathJax-Span-1836\"><span class=\"mrow\" id=\"MathJax-Span-1837\"><span class=\"mi\" id=\"MathJax-Span-1838\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">q</span><span class=\"mo\" id=\"MathJax-Span-1839\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">+</span><span class=\"mi\" id=\"MathJax-Span-1840\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1841\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">∗</span><span class=\"mi\" id=\"MathJax-Span-1842\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">i</span><span class=\"mo\" id=\"MathJax-Span-1843\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">+</span><span class=\"mi\" id=\"MathJax-Span-1844\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1845\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">−</span><span class=\"mn\" id=\"MathJax-Span-1846\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1847\" style=\"font-family: STIXGeneral-Regular;\">]</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.316em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>C</mi><mi>i</mi></msub><mo>=</mo><mo stretchy=\"false\">[</mo><msub><mi>x</mi><mrow class=\"MJX-TeXAtom-ORD\"><mi>q</mi><mo>+</mo><mi>k</mi><mo>∗</mo><mi>i</mi></mrow></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>x</mi><mrow class=\"MJX-TeXAtom-ORD\"><mi>q</mi><mo>+</mo><mi>k</mi><mo>∗</mo><mi>i</mi><mo>+</mo><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy=\"false\">]</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-196\">C_i = [x_{q+k*i}, ..., x_{q+k*i+k-1}]</script>.</li>\n              <li>The encoder produces a chunk embedding <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-197-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>c</mi><mi>i</mi></msub><mo>=</mo><msub><mi>M</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>e</mi><mi>n</mi><mi>c</mi></mrow></msub><mo stretchy=&quot;false&quot;>(</mo><msub><mi>C</mi><mi>i</mi></msub><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1848\" style=\"width: 6.513em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 5.419em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1005.37em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1849\"><span class=\"msubsup\" id=\"MathJax-Span-1850\"><span style=\"display: inline-block; position: relative; width: 0.732em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1851\" style=\"font-family: STIXGeneral-Italic;\">c</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"mi\" id=\"MathJax-Span-1852\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1853\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"msubsup\" id=\"MathJax-Span-1854\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 1.878em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1855\" style=\"font-family: STIXGeneral-Italic;\">M<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"texatom\" id=\"MathJax-Span-1856\"><span class=\"mrow\" id=\"MathJax-Span-1857\"><span class=\"mi\" id=\"MathJax-Span-1858\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">e</span><span class=\"mi\" id=\"MathJax-Span-1859\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">n</span><span class=\"mi\" id=\"MathJax-Span-1860\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">c</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1861\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"msubsup\" id=\"MathJax-Span-1862\"><span style=\"display: inline-block; position: relative; width: 0.94em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.68em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1863\" style=\"font-family: STIXGeneral-Italic;\">C<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.68em;\"><span class=\"mi\" id=\"MathJax-Span-1864\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1865\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>c</mi><mi>i</mi></msub><mo>=</mo><msub><mi>M</mi><mrow class=\"MJX-TeXAtom-ORD\"><mi>e</mi><mi>n</mi><mi>c</mi></mrow></msub><mo stretchy=\"false\">(</mo><msub><mi>C</mi><mi>i</mi></msub><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-197\">c_i = M_{enc}(C_i)</script>.</li>\n              <li>This is projected: <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-198-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>e</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>c</mi><mi>i</mi></msub></mrow></msub><mo>=</mo><mi>&amp;#x03D5;</mi><mo stretchy=&quot;false&quot;>(</mo><msub><mi>c</mi><mi>i</mi></msub><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1866\" style=\"width: 5.003em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 4.169em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1004.12em, 2.607em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1867\"><span class=\"msubsup\" id=\"MathJax-Span-1868\"><span style=\"display: inline-block; position: relative; width: 1.044em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1869\" style=\"font-family: STIXGeneral-Italic;\">e</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"texatom\" id=\"MathJax-Span-1870\"><span class=\"mrow\" id=\"MathJax-Span-1871\"><span class=\"msubsup\" id=\"MathJax-Span-1872\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.544em, 1000.32em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1873\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">c</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.904em; left: 0.315em;\"><span class=\"mi\" id=\"MathJax-Span-1874\" style=\"font-size: 50%; font-family: STIXGeneral-Italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1875\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mi\" id=\"MathJax-Span-1876\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">ϕ</span><span class=\"mo\" id=\"MathJax-Span-1877\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"msubsup\" id=\"MathJax-Span-1878\"><span style=\"display: inline-block; position: relative; width: 0.732em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1879\" style=\"font-family: STIXGeneral-Italic;\">c</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"mi\" id=\"MathJax-Span-1880\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1881\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.253em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>e</mi><mrow class=\"MJX-TeXAtom-ORD\"><msub><mi>c</mi><mi>i</mi></msub></mrow></msub><mo>=</mo><mi>ϕ</mi><mo stretchy=\"false\">(</mo><msub><mi>c</mi><mi>i</mi></msub><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-198\">e_{c_i} = \\phi(c_i)</script>.</li>\n              <li>The decoder then operates on <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-199-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>[</mo><msub><mi>e</mi><mn>1</mn></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>e</mi><mi>q</mi></msub><mo>,</mo><msub><mi>e</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>c</mi><mn>1</mn></msub></mrow></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>e</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>c</mi><mi>L</mi></msub></mrow></msub><mo stretchy=&quot;false&quot;>]</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1882\" style=\"width: 11.773em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 9.794em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1009.69em, 2.659em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1883\"><span class=\"mo\" id=\"MathJax-Span-1884\" style=\"font-family: STIXGeneral-Regular;\">[</span><span class=\"msubsup\" id=\"MathJax-Span-1885\"><span style=\"display: inline-block; position: relative; width: 0.888em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1886\" style=\"font-family: STIXGeneral-Italic;\">e</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"mn\" id=\"MathJax-Span-1887\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1888\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mo\" id=\"MathJax-Span-1889\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1890\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1891\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1892\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-1893\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 0.888em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1894\" style=\"font-family: STIXGeneral-Italic;\">e</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"mi\" id=\"MathJax-Span-1895\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">q</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1896\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-1897\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1898\" style=\"font-family: STIXGeneral-Italic;\">e</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"texatom\" id=\"MathJax-Span-1899\"><span class=\"mrow\" id=\"MathJax-Span-1900\"><span class=\"msubsup\" id=\"MathJax-Span-1901\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.544em, 1000.32em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1902\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">c</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.904em; left: 0.315em;\"><span class=\"mn\" id=\"MathJax-Span-1903\" style=\"font-size: 50%; font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1904\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mo\" id=\"MathJax-Span-1905\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1906\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1907\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">.</span><span class=\"mo\" id=\"MathJax-Span-1908\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-1909\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 1.148em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1910\" style=\"font-family: STIXGeneral-Italic;\">e</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"texatom\" id=\"MathJax-Span-1911\"><span class=\"mrow\" id=\"MathJax-Span-1912\"><span class=\"msubsup\" id=\"MathJax-Span-1913\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.544em, 1000.32em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1914\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">c</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.904em; left: 0.315em;\"><span class=\"mi\" id=\"MathJax-Span-1915\" style=\"font-size: 50%; font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1916\" style=\"font-family: STIXGeneral-Regular;\">]</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.253em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mo stretchy=\"false\">[</mo><msub><mi>e</mi><mn>1</mn></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>e</mi><mi>q</mi></msub><mo>,</mo><msub><mi>e</mi><mrow class=\"MJX-TeXAtom-ORD\"><msub><mi>c</mi><mn>1</mn></msub></mrow></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>e</mi><mrow class=\"MJX-TeXAtom-ORD\"><msub><mi>c</mi><mi>L</mi></msub></mrow></msub><mo stretchy=\"false\">]</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-199\">[e_1, ..., e_q, e_{c_1}, ..., e_{c_L}]</script>.</li>\n            </ul>\n<p><strong>Selective Compression</strong>:</p>\n<ul>\n          <li>A lightweight RL policy (trained using next-paragraph prediction perplexity as a reward signal) decides which chunks should be expanded into full tokens versus retained as embeddings.</li>\n          <li>This enables flexible “compress-anywhere” capabilities without sacrificing autoregressiveness.</li>\n        </ul>\n<p><strong>Training</strong>:</p>\n<ol>\n          <li><strong>Reconstruction Task</strong>: Initially freezes the decoder and trains the encoder and projection layer to reconstruct original tokens from embeddings.</li>\n          <li><strong>Continual Pre-Training (CPT)</strong>: Uses next-paragraph prediction, allowing the decoder to learn from the encoder’s chunk representations.</li>\n          <li><strong>Curriculum Learning</strong>: Gradually increases chunk complexity during training.</li>\n          <li><strong>Instruction-Tuning</strong>: Adapts the model to specific downstream applications (RAG, multi-turn conversation, summarization).</li>\n        </ol>\n<p><strong>Loss Function</strong>: Cross-entropy on next-token prediction during both reconstruction and CPT stages; policy gradients (e.g., PPO) for RL-based selective compression.</p>\n<p><strong>Datasets</strong>:</p>\n<ul>\n          <li>Pretraining: 20B tokens from SlimPajama’s Book and ArXiv subsets.</li>\n          <li>Evaluation: PG19, ProofPile, SlimPajama holdouts.</li>\n          <li>Fine-tuning: RAG benchmarks including MS MARCO, MMLU, BoolQ, CommonsenseQA, and others.</li>\n        </ul>\n<p><strong>Benchmarking</strong>:</p>\n<ul>\n          <li>Compared against CEPE, REPLUG, and LLaMA-2-7B (with or without full context).</li>\n          <li>Compression rates: <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-200-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi><mo>=</mo><mn>8</mn><mo>,</mo><mn>16</mn><mo>,</mo><mn>32</mn></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1917\" style=\"width: 6.148em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 5.107em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1005.11em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1918\"><span class=\"mi\" id=\"MathJax-Span-1919\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1920\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-1921\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">8</span><span class=\"mo\" id=\"MathJax-Span-1922\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mn\" id=\"MathJax-Span-1923\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">16</span><span class=\"mo\" id=\"MathJax-Span-1924\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mn\" id=\"MathJax-Span-1925\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">32</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi><mo>=</mo><mn>8</mn><mo>,</mo><mn>16</mn><mo>,</mo><mn>32</mn></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-200\">k = 8, 16, 32</script>.</li>\n          <li>Context lengths evaluated: 4096, 8192, 16384.</li>\n        </ul>\n<p><strong>Performance</strong>:</p>\n<ul>\n          <li>TTFT improved by <strong>30.85×</strong> over LLaMA and <strong>3.75×</strong> over CEPE at <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-201-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi><mo>=</mo><mn>32</mn></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1926\" style=\"width: 3.284em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.711em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1002.71em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1927\"><span class=\"mi\" id=\"MathJax-Span-1928\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1929\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-1930\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">32</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi><mo>=</mo><mn>32</mn></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-201\">k=32</script>.</li>\n          <li>Maintains or improves log-perplexity relative to CEPE across datasets.</li>\n          <li>Enables <strong>16× longer context</strong> with equal or better accuracy.</li>\n        </ul>\n<p><strong>Generalization</strong>:</p>\n<ul>\n          <li>Effective in RAG, multi-turn conversations, and long document summarization.</li>\n          <li>REFRAG16 with RL-based chunk selection often outperforms REFRAG8 trained with full compression, despite being trained at a higher compression rate.</li>\n        </ul>\n<p><strong>Model Scalability</strong>:</p>\n<ul>\n          <li>\n            <p>Tested with LLaMA-2-7B/13B and LLaMA-3 variants.</p>\n          </li>\n          <li>\n            <p>Larger decoders improve performance more than larger encoders, with limited benefit observed from encoder scaling beyond RoBERTa-Base.</p>\n          </li>\n        </ul>\n<p>Tested with LLaMA-2-7B/13B and LLaMA-3 variants.</p>\n<p>Larger decoders improve performance more than larger encoders, with limited benefit observed from encoder scaling beyond RoBERTa-Base.</p>\n<p>The following figure from the paper shows the main design of REFRAG. The input context is chunked and processed by the light-weight encoder to produce chunk embeddings, which are precomputable for efficient reuse. A light-weight RL policy decide few chunks to expand. These chunk embeddings along with the token embeddings of the question input are fed to the decoder.</p>\n<p><img src=\"../../../images/papers/REFRAG.jpg\" alt=\"\"></p>\n<ul>\n  <li>\n    <p><strong>Comparison to CEPE</strong>:</p>\n\n    <ul>\n      <li>CEPE reduces KV memory but sacrifices causal structure, making it incompatible with multi-turn tasks.</li>\n      <li>REFRAG preserves autoregressive decoding and supports chunk compression at arbitrary positions, enabling broader use cases.</li>\n    </ul>\n  </li>\n  <li>\n    <p><a href=\"https://github.com/facebookresearch/refrag\">Code</a></p>\n  </li>\n</ul>\n<p><strong>Comparison to CEPE</strong>:</p>\n<ul>\n      <li>CEPE reduces KV memory but sacrifices causal structure, making it incompatible with multi-turn tasks.</li>\n      <li>REFRAG preserves autoregressive decoding and supports chunk compression at arbitrary positions, enabling broader use cases.</li>\n    </ul>\n<p><a href=\"https://github.com/facebookresearch/refrag\">Code</a></p>",
    "contentMarkdown": "*   This paper by Lin et al. from Meta Superintelligence Labs, the National University of Singapore, and Rice University presents REpresentation For RAG **(REFRAG)**, a novel framework designed to accelerate decoding in RAG by compressing context tokens into chunk-level embeddings, significantly reducing latency and memory overhead without altering the underlying decoder architecture.\n    \n*   **Motivation**: While large language models (LLMs) excel at contextual learning in tasks like RAG, long context sequences dramatically increase inference latency—especially the time-to-first-token (TTFT)—due to quadratic scaling in attention computation and key-value (KV) cache memory usage. In RAG specifically, the majority of the context consists of retrieved documents, many of which are only marginally relevant, leading to block-diagonal attention patterns that are sparsely connected. The authors argue that most of this computation is wasteful and propose a method to exploit this sparsity.\n    \n*   **Core Idea**: Instead of feeding full tokenized contexts to the decoder, REFRAG replaces these with **precomputed, compressed chunk embeddings** derived from a lightweight encoder (e.g., RoBERTa). A selective RL-based policy determines which chunks need full token expansion and which can remain compressed. This greatly reduces the decoder input size and hence latency, especially TTFT.\n    \n*   **Architecture and Implementation**:\n    \n    *   **Components**:\n        \n        *   **Decoder**: A standard decoder-only model (e.g., LLaMA-2).\n        *   **Encoder**: Lightweight encoder (e.g., RoBERTa-Base or -Large) to compute chunk embeddings.\n        *   **Chunking**: The context (retrieved passages) is divided into L\\=skL\\=skL = \\\\frac{s}{k} chunks of size kkk tokens. Each chunk is encoded into a vector representation via the encoder.\n        *   **Projection Layer**: Aligns encoder outputs to the decoder’s token embedding dimension.\n    *   **Input Pipeline**:\n        \n        *   Given a prompt x\\=\\[x1,x2,...,xq\\]x\\=\\[x1,x2,...,xq\\]x = \\[x\\_1, x\\_2, ..., x\\_q\\] and a context \\[xq+1,...,xT\\]\\[xq+1,...,xT\\]\\[x\\_{q+1}, ..., x\\_T\\]:\n            \n            *   The context is chunked into Ci\\=\\[xq+k∗i,...,xq+k∗i+k−1\\]Ci\\=\\[xq+k∗i,...,xq+k∗i+k−1\\]C\\_i = \\[x\\_{q+k\\*i}, ..., x\\_{q+k\\*i+k-1}\\].\n            *   The encoder produces a chunk embedding ci\\=Menc(Ci)ci\\=Menc(Ci)c\\_i = M\\_{enc}(C\\_i).\n            *   This is projected: eci\\=ϕ(ci)eci\\=ϕ(ci)e\\_{c\\_i} = \\\\phi(c\\_i).\n            *   The decoder then operates on \\[e1,...,eq,ec1,...,ecL\\]\\[e1,...,eq,ec1,...,ecL\\]\\[e\\_1, ..., e\\_q, e\\_{c\\_1}, ..., e\\_{c\\_L}\\].\n    *   **Selective Compression**:\n        \n        *   A lightweight RL policy (trained using next-paragraph prediction perplexity as a reward signal) decides which chunks should be expanded into full tokens versus retained as embeddings.\n        *   This enables flexible “compress-anywhere” capabilities without sacrificing autoregressiveness.\n    *   **Training**:\n        \n        1.  **Reconstruction Task**: Initially freezes the decoder and trains the encoder and projection layer to reconstruct original tokens from embeddings.\n        2.  **Continual Pre-Training (CPT)**: Uses next-paragraph prediction, allowing the decoder to learn from the encoder’s chunk representations.\n        3.  **Curriculum Learning**: Gradually increases chunk complexity during training.\n        4.  **Instruction-Tuning**: Adapts the model to specific downstream applications (RAG, multi-turn conversation, summarization).\n    *   **Loss Function**: Cross-entropy on next-token prediction during both reconstruction and CPT stages; policy gradients (e.g., PPO) for RL-based selective compression.\n        \n    *   **Datasets**:\n        \n        *   Pretraining: 20B tokens from SlimPajama’s Book and ArXiv subsets.\n        *   Evaluation: PG19, ProofPile, SlimPajama holdouts.\n        *   Fine-tuning: RAG benchmarks including MS MARCO, MMLU, BoolQ, CommonsenseQA, and others.\n    *   **Benchmarking**:\n        \n        *   Compared against CEPE, REPLUG, and LLaMA-2-7B (with or without full context).\n        *   Compression rates: k\\=8,16,32k\\=8,16,32k = 8, 16, 32.\n        *   Context lengths evaluated: 4096, 8192, 16384.\n    *   **Performance**:\n        \n        *   TTFT improved by **30.85×** over LLaMA and **3.75×** over CEPE at k\\=32k\\=32k=32.\n        *   Maintains or improves log-perplexity relative to CEPE across datasets.\n        *   Enables **16× longer context** with equal or better accuracy.\n    *   **Generalization**:\n        \n        *   Effective in RAG, multi-turn conversations, and long document summarization.\n        *   REFRAG16 with RL-based chunk selection often outperforms REFRAG8 trained with full compression, despite being trained at a higher compression rate.\n    *   **Model Scalability**:\n        \n        *   Tested with LLaMA-2-7B/13B and LLaMA-3 variants.\n            \n        *   Larger decoders improve performance more than larger encoders, with limited benefit observed from encoder scaling beyond RoBERTa-Base.\n            \n*   The following figure from the paper shows the main design of REFRAG. The input context is chunked and processed by the light-weight encoder to produce chunk embeddings, which are precomputable for efficient reuse. A light-weight RL policy decide few chunks to expand. These chunk embeddings along with the token embeddings of the question input are fed to the decoder.\n    \n\nThis paper by Lin et al. from Meta Superintelligence Labs, the National University of Singapore, and Rice University presents REpresentation For RAG **(REFRAG)**, a novel framework designed to accelerate decoding in RAG by compressing context tokens into chunk-level embeddings, significantly reducing latency and memory overhead without altering the underlying decoder architecture.\n\n**Motivation**: While large language models (LLMs) excel at contextual learning in tasks like RAG, long context sequences dramatically increase inference latency—especially the time-to-first-token (TTFT)—due to quadratic scaling in attention computation and key-value (KV) cache memory usage. In RAG specifically, the majority of the context consists of retrieved documents, many of which are only marginally relevant, leading to block-diagonal attention patterns that are sparsely connected. The authors argue that most of this computation is wasteful and propose a method to exploit this sparsity.\n\n**Core Idea**: Instead of feeding full tokenized contexts to the decoder, REFRAG replaces these with **precomputed, compressed chunk embeddings** derived from a lightweight encoder (e.g., RoBERTa). A selective RL-based policy determines which chunks need full token expansion and which can remain compressed. This greatly reduces the decoder input size and hence latency, especially TTFT.\n\n**Architecture and Implementation**:\n\n*   **Components**:\n    \n    *   **Decoder**: A standard decoder-only model (e.g., LLaMA-2).\n    *   **Encoder**: Lightweight encoder (e.g., RoBERTa-Base or -Large) to compute chunk embeddings.\n    *   **Chunking**: The context (retrieved passages) is divided into L\\=skL\\=skL = \\\\frac{s}{k} chunks of size kkk tokens. Each chunk is encoded into a vector representation via the encoder.\n    *   **Projection Layer**: Aligns encoder outputs to the decoder’s token embedding dimension.\n*   **Input Pipeline**:\n    \n    *   Given a prompt x\\=\\[x1,x2,...,xq\\]x\\=\\[x1,x2,...,xq\\]x = \\[x\\_1, x\\_2, ..., x\\_q\\] and a context \\[xq+1,...,xT\\]\\[xq+1,...,xT\\]\\[x\\_{q+1}, ..., x\\_T\\]:\n        \n        *   The context is chunked into Ci\\=\\[xq+k∗i,...,xq+k∗i+k−1\\]Ci\\=\\[xq+k∗i,...,xq+k∗i+k−1\\]C\\_i = \\[x\\_{q+k\\*i}, ..., x\\_{q+k\\*i+k-1}\\].\n        *   The encoder produces a chunk embedding ci\\=Menc(Ci)ci\\=Menc(Ci)c\\_i = M\\_{enc}(C\\_i).\n        *   This is projected: eci\\=ϕ(ci)eci\\=ϕ(ci)e\\_{c\\_i} = \\\\phi(c\\_i).\n        *   The decoder then operates on \\[e1,...,eq,ec1,...,ecL\\]\\[e1,...,eq,ec1,...,ecL\\]\\[e\\_1, ..., e\\_q, e\\_{c\\_1}, ..., e\\_{c\\_L}\\].\n*   **Selective Compression**:\n    \n    *   A lightweight RL policy (trained using next-paragraph prediction perplexity as a reward signal) decides which chunks should be expanded into full tokens versus retained as embeddings.\n    *   This enables flexible “compress-anywhere” capabilities without sacrificing autoregressiveness.\n*   **Training**:\n    \n    1.  **Reconstruction Task**: Initially freezes the decoder and trains the encoder and projection layer to reconstruct original tokens from embeddings.\n    2.  **Continual Pre-Training (CPT)**: Uses next-paragraph prediction, allowing the decoder to learn from the encoder’s chunk representations.\n    3.  **Curriculum Learning**: Gradually increases chunk complexity during training.\n    4.  **Instruction-Tuning**: Adapts the model to specific downstream applications (RAG, multi-turn conversation, summarization).\n*   **Loss Function**: Cross-entropy on next-token prediction during both reconstruction and CPT stages; policy gradients (e.g., PPO) for RL-based selective compression.\n    \n*   **Datasets**:\n    \n    *   Pretraining: 20B tokens from SlimPajama’s Book and ArXiv subsets.\n    *   Evaluation: PG19, ProofPile, SlimPajama holdouts.\n    *   Fine-tuning: RAG benchmarks including MS MARCO, MMLU, BoolQ, CommonsenseQA, and others.\n*   **Benchmarking**:\n    \n    *   Compared against CEPE, REPLUG, and LLaMA-2-7B (with or without full context).\n    *   Compression rates: k\\=8,16,32k\\=8,16,32k = 8, 16, 32.\n    *   Context lengths evaluated: 4096, 8192, 16384.\n*   **Performance**:\n    \n    *   TTFT improved by **30.85×** over LLaMA and **3.75×** over CEPE at k\\=32k\\=32k=32.\n    *   Maintains or improves log-perplexity relative to CEPE across datasets.\n    *   Enables **16× longer context** with equal or better accuracy.\n*   **Generalization**:\n    \n    *   Effective in RAG, multi-turn conversations, and long document summarization.\n    *   REFRAG16 with RL-based chunk selection often outperforms REFRAG8 trained with full compression, despite being trained at a higher compression rate.\n*   **Model Scalability**:\n    \n    *   Tested with LLaMA-2-7B/13B and LLaMA-3 variants.\n        \n    *   Larger decoders improve performance more than larger encoders, with limited benefit observed from encoder scaling beyond RoBERTa-Base.\n        \n\n**Components**:\n\n*   **Decoder**: A standard decoder-only model (e.g., LLaMA-2).\n*   **Encoder**: Lightweight encoder (e.g., RoBERTa-Base or -Large) to compute chunk embeddings.\n*   **Chunking**: The context (retrieved passages) is divided into L\\=skL\\=skL = \\\\frac{s}{k} chunks of size kkk tokens. Each chunk is encoded into a vector representation via the encoder.\n*   **Projection Layer**: Aligns encoder outputs to the decoder’s token embedding dimension.\n\n**Input Pipeline**:\n\n*   Given a prompt x\\=\\[x1,x2,...,xq\\]x\\=\\[x1,x2,...,xq\\]x = \\[x\\_1, x\\_2, ..., x\\_q\\] and a context \\[xq+1,...,xT\\]\\[xq+1,...,xT\\]\\[x\\_{q+1}, ..., x\\_T\\]:\n    \n    *   The context is chunked into Ci\\=\\[xq+k∗i,...,xq+k∗i+k−1\\]Ci\\=\\[xq+k∗i,...,xq+k∗i+k−1\\]C\\_i = \\[x\\_{q+k\\*i}, ..., x\\_{q+k\\*i+k-1}\\].\n    *   The encoder produces a chunk embedding ci\\=Menc(Ci)ci\\=Menc(Ci)c\\_i = M\\_{enc}(C\\_i).\n    *   This is projected: eci\\=ϕ(ci)eci\\=ϕ(ci)e\\_{c\\_i} = \\\\phi(c\\_i).\n    *   The decoder then operates on \\[e1,...,eq,ec1,...,ecL\\]\\[e1,...,eq,ec1,...,ecL\\]\\[e\\_1, ..., e\\_q, e\\_{c\\_1}, ..., e\\_{c\\_L}\\].\n\nGiven a prompt x\\=\\[x1,x2,...,xq\\]x\\=\\[x1,x2,...,xq\\]x = \\[x\\_1, x\\_2, ..., x\\_q\\] and a context \\[xq+1,...,xT\\]\\[xq+1,...,xT\\]\\[x\\_{q+1}, ..., x\\_T\\]:\n\n*   The context is chunked into Ci\\=\\[xq+k∗i,...,xq+k∗i+k−1\\]Ci\\=\\[xq+k∗i,...,xq+k∗i+k−1\\]C\\_i = \\[x\\_{q+k\\*i}, ..., x\\_{q+k\\*i+k-1}\\].\n*   The encoder produces a chunk embedding ci\\=Menc(Ci)ci\\=Menc(Ci)c\\_i = M\\_{enc}(C\\_i).\n*   This is projected: eci\\=ϕ(ci)eci\\=ϕ(ci)e\\_{c\\_i} = \\\\phi(c\\_i).\n*   The decoder then operates on \\[e1,...,eq,ec1,...,ecL\\]\\[e1,...,eq,ec1,...,ecL\\]\\[e\\_1, ..., e\\_q, e\\_{c\\_1}, ..., e\\_{c\\_L}\\].\n\n**Selective Compression**:\n\n*   A lightweight RL policy (trained using next-paragraph prediction perplexity as a reward signal) decides which chunks should be expanded into full tokens versus retained as embeddings.\n*   This enables flexible “compress-anywhere” capabilities without sacrificing autoregressiveness.\n\n**Training**:\n\n1.  **Reconstruction Task**: Initially freezes the decoder and trains the encoder and projection layer to reconstruct original tokens from embeddings.\n2.  **Continual Pre-Training (CPT)**: Uses next-paragraph prediction, allowing the decoder to learn from the encoder’s chunk representations.\n3.  **Curriculum Learning**: Gradually increases chunk complexity during training.\n4.  **Instruction-Tuning**: Adapts the model to specific downstream applications (RAG, multi-turn conversation, summarization).\n\n**Loss Function**: Cross-entropy on next-token prediction during both reconstruction and CPT stages; policy gradients (e.g., PPO) for RL-based selective compression.\n\n**Datasets**:\n\n*   Pretraining: 20B tokens from SlimPajama’s Book and ArXiv subsets.\n*   Evaluation: PG19, ProofPile, SlimPajama holdouts.\n*   Fine-tuning: RAG benchmarks including MS MARCO, MMLU, BoolQ, CommonsenseQA, and others.\n\n**Benchmarking**:\n\n*   Compared against CEPE, REPLUG, and LLaMA-2-7B (with or without full context).\n*   Compression rates: k\\=8,16,32k\\=8,16,32k = 8, 16, 32.\n*   Context lengths evaluated: 4096, 8192, 16384.\n\n**Performance**:\n\n*   TTFT improved by **30.85×** over LLaMA and **3.75×** over CEPE at k\\=32k\\=32k=32.\n*   Maintains or improves log-perplexity relative to CEPE across datasets.\n*   Enables **16× longer context** with equal or better accuracy.\n\n**Generalization**:\n\n*   Effective in RAG, multi-turn conversations, and long document summarization.\n*   REFRAG16 with RL-based chunk selection often outperforms REFRAG8 trained with full compression, despite being trained at a higher compression rate.\n\n**Model Scalability**:\n\n*   Tested with LLaMA-2-7B/13B and LLaMA-3 variants.\n    \n*   Larger decoders improve performance more than larger encoders, with limited benefit observed from encoder scaling beyond RoBERTa-Base.\n    \n\nTested with LLaMA-2-7B/13B and LLaMA-3 variants.\n\nLarger decoders improve performance more than larger encoders, with limited benefit observed from encoder scaling beyond RoBERTa-Base.\n\nThe following figure from the paper shows the main design of REFRAG. The input context is chunked and processed by the light-weight encoder to produce chunk embeddings, which are precomputable for efficient reuse. A light-weight RL policy decide few chunks to expand. These chunk embeddings along with the token embeddings of the question input are fed to the decoder.\n\n![](../../../images/papers/REFRAG.jpg)\n\n*   **Comparison to CEPE**:\n    \n    *   CEPE reduces KV memory but sacrifices causal structure, making it incompatible with multi-turn tasks.\n    *   REFRAG preserves autoregressive decoding and supports chunk compression at arbitrary positions, enabling broader use cases.\n*   [Code](https://github.com/facebookresearch/refrag)\n    \n\n**Comparison to CEPE**:\n\n*   CEPE reduces KV memory but sacrifices causal structure, making it incompatible with multi-turn tasks.\n*   REFRAG preserves autoregressive decoding and supports chunk compression at arbitrary positions, enabling broader use cases.\n\n[Code](https://github.com/facebookresearch/refrag)",
    "order": 55,
    "orderInChapter": 22,
    "difficulty": 5,
    "estimatedMinutes": 10,
    "tags": [
      "nlpllms",
      "attention",
      "embedding",
      "bert",
      "llm",
      "loss function",
      "fine-tuning"
    ],
    "metadata": {
      "hasCode": false,
      "hasMath": true,
      "hasImages": true,
      "wordCount": 1835,
      "contentLength": 169632
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#refrag:-rethinking-rag-based-decoding",
    "scrapedAt": "2025-12-28T11:54:28.280Z"
  },
  {
    "id": "ai-RAG-fact-fetch-and-reason-a-unified-evaluation-of-retr-56",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "Selected Papers",
    "title": "Fact, Fetch, and Reason: a Unified Evaluation of Retrieval-Augmented Generation",
    "subtitle": "Selected Papers",
    "contentHtml": "<ul>\n  <li>\n    <p>This paper by Krishna et al. from Harvard, Google DeepMind, and Meta introduces <strong>FRAMES</strong> (Factuality, Retrieval, And reasoning MEasurement Set), a comprehensive benchmark designed to evaluate Retrieval-Augmented Generation (RAG) systems in a unified manner across factual accuracy, retrieval capability, and reasoning proficiency.</p>\n  </li>\n  <li>\n    <p>While prior benchmarks have assessed these components in isolation, FRAMES uniquely integrates them into a single dataset with 824 human-annotated multi-hop questions derived from Wikipedia, each requiring reasoning over multiple documents and types of inference like numerical or temporal reasoning. The authors aim to reflect real-world RAG use cases more accurately and expose current limitations in state-of-the-art LLMs when used in complex question answering tasks.</p>\n  </li>\n  <li>\n    <p><strong>Dataset Composition and Design</strong>:</p>\n\n    <ul>\n      <li>\n        <p><strong>Input</strong>: Multi-hop, factoid-style questions requiring synthesis of 2–15 Wikipedia articles. All questions are standalone and context-independent, avoiding binary answers and minimizing ambiguity.</p>\n      </li>\n      <li>\n        <p><strong>Reasoning Types</strong>: Each question is tagged with one or more of five reasoning categories: Numerical Reasoning, Tabular Reasoning, Multiple Constraints, Temporal Reasoning, and Post-Processing.</p>\n      </li>\n      <li>\n        <p><strong>Annotation Method</strong>: Initial synthetic question generation via LLMs was tested but discarded due to high hallucination rates; final dataset was constructed by expert human annotators using prompts that enforce multi-hop reasoning across multiple sources.</p>\n      </li>\n      <li>\n        <p><strong>Quality Control</strong>:</p>\n\n        <ul>\n          <li>Re-annotation for correctness and Wikipedia-grounded answers.</li>\n          <li>Contextual disambiguation to handle temporally sensitive queries.</li>\n          <li>Exclusion of questions with low output entropy or excessive ambiguity.</li>\n          <li>Oracle context provision for upper-bound evaluation.</li>\n        </ul>\n      </li>\n      <li>\n        <p><strong>Comparison</strong>: The dataset covers reasoning and retrieval scenarios not comprehensively addressed by other datasets such as TruthfulQA, HotpotQA, and NaturalQuestions, as shown in Table 1 of the paper.</p>\n      </li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Evaluation Framework and Implementation</strong>:</p>\n\n    <ul>\n      <li>\n        <p><strong>Single-Step Baselines</strong>:</p>\n\n        <ul>\n          <li>\n            <p><strong>Naive Prompt</strong>: Direct question to LLM without retrieval.</p>\n          </li>\n          <li>\n            <p><strong>BM25-Retrieved Prompt</strong>: Adds top-k BM25-scored Wikipedia documents to context.</p>\n          </li>\n          <li>\n            <p><strong>Oracle Prompt</strong>: Adds ground-truth human-labeled Wikipedia articles.</p>\n          </li>\n          <li>\n            <p><strong>LLMs Tested</strong>: Gemini-Pro-1.5, Gemini-Flash-1.5, Gemma2-27B, LLaMA3.2-3B, Qwen2.5-3B.</p>\n          </li>\n          <li>\n            <p><strong>Evaluation</strong>: Conducted via LLM-based auto-rater aligned with human evaluations (accuracy 0.96, Cohen’s Kappa 0.889).</p>\n          </li>\n          <li>\n            <p><strong>Findings</strong>:</p>\n\n            <ul>\n              <li>Accuracy without retrieval: 0.408.</li>\n              <li>With 2-doc BM25 retrieval: 0.452; with 4-doc: 0.474.</li>\n              <li>Oracle performance: 0.729.</li>\n              <li>Major failure modes: Numerical, Tabular, Post-Processing reasoning.</li>\n            </ul>\n          </li>\n        </ul>\n      </li>\n      <li>\n        <p><strong>Multi-Step Pipeline (Algorithm 1)</strong>:</p>\n\n        <ul>\n          <li>\n            <p><strong>Input</strong>: Question and instruction to generate <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-202-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1931\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1932\"><span class=\"mi\" id=\"MathJax-Span-1933\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-202\">k</script> search queries iteratively over <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-203-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>n</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1934\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1935\"><span class=\"mi\" id=\"MathJax-Span-1936\" style=\"font-family: STIXGeneral-Italic;\">n</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>n</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-203\">n</script> steps, retrieving <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-204-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>n</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>docs</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1937\" style=\"width: 2.294em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.878em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.565em, 1001.88em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1938\"><span class=\"msubsup\" id=\"MathJax-Span-1939\"><span style=\"display: inline-block; position: relative; width: 1.878em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1940\" style=\"font-family: STIXGeneral-Italic;\">n</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1941\"><span class=\"mrow\" id=\"MathJax-Span-1942\"><span class=\"mtext\" id=\"MathJax-Span-1943\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">docs</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.816em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>n</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>docs</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-204\">n_{\\text{docs}}</script> Wikipedia articles per query via BM25.</p>\n          </li>\n          <li>\n            <p><strong>Process</strong>:</p>\n\n            <ul>\n              <li>\n                <p>For each of <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-205-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>n</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1944\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1945\"><span class=\"mi\" id=\"MathJax-Span-1946\" style=\"font-family: STIXGeneral-Italic;\">n</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>n</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-205\">n</script> iterations:</p>\n\n                <ul>\n                  <li>Generate <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-206-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1947\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1948\"><span class=\"mi\" id=\"MathJax-Span-1949\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-206\">k</script> search queries.</li>\n                  <li>Retrieve <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-207-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>n</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>docs</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1950\" style=\"width: 2.294em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.878em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.565em, 1001.88em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1951\"><span class=\"msubsup\" id=\"MathJax-Span-1952\"><span style=\"display: inline-block; position: relative; width: 1.878em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1953\" style=\"font-family: STIXGeneral-Italic;\">n</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1954\"><span class=\"mrow\" id=\"MathJax-Span-1955\"><span class=\"mtext\" id=\"MathJax-Span-1956\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">docs</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.816em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>n</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>docs</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-207\">n_{\\text{docs}}</script> articles for each query.</li>\n                  <li>Add only new documents to context.</li>\n                </ul>\n              </li>\n              <li>\n                <p>Final inference is based on the cumulative retrieved context.</p>\n              </li>\n            </ul>\n          </li>\n          <li>\n            <p><strong>Vanilla vs. Search Planning</strong>:</p>\n\n            <ul>\n              <li>Vanilla: No instruction for query diversity or planfulness.</li>\n              <li>Search Planning: Adds examples and constraints (e.g., no repeated queries, chain-of-thought guidance).</li>\n            </ul>\n          </li>\n          <li>\n            <p><strong>Best Configuration</strong>: <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-208-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi><mo>=</mo><mn>5</mn><mo>,</mo><mi>n</mi><mo>=</mo><mn>5</mn><mo>,</mo><msub><mi>n</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>docs</mtext></mrow></msub><mo>=</mo><mn>10</mn></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1957\" style=\"width: 11.253em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 9.378em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1009.38em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1958\"><span class=\"mi\" id=\"MathJax-Span-1959\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1960\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-1961\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">5</span><span class=\"mo\" id=\"MathJax-Span-1962\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mi\" id=\"MathJax-Span-1963\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.211em;\">n</span><span class=\"mo\" id=\"MathJax-Span-1964\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-1965\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">5</span><span class=\"mo\" id=\"MathJax-Span-1966\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-1967\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 1.878em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1968\" style=\"font-family: STIXGeneral-Italic;\">n</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1969\"><span class=\"mrow\" id=\"MathJax-Span-1970\"><span class=\"mtext\" id=\"MathJax-Span-1971\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">docs</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1972\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-1973\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">10</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi><mo>=</mo><mn>5</mn><mo>,</mo><mi>n</mi><mo>=</mo><mn>5</mn><mo>,</mo><msub><mi>n</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>docs</mtext></mrow></msub><mo>=</mo><mn>10</mn></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-208\">k=5, n=5, n_{\\text{docs}}=10</script> achieved 0.66 accuracy — approaching the Oracle upper bound.</p>\n          </li>\n          <li>\n            <p><strong>Insights</strong>:</p>\n\n            <ul>\n              <li>Vanilla multi-step retrieval modestly improves performance (~0.45 to ~0.52).</li>\n              <li>With search planning, performance increases substantially to 0.66.</li>\n              <li>Multi-step setup is computationally expensive (6 serial LLM calls per question).</li>\n              <li>Numerical and post-processing reasoning remain weak spots, even with oracle contexts.</li>\n            </ul>\n          </li>\n        </ul>\n      </li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Core Contributions</strong>:</p>\n\n    <ul>\n      <li>Introduces <strong>FRAMES</strong>, the first unified benchmark assessing factuality, retrieval, and reasoning in a single end-to-end setup.</li>\n      <li>Shows that current LLMs—even with access to relevant knowledge—struggle significantly with complex reasoning tasks.</li>\n      <li>Proposes a reproducible multi-step retrieval framework with interpretable improvements using BM25 and planning-enhanced querying.</li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Future Directions</strong>:</p>\n\n    <ul>\n      <li>Improved retrieval via dense retrievers (e.g., ColBERT, SimCSE).</li>\n      <li>Enhanced reasoning through supervision methods (e.g., Toolformer, PRM-800K, DSPy).</li>\n      <li>Exploration of domain diversity and real-time retrieval extensions.</li>\n      <li>Mitigation of training data contamination due to overlap with Wikipedia.</li>\n    </ul>\n  </li>\n  <li>\n    <p>The following figure from the paper shows an example from the FRAMES dataset, highlighting the core capabilities needed by a system (Factuality, Retrieval, Reasoning) to answer the question.</p>\n  </li>\n</ul>\n<p>This paper by Krishna et al. from Harvard, Google DeepMind, and Meta introduces <strong>FRAMES</strong> (Factuality, Retrieval, And reasoning MEasurement Set), a comprehensive benchmark designed to evaluate Retrieval-Augmented Generation (RAG) systems in a unified manner across factual accuracy, retrieval capability, and reasoning proficiency.</p>\n<p>While prior benchmarks have assessed these components in isolation, FRAMES uniquely integrates them into a single dataset with 824 human-annotated multi-hop questions derived from Wikipedia, each requiring reasoning over multiple documents and types of inference like numerical or temporal reasoning. The authors aim to reflect real-world RAG use cases more accurately and expose current limitations in state-of-the-art LLMs when used in complex question answering tasks.</p>\n<p><strong>Dataset Composition and Design</strong>:</p>\n<ul>\n      <li>\n        <p><strong>Input</strong>: Multi-hop, factoid-style questions requiring synthesis of 2–15 Wikipedia articles. All questions are standalone and context-independent, avoiding binary answers and minimizing ambiguity.</p>\n      </li>\n      <li>\n        <p><strong>Reasoning Types</strong>: Each question is tagged with one or more of five reasoning categories: Numerical Reasoning, Tabular Reasoning, Multiple Constraints, Temporal Reasoning, and Post-Processing.</p>\n      </li>\n      <li>\n        <p><strong>Annotation Method</strong>: Initial synthetic question generation via LLMs was tested but discarded due to high hallucination rates; final dataset was constructed by expert human annotators using prompts that enforce multi-hop reasoning across multiple sources.</p>\n      </li>\n      <li>\n        <p><strong>Quality Control</strong>:</p>\n\n        <ul>\n          <li>Re-annotation for correctness and Wikipedia-grounded answers.</li>\n          <li>Contextual disambiguation to handle temporally sensitive queries.</li>\n          <li>Exclusion of questions with low output entropy or excessive ambiguity.</li>\n          <li>Oracle context provision for upper-bound evaluation.</li>\n        </ul>\n      </li>\n      <li>\n        <p><strong>Comparison</strong>: The dataset covers reasoning and retrieval scenarios not comprehensively addressed by other datasets such as TruthfulQA, HotpotQA, and NaturalQuestions, as shown in Table 1 of the paper.</p>\n      </li>\n    </ul>\n<p><strong>Input</strong>: Multi-hop, factoid-style questions requiring synthesis of 2–15 Wikipedia articles. All questions are standalone and context-independent, avoiding binary answers and minimizing ambiguity.</p>\n<p><strong>Reasoning Types</strong>: Each question is tagged with one or more of five reasoning categories: Numerical Reasoning, Tabular Reasoning, Multiple Constraints, Temporal Reasoning, and Post-Processing.</p>\n<p><strong>Annotation Method</strong>: Initial synthetic question generation via LLMs was tested but discarded due to high hallucination rates; final dataset was constructed by expert human annotators using prompts that enforce multi-hop reasoning across multiple sources.</p>\n<p><strong>Quality Control</strong>:</p>\n<ul>\n          <li>Re-annotation for correctness and Wikipedia-grounded answers.</li>\n          <li>Contextual disambiguation to handle temporally sensitive queries.</li>\n          <li>Exclusion of questions with low output entropy or excessive ambiguity.</li>\n          <li>Oracle context provision for upper-bound evaluation.</li>\n        </ul>\n<p><strong>Comparison</strong>: The dataset covers reasoning and retrieval scenarios not comprehensively addressed by other datasets such as TruthfulQA, HotpotQA, and NaturalQuestions, as shown in Table 1 of the paper.</p>\n<p><strong>Evaluation Framework and Implementation</strong>:</p>\n<ul>\n      <li>\n        <p><strong>Single-Step Baselines</strong>:</p>\n\n        <ul>\n          <li>\n            <p><strong>Naive Prompt</strong>: Direct question to LLM without retrieval.</p>\n          </li>\n          <li>\n            <p><strong>BM25-Retrieved Prompt</strong>: Adds top-k BM25-scored Wikipedia documents to context.</p>\n          </li>\n          <li>\n            <p><strong>Oracle Prompt</strong>: Adds ground-truth human-labeled Wikipedia articles.</p>\n          </li>\n          <li>\n            <p><strong>LLMs Tested</strong>: Gemini-Pro-1.5, Gemini-Flash-1.5, Gemma2-27B, LLaMA3.2-3B, Qwen2.5-3B.</p>\n          </li>\n          <li>\n            <p><strong>Evaluation</strong>: Conducted via LLM-based auto-rater aligned with human evaluations (accuracy 0.96, Cohen’s Kappa 0.889).</p>\n          </li>\n          <li>\n            <p><strong>Findings</strong>:</p>\n\n            <ul>\n              <li>Accuracy without retrieval: 0.408.</li>\n              <li>With 2-doc BM25 retrieval: 0.452; with 4-doc: 0.474.</li>\n              <li>Oracle performance: 0.729.</li>\n              <li>Major failure modes: Numerical, Tabular, Post-Processing reasoning.</li>\n            </ul>\n          </li>\n        </ul>\n      </li>\n      <li>\n        <p><strong>Multi-Step Pipeline (Algorithm 1)</strong>:</p>\n\n        <ul>\n          <li>\n            <p><strong>Input</strong>: Question and instruction to generate <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-202-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1931\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1932\"><span class=\"mi\" id=\"MathJax-Span-1933\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-202\">k</script> search queries iteratively over <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-203-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>n</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1934\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1935\"><span class=\"mi\" id=\"MathJax-Span-1936\" style=\"font-family: STIXGeneral-Italic;\">n</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>n</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-203\">n</script> steps, retrieving <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-204-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>n</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>docs</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1937\" style=\"width: 2.294em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.878em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.565em, 1001.88em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1938\"><span class=\"msubsup\" id=\"MathJax-Span-1939\"><span style=\"display: inline-block; position: relative; width: 1.878em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1940\" style=\"font-family: STIXGeneral-Italic;\">n</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1941\"><span class=\"mrow\" id=\"MathJax-Span-1942\"><span class=\"mtext\" id=\"MathJax-Span-1943\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">docs</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.816em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>n</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>docs</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-204\">n_{\\text{docs}}</script> Wikipedia articles per query via BM25.</p>\n          </li>\n          <li>\n            <p><strong>Process</strong>:</p>\n\n            <ul>\n              <li>\n                <p>For each of <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-205-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>n</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1944\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1945\"><span class=\"mi\" id=\"MathJax-Span-1946\" style=\"font-family: STIXGeneral-Italic;\">n</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>n</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-205\">n</script> iterations:</p>\n\n                <ul>\n                  <li>Generate <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-206-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1947\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1948\"><span class=\"mi\" id=\"MathJax-Span-1949\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-206\">k</script> search queries.</li>\n                  <li>Retrieve <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-207-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>n</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>docs</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1950\" style=\"width: 2.294em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.878em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.565em, 1001.88em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1951\"><span class=\"msubsup\" id=\"MathJax-Span-1952\"><span style=\"display: inline-block; position: relative; width: 1.878em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1953\" style=\"font-family: STIXGeneral-Italic;\">n</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1954\"><span class=\"mrow\" id=\"MathJax-Span-1955\"><span class=\"mtext\" id=\"MathJax-Span-1956\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">docs</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.816em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>n</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>docs</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-207\">n_{\\text{docs}}</script> articles for each query.</li>\n                  <li>Add only new documents to context.</li>\n                </ul>\n              </li>\n              <li>\n                <p>Final inference is based on the cumulative retrieved context.</p>\n              </li>\n            </ul>\n          </li>\n          <li>\n            <p><strong>Vanilla vs. Search Planning</strong>:</p>\n\n            <ul>\n              <li>Vanilla: No instruction for query diversity or planfulness.</li>\n              <li>Search Planning: Adds examples and constraints (e.g., no repeated queries, chain-of-thought guidance).</li>\n            </ul>\n          </li>\n          <li>\n            <p><strong>Best Configuration</strong>: <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-208-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi><mo>=</mo><mn>5</mn><mo>,</mo><mi>n</mi><mo>=</mo><mn>5</mn><mo>,</mo><msub><mi>n</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>docs</mtext></mrow></msub><mo>=</mo><mn>10</mn></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1957\" style=\"width: 11.253em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 9.378em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1009.38em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1958\"><span class=\"mi\" id=\"MathJax-Span-1959\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1960\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-1961\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">5</span><span class=\"mo\" id=\"MathJax-Span-1962\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mi\" id=\"MathJax-Span-1963\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.211em;\">n</span><span class=\"mo\" id=\"MathJax-Span-1964\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-1965\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">5</span><span class=\"mo\" id=\"MathJax-Span-1966\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-1967\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 1.878em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1968\" style=\"font-family: STIXGeneral-Italic;\">n</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1969\"><span class=\"mrow\" id=\"MathJax-Span-1970\"><span class=\"mtext\" id=\"MathJax-Span-1971\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">docs</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1972\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-1973\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">10</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi><mo>=</mo><mn>5</mn><mo>,</mo><mi>n</mi><mo>=</mo><mn>5</mn><mo>,</mo><msub><mi>n</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>docs</mtext></mrow></msub><mo>=</mo><mn>10</mn></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-208\">k=5, n=5, n_{\\text{docs}}=10</script> achieved 0.66 accuracy — approaching the Oracle upper bound.</p>\n          </li>\n          <li>\n            <p><strong>Insights</strong>:</p>\n\n            <ul>\n              <li>Vanilla multi-step retrieval modestly improves performance (~0.45 to ~0.52).</li>\n              <li>With search planning, performance increases substantially to 0.66.</li>\n              <li>Multi-step setup is computationally expensive (6 serial LLM calls per question).</li>\n              <li>Numerical and post-processing reasoning remain weak spots, even with oracle contexts.</li>\n            </ul>\n          </li>\n        </ul>\n      </li>\n    </ul>\n<p><strong>Single-Step Baselines</strong>:</p>\n<ul>\n          <li>\n            <p><strong>Naive Prompt</strong>: Direct question to LLM without retrieval.</p>\n          </li>\n          <li>\n            <p><strong>BM25-Retrieved Prompt</strong>: Adds top-k BM25-scored Wikipedia documents to context.</p>\n          </li>\n          <li>\n            <p><strong>Oracle Prompt</strong>: Adds ground-truth human-labeled Wikipedia articles.</p>\n          </li>\n          <li>\n            <p><strong>LLMs Tested</strong>: Gemini-Pro-1.5, Gemini-Flash-1.5, Gemma2-27B, LLaMA3.2-3B, Qwen2.5-3B.</p>\n          </li>\n          <li>\n            <p><strong>Evaluation</strong>: Conducted via LLM-based auto-rater aligned with human evaluations (accuracy 0.96, Cohen’s Kappa 0.889).</p>\n          </li>\n          <li>\n            <p><strong>Findings</strong>:</p>\n\n            <ul>\n              <li>Accuracy without retrieval: 0.408.</li>\n              <li>With 2-doc BM25 retrieval: 0.452; with 4-doc: 0.474.</li>\n              <li>Oracle performance: 0.729.</li>\n              <li>Major failure modes: Numerical, Tabular, Post-Processing reasoning.</li>\n            </ul>\n          </li>\n        </ul>\n<p><strong>Naive Prompt</strong>: Direct question to LLM without retrieval.</p>\n<p><strong>BM25-Retrieved Prompt</strong>: Adds top-k BM25-scored Wikipedia documents to context.</p>\n<p><strong>Oracle Prompt</strong>: Adds ground-truth human-labeled Wikipedia articles.</p>\n<p><strong>LLMs Tested</strong>: Gemini-Pro-1.5, Gemini-Flash-1.5, Gemma2-27B, LLaMA3.2-3B, Qwen2.5-3B.</p>\n<p><strong>Evaluation</strong>: Conducted via LLM-based auto-rater aligned with human evaluations (accuracy 0.96, Cohen’s Kappa 0.889).</p>\n<p><strong>Findings</strong>:</p>\n<ul>\n              <li>Accuracy without retrieval: 0.408.</li>\n              <li>With 2-doc BM25 retrieval: 0.452; with 4-doc: 0.474.</li>\n              <li>Oracle performance: 0.729.</li>\n              <li>Major failure modes: Numerical, Tabular, Post-Processing reasoning.</li>\n            </ul>\n<p><strong>Multi-Step Pipeline (Algorithm 1)</strong>:</p>\n<ul>\n          <li>\n            <p><strong>Input</strong>: Question and instruction to generate <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-202-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1931\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1932\"><span class=\"mi\" id=\"MathJax-Span-1933\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-202\">k</script> search queries iteratively over <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-203-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>n</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1934\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1935\"><span class=\"mi\" id=\"MathJax-Span-1936\" style=\"font-family: STIXGeneral-Italic;\">n</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>n</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-203\">n</script> steps, retrieving <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-204-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>n</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>docs</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1937\" style=\"width: 2.294em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.878em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.565em, 1001.88em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1938\"><span class=\"msubsup\" id=\"MathJax-Span-1939\"><span style=\"display: inline-block; position: relative; width: 1.878em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1940\" style=\"font-family: STIXGeneral-Italic;\">n</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1941\"><span class=\"mrow\" id=\"MathJax-Span-1942\"><span class=\"mtext\" id=\"MathJax-Span-1943\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">docs</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.816em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>n</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>docs</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-204\">n_{\\text{docs}}</script> Wikipedia articles per query via BM25.</p>\n          </li>\n          <li>\n            <p><strong>Process</strong>:</p>\n\n            <ul>\n              <li>\n                <p>For each of <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-205-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>n</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1944\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1945\"><span class=\"mi\" id=\"MathJax-Span-1946\" style=\"font-family: STIXGeneral-Italic;\">n</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>n</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-205\">n</script> iterations:</p>\n\n                <ul>\n                  <li>Generate <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-206-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1947\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1948\"><span class=\"mi\" id=\"MathJax-Span-1949\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-206\">k</script> search queries.</li>\n                  <li>Retrieve <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-207-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>n</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>docs</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1950\" style=\"width: 2.294em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.878em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.565em, 1001.88em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1951\"><span class=\"msubsup\" id=\"MathJax-Span-1952\"><span style=\"display: inline-block; position: relative; width: 1.878em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1953\" style=\"font-family: STIXGeneral-Italic;\">n</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1954\"><span class=\"mrow\" id=\"MathJax-Span-1955\"><span class=\"mtext\" id=\"MathJax-Span-1956\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">docs</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.816em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>n</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>docs</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-207\">n_{\\text{docs}}</script> articles for each query.</li>\n                  <li>Add only new documents to context.</li>\n                </ul>\n              </li>\n              <li>\n                <p>Final inference is based on the cumulative retrieved context.</p>\n              </li>\n            </ul>\n          </li>\n          <li>\n            <p><strong>Vanilla vs. Search Planning</strong>:</p>\n\n            <ul>\n              <li>Vanilla: No instruction for query diversity or planfulness.</li>\n              <li>Search Planning: Adds examples and constraints (e.g., no repeated queries, chain-of-thought guidance).</li>\n            </ul>\n          </li>\n          <li>\n            <p><strong>Best Configuration</strong>: <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-208-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi><mo>=</mo><mn>5</mn><mo>,</mo><mi>n</mi><mo>=</mo><mn>5</mn><mo>,</mo><msub><mi>n</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>docs</mtext></mrow></msub><mo>=</mo><mn>10</mn></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1957\" style=\"width: 11.253em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 9.378em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1009.38em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1958\"><span class=\"mi\" id=\"MathJax-Span-1959\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1960\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-1961\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">5</span><span class=\"mo\" id=\"MathJax-Span-1962\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mi\" id=\"MathJax-Span-1963\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.211em;\">n</span><span class=\"mo\" id=\"MathJax-Span-1964\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-1965\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">5</span><span class=\"mo\" id=\"MathJax-Span-1966\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-1967\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 1.878em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1968\" style=\"font-family: STIXGeneral-Italic;\">n</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1969\"><span class=\"mrow\" id=\"MathJax-Span-1970\"><span class=\"mtext\" id=\"MathJax-Span-1971\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">docs</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1972\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-1973\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">10</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi><mo>=</mo><mn>5</mn><mo>,</mo><mi>n</mi><mo>=</mo><mn>5</mn><mo>,</mo><msub><mi>n</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>docs</mtext></mrow></msub><mo>=</mo><mn>10</mn></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-208\">k=5, n=5, n_{\\text{docs}}=10</script> achieved 0.66 accuracy — approaching the Oracle upper bound.</p>\n          </li>\n          <li>\n            <p><strong>Insights</strong>:</p>\n\n            <ul>\n              <li>Vanilla multi-step retrieval modestly improves performance (~0.45 to ~0.52).</li>\n              <li>With search planning, performance increases substantially to 0.66.</li>\n              <li>Multi-step setup is computationally expensive (6 serial LLM calls per question).</li>\n              <li>Numerical and post-processing reasoning remain weak spots, even with oracle contexts.</li>\n            </ul>\n          </li>\n        </ul>\n<p><strong>Input</strong>: Question and instruction to generate <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-202-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1931\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1932\"><span class=\"mi\" id=\"MathJax-Span-1933\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-202\">k</script> search queries iteratively over <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-203-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>n</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1934\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1935\"><span class=\"mi\" id=\"MathJax-Span-1936\" style=\"font-family: STIXGeneral-Italic;\">n</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>n</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-203\">n</script> steps, retrieving <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-204-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>n</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>docs</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1937\" style=\"width: 2.294em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.878em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.565em, 1001.88em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1938\"><span class=\"msubsup\" id=\"MathJax-Span-1939\"><span style=\"display: inline-block; position: relative; width: 1.878em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1940\" style=\"font-family: STIXGeneral-Italic;\">n</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1941\"><span class=\"mrow\" id=\"MathJax-Span-1942\"><span class=\"mtext\" id=\"MathJax-Span-1943\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">docs</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.816em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>n</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>docs</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-204\">n_{\\text{docs}}</script> Wikipedia articles per query via BM25.</p>\n<p><strong>Process</strong>:</p>\n<ul>\n              <li>\n                <p>For each of <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-205-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>n</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1944\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1945\"><span class=\"mi\" id=\"MathJax-Span-1946\" style=\"font-family: STIXGeneral-Italic;\">n</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>n</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-205\">n</script> iterations:</p>\n\n                <ul>\n                  <li>Generate <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-206-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1947\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1948\"><span class=\"mi\" id=\"MathJax-Span-1949\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-206\">k</script> search queries.</li>\n                  <li>Retrieve <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-207-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>n</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>docs</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1950\" style=\"width: 2.294em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.878em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.565em, 1001.88em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1951\"><span class=\"msubsup\" id=\"MathJax-Span-1952\"><span style=\"display: inline-block; position: relative; width: 1.878em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1953\" style=\"font-family: STIXGeneral-Italic;\">n</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1954\"><span class=\"mrow\" id=\"MathJax-Span-1955\"><span class=\"mtext\" id=\"MathJax-Span-1956\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">docs</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.816em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>n</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>docs</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-207\">n_{\\text{docs}}</script> articles for each query.</li>\n                  <li>Add only new documents to context.</li>\n                </ul>\n              </li>\n              <li>\n                <p>Final inference is based on the cumulative retrieved context.</p>\n              </li>\n            </ul>\n<p>For each of <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-205-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>n</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1944\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1945\"><span class=\"mi\" id=\"MathJax-Span-1946\" style=\"font-family: STIXGeneral-Italic;\">n</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>n</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-205\">n</script> iterations:</p>\n<ul>\n                  <li>Generate <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-206-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1947\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1948\"><span class=\"mi\" id=\"MathJax-Span-1949\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-206\">k</script> search queries.</li>\n                  <li>Retrieve <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-207-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>n</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>docs</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1950\" style=\"width: 2.294em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.878em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.565em, 1001.88em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1951\"><span class=\"msubsup\" id=\"MathJax-Span-1952\"><span style=\"display: inline-block; position: relative; width: 1.878em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1953\" style=\"font-family: STIXGeneral-Italic;\">n</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1954\"><span class=\"mrow\" id=\"MathJax-Span-1955\"><span class=\"mtext\" id=\"MathJax-Span-1956\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">docs</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.816em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>n</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>docs</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-207\">n_{\\text{docs}}</script> articles for each query.</li>\n                  <li>Add only new documents to context.</li>\n                </ul>\n<p>Final inference is based on the cumulative retrieved context.</p>\n<p><strong>Vanilla vs. Search Planning</strong>:</p>\n<ul>\n              <li>Vanilla: No instruction for query diversity or planfulness.</li>\n              <li>Search Planning: Adds examples and constraints (e.g., no repeated queries, chain-of-thought guidance).</li>\n            </ul>\n<p><strong>Best Configuration</strong>: <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-208-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi><mo>=</mo><mn>5</mn><mo>,</mo><mi>n</mi><mo>=</mo><mn>5</mn><mo>,</mo><msub><mi>n</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>docs</mtext></mrow></msub><mo>=</mo><mn>10</mn></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1957\" style=\"width: 11.253em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 9.378em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1009.38em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1958\"><span class=\"mi\" id=\"MathJax-Span-1959\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1960\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-1961\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">5</span><span class=\"mo\" id=\"MathJax-Span-1962\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mi\" id=\"MathJax-Span-1963\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.211em;\">n</span><span class=\"mo\" id=\"MathJax-Span-1964\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-1965\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">5</span><span class=\"mo\" id=\"MathJax-Span-1966\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-1967\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 1.878em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1968\" style=\"font-family: STIXGeneral-Italic;\">n</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1969\"><span class=\"mrow\" id=\"MathJax-Span-1970\"><span class=\"mtext\" id=\"MathJax-Span-1971\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">docs</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1972\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-1973\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">10</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi><mo>=</mo><mn>5</mn><mo>,</mo><mi>n</mi><mo>=</mo><mn>5</mn><mo>,</mo><msub><mi>n</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>docs</mtext></mrow></msub><mo>=</mo><mn>10</mn></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-208\">k=5, n=5, n_{\\text{docs}}=10</script> achieved 0.66 accuracy — approaching the Oracle upper bound.</p>\n<p><strong>Insights</strong>:</p>\n<ul>\n              <li>Vanilla multi-step retrieval modestly improves performance (~0.45 to ~0.52).</li>\n              <li>With search planning, performance increases substantially to 0.66.</li>\n              <li>Multi-step setup is computationally expensive (6 serial LLM calls per question).</li>\n              <li>Numerical and post-processing reasoning remain weak spots, even with oracle contexts.</li>\n            </ul>\n<p><strong>Core Contributions</strong>:</p>\n<ul>\n      <li>Introduces <strong>FRAMES</strong>, the first unified benchmark assessing factuality, retrieval, and reasoning in a single end-to-end setup.</li>\n      <li>Shows that current LLMs—even with access to relevant knowledge—struggle significantly with complex reasoning tasks.</li>\n      <li>Proposes a reproducible multi-step retrieval framework with interpretable improvements using BM25 and planning-enhanced querying.</li>\n    </ul>\n<p><strong>Future Directions</strong>:</p>\n<ul>\n      <li>Improved retrieval via dense retrievers (e.g., ColBERT, SimCSE).</li>\n      <li>Enhanced reasoning through supervision methods (e.g., Toolformer, PRM-800K, DSPy).</li>\n      <li>Exploration of domain diversity and real-time retrieval extensions.</li>\n      <li>Mitigation of training data contamination due to overlap with Wikipedia.</li>\n    </ul>\n<p>The following figure from the paper shows an example from the FRAMES dataset, highlighting the core capabilities needed by a system (Factuality, Retrieval, Reasoning) to answer the question.</p>\n<p><img src=\"../../../images/papers/FRAMES.jpg\" alt=\"\"></p>\n<ul>\n  <li><a href=\"https://huggingface.co/datasets/google/frames-benchmark\">Dataset</a></li>\n</ul>",
    "contentMarkdown": "*   This paper by Krishna et al. from Harvard, Google DeepMind, and Meta introduces **FRAMES** (Factuality, Retrieval, And reasoning MEasurement Set), a comprehensive benchmark designed to evaluate Retrieval-Augmented Generation (RAG) systems in a unified manner across factual accuracy, retrieval capability, and reasoning proficiency.\n    \n*   While prior benchmarks have assessed these components in isolation, FRAMES uniquely integrates them into a single dataset with 824 human-annotated multi-hop questions derived from Wikipedia, each requiring reasoning over multiple documents and types of inference like numerical or temporal reasoning. The authors aim to reflect real-world RAG use cases more accurately and expose current limitations in state-of-the-art LLMs when used in complex question answering tasks.\n    \n*   **Dataset Composition and Design**:\n    \n    *   **Input**: Multi-hop, factoid-style questions requiring synthesis of 2–15 Wikipedia articles. All questions are standalone and context-independent, avoiding binary answers and minimizing ambiguity.\n        \n    *   **Reasoning Types**: Each question is tagged with one or more of five reasoning categories: Numerical Reasoning, Tabular Reasoning, Multiple Constraints, Temporal Reasoning, and Post-Processing.\n        \n    *   **Annotation Method**: Initial synthetic question generation via LLMs was tested but discarded due to high hallucination rates; final dataset was constructed by expert human annotators using prompts that enforce multi-hop reasoning across multiple sources.\n        \n    *   **Quality Control**:\n        \n        *   Re-annotation for correctness and Wikipedia-grounded answers.\n        *   Contextual disambiguation to handle temporally sensitive queries.\n        *   Exclusion of questions with low output entropy or excessive ambiguity.\n        *   Oracle context provision for upper-bound evaluation.\n    *   **Comparison**: The dataset covers reasoning and retrieval scenarios not comprehensively addressed by other datasets such as TruthfulQA, HotpotQA, and NaturalQuestions, as shown in Table 1 of the paper.\n        \n*   **Evaluation Framework and Implementation**:\n    \n    *   **Single-Step Baselines**:\n        \n        *   **Naive Prompt**: Direct question to LLM without retrieval.\n            \n        *   **BM25-Retrieved Prompt**: Adds top-k BM25-scored Wikipedia documents to context.\n            \n        *   **Oracle Prompt**: Adds ground-truth human-labeled Wikipedia articles.\n            \n        *   **LLMs Tested**: Gemini-Pro-1.5, Gemini-Flash-1.5, Gemma2-27B, LLaMA3.2-3B, Qwen2.5-3B.\n            \n        *   **Evaluation**: Conducted via LLM-based auto-rater aligned with human evaluations (accuracy 0.96, Cohen’s Kappa 0.889).\n            \n        *   **Findings**:\n            \n            *   Accuracy without retrieval: 0.408.\n            *   With 2-doc BM25 retrieval: 0.452; with 4-doc: 0.474.\n            *   Oracle performance: 0.729.\n            *   Major failure modes: Numerical, Tabular, Post-Processing reasoning.\n    *   **Multi-Step Pipeline (Algorithm 1)**:\n        \n        *   **Input**: Question and instruction to generate kkk search queries iteratively over nnn steps, retrieving ndocsndocsn\\_{\\\\text{docs}} Wikipedia articles per query via BM25.\n            \n        *   **Process**:\n            \n            *   For each of nnn iterations:\n                \n                *   Generate kkk search queries.\n                *   Retrieve ndocsndocsn\\_{\\\\text{docs}} articles for each query.\n                *   Add only new documents to context.\n            *   Final inference is based on the cumulative retrieved context.\n                \n        *   **Vanilla vs. Search Planning**:\n            \n            *   Vanilla: No instruction for query diversity or planfulness.\n            *   Search Planning: Adds examples and constraints (e.g., no repeated queries, chain-of-thought guidance).\n        *   **Best Configuration**: k\\=5,n\\=5,ndocs\\=10k\\=5,n\\=5,ndocs\\=10k=5, n=5, n\\_{\\\\text{docs}}=10 achieved 0.66 accuracy — approaching the Oracle upper bound.\n            \n        *   **Insights**:\n            \n            *   Vanilla multi-step retrieval modestly improves performance (~0.45 to ~0.52).\n            *   With search planning, performance increases substantially to 0.66.\n            *   Multi-step setup is computationally expensive (6 serial LLM calls per question).\n            *   Numerical and post-processing reasoning remain weak spots, even with oracle contexts.\n*   **Core Contributions**:\n    \n    *   Introduces **FRAMES**, the first unified benchmark assessing factuality, retrieval, and reasoning in a single end-to-end setup.\n    *   Shows that current LLMs—even with access to relevant knowledge—struggle significantly with complex reasoning tasks.\n    *   Proposes a reproducible multi-step retrieval framework with interpretable improvements using BM25 and planning-enhanced querying.\n*   **Future Directions**:\n    \n    *   Improved retrieval via dense retrievers (e.g., ColBERT, SimCSE).\n    *   Enhanced reasoning through supervision methods (e.g., Toolformer, PRM-800K, DSPy).\n    *   Exploration of domain diversity and real-time retrieval extensions.\n    *   Mitigation of training data contamination due to overlap with Wikipedia.\n*   The following figure from the paper shows an example from the FRAMES dataset, highlighting the core capabilities needed by a system (Factuality, Retrieval, Reasoning) to answer the question.\n    \n\nThis paper by Krishna et al. from Harvard, Google DeepMind, and Meta introduces **FRAMES** (Factuality, Retrieval, And reasoning MEasurement Set), a comprehensive benchmark designed to evaluate Retrieval-Augmented Generation (RAG) systems in a unified manner across factual accuracy, retrieval capability, and reasoning proficiency.\n\nWhile prior benchmarks have assessed these components in isolation, FRAMES uniquely integrates them into a single dataset with 824 human-annotated multi-hop questions derived from Wikipedia, each requiring reasoning over multiple documents and types of inference like numerical or temporal reasoning. The authors aim to reflect real-world RAG use cases more accurately and expose current limitations in state-of-the-art LLMs when used in complex question answering tasks.\n\n**Dataset Composition and Design**:\n\n*   **Input**: Multi-hop, factoid-style questions requiring synthesis of 2–15 Wikipedia articles. All questions are standalone and context-independent, avoiding binary answers and minimizing ambiguity.\n    \n*   **Reasoning Types**: Each question is tagged with one or more of five reasoning categories: Numerical Reasoning, Tabular Reasoning, Multiple Constraints, Temporal Reasoning, and Post-Processing.\n    \n*   **Annotation Method**: Initial synthetic question generation via LLMs was tested but discarded due to high hallucination rates; final dataset was constructed by expert human annotators using prompts that enforce multi-hop reasoning across multiple sources.\n    \n*   **Quality Control**:\n    \n    *   Re-annotation for correctness and Wikipedia-grounded answers.\n    *   Contextual disambiguation to handle temporally sensitive queries.\n    *   Exclusion of questions with low output entropy or excessive ambiguity.\n    *   Oracle context provision for upper-bound evaluation.\n*   **Comparison**: The dataset covers reasoning and retrieval scenarios not comprehensively addressed by other datasets such as TruthfulQA, HotpotQA, and NaturalQuestions, as shown in Table 1 of the paper.\n    \n\n**Input**: Multi-hop, factoid-style questions requiring synthesis of 2–15 Wikipedia articles. All questions are standalone and context-independent, avoiding binary answers and minimizing ambiguity.\n\n**Reasoning Types**: Each question is tagged with one or more of five reasoning categories: Numerical Reasoning, Tabular Reasoning, Multiple Constraints, Temporal Reasoning, and Post-Processing.\n\n**Annotation Method**: Initial synthetic question generation via LLMs was tested but discarded due to high hallucination rates; final dataset was constructed by expert human annotators using prompts that enforce multi-hop reasoning across multiple sources.\n\n**Quality Control**:\n\n*   Re-annotation for correctness and Wikipedia-grounded answers.\n*   Contextual disambiguation to handle temporally sensitive queries.\n*   Exclusion of questions with low output entropy or excessive ambiguity.\n*   Oracle context provision for upper-bound evaluation.\n\n**Comparison**: The dataset covers reasoning and retrieval scenarios not comprehensively addressed by other datasets such as TruthfulQA, HotpotQA, and NaturalQuestions, as shown in Table 1 of the paper.\n\n**Evaluation Framework and Implementation**:\n\n*   **Single-Step Baselines**:\n    \n    *   **Naive Prompt**: Direct question to LLM without retrieval.\n        \n    *   **BM25-Retrieved Prompt**: Adds top-k BM25-scored Wikipedia documents to context.\n        \n    *   **Oracle Prompt**: Adds ground-truth human-labeled Wikipedia articles.\n        \n    *   **LLMs Tested**: Gemini-Pro-1.5, Gemini-Flash-1.5, Gemma2-27B, LLaMA3.2-3B, Qwen2.5-3B.\n        \n    *   **Evaluation**: Conducted via LLM-based auto-rater aligned with human evaluations (accuracy 0.96, Cohen’s Kappa 0.889).\n        \n    *   **Findings**:\n        \n        *   Accuracy without retrieval: 0.408.\n        *   With 2-doc BM25 retrieval: 0.452; with 4-doc: 0.474.\n        *   Oracle performance: 0.729.\n        *   Major failure modes: Numerical, Tabular, Post-Processing reasoning.\n*   **Multi-Step Pipeline (Algorithm 1)**:\n    \n    *   **Input**: Question and instruction to generate kkk search queries iteratively over nnn steps, retrieving ndocsndocsn\\_{\\\\text{docs}} Wikipedia articles per query via BM25.\n        \n    *   **Process**:\n        \n        *   For each of nnn iterations:\n            \n            *   Generate kkk search queries.\n            *   Retrieve ndocsndocsn\\_{\\\\text{docs}} articles for each query.\n            *   Add only new documents to context.\n        *   Final inference is based on the cumulative retrieved context.\n            \n    *   **Vanilla vs. Search Planning**:\n        \n        *   Vanilla: No instruction for query diversity or planfulness.\n        *   Search Planning: Adds examples and constraints (e.g., no repeated queries, chain-of-thought guidance).\n    *   **Best Configuration**: k\\=5,n\\=5,ndocs\\=10k\\=5,n\\=5,ndocs\\=10k=5, n=5, n\\_{\\\\text{docs}}=10 achieved 0.66 accuracy — approaching the Oracle upper bound.\n        \n    *   **Insights**:\n        \n        *   Vanilla multi-step retrieval modestly improves performance (~0.45 to ~0.52).\n        *   With search planning, performance increases substantially to 0.66.\n        *   Multi-step setup is computationally expensive (6 serial LLM calls per question).\n        *   Numerical and post-processing reasoning remain weak spots, even with oracle contexts.\n\n**Single-Step Baselines**:\n\n*   **Naive Prompt**: Direct question to LLM without retrieval.\n    \n*   **BM25-Retrieved Prompt**: Adds top-k BM25-scored Wikipedia documents to context.\n    \n*   **Oracle Prompt**: Adds ground-truth human-labeled Wikipedia articles.\n    \n*   **LLMs Tested**: Gemini-Pro-1.5, Gemini-Flash-1.5, Gemma2-27B, LLaMA3.2-3B, Qwen2.5-3B.\n    \n*   **Evaluation**: Conducted via LLM-based auto-rater aligned with human evaluations (accuracy 0.96, Cohen’s Kappa 0.889).\n    \n*   **Findings**:\n    \n    *   Accuracy without retrieval: 0.408.\n    *   With 2-doc BM25 retrieval: 0.452; with 4-doc: 0.474.\n    *   Oracle performance: 0.729.\n    *   Major failure modes: Numerical, Tabular, Post-Processing reasoning.\n\n**Naive Prompt**: Direct question to LLM without retrieval.\n\n**BM25-Retrieved Prompt**: Adds top-k BM25-scored Wikipedia documents to context.\n\n**Oracle Prompt**: Adds ground-truth human-labeled Wikipedia articles.\n\n**LLMs Tested**: Gemini-Pro-1.5, Gemini-Flash-1.5, Gemma2-27B, LLaMA3.2-3B, Qwen2.5-3B.\n\n**Evaluation**: Conducted via LLM-based auto-rater aligned with human evaluations (accuracy 0.96, Cohen’s Kappa 0.889).\n\n**Findings**:\n\n*   Accuracy without retrieval: 0.408.\n*   With 2-doc BM25 retrieval: 0.452; with 4-doc: 0.474.\n*   Oracle performance: 0.729.\n*   Major failure modes: Numerical, Tabular, Post-Processing reasoning.\n\n**Multi-Step Pipeline (Algorithm 1)**:\n\n*   **Input**: Question and instruction to generate kkk search queries iteratively over nnn steps, retrieving ndocsndocsn\\_{\\\\text{docs}} Wikipedia articles per query via BM25.\n    \n*   **Process**:\n    \n    *   For each of nnn iterations:\n        \n        *   Generate kkk search queries.\n        *   Retrieve ndocsndocsn\\_{\\\\text{docs}} articles for each query.\n        *   Add only new documents to context.\n    *   Final inference is based on the cumulative retrieved context.\n        \n*   **Vanilla vs. Search Planning**:\n    \n    *   Vanilla: No instruction for query diversity or planfulness.\n    *   Search Planning: Adds examples and constraints (e.g., no repeated queries, chain-of-thought guidance).\n*   **Best Configuration**: k\\=5,n\\=5,ndocs\\=10k\\=5,n\\=5,ndocs\\=10k=5, n=5, n\\_{\\\\text{docs}}=10 achieved 0.66 accuracy — approaching the Oracle upper bound.\n    \n*   **Insights**:\n    \n    *   Vanilla multi-step retrieval modestly improves performance (~0.45 to ~0.52).\n    *   With search planning, performance increases substantially to 0.66.\n    *   Multi-step setup is computationally expensive (6 serial LLM calls per question).\n    *   Numerical and post-processing reasoning remain weak spots, even with oracle contexts.\n\n**Input**: Question and instruction to generate kkk search queries iteratively over nnn steps, retrieving ndocsndocsn\\_{\\\\text{docs}} Wikipedia articles per query via BM25.\n\n**Process**:\n\n*   For each of nnn iterations:\n    \n    *   Generate kkk search queries.\n    *   Retrieve ndocsndocsn\\_{\\\\text{docs}} articles for each query.\n    *   Add only new documents to context.\n*   Final inference is based on the cumulative retrieved context.\n    \n\nFor each of nnn iterations:\n\n*   Generate kkk search queries.\n*   Retrieve ndocsndocsn\\_{\\\\text{docs}} articles for each query.\n*   Add only new documents to context.\n\nFinal inference is based on the cumulative retrieved context.\n\n**Vanilla vs. Search Planning**:\n\n*   Vanilla: No instruction for query diversity or planfulness.\n*   Search Planning: Adds examples and constraints (e.g., no repeated queries, chain-of-thought guidance).\n\n**Best Configuration**: k\\=5,n\\=5,ndocs\\=10k\\=5,n\\=5,ndocs\\=10k=5, n=5, n\\_{\\\\text{docs}}=10 achieved 0.66 accuracy — approaching the Oracle upper bound.\n\n**Insights**:\n\n*   Vanilla multi-step retrieval modestly improves performance (~0.45 to ~0.52).\n*   With search planning, performance increases substantially to 0.66.\n*   Multi-step setup is computationally expensive (6 serial LLM calls per question).\n*   Numerical and post-processing reasoning remain weak spots, even with oracle contexts.\n\n**Core Contributions**:\n\n*   Introduces **FRAMES**, the first unified benchmark assessing factuality, retrieval, and reasoning in a single end-to-end setup.\n*   Shows that current LLMs—even with access to relevant knowledge—struggle significantly with complex reasoning tasks.\n*   Proposes a reproducible multi-step retrieval framework with interpretable improvements using BM25 and planning-enhanced querying.\n\n**Future Directions**:\n\n*   Improved retrieval via dense retrievers (e.g., ColBERT, SimCSE).\n*   Enhanced reasoning through supervision methods (e.g., Toolformer, PRM-800K, DSPy).\n*   Exploration of domain diversity and real-time retrieval extensions.\n*   Mitigation of training data contamination due to overlap with Wikipedia.\n\nThe following figure from the paper shows an example from the FRAMES dataset, highlighting the core capabilities needed by a system (Factuality, Retrieval, Reasoning) to answer the question.\n\n![](../../../images/papers/FRAMES.jpg)\n\n*   [Dataset](https://huggingface.co/datasets/google/frames-benchmark)",
    "order": 56,
    "orderInChapter": 23,
    "difficulty": 5,
    "estimatedMinutes": 10,
    "tags": [
      "nlpllms",
      "bert",
      "llm"
    ],
    "metadata": {
      "hasCode": false,
      "hasMath": true,
      "hasImages": true,
      "wordCount": 1855,
      "contentLength": 74930
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#fact,-fetch,-and-reason:-a-unified-evaluation-of-retrieval-augmented-generation",
    "scrapedAt": "2025-12-28T11:54:28.280Z"
  },
  {
    "id": "ai-RAG-long-form-factuality-in-large-language-models-57",
    "domain": "ai_primers",
    "category": "NLP/LLMs",
    "article": "Retrieval Augmented Generation (RAG)",
    "articleSlug": "RAG",
    "chapter": "Selected Papers",
    "title": "Long-form Factuality in Large Language Models",
    "subtitle": "Selected Papers",
    "contentHtml": "<ul>\n  <li>\n    <p>This paper by Jerry Wei et al. from Google DeepMind introduces <strong>LongFact</strong>, a new benchmark designed to evaluate the <strong>long-form factuality</strong> of large language models (LLMs), and proposes a novel automatic evaluation framework called <strong>Search-Augmented Factuality Evaluator (SAFE)</strong>. The paper also introduces a new factuality metric called <strong>F1@<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-209-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1974\" style=\"width: 0.622em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.519em; height: 0px; font-size: 121%;\"><span style=\"position: absolute; clip: rect(1.346em, 1000.52em, 2.327em, -999.997em); top: -2.167em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1975\"><span class=\"mi\" id=\"MathJax-Span-1976\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.172em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-209\">k</script></strong> that combines factual precision and recall based on an ideal number of facts expected by a user.</p>\n  </li>\n  <li>\n    <p><strong>Motivation</strong>: Existing factuality benchmarks primarily assess short-form responses or focus narrowly on specific domains. Evaluating long-form, open-ended responses is challenging due to the wide variability of facts, lack of reference answers, and the difficulty of fine-grained annotation.</p>\n  </li>\n  <li>\n    <p><strong>LongFact Benchmark</strong>:</p>\n\n    <ul>\n      <li>Generated using GPT-4, LongFact consists of 2,280 prompts across 38 topics, divided into two tasks: <strong>LongFact-Objects</strong> and <strong>LongFact-Concepts</strong>.</li>\n      <li>Prompts are designed to elicit multi-paragraph responses rich in factual content.</li>\n      <li>Covers a broad spectrum including STEM, social sciences, humanities, and general knowledge, offering extensive domain coverage for factuality evaluation.</li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>SAFE: Search-Augmented Factuality Evaluator</strong>:</p>\n\n    <ul>\n      <li>SAFE uses an LLM (GPT-3.5-Turbo) as an agent to perform a multi-step factuality evaluation.</li>\n      <li>\n        <p><strong>Pipeline</strong>:</p>\n\n        <ol>\n          <li><strong>Decomposition</strong>: Break down model responses into individual atomic facts.</li>\n          <li><strong>Self-Containment</strong>: Replace vague pronouns or references with explicit entities.</li>\n          <li><strong>Relevance Check</strong>: Determine whether each fact is relevant to the original prompt.</li>\n          <li><strong>Search and Verification</strong>: Use the Serper.dev API to send search queries to Google, retrieve top results, and iteratively reason whether each fact is supported or not.</li>\n        </ol>\n      </li>\n      <li>Facts are labeled as “supported,” “not supported,” or “irrelevant.” Only supported and not supported facts are used in final scoring.</li>\n    </ul>\n  </li>\n  <li>\n    <p>The following figure from the paper shows how SAFE splits a response into atomic facts, revises them, evaluates relevance, and checks factual support using Google Search.</p>\n  </li>\n</ul>\n<p>This paper by Jerry Wei et al. from Google DeepMind introduces <strong>LongFact</strong>, a new benchmark designed to evaluate the <strong>long-form factuality</strong> of large language models (LLMs), and proposes a novel automatic evaluation framework called <strong>Search-Augmented Factuality Evaluator (SAFE)</strong>. The paper also introduces a new factuality metric called <strong>F1@<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-209-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1974\" style=\"width: 0.622em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.519em; height: 0px; font-size: 121%;\"><span style=\"position: absolute; clip: rect(1.346em, 1000.52em, 2.327em, -999.997em); top: -2.167em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1975\"><span class=\"mi\" id=\"MathJax-Span-1976\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.172em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-209\">k</script></strong> that combines factual precision and recall based on an ideal number of facts expected by a user.</p>\n<p><strong>Motivation</strong>: Existing factuality benchmarks primarily assess short-form responses or focus narrowly on specific domains. Evaluating long-form, open-ended responses is challenging due to the wide variability of facts, lack of reference answers, and the difficulty of fine-grained annotation.</p>\n<p><strong>LongFact Benchmark</strong>:</p>\n<ul>\n      <li>Generated using GPT-4, LongFact consists of 2,280 prompts across 38 topics, divided into two tasks: <strong>LongFact-Objects</strong> and <strong>LongFact-Concepts</strong>.</li>\n      <li>Prompts are designed to elicit multi-paragraph responses rich in factual content.</li>\n      <li>Covers a broad spectrum including STEM, social sciences, humanities, and general knowledge, offering extensive domain coverage for factuality evaluation.</li>\n    </ul>\n<p><strong>SAFE: Search-Augmented Factuality Evaluator</strong>:</p>\n<ul>\n      <li>SAFE uses an LLM (GPT-3.5-Turbo) as an agent to perform a multi-step factuality evaluation.</li>\n      <li>\n        <p><strong>Pipeline</strong>:</p>\n\n        <ol>\n          <li><strong>Decomposition</strong>: Break down model responses into individual atomic facts.</li>\n          <li><strong>Self-Containment</strong>: Replace vague pronouns or references with explicit entities.</li>\n          <li><strong>Relevance Check</strong>: Determine whether each fact is relevant to the original prompt.</li>\n          <li><strong>Search and Verification</strong>: Use the Serper.dev API to send search queries to Google, retrieve top results, and iteratively reason whether each fact is supported or not.</li>\n        </ol>\n      </li>\n      <li>Facts are labeled as “supported,” “not supported,” or “irrelevant.” Only supported and not supported facts are used in final scoring.</li>\n    </ul>\n<p><strong>Pipeline</strong>:</p>\n<ol>\n          <li><strong>Decomposition</strong>: Break down model responses into individual atomic facts.</li>\n          <li><strong>Self-Containment</strong>: Replace vague pronouns or references with explicit entities.</li>\n          <li><strong>Relevance Check</strong>: Determine whether each fact is relevant to the original prompt.</li>\n          <li><strong>Search and Verification</strong>: Use the Serper.dev API to send search queries to Google, retrieve top results, and iteratively reason whether each fact is supported or not.</li>\n        </ol>\n<p>The following figure from the paper shows how SAFE splits a response into atomic facts, revises them, evaluates relevance, and checks factual support using Google Search.</p>\n<p><img src=\"../../../images/papers/Long-form-factuality-in-LLMs.jpg\" alt=\"\"></p>\n<ul>\n  <li>\n    <p><strong>F1@<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-210-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1977\" style=\"width: 0.622em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.519em; height: 0px; font-size: 121%;\"><span style=\"position: absolute; clip: rect(1.346em, 1000.52em, 2.327em, -999.997em); top: -2.167em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1978\"><span class=\"mi\" id=\"MathJax-Span-1979\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.172em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-210\">k</script> Metric</strong>:</p>\n\n    <ul>\n      <li>Proposes an extension of the standard F1 score to long-form factuality.</li>\n      <li><strong>Precision</strong>: Fraction of supported facts over total rated (supported + not supported).</li>\n      <li><strong>Recall</strong>: Fraction of supported facts up to a user-defined ideal number of facts, <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-211-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1980\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1981\"><span class=\"mi\" id=\"MathJax-Span-1982\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-211\">K</script>.</li>\n      <li>Defined as:\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-212-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><merror><mtext>\\text{F1@\\)k\\(}(y)&amp;#xA0;=&amp;#xA0;\\frac{2&amp;#xA0;\\cdot&amp;#xA0;\\text{Precision}(y)&amp;#xA0;\\cdot&amp;#xA0;\\text{Recall}_K(y)}{\\text{Precision}(y)&amp;#xA0;+&amp;#xA0;\\text{Recall}_K(y)}</mtext></merror></math>\" role=\"presentation\" style=\"position: relative;\"><span class=\"math\" id=\"MathJax-Span-1983\" aria-hidden=\"true\" style=\"\"><span class=\"noError\" id=\"MathJax-Span-1984\" style=\"display: inline-block;\">\\text{F1@\\)k\\(}(y)&nbsp;=&nbsp;\\frac{2&nbsp;\\cdot&nbsp;\\text{Precision}(y)&nbsp;\\cdot&nbsp;\\text{Recall}_K(y)}{\\text{Precision}(y)&nbsp;+&nbsp;\\text{Recall}_K(y)}</span></span><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><merror><mtext>\\text{F1@\\)k\\(}(y)&nbsp;=&nbsp;\\frac{2&nbsp;\\cdot&nbsp;\\text{Precision}(y)&nbsp;\\cdot&nbsp;\\text{Recall}_K(y)}{\\text{Precision}(y)&nbsp;+&nbsp;\\text{Recall}_K(y)}</mtext></merror></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-212\">\\text{F1@\\)k\\(}(y) = \\frac{2 \\cdot \\text{Precision}(y) \\cdot \\text{Recall}_K(y)}{\\text{Precision}(y) + \\text{Recall}_K(y)}</script></li>\n      <li>Offers a tradeoff between factual density and desired length of response.</li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Key Results</strong>:</p>\n\n    <ul>\n      <li>SAFE achieves 72% agreement with human annotators (from Min et al., 2023) and outperforms humans in 76% of disagreement cases.</li>\n      <li>It is over <strong>20× cheaper</strong> than human annotation ($0.19 per response vs. $4.00).</li>\n      <li>\n        <p>Benchmarked 13 LLMs (e.g., GPT-4-Turbo, Gemini-Ultra, Claude-3, PaLM-2) using LongFact.</p>\n\n        <ul>\n          <li>Larger models generally perform better on long-form factuality.</li>\n          <li><strong>Top performers</strong> on F1@<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-213-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1985\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1986\"><span class=\"mi\" id=\"MathJax-Span-1987\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-213\">k</script> include GPT-4-Turbo, Gemini-Ultra, and PaLM-2-L-IT-RLHF.</li>\n        </ul>\n      </li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Implementation Details</strong>:</p>\n\n    <ul>\n      <li>SAFE uses GPT-3.5-Turbo for reasoning and Serper API for Google Search.</li>\n      <li>Search steps capped at 5 per fact; top-3 results are retrieved per query.</li>\n      <li>Open-source implementation: <a href=\"https://github.com/google-deepmind/long-form-factuality\">GitHub - long-form-factuality</a></li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Limitations and Future Work</strong>:</p>\n\n    <ul>\n      <li>SAFE depends on the quality of Google Search and the LLM’s reasoning ability.</li>\n      <li>May fail in expert domains (e.g., law, medicine) or when relevant content is hard to find.</li>\n      <li>Future work may improve recall handling, robustness to repetition, and use of domain-specific search sources.</li>\n    </ul>\n  </li>\n</ul>\n<p><strong>F1@<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-210-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1977\" style=\"width: 0.622em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.519em; height: 0px; font-size: 121%;\"><span style=\"position: absolute; clip: rect(1.346em, 1000.52em, 2.327em, -999.997em); top: -2.167em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1978\"><span class=\"mi\" id=\"MathJax-Span-1979\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.172em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-210\">k</script> Metric</strong>:</p>\n<ul>\n      <li>Proposes an extension of the standard F1 score to long-form factuality.</li>\n      <li><strong>Precision</strong>: Fraction of supported facts over total rated (supported + not supported).</li>\n      <li><strong>Recall</strong>: Fraction of supported facts up to a user-defined ideal number of facts, <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-211-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1980\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1981\"><span class=\"mi\" id=\"MathJax-Span-1982\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-211\">K</script>.</li>\n      <li>Defined as:\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-212-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><merror><mtext>\\text{F1@\\)k\\(}(y)&amp;#xA0;=&amp;#xA0;\\frac{2&amp;#xA0;\\cdot&amp;#xA0;\\text{Precision}(y)&amp;#xA0;\\cdot&amp;#xA0;\\text{Recall}_K(y)}{\\text{Precision}(y)&amp;#xA0;+&amp;#xA0;\\text{Recall}_K(y)}</mtext></merror></math>\" role=\"presentation\" style=\"position: relative;\"><span class=\"math\" id=\"MathJax-Span-1983\" aria-hidden=\"true\" style=\"\"><span class=\"noError\" id=\"MathJax-Span-1984\" style=\"display: inline-block;\">\\text{F1@\\)k\\(}(y)&nbsp;=&nbsp;\\frac{2&nbsp;\\cdot&nbsp;\\text{Precision}(y)&nbsp;\\cdot&nbsp;\\text{Recall}_K(y)}{\\text{Precision}(y)&nbsp;+&nbsp;\\text{Recall}_K(y)}</span></span><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><merror><mtext>\\text{F1@\\)k\\(}(y)&nbsp;=&nbsp;\\frac{2&nbsp;\\cdot&nbsp;\\text{Precision}(y)&nbsp;\\cdot&nbsp;\\text{Recall}_K(y)}{\\text{Precision}(y)&nbsp;+&nbsp;\\text{Recall}_K(y)}</mtext></merror></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-212\">\\text{F1@\\)k\\(}(y) = \\frac{2 \\cdot \\text{Precision}(y) \\cdot \\text{Recall}_K(y)}{\\text{Precision}(y) + \\text{Recall}_K(y)}</script></li>\n      <li>Offers a tradeoff between factual density and desired length of response.</li>\n    </ul>\n<p><strong>Key Results</strong>:</p>\n<ul>\n      <li>SAFE achieves 72% agreement with human annotators (from Min et al., 2023) and outperforms humans in 76% of disagreement cases.</li>\n      <li>It is over <strong>20× cheaper</strong> than human annotation ($0.19 per response vs. $4.00).</li>\n      <li>\n        <p>Benchmarked 13 LLMs (e.g., GPT-4-Turbo, Gemini-Ultra, Claude-3, PaLM-2) using LongFact.</p>\n\n        <ul>\n          <li>Larger models generally perform better on long-form factuality.</li>\n          <li><strong>Top performers</strong> on F1@<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-213-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1985\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1986\"><span class=\"mi\" id=\"MathJax-Span-1987\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-213\">k</script> include GPT-4-Turbo, Gemini-Ultra, and PaLM-2-L-IT-RLHF.</li>\n        </ul>\n      </li>\n    </ul>\n<p>Benchmarked 13 LLMs (e.g., GPT-4-Turbo, Gemini-Ultra, Claude-3, PaLM-2) using LongFact.</p>\n<ul>\n          <li>Larger models generally perform better on long-form factuality.</li>\n          <li><strong>Top performers</strong> on F1@<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-213-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1985\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1986\"><span class=\"mi\" id=\"MathJax-Span-1987\" style=\"font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>k</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-213\">k</script> include GPT-4-Turbo, Gemini-Ultra, and PaLM-2-L-IT-RLHF.</li>\n        </ul>\n<p><strong>Implementation Details</strong>:</p>\n<ul>\n      <li>SAFE uses GPT-3.5-Turbo for reasoning and Serper API for Google Search.</li>\n      <li>Search steps capped at 5 per fact; top-3 results are retrieved per query.</li>\n      <li>Open-source implementation: <a href=\"https://github.com/google-deepmind/long-form-factuality\">GitHub - long-form-factuality</a></li>\n    </ul>\n<p><strong>Limitations and Future Work</strong>:</p>\n<ul>\n      <li>SAFE depends on the quality of Google Search and the LLM’s reasoning ability.</li>\n      <li>May fail in expert domains (e.g., law, medicine) or when relevant content is hard to find.</li>\n      <li>Future work may improve recall handling, robustness to repetition, and use of domain-specific search sources.</li>\n    </ul>",
    "contentMarkdown": "*   This paper by Jerry Wei et al. from Google DeepMind introduces **LongFact**, a new benchmark designed to evaluate the **long-form factuality** of large language models (LLMs), and proposes a novel automatic evaluation framework called **Search-Augmented Factuality Evaluator (SAFE)**. The paper also introduces a new factuality metric called **F1@kkk** that combines factual precision and recall based on an ideal number of facts expected by a user.\n    \n*   **Motivation**: Existing factuality benchmarks primarily assess short-form responses or focus narrowly on specific domains. Evaluating long-form, open-ended responses is challenging due to the wide variability of facts, lack of reference answers, and the difficulty of fine-grained annotation.\n    \n*   **LongFact Benchmark**:\n    \n    *   Generated using GPT-4, LongFact consists of 2,280 prompts across 38 topics, divided into two tasks: **LongFact-Objects** and **LongFact-Concepts**.\n    *   Prompts are designed to elicit multi-paragraph responses rich in factual content.\n    *   Covers a broad spectrum including STEM, social sciences, humanities, and general knowledge, offering extensive domain coverage for factuality evaluation.\n*   **SAFE: Search-Augmented Factuality Evaluator**:\n    \n    *   SAFE uses an LLM (GPT-3.5-Turbo) as an agent to perform a multi-step factuality evaluation.\n    *   **Pipeline**:\n        \n        1.  **Decomposition**: Break down model responses into individual atomic facts.\n        2.  **Self-Containment**: Replace vague pronouns or references with explicit entities.\n        3.  **Relevance Check**: Determine whether each fact is relevant to the original prompt.\n        4.  **Search and Verification**: Use the Serper.dev API to send search queries to Google, retrieve top results, and iteratively reason whether each fact is supported or not.\n    *   Facts are labeled as “supported,” “not supported,” or “irrelevant.” Only supported and not supported facts are used in final scoring.\n*   The following figure from the paper shows how SAFE splits a response into atomic facts, revises them, evaluates relevance, and checks factual support using Google Search.\n    \n\nThis paper by Jerry Wei et al. from Google DeepMind introduces **LongFact**, a new benchmark designed to evaluate the **long-form factuality** of large language models (LLMs), and proposes a novel automatic evaluation framework called **Search-Augmented Factuality Evaluator (SAFE)**. The paper also introduces a new factuality metric called **F1@kkk** that combines factual precision and recall based on an ideal number of facts expected by a user.\n\n**Motivation**: Existing factuality benchmarks primarily assess short-form responses or focus narrowly on specific domains. Evaluating long-form, open-ended responses is challenging due to the wide variability of facts, lack of reference answers, and the difficulty of fine-grained annotation.\n\n**LongFact Benchmark**:\n\n*   Generated using GPT-4, LongFact consists of 2,280 prompts across 38 topics, divided into two tasks: **LongFact-Objects** and **LongFact-Concepts**.\n*   Prompts are designed to elicit multi-paragraph responses rich in factual content.\n*   Covers a broad spectrum including STEM, social sciences, humanities, and general knowledge, offering extensive domain coverage for factuality evaluation.\n\n**SAFE: Search-Augmented Factuality Evaluator**:\n\n*   SAFE uses an LLM (GPT-3.5-Turbo) as an agent to perform a multi-step factuality evaluation.\n*   **Pipeline**:\n    \n    1.  **Decomposition**: Break down model responses into individual atomic facts.\n    2.  **Self-Containment**: Replace vague pronouns or references with explicit entities.\n    3.  **Relevance Check**: Determine whether each fact is relevant to the original prompt.\n    4.  **Search and Verification**: Use the Serper.dev API to send search queries to Google, retrieve top results, and iteratively reason whether each fact is supported or not.\n*   Facts are labeled as “supported,” “not supported,” or “irrelevant.” Only supported and not supported facts are used in final scoring.\n\n**Pipeline**:\n\n1.  **Decomposition**: Break down model responses into individual atomic facts.\n2.  **Self-Containment**: Replace vague pronouns or references with explicit entities.\n3.  **Relevance Check**: Determine whether each fact is relevant to the original prompt.\n4.  **Search and Verification**: Use the Serper.dev API to send search queries to Google, retrieve top results, and iteratively reason whether each fact is supported or not.\n\nThe following figure from the paper shows how SAFE splits a response into atomic facts, revises them, evaluates relevance, and checks factual support using Google Search.\n\n![](../../../images/papers/Long-form-factuality-in-LLMs.jpg)\n\n*   **F1@kkk Metric**:\n    \n    *   Proposes an extension of the standard F1 score to long-form factuality.\n    *   **Precision**: Fraction of supported facts over total rated (supported + not supported).\n    *   **Recall**: Fraction of supported facts up to a user-defined ideal number of facts, KKK.\n    *   Defined as: \\\\text{F1@\\\\)k\\\\(}(y) = \\\\frac{2 \\\\cdot \\\\text{Precision}(y) \\\\cdot \\\\text{Recall}\\_K(y)}{\\\\text{Precision}(y) + \\\\text{Recall}\\_K(y)}\\\\text{F1@\\\\)k\\\\(}(y) = \\\\frac{2 \\\\cdot \\\\text{Precision}(y) \\\\cdot \\\\text{Recall}\\_K(y)}{\\\\text{Precision}(y) + \\\\text{Recall}\\_K(y)}\\\\text{F1@\\\\)k\\\\(}(y) = \\\\frac{2 \\\\cdot \\\\text{Precision}(y) \\\\cdot \\\\text{Recall}\\_K(y)}{\\\\text{Precision}(y) + \\\\text{Recall}\\_K(y)}\n    *   Offers a tradeoff between factual density and desired length of response.\n*   **Key Results**:\n    \n    *   SAFE achieves 72% agreement with human annotators (from Min et al., 2023) and outperforms humans in 76% of disagreement cases.\n    *   It is over **20× cheaper** than human annotation ($0.19 per response vs. $4.00).\n    *   Benchmarked 13 LLMs (e.g., GPT-4-Turbo, Gemini-Ultra, Claude-3, PaLM-2) using LongFact.\n        \n        *   Larger models generally perform better on long-form factuality.\n        *   **Top performers** on F1@kkk include GPT-4-Turbo, Gemini-Ultra, and PaLM-2-L-IT-RLHF.\n*   **Implementation Details**:\n    \n    *   SAFE uses GPT-3.5-Turbo for reasoning and Serper API for Google Search.\n    *   Search steps capped at 5 per fact; top-3 results are retrieved per query.\n    *   Open-source implementation: [GitHub - long-form-factuality](https://github.com/google-deepmind/long-form-factuality)\n*   **Limitations and Future Work**:\n    \n    *   SAFE depends on the quality of Google Search and the LLM’s reasoning ability.\n    *   May fail in expert domains (e.g., law, medicine) or when relevant content is hard to find.\n    *   Future work may improve recall handling, robustness to repetition, and use of domain-specific search sources.\n\n**F1@kkk Metric**:\n\n*   Proposes an extension of the standard F1 score to long-form factuality.\n*   **Precision**: Fraction of supported facts over total rated (supported + not supported).\n*   **Recall**: Fraction of supported facts up to a user-defined ideal number of facts, KKK.\n*   Defined as: \\\\text{F1@\\\\)k\\\\(}(y) = \\\\frac{2 \\\\cdot \\\\text{Precision}(y) \\\\cdot \\\\text{Recall}\\_K(y)}{\\\\text{Precision}(y) + \\\\text{Recall}\\_K(y)}\\\\text{F1@\\\\)k\\\\(}(y) = \\\\frac{2 \\\\cdot \\\\text{Precision}(y) \\\\cdot \\\\text{Recall}\\_K(y)}{\\\\text{Precision}(y) + \\\\text{Recall}\\_K(y)}\\\\text{F1@\\\\)k\\\\(}(y) = \\\\frac{2 \\\\cdot \\\\text{Precision}(y) \\\\cdot \\\\text{Recall}\\_K(y)}{\\\\text{Precision}(y) + \\\\text{Recall}\\_K(y)}\n*   Offers a tradeoff between factual density and desired length of response.\n\n**Key Results**:\n\n*   SAFE achieves 72% agreement with human annotators (from Min et al., 2023) and outperforms humans in 76% of disagreement cases.\n*   It is over **20× cheaper** than human annotation ($0.19 per response vs. $4.00).\n*   Benchmarked 13 LLMs (e.g., GPT-4-Turbo, Gemini-Ultra, Claude-3, PaLM-2) using LongFact.\n    \n    *   Larger models generally perform better on long-form factuality.\n    *   **Top performers** on F1@kkk include GPT-4-Turbo, Gemini-Ultra, and PaLM-2-L-IT-RLHF.\n\nBenchmarked 13 LLMs (e.g., GPT-4-Turbo, Gemini-Ultra, Claude-3, PaLM-2) using LongFact.\n\n*   Larger models generally perform better on long-form factuality.\n*   **Top performers** on F1@kkk include GPT-4-Turbo, Gemini-Ultra, and PaLM-2-L-IT-RLHF.\n\n**Implementation Details**:\n\n*   SAFE uses GPT-3.5-Turbo for reasoning and Serper API for Google Search.\n*   Search steps capped at 5 per fact; top-3 results are retrieved per query.\n*   Open-source implementation: [GitHub - long-form-factuality](https://github.com/google-deepmind/long-form-factuality)\n\n**Limitations and Future Work**:\n\n*   SAFE depends on the quality of Google Search and the LLM’s reasoning ability.\n*   May fail in expert domains (e.g., law, medicine) or when relevant content is hard to find.\n*   Future work may improve recall handling, robustness to repetition, and use of domain-specific search sources.",
    "order": 57,
    "orderInChapter": 24,
    "difficulty": 5,
    "estimatedMinutes": 6,
    "tags": [
      "nlpllms",
      "gpt",
      "llm"
    ],
    "metadata": {
      "hasCode": false,
      "hasMath": true,
      "hasImages": true,
      "wordCount": 1134,
      "contentLength": 24128
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/RAG/#long-form-factuality-in-large-language-models",
    "scrapedAt": "2025-12-28T11:54:28.280Z"
  }
]