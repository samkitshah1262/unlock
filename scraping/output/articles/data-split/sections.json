[
  {
    "id": "ai-data-split-ensure-that-traindevtest-belong-to-the-same-distri-1",
    "articleSlug": "data-split",
    "articleTitle": "Splitting Datasets",
    "category": "Data/Training",
    "chapter": "Implementation Details",
    "title": "Ensure That Train/dev/test Belong to the Same Distribution (if Possible)",
    "order": 1,
    "orderInChapter": 1,
    "contentHtml": "<ul>\n  <li>Often we have a big dataset and want to split it into train, dev and test set. In most cases, each split will have the same distribution as the others.</li>\n  <li><strong>What could go wrong?</strong>\n    <ul>\n      <li>Suppose that we’ve divided our dataset into 10 groups. Let’s assume that the first 100 images (<code class=\"language-plaintext highlighter-rouge\">img_000.jpg</code> to <code class=\"language-plaintext highlighter-rouge\">img_099.jpg</code>) have label 0, the next 100 have label 1, … and the last 100 images have label 9.</li>\n      <li>In that case, the above code will make the dev set only have label 8, and the test set only label 9.</li>\n    </ul>\n  </li>\n  <li>\n    <p>We therefore need to ensure that the filenames are correctly shuffled before splitting the data.</p>\n\n    <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code2\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code2\">  <span class=\"n\">filenames</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"s\">'img_000.jpg'</span><span class=\"p\">,</span> <span class=\"s\">'img_001.jpg'</span><span class=\"p\">,</span> <span class=\"p\">...]</span>\n  <span class=\"n\">random</span><span class=\"p\">.</span><span class=\"n\">shuffle</span><span class=\"p\">(</span><span class=\"n\">filenames</span><span class=\"p\">)</span>  <span class=\"c1\"># randomly shuffles the ordering of filenames\n</span>\n  <span class=\"n\">split_1</span> <span class=\"o\">=</span> <span class=\"nb\">int</span><span class=\"p\">(</span><span class=\"mf\">0.8</span> <span class=\"o\">*</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">filenames</span><span class=\"p\">))</span>\n  <span class=\"n\">split_2</span> <span class=\"o\">=</span> <span class=\"nb\">int</span><span class=\"p\">(</span><span class=\"mf\">0.9</span> <span class=\"o\">*</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">filenames</span><span class=\"p\">))</span>\n  <span class=\"n\">train_filenames</span> <span class=\"o\">=</span> <span class=\"n\">filenames</span><span class=\"p\">[:</span><span class=\"n\">split_1</span><span class=\"p\">]</span>\n  <span class=\"n\">dev_filenames</span> <span class=\"o\">=</span> <span class=\"n\">filenames</span><span class=\"p\">[</span><span class=\"n\">split_1</span><span class=\"p\">:</span><span class=\"n\">split_2</span><span class=\"p\">]</span>\n  <span class=\"n\">test_filenames</span> <span class=\"o\">=</span> <span class=\"n\">filenames</span><span class=\"p\">[</span><span class=\"n\">split_2</span><span class=\"p\">:]</span>\n</code></pre></div>    </div>\n  </li>\n  <li>This should give approximately the same distribution for train, dev and test sets. If necessary, it is also possible to split each class into <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-5-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>80</mn><mi mathvariant=&quot;normal&quot;>&amp;#x0025;</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>/</mo></mrow><mn>10</mn><mi mathvariant=&quot;normal&quot;>&amp;#x0025;</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>/</mo></mrow><mn>10</mn><mi mathvariant=&quot;normal&quot;>&amp;#x0025;</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-27\" style=\"width: 7.294em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 6.044em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1005.99em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-28\"><span class=\"mn\" id=\"MathJax-Span-29\" style=\"font-family: STIXGeneral-Regular;\">80</span><span class=\"mi\" id=\"MathJax-Span-30\" style=\"font-family: STIXGeneral-Regular;\">%</span><span class=\"texatom\" id=\"MathJax-Span-31\"><span class=\"mrow\" id=\"MathJax-Span-32\"><span class=\"mo\" id=\"MathJax-Span-33\" style=\"font-family: STIXGeneral-Regular;\">/</span></span></span><span class=\"mn\" id=\"MathJax-Span-34\" style=\"font-family: STIXGeneral-Regular;\">10</span><span class=\"mi\" id=\"MathJax-Span-35\" style=\"font-family: STIXGeneral-Regular;\">%</span><span class=\"texatom\" id=\"MathJax-Span-36\"><span class=\"mrow\" id=\"MathJax-Span-37\"><span class=\"mo\" id=\"MathJax-Span-38\" style=\"font-family: STIXGeneral-Regular;\">/</span></span></span><span class=\"mn\" id=\"MathJax-Span-39\" style=\"font-family: STIXGeneral-Regular;\">10</span><span class=\"mi\" id=\"MathJax-Span-40\" style=\"font-family: STIXGeneral-Regular;\">%</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mn>80</mn><mi mathvariant=\"normal\">%</mi><mrow class=\"MJX-TeXAtom-ORD\"><mo>/</mo></mrow><mn>10</mn><mi mathvariant=\"normal\">%</mi><mrow class=\"MJX-TeXAtom-ORD\"><mo>/</mo></mrow><mn>10</mn><mi mathvariant=\"normal\">%</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-5\">80\\%/10\\%/10\\%</script> so that the distribution is the same in each set.</li>\n</ul>\n<ul>\n      <li>Suppose that we’ve divided our dataset into 10 groups. Let’s assume that the first 100 images (<code class=\"language-plaintext highlighter-rouge\">img_000.jpg</code> to <code class=\"language-plaintext highlighter-rouge\">img_099.jpg</code>) have label 0, the next 100 have label 1, … and the last 100 images have label 9.</li>\n      <li>In that case, the above code will make the dev set only have label 8, and the test set only label 9.</li>\n    </ul>\n<p>We therefore need to ensure that the filenames are correctly shuffled before splitting the data.</p>\n<pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code2\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code2\">  <span class=\"n\">filenames</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"s\">'img_000.jpg'</span><span class=\"p\">,</span> <span class=\"s\">'img_001.jpg'</span><span class=\"p\">,</span> <span class=\"p\">...]</span>\n  <span class=\"n\">random</span><span class=\"p\">.</span><span class=\"n\">shuffle</span><span class=\"p\">(</span><span class=\"n\">filenames</span><span class=\"p\">)</span>  <span class=\"c1\"># randomly shuffles the ordering of filenames\n</span>\n  <span class=\"n\">split_1</span> <span class=\"o\">=</span> <span class=\"nb\">int</span><span class=\"p\">(</span><span class=\"mf\">0.8</span> <span class=\"o\">*</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">filenames</span><span class=\"p\">))</span>\n  <span class=\"n\">split_2</span> <span class=\"o\">=</span> <span class=\"nb\">int</span><span class=\"p\">(</span><span class=\"mf\">0.9</span> <span class=\"o\">*</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">filenames</span><span class=\"p\">))</span>\n  <span class=\"n\">train_filenames</span> <span class=\"o\">=</span> <span class=\"n\">filenames</span><span class=\"p\">[:</span><span class=\"n\">split_1</span><span class=\"p\">]</span>\n  <span class=\"n\">dev_filenames</span> <span class=\"o\">=</span> <span class=\"n\">filenames</span><span class=\"p\">[</span><span class=\"n\">split_1</span><span class=\"p\">:</span><span class=\"n\">split_2</span><span class=\"p\">]</span>\n  <span class=\"n\">test_filenames</span> <span class=\"o\">=</span> <span class=\"n\">filenames</span><span class=\"p\">[</span><span class=\"n\">split_2</span><span class=\"p\">:]</span>\n</code></pre>",
    "contentMarkdown": "*   Often we have a big dataset and want to split it into train, dev and test set. In most cases, each split will have the same distribution as the others.\n*   **What could go wrong?**\n    *   Suppose that we’ve divided our dataset into 10 groups. Let’s assume that the first 100 images (`img_000.jpg` to `img_099.jpg`) have label 0, the next 100 have label 1, … and the last 100 images have label 9.\n    *   In that case, the above code will make the dev set only have label 8, and the test set only label 9.\n*   We therefore need to ensure that the filenames are correctly shuffled before splitting the data.\n    \n    ![](https://aman.ai/images/copy.png)\n    \n      `filenames = ['img_000.jpg', 'img_001.jpg', ...]   random.shuffle(filenames)  # randomly shuffles the ordering of filenames   split_1 = int(0.8 * len(filenames))   split_2 = int(0.9 * len(filenames))   train_filenames = filenames[:split_1]   dev_filenames = filenames[split_1:split_2]   test_filenames = filenames[split_2:]`\n    \n*   This should give approximately the same distribution for train, dev and test sets. If necessary, it is also possible to split each class into 80%/10%/10%80%/10%/10%80\\\\%/10\\\\%/10\\\\% so that the distribution is the same in each set.\n\n*   Suppose that we’ve divided our dataset into 10 groups. Let’s assume that the first 100 images (`img_000.jpg` to `img_099.jpg`) have label 0, the next 100 have label 1, … and the last 100 images have label 9.\n*   In that case, the above code will make the dev set only have label 8, and the test set only label 9.\n\nWe therefore need to ensure that the filenames are correctly shuffled before splitting the data.\n\n![](https://aman.ai/images/copy.png)\n\n  `filenames = ['img_000.jpg', 'img_001.jpg', ...]   random.shuffle(filenames)  # randomly shuffles the ordering of filenames   split_1 = int(0.8 * len(filenames))   split_2 = int(0.9 * len(filenames))   train_filenames = filenames[:split_1]   dev_filenames = filenames[split_1:split_2]   test_filenames = filenames[split_2:]`",
    "contentLength": 7957,
    "wordCount": 291,
    "hasCode": true,
    "hasMath": true,
    "hasImages": true,
    "url": "https://aman.ai/primers/ai/data-split/#ensure-that-train/dev/test-belong-to-the-same-distribution-(if-possible)"
  },
  {
    "id": "ai-data-split-no-randomness-makes-things-reproducible-2",
    "articleSlug": "data-split",
    "articleTitle": "Splitting Datasets",
    "category": "Data/Training",
    "chapter": "Implementation Details",
    "title": "No Randomness Makes Things Reproducible!",
    "order": 2,
    "orderInChapter": 2,
    "contentHtml": "<ul>\n  <li>We talked <a href=\"#reproducibility-is-important\">earlier</a> about making our dataset building script reproducible. Here we need to make sure that the train/dev/test split stays the same across every run of <code class=\"language-plaintext highlighter-rouge\">python build_dataset.py</code>.</li>\n  <li>The code in the <a href=\"#ensure-that-traindevtest-belong-to-the-same-distribution-if-possible\">above</a> section doesn’t ensure reproducibility, since each time you run it you will have a different split.</li>\n  <li>To make sure to have the same split each time this code is run, we need to fix the random seed before shuffling the filenames.</li>\n  <li>\n    <p>Here is a good way to remove any randomness in the process:</p>\n\n    <div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code3\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code3\">  <span class=\"n\">filenames</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"s\">'img_000.jpg'</span><span class=\"p\">,</span> <span class=\"s\">'img_001.jpg'</span><span class=\"p\">,</span> <span class=\"p\">...]</span>\n  <span class=\"n\">filenames</span><span class=\"p\">.</span><span class=\"n\">sort</span><span class=\"p\">()</span>  <span class=\"c1\"># make sure that the filenames have a fixed order before shuffling\n</span>  <span class=\"n\">random</span><span class=\"p\">.</span><span class=\"n\">seed</span><span class=\"p\">(</span><span class=\"mi\">230</span><span class=\"p\">)</span>\n  <span class=\"n\">random</span><span class=\"p\">.</span><span class=\"n\">shuffle</span><span class=\"p\">(</span><span class=\"n\">filenames</span><span class=\"p\">)</span> <span class=\"c1\"># shuffles the ordering of filenames (deterministic given the chosen seed)\n</span>\n  <span class=\"n\">split_1</span> <span class=\"o\">=</span> <span class=\"nb\">int</span><span class=\"p\">(</span><span class=\"mf\">0.8</span> <span class=\"o\">*</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">filenames</span><span class=\"p\">))</span>\n  <span class=\"n\">split_2</span> <span class=\"o\">=</span> <span class=\"nb\">int</span><span class=\"p\">(</span><span class=\"mf\">0.9</span> <span class=\"o\">*</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">filenames</span><span class=\"p\">))</span>\n  <span class=\"n\">train_filenames</span> <span class=\"o\">=</span> <span class=\"n\">filenames</span><span class=\"p\">[:</span><span class=\"n\">split_1</span><span class=\"p\">]</span>\n  <span class=\"n\">dev_filenames</span> <span class=\"o\">=</span> <span class=\"n\">filenames</span><span class=\"p\">[</span><span class=\"n\">split_1</span><span class=\"p\">:</span><span class=\"n\">split_2</span><span class=\"p\">]</span>\n  <span class=\"n\">test_filenames</span> <span class=\"o\">=</span> <span class=\"n\">filenames</span><span class=\"p\">[</span><span class=\"n\">split_2</span><span class=\"p\">:]</span>\n</code></pre></div>    </div>\n  </li>\n  <li>The call to <code class=\"language-plaintext highlighter-rouge\">filenames.sort()</code> makes sure that if you build filenames in a different way, the output is still the same.</li>\n</ul>\n<p>Here is a good way to remove any randomness in the process:</p>\n<pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code3\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code3\">  <span class=\"n\">filenames</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"s\">'img_000.jpg'</span><span class=\"p\">,</span> <span class=\"s\">'img_001.jpg'</span><span class=\"p\">,</span> <span class=\"p\">...]</span>\n  <span class=\"n\">filenames</span><span class=\"p\">.</span><span class=\"n\">sort</span><span class=\"p\">()</span>  <span class=\"c1\"># make sure that the filenames have a fixed order before shuffling\n</span>  <span class=\"n\">random</span><span class=\"p\">.</span><span class=\"n\">seed</span><span class=\"p\">(</span><span class=\"mi\">230</span><span class=\"p\">)</span>\n  <span class=\"n\">random</span><span class=\"p\">.</span><span class=\"n\">shuffle</span><span class=\"p\">(</span><span class=\"n\">filenames</span><span class=\"p\">)</span> <span class=\"c1\"># shuffles the ordering of filenames (deterministic given the chosen seed)\n</span>\n  <span class=\"n\">split_1</span> <span class=\"o\">=</span> <span class=\"nb\">int</span><span class=\"p\">(</span><span class=\"mf\">0.8</span> <span class=\"o\">*</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">filenames</span><span class=\"p\">))</span>\n  <span class=\"n\">split_2</span> <span class=\"o\">=</span> <span class=\"nb\">int</span><span class=\"p\">(</span><span class=\"mf\">0.9</span> <span class=\"o\">*</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">filenames</span><span class=\"p\">))</span>\n  <span class=\"n\">train_filenames</span> <span class=\"o\">=</span> <span class=\"n\">filenames</span><span class=\"p\">[:</span><span class=\"n\">split_1</span><span class=\"p\">]</span>\n  <span class=\"n\">dev_filenames</span> <span class=\"o\">=</span> <span class=\"n\">filenames</span><span class=\"p\">[</span><span class=\"n\">split_1</span><span class=\"p\">:</span><span class=\"n\">split_2</span><span class=\"p\">]</span>\n  <span class=\"n\">test_filenames</span> <span class=\"o\">=</span> <span class=\"n\">filenames</span><span class=\"p\">[</span><span class=\"n\">split_2</span><span class=\"p\">:]</span>\n</code></pre>",
    "contentMarkdown": "*   We talked [earlier](#reproducibility-is-important) about making our dataset building script reproducible. Here we need to make sure that the train/dev/test split stays the same across every run of `python build_dataset.py`.\n*   The code in the [above](#ensure-that-traindevtest-belong-to-the-same-distribution-if-possible) section doesn’t ensure reproducibility, since each time you run it you will have a different split.\n*   To make sure to have the same split each time this code is run, we need to fix the random seed before shuffling the filenames.\n*   Here is a good way to remove any randomness in the process:\n    \n    ![](https://aman.ai/images/copy.png)\n    \n      `filenames = ['img_000.jpg', 'img_001.jpg', ...]   filenames.sort()  # make sure that the filenames have a fixed order before shuffling   random.seed(230)   random.shuffle(filenames) # shuffles the ordering of filenames (deterministic given the chosen seed)   split_1 = int(0.8 * len(filenames))   split_2 = int(0.9 * len(filenames))   train_filenames = filenames[:split_1]   dev_filenames = filenames[split_1:split_2]   test_filenames = filenames[split_2:]`\n    \n*   The call to `filenames.sort()` makes sure that if you build filenames in a different way, the output is still the same.\n\nHere is a good way to remove any randomness in the process:\n\n![](https://aman.ai/images/copy.png)\n\n  `filenames = ['img_000.jpg', 'img_001.jpg', ...]   filenames.sort()  # make sure that the filenames have a fixed order before shuffling   random.seed(230)   random.shuffle(filenames) # shuffles the ordering of filenames (deterministic given the chosen seed)   split_1 = int(0.8 * len(filenames))   split_2 = int(0.9 * len(filenames))   train_filenames = filenames[:split_1]   dev_filenames = filenames[split_1:split_2]   test_filenames = filenames[split_2:]`",
    "contentLength": 5646,
    "wordCount": 227,
    "hasCode": true,
    "hasMath": false,
    "hasImages": true,
    "url": "https://aman.ai/primers/ai/data-split/#no-randomness-makes-things-reproducible!"
  }
]