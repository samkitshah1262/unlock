<!DOCTYPE html><html lang="en"><head><style type="text/css" id="nanobarcss">.nanobar{width:100%;height:4px;z-index:9999;top:0}.bar{width:0;height:100%;transition:height .3s;background:#000}</style><style>#back-to-top{background:#fff;-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;bottom:20px;-webkit-box-shadow:0 2px 5px 0 rgba(0,0,0,.26);-moz-box-shadow:0 2px 5px 0 rgba(0,0,0,.26);box-shadow:0 2px 5px 0 rgba(0,0,0,.26);color:#333;cursor:pointer;display:block;height:56px;opacity:1;outline:0;position:fixed;right:20px;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none;-webkit-transition:bottom .2s,opacity .2s;-o-transition:bottom .2s,opacity .2s;-moz-transition:bottom .2s,opacity .2s;transition:bottom .2s,opacity .2s;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:56px;z-index:1}#back-to-top svg{display:block;fill:currentColor;height:24px;margin:16px auto 0;width:24px}#back-to-top.hidden{bottom:-56px;opacity:0}</style>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Aman's AI Journal • Primers • Data Filtering</title>
  <meta name="viewport" content="width=device-width">
  <meta name="description" content="Aman's AI Journal | Course notes and learning material for Artificial Intelligence and Deep Learning Stanford classes.">
  <link rel="canonical" href="https://aman.ai/primers/ai/data-filtering/">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="/css/main.css">

  <!-- Google fonts -->
  <!-- <link href='https://fonts.googleapis.com/css?family=Roboto:400,300' rel='stylesheet' type='text/css'>-->

  <!-- RSS feed -->
  <link rel="alternate" type="application/atom+xml" title="Aman’s AI Journal" href="/feed.xml">  
  
  <link href="https://aman.ai/favicon.jpg" rel="shortcut icon">

  <!-- Google ads -->
  <script src="https://pagead2.googlesyndication.com/pagead/managed/js/adsense/m202512100101/show_ads_impl.js"></script><script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5905744527956213" crossorigin="anonymous" data-checked-head="true"></script>
<meta http-equiv="origin-trial" content="AlK2UR5SkAlj8jjdEc9p3F3xuFYlF6LYjAML3EOqw1g26eCwWPjdmecULvBH5MVPoqKYrOfPhYVL71xAXI1IBQoAAAB8eyJvcmlnaW4iOiJodHRwczovL2RvdWJsZWNsaWNrLm5ldDo0NDMiLCJmZWF0dXJlIjoiV2ViVmlld1hSZXF1ZXN0ZWRXaXRoRGVwcmVjYXRpb24iLCJleHBpcnkiOjE3NTgwNjcxOTksImlzU3ViZG9tYWluIjp0cnVlfQ=="><meta http-equiv="origin-trial" content="Amm8/NmvvQfhwCib6I7ZsmUxiSCfOxWxHayJwyU1r3gRIItzr7bNQid6O8ZYaE1GSQTa69WwhPC9flq/oYkRBwsAAACCeyJvcmlnaW4iOiJodHRwczovL2dvb2dsZXN5bmRpY2F0aW9uLmNvbTo0NDMiLCJmZWF0dXJlIjoiV2ViVmlld1hSZXF1ZXN0ZWRXaXRoRGVwcmVjYXRpb24iLCJleHBpcnkiOjE3NTgwNjcxOTksImlzU3ViZG9tYWluIjp0cnVlfQ=="><meta http-equiv="origin-trial" content="A9nrunKdU5m96PSN1XsSGr3qOP0lvPFUB2AiAylCDlN5DTl17uDFkpQuHj1AFtgWLxpLaiBZuhrtb2WOu7ofHwEAAACKeyJvcmlnaW4iOiJodHRwczovL2RvdWJsZWNsaWNrLm5ldDo0NDMiLCJmZWF0dXJlIjoiQUlQcm9tcHRBUElNdWx0aW1vZGFsSW5wdXQiLCJleHBpcnkiOjE3NzQzMTA0MDAsImlzU3ViZG9tYWluIjp0cnVlLCJpc1RoaXJkUGFydHkiOnRydWV9"><meta http-equiv="origin-trial" content="A93bovR+QVXNx2/38qDbmeYYf1wdte9EO37K9eMq3r+541qo0byhYU899BhPB7Cv9QqD7wIbR1B6OAc9kEfYCA4AAACQeyJvcmlnaW4iOiJodHRwczovL2dvb2dsZXN5bmRpY2F0aW9uLmNvbTo0NDMiLCJmZWF0dXJlIjoiQUlQcm9tcHRBUElNdWx0aW1vZGFsSW5wdXQiLCJleHBpcnkiOjE3NzQzMTA0MDAsImlzU3ViZG9tYWluIjp0cnVlLCJpc1RoaXJkUGFydHkiOnRydWV9"><meta http-equiv="origin-trial" content="A1S5fojrAunSDrFbD8OfGmFHdRFZymSM/1ss3G+NEttCLfHkXvlcF6LGLH8Mo5PakLO1sCASXU1/gQf6XGuTBgwAAACQeyJvcmlnaW4iOiJodHRwczovL2dvb2dsZXRhZ3NlcnZpY2VzLmNvbTo0NDMiLCJmZWF0dXJlIjoiQUlQcm9tcHRBUElNdWx0aW1vZGFsSW5wdXQiLCJleHBpcnkiOjE3NzQzMTA0MDAsImlzU3ViZG9tYWluIjp0cnVlLCJpc1RoaXJkUGFydHkiOnRydWV9"><style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 5px 0px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 5px; -webkit-border-radius: 5px; -moz-border-radius: 5px; -khtml-border-radius: 5px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 1px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: .7em}
.MathJax_MenuRadioCheck.RTL {right: .7em; left: auto}
.MathJax_MenuLabel {padding: 1px 2em 3px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #DDDDDD; margin: 4px 3px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: #606872; color: white}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1em; bottom: 1.5em; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><style type="text/css">.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom > * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd > * {display: block!important}
.MJXp-script-box > *  {display: table!important; height: 50%}
.MJXp-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXp-script-box > *:last-child > * {vertical-align: bottom}
.MJXp-script-box > * > * > * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over > * {display: block!important}
.MJXp-munderover > * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
.MathJax_PHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style><style type="text/css">.MathJax_Display {text-align: center; margin: 1em 0em; position: relative; display: block!important; text-indent: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; width: 100%}
.MathJax .merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MathJax .MJX-monospace {font-family: monospace}
.MathJax .MJX-sans-serif {font-family: sans-serif}
#MathJax_Tooltip {background-color: InfoBackground; color: InfoText; border: 1px solid black; box-shadow: 2px 2px 5px #AAAAAA; -webkit-box-shadow: 2px 2px 5px #AAAAAA; -moz-box-shadow: 2px 2px 5px #AAAAAA; -khtml-box-shadow: 2px 2px 5px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true'); padding: 3px 4px; z-index: 401; position: absolute; left: 0; top: 0; width: auto; height: auto; display: none}
.MathJax {display: inline; font-style: normal; font-weight: normal; line-height: normal; font-size: 100%; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0}
.MathJax:focus, body :focus .MathJax {display: inline-table}
.MathJax.MathJax_FullWidth {text-align: center; display: table-cell!important; width: 10000em!important}
.MathJax img, .MathJax nobr, .MathJax a {border: 0; padding: 0; margin: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; vertical-align: 0; line-height: normal; text-decoration: none}
img.MathJax_strut {border: 0!important; padding: 0!important; margin: 0!important; vertical-align: 0!important}
.MathJax span {display: inline; position: static; border: 0; padding: 0; margin: 0; vertical-align: 0; line-height: normal; text-decoration: none}
.MathJax nobr {white-space: nowrap!important}
.MathJax img {display: inline!important; float: none!important}
.MathJax * {transition: none; -webkit-transition: none; -moz-transition: none; -ms-transition: none; -o-transition: none}
.MathJax_Processing {visibility: hidden; position: fixed; width: 0; height: 0; overflow: hidden}
.MathJax_Processed {display: none!important}
.MathJax_ExBox {display: block!important; overflow: hidden; width: 1px; height: 60ex; min-height: 0; max-height: none}
.MathJax .MathJax_EmBox {display: block!important; overflow: hidden; width: 1px; height: 60em; min-height: 0; max-height: none}
.MathJax_LineBox {display: table!important}
.MathJax_LineBox span {display: table-cell!important; width: 10000em!important; min-width: 0; max-width: none; padding: 0; border: 0; margin: 0}
.MathJax .MathJax_HitBox {cursor: text; background: white; opacity: 0; filter: alpha(opacity=0)}
.MathJax .MathJax_HitBox * {filter: none; opacity: 1; background: transparent}
#MathJax_Tooltip * {filter: none; opacity: 1; background: transparent}
@font-face {font-family: MathJax_Blank; src: url('about:blank')}
.MathJax .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style><script async="" src="https://fundingchoicesmessages.google.com/i/ca-pub-5905744527956213?href=https%3A%2F%2Faman.ai%2Fprimers%2Fai%2Fdata-filtering&amp;ers=2"></script><script async="" src="https://fundingchoicesmessages.google.com/f/AGSKWxX0OneH5abh2qd6nNkuw1g0dHusKJyCo1QuJVaavCaRPJbYTP8WNoG60uZc1W5UfElyurNopWo1ez85--xgjUD2gjvuZBTYSIlJt2eJ3r6VwzJJvLy-ZLYwdIlAXIZlPzeqQDmccg==?fccs=W1siQUtzUm9sLUJvbktnUVUxdWNlalkySUd5NWpFYVZtcVpUTmIzWXZ3dkRIV3A3VkNFaUZlcHcyRVdEYUJlYzJpYnUtNGVaY041azV0VkRkR2xJRllvTWVhRnlrYTc3cVEycWF0Ti1ORGU0eTdDRktnS0lnbzBJRlNBQzdXNV96TF8zTWxHbHZjaGdJQVdCOHkycEhrR24yQjA1TkJ6Vm1Rb1RBPT0iXSxudWxsLG51bGwsbnVsbCxudWxsLG51bGwsWzE3NjY5MjI0OTUsNzAwMDAwMDBdLG51bGwsbnVsbCxudWxsLFtudWxsLFs3XV0sImh0dHBzOi8vYW1hbi5haS9wcmltZXJzL2FpL2RhdGEtZmlsdGVyaW5nLyIsbnVsbCxbWzgsInNDaE5INU9zYWswIl0sWzksImVuLVVTIl0sWzE5LCIyIl0sWzE3LCJbMF0iXSxbMjQsIiJdLFsyOSwiZmFsc2UiXV1d"></script><script async="" src="https://fundingchoicesmessages.google.com/f/AGSKWxUnmJdbied3WctL6VUqgl0BY__SDl7fGKhtkBJGYaTbdRpAft4-eRkqcGHItVrEw3fOQFSbHTdGUmydDb8DIvmlUkFRy_rjOFlzQ3-A9cMQV0yWB7O-AKATcNZOOLFokp-0RdfaPw==?fccs=W1siQUtzUm9sLUJvbktnUVUxdWNlalkySUd5NWpFYVZtcVpUTmIzWXZ3dkRIV3A3VkNFaUZlcHcyRVdEYUJlYzJpYnUtNGVaY041azV0VkRkR2xJRllvTWVhRnlrYTc3cVEycWF0Ti1ORGU0eTdDRktnS0lnbzBJRlNBQzdXNV96TF8zTWxHbHZjaGdJQVdCOHkycEhrR24yQjA1TkJ6Vm1Rb1RBPT0iXSxudWxsLG51bGwsbnVsbCxudWxsLG51bGwsWzE3NjY5MjI0OTUsMTg2MDAwMDAwXSxudWxsLG51bGwsbnVsbCxbbnVsbCxbNyw5XSxudWxsLDIsbnVsbCwiZW4iXSwiaHR0cHM6Ly9hbWFuLmFpL3ByaW1lcnMvYWkvZGF0YS1maWx0ZXJpbmcvIixudWxsLFtbOCwic0NoTkg1T3NhazAiXSxbOSwiZW4tVVMiXSxbMTksIjIiXSxbMTcsIlswXSJdLFsyNCwiIl0sWzI5LCJmYWxzZSJdXV0"></script><script async="" src="https://fundingchoicesmessages.google.com/f/AGSKWxUiwTkTVvxg5aPyVtuZbKJpomkJbzvTIdrvdjvlk71WFR3QXtlU2ahKBRdn921Gj1cWvwME_DaaNNz7yNrdIRlBWBgUoRDkYq1aQw_Ic14-C_2S-OecKYORLxXPaSDIGNySxdhWow==?fccs=W1siQUtzUm9sLUJvbktnUVUxdWNlalkySUd5NWpFYVZtcVpUTmIzWXZ3dkRIV3A3VkNFaUZlcHcyRVdEYUJlYzJpYnUtNGVaY041azV0VkRkR2xJRllvTWVhRnlrYTc3cVEycWF0Ti1ORGU0eTdDRktnS0lnbzBJRlNBQzdXNV96TF8zTWxHbHZjaGdJQVdCOHkycEhrR24yQjA1TkJ6Vm1Rb1RBPT0iXSxudWxsLG51bGwsbnVsbCxudWxsLG51bGwsWzE3NjY5MjI0OTYsMzkwMDAwMDBdLG51bGwsbnVsbCxudWxsLFtudWxsLFs3LDksNl0sbnVsbCwyLG51bGwsImVuIixudWxsLG51bGwsbnVsbCxudWxsLG51bGwsMV0sImh0dHBzOi8vYW1hbi5haS9wcmltZXJzL2FpL2RhdGEtZmlsdGVyaW5nLyIsbnVsbCxbWzgsInNDaE5INU9zYWswIl0sWzksImVuLVVTIl0sWzE5LCIyIl0sWzE3LCJbMF0iXSxbMjQsIiJdLFsyOSwiZmFsc2UiXV1d"></script></head>


    <body><div style="visibility: hidden; overflow: hidden; position: absolute; top: 0px; height: 1px; width: auto; padding: 0px; border: 0px; margin: 0px; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal;"><div id="MathJax_Hidden"></div></div><div id="MathJax_Message" style="display: none;"></div>

      <script src="https://unpkg.com/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js"></script>
      <script>addBackToTop({
        backgroundColor: '#fff',
        innerHTML: 'Back to Top',
        textColor: '#333'
      })</script><div id="back-to-top" class="hidden">Back to Top</div>
      <style>
        #back-to-top {
          border: 1px solid #ccc;
          border-radius: 0;
          font-family: sans-serif;
          font-size: 14px;
          width: 100px;
          text-align: center;
          line-height: 30px;
          height: 30px;
        }
      </style>   

    <header class="site-header">

  <a class="site-title" href="../">Distilled AI</a>

  <a class="site-link" href="https://aman.ai">Back to aman.ai</a>

  <!-- Html Elements for Search -->
  <div id="search-container">
  <input class="site-search-box" type="text" autocomplete="off" id="search-input" placeholder="search...">
  <div id="results-container"></div>
  </div>

  <!-- Script pointing to aman-script.js -->
  <script src="https://aman.ai/js/aman-search.min.js" type="text/javascript"></script>

  <!-- Configuration -->
  <script>
  document.getElementById('search-input').value='';
  SimpleJekyllSearch({
    searchInput: document.getElementById('search-input'),
    resultsContainer: document.getElementById('results-container'),
    exclude: ["cs231a"],
    searchResultTemplate: '<div class="site-search-results"><a href="{url}">{title}</a></div>',
    noResultsText: '<div class="site-search-results"><p>No results found</p></div>',
    json: 'https://aman.ai/search.json',
    limit: 5,
    fuzzy: false,
  })
  </script>    

</header>     

    <div class="page-content">
      <div class="wrap">
      <div class="post">

  <header class="post-header">
    <h1>Primers • Data Filtering</h1>
  </header>

  <article class="post-content">
  <ul id="markdown-toc">
  <li><a href="#overview" id="markdown-toc-overview">Overview</a>    <ul>
      <li><a href="#importance-of-high-quality-data" id="markdown-toc-importance-of-high-quality-data">Importance of High-Quality Data</a></li>
      <li><a href="#formal-perspective-why-noise-harms-generalization" id="markdown-toc-formal-perspective-why-noise-harms-generalization">Formal Perspective: Why Noise Harms Generalization</a></li>
      <li><a href="#filtering-in-pretraining" id="markdown-toc-filtering-in-pretraining">Filtering in Pretraining</a></li>
      <li><a href="#filtering-in-post-training" id="markdown-toc-filtering-in-post-training">Filtering in Post-Training</a></li>
      <li><a href="#benefits-of-rigorous-filtering" id="markdown-toc-benefits-of-rigorous-filtering">Benefits of Rigorous Filtering</a></li>
    </ul>
  </li>
  <li><a href="#quality-metrics-and-compliance-metrics" id="markdown-toc-quality-metrics-and-compliance-metrics">Quality Metrics and Compliance Metrics</a>    <ul>
      <li><a href="#rule-based-and-statistical-quality-metrics" id="markdown-toc-rule-based-and-statistical-quality-metrics">Rule-Based and Statistical Quality Metrics</a>        <ul>
          <li><a href="#length-based-checks" id="markdown-toc-length-based-checks">Length-Based Checks</a></li>
          <li><a href="#character-ratio-and-symbolic-noise" id="markdown-toc-character-ratio-and-symbolic-noise">Character-Ratio and Symbolic Noise</a></li>
          <li><a href="#language-identification-and-entropy" id="markdown-toc-language-identification-and-entropy">Language Identification and Entropy</a></li>
          <li><a href="#perplexity-filtering" id="markdown-toc-perplexity-filtering">Perplexity Filtering</a></li>
          <li><a href="#n-gram-diversity" id="markdown-toc-n-gram-diversity">N-Gram Diversity</a></li>
          <li><a href="#deduplication--near-deduplication" id="markdown-toc-deduplication--near-deduplication">Deduplication &amp; Near-Deduplication</a></li>
          <li><a href="#toxicity--profanity-filters" id="markdown-toc-toxicity--profanity-filters">Toxicity &amp; Profanity Filters</a></li>
        </ul>
      </li>
      <li><a href="#complexity-gap-cg-score-for-label-noise" id="markdown-toc-complexity-gap-cg-score-for-label-noise">Complexity Gap (CG) Score for Label Noise</a></li>
      <li><a href="#compliance-metrics" id="markdown-toc-compliance-metrics">Compliance Metrics</a></li>
      <li><a href="#best-practice-pipeline-for-quality--compliance-metrics" id="markdown-toc-best-practice-pipeline-for-quality--compliance-metrics">Best-Practice Pipeline for Quality &amp; Compliance Metrics</a></li>
    </ul>
  </li>
  <li><a href="#llm-based-evaluation-llm-as-a-judge" id="markdown-toc-llm-based-evaluation-llm-as-a-judge">LLM-Based Evaluation (LLM-as-a-Judge)</a>    <ul>
      <li><a href="#why-llm-based-evaluation-is-essential" id="markdown-toc-why-llm-based-evaluation-is-essential">Why LLM-Based Evaluation is Essential</a></li>
      <li><a href="#general-evaluation-dimensions" id="markdown-toc-general-evaluation-dimensions">General Evaluation Dimensions</a></li>
      <li><a href="#evaluation-prompt-with-modality-specific-evaluation-criteria-and-rubric" id="markdown-toc-evaluation-prompt-with-modality-specific-evaluation-criteria-and-rubric">Evaluation Prompt with Modality-Specific Evaluation Criteria and Rubric</a>        <ul>
          <li><a href="#text" id="markdown-toc-text">Text</a></li>
          <li><a href="#code" id="markdown-toc-code">Code</a>            <ul>
              <li><a href="#additional-code-specific-dimensions" id="markdown-toc-additional-code-specific-dimensions">Additional Code-Specific Dimensions</a></li>
            </ul>
          </li>
          <li><a href="#math" id="markdown-toc-math">Math</a>            <ul>
              <li><a href="#additional-math-specific-dimensions" id="markdown-toc-additional-math-specific-dimensions">Additional Math-Specific Dimensions</a></li>
            </ul>
          </li>
          <li><a href="#multimodal" id="markdown-toc-multimodal">Multimodal</a>            <ul>
              <li><a href="#additional-multimodal-specific-dimensions" id="markdown-toc-additional-multimodal-specific-dimensions">Additional Multimodal-Specific Dimensions</a></li>
            </ul>
          </li>
        </ul>
      </li>
      <li><a href="#aggregating-scores" id="markdown-toc-aggregating-scores">Aggregating Scores</a></li>
      <li><a href="#strengths-and-limitations" id="markdown-toc-strengths-and-limitations">Strengths and Limitations</a></li>
      <li><a href="#full-evaluation-prompt-with-integrated-modality-specific-sections" id="markdown-toc-full-evaluation-prompt-with-integrated-modality-specific-sections">Full Evaluation Prompt with Integrated Modality-Specific Sections</a></li>
      <li><a href="#evaluation-output-json-schema" id="markdown-toc-evaluation-output-json-schema">Evaluation Output JSON Schema</a></li>
    </ul>
  </li>
  <li><a href="#human-evaluation" id="markdown-toc-human-evaluation">Human Evaluation</a>    <ul>
      <li><a href="#role-of-human-evaluation-in-filtering-pipelines" id="markdown-toc-role-of-human-evaluation-in-filtering-pipelines">Role of Human Evaluation in Filtering Pipelines</a></li>
      <li><a href="#core-evaluation-dimensions-for-humans" id="markdown-toc-core-evaluation-dimensions-for-humans">Core Evaluation Dimensions for Humans</a></li>
      <li><a href="#modality-specific-human-evaluation" id="markdown-toc-modality-specific-human-evaluation">Modality-Specific Human Evaluation</a>        <ul>
          <li><a href="#text-1" id="markdown-toc-text-1">Text</a></li>
          <li><a href="#code-1" id="markdown-toc-code-1">Code</a></li>
          <li><a href="#math-1" id="markdown-toc-math-1">Math</a></li>
          <li><a href="#multimodal-1" id="markdown-toc-multimodal-1">Multimodal</a></li>
        </ul>
      </li>
      <li><a href="#quality-control-for-human-ratings" id="markdown-toc-quality-control-for-human-ratings">Quality Control for Human Ratings</a></li>
      <li><a href="#cost-and-scalability" id="markdown-toc-cost-and-scalability">Cost and Scalability</a></li>
    </ul>
  </li>
  <li><a href="#outlier-detection-via-island-analysis-of-embeddings" id="markdown-toc-outlier-detection-via-island-analysis-of-embeddings">Outlier Detection Via “Island” Analysis of Embeddings</a>    <ul>
      <li><a href="#embedding-extraction" id="markdown-toc-embedding-extraction">Embedding Extraction</a></li>
      <li><a href="#dimensionality-reduction" id="markdown-toc-dimensionality-reduction">Dimensionality Reduction</a></li>
      <li><a href="#clustering-and-outlier-detection" id="markdown-toc-clustering-and-outlier-detection">Clustering and Outlier Detection</a></li>
      <li><a href="#visual-island-analysis" id="markdown-toc-visual-island-analysis">Visual Island Analysis</a></li>
      <li><a href="#benefits-and-limitations" id="markdown-toc-benefits-and-limitations">Benefits and Limitations</a></li>
    </ul>
  </li>
  <li><a href="#prompt-quality-metrics" id="markdown-toc-prompt-quality-metrics">Prompt Quality Metrics</a>    <ul>
      <li><a href="#core-prompt-quality-dimensions" id="markdown-toc-core-prompt-quality-dimensions">Core Prompt Quality Dimensions</a></li>
      <li><a href="#example-evaluation-prompt-with-rubrics-and-examples" id="markdown-toc-example-evaluation-prompt-with-rubrics-and-examples">Example Evaluation Prompt (with Rubrics and Examples)</a></li>
      <li><a href="#integration-in-filtering-pipelines" id="markdown-toc-integration-in-filtering-pipelines">Integration in Filtering Pipelines</a></li>
    </ul>
  </li>
  <li><a href="#safety-metrics" id="markdown-toc-safety-metrics">Safety Metrics</a>    <ul>
      <li><a href="#content-safety-classification" id="markdown-toc-content-safety-classification">Content Safety Classification</a></li>
      <li><a href="#measuring-refusal-behavior-over--vs-under-punting" id="markdown-toc-measuring-refusal-behavior-over--vs-under-punting">Measuring Refusal Behavior: Over- Vs Under-Punting</a></li>
      <li><a href="#building-a-safety-evaluation-set" id="markdown-toc-building-a-safety-evaluation-set">Building a Safety Evaluation Set</a></li>
      <li><a href="#integration-in-filtering-pipelines-1" id="markdown-toc-integration-in-filtering-pipelines-1">Integration in Filtering Pipelines</a></li>
    </ul>
  </li>
  <li><a href="#deduplication" id="markdown-toc-deduplication">Deduplication</a>    <ul>
      <li><a href="#why-deduplication-comes-after-filtering" id="markdown-toc-why-deduplication-comes-after-filtering">Why Deduplication Comes After Filtering</a></li>
      <li><a href="#types-of-duplication" id="markdown-toc-types-of-duplication">Types of Duplication</a></li>
      <li><a href="#deduplication-methods" id="markdown-toc-deduplication-methods">Deduplication Methods</a>        <ul>
          <li><a href="#hash-based-deduplication" id="markdown-toc-hash-based-deduplication">Hash-Based Deduplication</a></li>
          <li><a href="#minhash--simhash" id="markdown-toc-minhash--simhash">MinHash / SimHash</a></li>
          <li><a href="#embedding-based-deduplication" id="markdown-toc-embedding-based-deduplication">Embedding-Based Deduplication</a></li>
          <li><a href="#locality-sensitive-hashing-lsh" id="markdown-toc-locality-sensitive-hashing-lsh">Locality-Sensitive Hashing (LSH)</a></li>
        </ul>
      </li>
      <li><a href="#handling-duplicates-after-detection" id="markdown-toc-handling-duplicates-after-detection">Handling Duplicates After Detection</a></li>
      <li><a href="#special-considerations" id="markdown-toc-special-considerations">Special Considerations</a></li>
    </ul>
  </li>
  <li><a href="#end-to-end-filtering-pipeline" id="markdown-toc-end-to-end-filtering-pipeline">End-to-End Filtering Pipeline</a>    <ul>
      <li><a href="#pipeline-stages" id="markdown-toc-pipeline-stages">Pipeline Stages</a>        <ul>
          <li><a href="#stage-1-basic-heuristic-filtering" id="markdown-toc-stage-1-basic-heuristic-filtering">Stage 1: Basic Heuristic Filtering</a></li>
          <li><a href="#stage-2-quality-and-compliance-metrics" id="markdown-toc-stage-2-quality-and-compliance-metrics">Stage 2: Quality and Compliance Metrics</a></li>
          <li><a href="#stage-3-outlier-and-island-detection" id="markdown-toc-stage-3-outlier-and-island-detection">Stage 3: Outlier and Island Detection</a></li>
          <li><a href="#stage-4-llm-based-evaluation-llm-as-a-judge" id="markdown-toc-stage-4-llm-based-evaluation-llm-as-a-judge">Stage 4: LLM-Based Evaluation (LLM-as-a-Judge)</a></li>
          <li><a href="#stage-5-human-evaluation" id="markdown-toc-stage-5-human-evaluation">Stage 5: Human Evaluation</a></li>
          <li><a href="#stage-6-prompt-quality-evaluation" id="markdown-toc-stage-6-prompt-quality-evaluation">Stage 6: Prompt Quality Evaluation</a></li>
          <li><a href="#stage-7-safety-behavior-evaluation" id="markdown-toc-stage-7-safety-behavior-evaluation">Stage 7: Safety Behavior Evaluation</a></li>
          <li><a href="#stage-8-deduplication" id="markdown-toc-stage-8-deduplication">Stage 8: Deduplication</a></li>
        </ul>
      </li>
      <li><a href="#flow-diagram" id="markdown-toc-flow-diagram">Flow Diagram</a></li>
    </ul>
  </li>
  <li><a href="#concrete-scoring-framework" id="markdown-toc-concrete-scoring-framework">Concrete Scoring Framework</a>    <ul>
      <li><a href="#stage-level-thresholding-overview" id="markdown-toc-stage-level-thresholding-overview">Stage-Level Thresholding Overview</a></li>
      <li><a href="#suggested-weights-and-thresholds" id="markdown-toc-suggested-weights-and-thresholds">Suggested Weights and Thresholds</a></li>
      <li><a href="#implementation-flow" id="markdown-toc-implementation-flow">Implementation Flow</a></li>
      <li><a href="#citation" id="markdown-toc-citation">Citation</a></li>
    </ul>
  </li>
</ul>

<h2 id="overview">Overview</h2>

<ul>
  <li>
    <p>Training data quality is the <strong>single largest determinant of model performance</strong>—even more than architecture size or compute budget. High-quality data allows models to reach higher accuracy with less compute, while poor-quality data wastes resources and limits scaling benefits.</p>
  </li>
  <li>
    <p>Large-scale datasets often contain <strong>systematic noise</strong>: duplicated content, low-information filler, mislabeled pairs, adversarial injections, or content from undesired domains. Without filtering, these corrupt the model’s learned representations and reduce generalization.</p>
  </li>
  <li>
    <p>As models scale (e.g. trillions of parameters), their <strong>capacity becomes bottlenecked by data quality</strong>. When trained on low-quality corpora, models spend capacity memorizing noise instead of learning useful structure, leading to diminishing returns from scaling.</p>
  </li>
  <li>
    <p>Rigorous filtering pipelines are therefore essential to produce <strong>clean, diverse, policy-compliant, and representative data</strong> for both pretraining (to build broad competence) and post-training (to align behavior with human preferences and safety norms).</p>
  </li>
</ul>

<h3 id="importance-of-high-quality-data">Importance of High-Quality Data</h3>

<ul>
  <li>
    <p>Data quality is the <strong>foundation of effective machine learning</strong>. Large language models (LLMs), code generation models, and multimodal systems rely on vast amounts of data for both <strong>pretraining</strong> and <strong>post-training</strong> (e.g., supervised fine-tuning, preference modeling via  (RLHF), and safety alignment).</p>
  </li>
  <li>
    <p>If this data is noisy or low-quality, models may:</p>

    <ul>
      <li>Converge more slowly,</li>
      <li>Generalize poorly,</li>
      <li>Or even become unstable or unsafe in downstream applications.</li>
    </ul>
  </li>
  <li>
    <p>In the worst case, corrupted data introduces <strong>systematic biases, hallucinations, and unsafe outputs</strong> that are difficult to remove later.</p>
  </li>
</ul>

<h3 id="formal-perspective-why-noise-harms-generalization">Formal Perspective: Why Noise Harms Generalization</h3>

<ul>
  <li>
    <p>Let <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1" style="width: 0.888em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.732em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.357em, 1000.73em, 2.346em, -999.997em); top: -2.185em; left: 0em;"><span class="mrow" id="MathJax-Span-2"><span class="mi" id="MathJax-Span-3" style="font-family: STIXGeneral-Italic;">D</span></span><span style="display: inline-block; width: 0px; height: 2.19em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>D</mi></math></span></span><script type="math/tex" id="MathJax-Element-1">D</script> be the training dataset and <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-2-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;M&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-4" style="width: 1.148em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.94em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.357em, 1000.94em, 2.346em, -999.997em); top: -2.185em; left: 0em;"><span class="mrow" id="MathJax-Span-5"><span class="mi" id="MathJax-Span-6" style="font-family: STIXGeneral-Italic;">M<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.055em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.19em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>M</mi></math></span></span><script type="math/tex" id="MathJax-Element-2">M</script> the model trained on it. Under the <a href="https://en.wikipedia.org/wiki/Empirical_risk_minimization">Empirical Risk Minimization</a> (ERM) principle, model parameters <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-3-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-7" style="width: 0.732em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.576em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.357em, 1000.58em, 2.346em, -999.997em); top: -2.185em; left: 0em;"><span class="mrow" id="MathJax-Span-8"><span class="mi" id="MathJax-Span-9" style="font-family: STIXGeneral-Italic;">θ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.19em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>θ</mi></math></span></span><script type="math/tex" id="MathJax-Element-3">\theta</script> are learned by minimizing:</p>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-4-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;munder&gt;&lt;mo movablelimits=&quot;true&quot; form=&quot;prefix&quot;&gt;min&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/mrow&gt;&lt;/munder&gt;&lt;mfrac&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;munder&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;/mrow&gt;&lt;/munder&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;&gt;L&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-10" style="width: 12.451em; display: inline-block;"><span style="display: inline-block; position: relative; width: 10.367em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(0.68em, 1010.32em, 3.753em, -999.997em); top: -2.185em; left: 0em;"><span class="mrow" id="MathJax-Span-11"><span class="munderover" id="MathJax-Span-12"><span style="display: inline-block; position: relative; width: 1.565em; height: 0px;"><span style="position: absolute; clip: rect(3.18em, 1001.57em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span class="mo" id="MathJax-Span-13" style="font-family: STIXGeneral-Regular;">min</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.388em, 1000.37em, 4.273em, -999.997em); top: -3.331em; left: 0.628em;"><span class="texatom" id="MathJax-Span-14"><span class="mrow" id="MathJax-Span-15"><span class="mi" id="MathJax-Span-16" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">θ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mfrac" id="MathJax-Span-17" style="padding-left: 0.211em;"><span style="display: inline-block; position: relative; width: 1.461em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;"><span style="position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;"><span class="mn" id="MathJax-Span-18" style="font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.18em, 1001.25em, 4.378em, -999.997em); top: -3.331em; left: 50%; margin-left: -0.674em;"><span class="mrow" id="MathJax-Span-19"><span class="texatom" id="MathJax-Span-20"><span class="mrow" id="MathJax-Span-21"><span class="mo" id="MathJax-Span-22" style="font-family: STIXVariants;">|</span></span></span><span class="mi" id="MathJax-Span-23" style="font-family: STIXGeneral-Italic;">D</span><span class="texatom" id="MathJax-Span-24"><span class="mrow" id="MathJax-Span-25"><span class="mo" id="MathJax-Span-26" style="font-family: STIXVariants;">|</span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(0.836em, 1001.46em, 1.201em, -999.997em); top: -1.247em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.461em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span><span class="munderover" id="MathJax-Span-27" style="padding-left: 0.211em;"><span style="display: inline-block; position: relative; width: 2.294em; height: 0px;"><span style="position: absolute; clip: rect(2.867em, 1001.2em, 4.638em, -999.997em); top: -4.008em; left: 0.471em;"><span class="mo" id="MathJax-Span-28" style="font-family: STIXSizeOneSym; vertical-align: -0.518em;">∑</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.388em, 1002.24em, 4.43em, -999.997em); top: -2.862em; left: 0em;"><span class="texatom" id="MathJax-Span-29"><span class="mrow" id="MathJax-Span-30"><span class="mo" id="MathJax-Span-31" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-32" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-33" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-34" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">y</span><span class="mo" id="MathJax-Span-35" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-36" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">∈</span><span class="mi" id="MathJax-Span-37" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">D</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="texatom" id="MathJax-Span-38" style="padding-left: 0.211em;"><span class="mrow" id="MathJax-Span-39"><span class="mi" id="MathJax-Span-40" style="font-family: STIXNonUnicode-Italic;"></span></span></span><span class="mo" id="MathJax-Span-41" style="font-family: STIXGeneral-Regular;">(</span><span class="msubsup" id="MathJax-Span-42"><span style="display: inline-block; position: relative; width: 0.68em; height: 0px;"><span style="position: absolute; clip: rect(3.18em, 1000.42em, 4.378em, -999.997em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-43" style="font-family: STIXGeneral-Italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.159em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.852em; left: 0.263em;"><span class="mi" id="MathJax-Span-44" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">θ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-45" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-46" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-47" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-48" style="font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-49" style="font-family: STIXGeneral-Italic; padding-left: 0.211em;">y</span><span class="mo" id="MathJax-Span-50" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.19em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.747em; border-left: 0px solid; width: 0px; height: 3.441em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><munder><mo movablelimits="true" form="prefix">min</mo><mrow class="MJX-TeXAtom-ORD"><mi>θ</mi></mrow></munder><mfrac><mn>1</mn><mrow><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mi>D</mi><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow></mrow></mfrac><munder><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo stretchy="false">)</mo><mo>∈</mo><mi>D</mi></mrow></munder><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-caligraphic" mathvariant="script">L</mi></mrow><mo stretchy="false">(</mo><msub><mi>f</mi><mi>θ</mi></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>,</mo><mi>y</mi><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-4">\min_{\theta} \frac{1}{|D|} \sum_{(x,y)\in D} \mathcal{L}(f_\theta(x), y)</script>

    <ul>
      <li>where <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-5-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;&gt;L&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-51" style="width: 0.888em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.732em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.357em, 1000.68em, 2.346em, -999.997em); top: -2.185em; left: 0em;"><span class="mrow" id="MathJax-Span-52"><span class="texatom" id="MathJax-Span-53"><span class="mrow" id="MathJax-Span-54"><span class="mi" id="MathJax-Span-55" style="font-family: STIXNonUnicode-Italic;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.19em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-caligraphic" mathvariant="script">L</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-5">\mathcal{L}</script> is the loss function.</li>
    </ul>
  </li>
  <li>This assumes that <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-6-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mo&gt;&amp;#x223C;&lt;/mo&gt;&lt;mi&gt;P&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-56" style="width: 5.523em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.586em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.409em, 1004.53em, 2.607em, -999.997em); top: -2.237em; left: 0em;"><span class="mrow" id="MathJax-Span-57"><span class="mi" id="MathJax-Span-58" style="font-family: STIXGeneral-Italic;">D</span><span class="mo" id="MathJax-Span-59" style="font-family: STIXGeneral-Regular; padding-left: 0.315em;">∼</span><span class="mi" id="MathJax-Span-60" style="font-family: STIXGeneral-Italic; padding-left: 0.315em;">P</span><span class="mo" id="MathJax-Span-61" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-62" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-63" style="font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-64" style="font-family: STIXGeneral-Italic; padding-left: 0.211em;">y</span><span class="mo" id="MathJax-Span-65" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.242em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>D</mi><mo>∼</mo><mi>P</mi><mo stretchy="false">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-6">D \sim P(x,y)</script>, i.e. that the dataset represents the true data distribution.</li>
  <li>
    <p>If <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-7-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-66" style="width: 0.888em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.732em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.357em, 1000.73em, 2.346em, -999.997em); top: -2.185em; left: 0em;"><span class="mrow" id="MathJax-Span-67"><span class="mi" id="MathJax-Span-68" style="font-family: STIXGeneral-Italic;">D</span></span><span style="display: inline-block; width: 0px; height: 2.19em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>D</mi></math></span></span><script type="math/tex" id="MathJax-Element-7">D</script> contains mislabeled, adversarial, duplicated, or off-distribution samples, then the learned <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-8-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo&gt;&amp;#x2217;&lt;/mo&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-69" style="width: 1.201em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.992em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.305em, 1000.99em, 2.294em, -999.997em); top: -2.133em; left: 0em;"><span class="mrow" id="MathJax-Span-70"><span class="msubsup" id="MathJax-Span-71"><span style="display: inline-block; position: relative; width: 0.992em; height: 0px;"><span style="position: absolute; clip: rect(3.18em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-72" style="font-family: STIXGeneral-Italic;">θ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -4.372em; left: 0.576em;"><span class="mo" id="MathJax-Span-73" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">∗</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.138em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>θ</mi><mo>∗</mo></msup></math></span></span><script type="math/tex" id="MathJax-Element-8">\theta^*</script> will minimize a <strong>distorted empirical risk</strong>, leading to:</p>

    <ul>
      <li>Poor generalization to unseen data,</li>
      <li>Overfitting to spurious correlations,</li>
      <li>Or systematic unsafe behaviors.</li>
    </ul>
  </li>
  <li>This is well-documented in studies such as <a href="https://arxiv.org/abs/2104.06835">Data Quality Determines Model Performance</a> and <a href="https://arxiv.org/abs/2001.08361">Scaling Laws for Neural Language Models</a>, which show diminishing returns from scaling when low-quality data dominates.</li>
</ul>

<h3 id="filtering-in-pretraining">Filtering in Pretraining</h3>

<ul>
  <li>
    <p>Pretraining typically uses <strong>web-scale corpora</strong> (e.g., <a href="https://commoncrawl.org/">Common Crawl</a>, <a href="https://pile.eleuther.ai/">The Pile</a>) containing trillions of tokens.</p>
  </li>
  <li>
    <p>Even a small fraction of <strong>corrupted data</strong> (spam, duplicates, off-domain content, adversarial injections) can:</p>

    <ul>
      <li>Skew token frequency distributions,</li>
      <li>Amplify social or cultural biases,</li>
      <li>Reduce model capacity available for rare but important phenomena.</li>
    </ul>
  </li>
  <li>
    <p>Filtering during pretraining aims to:</p>

    <ul>
      <li>Remove low-quality or irrelevant documents using <strong>statistical heuristics</strong> (length, perplexity, n-gram diversity, language ID).</li>
      <li>Enforce <strong>diversity and coverage</strong> to avoid mode collapse on common content.</li>
      <li><strong>Prevent contamination</strong> from test sets or benchmark datasets (avoiding data leakage).</li>
    </ul>
  </li>
  <li>
    <p>Relevant large-scale filtering pipelines include <a href="https://www.tensorflow.org/datasets/catalog/c4">C4</a> (used in <a href="https://arxiv.org/abs/1910.10683">T5</a>) and <a href="https://arxiv.org/abs/2306.01116">RefinedWeb</a>.</p>
  </li>
</ul>

<h3 id="filtering-in-post-training">Filtering in Post-Training</h3>

<ul>
  <li>
    <p>Post-training datasets are much smaller (millions rather than billions of samples), so <strong>every example carries much more weight</strong>. Poor quality data can directly:</p>

    <ul>
      <li>Teach models unsafe behavior,</li>
      <li>Collapse preference gradients,</li>
      <li>Or induce refusal bias from ambiguous labels.</li>
    </ul>
  </li>
  <li>
    <p>Filtering in post-training is used to:</p>

    <ul>
      <li>Eliminate <strong>ambiguous or low-consensus labels</strong>, which destabilize supervised fine-tuning.</li>
      <li>Remove <strong>unsafe, toxic, or policy-violating examples</strong> before they propagate into model behavior.</li>
      <li>Ensure that prompts are <strong>challenging yet solvable</strong>, which provides strong preference signals during RLHF.</li>
    </ul>
  </li>
  <li>
    <p>Good references for post-training data curation include the <a href="https://openai.com/research/learning-from-human-feedback">OpenAI RLHF blog</a> and <a href="https://www.anthropic.com/news/constitutional-ai">Anthropic’s HH-RLHF paper</a>.</p>
  </li>
</ul>

<h3 id="benefits-of-rigorous-filtering">Benefits of Rigorous Filtering</h3>

<p>Rigorous data filtering improves both <strong>model performance</strong> and <strong>training efficiency</strong>. Key benefits include:</p>

<ol>
  <li>
    <p><strong>Better Generalization</strong></p>

    <ul>
      <li>Removes noisy and spurious patterns that models could overfit to.</li>
      <li>Improves cross-domain and zero-shot performance.</li>
    </ul>
  </li>
  <li>
    <p><strong>Stability and Robustness</strong></p>

    <ul>
      <li>Reduces harmful memorization of rare or adversarial outliers.</li>
      <li>Leads to more stable convergence during training.</li>
    </ul>
  </li>
  <li>
    <p><strong>Compute Efficiency</strong></p>

    <ul>
      <li>Reduces the number of training steps needed by discarding uninformative or duplicated samples.</li>
      <li>Frees up capacity for rare, high-value patterns.</li>
    </ul>
  </li>
  <li>
    <p><strong>Improved Safety</strong></p>

    <ul>
      <li>Minimizes risk of models generating harmful, toxic, or policy-violating content.</li>
      <li>Reduces need for aggressive safety alignment later.</li>
    </ul>
  </li>
  <li>
    <p><strong>Higher Evaluation Correlation</strong></p>

    <ul>
      <li>Ensures post-training alignment datasets reflect <strong>desired human preferences</strong>, improving correlation between offline evals and human-rated quality.</li>
    </ul>
  </li>
</ol>

<h2 id="quality-metrics-and-compliance-metrics">Quality Metrics and Compliance Metrics</h2>

<ul>
  <li>High-quality data filtering pipelines typically operate in <strong>layers</strong>: (i) fast and cheap rule-based/statistical checks, (ii) deeper LLM-based evaluations, and (iii) optional human checks for calibration. This section describes metrics for <strong>text, code, math, and multimodal</strong> data, and includes both <strong>quality metrics</strong> (intrinsic usefulness) and <strong>compliance metrics</strong> (policy/safety/legal alignment).</li>
</ul>

<h3 id="rule-based-and-statistical-quality-metrics">Rule-Based and Statistical Quality Metrics</h3>

<ul>
  <li>These are inexpensive heuristics for large-scale, early-stage filtering—ideal for <strong>pretraining-scale corpora</strong>.</li>
</ul>

<h4 id="length-based-checks">Length-Based Checks</h4>

<ul>
  <li>Remove extremely short (&lt;5 tokens) or overly long (&gt;2000 tokens) samples.</li>
  <li>Prevents boilerplate stubs and runaway text from skewing training.</li>
</ul>

<h4 id="character-ratio-and-symbolic-noise">Character-Ratio and Symbolic Noise</h4>

<ul>
  <li>Filter samples with excessive non-alphabetic characters, emoji spam, or gibberish.</li>
  <li>Use regex-based heuristics or character frequency thresholds.</li>
</ul>

<h4 id="language-identification-and-entropy">Language Identification and Entropy</h4>

<ul>
  <li>Detect and remove samples in the wrong language using <a href="https://fasttext.cc/">fastText</a> or <a href="https://github.com/saffsd/langid.py">langid.py</a>.</li>
  <li>Compute Shannon entropy <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-9-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;H&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-74" style="width: 2.346em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.93em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.357em, 1001.88em, 2.503em, -999.997em); top: -2.185em; left: 0em;"><span class="mrow" id="MathJax-Span-75"><span class="mi" id="MathJax-Span-76" style="font-family: STIXGeneral-Italic;">H<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.055em;"></span></span><span class="mo" id="MathJax-Span-77" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-78" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-79" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.19em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>H</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-9">H(x)</script> to find too-random or too-predictable text.</li>
</ul>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-10-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;H&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;munder&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/mrow&gt;&lt;/munder&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mi&gt;log&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-80" style="width: 13.128em; display: inline-block;"><span style="display: inline-block; position: relative; width: 10.94em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.044em, 1010.89em, 3.596em, -999.997em); top: -2.185em; left: 0em;"><span class="mrow" id="MathJax-Span-81"><span class="mi" id="MathJax-Span-82" style="font-family: STIXGeneral-Italic;">H<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.055em;"></span></span><span class="mo" id="MathJax-Span-83" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-84" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-85" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-86" style="font-family: STIXGeneral-Regular; padding-left: 0.315em;">=</span><span class="mo" id="MathJax-Span-87" style="font-family: STIXGeneral-Regular; padding-left: 0.315em;">−</span><span class="munderover" id="MathJax-Span-88" style="padding-left: 0.211em;"><span style="display: inline-block; position: relative; width: 1.305em; height: 0px;"><span style="position: absolute; clip: rect(2.867em, 1001.2em, 4.638em, -999.997em); top: -4.008em; left: 0em;"><span class="mo" id="MathJax-Span-89" style="font-family: STIXSizeOneSym; vertical-align: -0.518em;">∑</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.388em, 1000.21em, 4.273em, -999.997em); top: -2.862em; left: 0.576em;"><span class="texatom" id="MathJax-Span-90"><span class="mrow" id="MathJax-Span-91"><span class="mi" id="MathJax-Span-92" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mi" id="MathJax-Span-93" style="font-family: STIXGeneral-Italic; padding-left: 0.211em;">p</span><span class="mo" id="MathJax-Span-94" style="font-family: STIXGeneral-Regular;">(</span><span class="msubsup" id="MathJax-Span-95"><span style="display: inline-block; position: relative; width: 0.732em; height: 0px;"><span style="position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-96" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.852em; left: 0.471em;"><span class="mi" id="MathJax-Span-97" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-98" style="font-family: STIXGeneral-Regular;">)</span><span class="mi" id="MathJax-Span-99" style="font-family: STIXGeneral-Regular; padding-left: 0.211em;">log</span><span class="mo" id="MathJax-Span-100"></span><span class="mi" id="MathJax-Span-101" style="font-family: STIXGeneral-Italic; padding-left: 0.211em;">p</span><span class="mo" id="MathJax-Span-102" style="font-family: STIXGeneral-Regular;">(</span><span class="msubsup" id="MathJax-Span-103"><span style="display: inline-block; position: relative; width: 0.732em; height: 0px;"><span style="position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-104" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.852em; left: 0.471em;"><span class="mi" id="MathJax-Span-105" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-106" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.19em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.559em; border-left: 0px solid; width: 0px; height: 2.816em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>H</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mo>−</mo><munder><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>i</mi></mrow></munder><mi>p</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mi>log</mi><mo>⁡</mo><mi>p</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-10">H(x) = -\sum_{i} p(x_i)\log p(x_i)</script>

<h4 id="perplexity-filtering">Perplexity Filtering</h4>

<ul>
  <li>Use a smaller pretrained LM (not the target model) to estimate:</li>
</ul>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-11-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mtext&gt;PPL&lt;/mtext&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;exp&lt;/mi&gt;&lt;mspace width=&quot;negativethinmathspace&quot; /&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mfrac&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mfrac&gt;&lt;munderover&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/munderover&gt;&lt;mi&gt;log&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2223;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;lt;&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-107" style="width: 19.482em; display: inline-block;"><span style="display: inline-block; position: relative; width: 16.201em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(2.19em, 1016.1em, 5.576em, -999.997em); top: -4.112em; left: 0em;"><span class="mrow" id="MathJax-Span-108"><span class="mtext" id="MathJax-Span-109" style="font-family: STIXGeneral-Regular;">PPL</span><span class="mo" id="MathJax-Span-110" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-111" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-112" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-113" style="font-family: STIXGeneral-Regular; padding-left: 0.315em;">=</span><span class="mi" id="MathJax-Span-114" style="font-family: STIXGeneral-Regular; padding-left: 0.315em;">exp</span><span class="mspace" id="MathJax-Span-115" style="height: 0em; vertical-align: 0em; margin-left: -0.206em;"></span><span class="mrow" id="MathJax-Span-116" style="padding-left: 0.211em;"><span class="mo" id="MathJax-Span-117" style="vertical-align: -0.779em;"><span style="font-family: STIXSizeFourSym;">(</span></span><span class="mrow" id="MathJax-Span-118"><span class="mo" id="MathJax-Span-119" style="font-family: STIXGeneral-Regular;">−</span><span class="mfrac" id="MathJax-Span-120"><span style="display: inline-block; position: relative; width: 0.628em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;"><span style="position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;"><span class="mn" id="MathJax-Span-121" style="font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -3.331em; left: 50%; margin-left: -0.258em;"><span class="mi" id="MathJax-Span-122" style="font-family: STIXGeneral-Italic;">n</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(0.836em, 1000.63em, 1.201em, -999.997em); top: -1.247em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.628em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span><span class="munderover" id="MathJax-Span-123" style="padding-left: 0.211em;"><span style="display: inline-block; position: relative; width: 1.305em; height: 0px;"><span style="position: absolute; clip: rect(2.867em, 1001.2em, 4.638em, -999.997em); top: -4.008em; left: 0em;"><span class="mo" id="MathJax-Span-124" style="font-family: STIXSizeOneSym; vertical-align: -0.518em;">∑</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.388em, 1000.94em, 4.273em, -999.997em); top: -2.862em; left: 0.107em;"><span class="texatom" id="MathJax-Span-125"><span class="mrow" id="MathJax-Span-126"><span class="mi" id="MathJax-Span-127" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span class="mo" id="MathJax-Span-128" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">=</span><span class="mn" id="MathJax-Span-129" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.44em, 1000.32em, 4.169em, -999.997em); top: -5.206em; left: 0.471em;"><span class="mi" id="MathJax-Span-130" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">n</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mi" id="MathJax-Span-131" style="font-family: STIXGeneral-Regular; padding-left: 0.211em;">log</span><span class="mo" id="MathJax-Span-132"></span><span class="msubsup" id="MathJax-Span-133" style="padding-left: 0.211em;"><span style="display: inline-block; position: relative; width: 0.94em; height: 0px;"><span style="position: absolute; clip: rect(3.44em, 1000.47em, 4.378em, -999.997em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-134" style="font-family: STIXGeneral-Italic;">p</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.852em; left: 0.523em;"><span class="mi" id="MathJax-Span-135" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">θ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-136" style="font-family: STIXGeneral-Regular;">(</span><span class="msubsup" id="MathJax-Span-137"><span style="display: inline-block; position: relative; width: 0.732em; height: 0px;"><span style="position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-138" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.852em; left: 0.471em;"><span class="mi" id="MathJax-Span-139" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-140" style="font-family: STIXGeneral-Regular; padding-left: 0.315em;">∣</span><span class="msubsup" id="MathJax-Span-141" style="padding-left: 0.315em;"><span style="display: inline-block; position: relative; width: 1.201em; height: 0px;"><span style="position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-142" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.852em; left: 0.471em;"><span class="texatom" id="MathJax-Span-143"><span class="mrow" id="MathJax-Span-144"><span class="mo" id="MathJax-Span-145" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">&lt;</span><span class="mi" id="MathJax-Span-146" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-147" style="font-family: STIXGeneral-Regular;">)</span></span><span class="mo" id="MathJax-Span-148" style="vertical-align: -0.779em;"><span style="font-family: STIXSizeFourSym;">)</span></span></span></span><span style="display: inline-block; width: 0px; height: 4.117em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.622em; border-left: 0px solid; width: 0px; height: 3.816em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtext>PPL</mtext><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mi>exp</mi><mspace width="negativethinmathspace"></mspace><mrow><mo>(</mo><mrow><mo>−</mo><mfrac><mn>1</mn><mi>n</mi></mfrac><munderover><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mi>log</mi><mo>⁡</mo><msub><mi>p</mi><mi>θ</mi></msub><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>∣</mo><msub><mi>x</mi><mrow class="MJX-TeXAtom-ORD"><mo>&lt;</mo><mi>i</mi></mrow></msub><mo stretchy="false">)</mo></mrow><mo>)</mo></mrow></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-11">\text{PPL}(x) = \exp\!\left(-\frac{1}{n} \sum_{i=1}^n \log p_\theta(x_i\mid x_{<i})\right)</script>

<ul>
  <li>Very high perplexity <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-12-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2192;&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-149" style="width: 1.201em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.992em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.565em, 1000.94em, 2.294em, -999.997em); top: -2.185em; left: 0em;"><span class="mrow" id="MathJax-Span-150"><span class="mo" id="MathJax-Span-151" style="font-family: STIXGeneral-Regular;">→</span></span><span style="display: inline-block; width: 0px; height: 2.19em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: 0.003em; border-left: 0px solid; width: 0px; height: 0.628em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">→</mo></math></span></span><script type="math/tex" id="MathJax-Element-12">\rightarrow</script> garbled or foreign text; very low <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-13-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2192;&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-152" style="width: 1.201em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.992em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.565em, 1000.94em, 2.294em, -999.997em); top: -2.185em; left: 0em;"><span class="mrow" id="MathJax-Span-153"><span class="mo" id="MathJax-Span-154" style="font-family: STIXGeneral-Regular;">→</span></span><span style="display: inline-block; width: 0px; height: 2.19em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: 0.003em; border-left: 0px solid; width: 0px; height: 0.628em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">→</mo></math></span></span><script type="math/tex" id="MathJax-Element-13">\rightarrow</script> overly common boilerplate.</li>
</ul>

<h4 id="n-gram-diversity">N-Gram Diversity</h4>

<ul>
  <li>Measures richness of content:</li>
</ul>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-14-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msub&gt;&lt;mtext&gt;diversity&lt;/mtext&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mtext&gt;unique n-grams&lt;/mtext&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mtext&gt;total n-grams&lt;/mtext&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-155" style="width: 17.607em; display: inline-block;"><span style="display: inline-block; position: relative; width: 14.638em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(0.68em, 1014.64em, 3.232em, -999.997em); top: -2.185em; left: 0em;"><span class="mrow" id="MathJax-Span-156"><span class="msubsup" id="MathJax-Span-157"><span style="display: inline-block; position: relative; width: 3.909em; height: 0px;"><span style="position: absolute; clip: rect(3.18em, 1003.49em, 4.378em, -999.997em); top: -4.008em; left: 0em;"><span class="mtext" id="MathJax-Span-158" style="font-family: STIXGeneral-Regular;">diversity</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.747em; left: 3.492em;"><span class="mi" id="MathJax-Span-159" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">n</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-160" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-161" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-162" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-163" style="font-family: STIXGeneral-Regular; padding-left: 0.315em;">=</span><span class="mfrac" id="MathJax-Span-164" style="padding-left: 0.315em;"><span style="display: inline-block; position: relative; width: 8.128em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;"><span style="position: absolute; clip: rect(3.18em, 1007.87em, 4.378em, -999.997em); top: -4.685em; left: 50%; margin-left: -4.008em;"><span class="mrow" id="MathJax-Span-165"><span class="texatom" id="MathJax-Span-166"><span class="mrow" id="MathJax-Span-167"><span class="mo" id="MathJax-Span-168" style="font-family: STIXVariants;">|</span></span></span><span class="mtext" id="MathJax-Span-169" style="font-family: STIXGeneral-Regular;">unique n-grams</span><span class="mo" id="MathJax-Span-170" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-171" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-172" style="font-family: STIXGeneral-Regular;">)</span><span class="texatom" id="MathJax-Span-173"><span class="mrow" id="MathJax-Span-174"><span class="mo" id="MathJax-Span-175" style="font-family: STIXVariants;">|</span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.18em, 1006.36em, 4.378em, -999.997em); top: -3.331em; left: 50%; margin-left: -3.227em;"><span class="mrow" id="MathJax-Span-176"><span class="mtext" id="MathJax-Span-177" style="font-family: STIXGeneral-Regular;">total n-grams</span><span class="mo" id="MathJax-Span-178" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-179" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-180" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(0.836em, 1008.13em, 1.201em, -999.997em); top: -1.247em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 8.128em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.19em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.122em; border-left: 0px solid; width: 0px; height: 2.878em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mtext>diversity</mtext><mi>n</mi></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mtext>unique n-grams</mtext><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow></mrow><mrow><mtext>total n-grams</mtext><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></mfrac></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-14">\text{diversity}_n(x) = \frac{|\text{unique n-grams}(x)|}{\text{total n-grams}(x)}</script>

<ul>
  <li>Helps remove template-like content.</li>
</ul>

<h4 id="deduplication--near-deduplication">Deduplication &amp; Near-Deduplication</h4>

<ul>
  <li>Use <a href="https://en.wikipedia.org/wiki/MinHash">MinHash</a>, <a href="https://en.wikipedia.org/wiki/SimHash">SimHash</a>, or embedding cosine similarity to eliminate duplicates.</li>
  <li>Deduplication is also revisited in the <a href="#deduplication">Deduplication</a> section.</li>
</ul>

<h4 id="toxicity--profanity-filters">Toxicity &amp; Profanity Filters</h4>

<ul>
  <li>Use lexicon-based filters or toxicity classifiers such as <a href="https://perspectiveapi.com/">Perspective</a>.</li>
  <li>Early removal prevents harmful content from influencing pretraining distributions.</li>
</ul>

<h3 id="complexity-gap-cg-score-for-label-noise">Complexity Gap (CG) Score for Label Noise</h3>

<ul>
  <li>
    <p>The <strong>Complexity Gap (CG) score</strong>, introduced in <a href="https://arxiv.org/abs/2301.00930">Data Valuation Without Training</a> by Nohyun et al. (2023),  estimates <strong>label noise</strong> without training models.</p>
  </li>
  <li>
    <p>Let <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-15-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-181" style="width: 3.388em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.815em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.357em, 1002.76em, 2.555em, -999.997em); top: -2.185em; left: 0em;"><span class="mrow" id="MathJax-Span-182"><span class="mi" id="MathJax-Span-183" style="font-family: STIXGeneral-Italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-184" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-185" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-186" style="font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-187" style="font-family: STIXGeneral-Italic; padding-left: 0.211em;">y</span><span class="mo" id="MathJax-Span-188" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.19em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi><mo stretchy="false">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-15">C(x,y)</script> be the Kolmogorov complexity estimate of an input–label pair and <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-16-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x007E;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-189" style="width: 3.336em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.763em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.357em, 1002.71em, 2.555em, -999.997em); top: -2.185em; left: 0em;"><span class="mrow" id="MathJax-Span-190"><span class="mi" id="MathJax-Span-191" style="font-family: STIXGeneral-Italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-192" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-193" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-194" style="font-family: STIXGeneral-Regular;">,</span><span class="texatom" id="MathJax-Span-195" style="padding-left: 0.211em;"><span class="mrow" id="MathJax-Span-196"><span class="munderover" id="MathJax-Span-197"><span style="display: inline-block; position: relative; width: 0.471em; height: 0px;"><span style="position: absolute; clip: rect(3.44em, 1000.42em, 4.378em, -999.997em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-198" style="font-family: STIXGeneral-Italic;">y</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -4.06em; left: 0.055em;"><span style="height: 0em; vertical-align: 0em; width: 0.419em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-199" style="font-family: STIXGeneral-Regular;">̃&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.258em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-200" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.19em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi><mo stretchy="false">(</mo><mi>x</mi><mo>,</mo><mrow class="MJX-TeXAtom-ORD"><mover><mi>y</mi><mo stretchy="false">~</mo></mover></mrow><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-16">C(x,\tilde{y})</script> the complexity when labels are randomly permuted. * Then:</p>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-17-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mtext&gt;CG&lt;/mtext&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x007E;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-201" style="width: 13.648em; display: inline-block;"><span style="display: inline-block; position: relative; width: 11.357em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.357em, 1011.3em, 2.555em, -999.997em); top: -2.185em; left: 0em;"><span class="mrow" id="MathJax-Span-202"><span class="mtext" id="MathJax-Span-203" style="font-family: STIXGeneral-Regular;">CG</span><span class="mo" id="MathJax-Span-204" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-205" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-206" style="font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-207" style="font-family: STIXGeneral-Italic; padding-left: 0.211em;">y</span><span class="mo" id="MathJax-Span-208" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-209" style="font-family: STIXGeneral-Regular; padding-left: 0.315em;">=</span><span class="mi" id="MathJax-Span-210" style="font-family: STIXGeneral-Italic; padding-left: 0.315em;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-211" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-212" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-213" style="font-family: STIXGeneral-Regular;">,</span><span class="texatom" id="MathJax-Span-214" style="padding-left: 0.211em;"><span class="mrow" id="MathJax-Span-215"><span class="munderover" id="MathJax-Span-216"><span style="display: inline-block; position: relative; width: 0.471em; height: 0px;"><span style="position: absolute; clip: rect(3.44em, 1000.42em, 4.378em, -999.997em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-217" style="font-family: STIXGeneral-Italic;">y</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -4.06em; left: 0.055em;"><span style="height: 0em; vertical-align: 0em; width: 0.419em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-218" style="font-family: STIXGeneral-Regular;">̃&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.258em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-219" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-220" style="font-family: STIXGeneral-Regular; padding-left: 0.263em;">−</span><span class="mi" id="MathJax-Span-221" style="font-family: STIXGeneral-Italic; padding-left: 0.263em;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-222" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-223" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-224" style="font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-225" style="font-family: STIXGeneral-Italic; padding-left: 0.211em;">y</span><span class="mo" id="MathJax-Span-226" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.19em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtext>CG</mtext><mo stretchy="false">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo stretchy="false">)</mo><mo>=</mo><mi>C</mi><mo stretchy="false">(</mo><mi>x</mi><mo>,</mo><mrow class="MJX-TeXAtom-ORD"><mover><mi>y</mi><mo stretchy="false">~</mo></mover></mrow><mo stretchy="false">)</mo><mo>−</mo><mi>C</mi><mo stretchy="false">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-17">\text{CG}(x,y) = C(x,\tilde{y}) - C(x,y)</script>

    <ul>
      <li>High CG <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-18-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2192;&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-227" style="width: 1.201em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.992em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.565em, 1000.94em, 2.294em, -999.997em); top: -2.185em; left: 0em;"><span class="mrow" id="MathJax-Span-228"><span class="mo" id="MathJax-Span-229" style="font-family: STIXGeneral-Regular;">→</span></span><span style="display: inline-block; width: 0px; height: 2.19em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: 0.003em; border-left: 0px solid; width: 0px; height: 0.628em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">→</mo></math></span></span><script type="math/tex" id="MathJax-Element-18">\rightarrow</script> label <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-19-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-230" style="width: 0.628em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.617em, 1000.52em, 2.555em, -999.997em); top: -2.185em; left: 0em;"><span class="mrow" id="MathJax-Span-231"><span class="mi" id="MathJax-Span-232" style="font-family: STIXGeneral-Italic;">y</span></span><span style="display: inline-block; width: 0px; height: 2.19em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>y</mi></math></span></span><script type="math/tex" id="MathJax-Element-19">y</script> meaningfully compresses <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-20-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-233" style="width: 0.628em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;"><span class="mrow" id="MathJax-Span-234"><span class="mi" id="MathJax-Span-235" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.19em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi></math></span></span><script type="math/tex" id="MathJax-Element-20">x</script> → likely correct.</li>
      <li>Low or negative CG <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-21-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2192;&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-236" style="width: 1.201em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.992em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.565em, 1000.94em, 2.294em, -999.997em); top: -2.185em; left: 0em;"><span class="mrow" id="MathJax-Span-237"><span class="mo" id="MathJax-Span-238" style="font-family: STIXGeneral-Regular;">→</span></span><span style="display: inline-block; width: 0px; height: 2.19em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: 0.003em; border-left: 0px solid; width: 0px; height: 0.628em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">→</mo></math></span></span><script type="math/tex" id="MathJax-Element-21">\rightarrow</script> <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-22-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-239" style="width: 0.628em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.617em, 1000.52em, 2.555em, -999.997em); top: -2.185em; left: 0em;"><span class="mrow" id="MathJax-Span-240"><span class="mi" id="MathJax-Span-241" style="font-family: STIXGeneral-Italic;">y</span></span><span style="display: inline-block; width: 0px; height: 2.19em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>y</mi></math></span></span><script type="math/tex" id="MathJax-Element-22">y</script> gives little information → likely noisy.</li>
    </ul>
  </li>
  <li>
    <p><strong>Modality applicability</strong>:</p>

    <ul>
      <li>Works for <strong>text, code, and math</strong> since all are tokenizable and labelable.</li>
      <li>Extensible to <strong>multimodal data</strong> (e.g., image–label) if both parts are serialized (e.g., image features or captions concatenated with labels) before complexity estimation.</li>
    </ul>
  </li>
  <li>
    <p>CG is especially useful for <strong>post-training datasets</strong>, where label noise has outsized effects.</p>
  </li>
</ul>

<h3 id="compliance-metrics">Compliance Metrics</h3>

<ul>
  <li>
    <p>Compliance metrics enforce <strong>external constraints</strong> like safety, privacy, and licensing—crucial in <strong>post-training</strong> and <strong>alignment datasets</strong>.</p>
  </li>
  <li>
    <p>Typical checks:</p>

    <ul>
      <li><strong>Safety policy classifiers:</strong> block sexual, hateful, violent, or self-harm content.</li>
      <li><strong>License audits:</strong> remove copyrighted or restrictive-license content (<a href="https://creativecommons.org/">Creative Commons</a> license parsing).</li>
      <li><strong>Privacy filters:</strong> remove PII using regex and named-entity recognition (NER).</li>
      <li><strong>Bias/toxicity detectors:</strong> run automated bias classifiers and PII scrubbers.</li>
    </ul>
  </li>
  <li>
    <p>Compliance metrics are often binary (pass/fail), but can be scored probabilistically to enable threshold tuning.</p>
  </li>
</ul>

<h3 id="best-practice-pipeline-for-quality--compliance-metrics">Best-Practice Pipeline for Quality &amp; Compliance Metrics</h3>

<ul>
  <li>
    <p>A robust early-stage pipeline typically does:</p>

    <ol>
      <li><strong>Cheap rule-based filters</strong> (length, character ratio, language ID, perplexity, diversity).</li>
      <li><strong>Deduplication</strong> (hash-based + embedding-based).</li>
      <li><strong>Compliance filters</strong> (safety, license, privacy).</li>
      <li><strong>Optional CG score</strong> for labeled datasets to detect label noise.</li>
    </ol>
  </li>
  <li>
    <p>Only data passing these gates proceeds to <strong>LLM-based evaluation</strong> (Section 3) and optional <strong>human evaluation</strong> (Section 4).</p>
  </li>
</ul>

<h2 id="llm-based-evaluation-llm-as-a-judge">LLM-Based Evaluation (LLM-as-a-Judge)</h2>

<ul>
  <li><strong>LLM-based evaluation</strong> is a scalable mid-stage filtering layer, positioned after rule-based/statistical filters but before or alongside human evaluation. It is especially useful for filtering <strong>instruction data, code/math problems, and multimodal datasets</strong> where quality depends on deep semantic properties that shallow heuristics can’t capture.</li>
  <li>LLMs like <a href="https://openai.com/index/gpt-4-research/">GPT-4</a> or <a href="https://claude.ai/">Claude</a> are often used as judges, with dedicated models such as <a href="https://huggingface.co/meta-llama/Llama-Critic">Llama-Critic</a>, <a href="https://huggingface.co/nvidia/Prometheus-13b-v1.0">Prometheus</a>, and <a href="https://huggingface.co/teknium/Shepherd-7B-v2.0">Shepherd</a>, which are fine-tuned on Learning-to-Rank (LTR) data (i.e., on pointwise, pairwise, and/or listwise tasks).</li>
  <li>For details on prompting LLMs as judges, see <a href="https://github.com/openai/evals">OpenAI Evals</a> and <a href="https://www.anthropic.com/news/constitutional-ai">Anthropic’s Constitutional AI paper</a>.</li>
</ul>

<h3 id="why-llm-based-evaluation-is-essential">Why LLM-Based Evaluation is Essential</h3>

<ul>
  <li>
    <p>Rule-based and statistical filters (perplexity, entropy) can detect low-level noise, but they cannot judge:</p>

    <ul>
      <li>semantic <strong>fluency and coherence</strong>,</li>
      <li><strong>factuality</strong> and knowledge grounding,</li>
      <li>whether responses <strong>follow instructions</strong> and stay <strong>on-topic</strong>,</li>
      <li>or whether multimodal pairs are <strong>semantically aligned</strong>.</li>
    </ul>
  </li>
  <li>
    <p><strong>LLM-based evaluation (LLM-as-a-judge)</strong> fills this gap. Modern evaluators like  or  can be prompted to rate content on structured rubrics, producing <strong>granular quality scores at scale</strong>.</p>
  </li>
  <li>
    <p>This is especially crucial for:</p>

    <ul>
      <li><strong>Instruction-tuning datasets</strong> (SFT)</li>
      <li><strong>Preference datasets</strong> for  (RLHF)</li>
      <li><strong>Domain-specific datasets</strong> (code, math, multimodal)</li>
    </ul>
  </li>
</ul>

<h3 id="general-evaluation-dimensions">General Evaluation Dimensions</h3>

<ul>
  <li>These dimensions apply to <strong>all data types (text, code, math, multimodal)</strong> and should be rated by default.</li>
</ul>

<div align="center">
<table class="tg">
<thead>
<tr>
<th class="tg-hcenter-valign-first"><strong>Dimension</strong></th>
<th class="tg-hcenter-valign-second"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tg-tleft-valign-first">Fluency / Grammaticality</td>
<td class="tg-tleft-valign-second">Is it well-formed and grammatically correct?</td>
</tr>
<tr>
<td class="tg-tleft-valign-first">Coherence / Logical Flow</td>
<td class="tg-tleft-valign-second">Are ideas or steps connected and logically structured?</td>
</tr>
<tr>
<td class="tg-tleft-valign-first">Factuality / Correctness</td>
<td class="tg-tleft-valign-second">Are claims factually accurate or logically correct?</td>
</tr>
<tr>
<td class="tg-tleft-valign-first">Instruction Relevance</td>
<td class="tg-tleft-valign-second">Does it answer the given instruction fully and directly?</td>
</tr>
<tr>
<td class="tg-tleft-valign-first">Safety / Policy Compliance</td>
<td class="tg-tleft-valign-second">Is it free from unsafe, toxic, or policy-violating content?</td>
</tr>
<tr>
<td class="tg-tleft-valign-first">Conciseness / Clarity</td>
<td class="tg-tleft-valign-second">Is it clear and not overly verbose or vague?</td>
</tr>
</tbody>
</table>
</div>

<h3 id="evaluation-prompt-with-modality-specific-evaluation-criteria-and-rubric">Evaluation Prompt with Modality-Specific Evaluation Criteria and Rubric</h3>

<ul>
  <li>Included below is a <strong>structured evaluation prompt</strong> that includes all general + modality-specific evaluation criteria and a per-criteria rubric, each with:
    <ul>
      <li>clear definitions,</li>
      <li>1–5 Likert-scale rubrics,</li>
      <li>good/bad examples,</li>
      <li>and a structured JSON output format.</li>
    </ul>
  </li>
  <li>The following sub-section highlight modality-specific evaluation criteria.</li>
</ul>

<h4 id="text">Text</h4>

<ul>
  <li>Focus on fluency, coherence, factual correctness, and instruction relevance.</li>
  <li>Detect hallucinations or contradictions.</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><div><button class="btn-copy" data-clipboard-action="copy" data-clipboard-target="#code0"><img src="https://aman.ai/images/copy.png" style="margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;"></button></div><code id="code0">You are an expert data quality evaluator. 
Evaluate the following SAMPLE (which can be text, code, math, or multimodal).
Assign scores from 1–5 on each dimension using the detailed rubrics below.
For each score, include a 1–2 sentence explanation referencing specific aspects of the sample.
Return your evaluation in JSON format.

SAMPLE TO EVALUATE:
""

---

1. Fluency / Grammaticality
Definition: Is the sample well-formed, grammatical, and easy to read?

Rubric:
1 - Completely unreadable or nonsensical.
2 - Frequent grammar errors, very awkward phrasing.
3 - Understandable but somewhat awkward or choppy.
4 - Clear and smooth with minor issues.
5 - Highly fluent, polished, and natural.

Good: "The mitochondrion is the powerhouse of the cell." (5)  
Bad: "Cell power make mitochondria go boom." (1)

---

2. Coherence / Logical Flow
Definition: Do the ideas or steps follow a logical structure and make sense together?

Rubric:
1 - Totally disjointed or contradictory.
2 - Some logical gaps or contradictions.
3 - Mostly connected but occasionally inconsistent.
4 - Logical and structured with minor gaps.
5 - Fully logical, internally consistent, and well organized.

Good: "First define the variable, then initialize it, then loop through values." (5)  
Bad: "Loop the values then define it after output." (1)

---

3. Factuality / Correctness
Definition: Are statements accurate and factually correct (or logically valid for math/code)?

Rubric:
1 - Mostly false or logically incorrect.
2 - More wrong than right; major errors.
3 - Mostly correct but some minor factual or logical issues.
4 - Correct with small inaccuracies.
5 - Fully accurate and factually correct.

Good: "Paris is the capital of France." (5)  
Bad: "Paris is the capital of Germany." (1)

---

4. Instruction-Following Relevance
Definition: Does the response directly and completely address the given prompt/instruction?

Rubric:
1 - Completely unrelated to the instruction.
2 - Very partially related, ignores most of the instruction.
3 - Addresses the instruction partially.
4 - Fully addresses it with minor omissions.
5 - Fully addresses all aspects of the instruction.

Good:
Prompt: "List two prime numbers" → "2 and 3" (5)  
Bad:
Prompt: "List two prime numbers" → "Bananas are yellow." (1)

---

5. Safety / Policy Compliance
Definition: Is the content free from harmful, unsafe, or policy-violating content?

Rubric:
1 - Explicit harm, illegal activity, or hate content.
2 - Possibly unsafe or harmful.
3 - Mostly safe but some risky or borderline content.
4 - Safe and non-harmful.
5 - Very safe and benign.

Good: "Describe how vaccines work to prevent disease." (5)  
Bad: "Describe how to make a bomb at home." (1)

---

6. Conciseness / Clarity
Definition: Is the content concise and clear without being vague or overly verbose?

Rubric:
1 - Extremely vague or overly verbose with no structure.
2 - Wordy or redundant; hard to follow.
3 - Somewhat clear but occasionally repetitive or rambling.
4 - Mostly concise and clear with minor redundancy.
5 - Very clear, concise, and well structured.

Good: "Sort the list in ascending order using a for loop." (5)  
Bad: "You could, if you want, possibly sort the list, maybe in ascending order or something." (1)

---

OUTPUT FORMAT:
{
  "fluency": {"score": &lt;1-5&gt;, "explanation": "&lt;...&gt;"},
  "coherence": {"score": &lt;1-5&gt;, "explanation": "&lt;...&gt;"},
  "factuality": {"score": &lt;1-5&gt;, "explanation": "&lt;...&gt;"},
  "instruction_relevance": {"score": &lt;1-5&gt;, "explanation": "&lt;...&gt;"},
  "safety": {"score": &lt;1-5&gt;, "explanation": "&lt;...&gt;"},
  "conciseness": {"score": &lt;1-5&gt;, "explanation": "&lt;...&gt;"},
  "overall_average": &lt;mean score rounded to 2 decimals&gt;
}
</code></pre></div></div>

<h4 id="code">Code</h4>

<ul>
  <li>Use LLMs to check algorithmic correctness, adherence to style, clarity of comments.</li>
  <li>Optionally verify executability using static analysis or lightweight test harnesses.</li>
</ul>

<h5 id="additional-code-specific-dimensions">Additional Code-Specific Dimensions</h5>

<ul>
  <li>Use these <strong>in addition to the general dimensions</strong> if the sample is code:</li>
</ul>

<div align="center">
<table class="tg">
<thead>
<tr>
<th class="tg-hcenter-valign-first"><strong>Dimension</strong></th>
<th class="tg-hcenter-valign-second"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tg-tleft-valign-first">Executability</td>
<td class="tg-tleft-valign-second">Does the code run without syntax/runtime errors?</td>
</tr>
<tr>
<td class="tg-tleft-valign-first">Functional Correctness</td>
<td class="tg-tleft-valign-second">Does it produce the correct output for the specified task?</td>
</tr>
<tr>
<td class="tg-tleft-valign-first">Readability &amp; Style</td>
<td class="tg-tleft-valign-second">Is it readable, documented, and stylistically consistent?</td>
</tr>
</tbody>
</table>
</div>

<ul>
  <li>
    <p><strong>Rubrics &amp; Examples</strong>:</p>

    <ul>
      <li>
        <p><strong>Executability</strong>:</p>

        <ul>
          <li>1 = does not run at all</li>
          <li>5 = runs cleanly with no errors/warnings</li>
          <li>Good: script compiles and executes (5)</li>
          <li>Bad: undefined variables and syntax errors (1)</li>
        </ul>
      </li>
      <li>
        <p><strong>Functional Correctness</strong>:</p>

        <ul>
          <li>1 = completely incorrect</li>
          <li>5 = fully correct on all tested cases</li>
          <li>Good: correct sorting algorithm (5)</li>
          <li>Bad: returns unsorted list (1)</li>
        </ul>
      </li>
      <li>
        <p><strong>Readability &amp; Style</strong>:</p>

        <ul>
          <li>1 = spaghetti code, no comments</li>
          <li>5 = clean, well-structured, documented</li>
          <li>Good: PEP8-compliant Python with comments (5)</li>
          <li>Bad: one-line dense code (1)</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h4 id="math">Math</h4>

<ul>
  <li>Evaluate reasoning correctness and step validity.</li>
  <li>Ensure clarity and logical structure of solutions.</li>
</ul>

<h5 id="additional-math-specific-dimensions">Additional Math-Specific Dimensions</h5>

<ul>
  <li>Use these <strong>in addition to the general dimensions</strong> if the sample is math:</li>
</ul>

<div align="center">
<table class="tg">
<thead>
<tr>
<th class="tg-hcenter-valign-first"><strong>Dimension</strong></th>
<th class="tg-hcenter-valign-second"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tg-tleft-valign-first">Step Correctness</td>
<td class="tg-tleft-valign-second">Are all intermediate reasoning steps correct?</td>
</tr>
<tr>
<td class="tg-tleft-valign-first">Solution Validity</td>
<td class="tg-tleft-valign-second">Is the final result correct and consistent with steps?</td>
</tr>
<tr>
<td class="tg-tleft-valign-first">Mathematical Clarity</td>
<td class="tg-tleft-valign-second">Are steps clearly presented and logically structured?</td>
</tr>
</tbody>
</table>
</div>

<ul>
  <li>
    <p><strong>Rubrics &amp; Examples</strong>:</p>

    <ul>
      <li>
        <p><strong>Step Correctness</strong>:</p>

        <ul>
          <li>1 = most steps wrong</li>
          <li>5 = all steps correct</li>
          <li>Good: each algebraic manipulation valid (5)</li>
          <li>Bad: divides by zero (1)</li>
        </ul>
      </li>
      <li>
        <p><strong>Solution Validity</strong>:</p>

        <ul>
          <li>1 = wrong and inconsistent</li>
          <li>5 = correct answer matching steps</li>
          <li>Good: solves for x=5 correctly (5)</li>
          <li>Bad: final answer 7 from valid steps but arithmetic mistake (2)</li>
        </ul>
      </li>
      <li>
        <p><strong>Mathematical Clarity</strong>:</p>

        <ul>
          <li>1 = extremely messy</li>
          <li>5 = clear and structured</li>
          <li>Good: labeled steps and proper equation layout (5)</li>
          <li>Bad: steps scattered with no order (1)</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h4 id="multimodal">Multimodal</h4>

<ul>
  <li>Check semantic alignment (e.g. image matches caption).</li>
  <li>Detect unsafe content in either modality.</li>
  <li>Judge informativeness and relevance of the pairing.</li>
  <li>For reference: <a href="https://github.com/meta-llama/llama-guard">LLaMA-Guard</a> can evaluate multimodal safety and relevance at scale.</li>
</ul>

<h5 id="additional-multimodal-specific-dimensions">Additional Multimodal-Specific Dimensions</h5>

<ul>
  <li>Use these <strong>in addition to the general dimensions</strong> if the sample is multimodal:</li>
</ul>

<div align="center">
<table class="tg">
<thead>
<tr>
<th class="tg-hcenter-valign-first"><strong>Dimension</strong></th>
<th class="tg-hcenter-valign-second"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tg-tleft-valign-first">Image-Text Alignment</td>
<td class="tg-tleft-valign-second">Does the text accurately describe or match the image/video?</td>
</tr>
<tr>
<td class="tg-tleft-valign-first">Visual Safety</td>
<td class="tg-tleft-valign-second">Is the visual content safe, non-violent, and non-NSFW?</td>
</tr>
<tr>
<td class="tg-tleft-valign-first">Informativeness</td>
<td class="tg-tleft-valign-second">Is the pairing informative and relevant rather than trivial?</td>
</tr>
</tbody>
</table>
</div>

<ul>
  <li>
    <p><strong>Rubrics &amp; Examples</strong>:</p>

    <ul>
      <li>
        <p><strong>Image-Text Alignment</strong>:</p>

        <ul>
          <li>1 = completely mismatched</li>
          <li>5 = fully aligned and descriptive</li>
          <li>Good: caption “A red apple on a table” for red apple image (5)</li>
          <li>Bad: caption “A cat running” for a dog image (1)</li>
        </ul>
      </li>
      <li>
        <p><strong>Visual Safety</strong>:</p>

        <ul>
          <li>1 = explicit unsafe/violent</li>
          <li>5 = very safe and benign</li>
          <li>Good: photo of a classroom (5)</li>
          <li>Bad: graphic gore image (1)</li>
        </ul>
      </li>
      <li>
        <p><strong>Informativeness</strong>:</p>

        <ul>
          <li>1 = trivial/uninformative</li>
          <li>5 = highly informative</li>
          <li>Good: diagram labeling cell parts (5)</li>
          <li>Bad: caption “This is an image” (1)</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 id="aggregating-scores">Aggregating Scores</h3>

<ul>
  <li>
    <p>Collect scores per dimension <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-23-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-242" style="width: 2.451em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.034em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.357em, 1001.98em, 2.503em, -999.997em); top: -2.185em; left: 0em;"><span class="mrow" id="MathJax-Span-243"><span class="msubsup" id="MathJax-Span-244"><span style="display: inline-block; position: relative; width: 0.836em; height: 0px;"><span style="position: absolute; clip: rect(3.44em, 1000.37em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-245" style="font-family: STIXGeneral-Italic;">s</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.852em; left: 0.367em;"><span class="mi" id="MathJax-Span-246" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-247" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-248" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-249" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.19em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>s</mi><mi>d</mi></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-23">s_d(x)</script> and aggregate them into a composite quality score:</p>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-24-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;munder&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;/mrow&gt;&lt;/munder&gt;&lt;msub&gt;&lt;mi&gt;w&lt;/mi&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-250" style="width: 10.471em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.701em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.096em, 1008.65em, 3.648em, -999.997em); top: -2.237em; left: 0em;"><span class="mrow" id="MathJax-Span-251"><span class="mi" id="MathJax-Span-252" style="font-family: STIXGeneral-Italic;">Q</span><span class="mo" id="MathJax-Span-253" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-254" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-255" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-256" style="font-family: STIXGeneral-Regular; padding-left: 0.315em;">=</span><span class="munderover" id="MathJax-Span-257" style="padding-left: 0.315em;"><span style="display: inline-block; position: relative; width: 1.357em; height: 0px;"><span style="position: absolute; clip: rect(2.867em, 1001.2em, 4.638em, -999.997em); top: -4.008em; left: 0.055em;"><span class="mo" id="MathJax-Span-258" style="font-family: STIXSizeOneSym; vertical-align: -0.518em;">∑</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.388em, 1001.36em, 4.273em, -999.997em); top: -2.862em; left: 0em;"><span class="texatom" id="MathJax-Span-259"><span class="mrow" id="MathJax-Span-260"><span class="mi" id="MathJax-Span-261" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-262" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">∈</span><span class="mi" id="MathJax-Span-263" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">D</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-264" style="padding-left: 0.211em;"><span style="display: inline-block; position: relative; width: 1.096em; height: 0px;"><span style="position: absolute; clip: rect(3.44em, 1000.63em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-265" style="font-family: STIXGeneral-Italic;">w</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.852em; left: 0.68em;"><span class="mi" id="MathJax-Span-266" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-267" style="font-family: STIXGeneral-Regular; padding-left: 0.263em;">⋅</span><span class="msubsup" id="MathJax-Span-268" style="padding-left: 0.263em;"><span style="display: inline-block; position: relative; width: 0.836em; height: 0px;"><span style="position: absolute; clip: rect(3.44em, 1000.37em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-269" style="font-family: STIXGeneral-Italic;">s</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.852em; left: 0.367em;"><span class="mi" id="MathJax-Span-270" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-271" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-272" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-273" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.242em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.559em; border-left: 0px solid; width: 0px; height: 2.816em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>Q</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><munder><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>d</mi><mo>∈</mo><mi>D</mi></mrow></munder><msub><mi>w</mi><mi>d</mi></msub><mo>⋅</mo><msub><mi>s</mi><mi>d</mi></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-24">Q(x) = \sum_{d \in D} w_d \cdot s_d(x)</script>

    <ul>
      <li>where <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-25-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;w&lt;/mi&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-274" style="width: 1.357em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.096em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.565em, 1001.1em, 2.451em, -999.997em); top: -2.133em; left: 0em;"><span class="mrow" id="MathJax-Span-275"><span class="msubsup" id="MathJax-Span-276"><span style="display: inline-block; position: relative; width: 1.096em; height: 0px;"><span style="position: absolute; clip: rect(3.44em, 1000.63em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-277" style="font-family: STIXGeneral-Italic;">w</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.852em; left: 0.68em;"><span class="mi" id="MathJax-Span-278" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.138em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>w</mi><mi>d</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-25">w_d</script> are tunable weights. Data points below threshold on <strong>any critical dimension (like safety)</strong> can be hard-filtered.</li>
    </ul>
  </li>
  <li>
    <p>Some systems also use <strong>pairwise comparisons</strong>: the evaluator is given two candidates and asked which is better on each dimension, producing preference labels for training reward models.</p>
  </li>
</ul>

<h3 id="strengths-and-limitations">Strengths and Limitations</h3>

<ul>
  <li>
    <p><strong>Strengths</strong>:</p>

    <ul>
      <li>Scalable, consistent, and adaptable to new domains.</li>
      <li>Captures nuanced properties impossible for simple heuristics.</li>
      <li>Produces structured scores for filtering thresholds.</li>
    </ul>
  </li>
  <li>
    <p><strong>Limitations</strong>:</p>

    <ul>
      <li>Can inherit bias from the evaluator model.</li>
      <li>May hallucinate or produce inconsistent judgments.</li>
      <li>Requires calibration against human gold labels to remain reliable.</li>
    </ul>
  </li>
</ul>

<h3 id="full-evaluation-prompt-with-integrated-modality-specific-sections">Full Evaluation Prompt with Integrated Modality-Specific Sections</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><div><button class="btn-copy" data-clipboard-action="copy" data-clipboard-target="#code1"><img src="https://aman.ai/images/copy.png" style="margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;"></button></div><code id="code1">You are an expert data quality evaluator. 
Evaluate the following SAMPLE (which can be text, code, math, or multimodal).
Assign scores from 1–5 on each relevant dimension using the detailed rubrics below.
For each score, include a 1–2 sentence explanation referencing specific aspects of the sample.
Only score dimensions that apply to the sample’s type.
Return your evaluation in JSON format.

SAMPLE TO EVALUATE:
""

---

GENERAL DIMENSIONS

1. Fluency / Grammaticality
Definition: Is the sample well-formed, grammatical, and easy to read?

Rubric:
1 - Completely unreadable or nonsensical.
2 - Frequent grammar errors, very awkward phrasing.
3 - Understandable but somewhat awkward or choppy.
4 - Clear and smooth with minor issues.
5 - Highly fluent, polished, and natural.

Good: "The mitochondrion is the powerhouse of the cell." (5)  
Bad: "Cell power make mitochondria go boom." (1)

---

2. Coherence / Logical Flow
Definition: Do the ideas or steps follow a logical structure and make sense together?

Rubric:
1 - Totally disjointed or contradictory.
2 - Some logical gaps or contradictions.
3 - Mostly connected but occasionally inconsistent.
4 - Logical and structured with minor gaps.
5 - Fully logical, internally consistent, and well organized.

Good: "First define the variable, then initialize it, then loop through values." (5)  
Bad: "Loop the values then define it after output." (1)

---

3. Factuality / Correctness
Definition: Are statements accurate and factually correct (or logically valid for math/code)?

Rubric:
1 - Mostly false or logically incorrect.
2 - More wrong than right; major errors.
3 - Mostly correct but some minor factual or logical issues.
4 - Correct with small inaccuracies.
5 - Fully accurate and factually correct.

Good: "Paris is the capital of France." (5)  
Bad: "Paris is the capital of Germany." (1)

---

4. Instruction-Following Relevance
Definition: Does the response directly and completely address the given prompt/instruction?

Rubric:
1 - Completely unrelated to the instruction.
2 - Very partially related, ignores most of the instruction.
3 - Addresses the instruction partially.
4 - Fully addresses it with minor omissions.
5 - Fully addresses all aspects of the instruction.

Good:
Prompt: "List two prime numbers" → "2 and 3" (5)  
Bad:
Prompt: "List two prime numbers" → "Bananas are yellow." (1)

---

5. Safety / Policy Compliance
Definition: Is the content free from harmful, unsafe, or policy-violating content?

Rubric:
1 - Explicit harm, illegal activity, or hate content.
2 - Possibly unsafe or harmful.
3 - Mostly safe but some risky or borderline content.
4 - Safe and non-harmful.
5 - Very safe and benign.

Good: "Describe how vaccines work to prevent disease." (5)  
Bad: "Describe how to make a bomb at home." (1)

---

6. Conciseness / Clarity
Definition: Is the content concise and clear without being vague or overly verbose?

Rubric:
1 - Extremely vague or overly verbose with no structure.
2 - Wordy or redundant; hard to follow.
3 - Somewhat clear but occasionally repetitive or rambling.
4 - Mostly concise and clear with minor redundancy.
5 - Very clear, concise, and well structured.

Good: "Sort the list in ascending order using a for loop." (5)  
Bad: "You could, if you want, possibly sort the list, maybe in ascending order or something." (1)

---

CODE-SPECIFIC DIMENSIONS

7. Executability
Definition: Does the code run without syntax or runtime errors?

Rubric:
1 - Does not run at all.
2 - Runs with major errors.
3 - Runs with minor errors or missing imports.
4 - Runs with no errors but has warnings.
5 - Runs cleanly with no errors or warnings.

Good: A script that compiles and executes cleanly. (5)  
Bad: Code missing colons and undefined variables. (1)

---

8. Functional Correctness
Definition: Does the code produce correct output for the specified task?

Rubric:
1 - Completely incorrect or unrelated functionality.
2 - Attempts task but fails on most inputs.
3 - Works on simple cases but fails on edge cases.
4 - Works correctly with minor bugs.
5 - Fully correct on all tested cases.

Good: A correct sorting algorithm implementation. (5)  
Bad: Returns the unsorted list unchanged. (1)

---

9. Readability &amp; Style
Definition: Is the code readable, documented, and stylistically consistent?

Rubric:
1 - Very hard to read, no structure or naming.
2 - Poor formatting, unclear structure.
3 - Understandable but inconsistent style.
4 - Readable and mostly well-formatted.
5 - Very clean, well-structured, and documented.

Good: Clean PEP8-compliant Python with comments. (5)  
Bad: One-line spaghetti code with no comments. (1)

---

MATH-SPECIFIC DIMENSIONS

10. Step Correctness
Definition: Are all intermediate reasoning steps correct?

Rubric:
1 - Most steps are wrong.
2 - Several major errors in steps.
3 - Mostly correct steps with minor issues.
4 - Correct steps with minor slips.
5 - All steps logically correct.

Good: Each algebraic manipulation is valid. (5)  
Bad: Divides by zero in step 2. (1)

---

11. Solution Validity
Definition: Is the final result correct and consistent with steps?

Rubric:
1 - Final answer is wrong and inconsistent.
2 - Final answer is wrong but steps are partly okay.
3 - Steps lead to a wrong answer due to small error.
4 - Correct answer with very small slip.
5 - Correct answer consistent with steps.

Good: Solves for x=5 correctly. (5)  
Bad: Gets x=7 from valid steps but arithmetic mistake. (2)

---

12. Mathematical Clarity
Definition: Are steps clearly presented and logically structured?

Rubric:
1 - Extremely messy, hard to follow.
2 - Poorly organized, hard to parse.
3 - Understandable but unclear formatting.
4 - Clear with minor formatting issues.
5 - Very clear, structured, and readable.

Good: Proper equation layout, labeled steps. (5)  
Bad: Steps scattered with no order. (1)

---

MULTIMODAL-SPECIFIC DIMENSIONS

13. Image-Text Alignment
Definition: Does the text accurately describe or match the image/video?

Rubric:
1 - Completely mismatched.
2 - Mostly mismatched.
3 - Some alignment but partially wrong.
4 - Mostly aligned.
5 - Fully aligned and descriptive.

Good: Caption “A red apple on a table” for a red apple image. (5)  
Bad: Caption “A cat running” for a dog image. (1)

---

14. Visual Safety
Definition: Is the visual content safe and non-NSFW or non-violent?

Rubric:
1 - Explicit unsafe or violent content.
2 - Possibly unsafe or graphic.
3 - Mostly safe but some risk.
4 - Safe and benign.
5 - Very safe, educational, and benign.

Good: Photo of a classroom. (5)  
Bad: Graphic gore image. (1)

---

15. Informativeness
Definition: Is the image-text pair informative and non-trivial?

Rubric:
1 - Trivial or uninformative.
2 - Very shallow.
3 - Somewhat informative.
4 - Informative and detailed.
5 - Highly informative and content-rich.

Good: Diagram labeling parts of a cell. (5)  
Bad: Caption “This is an image” on a photo. (1)

---

OUTPUT FORMAT:
{
  "fluency": {...},
  "coherence": {...},
  ...
  "executability": {...},
  ...
  "image_text_alignment": {...},
  ...
  "overall_average": &lt;mean of all scored dimensions, rounded to 2 decimals&gt;
}
</code></pre></div></div>

<h3 id="evaluation-output-json-schema">Evaluation Output JSON Schema</h3>

<ul>
  <li>
    <p>Use this schema to standardize evaluator outputs across general and modality-specific evaluations. This schema supports:</p>

    <ul>
      <li>Always-present <strong>general dimensions</strong></li>
      <li><strong>Optional modality-specific dimensions</strong> that are included only if applicable</li>
      <li>Standardized structure (score, explanation) for each dimension</li>
      <li>An <code class="language-plaintext highlighter-rouge">overall_average</code> computed over whichever dimensions were scored</li>
    </ul>
  </li>
  <li>
    <p>Each dimension has:</p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">score</code>: integer from 1–5 (Likert rating)</li>
      <li><code class="language-plaintext highlighter-rouge">explanation</code>: 1–2 sentence rationale referring to the sample</li>
    </ul>
  </li>
  <li>
    <p>Optional fields are present only if the content matches that modality (code, math, multimodal).</p>
  </li>
</ul>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><div><button class="btn-copy" data-clipboard-action="copy" data-clipboard-target="#code2"><img src="https://aman.ai/images/copy.png" style="margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;"></button></div><code id="code2"><span class="p">{</span><span class="w">
  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"object"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"fluency"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"object"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"score"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"integer"</span><span class="p">,</span><span class="w"> </span><span class="nl">"minimum"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nl">"maximum"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="nl">"explanation"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w"> </span><span class="p">}</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"required"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"score"</span><span class="p">,</span><span class="s2">"explanation"</span><span class="p">]</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"coherence"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"$ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"#/definitions/criterion"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="nl">"factuality"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"$ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"#/definitions/criterion"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="nl">"instruction_relevance"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"$ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"#/definitions/criterion"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="nl">"safety"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"$ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"#/definitions/criterion"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="nl">"conciseness"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"$ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"#/definitions/criterion"</span><span class="w"> </span><span class="p">},</span><span class="w">

    </span><span class="nl">"executability"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"$ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"#/definitions/criterion"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="nl">"functional_correctness"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"$ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"#/definitions/criterion"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="nl">"readability_style"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"$ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"#/definitions/criterion"</span><span class="w"> </span><span class="p">},</span><span class="w">

    </span><span class="nl">"step_correctness"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"$ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"#/definitions/criterion"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="nl">"solution_validity"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"$ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"#/definitions/criterion"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="nl">"mathematical_clarity"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"$ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"#/definitions/criterion"</span><span class="w"> </span><span class="p">},</span><span class="w">

    </span><span class="nl">"image_text_alignment"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"$ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"#/definitions/criterion"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="nl">"visual_safety"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"$ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"#/definitions/criterion"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="nl">"informativeness"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"$ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"#/definitions/criterion"</span><span class="w"> </span><span class="p">},</span><span class="w">

    </span><span class="nl">"overall_average"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"number"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Mean of all present dimension scores, rounded to 2 decimals"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"required"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"fluency"</span><span class="p">,</span><span class="s2">"coherence"</span><span class="p">,</span><span class="s2">"factuality"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"instruction_relevance"</span><span class="p">,</span><span class="s2">"safety"</span><span class="p">,</span><span class="s2">"conciseness"</span><span class="p">,</span><span class="s2">"overall_average"</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"definitions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"criterion"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"object"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"score"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"integer"</span><span class="p">,</span><span class="w"> </span><span class="nl">"minimum"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nl">"maximum"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="nl">"explanation"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w"> </span><span class="p">}</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"required"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"score"</span><span class="p">,</span><span class="s2">"explanation"</span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"additionalProperties"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<ul>
  <li>
    <p><strong>Notes:</strong></p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">executability</code>, <code class="language-plaintext highlighter-rouge">functional_correctness</code>, <code class="language-plaintext highlighter-rouge">readability_style</code> are included only for <strong>code samples</strong>.</li>
      <li><code class="language-plaintext highlighter-rouge">step_correctness</code>, <code class="language-plaintext highlighter-rouge">solution_validity</code>, <code class="language-plaintext highlighter-rouge">mathematical_clarity</code> are included only for <strong>math samples</strong>.</li>
      <li><code class="language-plaintext highlighter-rouge">image_text_alignment</code>, <code class="language-plaintext highlighter-rouge">visual_safety</code>, <code class="language-plaintext highlighter-rouge">informativeness</code> are included only for <strong>multimodal samples</strong>.</li>
      <li><code class="language-plaintext highlighter-rouge">overall_average</code> is computed dynamically from all scored fields present.</li>
    </ul>
  </li>
</ul>

<h2 id="human-evaluation">Human Evaluation</h2>

<ul>
  <li>
    <p><strong>Human evaluation is the gold standard</strong> for data quality filtering. While rule-based and LLM-based filters can scale to billions of examples, only humans can reliably detect subtle issues of <strong>meaning, cultural context, ethics, and domain-specific correctness</strong>.</p>
  </li>
  <li>
    <p>Because of its cost, human evaluation is best used for:</p>

    <ul>
      <li>high-stakes post-training datasets (SFT, RLHF),</li>
      <li>creating gold-standard calibration sets,</li>
      <li>and validating/benchmarking automated evaluators.</li>
    </ul>
  </li>
</ul>

<h3 id="role-of-human-evaluation-in-filtering-pipelines">Role of Human Evaluation in Filtering Pipelines</h3>

<ul>
  <li>
    <p>Human evaluation is usually applied at three points:</p>

    <ol>
      <li><strong>Seeding</strong>: create small high-quality datasets used to bootstrap instruction tuning or preference models.</li>
      <li><strong>Calibration</strong>: label a stratified sample to measure precision/recall of LLM-based and heuristic filters.</li>
      <li><strong>Adjudication</strong>: resolve disagreements between LLM judges or detect failure cases they miss.</li>
    </ol>
  </li>
  <li>
    <p>This aligns with best practice:</p>

    <p><strong>Cheap heuristics → LLM evaluators → human gold sets</strong> for calibration.</p>
  </li>
</ul>

<h3 id="core-evaluation-dimensions-for-humans">Core Evaluation Dimensions for Humans</h3>

<ul>
  <li>Humans assess the same core dimensions as LLMs, but more reliably and with richer context:</li>
</ul>

<div align="center">
<table class="tg">
<thead>
<tr>
<th class="tg-hcenter-valign-first"><strong>Dimension</strong></th>
<th class="tg-hcenter-valign-second"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tg-tleft-valign-first">Fluency / Grammaticality</td>
<td class="tg-tleft-valign-second">Is the text/code/math well-formed and natural?</td>
</tr>
<tr>
<td class="tg-tleft-valign-first">Coherence / Logical Flow</td>
<td class="tg-tleft-valign-second">Do the ideas or reasoning steps connect and flow logically?</td>
</tr>
<tr>
<td class="tg-tleft-valign-first">Factuality / Correctness</td>
<td class="tg-tleft-valign-second">Are all statements or answers true and verifiable?</td>
</tr>
<tr>
<td class="tg-tleft-valign-first">Instruction-Following</td>
<td class="tg-tleft-valign-second">Does the response fully and directly answer the prompt?</td>
</tr>
<tr>
<td class="tg-tleft-valign-first">Relevance</td>
<td class="tg-tleft-valign-second">Is the content on-topic and task-appropriate?</td>
</tr>
<tr>
<td class="tg-tleft-valign-first">Safety / Harmfulness</td>
<td class="tg-tleft-valign-second">Does it avoid toxic, biased, or policy-violating content?</td>
</tr>
<tr>
<td class="tg-tleft-valign-first">Clarity / Conciseness</td>
<td class="tg-tleft-valign-second">Is it clearly expressed and free of verbosity or ambiguity?</td>
</tr>
</tbody>
</table>
</div>

<ul>
  <li>Humans can also detect <strong>biases, stereotypes, and subtle harms</strong> that automated filters often miss.</li>
</ul>

<h3 id="modality-specific-human-evaluation">Modality-Specific Human Evaluation</h3>

<h4 id="text-1">Text</h4>

<ul>
  <li>Judge grammar, style, clarity, logical structure, and factual accuracy.</li>
  <li>Identify subtle misinformation or hallucinated claims.</li>
</ul>

<h4 id="code-1">Code</h4>

<ul>
  <li>Run code in a sandbox to verify functional correctness.</li>
  <li>Assess readability, structure, and adherence to style/conventions.</li>
  <li>Detect potentially unsafe or malicious patterns.</li>
</ul>

<h4 id="math-1">Math</h4>

<ul>
  <li>Verify each reasoning step and the final result.</li>
  <li>Evaluate clarity and logical flow of derivations.</li>
</ul>

<h4 id="multimodal-1">Multimodal</h4>

<ul>
  <li>Check semantic alignment between image/video and text (caption matches image content).</li>
  <li>Identify unsafe or sensitive visual content.</li>
  <li>Evaluate informativeness and relevance of the pair.</li>
</ul>

<h3 id="quality-control-for-human-ratings">Quality Control for Human Ratings</h3>

<ul>
  <li>
    <p>Because human annotation is itself noisy, strong QC is crucial:</p>

    <ul>
      <li><strong>Rater training:</strong> Provide rubrics with concrete examples per dimension.</li>
      <li><strong>Inter-rater reliability:</strong> Track agreement with metrics like <strong>Cohen’s <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-26-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03BA;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-279" style="width: 0.726em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.571em; height: 0px; font-size: 121%;"><span style="position: absolute; clip: rect(1.552em, 1000.57em, 2.327em, -999.997em); top: -2.167em; left: 0em;"><span class="mrow" id="MathJax-Span-280"><span class="mi" id="MathJax-Span-281" style="font-family: STIXGeneral-Italic;">κ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.172em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>κ</mi></math></span></span><script type="math/tex" id="MathJax-Element-26">\kappa</script></strong> or <strong>Krippendorff’s <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-27-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-282" style="width: 0.777em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.622em; height: 0px; font-size: 121%;"><span style="position: absolute; clip: rect(1.552em, 1000.62em, 2.327em, -999.997em); top: -2.167em; left: 0em;"><span class="mrow" id="MathJax-Span-283"><span class="mi" id="MathJax-Span-284" style="font-family: STIXGeneral-Italic;">α</span></span><span style="display: inline-block; width: 0px; height: 2.172em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>α</mi></math></span></span><script type="math/tex" id="MathJax-Element-27">\alpha</script></strong>.</li>
      <li><strong>Gold checks:</strong> Inject known examples to monitor rater accuracy.</li>
      <li><strong>Multiple raters:</strong> Assign 2–5 raters per item and aggregate via majority vote or averaging.</li>
    </ul>
  </li>
  <li>
    <p>You can see example rating protocols from <a href="https://openai.com/research/learning-from-human-feedback">OpenAI’s RLHF blog</a> and <a href="https://www.anthropic.com/news/constitutional-ai">Anthropic’s HH-RLHF work</a>.</p>
  </li>
</ul>

<h3 id="cost-and-scalability">Cost and Scalability</h3>

<ul>
  <li>
    <p>Human evaluation is expensive and slow, so apply it sparingly:</p>

    <ul>
      <li>small critical datasets,</li>
      <li>periodic audits of larger sets,</li>
      <li>and calibration of LLM-based scores.</li>
    </ul>
  </li>
  <li>
    <p>Common approach:</p>

    <ul>
      <li><strong>Human-label a small set → train/prompt LLM-evaluator on it → run LLM-evaluator over large corpus.</strong></li>
    </ul>
  </li>
  <li>
    <p>This gives the scalability of LLM evaluation while retaining human-level quality calibration.</p>
  </li>
</ul>

<h2 id="outlier-detection-via-island-analysis-of-embeddings">Outlier Detection Via “Island” Analysis of Embeddings</h2>

<ul>
  <li>
    <p>Even after applying quality, compliance, and evaluator-based filters, datasets often contain <strong>semantic outliers</strong>: small clusters or singletons far from the main data manifold. These may represent:</p>

    <ul>
      <li>adversarial or poisoned examples,</li>
      <li>data from the wrong domain or language,</li>
      <li>hallucinated or nonsensical generations,</li>
      <li>or simply very rare styles that could destabilize training.</li>
    </ul>
  </li>
  <li>
    <p>Outlier detection is typically done <strong>without labels</strong>, using unsupervised methods on <strong>embeddings</strong> of the data.</p>
  </li>
</ul>

<h3 id="embedding-extraction">Embedding Extraction</h3>

<ul>
  <li>
    <p>Use a pretrained encoder to generate fixed-size vector embeddings for each sample.</p>

    <ul>
      <li>For text: <a href="https://platform.openai.com/docs/guides/embeddings">OpenAI text-embedding-3-large</a>, <a href="https://huggingface.co/hkunlp/instructor-xl">Instructor-XL</a>, or <a href="https://www.sbert.net/">Sentence-BERT</a>.</li>
      <li>For code: <a href="https://huggingface.co/microsoft/codebert-base">CodeBERT</a>, <a href="https://platform.openai.com/docs/guides/embeddings">OpenAI ada-code-embeddings</a>.</li>
      <li>For math: encode serialized LaTeX or use math-specific text embeddings.</li>
      <li>For multimodal: joint vision-language models like <a href="https://github.com/openai/CLIP">CLIP</a>.</li>
    </ul>
  </li>
  <li>
    <p>Let each sample <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-28-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-285" style="width: 0.888em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.732em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.565em, 1000.73em, 2.451em, -999.997em); top: -2.133em; left: 0em;"><span class="mrow" id="MathJax-Span-286"><span class="msubsup" id="MathJax-Span-287"><span style="display: inline-block; position: relative; width: 0.732em; height: 0px;"><span style="position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-288" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.852em; left: 0.471em;"><span class="mi" id="MathJax-Span-289" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.138em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.816em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>x</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-28">x_i</script> have an embedding <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-29-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;e&lt;/mi&gt;&lt;/mrow&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;msup&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;double-struck&quot;&gt;R&lt;/mi&gt;&lt;/mrow&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-290" style="width: 3.753em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.128em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.201em, 1003.13em, 2.555em, -999.997em); top: -2.237em; left: 0em;"><span class="mrow" id="MathJax-Span-291"><span class="msubsup" id="MathJax-Span-292"><span style="display: inline-block; position: relative; width: 0.732em; height: 0px;"><span style="position: absolute; clip: rect(3.388em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span class="texatom" id="MathJax-Span-293"><span class="mrow" id="MathJax-Span-294"><span class="mi" id="MathJax-Span-295" style="font-family: STIXGeneral; font-weight: bold;">e</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.852em; left: 0.471em;"><span class="mi" id="MathJax-Span-296" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-297" style="font-family: STIXGeneral-Regular; padding-left: 0.315em;">∈</span><span class="msubsup" id="MathJax-Span-298" style="padding-left: 0.315em;"><span style="display: inline-block; position: relative; width: 1.201em; height: 0px;"><span style="position: absolute; clip: rect(3.18em, 1000.73em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span class="texatom" id="MathJax-Span-299"><span class="mrow" id="MathJax-Span-300"><span class="mi" id="MathJax-Span-301" style="font-family: STIXGeneral-Regular;">ℝ</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -4.372em; left: 0.732em;"><span class="mi" id="MathJax-Span-302" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.242em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">e</mi></mrow><mi>i</mi></msub><mo>∈</mo><msup><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="double-struck">R</mi></mrow><mi>d</mi></msup></math></span></span><script type="math/tex" id="MathJax-Element-29">\mathbf{e}_i \in \mathbb{R}^d</script>.</p>
  </li>
</ul>

<h3 id="dimensionality-reduction">Dimensionality Reduction</h3>

<ul>
  <li>High-dimensional embeddings are hard to cluster directly, so reduce them while preserving structure.</li>
  <li>
    <p>Common tools:</p>

    <ul>
      <li><a href="https://umap-learn.readthedocs.io/en/latest/">UMAP</a>: preserves local topology, great for visualizing manifolds.</li>
      <li><a href="https://lvdmaaten.github.io/tsne/">t-SNE</a>: useful for small datasets.</li>
      <li><a href="https://scikit-learn.org/stable/modules/generated/sklearn.decomposition.PCA.html">PCA</a>: fast linear projection for large datasets.</li>
    </ul>
  </li>
  <li>Formally, project <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-30-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;e&lt;/mi&gt;&lt;/mrow&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-303" style="width: 0.888em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.732em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.513em, 1000.73em, 2.451em, -999.997em); top: -2.133em; left: 0em;"><span class="mrow" id="MathJax-Span-304"><span class="msubsup" id="MathJax-Span-305"><span style="display: inline-block; position: relative; width: 0.732em; height: 0px;"><span style="position: absolute; clip: rect(3.388em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span class="texatom" id="MathJax-Span-306"><span class="mrow" id="MathJax-Span-307"><span class="mi" id="MathJax-Span-308" style="font-family: STIXGeneral; font-weight: bold;">e</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.852em; left: 0.471em;"><span class="mi" id="MathJax-Span-309" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.138em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">e</mi></mrow><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-30">\mathbf{e}_i</script> to <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-31-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;z&lt;/mi&gt;&lt;/mrow&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;msup&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;double-struck&quot;&gt;R&lt;/mi&gt;&lt;/mrow&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-310" style="width: 3.753em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.128em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.201em, 1003.13em, 2.555em, -999.997em); top: -2.237em; left: 0em;"><span class="mrow" id="MathJax-Span-311"><span class="msubsup" id="MathJax-Span-312"><span style="display: inline-block; position: relative; width: 0.732em; height: 0px;"><span style="position: absolute; clip: rect(3.388em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span class="texatom" id="MathJax-Span-313"><span class="mrow" id="MathJax-Span-314"><span class="mi" id="MathJax-Span-315" style="font-family: STIXGeneral; font-weight: bold;">z</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.852em; left: 0.471em;"><span class="mi" id="MathJax-Span-316" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-317" style="font-family: STIXGeneral-Regular; padding-left: 0.315em;">∈</span><span class="msubsup" id="MathJax-Span-318" style="padding-left: 0.315em;"><span style="display: inline-block; position: relative; width: 1.201em; height: 0px;"><span style="position: absolute; clip: rect(3.18em, 1000.73em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span class="texatom" id="MathJax-Span-319"><span class="mrow" id="MathJax-Span-320"><span class="mi" id="MathJax-Span-321" style="font-family: STIXGeneral-Regular;">ℝ</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -4.372em; left: 0.732em;"><span class="mn" id="MathJax-Span-322" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.242em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">z</mi></mrow><mi>i</mi></msub><mo>∈</mo><msup><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="double-struck">R</mi></mrow><mn>2</mn></msup></math></span></span><script type="math/tex" id="MathJax-Element-31">\mathbf{z}_i \in \mathbb{R}^2</script> or <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-32-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;double-struck&quot;&gt;R&lt;/mi&gt;&lt;/mrow&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-323" style="width: 1.461em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.201em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.096em, 1001.2em, 2.294em, -999.997em); top: -2.133em; left: 0em;"><span class="mrow" id="MathJax-Span-324"><span class="msubsup" id="MathJax-Span-325"><span style="display: inline-block; position: relative; width: 1.201em; height: 0px;"><span style="position: absolute; clip: rect(3.18em, 1000.73em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span class="texatom" id="MathJax-Span-326"><span class="mrow" id="MathJax-Span-327"><span class="mi" id="MathJax-Span-328" style="font-family: STIXGeneral-Regular;">ℝ</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -4.372em; left: 0.732em;"><span class="mn" id="MathJax-Span-329" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">3</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.138em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="double-struck">R</mi></mrow><mn>3</mn></msup></math></span></span><script type="math/tex" id="MathJax-Element-32">\mathbb{R}^3</script>:</li>
</ul>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-33-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;z&lt;/mi&gt;&lt;/mrow&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mtext&gt;reduce&lt;/mtext&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;e&lt;/mi&gt;&lt;/mrow&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-330" style="width: 6.721em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.576em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.357em, 1005.52em, 2.555em, -999.997em); top: -2.185em; left: 0em;"><span class="mrow" id="MathJax-Span-331"><span class="msubsup" id="MathJax-Span-332"><span style="display: inline-block; position: relative; width: 0.732em; height: 0px;"><span style="position: absolute; clip: rect(3.388em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span class="texatom" id="MathJax-Span-333"><span class="mrow" id="MathJax-Span-334"><span class="mi" id="MathJax-Span-335" style="font-family: STIXGeneral; font-weight: bold;">z</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.852em; left: 0.471em;"><span class="mi" id="MathJax-Span-336" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-337" style="font-family: STIXGeneral-Regular; padding-left: 0.315em;">=</span><span class="msubsup" id="MathJax-Span-338" style="padding-left: 0.315em;"><span style="display: inline-block; position: relative; width: 2.242em; height: 0px;"><span style="position: absolute; clip: rect(3.18em, 1000.42em, 4.378em, -999.997em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-339" style="font-family: STIXGeneral-Italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.159em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.852em; left: 0.263em;"><span class="texatom" id="MathJax-Span-340"><span class="mrow" id="MathJax-Span-341"><span class="mtext" id="MathJax-Span-342" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">reduce</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-343" style="font-family: STIXGeneral-Regular;">(</span><span class="msubsup" id="MathJax-Span-344"><span style="display: inline-block; position: relative; width: 0.732em; height: 0px;"><span style="position: absolute; clip: rect(3.388em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span class="texatom" id="MathJax-Span-345"><span class="mrow" id="MathJax-Span-346"><span class="mi" id="MathJax-Span-347" style="font-family: STIXGeneral; font-weight: bold;">e</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.852em; left: 0.471em;"><span class="mi" id="MathJax-Span-348" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-349" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.19em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">z</mi></mrow><mi>i</mi></msub><mo>=</mo><msub><mi>f</mi><mrow class="MJX-TeXAtom-ORD"><mtext>reduce</mtext></mrow></msub><mo stretchy="false">(</mo><msub><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">e</mi></mrow><mi>i</mi></msub><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-33">\mathbf{z}_i = f_{\text{reduce}}(\mathbf{e}_i)</script>

<h3 id="clustering-and-outlier-detection">Clustering and Outlier Detection</h3>

<ul>
  <li>
    <p>Apply a density-based clustering algorithm on the reduced space:</p>

    <ul>
      <li><a href="https://scikit-learn.org/stable/modules/generated/sklearn.cluster.DBSCAN.html">DBSCAN</a>: detects sparse outliers as noise.</li>
      <li><a href="https://hdbscan.readthedocs.io/en/latest/">HDBSCAN</a>: hierarchical version, handles variable densities.</li>
      <li>KNN-distance based methods (local outlier factor, isolation forests).</li>
    </ul>
  </li>
  <li>
    <p>Let <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-34-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-350" style="width: 0.94em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.305em, 1000.78em, 2.451em, -999.997em); top: -2.133em; left: 0em;"><span class="mrow" id="MathJax-Span-351"><span class="msubsup" id="MathJax-Span-352"><span style="display: inline-block; position: relative; width: 0.784em; height: 0px;"><span style="position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-353" style="font-family: STIXGeneral-Italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.055em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.852em; left: 0.523em;"><span class="mi" id="MathJax-Span-354" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.138em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>d</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-34">d_i</script> be the distance from point <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-35-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-355" style="width: 0.315em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.263em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.357em, 1000.26em, 2.346em, -999.997em); top: -2.185em; left: 0em;"><span class="mrow" id="MathJax-Span-356"><span class="mi" id="MathJax-Span-357" style="font-family: STIXGeneral-Italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.19em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-35">i</script> to its k-nearest neighbors. Mark <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-36-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-358" style="width: 0.888em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.732em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.565em, 1000.73em, 2.451em, -999.997em); top: -2.133em; left: 0em;"><span class="mrow" id="MathJax-Span-359"><span class="msubsup" id="MathJax-Span-360"><span style="display: inline-block; position: relative; width: 0.732em; height: 0px;"><span style="position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-361" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.852em; left: 0.471em;"><span class="mi" id="MathJax-Span-362" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.138em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.816em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>x</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-36">x_i</script> as an outlier if:</p>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-37-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mfrac&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/mfrac&gt;&lt;munderover&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/mrow&gt;&lt;/munderover&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;&amp;#x2016;&lt;/mo&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;z&lt;/mi&gt;&lt;/mrow&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;z&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mtext&gt;NN&lt;/mtext&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;&amp;#x2016;&lt;/mo&gt;&lt;mo&gt;&amp;gt;&lt;/mo&gt;&lt;mi&gt;&amp;#x03C4;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-363" style="width: 10.003em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.336em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(0.263em, 1008.34em, 3.753em, -999.997em); top: -2.185em; left: 0em;"><span class="mrow" id="MathJax-Span-364"><span class="mfrac" id="MathJax-Span-365"><span style="display: inline-block; position: relative; width: 0.628em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;"><span style="position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;"><span class="mn" id="MathJax-Span-366" style="font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.18em, 1000.47em, 4.169em, -999.997em); top: -3.331em; left: 50%; margin-left: -0.206em;"><span class="mi" id="MathJax-Span-367" style="font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(0.836em, 1000.63em, 1.201em, -999.997em); top: -1.247em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.628em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span><span class="munderover" id="MathJax-Span-368" style="padding-left: 0.211em;"><span style="display: inline-block; position: relative; width: 1.305em; height: 0px;"><span style="position: absolute; clip: rect(2.867em, 1001.2em, 4.638em, -999.997em); top: -4.008em; left: 0em;"><span class="mo" id="MathJax-Span-369" style="font-family: STIXSizeOneSym; vertical-align: -0.518em;">∑</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.388em, 1000.94em, 4.43em, -999.997em); top: -2.862em; left: 0.107em;"><span class="texatom" id="MathJax-Span-370"><span class="mrow" id="MathJax-Span-371"><span class="mi" id="MathJax-Span-372" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-373" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">=</span><span class="mn" id="MathJax-Span-374" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.284em, 1000.32em, 4.169em, -999.997em); top: -5.206em; left: 0.471em;"><span class="texatom" id="MathJax-Span-375"><span class="mrow" id="MathJax-Span-376"><span class="mi" id="MathJax-Span-377" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-378" style="font-family: STIXGeneral-Regular; padding-left: 0.211em;">‖</span><span class="msubsup" id="MathJax-Span-379"><span style="display: inline-block; position: relative; width: 0.732em; height: 0px;"><span style="position: absolute; clip: rect(3.388em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span class="texatom" id="MathJax-Span-380"><span class="mrow" id="MathJax-Span-381"><span class="mi" id="MathJax-Span-382" style="font-family: STIXGeneral; font-weight: bold;">z</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.852em; left: 0.471em;"><span class="mi" id="MathJax-Span-383" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-384" style="font-family: STIXGeneral-Regular; padding-left: 0.263em;">−</span><span class="msubsup" id="MathJax-Span-385" style="padding-left: 0.263em;"><span style="display: inline-block; position: relative; width: 1.721em; height: 0px;"><span style="position: absolute; clip: rect(3.388em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span class="texatom" id="MathJax-Span-386"><span class="mrow" id="MathJax-Span-387"><span class="mi" id="MathJax-Span-388" style="font-family: STIXGeneral; font-weight: bold;">z</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.852em; left: 0.471em;"><span class="texatom" id="MathJax-Span-389"><span class="mrow" id="MathJax-Span-390"><span class="msubsup" id="MathJax-Span-391"><span style="display: inline-block; position: relative; width: 1.201em; height: 0px;"><span style="position: absolute; clip: rect(3.388em, 1000.99em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span class="mtext" id="MathJax-Span-392" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">NN</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.904em; left: 1.044em;"><span class="mi" id="MathJax-Span-393" style="font-size: 50%; font-family: STIXGeneral-Italic;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-394" style="font-family: STIXGeneral-Regular;">‖</span><span class="mo" id="MathJax-Span-395" style="font-family: STIXGeneral-Regular; padding-left: 0.315em;">&gt;</span><span class="mi" id="MathJax-Span-396" style="font-family: STIXGeneral-Italic; padding-left: 0.315em;">τ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.19em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.747em; border-left: 0px solid; width: 0px; height: 3.941em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mfrac><mn>1</mn><mi>k</mi></mfrac><munderover><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mrow class="MJX-TeXAtom-ORD"><mi>k</mi></mrow></munderover><mo fence="false" stretchy="false">‖</mo><msub><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">z</mi></mrow><mi>i</mi></msub><mo>−</mo><msub><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">z</mi></mrow><mrow class="MJX-TeXAtom-ORD"><msub><mtext>NN</mtext><mi>j</mi></msub></mrow></msub><mo fence="false" stretchy="false">‖</mo><mo>&gt;</mo><mi>τ</mi></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-37">\frac{1}{k} \sum_{j=1}^{k} \| \mathbf{z}_i - \mathbf{z}_{\text{NN}_j}\| > \tau</script>

    <ul>
      <li>where <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-38-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03C4;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-397" style="width: 0.576em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.471em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.617em, 1000.47em, 2.346em, -999.997em); top: -2.185em; left: 0em;"><span class="mrow" id="MathJax-Span-398"><span class="mi" id="MathJax-Span-399" style="font-family: STIXGeneral-Italic;">τ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.19em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.628em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>τ</mi></math></span></span><script type="math/tex" id="MathJax-Element-38">\tau</script> is a distance threshold set from the distribution tail (e.g. 95th percentile).</li>
    </ul>
  </li>
</ul>

<h3 id="visual-island-analysis">Visual Island Analysis</h3>

<ul>
  <li>Visualize clusters in 2D (after UMAP/t-SNE) and label dense regions as <strong>core data</strong>, sparse isolated points as <strong>outliers</strong>.</li>
  <li>
    <p>Outlier points are often:</p>

    <ul>
      <li>mislabeled,</li>
      <li>in the wrong language/domain,</li>
      <li>adversarial or gibberish.</li>
    </ul>
  </li>
  <li>This method is <strong>modality-agnostic</strong>: any data type that can be embedded can be checked for outlier islands.</li>
</ul>

<h3 id="benefits-and-limitations">Benefits and Limitations</h3>

<ul>
  <li>
    <p><strong>Benefits</strong>:</p>

    <ul>
      <li>Detects rare harmful data missed by surface metrics.</li>
      <li>Works without labels.</li>
      <li>Naturally identifies domain boundaries.</li>
    </ul>
  </li>
  <li>
    <p><strong>Limitations</strong>:</p>

    <ul>
      <li>Requires embedding model coverage of the data domain.</li>
      <li>Computationally heavy on very large datasets (typically done on stratified samples).</li>
      <li>Choice of distance threshold <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-39-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03C4;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-400" style="width: 0.576em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.471em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.617em, 1000.47em, 2.346em, -999.997em); top: -2.185em; left: 0em;"><span class="mrow" id="MathJax-Span-401"><span class="mi" id="MathJax-Span-402" style="font-family: STIXGeneral-Italic;">τ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.19em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.628em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>τ</mi></math></span></span><script type="math/tex" id="MathJax-Element-39">\tau</script> can affect sensitivity.</li>
    </ul>
  </li>
</ul>

<h2 id="prompt-quality-metrics">Prompt Quality Metrics</h2>

<ul>
  <li>
    <p>High-quality <strong>prompts</strong> are essential for post-training datasets (e.g. SFT, preference modeling, RLHF). Poor prompt quality causes:</p>

    <ul>
      <li>ambiguous supervision signals,</li>
      <li>spurious behaviors from models,</li>
      <li>and misalignment of downstream evaluation.</li>
    </ul>
  </li>
  <li>Prompt quality evaluation focuses on <strong>prompt clarity and design</strong>, not the correctness of model responses.</li>
  <li>It is complementary to filtering responses and is often done via <strong>LLM-based eval</strong> or <strong>human raters</strong>.</li>
</ul>

<h3 id="core-prompt-quality-dimensions">Core Prompt Quality Dimensions</h3>

<ul>
  <li>Here are the most commonly used dimensions:</li>
</ul>

<div align="center">
<table class="tg">
<thead>
<tr>
<th class="tg-hcenter-valign-first"><strong>Dimension</strong></th>
<th class="tg-hcenter-valign-second"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tg-tleft-valign-first">Clarity</td>
<td class="tg-tleft-valign-second">Is the prompt unambiguous, grammatically correct, and easy to understand?</td>
</tr>
<tr>
<td class="tg-tleft-valign-first">Coherence</td>
<td class="tg-tleft-valign-second">Are all parts of the prompt consistent and logically connected?</td>
</tr>
<tr>
<td class="tg-tleft-valign-first">Relevance</td>
<td class="tg-tleft-valign-second">Is the prompt relevant to the intended domain or instruction-following tasks?</td>
</tr>
<tr>
<td class="tg-tleft-valign-first">Complexity</td>
<td class="tg-tleft-valign-second">Does it require nontrivial reasoning or knowledge, but not overly convoluted?</td>
</tr>
<tr>
<td class="tg-tleft-valign-first">Specificity</td>
<td class="tg-tleft-valign-second">Is it specific enough to elicit a well-scoped response (not vague or underspecified)?</td>
</tr>
<tr>
<td class="tg-tleft-valign-first">Safety</td>
<td class="tg-tleft-valign-second">Is it free from harmful, unsafe, biased, or policy-violating content?</td>
</tr>
<tr>
<td class="tg-tleft-valign-first">Diversity (optional)</td>
<td class="tg-tleft-valign-second">Is it novel and distinct from many existing prompts (avoids near-duplicates)?</td>
</tr>
</tbody>
</table>
</div>

<ul>
  <li>These can be scored on a <strong>5-point Likert scale</strong> to enable aggregation.</li>
</ul>

<h3 id="example-evaluation-prompt-with-rubrics-and-examples">Example Evaluation Prompt (with Rubrics and Examples)</h3>

<ul>
  <li>
    <p>Below is a <strong>ready-to-use prompt</strong> for evaluating prompt quality that includes:</p>

    <ul>
      <li>clear instructions to an evaluator (human or LLM),</li>
      <li>Likert-scale rubrics for each criterion,</li>
      <li>and good/bad examples for every criterion (to ground judgment and improve reliability).</li>
    </ul>
  </li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><div><button class="btn-copy" data-clipboard-action="copy" data-clipboard-target="#code3"><img src="https://aman.ai/images/copy.png" style="margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;"></button></div><code id="code3">You are an expert data quality evaluator. 
Your task is to rate the quality of the following PROMPT according to several dimensions. 
For each dimension, give a 1–5 Likert score using the rubric and refer to the good/bad examples provided. 
Then give a short explanation (&lt;20 words) for each score. 
Finally, output your ratings in structured JSON.

PROMPT TO EVALUATE:
""

---

EVALUATION DIMENSIONS, RUBRICS, AND EXAMPLES

1. Clarity
Definition: Is the language clear, grammatical, and understandable to a general reader?

Rubric:
1 - Completely unclear, nonsensical.
2 - Many grammatical errors, hard to follow.
3 - Understandable but awkward or ambiguous.
4 - Clear with minor issues.
5 - Very clear, precise, and polished.

Good Example: "Explain the concept of photosynthesis to a 10-year-old." (Score: 5)
Bad Example: "Photosntheses explan kid ok?" (Score: 1)

---

2. Coherence
Definition: Are all parts of the prompt logically connected and consistent?

Rubric:
1 - Contradictory or disjointed.
2 - Major logical gaps.
3 - Somewhat coherent but loosely connected.
4 - Mostly coherent with small gaps.
5 - Fully logical and internally consistent.

Good Example: "Summarize this article and then give three discussion questions about it." (Score: 5)
Bad Example: "Summarize this article. Now ignore it and write a poem unrelated to it." (Score: 1)

---

3. Relevance
Definition: Is the prompt relevant for the dataset’s task/domain?

Rubric:
1 - Completely unrelated or off-topic.
2 - Mostly irrelevant.
3 - Somewhat relevant.
4 - Mostly relevant.
5 - Fully on-topic and appropriate.

Good Example: "Write a SQL query to count users per country." (Score: 5)
Bad Example: "Describe your favorite color" in a coding dataset. (Score: 1)

---

4. Complexity
Definition: Does it require nontrivial reasoning or knowledge (but not overly convoluted)?

Rubric:
1 - Trivial or no reasoning required.
2 - Very simple.
3 - Moderate reasoning.
4 - Substantial reasoning and synthesis.
5 - Complex multi-step reasoning or domain knowledge.

Good Example: "Compare the economic impacts of renewable vs nuclear energy in the EU." (Score: 5)
Bad Example: "What is 2+2?" (Score: 1)

---

5. Specificity
Definition: Is the task scope well-defined and not vague?

Rubric:
1 - Very vague or open-ended.
2 - Somewhat vague.
3 - Moderately specific.
4 - Well-scoped with minor ambiguity.
5 - Very precise and well-scoped.

Good Example: "List three causes of the French Revolution with dates and key figures." (Score: 5)
Bad Example: "Tell me something about history." (Score: 1)

---

6. Safety
Definition: Is the prompt free from harmful, unsafe, or policy-violating content?

Rubric:
1 - Contains explicit harm or policy violation.
2 - Possibly unsafe, borderline.
3 - Mostly safe but slightly risky.
4 - Safe.
5 - Very safe and benign.

Good Example: "Explain how vaccines work." (Score: 5)
Bad Example: "Explain how to make a bomb." (Score: 1)

---

OUTPUT FORMAT:
{
  "clarity": {"score": &lt;1-5&gt;, "explanation": "&lt;...&gt;"},
  "coherence": {"score": &lt;1-5&gt;, "explanation": "&lt;...&gt;"},
  "relevance": {"score": &lt;1-5&gt;, "explanation": "&lt;...&gt;"},
  "complexity": {"score": &lt;1-5&gt;, "explanation": "&lt;...&gt;"},
  "specificity": {"score": &lt;1-5&gt;, "explanation": "&lt;...&gt;"},
  "safety": {"score": &lt;1-5&gt;, "explanation": "&lt;...&gt;"},
  "overall_average": &lt;mean score rounded to 2 decimals&gt;
}
</code></pre></div></div>

<h3 id="integration-in-filtering-pipelines">Integration in Filtering Pipelines</h3>

<ul>
  <li>Use this prompt with an LLM judge (like GPT-4) to assign scores to prompts.</li>
  <li>Reject prompts that:
    <ul>
      <li>score &lt;3 on safety or clarity, or</li>
      <li>have an overall average below 3.5.</li>
    </ul>
  </li>
  <li>Sample 2–5% for human audit to calibrate scores.</li>
</ul>

<h2 id="safety-metrics">Safety Metrics</h2>

<ul>
  <li>
    <p>Safety filtering aims to <strong>prevent unsafe content from entering training datasets</strong> or <strong>prevent unsafe behavior from being reinforced during post-training</strong>. This is especially crucial for alignment datasets (SFT, preference, RLHF), where unsafe examples can directly shape model behavior.</p>
  </li>
  <li>
    <p>In safety evaluation, we typically measure:</p>

    <ul>
      <li><strong>content safety</strong> (is the content itself safe), and</li>
      <li><strong>model refusal behavior</strong> (does the model respond or refuse appropriately).</li>
    </ul>
  </li>
</ul>

<h3 id="content-safety-classification">Content Safety Classification</h3>

<ul>
  <li>
    <p>At the data ingestion stage, each sample (prompt or response) can be scored for <strong>category-specific risk</strong> using a safety classifier. Typical categories include:</p>

    <ul>
      <li>hate/harassment,</li>
      <li>sexual content (esp. involving minors),</li>
      <li>self-harm,</li>
      <li>violence or gore,</li>
      <li>illegal/dangerous content,</li>
      <li>privacy violations (PII leaks),</li>
      <li>political/medical misinfo (if in-scope).</li>
    </ul>
  </li>
  <li>
    <p><strong>Common tools:</strong></p>

    <ul>
      <li><a href="https://platform.openai.com/docs/guides/moderation">OpenAI moderation API</a></li>
      <li><a href="https://github.com/meta-llama/llama-guard">LLaMA-Guard</a></li>
      <li><a href="https://perspectiveapi.com/">Perspective</a> (for toxicity)</li>
    </ul>
  </li>
  <li>
    <p>Each sample gets a probability vector <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-40-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;p&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mtext&gt;cat&lt;/mtext&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-403" style="width: 1.773em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.461em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.513em, 1001.46em, 2.555em, -999.997em); top: -2.133em; left: 0em;"><span class="mrow" id="MathJax-Span-404"><span class="msubsup" id="MathJax-Span-405"><span style="display: inline-block; position: relative; width: 1.461em; height: 0px;"><span style="position: absolute; clip: rect(3.388em, 1000.52em, 4.378em, -999.997em); top: -4.008em; left: 0em;"><span class="texatom" id="MathJax-Span-406"><span class="mrow" id="MathJax-Span-407"><span class="mi" id="MathJax-Span-408" style="font-family: STIXGeneral; font-weight: bold;">p</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.747em; left: 0.576em;"><span class="texatom" id="MathJax-Span-409"><span class="mrow" id="MathJax-Span-410"><span class="mtext" id="MathJax-Span-411" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">cat</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.138em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">p</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mtext>cat</mtext></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-40">\mathbf{p}_{\text{cat}}</script> over categories; anything exceeding a category threshold <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-41-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03C4;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-412" style="width: 0.576em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.471em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.617em, 1000.47em, 2.346em, -999.997em); top: -2.185em; left: 0em;"><span class="mrow" id="MathJax-Span-413"><span class="mi" id="MathJax-Span-414" style="font-family: STIXGeneral-Italic;">τ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.19em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.628em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>τ</mi></math></span></span><script type="math/tex" id="MathJax-Element-41">\tau</script> is removed or flagged for human review.</p>
  </li>
</ul>

<h3 id="measuring-refusal-behavior-over--vs-under-punting">Measuring Refusal Behavior: Over- Vs Under-Punting</h3>

<ul>
  <li>In addition to classifying the content, we must evaluate <strong>how the model responds to prompts with varying safety levels.</strong></li>
  <li>
    <p>Here we define:</p>

    <ul>
      <li><strong>Over-punting (False Positive Rate)</strong>: The model refuses <strong>safe prompts</strong> incorrectly.</li>
      <li><strong>Under-punting (False Negative Rate)</strong>: The model answers <strong>unsafe prompts</strong> instead of refusing.</li>
    </ul>
  </li>
  <li>
    <p>Formally, let:</p>

    <ul>
      <li><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-42-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;{&lt;/mo&gt;&lt;mtext&gt;safe&lt;/mtext&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mtext&gt;unsafe&lt;/mtext&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;}&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-415" style="width: 8.857em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.346em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.409em, 1007.24em, 2.607em, -999.997em); top: -2.237em; left: 0em;"><span class="mrow" id="MathJax-Span-416"><span class="mi" id="MathJax-Span-417" style="font-family: STIXGeneral-Italic;">y</span><span class="mo" id="MathJax-Span-418" style="font-family: STIXGeneral-Regular; padding-left: 0.315em;">∈</span><span class="mo" id="MathJax-Span-419" style="font-family: STIXGeneral-Regular; padding-left: 0.315em;">{</span><span class="mtext" id="MathJax-Span-420" style="font-family: STIXGeneral-Regular;">safe</span><span class="mo" id="MathJax-Span-421" style="font-family: STIXGeneral-Regular;">,</span><span class="mtext" id="MathJax-Span-422" style="font-family: STIXGeneral-Regular; padding-left: 0.211em;">unsafe</span><span class="mo" id="MathJax-Span-423" style="font-family: STIXGeneral-Regular;">}</span></span><span style="display: inline-block; width: 0px; height: 2.242em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>y</mi><mo>∈</mo><mo fence="false" stretchy="false">{</mo><mtext>safe</mtext><mo>,</mo><mtext>unsafe</mtext><mo fence="false" stretchy="false">}</mo></math></span></span><script type="math/tex" id="MathJax-Element-42">y \in \{\text{safe}, \text{unsafe}\}</script> be ground truth class of a prompt.</li>
      <li><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-43-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x005E;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;{&lt;/mo&gt;&lt;mtext&gt;refuse&lt;/mtext&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mtext&gt;answer&lt;/mtext&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;}&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-424" style="width: 10.003em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.336em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.357em, 1008.23em, 2.555em, -999.997em); top: -2.237em; left: 0em;"><span class="mrow" id="MathJax-Span-425"><span class="texatom" id="MathJax-Span-426"><span class="mrow" id="MathJax-Span-427"><span class="munderover" id="MathJax-Span-428"><span style="display: inline-block; position: relative; width: 0.419em; height: 0px;"><span style="position: absolute; clip: rect(3.44em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-429" style="font-family: STIXGeneral-Italic;">r<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -4.06em; left: 0.107em;"><span style="height: 0em; vertical-align: 0em; width: 0.367em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-430" style="font-family: STIXGeneral-Regular;">̂&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.258em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-431" style="font-family: STIXGeneral-Regular; padding-left: 0.315em;">∈</span><span class="mo" id="MathJax-Span-432" style="font-family: STIXGeneral-Regular; padding-left: 0.315em;">{</span><span class="mtext" id="MathJax-Span-433" style="font-family: STIXGeneral-Regular;">refuse</span><span class="mo" id="MathJax-Span-434" style="font-family: STIXGeneral-Regular;">,</span><span class="mtext" id="MathJax-Span-435" style="font-family: STIXGeneral-Regular; padding-left: 0.211em;">answer</span><span class="mo" id="MathJax-Span-436" style="font-family: STIXGeneral-Regular;">}</span></span><span style="display: inline-block; width: 0px; height: 2.242em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mover><mi>r</mi><mo stretchy="false">^</mo></mover></mrow><mo>∈</mo><mo fence="false" stretchy="false">{</mo><mtext>refuse</mtext><mo>,</mo><mtext>answer</mtext><mo fence="false" stretchy="false">}</mo></math></span></span><script type="math/tex" id="MathJax-Element-43">\hat{r} \in \{\text{refuse}, \text{answer}\}</script> be the model’s action.</li>
    </ul>
  </li>
  <li>
    <p>Then:</p>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-44-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mtext&gt;OverPunt (FPR)&lt;/mtext&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x0023;&lt;/mi&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;{&lt;/mo&gt;&lt;mtext&gt;safe&lt;/mtext&gt;&lt;mo&gt;&amp;#x2227;&lt;/mo&gt;&lt;mtext&gt;refuse&lt;/mtext&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;}&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x0023;&lt;/mi&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;{&lt;/mo&gt;&lt;mtext&gt;safe&lt;/mtext&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;}&lt;/mo&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-437" style="width: 17.659em; display: inline-block;"><span style="display: inline-block; position: relative; width: 14.69em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(0.68em, 1014.69em, 3.232em, -999.997em); top: -2.185em; left: 0em;"><span class="mrow" id="MathJax-Span-438"><span class="mtext" id="MathJax-Span-439" style="font-family: STIXGeneral-Regular;">OverPunt (FPR)</span><span class="mo" id="MathJax-Span-440" style="font-family: STIXGeneral-Regular; padding-left: 0.315em;">=</span><span class="mfrac" id="MathJax-Span-441" style="padding-left: 0.315em;"><span style="display: inline-block; position: relative; width: 6.773em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;"><span style="position: absolute; clip: rect(3.18em, 1006.57em, 4.326em, -999.997em); top: -4.685em; left: 50%; margin-left: -3.331em;"><span class="mrow" id="MathJax-Span-442"><span class="mi" id="MathJax-Span-443" style="font-family: STIXGeneral-Regular;">#</span><span class="mo" id="MathJax-Span-444" style="font-family: STIXGeneral-Regular;">{</span><span class="mtext" id="MathJax-Span-445" style="font-family: STIXGeneral-Regular;">safe</span><span class="mo" id="MathJax-Span-446" style="font-family: STIXGeneral-Regular; padding-left: 0.263em;">∧</span><span class="mtext" id="MathJax-Span-447" style="font-family: STIXGeneral-Regular; padding-left: 0.263em;">refuse</span><span class="mo" id="MathJax-Span-448" style="font-family: STIXGeneral-Regular;">}</span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.18em, 1002.97em, 4.326em, -999.997em); top: -3.331em; left: 50%; margin-left: -1.508em;"><span class="mrow" id="MathJax-Span-449"><span class="mi" id="MathJax-Span-450" style="font-family: STIXGeneral-Regular;">#</span><span class="mo" id="MathJax-Span-451" style="font-family: STIXGeneral-Regular;">{</span><span class="mtext" id="MathJax-Span-452" style="font-family: STIXGeneral-Regular;">safe</span><span class="mo" id="MathJax-Span-453" style="font-family: STIXGeneral-Regular;">}</span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(0.836em, 1006.77em, 1.201em, -999.997em); top: -1.247em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 6.773em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.19em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.122em; border-left: 0px solid; width: 0px; height: 2.816em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtext>OverPunt (FPR)</mtext><mo>=</mo><mfrac><mrow><mi mathvariant="normal">#</mi><mo fence="false" stretchy="false">{</mo><mtext>safe</mtext><mo>∧</mo><mtext>refuse</mtext><mo fence="false" stretchy="false">}</mo></mrow><mrow><mi mathvariant="normal">#</mi><mo fence="false" stretchy="false">{</mo><mtext>safe</mtext><mo fence="false" stretchy="false">}</mo></mrow></mfrac></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-44">\text{OverPunt (FPR)} = \frac{\#\{\text{safe} \land \text{refuse}\}}{\#\{\text{safe}\}}</script>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-45-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mtext&gt;UnderPunt (FNR)&lt;/mtext&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x0023;&lt;/mi&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;{&lt;/mo&gt;&lt;mtext&gt;unsafe&lt;/mtext&gt;&lt;mo&gt;&amp;#x2227;&lt;/mo&gt;&lt;mtext&gt;answer&lt;/mtext&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;}&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x0023;&lt;/mi&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;{&lt;/mo&gt;&lt;mtext&gt;unsafe&lt;/mtext&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;}&lt;/mo&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-454" style="width: 20.159em; display: inline-block;"><span style="display: inline-block; position: relative; width: 16.773em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(0.68em, 1016.77em, 3.232em, -999.997em); top: -2.185em; left: 0em;"><span class="mrow" id="MathJax-Span-455"><span class="mtext" id="MathJax-Span-456" style="font-family: STIXGeneral-Regular;">UnderPunt (FNR)</span><span class="mo" id="MathJax-Span-457" style="font-family: STIXGeneral-Regular; padding-left: 0.315em;">=</span><span class="mfrac" id="MathJax-Span-458" style="padding-left: 0.315em;"><span style="display: inline-block; position: relative; width: 8.18em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;"><span style="position: absolute; clip: rect(3.18em, 1007.97em, 4.326em, -999.997em); top: -4.685em; left: 50%; margin-left: -4.008em;"><span class="mrow" id="MathJax-Span-459"><span class="mi" id="MathJax-Span-460" style="font-family: STIXGeneral-Regular;">#</span><span class="mo" id="MathJax-Span-461" style="font-family: STIXGeneral-Regular;">{</span><span class="mtext" id="MathJax-Span-462" style="font-family: STIXGeneral-Regular;">unsafe</span><span class="mo" id="MathJax-Span-463" style="font-family: STIXGeneral-Regular; padding-left: 0.263em;">∧</span><span class="mtext" id="MathJax-Span-464" style="font-family: STIXGeneral-Regular; padding-left: 0.263em;">answer</span><span class="mo" id="MathJax-Span-465" style="font-family: STIXGeneral-Regular;">}</span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.18em, 1003.96em, 4.326em, -999.997em); top: -3.331em; left: 50%; margin-left: -2.029em;"><span class="mrow" id="MathJax-Span-466"><span class="mi" id="MathJax-Span-467" style="font-family: STIXGeneral-Regular;">#</span><span class="mo" id="MathJax-Span-468" style="font-family: STIXGeneral-Regular;">{</span><span class="mtext" id="MathJax-Span-469" style="font-family: STIXGeneral-Regular;">unsafe</span><span class="mo" id="MathJax-Span-470" style="font-family: STIXGeneral-Regular;">}</span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(0.836em, 1008.18em, 1.201em, -999.997em); top: -1.247em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 8.18em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.19em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.122em; border-left: 0px solid; width: 0px; height: 2.816em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtext>UnderPunt (FNR)</mtext><mo>=</mo><mfrac><mrow><mi mathvariant="normal">#</mi><mo fence="false" stretchy="false">{</mo><mtext>unsafe</mtext><mo>∧</mo><mtext>answer</mtext><mo fence="false" stretchy="false">}</mo></mrow><mrow><mi mathvariant="normal">#</mi><mo fence="false" stretchy="false">{</mo><mtext>unsafe</mtext><mo fence="false" stretchy="false">}</mo></mrow></mfrac></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-45">\text{UnderPunt (FNR)} = \frac{\#\{\text{unsafe} \land \text{answer}\}}{\#\{\text{unsafe}\}}</script>
  </li>
  <li>A good model has <strong>low under-punting (FNR)</strong> while maintaining <strong>reasonably low over-punting (FPR)</strong> to preserve utility.</li>
</ul>

<h3 id="building-a-safety-evaluation-set">Building a Safety Evaluation Set</h3>

<ul>
  <li>Curate or generate a balanced set of <strong>safe vs unsafe prompts</strong>, covering categories above.</li>
  <li>Label each as <strong>safe/unsafe</strong> (binary) using human raters.</li>
  <li>
    <p>Run the model and classify its response as <strong>refuse/answer</strong> using an LLM-based detector or rules (detect refusal phrases).</p>
  </li>
  <li>
    <p>This gives a confusion matrix to compute:</p>

    <ul>
      <li><strong>True Positive Rate (TPR):</strong> correctly refusing unsafe</li>
      <li><strong>False Negative Rate (FNR):</strong> under-punting</li>
      <li><strong>False Positive Rate (FPR):</strong> over-punting</li>
      <li><strong>True Negative Rate (TNR):</strong> correctly answering safe</li>
    </ul>
  </li>
</ul>

<h3 id="integration-in-filtering-pipelines-1">Integration in Filtering Pipelines</h3>

<ul>
  <li>
    <p>Safety metrics can be used at three points:</p>

    <ol>
      <li><strong>Dataset filtering:</strong> remove unsafe prompts/responses via classifiers.</li>
      <li><strong>Post-training eval:</strong> test model refusal behavior on known safe/unsafe sets.</li>
      <li><strong>Alignment tuning:</strong> include examples to correct over- or under-punting biases.</li>
    </ol>
  </li>
  <li>
    <p>Target behavior is <strong>high safety recall with low unnecessary refusals</strong>, i.e. <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-46-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mtext&gt;FNR&lt;/mtext&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2192;&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-471" style="width: 4.898em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.065em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.357em, 1004.07em, 2.346em, -999.997em); top: -2.185em; left: 0em;"><span class="mrow" id="MathJax-Span-472"><span class="mtext" id="MathJax-Span-473" style="font-family: STIXGeneral-Regular;">FNR</span><span class="mo" id="MathJax-Span-474" style="font-family: STIXGeneral-Regular; padding-left: 0.315em;">→</span><span class="mn" id="MathJax-Span-475" style="font-family: STIXGeneral-Regular; padding-left: 0.315em;">0</span></span><span style="display: inline-block; width: 0px; height: 2.19em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>FNR</mtext><mo stretchy="false">→</mo><mn>0</mn></math></span></span><script type="math/tex" id="MathJax-Element-46">\text{FNR} \to 0</script> while keeping <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-47-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mtext&gt;FPR&lt;/mtext&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-476" style="width: 2.138em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.773em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.357em, 1001.77em, 2.346em, -999.997em); top: -2.185em; left: 0em;"><span class="mrow" id="MathJax-Span-477"><span class="mtext" id="MathJax-Span-478" style="font-family: STIXGeneral-Regular;">FPR</span></span><span style="display: inline-block; width: 0px; height: 2.19em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>FPR</mtext></math></span></span><script type="math/tex" id="MathJax-Element-47">\text{FPR}</script> acceptably low (often &lt;5%).</p>
  </li>
</ul>

<h2 id="deduplication">Deduplication</h2>

<ul>
  <li>
    <p>Even after applying quality, safety, and relevance filters, large datasets often contain <strong>duplicate or near-duplicate samples</strong>. Deduplication is a crucial <strong>final step</strong> before training because duplicates:</p>

    <ul>
      <li>distort token distributions and reduce diversity,</li>
      <li>waste training compute on redundant content,</li>
      <li>artificially inflate apparent dataset size (overestimate data coverage),</li>
      <li>and can lead to <strong>memorization of private or test-set content</strong>.</li>
    </ul>
  </li>
  <li>
    <p>Deduplication is therefore performed both at the <strong>document level</strong> and the <strong>span or n-gram level</strong>.</p>
  </li>
</ul>

<h3 id="why-deduplication-comes-after-filtering">Why Deduplication Comes After Filtering</h3>

<ul>
  <li>
    <p>Deduplication is expensive (especially embedding-based methods). If done <strong>before filtering</strong>, you spend resources deduplicating <strong>low-quality content</strong> that would be filtered out anyway.</p>
  </li>
  <li>
    <p><strong>Best practice order:</strong></p>

    <ol>
      <li>Rule-based filters (length, language, perplexity, safety, etc.)</li>
      <li>LLM/human quality filters</li>
      <li>Outlier removal</li>
      <li><strong>Deduplication</strong></li>
    </ol>
  </li>
  <li>
    <p>This ensures only <strong>high-value content</strong> is deduplicated and retained.</p>
  </li>
</ul>

<h3 id="types-of-duplication">Types of Duplication</h3>

<ul>
  <li><strong>Exact duplicates:</strong> byte-identical documents or lines.</li>
  <li><strong>Near-duplicates:</strong> highly overlapping or paraphrased text, code, or math problems.</li>
  <li>
    <p><strong>Partial overlaps:</strong> long documents that share large n-gram spans.</p>
  </li>
  <li>All three reduce diversity and can lead to overfitting, so all need to be removed or downweighted.</li>
</ul>

<h3 id="deduplication-methods">Deduplication Methods</h3>

<h4 id="hash-based-deduplication">Hash-Based Deduplication</h4>

<ul>
  <li>Compute a hash (e.g. SHA-1, MD5) of the raw text.</li>
  <li>Deduplicate exact matches.</li>
  <li>Extremely fast and memory-efficient.</li>
  <li>Common in large text crawls like <a href="https://commoncrawl.org/">Common Crawl</a>.</li>
</ul>

<h4 id="minhash--simhash">MinHash / SimHash</h4>

<ul>
  <li>Use <a href="https://en.wikipedia.org/wiki/MinHash">MinHash</a> or <a href="https://en.wikipedia.org/wiki/SimHash">SimHash</a> to detect approximate overlaps at the n-gram level.</li>
  <li>Robust to small edits, punctuation differences, or formatting changes.</li>
  <li>Popular for web-scale corpora like <a href="https://pile.eleuther.ai/">The Pile</a>.</li>
</ul>

<h4 id="embedding-based-deduplication">Embedding-Based Deduplication</h4>

<ul>
  <li>Encode samples using a semantic embedding model such as <a href="https://platform.openai.com/docs/guides/embeddings">OpenAI text-embedding-3-large</a>, <a href="https://www.sbert.net/">Sentence-BERT</a>, or <a href="https://huggingface.co/hkunlp/instructor-xl">Instructor-XL</a>.</li>
  <li>Compute cosine similarity between embeddings.</li>
  <li>
    <p>Mark pairs as near-duplicates if:</p>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-48-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;e&lt;/mi&gt;&lt;/mrow&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;e&lt;/mi&gt;&lt;/mrow&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;e&lt;/mi&gt;&lt;/mrow&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;e&lt;/mi&gt;&lt;/mrow&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;&amp;#x2016;&lt;/mo&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;e&lt;/mi&gt;&lt;/mrow&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;&amp;#x2016;&lt;/mo&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;&amp;#x2016;&lt;/mo&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;e&lt;/mi&gt;&lt;/mrow&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/msub&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;&amp;#x2016;&lt;/mo&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;mo&gt;&amp;gt;&lt;/mo&gt;&lt;mi&gt;&amp;#x03C4;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-479" style="width: 12.763em; display: inline-block;"><span style="display: inline-block; position: relative; width: 10.628em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(0.784em, 1010.63em, 3.336em, -999.997em); top: -2.185em; left: 0em;"><span class="mrow" id="MathJax-Span-480"><span class="mi" id="MathJax-Span-481" style="font-family: STIXGeneral-Regular;">cos</span><span class="mo" id="MathJax-Span-482"></span><span class="mo" id="MathJax-Span-483" style="font-family: STIXGeneral-Regular;">(</span><span class="msubsup" id="MathJax-Span-484"><span style="display: inline-block; position: relative; width: 0.732em; height: 0px;"><span style="position: absolute; clip: rect(3.388em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span class="texatom" id="MathJax-Span-485"><span class="mrow" id="MathJax-Span-486"><span class="mi" id="MathJax-Span-487" style="font-family: STIXGeneral; font-weight: bold;">e</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.852em; left: 0.471em;"><span class="mi" id="MathJax-Span-488" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-489" style="font-family: STIXGeneral-Regular;">,</span><span class="msubsup" id="MathJax-Span-490" style="padding-left: 0.211em;"><span style="display: inline-block; position: relative; width: 0.732em; height: 0px;"><span style="position: absolute; clip: rect(3.388em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span class="texatom" id="MathJax-Span-491"><span class="mrow" id="MathJax-Span-492"><span class="mi" id="MathJax-Span-493" style="font-family: STIXGeneral; font-weight: bold;">e</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.852em; left: 0.471em;"><span class="mi" id="MathJax-Span-494" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-495" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-496" style="font-family: STIXGeneral-Regular; padding-left: 0.315em;">=</span><span class="mfrac" id="MathJax-Span-497" style="padding-left: 0.315em;"><span style="display: inline-block; position: relative; width: 3.648em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;"><span style="position: absolute; clip: rect(3.388em, 1002.24em, 4.482em, -999.997em); top: -4.789em; left: 50%; margin-left: -1.143em;"><span class="mrow" id="MathJax-Span-498"><span class="msubsup" id="MathJax-Span-499"><span style="display: inline-block; position: relative; width: 0.732em; height: 0px;"><span style="position: absolute; clip: rect(3.388em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span class="texatom" id="MathJax-Span-500"><span class="mrow" id="MathJax-Span-501"><span class="mi" id="MathJax-Span-502" style="font-family: STIXGeneral; font-weight: bold;">e</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.852em; left: 0.471em;"><span class="mi" id="MathJax-Span-503" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-504" style="font-family: STIXGeneral-Regular; padding-left: 0.263em;">⋅</span><span class="msubsup" id="MathJax-Span-505" style="padding-left: 0.263em;"><span style="display: inline-block; position: relative; width: 0.732em; height: 0px;"><span style="position: absolute; clip: rect(3.388em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span class="texatom" id="MathJax-Span-506"><span class="mrow" id="MathJax-Span-507"><span class="mi" id="MathJax-Span-508" style="font-family: STIXGeneral; font-weight: bold;">e</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.852em; left: 0.471em;"><span class="mi" id="MathJax-Span-509" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.18em, 1003.39em, 4.482em, -999.997em); top: -3.331em; left: 50%; margin-left: -1.768em;"><span class="mrow" id="MathJax-Span-510"><span class="mo" id="MathJax-Span-511" style="font-family: STIXGeneral-Regular;">‖</span><span class="msubsup" id="MathJax-Span-512"><span style="display: inline-block; position: relative; width: 0.732em; height: 0px;"><span style="position: absolute; clip: rect(3.388em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span class="texatom" id="MathJax-Span-513"><span class="mrow" id="MathJax-Span-514"><span class="mi" id="MathJax-Span-515" style="font-family: STIXGeneral; font-weight: bold;">e</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.852em; left: 0.471em;"><span class="mi" id="MathJax-Span-516" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-517" style="font-family: STIXGeneral-Regular;">‖</span><span class="mo" id="MathJax-Span-518" style="font-family: STIXGeneral-Regular;">‖</span><span class="msubsup" id="MathJax-Span-519"><span style="display: inline-block; position: relative; width: 0.732em; height: 0px;"><span style="position: absolute; clip: rect(3.388em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span class="texatom" id="MathJax-Span-520"><span class="mrow" id="MathJax-Span-521"><span class="mi" id="MathJax-Span-522" style="font-family: STIXGeneral; font-weight: bold;">e</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.852em; left: 0.471em;"><span class="mi" id="MathJax-Span-523" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-524" style="font-family: STIXGeneral-Regular;">‖</span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(0.836em, 1003.65em, 1.201em, -999.997em); top: -1.247em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 3.648em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span><span class="mo" id="MathJax-Span-525" style="font-family: STIXGeneral-Regular; padding-left: 0.315em;">&gt;</span><span class="mi" id="MathJax-Span-526" style="font-family: STIXGeneral-Italic; padding-left: 0.315em;">τ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.19em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.247em; border-left: 0px solid; width: 0px; height: 2.816em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">e</mi></mrow><mi>i</mi></msub><mo>,</mo><msub><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">e</mi></mrow><mi>j</mi></msub><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><msub><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">e</mi></mrow><mi>i</mi></msub><mo>⋅</mo><msub><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">e</mi></mrow><mi>j</mi></msub></mrow><mrow><mo fence="false" stretchy="false">‖</mo><msub><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">e</mi></mrow><mi>i</mi></msub><mo fence="false" stretchy="false">‖</mo><mo fence="false" stretchy="false">‖</mo><msub><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">e</mi></mrow><mi>j</mi></msub><mo fence="false" stretchy="false">‖</mo></mrow></mfrac><mo>&gt;</mo><mi>τ</mi></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-48">\cos(\mathbf{e}_i,\mathbf{e}_j) = \frac{\mathbf{e}_i \cdot \mathbf{e}_j}{\|\mathbf{e}_i\|\|\mathbf{e}_j\|} > \tau</script>

    <ul>
      <li><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-49-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03C4;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-527" style="width: 0.576em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.471em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.617em, 1000.47em, 2.346em, -999.997em); top: -2.185em; left: 0em;"><span class="mrow" id="MathJax-Span-528"><span class="mi" id="MathJax-Span-529" style="font-family: STIXGeneral-Italic;">τ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.19em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.628em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>τ</mi></math></span></span><script type="math/tex" id="MathJax-Element-49">\tau</script> is typically 0.85–0.95 depending on tolerance.</li>
    </ul>
  </li>
  <li>More expensive but captures paraphrases and cross-lingual duplicates.</li>
</ul>

<h4 id="locality-sensitive-hashing-lsh">Locality-Sensitive Hashing (LSH)</h4>

<ul>
  <li>Approximate nearest-neighbor search (e.g. <a href="https://github.com/facebookresearch/faiss">FAISS</a>) on embeddings to scale to billions of samples.</li>
  <li>Enables fast clustering and deduplication in high dimensions.</li>
</ul>

<h3 id="handling-duplicates-after-detection">Handling Duplicates After Detection</h3>

<ul>
  <li>
    <p>After duplicates are identified, you can:</p>

    <ul>
      <li><strong>Keep one</strong> canonical copy (highest quality or random),</li>
      <li><strong>Downweight</strong> duplicates instead of dropping,</li>
      <li><strong>Cluster and merge</strong> overlapping documents if they contain unique segments.</li>
    </ul>
  </li>
  <li>
    <p>This prevents losing valuable unique content while still removing redundancy.</p>
  </li>
</ul>

<h3 id="special-considerations">Special Considerations</h3>

<ul>
  <li>Perform deduplication <strong>within and across datasets</strong> (e.g. training vs evaluation sets to prevent contamination).</li>
  <li>
    <p>Deduplicate <strong>at multiple granularities</strong>:</p>

    <ul>
      <li>document level (whole pages/files),</li>
      <li>paragraph/line level,</li>
      <li>span/n-gram level.</li>
    </ul>
  </li>
  <li>Track provenance metadata so that deduplication doesn’t remove licensed or proprietary content incorrectly.</li>
</ul>

<h2 id="end-to-end-filtering-pipeline">End-to-End Filtering Pipeline</h2>

<ul>
  <li>An effective filtering pipeline processes raw data through <strong>progressively stricter stages</strong>, starting with cheap statistical filters and ending with expensive human checks. This ensures you maximize <strong>quality, safety, and diversity</strong> while minimizing <strong>cost, duplication, and label noise</strong>.</li>
</ul>

<h3 id="pipeline-stages">Pipeline Stages</h3>

<h4 id="stage-1-basic-heuristic-filtering">Stage 1: Basic Heuristic Filtering</h4>

<ul>
  <li>
    <p><strong>Goal:</strong> Quickly remove obvious noise and off-domain data.</p>
  </li>
  <li>
    <p><strong>Techniques</strong>:</p>

    <ul>
      <li>Length-based filtering (&lt;5 or &gt;2000 tokens)</li>
      <li>Character ratio and symbol noise checks</li>
      <li>Language ID (e.g. <a href="https://fasttext.cc/">fastText</a>)</li>
      <li>Entropy checks</li>
      <li>Perplexity filtering with small LM</li>
      <li>Toxicity/profanity lexicon filters</li>
    </ul>
  </li>
  <li>
    <p><strong>Output:</strong> Cleaned raw corpus</p>
  </li>
</ul>

<h4 id="stage-2-quality-and-compliance-metrics">Stage 2: Quality and Compliance Metrics</h4>

<ul>
  <li>
    <p><strong>Goal:</strong> Ensure data is informative, diverse, and policy-compliant.</p>
  </li>
  <li>
    <p><strong>Quality Metrics</strong>:</p>

    <ul>
      <li>N-gram diversity</li>
      <li>Length-adjusted entropy</li>
      <li><a href="##complexity-gap-cg-score-for-label-noise">Complexity Gap (CG) score</a> for label noise.
        <ul>
          <li>Works on text/code/math; extendable to multimodal if serialized</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>Compliance Metrics</strong>:</p>

    <ul>
      <li>Safety classifiers (<a href="https://platform.openai.com/docs/guides/moderation">OpenAI moderation API</a>, <a href="https://github.com/meta-llama/llama-guard">LLaMA-Guard</a>)</li>
      <li>License/PII/bias filters</li>
    </ul>
  </li>
  <li>
    <p><strong>Output:</strong> High-quality, policy-compliant samples</p>
  </li>
</ul>

<h4 id="stage-3-outlier-and-island-detection">Stage 3: Outlier and Island Detection</h4>

<ul>
  <li>
    <p><strong>Goal:</strong> Remove semantically isolated or adversarial clusters.</p>
  </li>
  <li>
    <p><strong>Techniques</strong>:</p>

    <ul>
      <li>Embeddings from <a href="https://platform.openai.com/docs/guides/embeddings">OpenAI</a>, <a href="https://www.sbert.net/">Sentence-BERT</a>, etc.</li>
      <li>Dimensionality reduction (<a href="https://umap-learn.readthedocs.io/en/latest/">UMAP</a>, <a href="https://scikit-learn.org/stable/modules/generated/sklearn.decomposition.PCA.html">PCA</a>)</li>
      <li>Density-based clustering (<a href="https://scikit-learn.org/stable/modules/generated/sklearn.cluster.DBSCAN.html">DBSCAN</a>)</li>
      <li>Distance-threshold filtering</li>
    </ul>
  </li>
  <li>
    <p><strong>Output:</strong> In-distribution, cohesive data</p>
  </li>
</ul>

<h4 id="stage-4-llm-based-evaluation-llm-as-a-judge">Stage 4: LLM-Based Evaluation (LLM-as-a-Judge)</h4>

<ul>
  <li>
    <p><strong>Goal:</strong> Judge nuanced qualities at scale.</p>
  </li>
  <li>
    <p><strong>Evaluation Dimensions</strong>:</p>

    <ul>
      <li>Fluency, coherence, factuality, instruction relevance, conciseness, safety, diversity</li>
    </ul>
  </li>
  <li>
    <p><strong>Implementation</strong>:</p>

    <ul>
      <li>Structured prompts for LLM judges (e.g. GPT-4, Claude)</li>
      <li>Likert-scale scores per dimension</li>
      <li>Weighted aggregation:</li>
    </ul>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-50-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;munder&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;/mrow&gt;&lt;/munder&gt;&lt;msub&gt;&lt;mi&gt;w&lt;/mi&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-530" style="width: 10.471em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.701em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.096em, 1008.65em, 3.648em, -999.997em); top: -2.237em; left: 0em;"><span class="mrow" id="MathJax-Span-531"><span class="mi" id="MathJax-Span-532" style="font-family: STIXGeneral-Italic;">Q</span><span class="mo" id="MathJax-Span-533" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-534" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-535" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-536" style="font-family: STIXGeneral-Regular; padding-left: 0.315em;">=</span><span class="munderover" id="MathJax-Span-537" style="padding-left: 0.315em;"><span style="display: inline-block; position: relative; width: 1.357em; height: 0px;"><span style="position: absolute; clip: rect(2.867em, 1001.2em, 4.638em, -999.997em); top: -4.008em; left: 0.055em;"><span class="mo" id="MathJax-Span-538" style="font-family: STIXSizeOneSym; vertical-align: -0.518em;">∑</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.388em, 1001.36em, 4.273em, -999.997em); top: -2.862em; left: 0em;"><span class="texatom" id="MathJax-Span-539"><span class="mrow" id="MathJax-Span-540"><span class="mi" id="MathJax-Span-541" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-542" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">∈</span><span class="mi" id="MathJax-Span-543" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">D</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-544" style="padding-left: 0.211em;"><span style="display: inline-block; position: relative; width: 1.096em; height: 0px;"><span style="position: absolute; clip: rect(3.44em, 1000.63em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-545" style="font-family: STIXGeneral-Italic;">w</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.852em; left: 0.68em;"><span class="mi" id="MathJax-Span-546" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-547" style="font-family: STIXGeneral-Regular; padding-left: 0.263em;">⋅</span><span class="msubsup" id="MathJax-Span-548" style="padding-left: 0.263em;"><span style="display: inline-block; position: relative; width: 0.836em; height: 0px;"><span style="position: absolute; clip: rect(3.44em, 1000.37em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-549" style="font-family: STIXGeneral-Italic;">s</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.852em; left: 0.367em;"><span class="mi" id="MathJax-Span-550" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-551" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-552" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-553" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.242em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.559em; border-left: 0px solid; width: 0px; height: 2.816em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>Q</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><munder><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>d</mi><mo>∈</mo><mi>D</mi></mrow></munder><msub><mi>w</mi><mi>d</mi></msub><mo>⋅</mo><msub><mi>s</mi><mi>d</mi></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-50">Q(x) = \sum_{d \in D} w_d \cdot s_d(x)</script>
  </li>
  <li>
    <p><strong>Output:</strong> Samples with structured quality scores</p>
  </li>
</ul>

<h4 id="stage-5-human-evaluation">Stage 5: Human Evaluation</h4>

<ul>
  <li>
    <p><strong>Goal:</strong> Provide gold-standard ratings for calibration and final QA.</p>
  </li>
  <li>
    <p><strong>Key Features</strong>:</p>

    <ul>
      <li>Same dimensions as LLM eval (fluency, coherence, factuality, etc.)</li>
      <li>Inter-rater reliability checks (Cohen’s <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-51-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03BA;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-554" style="width: 0.732em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.576em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.617em, 1000.58em, 2.346em, -999.997em); top: -2.185em; left: 0em;"><span class="mrow" id="MathJax-Span-555"><span class="mi" id="MathJax-Span-556" style="font-family: STIXGeneral-Italic;">κ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.19em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>κ</mi></math></span></span><script type="math/tex" id="MathJax-Element-51">\kappa</script>)</li>
      <li>Gold standard tests and rater training</li>
    </ul>
  </li>
  <li>
    <p><strong>Use</strong>:</p>

    <ul>
      <li>Label a small stratified sample</li>
      <li>Calibrate thresholds for LLM-based evaluation</li>
    </ul>
  </li>
  <li>
    <p><strong>Output:</strong> Human-verified high-quality set</p>
  </li>
</ul>

<h4 id="stage-6-prompt-quality-evaluation">Stage 6: Prompt Quality Evaluation</h4>

<ul>
  <li>
    <p><strong>Goal:</strong> Ensure prompts themselves are clear, well-formed, and safe.</p>
  </li>
  <li>
    <p><strong>Metrics</strong>:</p>

    <ul>
      <li>Clarity, coherence, relevance, complexity, specificity, safety</li>
      <li>5-point Likert rubrics</li>
      <li>Good/bad examples embedded in the evaluation prompt</li>
    </ul>
  </li>
  <li>
    <p><strong>Use</strong>:</p>

    <ul>
      <li>Evaluate prompt-only datasets</li>
      <li>Discard ambiguous or unsafe prompts</li>
    </ul>
  </li>
</ul>

<h4 id="stage-7-safety-behavior-evaluation">Stage 7: Safety Behavior Evaluation</h4>

<ul>
  <li>
    <p><strong>Goal:</strong> Evaluate how the model responds to safe/unsafe prompts.</p>
  </li>
  <li>
    <p><strong>Metrics</strong>:</p>

    <ul>
      <li><strong>Over-punting (FPR):</strong> refusing safe prompts</li>
      <li><strong>Under-punting (FNR):</strong> answering unsafe prompts</li>
    </ul>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-52-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mtext&gt;FPR&lt;/mtext&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x0023;&lt;/mi&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;{&lt;/mo&gt;&lt;mtext&gt;safe&lt;/mtext&gt;&lt;mo&gt;&amp;#x2227;&lt;/mo&gt;&lt;mtext&gt;refuse&lt;/mtext&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;}&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x0023;&lt;/mi&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;{&lt;/mo&gt;&lt;mtext&gt;safe&lt;/mtext&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;}&lt;/mo&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mspace width=&quot;1em&quot; /&gt;&lt;mtext&gt;FNR&lt;/mtext&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x0023;&lt;/mi&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;{&lt;/mo&gt;&lt;mtext&gt;unsafe&lt;/mtext&gt;&lt;mo&gt;&amp;#x2227;&lt;/mo&gt;&lt;mtext&gt;answer&lt;/mtext&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;}&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x0023;&lt;/mi&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;{&lt;/mo&gt;&lt;mtext&gt;unsafe&lt;/mtext&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;}&lt;/mo&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-557" style="width: 27.763em; display: inline-block;"><span style="display: inline-block; position: relative; width: 23.128em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(0.68em, 1023.13em, 3.232em, -999.997em); top: -2.185em; left: 0em;"><span class="mrow" id="MathJax-Span-558"><span class="mtext" id="MathJax-Span-559" style="font-family: STIXGeneral-Regular;">FPR</span><span class="mo" id="MathJax-Span-560" style="font-family: STIXGeneral-Regular; padding-left: 0.315em;">=</span><span class="mfrac" id="MathJax-Span-561" style="padding-left: 0.315em;"><span style="display: inline-block; position: relative; width: 6.773em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;"><span style="position: absolute; clip: rect(3.18em, 1006.57em, 4.326em, -999.997em); top: -4.685em; left: 50%; margin-left: -3.331em;"><span class="mrow" id="MathJax-Span-562"><span class="mi" id="MathJax-Span-563" style="font-family: STIXGeneral-Regular;">#</span><span class="mo" id="MathJax-Span-564" style="font-family: STIXGeneral-Regular;">{</span><span class="mtext" id="MathJax-Span-565" style="font-family: STIXGeneral-Regular;">safe</span><span class="mo" id="MathJax-Span-566" style="font-family: STIXGeneral-Regular; padding-left: 0.263em;">∧</span><span class="mtext" id="MathJax-Span-567" style="font-family: STIXGeneral-Regular; padding-left: 0.263em;">refuse</span><span class="mo" id="MathJax-Span-568" style="font-family: STIXGeneral-Regular;">}</span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.18em, 1002.97em, 4.326em, -999.997em); top: -3.331em; left: 50%; margin-left: -1.508em;"><span class="mrow" id="MathJax-Span-569"><span class="mi" id="MathJax-Span-570" style="font-family: STIXGeneral-Regular;">#</span><span class="mo" id="MathJax-Span-571" style="font-family: STIXGeneral-Regular;">{</span><span class="mtext" id="MathJax-Span-572" style="font-family: STIXGeneral-Regular;">safe</span><span class="mo" id="MathJax-Span-573" style="font-family: STIXGeneral-Regular;">}</span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(0.836em, 1006.77em, 1.201em, -999.997em); top: -1.247em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 6.773em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span><span class="mo" id="MathJax-Span-574" style="font-family: STIXGeneral-Regular;">,</span><span class="mspace" id="MathJax-Span-575" style="height: 0em; vertical-align: 0em; width: 1.148em; display: inline-block; overflow: hidden;"></span><span class="mtext" id="MathJax-Span-576" style="font-family: STIXGeneral-Regular; padding-left: 0.211em;">FNR</span><span class="mo" id="MathJax-Span-577" style="font-family: STIXGeneral-Regular; padding-left: 0.315em;">=</span><span class="mfrac" id="MathJax-Span-578" style="padding-left: 0.315em;"><span style="display: inline-block; position: relative; width: 8.18em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;"><span style="position: absolute; clip: rect(3.18em, 1007.97em, 4.326em, -999.997em); top: -4.685em; left: 50%; margin-left: -4.008em;"><span class="mrow" id="MathJax-Span-579"><span class="mi" id="MathJax-Span-580" style="font-family: STIXGeneral-Regular;">#</span><span class="mo" id="MathJax-Span-581" style="font-family: STIXGeneral-Regular;">{</span><span class="mtext" id="MathJax-Span-582" style="font-family: STIXGeneral-Regular;">unsafe</span><span class="mo" id="MathJax-Span-583" style="font-family: STIXGeneral-Regular; padding-left: 0.263em;">∧</span><span class="mtext" id="MathJax-Span-584" style="font-family: STIXGeneral-Regular; padding-left: 0.263em;">answer</span><span class="mo" id="MathJax-Span-585" style="font-family: STIXGeneral-Regular;">}</span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.18em, 1003.96em, 4.326em, -999.997em); top: -3.331em; left: 50%; margin-left: -2.029em;"><span class="mrow" id="MathJax-Span-586"><span class="mi" id="MathJax-Span-587" style="font-family: STIXGeneral-Regular;">#</span><span class="mo" id="MathJax-Span-588" style="font-family: STIXGeneral-Regular;">{</span><span class="mtext" id="MathJax-Span-589" style="font-family: STIXGeneral-Regular;">unsafe</span><span class="mo" id="MathJax-Span-590" style="font-family: STIXGeneral-Regular;">}</span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(0.836em, 1008.18em, 1.201em, -999.997em); top: -1.247em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 8.18em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.19em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.122em; border-left: 0px solid; width: 0px; height: 2.816em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtext>FPR</mtext><mo>=</mo><mfrac><mrow><mi mathvariant="normal">#</mi><mo fence="false" stretchy="false">{</mo><mtext>safe</mtext><mo>∧</mo><mtext>refuse</mtext><mo fence="false" stretchy="false">}</mo></mrow><mrow><mi mathvariant="normal">#</mi><mo fence="false" stretchy="false">{</mo><mtext>safe</mtext><mo fence="false" stretchy="false">}</mo></mrow></mfrac><mo>,</mo><mspace width="1em"></mspace><mtext>FNR</mtext><mo>=</mo><mfrac><mrow><mi mathvariant="normal">#</mi><mo fence="false" stretchy="false">{</mo><mtext>unsafe</mtext><mo>∧</mo><mtext>answer</mtext><mo fence="false" stretchy="false">}</mo></mrow><mrow><mi mathvariant="normal">#</mi><mo fence="false" stretchy="false">{</mo><mtext>unsafe</mtext><mo fence="false" stretchy="false">}</mo></mrow></mfrac></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-52">\text{FPR} = \frac{\#\{\text{safe} \land \text{refuse}\}}{\#\{\text{safe}\}},\quad
 \text{FNR} = \frac{\#\{\text{unsafe} \land \text{answer}\}}{\#\{\text{unsafe}\}}</script>
  </li>
  <li>
    <p><strong>Use</strong>:</p>

    <ul>
      <li>Tune model refusal behavior to be safe but not overly cautious.</li>
    </ul>
  </li>
</ul>

<h4 id="stage-8-deduplication">Stage 8: Deduplication</h4>

<ul>
  <li>
    <p><strong>Goal:</strong> Remove duplicates and near-duplicates that inflate dataset size and reduce diversity.</p>
  </li>
  <li>
    <p><strong>Techniques</strong>:</p>

    <ul>
      <li>Hash-based (SHA-1, MD5)</li>
      <li><a href="https://en.wikipedia.org/wiki/MinHash">MinHash</a>, <a href="https://en.wikipedia.org/wiki/SimHash">SimHash</a></li>
      <li>Thresholding embedding-based cosine similarity: <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-53-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;e&lt;/mi&gt;&lt;/mrow&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;e&lt;/mi&gt;&lt;/mrow&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;gt;&lt;/mo&gt;&lt;mi&gt;&amp;#x03C4;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-591" style="width: 6.721em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.576em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.357em, 1005.58em, 2.659em, -999.997em); top: -2.185em; left: 0em;"><span class="mrow" id="MathJax-Span-592"><span class="mi" id="MathJax-Span-593" style="font-family: STIXGeneral-Regular;">cos</span><span class="mo" id="MathJax-Span-594"></span><span class="mo" id="MathJax-Span-595" style="font-family: STIXGeneral-Regular;">(</span><span class="msubsup" id="MathJax-Span-596"><span style="display: inline-block; position: relative; width: 0.732em; height: 0px;"><span style="position: absolute; clip: rect(3.388em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span class="texatom" id="MathJax-Span-597"><span class="mrow" id="MathJax-Span-598"><span class="mi" id="MathJax-Span-599" style="font-family: STIXGeneral; font-weight: bold;">e</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.852em; left: 0.471em;"><span class="mi" id="MathJax-Span-600" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-601" style="font-family: STIXGeneral-Regular;">,</span><span class="msubsup" id="MathJax-Span-602" style="padding-left: 0.211em;"><span style="display: inline-block; position: relative; width: 0.732em; height: 0px;"><span style="position: absolute; clip: rect(3.388em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span class="texatom" id="MathJax-Span-603"><span class="mrow" id="MathJax-Span-604"><span class="mi" id="MathJax-Span-605" style="font-family: STIXGeneral; font-weight: bold;">e</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.852em; left: 0.471em;"><span class="mi" id="MathJax-Span-606" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-607" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-608" style="font-family: STIXGeneral-Regular; padding-left: 0.315em;">&gt;</span><span class="mi" id="MathJax-Span-609" style="font-family: STIXGeneral-Italic; padding-left: 0.315em;">τ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.19em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.316em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">e</mi></mrow><mi>i</mi></msub><mo>,</mo><msub><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">e</mi></mrow><mi>j</mi></msub><mo stretchy="false">)</mo><mo>&gt;</mo><mi>τ</mi></math></span></span><script type="math/tex" id="MathJax-Element-53">\cos(\mathbf{e}_i,\mathbf{e}_j) > \tau</script></li>
      <li>ANN tools like <a href="https://github.com/facebookresearch/faiss">FAISS</a></li>
    </ul>
  </li>
  <li>
    <p><strong>Scope</strong>:</p>

    <ul>
      <li>Within-dataset and cross-dataset (to prevent eval set contamination)</li>
    </ul>
  </li>
</ul>

<h3 id="flow-diagram">Flow Diagram</h3>

<ul>
  <li>The following figure shows the end-to-end data filtering pipeline - from raw data to a final curated training set — showing each stage (rule-based filters, quality and compliance, outlier detection, LLM-based evaluation, human calibration, prompt quality scoring, safety behavior evaluation, and deduplication) connected in sequence.</li>
</ul>

<p><img src="/primers/ai/assets/data-filtering/flow.jpg" alt=""></p>

<h2 id="concrete-scoring-framework">Concrete Scoring Framework</h2>

<ul>
  <li>
    <p>This section gives a <strong>practical scoring framework</strong> for combining:</p>

    <ul>
      <li>rule-based/statistical filters,</li>
      <li>quality and compliance metrics,</li>
      <li>LLM-based evaluations,</li>
      <li>human calibration samples,</li>
      <li>and safety behavior checks.</li>
    </ul>
  </li>
  <li>
    <p>It assumes you are filtering <strong>instruction data (prompt–response pairs)</strong>, but the structure generalizes to code, math, and multimodal pairs.</p>
  </li>
</ul>

<h3 id="stage-level-thresholding-overview">Stage-Level Thresholding Overview</h3>

<ul>
  <li>Each stage assigns either a <strong>binary pass/fail</strong> or a <strong>numeric quality score <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-54-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;q&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-610" style="width: 4.961em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.083em; height: 0px; font-size: 121%;"><span style="position: absolute; clip: rect(1.397em, 1003.98em, 2.585em, -999.997em); top: -2.218em; left: 0em;"><span class="mrow" id="MathJax-Span-611"><span class="msubsup" id="MathJax-Span-612"><span style="display: inline-block; position: relative; width: 0.777em; height: 0px;"><span style="position: absolute; clip: rect(3.36em, 1000.47em, 4.341em, -999.997em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-613" style="font-family: STIXGeneral-Italic;">q</span><span style="display: inline-block; width: 0px; height: 3.98em;"></span></span><span style="position: absolute; top: -3.82em; left: 0.519em;"><span class="mi" id="MathJax-Span-614" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 3.98em;"></span></span></span></span><span class="mo" id="MathJax-Span-615" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">∈</span><span class="mo" id="MathJax-Span-616" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">[</span><span class="mn" id="MathJax-Span-617" style="font-family: STIXGeneral-Regular;">0</span><span class="mo" id="MathJax-Span-618" style="font-family: STIXGeneral-Regular;">,</span><span class="mn" id="MathJax-Span-619" style="font-family: STIXGeneral-Regular; padding-left: 0.209em;">1</span><span class="mo" id="MathJax-Span-620" style="font-family: STIXGeneral-Regular;">]</span></span><span style="display: inline-block; width: 0px; height: 2.224em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>q</mi><mi>i</mi></msub><mo>∈</mo><mo stretchy="false">[</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-54">q_i \in [0,1]</script></strong>.</li>
  <li>
    <p>The filtering logic is:</p>

    <ul>
      <li><strong>Hard filters</strong> (discard on failure): rule-based heuristics, compliance/safety, deduplication.</li>
      <li><strong>Soft scores</strong> (aggregate into overall quality): LLM and human evaluations.</li>
    </ul>
  </li>
  <li>
    <p><strong>Notation:</strong></p>

    <ul>
      <li><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-55-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-621" style="width: 2.451em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.034em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.357em, 1001.98em, 2.503em, -999.997em); top: -2.185em; left: 0em;"><span class="mrow" id="MathJax-Span-622"><span class="msubsup" id="MathJax-Span-623"><span style="display: inline-block; position: relative; width: 0.836em; height: 0px;"><span style="position: absolute; clip: rect(3.44em, 1000.37em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-624" style="font-family: STIXGeneral-Italic;">s</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.852em; left: 0.367em;"><span class="texatom" id="MathJax-Span-625"><span class="mrow" id="MathJax-Span-626"><span class="mi" id="MathJax-Span-627" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-628" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-629" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-630" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.19em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>s</mi><mrow class="MJX-TeXAtom-ORD"><mi>d</mi></mrow></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-55">s_{d}(x)</script>: score on dimension <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-56-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-631" style="width: 0.732em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.576em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.357em, 1000.58em, 2.346em, -999.997em); top: -2.185em; left: 0em;"><span class="mrow" id="MathJax-Span-632"><span class="mi" id="MathJax-Span-633" style="font-family: STIXGeneral-Italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.055em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.19em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>d</mi></math></span></span><script type="math/tex" id="MathJax-Element-56">d</script> for sample <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-57-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-634" style="width: 0.628em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;"><span class="mrow" id="MathJax-Span-635"><span class="mi" id="MathJax-Span-636" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.19em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi></math></span></span><script type="math/tex" id="MathJax-Element-57">x</script>.</li>
      <li><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-58-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;w&lt;/mi&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-637" style="width: 1.357em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.096em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.565em, 1001.1em, 2.451em, -999.997em); top: -2.133em; left: 0em;"><span class="mrow" id="MathJax-Span-638"><span class="msubsup" id="MathJax-Span-639"><span style="display: inline-block; position: relative; width: 1.096em; height: 0px;"><span style="position: absolute; clip: rect(3.44em, 1000.63em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-640" style="font-family: STIXGeneral-Italic;">w</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.852em; left: 0.68em;"><span class="mi" id="MathJax-Span-641" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.138em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>w</mi><mi>d</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-58">w_d</script>: weight for dimension <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-59-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-642" style="width: 0.732em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.576em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.357em, 1000.58em, 2.346em, -999.997em); top: -2.185em; left: 0em;"><span class="mrow" id="MathJax-Span-643"><span class="mi" id="MathJax-Span-644" style="font-family: STIXGeneral-Italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.055em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.19em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>d</mi></math></span></span><script type="math/tex" id="MathJax-Element-59">d</script>.</li>
      <li><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-60-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-645" style="width: 2.294em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.878em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.357em, 1001.83em, 2.503em, -999.997em); top: -2.185em; left: 0em;"><span class="mrow" id="MathJax-Span-646"><span class="mi" id="MathJax-Span-647" style="font-family: STIXGeneral-Italic;">Q</span><span class="mo" id="MathJax-Span-648" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-649" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-650" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.19em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-60">Q(x)</script>: overall quality score.</li>
    </ul>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-61-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;munder&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/mrow&gt;&lt;/munder&gt;&lt;msub&gt;&lt;mi&gt;w&lt;/mi&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;munder&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/mrow&gt;&lt;/munder&gt;&lt;msub&gt;&lt;mi&gt;w&lt;/mi&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-651" style="width: 10.628em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.857em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(0.471em, 1008.86em, 3.388em, -999.997em); top: -2.185em; left: 0em;"><span class="mrow" id="MathJax-Span-652"><span class="mi" id="MathJax-Span-653" style="font-family: STIXGeneral-Italic;">Q</span><span class="mo" id="MathJax-Span-654" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-655" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-656" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-657" style="font-family: STIXGeneral-Regular; padding-left: 0.315em;">=</span><span class="mfrac" id="MathJax-Span-658" style="padding-left: 0.315em;"><span style="display: inline-block; position: relative; width: 5.576em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;"><span style="position: absolute; clip: rect(3.076em, 1005.42em, 4.482em, -999.997em); top: -4.789em; left: 50%; margin-left: -2.706em;"><span class="mrow" id="MathJax-Span-659"><span class="munderover" id="MathJax-Span-660"><span style="display: inline-block; position: relative; width: 1.357em; height: 0px;"><span style="position: absolute; clip: rect(3.076em, 1000.84em, 4.43em, -999.997em); top: -4.008em; left: 0em;"><span class="mo" id="MathJax-Span-661" style="font-family: STIXGeneral-Regular; vertical-align: 0.003em;">∑</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.695em; left: 0.94em;"><span class="texatom" id="MathJax-Span-662"><span class="mrow" id="MathJax-Span-663"><span class="mi" id="MathJax-Span-664" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-665" style="padding-left: 0.211em;"><span style="display: inline-block; position: relative; width: 1.096em; height: 0px;"><span style="position: absolute; clip: rect(3.44em, 1000.63em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-666" style="font-family: STIXGeneral-Italic;">w</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.852em; left: 0.68em;"><span class="mi" id="MathJax-Span-667" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-668" style="font-family: STIXGeneral-Regular; padding-left: 0.263em;">⋅</span><span class="msubsup" id="MathJax-Span-669" style="padding-left: 0.263em;"><span style="display: inline-block; position: relative; width: 0.836em; height: 0px;"><span style="position: absolute; clip: rect(3.44em, 1000.37em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-670" style="font-family: STIXGeneral-Italic;">s</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.852em; left: 0.367em;"><span class="mi" id="MathJax-Span-671" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-672" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-673" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-674" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.076em, 1002.71em, 4.482em, -999.997em); top: -3.279em; left: 50%; margin-left: -1.352em;"><span class="mrow" id="MathJax-Span-675"><span class="munderover" id="MathJax-Span-676"><span style="display: inline-block; position: relative; width: 1.357em; height: 0px;"><span style="position: absolute; clip: rect(3.076em, 1000.84em, 4.43em, -999.997em); top: -4.008em; left: 0em;"><span class="mo" id="MathJax-Span-677" style="font-family: STIXGeneral-Regular; vertical-align: 0.003em;">∑</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.695em; left: 0.94em;"><span class="texatom" id="MathJax-Span-678"><span class="mrow" id="MathJax-Span-679"><span class="mi" id="MathJax-Span-680" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-681" style="padding-left: 0.211em;"><span style="display: inline-block; position: relative; width: 1.096em; height: 0px;"><span style="position: absolute; clip: rect(3.44em, 1000.63em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-682" style="font-family: STIXGeneral-Italic;">w</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.852em; left: 0.68em;"><span class="mi" id="MathJax-Span-683" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(0.836em, 1005.58em, 1.201em, -999.997em); top: -1.247em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 5.576em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.19em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.309em; border-left: 0px solid; width: 0px; height: 3.191em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>Q</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><munder><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>d</mi></mrow></munder><msub><mi>w</mi><mi>d</mi></msub><mo>⋅</mo><msub><mi>s</mi><mi>d</mi></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><mrow><munder><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>d</mi></mrow></munder><msub><mi>w</mi><mi>d</mi></msub></mrow></mfrac></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-61">Q(x) = \frac{\sum_{d} w_d \cdot s_d(x)}{\sum_{d} w_d}</script>
  </li>
  <li>Keep <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-62-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-684" style="width: 0.628em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;"><span class="mrow" id="MathJax-Span-685"><span class="mi" id="MathJax-Span-686" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.19em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi></math></span></span><script type="math/tex" id="MathJax-Element-62">x</script> if <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-63-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x2265;&lt;/mo&gt;&lt;mi&gt;&amp;#x03C4;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-687" style="width: 4.273em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.544em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.357em, 1003.54em, 2.503em, -999.997em); top: -2.185em; left: 0em;"><span class="mrow" id="MathJax-Span-688"><span class="mi" id="MathJax-Span-689" style="font-family: STIXGeneral-Italic;">Q</span><span class="mo" id="MathJax-Span-690" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-691" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-692" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-693" style="font-family: STIXGeneral-Regular; padding-left: 0.315em;">≥</span><span class="mi" id="MathJax-Span-694" style="font-family: STIXGeneral-Italic; padding-left: 0.315em;">τ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.19em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>≥</mo><mi>τ</mi></math></span></span><script type="math/tex" id="MathJax-Element-63">Q(x) \ge \tau</script> and it passes all hard filters.</li>
</ul>

<h3 id="suggested-weights-and-thresholds">Suggested Weights and Thresholds</h3>

<ol>
  <li>
    <p><strong>Rule-Based / Statistical Filters</strong>:</p>

    <ul>
      <li>
        <p>Hard reject if:</p>

        <ul>
          <li>length &lt; 5 or &gt; 2000 tokens</li>
          <li>language mismatch</li>
          <li>perplexity z-score &gt; +3 or &lt; –3</li>
          <li>entropy &lt; 1.0 bits/token</li>
          <li>contains blocked terms (toxicity, profanity)</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>Compliance Filters</strong>:</p>

    <ul>
      <li>
        <p>Hard reject if:</p>

        <ul>
          <li><a href="https://platform.openai.com/docs/guides/moderation">OpenAI Moderation API</a> risk &gt; 0.8</li>
          <li><a href="https://github.com/meta-llama/llama-guard">LLaMA-Guard</a> unsafe label present</li>
          <li>contains PII or license-restricted text</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>Outlier Detection</strong>:</p>

    <ul>
      <li>Hard reject if DBSCAN marks as noise or mean kNN distance &gt; 95th percentile</li>
    </ul>
  </li>
  <li>
    <p><strong>LLM-Based Evaluation</strong>:</p>

    <ul>
      <li>
        <p>Dimensions and weights:</p>

        <div align="center">
 <table class="tg">
 <thead>
 <tr>
 <th class="tg-hcenter-valign-first"><strong>Dimension</strong></th>
 <th class="tg-hcenter-valign-first"><strong>Weight <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-64-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;w&lt;/mi&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-695" style="width: 1.372em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.134em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.61em, 1001.13em, 2.562em, -999.997em); top: -2.199em; left: 0em;"><span class="mrow" id="MathJax-Span-696"><span class="msubsup" id="MathJax-Span-697"><span style="display: inline-block; position: relative; width: 1.134em; height: 0px;"><span style="position: absolute; clip: rect(3.396em, 1000.66em, 4.17em, -999.997em); top: -3.985em; left: 0em;"><span class="mi" id="MathJax-Span-698" style="font-family: STIXGeneral-Italic;">w</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; top: -3.807em; left: 0.658em;"><span class="mi" id="MathJax-Span-699" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.205em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 0.861em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>w</mi><mi>d</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-64">w_d</script></strong></th>
 <th class="tg-hcenter-valign-second"><strong>Threshold</strong></th>
 </tr>
 </thead>
 <tbody>
 <tr>
 <td class="tg-tleft-valign-first">Clarity</td>
 <td class="tg-tleft-valign-first">0.15</td>
 <td class="tg-tleft-valign-second">≥ 3/5</td>
 </tr>
 <tr>
 <td class="tg-tleft-valign-first">Coherence</td>
 <td class="tg-tleft-valign-first">0.15</td>
 <td class="tg-tleft-valign-second">≥ 3/5</td>
 </tr>
 <tr>
 <td class="tg-tleft-valign-first">Factuality</td>
 <td class="tg-tleft-valign-first">0.20</td>
 <td class="tg-tleft-valign-second">≥ 3/5</td>
 </tr>
 <tr>
 <td class="tg-tleft-valign-first">Instruction relevance</td>
 <td class="tg-tleft-valign-first">0.20</td>
 <td class="tg-tleft-valign-second">≥ 3/5</td>
 </tr>
 <tr>
 <td class="tg-tleft-valign-first">Conciseness</td>
 <td class="tg-tleft-valign-first">0.10</td>
 <td class="tg-tleft-valign-second">≥ 2/5</td>
 </tr>
 <tr>
 <td class="tg-tleft-valign-first">Safety</td>
 <td class="tg-tleft-valign-first">0.20</td>
 <td class="tg-tleft-valign-second">≥ 4/5</td>
 </tr>
 </tbody>
 </table>
 </div>
      </li>
      <li>
        <p>Compute:</p>
      </li>
    </ul>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-65-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msub&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mtext&gt;LLM&lt;/mtext&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;munder&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/munder&gt;&lt;msub&gt;&lt;mi&gt;w&lt;/mi&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;munder&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/munder&gt;&lt;msub&gt;&lt;mi&gt;w&lt;/mi&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-700" style="width: 11.565em; display: inline-block;"><span style="display: inline-block; position: relative; width: 9.638em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(0.471em, 1009.64em, 3.388em, -999.997em); top: -2.185em; left: 0em;"><span class="mrow" id="MathJax-Span-701"><span class="msubsup" id="MathJax-Span-702"><span style="display: inline-block; position: relative; width: 2.294em; height: 0px;"><span style="position: absolute; clip: rect(3.18em, 1000.68em, 4.326em, -999.997em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-703" style="font-family: STIXGeneral-Italic;">Q</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.852em; left: 0.732em;"><span class="texatom" id="MathJax-Span-704"><span class="mrow" id="MathJax-Span-705"><span class="mtext" id="MathJax-Span-706" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">LLM</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-707" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-708" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-709" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-710" style="font-family: STIXGeneral-Regular; padding-left: 0.315em;">=</span><span class="mfrac" id="MathJax-Span-711" style="padding-left: 0.315em;"><span style="display: inline-block; position: relative; width: 4.742em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;"><span style="position: absolute; clip: rect(3.076em, 1004.59em, 4.482em, -999.997em); top: -4.789em; left: 50%; margin-left: -2.341em;"><span class="mrow" id="MathJax-Span-712"><span class="munderover" id="MathJax-Span-713"><span style="display: inline-block; position: relative; width: 1.357em; height: 0px;"><span style="position: absolute; clip: rect(3.076em, 1000.84em, 4.43em, -999.997em); top: -4.008em; left: 0em;"><span class="mo" id="MathJax-Span-714" style="font-family: STIXGeneral-Regular; vertical-align: 0.003em;">∑</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.695em; left: 0.94em;"><span class="mi" id="MathJax-Span-715" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-716" style="padding-left: 0.211em;"><span style="display: inline-block; position: relative; width: 1.096em; height: 0px;"><span style="position: absolute; clip: rect(3.44em, 1000.63em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-717" style="font-family: STIXGeneral-Italic;">w</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.852em; left: 0.68em;"><span class="mi" id="MathJax-Span-718" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-719"><span style="display: inline-block; position: relative; width: 0.836em; height: 0px;"><span style="position: absolute; clip: rect(3.44em, 1000.37em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-720" style="font-family: STIXGeneral-Italic;">s</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.852em; left: 0.367em;"><span class="mi" id="MathJax-Span-721" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-722" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-723" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-724" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.076em, 1002.71em, 4.482em, -999.997em); top: -3.279em; left: 50%; margin-left: -1.352em;"><span class="mrow" id="MathJax-Span-725"><span class="munderover" id="MathJax-Span-726"><span style="display: inline-block; position: relative; width: 1.357em; height: 0px;"><span style="position: absolute; clip: rect(3.076em, 1000.84em, 4.43em, -999.997em); top: -4.008em; left: 0em;"><span class="mo" id="MathJax-Span-727" style="font-family: STIXGeneral-Regular; vertical-align: 0.003em;">∑</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.695em; left: 0.94em;"><span class="mi" id="MathJax-Span-728" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-729" style="padding-left: 0.211em;"><span style="display: inline-block; position: relative; width: 1.096em; height: 0px;"><span style="position: absolute; clip: rect(3.44em, 1000.63em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-730" style="font-family: STIXGeneral-Italic;">w</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.852em; left: 0.68em;"><span class="mi" id="MathJax-Span-731" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(0.836em, 1004.74em, 1.201em, -999.997em); top: -1.247em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 4.742em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.19em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.309em; border-left: 0px solid; width: 0px; height: 3.191em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>Q</mi><mrow class="MJX-TeXAtom-ORD"><mtext>LLM</mtext></mrow></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><munder><mo>∑</mo><mi>d</mi></munder><msub><mi>w</mi><mi>d</mi></msub><msub><mi>s</mi><mi>d</mi></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><mrow><munder><mo>∑</mo><mi>d</mi></munder><msub><mi>w</mi><mi>d</mi></msub></mrow></mfrac></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-65">Q_{\text{LLM}}(x) = \frac{\sum_d w_d s_d(x)}{\sum_d w_d}</script>

    <ul>
      <li>Keep if <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-66-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mtext&gt;LLM&lt;/mtext&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x2265;&lt;/mo&gt;&lt;mn&gt;3.5&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-732" style="width: 7.086em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.888em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.357em, 1005.84em, 2.503em, -999.997em); top: -2.185em; left: 0em;"><span class="mrow" id="MathJax-Span-733"><span class="msubsup" id="MathJax-Span-734"><span style="display: inline-block; position: relative; width: 2.294em; height: 0px;"><span style="position: absolute; clip: rect(3.18em, 1000.68em, 4.326em, -999.997em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-735" style="font-family: STIXGeneral-Italic;">Q</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.852em; left: 0.732em;"><span class="texatom" id="MathJax-Span-736"><span class="mrow" id="MathJax-Span-737"><span class="mtext" id="MathJax-Span-738" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">LLM</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-739" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-740" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-741" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-742" style="font-family: STIXGeneral-Regular; padding-left: 0.315em;">≥</span><span class="mn" id="MathJax-Span-743" style="font-family: STIXGeneral-Regular; padding-left: 0.315em;">3.5</span></span><span style="display: inline-block; width: 0px; height: 2.19em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>Q</mi><mrow class="MJX-TeXAtom-ORD"><mtext>LLM</mtext></mrow></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>≥</mo><mn>3.5</mn></math></span></span><script type="math/tex" id="MathJax-Element-66">Q_{\text{LLM}}(x) \ge 3.5</script> and <strong>no dimension &lt; 3 except conciseness</strong>.</li>
    </ul>
  </li>
  <li>
    <p><strong>Human Evaluation (Calibration Subset)</strong>:</p>

    <ul>
      <li>Evaluate 1–5% of data</li>
      <li>Compute average absolute difference between human and LLM scores:</li>
    </ul>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-67-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x0394;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/mfrac&gt;&lt;munder&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/munder&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;msubsup&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mtext&gt;human&lt;/mtext&gt;&lt;/mrow&gt;&lt;/msubsup&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msubsup&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mtext&gt;LLM&lt;/mtext&gt;&lt;/mrow&gt;&lt;/msubsup&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-744" style="width: 12.971em; display: inline-block;"><span style="display: inline-block; position: relative; width: 10.784em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(0.992em, 1010.68em, 3.909em, -999.997em); top: -2.497em; left: 0em;"><span class="mrow" id="MathJax-Span-745"><span class="mi" id="MathJax-Span-746" style="font-family: STIXGeneral-Regular;">Δ</span><span class="mo" id="MathJax-Span-747" style="font-family: STIXGeneral-Regular; padding-left: 0.315em;">=</span><span class="mfrac" id="MathJax-Span-748" style="padding-left: 0.315em;"><span style="display: inline-block; position: relative; width: 0.836em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;"><span style="position: absolute; clip: rect(3.18em, 1000.42em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.258em;"><span class="mn" id="MathJax-Span-749" style="font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.18em, 1000.73em, 4.169em, -999.997em); top: -3.331em; left: 50%; margin-left: -0.362em;"><span class="mi" id="MathJax-Span-750" style="font-family: STIXGeneral-Italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.055em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(0.836em, 1000.84em, 1.201em, -999.997em); top: -1.247em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.836em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span><span class="munderover" id="MathJax-Span-751" style="padding-left: 0.211em;"><span style="display: inline-block; position: relative; width: 1.305em; height: 0px;"><span style="position: absolute; clip: rect(2.867em, 1001.2em, 4.638em, -999.997em); top: -4.008em; left: 0em;"><span class="mo" id="MathJax-Span-752" style="font-family: STIXSizeOneSym; vertical-align: -0.518em;">∑</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.388em, 1000.21em, 4.273em, -999.997em); top: -2.862em; left: 0.576em;"><span class="mi" id="MathJax-Span-753" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="texatom" id="MathJax-Span-754" style="padding-left: 0.211em;"><span class="mrow" id="MathJax-Span-755"><span class="mo" id="MathJax-Span-756" style="font-family: STIXVariants;">|</span></span></span><span class="msubsup" id="MathJax-Span-757"><span style="display: inline-block; position: relative; width: 2.398em; height: 0px;"><span style="position: absolute; clip: rect(3.44em, 1000.37em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-758" style="font-family: STIXGeneral-Italic;">s</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.388em, 1001.98em, 4.169em, -999.997em); top: -4.372em; left: 0.367em;"><span class="texatom" id="MathJax-Span-759"><span class="mrow" id="MathJax-Span-760"><span class="mtext" id="MathJax-Span-761" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">human</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.388em, 1000.26em, 4.169em, -999.997em); top: -3.695em; left: 0.367em;"><span class="mi" id="MathJax-Span-762" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-763" style="font-family: STIXGeneral-Regular; padding-left: 0.263em;">−</span><span class="msubsup" id="MathJax-Span-764" style="padding-left: 0.263em;"><span style="display: inline-block; position: relative; width: 1.982em; height: 0px;"><span style="position: absolute; clip: rect(3.44em, 1000.37em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-765" style="font-family: STIXGeneral-Italic;">s</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.388em, 1001.57em, 4.169em, -999.997em); top: -4.372em; left: 0.367em;"><span class="texatom" id="MathJax-Span-766"><span class="mrow" id="MathJax-Span-767"><span class="mtext" id="MathJax-Span-768" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">LLM</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.388em, 1000.26em, 4.169em, -999.997em); top: -3.695em; left: 0.367em;"><span class="mi" id="MathJax-Span-769" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="texatom" id="MathJax-Span-770"><span class="mrow" id="MathJax-Span-771"><span class="mo" id="MathJax-Span-772" style="font-family: STIXVariants;">|</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.503em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.559em; border-left: 0px solid; width: 0px; height: 3.253em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi mathvariant="normal">Δ</mi><mo>=</mo><mfrac><mn>1</mn><mi>N</mi></mfrac><munder><mo>∑</mo><mi>i</mi></munder><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><msubsup><mi>s</mi><mi>i</mi><mrow class="MJX-TeXAtom-ORD"><mtext>human</mtext></mrow></msubsup><mo>−</mo><msubsup><mi>s</mi><mi>i</mi><mrow class="MJX-TeXAtom-ORD"><mtext>LLM</mtext></mrow></msubsup><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-67">\Delta = \frac{1}{N} \sum_i |s^{\text{human}}_i - s^{\text{LLM}}_i|</script>

    <ul>
      <li>If <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-68-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x0394;&lt;/mi&gt;&lt;mo&gt;&amp;gt;&lt;/mo&gt;&lt;mn&gt;1.0&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-773" style="width: 3.857em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.18em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.357em, 1003.18em, 2.346em, -999.997em); top: -2.185em; left: 0em;"><span class="mrow" id="MathJax-Span-774"><span class="mi" id="MathJax-Span-775" style="font-family: STIXGeneral-Regular;">Δ</span><span class="mo" id="MathJax-Span-776" style="font-family: STIXGeneral-Regular; padding-left: 0.315em;">&gt;</span><span class="mn" id="MathJax-Span-777" style="font-family: STIXGeneral-Regular; padding-left: 0.315em;">1.0</span></span><span style="display: inline-block; width: 0px; height: 2.19em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="normal">Δ</mi><mo>&gt;</mo><mn>1.0</mn></math></span></span><script type="math/tex" id="MathJax-Element-68">\Delta > 1.0</script>, adjust LLM thresholds down or retrain prompt.</li>
    </ul>
  </li>
  <li>
    <p><strong>Prompt Quality Evaluation</strong>:</p>

    <ul>
      <li>Apply the detailed Likert rubric from the <a href="#prompt-quality-metrics">Prompt Quality Metrics</a> section.</li>
      <li>Require overall average ≥ 3.5 and <strong>safety ≥ 4</strong>.</li>
    </ul>
  </li>
  <li>
    <p><strong>Safety Behavior Evaluation</strong>:</p>

    <ul>
      <li>Use balanced safe/unsafe set.</li>
      <li>Require:
        <ul>
          <li>
<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-69-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mtext&gt;FNR (under-punt)&lt;/mtext&gt;&lt;mo&gt;&amp;lt;&lt;/mo&gt;&lt;mn&gt;0.05&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-778" style="width: 12.19em; display: inline-block;"><span style="display: inline-block; position: relative; width: 10.159em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.357em, 1010.11em, 2.555em, -999.997em); top: -2.185em; left: 0em;"><span class="mrow" id="MathJax-Span-779"><span class="mtext" id="MathJax-Span-780" style="font-family: STIXGeneral-Regular;">FNR (under-punt)</span><span class="mo" id="MathJax-Span-781" style="font-family: STIXGeneral-Regular; padding-left: 0.315em;">&lt;</span><span class="mn" id="MathJax-Span-782" style="font-family: STIXGeneral-Regular; padding-left: 0.315em;">0.05</span></span><span style="display: inline-block; width: 0px; height: 2.19em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtext>FNR (under-punt)</mtext><mo>&lt;</mo><mn>0.05</mn></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-69">\text{FNR (under-punt)} < 0.05</script>
          </li>
          <li>
<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-70-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mtext&gt;FPR (over-punt)&lt;/mtext&gt;&lt;mo&gt;&amp;lt;&lt;/mo&gt;&lt;mn&gt;0.10&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-783" style="width: 11.461em; display: inline-block;"><span style="display: inline-block; position: relative; width: 9.534em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.357em, 1009.53em, 2.555em, -999.997em); top: -2.185em; left: 0em;"><span class="mrow" id="MathJax-Span-784"><span class="mtext" id="MathJax-Span-785" style="font-family: STIXGeneral-Regular;">FPR (over-punt)</span><span class="mo" id="MathJax-Span-786" style="font-family: STIXGeneral-Regular; padding-left: 0.315em;">&lt;</span><span class="mn" id="MathJax-Span-787" style="font-family: STIXGeneral-Regular; padding-left: 0.315em;">0.10</span></span><span style="display: inline-block; width: 0px; height: 2.19em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtext>FPR (over-punt)</mtext><mo>&lt;</mo><mn>0.10</mn></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-70">\text{FPR (over-punt)} < 0.10</script>
          </li>
        </ul>
      </li>
      <li>If violated, filter unsafe prompts more aggressively and retrain refusal behavior.</li>
    </ul>
  </li>
  <li>
    <p><strong>Deduplication</strong>:</p>

    <ul>
      <li>Drop exact hash duplicates.</li>
      <li>Drop near-duplicates if embedding cosine similarity <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-71-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;e&lt;/mi&gt;&lt;/mrow&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;e&lt;/mi&gt;&lt;/mrow&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;gt;&lt;/mo&gt;&lt;mn&gt;0.90&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-788" style="width: 8.284em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.878em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.357em, 1006.88em, 2.659em, -999.997em); top: -2.185em; left: 0em;"><span class="mrow" id="MathJax-Span-789"><span class="mi" id="MathJax-Span-790" style="font-family: STIXGeneral-Regular;">cos</span><span class="mo" id="MathJax-Span-791"></span><span class="mo" id="MathJax-Span-792" style="font-family: STIXGeneral-Regular;">(</span><span class="msubsup" id="MathJax-Span-793"><span style="display: inline-block; position: relative; width: 0.732em; height: 0px;"><span style="position: absolute; clip: rect(3.388em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span class="texatom" id="MathJax-Span-794"><span class="mrow" id="MathJax-Span-795"><span class="mi" id="MathJax-Span-796" style="font-family: STIXGeneral; font-weight: bold;">e</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.852em; left: 0.471em;"><span class="mi" id="MathJax-Span-797" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-798" style="font-family: STIXGeneral-Regular;">,</span><span class="msubsup" id="MathJax-Span-799" style="padding-left: 0.211em;"><span style="display: inline-block; position: relative; width: 0.732em; height: 0px;"><span style="position: absolute; clip: rect(3.388em, 1000.42em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span class="texatom" id="MathJax-Span-800"><span class="mrow" id="MathJax-Span-801"><span class="mi" id="MathJax-Span-802" style="font-family: STIXGeneral; font-weight: bold;">e</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.852em; left: 0.471em;"><span class="mi" id="MathJax-Span-803" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-804" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-805" style="font-family: STIXGeneral-Regular; padding-left: 0.315em;">&gt;</span><span class="mn" id="MathJax-Span-806" style="font-family: STIXGeneral-Regular; padding-left: 0.315em;">0.90</span></span><span style="display: inline-block; width: 0px; height: 2.19em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.316em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">e</mi></mrow><mi>i</mi></msub><mo>,</mo><msub><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">e</mi></mrow><mi>j</mi></msub><mo stretchy="false">)</mo><mo>&gt;</mo><mn>0.90</mn></math></span></span><script type="math/tex" id="MathJax-Element-71">\cos(\mathbf{e}_i,\mathbf{e}_j) > 0.90</script>.</li>
    </ul>
  </li>
</ol>

<h3 id="implementation-flow">Implementation Flow</h3>

<ul>
  <li>
    <p>The following flow offers a <strong>self-consistent scoring architecture</strong> that balances <strong>precision (safety)</strong> and <strong>recall (coverage)</strong> while staying scalable:</p>

    <ol>
      <li><strong>Precompute</strong> rule-based, safety, and embedding metrics.</li>
      <li><strong>Filter</strong> using hard criteria (#1–#3, #8).</li>
      <li><strong>Evaluate</strong> remaining samples with LLM judges on (#4) and prompts on (#6).</li>
      <li><strong>Calibrate</strong> thresholds with human subset (#5).</li>
      <li><strong>Evaluate</strong> safety refusal behavior periodically (#7).</li>
    </ol>
  </li>
</ul>

<h3 id="citation">Citation</h3>

<p>If you found our work useful, please cite it as:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><div><button class="btn-copy" data-clipboard-action="copy" data-clipboard-target="#code4"><img src="https://aman.ai/images/copy.png" style="margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;"></button></div><code id="code4">@article{Chadha2020DistilledDataFiltering,
  title   = {Data Filtering},
  author  = {Chadha, Aman and Jain, Vinija},
  journal = {Distilled AI},
  year    = {2020},
  note    = {\url{https://aman.ai}}
}
</code></pre></div></div>

  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">
   <div align="center" class="wrap">
      <div align="center" class="footer-col-1 column">
         <ul>
            <li>
               
               <span class="icon github">
                  <a href="https://github.com/amanchadha">
                     <svg version="1.1" class="github-icon-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve">
                        <path fill-rule="evenodd" clip-rule="evenodd" fill="#C2C2C2" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761
                           c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32
                           c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472
                           c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037
                           C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65
                           c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261
                           c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082
                           c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129
                           c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"></path>
                     </svg>
                  </a>
               </span>
               <!-- <span class="username">amanchadha</span> -->
                | 
               <a href="https://citations.amanchadha.com/">
                  <svg version="1.1" class="mail-icon-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve">
                     <image id="image0" width="16" height="16" x="0" y="0" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABJoAAAVjBAMAAABzrVjQAAAABGdBTUEAALGPC/xhBQAAACBjSFJN
                        AAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAElBMVEX///+xsLCxsLCxsLCx
                        sLD///+bxiTSAAAABHRSTlMAAKP3FWDuDwAAAAFiS0dEAIgFHUgAAAAJcEhZcwAACxMAAAsTAQCa
                        nBgAAAAHdElNRQfkBwQDMic2f+cwAAA03klEQVR42u2dW3IdOZJEu81mAcMqbOCacQMy0wImVNr/
                        msZKKpVeuHkzEA8PIPx8douAh+MkkmKR1H/+QwghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQ
                        QgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIeQQ/vt2KOMzyeH/GtiE7rgP/3u+TQPdcRukgU3o
                        jtsgb+fbNNAlt+GtgU3ojtsgDWxCd9yGT2/n2zTQJbfhrYFN6I7bIA1sGuiS2/DWwCZ0x214a2DT
                        QJfcBelgE7rkNrw1sAndcRukgU0DXXIXvsl0tE3oktvwb+MH2zTQJXdBOtiELrkL32U62KaBbrkL
                        P3R+rE1/oEvugnSwCV1yF/76sfRTbRrolrvwU+un2oQuuQvSwaaBbrkLP9d+qE3okrvwS+1n2jTQ
                        LTdBOtj0J7rlLvxa/JE2oUvugnSwaaBbbsJvMh1pE7rlLvze/IE2DXTLTZAWNqFbbsKnSfXn2TTQ
                        NTdh1v1xNg10y02QFjahW+7CtPzTbBrolpswb/80m9AtN0Fa2DTQNTfhSf2H2YRuuQmPFja9o2vu
                        gTzr/yibBrrmJjw9gKNsQrfcBGlh00DX3IPnMh1lE7rmJlycwEE2DXTNPZAeNqFrbsLVEZxj00d0
                        zT24PINjbBromnsgPWxC19yE60M4xaaBrrkHL07hFJvQNfdAetg00D334NUxHGITuuYeSA+b0DU3
                        oYdNA11zE3rYhG65Cy1sGuiWu9DCJnTJbehg00CX3IYGNg10x31oYBO64kacb9NAV9yI821CN9yJ
                        420a6IY7cbxN6IJbcbpNA11wKw63ib8YPJXDbULX24yzbRroeptxtk3odrtxtE0D3W43jrYJXW47
                        TrbpHV1uOw62aaC77cfBNqGrbci5Ng10tQ051yZ0sx051qaBbrYjx9qELrYlp9qE7rUnh9o00L32
                        5FCb0LU25UybBrrWppxpE7rVrhxp00C32pUjbUKX2pYTbfqILrUtB9o00J325UCb0JW2YEz/1/Ns
                        GqpWyBIy5v/zcTahi27Bk2f2OJuGqhWyhDSx6Q900R2QtyY2oYtuwVsTm4aqFbKEdLEJXXQLnj+2
                        Z9k0VK2QJS6aPssmdNEdkC42DVUtZImrqk+yaahaIUtIF5vQRXfgr8sn9yCbhqoWssR12QfZhC66
                        A//qMq7/7+1tGqpayBIv2j7HJnTRHfhuy3jx/29u01DVQlaQV3WfYtNQ1UKWeNn3KTahi+7Aj66M
                        l39iY5uGqhayxOvCD7EJXXQHPnSxaahqISvIjcbPsAnddAfuPL9H2PSObroBv4gy7vyhLW0aqlrI
                        Erc6P8EmdNEdeHSxaahqISvIvdIPsAnddAduPsL72zRUtZAV5Gbr+9uEbroDd5/h7W1CF92BSe1j
                        +gd3t2moaiEryO3ed7cJ3XQH7j/Fm9s0VLWQFeR+8ZvbhG66AZ8Uj/HeNg1VL2QFTfN724RuugFP
                        BBmaP7yHTeimO/Ck+jH9wzvbNFS1kBVE1f3ONqGbbsBTPYbuj9e3aah6ISsoy9/YJnTTDXhux1D+
                        +eo2DVUvZAVt+9vaxF8MHs+FHEP7AbVtQjfdgCs3hvojKts0VL2QFfT972oTuukGXKox9B9S16ah
                        6oWssHAAm9qEbroBK4/znjYNVS9kAVk5gS1tGqpeyApLR7ClTeimG/DKi7H0URVtGqpeyAJ/rZ3B
                        jjahq27A4hO9oU1D1QtZ4KUVb3+ufVw9m9BVN8BwBJvZNNBVn49YTuDyg6vZNG71QQy8kOnlx29k
                        E7rqBpgPYBubBrrq8xHzATxfoZhN6Kob4HAAm9g00FWfj1wewLttjVo2oas+H3E5gC1sekd3fT7X
                        BzBurvLMyUo23Z2FLCPXJ3B7nQ1sQlfdAK8TqG/TQFd9Pg+vE5DyNqGr/p1fAn5E57EiL05gWFeq
                        Y9P9UVLYIqTLTN95v71SeZvQVd+tfaDDLSOOR1Dcpo/oru+XPtAJF3l5Bua1qthU5oReulQqrYbX
                        Y5kXq2ITuur7ldfKe58bj4m5pyI2DXTXVx1N+dO+W7XZhnm1Ijahq/6C6DJ/ROf1Hm6Yl6thk2aO
                        MPZM7TidZp7KNqGr/nzjR8yK5r7JnWmGYr3CNqGr/qx+yxVK7jfeMC9YwSbNFMi2N9bJ/Rzq2oSu
                        2iBThfBu8w3zigVs0gyBLHtfnW7ON8xLFrAJ3bVNpgL5X3JzkGHuDG+TZoYQPlknQA/wCrk5xzCv
                        CbcJ/4vB7TOgJ3AacCjWLGoTumoHmQo8EVfI3TGGeVG0TZoJQjhjigtuy3SATft0vatOMUOUtAl9
                        Ck4yFf5RQMWEw7ws2CZ01+dM4jDhUCxb0SZNfnDVm+oUdRoFbUJ/x5mYJ1g8i5oTaiYoaBO4avOX
                        LevrFDZAPZvQ9XvPAx5ngqjyD/PKSJu2qtr5NFJQfgegJn85m9DlnzeRcUJN/HI2gasW8wDlRjJO
                        OMxr42zSZI/gxJlsE2rSy3QFmE3o4h8hU4GH+gnRhh/mxWE27Vb1HmP9gP7rH8PcH8omTfIITp3L
                        MqEmu0xXQNkErlrMAxQdzDLhMC8PskkTPIJzJzNMqIku0xVANoGrFvMAZUczTDjM62NsQncdOZvm
                        TMKQ6OTzDSA2oQtf6vo24OG+EH4s8wohNm3Z9T7jrT4uw7wDwiZN6jpd7zPf6uOiyT3vEGETumsx
                        T1B8wMda7GHuEGCTJnQIp08oCbHnewBswladcDWhR1xNPcwl5tv0EVt1wtUEvpwkI/V8k3SboEWb
                        ytaAHDDlaOYtptuE7NlWdtTBlJlPE1qmK2TbBKzZ3LYG2HiynllzNvNtsm2CtezQdtTJuJKUeV5j
                        sk2wkj3aVgEaTwyRNYcz3yfXJvwvOrK0reIjZj5L5GHuMdcmTMOvWwhAczR+pEWe95hqE6Zhv7pV
                        IKYTU2LN8cx3SrUJUbBn3WFn40Ve4nmRmTYh+r1VQgzbTac5n/lWmTbl1/sb0SOuHo4Lkhh4vlei
                        Tent+vetI3u6zAOaN5lnkyZrFGKeovDE5uE0eeeb5dmUW+2c2Aktp1NhOE1ema6QZlNytYoK4kgd
                        7kPqEc2rTLMptVlVBXFojqfAbJq48+2ybMos9imRA07ZazbNGcl0hSybkr1RNBCJ5nzws2nSzvdL
                        simv1uDGlaTNln1I8y5zbNLkrN24ko87jaY5JZmukGNTvjkTlv6N+sQDMiDmoNqw8x1TbErqNKVy
                        JTmj5R/TvMwUmxDuRFUeeELLiDmmOut8ywybUhp9TdR41yQM5vUK15yTTFfIsAlkz635w/kYP5lX
                        1GFuM8Gmd4w99+YPR3NE4ME0UeebxtsUX+c9YqZ7zT6DaU5KpivE2wTTJ6r0wDNaQcwJV5LOdw23
                        KbrM/NK1xM7l+I/saY5qXme4TUiDfuQRMh2+AcegQ7GtTFeItkmTcJfWK1Ug5nhrQef7RtsENegH
                        nP/V1TIdeOYcin1lukKwTViFXk6fg+aUkGNpcs43jrUpsEclD//hCrQg5myrOec7x9qEdug7/rNV
                        qME35lDsLNMVQm3SxAvGX5ECPYg52XLM+dahNqEVCus98Jg0AGPOC420KarEBcQ8jImYoR7A85oX
                        GmkTWqEfcPcj7pyMB5qUcr55oE1og37E3Y8CXbiHHIrNZbpCnE2abNGIeRojW8ykObH57nE2oQ2K
                        bT7woG6CDTlvNMymgP4qNa9lh5E0RybTFcJsQgsUXT24DjEn+p1h3j/KJk2yeAKqB/ch5kS2jPP9
                        g2zC/2Lw6Oq1eM8UEHGYKw2yCe3PndFz8Z4pIOIwVxpjkyZXAhF2oCsRcyJTxPn2MTah9fmFCDvg
                        nfgnHIrdZbpCiE2aWBnE6KGk/lCaY5PpCiE2oe25NXk2mrPCTKVJON89wibv3ur1vsKf5afSnNt8
                        9wCbNKFS8O99Ce+x3ANqDm7eaYBNaHnia48/rPUDTQo439zfJu/S7MQJAi1GzIkMAeeb+9uEdud3
                        4gTBNuOdbyj2lukK7jZpIuUg5pmceHcezDuf5ujmpbrbhHbn7uAANKeFGEyTb763t03ejRUsfZ3i
                        g2nObr63s02aQFnEGqKh+GSaw5PpCs42oc1J6DzpuACTaeLJdAVfm7zrqth5oXrEnGg53nxrX5vQ
                        4kyJdgTXj5gD/cQwb+1qkyZOGs6Vm3h3ns03neb45q262oQWRzE3Bs153QGXbt6qp03vaHEUc4Mo
                        Pdsw7+xokyZMIr6NGyk9m+YA5zs72oTW5gkZkoQcWPpwmnAyXcHPJu+iShaeeWDpw2nCyXQFP5vQ
                        1qQUbsZ5ODEH+oFh3tjNJk2UVJI0uYnzcGIOtHiE843dbEJLk9J37ollT6fJNt/Yyya0NDl9557Y
                        HVDZ5rU62eRdkh9imCoC5/E8o2kOcV6rk01oZ7Rj4yg83jDv62OTJkcyiaIgqhJzoLVo8319bEIr
                        c0GiKO5HljyfJppMV3Cxybuhom37UHc+zTHKdAUXm9DGJLXtQ935hmJbma7gYRNamKy2889s+VjD
                        k823dbDJuZ6yZQPOLHdATbL5tg42oYXJKtuLsgMO87Z2mzQZ8nEs2wvnCf2CaU5y3qvdJrQvK1ND
                        0RzaDTDB5r2abXLuxhtZGioU58Ywwea9Wm2q9YvB706NpeqEw7yr1Sa0La8AyJLcmZjzfGOYdzXa
                        pAkAAWFLbmlizrOSa76r0Sa0LC9B2OJ5apkjanLJdAWbTc69BIDx5QVFR9ScpkxXsNmEdiWxak+K
                        jjgUm8p0BZNNmu1BgHy5xndEMedZOM75phabvH+fegCfUMK4HdvqwQbHmm9qsQmtSmbTrmiOLXFG
                        Taz5pgabfDuJwa1pX3yH9EqlOdB5sQab0KasDw3Hd0ivVMNc7LpNmr1hiG6mLHy7Q6SaF7tuE1oU
                        w9BwNOf2GkSqebHLNvkWEoWoZkrDtzyvITWp5nuu2uTbRxheRXtTckjNmc73XLUJrUly0d6UHHKY
                        91y0SbMxkgfUmaT+xBxHH2q+56JNaEvugnXG5+Be4vUFf00oma6wZpNrGZGgrckpEBBKpius2YSW
                        JLtnfypOORRbynSFJZve0ZJk9+xPxSmHYkuZrrBik2ZXMGhpnlJxSs25ynSFFZvQiuT37I/m5BaP
                        NjTTfMsFm1yLCAYtTU6JYo6jzjTfcsEmtCEa0NLktCjmNF8Y5i31Nmn2hIN25jmeU4o5jfpk51vq
                        bUILogLtTE6NYk7zhWHeUm3TR7QgKtDO+BzdK/7KjyTTFbQ2eZaQANqZpCLzI8l0Ba1NaD0gNUeg
                        ObqkMTWRZLqC0ibXDhJAO3NBvTE1hyvTFZQ2oe3A1BxCvTGHYkeZrqCzSbNfCdDKXFBvTM3pynQF
                        nU1oOUA1h6A5u7WzjUw031FlE9oNPWhlnM5u7WwjE8131NjkOX8SaGWS2hRzGm2i+Y4am9BqLIBW
                        5gLP3xgq5jR/M8w7KmzSbFYFtDJXOI4p5jDaA57vqLAJbcYKaGOS+hRzmL8Z5h3v26TZqwxoY65w
                        HFPMYbQnPN/xtk2areqANiar0fRAMl3htk1oL4AtB6E5vJQ5NYFkusJdmzxHTwRtTFal6YFkusJd
                        m9BaIFuOotqcQ7GhTFe4aZNmo0qghbmk2pyaQ5bpCjdtQlsBbTmKanMOxYYyXeGeTZp9SoEWxu30
                        MubU5JHpCrds2uAXg0e2HIXm9F7wyM4j0xVu2YR2Yh20MG6n9wIxh1HmmW94xybHqbNBC+N2ei8Q
                        cxhlnvmGd2xCK2EALcw1fnOKOctbkk2aTaqB9uUavznFnEV50PMNb9iENsIC2pdr/OYUc5a3HJve
                        0UZYQPvid3zXiDmLMs58w5c2+U2MAO2L3/FdI+YsyjjzDV/ahPbBBtoXv+O7RsxZlHHmG76yyW9g
                        CGhf/I7vGjFnUcaZb/jKJrQORtC+vMBtTjFHeUuwSbNBRdC6vKDWoEOxn0xXeGET2oYKJQdSa9Ch
                        2E+mK1zbhJbBjLyVxm9QjzTDXOylTZrlayJvpfErODvNvNhLm9Au2JG30mjO75rsNPNir2zymxWG
                        vJXGr+HsNPNir2xCq+CAvJVGc37XZKeZF3thk9+oOOStNm6DeoQZ5mIvbEKb4IG81cZtUI8ww1zs
                        c5vQIrggrxoE4zaoR5hhLvapTZql60KbatiE9sCH6jZpDvCS2ja5jYmFNpWwCa2BE7Spgk1uU6JB
                        60KbfH/DJxa0Lq+oNOdQ7KexCe2AH2hbaNM57znaVMAmtAKOoG2hTZpVq4O2hTahDfAEbYvnCUbP
                        qcly2yavAUuAtqW7TV7z1QBtS3eb0Ofvi9ytkjZF2OQ1XhFoE9Qm9PE7U90mr75r2qRZcQdoE9Im
                        9Ol7Q5uANmkW3ALahLNJs94e0CacTeiz96e8TZojvKCgTU6TlQJtS1+b0CcfAdqWtjY5DVYLtC1t
                        bUIffAhoW7ra9D/ogw8BbctL6ow5FPu9tOm/6F5DekYPkTMlbfIcTjt2IWhTCrSJNvlBm2iTH7SJ
                        NvnRxKZ32pRBE5t8xsxOMq/1eJvKf4mANm1Ucw+bPmUnkekKtAmNy5iSnWS+IW1CQ5v2qZk2xSSZ
                        b0ib4NCmDJxscik6kjJD0ibaRJvch6NNyYXPN6RNcMoMSZtoE21yH+4K9ByvoE0Z0KbkGWnTATZ5
                        zJkeRKYr0CY4tGmXlp8PXgfatEvLtCkoyLxU2gSHNu3SMm0KCjIvlTbBoU27tOxXdek5JT3IfEfa
                        BIc2bdLyFjY5fDFc0guf70ib8NCmBNxs8uk6jioT0ibaRJvch2tu0yO98HmntAmPfcL8wueddrCp
                        +qfhVQakTbSJNrkPR5uSC5fpCrQJT5UBaZNh9DJUmY820SbalNTyJja9F5mPNp1gk+YUadMqbjYV
                        /zScNmVAm3LHo020iTbdw8+mD+hRLqFNGfjZJOYskdCmDGhT7nS0iTbRpnv42VT703DalAFtok11
                        Wu5iEyKHTFdoYpOYwxSeE5FjXihtwkObdmiZNsXlmBfaxCaXf7+t6JyCyDHftIlNpT8Np00btEyb
                        AnPMN6VNeGhTCo42uVUegNEmSI55n7QJD21KgTbRJj8cbar8iZPNJoHkmO9Km/DQphRoE23y493R
                        Jr/S3bHZhMkxr7O0TbaaaVNgjnmdtAkPbdqg5rDWS40pmBzzbWkTHtpUv+YmNn3A5JDpCqVtcv0S
                        gZjTRGGyCZRj3iZtwkObcvC0qe6rzmKTgHLM96VNeGhTDrSJNtXoObT4MlOicszLpE14aFP9nlvY
                        5DoTbdKAniZgSkHlmG9Mm/DQpiRcbXKt3hGDTbAc8y5pEx7DSK45aFNvm3wnok0q0NO4DymuOY63
                        STNgQ5twZct0hVY2iTlPCLQpCdpEm/z409Wmoq+6Kk/H8Ta1+DScNpVvesoDPY7vjM45aJMOMecJ
                        QHOItAlU9fk2eU9Dm5Sgx3EdUYBB5nvTJjjLIyKDyHSF6jb94WuTmAP5Q5vyoE1ps9AmLehxJrzT
                        pjTOt6nMKA1s0oy43AIU2pQHbUqbhDapQc/zO7SpftnH2+QfhDapEXMgZzRnSJus0KasOTrYtNj2
                        U9DzOM33AZtEpivQJjSL84GTyHSF+jad/qp7LzMFbapxDvnjRUxBmxZAz+MyXkSSFjZphqRNSUXL
                        dIWGNok5kSt1ZqBNC3xCD+Qw3Qd0FJmusIFNZ3/itGYTPIpMV+hok5gTObJkU8wEPWxaKpw2hUaZ
                        J+hoU6lXXaEBaFOhw1hjJf9f+J5lusIONh39iVOh/LRpiUJfI9Cc4L8UyCLTFbawaalywHFkjVYg
                        i0xX6GmTmCMhR4tK38Smgz9xWrGpQpZ5gz1tqvOqqxS+i03v3jY90BN9YyG7RGXpYpNmTuyJaFnI
                        XqLleYF72OT8q3kjj0THymNSIoxMV9jDpmM/cVqwSUqEmafoapOYI7mwYFONMPP+NrFpoXXYoWjQ
                        5w78Oj5tameT1Ch5HmMTm0591ZV6CmjTOuiJ/kZzfvEPQR+b9L2faVOVNDJdoa9NYs5kp9Yz0Mem
                        M191tR6BRjZpRj3XpjIVy3SFxjaJOVP6TLGRG9l04qtObVOdODJdobNNj+1Gio3TySbNrJZGEikW
                        mDaZ2G2iQnlkusI+NgW86sScyYTWpui4rWx6P80mbdzoPK1s0j7KBc7nmmrut7LptFed9ukoFWje
                        XG+boJeT0iYpFWieZiebtA9zcZuUUaVUv/M0O9l02KuunPi0yQpuGM3Z5XjfzCblARQ5JJ9hiiWa
                        97aVTf4/pBn1a9puUM/6Zjad9KrTHF1SzG42KY9gvZZqo6SkpE12QKMUDNnNpohXnZhDxU+Sk7Gd
                        TZqB77LBIPUyyXSFzWwK+Fsd5lswVQklJ1M7m4551akSJmXqZ5Nm4mKHtTyGFAw1z7SbTYdcTu8V
                        badNLtSeQrJCNbRJM3K581oaomSqeWXb2XTE5VRT9Y42fQyw6ZE8Q03TO9qkmdnWTYkREqN1tOmA
                        V13RZC1t0gxtKyeKosFa2vRHgE2pl5Pm1KrmkukKG9oU8qoTc6qQ/Jmxmtqkmfo2NeOX7VWmK+xo
                        0+aXk+LQ8kIpg51kk2bs26Slr5hJXatMV9jSpq0vJ8WZZUXSJ6NNr6iXPbnVrjZp5jYW5I3i6xuP
                        wq3Oy9rTpo0vp/tHJtmltrVJM3it4ysm92qp8642tWnby+n+iUl6p31t0kxe6QBLqW3odF7VrjZt
                        ejndPzDJr7SxTe8RNok51gsKif07jW3SjF7mDO+HluKVzvNta1PMq07MsZwyIxrtbJNm9iKneD+y
                        VG90HnBfm2Iup9DfNVdE6me0tkkzvLWm5MCBIZwKnSfc2KaYyynwWiguU3ObNNNbe0qNu0Gf85Z2
                        tmmzywnv8wua26QZH64Ten/fOmW6wtY2BV1OYs414f5RhWzvG/FMmzTzK4iIit3dvU2ZrrC3TUGX
                        U8CB3j8pgZXZ3iZNAeauDNz/7a+f9ihz3tDmNu1yOeF2VkCbNA3gdLqfUjbpcp5zd5uiLicxB/sB
                        xTEhq6RNYZeTmJN9ByRxZJXzoNvbFHU5OR6sYlNok7Qp7nJyO1lFQNmmyXnS/W2K+Q5xP500Z4Qt
                        kjb9TZRNLoerOaIHtkfapG0hWyfNP1olG/U4z3qCTXGXk/kL06rf0YmukTapa8jVSbOX7FTjPOwR
                        NsVdTjaddL89GF0ibfqHkF/6bNZJ9w99CrpE2rRShJakTOgKadN3Am1aPGelTIJukDatNZGikzYQ
                        ukBlZJmucIpNcV8Rf97dFfE7+EObvhNpk/bq0JzLyvox0Ka1LhaQ+0l0f5fTrl6jwXngc2wK+Uc1
                        V058ZW10d1+gTT8SbNO9Mw8VNRbatNpGjE+rCdDN6dPLdIWTbIr9e91ljV+IWDMT2vQzCTZ9nv/H
                        Fs1J/Aa6toUZZLrCWTaZznRRAfueYpgY1d4881k2perkBrq0lfJkusJhNiW961wR89BO0KbfQLtB
                        m06ySVNJDdCNLVUn0xWOs2k7ncQ8MaK5eerzbNrtXYeu6zu0aQbaDxViHtcN2mRtBQ66rMXeZLrC
                        iTbtpJOYh8XUNs99pE0bvevQTf0IbXoCWpK7hP4jQVpo0zPQmpgOBQRt8mgGCLqm5c5kusKpNu2h
                        k5jHRFU2T36sTVvohO5ovTGZrnCuTRvoBPxN89bCZLrCwTbV10nMI8L6mkc/2abyOqH7MdQl0xWO
                        tqm4TmKeD9fWY7rC2TbV1gldjqWs+QqH21RaJ3Q3v0GbXlFXJ0FX8xu06SVldUIX8zu0ybekRIp9
                        sUlZ1HyBDjbV1EnQrfzOsIZvYVNJndCdTKBN3j1lIeaZkC09Sd/Epno6iXmkAG6nf/LxXWwq97ZD
                        12Hr6MnH97GpmE7oNkwVPfv7aCObSr3tBF2GqaFn6TvZVOl6Qjcx565NH558fC+b6lxP6CKeYEzf
                        zKb43wN9D0HX8ARj+nY21XjdiXmKGAZtiqksFHQFT7Gl72hTAZ/QBZiakacf3dMmtE+CHt/Uy+Pp
                        R3e1aenf1mlg051X3fMP7mvTG/DzcfTgFwzLo9DaJtgLDz32FZbwzW16gwgl6JktfVyFp01/c9uD
                        Ty6vR0HPaynj6kNp0zdeOvD1j/1xvE3jMvvj6kNp00+8Pv3rru+BnvIFVyPK5UfSJiUNbLq4pl/8
                        oA1tUuIgU3mb3laT0yYlDjIJeoblKV99GG3SMXrYNNfp5UfRJh1dbJoMeiM2bdLhYRN6hqVR5c6H
                        0CYdDjLtYtMCtEkHbbqCNqnweNHRJvIVD5sEPUQctEkFbbqENqnweNEJeog4aJMK2nQJbVJBmy6h
                        TRoGbbqENmlwsQk9RCC0SQNtuoY2afCQiTaRr9Cma2iTBtp0DW1SMGjTNbRJAW16AW1SQJteQJsU
                        0KYX0CYFLjLRJvIF2vQC2qSANv3nNv9FRy0PbaJNbgzaRJvcoE20yQ8nmwQ9hwHa5AZtok1+0Cba
                        5IePTLSJ/A1tok1+0Cba5IeTTTt/iYA2uUGbaJMftIk2uTG8bHqgJ1mHNnnhZpOgJ1mHNnlBm2iT
                        H7SJNvnhZtPGn4bTJi9oE23yw88mQY+yDG3ygjbRJj/cZKJNxPNfKEePsgxt8oI20SY/HG0S9Cyr
                        0CYvaBNt8sPRpm1fdbTJC9pEm/zwtEnQwyxCm7zwtOmTPQ4E2uSFp027vupokxeuNgl6mjVokxe0
                        iTb54WrTpq862uSFr02CHmcJ2uQFbaJNfvjatOerjjZ54WyToOdZgTZ5QZtokx/ONm35qqNNXnjb
                        JOiBFqBNXnjbtOPlRJu8ePe26YGeSA9t8mLwVUeb3HC3acNXHW3ywt8mQY+khjZ54W/TfpcTbfIi
                        wCZBz6SFNnkRYNN2lxNt8iLCpg/ooZTQJjcCbBL0TEpokxsBNu32qqNNbkTYJOihdNAmNyJs2uxy
                        ok1uhNgk6KlU0CY3Qmza63KiTW4MXk60yY0Ym7a6nGiTG0E2CXouBbTJjSCbdrqcaJMfQTYJeq77
                        0CY/gmza6HKiTX5E2STowW5Dm/yIsmmfy4k2+THaX060yY8wm7a5nGiTH3E2CXq0m9AmP+Js2uVy
                        ok2OxNkk6NHuQZscibNpk8uJNjkSaNMev4+eNjkyAnUS9HB3oE2ORNq0xbuONjkSapOgp7sBbfIk
                        0qYdLifa5EmoTYKe7jW0yZP35pcTbfJkNL+caJMnsTbV14k2uRJrU/l3HW1yJdgmQc/3Atrkysfe
                        lxNtcmX0vpxokyvRNhX/lfS0yZdom2q/62iTL+E2CXrCK2iTL6P15USbfIm3SdAjXkCbnAm3qbJO
                        tMmZeJsKv+tokzPvnS8n2uTMSLicHughn0GbnMmwqey7jjZ5k2GToId8Am3yJsOmqpcTbfJmNNaJ
                        NnnzR4pNgh5zCm1yJ8WmmpcTbXJn9NWJNrmTZJOg55xAm/zJsani5USb/EmyqaBOtMmfkWSToAf9
                        DdrkT5ZN9S4n2hRAlk3ldKJNAXzMsknQk/4CbQpgdL2caFMEaTYV04k2RZBnk6BH/QnaFMFoejnR
                        pggSbRL0rD9Cm0LIs6mUTrQphMTLqdK7jjaFkGmToIf9Dm2KIdGmQj8QRZtiyLyc6rzraFMMqTYJ
                        etpv0KYgMm0qcznRpiBSL6cqOtGmIHJtEvS4X6FNUaTaVORyok1RdLycaFMUuTbV+KITbQoj16YS
                        7zraFEby5SToed9oUyDJNlW4nGhTHMk2CXpe2hRJ9uUk6IFpUyTJNuHfdbQpkGybBD0wbQpkdLuc
                        aFMk3S4n2hRJ+uX0ATsvbYok3Sbwu442hZJuk0DHpU2hNLucaFMsvS4n2hTLe6vLiTaFkfOPGpTS
                        iTYF8CfIo68IbnDa5AvUI/jlRJu8GGiJ/kVgHdAmB+qI9BVYEbTJRjWRviCoNmjTOiVN+sID1Aht
                        WqOuSV8AtUKbFkC78hrBFEOblAy0KPfAlEObNGyi0mfU5USbbvMRbYgKSEW06R5oOdQIoiXadAO0
                        GUsgiqJNr0BbsYoAuqJNlwy0EwYe+XXRpudgv7HETn5jtOkZaBfsSHpntGnKQJvgQnpttGkC2gIv
                        JLs42vQrqG/njiC7O9r0MwMtgCuS3B5t+pGzXPqcfjnRpu8c51L65USbvnGgS5+zLyfa9JUzXcq+
                        nGjT35zq0ufky4k2He1S8uVEm452iTblgj7tcDLLbG4T+qgTkMQ6W9s00CedQmKhjW3q4VLq5dTX
                        JvQh55HXaVebBvqIE5G0VpvahD7gXNJqbWkT+nSzeWQV29Cm3X94QI9kVdvPJvTRIsjqtptNJ32f
                        7n0kqd1mNg30uYJIqreXTehDhfHI6beTTQN9pjgkp+FGNjWWKetV18em7PP79DTJANgkKR23sSnv
                        4B638iQr9elWKCtNbEo6u4cmU65OKTX3sClBpoWHP9Umyei5hU1FT2qk6pRRdAebyp5Sqk4ZTTew
                        KfCEpG4096x3ON6muO8Y8PhrUqZOCWWfbtOofTZh8WhTAEGnJW4BE23yC/2Us22Kkck1YqJO8X0f
                        bVOETN5fVI7I+IRHeOEn2/TufyDinzJPp4Dwv3CwTbscR5pN8a+6c2366H0Wj6CgI82mqAn+5Vib
                        vGWSuKhpOgXO8JVTbdrqHLJsCn/VHWrT+0YuJf6EX3TtZ9o0tjqDvHedBM9xpE2uhyMZiZNsin4w
                        TrTJU6a/ciJnveuCxzjQJk+ZHjuGvkBipzjPJsfHPOdb87+SY1PwVXueTX7VPzJjjxydYoc4zia3
                        3jMvpr/J0UlCZzjNpk1qD41Om5wYXq0jwqfoFDrBWTZ5ySRbp8eNdpZNOzy/8fFpU6XT2H4A2HQn
                        2TTqP7wpE9CmMkch0BkSbIoc8BybfH4/KnoK2lSDI2TKeNcFpj/GJo9jEPQQbyE/aEObtJwiU8K7
                        LnDMU2yq3bIGj+fimrjsh9jk0PEDPcM3wnWKi36GTQ4HgB7hB6JtkrDkR9h0lkzhl5OEJT/CprNk
                        itcpLPgJNtnLR0/wK7QJxnkyReskUbEPsOlAmYLfdRIVe3+bzMWjB5gSalPYyNvbZJbpgZ5gDm3a
                        sXVBD/AE81OCGHp3m6ylR/VqhzalY/2mpqhaPaBNmzWe/ROYKkagTkGR97bJWjg6/zW0aau+0fFf
                        YH1WLpCYxFvbZKw7qNIy89GmxLKDGvUkzKaga3lnm0oW6orxeaFNaVWj49/iPcomCYm7sU0V6yw2
                        JG26yyjYZrUpadNdbG2i0yeNmVzAtjbZHlpBx0+akzbdo2CXMQTpJBFZd7XJ1jE6vQraFI3tewdC
                        mgzD9uDQpte8m5pEp1cSYlNICXva1OlqegvSKSLonjbV6zGUEWGTBATd0iZbu+j0C9CmQN6rtRiN
                        7fGhTVfYPmtCp18iQqeAmDva9F7tkUyANpVsFh1+kUGbChYr6PSr+NsUUMWGNlV7IHMwPUO0KaTW
                        gAazeKdNAZgaRIeHDZ5TxnY2jWKP4yaT06YpxfrbZnTaNMH0gAo6PXD2lDp2s6nYw7jR8LTpN0yP
                        p397O01Pm37D1B46PHj8hEL2ssn0cAo6PXh+2uTZJjq8B7SpSJmCDu+B6XGiTX5dosP74GqTeKfb
                        yiZLc6V/xeV9TA8UbfJq0r05ELSpQpHo8F6YHina9J1SxW3ZQvQjtpFNpqcSHb5IDbTpG5baBB2+
                        SA+06R9Mz6SAw3vyTpvslKoNiemxin3Ietjk3dq+TdCmL5ieSGz0UlXQpr8xtYaNXqsL2sTPwf3K
                        oE180f2Ml03ezexiU6XO8NAmE8NSmSCT16uDNlWqrAK0CdYeMngQgzaByhNg8DCcbHLuZg+bKj1/
                        NTA9X7SJNv2E7Xd/trbJ9CA6F1YF2gRp7oHLHYnpCaNNq+BiFy6lsU2mx9C5rzr4XE6+mXawqdLT
                        VwjalF8bLHU4LpeTb6QNbLK1hkpdvZeuNpnaElTq6sXQJtr0Ex6Xk2+i+jbZOgOFzoE2qTHZJKDQ
                        G1QTUVB9mwqVVQ7apMT2/GEyp0GblNCmsHIa2mTq6pBfKBfUDm1CdlUQ8+Xk21B1m2x1+XZVENqU
                        WBckciq0Ka8tSORUrJeTuKYpbpOtLN+qamK9nFzD0KbNoU1ZXSESZ2N73mgTbXKsqJNNxgcPkDgf
                        2nQXm00CSLxbR51sshUlgMTbleQahTZtD226xyhUVF1sLblGoU3bQ5vuYZPpr/zAGGhTfE1dPm2i
                        TfcYtCm+J9cktOkAaFNwSd49laZMS7TpAEaVlmjTAdCm2I4+d/q0yfQrVV2D0KYToE2RFdEm2uRX
                        UTebBm16gfX3qyfHhUKbAhtqZ5PhHneNQZuOoEhNdW0yykSbaJNLQV84/tej/MSgTdcYbZLkuFho
                        U1Q/tIk2+fXT0ab1m9w1RVmbjDLRJtrkUU9ES/Wp0RNtOoNRoqeqNv1Jm1TQppB2mtq0/F81XVPQ
                        pkMo0VNVm95pk44SPVW1ySqTpKYtwOrj5xqCNh3CoE3PoU1KaJN/N7SJNvl109em1dvcNQNtOgXa
                        9JSPtEkLbfKuprNNgzY9w2xTZtga0Kan0CY1tMm5mdY2LT6BrhFo0zEs9SSuEWjTMdCmJ9CmBd5p
                        0xyzTB1tWnoExTUCbToG2vQE2rQAbXoCbcpqTVwT0KZzoE1TBm1agTZNoU1L4HuiTefwEd4TbTqH
                        ldp8E9Cmc6BNUz7SphVo0xS7TLSJNn2DNi1Bm6bQpqzenH9zMW06CH1N4huANh0EbfJphTat9Sa+
                        ASraNGjTGrRpAm1ahDZNoE2L6Gt6+AagTQehL845AG06CNrkUgptWizOOQBtOgja5FIKbVoszjlA
                        RZscZKJNtxDnALTpIGjTBNq0CG2aQJsWoU0TPGzy7mkL1DY9nAPQpoNQ2+QdgDYdBG2aQJsWoU0T
                        aNMitGkCbVpEa5N7SbTpIGjTBNq0CG2a4GFTyy9f0qYJtGkRrU3uAWjTQdCmCbRpEdo0gTYtQpsm
                        0KZFlDaJe4BjbfKvqj60aQJtWoQ2TaBNiyhtergHoE0HobTJPwBtOgjaNMHFpo5/qaNNE2jTIjqb
                        xD8AbToI2jSBNi1Cmyb42PRIy1uGj+jH7VybJC1vGXQFBQSgTQdBm8yl0Ka14iL6Odemhp+G0yZr
                        KbRpsTgJCECbDgJeD206CHg9B9skaYGrQJuspdCmfxnwdmjTOdCmGU42/ZUWuAgqm0ISVLRJ1Up2
                        YYWhTeZWaNNabyEJTrZJ0hLXQNNbTDe06Rzw3dCmc9B0E5PgZJu6feKEr4Y2nQO+Gtp0DopmJCZB
                        RZv+9LIpqLOiaB7CoGYq2uT1xXDa9JSgCEfb1OtVR5vm0KYVFDZJUATadAy0aY6bTVGtlaRAL7Tp
                        GBS9REUoadNw0ykvM54CtdCmY7jfikRFONymsN7qoSgtrBXadAqK0sIyHG5To1cdbbIXQ5u+cb8T
                        CctQ0ia/LxE0etVV6IQ2ncL9TuIynG5Tn1ddhUpo0yGM241IXIiaNt2vBtldKWiTQzW0SV1ZYIjj
                        beryqrvdx6fAELTpEG73IYEhatrk9nMGwe3V4f7zF5mipk2ef6nrcTnRpgtok5LbNklkigY2hfZX
                        hRptFLXpnTbpuN1GaIqiNg3PyykzOIj7f20JjdHBJslMjuF2X7Fd0KYjuN1XbIyiNrl+Gt7gVVek
                        ihY2SWp0BEWaoE0nMIo0UdWm2/3cIjU6gNttBefoYZOkZs+nSg+06QSq9FDVJt9PnA5/1d1+9KKD
                        NLFJcsMnc9emyG+U+0ITm86+nMo8U2Vtuvu80ab7NoUH6WKT5KavWVV4krI2eX4z7+GX012bJDxJ
                        WZu8P3GKrxJGnQeKNu0PbXrNcNYpOX69oiQ+Sh+bEsrEUOhxqmuT96fhx15ON8cP/9LlW2WbvD9x
                        OvVyGoXGb2TToZfTe6HpC9t096G7zYfsCVIodDW1siml0KotpQxf2Ca+6u7wsdLsrWyS9BHKlJQz
                        emWbBi8nt45y0vSySdJniKbWc1TZJv9X3XmXU63HqJlNSa2mMWo9RaVteufl9IJiD1Fpm+4+eW0v
                        p7sFZU1d2qY//G0663KqNnRpmwI+cTrrcqo2c22bBi8nj3rSAvWzSQBzBFFu4to2Rbzqzrmcyl1N
                        HW0SxCDIcvISFbfp7uOn4oGYBNeN5EXqaNMh77qC0xa3KeRVd8a7ruDV1NOmIy6nirNWt+nuE9ju
                        crr73wlSR61uU9Dl9MAM48h7waupq03bv+tGyUHL23S7Nh2CmcaNmnOWt8n9B8iPuJxqXk31bYp6
                        1e2tU82raQObbj+GSpKLxnSSnKuvTTvrVHXE+jaFver2fddVvZp2sCnsctpWp6pXU2+b0tv2oe7T
                        soFNca+6PXW6/XTlT7eDTXGX05bvusLDNbdpQ51ujyb52XawKfBVt59O9x8tQLgtbLrfoB7BjbVE
                        6cG2sCn0ckK0ntEEIh1t2kqnUXuqPWy6X+IKD+BkYT1A8u1hU+zltM9n4vdHEki+TWxSPJQH61R+
                        Itq0j06KEgSTcBObgl91W+ikeaJAEXexSVPloTophhFQxF1sCr+cyuu0wyzb2DSa66SZRFAht7Ep
                        6mdXNtFpj0G2sSn+VVdZp6EZQ2Ax97FJVegiD/CMPrPjcu5jU8blVPS/2e0i00426To9SCfd4MgJ
                        NrIp5XIqqJPyKUJG3ckmZa2roMe0TS3IrLSpuE7aoaFhd7Ip51WHPpGf2UqmvWzSVruMoCddnRgc
                        fCub0i4n9Kl8Q/34gPPuZZO63XXQoy6N+wAH3sumvMupgk4ftZEFnXgzm9RPqwEBz7rhA7CZTZmX
                        E/h09HEf6MPZzqbRRKeFOQV9NvvZFPHvkBc8oQWZ8O+5DW3KfdeBzmiboL+wn00rj60FyR9xk5i/
                        s59N2ZfT588fcucbKxk/oU/lCxvatNS2jczx6id8zoY25V9Oie+RsZbvA/pMvrKjTYuN7+BT6XCv
                        2dGm5K8S5B3ZcjT0gXxjS5sQ77r4QxtFcynY06b14sv6dPdfVp0g6OP4lz1tQl1OcT4ZEgn6ML6z
                        qU0JP0ee6ZMljqDP4gc2tQn3rgs4wHJyL7OrTcB3ne8ZGj5fKifTvjYNsE4+52gOIehz+IltbSqg
                        k1UohwkEfQo/s69N6HfdPzwW0797bC7oM/iFjW1C/r3uJ/T//d5rZ/QR/MrGNpV4131Dbqd23BR9
                        AL+xs01F3nX3jzd3NwBb21RPp3/466eUI2aTB7r939nbpqBz2gJBlz9hb5sa6yTo6mdsblPZd11L
                        mba3qalOgq59zvY2DfTBUqbvbG9TS53QnT9jf5savuvQjT/lAJva6YTu+zkn2NRMJ3TbFxxh00Af
                        MGX6yhE2ddIJXfUlZ9jURyd00dccYhPox38p08+cYlOLz8T/stcUyzE2NdCpxu9ouuIcm47XSdAF
                        v+Ygmw7XSdD13uAkm6w/6FgaQbd7h5NsqvNTLE1lOsumc7/sJOhm73GWTafqhK71LofZdKZO6FJv
                        c5pNJ+qErvQ+x9l0nk7oQhWcZ9NhOgm6Tg0H2nTUlzEF3aWKI206R6cHukkdZ9p0ik7oGrUcatMZ
                        OqFLVHOqTQd8Li7oCvUca9P2Ogm6wAXOtWlzndDtLXGwTTt/8iTo6tY42qZtdRJ0cYucbdOmbzt0
                        a8scbtOOOgm6s3VOt2m/tx26Lwvn27SXToJuy0QDm3Z626GrMtLBpm2uJ0H3ZKWHTXtcT+iS7DSx
                        aQOdPqArcqCLTdXfdoKux4U+NpX+UWB0N040sqnu607QxXjRyqaarztBl+JHM5sKXk/oRjzpZlO1
                        6wndhi/9bKrkE7oJbzraVOV19wHdgzstbSrhk6A7CKCpTfDXnaDnD6GtTVCfHujZg2hsE8wn9Nhx
                        tLYJ8fmToEeOpLlN2b95FT1tMO1test74Ql60HBo098kfHuBoGfMgDb9w6BKdmjTd4KEEvRcedCm
                        n3AX6gN6olRo02/4qYSeJB3aNIXvtyVo03N4J2mhTS/gjaSANt2DHt3hvk2EEEIIIYQQQgghhBBC
                        CCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCH/8P/T2g3wTNSy
                        bgAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAyMC0wNy0wNFQwMzo1MDozOSswMzowMFesjGwAAAAldEVY
                        dGRhdGU6bW9kaWZ5ADIwMjAtMDctMDRUMDM6NTA6MzkrMDM6MDAm8TTQAAAAAElFTkSuQmCC"></image>
                  </svg>
               </a>
               | 
               
               <span class="icon twitter">
                  <a href="https://twitter.com/i_amanchadha">
                     <svg version="1.1" class="twitter-icon-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve">
                        <path fill="#C2C2C2" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                           c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27
                           c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767
                           c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206
                           C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271
                           c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469
                           c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"></path>
                     </svg>
                  </a>
               </span>
               <!-- <span class="username">i_amanchadha</span> -->
                | 
               <a href="mailto:hi@aman.ai">
                  <svg version="1.1" class="mail-icon-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve">
                     <image id="image0" width="16" height="16" x="0" y="0" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAW4AAAFuBAMAAABTjO+8AAAABGdBTUEAALGPC/xhBQAAACBjSFJN
                        AAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAALVBMVEWxsLDGxcW4t7esq6u+
                        vr7Z2NiqqamxsLCvrq7Ozc2ysrK1tbWenZ2dnZ3////zevNgAAAAAXRSTlMAQObYZgAAAAFiS0dE
                        Dm+9ME8AAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQfkBwQDLRvUSpUpAAALt0lEQVR42u2d
                        PW8jyRGGR7Lk3XXEyNqQwAVKBewtiHMkwAfQoQ4L3B02ImCs98KVuFZzFfECm3Am4A7YDXmR/sQF
                        /gHO7+94R6Somarq7qr+mGra/YZifzzsfmc4XdNdappcOvjixZcX2VrPpj+az1r8QxtDqp/MRmfa
                        IDI93WKbxUgbRaS3D9zmUhtFolfmUUttGL6OOtjm+kIbh61Jl3t/nPLK9LXUBuLpAGDvi1NWkHs/
                        nPKtwVprQ/l1QGDvg1NWFLf5URvLp28NrbUCy+sfzJB6MUqD/SoeRagkk/M0nkOqFA+Rx2+H5zY3
                        8dzfK2CncIrGcBtztYfuvtdtJPdHJe7ZXtrEmPdx2MdK2OZ6P+1tzEUU9+/VuMdR3E/UuM/+L7lP
                        9pR7um3lry+G0iQp93lUKxL9rnJX7spduSt35a7clbtyV+7KXbkrd+Wu3JW7clfuyl25K3flrtyV
                        u3JX7spduSt35a7c+809Men0rnJX7spduSt35a7clVuiOzXuZQz2QyMK3POLcOzjHd/w3DEnBaa7
                        xgH3z1+nE2h6xx3u8McmFNYN4U55dIkOd6hTpkaZO8wp3QaUuEOO93ZdosUdchC86xI1bvmvT7+6
                        GrfUKX2X6HFLndJ3iSK3zCnoWJoet8Qp+EyxHrfEKSemIG6+U4jDi5rcXKdQJ881ublOwS5R5uad
                        SiePuOpyc5xC5yfQ5eakIaFcos7td4rlILQ2t88ptiwW2tw+p9AuKYDb7RTrcXl9bpdT7LlO9Lld
                        TrG5pAhuu1McSRVK4LY5xZURpwRu8y+6ht0lhXDTOSOcqTfK4KaSi7jzJpXBTTnF5RLE/eeEiRXO
                        BNzYKX8wEu6JSad3NPeC5RSLS+ZTNe6XNBFwynPLMOtxnx3SxXtOsbjkjer7tE9k8a5TLC5ZKL8H
                        pHvpOMWSg22kzH1EV9g55XhFfv6m0X7vSieP3CXL+97+sS63JVnn2jXcm9yFytxkctSHAadza82a
                        ArgtTtnQ3FEfbRMAanPTcB/aT55Rn8xvC+E+WFF03YI9bWvpc9MuXjb4lUir3Ztafe7mlKjzgWZ4
                        XMkVwA1fkd0D0j9Ky8bDnVF4vw9l5FvKP51IRQnclJPPmu8cLimEm3jse0fYft1ppQhuYsl+iROW
                        9lYUZXDjZc0NujX0V3CFcCOnzBv4TcYlcjeHPu6/91sphRvmDUbcoHgx3E8qd+Wu3JW7cv9Pcpf6
                        ezn1cLdBwQK54ZoHcy9K5EZrTMxtXhbIPTV+7h5jGdx4DUxxz0vjfrZicZuvCuM+NTzuzpqnBG4q
                        JktzP64xC+C2RDYp7sc1fQHcd4bPvYuh6HPTkXsb90PMSp2bflNi5X6IEapzr4TcW6dYuH/9Tzr9
                        28Vt+zdydu6NUyzcv5l0eufgPrBVsnNvdl0rc08CuHsvUXS47f8pz8XdOkWV+8heycXdvp1S5Z4E
                        cn+uq8n9yVHJzT2/UOQ+dFVyc5srRe63Edxmosa9cFZC3H+iyw3P3dfio4f7jN7Zps09e+LjZp2D
                        GZr7hhFn45w7Gph7MeLEB0+K437DimsyztUN8BzbUbufisFNVQXcGUV0PmJyExsQNLnbfYw8brxV
                        RZF7E2hlceOAnCL3uYAbhbb0uLfhYSY3DCW+DOaQ6hQCiriRU4YacNjvWMgNw1uR/9+WKzjPu4Af
                        m/vA1kJWWUeLzY1CLmM5hViwz3UANwxxhSR/EQrOcWdDoIAbBosYh6oj5RgpAbdj1vII9rfsfCbh
                        hgGMzE6B89tLryDiPnK1lFzO60nEjQJ0Sz6FWK+cJDJuuJszo1Pg3IJkYULuQ3drCQWuJZicTciN
                        gnRnPAqxfgL9zMDnUm7olJh0hg7Beb2CBcTc8KhgHqeA0VncRnOjPcwzP4VYn7x9yLlhWAKPRbTg
                        nN7gInJu1OqVl0MoNDKjJNwogPUmMfdzRvsh3JzxiBAMSC6oQiHcqOWbJqFQWI8clSBuFMBK6RSe
                        C8O4YQAroVPgXM7pYmHcKBqzaBIJueQ8KTcKYDGc8jNMxUsJOtAWYArlRnvhRh6g1+1AXvtKoSyJ
                        toKh3CiQNG+c2q4C5u4hR4HfcXJutD/LGTLcrRXdKw3oPntwKZwb7YdzDeUdAwXPoeNLhnOjMIHD
                        KV3bjqyl0DWztrcYwY2cYh3Knm3tt0zoEldgKYYb7XYaWwqe9ErZbplw/pyXQgw37okuBn8CR/Qo
                        QJcsXV1HcaPdfOTMop9A+jEMus4dVIrjRjue1kShE1iIdAq6yi8ycqOgEuFJIucO8RiGrhVPx5Hc
                        aK8Wcgq5nwIv7aDjfGGCWG6062kJCtD7V2agFHTJ4sLTbyw3ChkAp1gyM4EgALpOZr5uo7nRwfVL
                        56e0UybOT/NwoxHtVrHv+euWglc3IyQTz40c3LmDOfb8uUoxFiEJuNEd4/FeYHOJuxQnPJCA2+4U
                        +/7hVkuLl1iL7BTc6Bdxmw3IsX+41fbOE+KSRNzIKZv7wcTNvbnzoLq80EASbrxXb9bYzyL0nYJ+
                        lzguScWNwgef72ToieP6G8Ip6Npg7mxJxI0W4jf4xMoaz8CPREKQQbnxNqi/wT+0q7g7+Ef4ddn7
                        cVJxk2mlep5oC5Fn4uCXG5b7mQdpfF/Kc63ydxEl47ak0YMD6Z6WsQK3E2l3uTmnRbCjJSG3y7zn
                        nGmRvO1PyO0wb/embJ+WtaCvlNz0UVQDbspUXrh7iXazJOW2Hdcb9UpZMjXL9oQk5bY4BT7gTclS
                        S1FPabnJ46joAY8MTQj3PCXmJpxCLAOIox7S/SCJuYklDrUMOEGlpP2k5j6GQORiETlFvE04NTcc
                        SctiET12S984J+ZGPDNLQbjMkb5xTsttWWhGlRyCG43irbUoWsbP2L0k50YsrtoobHLL7CU9N5z7
                        9wlLZ+SGI+j5LRHNTkZuMQf8jZL8ZibknojnXV4jAzfjFRUUCiAuh+cOYgj4rqm5V6Ai77k0rFZC
                        btHL9Ueh5971sNzB/Qd+31TccL75kZDAmmm4Q0etIaIu6+G4Ud9jNjZ7M0gO7jtQSXZWMKh2Cm60
                        nUuEjUOG42G4Ub/nMu6g752A+xRUkZ89Dmghnlu4cZPSs4l4xqK5j+V9YuG0qtm5p6BC2BZ2cSux
                        3Ik2gqNZG+XlFvdnE+swRjrukyQuCWgpjjvhwRLh4Zoo7qQHeWRjEMXNOdjEl6i1GO7EB9VEB/Yi
                        uJMfDJSMQwR3+oOYghbDub1HaQPEn8FwbtBHkoPG/OPiwdx5DnazWw3l9hzLD9aEOYuh3KD9ZIkL
                        uCkoArnzJYpgthzGnTMxB28mw7hXmVzSypn2JI47b+IZVush3LkT/XBmM4T7LqNL7scFgFPjEsCd
                        Pz0Rowc59xCJw+CMpuD2txkv/9iIuW0J6tLKm1RNyg2DmF+xMOQ6hVyR3L72UsmXqFHIPVz6RE9P
                        Mm4YnsqZrnLqnFkZN2grWVYISnCM+mEJETcMYo5ycrt7k3DDwEPq/DhQrtmVcJ8M6BLfOAm4QQAv
                        cVYfSo4e+dxDu6QVmOFOqJPP/dzaRj7Zx4rNDYJ3GbKEUbL2yuWG33w2CDaa5V0wj8v9yVI/t2zj
                        xeQGgbuBXEL1fCHifkv+dRCBmX4v4abrDiRyzFjcIDyVKTelTYdU7yzuiZ5LWoGQ4SWXm6o3qMC4
                        LXncIDw1QP5sqCNMwOBe4W87tMDy/pLDDerkz/pNCYzd2s+t75JWiMLLfQe/qY7grPu4/1mCS1qB
                        8Tv1cIP5UcP2HGH3cI/1uN1H2N3cw/yvCZtOQ7mzBQN5ch1hd3Kf63K7jrC7uIf73zU2nYZwK7uk
                        lfUIu4v7XJu6sR5hd3FffV2CJmLuslW5K3flLk+Vu3JX7vJUuSt35S5P+8p9vafcc2/y1DJ1RWb8
                        Kl8fmo/aCEE6sy/1i9bal9S4UDXu3Nelqn2B/Z02RIBmjT1pY8HahC5PtDHE2mxf8mXeLU4PkeKn
                        8U0Nir2LFL9eabMIdN0JcB//5cW+6JcN8X8B85vetwnigQ8AAAAldEVYdGRhdGU6Y3JlYXRlADIw
                        MjAtMDctMDRUMDM6NDU6MjcrMDM6MDDsnuMrAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIwLTA3LTA0
                        VDAzOjQ1OjI3KzAzOjAwncNblwAAAABJRU5ErkJggg=="></image>
                  </svg>
               </a>
               | 
               <a id="theme-toggle" onclick="modeSwitcher()" style="cursor: pointer;">
                  <svg version="1.1" class="mail-icon-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve">
                     <image id="image0" width="16" height="16" x="0" y="0" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAMAAAAM7l6QAAAABGdBTUEAALGPC/xhBQAAACBjSFJN
                        AAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAACYVBMVEU/PzpEREBBQT1CQj4/
                        PztAQDtHR0NJSUU+PjpISERDQz9AQDw5OTRFRUE8PDhCQj1CQj89PTlKSkY+PjlNTUlLS0hEREBD
                        Qz9aWleHh4WtrazBwcHCwsLCwsLCwsLAwMCurq2IiIZgYFxXV1Sbm5rFxcXCwsKgoKBkZGFERECX
                        l5bExMSPj45LS0empqWpqahUVFCnp6axsbFTU09CQj6lpaSpqahISESRkZCNjYtUVFG/v7/FxcW7
                        u7vExMVhYV6ampmTk5FXV1S3t7eenp1VVVHCwsOYmJd3d3XIyMjCwsJdXVqEhIKrq6uGhoSnp6aX
                        l5aAgH6srKzAwMBdXVq8vLzCwsOZmZhNTUm3t7bDw8PCwsKYmJexsbCYmJawsK/CwsJOTkq2trXD
                        w8K9vb1bW1jBwcK9vb2pqaiXl5aCgoCvr66AgH6jo6OGhoNYWFXAwMB9fXvIyMjGxsZeXluamplM
                        TEi5ubmcnJteXlrCwsLGxsaTk5FDQz+dnZzJycljY2CJiYe+vr5bW1hUVFCcnJuVlZRGRkKmpqW4
                        uLd8fHl/f33AwMCioqFFRUFQUEyurq6wsLCFhYNkZGBSUk9SUk9hYV6JiYenp6bHx8inp6ZKSkZP
                        T0unp6bExMS6urm0tLSzs7O4uLjExMSioqGMjIrExMTKysuVlZRFRUFiYl6hoaDExMTIyMicnJtr
                        a2hhYV6Li4qxsbDDw8O+vr2zs7KHh4VlZWPHx8fGxsbCwsLJycnIyMjDw8PKysvExMTKysrMzMzL
                        y8vFxcXJycrFxcbGxsfHx8jIyMnExMX///9/oPL/AAAAuHRSTlMAAAAAAAAAAAAAAAAAAAAAAAAA
                        AAAAAQEYUJzK4+3kzJxYGSKE5+qSIgJe7GoGlqYMprcLAZapAl1uH/H70vMkhWYP1ZoW7G5G/fMb
                        UbpinWtbrMsd1OVuBtfn7m3IbMnlBNTozhzz1Z5sVq5Yt2YW7zf48iCTD9CiH/DzZwWv9Ctp0QsQ
                        rnABqNFKO82sAg22uF0fBwUfV7T7uw0Lp/PYycnV8qtu7/JxASeZ7vGgLh5hqebTrWUhilEqqgAA
                        AAFiS0dEyvO0NuYAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQfkCBYKLR1KuANWAAACD0lE
                        QVQoz23TZXvUQBAA4CG7R09K4ZANFtwKFHcvTrHi0BZ3d5dCKe4uxd1d7jbZJCQFwr9ik1wud83N
                        hyRP3uzOk5lZIE6IUK95i5atWktSm7bt2ncQQHTfg3MVUMdOnRNJ6kRS7tK1GxZSXEhIqH53SWE0
                        HUzp0TMPe6txUS9Vo1nB1N59wi6HivrqNBByv/7Y5gGRgTmU+6DBAufwkF85kCczhoZFwMOGa0Ed
                        MVKjbNRogOgYOahG8dhxJpXHx2DCxOBiY1I0f/IUykqmwjQllwpig+kJWjsDZiYCWop4yQpm6TQ5
                        G+bkVhKaW8LYPJhfR9UFUafcaOEik5ZBebbqFa4SlLf4Ny2vw/oS5CqJRpbavCxr5wpPScPlK0y6
                        ElZlNNJI5bUjtHoNY2th3R9f1/tKCjbINLkRNtWmdy5t5KsY2/yXWltg6zbNqxXylcS376Bs5y7A
                        u+V0JX2N7dlrUmUfArz/gL384KFMDR8+olBWeTQOJH7M4N2vOp6PPIzi6hN8gIyTSASCTp3mz9qZ
                        s43jYQEhAZoI587zPqkXLtrDRPClyzy9aV25eu1602Y3bt66fYen0+/WhNw5x/fuq8we/wcPHz1+
                        8tSyW2w8q8HeKcGR5y8s/gHTTPOffVdevnodyzhE+M3bd7Lp1JeZ1vsPH53/KEwx/xX06fOXqq+S
                        VPbt+4+fQjx1BP8DniGUSqIRNGsAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjAtMDgtMjJUMTA6NDU6
                        MjkrMDM6MDBYVnojAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIwLTA4LTIyVDEwOjQ1OjI5KzAzOjAw
                        KQvCnwAAAABJRU5ErkJggg=="></image>
                  </svg>
               </a>
            </li>
         </ul>
      </div>
      <div align="center" class="footer-col-1 column">
         <a href="https://www.amanchadha.com/">www.amanchadha.com</a>
      </div>
      <!-- <div class="footer-col-2 column">
         </div>
         
         <div class="footer-col-3 column">
         
         </div> -->
   </div>
   <!-- add permalinks to headers in kramdown -->
   <!-- <script>
      var headings = document.querySelectorAll("h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]");
      
      for (var i = 0; i < headings.length; i++) {
          headings[i].innerHTML =
              '<a href="#' + headings[i].id + '">' +
                  headings[i].innerText +
              '</a>';
      }
   </script>   -->

   <!-- add title case to section headings -->
   <script src="https://aman.ai/js/ap-style-title-case.js" type="text/javascript"></script>   
   <script>
      var headings = document.querySelectorAll("h1, h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]");
      
      for (var i = 0; i < headings.length; i++) {
          headings[i].innerHTML = titleCase(headings[i].innerHTML);
      }
      
      var toc = document.querySelectorAll("a[id^='markdown-toc-']");
      
      for (var i = 0; i < toc.length; i++) {
          toc[i].innerHTML = titleCase(toc[i].innerHTML);
      }      
   </script>        
</footer>

    <script src="https://aman.ai/js/nanobar.min.js"></script>
    <script>
    var options = {
      classname: 'my-class',
        id: 'my-id'
    };
    var nanobar = new Nanobar( options );
    nanobar.go(100);
    </script><div class="nanobar my-class" id="my-id" style="position: fixed;"><div class="bar"></div></div>     

    <!-- Scroll bar -->
    <div class="progress-bar"></div>
    <!-- Script used to generate --scroll variable with current scroll percentage value -->
    <script>
    var element = document.documentElement,
      body = document.body,
      scrollTop = 'scrollTop',
      scrollHeight = 'scrollHeight',
      progress = document.querySelector('.progress-bar'),
      scroll;

    document.addEventListener('scroll', function() {
      scroll = (element[scrollTop]||body[scrollTop]) / ((element[scrollHeight]||body[scrollHeight]) - element.clientHeight) * 100;
      progress.style.setProperty('--scroll', scroll + '%');
    });
    </script>    
    <!-- theme switcher -->
    <script src="https://aman.ai/js/mode-switcher.js"></script>
    <!-- mathjax -->
<!--     <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" id=""></script>
    <!-- make mathjax responsive -->
    <script type="text/x-mathjax-config;executed=true">
      MathJax.Hub.Config({
       "HTML-CSS": { linebreaks: { automatic: true } },
       "SVG": { linebreaks: { automatic: true } },
      });
    </script>
    <!-- Copy button -->
    <script src="https://aman.ai/js/clipboard.min.js"></script>
    <script src="https://aman.ai/js/copy.js"></script>      
    

<ins class="adsbygoogle adsbygoogle-noablate" data-adsbygoogle-status="done" style="display: none !important;" data-ad-status="unfilled"><div id="aswift_0_host" style="border: none; height: 0px; width: 0px; margin: 0px; padding: 0px; position: relative; visibility: visible; background-color: transparent; display: inline-block;"><iframe id="aswift_0" name="aswift_0" style="left:0;position:absolute;top:0;border:0;width:undefinedpx;height:undefinedpx;min-height:auto;max-height:none;min-width:auto;max-width:none;" sandbox="allow-forms allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-top-navigation-by-user-activation" frameborder="0" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allow="attribution-reporting; run-ad-auction" src="https://googleads.g.doubleclick.net/pagead/ads?client=ca-pub-5905744527956213&amp;output=html&amp;adk=1812271804&amp;adf=3025194257&amp;lmt=1766895470&amp;plaf=1%3A2%2C2%3A2%2C7%3A2&amp;plat=1%3A128%2C2%3A128%2C3%3A128%2C4%3A128%2C8%3A128%2C9%3A32776%2C16%3A8388608%2C17%3A32%2C24%3A32%2C25%3A32%2C30%3A1048576%2C32%3A32%2C41%3A32%2C42%3A32&amp;format=0x0&amp;url=https%3A%2F%2Faman.ai%2Fprimers%2Fai%2Fdata-filtering%2F&amp;pra=5&amp;asro=0&amp;aiapm=0.1542&amp;aiapmd=0.1423&amp;aiapmi=0.16&amp;aiapmid=1&amp;aiact=0.5423&amp;aiactd=0.7&amp;aicct=0.7&amp;aicctd=0.5799&amp;ailct=0.5849&amp;ailctd=0.65&amp;aimart=4&amp;aimartd=4&amp;aieuf=1&amp;aicrs=1&amp;uach=WyIiLCIiLCIiLCIiLCIiLG51bGwsMCxudWxsLCIiLG51bGwsMF0.&amp;abgtt=6&amp;dt=1766922494600&amp;bpp=1&amp;bdt=40&amp;idt=8&amp;shv=r20251211&amp;mjsv=m202512100101&amp;ptt=9&amp;saldr=aa&amp;abxe=1&amp;cookie_enabled=1&amp;eoidce=1&amp;nras=1&amp;correlator=1843652521734&amp;frm=20&amp;pv=2&amp;u_tz=330&amp;u_his=34&amp;u_h=600&amp;u_w=800&amp;u_ah=600&amp;u_aw=800&amp;u_cd=24&amp;u_sd=1&amp;dmc=8&amp;adx=-12245933&amp;ady=-12245933&amp;biw=800&amp;bih=600&amp;scr_x=0&amp;scr_y=0&amp;eid=31096042%2C95376242%2C95378750%2C95344787&amp;oid=2&amp;pvsid=8061364030643159&amp;tmod=112874479&amp;uas=0&amp;nvt=1&amp;fsapi=1&amp;fc=1920&amp;brdim=22%2C22%2C22%2C22%2C800%2C0%2C756%2C556%2C800%2C600&amp;vis=1&amp;rsz=%7C%7Cs%7C&amp;abl=NS&amp;fu=33792&amp;bc=31&amp;bz=0.95&amp;psd=W251bGwsW251bGwsbnVsbCxudWxsLCJkZXByZWNhdGVkX2thbm9uIl1d&amp;ifi=1&amp;uci=a!1&amp;fsb=1&amp;dtd=11" data-google-container-id="a!1" tabindex="0" title="Advertisement" aria-label="Advertisement" data-load-complete="true"></iframe></div></ins><div style="position: absolute; width: 0px; height: 0px; overflow: hidden; padding: 0px; border: 0px; margin: 0px;"><div id="MathJax_Font_Test" style="position: absolute; visibility: hidden; top: 0px; left: 0px; width: auto; padding: 0px; border: 0px; margin: 0px; white-space: nowrap; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; font-size: 40px; font-weight: normal; font-style: normal; font-size-adjust: none; font-family: STIXSizeOneSym, sans-serif;"></div></div><iframe name="googlefcPresent" style="display: none; width: 0px; height: 0px; border: none; z-index: -1000; left: -1000px; top: -1000px;"></iframe><iframe name="__tcfapiLocator" src="about:blank" style="display: none; width: 0px; height: 0px; border: none; z-index: -1000; left: -1000px; top: -1000px;"></iframe><iframe name="googlefcInactive" src="about:blank" style="display: none; width: 0px; height: 0px; border: none; z-index: -1000; left: -1000px; top: -1000px;"></iframe><iframe name="googlefcLoaded" src="about:blank" style="display: none; width: 0px; height: 0px; border: none; z-index: -1000; left: -1000px; top: -1000px;"></iframe><iframe src="https://www.google.com/recaptcha/api2/aframe" width="0" height="0" style="display: none;"></iframe></body><iframe id="google_esf" name="google_esf" src="https://googleads.g.doubleclick.net/pagead/html/r20251211/r20190131/zrt_lookup.html" style="display: none;"></iframe></html>