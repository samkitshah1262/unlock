[
  {
    "id": "ai-on-device-transformers-encoder-compute-bound-nature-1",
    "articleSlug": "on-device-transformers",
    "articleTitle": "On-device Transformers",
    "category": "On-Device AI",
    "chapter": "Architectural Overview and Compute Characteristics of Transformers",
    "title": "Encoder: Compute-bound Nature",
    "order": 1,
    "orderInChapter": 1,
    "contentHtml": "<ul>\n  <li>\n    <p>The encoder performs operations on entire sequences in parallel. The main computational components are:</p>\n\n    <ol>\n      <li><strong>Multi-Head Self-Attention (MHSA)</strong></li>\n      <li><strong>Feedforward Networks (FFN)</strong></li>\n      <li><strong>LayerNorm / Dropout (lightweight)</strong></li>\n    </ol>\n  </li>\n  <li>\n    <p>The attention operation in the encoder is full-sequence:</p>\n\n    <ul>\n      <li>\n        <p>Attention Score Calculation:</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-3-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>Attention</mtext><mo stretchy=&quot;false&quot;>(</mo><mi>Q</mi><mo>,</mo><mi>K</mi><mo>,</mo><mi>V</mi><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mtext>softmax</mtext><mrow><mo>(</mo><mfrac><mrow><mi>Q</mi><msup><mi>K</mi><mi>T</mi></msup></mrow><msqrt><msub><mi>d</mi><mi>k</mi></msub></msqrt></mfrac><mo>)</mo></mrow><mi>V</mi></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-7\" style=\"width: 20.732em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 17.242em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(2.19em, 1017.24em, 5.576em, -999.997em); top: -4.112em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-8\"><span class=\"mtext\" id=\"MathJax-Span-9\" style=\"font-family: STIXGeneral-Regular;\">Attention</span><span class=\"mo\" id=\"MathJax-Span-10\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-11\" style=\"font-family: STIXGeneral-Italic;\">Q</span><span class=\"mo\" id=\"MathJax-Span-12\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mi\" id=\"MathJax-Span-13\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.211em;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-14\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mi\" id=\"MathJax-Span-15\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.211em;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-16\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-17\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mtext\" id=\"MathJax-Span-18\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">softmax</span><span class=\"mrow\" id=\"MathJax-Span-19\" style=\"padding-left: 0.211em;\"><span class=\"mo\" id=\"MathJax-Span-20\" style=\"vertical-align: -0.779em;\"><span style=\"font-family: STIXSizeFourSym;\">(</span></span><span class=\"mfrac\" id=\"MathJax-Span-21\"><span style=\"display: inline-block; position: relative; width: 2.138em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.023em, 1002.03em, 4.326em, -999.997em); top: -4.685em; left: 50%; margin-left: -1.039em;\"><span class=\"mrow\" id=\"MathJax-Span-22\"><span class=\"mi\" id=\"MathJax-Span-23\" style=\"font-family: STIXGeneral-Italic;\">Q</span><span class=\"msubsup\" id=\"MathJax-Span-24\"><span style=\"display: inline-block; position: relative; width: 1.305em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.73em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-25\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.372em; left: 0.784em;\"><span class=\"mi\" id=\"MathJax-Span-26\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">T<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(2.971em, 1001.88em, 4.534em, -999.997em); top: -3.122em; left: 50%; margin-left: -0.935em;\"><span class=\"msqrt\" id=\"MathJax-Span-27\"><span style=\"display: inline-block; position: relative; width: 1.878em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.326em, -999.997em); top: -4.008em; left: 0.94em;\"><span class=\"mrow\" id=\"MathJax-Span-28\"><span class=\"msubsup\" id=\"MathJax-Span-29\"><span style=\"display: inline-block; position: relative; width: 0.888em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-30\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"mi\" id=\"MathJax-Span-31\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.023em, 1000.94em, 3.388em, -999.997em); top: -4.06em; left: 0.94em;\"><span style=\"display: inline-block; position: relative; width: 0.94em; height: 0px;\"><span style=\"position: absolute; font-family: STIXGeneral-Regular; top: -4.008em; left: 0em;\">‾<span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; font-family: STIXGeneral-Regular; top: -4.008em; left: 0.419em;\">‾<span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(2.867em, 1000.94em, 4.43em, -999.997em); top: -3.904em; left: 0em;\"><span style=\"font-family: STIXGeneral-Regular;\">√</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1002.14em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.138em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-32\" style=\"vertical-align: -0.779em;\"><span style=\"font-family: STIXSizeFourSym;\">)</span></span></span><span class=\"mi\" id=\"MathJax-Span-33\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.211em;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.117em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -1.622em; border-left: 0px solid; width: 0px; height: 3.816em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>Attention</mtext><mo stretchy=\"false\">(</mo><mi>Q</mi><mo>,</mo><mi>K</mi><mo>,</mo><mi>V</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mtext>softmax</mtext><mrow><mo>(</mo><mfrac><mrow><mi>Q</mi><msup><mi>K</mi><mi>T</mi></msup></mrow><msqrt><msub><mi>d</mi><mi>k</mi></msub></msqrt></mfrac><mo>)</mo></mrow><mi>V</mi></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-3\">\\text{Attention}(Q, K, V) = \\text{softmax}\\left( \\frac{QK^T}{\\sqrt{d_k}} \\right)V</script>\n\n        <ul>\n          <li>\n            <p>where:</p>\n\n            <ul>\n              <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-4-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>Q</mi><mo>=</mo><mi>X</mi><msub><mi>W</mi><mi>Q</mi></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-34\" style=\"width: 4.951em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 4.117em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1004.12em, 2.607em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-35\"><span class=\"mi\" id=\"MathJax-Span-36\" style=\"font-family: STIXGeneral-Italic;\">Q</span><span class=\"mo\" id=\"MathJax-Span-37\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mi\" id=\"MathJax-Span-38\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">X<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"msubsup\" id=\"MathJax-Span-39\"><span style=\"display: inline-block; position: relative; width: 1.409em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-40\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mi\" id=\"MathJax-Span-41\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">Q</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.253em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>Q</mi><mo>=</mo><mi>X</mi><msub><mi>W</mi><mi>Q</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-4\">Q = XW_Q</script>, <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-5-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi><mo>=</mo><mi>X</mi><msub><mi>W</mi><mi>K</mi></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-42\" style=\"width: 5.003em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 4.169em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1004.17em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-43\"><span class=\"mi\" id=\"MathJax-Span-44\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-45\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mi\" id=\"MathJax-Span-46\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">X<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"msubsup\" id=\"MathJax-Span-47\"><span style=\"display: inline-block; position: relative; width: 1.409em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-48\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mi\" id=\"MathJax-Span-49\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.066em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi><mo>=</mo><mi>X</mi><msub><mi>W</mi><mi>K</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-5\">K = XW_K</script>, <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-6-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi><mo>=</mo><mi>X</mi><msub><mi>W</mi><mi>V</mi></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-50\" style=\"width: 5.003em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 4.169em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1004.17em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-51\"><span class=\"mi\" id=\"MathJax-Span-52\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-53\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mi\" id=\"MathJax-Span-54\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">X<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"msubsup\" id=\"MathJax-Span-55\"><span style=\"display: inline-block; position: relative; width: 1.409em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-56\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mi\" id=\"MathJax-Span-57\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi><mo>=</mo><mi>X</mi><msub><mi>W</mi><mi>V</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-6\">V = XW_V</script></li>\n              <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-7-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>X</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-58\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-59\"><span class=\"mi\" id=\"MathJax-Span-60\" style=\"font-family: STIXGeneral-Italic;\">X<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>X</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-7\">X</script>: Input sequence</li>\n              <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-8-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>W</mi><mi>Q</mi></msub><mo>,</mo><msub><mi>W</mi><mi>K</mi></msub><mo>,</mo><msub><mi>W</mi><mi>V</mi></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-61\" style=\"width: 6.201em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 5.159em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1005.16em, 2.607em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-62\"><span class=\"msubsup\" id=\"MathJax-Span-63\"><span style=\"display: inline-block; position: relative; width: 1.409em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-64\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mi\" id=\"MathJax-Span-65\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">Q</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-66\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-67\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 1.409em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-68\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mi\" id=\"MathJax-Span-69\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-70\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-71\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 1.409em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-72\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mi\" id=\"MathJax-Span-73\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.253em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>W</mi><mi>Q</mi></msub><mo>,</mo><msub><mi>W</mi><mi>K</mi></msub><mo>,</mo><msub><mi>W</mi><mi>V</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-8\">W_Q, W_K, W_V</script>: Projection matrices</li>\n            </ul>\n          </li>\n        </ul>\n      </li>\n    </ul>\n  </li>\n  <li>\n    <p>This means the compute scales as <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-9-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><msup><mi>n</mi><mn>2</mn></msup><mo>&amp;#x22C5;</mo><mi>d</mi><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-74\" style=\"width: 4.638em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 3.857em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.253em, 1003.8em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-75\"><span class=\"mi\" id=\"MathJax-Span-76\" style=\"font-family: STIXGeneral-Italic;\">O</span><span class=\"mo\" id=\"MathJax-Span-77\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"msubsup\" id=\"MathJax-Span-78\"><span style=\"display: inline-block; position: relative; width: 0.94em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-79\" style=\"font-family: STIXGeneral-Italic;\">n</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.372em; left: 0.523em;\"><span class=\"mn\" id=\"MathJax-Span-80\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-81\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"mi\" id=\"MathJax-Span-82\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.263em;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-83\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.378em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>O</mi><mo stretchy=\"false\">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo>⋅</mo><mi>d</mi><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-9\">O(n^2 \\cdot d)</script>, where <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-10-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>n</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-84\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-85\"><span class=\"mi\" id=\"MathJax-Span-86\" style=\"font-family: STIXGeneral-Italic;\">n</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>n</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-10\">n</script> is the sequence length and <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-11-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>d</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-87\" style=\"width: 0.732em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.576em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.58em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-88\"><span class=\"mi\" id=\"MathJax-Span-89\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>d</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-11\">d</script> is the hidden dimension.</p>\n  </li>\n  <li>\n    <p>FFN consists of two matrix multiplications:</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-12-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>FFN</mtext><mo stretchy=&quot;false&quot;>(</mo><mi>x</mi><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mo movablelimits=&quot;true&quot; form=&quot;prefix&quot;>max</mo><mo stretchy=&quot;false&quot;>(</mo><mn>0</mn><mo>,</mo><mi>x</mi><msub><mi>W</mi><mn>1</mn></msub><mo>+</mo><msub><mi>b</mi><mn>1</mn></msub><mo stretchy=&quot;false&quot;>)</mo><msub><mi>W</mi><mn>2</mn></msub><mo>+</mo><msub><mi>b</mi><mn>2</mn></msub></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-90\" style=\"width: 17.607em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 14.638em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1014.64em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-91\"><span class=\"mtext\" id=\"MathJax-Span-92\" style=\"font-family: STIXGeneral-Regular;\">FFN</span><span class=\"mo\" id=\"MathJax-Span-93\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-94\" style=\"font-family: STIXGeneral-Italic;\">x<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-95\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-96\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mo\" id=\"MathJax-Span-97\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">max</span><span class=\"mo\" id=\"MathJax-Span-98\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mn\" id=\"MathJax-Span-99\" style=\"font-family: STIXGeneral-Regular;\">0</span><span class=\"mo\" id=\"MathJax-Span-100\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mi\" id=\"MathJax-Span-101\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.211em;\">x<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"msubsup\" id=\"MathJax-Span-102\"><span style=\"display: inline-block; position: relative; width: 1.253em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-103\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mn\" id=\"MathJax-Span-104\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-105\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"msubsup\" id=\"MathJax-Span-106\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 0.94em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-107\" style=\"font-family: STIXGeneral-Italic;\">b</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"mn\" id=\"MathJax-Span-108\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-109\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"msubsup\" id=\"MathJax-Span-110\"><span style=\"display: inline-block; position: relative; width: 1.253em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-111\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mn\" id=\"MathJax-Span-112\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-113\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"msubsup\" id=\"MathJax-Span-114\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 0.94em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-115\" style=\"font-family: STIXGeneral-Italic;\">b</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"mn\" id=\"MathJax-Span-116\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>FFN</mtext><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mo movablelimits=\"true\" form=\"prefix\">max</mo><mo stretchy=\"false\">(</mo><mn>0</mn><mo>,</mo><mi>x</mi><msub><mi>W</mi><mn>1</mn></msub><mo>+</mo><msub><mi>b</mi><mn>1</mn></msub><mo stretchy=\"false\">)</mo><msub><mi>W</mi><mn>2</mn></msub><mo>+</mo><msub><mi>b</mi><mn>2</mn></msub></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-12\">\\text{FFN}(x) = \\max(0, xW_1 + b_1)W_2 + b_2</script>\n\n    <ul>\n      <li>\n        <p>Typically, <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-13-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>W</mi><mn>1</mn></msub><mo>&amp;#x2208;</mo><msup><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi mathvariant=&quot;double-struck&quot;>R</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>d</mi><mo>&amp;#x00D7;</mo><mn>4</mn><mi>d</mi></mrow></msup></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-117\" style=\"width: 5.836em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 4.846em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.201em, 1004.85em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-118\"><span class=\"msubsup\" id=\"MathJax-Span-119\"><span style=\"display: inline-block; position: relative; width: 1.253em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-120\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mn\" id=\"MathJax-Span-121\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-122\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">∈</span><span class=\"msubsup\" id=\"MathJax-Span-123\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 2.398em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.73em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"texatom\" id=\"MathJax-Span-124\"><span class=\"mrow\" id=\"MathJax-Span-125\"><span class=\"mi\" id=\"MathJax-Span-126\" style=\"font-family: STIXGeneral-Regular;\">ℝ</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.372em; left: 0.732em;\"><span class=\"texatom\" id=\"MathJax-Span-127\"><span class=\"mrow\" id=\"MathJax-Span-128\"><span class=\"mi\" id=\"MathJax-Span-129\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-130\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">×</span><span class=\"mn\" id=\"MathJax-Span-131\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">4</span><span class=\"mi\" id=\"MathJax-Span-132\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.378em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>W</mi><mn>1</mn></msub><mo>∈</mo><msup><mrow class=\"MJX-TeXAtom-ORD\"><mi mathvariant=\"double-struck\">R</mi></mrow><mrow class=\"MJX-TeXAtom-ORD\"><mi>d</mi><mo>×</mo><mn>4</mn><mi>d</mi></mrow></msup></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-13\">W_1 \\in \\mathbb{R}^{d \\times 4d}</script>, <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-14-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>W</mi><mn>2</mn></msub><mo>&amp;#x2208;</mo><msup><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi mathvariant=&quot;double-struck&quot;>R</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>4</mn><mi>d</mi><mo>&amp;#x00D7;</mo><mi>d</mi></mrow></msup></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-133\" style=\"width: 5.836em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 4.846em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.201em, 1004.85em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-134\"><span class=\"msubsup\" id=\"MathJax-Span-135\"><span style=\"display: inline-block; position: relative; width: 1.253em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-136\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mn\" id=\"MathJax-Span-137\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-138\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">∈</span><span class=\"msubsup\" id=\"MathJax-Span-139\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 2.398em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.73em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"texatom\" id=\"MathJax-Span-140\"><span class=\"mrow\" id=\"MathJax-Span-141\"><span class=\"mi\" id=\"MathJax-Span-142\" style=\"font-family: STIXGeneral-Regular;\">ℝ</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.372em; left: 0.732em;\"><span class=\"texatom\" id=\"MathJax-Span-143\"><span class=\"mrow\" id=\"MathJax-Span-144\"><span class=\"mn\" id=\"MathJax-Span-145\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">4</span><span class=\"mi\" id=\"MathJax-Span-146\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-147\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">×</span><span class=\"mi\" id=\"MathJax-Span-148\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.378em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>W</mi><mn>2</mn></msub><mo>∈</mo><msup><mrow class=\"MJX-TeXAtom-ORD\"><mi mathvariant=\"double-struck\">R</mi></mrow><mrow class=\"MJX-TeXAtom-ORD\"><mn>4</mn><mi>d</mi><mo>×</mo><mi>d</mi></mrow></msup></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-14\">W_2 \\in \\mathbb{R}^{4d \\times d}</script></p>\n      </li>\n      <li>\n        <p>Note that the reason there are <strong>two</strong> matrix multiplications is that the feed-forward network inside each transformer block is actually a <strong>two-layer position-wise fully connected network</strong>:</p>\n\n        <ol>\n          <li>The first matrix multiplication with <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-15-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>W</mi><mn>1</mn></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-149\" style=\"width: 1.513em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.253em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1001.25em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-150\"><span class=\"msubsup\" id=\"MathJax-Span-151\"><span style=\"display: inline-block; position: relative; width: 1.253em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-152\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mn\" id=\"MathJax-Span-153\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.066em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>W</mi><mn>1</mn></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-15\">W_1</script> projects the hidden representation from dimension <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-16-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>d</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-154\" style=\"width: 0.732em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.576em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.58em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-155\"><span class=\"mi\" id=\"MathJax-Span-156\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>d</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-16\">d</script> (the model’s hidden size) <strong>up</strong> to a larger intermediate dimension, typically <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-17-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>4</mn><mi>d</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-157\" style=\"width: 1.253em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.044em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1001.04em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-158\"><span class=\"mn\" id=\"MathJax-Span-159\" style=\"font-family: STIXGeneral-Regular;\">4</span><span class=\"mi\" id=\"MathJax-Span-160\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mn>4</mn><mi>d</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-17\">4d</script>, to increase model capacity and introduce a richer representation space.</li>\n          <li>The second matrix multiplication with <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-18-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>W</mi><mn>2</mn></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-161\" style=\"width: 1.513em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.253em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1001.25em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-162\"><span class=\"msubsup\" id=\"MathJax-Span-163\"><span style=\"display: inline-block; position: relative; width: 1.253em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-164\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mn\" id=\"MathJax-Span-165\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.066em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>W</mi><mn>2</mn></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-18\">W_2</script> projects the intermediate vector <strong>back down</strong> to dimension <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-19-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>d</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-166\" style=\"width: 0.732em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.576em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.58em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-167\"><span class=\"mi\" id=\"MathJax-Span-168\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>d</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-19\">d</script>, so that the output shape matches the residual connection input and can be passed to the next transformer layer.</li>\n        </ol>\n      </li>\n      <li>\n        <p>Between these two layers, a non-linearity (often ReLU or GELU) is applied, enabling the FFN to learn complex transformations beyond what a single linear layer could achieve.</p>\n      </li>\n    </ul>\n  </li>\n  <li>\n    <p>These operations are <strong>highly parallelizable</strong> and benefit from <strong>vectorized matrix operations</strong>, making them well-suited for GPUs and TPUs. Even CPUs can achieve good performance <a href=\"https://www.intel.com/content/www/us/en/developer/tools/oneapi/onemkl.html\">Math Kernel Library (oneMKL)</a>/<a href=\"https://github.com/Jakob6174/Intel-DNNL\">Deep Neural Network Library (DNNL)</a> or <a href=\"https://github.com/uxlfoundation/oneDNN\">oneAPI Deep Neural Network Library (oneDNN)</a> optimized kernels — but they are generally slower due to fewer cores and lower memory bandwidth.</p>\n  </li>\n  <li>\n    <p>In short:</p>\n\n    <ul>\n      <li><strong>Memory usage:</strong> Moderate</li>\n      <li><strong>Compute intensity:</strong> High</li>\n      <li><strong>Best suited hardware:</strong> GPU, NPU (CPU feasible for small models or batch sizes)</li>\n    </ul>\n  </li>\n</ul>\n<p>The encoder performs operations on entire sequences in parallel. The main computational components are:</p>\n<ol>\n      <li><strong>Multi-Head Self-Attention (MHSA)</strong></li>\n      <li><strong>Feedforward Networks (FFN)</strong></li>\n      <li><strong>LayerNorm / Dropout (lightweight)</strong></li>\n    </ol>\n<p>The attention operation in the encoder is full-sequence:</p>\n<ul>\n      <li>\n        <p>Attention Score Calculation:</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-3-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>Attention</mtext><mo stretchy=&quot;false&quot;>(</mo><mi>Q</mi><mo>,</mo><mi>K</mi><mo>,</mo><mi>V</mi><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mtext>softmax</mtext><mrow><mo>(</mo><mfrac><mrow><mi>Q</mi><msup><mi>K</mi><mi>T</mi></msup></mrow><msqrt><msub><mi>d</mi><mi>k</mi></msub></msqrt></mfrac><mo>)</mo></mrow><mi>V</mi></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-7\" style=\"width: 20.732em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 17.242em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(2.19em, 1017.24em, 5.576em, -999.997em); top: -4.112em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-8\"><span class=\"mtext\" id=\"MathJax-Span-9\" style=\"font-family: STIXGeneral-Regular;\">Attention</span><span class=\"mo\" id=\"MathJax-Span-10\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-11\" style=\"font-family: STIXGeneral-Italic;\">Q</span><span class=\"mo\" id=\"MathJax-Span-12\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mi\" id=\"MathJax-Span-13\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.211em;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-14\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mi\" id=\"MathJax-Span-15\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.211em;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-16\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-17\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mtext\" id=\"MathJax-Span-18\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">softmax</span><span class=\"mrow\" id=\"MathJax-Span-19\" style=\"padding-left: 0.211em;\"><span class=\"mo\" id=\"MathJax-Span-20\" style=\"vertical-align: -0.779em;\"><span style=\"font-family: STIXSizeFourSym;\">(</span></span><span class=\"mfrac\" id=\"MathJax-Span-21\"><span style=\"display: inline-block; position: relative; width: 2.138em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.023em, 1002.03em, 4.326em, -999.997em); top: -4.685em; left: 50%; margin-left: -1.039em;\"><span class=\"mrow\" id=\"MathJax-Span-22\"><span class=\"mi\" id=\"MathJax-Span-23\" style=\"font-family: STIXGeneral-Italic;\">Q</span><span class=\"msubsup\" id=\"MathJax-Span-24\"><span style=\"display: inline-block; position: relative; width: 1.305em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.73em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-25\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.372em; left: 0.784em;\"><span class=\"mi\" id=\"MathJax-Span-26\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">T<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(2.971em, 1001.88em, 4.534em, -999.997em); top: -3.122em; left: 50%; margin-left: -0.935em;\"><span class=\"msqrt\" id=\"MathJax-Span-27\"><span style=\"display: inline-block; position: relative; width: 1.878em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.326em, -999.997em); top: -4.008em; left: 0.94em;\"><span class=\"mrow\" id=\"MathJax-Span-28\"><span class=\"msubsup\" id=\"MathJax-Span-29\"><span style=\"display: inline-block; position: relative; width: 0.888em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-30\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"mi\" id=\"MathJax-Span-31\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.023em, 1000.94em, 3.388em, -999.997em); top: -4.06em; left: 0.94em;\"><span style=\"display: inline-block; position: relative; width: 0.94em; height: 0px;\"><span style=\"position: absolute; font-family: STIXGeneral-Regular; top: -4.008em; left: 0em;\">‾<span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; font-family: STIXGeneral-Regular; top: -4.008em; left: 0.419em;\">‾<span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(2.867em, 1000.94em, 4.43em, -999.997em); top: -3.904em; left: 0em;\"><span style=\"font-family: STIXGeneral-Regular;\">√</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1002.14em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.138em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-32\" style=\"vertical-align: -0.779em;\"><span style=\"font-family: STIXSizeFourSym;\">)</span></span></span><span class=\"mi\" id=\"MathJax-Span-33\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.211em;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.117em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -1.622em; border-left: 0px solid; width: 0px; height: 3.816em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>Attention</mtext><mo stretchy=\"false\">(</mo><mi>Q</mi><mo>,</mo><mi>K</mi><mo>,</mo><mi>V</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mtext>softmax</mtext><mrow><mo>(</mo><mfrac><mrow><mi>Q</mi><msup><mi>K</mi><mi>T</mi></msup></mrow><msqrt><msub><mi>d</mi><mi>k</mi></msub></msqrt></mfrac><mo>)</mo></mrow><mi>V</mi></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-3\">\\text{Attention}(Q, K, V) = \\text{softmax}\\left( \\frac{QK^T}{\\sqrt{d_k}} \\right)V</script>\n\n        <ul>\n          <li>\n            <p>where:</p>\n\n            <ul>\n              <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-4-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>Q</mi><mo>=</mo><mi>X</mi><msub><mi>W</mi><mi>Q</mi></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-34\" style=\"width: 4.951em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 4.117em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1004.12em, 2.607em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-35\"><span class=\"mi\" id=\"MathJax-Span-36\" style=\"font-family: STIXGeneral-Italic;\">Q</span><span class=\"mo\" id=\"MathJax-Span-37\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mi\" id=\"MathJax-Span-38\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">X<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"msubsup\" id=\"MathJax-Span-39\"><span style=\"display: inline-block; position: relative; width: 1.409em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-40\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mi\" id=\"MathJax-Span-41\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">Q</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.253em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>Q</mi><mo>=</mo><mi>X</mi><msub><mi>W</mi><mi>Q</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-4\">Q = XW_Q</script>, <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-5-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi><mo>=</mo><mi>X</mi><msub><mi>W</mi><mi>K</mi></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-42\" style=\"width: 5.003em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 4.169em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1004.17em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-43\"><span class=\"mi\" id=\"MathJax-Span-44\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-45\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mi\" id=\"MathJax-Span-46\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">X<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"msubsup\" id=\"MathJax-Span-47\"><span style=\"display: inline-block; position: relative; width: 1.409em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-48\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mi\" id=\"MathJax-Span-49\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.066em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi><mo>=</mo><mi>X</mi><msub><mi>W</mi><mi>K</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-5\">K = XW_K</script>, <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-6-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi><mo>=</mo><mi>X</mi><msub><mi>W</mi><mi>V</mi></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-50\" style=\"width: 5.003em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 4.169em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1004.17em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-51\"><span class=\"mi\" id=\"MathJax-Span-52\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-53\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mi\" id=\"MathJax-Span-54\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">X<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"msubsup\" id=\"MathJax-Span-55\"><span style=\"display: inline-block; position: relative; width: 1.409em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-56\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mi\" id=\"MathJax-Span-57\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi><mo>=</mo><mi>X</mi><msub><mi>W</mi><mi>V</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-6\">V = XW_V</script></li>\n              <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-7-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>X</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-58\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-59\"><span class=\"mi\" id=\"MathJax-Span-60\" style=\"font-family: STIXGeneral-Italic;\">X<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>X</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-7\">X</script>: Input sequence</li>\n              <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-8-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>W</mi><mi>Q</mi></msub><mo>,</mo><msub><mi>W</mi><mi>K</mi></msub><mo>,</mo><msub><mi>W</mi><mi>V</mi></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-61\" style=\"width: 6.201em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 5.159em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1005.16em, 2.607em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-62\"><span class=\"msubsup\" id=\"MathJax-Span-63\"><span style=\"display: inline-block; position: relative; width: 1.409em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-64\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mi\" id=\"MathJax-Span-65\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">Q</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-66\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-67\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 1.409em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-68\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mi\" id=\"MathJax-Span-69\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-70\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-71\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 1.409em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-72\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mi\" id=\"MathJax-Span-73\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.253em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>W</mi><mi>Q</mi></msub><mo>,</mo><msub><mi>W</mi><mi>K</mi></msub><mo>,</mo><msub><mi>W</mi><mi>V</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-8\">W_Q, W_K, W_V</script>: Projection matrices</li>\n            </ul>\n          </li>\n        </ul>\n      </li>\n    </ul>\n<p>Attention Score Calculation:</p>\n<ul>\n          <li>\n            <p>where:</p>\n\n            <ul>\n              <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-4-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>Q</mi><mo>=</mo><mi>X</mi><msub><mi>W</mi><mi>Q</mi></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-34\" style=\"width: 4.951em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 4.117em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1004.12em, 2.607em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-35\"><span class=\"mi\" id=\"MathJax-Span-36\" style=\"font-family: STIXGeneral-Italic;\">Q</span><span class=\"mo\" id=\"MathJax-Span-37\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mi\" id=\"MathJax-Span-38\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">X<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"msubsup\" id=\"MathJax-Span-39\"><span style=\"display: inline-block; position: relative; width: 1.409em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-40\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mi\" id=\"MathJax-Span-41\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">Q</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.253em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>Q</mi><mo>=</mo><mi>X</mi><msub><mi>W</mi><mi>Q</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-4\">Q = XW_Q</script>, <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-5-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi><mo>=</mo><mi>X</mi><msub><mi>W</mi><mi>K</mi></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-42\" style=\"width: 5.003em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 4.169em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1004.17em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-43\"><span class=\"mi\" id=\"MathJax-Span-44\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-45\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mi\" id=\"MathJax-Span-46\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">X<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"msubsup\" id=\"MathJax-Span-47\"><span style=\"display: inline-block; position: relative; width: 1.409em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-48\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mi\" id=\"MathJax-Span-49\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.066em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi><mo>=</mo><mi>X</mi><msub><mi>W</mi><mi>K</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-5\">K = XW_K</script>, <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-6-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi><mo>=</mo><mi>X</mi><msub><mi>W</mi><mi>V</mi></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-50\" style=\"width: 5.003em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 4.169em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1004.17em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-51\"><span class=\"mi\" id=\"MathJax-Span-52\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-53\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mi\" id=\"MathJax-Span-54\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">X<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"msubsup\" id=\"MathJax-Span-55\"><span style=\"display: inline-block; position: relative; width: 1.409em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-56\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mi\" id=\"MathJax-Span-57\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi><mo>=</mo><mi>X</mi><msub><mi>W</mi><mi>V</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-6\">V = XW_V</script></li>\n              <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-7-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>X</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-58\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-59\"><span class=\"mi\" id=\"MathJax-Span-60\" style=\"font-family: STIXGeneral-Italic;\">X<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>X</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-7\">X</script>: Input sequence</li>\n              <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-8-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>W</mi><mi>Q</mi></msub><mo>,</mo><msub><mi>W</mi><mi>K</mi></msub><mo>,</mo><msub><mi>W</mi><mi>V</mi></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-61\" style=\"width: 6.201em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 5.159em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1005.16em, 2.607em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-62\"><span class=\"msubsup\" id=\"MathJax-Span-63\"><span style=\"display: inline-block; position: relative; width: 1.409em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-64\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mi\" id=\"MathJax-Span-65\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">Q</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-66\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-67\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 1.409em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-68\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mi\" id=\"MathJax-Span-69\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-70\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-71\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 1.409em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-72\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mi\" id=\"MathJax-Span-73\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.253em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>W</mi><mi>Q</mi></msub><mo>,</mo><msub><mi>W</mi><mi>K</mi></msub><mo>,</mo><msub><mi>W</mi><mi>V</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-8\">W_Q, W_K, W_V</script>: Projection matrices</li>\n            </ul>\n          </li>\n        </ul>\n<p>where:</p>\n<ul>\n              <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-4-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>Q</mi><mo>=</mo><mi>X</mi><msub><mi>W</mi><mi>Q</mi></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-34\" style=\"width: 4.951em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 4.117em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1004.12em, 2.607em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-35\"><span class=\"mi\" id=\"MathJax-Span-36\" style=\"font-family: STIXGeneral-Italic;\">Q</span><span class=\"mo\" id=\"MathJax-Span-37\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mi\" id=\"MathJax-Span-38\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">X<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"msubsup\" id=\"MathJax-Span-39\"><span style=\"display: inline-block; position: relative; width: 1.409em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-40\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mi\" id=\"MathJax-Span-41\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">Q</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.253em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>Q</mi><mo>=</mo><mi>X</mi><msub><mi>W</mi><mi>Q</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-4\">Q = XW_Q</script>, <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-5-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi><mo>=</mo><mi>X</mi><msub><mi>W</mi><mi>K</mi></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-42\" style=\"width: 5.003em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 4.169em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1004.17em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-43\"><span class=\"mi\" id=\"MathJax-Span-44\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-45\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mi\" id=\"MathJax-Span-46\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">X<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"msubsup\" id=\"MathJax-Span-47\"><span style=\"display: inline-block; position: relative; width: 1.409em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-48\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mi\" id=\"MathJax-Span-49\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.066em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi><mo>=</mo><mi>X</mi><msub><mi>W</mi><mi>K</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-5\">K = XW_K</script>, <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-6-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi><mo>=</mo><mi>X</mi><msub><mi>W</mi><mi>V</mi></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-50\" style=\"width: 5.003em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 4.169em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1004.17em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-51\"><span class=\"mi\" id=\"MathJax-Span-52\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-53\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mi\" id=\"MathJax-Span-54\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">X<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"msubsup\" id=\"MathJax-Span-55\"><span style=\"display: inline-block; position: relative; width: 1.409em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-56\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mi\" id=\"MathJax-Span-57\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi><mo>=</mo><mi>X</mi><msub><mi>W</mi><mi>V</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-6\">V = XW_V</script></li>\n              <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-7-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>X</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-58\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-59\"><span class=\"mi\" id=\"MathJax-Span-60\" style=\"font-family: STIXGeneral-Italic;\">X<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>X</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-7\">X</script>: Input sequence</li>\n              <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-8-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>W</mi><mi>Q</mi></msub><mo>,</mo><msub><mi>W</mi><mi>K</mi></msub><mo>,</mo><msub><mi>W</mi><mi>V</mi></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-61\" style=\"width: 6.201em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 5.159em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1005.16em, 2.607em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-62\"><span class=\"msubsup\" id=\"MathJax-Span-63\"><span style=\"display: inline-block; position: relative; width: 1.409em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-64\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mi\" id=\"MathJax-Span-65\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">Q</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-66\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-67\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 1.409em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-68\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mi\" id=\"MathJax-Span-69\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-70\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-71\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 1.409em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-72\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mi\" id=\"MathJax-Span-73\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.253em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>W</mi><mi>Q</mi></msub><mo>,</mo><msub><mi>W</mi><mi>K</mi></msub><mo>,</mo><msub><mi>W</mi><mi>V</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-8\">W_Q, W_K, W_V</script>: Projection matrices</li>\n            </ul>\n<p>This means the compute scales as <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-9-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><msup><mi>n</mi><mn>2</mn></msup><mo>&amp;#x22C5;</mo><mi>d</mi><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-74\" style=\"width: 4.638em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 3.857em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.253em, 1003.8em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-75\"><span class=\"mi\" id=\"MathJax-Span-76\" style=\"font-family: STIXGeneral-Italic;\">O</span><span class=\"mo\" id=\"MathJax-Span-77\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"msubsup\" id=\"MathJax-Span-78\"><span style=\"display: inline-block; position: relative; width: 0.94em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-79\" style=\"font-family: STIXGeneral-Italic;\">n</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.372em; left: 0.523em;\"><span class=\"mn\" id=\"MathJax-Span-80\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-81\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"mi\" id=\"MathJax-Span-82\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.263em;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-83\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.378em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>O</mi><mo stretchy=\"false\">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo>⋅</mo><mi>d</mi><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-9\">O(n^2 \\cdot d)</script>, where <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-10-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>n</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-84\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-85\"><span class=\"mi\" id=\"MathJax-Span-86\" style=\"font-family: STIXGeneral-Italic;\">n</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>n</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-10\">n</script> is the sequence length and <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-11-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>d</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-87\" style=\"width: 0.732em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.576em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.58em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-88\"><span class=\"mi\" id=\"MathJax-Span-89\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>d</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-11\">d</script> is the hidden dimension.</p>\n<p>FFN consists of two matrix multiplications:</p>\n<ul>\n      <li>\n        <p>Typically, <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-13-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>W</mi><mn>1</mn></msub><mo>&amp;#x2208;</mo><msup><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi mathvariant=&quot;double-struck&quot;>R</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>d</mi><mo>&amp;#x00D7;</mo><mn>4</mn><mi>d</mi></mrow></msup></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-117\" style=\"width: 5.836em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 4.846em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.201em, 1004.85em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-118\"><span class=\"msubsup\" id=\"MathJax-Span-119\"><span style=\"display: inline-block; position: relative; width: 1.253em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-120\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mn\" id=\"MathJax-Span-121\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-122\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">∈</span><span class=\"msubsup\" id=\"MathJax-Span-123\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 2.398em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.73em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"texatom\" id=\"MathJax-Span-124\"><span class=\"mrow\" id=\"MathJax-Span-125\"><span class=\"mi\" id=\"MathJax-Span-126\" style=\"font-family: STIXGeneral-Regular;\">ℝ</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.372em; left: 0.732em;\"><span class=\"texatom\" id=\"MathJax-Span-127\"><span class=\"mrow\" id=\"MathJax-Span-128\"><span class=\"mi\" id=\"MathJax-Span-129\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-130\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">×</span><span class=\"mn\" id=\"MathJax-Span-131\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">4</span><span class=\"mi\" id=\"MathJax-Span-132\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.378em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>W</mi><mn>1</mn></msub><mo>∈</mo><msup><mrow class=\"MJX-TeXAtom-ORD\"><mi mathvariant=\"double-struck\">R</mi></mrow><mrow class=\"MJX-TeXAtom-ORD\"><mi>d</mi><mo>×</mo><mn>4</mn><mi>d</mi></mrow></msup></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-13\">W_1 \\in \\mathbb{R}^{d \\times 4d}</script>, <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-14-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>W</mi><mn>2</mn></msub><mo>&amp;#x2208;</mo><msup><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi mathvariant=&quot;double-struck&quot;>R</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>4</mn><mi>d</mi><mo>&amp;#x00D7;</mo><mi>d</mi></mrow></msup></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-133\" style=\"width: 5.836em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 4.846em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.201em, 1004.85em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-134\"><span class=\"msubsup\" id=\"MathJax-Span-135\"><span style=\"display: inline-block; position: relative; width: 1.253em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-136\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mn\" id=\"MathJax-Span-137\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-138\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">∈</span><span class=\"msubsup\" id=\"MathJax-Span-139\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 2.398em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.73em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"texatom\" id=\"MathJax-Span-140\"><span class=\"mrow\" id=\"MathJax-Span-141\"><span class=\"mi\" id=\"MathJax-Span-142\" style=\"font-family: STIXGeneral-Regular;\">ℝ</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.372em; left: 0.732em;\"><span class=\"texatom\" id=\"MathJax-Span-143\"><span class=\"mrow\" id=\"MathJax-Span-144\"><span class=\"mn\" id=\"MathJax-Span-145\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">4</span><span class=\"mi\" id=\"MathJax-Span-146\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-147\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">×</span><span class=\"mi\" id=\"MathJax-Span-148\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.378em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>W</mi><mn>2</mn></msub><mo>∈</mo><msup><mrow class=\"MJX-TeXAtom-ORD\"><mi mathvariant=\"double-struck\">R</mi></mrow><mrow class=\"MJX-TeXAtom-ORD\"><mn>4</mn><mi>d</mi><mo>×</mo><mi>d</mi></mrow></msup></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-14\">W_2 \\in \\mathbb{R}^{4d \\times d}</script></p>\n      </li>\n      <li>\n        <p>Note that the reason there are <strong>two</strong> matrix multiplications is that the feed-forward network inside each transformer block is actually a <strong>two-layer position-wise fully connected network</strong>:</p>\n\n        <ol>\n          <li>The first matrix multiplication with <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-15-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>W</mi><mn>1</mn></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-149\" style=\"width: 1.513em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.253em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1001.25em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-150\"><span class=\"msubsup\" id=\"MathJax-Span-151\"><span style=\"display: inline-block; position: relative; width: 1.253em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-152\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mn\" id=\"MathJax-Span-153\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.066em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>W</mi><mn>1</mn></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-15\">W_1</script> projects the hidden representation from dimension <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-16-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>d</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-154\" style=\"width: 0.732em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.576em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.58em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-155\"><span class=\"mi\" id=\"MathJax-Span-156\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>d</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-16\">d</script> (the model’s hidden size) <strong>up</strong> to a larger intermediate dimension, typically <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-17-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>4</mn><mi>d</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-157\" style=\"width: 1.253em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.044em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1001.04em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-158\"><span class=\"mn\" id=\"MathJax-Span-159\" style=\"font-family: STIXGeneral-Regular;\">4</span><span class=\"mi\" id=\"MathJax-Span-160\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mn>4</mn><mi>d</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-17\">4d</script>, to increase model capacity and introduce a richer representation space.</li>\n          <li>The second matrix multiplication with <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-18-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>W</mi><mn>2</mn></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-161\" style=\"width: 1.513em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.253em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1001.25em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-162\"><span class=\"msubsup\" id=\"MathJax-Span-163\"><span style=\"display: inline-block; position: relative; width: 1.253em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-164\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mn\" id=\"MathJax-Span-165\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.066em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>W</mi><mn>2</mn></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-18\">W_2</script> projects the intermediate vector <strong>back down</strong> to dimension <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-19-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>d</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-166\" style=\"width: 0.732em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.576em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.58em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-167\"><span class=\"mi\" id=\"MathJax-Span-168\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>d</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-19\">d</script>, so that the output shape matches the residual connection input and can be passed to the next transformer layer.</li>\n        </ol>\n      </li>\n      <li>\n        <p>Between these two layers, a non-linearity (often ReLU or GELU) is applied, enabling the FFN to learn complex transformations beyond what a single linear layer could achieve.</p>\n      </li>\n    </ul>\n<p>Typically, <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-13-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>W</mi><mn>1</mn></msub><mo>&amp;#x2208;</mo><msup><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi mathvariant=&quot;double-struck&quot;>R</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>d</mi><mo>&amp;#x00D7;</mo><mn>4</mn><mi>d</mi></mrow></msup></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-117\" style=\"width: 5.836em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 4.846em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.201em, 1004.85em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-118\"><span class=\"msubsup\" id=\"MathJax-Span-119\"><span style=\"display: inline-block; position: relative; width: 1.253em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-120\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mn\" id=\"MathJax-Span-121\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-122\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">∈</span><span class=\"msubsup\" id=\"MathJax-Span-123\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 2.398em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.73em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"texatom\" id=\"MathJax-Span-124\"><span class=\"mrow\" id=\"MathJax-Span-125\"><span class=\"mi\" id=\"MathJax-Span-126\" style=\"font-family: STIXGeneral-Regular;\">ℝ</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.372em; left: 0.732em;\"><span class=\"texatom\" id=\"MathJax-Span-127\"><span class=\"mrow\" id=\"MathJax-Span-128\"><span class=\"mi\" id=\"MathJax-Span-129\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-130\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">×</span><span class=\"mn\" id=\"MathJax-Span-131\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">4</span><span class=\"mi\" id=\"MathJax-Span-132\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.378em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>W</mi><mn>1</mn></msub><mo>∈</mo><msup><mrow class=\"MJX-TeXAtom-ORD\"><mi mathvariant=\"double-struck\">R</mi></mrow><mrow class=\"MJX-TeXAtom-ORD\"><mi>d</mi><mo>×</mo><mn>4</mn><mi>d</mi></mrow></msup></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-13\">W_1 \\in \\mathbb{R}^{d \\times 4d}</script>, <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-14-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>W</mi><mn>2</mn></msub><mo>&amp;#x2208;</mo><msup><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi mathvariant=&quot;double-struck&quot;>R</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>4</mn><mi>d</mi><mo>&amp;#x00D7;</mo><mi>d</mi></mrow></msup></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-133\" style=\"width: 5.836em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 4.846em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.201em, 1004.85em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-134\"><span class=\"msubsup\" id=\"MathJax-Span-135\"><span style=\"display: inline-block; position: relative; width: 1.253em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-136\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mn\" id=\"MathJax-Span-137\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-138\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">∈</span><span class=\"msubsup\" id=\"MathJax-Span-139\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 2.398em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.73em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"texatom\" id=\"MathJax-Span-140\"><span class=\"mrow\" id=\"MathJax-Span-141\"><span class=\"mi\" id=\"MathJax-Span-142\" style=\"font-family: STIXGeneral-Regular;\">ℝ</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.372em; left: 0.732em;\"><span class=\"texatom\" id=\"MathJax-Span-143\"><span class=\"mrow\" id=\"MathJax-Span-144\"><span class=\"mn\" id=\"MathJax-Span-145\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">4</span><span class=\"mi\" id=\"MathJax-Span-146\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-147\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">×</span><span class=\"mi\" id=\"MathJax-Span-148\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.378em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>W</mi><mn>2</mn></msub><mo>∈</mo><msup><mrow class=\"MJX-TeXAtom-ORD\"><mi mathvariant=\"double-struck\">R</mi></mrow><mrow class=\"MJX-TeXAtom-ORD\"><mn>4</mn><mi>d</mi><mo>×</mo><mi>d</mi></mrow></msup></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-14\">W_2 \\in \\mathbb{R}^{4d \\times d}</script></p>\n<p>Note that the reason there are <strong>two</strong> matrix multiplications is that the feed-forward network inside each transformer block is actually a <strong>two-layer position-wise fully connected network</strong>:</p>\n<ol>\n          <li>The first matrix multiplication with <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-15-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>W</mi><mn>1</mn></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-149\" style=\"width: 1.513em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.253em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1001.25em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-150\"><span class=\"msubsup\" id=\"MathJax-Span-151\"><span style=\"display: inline-block; position: relative; width: 1.253em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-152\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mn\" id=\"MathJax-Span-153\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.066em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>W</mi><mn>1</mn></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-15\">W_1</script> projects the hidden representation from dimension <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-16-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>d</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-154\" style=\"width: 0.732em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.576em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.58em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-155\"><span class=\"mi\" id=\"MathJax-Span-156\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>d</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-16\">d</script> (the model’s hidden size) <strong>up</strong> to a larger intermediate dimension, typically <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-17-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>4</mn><mi>d</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-157\" style=\"width: 1.253em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.044em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1001.04em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-158\"><span class=\"mn\" id=\"MathJax-Span-159\" style=\"font-family: STIXGeneral-Regular;\">4</span><span class=\"mi\" id=\"MathJax-Span-160\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mn>4</mn><mi>d</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-17\">4d</script>, to increase model capacity and introduce a richer representation space.</li>\n          <li>The second matrix multiplication with <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-18-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>W</mi><mn>2</mn></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-161\" style=\"width: 1.513em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.253em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1001.25em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-162\"><span class=\"msubsup\" id=\"MathJax-Span-163\"><span style=\"display: inline-block; position: relative; width: 1.253em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-164\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"mn\" id=\"MathJax-Span-165\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.066em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>W</mi><mn>2</mn></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-18\">W_2</script> projects the intermediate vector <strong>back down</strong> to dimension <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-19-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>d</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-166\" style=\"width: 0.732em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.576em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.58em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-167\"><span class=\"mi\" id=\"MathJax-Span-168\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>d</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-19\">d</script>, so that the output shape matches the residual connection input and can be passed to the next transformer layer.</li>\n        </ol>\n<p>Between these two layers, a non-linearity (often ReLU or GELU) is applied, enabling the FFN to learn complex transformations beyond what a single linear layer could achieve.</p>\n<p>These operations are <strong>highly parallelizable</strong> and benefit from <strong>vectorized matrix operations</strong>, making them well-suited for GPUs and TPUs. Even CPUs can achieve good performance <a href=\"https://www.intel.com/content/www/us/en/developer/tools/oneapi/onemkl.html\">Math Kernel Library (oneMKL)</a>/<a href=\"https://github.com/Jakob6174/Intel-DNNL\">Deep Neural Network Library (DNNL)</a> or <a href=\"https://github.com/uxlfoundation/oneDNN\">oneAPI Deep Neural Network Library (oneDNN)</a> optimized kernels — but they are generally slower due to fewer cores and lower memory bandwidth.</p>\n<p>In short:</p>\n<ul>\n      <li><strong>Memory usage:</strong> Moderate</li>\n      <li><strong>Compute intensity:</strong> High</li>\n      <li><strong>Best suited hardware:</strong> GPU, NPU (CPU feasible for small models or batch sizes)</li>\n    </ul>",
    "contentMarkdown": "*   The encoder performs operations on entire sequences in parallel. The main computational components are:\n    \n    1.  **Multi-Head Self-Attention (MHSA)**\n    2.  **Feedforward Networks (FFN)**\n    3.  **LayerNorm / Dropout (lightweight)**\n*   The attention operation in the encoder is full-sequence:\n    \n    *   Attention Score Calculation:\n        \n        Attention(Q,K,V)\\=softmax(QKTdk‾‾√)VAttention(Q,K,V)\\=softmax(QKTdk)V\n        \n        \\\\text{Attention}(Q, K, V) = \\\\text{softmax}\\\\left( \\\\frac{QK^T}{\\\\sqrt{d\\_k}} \\\\right)V\n        *   where:\n            \n            *   Q\\=XWQQ\\=XWQQ = XW\\_Q, K\\=XWKK\\=XWKK = XW\\_K, V\\=XWVV\\=XWVV = XW\\_V\n            *   XXX: Input sequence\n            *   WQ,WK,WVWQ,WK,WVW\\_Q, W\\_K, W\\_V: Projection matrices\n*   This means the compute scales as O(n2⋅d)O(n2⋅d)O(n^2 \\\\cdot d), where nnn is the sequence length and ddd is the hidden dimension.\n    \n*   FFN consists of two matrix multiplications:\n    \n    FFN(x)\\=max(0,xW1+b1)W2+b2FFN(x)\\=max(0,xW1+b1)W2+b2\n    \n    \\\\text{FFN}(x) = \\\\max(0, xW\\_1 + b\\_1)W\\_2 + b\\_2\n    *   Typically, W1∈ℝd×4dW1∈Rd×4dW\\_1 \\\\in \\\\mathbb{R}^{d \\\\times 4d}, W2∈ℝ4d×dW2∈R4d×dW\\_2 \\\\in \\\\mathbb{R}^{4d \\\\times d}\n        \n    *   Note that the reason there are **two** matrix multiplications is that the feed-forward network inside each transformer block is actually a **two-layer position-wise fully connected network**:\n        \n        1.  The first matrix multiplication with W1W1W\\_1 projects the hidden representation from dimension ddd (the model’s hidden size) **up** to a larger intermediate dimension, typically 4d4d4d, to increase model capacity and introduce a richer representation space.\n        2.  The second matrix multiplication with W2W2W\\_2 projects the intermediate vector **back down** to dimension ddd, so that the output shape matches the residual connection input and can be passed to the next transformer layer.\n    *   Between these two layers, a non-linearity (often ReLU or GELU) is applied, enabling the FFN to learn complex transformations beyond what a single linear layer could achieve.\n        \n*   These operations are **highly parallelizable** and benefit from **vectorized matrix operations**, making them well-suited for GPUs and TPUs. Even CPUs can achieve good performance [Math Kernel Library (oneMKL)](https://www.intel.com/content/www/us/en/developer/tools/oneapi/onemkl.html)/[Deep Neural Network Library (DNNL)](https://github.com/Jakob6174/Intel-DNNL) or [oneAPI Deep Neural Network Library (oneDNN)](https://github.com/uxlfoundation/oneDNN) optimized kernels — but they are generally slower due to fewer cores and lower memory bandwidth.\n    \n*   In short:\n    \n    *   **Memory usage:** Moderate\n    *   **Compute intensity:** High\n    *   **Best suited hardware:** GPU, NPU (CPU feasible for small models or batch sizes)\n\nThe encoder performs operations on entire sequences in parallel. The main computational components are:\n\n1.  **Multi-Head Self-Attention (MHSA)**\n2.  **Feedforward Networks (FFN)**\n3.  **LayerNorm / Dropout (lightweight)**\n\nThe attention operation in the encoder is full-sequence:\n\n*   Attention Score Calculation:\n    \n    Attention(Q,K,V)\\=softmax(QKTdk‾‾√)VAttention(Q,K,V)\\=softmax(QKTdk)V\n    \n    \\\\text{Attention}(Q, K, V) = \\\\text{softmax}\\\\left( \\\\frac{QK^T}{\\\\sqrt{d\\_k}} \\\\right)V\n    *   where:\n        \n        *   Q\\=XWQQ\\=XWQQ = XW\\_Q, K\\=XWKK\\=XWKK = XW\\_K, V\\=XWVV\\=XWVV = XW\\_V\n        *   XXX: Input sequence\n        *   WQ,WK,WVWQ,WK,WVW\\_Q, W\\_K, W\\_V: Projection matrices\n\nAttention Score Calculation:\n\n*   where:\n    \n    *   Q\\=XWQQ\\=XWQQ = XW\\_Q, K\\=XWKK\\=XWKK = XW\\_K, V\\=XWVV\\=XWVV = XW\\_V\n    *   XXX: Input sequence\n    *   WQ,WK,WVWQ,WK,WVW\\_Q, W\\_K, W\\_V: Projection matrices\n\nwhere:\n\n*   Q\\=XWQQ\\=XWQQ = XW\\_Q, K\\=XWKK\\=XWKK = XW\\_K, V\\=XWVV\\=XWVV = XW\\_V\n*   XXX: Input sequence\n*   WQ,WK,WVWQ,WK,WVW\\_Q, W\\_K, W\\_V: Projection matrices\n\nThis means the compute scales as O(n2⋅d)O(n2⋅d)O(n^2 \\\\cdot d), where nnn is the sequence length and ddd is the hidden dimension.\n\nFFN consists of two matrix multiplications:\n\n*   Typically, W1∈ℝd×4dW1∈Rd×4dW\\_1 \\\\in \\\\mathbb{R}^{d \\\\times 4d}, W2∈ℝ4d×dW2∈R4d×dW\\_2 \\\\in \\\\mathbb{R}^{4d \\\\times d}\n    \n*   Note that the reason there are **two** matrix multiplications is that the feed-forward network inside each transformer block is actually a **two-layer position-wise fully connected network**:\n    \n    1.  The first matrix multiplication with W1W1W\\_1 projects the hidden representation from dimension ddd (the model’s hidden size) **up** to a larger intermediate dimension, typically 4d4d4d, to increase model capacity and introduce a richer representation space.\n    2.  The second matrix multiplication with W2W2W\\_2 projects the intermediate vector **back down** to dimension ddd, so that the output shape matches the residual connection input and can be passed to the next transformer layer.\n*   Between these two layers, a non-linearity (often ReLU or GELU) is applied, enabling the FFN to learn complex transformations beyond what a single linear layer could achieve.\n    \n\nTypically, W1∈ℝd×4dW1∈Rd×4dW\\_1 \\\\in \\\\mathbb{R}^{d \\\\times 4d}, W2∈ℝ4d×dW2∈R4d×dW\\_2 \\\\in \\\\mathbb{R}^{4d \\\\times d}\n\nNote that the reason there are **two** matrix multiplications is that the feed-forward network inside each transformer block is actually a **two-layer position-wise fully connected network**:\n\n1.  The first matrix multiplication with W1W1W\\_1 projects the hidden representation from dimension ddd (the model’s hidden size) **up** to a larger intermediate dimension, typically 4d4d4d, to increase model capacity and introduce a richer representation space.\n2.  The second matrix multiplication with W2W2W\\_2 projects the intermediate vector **back down** to dimension ddd, so that the output shape matches the residual connection input and can be passed to the next transformer layer.\n\nBetween these two layers, a non-linearity (often ReLU or GELU) is applied, enabling the FFN to learn complex transformations beyond what a single linear layer could achieve.\n\nThese operations are **highly parallelizable** and benefit from **vectorized matrix operations**, making them well-suited for GPUs and TPUs. Even CPUs can achieve good performance [Math Kernel Library (oneMKL)](https://www.intel.com/content/www/us/en/developer/tools/oneapi/onemkl.html)/[Deep Neural Network Library (DNNL)](https://github.com/Jakob6174/Intel-DNNL) or [oneAPI Deep Neural Network Library (oneDNN)](https://github.com/uxlfoundation/oneDNN) optimized kernels — but they are generally slower due to fewer cores and lower memory bandwidth.\n\nIn short:\n\n*   **Memory usage:** Moderate\n*   **Compute intensity:** High\n*   **Best suited hardware:** GPU, NPU (CPU feasible for small models or batch sizes)",
    "contentLength": 136439,
    "wordCount": 822,
    "hasCode": false,
    "hasMath": true,
    "hasImages": false,
    "url": "https://aman.ai/primers/ai/on-device-transformers/#encoder:-compute-bound-nature"
  },
  {
    "id": "ai-on-device-transformers-decoder-memory-bound-nature-2",
    "articleSlug": "on-device-transformers",
    "articleTitle": "On-device Transformers",
    "category": "On-Device AI",
    "chapter": "Architectural Overview and Compute Characteristics of Transformers",
    "title": "Decoder: Memory-bound Nature",
    "order": 2,
    "orderInChapter": 2,
    "contentHtml": "<ul>\n  <li>\n    <p>The decoder is autoregressive — it generates one token at a time and feeds it back in:</p>\n\n    <ul>\n      <li>Attention involves both <strong>self-attention</strong> (causal) and <strong>encoder-decoder attention</strong></li>\n      <li>Cannot parallelize the same way as the encoder during generation</li>\n      <li>During generation, keys and values grow with each step, leading to large <strong>KV caches</strong></li>\n    </ul>\n  </li>\n  <li>\n    <p>Hence, the decoder is more <strong>memory-bound</strong> than compute-bound during generation:</p>\n\n    <ul>\n      <li>Storing and reading from the <strong>KV cache</strong> dominates the time per token</li>\n      <li>The cost grows linearly with sequence length</li>\n    </ul>\n  </li>\n  <li>\n    <p>At each step <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-20-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>t</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-169\" style=\"width: 0.315em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.263em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.513em, 1000.26em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-170\"><span class=\"mi\" id=\"MathJax-Span-171\" style=\"font-family: STIXGeneral-Italic;\">t<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.816em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>t</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-20\">t</script>, the model computes:</p>\n  </li>\n</ul>\n<p>The decoder is autoregressive — it generates one token at a time and feeds it back in:</p>\n<ul>\n      <li>Attention involves both <strong>self-attention</strong> (causal) and <strong>encoder-decoder attention</strong></li>\n      <li>Cannot parallelize the same way as the encoder during generation</li>\n      <li>During generation, keys and values grow with each step, leading to large <strong>KV caches</strong></li>\n    </ul>\n<p>Hence, the decoder is more <strong>memory-bound</strong> than compute-bound during generation:</p>\n<ul>\n      <li>Storing and reading from the <strong>KV cache</strong> dominates the time per token</li>\n      <li>The cost grows linearly with sequence length</li>\n    </ul>\n<p>At each step <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-20-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>t</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-169\" style=\"width: 0.315em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.263em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.513em, 1000.26em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-170\"><span class=\"mi\" id=\"MathJax-Span-171\" style=\"font-family: STIXGeneral-Italic;\">t<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.816em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>t</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-20\">t</script>, the model computes:</p>\n<div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-21-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>Attention</mtext><mo stretchy=&quot;false&quot;>(</mo><msub><mi>Q</mi><mi>t</mi></msub><mo>,</mo><msub><mi>K</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>1</mn><mo>:</mo><mi>t</mi></mrow></msub><mo>,</mo><msub><mi>V</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>1</mn><mo>:</mo><mi>t</mi></mrow></msub><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mtext>softmax</mtext><mrow><mo>(</mo><mfrac><mrow><msub><mi>Q</mi><mi>t</mi></msub><msubsup><mi>K</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>1</mn><mo>:</mo><mi>t</mi></mrow><mi>T</mi></msubsup></mrow><msqrt><msub><mi>d</mi><mi>k</mi></msub></msqrt></mfrac><mo>)</mo></mrow><msub><mi>V</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>1</mn><mo>:</mo><mi>t</mi></mrow></msub></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-172\" style=\"width: 24.065em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 20.055em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(2.19em, 1020.05em, 5.576em, -999.997em); top: -4.112em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-173\"><span class=\"mtext\" id=\"MathJax-Span-174\" style=\"font-family: STIXGeneral-Regular;\">Attention</span><span class=\"mo\" id=\"MathJax-Span-175\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"msubsup\" id=\"MathJax-Span-176\"><span style=\"display: inline-block; position: relative; width: 0.992em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.68em, 4.326em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-177\" style=\"font-family: STIXGeneral-Italic;\">Q</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.732em;\"><span class=\"mi\" id=\"MathJax-Span-178\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">t<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-179\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-180\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 1.513em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.73em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-181\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.68em;\"><span class=\"texatom\" id=\"MathJax-Span-182\"><span class=\"mrow\" id=\"MathJax-Span-183\"><span class=\"mn\" id=\"MathJax-Span-184\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span><span class=\"mo\" id=\"MathJax-Span-185\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">:</span><span class=\"mi\" id=\"MathJax-Span-186\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">t<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-187\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-188\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 1.461em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.68em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-189\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.628em;\"><span class=\"texatom\" id=\"MathJax-Span-190\"><span class=\"mrow\" id=\"MathJax-Span-191\"><span class=\"mn\" id=\"MathJax-Span-192\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span><span class=\"mo\" id=\"MathJax-Span-193\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">:</span><span class=\"mi\" id=\"MathJax-Span-194\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">t<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-195\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-196\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mtext\" id=\"MathJax-Span-197\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">softmax</span><span class=\"mrow\" id=\"MathJax-Span-198\" style=\"padding-left: 0.211em;\"><span class=\"mo\" id=\"MathJax-Span-199\" style=\"vertical-align: -0.779em;\"><span style=\"font-family: STIXSizeFourSym;\">(</span></span><span class=\"mfrac\" id=\"MathJax-Span-200\"><span style=\"display: inline-block; position: relative; width: 2.607em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.076em, 1002.5em, 4.482em, -999.997em); top: -4.789em; left: 50%; margin-left: -1.247em;\"><span class=\"mrow\" id=\"MathJax-Span-201\"><span class=\"msubsup\" id=\"MathJax-Span-202\"><span style=\"display: inline-block; position: relative; width: 0.992em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.68em, 4.326em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-203\" style=\"font-family: STIXGeneral-Italic;\">Q</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.732em;\"><span class=\"mi\" id=\"MathJax-Span-204\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">t<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"msubsup\" id=\"MathJax-Span-205\"><span style=\"display: inline-block; position: relative; width: 1.513em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.73em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-206\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1000.52em, 4.169em, -999.997em); top: -4.372em; left: 0.784em;\"><span class=\"mi\" id=\"MathJax-Span-207\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">T<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1000.84em, 4.169em, -999.997em); top: -3.695em; left: 0.68em;\"><span class=\"texatom\" id=\"MathJax-Span-208\"><span class=\"mrow\" id=\"MathJax-Span-209\"><span class=\"mn\" id=\"MathJax-Span-210\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span><span class=\"mo\" id=\"MathJax-Span-211\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">:</span><span class=\"mi\" id=\"MathJax-Span-212\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">t<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(2.971em, 1001.88em, 4.534em, -999.997em); top: -3.122em; left: 50%; margin-left: -0.935em;\"><span class=\"msqrt\" id=\"MathJax-Span-213\"><span style=\"display: inline-block; position: relative; width: 1.878em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.326em, -999.997em); top: -4.008em; left: 0.94em;\"><span class=\"mrow\" id=\"MathJax-Span-214\"><span class=\"msubsup\" id=\"MathJax-Span-215\"><span style=\"display: inline-block; position: relative; width: 0.888em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-216\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"mi\" id=\"MathJax-Span-217\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">k<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.023em, 1000.94em, 3.388em, -999.997em); top: -4.06em; left: 0.94em;\"><span style=\"display: inline-block; position: relative; width: 0.94em; height: 0px;\"><span style=\"position: absolute; font-family: STIXGeneral-Regular; top: -4.008em; left: 0em;\">‾<span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; font-family: STIXGeneral-Regular; top: -4.008em; left: 0.419em;\">‾<span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(2.867em, 1000.94em, 4.43em, -999.997em); top: -3.904em; left: 0em;\"><span style=\"font-family: STIXGeneral-Regular;\">√</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1002.61em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.607em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-218\" style=\"vertical-align: -0.779em;\"><span style=\"font-family: STIXSizeFourSym;\">)</span></span></span><span class=\"msubsup\" id=\"MathJax-Span-219\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 1.461em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.68em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-220\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.628em;\"><span class=\"texatom\" id=\"MathJax-Span-221\"><span class=\"mrow\" id=\"MathJax-Span-222\"><span class=\"mn\" id=\"MathJax-Span-223\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span><span class=\"mo\" id=\"MathJax-Span-224\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">:</span><span class=\"mi\" id=\"MathJax-Span-225\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">t<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.117em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -1.622em; border-left: 0px solid; width: 0px; height: 3.816em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>Attention</mtext><mo stretchy=\"false\">(</mo><msub><mi>Q</mi><mi>t</mi></msub><mo>,</mo><msub><mi>K</mi><mrow class=\"MJX-TeXAtom-ORD\"><mn>1</mn><mo>:</mo><mi>t</mi></mrow></msub><mo>,</mo><msub><mi>V</mi><mrow class=\"MJX-TeXAtom-ORD\"><mn>1</mn><mo>:</mo><mi>t</mi></mrow></msub><mo stretchy=\"false\">)</mo><mo>=</mo><mtext>softmax</mtext><mrow><mo>(</mo><mfrac><mrow><msub><mi>Q</mi><mi>t</mi></msub><msubsup><mi>K</mi><mrow class=\"MJX-TeXAtom-ORD\"><mn>1</mn><mo>:</mo><mi>t</mi></mrow><mi>T</mi></msubsup></mrow><msqrt><msub><mi>d</mi><mi>k</mi></msub></msqrt></mfrac><mo>)</mo></mrow><msub><mi>V</mi><mrow class=\"MJX-TeXAtom-ORD\"><mn>1</mn><mo>:</mo><mi>t</mi></mrow></msub></math></span></span></div>\n<ul>\n  <li>\n    <p><strong>Consequences</strong>:</p>\n\n    <ul>\n      <li>Prefill (initial sequence context embedding) is <strong>parallelizable</strong> and compute-intensive</li>\n      <li><strong>Decode (autoregressive step-by-step)</strong> is <strong>sequential</strong>, leading to limited parallelism and more cache reads</li>\n    </ul>\n  </li>\n  <li>\n    <p>So:</p>\n    <ul>\n      <li><strong>Memory usage:</strong> High (growing with generated sequence)</li>\n      <li><strong>Compute intensity:</strong> Low per step</li>\n      <li><strong>Best suited hardware:</strong> Depends on phase\n        <ul>\n          <li>Prefill: GPU/NPU</li>\n          <li>Decode: CPU often sufficient unless batch generation is needed</li>\n        </ul>\n      </li>\n    </ul>\n  </li>\n</ul>\n<p><strong>Consequences</strong>:</p>\n<ul>\n      <li>Prefill (initial sequence context embedding) is <strong>parallelizable</strong> and compute-intensive</li>\n      <li><strong>Decode (autoregressive step-by-step)</strong> is <strong>sequential</strong>, leading to limited parallelism and more cache reads</li>\n    </ul>\n<p>So:</p>\n<ul>\n      <li><strong>Memory usage:</strong> High (growing with generated sequence)</li>\n      <li><strong>Compute intensity:</strong> Low per step</li>\n      <li><strong>Best suited hardware:</strong> Depends on phase\n        <ul>\n          <li>Prefill: GPU/NPU</li>\n          <li>Decode: CPU often sufficient unless batch generation is needed</li>\n        </ul>\n      </li>\n    </ul>\n<ul>\n          <li>Prefill: GPU/NPU</li>\n          <li>Decode: CPU often sufficient unless batch generation is needed</li>\n        </ul>",
    "contentMarkdown": "*   The decoder is autoregressive — it generates one token at a time and feeds it back in:\n    \n    *   Attention involves both **self-attention** (causal) and **encoder-decoder attention**\n    *   Cannot parallelize the same way as the encoder during generation\n    *   During generation, keys and values grow with each step, leading to large **KV caches**\n*   Hence, the decoder is more **memory-bound** than compute-bound during generation:\n    \n    *   Storing and reading from the **KV cache** dominates the time per token\n    *   The cost grows linearly with sequence length\n*   At each step ttt, the model computes:\n    \n\nThe decoder is autoregressive — it generates one token at a time and feeds it back in:\n\n*   Attention involves both **self-attention** (causal) and **encoder-decoder attention**\n*   Cannot parallelize the same way as the encoder during generation\n*   During generation, keys and values grow with each step, leading to large **KV caches**\n\nHence, the decoder is more **memory-bound** than compute-bound during generation:\n\n*   Storing and reading from the **KV cache** dominates the time per token\n*   The cost grows linearly with sequence length\n\nAt each step ttt, the model computes:\n\nAttention(Qt,K1:t,V1:t)\\=softmax(QtKT1:tdk‾‾√)V1:tAttention(Qt,K1:t,V1:t)\\=softmax(QtK1:tTdk)V1:t\n\n*   **Consequences**:\n    \n    *   Prefill (initial sequence context embedding) is **parallelizable** and compute-intensive\n    *   **Decode (autoregressive step-by-step)** is **sequential**, leading to limited parallelism and more cache reads\n*   So:\n    \n    *   **Memory usage:** High (growing with generated sequence)\n    *   **Compute intensity:** Low per step\n    *   **Best suited hardware:** Depends on phase\n        *   Prefill: GPU/NPU\n        *   Decode: CPU often sufficient unless batch generation is needed\n\n**Consequences**:\n\n*   Prefill (initial sequence context embedding) is **parallelizable** and compute-intensive\n*   **Decode (autoregressive step-by-step)** is **sequential**, leading to limited parallelism and more cache reads\n\nSo:\n\n*   **Memory usage:** High (growing with generated sequence)\n*   **Compute intensity:** Low per step\n*   **Best suited hardware:** Depends on phase\n    *   Prefill: GPU/NPU\n    *   Decode: CPU often sufficient unless batch generation is needed\n\n*   Prefill: GPU/NPU\n*   Decode: CPU often sufficient unless batch generation is needed",
    "contentLength": 19168,
    "wordCount": 319,
    "hasCode": false,
    "hasMath": true,
    "hasImages": false,
    "url": "https://aman.ai/primers/ai/on-device-transformers/#decoder:-memory-bound-nature"
  },
  {
    "id": "ai-on-device-transformers-central-processing-unit-cpu-3",
    "articleSlug": "on-device-transformers",
    "articleTitle": "On-device Transformers",
    "category": "On-Device AI",
    "chapter": "Hardware-Specific Characteristics (CPU, GPU, TPU, NPU)",
    "title": "Central Processing Unit (CPU)",
    "order": 3,
    "orderInChapter": 1,
    "contentHtml": "<h4 id=\"strengths\">Strengths</h4>\n<ul>\n  <li>Excellent single-thread performance</li>\n  <li>Low latency; ideal for on-demand and low-batch inference</li>\n  <li>Flexible memory access and branching logic</li>\n</ul>\n<h4 id=\"limitations\">Limitations</h4>\n<ul>\n  <li>Limited parallelism (typically 4–64 cores vs 1000s of GPU cores)</li>\n  <li>Lower throughput for matrix-heavy operations</li>\n  <li>Cache-friendly but bandwidth-limited compared to accelerators</li>\n</ul>\n<h4 id=\"when-to-use\">When to Use</h4>\n<ul>\n  <li>Autoregressive decoding for small models (e.g., 1–2B parameters)</li>\n  <li>Edge or offline devices with no GPU/NPU</li>\n  <li>Lightweight server-side deployments for on-demand inference</li>\n</ul>\n<h4 id=\"watchouts\">Watchouts</h4>\n<ul>\n  <li>Attention mechanisms (especially multi-head) can become bottlenecks due to cache locality issues</li>\n  <li>Performance highly dependent on software stack: use optimized libraries (e.g., oneDNN, ONNX Runtime, Intel Extension for PyTorch)</li>\n</ul>\n<h4 id=\"best-practices\">Best Practices</h4>\n<ul>\n  <li>Use quantization (<code class=\"language-plaintext highlighter-rouge\">int8</code> or <code class=\"language-plaintext highlighter-rouge\">float16</code> if supported)</li>\n  <li>Fuse layers to reduce memory bandwidth needs</li>\n  <li>Apply KV cache optimization aggressively for decoder workloads</li>\n</ul>",
    "contentMarkdown": "#### Strengths\n\n*   Excellent single-thread performance\n*   Low latency; ideal for on-demand and low-batch inference\n*   Flexible memory access and branching logic\n\n#### Limitations\n\n*   Limited parallelism (typically 4–64 cores vs 1000s of GPU cores)\n*   Lower throughput for matrix-heavy operations\n*   Cache-friendly but bandwidth-limited compared to accelerators\n\n#### When to Use\n\n*   Autoregressive decoding for small models (e.g., 1–2B parameters)\n*   Edge or offline devices with no GPU/NPU\n*   Lightweight server-side deployments for on-demand inference\n\n#### Watchouts\n\n*   Attention mechanisms (especially multi-head) can become bottlenecks due to cache locality issues\n*   Performance highly dependent on software stack: use optimized libraries (e.g., oneDNN, ONNX Runtime, Intel Extension for PyTorch)\n\n#### Best Practices\n\n*   Use quantization (`int8` or `float16` if supported)\n*   Fuse layers to reduce memory bandwidth needs\n*   Apply KV cache optimization aggressively for decoder workloads",
    "contentLength": 1368,
    "wordCount": 137,
    "hasCode": true,
    "hasMath": false,
    "hasImages": false,
    "url": "https://aman.ai/primers/ai/on-device-transformers/#central-processing-unit-(cpu)"
  },
  {
    "id": "ai-on-device-transformers-graphics-processing-unit-gpu-4",
    "articleSlug": "on-device-transformers",
    "articleTitle": "On-device Transformers",
    "category": "On-Device AI",
    "chapter": "Hardware-Specific Characteristics (CPU, GPU, TPU, NPU)",
    "title": "Graphics Processing Unit (GPU)",
    "order": 4,
    "orderInChapter": 2,
    "contentHtml": "<h4 id=\"strengths-1\">Strengths</h4>\n<ul>\n  <li>Massive parallelism via thousands of CUDA cores</li>\n  <li>High-bandwidth memory (HBM), e.g., 600+ GB/s</li>\n  <li>Excellent for batched inference and training</li>\n</ul>\n<h4 id=\"limitations-1\">Limitations</h4>\n<ul>\n  <li>Higher latency per operation than CPUs</li>\n  <li>Can be underutilized for small batch sizes or single-token decoding</li>\n  <li>More complex memory hierarchy</li>\n</ul>\n<h4 id=\"when-to-use-1\">When to Use</h4>\n<ul>\n  <li>Prefill operations where entire input sequence can be parallelized</li>\n  <li>Training and fine-tuning large models</li>\n  <li>Batch decoding (e.g., chat applications with multiple users)</li>\n</ul>\n<h4 id=\"watchouts-1\">Watchouts</h4>\n<ul>\n  <li>Decode stage underutilizes GPU unless using batching or advanced techniques like speculative decoding</li>\n  <li>Need to manage memory carefully — attention cache can become large</li>\n</ul>\n<h4 id=\"best-practices-1\">Best Practices</h4>\n<ul>\n  <li>Use Tensor Cores (e.g., with <code class=\"language-plaintext highlighter-rouge\">float16</code>/<code class=\"language-plaintext highlighter-rouge\">bfloat16</code>) for matrix operations</li>\n  <li>Leverage libraries like NVIDIA’s FasterTransformer or TensorRT</li>\n  <li>Minimize memory copies between host (CPU) and device (GPU)</li>\n</ul>",
    "contentMarkdown": "#### Strengths\n\n*   Massive parallelism via thousands of CUDA cores\n*   High-bandwidth memory (HBM), e.g., 600+ GB/s\n*   Excellent for batched inference and training\n\n#### Limitations\n\n*   Higher latency per operation than CPUs\n*   Can be underutilized for small batch sizes or single-token decoding\n*   More complex memory hierarchy\n\n#### When to Use\n\n*   Prefill operations where entire input sequence can be parallelized\n*   Training and fine-tuning large models\n*   Batch decoding (e.g., chat applications with multiple users)\n\n#### Watchouts\n\n*   Decode stage underutilizes GPU unless using batching or advanced techniques like speculative decoding\n*   Need to manage memory carefully — attention cache can become large\n\n#### Best Practices\n\n*   Use Tensor Cores (e.g., with `float16`/`bfloat16`) for matrix operations\n*   Leverage libraries like NVIDIA’s FasterTransformer or TensorRT\n*   Minimize memory copies between host (CPU) and device (GPU)",
    "contentLength": 1323,
    "wordCount": 137,
    "hasCode": true,
    "hasMath": false,
    "hasImages": false,
    "url": "https://aman.ai/primers/ai/on-device-transformers/#graphics-processing-unit-(gpu)"
  },
  {
    "id": "ai-on-device-transformers-tensor-processing-unit-tpu-5",
    "articleSlug": "on-device-transformers",
    "articleTitle": "On-device Transformers",
    "category": "On-Device AI",
    "chapter": "Hardware-Specific Characteristics (CPU, GPU, TPU, NPU)",
    "title": "Tensor Processing Unit (TPU)",
    "order": 5,
    "orderInChapter": 3,
    "contentHtml": "<h4 id=\"strengths-2\">Strengths</h4>\n<ul>\n  <li>Designed specifically for tensor operations (dense matmuls, convolutions)</li>\n  <li>Excellent for training and large-scale inference</li>\n  <li>Systolic array architecture delivers massive throughput</li>\n</ul>\n<h4 id=\"limitations-2\">Limitations</h4>\n<ul>\n  <li>Limited flexibility (less suited for irregular control flow)</li>\n  <li>Software stack tied to Google ecosystem (JAX, TensorFlow)</li>\n</ul>\n<h4 id=\"when-to-use-2\">When to Use</h4>\n<ul>\n  <li>Training large, deep models with billions to trillions of parameters (e.g., Llama, T5, BERT, etc.)</li>\n  <li>Batched prefill in inference</li>\n</ul>\n<h4 id=\"watchouts-2\">Watchouts</h4>\n<ul>\n  <li>Autoregressive decoding underperforms due to lack of dynamic control flow</li>\n  <li>Fixed size memory buffers limit dynamic sequence handling</li>\n</ul>\n<h4 id=\"best-practices-2\">Best Practices</h4>\n<ul>\n  <li>Keep compute on TPU, avoid offloading to CPU</li>\n  <li>Use <code class=\"language-plaintext highlighter-rouge\">xla</code> compilation to fuse ops and reduce memory overhead</li>\n  <li>Align tensor shapes to match hardware block sizes</li>\n</ul>",
    "contentMarkdown": "#### Strengths\n\n*   Designed specifically for tensor operations (dense matmuls, convolutions)\n*   Excellent for training and large-scale inference\n*   Systolic array architecture delivers massive throughput\n\n#### Limitations\n\n*   Limited flexibility (less suited for irregular control flow)\n*   Software stack tied to Google ecosystem (JAX, TensorFlow)\n\n#### When to Use\n\n*   Training large, deep models with billions to trillions of parameters (e.g., Llama, T5, BERT, etc.)\n*   Batched prefill in inference\n\n#### Watchouts\n\n*   Autoregressive decoding underperforms due to lack of dynamic control flow\n*   Fixed size memory buffers limit dynamic sequence handling\n\n#### Best Practices\n\n*   Keep compute on TPU, avoid offloading to CPU\n*   Use `xla` compilation to fuse ops and reduce memory overhead\n*   Align tensor shapes to match hardware block sizes",
    "contentLength": 1154,
    "wordCount": 124,
    "hasCode": true,
    "hasMath": false,
    "hasImages": false,
    "url": "https://aman.ai/primers/ai/on-device-transformers/#tensor-processing-unit-(tpu)"
  },
  {
    "id": "ai-on-device-transformers-neural-processing-unit-npu-6",
    "articleSlug": "on-device-transformers",
    "articleTitle": "On-device Transformers",
    "category": "On-Device AI",
    "chapter": "Hardware-Specific Characteristics (CPU, GPU, TPU, NPU)",
    "title": "Neural Processing Unit (NPU)",
    "order": 6,
    "orderInChapter": 4,
    "contentHtml": "<h4 id=\"strengths-3\">Strengths</h4>\n<ul>\n  <li>Optimized for inference on mobile and edge devices</li>\n  <li>Energy-efficient; often integrated with smartphone SoCs</li>\n  <li>Dedicated acceleration for quantized models (e.g., <code class=\"language-plaintext highlighter-rouge\">int8</code>, <code class=\"language-plaintext highlighter-rouge\">float16</code>)</li>\n</ul>\n<h4 id=\"limitations-3\">Limitations</h4>\n<ul>\n  <li>Vary widely in capability and programming APIs (e.g., Apple’s ANE, Qualcomm’s Hexagon, Huawei’s Ascend)</li>\n  <li>Difficult to customize beyond supported ops</li>\n</ul>\n<h4 id=\"when-to-use-3\">When to Use</h4>\n<ul>\n  <li>On-device generation (e.g., real-time voice assistants)</li>\n  <li>Low-latency use-cases with small LLMs or distilled models</li>\n</ul>\n<h4 id=\"watchouts-3\">Watchouts</h4>\n<ul>\n  <li>Must quantize model to match NPU-supported formats</li>\n  <li>Performance depends heavily on vendor-specific SDKs (e.g., CoreML, NNAPI, SNPE)</li>\n</ul>\n<h4 id=\"best-practices-3\">Best Practices</h4>\n<ul>\n  <li>Use static quantization and operation fusing</li>\n  <li>Prune and distill models before deployment</li>\n  <li>Use vendor-optimized Transformer blocks when available</li>\n</ul>",
    "contentMarkdown": "#### Strengths\n\n*   Optimized for inference on mobile and edge devices\n*   Energy-efficient; often integrated with smartphone SoCs\n*   Dedicated acceleration for quantized models (e.g., `int8`, `float16`)\n\n#### Limitations\n\n*   Vary widely in capability and programming APIs (e.g., Apple’s ANE, Qualcomm’s Hexagon, Huawei’s Ascend)\n*   Difficult to customize beyond supported ops\n\n#### When to Use\n\n*   On-device generation (e.g., real-time voice assistants)\n*   Low-latency use-cases with small LLMs or distilled models\n\n#### Watchouts\n\n*   Must quantize model to match NPU-supported formats\n*   Performance depends heavily on vendor-specific SDKs (e.g., CoreML, NNAPI, SNPE)\n\n#### Best Practices\n\n*   Use static quantization and operation fusing\n*   Prune and distill models before deployment\n*   Use vendor-optimized Transformer blocks when available",
    "contentLength": 1209,
    "wordCount": 116,
    "hasCode": true,
    "hasMath": false,
    "hasImages": false,
    "url": "https://aman.ai/primers/ai/on-device-transformers/#neural-processing-unit-(npu)"
  },
  {
    "id": "ai-on-device-transformers-comparative-analysis-7",
    "articleSlug": "on-device-transformers",
    "articleTitle": "On-device Transformers",
    "category": "On-Device AI",
    "chapter": "Hardware-Specific Characteristics (CPU, GPU, TPU, NPU)",
    "title": "Comparative Analysis",
    "order": 7,
    "orderInChapter": 5,
    "contentHtml": "<div align=\"center\">\n<table class=\"tg\">\n<thead>\n<tr>\n<th class=\"tg-hcenter-valign-first\"><strong>Feature</strong></th>\n<th class=\"tg-hcenter-valign-first\"><strong>CPU</strong></th>\n<th class=\"tg-hcenter-valign-first\"><strong>GPU</strong></th>\n<th class=\"tg-hcenter-valign-first\"><strong>TPU</strong></th>\n<th class=\"tg-hcenter-valign-second\"><strong>NPU (Edge)</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td class=\"tg-tleft-valign-first\">Parallelism</td>\n<td class=\"tg-tleft-valign-first\">Low</td>\n<td class=\"tg-tleft-valign-first\">High</td>\n<td class=\"tg-tleft-valign-first\">Very High</td>\n<td class=\"tg-tleft-valign-second\">Moderate</td>\n</tr>\n<tr>\n<td class=\"tg-tleft-valign-first\">Prefill Performance</td>\n<td class=\"tg-tleft-valign-first\">Moderate</td>\n<td class=\"tg-tleft-valign-first\">Excellent</td>\n<td class=\"tg-tleft-valign-first\">Excellent</td>\n<td class=\"tg-tleft-valign-second\">Moderate</td>\n</tr>\n<tr>\n<td class=\"tg-tleft-valign-first\">Decode Performance</td>\n<td class=\"tg-tleft-valign-first\">Good (low-batch)</td>\n<td class=\"tg-tleft-valign-first\">Moderate</td>\n<td class=\"tg-tleft-valign-first\">Poor</td>\n<td class=\"tg-tleft-valign-second\">Good (quantized)</td>\n</tr>\n<tr>\n<td class=\"tg-tleft-valign-first\">Memory Bandwidth</td>\n<td class=\"tg-tleft-valign-first\">Low</td>\n<td class=\"tg-tleft-valign-first\">High</td>\n<td class=\"tg-tleft-valign-first\">Very High</td>\n<td class=\"tg-tleft-valign-second\">Low–Moderate</td>\n</tr>\n<tr>\n<td class=\"tg-tleft-valign-first\">Flexibility</td>\n<td class=\"tg-tleft-valign-first\">Very High</td>\n<td class=\"tg-tleft-valign-first\">High</td>\n<td class=\"tg-tleft-valign-first\">Low</td>\n<td class=\"tg-tleft-valign-second\">Low</td>\n</tr>\n<tr>\n<td class=\"tg-tleft-valign-first\">Quantization Support</td>\n<td class=\"tg-tleft-valign-first\">Yes (<code>int8</code>)</td>\n<td class=\"tg-tleft-valign-first\">Yes (TensorRT)</td>\n<td class=\"tg-tleft-valign-first\">Yes (<code>bfloat16</code>)</td>\n<td class=\"tg-tleft-valign-second\">Yes (`int8`-only)</td>\n</tr>\n</tbody>\n</table>\n</div>\n<table class=\"tg\">\n<thead>\n<tr>\n<th class=\"tg-hcenter-valign-first\"><strong>Feature</strong></th>\n<th class=\"tg-hcenter-valign-first\"><strong>CPU</strong></th>\n<th class=\"tg-hcenter-valign-first\"><strong>GPU</strong></th>\n<th class=\"tg-hcenter-valign-first\"><strong>TPU</strong></th>\n<th class=\"tg-hcenter-valign-second\"><strong>NPU (Edge)</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td class=\"tg-tleft-valign-first\">Parallelism</td>\n<td class=\"tg-tleft-valign-first\">Low</td>\n<td class=\"tg-tleft-valign-first\">High</td>\n<td class=\"tg-tleft-valign-first\">Very High</td>\n<td class=\"tg-tleft-valign-second\">Moderate</td>\n</tr>\n<tr>\n<td class=\"tg-tleft-valign-first\">Prefill Performance</td>\n<td class=\"tg-tleft-valign-first\">Moderate</td>\n<td class=\"tg-tleft-valign-first\">Excellent</td>\n<td class=\"tg-tleft-valign-first\">Excellent</td>\n<td class=\"tg-tleft-valign-second\">Moderate</td>\n</tr>\n<tr>\n<td class=\"tg-tleft-valign-first\">Decode Performance</td>\n<td class=\"tg-tleft-valign-first\">Good (low-batch)</td>\n<td class=\"tg-tleft-valign-first\">Moderate</td>\n<td class=\"tg-tleft-valign-first\">Poor</td>\n<td class=\"tg-tleft-valign-second\">Good (quantized)</td>\n</tr>\n<tr>\n<td class=\"tg-tleft-valign-first\">Memory Bandwidth</td>\n<td class=\"tg-tleft-valign-first\">Low</td>\n<td class=\"tg-tleft-valign-first\">High</td>\n<td class=\"tg-tleft-valign-first\">Very High</td>\n<td class=\"tg-tleft-valign-second\">Low–Moderate</td>\n</tr>\n<tr>\n<td class=\"tg-tleft-valign-first\">Flexibility</td>\n<td class=\"tg-tleft-valign-first\">Very High</td>\n<td class=\"tg-tleft-valign-first\">High</td>\n<td class=\"tg-tleft-valign-first\">Low</td>\n<td class=\"tg-tleft-valign-second\">Low</td>\n</tr>\n<tr>\n<td class=\"tg-tleft-valign-first\">Quantization Support</td>\n<td class=\"tg-tleft-valign-first\">Yes (<code>int8</code>)</td>\n<td class=\"tg-tleft-valign-first\">Yes (TensorRT)</td>\n<td class=\"tg-tleft-valign-first\">Yes (<code>bfloat16</code>)</td>\n<td class=\"tg-tleft-valign-second\">Yes (`int8`-only)</td>\n</tr>\n</tbody>\n</table>",
    "contentMarkdown": "**Feature**\n\n**CPU**\n\n**GPU**\n\n**TPU**\n\n**NPU (Edge)**\n\nParallelism\n\nLow\n\nHigh\n\nVery High\n\nModerate\n\nPrefill Performance\n\nModerate\n\nExcellent\n\nExcellent\n\nModerate\n\nDecode Performance\n\nGood (low-batch)\n\nModerate\n\nPoor\n\nGood (quantized)\n\nMemory Bandwidth\n\nLow\n\nHigh\n\nVery High\n\nLow–Moderate\n\nFlexibility\n\nVery High\n\nHigh\n\nLow\n\nLow\n\nQuantization Support\n\nYes (`int8`)\n\nYes (TensorRT)\n\nYes (`bfloat16`)\n\nYes (\\`int8\\`-only)\n\n**Feature**\n\n**CPU**\n\n**GPU**\n\n**TPU**\n\n**NPU (Edge)**\n\nParallelism\n\nLow\n\nHigh\n\nVery High\n\nModerate\n\nPrefill Performance\n\nModerate\n\nExcellent\n\nExcellent\n\nModerate\n\nDecode Performance\n\nGood (low-batch)\n\nModerate\n\nPoor\n\nGood (quantized)\n\nMemory Bandwidth\n\nLow\n\nHigh\n\nVery High\n\nLow–Moderate\n\nFlexibility\n\nVery High\n\nHigh\n\nLow\n\nLow\n\nQuantization Support\n\nYes (`int8`)\n\nYes (TensorRT)\n\nYes (`bfloat16`)\n\nYes (\\`int8\\`-only)",
    "contentLength": 4011,
    "wordCount": 98,
    "hasCode": true,
    "hasMath": false,
    "hasImages": false,
    "url": "https://aman.ai/primers/ai/on-device-transformers/#comparative-analysis"
  },
  {
    "id": "ai-on-device-transformers-balancing-compute-and-memory-prefill-vs-decode-opt-8",
    "articleSlug": "on-device-transformers",
    "articleTitle": "On-device Transformers",
    "category": "On-Device AI",
    "chapter": "Optimization Techniques for On-Device Transformers",
    "title": "Balancing Compute and Memory: Prefill vs. Decode Optimization",
    "order": 8,
    "orderInChapter": 1,
    "contentHtml": "<ul>\n  <li>\n    <p>Transformer inference is divided into two distinct phases:</p>\n\n    <ol>\n      <li>\n        <p><strong>Prefill Phase</strong>:</p>\n\n        <ul>\n          <li>Processes the input prompt to generate the initial attention and hidden states.</li>\n          <li>This phase can be highly parallelized across sequence length and batch size.</li>\n        </ul>\n      </li>\n      <li>\n        <p><strong>Decode Phase</strong>:</p>\n\n        <ul>\n          <li>Generates output tokens one at a time in an autoregressive loop.</li>\n          <li>At each step, past tokens must be revisited via the KV cache, leading to repetitive memory access.</li>\n        </ul>\n      </li>\n    </ol>\n  </li>\n  <li>\n    <p>Because these phases differ in structure, they have different performance bottlenecks and require distinct optimization strategies:</p>\n  </li>\n</ul>\n<p>Transformer inference is divided into two distinct phases:</p>\n<ol>\n      <li>\n        <p><strong>Prefill Phase</strong>:</p>\n\n        <ul>\n          <li>Processes the input prompt to generate the initial attention and hidden states.</li>\n          <li>This phase can be highly parallelized across sequence length and batch size.</li>\n        </ul>\n      </li>\n      <li>\n        <p><strong>Decode Phase</strong>:</p>\n\n        <ul>\n          <li>Generates output tokens one at a time in an autoregressive loop.</li>\n          <li>At each step, past tokens must be revisited via the KV cache, leading to repetitive memory access.</li>\n        </ul>\n      </li>\n    </ol>\n<p><strong>Prefill Phase</strong>:</p>\n<ul>\n          <li>Processes the input prompt to generate the initial attention and hidden states.</li>\n          <li>This phase can be highly parallelized across sequence length and batch size.</li>\n        </ul>\n<p><strong>Decode Phase</strong>:</p>\n<ul>\n          <li>Generates output tokens one at a time in an autoregressive loop.</li>\n          <li>At each step, past tokens must be revisited via the KV cache, leading to repetitive memory access.</li>\n        </ul>\n<p>Because these phases differ in structure, they have different performance bottlenecks and require distinct optimization strategies:</p>\n<h4 id=\"why-different-performance-bottlenecks-require-different-optimization-strategies\">Why Different Performance Bottlenecks Require Different Optimization Strategies</h4>\n<ul>\n  <li>\n    <p><strong>Prefill is compute-bound</strong>:</p>\n\n    <ul>\n      <li>Dominated by large matrix multiplications and attention computations.</li>\n      <li>Performance depends on how much raw compute throughput the device has (e.g., <code class=\"language-plaintext highlighter-rouge\">float16</code> or <code class=\"language-plaintext highlighter-rouge\">bfloat16</code> throughput on GPUs/TPUs).</li>\n      <li>\n        <p>To optimize:</p>\n\n        <ul>\n          <li><strong>Dequantize weights early</strong> (from <code class=\"language-plaintext highlighter-rouge\">int8</code>/<code class=\"language-plaintext highlighter-rouge\">int4</code> to <code class=\"language-plaintext highlighter-rouge\">float16</code>/<code class=\"language-plaintext highlighter-rouge\">float32</code>) before compute.</li>\n          <li>This ensures clean matrix operations using high-precision compute engines (e.g., Tensor Cores or CPU vector units).</li>\n        </ul>\n      </li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Decode is memory-bound</strong>:</p>\n\n    <ul>\n      <li>Dominated by repeated memory reads from the KV cache and weights.</li>\n      <li>Each token step requires pulling more memory into cache.</li>\n      <li>\n        <p>To optimize:</p>\n\n        <ul>\n          <li><strong>Delay dequantization</strong> until computation, using compact representations as long as possible.</li>\n          <li>This minimizes bandwidth usage and cache misses, especially on CPUs and NPUs.</li>\n        </ul>\n      </li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Illustration: Optimizing LLM Inference by Adapting to Compute and Memory Bottlenecks (Different Performance Bottlenecks require Different Optimization Strategies)</strong>:</p>\n\n    <ul>\n      <li>The figure below (<a href=\"https://developers.googleblog.com/en/large-language-models-on-device-with-mediapipe-and-tensorflow-lite/\">source</a>) demonstrates how different performance bottlenecks in the LLM inference pipeline lead to distinct optimization strategies for handling dequantization of weights.</li>\n    </ul>\n\n    <p><img src=\"/primers/ai/assets/on-device-transformers/OptimizationStrategiesBottlenecks.jpg\" alt=\"Optimization strategies for prefill vs decode phases\"></p>\n\n    <ul>\n      <li>\n        <p>In the <strong>prefill phase</strong>, which is compute-intensive, the model first <strong>dequantizes</strong> low-bit weights (<code class=\"language-plaintext highlighter-rouge\">int4</code>) into floating-point (<code class=\"language-plaintext highlighter-rouge\">float16</code>) values before passing them to the convolution (<code class=\"language-plaintext highlighter-rouge\">Conv_2D</code>) operator. This ensures optimal performance for heavy computations, as the floating-point operations run more efficiently on modern processors.</p>\n      </li>\n      <li>\n        <p>In contrast, the <strong>decode phase</strong> is memory-intensive. Here, instead of dequantizing weights ahead of time, the model uses <strong>fused Conv_2D with dequantization</strong>, keeping weights in their compact form (<code class=\"language-plaintext highlighter-rouge\">int4</code>) until they are needed. This reduces memory bandwidth usage by avoiding unnecessary data expansion during transfer, which is critical when decoding tokens one at a time.</p>\n      </li>\n      <li>\n        <p>This design highlights a core principle in system optimization: different stages of computation may require tailored approaches based on their unique constraints—compute-bound stages benefit from early dequantization, while memory-bound stages gain from deferred dequantization.</p>\n      </li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Key takeaways</strong>:</p>\n\n    <ul>\n      <li>\n        <p>Performance optimization isn’t one-size-fits-all. You have to understand where the bottleneck is (compute vs memory) and tailor your strategy to the bottleneck:</p>\n\n        <ul>\n          <li><em>Dequantize early when compute-bound (prefill phase).</em></li>\n          <li><em>Dequantize late when memory-bound (decode phase).</em></li>\n        </ul>\n      </li>\n      <li>\n        <p>This phase-aware optimization is foundational for achieving efficient LLM inference on-device and under constrained compute/memory budgets.</p>\n      </li>\n    </ul>\n  </li>\n</ul>\n<p><strong>Prefill is compute-bound</strong>:</p>\n<ul>\n      <li>Dominated by large matrix multiplications and attention computations.</li>\n      <li>Performance depends on how much raw compute throughput the device has (e.g., <code class=\"language-plaintext highlighter-rouge\">float16</code> or <code class=\"language-plaintext highlighter-rouge\">bfloat16</code> throughput on GPUs/TPUs).</li>\n      <li>\n        <p>To optimize:</p>\n\n        <ul>\n          <li><strong>Dequantize weights early</strong> (from <code class=\"language-plaintext highlighter-rouge\">int8</code>/<code class=\"language-plaintext highlighter-rouge\">int4</code> to <code class=\"language-plaintext highlighter-rouge\">float16</code>/<code class=\"language-plaintext highlighter-rouge\">float32</code>) before compute.</li>\n          <li>This ensures clean matrix operations using high-precision compute engines (e.g., Tensor Cores or CPU vector units).</li>\n        </ul>\n      </li>\n    </ul>\n<p>To optimize:</p>\n<ul>\n          <li><strong>Dequantize weights early</strong> (from <code class=\"language-plaintext highlighter-rouge\">int8</code>/<code class=\"language-plaintext highlighter-rouge\">int4</code> to <code class=\"language-plaintext highlighter-rouge\">float16</code>/<code class=\"language-plaintext highlighter-rouge\">float32</code>) before compute.</li>\n          <li>This ensures clean matrix operations using high-precision compute engines (e.g., Tensor Cores or CPU vector units).</li>\n        </ul>\n<p><strong>Decode is memory-bound</strong>:</p>\n<ul>\n      <li>Dominated by repeated memory reads from the KV cache and weights.</li>\n      <li>Each token step requires pulling more memory into cache.</li>\n      <li>\n        <p>To optimize:</p>\n\n        <ul>\n          <li><strong>Delay dequantization</strong> until computation, using compact representations as long as possible.</li>\n          <li>This minimizes bandwidth usage and cache misses, especially on CPUs and NPUs.</li>\n        </ul>\n      </li>\n    </ul>\n<p>To optimize:</p>\n<ul>\n          <li><strong>Delay dequantization</strong> until computation, using compact representations as long as possible.</li>\n          <li>This minimizes bandwidth usage and cache misses, especially on CPUs and NPUs.</li>\n        </ul>\n<p><strong>Illustration: Optimizing LLM Inference by Adapting to Compute and Memory Bottlenecks (Different Performance Bottlenecks require Different Optimization Strategies)</strong>:</p>\n<ul>\n      <li>The figure below (<a href=\"https://developers.googleblog.com/en/large-language-models-on-device-with-mediapipe-and-tensorflow-lite/\">source</a>) demonstrates how different performance bottlenecks in the LLM inference pipeline lead to distinct optimization strategies for handling dequantization of weights.</li>\n    </ul>\n<p><img src=\"/primers/ai/assets/on-device-transformers/OptimizationStrategiesBottlenecks.jpg\" alt=\"Optimization strategies for prefill vs decode phases\"></p>\n<ul>\n      <li>\n        <p>In the <strong>prefill phase</strong>, which is compute-intensive, the model first <strong>dequantizes</strong> low-bit weights (<code class=\"language-plaintext highlighter-rouge\">int4</code>) into floating-point (<code class=\"language-plaintext highlighter-rouge\">float16</code>) values before passing them to the convolution (<code class=\"language-plaintext highlighter-rouge\">Conv_2D</code>) operator. This ensures optimal performance for heavy computations, as the floating-point operations run more efficiently on modern processors.</p>\n      </li>\n      <li>\n        <p>In contrast, the <strong>decode phase</strong> is memory-intensive. Here, instead of dequantizing weights ahead of time, the model uses <strong>fused Conv_2D with dequantization</strong>, keeping weights in their compact form (<code class=\"language-plaintext highlighter-rouge\">int4</code>) until they are needed. This reduces memory bandwidth usage by avoiding unnecessary data expansion during transfer, which is critical when decoding tokens one at a time.</p>\n      </li>\n      <li>\n        <p>This design highlights a core principle in system optimization: different stages of computation may require tailored approaches based on their unique constraints—compute-bound stages benefit from early dequantization, while memory-bound stages gain from deferred dequantization.</p>\n      </li>\n    </ul>\n<p>In the <strong>prefill phase</strong>, which is compute-intensive, the model first <strong>dequantizes</strong> low-bit weights (<code class=\"language-plaintext highlighter-rouge\">int4</code>) into floating-point (<code class=\"language-plaintext highlighter-rouge\">float16</code>) values before passing them to the convolution (<code class=\"language-plaintext highlighter-rouge\">Conv_2D</code>) operator. This ensures optimal performance for heavy computations, as the floating-point operations run more efficiently on modern processors.</p>\n<p>In contrast, the <strong>decode phase</strong> is memory-intensive. Here, instead of dequantizing weights ahead of time, the model uses <strong>fused Conv_2D with dequantization</strong>, keeping weights in their compact form (<code class=\"language-plaintext highlighter-rouge\">int4</code>) until they are needed. This reduces memory bandwidth usage by avoiding unnecessary data expansion during transfer, which is critical when decoding tokens one at a time.</p>\n<p>This design highlights a core principle in system optimization: different stages of computation may require tailored approaches based on their unique constraints—compute-bound stages benefit from early dequantization, while memory-bound stages gain from deferred dequantization.</p>\n<p><strong>Key takeaways</strong>:</p>\n<ul>\n      <li>\n        <p>Performance optimization isn’t one-size-fits-all. You have to understand where the bottleneck is (compute vs memory) and tailor your strategy to the bottleneck:</p>\n\n        <ul>\n          <li><em>Dequantize early when compute-bound (prefill phase).</em></li>\n          <li><em>Dequantize late when memory-bound (decode phase).</em></li>\n        </ul>\n      </li>\n      <li>\n        <p>This phase-aware optimization is foundational for achieving efficient LLM inference on-device and under constrained compute/memory budgets.</p>\n      </li>\n    </ul>\n<p>Performance optimization isn’t one-size-fits-all. You have to understand where the bottleneck is (compute vs memory) and tailor your strategy to the bottleneck:</p>\n<ul>\n          <li><em>Dequantize early when compute-bound (prefill phase).</em></li>\n          <li><em>Dequantize late when memory-bound (decode phase).</em></li>\n        </ul>\n<p>This phase-aware optimization is foundational for achieving efficient LLM inference on-device and under constrained compute/memory budgets.</p>",
    "contentMarkdown": "*   Transformer inference is divided into two distinct phases:\n    \n    1.  **Prefill Phase**:\n        \n        *   Processes the input prompt to generate the initial attention and hidden states.\n        *   This phase can be highly parallelized across sequence length and batch size.\n    2.  **Decode Phase**:\n        \n        *   Generates output tokens one at a time in an autoregressive loop.\n        *   At each step, past tokens must be revisited via the KV cache, leading to repetitive memory access.\n*   Because these phases differ in structure, they have different performance bottlenecks and require distinct optimization strategies:\n    \n\nTransformer inference is divided into two distinct phases:\n\n1.  **Prefill Phase**:\n    \n    *   Processes the input prompt to generate the initial attention and hidden states.\n    *   This phase can be highly parallelized across sequence length and batch size.\n2.  **Decode Phase**:\n    \n    *   Generates output tokens one at a time in an autoregressive loop.\n    *   At each step, past tokens must be revisited via the KV cache, leading to repetitive memory access.\n\n**Prefill Phase**:\n\n*   Processes the input prompt to generate the initial attention and hidden states.\n*   This phase can be highly parallelized across sequence length and batch size.\n\n**Decode Phase**:\n\n*   Generates output tokens one at a time in an autoregressive loop.\n*   At each step, past tokens must be revisited via the KV cache, leading to repetitive memory access.\n\nBecause these phases differ in structure, they have different performance bottlenecks and require distinct optimization strategies:\n\n#### Why Different Performance Bottlenecks Require Different Optimization Strategies\n\n*   **Prefill is compute-bound**:\n    \n    *   Dominated by large matrix multiplications and attention computations.\n    *   Performance depends on how much raw compute throughput the device has (e.g., `float16` or `bfloat16` throughput on GPUs/TPUs).\n    *   To optimize:\n        \n        *   **Dequantize weights early** (from `int8`/`int4` to `float16`/`float32`) before compute.\n        *   This ensures clean matrix operations using high-precision compute engines (e.g., Tensor Cores or CPU vector units).\n*   **Decode is memory-bound**:\n    \n    *   Dominated by repeated memory reads from the KV cache and weights.\n    *   Each token step requires pulling more memory into cache.\n    *   To optimize:\n        \n        *   **Delay dequantization** until computation, using compact representations as long as possible.\n        *   This minimizes bandwidth usage and cache misses, especially on CPUs and NPUs.\n*   **Illustration: Optimizing LLM Inference by Adapting to Compute and Memory Bottlenecks (Different Performance Bottlenecks require Different Optimization Strategies)**:\n    \n    *   The figure below ([source](https://developers.googleblog.com/en/large-language-models-on-device-with-mediapipe-and-tensorflow-lite/)) demonstrates how different performance bottlenecks in the LLM inference pipeline lead to distinct optimization strategies for handling dequantization of weights.\n    \n    ![Optimization strategies for prefill vs decode phases](/primers/ai/assets/on-device-transformers/OptimizationStrategiesBottlenecks.jpg)\n    \n    *   In the **prefill phase**, which is compute-intensive, the model first **dequantizes** low-bit weights (`int4`) into floating-point (`float16`) values before passing them to the convolution (`Conv_2D`) operator. This ensures optimal performance for heavy computations, as the floating-point operations run more efficiently on modern processors.\n        \n    *   In contrast, the **decode phase** is memory-intensive. Here, instead of dequantizing weights ahead of time, the model uses **fused Conv\\_2D with dequantization**, keeping weights in their compact form (`int4`) until they are needed. This reduces memory bandwidth usage by avoiding unnecessary data expansion during transfer, which is critical when decoding tokens one at a time.\n        \n    *   This design highlights a core principle in system optimization: different stages of computation may require tailored approaches based on their unique constraints—compute-bound stages benefit from early dequantization, while memory-bound stages gain from deferred dequantization.\n        \n*   **Key takeaways**:\n    \n    *   Performance optimization isn’t one-size-fits-all. You have to understand where the bottleneck is (compute vs memory) and tailor your strategy to the bottleneck:\n        \n        *   _Dequantize early when compute-bound (prefill phase)._\n        *   _Dequantize late when memory-bound (decode phase)._\n    *   This phase-aware optimization is foundational for achieving efficient LLM inference on-device and under constrained compute/memory budgets.\n        \n\n**Prefill is compute-bound**:\n\n*   Dominated by large matrix multiplications and attention computations.\n*   Performance depends on how much raw compute throughput the device has (e.g., `float16` or `bfloat16` throughput on GPUs/TPUs).\n*   To optimize:\n    \n    *   **Dequantize weights early** (from `int8`/`int4` to `float16`/`float32`) before compute.\n    *   This ensures clean matrix operations using high-precision compute engines (e.g., Tensor Cores or CPU vector units).\n\nTo optimize:\n\n*   **Dequantize weights early** (from `int8`/`int4` to `float16`/`float32`) before compute.\n*   This ensures clean matrix operations using high-precision compute engines (e.g., Tensor Cores or CPU vector units).\n\n**Decode is memory-bound**:\n\n*   Dominated by repeated memory reads from the KV cache and weights.\n*   Each token step requires pulling more memory into cache.\n*   To optimize:\n    \n    *   **Delay dequantization** until computation, using compact representations as long as possible.\n    *   This minimizes bandwidth usage and cache misses, especially on CPUs and NPUs.\n\nTo optimize:\n\n*   **Delay dequantization** until computation, using compact representations as long as possible.\n*   This minimizes bandwidth usage and cache misses, especially on CPUs and NPUs.\n\n**Illustration: Optimizing LLM Inference by Adapting to Compute and Memory Bottlenecks (Different Performance Bottlenecks require Different Optimization Strategies)**:\n\n*   The figure below ([source](https://developers.googleblog.com/en/large-language-models-on-device-with-mediapipe-and-tensorflow-lite/)) demonstrates how different performance bottlenecks in the LLM inference pipeline lead to distinct optimization strategies for handling dequantization of weights.\n\n![Optimization strategies for prefill vs decode phases](/primers/ai/assets/on-device-transformers/OptimizationStrategiesBottlenecks.jpg)\n\n*   In the **prefill phase**, which is compute-intensive, the model first **dequantizes** low-bit weights (`int4`) into floating-point (`float16`) values before passing them to the convolution (`Conv_2D`) operator. This ensures optimal performance for heavy computations, as the floating-point operations run more efficiently on modern processors.\n    \n*   In contrast, the **decode phase** is memory-intensive. Here, instead of dequantizing weights ahead of time, the model uses **fused Conv\\_2D with dequantization**, keeping weights in their compact form (`int4`) until they are needed. This reduces memory bandwidth usage by avoiding unnecessary data expansion during transfer, which is critical when decoding tokens one at a time.\n    \n*   This design highlights a core principle in system optimization: different stages of computation may require tailored approaches based on their unique constraints—compute-bound stages benefit from early dequantization, while memory-bound stages gain from deferred dequantization.\n    \n\nIn the **prefill phase**, which is compute-intensive, the model first **dequantizes** low-bit weights (`int4`) into floating-point (`float16`) values before passing them to the convolution (`Conv_2D`) operator. This ensures optimal performance for heavy computations, as the floating-point operations run more efficiently on modern processors.\n\nIn contrast, the **decode phase** is memory-intensive. Here, instead of dequantizing weights ahead of time, the model uses **fused Conv\\_2D with dequantization**, keeping weights in their compact form (`int4`) until they are needed. This reduces memory bandwidth usage by avoiding unnecessary data expansion during transfer, which is critical when decoding tokens one at a time.\n\nThis design highlights a core principle in system optimization: different stages of computation may require tailored approaches based on their unique constraints—compute-bound stages benefit from early dequantization, while memory-bound stages gain from deferred dequantization.\n\n**Key takeaways**:\n\n*   Performance optimization isn’t one-size-fits-all. You have to understand where the bottleneck is (compute vs memory) and tailor your strategy to the bottleneck:\n    \n    *   _Dequantize early when compute-bound (prefill phase)._\n    *   _Dequantize late when memory-bound (decode phase)._\n*   This phase-aware optimization is foundational for achieving efficient LLM inference on-device and under constrained compute/memory budgets.\n    \n\nPerformance optimization isn’t one-size-fits-all. You have to understand where the bottleneck is (compute vs memory) and tailor your strategy to the bottleneck:\n\n*   _Dequantize early when compute-bound (prefill phase)._\n*   _Dequantize late when memory-bound (decode phase)._\n\nThis phase-aware optimization is foundational for achieving efficient LLM inference on-device and under constrained compute/memory budgets.",
    "contentLength": 13431,
    "wordCount": 1197,
    "hasCode": true,
    "hasMath": false,
    "hasImages": true,
    "url": "https://aman.ai/primers/ai/on-device-transformers/#balancing-compute-and-memory:-prefill-vs.-decode-optimization"
  },
  {
    "id": "ai-on-device-transformers-key-value-kv-cache-optimization-9",
    "articleSlug": "on-device-transformers",
    "articleTitle": "On-device Transformers",
    "category": "On-Device AI",
    "chapter": "Optimization Techniques for On-Device Transformers",
    "title": "Key-Value (KV) Cache Optimization",
    "order": 9,
    "orderInChapter": 2,
    "contentHtml": "<ul>\n  <li>\n    <p>In decoder-based models (e.g., GPT), each new token requires computing self-attention with all past tokens. Without optimization, this scales as:</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-22-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><msup><mi>n</mi><mn>2</mn></msup><mo>&amp;#x22C5;</mo><mi>d</mi><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-226\" style=\"width: 4.638em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 3.857em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.201em, 1003.8em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-227\"><span class=\"mi\" id=\"MathJax-Span-228\" style=\"font-family: STIXGeneral-Italic;\">O</span><span class=\"mo\" id=\"MathJax-Span-229\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"msubsup\" id=\"MathJax-Span-230\"><span style=\"display: inline-block; position: relative; width: 0.94em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-231\" style=\"font-family: STIXGeneral-Italic;\">n</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.424em; left: 0.523em;\"><span class=\"mn\" id=\"MathJax-Span-232\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-233\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"mi\" id=\"MathJax-Span-234\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.263em;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-235\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.441em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mi>O</mi><mo stretchy=\"false\">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo>⋅</mo><mi>d</mi><mo stretchy=\"false\">)</mo></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-22\">O(n^2 \\cdot d)</script>\n\n    <ul>\n      <li>where <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-23-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>n</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-236\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-237\"><span class=\"mi\" id=\"MathJax-Span-238\" style=\"font-family: STIXGeneral-Italic;\">n</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>n</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-23\">n</script> is the number of generated tokens and <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-24-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>d</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-239\" style=\"width: 0.732em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.576em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.58em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-240\"><span class=\"mi\" id=\"MathJax-Span-241\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>d</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-24\">d</script> is the hidden dimension.</li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>KV cache principle:</strong></p>\n\n    <ul>\n      <li>Store the key (K) and value (V) projections for all past tokens during generation.</li>\n      <li>\n        <p>For a new token, compute only its query (Q) and perform:</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-25-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>Attention</mtext><mo stretchy=&quot;false&quot;>(</mo><msub><mi>Q</mi><mi>t</mi></msub><mo>,</mo><msub><mi>K</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>1</mn><mo>:</mo><mi>t</mi></mrow></msub><mo>,</mo><msub><mi>V</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>1</mn><mo>:</mo><mi>t</mi></mrow></msub><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-242\" style=\"width: 11.201em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 9.326em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1009.27em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-243\"><span class=\"mtext\" id=\"MathJax-Span-244\" style=\"font-family: STIXGeneral-Regular;\">Attention</span><span class=\"mo\" id=\"MathJax-Span-245\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"msubsup\" id=\"MathJax-Span-246\"><span style=\"display: inline-block; position: relative; width: 0.992em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.68em, 4.326em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-247\" style=\"font-family: STIXGeneral-Italic;\">Q</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.732em;\"><span class=\"mi\" id=\"MathJax-Span-248\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">t<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-249\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-250\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 1.513em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.73em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-251\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.68em;\"><span class=\"texatom\" id=\"MathJax-Span-252\"><span class=\"mrow\" id=\"MathJax-Span-253\"><span class=\"mn\" id=\"MathJax-Span-254\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span><span class=\"mo\" id=\"MathJax-Span-255\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">:</span><span class=\"mi\" id=\"MathJax-Span-256\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">t<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-257\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-258\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 1.461em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.68em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-259\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.628em;\"><span class=\"texatom\" id=\"MathJax-Span-260\"><span class=\"mrow\" id=\"MathJax-Span-261\"><span class=\"mn\" id=\"MathJax-Span-262\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span><span class=\"mo\" id=\"MathJax-Span-263\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">:</span><span class=\"mi\" id=\"MathJax-Span-264\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">t<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-265\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>Attention</mtext><mo stretchy=\"false\">(</mo><msub><mi>Q</mi><mi>t</mi></msub><mo>,</mo><msub><mi>K</mi><mrow class=\"MJX-TeXAtom-ORD\"><mn>1</mn><mo>:</mo><mi>t</mi></mrow></msub><mo>,</mo><msub><mi>V</mi><mrow class=\"MJX-TeXAtom-ORD\"><mn>1</mn><mo>:</mo><mi>t</mi></mrow></msub><mo stretchy=\"false\">)</mo></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-25\">\\text{Attention}(Q_t, K_{1:t}, V_{1:t})</script>\n      </li>\n      <li>\n        <p>This reduces complexity per step to:</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-26-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><mi>n</mi><mo>&amp;#x22C5;</mo><mi>d</mi><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-266\" style=\"width: 4.169em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 3.44em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1003.39em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-267\"><span class=\"mi\" id=\"MathJax-Span-268\" style=\"font-family: STIXGeneral-Italic;\">O</span><span class=\"mo\" id=\"MathJax-Span-269\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-270\" style=\"font-family: STIXGeneral-Italic;\">n</span><span class=\"mo\" id=\"MathJax-Span-271\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"mi\" id=\"MathJax-Span-272\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.263em;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-273\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo>⋅</mo><mi>d</mi><mo stretchy=\"false\">)</mo></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-26\">O(n \\cdot d)</script>\n      </li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Hardware impact:</strong></p>\n\n    <ul>\n      <li>Reduces compute but increases <strong>memory bandwidth</strong> requirements since past K/V matrices must be accessed repeatedly.</li>\n      <li>Critical for CPU-based decoding; also essential on NPUs with limited memory.</li>\n    </ul>\n  </li>\n  <li>\n    <p>A detailed discourse on this topic is available in our <a href=\"../model-acceleration\">Model Acceleration</a> primer.</p>\n  </li>\n</ul>\n<p>In decoder-based models (e.g., GPT), each new token requires computing self-attention with all past tokens. Without optimization, this scales as:</p>\n<ul>\n      <li>where <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-23-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>n</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-236\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-237\"><span class=\"mi\" id=\"MathJax-Span-238\" style=\"font-family: STIXGeneral-Italic;\">n</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>n</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-23\">n</script> is the number of generated tokens and <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-24-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>d</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-239\" style=\"width: 0.732em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.576em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.58em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-240\"><span class=\"mi\" id=\"MathJax-Span-241\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>d</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-24\">d</script> is the hidden dimension.</li>\n    </ul>\n<p><strong>KV cache principle:</strong></p>\n<ul>\n      <li>Store the key (K) and value (V) projections for all past tokens during generation.</li>\n      <li>\n        <p>For a new token, compute only its query (Q) and perform:</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-25-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>Attention</mtext><mo stretchy=&quot;false&quot;>(</mo><msub><mi>Q</mi><mi>t</mi></msub><mo>,</mo><msub><mi>K</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>1</mn><mo>:</mo><mi>t</mi></mrow></msub><mo>,</mo><msub><mi>V</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>1</mn><mo>:</mo><mi>t</mi></mrow></msub><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-242\" style=\"width: 11.201em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 9.326em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1009.27em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-243\"><span class=\"mtext\" id=\"MathJax-Span-244\" style=\"font-family: STIXGeneral-Regular;\">Attention</span><span class=\"mo\" id=\"MathJax-Span-245\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"msubsup\" id=\"MathJax-Span-246\"><span style=\"display: inline-block; position: relative; width: 0.992em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.68em, 4.326em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-247\" style=\"font-family: STIXGeneral-Italic;\">Q</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.732em;\"><span class=\"mi\" id=\"MathJax-Span-248\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">t<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-249\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-250\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 1.513em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.73em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-251\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.68em;\"><span class=\"texatom\" id=\"MathJax-Span-252\"><span class=\"mrow\" id=\"MathJax-Span-253\"><span class=\"mn\" id=\"MathJax-Span-254\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span><span class=\"mo\" id=\"MathJax-Span-255\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">:</span><span class=\"mi\" id=\"MathJax-Span-256\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">t<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-257\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-258\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 1.461em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.68em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-259\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.628em;\"><span class=\"texatom\" id=\"MathJax-Span-260\"><span class=\"mrow\" id=\"MathJax-Span-261\"><span class=\"mn\" id=\"MathJax-Span-262\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">1</span><span class=\"mo\" id=\"MathJax-Span-263\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">:</span><span class=\"mi\" id=\"MathJax-Span-264\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">t<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-265\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>Attention</mtext><mo stretchy=\"false\">(</mo><msub><mi>Q</mi><mi>t</mi></msub><mo>,</mo><msub><mi>K</mi><mrow class=\"MJX-TeXAtom-ORD\"><mn>1</mn><mo>:</mo><mi>t</mi></mrow></msub><mo>,</mo><msub><mi>V</mi><mrow class=\"MJX-TeXAtom-ORD\"><mn>1</mn><mo>:</mo><mi>t</mi></mrow></msub><mo stretchy=\"false\">)</mo></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-25\">\\text{Attention}(Q_t, K_{1:t}, V_{1:t})</script>\n      </li>\n      <li>\n        <p>This reduces complexity per step to:</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-26-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><mi>n</mi><mo>&amp;#x22C5;</mo><mi>d</mi><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-266\" style=\"width: 4.169em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 3.44em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1003.39em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-267\"><span class=\"mi\" id=\"MathJax-Span-268\" style=\"font-family: STIXGeneral-Italic;\">O</span><span class=\"mo\" id=\"MathJax-Span-269\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-270\" style=\"font-family: STIXGeneral-Italic;\">n</span><span class=\"mo\" id=\"MathJax-Span-271\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"mi\" id=\"MathJax-Span-272\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.263em;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-273\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo>⋅</mo><mi>d</mi><mo stretchy=\"false\">)</mo></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-26\">O(n \\cdot d)</script>\n      </li>\n    </ul>\n<p>For a new token, compute only its query (Q) and perform:</p>\n<p>This reduces complexity per step to:</p>\n<p><strong>Hardware impact:</strong></p>\n<ul>\n      <li>Reduces compute but increases <strong>memory bandwidth</strong> requirements since past K/V matrices must be accessed repeatedly.</li>\n      <li>Critical for CPU-based decoding; also essential on NPUs with limited memory.</li>\n    </ul>\n<p>A detailed discourse on this topic is available in our <a href=\"../model-acceleration\">Model Acceleration</a> primer.</p>",
    "contentMarkdown": "*   In decoder-based models (e.g., GPT), each new token requires computing self-attention with all past tokens. Without optimization, this scales as:\n    \n    O(n2⋅d)O(n2⋅d)\n    \n    O(n^2 \\\\cdot d)\n    *   where nnn is the number of generated tokens and ddd is the hidden dimension.\n*   **KV cache principle:**\n    \n    *   Store the key (K) and value (V) projections for all past tokens during generation.\n    *   For a new token, compute only its query (Q) and perform:\n        \n        Attention(Qt,K1:t,V1:t)Attention(Qt,K1:t,V1:t)\n        \n        \\\\text{Attention}(Q\\_t, K\\_{1:t}, V\\_{1:t})\n    *   This reduces complexity per step to:\n        \n        O(n⋅d)O(n⋅d)\n        \n        O(n \\\\cdot d)\n*   **Hardware impact:**\n    \n    *   Reduces compute but increases **memory bandwidth** requirements since past K/V matrices must be accessed repeatedly.\n    *   Critical for CPU-based decoding; also essential on NPUs with limited memory.\n*   A detailed discourse on this topic is available in our [Model Acceleration](../model-acceleration) primer.\n    \n\nIn decoder-based models (e.g., GPT), each new token requires computing self-attention with all past tokens. Without optimization, this scales as:\n\n*   where nnn is the number of generated tokens and ddd is the hidden dimension.\n\n**KV cache principle:**\n\n*   Store the key (K) and value (V) projections for all past tokens during generation.\n*   For a new token, compute only its query (Q) and perform:\n    \n    Attention(Qt,K1:t,V1:t)Attention(Qt,K1:t,V1:t)\n    \n    \\\\text{Attention}(Q\\_t, K\\_{1:t}, V\\_{1:t})\n*   This reduces complexity per step to:\n    \n    O(n⋅d)O(n⋅d)\n    \n    O(n \\\\cdot d)\n\nFor a new token, compute only its query (Q) and perform:\n\nThis reduces complexity per step to:\n\n**Hardware impact:**\n\n*   Reduces compute but increases **memory bandwidth** requirements since past K/V matrices must be accessed repeatedly.\n*   Critical for CPU-based decoding; also essential on NPUs with limited memory.\n\nA detailed discourse on this topic is available in our [Model Acceleration](../model-acceleration) primer.",
    "contentLength": 25270,
    "wordCount": 271,
    "hasCode": false,
    "hasMath": true,
    "hasImages": false,
    "url": "https://aman.ai/primers/ai/on-device-transformers/#key-value-(kv)-cache-optimization"
  },
  {
    "id": "ai-on-device-transformers-speculative-decoding-10",
    "articleSlug": "on-device-transformers",
    "articleTitle": "On-device Transformers",
    "category": "On-Device AI",
    "chapter": "Optimization Techniques for On-Device Transformers",
    "title": "Speculative Decoding",
    "order": 10,
    "orderInChapter": 3,
    "contentHtml": "<ul>\n  <li>\n    <p>Speculative decoding improves throughput by parallelizing token generation while maintaining correctness.</p>\n  </li>\n  <li>\n    <p><strong>Workflow:</strong></p>\n\n    <ol>\n      <li>Use a small <strong>draft model</strong> to propose multiple tokens ahead.</li>\n      <li>A larger <strong>target model</strong> validates or rejects the proposed tokens in parallel.</li>\n      <li>Accepted tokens are appended to the sequence; rejected tokens trigger fallback to standard autoregressive decoding.</li>\n    </ol>\n  </li>\n  <li>\n    <p><strong>Benefit:</strong></p>\n\n    <ul>\n      <li>Reduces total number of sequential steps for the large model.</li>\n      <li>Best suited for GPU or NPU where batched verification of tokens can be parallelized.</li>\n    </ul>\n  </li>\n  <li>\n    <p>A detailed discourse on this topic is available in our <a href=\"../speculative-decoding\">Speculative Decoding</a> primer.</p>\n  </li>\n</ul>\n<p>Speculative decoding improves throughput by parallelizing token generation while maintaining correctness.</p>\n<p><strong>Workflow:</strong></p>\n<ol>\n      <li>Use a small <strong>draft model</strong> to propose multiple tokens ahead.</li>\n      <li>A larger <strong>target model</strong> validates or rejects the proposed tokens in parallel.</li>\n      <li>Accepted tokens are appended to the sequence; rejected tokens trigger fallback to standard autoregressive decoding.</li>\n    </ol>\n<p><strong>Benefit:</strong></p>\n<ul>\n      <li>Reduces total number of sequential steps for the large model.</li>\n      <li>Best suited for GPU or NPU where batched verification of tokens can be parallelized.</li>\n    </ul>\n<p>A detailed discourse on this topic is available in our <a href=\"../speculative-decoding\">Speculative Decoding</a> primer.</p>",
    "contentMarkdown": "*   Speculative decoding improves throughput by parallelizing token generation while maintaining correctness.\n    \n*   **Workflow:**\n    \n    1.  Use a small **draft model** to propose multiple tokens ahead.\n    2.  A larger **target model** validates or rejects the proposed tokens in parallel.\n    3.  Accepted tokens are appended to the sequence; rejected tokens trigger fallback to standard autoregressive decoding.\n*   **Benefit:**\n    \n    *   Reduces total number of sequential steps for the large model.\n    *   Best suited for GPU or NPU where batched verification of tokens can be parallelized.\n*   A detailed discourse on this topic is available in our [Speculative Decoding](../speculative-decoding) primer.\n    \n\nSpeculative decoding improves throughput by parallelizing token generation while maintaining correctness.\n\n**Workflow:**\n\n1.  Use a small **draft model** to propose multiple tokens ahead.\n2.  A larger **target model** validates or rejects the proposed tokens in parallel.\n3.  Accepted tokens are appended to the sequence; rejected tokens trigger fallback to standard autoregressive decoding.\n\n**Benefit:**\n\n*   Reduces total number of sequential steps for the large model.\n*   Best suited for GPU or NPU where batched verification of tokens can be parallelized.\n\nA detailed discourse on this topic is available in our [Speculative Decoding](../speculative-decoding) primer.",
    "contentLength": 1786,
    "wordCount": 188,
    "hasCode": false,
    "hasMath": false,
    "hasImages": false,
    "url": "https://aman.ai/primers/ai/on-device-transformers/#speculative-decoding"
  },
  {
    "id": "ai-on-device-transformers-quantization-48-bit-11",
    "articleSlug": "on-device-transformers",
    "articleTitle": "On-device Transformers",
    "category": "On-Device AI",
    "chapter": "Optimization Techniques for On-Device Transformers",
    "title": "Quantization (4/8-bit)",
    "order": 11,
    "orderInChapter": 4,
    "contentHtml": "<ul>\n  <li>\n    <p>Quantization reduces model weights and activations from <code class=\"language-plaintext highlighter-rouge\">float32</code> or <code class=\"language-plaintext highlighter-rouge\">float16</code> to lower precision (e.g., <code class=\"language-plaintext highlighter-rouge\">int8</code> or <code class=\"language-plaintext highlighter-rouge\">int4</code>).</p>\n\n    <ul>\n      <li><strong>Static Quantization</strong>: Precompute scale factors during calibration on a representative dataset.</li>\n      <li><strong>Dynamic Quantization</strong>: Scales are computed on-the-fly during inference, less accurate but easier to apply.</li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Equation:</strong></p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-27-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><msub><mi>x</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>q</mi><mi>u</mi><mi>a</mi><mi>n</mi><mi>t</mi></mrow></msub><mo>=</mo><mtext>round</mtext><mrow><mo>(</mo><mfrac><mi>x</mi><mi>s</mi></mfrac><mo>)</mo></mrow></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-274\" style=\"width: 9.482em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 7.867em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(2.138em, 1007.76em, 4.326em, -999.997em); top: -3.487em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-275\"><span class=\"msubsup\" id=\"MathJax-Span-276\"><span style=\"display: inline-block; position: relative; width: 2.138em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-277\" style=\"font-family: STIXGeneral-Italic;\">x<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.471em;\"><span class=\"texatom\" id=\"MathJax-Span-278\"><span class=\"mrow\" id=\"MathJax-Span-279\"><span class=\"mi\" id=\"MathJax-Span-280\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">q</span><span class=\"mi\" id=\"MathJax-Span-281\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">u</span><span class=\"mi\" id=\"MathJax-Span-282\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">a</span><span class=\"mi\" id=\"MathJax-Span-283\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">n</span><span class=\"mi\" id=\"MathJax-Span-284\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">t<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-285\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mtext\" id=\"MathJax-Span-286\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">round</span><span class=\"mrow\" id=\"MathJax-Span-287\" style=\"padding-left: 0.211em;\"><span class=\"mo\" id=\"MathJax-Span-288\" style=\"vertical-align: -0.414em;\"><span style=\"font-family: STIXSizeTwoSym;\">(</span></span><span class=\"mfrac\" id=\"MathJax-Span-289\"><span style=\"display: inline-block; position: relative; width: 0.576em; height: 0px; margin-right: 0.107em; margin-left: 0.107em;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.685em; left: 50%; margin-left: -0.206em;\"><span class=\"mi\" id=\"MathJax-Span-290\" style=\"font-family: STIXGeneral-Italic;\">x<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.44em, 1000.37em, 4.169em, -999.997em); top: -3.331em; left: 50%; margin-left: -0.206em;\"><span class=\"mi\" id=\"MathJax-Span-291\" style=\"font-family: STIXGeneral-Italic;\">s</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(0.836em, 1000.58em, 1.201em, -999.997em); top: -1.247em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.576em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.044em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-292\" style=\"vertical-align: -0.414em;\"><span style=\"font-family: STIXSizeTwoSym;\">)</span></span></span></span><span style=\"display: inline-block; width: 0px; height: 3.492em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.872em; border-left: 0px solid; width: 0px; height: 2.378em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><msub><mi>x</mi><mrow class=\"MJX-TeXAtom-ORD\"><mi>q</mi><mi>u</mi><mi>a</mi><mi>n</mi><mi>t</mi></mrow></msub><mo>=</mo><mtext>round</mtext><mrow><mo>(</mo><mfrac><mi>x</mi><mi>s</mi></mfrac><mo>)</mo></mrow></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-27\">x_{quant} = \\text{round}\\left(\\frac{x}{s}\\right)</script>\n\n    <ul>\n      <li>where <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-28-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>s</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-293\" style=\"width: 0.471em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.367em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.37em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-294\"><span class=\"mi\" id=\"MathJax-Span-295\" style=\"font-family: STIXGeneral-Italic;\">s</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>s</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-28\">s</script> is the scaling factor.</li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Benefits:</strong></p>\n\n    <ul>\n      <li>Reduces memory footprint by 4–8x.</li>\n      <li>Increases throughput on CPUs (via AVX512/AMX) and NPUs (native <code class=\"language-plaintext highlighter-rouge\">int8</code> support).</li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Trade-offs:</strong></p>\n\n    <ul>\n      <li>May reduce accuracy, especially for attention layers and small models.</li>\n      <li>Requires per-channel quantization for best results.</li>\n    </ul>\n  </li>\n  <li>\n    <p>A detailed discourse on this topic is available in our <a href=\"../model-compression\">Model Compression</a> primer.</p>\n  </li>\n</ul>\n<p>Quantization reduces model weights and activations from <code class=\"language-plaintext highlighter-rouge\">float32</code> or <code class=\"language-plaintext highlighter-rouge\">float16</code> to lower precision (e.g., <code class=\"language-plaintext highlighter-rouge\">int8</code> or <code class=\"language-plaintext highlighter-rouge\">int4</code>).</p>\n<ul>\n      <li><strong>Static Quantization</strong>: Precompute scale factors during calibration on a representative dataset.</li>\n      <li><strong>Dynamic Quantization</strong>: Scales are computed on-the-fly during inference, less accurate but easier to apply.</li>\n    </ul>\n<p><strong>Equation:</strong></p>\n<ul>\n      <li>where <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-28-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>s</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-293\" style=\"width: 0.471em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.367em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.37em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-294\"><span class=\"mi\" id=\"MathJax-Span-295\" style=\"font-family: STIXGeneral-Italic;\">s</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>s</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-28\">s</script> is the scaling factor.</li>\n    </ul>\n<p><strong>Benefits:</strong></p>\n<ul>\n      <li>Reduces memory footprint by 4–8x.</li>\n      <li>Increases throughput on CPUs (via AVX512/AMX) and NPUs (native <code class=\"language-plaintext highlighter-rouge\">int8</code> support).</li>\n    </ul>\n<p><strong>Trade-offs:</strong></p>\n<ul>\n      <li>May reduce accuracy, especially for attention layers and small models.</li>\n      <li>Requires per-channel quantization for best results.</li>\n    </ul>\n<p>A detailed discourse on this topic is available in our <a href=\"../model-compression\">Model Compression</a> primer.</p>",
    "contentMarkdown": "*   Quantization reduces model weights and activations from `float32` or `float16` to lower precision (e.g., `int8` or `int4`).\n    \n    *   **Static Quantization**: Precompute scale factors during calibration on a representative dataset.\n    *   **Dynamic Quantization**: Scales are computed on-the-fly during inference, less accurate but easier to apply.\n*   **Equation:**\n    \n    xquant\\=round(xs)xquant\\=round(xs)\n    \n    x\\_{quant} = \\\\text{round}\\\\left(\\\\frac{x}{s}\\\\right)\n    *   where sss is the scaling factor.\n*   **Benefits:**\n    \n    *   Reduces memory footprint by 4–8x.\n    *   Increases throughput on CPUs (via AVX512/AMX) and NPUs (native `int8` support).\n*   **Trade-offs:**\n    \n    *   May reduce accuracy, especially for attention layers and small models.\n    *   Requires per-channel quantization for best results.\n*   A detailed discourse on this topic is available in our [Model Compression](../model-compression) primer.\n    \n\nQuantization reduces model weights and activations from `float32` or `float16` to lower precision (e.g., `int8` or `int4`).\n\n*   **Static Quantization**: Precompute scale factors during calibration on a representative dataset.\n*   **Dynamic Quantization**: Scales are computed on-the-fly during inference, less accurate but easier to apply.\n\n**Equation:**\n\n*   where sss is the scaling factor.\n\n**Benefits:**\n\n*   Reduces memory footprint by 4–8x.\n*   Increases throughput on CPUs (via AVX512/AMX) and NPUs (native `int8` support).\n\n**Trade-offs:**\n\n*   May reduce accuracy, especially for attention layers and small models.\n*   Requires per-channel quantization for best results.\n\nA detailed discourse on this topic is available in our [Model Compression](../model-compression) primer.",
    "contentLength": 9969,
    "wordCount": 215,
    "hasCode": true,
    "hasMath": true,
    "hasImages": false,
    "url": "https://aman.ai/primers/ai/on-device-transformers/#quantization-(4/8-bit)"
  },
  {
    "id": "ai-on-device-transformers-knowledge-distillation-12",
    "articleSlug": "on-device-transformers",
    "articleTitle": "On-device Transformers",
    "category": "On-Device AI",
    "chapter": "Optimization Techniques for On-Device Transformers",
    "title": "Knowledge Distillation",
    "order": 12,
    "orderInChapter": 5,
    "contentHtml": "<ul>\n  <li>\n    <p>Use a large, accurate <strong>teacher model</strong> to train a smaller <strong>student model</strong>:</p>\n  </li>\n  <li>\n    <p>Objective function includes both hard labels and soft probabilities:</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-29-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>L</mi><mo>=</mo><mi>&amp;#x03B1;</mi><msub><mi>L</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>CE</mtext></mrow></msub><mo>+</mo><mo stretchy=&quot;false&quot;>(</mo><mn>1</mn><mo>&amp;#x2212;</mo><mi>&amp;#x03B1;</mi><mo stretchy=&quot;false&quot;>)</mo><mspace width=&quot;thinmathspace&quot; /><mtext>KL</mtext><mo stretchy=&quot;false&quot;>(</mo><msub><mi>p</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>teacher</mtext></mrow></msub><mo fence=&quot;false&quot; stretchy=&quot;false&quot;>&amp;#x2016;</mo><msub><mi>p</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>student</mtext></mrow></msub><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-296\" style=\"width: 18.701em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 15.576em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1015.52em, 2.555em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-297\"><span class=\"mi\" id=\"MathJax-Span-298\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-299\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mi\" id=\"MathJax-Span-300\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">α</span><span class=\"msubsup\" id=\"MathJax-Span-301\"><span style=\"display: inline-block; position: relative; width: 1.513em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.58em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-302\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.576em;\"><span class=\"texatom\" id=\"MathJax-Span-303\"><span class=\"mrow\" id=\"MathJax-Span-304\"><span class=\"mtext\" id=\"MathJax-Span-305\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">CE</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-306\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mo\" id=\"MathJax-Span-307\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">(</span><span class=\"mn\" id=\"MathJax-Span-308\" style=\"font-family: STIXGeneral-Regular;\">1</span><span class=\"mo\" id=\"MathJax-Span-309\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">−</span><span class=\"mi\" id=\"MathJax-Span-310\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.263em;\">α</span><span class=\"mo\" id=\"MathJax-Span-311\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mspace\" id=\"MathJax-Span-312\" style=\"height: 0em; vertical-align: 0em; width: 0.211em; display: inline-block; overflow: hidden;\"></span><span class=\"mtext\" id=\"MathJax-Span-313\" style=\"font-family: STIXGeneral-Regular;\">KL</span><span class=\"mo\" id=\"MathJax-Span-314\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"msubsup\" id=\"MathJax-Span-315\"><span style=\"display: inline-block; position: relative; width: 2.607em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.378em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-316\" style=\"font-family: STIXGeneral-Italic;\">p</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-317\"><span class=\"mrow\" id=\"MathJax-Span-318\"><span class=\"mtext\" id=\"MathJax-Span-319\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">teacher</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-320\" style=\"font-family: STIXGeneral-Regular;\">‖</span><span class=\"msubsup\" id=\"MathJax-Span-321\"><span style=\"display: inline-block; position: relative; width: 2.607em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.378em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-322\" style=\"font-family: STIXGeneral-Italic;\">p</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-323\"><span class=\"mrow\" id=\"MathJax-Span-324\"><span class=\"mtext\" id=\"MathJax-Span-325\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">student</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-326\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mi>L</mi><mo>=</mo><mi>α</mi><msub><mi>L</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>CE</mtext></mrow></msub><mo>+</mo><mo stretchy=\"false\">(</mo><mn>1</mn><mo>−</mo><mi>α</mi><mo stretchy=\"false\">)</mo><mspace width=\"thinmathspace\"></mspace><mtext>KL</mtext><mo stretchy=\"false\">(</mo><msub><mi>p</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>teacher</mtext></mrow></msub><mo fence=\"false\" stretchy=\"false\">‖</mo><msub><mi>p</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>student</mtext></mrow></msub><mo stretchy=\"false\">)</mo></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-29\">L = \\alpha L_{\\text{CE}} + (1 - \\alpha) \\, \\text{KL}(p_{\\text{teacher}} \\| p_{\\text{student}})</script>\n  </li>\n  <li>\n    <p><strong>Benefit:</strong></p>\n\n    <ul>\n      <li>Student model retains much of the teacher’s performance with fewer parameters.</li>\n      <li>Ideal for NPUs and CPU edge deployments.</li>\n    </ul>\n  </li>\n  <li>\n    <p>A detailed discourse on this topic is available in our <a href=\"../model-compression\">Model Compression</a> primer.</p>\n  </li>\n</ul>\n<p>Use a large, accurate <strong>teacher model</strong> to train a smaller <strong>student model</strong>:</p>\n<p>Objective function includes both hard labels and soft probabilities:</p>\n<p><strong>Benefit:</strong></p>\n<ul>\n      <li>Student model retains much of the teacher’s performance with fewer parameters.</li>\n      <li>Ideal for NPUs and CPU edge deployments.</li>\n    </ul>\n<p>A detailed discourse on this topic is available in our <a href=\"../model-compression\">Model Compression</a> primer.</p>",
    "contentMarkdown": "*   Use a large, accurate **teacher model** to train a smaller **student model**:\n    \n*   Objective function includes both hard labels and soft probabilities:\n    \n    L\\=αLCE+(1−α)KL(pteacher‖pstudent)L\\=αLCE+(1−α)KL(pteacher‖pstudent)\n    \n    L = \\\\alpha L\\_{\\\\text{CE}} + (1 - \\\\alpha) \\\\, \\\\text{KL}(p\\_{\\\\text{teacher}} \\\\| p\\_{\\\\text{student}})\n*   **Benefit:**\n    \n    *   Student model retains much of the teacher’s performance with fewer parameters.\n    *   Ideal for NPUs and CPU edge deployments.\n*   A detailed discourse on this topic is available in our [Model Compression](../model-compression) primer.\n    \n\nUse a large, accurate **teacher model** to train a smaller **student model**:\n\nObjective function includes both hard labels and soft probabilities:\n\n**Benefit:**\n\n*   Student model retains much of the teacher’s performance with fewer parameters.\n*   Ideal for NPUs and CPU edge deployments.\n\nA detailed discourse on this topic is available in our [Model Compression](../model-compression) primer.",
    "contentLength": 7581,
    "wordCount": 127,
    "hasCode": false,
    "hasMath": true,
    "hasImages": false,
    "url": "https://aman.ai/primers/ai/on-device-transformers/#knowledge-distillation"
  },
  {
    "id": "ai-on-device-transformers-weight-pruning-and-low-rank-approximations-13",
    "articleSlug": "on-device-transformers",
    "articleTitle": "On-device Transformers",
    "category": "On-Device AI",
    "chapter": "Optimization Techniques for On-Device Transformers",
    "title": "Weight Pruning and Low-Rank Approximations",
    "order": 13,
    "orderInChapter": 6,
    "contentHtml": "<ul>\n  <li><strong>Pruning</strong> removes less important weights (e.g., structured pruning of entire attention heads).</li>\n  <li>\n    <p><strong>Low-rank factorization</strong> decomposes weight matrices:</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-30-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>W</mi><mo>&amp;#x2208;</mo><msup><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi mathvariant=&quot;double-struck&quot;>R</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>d</mi><mo>&amp;#x00D7;</mo><mi>d</mi></mrow></msup><mo>&amp;#x2248;</mo><mi>U</mi><msup><mi>V</mi><mi>T</mi></msup></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-327\" style=\"width: 9.013em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 7.503em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.201em, 1007.5em, 2.451em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-328\"><span class=\"mi\" id=\"MathJax-Span-329\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-330\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">∈</span><span class=\"msubsup\" id=\"MathJax-Span-331\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 2.034em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.73em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"texatom\" id=\"MathJax-Span-332\"><span class=\"mrow\" id=\"MathJax-Span-333\"><span class=\"mi\" id=\"MathJax-Span-334\" style=\"font-family: STIXGeneral-Regular;\">ℝ</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.424em; left: 0.732em;\"><span class=\"texatom\" id=\"MathJax-Span-335\"><span class=\"mrow\" id=\"MathJax-Span-336\"><span class=\"mi\" id=\"MathJax-Span-337\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-338\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">×</span><span class=\"mi\" id=\"MathJax-Span-339\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-340\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">≈</span><span class=\"mi\" id=\"MathJax-Span-341\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">U<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"msubsup\" id=\"MathJax-Span-342\"><span style=\"display: inline-block; position: relative; width: 1.305em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.68em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-343\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.424em; left: 0.784em;\"><span class=\"mi\" id=\"MathJax-Span-344\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">T<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.122em; border-left: 0px solid; width: 0px; height: 1.253em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mi>W</mi><mo>∈</mo><msup><mrow class=\"MJX-TeXAtom-ORD\"><mi mathvariant=\"double-struck\">R</mi></mrow><mrow class=\"MJX-TeXAtom-ORD\"><mi>d</mi><mo>×</mo><mi>d</mi></mrow></msup><mo>≈</mo><mi>U</mi><msup><mi>V</mi><mi>T</mi></msup></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-30\">W \\in \\mathbb{R}^{d \\times d} \\approx U V^T</script>\n\n    <ul>\n      <li>with <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-31-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>U</mi><mo>,</mo><mi>V</mi><mo>&amp;#x2208;</mo><msup><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi mathvariant=&quot;double-struck&quot;>R</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>d</mi><mo>&amp;#x00D7;</mo><mi>r</mi></mrow></msup><mo>,</mo><mi>r</mi><mo>&amp;#x226A;</mo><mi>d</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-345\" style=\"width: 9.482em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 7.867em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.201em, 1007.87em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-346\"><span class=\"mi\" id=\"MathJax-Span-347\" style=\"font-family: STIXGeneral-Italic;\">U<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-348\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mi\" id=\"MathJax-Span-349\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.211em;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-350\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">∈</span><span class=\"msubsup\" id=\"MathJax-Span-351\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 1.93em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.73em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"texatom\" id=\"MathJax-Span-352\"><span class=\"mrow\" id=\"MathJax-Span-353\"><span class=\"mi\" id=\"MathJax-Span-354\" style=\"font-family: STIXGeneral-Regular;\">ℝ</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.372em; left: 0.732em;\"><span class=\"texatom\" id=\"MathJax-Span-355\"><span class=\"mrow\" id=\"MathJax-Span-356\"><span class=\"mi\" id=\"MathJax-Span-357\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-358\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">×</span><span class=\"mi\" id=\"MathJax-Span-359\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">r<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-360\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mi\" id=\"MathJax-Span-361\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.211em;\">r<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-362\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">≪</span><span class=\"mi\" id=\"MathJax-Span-363\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.316em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>U</mi><mo>,</mo><mi>V</mi><mo>∈</mo><msup><mrow class=\"MJX-TeXAtom-ORD\"><mi mathvariant=\"double-struck\">R</mi></mrow><mrow class=\"MJX-TeXAtom-ORD\"><mi>d</mi><mo>×</mo><mi>r</mi></mrow></msup><mo>,</mo><mi>r</mi><mo>≪</mo><mi>d</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-31\">U, V \\in \\mathbb{R}^{d \\times r}, r \\ll d</script>.</li>\n    </ul>\n  </li>\n  <li>\n    <p>These reduce both memory and FLOPs.</p>\n  </li>\n  <li>A detailed discourse on this topic is available in our <a href=\"../model-compression\">Model Compression</a> primer.</li>\n</ul>\n<p><strong>Low-rank factorization</strong> decomposes weight matrices:</p>\n<ul>\n      <li>with <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-31-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>U</mi><mo>,</mo><mi>V</mi><mo>&amp;#x2208;</mo><msup><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi mathvariant=&quot;double-struck&quot;>R</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>d</mi><mo>&amp;#x00D7;</mo><mi>r</mi></mrow></msup><mo>,</mo><mi>r</mi><mo>&amp;#x226A;</mo><mi>d</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-345\" style=\"width: 9.482em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 7.867em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.201em, 1007.87em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-346\"><span class=\"mi\" id=\"MathJax-Span-347\" style=\"font-family: STIXGeneral-Italic;\">U<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-348\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mi\" id=\"MathJax-Span-349\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.211em;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-350\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">∈</span><span class=\"msubsup\" id=\"MathJax-Span-351\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 1.93em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.73em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"texatom\" id=\"MathJax-Span-352\"><span class=\"mrow\" id=\"MathJax-Span-353\"><span class=\"mi\" id=\"MathJax-Span-354\" style=\"font-family: STIXGeneral-Regular;\">ℝ</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.372em; left: 0.732em;\"><span class=\"texatom\" id=\"MathJax-Span-355\"><span class=\"mrow\" id=\"MathJax-Span-356\"><span class=\"mi\" id=\"MathJax-Span-357\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-358\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">×</span><span class=\"mi\" id=\"MathJax-Span-359\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">r<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-360\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mi\" id=\"MathJax-Span-361\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.211em;\">r<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-362\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">≪</span><span class=\"mi\" id=\"MathJax-Span-363\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.316em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>U</mi><mo>,</mo><mi>V</mi><mo>∈</mo><msup><mrow class=\"MJX-TeXAtom-ORD\"><mi mathvariant=\"double-struck\">R</mi></mrow><mrow class=\"MJX-TeXAtom-ORD\"><mi>d</mi><mo>×</mo><mi>r</mi></mrow></msup><mo>,</mo><mi>r</mi><mo>≪</mo><mi>d</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-31\">U, V \\in \\mathbb{R}^{d \\times r}, r \\ll d</script>.</li>\n    </ul>\n<p>These reduce both memory and FLOPs.</p>",
    "contentMarkdown": "*   **Pruning** removes less important weights (e.g., structured pruning of entire attention heads).\n*   **Low-rank factorization** decomposes weight matrices:\n    \n    W∈ℝd×d≈UVTW∈Rd×d≈UVT\n    \n    W \\\\in \\\\mathbb{R}^{d \\\\times d} \\\\approx U V^T\n    *   with U,V∈ℝd×r,r≪dU,V∈Rd×r,r≪dU, V \\\\in \\\\mathbb{R}^{d \\\\times r}, r \\\\ll d.\n*   These reduce both memory and FLOPs.\n    \n*   A detailed discourse on this topic is available in our [Model Compression](../model-compression) primer.\n\n**Low-rank factorization** decomposes weight matrices:\n\n*   with U,V∈ℝd×r,r≪dU,V∈Rd×r,r≪dU, V \\\\in \\\\mathbb{R}^{d \\\\times r}, r \\\\ll d.\n\nThese reduce both memory and FLOPs.",
    "contentLength": 13431,
    "wordCount": 82,
    "hasCode": false,
    "hasMath": true,
    "hasImages": false,
    "url": "https://aman.ai/primers/ai/on-device-transformers/#weight-pruning-and-low-rank-approximations"
  },
  {
    "id": "ai-on-device-transformers-operator-and-graph-fusion-14",
    "articleSlug": "on-device-transformers",
    "articleTitle": "On-device Transformers",
    "category": "On-Device AI",
    "chapter": "Optimization Techniques for On-Device Transformers",
    "title": "Operator and Graph Fusion",
    "order": 14,
    "orderInChapter": 7,
    "contentHtml": "<ul>\n  <li>Merge operations like Linear + Bias + LayerNorm to reduce memory reads/writes.</li>\n  <li>Frameworks: TensorRT (GPU), OpenVINO (CPU), CoreML (NPU).</li>\n</ul>",
    "contentMarkdown": "*   Merge operations like Linear + Bias + LayerNorm to reduce memory reads/writes.\n*   Frameworks: TensorRT (GPU), OpenVINO (CPU), CoreML (NPU).",
    "contentLength": 169,
    "wordCount": 21,
    "hasCode": false,
    "hasMath": false,
    "hasImages": false,
    "url": "https://aman.ai/primers/ai/on-device-transformers/#operator-and-graph-fusion"
  },
  {
    "id": "ai-on-device-transformers-sequence-length-and-batch-optimizations-15",
    "articleSlug": "on-device-transformers",
    "articleTitle": "On-device Transformers",
    "category": "On-Device AI",
    "chapter": "Optimization Techniques for On-Device Transformers",
    "title": "Sequence Length and Batch Optimizations",
    "order": 15,
    "orderInChapter": 8,
    "contentHtml": "<ul>\n  <li>Use <strong>sliding window attention</strong> for long sequences.</li>\n  <li>Tune batch size to match hardware occupancy (especially on GPUs).</li>\n</ul>",
    "contentMarkdown": "*   Use **sliding window attention** for long sequences.\n*   Tune batch size to match hardware occupancy (especially on GPUs).",
    "contentLength": 164,
    "wordCount": 19,
    "hasCode": false,
    "hasMath": false,
    "hasImages": false,
    "url": "https://aman.ai/primers/ai/on-device-transformers/#sequence-length-and-batch-optimizations"
  },
  {
    "id": "ai-on-device-transformers-hardware-specific-optimization-notes-16",
    "articleSlug": "on-device-transformers",
    "articleTitle": "On-device Transformers",
    "category": "On-Device AI",
    "chapter": "Optimization Techniques for On-Device Transformers",
    "title": "Hardware-Specific Optimization Notes",
    "order": 16,
    "orderInChapter": 9,
    "contentHtml": "<ul>\n  <li><strong>CPU:</strong> Quantization (<code class=\"language-plaintext highlighter-rouge\">int8</code>), operator fusion, KV caching.</li>\n  <li><strong>GPU:</strong> Mixed precision (<code class=\"language-plaintext highlighter-rouge\">float16</code>/<code class=\"language-plaintext highlighter-rouge\">bfloat16</code>), speculative decoding, batching.</li>\n  <li><strong>TPU:</strong> XLA graph compilation, dense matmul optimizations.</li>\n  <li><strong>NPU:</strong> Static quantization (<code class=\"language-plaintext highlighter-rouge\">int8</code>/<code class=\"language-plaintext highlighter-rouge\">int4</code>), model distillation, pruning.</li>\n</ul>",
    "contentMarkdown": "*   **CPU:** Quantization (`int8`), operator fusion, KV caching.\n*   **GPU:** Mixed precision (`float16`/`bfloat16`), speculative decoding, batching.\n*   **TPU:** XLA graph compilation, dense matmul optimizations.\n*   **NPU:** Static quantization (`int8`/`int4`), model distillation, pruning.",
    "contentLength": 663,
    "wordCount": 32,
    "hasCode": true,
    "hasMath": false,
    "hasImages": false,
    "url": "https://aman.ai/primers/ai/on-device-transformers/#hardware-specific-optimization-notes"
  },
  {
    "id": "ai-on-device-transformers-cpu-deployment-considerations-17",
    "articleSlug": "on-device-transformers",
    "articleTitle": "On-device Transformers",
    "category": "On-Device AI",
    "chapter": "Practical Considerations and Pitfalls When Deploying Transformers on CPU, GPU, and NPUs",
    "title": "CPU Deployment Considerations",
    "order": 17,
    "orderInChapter": 1,
    "contentHtml": "<h4 id=\"key-strengths\">Key Strengths</h4>\n<ul>\n  <li>General-purpose flexibility</li>\n  <li>No need for specialized drivers or runtime</li>\n  <li>Lower memory bandwidth than accelerators, but with good cache locality</li>\n</ul>\n<h4 id=\"watch-out-for\">Watch Out for</h4>\n<ol>\n  <li>\n    <p><strong>MatMul Bottlenecks:</strong></p>\n\n    <ul>\n      <li>Transformer layers involve large GEMMs (General Matrix-Matrix Multiplications).</li>\n      <li>Use libraries like Intel MKL-DNN, oneDNN, or OpenBLAS with AVX2/AVX512 instructions.</li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Cache Contention:</strong></p>\n\n    <ul>\n      <li>KV cache can overflow L2/L3 caches, especially with long sequences.</li>\n      <li>Performance drops significantly when cache locality is lost.</li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Thread Over-subscription:</strong></p>\n\n    <ul>\n      <li>Avoid naive use of multithreading; prefer thread pools and NUMA-aware scheduling.</li>\n      <li>Profile using <code class=\"language-plaintext highlighter-rouge\">perf</code>, Intel VTune, or similar tools.</li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Memory Bandwidth:</strong></p>\n\n    <ul>\n      <li>CPUs often become memory-bound during decoder operation.</li>\n      <li>Optimize memory access patterns and fuse operations to reduce intermediary transfers.</li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Quantization Challenges:</strong></p>\n\n    <ul>\n      <li><code class=\"language-plaintext highlighter-rouge\">int8</code> quantization is highly effective, but requires calibration and may degrade attention accuracy.</li>\n      <li>Use dynamic quantization only if static is not viable.</li>\n    </ul>\n  </li>\n</ol>\n<p><strong>MatMul Bottlenecks:</strong></p>\n<ul>\n      <li>Transformer layers involve large GEMMs (General Matrix-Matrix Multiplications).</li>\n      <li>Use libraries like Intel MKL-DNN, oneDNN, or OpenBLAS with AVX2/AVX512 instructions.</li>\n    </ul>\n<p><strong>Cache Contention:</strong></p>\n<ul>\n      <li>KV cache can overflow L2/L3 caches, especially with long sequences.</li>\n      <li>Performance drops significantly when cache locality is lost.</li>\n    </ul>\n<p><strong>Thread Over-subscription:</strong></p>\n<ul>\n      <li>Avoid naive use of multithreading; prefer thread pools and NUMA-aware scheduling.</li>\n      <li>Profile using <code class=\"language-plaintext highlighter-rouge\">perf</code>, Intel VTune, or similar tools.</li>\n    </ul>\n<p><strong>Memory Bandwidth:</strong></p>\n<ul>\n      <li>CPUs often become memory-bound during decoder operation.</li>\n      <li>Optimize memory access patterns and fuse operations to reduce intermediary transfers.</li>\n    </ul>\n<p><strong>Quantization Challenges:</strong></p>\n<ul>\n      <li><code class=\"language-plaintext highlighter-rouge\">int8</code> quantization is highly effective, but requires calibration and may degrade attention accuracy.</li>\n      <li>Use dynamic quantization only if static is not viable.</li>\n    </ul>",
    "contentMarkdown": "#### Key Strengths\n\n*   General-purpose flexibility\n*   No need for specialized drivers or runtime\n*   Lower memory bandwidth than accelerators, but with good cache locality\n\n#### Watch Out for\n\n1.  **MatMul Bottlenecks:**\n    \n    *   Transformer layers involve large GEMMs (General Matrix-Matrix Multiplications).\n    *   Use libraries like Intel MKL-DNN, oneDNN, or OpenBLAS with AVX2/AVX512 instructions.\n2.  **Cache Contention:**\n    \n    *   KV cache can overflow L2/L3 caches, especially with long sequences.\n    *   Performance drops significantly when cache locality is lost.\n3.  **Thread Over-subscription:**\n    \n    *   Avoid naive use of multithreading; prefer thread pools and NUMA-aware scheduling.\n    *   Profile using `perf`, Intel VTune, or similar tools.\n4.  **Memory Bandwidth:**\n    \n    *   CPUs often become memory-bound during decoder operation.\n    *   Optimize memory access patterns and fuse operations to reduce intermediary transfers.\n5.  **Quantization Challenges:**\n    \n    *   `int8` quantization is highly effective, but requires calibration and may degrade attention accuracy.\n    *   Use dynamic quantization only if static is not viable.\n\n**MatMul Bottlenecks:**\n\n*   Transformer layers involve large GEMMs (General Matrix-Matrix Multiplications).\n*   Use libraries like Intel MKL-DNN, oneDNN, or OpenBLAS with AVX2/AVX512 instructions.\n\n**Cache Contention:**\n\n*   KV cache can overflow L2/L3 caches, especially with long sequences.\n*   Performance drops significantly when cache locality is lost.\n\n**Thread Over-subscription:**\n\n*   Avoid naive use of multithreading; prefer thread pools and NUMA-aware scheduling.\n*   Profile using `perf`, Intel VTune, or similar tools.\n\n**Memory Bandwidth:**\n\n*   CPUs often become memory-bound during decoder operation.\n*   Optimize memory access patterns and fuse operations to reduce intermediary transfers.\n\n**Quantization Challenges:**\n\n*   `int8` quantization is highly effective, but requires calibration and may degrade attention accuracy.\n*   Use dynamic quantization only if static is not viable.",
    "contentLength": 2986,
    "wordCount": 266,
    "hasCode": true,
    "hasMath": false,
    "hasImages": false,
    "url": "https://aman.ai/primers/ai/on-device-transformers/#cpu-deployment-considerations"
  },
  {
    "id": "ai-on-device-transformers-gpu-deployment-considerations-18",
    "articleSlug": "on-device-transformers",
    "articleTitle": "On-device Transformers",
    "category": "On-Device AI",
    "chapter": "Practical Considerations and Pitfalls When Deploying Transformers on CPU, GPU, and NPUs",
    "title": "GPU Deployment Considerations",
    "order": 18,
    "orderInChapter": 2,
    "contentHtml": "<h4 id=\"key-strengths-1\">Key Strengths</h4>\n<ul>\n  <li>Ideal for batched operations and compute-heavy encoder layers</li>\n  <li>High memory bandwidth, many-core architecture</li>\n</ul>\n<h4 id=\"watch-out-for-1\">Watch Out for</h4>\n<ol>\n  <li>\n    <p><strong>Underutilization During Decoding:</strong></p>\n\n    <ul>\n      <li>Single-token decode workloads don’t fully occupy GPU cores.</li>\n      <li>Consider batching requests or speculative decoding to improve efficiency.</li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Kernel Launch Overhead:</strong></p>\n\n    <ul>\n      <li>GPU launch latency can dominate runtime in step-by-step decoding.</li>\n      <li>Use fused kernels and persistent caches.</li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Host-Device Memory Transfers:</strong></p>\n\n    <ul>\n      <li>Frequent CPU-GPU synchronization (especially during dynamic decoding) can be costly.</li>\n      <li>Minimize PCIe transfers and pre-load inputs onto device.</li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Precision Handling:</strong></p>\n\n    <ul>\n      <li>Use <code class=\"language-plaintext highlighter-rouge\">float16</code> or <code class=\"language-plaintext highlighter-rouge\">bfloat16</code> for faster inference, but be cautious of numerical stability.</li>\n      <li>Validate that quantized weights preserve generation quality.</li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Maximize Tensor Core Use:</strong></p>\n\n    <ul>\n      <li>Use NVIDIA’s cuBLAS, cuDNN, or FasterTransformer for optimized linear algebra.</li>\n    </ul>\n  </li>\n</ol>\n<p><strong>Underutilization During Decoding:</strong></p>\n<ul>\n      <li>Single-token decode workloads don’t fully occupy GPU cores.</li>\n      <li>Consider batching requests or speculative decoding to improve efficiency.</li>\n    </ul>\n<p><strong>Kernel Launch Overhead:</strong></p>\n<ul>\n      <li>GPU launch latency can dominate runtime in step-by-step decoding.</li>\n      <li>Use fused kernels and persistent caches.</li>\n    </ul>\n<p><strong>Host-Device Memory Transfers:</strong></p>\n<ul>\n      <li>Frequent CPU-GPU synchronization (especially during dynamic decoding) can be costly.</li>\n      <li>Minimize PCIe transfers and pre-load inputs onto device.</li>\n    </ul>\n<p><strong>Precision Handling:</strong></p>\n<ul>\n      <li>Use <code class=\"language-plaintext highlighter-rouge\">float16</code> or <code class=\"language-plaintext highlighter-rouge\">bfloat16</code> for faster inference, but be cautious of numerical stability.</li>\n      <li>Validate that quantized weights preserve generation quality.</li>\n    </ul>\n<p><strong>Maximize Tensor Core Use:</strong></p>\n<ul>\n      <li>Use NVIDIA’s cuBLAS, cuDNN, or FasterTransformer for optimized linear algebra.</li>\n    </ul>",
    "contentMarkdown": "#### Key Strengths\n\n*   Ideal for batched operations and compute-heavy encoder layers\n*   High memory bandwidth, many-core architecture\n\n#### Watch Out for\n\n1.  **Underutilization During Decoding:**\n    \n    *   Single-token decode workloads don’t fully occupy GPU cores.\n    *   Consider batching requests or speculative decoding to improve efficiency.\n2.  **Kernel Launch Overhead:**\n    \n    *   GPU launch latency can dominate runtime in step-by-step decoding.\n    *   Use fused kernels and persistent caches.\n3.  **Host-Device Memory Transfers:**\n    \n    *   Frequent CPU-GPU synchronization (especially during dynamic decoding) can be costly.\n    *   Minimize PCIe transfers and pre-load inputs onto device.\n4.  **Precision Handling:**\n    \n    *   Use `float16` or `bfloat16` for faster inference, but be cautious of numerical stability.\n    *   Validate that quantized weights preserve generation quality.\n5.  **Maximize Tensor Core Use:**\n    \n    *   Use NVIDIA’s cuBLAS, cuDNN, or FasterTransformer for optimized linear algebra.\n\n**Underutilization During Decoding:**\n\n*   Single-token decode workloads don’t fully occupy GPU cores.\n*   Consider batching requests or speculative decoding to improve efficiency.\n\n**Kernel Launch Overhead:**\n\n*   GPU launch latency can dominate runtime in step-by-step decoding.\n*   Use fused kernels and persistent caches.\n\n**Host-Device Memory Transfers:**\n\n*   Frequent CPU-GPU synchronization (especially during dynamic decoding) can be costly.\n*   Minimize PCIe transfers and pre-load inputs onto device.\n\n**Precision Handling:**\n\n*   Use `float16` or `bfloat16` for faster inference, but be cautious of numerical stability.\n*   Validate that quantized weights preserve generation quality.\n\n**Maximize Tensor Core Use:**\n\n*   Use NVIDIA’s cuBLAS, cuDNN, or FasterTransformer for optimized linear algebra.",
    "contentLength": 2737,
    "wordCount": 235,
    "hasCode": true,
    "hasMath": false,
    "hasImages": false,
    "url": "https://aman.ai/primers/ai/on-device-transformers/#gpu-deployment-considerations"
  },
  {
    "id": "ai-on-device-transformers-tpu-deployment-considerations-19",
    "articleSlug": "on-device-transformers",
    "articleTitle": "On-device Transformers",
    "category": "On-Device AI",
    "chapter": "Practical Considerations and Pitfalls When Deploying Transformers on CPU, GPU, and NPUs",
    "title": "TPU Deployment Considerations",
    "order": 19,
    "orderInChapter": 3,
    "contentHtml": "<h4 id=\"key-strengths-2\">Key Strengths</h4>\n<ul>\n  <li>Extremely efficient for matrix operations</li>\n  <li>Suitable for large-batch inference and training</li>\n</ul>\n<h4 id=\"watch-out-for-2\">Watch Out for</h4>\n<ol>\n  <li>\n    <p><strong>Poor Fit for Decoding:</strong></p>\n\n    <ul>\n      <li>TPUs struggle with dynamic token-wise decoding due to fixed compute graph.</li>\n      <li>May need to run decode loop on CPU or use alternative methods (e.g., GSPMD)</li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Static Shape Requirements:</strong></p>\n\n    <ul>\n      <li>Input/output shapes often must be known ahead of time.</li>\n      <li>Makes dynamic batching and long-sequence handling difficult.</li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Limited Ecosystem:</strong></p>\n\n    <ul>\n      <li>XLA and TensorFlow/JAX integration are essential.</li>\n      <li>Less flexibility than PyTorch or ONNX-based deployments.</li>\n    </ul>\n  </li>\n</ol>\n<p><strong>Poor Fit for Decoding:</strong></p>\n<ul>\n      <li>TPUs struggle with dynamic token-wise decoding due to fixed compute graph.</li>\n      <li>May need to run decode loop on CPU or use alternative methods (e.g., GSPMD)</li>\n    </ul>\n<p><strong>Static Shape Requirements:</strong></p>\n<ul>\n      <li>Input/output shapes often must be known ahead of time.</li>\n      <li>Makes dynamic batching and long-sequence handling difficult.</li>\n    </ul>\n<p><strong>Limited Ecosystem:</strong></p>\n<ul>\n      <li>XLA and TensorFlow/JAX integration are essential.</li>\n      <li>Less flexibility than PyTorch or ONNX-based deployments.</li>\n    </ul>",
    "contentMarkdown": "#### Key Strengths\n\n*   Extremely efficient for matrix operations\n*   Suitable for large-batch inference and training\n\n#### Watch Out for\n\n1.  **Poor Fit for Decoding:**\n    \n    *   TPUs struggle with dynamic token-wise decoding due to fixed compute graph.\n    *   May need to run decode loop on CPU or use alternative methods (e.g., GSPMD)\n2.  **Static Shape Requirements:**\n    \n    *   Input/output shapes often must be known ahead of time.\n    *   Makes dynamic batching and long-sequence handling difficult.\n3.  **Limited Ecosystem:**\n    \n    *   XLA and TensorFlow/JAX integration are essential.\n    *   Less flexibility than PyTorch or ONNX-based deployments.\n\n**Poor Fit for Decoding:**\n\n*   TPUs struggle with dynamic token-wise decoding due to fixed compute graph.\n*   May need to run decode loop on CPU or use alternative methods (e.g., GSPMD)\n\n**Static Shape Requirements:**\n\n*   Input/output shapes often must be known ahead of time.\n*   Makes dynamic batching and long-sequence handling difficult.\n\n**Limited Ecosystem:**\n\n*   XLA and TensorFlow/JAX integration are essential.\n*   Less flexibility than PyTorch or ONNX-based deployments.",
    "contentLength": 1593,
    "wordCount": 161,
    "hasCode": false,
    "hasMath": false,
    "hasImages": false,
    "url": "https://aman.ai/primers/ai/on-device-transformers/#tpu-deployment-considerations"
  },
  {
    "id": "ai-on-device-transformers-npu-deployment-considerations-edgesoc-devices-20",
    "articleSlug": "on-device-transformers",
    "articleTitle": "On-device Transformers",
    "category": "On-Device AI",
    "chapter": "Practical Considerations and Pitfalls When Deploying Transformers on CPU, GPU, and NPUs",
    "title": "NPU Deployment Considerations (Edge/SoC Devices)",
    "order": 20,
    "orderInChapter": 4,
    "contentHtml": "<h4 id=\"key-strengths-3\">Key Strengths</h4>\n<ul>\n  <li>Extremely efficient for low-power inference</li>\n  <li>On-chip memory reduces latency</li>\n</ul>\n<h4 id=\"watch-out-for-3\">Watch Out for</h4>\n<ol>\n  <li>\n    <p><strong>Operator Support Limitations:</strong></p>\n\n    <ul>\n      <li>Custom or unsupported operations must fall back to CPU, drastically hurting performance.</li>\n      <li>Stay within the vendor’s supported op-set (e.g., for Apple ANE, Qualcomm Hexagon, etc.).</li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Model Size Constraints:</strong></p>\n\n    <ul>\n      <li>Total model size must fit within NPU’s SRAM or limited DRAM window.</li>\n      <li>Quantization (<code class=\"language-plaintext highlighter-rouge\">int8</code> or <code class=\"language-plaintext highlighter-rouge\">int4</code>) is non-negotiable for many NPUs.</li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Toolchain Lock-in:</strong></p>\n\n    <ul>\n      <li>Conversion pipelines (e.g., PyTorch <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-32-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>&amp;#x2192;</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-364\" style=\"width: 1.201em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.992em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.565em, 1000.94em, 2.294em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-365\"><span class=\"mo\" id=\"MathJax-Span-366\" style=\"font-family: STIXGeneral-Regular;\">→</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: 0.003em; border-left: 0px solid; width: 0px; height: 0.628em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mo stretchy=\"false\">→</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-32\">\\rightarrow</script> ONNX <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-33-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>&amp;#x2192;</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-367\" style=\"width: 1.201em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.992em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.565em, 1000.94em, 2.294em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-368\"><span class=\"mo\" id=\"MathJax-Span-369\" style=\"font-family: STIXGeneral-Regular;\">→</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: 0.003em; border-left: 0px solid; width: 0px; height: 0.628em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mo stretchy=\"false\">→</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-33\">\\rightarrow</script> CoreML) must be strictly validated.</li>\n      <li>Vendor SDKs may lack transparency and debugging tools.</li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>No Runtime Reallocation:</strong></p>\n\n    <ul>\n      <li>Static allocation of KV cache, input tensors, and batch sizes is often required.</li>\n      <li>This can lead to fragmentation or wasted space.</li>\n    </ul>\n  </li>\n</ol>\n<p><strong>Operator Support Limitations:</strong></p>\n<ul>\n      <li>Custom or unsupported operations must fall back to CPU, drastically hurting performance.</li>\n      <li>Stay within the vendor’s supported op-set (e.g., for Apple ANE, Qualcomm Hexagon, etc.).</li>\n    </ul>\n<p><strong>Model Size Constraints:</strong></p>\n<ul>\n      <li>Total model size must fit within NPU’s SRAM or limited DRAM window.</li>\n      <li>Quantization (<code class=\"language-plaintext highlighter-rouge\">int8</code> or <code class=\"language-plaintext highlighter-rouge\">int4</code>) is non-negotiable for many NPUs.</li>\n    </ul>\n<p><strong>Toolchain Lock-in:</strong></p>\n<ul>\n      <li>Conversion pipelines (e.g., PyTorch <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-32-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>&amp;#x2192;</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-364\" style=\"width: 1.201em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.992em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.565em, 1000.94em, 2.294em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-365\"><span class=\"mo\" id=\"MathJax-Span-366\" style=\"font-family: STIXGeneral-Regular;\">→</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: 0.003em; border-left: 0px solid; width: 0px; height: 0.628em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mo stretchy=\"false\">→</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-32\">\\rightarrow</script> ONNX <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-33-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>&amp;#x2192;</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-367\" style=\"width: 1.201em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.992em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.565em, 1000.94em, 2.294em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-368\"><span class=\"mo\" id=\"MathJax-Span-369\" style=\"font-family: STIXGeneral-Regular;\">→</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: 0.003em; border-left: 0px solid; width: 0px; height: 0.628em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mo stretchy=\"false\">→</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-33\">\\rightarrow</script> CoreML) must be strictly validated.</li>\n      <li>Vendor SDKs may lack transparency and debugging tools.</li>\n    </ul>\n<p><strong>No Runtime Reallocation:</strong></p>\n<ul>\n      <li>Static allocation of KV cache, input tensors, and batch sizes is often required.</li>\n      <li>This can lead to fragmentation or wasted space.</li>\n    </ul>",
    "contentMarkdown": "#### Key Strengths\n\n*   Extremely efficient for low-power inference\n*   On-chip memory reduces latency\n\n#### Watch Out for\n\n1.  **Operator Support Limitations:**\n    \n    *   Custom or unsupported operations must fall back to CPU, drastically hurting performance.\n    *   Stay within the vendor’s supported op-set (e.g., for Apple ANE, Qualcomm Hexagon, etc.).\n2.  **Model Size Constraints:**\n    \n    *   Total model size must fit within NPU’s SRAM or limited DRAM window.\n    *   Quantization (`int8` or `int4`) is non-negotiable for many NPUs.\n3.  **Toolchain Lock-in:**\n    \n    *   Conversion pipelines (e.g., PyTorch →→\\\\rightarrow ONNX →→\\\\rightarrow CoreML) must be strictly validated.\n    *   Vendor SDKs may lack transparency and debugging tools.\n4.  **No Runtime Reallocation:**\n    \n    *   Static allocation of KV cache, input tensors, and batch sizes is often required.\n    *   This can lead to fragmentation or wasted space.\n\n**Operator Support Limitations:**\n\n*   Custom or unsupported operations must fall back to CPU, drastically hurting performance.\n*   Stay within the vendor’s supported op-set (e.g., for Apple ANE, Qualcomm Hexagon, etc.).\n\n**Model Size Constraints:**\n\n*   Total model size must fit within NPU’s SRAM or limited DRAM window.\n*   Quantization (`int8` or `int4`) is non-negotiable for many NPUs.\n\n**Toolchain Lock-in:**\n\n*   Conversion pipelines (e.g., PyTorch →→\\\\rightarrow ONNX →→\\\\rightarrow CoreML) must be strictly validated.\n*   Vendor SDKs may lack transparency and debugging tools.\n\n**No Runtime Reallocation:**\n\n*   Static allocation of KV cache, input tensors, and batch sizes is often required.\n*   This can lead to fragmentation or wasted space.",
    "contentLength": 7398,
    "wordCount": 234,
    "hasCode": true,
    "hasMath": true,
    "hasImages": false,
    "url": "https://aman.ai/primers/ai/on-device-transformers/#npu-deployment-considerations-(edge/soc-devices)"
  },
  {
    "id": "ai-on-device-transformers-summary-table-key-pitfalls-by-hardware-21",
    "articleSlug": "on-device-transformers",
    "articleTitle": "On-device Transformers",
    "category": "On-Device AI",
    "chapter": "Practical Considerations and Pitfalls When Deploying Transformers on CPU, GPU, and NPUs",
    "title": "Summary Table: Key Pitfalls by Hardware",
    "order": 21,
    "orderInChapter": 5,
    "contentHtml": "<div align=\"center\">\n<table class=\"tg\">\n<thead>\n<tr>\n<th class=\"tg-hcenter-valign-first\"><strong>Platform</strong></th>\n<th class=\"tg-hcenter-valign-first\"><strong>Key Pitfall</strong></th>\n<th class=\"tg-hcenter-valign-second\"><strong>Best Practices</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td class=\"tg-tleft-valign-first\">CPU</td>\n<td class=\"tg-tleft-valign-first\">Memory-bound decode + small caches</td>\n<td class=\"tg-tleft-valign-second\">Use quantization, cache-friendly layouts</td>\n</tr>\n<tr>\n<td class=\"tg-tleft-valign-first\">GPU</td>\n<td class=\"tg-tleft-valign-first\">Underutilized during decoding</td>\n<td class=\"tg-tleft-valign-second\">Use batching, speculative decoding, fused kernels</td>\n</tr>\n<tr>\n<td class=\"tg-tleft-valign-first\">TPU</td>\n<td class=\"tg-tleft-valign-first\">Poor step-by-step token generation</td>\n<td class=\"tg-tleft-valign-second\">Offload decode to CPU or use static batching</td>\n</tr>\n<tr>\n<td class=\"tg-tleft-valign-first\">NPU</td>\n<td class=\"tg-tleft-valign-first\">Operator and memory constraints</td>\n<td class=\"tg-tleft-valign-second\">Quantize, simplify architecture, preallocate buffers</td>\n</tr>\n</tbody>\n</table>\n</div>\n<table class=\"tg\">\n<thead>\n<tr>\n<th class=\"tg-hcenter-valign-first\"><strong>Platform</strong></th>\n<th class=\"tg-hcenter-valign-first\"><strong>Key Pitfall</strong></th>\n<th class=\"tg-hcenter-valign-second\"><strong>Best Practices</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td class=\"tg-tleft-valign-first\">CPU</td>\n<td class=\"tg-tleft-valign-first\">Memory-bound decode + small caches</td>\n<td class=\"tg-tleft-valign-second\">Use quantization, cache-friendly layouts</td>\n</tr>\n<tr>\n<td class=\"tg-tleft-valign-first\">GPU</td>\n<td class=\"tg-tleft-valign-first\">Underutilized during decoding</td>\n<td class=\"tg-tleft-valign-second\">Use batching, speculative decoding, fused kernels</td>\n</tr>\n<tr>\n<td class=\"tg-tleft-valign-first\">TPU</td>\n<td class=\"tg-tleft-valign-first\">Poor step-by-step token generation</td>\n<td class=\"tg-tleft-valign-second\">Offload decode to CPU or use static batching</td>\n</tr>\n<tr>\n<td class=\"tg-tleft-valign-first\">NPU</td>\n<td class=\"tg-tleft-valign-first\">Operator and memory constraints</td>\n<td class=\"tg-tleft-valign-second\">Quantize, simplify architecture, preallocate buffers</td>\n</tr>\n</tbody>\n</table>",
    "contentMarkdown": "**Platform**\n\n**Key Pitfall**\n\n**Best Practices**\n\nCPU\n\nMemory-bound decode + small caches\n\nUse quantization, cache-friendly layouts\n\nGPU\n\nUnderutilized during decoding\n\nUse batching, speculative decoding, fused kernels\n\nTPU\n\nPoor step-by-step token generation\n\nOffload decode to CPU or use static batching\n\nNPU\n\nOperator and memory constraints\n\nQuantize, simplify architecture, preallocate buffers\n\n**Platform**\n\n**Key Pitfall**\n\n**Best Practices**\n\nCPU\n\nMemory-bound decode + small caches\n\nUse quantization, cache-friendly layouts\n\nGPU\n\nUnderutilized during decoding\n\nUse batching, speculative decoding, fused kernels\n\nTPU\n\nPoor step-by-step token generation\n\nOffload decode to CPU or use static batching\n\nNPU\n\nOperator and memory constraints\n\nQuantize, simplify architecture, preallocate buffers",
    "contentLength": 2301,
    "wordCount": 96,
    "hasCode": false,
    "hasMath": false,
    "hasImages": false,
    "url": "https://aman.ai/primers/ai/on-device-transformers/#summary-table:-key-pitfalls-by-hardware"
  },
  {
    "id": "ai-on-device-transformers-tokenizer-and-vocabulary-size-22",
    "articleSlug": "on-device-transformers",
    "articleTitle": "On-device Transformers",
    "category": "On-Device AI",
    "chapter": "Parameter Choices and Their Runtime Implications in Transformer Architectures",
    "title": "Tokenizer and Vocabulary Size",
    "order": 22,
    "orderInChapter": 1,
    "contentHtml": "<ul>\n  <li>A tokenizer converts raw text into discrete tokens that the model can process. The vocabulary size, denoted as <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-38-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-386\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-387\"><span class=\"mi\" id=\"MathJax-Span-388\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-38\">V</script>, represents the number of unique tokens the model can recognize. This parameter has several direct and indirect effects on transformer runtime.</li>\n</ul>\n<h4 id=\"impact-on-embedding-and-output-layers\">Impact on Embedding and Output Layers</h4>\n<ul>\n  <li>\n    <p>The embedding layer maps each token ID to a vector of size <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-39-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-389\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-390\"><span class=\"msubsup\" id=\"MathJax-Span-391\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-392\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-393\"><span class=\"mrow\" id=\"MathJax-Span-394\"><span class=\"mtext\" id=\"MathJax-Span-395\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-39\">d_{\\text{model}}</script> (the embedding dimension). The computational and memory cost of this layer is:</p>\n\n    <ul>\n      <li><strong>Parameter count:</strong> <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-40-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>P</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>embed</mtext></mrow></msub><mo>=</mo><mi>V</mi><mo>&amp;#x00D7;</mo><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-396\" style=\"width: 9.586em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 7.971em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1007.97em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-397\"><span class=\"msubsup\" id=\"MathJax-Span-398\"><span style=\"display: inline-block; position: relative; width: 2.555em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.63em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-399\" style=\"font-family: STIXGeneral-Italic;\">P</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.628em;\"><span class=\"texatom\" id=\"MathJax-Span-400\"><span class=\"mrow\" id=\"MathJax-Span-401\"><span class=\"mtext\" id=\"MathJax-Span-402\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">embed</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-403\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mi\" id=\"MathJax-Span-404\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-405\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">×</span><span class=\"msubsup\" id=\"MathJax-Span-406\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-407\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-408\"><span class=\"mrow\" id=\"MathJax-Span-409\"><span class=\"mtext\" id=\"MathJax-Span-410\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>P</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>embed</mtext></mrow></msub><mo>=</mo><mi>V</mi><mo>×</mo><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-40\">P_{\\text{embed}} = V \\times d_{\\text{model}}</script></li>\n      <li><strong>Memory footprint:</strong> Proportional to <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-41-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>P</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>embed</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-411\" style=\"width: 3.076em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.555em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.55em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-412\"><span class=\"msubsup\" id=\"MathJax-Span-413\"><span style=\"display: inline-block; position: relative; width: 2.555em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.63em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-414\" style=\"font-family: STIXGeneral-Italic;\">P</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.628em;\"><span class=\"texatom\" id=\"MathJax-Span-415\"><span class=\"mrow\" id=\"MathJax-Span-416\"><span class=\"mtext\" id=\"MathJax-Span-417\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">embed</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>P</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>embed</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-41\">P_{\\text{embed}}</script>, typically stored in float16 or int8.</li>\n      <li><strong>Runtime:</strong> At inference, the lookup cost is <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-42-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><mn>1</mn><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-418\" style=\"width: 2.294em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.878em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1001.83em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-419\"><span class=\"mi\" id=\"MathJax-Span-420\" style=\"font-family: STIXGeneral-Italic;\">O</span><span class=\"mo\" id=\"MathJax-Span-421\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mn\" id=\"MathJax-Span-422\" style=\"font-family: STIXGeneral-Regular;\">1</span><span class=\"mo\" id=\"MathJax-Span-423\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>O</mi><mo stretchy=\"false\">(</mo><mn>1</mn><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-42\">O(1)</script> per token, but the softmax in the output layer is <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-43-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><mi>V</mi><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-424\" style=\"width: 2.659em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.19em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1002.14em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-425\"><span class=\"mi\" id=\"MathJax-Span-426\" style=\"font-family: STIXGeneral-Italic;\">O</span><span class=\"mo\" id=\"MathJax-Span-427\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-428\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-429\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>O</mi><mo stretchy=\"false\">(</mo><mi>V</mi><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-43\">O(V)</script> per token.</li>\n    </ul>\n  </li>\n  <li>\n    <p>The largest runtime penalty from a bigger vocabulary comes from the output projection and softmax. The final logits are computed via:</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-44-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><msub><mi>z</mi><mi>t</mi></msub><mo>=</mo><msub><mi>W</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>out</mtext></mrow></msub><msub><mi>h</mi><mi>t</mi></msub><mo>+</mo><mi>b</mi></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-430\" style=\"width: 7.346em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 6.096em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1006.04em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-431\"><span class=\"msubsup\" id=\"MathJax-Span-432\"><span style=\"display: inline-block; position: relative; width: 0.68em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.37em, 4.273em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-433\" style=\"font-family: STIXGeneral-Italic;\">z</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.367em;\"><span class=\"mi\" id=\"MathJax-Span-434\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">t<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-435\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"msubsup\" id=\"MathJax-Span-436\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 1.826em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-437\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"texatom\" id=\"MathJax-Span-438\"><span class=\"mrow\" id=\"MathJax-Span-439\"><span class=\"mtext\" id=\"MathJax-Span-440\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">out</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"msubsup\" id=\"MathJax-Span-441\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-442\" style=\"font-family: STIXGeneral-Italic;\">h</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"mi\" id=\"MathJax-Span-443\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">t<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-444\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mi\" id=\"MathJax-Span-445\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.263em;\">b</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><msub><mi>z</mi><mi>t</mi></msub><mo>=</mo><msub><mi>W</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>out</mtext></mrow></msub><msub><mi>h</mi><mi>t</mi></msub><mo>+</mo><mi>b</mi></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-44\">z_t = W_{\\text{out}} h_t + b</script>\n\n    <ul>\n      <li>where <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-45-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>W</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>out</mtext></mrow></msub><mo>&amp;#x2208;</mo><msup><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi mathvariant=&quot;double-struck&quot;>R</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>V</mi><mo>&amp;#x00D7;</mo><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></mrow></msup></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-446\" style=\"width: 7.763em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 6.461em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.201em, 1006.46em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-447\"><span class=\"msubsup\" id=\"MathJax-Span-448\"><span style=\"display: inline-block; position: relative; width: 1.826em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-449\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"texatom\" id=\"MathJax-Span-450\"><span class=\"mrow\" id=\"MathJax-Span-451\"><span class=\"mtext\" id=\"MathJax-Span-452\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">out</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-453\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">∈</span><span class=\"msubsup\" id=\"MathJax-Span-454\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 3.44em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.73em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"texatom\" id=\"MathJax-Span-455\"><span class=\"mrow\" id=\"MathJax-Span-456\"><span class=\"mi\" id=\"MathJax-Span-457\" style=\"font-family: STIXGeneral-Regular;\">ℝ</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.372em; left: 0.732em;\"><span class=\"texatom\" id=\"MathJax-Span-458\"><span class=\"mrow\" id=\"MathJax-Span-459\"><span class=\"mi\" id=\"MathJax-Span-460\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-461\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">×</span><span class=\"msubsup\" id=\"MathJax-Span-462\"><span style=\"display: inline-block; position: relative; width: 1.669em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.388em, 1000.37em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-463\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.904em; left: 0.367em;\"><span class=\"texatom\" id=\"MathJax-Span-464\"><span class=\"mrow\" id=\"MathJax-Span-465\"><span class=\"mtext\" id=\"MathJax-Span-466\" style=\"font-size: 50%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.378em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>W</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>out</mtext></mrow></msub><mo>∈</mo><msup><mrow class=\"MJX-TeXAtom-ORD\"><mi mathvariant=\"double-struck\">R</mi></mrow><mrow class=\"MJX-TeXAtom-ORD\"><mi>V</mi><mo>×</mo><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></mrow></msup></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-45\">W_{\\text{out}} \\in \\mathbb{R}^{V \\times d_{\\text{model}}}</script>.</li>\n    </ul>\n  </li>\n  <li>\n    <p>This operation costs <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-46-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><mi>V</mi><mo>&amp;#x22C5;</mo><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-467\" style=\"width: 6.565em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 5.471em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1005.42em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-468\"><span class=\"mi\" id=\"MathJax-Span-469\" style=\"font-family: STIXGeneral-Italic;\">O</span><span class=\"mo\" id=\"MathJax-Span-470\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-471\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-472\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"msubsup\" id=\"MathJax-Span-473\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-474\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-475\"><span class=\"mrow\" id=\"MathJax-Span-476\"><span class=\"mtext\" id=\"MathJax-Span-477\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-478\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>O</mi><mo stretchy=\"false\">(</mo><mi>V</mi><mo>⋅</mo><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-46\">O(V \\cdot d_{\\text{model}})</script> per decoding step. For large <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-47-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-479\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-480\"><span class=\"mi\" id=\"MathJax-Span-481\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-47\">V</script> (e.g., 50k+), this can dominate single-token decode latency on CPUs or NPUs, especially when <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-48-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-482\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-483\"><span class=\"mi\" id=\"MathJax-Span-484\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-48\">V</script> exceeds cache size.</p>\n  </li>\n</ul>\n<p>The embedding layer maps each token ID to a vector of size <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-39-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-389\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-390\"><span class=\"msubsup\" id=\"MathJax-Span-391\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-392\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-393\"><span class=\"mrow\" id=\"MathJax-Span-394\"><span class=\"mtext\" id=\"MathJax-Span-395\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-39\">d_{\\text{model}}</script> (the embedding dimension). The computational and memory cost of this layer is:</p>\n<ul>\n      <li><strong>Parameter count:</strong> <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-40-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>P</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>embed</mtext></mrow></msub><mo>=</mo><mi>V</mi><mo>&amp;#x00D7;</mo><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-396\" style=\"width: 9.586em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 7.971em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1007.97em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-397\"><span class=\"msubsup\" id=\"MathJax-Span-398\"><span style=\"display: inline-block; position: relative; width: 2.555em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.63em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-399\" style=\"font-family: STIXGeneral-Italic;\">P</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.628em;\"><span class=\"texatom\" id=\"MathJax-Span-400\"><span class=\"mrow\" id=\"MathJax-Span-401\"><span class=\"mtext\" id=\"MathJax-Span-402\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">embed</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-403\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mi\" id=\"MathJax-Span-404\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-405\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">×</span><span class=\"msubsup\" id=\"MathJax-Span-406\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-407\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-408\"><span class=\"mrow\" id=\"MathJax-Span-409\"><span class=\"mtext\" id=\"MathJax-Span-410\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>P</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>embed</mtext></mrow></msub><mo>=</mo><mi>V</mi><mo>×</mo><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-40\">P_{\\text{embed}} = V \\times d_{\\text{model}}</script></li>\n      <li><strong>Memory footprint:</strong> Proportional to <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-41-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>P</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>embed</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-411\" style=\"width: 3.076em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.555em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.55em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-412\"><span class=\"msubsup\" id=\"MathJax-Span-413\"><span style=\"display: inline-block; position: relative; width: 2.555em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.63em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-414\" style=\"font-family: STIXGeneral-Italic;\">P</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.628em;\"><span class=\"texatom\" id=\"MathJax-Span-415\"><span class=\"mrow\" id=\"MathJax-Span-416\"><span class=\"mtext\" id=\"MathJax-Span-417\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">embed</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>P</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>embed</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-41\">P_{\\text{embed}}</script>, typically stored in float16 or int8.</li>\n      <li><strong>Runtime:</strong> At inference, the lookup cost is <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-42-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><mn>1</mn><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-418\" style=\"width: 2.294em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.878em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1001.83em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-419\"><span class=\"mi\" id=\"MathJax-Span-420\" style=\"font-family: STIXGeneral-Italic;\">O</span><span class=\"mo\" id=\"MathJax-Span-421\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mn\" id=\"MathJax-Span-422\" style=\"font-family: STIXGeneral-Regular;\">1</span><span class=\"mo\" id=\"MathJax-Span-423\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>O</mi><mo stretchy=\"false\">(</mo><mn>1</mn><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-42\">O(1)</script> per token, but the softmax in the output layer is <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-43-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><mi>V</mi><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-424\" style=\"width: 2.659em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.19em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1002.14em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-425\"><span class=\"mi\" id=\"MathJax-Span-426\" style=\"font-family: STIXGeneral-Italic;\">O</span><span class=\"mo\" id=\"MathJax-Span-427\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-428\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-429\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>O</mi><mo stretchy=\"false\">(</mo><mi>V</mi><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-43\">O(V)</script> per token.</li>\n    </ul>\n<p>The largest runtime penalty from a bigger vocabulary comes from the output projection and softmax. The final logits are computed via:</p>\n<ul>\n      <li>where <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-45-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>W</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>out</mtext></mrow></msub><mo>&amp;#x2208;</mo><msup><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi mathvariant=&quot;double-struck&quot;>R</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>V</mi><mo>&amp;#x00D7;</mo><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></mrow></msup></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-446\" style=\"width: 7.763em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 6.461em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.201em, 1006.46em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-447\"><span class=\"msubsup\" id=\"MathJax-Span-448\"><span style=\"display: inline-block; position: relative; width: 1.826em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.89em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-449\" style=\"font-family: STIXGeneral-Italic;\">W<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.836em;\"><span class=\"texatom\" id=\"MathJax-Span-450\"><span class=\"mrow\" id=\"MathJax-Span-451\"><span class=\"mtext\" id=\"MathJax-Span-452\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">out</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-453\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">∈</span><span class=\"msubsup\" id=\"MathJax-Span-454\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 3.44em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.73em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"texatom\" id=\"MathJax-Span-455\"><span class=\"mrow\" id=\"MathJax-Span-456\"><span class=\"mi\" id=\"MathJax-Span-457\" style=\"font-family: STIXGeneral-Regular;\">ℝ</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.372em; left: 0.732em;\"><span class=\"texatom\" id=\"MathJax-Span-458\"><span class=\"mrow\" id=\"MathJax-Span-459\"><span class=\"mi\" id=\"MathJax-Span-460\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-461\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">×</span><span class=\"msubsup\" id=\"MathJax-Span-462\"><span style=\"display: inline-block; position: relative; width: 1.669em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.388em, 1000.37em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-463\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.904em; left: 0.367em;\"><span class=\"texatom\" id=\"MathJax-Span-464\"><span class=\"mrow\" id=\"MathJax-Span-465\"><span class=\"mtext\" id=\"MathJax-Span-466\" style=\"font-size: 50%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.378em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>W</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>out</mtext></mrow></msub><mo>∈</mo><msup><mrow class=\"MJX-TeXAtom-ORD\"><mi mathvariant=\"double-struck\">R</mi></mrow><mrow class=\"MJX-TeXAtom-ORD\"><mi>V</mi><mo>×</mo><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></mrow></msup></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-45\">W_{\\text{out}} \\in \\mathbb{R}^{V \\times d_{\\text{model}}}</script>.</li>\n    </ul>\n<p>This operation costs <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-46-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><mi>V</mi><mo>&amp;#x22C5;</mo><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-467\" style=\"width: 6.565em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 5.471em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1005.42em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-468\"><span class=\"mi\" id=\"MathJax-Span-469\" style=\"font-family: STIXGeneral-Italic;\">O</span><span class=\"mo\" id=\"MathJax-Span-470\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-471\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-472\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"msubsup\" id=\"MathJax-Span-473\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-474\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-475\"><span class=\"mrow\" id=\"MathJax-Span-476\"><span class=\"mtext\" id=\"MathJax-Span-477\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-478\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>O</mi><mo stretchy=\"false\">(</mo><mi>V</mi><mo>⋅</mo><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-46\">O(V \\cdot d_{\\text{model}})</script> per decoding step. For large <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-47-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-479\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-480\"><span class=\"mi\" id=\"MathJax-Span-481\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-47\">V</script> (e.g., 50k+), this can dominate single-token decode latency on CPUs or NPUs, especially when <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-48-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-482\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-483\"><span class=\"mi\" id=\"MathJax-Span-484\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-48\">V</script> exceeds cache size.</p>\n<h4 id=\"tradeoffs-of-vocabulary-size\">Tradeoffs of Vocabulary Size</h4>\n<ul>\n  <li>\n    <p><strong>Larger <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-49-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-485\" style=\"width: 0.932em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.777em; height: 0px; font-size: 121%;\"><span style=\"position: absolute; clip: rect(1.346em, 1000.78em, 2.327em, -999.997em); top: -2.167em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-486\"><span class=\"mi\" id=\"MathJax-Span-487\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.054em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.172em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-49\">V</script></strong></p>\n\n    <ul>\n      <li><strong>Pros:</strong> Fewer tokens per sentence (shorter sequences), potentially better language coverage.</li>\n      <li><strong>Cons:</strong> Larger embedding and output layers, higher per-step cost, more memory bandwidth pressure.</li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Smaller <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-50-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-488\" style=\"width: 0.932em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.777em; height: 0px; font-size: 121%;\"><span style=\"position: absolute; clip: rect(1.346em, 1000.78em, 2.327em, -999.997em); top: -2.167em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-489\"><span class=\"mi\" id=\"MathJax-Span-490\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.054em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.172em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-50\">V</script></strong></p>\n\n    <ul>\n      <li><strong>Pros:</strong> Smaller parameter count, faster output projection, better fit for on-device constraints.</li>\n      <li><strong>Cons:</strong> Longer sequences (more decoding steps), higher total attention cost <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-51-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><msup><mi>n</mi><mn>2</mn></msup><mo>&amp;#x22C5;</mo><mi>d</mi><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-491\" style=\"width: 4.638em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 3.857em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.253em, 1003.8em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-492\"><span class=\"mi\" id=\"MathJax-Span-493\" style=\"font-family: STIXGeneral-Italic;\">O</span><span class=\"mo\" id=\"MathJax-Span-494\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"msubsup\" id=\"MathJax-Span-495\"><span style=\"display: inline-block; position: relative; width: 0.94em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-496\" style=\"font-family: STIXGeneral-Italic;\">n</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.372em; left: 0.523em;\"><span class=\"mn\" id=\"MathJax-Span-497\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-498\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"mi\" id=\"MathJax-Span-499\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.263em;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-500\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.378em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>O</mi><mo stretchy=\"false\">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo>⋅</mo><mi>d</mi><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-51\">O(n^2 \\cdot d)</script> in prefill.</li>\n    </ul>\n  </li>\n  <li>\n    <p>There is a non-trivial sweet spot where the cost of the output softmax balances with the cost of processing longer sequences.</p>\n  </li>\n</ul>\n<p><strong>Larger <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-49-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-485\" style=\"width: 0.932em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.777em; height: 0px; font-size: 121%;\"><span style=\"position: absolute; clip: rect(1.346em, 1000.78em, 2.327em, -999.997em); top: -2.167em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-486\"><span class=\"mi\" id=\"MathJax-Span-487\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.054em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.172em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-49\">V</script></strong></p>\n<ul>\n      <li><strong>Pros:</strong> Fewer tokens per sentence (shorter sequences), potentially better language coverage.</li>\n      <li><strong>Cons:</strong> Larger embedding and output layers, higher per-step cost, more memory bandwidth pressure.</li>\n    </ul>\n<p><strong>Smaller <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-50-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-488\" style=\"width: 0.932em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.777em; height: 0px; font-size: 121%;\"><span style=\"position: absolute; clip: rect(1.346em, 1000.78em, 2.327em, -999.997em); top: -2.167em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-489\"><span class=\"mi\" id=\"MathJax-Span-490\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.054em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.172em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-50\">V</script></strong></p>\n<ul>\n      <li><strong>Pros:</strong> Smaller parameter count, faster output projection, better fit for on-device constraints.</li>\n      <li><strong>Cons:</strong> Longer sequences (more decoding steps), higher total attention cost <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-51-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><msup><mi>n</mi><mn>2</mn></msup><mo>&amp;#x22C5;</mo><mi>d</mi><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-491\" style=\"width: 4.638em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 3.857em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.253em, 1003.8em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-492\"><span class=\"mi\" id=\"MathJax-Span-493\" style=\"font-family: STIXGeneral-Italic;\">O</span><span class=\"mo\" id=\"MathJax-Span-494\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"msubsup\" id=\"MathJax-Span-495\"><span style=\"display: inline-block; position: relative; width: 0.94em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-496\" style=\"font-family: STIXGeneral-Italic;\">n</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.372em; left: 0.523em;\"><span class=\"mn\" id=\"MathJax-Span-497\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-498\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"mi\" id=\"MathJax-Span-499\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.263em;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-500\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.378em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>O</mi><mo stretchy=\"false\">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo>⋅</mo><mi>d</mi><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-51\">O(n^2 \\cdot d)</script> in prefill.</li>\n    </ul>\n<p>There is a non-trivial sweet spot where the cost of the output softmax balances with the cost of processing longer sequences.</p>\n<h4 id=\"runtime-context-temperature-vs-vocabulary-size\">Runtime Context: Temperature vs. Vocabulary Size</h4>\n<ul>\n  <li>\n    <p>Note that temperature (as it relates to decoder sampling) affects randomness and diversity of outputs, but <strong>does not impact FLOPs, memory bandwidth, or parameter count</strong>. In contrast, vocabulary size directly changes the computational graph and memory access pattern at every generation step.</p>\n  </li>\n  <li>\n    <p>So in terms of runtime importance:</p>\n\n    <ul>\n      <li><strong>Vocabulary size is far more significant than temperature</strong> for performance.</li>\n      <li>Temperature can be tuned freely without runtime cost, but vocabulary size needs to be fixed at training time.</li>\n    </ul>\n  </li>\n</ul>\n<p>Note that temperature (as it relates to decoder sampling) affects randomness and diversity of outputs, but <strong>does not impact FLOPs, memory bandwidth, or parameter count</strong>. In contrast, vocabulary size directly changes the computational graph and memory access pattern at every generation step.</p>\n<p>So in terms of runtime importance:</p>\n<ul>\n      <li><strong>Vocabulary size is far more significant than temperature</strong> for performance.</li>\n      <li>Temperature can be tuned freely without runtime cost, but vocabulary size needs to be fixed at training time.</li>\n    </ul>\n<h4 id=\"server-vs-on-device-considerations\">Server vs. On-Device Considerations</h4>\n<ul>\n  <li>\n    <p><strong>Server-side (NanoGPT, TensorRT-LLM, vLLM, DeepSpeed-Inference)</strong>: Large vocabularies are more tolerable since GPUs offer high-bandwidth memory (HBM) and Tensor Cores, which accelerate matrix-vector multiplies in the output layer. Softmax can be fused and batched.</p>\n  </li>\n  <li>\n    <p><strong>On-device (<code class=\"language-plaintext highlighter-rouge\">llama.cpp</code>, LidarTLM, GGML, MediaPipe + TFLite, ONNX Runtime Mobile)</strong>: Vocabulary size is a primary bottleneck, especially for NPUs or CPUs without fast GEMM acceleration for large matrices. LidarTLM, optimized for edge LiDAR transformers, often uses reduced vocabularies or subword schemes to minimize per-step cost.</p>\n  </li>\n</ul>\n<p><strong>Server-side (NanoGPT, TensorRT-LLM, vLLM, DeepSpeed-Inference)</strong>: Large vocabularies are more tolerable since GPUs offer high-bandwidth memory (HBM) and Tensor Cores, which accelerate matrix-vector multiplies in the output layer. Softmax can be fused and batched.</p>\n<p><strong>On-device (<code class=\"language-plaintext highlighter-rouge\">llama.cpp</code>, LidarTLM, GGML, MediaPipe + TFLite, ONNX Runtime Mobile)</strong>: Vocabulary size is a primary bottleneck, especially for NPUs or CPUs without fast GEMM acceleration for large matrices. LidarTLM, optimized for edge LiDAR transformers, often uses reduced vocabularies or subword schemes to minimize per-step cost.</p>\n<h5 id=\"runtime-specific-notes\">Runtime-Specific Notes</h5>\n<ul>\n  <li>\n    <p><strong>NanoGPT</strong>: Tends toward larger vocab (10–50k), fine for servers but not optimal for low-latency mobile inference.</p>\n  </li>\n  <li>\n    <p><strong>TensorRT-LLM</strong>: Optimized for NVIDIA GPUs with fused kernels and mixed-precision GEMMs, allowing large vocab sizes with minimal per-token penalty, especially when batching is used.</p>\n  </li>\n  <li>\n    <p><strong>vLLM</strong>: Uses advanced caching and continuous batching strategies on servers, mitigating large-vocab output projection costs, but still sees latency increases at very high <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-52-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-501\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-502\"><span class=\"mi\" id=\"MathJax-Span-503\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-52\">V</script>.</p>\n  </li>\n  <li>\n    <p><strong><code class=\"language-plaintext highlighter-rouge\">llama.cpp</code></strong>: Often run quantized on CPUs; vocab size affects KV cache read/write less than it affects output projection latency. Implements vocabulary lookups and output projection via cache-aware tiled GEMM in GGML to minimize L3 cache misses.</p>\n  </li>\n  <li>\n    <p><strong>LidarTLM</strong>: Frequently aggressively pruned vocab for ultra-low-power environments.</p>\n  </li>\n  <li>\n    <p><strong>MediaPipe + TFLite LLMs</strong>: For mobile/embedded devices, vocab size is often cut down to 4k–8k to meet NPU SRAM limits, with aggressive quantization applied to the embedding and projection layers.</p>\n  </li>\n  <li>\n    <p><strong>ONNX Runtime (CPU/NPU)</strong>: On CPU, large vocabularies can cause cache misses in the output projection; on NPU, unsupported large matrix ops may be forced to fall back to CPU, severely impacting latency.</p>\n  </li>\n</ul>\n<p><strong>NanoGPT</strong>: Tends toward larger vocab (10–50k), fine for servers but not optimal for low-latency mobile inference.</p>\n<p><strong>TensorRT-LLM</strong>: Optimized for NVIDIA GPUs with fused kernels and mixed-precision GEMMs, allowing large vocab sizes with minimal per-token penalty, especially when batching is used.</p>\n<p><strong>vLLM</strong>: Uses advanced caching and continuous batching strategies on servers, mitigating large-vocab output projection costs, but still sees latency increases at very high <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-52-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-501\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-502\"><span class=\"mi\" id=\"MathJax-Span-503\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-52\">V</script>.</p>\n<p><strong><code class=\"language-plaintext highlighter-rouge\">llama.cpp</code></strong>: Often run quantized on CPUs; vocab size affects KV cache read/write less than it affects output projection latency. Implements vocabulary lookups and output projection via cache-aware tiled GEMM in GGML to minimize L3 cache misses.</p>\n<p><strong>LidarTLM</strong>: Frequently aggressively pruned vocab for ultra-low-power environments.</p>\n<p><strong>MediaPipe + TFLite LLMs</strong>: For mobile/embedded devices, vocab size is often cut down to 4k–8k to meet NPU SRAM limits, with aggressive quantization applied to the embedding and projection layers.</p>\n<p><strong>ONNX Runtime (CPU/NPU)</strong>: On CPU, large vocabularies can cause cache misses in the output projection; on NPU, unsupported large matrix ops may be forced to fall back to CPU, severely impacting latency.</p>",
    "contentMarkdown": "*   A tokenizer converts raw text into discrete tokens that the model can process. The vocabulary size, denoted as VVV, represents the number of unique tokens the model can recognize. This parameter has several direct and indirect effects on transformer runtime.\n\n#### Impact on Embedding and Output Layers\n\n*   The embedding layer maps each token ID to a vector of size dmodeldmodeld\\_{\\\\text{model}} (the embedding dimension). The computational and memory cost of this layer is:\n    \n    *   **Parameter count:** Pembed\\=V×dmodelPembed\\=V×dmodelP\\_{\\\\text{embed}} = V \\\\times d\\_{\\\\text{model}}\n    *   **Memory footprint:** Proportional to PembedPembedP\\_{\\\\text{embed}}, typically stored in float16 or int8.\n    *   **Runtime:** At inference, the lookup cost is O(1)O(1)O(1) per token, but the softmax in the output layer is O(V)O(V)O(V) per token.\n*   The largest runtime penalty from a bigger vocabulary comes from the output projection and softmax. The final logits are computed via:\n    \n    zt\\=Woutht+bzt\\=Woutht+b\n    \n    z\\_t = W\\_{\\\\text{out}} h\\_t + b\n    *   where Wout∈ℝV×dmodelWout∈RV×dmodelW\\_{\\\\text{out}} \\\\in \\\\mathbb{R}^{V \\\\times d\\_{\\\\text{model}}}.\n*   This operation costs O(V⋅dmodel)O(V⋅dmodel)O(V \\\\cdot d\\_{\\\\text{model}}) per decoding step. For large VVV (e.g., 50k+), this can dominate single-token decode latency on CPUs or NPUs, especially when VVV exceeds cache size.\n    \n\nThe embedding layer maps each token ID to a vector of size dmodeldmodeld\\_{\\\\text{model}} (the embedding dimension). The computational and memory cost of this layer is:\n\n*   **Parameter count:** Pembed\\=V×dmodelPembed\\=V×dmodelP\\_{\\\\text{embed}} = V \\\\times d\\_{\\\\text{model}}\n*   **Memory footprint:** Proportional to PembedPembedP\\_{\\\\text{embed}}, typically stored in float16 or int8.\n*   **Runtime:** At inference, the lookup cost is O(1)O(1)O(1) per token, but the softmax in the output layer is O(V)O(V)O(V) per token.\n\nThe largest runtime penalty from a bigger vocabulary comes from the output projection and softmax. The final logits are computed via:\n\n*   where Wout∈ℝV×dmodelWout∈RV×dmodelW\\_{\\\\text{out}} \\\\in \\\\mathbb{R}^{V \\\\times d\\_{\\\\text{model}}}.\n\nThis operation costs O(V⋅dmodel)O(V⋅dmodel)O(V \\\\cdot d\\_{\\\\text{model}}) per decoding step. For large VVV (e.g., 50k+), this can dominate single-token decode latency on CPUs or NPUs, especially when VVV exceeds cache size.\n\n#### Tradeoffs of Vocabulary Size\n\n*   **Larger VVV**\n    \n    *   **Pros:** Fewer tokens per sentence (shorter sequences), potentially better language coverage.\n    *   **Cons:** Larger embedding and output layers, higher per-step cost, more memory bandwidth pressure.\n*   **Smaller VVV**\n    \n    *   **Pros:** Smaller parameter count, faster output projection, better fit for on-device constraints.\n    *   **Cons:** Longer sequences (more decoding steps), higher total attention cost O(n2⋅d)O(n2⋅d)O(n^2 \\\\cdot d) in prefill.\n*   There is a non-trivial sweet spot where the cost of the output softmax balances with the cost of processing longer sequences.\n    \n\n**Larger VVV**\n\n*   **Pros:** Fewer tokens per sentence (shorter sequences), potentially better language coverage.\n*   **Cons:** Larger embedding and output layers, higher per-step cost, more memory bandwidth pressure.\n\n**Smaller VVV**\n\n*   **Pros:** Smaller parameter count, faster output projection, better fit for on-device constraints.\n*   **Cons:** Longer sequences (more decoding steps), higher total attention cost O(n2⋅d)O(n2⋅d)O(n^2 \\\\cdot d) in prefill.\n\nThere is a non-trivial sweet spot where the cost of the output softmax balances with the cost of processing longer sequences.\n\n#### Runtime Context: Temperature vs. Vocabulary Size\n\n*   Note that temperature (as it relates to decoder sampling) affects randomness and diversity of outputs, but **does not impact FLOPs, memory bandwidth, or parameter count**. In contrast, vocabulary size directly changes the computational graph and memory access pattern at every generation step.\n    \n*   So in terms of runtime importance:\n    \n    *   **Vocabulary size is far more significant than temperature** for performance.\n    *   Temperature can be tuned freely without runtime cost, but vocabulary size needs to be fixed at training time.\n\nNote that temperature (as it relates to decoder sampling) affects randomness and diversity of outputs, but **does not impact FLOPs, memory bandwidth, or parameter count**. In contrast, vocabulary size directly changes the computational graph and memory access pattern at every generation step.\n\nSo in terms of runtime importance:\n\n*   **Vocabulary size is far more significant than temperature** for performance.\n*   Temperature can be tuned freely without runtime cost, but vocabulary size needs to be fixed at training time.\n\n#### Server vs. On-Device Considerations\n\n*   **Server-side (NanoGPT, TensorRT-LLM, vLLM, DeepSpeed-Inference)**: Large vocabularies are more tolerable since GPUs offer high-bandwidth memory (HBM) and Tensor Cores, which accelerate matrix-vector multiplies in the output layer. Softmax can be fused and batched.\n    \n*   **On-device (`llama.cpp`, LidarTLM, GGML, MediaPipe + TFLite, ONNX Runtime Mobile)**: Vocabulary size is a primary bottleneck, especially for NPUs or CPUs without fast GEMM acceleration for large matrices. LidarTLM, optimized for edge LiDAR transformers, often uses reduced vocabularies or subword schemes to minimize per-step cost.\n    \n\n**Server-side (NanoGPT, TensorRT-LLM, vLLM, DeepSpeed-Inference)**: Large vocabularies are more tolerable since GPUs offer high-bandwidth memory (HBM) and Tensor Cores, which accelerate matrix-vector multiplies in the output layer. Softmax can be fused and batched.\n\n**On-device (`llama.cpp`, LidarTLM, GGML, MediaPipe + TFLite, ONNX Runtime Mobile)**: Vocabulary size is a primary bottleneck, especially for NPUs or CPUs without fast GEMM acceleration for large matrices. LidarTLM, optimized for edge LiDAR transformers, often uses reduced vocabularies or subword schemes to minimize per-step cost.\n\n##### Runtime-Specific Notes\n\n*   **NanoGPT**: Tends toward larger vocab (10–50k), fine for servers but not optimal for low-latency mobile inference.\n    \n*   **TensorRT-LLM**: Optimized for NVIDIA GPUs with fused kernels and mixed-precision GEMMs, allowing large vocab sizes with minimal per-token penalty, especially when batching is used.\n    \n*   **vLLM**: Uses advanced caching and continuous batching strategies on servers, mitigating large-vocab output projection costs, but still sees latency increases at very high VVV.\n    \n*   **`llama.cpp`**: Often run quantized on CPUs; vocab size affects KV cache read/write less than it affects output projection latency. Implements vocabulary lookups and output projection via cache-aware tiled GEMM in GGML to minimize L3 cache misses.\n    \n*   **LidarTLM**: Frequently aggressively pruned vocab for ultra-low-power environments.\n    \n*   **MediaPipe + TFLite LLMs**: For mobile/embedded devices, vocab size is often cut down to 4k–8k to meet NPU SRAM limits, with aggressive quantization applied to the embedding and projection layers.\n    \n*   **ONNX Runtime (CPU/NPU)**: On CPU, large vocabularies can cause cache misses in the output projection; on NPU, unsupported large matrix ops may be forced to fall back to CPU, severely impacting latency.\n    \n\n**NanoGPT**: Tends toward larger vocab (10–50k), fine for servers but not optimal for low-latency mobile inference.\n\n**TensorRT-LLM**: Optimized for NVIDIA GPUs with fused kernels and mixed-precision GEMMs, allowing large vocab sizes with minimal per-token penalty, especially when batching is used.\n\n**vLLM**: Uses advanced caching and continuous batching strategies on servers, mitigating large-vocab output projection costs, but still sees latency increases at very high VVV.\n\n**`llama.cpp`**: Often run quantized on CPUs; vocab size affects KV cache read/write less than it affects output projection latency. Implements vocabulary lookups and output projection via cache-aware tiled GEMM in GGML to minimize L3 cache misses.\n\n**LidarTLM**: Frequently aggressively pruned vocab for ultra-low-power environments.\n\n**MediaPipe + TFLite LLMs**: For mobile/embedded devices, vocab size is often cut down to 4k–8k to meet NPU SRAM limits, with aggressive quantization applied to the embedding and projection layers.\n\n**ONNX Runtime (CPU/NPU)**: On CPU, large vocabularies can cause cache misses in the output projection; on NPU, unsupported large matrix ops may be forced to fall back to CPU, severely impacting latency.",
    "contentLength": 70745,
    "wordCount": 1154,
    "hasCode": true,
    "hasMath": true,
    "hasImages": false,
    "url": "https://aman.ai/primers/ai/on-device-transformers/#tokenizer-and-vocabulary-size"
  },
  {
    "id": "ai-on-device-transformers-modelembedding-dimension-23",
    "articleSlug": "on-device-transformers",
    "articleTitle": "On-device Transformers",
    "category": "On-Device AI",
    "chapter": "Parameter Choices and Their Runtime Implications in Transformer Architectures",
    "title": "Model/Embedding Dimension",
    "order": 23,
    "orderInChapter": 2,
    "contentHtml": "<ul>\n  <li>The model dimension (also called the “embedding dimension”), <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-53-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-504\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-505\"><span class=\"msubsup\" id=\"MathJax-Span-506\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-507\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-508\"><span class=\"mrow\" id=\"MathJax-Span-509\"><span class=\"mtext\" id=\"MathJax-Span-510\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-53\">d_{\\text{model}}</script>, determines the dimensionality of token embeddings and hidden states across the transformer.</li>\n  <li>The model dimension has a direct, predictable effect on runtime cost. Increasing the model dimension even slightly can push an on-device model from real-time to unusably slow since it appears in nearly every computational term in the architecture.</li>\n</ul>\n<h4 id=\"where-the-model-dimension-shows-up\">Where the Model Dimension Shows up</h4>\n<ul>\n  <li><strong>Embedding Layer:</strong>\n    <ul>\n      <li>Parameter count:</li>\n    </ul>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-54-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><msub><mi>P</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>embed</mtext></mrow></msub><mo>=</mo><mi>V</mi><mo>&amp;#x00D7;</mo><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-511\" style=\"width: 9.586em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 7.971em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1007.97em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-512\"><span class=\"msubsup\" id=\"MathJax-Span-513\"><span style=\"display: inline-block; position: relative; width: 2.555em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.63em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-514\" style=\"font-family: STIXGeneral-Italic;\">P</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.628em;\"><span class=\"texatom\" id=\"MathJax-Span-515\"><span class=\"mrow\" id=\"MathJax-Span-516\"><span class=\"mtext\" id=\"MathJax-Span-517\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">embed</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-518\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mi\" id=\"MathJax-Span-519\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-520\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">×</span><span class=\"msubsup\" id=\"MathJax-Span-521\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-522\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-523\"><span class=\"mrow\" id=\"MathJax-Span-524\"><span class=\"mtext\" id=\"MathJax-Span-525\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><msub><mi>P</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>embed</mtext></mrow></msub><mo>=</mo><mi>V</mi><mo>×</mo><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-54\">P_{\\text{embed}} = V \\times d_{\\text{model}}</script>\n\n    <ul>\n      <li>Memory bandwidth scales linearly with <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-55-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-526\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-527\"><span class=\"msubsup\" id=\"MathJax-Span-528\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-529\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-530\"><span class=\"mrow\" id=\"MathJax-Span-531\"><span class=\"mtext\" id=\"MathJax-Span-532\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-55\">d_{\\text{model}}</script> when loading embeddings.</li>\n    </ul>\n  </li>\n  <li><strong>Multi-Head Attention (MHA):</strong>\n    <ul>\n      <li>Each attention projection (<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-56-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>Q</mi><mo>,</mo><mi>K</mi><mo>,</mo><mi>V</mi><mo>,</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-533\" style=\"width: 4.169em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 3.44em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1003.39em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-534\"><span class=\"mi\" id=\"MathJax-Span-535\" style=\"font-family: STIXGeneral-Italic;\">Q</span><span class=\"mo\" id=\"MathJax-Span-536\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mi\" id=\"MathJax-Span-537\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.211em;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-538\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mi\" id=\"MathJax-Span-539\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.211em;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-540\" style=\"font-family: STIXGeneral-Regular;\">,</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>Q</mi><mo>,</mo><mi>K</mi><mo>,</mo><mi>V</mi><mo>,</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-56\">Q, K, V,</script> output) is a matrix multiply of shape <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-57-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>(</mo><mi>n</mi><mo>&amp;#x00D7;</mo><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub><mo stretchy=&quot;false&quot;>)</mo><mo>&amp;#x00D7;</mo><mo stretchy=&quot;false&quot;>(</mo><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub><mo>&amp;#x00D7;</mo><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>proj</mtext></mrow></msub><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-541\" style=\"width: 13.857em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 11.513em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1011.46em, 2.659em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-542\"><span class=\"mo\" id=\"MathJax-Span-543\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-544\" style=\"font-family: STIXGeneral-Italic;\">n</span><span class=\"mo\" id=\"MathJax-Span-545\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">×</span><span class=\"msubsup\" id=\"MathJax-Span-546\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-547\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-548\"><span class=\"mrow\" id=\"MathJax-Span-549\"><span class=\"mtext\" id=\"MathJax-Span-550\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-551\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-552\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">×</span><span class=\"mo\" id=\"MathJax-Span-553\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">(</span><span class=\"msubsup\" id=\"MathJax-Span-554\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-555\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-556\"><span class=\"mrow\" id=\"MathJax-Span-557\"><span class=\"mtext\" id=\"MathJax-Span-558\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-559\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">×</span><span class=\"msubsup\" id=\"MathJax-Span-560\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 1.721em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-561\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-562\"><span class=\"mrow\" id=\"MathJax-Span-563\"><span class=\"mtext\" id=\"MathJax-Span-564\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">proj</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-565\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.316em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mo stretchy=\"false\">(</mo><mi>n</mi><mo>×</mo><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub><mo stretchy=\"false\">)</mo><mo>×</mo><mo stretchy=\"false\">(</mo><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub><mo>×</mo><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>proj</mtext></mrow></msub><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-57\">(n \\times d_{\\text{model}}) \\times (d_{\\text{model}} \\times d_{\\text{proj}})</script>.</li>\n      <li>FLOPs per layer for MHA (excluding softmax):</li>\n    </ul>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-58-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><msup><mi>n</mi><mn>2</mn></msup><mo>&amp;#x22C5;</mo><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>head</mtext></mrow></msub><mo>&amp;#x22C5;</mo><mi>h</mi><mo stretchy=&quot;false&quot;>)</mo><mo>+</mo><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><mi>n</mi><mo>&amp;#x22C5;</mo><msubsup><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow><mn>2</mn></msubsup><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-566\" style=\"width: 15.576em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 12.971em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.201em, 1012.92em, 2.711em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-567\"><span class=\"mi\" id=\"MathJax-Span-568\" style=\"font-family: STIXGeneral-Italic;\">O</span><span class=\"mo\" id=\"MathJax-Span-569\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"msubsup\" id=\"MathJax-Span-570\"><span style=\"display: inline-block; position: relative; width: 0.94em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-571\" style=\"font-family: STIXGeneral-Italic;\">n</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.424em; left: 0.523em;\"><span class=\"mn\" id=\"MathJax-Span-572\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-573\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"msubsup\" id=\"MathJax-Span-574\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 1.93em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-575\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-576\"><span class=\"mrow\" id=\"MathJax-Span-577\"><span class=\"mtext\" id=\"MathJax-Span-578\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">head</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-579\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"mi\" id=\"MathJax-Span-580\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.263em;\">h</span><span class=\"mo\" id=\"MathJax-Span-581\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-582\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mi\" id=\"MathJax-Span-583\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.263em;\">O</span><span class=\"mo\" id=\"MathJax-Span-584\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-585\" style=\"font-family: STIXGeneral-Italic;\">n</span><span class=\"mo\" id=\"MathJax-Span-586\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"msubsup\" id=\"MathJax-Span-587\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-588\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1000.42em, 4.169em, -999.997em); top: -4.372em; left: 0.576em;\"><span class=\"mn\" id=\"MathJax-Span-589\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1001.83em, 4.169em, -999.997em); top: -3.695em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-590\"><span class=\"mrow\" id=\"MathJax-Span-591\"><span class=\"mtext\" id=\"MathJax-Span-592\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-593\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.566em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mi>O</mi><mo stretchy=\"false\">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo>⋅</mo><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>head</mtext></mrow></msub><mo>⋅</mo><mi>h</mi><mo stretchy=\"false\">)</mo><mo>+</mo><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo>⋅</mo><msubsup><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow><mn>2</mn></msubsup><mo stretchy=\"false\">)</mo></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-58\">O(n^2 \\cdot d_{\\text{head}} \\cdot h) + O(n \\cdot d_{\\text{model}}^2)</script>\n\n    <ul>\n      <li>Since <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-59-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>head</mtext></mrow></msub><mo>&amp;#x22C5;</mo><mi>h</mi><mo>=</mo><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-594\" style=\"width: 8.336em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 6.93em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1006.93em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-595\"><span class=\"msubsup\" id=\"MathJax-Span-596\"><span style=\"display: inline-block; position: relative; width: 1.93em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-597\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-598\"><span class=\"mrow\" id=\"MathJax-Span-599\"><span class=\"mtext\" id=\"MathJax-Span-600\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">head</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-601\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"mi\" id=\"MathJax-Span-602\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.263em;\">h</span><span class=\"mo\" id=\"MathJax-Span-603\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"msubsup\" id=\"MathJax-Span-604\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-605\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-606\"><span class=\"mrow\" id=\"MathJax-Span-607\"><span class=\"mtext\" id=\"MathJax-Span-608\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>head</mtext></mrow></msub><mo>⋅</mo><mi>h</mi><mo>=</mo><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-59\">d_{\\text{head}} \\cdot h = d_{\\text{model}}</script>, the cost scales as <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-60-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><msup><mi>n</mi><mn>2</mn></msup><mo>&amp;#x22C5;</mo><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-609\" style=\"width: 6.773em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 5.628em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.253em, 1005.58em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-610\"><span class=\"mi\" id=\"MathJax-Span-611\" style=\"font-family: STIXGeneral-Italic;\">O</span><span class=\"mo\" id=\"MathJax-Span-612\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"msubsup\" id=\"MathJax-Span-613\"><span style=\"display: inline-block; position: relative; width: 0.94em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-614\" style=\"font-family: STIXGeneral-Italic;\">n</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.372em; left: 0.523em;\"><span class=\"mn\" id=\"MathJax-Span-615\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-616\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"msubsup\" id=\"MathJax-Span-617\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-618\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-619\"><span class=\"mrow\" id=\"MathJax-Span-620\"><span class=\"mtext\" id=\"MathJax-Span-621\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-622\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.378em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>O</mi><mo stretchy=\"false\">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo>⋅</mo><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-60\">O(n^2 \\cdot d_{\\text{model}})</script> for attention scores and <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-61-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><mi>n</mi><mo>&amp;#x22C5;</mo><msubsup><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow><mn>2</mn></msubsup><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-623\" style=\"width: 6.253em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 5.211em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.253em, 1005.16em, 2.711em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-624\"><span class=\"mi\" id=\"MathJax-Span-625\" style=\"font-family: STIXGeneral-Italic;\">O</span><span class=\"mo\" id=\"MathJax-Span-626\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-627\" style=\"font-family: STIXGeneral-Italic;\">n</span><span class=\"mo\" id=\"MathJax-Span-628\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"msubsup\" id=\"MathJax-Span-629\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-630\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1000.42em, 4.169em, -999.997em); top: -4.372em; left: 0.576em;\"><span class=\"mn\" id=\"MathJax-Span-631\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1001.83em, 4.169em, -999.997em); top: -3.695em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-632\"><span class=\"mrow\" id=\"MathJax-Span-633\"><span class=\"mtext\" id=\"MathJax-Span-634\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-635\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.503em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo>⋅</mo><msubsup><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow><mn>2</mn></msubsup><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-61\">O(n \\cdot d_{\\text{model}}^2)</script> for projections.</li>\n    </ul>\n  </li>\n  <li><strong>Feedforward Network (FFN):</strong>\n    <ul>\n      <li>Uses intermediate size <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-62-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>ff</mtext></mrow></msub><mo>&amp;#x2248;</mo><mn>4</mn><mo>&amp;#x22C5;</mo><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-636\" style=\"width: 7.294em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 6.044em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1006.04em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-637\"><span class=\"msubsup\" id=\"MathJax-Span-638\"><span style=\"display: inline-block; position: relative; width: 1.044em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-639\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-640\"><span class=\"mrow\" id=\"MathJax-Span-641\"><span class=\"mtext\" id=\"MathJax-Span-642\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">ff</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-643\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">≈</span><span class=\"mn\" id=\"MathJax-Span-644\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">4</span><span class=\"mo\" id=\"MathJax-Span-645\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"msubsup\" id=\"MathJax-Span-646\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-647\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-648\"><span class=\"mrow\" id=\"MathJax-Span-649\"><span class=\"mtext\" id=\"MathJax-Span-650\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>ff</mtext></mrow></msub><mo>≈</mo><mn>4</mn><mo>⋅</mo><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-62\">d_{\\text{ff}} \\approx 4 \\cdot d_{\\text{model}}</script>.</li>\n      <li>Per layer FLOPs:</li>\n    </ul>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-63-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><mi>n</mi><mo>&amp;#x22C5;</mo><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub><mo>&amp;#x22C5;</mo><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>ff</mtext></mrow></msub><mo stretchy=&quot;false&quot;>)</mo><mo>&amp;#x2248;</mo><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><mi>n</mi><mo>&amp;#x22C5;</mo><msubsup><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow><mn>2</mn></msubsup><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-651\" style=\"width: 16.357em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 13.596em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.253em, 1013.54em, 2.711em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-652\"><span class=\"mi\" id=\"MathJax-Span-653\" style=\"font-family: STIXGeneral-Italic;\">O</span><span class=\"mo\" id=\"MathJax-Span-654\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-655\" style=\"font-family: STIXGeneral-Italic;\">n</span><span class=\"mo\" id=\"MathJax-Span-656\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"msubsup\" id=\"MathJax-Span-657\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-658\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-659\"><span class=\"mrow\" id=\"MathJax-Span-660\"><span class=\"mtext\" id=\"MathJax-Span-661\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-662\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"msubsup\" id=\"MathJax-Span-663\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 1.044em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-664\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-665\"><span class=\"mrow\" id=\"MathJax-Span-666\"><span class=\"mtext\" id=\"MathJax-Span-667\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">ff</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-668\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-669\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">≈</span><span class=\"mi\" id=\"MathJax-Span-670\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">O</span><span class=\"mo\" id=\"MathJax-Span-671\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-672\" style=\"font-family: STIXGeneral-Italic;\">n</span><span class=\"mo\" id=\"MathJax-Span-673\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"msubsup\" id=\"MathJax-Span-674\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-675\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1000.42em, 4.169em, -999.997em); top: -4.372em; left: 0.576em;\"><span class=\"mn\" id=\"MathJax-Span-676\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1001.83em, 4.169em, -999.997em); top: -3.695em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-677\"><span class=\"mrow\" id=\"MathJax-Span-678\"><span class=\"mtext\" id=\"MathJax-Span-679\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-680\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.503em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo>⋅</mo><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub><mo>⋅</mo><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>ff</mtext></mrow></msub><mo stretchy=\"false\">)</mo><mo>≈</mo><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo>⋅</mo><msubsup><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow><mn>2</mn></msubsup><mo stretchy=\"false\">)</mo></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-63\">O(n \\cdot d_{\\text{model}} \\cdot d_{\\text{ff}}) \\approx O(n \\cdot d_{\\text{model}}^2)</script>\n  </li>\n  <li>\n    <p><strong>Output Projection:</strong></p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-64-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><mi>V</mi><mo>&amp;#x22C5;</mo><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-681\" style=\"width: 6.565em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 5.471em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1005.42em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-682\"><span class=\"mi\" id=\"MathJax-Span-683\" style=\"font-family: STIXGeneral-Italic;\">O</span><span class=\"mo\" id=\"MathJax-Span-684\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-685\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-686\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"msubsup\" id=\"MathJax-Span-687\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-688\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-689\"><span class=\"mrow\" id=\"MathJax-Span-690\"><span class=\"mtext\" id=\"MathJax-Span-691\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-692\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mi>O</mi><mo stretchy=\"false\">(</mo><mi>V</mi><mo>⋅</mo><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub><mo stretchy=\"false\">)</mo></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-64\">O(V \\cdot d_{\\text{model}})</script>\n\n    <ul>\n      <li>This is where <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-65-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-693\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-694\"><span class=\"msubsup\" id=\"MathJax-Span-695\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-696\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-697\"><span class=\"mrow\" id=\"MathJax-Span-698\"><span class=\"mtext\" id=\"MathJax-Span-699\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-65\">d_{\\text{model}}</script> multiplies with vocab size effects (cf. <a href=\"#tokenizer-and-vocabulary-size\">Tokenizer and Vocabulary Size</a> section).</li>\n    </ul>\n  </li>\n</ul>\n<ul>\n      <li>Parameter count:</li>\n    </ul>\n<ul>\n      <li>Memory bandwidth scales linearly with <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-55-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-526\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-527\"><span class=\"msubsup\" id=\"MathJax-Span-528\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-529\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-530\"><span class=\"mrow\" id=\"MathJax-Span-531\"><span class=\"mtext\" id=\"MathJax-Span-532\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-55\">d_{\\text{model}}</script> when loading embeddings.</li>\n    </ul>\n<ul>\n      <li>Each attention projection (<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-56-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>Q</mi><mo>,</mo><mi>K</mi><mo>,</mo><mi>V</mi><mo>,</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-533\" style=\"width: 4.169em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 3.44em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1003.39em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-534\"><span class=\"mi\" id=\"MathJax-Span-535\" style=\"font-family: STIXGeneral-Italic;\">Q</span><span class=\"mo\" id=\"MathJax-Span-536\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mi\" id=\"MathJax-Span-537\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.211em;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-538\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mi\" id=\"MathJax-Span-539\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.211em;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-540\" style=\"font-family: STIXGeneral-Regular;\">,</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>Q</mi><mo>,</mo><mi>K</mi><mo>,</mo><mi>V</mi><mo>,</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-56\">Q, K, V,</script> output) is a matrix multiply of shape <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-57-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>(</mo><mi>n</mi><mo>&amp;#x00D7;</mo><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub><mo stretchy=&quot;false&quot;>)</mo><mo>&amp;#x00D7;</mo><mo stretchy=&quot;false&quot;>(</mo><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub><mo>&amp;#x00D7;</mo><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>proj</mtext></mrow></msub><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-541\" style=\"width: 13.857em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 11.513em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1011.46em, 2.659em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-542\"><span class=\"mo\" id=\"MathJax-Span-543\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-544\" style=\"font-family: STIXGeneral-Italic;\">n</span><span class=\"mo\" id=\"MathJax-Span-545\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">×</span><span class=\"msubsup\" id=\"MathJax-Span-546\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-547\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-548\"><span class=\"mrow\" id=\"MathJax-Span-549\"><span class=\"mtext\" id=\"MathJax-Span-550\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-551\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mo\" id=\"MathJax-Span-552\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">×</span><span class=\"mo\" id=\"MathJax-Span-553\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">(</span><span class=\"msubsup\" id=\"MathJax-Span-554\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-555\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-556\"><span class=\"mrow\" id=\"MathJax-Span-557\"><span class=\"mtext\" id=\"MathJax-Span-558\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-559\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">×</span><span class=\"msubsup\" id=\"MathJax-Span-560\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 1.721em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-561\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-562\"><span class=\"mrow\" id=\"MathJax-Span-563\"><span class=\"mtext\" id=\"MathJax-Span-564\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">proj</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-565\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.316em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mo stretchy=\"false\">(</mo><mi>n</mi><mo>×</mo><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub><mo stretchy=\"false\">)</mo><mo>×</mo><mo stretchy=\"false\">(</mo><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub><mo>×</mo><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>proj</mtext></mrow></msub><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-57\">(n \\times d_{\\text{model}}) \\times (d_{\\text{model}} \\times d_{\\text{proj}})</script>.</li>\n      <li>FLOPs per layer for MHA (excluding softmax):</li>\n    </ul>\n<ul>\n      <li>Since <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-59-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>head</mtext></mrow></msub><mo>&amp;#x22C5;</mo><mi>h</mi><mo>=</mo><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-594\" style=\"width: 8.336em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 6.93em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1006.93em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-595\"><span class=\"msubsup\" id=\"MathJax-Span-596\"><span style=\"display: inline-block; position: relative; width: 1.93em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-597\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-598\"><span class=\"mrow\" id=\"MathJax-Span-599\"><span class=\"mtext\" id=\"MathJax-Span-600\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">head</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-601\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"mi\" id=\"MathJax-Span-602\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.263em;\">h</span><span class=\"mo\" id=\"MathJax-Span-603\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"msubsup\" id=\"MathJax-Span-604\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-605\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-606\"><span class=\"mrow\" id=\"MathJax-Span-607\"><span class=\"mtext\" id=\"MathJax-Span-608\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>head</mtext></mrow></msub><mo>⋅</mo><mi>h</mi><mo>=</mo><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-59\">d_{\\text{head}} \\cdot h = d_{\\text{model}}</script>, the cost scales as <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-60-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><msup><mi>n</mi><mn>2</mn></msup><mo>&amp;#x22C5;</mo><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-609\" style=\"width: 6.773em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 5.628em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.253em, 1005.58em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-610\"><span class=\"mi\" id=\"MathJax-Span-611\" style=\"font-family: STIXGeneral-Italic;\">O</span><span class=\"mo\" id=\"MathJax-Span-612\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"msubsup\" id=\"MathJax-Span-613\"><span style=\"display: inline-block; position: relative; width: 0.94em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-614\" style=\"font-family: STIXGeneral-Italic;\">n</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.372em; left: 0.523em;\"><span class=\"mn\" id=\"MathJax-Span-615\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-616\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"msubsup\" id=\"MathJax-Span-617\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-618\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-619\"><span class=\"mrow\" id=\"MathJax-Span-620\"><span class=\"mtext\" id=\"MathJax-Span-621\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-622\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.378em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>O</mi><mo stretchy=\"false\">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo>⋅</mo><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-60\">O(n^2 \\cdot d_{\\text{model}})</script> for attention scores and <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-61-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><mi>n</mi><mo>&amp;#x22C5;</mo><msubsup><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow><mn>2</mn></msubsup><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-623\" style=\"width: 6.253em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 5.211em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.253em, 1005.16em, 2.711em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-624\"><span class=\"mi\" id=\"MathJax-Span-625\" style=\"font-family: STIXGeneral-Italic;\">O</span><span class=\"mo\" id=\"MathJax-Span-626\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-627\" style=\"font-family: STIXGeneral-Italic;\">n</span><span class=\"mo\" id=\"MathJax-Span-628\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"msubsup\" id=\"MathJax-Span-629\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-630\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1000.42em, 4.169em, -999.997em); top: -4.372em; left: 0.576em;\"><span class=\"mn\" id=\"MathJax-Span-631\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1001.83em, 4.169em, -999.997em); top: -3.695em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-632\"><span class=\"mrow\" id=\"MathJax-Span-633\"><span class=\"mtext\" id=\"MathJax-Span-634\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-635\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.503em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo>⋅</mo><msubsup><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow><mn>2</mn></msubsup><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-61\">O(n \\cdot d_{\\text{model}}^2)</script> for projections.</li>\n    </ul>\n<ul>\n      <li>Uses intermediate size <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-62-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>ff</mtext></mrow></msub><mo>&amp;#x2248;</mo><mn>4</mn><mo>&amp;#x22C5;</mo><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-636\" style=\"width: 7.294em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 6.044em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1006.04em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-637\"><span class=\"msubsup\" id=\"MathJax-Span-638\"><span style=\"display: inline-block; position: relative; width: 1.044em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-639\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-640\"><span class=\"mrow\" id=\"MathJax-Span-641\"><span class=\"mtext\" id=\"MathJax-Span-642\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">ff</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-643\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">≈</span><span class=\"mn\" id=\"MathJax-Span-644\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">4</span><span class=\"mo\" id=\"MathJax-Span-645\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"msubsup\" id=\"MathJax-Span-646\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-647\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-648\"><span class=\"mrow\" id=\"MathJax-Span-649\"><span class=\"mtext\" id=\"MathJax-Span-650\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>ff</mtext></mrow></msub><mo>≈</mo><mn>4</mn><mo>⋅</mo><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-62\">d_{\\text{ff}} \\approx 4 \\cdot d_{\\text{model}}</script>.</li>\n      <li>Per layer FLOPs:</li>\n    </ul>\n<p><strong>Output Projection:</strong></p>\n<ul>\n      <li>This is where <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-65-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-693\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-694\"><span class=\"msubsup\" id=\"MathJax-Span-695\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-696\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-697\"><span class=\"mrow\" id=\"MathJax-Span-698\"><span class=\"mtext\" id=\"MathJax-Span-699\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-65\">d_{\\text{model}}</script> multiplies with vocab size effects (cf. <a href=\"#tokenizer-and-vocabulary-size\">Tokenizer and Vocabulary Size</a> section).</li>\n    </ul>\n<h4 id=\"impact-on-the-kv-cache\">Impact on the KV Cache</h4>\n<ul>\n  <li>\n    <p>Increasing the model/embedding dimension <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-66-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-700\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-701\"><span class=\"msubsup\" id=\"MathJax-Span-702\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-703\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-704\"><span class=\"mrow\" id=\"MathJax-Span-705\"><span class=\"mtext\" id=\"MathJax-Span-706\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-66\">d_{\\text{model}}</script> linearly increases the size of the KV cache, which stores past attention states, and can quickly become a major driver of memory usage during inference.</p>\n  </li>\n  <li>\n    <p>During inference, each attention layer stores the <strong>Key</strong> (<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-67-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-707\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-708\"><span class=\"mi\" id=\"MathJax-Span-709\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-67\">K</script>) and <strong>Value</strong> (<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-68-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-710\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-711\"><span class=\"mi\" id=\"MathJax-Span-712\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-68\">V</script>) projections for every processed token in a <strong>KV cache</strong>, allowing the model to reuse past context without recomputing attention.</p>\n  </li>\n  <li>\n    <p>For a model with <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-69-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>h</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-713\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-714\"><span class=\"mi\" id=\"MathJax-Span-715\" style=\"font-family: STIXGeneral-Italic;\">h</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>h</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-69\">h</script> heads, head dimension <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-70-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>head</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-716\" style=\"width: 2.346em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.93em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1001.93em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-717\"><span class=\"msubsup\" id=\"MathJax-Span-718\"><span style=\"display: inline-block; position: relative; width: 1.93em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-719\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-720\"><span class=\"mrow\" id=\"MathJax-Span-721\"><span class=\"mtext\" id=\"MathJax-Span-722\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">head</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>head</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-70\">d_{\\text{head}}</script>, and embedding dimension <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-71-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub><mo>=</mo><mi>h</mi><mo>&amp;#x22C5;</mo><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>head</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-723\" style=\"width: 8.336em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 6.93em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1006.93em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-724\"><span class=\"msubsup\" id=\"MathJax-Span-725\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-726\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-727\"><span class=\"mrow\" id=\"MathJax-Span-728\"><span class=\"mtext\" id=\"MathJax-Span-729\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-730\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mi\" id=\"MathJax-Span-731\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">h</span><span class=\"mo\" id=\"MathJax-Span-732\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"msubsup\" id=\"MathJax-Span-733\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 1.93em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-734\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-735\"><span class=\"mrow\" id=\"MathJax-Span-736\"><span class=\"mtext\" id=\"MathJax-Span-737\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">head</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub><mo>=</mo><mi>h</mi><mo>⋅</mo><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>head</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-71\">d_{\\text{model}} = h \\cdot d_{\\text{head}}</script>, the KV cache size per token for a single layer is:</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-72-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>KV size per token</mtext><mo>=</mo><mn>2</mn><mo>&amp;#x00D7;</mo><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-738\" style=\"width: 14.846em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 12.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1012.35em, 2.555em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-739\"><span class=\"mtext\" id=\"MathJax-Span-740\" style=\"font-family: STIXGeneral-Regular;\">KV size per token</span><span class=\"mo\" id=\"MathJax-Span-741\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-742\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">2</span><span class=\"mo\" id=\"MathJax-Span-743\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">×</span><span class=\"msubsup\" id=\"MathJax-Span-744\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-745\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-746\"><span class=\"mrow\" id=\"MathJax-Span-747\"><span class=\"mtext\" id=\"MathJax-Span-748\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>KV size per token</mtext><mo>=</mo><mn>2</mn><mo>×</mo><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-72\">\\text{KV size per token} = 2 \\times d_{\\text{model}}</script>\n\n    <ul>\n      <li>where, the factor of 2 accounts for storing both <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-73-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-749\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-750\"><span class=\"mi\" id=\"MathJax-Span-751\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-73\">K</script> and <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-74-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-752\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-753\"><span class=\"mi\" id=\"MathJax-Span-754\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-74\">V</script>.</li>\n    </ul>\n  </li>\n  <li>\n    <p>For a sequence of length <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-75-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>n</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-755\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-756\"><span class=\"mi\" id=\"MathJax-Span-757\" style=\"font-family: STIXGeneral-Italic;\">n</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>n</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-75\">n</script> and <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-76-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-758\" style=\"width: 0.784em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.63em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-759\"><span class=\"mi\" id=\"MathJax-Span-760\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>L</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-76\">L</script> transformer layers, the total KV cache size is:</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-77-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>Total KV memory</mtext><mo>=</mo><mi>L</mi><mo>&amp;#x00D7;</mo><mi>n</mi><mo>&amp;#x00D7;</mo><mn>2</mn><mo>&amp;#x00D7;</mo><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub><mo>&amp;#x00D7;</mo><mtext>sizeof(dtype)</mtext></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-761\" style=\"width: 26.513em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 22.086em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1022.03em, 2.555em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-762\"><span class=\"mtext\" id=\"MathJax-Span-763\" style=\"font-family: STIXGeneral-Regular;\">Total KV memory</span><span class=\"mo\" id=\"MathJax-Span-764\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mi\" id=\"MathJax-Span-765\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-766\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">×</span><span class=\"mi\" id=\"MathJax-Span-767\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.263em;\">n</span><span class=\"mo\" id=\"MathJax-Span-768\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">×</span><span class=\"mn\" id=\"MathJax-Span-769\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">2</span><span class=\"mo\" id=\"MathJax-Span-770\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">×</span><span class=\"msubsup\" id=\"MathJax-Span-771\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-772\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-773\"><span class=\"mrow\" id=\"MathJax-Span-774\"><span class=\"mtext\" id=\"MathJax-Span-775\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-776\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">×</span><span class=\"mtext\" id=\"MathJax-Span-777\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">sizeof(dtype)</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mtext>Total KV memory</mtext><mo>=</mo><mi>L</mi><mo>×</mo><mi>n</mi><mo>×</mo><mn>2</mn><mo>×</mo><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub><mo>×</mo><mtext>sizeof(dtype)</mtext></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-77\">\\text{Total KV memory} = L \\times n \\times 2 \\times d_{\\text{model}} \\times \\text{sizeof(dtype)}</script>\n  </li>\n  <li>\n    <p><strong>Why this grows with <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-78-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-778\" style=\"width: 2.843em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.327em; height: 0px; font-size: 121%;\"><span style=\"position: absolute; clip: rect(1.294em, 1002.33em, 2.43em, -999.997em); top: -2.115em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-779\"><span class=\"msubsup\" id=\"MathJax-Span-780\"><span style=\"display: inline-block; position: relative; width: 2.327em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.153em, 1000.52em, 4.135em, -999.997em); top: -3.975em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-781\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.054em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 3.98em;\"></span></span><span style=\"position: absolute; top: -3.82em; left: 0.519em;\"><span class=\"texatom\" id=\"MathJax-Span-782\"><span class=\"mrow\" id=\"MathJax-Span-783\"><span class=\"mtext\" id=\"MathJax-Span-784\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 3.98em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.12em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-78\">d_{\\text{model}}</script>:</strong></p>\n\n    <ul>\n      <li>Both <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-79-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-785\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-786\"><span class=\"mi\" id=\"MathJax-Span-787\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-79\">K</script> and <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-80-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-788\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-789\"><span class=\"mi\" id=\"MathJax-Span-790\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-80\">V</script> vectors have dimensionality <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-81-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-791\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-792\"><span class=\"msubsup\" id=\"MathJax-Span-793\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-794\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-795\"><span class=\"mrow\" id=\"MathJax-Span-796\"><span class=\"mtext\" id=\"MathJax-Span-797\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-81\">d_{\\text{model}}</script>, so increasing <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-82-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-798\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-799\"><span class=\"msubsup\" id=\"MathJax-Span-800\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-801\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-802\"><span class=\"mrow\" id=\"MathJax-Span-803\"><span class=\"mtext\" id=\"MathJax-Span-804\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-82\">d_{\\text{model}}</script> directly increases the number of stored values per token.</li>\n      <li>The growth is <strong>linear</strong> with respect to <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-83-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-805\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-806\"><span class=\"msubsup\" id=\"MathJax-Span-807\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-808\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-809\"><span class=\"mrow\" id=\"MathJax-Span-810\"><span class=\"mtext\" id=\"MathJax-Span-811\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-83\">d_{\\text{model}}</script>, but multiplicative with <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-84-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>n</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-812\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-813\"><span class=\"mi\" id=\"MathJax-Span-814\" style=\"font-family: STIXGeneral-Italic;\">n</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>n</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-84\">n</script> and <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-85-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-815\" style=\"width: 0.784em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.63em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-816\"><span class=\"mi\" id=\"MathJax-Span-817\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>L</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-85\">L</script>.</li>\n      <li>This means that even modest increases in <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-86-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-818\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-819\"><span class=\"msubsup\" id=\"MathJax-Span-820\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-821\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-822\"><span class=\"mrow\" id=\"MathJax-Span-823\"><span class=\"mtext\" id=\"MathJax-Span-824\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-86\">d_{\\text{model}}</script> can cause large jumps in memory usage for long sequences or deep networks.</li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Practical implications:</strong></p>\n\n    <ul>\n      <li>Larger <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-87-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-825\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-826\"><span class=\"msubsup\" id=\"MathJax-Span-827\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-828\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-829\"><span class=\"mrow\" id=\"MathJax-Span-830\"><span class=\"mtext\" id=\"MathJax-Span-831\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-87\">d_{\\text{model}}</script> means more memory bandwidth required to read/write the KV cache, which can bottleneck inference.</li>\n      <li>On memory-limited devices, KV cache capacity often becomes the limiting factor before compute throughput does.</li>\n    </ul>\n  </li>\n</ul>\n<p>Increasing the model/embedding dimension <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-66-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-700\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-701\"><span class=\"msubsup\" id=\"MathJax-Span-702\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-703\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-704\"><span class=\"mrow\" id=\"MathJax-Span-705\"><span class=\"mtext\" id=\"MathJax-Span-706\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-66\">d_{\\text{model}}</script> linearly increases the size of the KV cache, which stores past attention states, and can quickly become a major driver of memory usage during inference.</p>\n<p>During inference, each attention layer stores the <strong>Key</strong> (<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-67-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-707\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-708\"><span class=\"mi\" id=\"MathJax-Span-709\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-67\">K</script>) and <strong>Value</strong> (<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-68-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-710\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-711\"><span class=\"mi\" id=\"MathJax-Span-712\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-68\">V</script>) projections for every processed token in a <strong>KV cache</strong>, allowing the model to reuse past context without recomputing attention.</p>\n<p>For a model with <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-69-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>h</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-713\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-714\"><span class=\"mi\" id=\"MathJax-Span-715\" style=\"font-family: STIXGeneral-Italic;\">h</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>h</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-69\">h</script> heads, head dimension <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-70-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>head</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-716\" style=\"width: 2.346em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.93em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1001.93em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-717\"><span class=\"msubsup\" id=\"MathJax-Span-718\"><span style=\"display: inline-block; position: relative; width: 1.93em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-719\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-720\"><span class=\"mrow\" id=\"MathJax-Span-721\"><span class=\"mtext\" id=\"MathJax-Span-722\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">head</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>head</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-70\">d_{\\text{head}}</script>, and embedding dimension <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-71-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub><mo>=</mo><mi>h</mi><mo>&amp;#x22C5;</mo><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>head</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-723\" style=\"width: 8.336em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 6.93em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1006.93em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-724\"><span class=\"msubsup\" id=\"MathJax-Span-725\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-726\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-727\"><span class=\"mrow\" id=\"MathJax-Span-728\"><span class=\"mtext\" id=\"MathJax-Span-729\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-730\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mi\" id=\"MathJax-Span-731\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">h</span><span class=\"mo\" id=\"MathJax-Span-732\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"msubsup\" id=\"MathJax-Span-733\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 1.93em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-734\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-735\"><span class=\"mrow\" id=\"MathJax-Span-736\"><span class=\"mtext\" id=\"MathJax-Span-737\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">head</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub><mo>=</mo><mi>h</mi><mo>⋅</mo><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>head</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-71\">d_{\\text{model}} = h \\cdot d_{\\text{head}}</script>, the KV cache size per token for a single layer is:</p>\n<ul>\n      <li>where, the factor of 2 accounts for storing both <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-73-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-749\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-750\"><span class=\"mi\" id=\"MathJax-Span-751\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-73\">K</script> and <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-74-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-752\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-753\"><span class=\"mi\" id=\"MathJax-Span-754\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-74\">V</script>.</li>\n    </ul>\n<p>For a sequence of length <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-75-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>n</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-755\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-756\"><span class=\"mi\" id=\"MathJax-Span-757\" style=\"font-family: STIXGeneral-Italic;\">n</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>n</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-75\">n</script> and <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-76-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-758\" style=\"width: 0.784em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.63em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-759\"><span class=\"mi\" id=\"MathJax-Span-760\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>L</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-76\">L</script> transformer layers, the total KV cache size is:</p>\n<p><strong>Why this grows with <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-78-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-778\" style=\"width: 2.843em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.327em; height: 0px; font-size: 121%;\"><span style=\"position: absolute; clip: rect(1.294em, 1002.33em, 2.43em, -999.997em); top: -2.115em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-779\"><span class=\"msubsup\" id=\"MathJax-Span-780\"><span style=\"display: inline-block; position: relative; width: 2.327em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.153em, 1000.52em, 4.135em, -999.997em); top: -3.975em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-781\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.054em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 3.98em;\"></span></span><span style=\"position: absolute; top: -3.82em; left: 0.519em;\"><span class=\"texatom\" id=\"MathJax-Span-782\"><span class=\"mrow\" id=\"MathJax-Span-783\"><span class=\"mtext\" id=\"MathJax-Span-784\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 3.98em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.12em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-78\">d_{\\text{model}}</script>:</strong></p>\n<ul>\n      <li>Both <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-79-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-785\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-786\"><span class=\"mi\" id=\"MathJax-Span-787\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-79\">K</script> and <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-80-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-788\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-789\"><span class=\"mi\" id=\"MathJax-Span-790\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-80\">V</script> vectors have dimensionality <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-81-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-791\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-792\"><span class=\"msubsup\" id=\"MathJax-Span-793\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-794\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-795\"><span class=\"mrow\" id=\"MathJax-Span-796\"><span class=\"mtext\" id=\"MathJax-Span-797\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-81\">d_{\\text{model}}</script>, so increasing <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-82-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-798\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-799\"><span class=\"msubsup\" id=\"MathJax-Span-800\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-801\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-802\"><span class=\"mrow\" id=\"MathJax-Span-803\"><span class=\"mtext\" id=\"MathJax-Span-804\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-82\">d_{\\text{model}}</script> directly increases the number of stored values per token.</li>\n      <li>The growth is <strong>linear</strong> with respect to <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-83-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-805\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-806\"><span class=\"msubsup\" id=\"MathJax-Span-807\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-808\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-809\"><span class=\"mrow\" id=\"MathJax-Span-810\"><span class=\"mtext\" id=\"MathJax-Span-811\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-83\">d_{\\text{model}}</script>, but multiplicative with <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-84-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>n</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-812\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-813\"><span class=\"mi\" id=\"MathJax-Span-814\" style=\"font-family: STIXGeneral-Italic;\">n</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>n</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-84\">n</script> and <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-85-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-815\" style=\"width: 0.784em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.63em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-816\"><span class=\"mi\" id=\"MathJax-Span-817\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>L</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-85\">L</script>.</li>\n      <li>This means that even modest increases in <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-86-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-818\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-819\"><span class=\"msubsup\" id=\"MathJax-Span-820\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-821\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-822\"><span class=\"mrow\" id=\"MathJax-Span-823\"><span class=\"mtext\" id=\"MathJax-Span-824\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-86\">d_{\\text{model}}</script> can cause large jumps in memory usage for long sequences or deep networks.</li>\n    </ul>\n<p><strong>Practical implications:</strong></p>\n<ul>\n      <li>Larger <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-87-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-825\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-826\"><span class=\"msubsup\" id=\"MathJax-Span-827\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-828\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-829\"><span class=\"mrow\" id=\"MathJax-Span-830\"><span class=\"mtext\" id=\"MathJax-Span-831\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-87\">d_{\\text{model}}</script> means more memory bandwidth required to read/write the KV cache, which can bottleneck inference.</li>\n      <li>On memory-limited devices, KV cache capacity often becomes the limiting factor before compute throughput does.</li>\n    </ul>\n<h4 id=\"runtime-and-memory-effects\">Runtime and Memory Effects</h4>\n<ul>\n  <li>\n    <p><strong>Larger Model Dimension:</strong></p>\n\n    <ul>\n      <li><strong>Pros:</strong> More capacity per token, better representation quality, higher perplexity performance.</li>\n      <li><strong>Cons:</strong> Quadratic or linear increase in FLOPs for most layers, large memory footprint, higher activation size in KV cache.</li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Smaller Model Dimension:</strong></p>\n\n    <ul>\n      <li><strong>Pros:</strong> Smaller models, faster inference, better suited for edge devices.</li>\n      <li><strong>Cons:</strong> Lower expressive power; can bottleneck performance before parameter count is reached.</li>\n    </ul>\n  </li>\n</ul>\n<p><strong>Larger Model Dimension:</strong></p>\n<ul>\n      <li><strong>Pros:</strong> More capacity per token, better representation quality, higher perplexity performance.</li>\n      <li><strong>Cons:</strong> Quadratic or linear increase in FLOPs for most layers, large memory footprint, higher activation size in KV cache.</li>\n    </ul>\n<p><strong>Smaller Model Dimension:</strong></p>\n<ul>\n      <li><strong>Pros:</strong> Smaller models, faster inference, better suited for edge devices.</li>\n      <li><strong>Cons:</strong> Lower expressive power; can bottleneck performance before parameter count is reached.</li>\n    </ul>\n<h4 id=\"interaction-with-sequence-length\">Interaction with Sequence Length</h4>\n<ul>\n  <li>While increasing the model dimension linearly scales memory and compute in most layers, attention score calculation (<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-88-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><msup><mi>n</mi><mn>2</mn></msup><mo>&amp;#x22C5;</mo><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-832\" style=\"width: 6.773em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 5.628em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.253em, 1005.58em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-833\"><span class=\"mi\" id=\"MathJax-Span-834\" style=\"font-family: STIXGeneral-Italic;\">O</span><span class=\"mo\" id=\"MathJax-Span-835\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"msubsup\" id=\"MathJax-Span-836\"><span style=\"display: inline-block; position: relative; width: 0.94em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-837\" style=\"font-family: STIXGeneral-Italic;\">n</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.372em; left: 0.523em;\"><span class=\"mn\" id=\"MathJax-Span-838\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-839\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"msubsup\" id=\"MathJax-Span-840\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-841\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-842\"><span class=\"mrow\" id=\"MathJax-Span-843\"><span class=\"mtext\" id=\"MathJax-Span-844\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-845\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.378em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>O</mi><mo stretchy=\"false\">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo>⋅</mo><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-88\">O(n^2 \\cdot d_{\\text{model}})</script>) means that with long sequences, the impact of <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-89-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-846\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-847\"><span class=\"msubsup\" id=\"MathJax-Span-848\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-849\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-850\"><span class=\"mrow\" id=\"MathJax-Span-851\"><span class=\"mtext\" id=\"MathJax-Span-852\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-89\">d_{\\text{model}}</script> is amplified.</li>\n</ul>\n<h4 id=\"server-vs-on-device\">Server vs. On-Device</h4>\n<ul>\n  <li><strong>Server (NanoGPT, TensorRT-LLM, vLLM, DeepSpeed-Inference):</strong>\n    <ul>\n      <li>Can afford larger <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-90-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-853\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-854\"><span class=\"msubsup\" id=\"MathJax-Span-855\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-856\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-857\"><span class=\"mrow\" id=\"MathJax-Span-858\"><span class=\"mtext\" id=\"MathJax-Span-859\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-90\">d_{\\text{model}}</script> (e.g., 2048+) due to GPU tensor cores and high-bandwidth memory. The main tradeoff is training/inference cost, not latency.</li>\n      <li>TensorRT-LLM uses fused attention kernels and mixed-precision GEMMs to sustain high throughput at large <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-91-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-860\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-861\"><span class=\"msubsup\" id=\"MathJax-Span-862\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-863\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-864\"><span class=\"mrow\" id=\"MathJax-Span-865\"><span class=\"mtext\" id=\"MathJax-Span-866\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-91\">d_{\\text{model}}</script>, while vLLM and DeepSpeed-Inference can overlap compute and memory ops to mask latency.</li>\n    </ul>\n  </li>\n  <li><strong>On-Device (llama.cpp, GGML, ONNX Runtime Mobile):</strong>\n    <ul>\n      <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-92-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-867\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-868\"><span class=\"msubsup\" id=\"MathJax-Span-869\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-870\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-871\"><span class=\"mrow\" id=\"MathJax-Span-872\"><span class=\"mtext\" id=\"MathJax-Span-873\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-92\">d_{\\text{model}}</script> needs to be small enough to fit activations and KV cache in available RAM/LLC. Even quantized models struggle if <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-93-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-874\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-875\"><span class=\"msubsup\" id=\"MathJax-Span-876\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-877\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-878\"><span class=\"mrow\" id=\"MathJax-Span-879\"><span class=\"mtext\" id=\"MathJax-Span-880\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-93\">d_{\\text{model}}</script> &gt; 1024 on low-end CPUs.</li>\n      <li><code class=\"language-plaintext highlighter-rouge\">llama.cpp</code> and GGML use block-quantized matrix multiplies to reduce memory footprint, while ONNX Runtime Mobile leverages kernel fusion for small <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-94-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-881\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-882\"><span class=\"msubsup\" id=\"MathJax-Span-883\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-884\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-885\"><span class=\"mrow\" id=\"MathJax-Span-886\"><span class=\"mtext\" id=\"MathJax-Span-887\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-94\">d_{\\text{model}}</script> efficiency.</li>\n    </ul>\n  </li>\n  <li><strong>Edge-specialized (LidarTLM, MediaPipe + TFLite, Qualcomm AI Stack):</strong>\n    <ul>\n      <li>Often uses <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-95-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-888\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-889\"><span class=\"msubsup\" id=\"MathJax-Span-890\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-891\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-892\"><span class=\"mrow\" id=\"MathJax-Span-893\"><span class=\"mtext\" id=\"MathJax-Span-894\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-95\">d_{\\text{model}}</script> = 256–512 for real-time inference in sensor fusion pipelines, balancing compute with strict power envelopes.</li>\n      <li>MediaPipe + TFLite models targeting NPUs frequently compress <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-96-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-895\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-896\"><span class=\"msubsup\" id=\"MathJax-Span-897\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-898\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-899\"><span class=\"mrow\" id=\"MathJax-Span-900\"><span class=\"mtext\" id=\"MathJax-Span-901\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-96\">d_{\\text{model}}</script> to fit SRAM, while the Qualcomm AI Stack uses <code class=\"language-plaintext highlighter-rouge\">int8</code>/<code class=\"language-plaintext highlighter-rouge\">float16</code> hybrid kernels to keep latency under frame-time budgets.</li>\n    </ul>\n  </li>\n</ul>\n<ul>\n      <li>Can afford larger <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-90-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-853\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-854\"><span class=\"msubsup\" id=\"MathJax-Span-855\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-856\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-857\"><span class=\"mrow\" id=\"MathJax-Span-858\"><span class=\"mtext\" id=\"MathJax-Span-859\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-90\">d_{\\text{model}}</script> (e.g., 2048+) due to GPU tensor cores and high-bandwidth memory. The main tradeoff is training/inference cost, not latency.</li>\n      <li>TensorRT-LLM uses fused attention kernels and mixed-precision GEMMs to sustain high throughput at large <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-91-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-860\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-861\"><span class=\"msubsup\" id=\"MathJax-Span-862\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-863\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-864\"><span class=\"mrow\" id=\"MathJax-Span-865\"><span class=\"mtext\" id=\"MathJax-Span-866\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-91\">d_{\\text{model}}</script>, while vLLM and DeepSpeed-Inference can overlap compute and memory ops to mask latency.</li>\n    </ul>\n<ul>\n      <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-92-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-867\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-868\"><span class=\"msubsup\" id=\"MathJax-Span-869\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-870\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-871\"><span class=\"mrow\" id=\"MathJax-Span-872\"><span class=\"mtext\" id=\"MathJax-Span-873\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-92\">d_{\\text{model}}</script> needs to be small enough to fit activations and KV cache in available RAM/LLC. Even quantized models struggle if <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-93-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-874\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-875\"><span class=\"msubsup\" id=\"MathJax-Span-876\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-877\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-878\"><span class=\"mrow\" id=\"MathJax-Span-879\"><span class=\"mtext\" id=\"MathJax-Span-880\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-93\">d_{\\text{model}}</script> &gt; 1024 on low-end CPUs.</li>\n      <li><code class=\"language-plaintext highlighter-rouge\">llama.cpp</code> and GGML use block-quantized matrix multiplies to reduce memory footprint, while ONNX Runtime Mobile leverages kernel fusion for small <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-94-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-881\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-882\"><span class=\"msubsup\" id=\"MathJax-Span-883\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-884\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-885\"><span class=\"mrow\" id=\"MathJax-Span-886\"><span class=\"mtext\" id=\"MathJax-Span-887\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-94\">d_{\\text{model}}</script> efficiency.</li>\n    </ul>\n<ul>\n      <li>Often uses <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-95-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-888\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-889\"><span class=\"msubsup\" id=\"MathJax-Span-890\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-891\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-892\"><span class=\"mrow\" id=\"MathJax-Span-893\"><span class=\"mtext\" id=\"MathJax-Span-894\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-95\">d_{\\text{model}}</script> = 256–512 for real-time inference in sensor fusion pipelines, balancing compute with strict power envelopes.</li>\n      <li>MediaPipe + TFLite models targeting NPUs frequently compress <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-96-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-895\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-896\"><span class=\"msubsup\" id=\"MathJax-Span-897\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-898\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-899\"><span class=\"mrow\" id=\"MathJax-Span-900\"><span class=\"mtext\" id=\"MathJax-Span-901\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-96\">d_{\\text{model}}</script> to fit SRAM, while the Qualcomm AI Stack uses <code class=\"language-plaintext highlighter-rouge\">int8</code>/<code class=\"language-plaintext highlighter-rouge\">float16</code> hybrid kernels to keep latency under frame-time budgets.</li>\n    </ul>",
    "contentMarkdown": "*   The model dimension (also called the “embedding dimension”), dmodeldmodeld\\_{\\\\text{model}}, determines the dimensionality of token embeddings and hidden states across the transformer.\n*   The model dimension has a direct, predictable effect on runtime cost. Increasing the model dimension even slightly can push an on-device model from real-time to unusably slow since it appears in nearly every computational term in the architecture.\n\n#### Where the Model Dimension Shows up\n\n*   **Embedding Layer:**\n    \n    *   Parameter count:\n    \n    Pembed\\=V×dmodelPembed\\=V×dmodel\n    \n    P\\_{\\\\text{embed}} = V \\\\times d\\_{\\\\text{model}}\n    *   Memory bandwidth scales linearly with dmodeldmodeld\\_{\\\\text{model}} when loading embeddings.\n*   **Multi-Head Attention (MHA):**\n    \n    *   Each attention projection (Q,K,V,Q,K,V,Q, K, V, output) is a matrix multiply of shape (n×dmodel)×(dmodel×dproj)(n×dmodel)×(dmodel×dproj)(n \\\\times d\\_{\\\\text{model}}) \\\\times (d\\_{\\\\text{model}} \\\\times d\\_{\\\\text{proj}}).\n    *   FLOPs per layer for MHA (excluding softmax):\n    \n    O(n2⋅dhead⋅h)+O(n⋅d2model)O(n2⋅dhead⋅h)+O(n⋅dmodel2)\n    \n    O(n^2 \\\\cdot d\\_{\\\\text{head}} \\\\cdot h) + O(n \\\\cdot d\\_{\\\\text{model}}^2)\n    *   Since dhead⋅h\\=dmodeldhead⋅h\\=dmodeld\\_{\\\\text{head}} \\\\cdot h = d\\_{\\\\text{model}}, the cost scales as O(n2⋅dmodel)O(n2⋅dmodel)O(n^2 \\\\cdot d\\_{\\\\text{model}}) for attention scores and O(n⋅d2model)O(n⋅dmodel2)O(n \\\\cdot d\\_{\\\\text{model}}^2) for projections.\n*   **Feedforward Network (FFN):**\n    \n    *   Uses intermediate size dff≈4⋅dmodeldff≈4⋅dmodeld\\_{\\\\text{ff}} \\\\approx 4 \\\\cdot d\\_{\\\\text{model}}.\n    *   Per layer FLOPs:\n    \n    O(n⋅dmodel⋅dff)≈O(n⋅d2model)O(n⋅dmodel⋅dff)≈O(n⋅dmodel2)\n    \n    O(n \\\\cdot d\\_{\\\\text{model}} \\\\cdot d\\_{\\\\text{ff}}) \\\\approx O(n \\\\cdot d\\_{\\\\text{model}}^2)\n*   **Output Projection:**\n    \n    O(V⋅dmodel)O(V⋅dmodel)\n    \n    O(V \\\\cdot d\\_{\\\\text{model}})\n    *   This is where dmodeldmodeld\\_{\\\\text{model}} multiplies with vocab size effects (cf. [Tokenizer and Vocabulary Size](#tokenizer-and-vocabulary-size) section).\n\n*   Parameter count:\n\n*   Memory bandwidth scales linearly with dmodeldmodeld\\_{\\\\text{model}} when loading embeddings.\n\n*   Each attention projection (Q,K,V,Q,K,V,Q, K, V, output) is a matrix multiply of shape (n×dmodel)×(dmodel×dproj)(n×dmodel)×(dmodel×dproj)(n \\\\times d\\_{\\\\text{model}}) \\\\times (d\\_{\\\\text{model}} \\\\times d\\_{\\\\text{proj}}).\n*   FLOPs per layer for MHA (excluding softmax):\n\n*   Since dhead⋅h\\=dmodeldhead⋅h\\=dmodeld\\_{\\\\text{head}} \\\\cdot h = d\\_{\\\\text{model}}, the cost scales as O(n2⋅dmodel)O(n2⋅dmodel)O(n^2 \\\\cdot d\\_{\\\\text{model}}) for attention scores and O(n⋅d2model)O(n⋅dmodel2)O(n \\\\cdot d\\_{\\\\text{model}}^2) for projections.\n\n*   Uses intermediate size dff≈4⋅dmodeldff≈4⋅dmodeld\\_{\\\\text{ff}} \\\\approx 4 \\\\cdot d\\_{\\\\text{model}}.\n*   Per layer FLOPs:\n\n**Output Projection:**\n\n*   This is where dmodeldmodeld\\_{\\\\text{model}} multiplies with vocab size effects (cf. [Tokenizer and Vocabulary Size](#tokenizer-and-vocabulary-size) section).\n\n#### Impact on the KV Cache\n\n*   Increasing the model/embedding dimension dmodeldmodeld\\_{\\\\text{model}} linearly increases the size of the KV cache, which stores past attention states, and can quickly become a major driver of memory usage during inference.\n    \n*   During inference, each attention layer stores the **Key** (KKK) and **Value** (VVV) projections for every processed token in a **KV cache**, allowing the model to reuse past context without recomputing attention.\n    \n*   For a model with hhh heads, head dimension dheaddheadd\\_{\\\\text{head}}, and embedding dimension dmodel\\=h⋅dheaddmodel\\=h⋅dheadd\\_{\\\\text{model}} = h \\\\cdot d\\_{\\\\text{head}}, the KV cache size per token for a single layer is:\n    \n    KV size per token\\=2×dmodelKV size per token\\=2×dmodel\n    \n    \\\\text{KV size per token} = 2 \\\\times d\\_{\\\\text{model}}\n    *   where, the factor of 2 accounts for storing both KKK and VVV.\n*   For a sequence of length nnn and LLL transformer layers, the total KV cache size is:\n    \n    Total KV memory\\=L×n×2×dmodel×sizeof(dtype)Total KV memory\\=L×n×2×dmodel×sizeof(dtype)\n    \n    \\\\text{Total KV memory} = L \\\\times n \\\\times 2 \\\\times d\\_{\\\\text{model}} \\\\times \\\\text{sizeof(dtype)}\n*   **Why this grows with dmodeldmodeld\\_{\\\\text{model}}:**\n    \n    *   Both KKK and VVV vectors have dimensionality dmodeldmodeld\\_{\\\\text{model}}, so increasing dmodeldmodeld\\_{\\\\text{model}} directly increases the number of stored values per token.\n    *   The growth is **linear** with respect to dmodeldmodeld\\_{\\\\text{model}}, but multiplicative with nnn and LLL.\n    *   This means that even modest increases in dmodeldmodeld\\_{\\\\text{model}} can cause large jumps in memory usage for long sequences or deep networks.\n*   **Practical implications:**\n    \n    *   Larger dmodeldmodeld\\_{\\\\text{model}} means more memory bandwidth required to read/write the KV cache, which can bottleneck inference.\n    *   On memory-limited devices, KV cache capacity often becomes the limiting factor before compute throughput does.\n\nIncreasing the model/embedding dimension dmodeldmodeld\\_{\\\\text{model}} linearly increases the size of the KV cache, which stores past attention states, and can quickly become a major driver of memory usage during inference.\n\nDuring inference, each attention layer stores the **Key** (KKK) and **Value** (VVV) projections for every processed token in a **KV cache**, allowing the model to reuse past context without recomputing attention.\n\nFor a model with hhh heads, head dimension dheaddheadd\\_{\\\\text{head}}, and embedding dimension dmodel\\=h⋅dheaddmodel\\=h⋅dheadd\\_{\\\\text{model}} = h \\\\cdot d\\_{\\\\text{head}}, the KV cache size per token for a single layer is:\n\n*   where, the factor of 2 accounts for storing both KKK and VVV.\n\nFor a sequence of length nnn and LLL transformer layers, the total KV cache size is:\n\n**Why this grows with dmodeldmodeld\\_{\\\\text{model}}:**\n\n*   Both KKK and VVV vectors have dimensionality dmodeldmodeld\\_{\\\\text{model}}, so increasing dmodeldmodeld\\_{\\\\text{model}} directly increases the number of stored values per token.\n*   The growth is **linear** with respect to dmodeldmodeld\\_{\\\\text{model}}, but multiplicative with nnn and LLL.\n*   This means that even modest increases in dmodeldmodeld\\_{\\\\text{model}} can cause large jumps in memory usage for long sequences or deep networks.\n\n**Practical implications:**\n\n*   Larger dmodeldmodeld\\_{\\\\text{model}} means more memory bandwidth required to read/write the KV cache, which can bottleneck inference.\n*   On memory-limited devices, KV cache capacity often becomes the limiting factor before compute throughput does.\n\n#### Runtime and Memory Effects\n\n*   **Larger Model Dimension:**\n    \n    *   **Pros:** More capacity per token, better representation quality, higher perplexity performance.\n    *   **Cons:** Quadratic or linear increase in FLOPs for most layers, large memory footprint, higher activation size in KV cache.\n*   **Smaller Model Dimension:**\n    \n    *   **Pros:** Smaller models, faster inference, better suited for edge devices.\n    *   **Cons:** Lower expressive power; can bottleneck performance before parameter count is reached.\n\n**Larger Model Dimension:**\n\n*   **Pros:** More capacity per token, better representation quality, higher perplexity performance.\n*   **Cons:** Quadratic or linear increase in FLOPs for most layers, large memory footprint, higher activation size in KV cache.\n\n**Smaller Model Dimension:**\n\n*   **Pros:** Smaller models, faster inference, better suited for edge devices.\n*   **Cons:** Lower expressive power; can bottleneck performance before parameter count is reached.\n\n#### Interaction with Sequence Length\n\n*   While increasing the model dimension linearly scales memory and compute in most layers, attention score calculation (O(n2⋅dmodel)O(n2⋅dmodel)O(n^2 \\\\cdot d\\_{\\\\text{model}})) means that with long sequences, the impact of dmodeldmodeld\\_{\\\\text{model}} is amplified.\n\n#### Server vs. On-Device\n\n*   **Server (NanoGPT, TensorRT-LLM, vLLM, DeepSpeed-Inference):**\n    *   Can afford larger dmodeldmodeld\\_{\\\\text{model}} (e.g., 2048+) due to GPU tensor cores and high-bandwidth memory. The main tradeoff is training/inference cost, not latency.\n    *   TensorRT-LLM uses fused attention kernels and mixed-precision GEMMs to sustain high throughput at large dmodeldmodeld\\_{\\\\text{model}}, while vLLM and DeepSpeed-Inference can overlap compute and memory ops to mask latency.\n*   **On-Device (llama.cpp, GGML, ONNX Runtime Mobile):**\n    *   dmodeldmodeld\\_{\\\\text{model}} needs to be small enough to fit activations and KV cache in available RAM/LLC. Even quantized models struggle if dmodeldmodeld\\_{\\\\text{model}} > 1024 on low-end CPUs.\n    *   `llama.cpp` and GGML use block-quantized matrix multiplies to reduce memory footprint, while ONNX Runtime Mobile leverages kernel fusion for small dmodeldmodeld\\_{\\\\text{model}} efficiency.\n*   **Edge-specialized (LidarTLM, MediaPipe + TFLite, Qualcomm AI Stack):**\n    *   Often uses dmodeldmodeld\\_{\\\\text{model}} = 256–512 for real-time inference in sensor fusion pipelines, balancing compute with strict power envelopes.\n    *   MediaPipe + TFLite models targeting NPUs frequently compress dmodeldmodeld\\_{\\\\text{model}} to fit SRAM, while the Qualcomm AI Stack uses `int8`/`float16` hybrid kernels to keep latency under frame-time budgets.\n\n*   Can afford larger dmodeldmodeld\\_{\\\\text{model}} (e.g., 2048+) due to GPU tensor cores and high-bandwidth memory. The main tradeoff is training/inference cost, not latency.\n*   TensorRT-LLM uses fused attention kernels and mixed-precision GEMMs to sustain high throughput at large dmodeldmodeld\\_{\\\\text{model}}, while vLLM and DeepSpeed-Inference can overlap compute and memory ops to mask latency.\n\n*   dmodeldmodeld\\_{\\\\text{model}} needs to be small enough to fit activations and KV cache in available RAM/LLC. Even quantized models struggle if dmodeldmodeld\\_{\\\\text{model}} > 1024 on low-end CPUs.\n*   `llama.cpp` and GGML use block-quantized matrix multiplies to reduce memory footprint, while ONNX Runtime Mobile leverages kernel fusion for small dmodeldmodeld\\_{\\\\text{model}} efficiency.\n\n*   Often uses dmodeldmodeld\\_{\\\\text{model}} = 256–512 for real-time inference in sensor fusion pipelines, balancing compute with strict power envelopes.\n*   MediaPipe + TFLite models targeting NPUs frequently compress dmodeldmodeld\\_{\\\\text{model}} to fit SRAM, while the Qualcomm AI Stack uses `int8`/`float16` hybrid kernels to keep latency under frame-time budgets.",
    "contentLength": 193998,
    "wordCount": 1270,
    "hasCode": true,
    "hasMath": true,
    "hasImages": false,
    "url": "https://aman.ai/primers/ai/on-device-transformers/#model/embedding-dimension"
  },
  {
    "id": "ai-on-device-transformers-sequence-length-and-kv-cache-size-24",
    "articleSlug": "on-device-transformers",
    "articleTitle": "On-device Transformers",
    "category": "On-Device AI",
    "chapter": "Parameter Choices and Their Runtime Implications in Transformer Architectures",
    "title": "Sequence Length and KV Cache Size",
    "order": 24,
    "orderInChapter": 3,
    "contentHtml": "<ul>\n  <li>The sequence length <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-97-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>n</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-902\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-903\"><span class=\"mi\" id=\"MathJax-Span-904\" style=\"font-family: STIXGeneral-Italic;\">n</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>n</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-97\">n</script> (number of tokens in context) directly controls both the <strong>prefill phase</strong> cost and the <strong>decode phase</strong> memory demands in transformer inference.</li>\n  <li>Sequence length has a <strong>relatively large runtime impact</strong> since it changes the size of the entire compute graph and KV cache footprint.</li>\n</ul>\n<h4 id=\"computational-scaling\">Computational Scaling</h4>\n<ul>\n  <li><strong>Prefill (parallelizable)</strong>:\n    <ul>\n      <li>Multi-head attention complexity for the encoder or decoder prefill step:</li>\n    </ul>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-98-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><msup><mi>n</mi><mn>2</mn></msup><mo>&amp;#x22C5;</mo><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-905\" style=\"width: 6.773em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 5.628em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.201em, 1005.58em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-906\"><span class=\"mi\" id=\"MathJax-Span-907\" style=\"font-family: STIXGeneral-Italic;\">O</span><span class=\"mo\" id=\"MathJax-Span-908\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"msubsup\" id=\"MathJax-Span-909\"><span style=\"display: inline-block; position: relative; width: 0.94em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-910\" style=\"font-family: STIXGeneral-Italic;\">n</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.424em; left: 0.523em;\"><span class=\"mn\" id=\"MathJax-Span-911\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-912\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"msubsup\" id=\"MathJax-Span-913\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-914\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-915\"><span class=\"mrow\" id=\"MathJax-Span-916\"><span class=\"mtext\" id=\"MathJax-Span-917\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-918\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.441em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mi>O</mi><mo stretchy=\"false\">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo>⋅</mo><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub><mo stretchy=\"false\">)</mo></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-98\">O(n^2 \\cdot d_{\\text{model}})</script>\n\n    <ul>\n      <li>Because all <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-99-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>n</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-919\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-920\"><span class=\"mi\" id=\"MathJax-Span-921\" style=\"font-family: STIXGeneral-Italic;\">n</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>n</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-99\">n</script> tokens attend to all others, cost grows quadratically. Increasing sequence length from 2k to 4k tokens quadruples the attention score computation.</li>\n    </ul>\n  </li>\n  <li><strong>Decode (autoregressive)</strong>:\n    <ul>\n      <li>With KV caching, each new token attends to all past tokens:</li>\n    </ul>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-100-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><mi>n</mi><mo>&amp;#x22C5;</mo><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-922\" style=\"width: 6.253em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 5.211em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1005.16em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-923\"><span class=\"mi\" id=\"MathJax-Span-924\" style=\"font-family: STIXGeneral-Italic;\">O</span><span class=\"mo\" id=\"MathJax-Span-925\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-926\" style=\"font-family: STIXGeneral-Italic;\">n</span><span class=\"mo\" id=\"MathJax-Span-927\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"msubsup\" id=\"MathJax-Span-928\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-929\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-930\"><span class=\"mrow\" id=\"MathJax-Span-931\"><span class=\"mtext\" id=\"MathJax-Span-932\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-933\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo>⋅</mo><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub><mo stretchy=\"false\">)</mo></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-100\">O(n \\cdot d_{\\text{model}})</script>\n\n    <ul>\n      <li>This is linear per token, but multiplied across <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-101-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>n</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>gen</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-934\" style=\"width: 1.982em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.617em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.565em, 1001.62em, 2.607em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-935\"><span class=\"msubsup\" id=\"MathJax-Span-936\"><span style=\"display: inline-block; position: relative; width: 1.617em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-937\" style=\"font-family: STIXGeneral-Italic;\">n</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-938\"><span class=\"mrow\" id=\"MathJax-Span-939\"><span class=\"mtext\" id=\"MathJax-Span-940\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">gen</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.003em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>n</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>gen</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-101\">n_{\\text{gen}}</script> output tokens.</li>\n    </ul>\n  </li>\n</ul>\n<ul>\n      <li>Multi-head attention complexity for the encoder or decoder prefill step:</li>\n    </ul>\n<ul>\n      <li>Because all <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-99-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>n</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-919\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-920\"><span class=\"mi\" id=\"MathJax-Span-921\" style=\"font-family: STIXGeneral-Italic;\">n</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>n</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-99\">n</script> tokens attend to all others, cost grows quadratically. Increasing sequence length from 2k to 4k tokens quadruples the attention score computation.</li>\n    </ul>\n<ul>\n      <li>With KV caching, each new token attends to all past tokens:</li>\n    </ul>\n<ul>\n      <li>This is linear per token, but multiplied across <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-101-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>n</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>gen</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-934\" style=\"width: 1.982em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.617em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.565em, 1001.62em, 2.607em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-935\"><span class=\"msubsup\" id=\"MathJax-Span-936\"><span style=\"display: inline-block; position: relative; width: 1.617em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-937\" style=\"font-family: STIXGeneral-Italic;\">n</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-938\"><span class=\"mrow\" id=\"MathJax-Span-939\"><span class=\"mtext\" id=\"MathJax-Span-940\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">gen</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.003em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>n</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>gen</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-101\">n_{\\text{gen}}</script> output tokens.</li>\n    </ul>\n<h4 id=\"kv-cache-size-and-memory-footprint\">KV Cache Size and Memory Footprint</h4>\n<ul>\n  <li>\n    <p>In autoregressive decoding, the KV cache stores keys and values for each token at each layer:</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-102-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>K</mi><msub><mi>V</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>s</mi><mi>i</mi><mi>z</mi><mi>e</mi></mrow></msub><mo>&amp;#x2248;</mo><mi>n</mi><mo>&amp;#x00D7;</mo><mi>L</mi><mo>&amp;#x00D7;</mo><mn>2</mn><mo>&amp;#x00D7;</mo><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub><mo>&amp;#x00D7;</mo><mtext>precision</mtext></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-941\" style=\"width: 18.909em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 15.732em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1015.73em, 2.555em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-942\"><span class=\"mi\" id=\"MathJax-Span-943\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"msubsup\" id=\"MathJax-Span-944\"><span style=\"display: inline-block; position: relative; width: 1.773em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.68em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-945\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.628em;\"><span class=\"texatom\" id=\"MathJax-Span-946\"><span class=\"mrow\" id=\"MathJax-Span-947\"><span class=\"mi\" id=\"MathJax-Span-948\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">s</span><span class=\"mi\" id=\"MathJax-Span-949\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">i</span><span class=\"mi\" id=\"MathJax-Span-950\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">z</span><span class=\"mi\" id=\"MathJax-Span-951\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">e</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-952\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">≈</span><span class=\"mi\" id=\"MathJax-Span-953\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">n</span><span class=\"mo\" id=\"MathJax-Span-954\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">×</span><span class=\"mi\" id=\"MathJax-Span-955\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.263em;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-956\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">×</span><span class=\"mn\" id=\"MathJax-Span-957\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">2</span><span class=\"mo\" id=\"MathJax-Span-958\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">×</span><span class=\"msubsup\" id=\"MathJax-Span-959\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-960\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-961\"><span class=\"mrow\" id=\"MathJax-Span-962\"><span class=\"mtext\" id=\"MathJax-Span-963\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-964\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">×</span><span class=\"mtext\" id=\"MathJax-Span-965\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">precision</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mi>K</mi><msub><mi>V</mi><mrow class=\"MJX-TeXAtom-ORD\"><mi>s</mi><mi>i</mi><mi>z</mi><mi>e</mi></mrow></msub><mo>≈</mo><mi>n</mi><mo>×</mo><mi>L</mi><mo>×</mo><mn>2</mn><mo>×</mo><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub><mo>×</mo><mtext>precision</mtext></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-102\">KV_{size} \\approx n \\times L \\times 2 \\times d_{\\text{model}} \\times \\text{precision}</script>\n\n    <ul>\n      <li>\n        <p>where:</p>\n\n        <ul>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-103-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>n</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-966\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-967\"><span class=\"mi\" id=\"MathJax-Span-968\" style=\"font-family: STIXGeneral-Italic;\">n</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>n</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-103\">n</script>: sequence length so far</li>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-104-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-969\" style=\"width: 0.784em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.63em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-970\"><span class=\"mi\" id=\"MathJax-Span-971\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>L</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-104\">L</script>: number of layers</li>\n          <li>Factor 2: separate <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-105-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-972\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-973\"><span class=\"mi\" id=\"MathJax-Span-974\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-105\">K</script> and <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-106-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-975\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-976\"><span class=\"mi\" id=\"MathJax-Span-977\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-106\">V</script> storage</li>\n          <li>precision: bytes per element (e.g., 2 for <code class=\"language-plaintext highlighter-rouge\">float16</code>, 1 for int8)</li>\n        </ul>\n      </li>\n    </ul>\n  </li>\n  <li>\n    <p>Example: For <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-107-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>n</mi><mo>=</mo><mn>2048</mn><mo>,</mo><mi>L</mi><mo>=</mo><mn>24</mn><mo>,</mo><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub><mo>=</mo><mn>1024</mn><mo>,</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-978\" style=\"width: 15.888em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 13.232em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1013.18em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-979\"><span class=\"mi\" id=\"MathJax-Span-980\" style=\"font-family: STIXGeneral-Italic;\">n</span><span class=\"mo\" id=\"MathJax-Span-981\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-982\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">2048</span><span class=\"mo\" id=\"MathJax-Span-983\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mi\" id=\"MathJax-Span-984\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.211em;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-985\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-986\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">24</span><span class=\"mo\" id=\"MathJax-Span-987\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-988\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-989\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-990\"><span class=\"mrow\" id=\"MathJax-Span-991\"><span class=\"mtext\" id=\"MathJax-Span-992\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-993\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-994\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">1024</span><span class=\"mo\" id=\"MathJax-Span-995\" style=\"font-family: STIXGeneral-Regular;\">,</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>n</mi><mo>=</mo><mn>2048</mn><mo>,</mo><mi>L</mi><mo>=</mo><mn>24</mn><mo>,</mo><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub><mo>=</mo><mn>1024</mn><mo>,</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-107\">n = 2048, L = 24, d_{\\text{model}} = 1024,</script> <code class=\"language-plaintext highlighter-rouge\">float16</code>, KV cache ≈ 192 MB.</p>\n  </li>\n</ul>\n<p>In autoregressive decoding, the KV cache stores keys and values for each token at each layer:</p>\n<ul>\n      <li>\n        <p>where:</p>\n\n        <ul>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-103-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>n</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-966\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-967\"><span class=\"mi\" id=\"MathJax-Span-968\" style=\"font-family: STIXGeneral-Italic;\">n</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>n</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-103\">n</script>: sequence length so far</li>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-104-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-969\" style=\"width: 0.784em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.63em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-970\"><span class=\"mi\" id=\"MathJax-Span-971\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>L</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-104\">L</script>: number of layers</li>\n          <li>Factor 2: separate <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-105-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-972\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-973\"><span class=\"mi\" id=\"MathJax-Span-974\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-105\">K</script> and <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-106-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-975\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-976\"><span class=\"mi\" id=\"MathJax-Span-977\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-106\">V</script> storage</li>\n          <li>precision: bytes per element (e.g., 2 for <code class=\"language-plaintext highlighter-rouge\">float16</code>, 1 for int8)</li>\n        </ul>\n      </li>\n    </ul>\n<p>where:</p>\n<ul>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-103-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>n</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-966\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-967\"><span class=\"mi\" id=\"MathJax-Span-968\" style=\"font-family: STIXGeneral-Italic;\">n</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>n</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-103\">n</script>: sequence length so far</li>\n          <li><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-104-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-969\" style=\"width: 0.784em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.63em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-970\"><span class=\"mi\" id=\"MathJax-Span-971\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>L</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-104\">L</script>: number of layers</li>\n          <li>Factor 2: separate <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-105-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-972\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-973\"><span class=\"mi\" id=\"MathJax-Span-974\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-105\">K</script> and <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-106-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-975\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-976\"><span class=\"mi\" id=\"MathJax-Span-977\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-106\">V</script> storage</li>\n          <li>precision: bytes per element (e.g., 2 for <code class=\"language-plaintext highlighter-rouge\">float16</code>, 1 for int8)</li>\n        </ul>\n<p>Example: For <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-107-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>n</mi><mo>=</mo><mn>2048</mn><mo>,</mo><mi>L</mi><mo>=</mo><mn>24</mn><mo>,</mo><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub><mo>=</mo><mn>1024</mn><mo>,</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-978\" style=\"width: 15.888em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 13.232em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1013.18em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-979\"><span class=\"mi\" id=\"MathJax-Span-980\" style=\"font-family: STIXGeneral-Italic;\">n</span><span class=\"mo\" id=\"MathJax-Span-981\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-982\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">2048</span><span class=\"mo\" id=\"MathJax-Span-983\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mi\" id=\"MathJax-Span-984\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.211em;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-985\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-986\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">24</span><span class=\"mo\" id=\"MathJax-Span-987\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-988\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-989\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-990\"><span class=\"mrow\" id=\"MathJax-Span-991\"><span class=\"mtext\" id=\"MathJax-Span-992\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-993\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-994\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">1024</span><span class=\"mo\" id=\"MathJax-Span-995\" style=\"font-family: STIXGeneral-Regular;\">,</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>n</mi><mo>=</mo><mn>2048</mn><mo>,</mo><mi>L</mi><mo>=</mo><mn>24</mn><mo>,</mo><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub><mo>=</mo><mn>1024</mn><mo>,</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-107\">n = 2048, L = 24, d_{\\text{model}} = 1024,</script> <code class=\"language-plaintext highlighter-rouge\">float16</code>, KV cache ≈ 192 MB.</p>\n<h4 id=\"latency-effects\">Latency Effects</h4>\n<ul>\n  <li><strong>Prefill latency</strong> dominated by large GEMMs (matrix multiplications) <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-108-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>&amp;#x2192;</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-996\" style=\"width: 1.201em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.992em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.565em, 1000.94em, 2.294em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-997\"><span class=\"mo\" id=\"MathJax-Span-998\" style=\"font-family: STIXGeneral-Regular;\">→</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: 0.003em; border-left: 0px solid; width: 0px; height: 0.628em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mo stretchy=\"false\">→</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-108\">\\rightarrow</script> compute-bound.</li>\n  <li><strong>Decode latency</strong> dominated by KV cache reads and output projection <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-109-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>&amp;#x2192;</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-999\" style=\"width: 1.201em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.992em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.565em, 1000.94em, 2.294em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1000\"><span class=\"mo\" id=\"MathJax-Span-1001\" style=\"font-family: STIXGeneral-Regular;\">→</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: 0.003em; border-left: 0px solid; width: 0px; height: 0.628em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mo stretchy=\"false\">→</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-109\">\\rightarrow</script> memory-bound.</li>\n  <li>\n    <p>Large <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-110-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>n</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1002\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1003\"><span class=\"mi\" id=\"MathJax-Span-1004\" style=\"font-family: STIXGeneral-Italic;\">n</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>n</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-110\">n</script> increases both phases:</p>\n\n    <ul>\n      <li><strong>In prefill:</strong> longer sequences multiply the quadratic term.</li>\n      <li><strong>In decode:</strong> KV cache memory footprint grows, possibly exceeding L2/L3 cache <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-111-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>&amp;#x2192;</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1005\" style=\"width: 1.201em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.992em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.565em, 1000.94em, 2.294em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1006\"><span class=\"mo\" id=\"MathJax-Span-1007\" style=\"font-family: STIXGeneral-Regular;\">→</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: 0.003em; border-left: 0px solid; width: 0px; height: 0.628em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mo stretchy=\"false\">→</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-111\">\\rightarrow</script> slower fetches.</li>\n    </ul>\n  </li>\n</ul>\n<p>Large <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-110-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>n</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1002\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1003\"><span class=\"mi\" id=\"MathJax-Span-1004\" style=\"font-family: STIXGeneral-Italic;\">n</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>n</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-110\">n</script> increases both phases:</p>\n<ul>\n      <li><strong>In prefill:</strong> longer sequences multiply the quadratic term.</li>\n      <li><strong>In decode:</strong> KV cache memory footprint grows, possibly exceeding L2/L3 cache <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-111-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>&amp;#x2192;</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1005\" style=\"width: 1.201em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.992em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.565em, 1000.94em, 2.294em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1006\"><span class=\"mo\" id=\"MathJax-Span-1007\" style=\"font-family: STIXGeneral-Regular;\">→</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: 0.003em; border-left: 0px solid; width: 0px; height: 0.628em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mo stretchy=\"false\">→</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-111\">\\rightarrow</script> slower fetches.</li>\n    </ul>\n<h4 id=\"server-vs-on-device-1\">Server vs. On-Device</h4>\n<ul>\n  <li><strong>Server (NanoGPT, TensorRT-LLM, vLLM, DeepSpeed-Inference)</strong>:\n    <ul>\n      <li>GPUs can handle long sequences for prefill, but decode can still be underutilized unless batching or speculative decoding is applied. KV cache often fits in GPU memory without issue.</li>\n      <li>TensorRT-LLM and DeepSpeed-Inference use fused attention kernels to reduce KV cache memory bandwidth costs, while vLLM leverages continuous batching to mask decode-phase stalls.</li>\n    </ul>\n  </li>\n  <li><strong>On-Device (<code class=\"language-plaintext highlighter-rouge\">llama.cpp</code>, GGML, ONNX Runtime Mobile)</strong>:\n    <ul>\n      <li>Sequence length is often capped (e.g., 512–1024 tokens) to avoid RAM exhaustion and to keep KV cache in CPU last-level cache. Even at <code class=\"language-plaintext highlighter-rouge\">int8</code> quantization, longer contexts can stall inference.</li>\n      <li><code class=\"language-plaintext highlighter-rouge\">llama.cpp</code> and GGML implement tiled KV cache layouts to keep hot data in L3 cache; ONNX Runtime Mobile sometimes offloads KV cache to DRAM when SRAM is insufficient, impacting latency.</li>\n    </ul>\n  </li>\n  <li><strong>Edge-specialized (LidarTLM, MediaPipe + TFLite LLMs)</strong>:\n    <ul>\n      <li>Sequences are kept short (e.g., 128–256 tokens) because LiDAR frame-based context naturally fits into smaller windows, allowing real-time inference.</li>\n      <li>On TFLite NPUs, static allocation of KV cache in SRAM ensures deterministic performance and avoids runtime allocation delays.</li>\n    </ul>\n  </li>\n</ul>\n<ul>\n      <li>GPUs can handle long sequences for prefill, but decode can still be underutilized unless batching or speculative decoding is applied. KV cache often fits in GPU memory without issue.</li>\n      <li>TensorRT-LLM and DeepSpeed-Inference use fused attention kernels to reduce KV cache memory bandwidth costs, while vLLM leverages continuous batching to mask decode-phase stalls.</li>\n    </ul>\n<ul>\n      <li>Sequence length is often capped (e.g., 512–1024 tokens) to avoid RAM exhaustion and to keep KV cache in CPU last-level cache. Even at <code class=\"language-plaintext highlighter-rouge\">int8</code> quantization, longer contexts can stall inference.</li>\n      <li><code class=\"language-plaintext highlighter-rouge\">llama.cpp</code> and GGML implement tiled KV cache layouts to keep hot data in L3 cache; ONNX Runtime Mobile sometimes offloads KV cache to DRAM when SRAM is insufficient, impacting latency.</li>\n    </ul>\n<ul>\n      <li>Sequences are kept short (e.g., 128–256 tokens) because LiDAR frame-based context naturally fits into smaller windows, allowing real-time inference.</li>\n      <li>On TFLite NPUs, static allocation of KV cache in SRAM ensures deterministic performance and avoids runtime allocation delays.</li>\n    </ul>",
    "contentMarkdown": "*   The sequence length nnn (number of tokens in context) directly controls both the **prefill phase** cost and the **decode phase** memory demands in transformer inference.\n*   Sequence length has a **relatively large runtime impact** since it changes the size of the entire compute graph and KV cache footprint.\n\n#### Computational Scaling\n\n*   **Prefill (parallelizable)**:\n    \n    *   Multi-head attention complexity for the encoder or decoder prefill step:\n    \n    O(n2⋅dmodel)O(n2⋅dmodel)\n    \n    O(n^2 \\\\cdot d\\_{\\\\text{model}})\n    *   Because all nnn tokens attend to all others, cost grows quadratically. Increasing sequence length from 2k to 4k tokens quadruples the attention score computation.\n*   **Decode (autoregressive)**:\n    \n    *   With KV caching, each new token attends to all past tokens:\n    \n    O(n⋅dmodel)O(n⋅dmodel)\n    \n    O(n \\\\cdot d\\_{\\\\text{model}})\n    *   This is linear per token, but multiplied across ngenngenn\\_{\\\\text{gen}} output tokens.\n\n*   Multi-head attention complexity for the encoder or decoder prefill step:\n\n*   Because all nnn tokens attend to all others, cost grows quadratically. Increasing sequence length from 2k to 4k tokens quadruples the attention score computation.\n\n*   With KV caching, each new token attends to all past tokens:\n\n*   This is linear per token, but multiplied across ngenngenn\\_{\\\\text{gen}} output tokens.\n\n#### KV Cache Size and Memory Footprint\n\n*   In autoregressive decoding, the KV cache stores keys and values for each token at each layer:\n    \n    KVsize≈n×L×2×dmodel×precisionKVsize≈n×L×2×dmodel×precision\n    \n    KV\\_{size} \\\\approx n \\\\times L \\\\times 2 \\\\times d\\_{\\\\text{model}} \\\\times \\\\text{precision}\n    *   where:\n        \n        *   nnn: sequence length so far\n        *   LLL: number of layers\n        *   Factor 2: separate KKK and VVV storage\n        *   precision: bytes per element (e.g., 2 for `float16`, 1 for int8)\n*   Example: For n\\=2048,L\\=24,dmodel\\=1024,n\\=2048,L\\=24,dmodel\\=1024,n = 2048, L = 24, d\\_{\\\\text{model}} = 1024, `float16`, KV cache ≈ 192 MB.\n    \n\nIn autoregressive decoding, the KV cache stores keys and values for each token at each layer:\n\n*   where:\n    \n    *   nnn: sequence length so far\n    *   LLL: number of layers\n    *   Factor 2: separate KKK and VVV storage\n    *   precision: bytes per element (e.g., 2 for `float16`, 1 for int8)\n\nwhere:\n\n*   nnn: sequence length so far\n*   LLL: number of layers\n*   Factor 2: separate KKK and VVV storage\n*   precision: bytes per element (e.g., 2 for `float16`, 1 for int8)\n\nExample: For n\\=2048,L\\=24,dmodel\\=1024,n\\=2048,L\\=24,dmodel\\=1024,n = 2048, L = 24, d\\_{\\\\text{model}} = 1024, `float16`, KV cache ≈ 192 MB.\n\n#### Latency Effects\n\n*   **Prefill latency** dominated by large GEMMs (matrix multiplications) →→\\\\rightarrow compute-bound.\n*   **Decode latency** dominated by KV cache reads and output projection →→\\\\rightarrow memory-bound.\n*   Large nnn increases both phases:\n    \n    *   **In prefill:** longer sequences multiply the quadratic term.\n    *   **In decode:** KV cache memory footprint grows, possibly exceeding L2/L3 cache →→\\\\rightarrow slower fetches.\n\nLarge nnn increases both phases:\n\n*   **In prefill:** longer sequences multiply the quadratic term.\n*   **In decode:** KV cache memory footprint grows, possibly exceeding L2/L3 cache →→\\\\rightarrow slower fetches.\n\n#### Server vs. On-Device\n\n*   **Server (NanoGPT, TensorRT-LLM, vLLM, DeepSpeed-Inference)**:\n    *   GPUs can handle long sequences for prefill, but decode can still be underutilized unless batching or speculative decoding is applied. KV cache often fits in GPU memory without issue.\n    *   TensorRT-LLM and DeepSpeed-Inference use fused attention kernels to reduce KV cache memory bandwidth costs, while vLLM leverages continuous batching to mask decode-phase stalls.\n*   **On-Device (`llama.cpp`, GGML, ONNX Runtime Mobile)**:\n    *   Sequence length is often capped (e.g., 512–1024 tokens) to avoid RAM exhaustion and to keep KV cache in CPU last-level cache. Even at `int8` quantization, longer contexts can stall inference.\n    *   `llama.cpp` and GGML implement tiled KV cache layouts to keep hot data in L3 cache; ONNX Runtime Mobile sometimes offloads KV cache to DRAM when SRAM is insufficient, impacting latency.\n*   **Edge-specialized (LidarTLM, MediaPipe + TFLite LLMs)**:\n    *   Sequences are kept short (e.g., 128–256 tokens) because LiDAR frame-based context naturally fits into smaller windows, allowing real-time inference.\n    *   On TFLite NPUs, static allocation of KV cache in SRAM ensures deterministic performance and avoids runtime allocation delays.\n\n*   GPUs can handle long sequences for prefill, but decode can still be underutilized unless batching or speculative decoding is applied. KV cache often fits in GPU memory without issue.\n*   TensorRT-LLM and DeepSpeed-Inference use fused attention kernels to reduce KV cache memory bandwidth costs, while vLLM leverages continuous batching to mask decode-phase stalls.\n\n*   Sequence length is often capped (e.g., 512–1024 tokens) to avoid RAM exhaustion and to keep KV cache in CPU last-level cache. Even at `int8` quantization, longer contexts can stall inference.\n*   `llama.cpp` and GGML implement tiled KV cache layouts to keep hot data in L3 cache; ONNX Runtime Mobile sometimes offloads KV cache to DRAM when SRAM is insufficient, impacting latency.\n\n*   Sequences are kept short (e.g., 128–256 tokens) because LiDAR frame-based context naturally fits into smaller windows, allowing real-time inference.\n*   On TFLite NPUs, static allocation of KV cache in SRAM ensures deterministic performance and avoids runtime allocation delays.",
    "contentLength": 56130,
    "wordCount": 791,
    "hasCode": true,
    "hasMath": true,
    "hasImages": false,
    "url": "https://aman.ai/primers/ai/on-device-transformers/#sequence-length-and-kv-cache-size"
  },
  {
    "id": "ai-on-device-transformers-parameter-count-and-model-depth-25",
    "articleSlug": "on-device-transformers",
    "articleTitle": "On-device Transformers",
    "category": "On-Device AI",
    "chapter": "Parameter Choices and Their Runtime Implications in Transformer Architectures",
    "title": "Parameter Count and Model Depth",
    "order": 25,
    "orderInChapter": 4,
    "contentHtml": "<ul>\n  <li>The total parameter count <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-112-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>P</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1008\" style=\"width: 0.732em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.576em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.58em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1009\"><span class=\"mi\" id=\"MathJax-Span-1010\" style=\"font-family: STIXGeneral-Italic;\">P</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>P</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-112\">P</script> and model depth <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-113-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1011\" style=\"width: 0.784em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.63em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1012\"><span class=\"mi\" id=\"MathJax-Span-1013\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>L</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-113\">L</script> (number of transformer blocks) determine the model’s representational capacity and directly affect runtime.</li>\n  <li>Doubling <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-114-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1014\" style=\"width: 0.784em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.63em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1015\"><span class=\"mi\" id=\"MathJax-Span-1016\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>L</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-114\">L</script> roughly doubles per-token latency.</li>\n</ul>\n<h4 id=\"parameter-count-decomposition\">Parameter Count Decomposition</h4>\n<ul>\n  <li>\n    <p>A rough parameter breakdown for a decoder-only transformer:</p>\n\n    <ol>\n      <li>\n        <p><strong>Embedding matrices:</strong></p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-115-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><msub><mi>P</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>embed</mtext></mrow></msub><mo>=</mo><mi>V</mi><mo>&amp;#x22C5;</mo><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1017\" style=\"width: 9.378em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 7.815em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1007.82em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1018\"><span class=\"msubsup\" id=\"MathJax-Span-1019\"><span style=\"display: inline-block; position: relative; width: 2.555em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.63em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1020\" style=\"font-family: STIXGeneral-Italic;\">P</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.628em;\"><span class=\"texatom\" id=\"MathJax-Span-1021\"><span class=\"mrow\" id=\"MathJax-Span-1022\"><span class=\"mtext\" id=\"MathJax-Span-1023\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">embed</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1024\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mi\" id=\"MathJax-Span-1025\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1026\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"msubsup\" id=\"MathJax-Span-1027\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1028\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1029\"><span class=\"mrow\" id=\"MathJax-Span-1030\"><span class=\"mtext\" id=\"MathJax-Span-1031\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><msub><mi>P</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>embed</mtext></mrow></msub><mo>=</mo><mi>V</mi><mo>⋅</mo><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-115\">P_{\\text{embed}} = V \\cdot d_{\\text{model}}</script>\n      </li>\n      <li>\n        <p><strong>Per-layer parameters:</strong></p>\n\n        <ul>\n          <li>\n            <p>Attention projections (<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-116-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>Q</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1032\" style=\"width: 0.888em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.732em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.73em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1033\"><span class=\"mi\" id=\"MathJax-Span-1034\" style=\"font-family: STIXGeneral-Italic;\">Q</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>Q</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-116\">Q</script>, <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-117-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1035\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1036\"><span class=\"mi\" id=\"MathJax-Span-1037\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-117\">K</script>, <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-118-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1038\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1039\"><span class=\"mi\" id=\"MathJax-Span-1040\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-118\">V</script>, <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-119-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>O</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1041\" style=\"width: 0.888em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.732em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.73em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1042\"><span class=\"mi\" id=\"MathJax-Span-1043\" style=\"font-family: STIXGeneral-Italic;\">O</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>O</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-119\">O</script>):</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-120-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mn>4</mn><mo>&amp;#x22C5;</mo><msubsup><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow><mn>2</mn></msubsup></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1044\" style=\"width: 4.586em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 3.805em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.253em, 1003.8em, 2.711em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1045\"><span class=\"mn\" id=\"MathJax-Span-1046\" style=\"font-family: STIXGeneral-Regular;\">4</span><span class=\"mo\" id=\"MathJax-Span-1047\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"msubsup\" id=\"MathJax-Span-1048\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1049\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1000.42em, 4.169em, -999.997em); top: -4.372em; left: 0.576em;\"><span class=\"mn\" id=\"MathJax-Span-1050\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1001.83em, 4.169em, -999.997em); top: -3.695em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1051\"><span class=\"mrow\" id=\"MathJax-Span-1052\"><span class=\"mtext\" id=\"MathJax-Span-1053\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.503em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mn>4</mn><mo>⋅</mo><msubsup><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow><mn>2</mn></msubsup></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-120\">4 \\cdot d_{\\text{model}}^2</script>\n          </li>\n          <li>\n            <p>Feedforward networks:</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-121-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mn>2</mn><mo>&amp;#x22C5;</mo><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub><mo>&amp;#x22C5;</mo><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>ff</mtext></mrow></msub><mo>&amp;#x2248;</mo><mn>8</mn><mo>&amp;#x22C5;</mo><msubsup><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow><mn>2</mn></msubsup></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1054\" style=\"width: 13.023em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 10.836em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.253em, 1010.84em, 2.711em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1055\"><span class=\"mn\" id=\"MathJax-Span-1056\" style=\"font-family: STIXGeneral-Regular;\">2</span><span class=\"mo\" id=\"MathJax-Span-1057\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"msubsup\" id=\"MathJax-Span-1058\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1059\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1060\"><span class=\"mrow\" id=\"MathJax-Span-1061\"><span class=\"mtext\" id=\"MathJax-Span-1062\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1063\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"msubsup\" id=\"MathJax-Span-1064\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 1.044em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1065\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1066\"><span class=\"mrow\" id=\"MathJax-Span-1067\"><span class=\"mtext\" id=\"MathJax-Span-1068\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">ff</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1069\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">≈</span><span class=\"mn\" id=\"MathJax-Span-1070\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">8</span><span class=\"mo\" id=\"MathJax-Span-1071\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"msubsup\" id=\"MathJax-Span-1072\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1073\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1000.42em, 4.169em, -999.997em); top: -4.372em; left: 0.576em;\"><span class=\"mn\" id=\"MathJax-Span-1074\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1001.83em, 4.169em, -999.997em); top: -3.695em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1075\"><span class=\"mrow\" id=\"MathJax-Span-1076\"><span class=\"mtext\" id=\"MathJax-Span-1077\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.503em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mn>2</mn><mo>⋅</mo><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub><mo>⋅</mo><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>ff</mtext></mrow></msub><mo>≈</mo><mn>8</mn><mo>⋅</mo><msubsup><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow><mn>2</mn></msubsup></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-121\">2 \\cdot d_{\\text{model}} \\cdot d_{\\text{ff}} \\approx 8 \\cdot d_{\\text{model}}^2</script>\n          </li>\n          <li>\n            <p>LayerNorm &amp; biases: negligible in size</p>\n          </li>\n        </ul>\n      </li>\n      <li>\n        <p><strong>Total model parameters:</strong></p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-122-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><msub><mi>P</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>total</mtext></mrow></msub><mo>&amp;#x2248;</mo><msub><mi>P</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>embed</mtext></mrow></msub><mo>+</mo><mi>L</mi><mo>&amp;#x22C5;</mo><mo stretchy=&quot;false&quot;>(</mo><mn>12</mn><mo>&amp;#x22C5;</mo><msubsup><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow><mn>2</mn></msubsup><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1078\" style=\"width: 16.044em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 13.336em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.253em, 1013.28em, 2.711em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1079\"><span class=\"msubsup\" id=\"MathJax-Span-1080\"><span style=\"display: inline-block; position: relative; width: 1.93em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.63em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1081\" style=\"font-family: STIXGeneral-Italic;\">P</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.628em;\"><span class=\"texatom\" id=\"MathJax-Span-1082\"><span class=\"mrow\" id=\"MathJax-Span-1083\"><span class=\"mtext\" id=\"MathJax-Span-1084\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">total</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1085\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">≈</span><span class=\"msubsup\" id=\"MathJax-Span-1086\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 2.555em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.63em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1087\" style=\"font-family: STIXGeneral-Italic;\">P</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.628em;\"><span class=\"texatom\" id=\"MathJax-Span-1088\"><span class=\"mrow\" id=\"MathJax-Span-1089\"><span class=\"mtext\" id=\"MathJax-Span-1090\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">embed</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1091\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mi\" id=\"MathJax-Span-1092\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.263em;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1093\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"mo\" id=\"MathJax-Span-1094\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">(</span><span class=\"mn\" id=\"MathJax-Span-1095\" style=\"font-family: STIXGeneral-Regular;\">12</span><span class=\"mo\" id=\"MathJax-Span-1096\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"msubsup\" id=\"MathJax-Span-1097\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1098\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1000.42em, 4.169em, -999.997em); top: -4.372em; left: 0.576em;\"><span class=\"mn\" id=\"MathJax-Span-1099\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1001.83em, 4.169em, -999.997em); top: -3.695em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1100\"><span class=\"mrow\" id=\"MathJax-Span-1101\"><span class=\"mtext\" id=\"MathJax-Span-1102\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1103\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.503em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><msub><mi>P</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>total</mtext></mrow></msub><mo>≈</mo><msub><mi>P</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>embed</mtext></mrow></msub><mo>+</mo><mi>L</mi><mo>⋅</mo><mo stretchy=\"false\">(</mo><mn>12</mn><mo>⋅</mo><msubsup><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow><mn>2</mn></msubsup><mo stretchy=\"false\">)</mo></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-122\">P_{\\text{total}} \\approx P_{\\text{embed}} + L \\cdot (12 \\cdot d_{\\text{model}}^2)</script>\n      </li>\n    </ol>\n  </li>\n  <li>\n    <p>This shows that increasing <strong>depth <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-123-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1104\" style=\"width: 0.777em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.622em; height: 0px; font-size: 121%;\"><span style=\"position: absolute; clip: rect(1.346em, 1000.62em, 2.327em, -999.997em); top: -2.167em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1105\"><span class=\"mi\" id=\"MathJax-Span-1106\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.172em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>L</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-123\">L</script></strong> linearly scales parameter count and compute cost, whereas increasing <strong><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-124-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1107\" style=\"width: 2.843em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.327em; height: 0px; font-size: 121%;\"><span style=\"position: absolute; clip: rect(1.294em, 1002.33em, 2.43em, -999.997em); top: -2.115em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1108\"><span class=\"msubsup\" id=\"MathJax-Span-1109\"><span style=\"display: inline-block; position: relative; width: 2.327em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.153em, 1000.52em, 4.135em, -999.997em); top: -3.975em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1110\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.054em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 3.98em;\"></span></span><span style=\"position: absolute; top: -3.82em; left: 0.519em;\"><span class=\"texatom\" id=\"MathJax-Span-1111\"><span class=\"mrow\" id=\"MathJax-Span-1112\"><span class=\"mtext\" id=\"MathJax-Span-1113\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 3.98em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.12em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-124\">d_{\\text{model}}</script></strong> scales cost quadratically.</p>\n  </li>\n</ul>\n<p>A rough parameter breakdown for a decoder-only transformer:</p>\n<ol>\n      <li>\n        <p><strong>Embedding matrices:</strong></p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-115-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><msub><mi>P</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>embed</mtext></mrow></msub><mo>=</mo><mi>V</mi><mo>&amp;#x22C5;</mo><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1017\" style=\"width: 9.378em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 7.815em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1007.82em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1018\"><span class=\"msubsup\" id=\"MathJax-Span-1019\"><span style=\"display: inline-block; position: relative; width: 2.555em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.63em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1020\" style=\"font-family: STIXGeneral-Italic;\">P</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.628em;\"><span class=\"texatom\" id=\"MathJax-Span-1021\"><span class=\"mrow\" id=\"MathJax-Span-1022\"><span class=\"mtext\" id=\"MathJax-Span-1023\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">embed</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1024\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mi\" id=\"MathJax-Span-1025\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1026\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"msubsup\" id=\"MathJax-Span-1027\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1028\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1029\"><span class=\"mrow\" id=\"MathJax-Span-1030\"><span class=\"mtext\" id=\"MathJax-Span-1031\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><msub><mi>P</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>embed</mtext></mrow></msub><mo>=</mo><mi>V</mi><mo>⋅</mo><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-115\">P_{\\text{embed}} = V \\cdot d_{\\text{model}}</script>\n      </li>\n      <li>\n        <p><strong>Per-layer parameters:</strong></p>\n\n        <ul>\n          <li>\n            <p>Attention projections (<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-116-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>Q</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1032\" style=\"width: 0.888em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.732em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.73em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1033\"><span class=\"mi\" id=\"MathJax-Span-1034\" style=\"font-family: STIXGeneral-Italic;\">Q</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>Q</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-116\">Q</script>, <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-117-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1035\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1036\"><span class=\"mi\" id=\"MathJax-Span-1037\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-117\">K</script>, <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-118-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1038\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1039\"><span class=\"mi\" id=\"MathJax-Span-1040\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-118\">V</script>, <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-119-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>O</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1041\" style=\"width: 0.888em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.732em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.73em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1042\"><span class=\"mi\" id=\"MathJax-Span-1043\" style=\"font-family: STIXGeneral-Italic;\">O</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>O</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-119\">O</script>):</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-120-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mn>4</mn><mo>&amp;#x22C5;</mo><msubsup><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow><mn>2</mn></msubsup></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1044\" style=\"width: 4.586em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 3.805em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.253em, 1003.8em, 2.711em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1045\"><span class=\"mn\" id=\"MathJax-Span-1046\" style=\"font-family: STIXGeneral-Regular;\">4</span><span class=\"mo\" id=\"MathJax-Span-1047\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"msubsup\" id=\"MathJax-Span-1048\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1049\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1000.42em, 4.169em, -999.997em); top: -4.372em; left: 0.576em;\"><span class=\"mn\" id=\"MathJax-Span-1050\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1001.83em, 4.169em, -999.997em); top: -3.695em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1051\"><span class=\"mrow\" id=\"MathJax-Span-1052\"><span class=\"mtext\" id=\"MathJax-Span-1053\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.503em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mn>4</mn><mo>⋅</mo><msubsup><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow><mn>2</mn></msubsup></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-120\">4 \\cdot d_{\\text{model}}^2</script>\n          </li>\n          <li>\n            <p>Feedforward networks:</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-121-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mn>2</mn><mo>&amp;#x22C5;</mo><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub><mo>&amp;#x22C5;</mo><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>ff</mtext></mrow></msub><mo>&amp;#x2248;</mo><mn>8</mn><mo>&amp;#x22C5;</mo><msubsup><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow><mn>2</mn></msubsup></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1054\" style=\"width: 13.023em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 10.836em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.253em, 1010.84em, 2.711em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1055\"><span class=\"mn\" id=\"MathJax-Span-1056\" style=\"font-family: STIXGeneral-Regular;\">2</span><span class=\"mo\" id=\"MathJax-Span-1057\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"msubsup\" id=\"MathJax-Span-1058\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1059\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1060\"><span class=\"mrow\" id=\"MathJax-Span-1061\"><span class=\"mtext\" id=\"MathJax-Span-1062\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1063\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"msubsup\" id=\"MathJax-Span-1064\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 1.044em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1065\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1066\"><span class=\"mrow\" id=\"MathJax-Span-1067\"><span class=\"mtext\" id=\"MathJax-Span-1068\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">ff</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1069\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">≈</span><span class=\"mn\" id=\"MathJax-Span-1070\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">8</span><span class=\"mo\" id=\"MathJax-Span-1071\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"msubsup\" id=\"MathJax-Span-1072\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1073\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1000.42em, 4.169em, -999.997em); top: -4.372em; left: 0.576em;\"><span class=\"mn\" id=\"MathJax-Span-1074\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1001.83em, 4.169em, -999.997em); top: -3.695em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1075\"><span class=\"mrow\" id=\"MathJax-Span-1076\"><span class=\"mtext\" id=\"MathJax-Span-1077\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.503em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mn>2</mn><mo>⋅</mo><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub><mo>⋅</mo><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>ff</mtext></mrow></msub><mo>≈</mo><mn>8</mn><mo>⋅</mo><msubsup><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow><mn>2</mn></msubsup></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-121\">2 \\cdot d_{\\text{model}} \\cdot d_{\\text{ff}} \\approx 8 \\cdot d_{\\text{model}}^2</script>\n          </li>\n          <li>\n            <p>LayerNorm &amp; biases: negligible in size</p>\n          </li>\n        </ul>\n      </li>\n      <li>\n        <p><strong>Total model parameters:</strong></p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-122-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><msub><mi>P</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>total</mtext></mrow></msub><mo>&amp;#x2248;</mo><msub><mi>P</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>embed</mtext></mrow></msub><mo>+</mo><mi>L</mi><mo>&amp;#x22C5;</mo><mo stretchy=&quot;false&quot;>(</mo><mn>12</mn><mo>&amp;#x22C5;</mo><msubsup><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow><mn>2</mn></msubsup><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1078\" style=\"width: 16.044em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 13.336em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.253em, 1013.28em, 2.711em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1079\"><span class=\"msubsup\" id=\"MathJax-Span-1080\"><span style=\"display: inline-block; position: relative; width: 1.93em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.63em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1081\" style=\"font-family: STIXGeneral-Italic;\">P</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.628em;\"><span class=\"texatom\" id=\"MathJax-Span-1082\"><span class=\"mrow\" id=\"MathJax-Span-1083\"><span class=\"mtext\" id=\"MathJax-Span-1084\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">total</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1085\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">≈</span><span class=\"msubsup\" id=\"MathJax-Span-1086\" style=\"padding-left: 0.315em;\"><span style=\"display: inline-block; position: relative; width: 2.555em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.63em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1087\" style=\"font-family: STIXGeneral-Italic;\">P</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.628em;\"><span class=\"texatom\" id=\"MathJax-Span-1088\"><span class=\"mrow\" id=\"MathJax-Span-1089\"><span class=\"mtext\" id=\"MathJax-Span-1090\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">embed</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1091\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mi\" id=\"MathJax-Span-1092\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.263em;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1093\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"mo\" id=\"MathJax-Span-1094\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">(</span><span class=\"mn\" id=\"MathJax-Span-1095\" style=\"font-family: STIXGeneral-Regular;\">12</span><span class=\"mo\" id=\"MathJax-Span-1096\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"msubsup\" id=\"MathJax-Span-1097\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1098\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1000.42em, 4.169em, -999.997em); top: -4.372em; left: 0.576em;\"><span class=\"mn\" id=\"MathJax-Span-1099\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1001.83em, 4.169em, -999.997em); top: -3.695em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1100\"><span class=\"mrow\" id=\"MathJax-Span-1101\"><span class=\"mtext\" id=\"MathJax-Span-1102\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1103\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.503em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><msub><mi>P</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>total</mtext></mrow></msub><mo>≈</mo><msub><mi>P</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>embed</mtext></mrow></msub><mo>+</mo><mi>L</mi><mo>⋅</mo><mo stretchy=\"false\">(</mo><mn>12</mn><mo>⋅</mo><msubsup><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow><mn>2</mn></msubsup><mo stretchy=\"false\">)</mo></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-122\">P_{\\text{total}} \\approx P_{\\text{embed}} + L \\cdot (12 \\cdot d_{\\text{model}}^2)</script>\n      </li>\n    </ol>\n<p><strong>Embedding matrices:</strong></p>\n<p><strong>Per-layer parameters:</strong></p>\n<ul>\n          <li>\n            <p>Attention projections (<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-116-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>Q</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1032\" style=\"width: 0.888em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.732em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.73em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1033\"><span class=\"mi\" id=\"MathJax-Span-1034\" style=\"font-family: STIXGeneral-Italic;\">Q</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>Q</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-116\">Q</script>, <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-117-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1035\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1036\"><span class=\"mi\" id=\"MathJax-Span-1037\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-117\">K</script>, <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-118-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1038\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1039\"><span class=\"mi\" id=\"MathJax-Span-1040\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-118\">V</script>, <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-119-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>O</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1041\" style=\"width: 0.888em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.732em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.73em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1042\"><span class=\"mi\" id=\"MathJax-Span-1043\" style=\"font-family: STIXGeneral-Italic;\">O</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>O</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-119\">O</script>):</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-120-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mn>4</mn><mo>&amp;#x22C5;</mo><msubsup><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow><mn>2</mn></msubsup></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1044\" style=\"width: 4.586em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 3.805em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.253em, 1003.8em, 2.711em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1045\"><span class=\"mn\" id=\"MathJax-Span-1046\" style=\"font-family: STIXGeneral-Regular;\">4</span><span class=\"mo\" id=\"MathJax-Span-1047\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"msubsup\" id=\"MathJax-Span-1048\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1049\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1000.42em, 4.169em, -999.997em); top: -4.372em; left: 0.576em;\"><span class=\"mn\" id=\"MathJax-Span-1050\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1001.83em, 4.169em, -999.997em); top: -3.695em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1051\"><span class=\"mrow\" id=\"MathJax-Span-1052\"><span class=\"mtext\" id=\"MathJax-Span-1053\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.503em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mn>4</mn><mo>⋅</mo><msubsup><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow><mn>2</mn></msubsup></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-120\">4 \\cdot d_{\\text{model}}^2</script>\n          </li>\n          <li>\n            <p>Feedforward networks:</p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-121-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mn>2</mn><mo>&amp;#x22C5;</mo><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub><mo>&amp;#x22C5;</mo><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>ff</mtext></mrow></msub><mo>&amp;#x2248;</mo><mn>8</mn><mo>&amp;#x22C5;</mo><msubsup><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow><mn>2</mn></msubsup></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1054\" style=\"width: 13.023em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 10.836em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.253em, 1010.84em, 2.711em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1055\"><span class=\"mn\" id=\"MathJax-Span-1056\" style=\"font-family: STIXGeneral-Regular;\">2</span><span class=\"mo\" id=\"MathJax-Span-1057\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"msubsup\" id=\"MathJax-Span-1058\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1059\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1060\"><span class=\"mrow\" id=\"MathJax-Span-1061\"><span class=\"mtext\" id=\"MathJax-Span-1062\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1063\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"msubsup\" id=\"MathJax-Span-1064\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 1.044em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1065\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1066\"><span class=\"mrow\" id=\"MathJax-Span-1067\"><span class=\"mtext\" id=\"MathJax-Span-1068\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">ff</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1069\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">≈</span><span class=\"mn\" id=\"MathJax-Span-1070\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">8</span><span class=\"mo\" id=\"MathJax-Span-1071\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"msubsup\" id=\"MathJax-Span-1072\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1073\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1000.42em, 4.169em, -999.997em); top: -4.372em; left: 0.576em;\"><span class=\"mn\" id=\"MathJax-Span-1074\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1001.83em, 4.169em, -999.997em); top: -3.695em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1075\"><span class=\"mrow\" id=\"MathJax-Span-1076\"><span class=\"mtext\" id=\"MathJax-Span-1077\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.503em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mn>2</mn><mo>⋅</mo><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub><mo>⋅</mo><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>ff</mtext></mrow></msub><mo>≈</mo><mn>8</mn><mo>⋅</mo><msubsup><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow><mn>2</mn></msubsup></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-121\">2 \\cdot d_{\\text{model}} \\cdot d_{\\text{ff}} \\approx 8 \\cdot d_{\\text{model}}^2</script>\n          </li>\n          <li>\n            <p>LayerNorm &amp; biases: negligible in size</p>\n          </li>\n        </ul>\n<p>Attention projections (<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-116-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>Q</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1032\" style=\"width: 0.888em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.732em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.73em, 2.503em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1033\"><span class=\"mi\" id=\"MathJax-Span-1034\" style=\"font-family: STIXGeneral-Italic;\">Q</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>Q</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-116\">Q</script>, <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-117-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1035\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1036\"><span class=\"mi\" id=\"MathJax-Span-1037\" style=\"font-family: STIXGeneral-Italic;\">K<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>K</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-117\">K</script>, <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-118-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1038\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1039\"><span class=\"mi\" id=\"MathJax-Span-1040\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-118\">V</script>, <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-119-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>O</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1041\" style=\"width: 0.888em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.732em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.73em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1042\"><span class=\"mi\" id=\"MathJax-Span-1043\" style=\"font-family: STIXGeneral-Italic;\">O</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>O</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-119\">O</script>):</p>\n<p>Feedforward networks:</p>\n<p>LayerNorm &amp; biases: negligible in size</p>\n<p><strong>Total model parameters:</strong></p>\n<p>This shows that increasing <strong>depth <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-123-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1104\" style=\"width: 0.777em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.622em; height: 0px; font-size: 121%;\"><span style=\"position: absolute; clip: rect(1.346em, 1000.62em, 2.327em, -999.997em); top: -2.167em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1105\"><span class=\"mi\" id=\"MathJax-Span-1106\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.172em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>L</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-123\">L</script></strong> linearly scales parameter count and compute cost, whereas increasing <strong><span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-124-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1107\" style=\"width: 2.843em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.327em; height: 0px; font-size: 121%;\"><span style=\"position: absolute; clip: rect(1.294em, 1002.33em, 2.43em, -999.997em); top: -2.115em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1108\"><span class=\"msubsup\" id=\"MathJax-Span-1109\"><span style=\"display: inline-block; position: relative; width: 2.327em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.153em, 1000.52em, 4.135em, -999.997em); top: -3.975em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1110\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.054em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 3.98em;\"></span></span><span style=\"position: absolute; top: -3.82em; left: 0.519em;\"><span class=\"texatom\" id=\"MathJax-Span-1111\"><span class=\"mrow\" id=\"MathJax-Span-1112\"><span class=\"mtext\" id=\"MathJax-Span-1113\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 3.98em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.12em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-124\">d_{\\text{model}}</script></strong> scales cost quadratically.</p>\n<h4 id=\"runtime-scaling-with-depth\">Runtime Scaling with Depth</h4>\n<ul>\n  <li><strong>Prefill phase:</strong> Cost scales as <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-125-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><mi>L</mi><mo>&amp;#x22C5;</mo><msup><mi>n</mi><mn>2</mn></msup><mo>&amp;#x22C5;</mo><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub><mo stretchy=&quot;false&quot;>)</mo><mspace width=&quot;1em&quot; /><mtext>(attention)</mtext></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1114\" style=\"width: 15.107em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 12.555em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.253em, 1012.5em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1115\"><span class=\"mi\" id=\"MathJax-Span-1116\" style=\"font-family: STIXGeneral-Italic;\">O</span><span class=\"mo\" id=\"MathJax-Span-1117\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-1118\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1119\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"msubsup\" id=\"MathJax-Span-1120\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 0.94em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.44em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1121\" style=\"font-family: STIXGeneral-Italic;\">n</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -4.372em; left: 0.523em;\"><span class=\"mn\" id=\"MathJax-Span-1122\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1123\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"msubsup\" id=\"MathJax-Span-1124\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1125\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1126\"><span class=\"mrow\" id=\"MathJax-Span-1127\"><span class=\"mtext\" id=\"MathJax-Span-1128\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1129\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mspace\" id=\"MathJax-Span-1130\" style=\"height: 0em; vertical-align: 0em; width: 1.148em; display: inline-block; overflow: hidden;\"></span><span class=\"mtext\" id=\"MathJax-Span-1131\" style=\"font-family: STIXGeneral-Regular;\">(attention)</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.378em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>O</mi><mo stretchy=\"false\">(</mo><mi>L</mi><mo>⋅</mo><msup><mi>n</mi><mn>2</mn></msup><mo>⋅</mo><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub><mo stretchy=\"false\">)</mo><mspace width=\"1em\"></mspace><mtext>(attention)</mtext></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-125\">O(L \\cdot n^2 \\cdot d_{\\text{model}}) \\quad \\text{(attention)}</script> plus <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-126-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><mi>L</mi><mo>&amp;#x22C5;</mo><mi>n</mi><mo>&amp;#x22C5;</mo><msubsup><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow><mn>2</mn></msubsup><mo stretchy=&quot;false&quot;>)</mo><mspace width=&quot;1em&quot; /><mtext>(FFN)</mtext></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1132\" style=\"width: 12.503em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 10.419em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.253em, 1010.37em, 2.711em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1133\"><span class=\"mi\" id=\"MathJax-Span-1134\" style=\"font-family: STIXGeneral-Italic;\">O</span><span class=\"mo\" id=\"MathJax-Span-1135\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-1136\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1137\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"mi\" id=\"MathJax-Span-1138\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.263em;\">n</span><span class=\"mo\" id=\"MathJax-Span-1139\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"msubsup\" id=\"MathJax-Span-1140\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1141\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1000.42em, 4.169em, -999.997em); top: -4.372em; left: 0.576em;\"><span class=\"mn\" id=\"MathJax-Span-1142\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1001.83em, 4.169em, -999.997em); top: -3.695em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1143\"><span class=\"mrow\" id=\"MathJax-Span-1144\"><span class=\"mtext\" id=\"MathJax-Span-1145\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1146\" style=\"font-family: STIXGeneral-Regular;\">)</span><span class=\"mspace\" id=\"MathJax-Span-1147\" style=\"height: 0em; vertical-align: 0em; width: 1.148em; display: inline-block; overflow: hidden;\"></span><span class=\"mtext\" id=\"MathJax-Span-1148\" style=\"font-family: STIXGeneral-Regular;\">(FFN)</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.503em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>O</mi><mo stretchy=\"false\">(</mo><mi>L</mi><mo>⋅</mo><mi>n</mi><mo>⋅</mo><msubsup><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow><mn>2</mn></msubsup><mo stretchy=\"false\">)</mo><mspace width=\"1em\"></mspace><mtext>(FFN)</mtext></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-126\">O(L \\cdot n \\cdot d_{\\text{model}}^2) \\quad \\text{(FFN)}</script>.</li>\n  <li><strong>Decode phase:</strong> Each new token must pass through all <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-127-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1149\" style=\"width: 0.784em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.63em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1150\"><span class=\"mi\" id=\"MathJax-Span-1151\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>L</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-127\">L</script> layers sequentially, so latency per token scales linearly with <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-128-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1152\" style=\"width: 0.784em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.63em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1153\"><span class=\"mi\" id=\"MathJax-Span-1154\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>L</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-128\">L</script>.</li>\n</ul>\n<h4 id=\"accuracy-vs-latency-tradeoff\">Accuracy vs. Latency Tradeoff</h4>\n<ul>\n  <li><strong>More layers</strong> generally yield better performance and longer-range reasoning, but each layer adds sequential compute steps during decoding.</li>\n  <li><strong>Shallow networks</strong> are much faster for autoregressive decoding but can struggle with complex reasoning or long-range dependencies.</li>\n</ul>\n<h4 id=\"server-vs-on-device-2\">Server vs. On-Device</h4>\n<ul>\n  <li>\n    <p><strong>Server (NanoGPT, TensorRT-LLM, vLLM, DeepSpeed-Inference)</strong>: Large <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-129-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1155\" style=\"width: 0.784em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.63em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1156\"><span class=\"mi\" id=\"MathJax-Span-1157\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>L</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-129\">L</script> (24–48) is feasible. GPUs can hide some latency through parallelization across layers with pipeline or tensor parallelism. The prefill stage dominates for long contexts.</p>\n  </li>\n  <li>\n    <p><strong>On-Device (<code class=\"language-plaintext highlighter-rouge\">llama.cpp</code>, GGML, ONNX Runtime Mobile)</strong>: Depth often limited to 8–16 layers for real-time inference. Too many layers <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-130-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>&amp;#x2192;</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1158\" style=\"width: 1.201em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.992em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.565em, 1000.94em, 2.294em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1159\"><span class=\"mo\" id=\"MathJax-Span-1160\" style=\"font-family: STIXGeneral-Regular;\">→</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: 0.003em; border-left: 0px solid; width: 0px; height: 0.628em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mo stretchy=\"false\">→</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-130\">\\rightarrow</script> sequential decode bottleneck on CPU or NPU. Quantization helps memory but not sequential compute cost.</p>\n  </li>\n  <li>\n    <p><strong>Edge-specialized (LidarTLM, MediaPipe + TFLite LLMs)</strong>: Extremely shallow depths (4–8 layers) to maintain low latency for sensor-fusion loops. Accuracy loss offset by task-specific training and limited context size.</p>\n  </li>\n</ul>\n<p><strong>Server (NanoGPT, TensorRT-LLM, vLLM, DeepSpeed-Inference)</strong>: Large <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-129-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1155\" style=\"width: 0.784em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.63em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1156\"><span class=\"mi\" id=\"MathJax-Span-1157\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>L</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-129\">L</script> (24–48) is feasible. GPUs can hide some latency through parallelization across layers with pipeline or tensor parallelism. The prefill stage dominates for long contexts.</p>\n<p><strong>On-Device (<code class=\"language-plaintext highlighter-rouge\">llama.cpp</code>, GGML, ONNX Runtime Mobile)</strong>: Depth often limited to 8–16 layers for real-time inference. Too many layers <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-130-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>&amp;#x2192;</mo></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1158\" style=\"width: 1.201em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.992em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.565em, 1000.94em, 2.294em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1159\"><span class=\"mo\" id=\"MathJax-Span-1160\" style=\"font-family: STIXGeneral-Regular;\">→</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: 0.003em; border-left: 0px solid; width: 0px; height: 0.628em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mo stretchy=\"false\">→</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-130\">\\rightarrow</script> sequential decode bottleneck on CPU or NPU. Quantization helps memory but not sequential compute cost.</p>\n<p><strong>Edge-specialized (LidarTLM, MediaPipe + TFLite LLMs)</strong>: Extremely shallow depths (4–8 layers) to maintain low latency for sensor-fusion loops. Accuracy loss offset by task-specific training and limited context size.</p>",
    "contentMarkdown": "*   The total parameter count PPP and model depth LLL (number of transformer blocks) determine the model’s representational capacity and directly affect runtime.\n*   Doubling LLL roughly doubles per-token latency.\n\n#### Parameter Count Decomposition\n\n*   A rough parameter breakdown for a decoder-only transformer:\n    \n    1.  **Embedding matrices:**\n        \n        Pembed\\=V⋅dmodelPembed\\=V⋅dmodel\n        \n        P\\_{\\\\text{embed}} = V \\\\cdot d\\_{\\\\text{model}}\n    2.  **Per-layer parameters:**\n        \n        *   Attention projections (QQQ, KKK, VVV, OOO):\n            \n            4⋅d2model4⋅dmodel2\n            \n            4 \\\\cdot d\\_{\\\\text{model}}^2\n        *   Feedforward networks:\n            \n            2⋅dmodel⋅dff≈8⋅d2model2⋅dmodel⋅dff≈8⋅dmodel2\n            \n            2 \\\\cdot d\\_{\\\\text{model}} \\\\cdot d\\_{\\\\text{ff}} \\\\approx 8 \\\\cdot d\\_{\\\\text{model}}^2\n        *   LayerNorm & biases: negligible in size\n            \n    3.  **Total model parameters:**\n        \n        Ptotal≈Pembed+L⋅(12⋅d2model)Ptotal≈Pembed+L⋅(12⋅dmodel2)\n        \n        P\\_{\\\\text{total}} \\\\approx P\\_{\\\\text{embed}} + L \\\\cdot (12 \\\\cdot d\\_{\\\\text{model}}^2)\n*   This shows that increasing **depth LLL** linearly scales parameter count and compute cost, whereas increasing **dmodeldmodeld\\_{\\\\text{model}}** scales cost quadratically.\n    \n\nA rough parameter breakdown for a decoder-only transformer:\n\n1.  **Embedding matrices:**\n    \n    Pembed\\=V⋅dmodelPembed\\=V⋅dmodel\n    \n    P\\_{\\\\text{embed}} = V \\\\cdot d\\_{\\\\text{model}}\n2.  **Per-layer parameters:**\n    \n    *   Attention projections (QQQ, KKK, VVV, OOO):\n        \n        4⋅d2model4⋅dmodel2\n        \n        4 \\\\cdot d\\_{\\\\text{model}}^2\n    *   Feedforward networks:\n        \n        2⋅dmodel⋅dff≈8⋅d2model2⋅dmodel⋅dff≈8⋅dmodel2\n        \n        2 \\\\cdot d\\_{\\\\text{model}} \\\\cdot d\\_{\\\\text{ff}} \\\\approx 8 \\\\cdot d\\_{\\\\text{model}}^2\n    *   LayerNorm & biases: negligible in size\n        \n3.  **Total model parameters:**\n    \n    Ptotal≈Pembed+L⋅(12⋅d2model)Ptotal≈Pembed+L⋅(12⋅dmodel2)\n    \n    P\\_{\\\\text{total}} \\\\approx P\\_{\\\\text{embed}} + L \\\\cdot (12 \\\\cdot d\\_{\\\\text{model}}^2)\n\n**Embedding matrices:**\n\n**Per-layer parameters:**\n\n*   Attention projections (QQQ, KKK, VVV, OOO):\n    \n    4⋅d2model4⋅dmodel2\n    \n    4 \\\\cdot d\\_{\\\\text{model}}^2\n*   Feedforward networks:\n    \n    2⋅dmodel⋅dff≈8⋅d2model2⋅dmodel⋅dff≈8⋅dmodel2\n    \n    2 \\\\cdot d\\_{\\\\text{model}} \\\\cdot d\\_{\\\\text{ff}} \\\\approx 8 \\\\cdot d\\_{\\\\text{model}}^2\n*   LayerNorm & biases: negligible in size\n    \n\nAttention projections (QQQ, KKK, VVV, OOO):\n\nFeedforward networks:\n\nLayerNorm & biases: negligible in size\n\n**Total model parameters:**\n\nThis shows that increasing **depth LLL** linearly scales parameter count and compute cost, whereas increasing **dmodeldmodeld\\_{\\\\text{model}}** scales cost quadratically.\n\n#### Runtime Scaling with Depth\n\n*   **Prefill phase:** Cost scales as O(L⋅n2⋅dmodel)(attention)O(L⋅n2⋅dmodel)(attention)O(L \\\\cdot n^2 \\\\cdot d\\_{\\\\text{model}}) \\\\quad \\\\text{(attention)} plus O(L⋅n⋅d2model)(FFN)O(L⋅n⋅dmodel2)(FFN)O(L \\\\cdot n \\\\cdot d\\_{\\\\text{model}}^2) \\\\quad \\\\text{(FFN)}.\n*   **Decode phase:** Each new token must pass through all LLL layers sequentially, so latency per token scales linearly with LLL.\n\n#### Accuracy vs. Latency Tradeoff\n\n*   **More layers** generally yield better performance and longer-range reasoning, but each layer adds sequential compute steps during decoding.\n*   **Shallow networks** are much faster for autoregressive decoding but can struggle with complex reasoning or long-range dependencies.\n\n#### Server vs. On-Device\n\n*   **Server (NanoGPT, TensorRT-LLM, vLLM, DeepSpeed-Inference)**: Large LLL (24–48) is feasible. GPUs can hide some latency through parallelization across layers with pipeline or tensor parallelism. The prefill stage dominates for long contexts.\n    \n*   **On-Device (`llama.cpp`, GGML, ONNX Runtime Mobile)**: Depth often limited to 8–16 layers for real-time inference. Too many layers →→\\\\rightarrow sequential decode bottleneck on CPU or NPU. Quantization helps memory but not sequential compute cost.\n    \n*   **Edge-specialized (LidarTLM, MediaPipe + TFLite LLMs)**: Extremely shallow depths (4–8 layers) to maintain low latency for sensor-fusion loops. Accuracy loss offset by task-specific training and limited context size.\n    \n\n**Server (NanoGPT, TensorRT-LLM, vLLM, DeepSpeed-Inference)**: Large LLL (24–48) is feasible. GPUs can hide some latency through parallelization across layers with pipeline or tensor parallelism. The prefill stage dominates for long contexts.\n\n**On-Device (`llama.cpp`, GGML, ONNX Runtime Mobile)**: Depth often limited to 8–16 layers for real-time inference. Too many layers →→\\\\rightarrow sequential decode bottleneck on CPU or NPU. Quantization helps memory but not sequential compute cost.\n\n**Edge-specialized (LidarTLM, MediaPipe + TFLite LLMs)**: Extremely shallow depths (4–8 layers) to maintain low latency for sensor-fusion loops. Accuracy loss offset by task-specific training and limited context size.",
    "contentLength": 96723,
    "wordCount": 538,
    "hasCode": true,
    "hasMath": true,
    "hasImages": false,
    "url": "https://aman.ai/primers/ai/on-device-transformers/#parameter-count-and-model-depth"
  },
  {
    "id": "ai-on-device-transformers-embedding-size-times-vocabulary-size-times-depth-26",
    "articleSlug": "on-device-transformers",
    "articleTitle": "On-device Transformers",
    "category": "On-Device AI",
    "chapter": "Parameter Choices and Their Runtime Implications in Transformer Architectures",
    "title": "Embedding Size ××\\times Vocabulary Size ××\\times Depth",
    "order": 26,
    "orderInChapter": 5,
    "contentHtml": "<ul>\n  <li>So far, we’ve treated vocabulary size <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-133-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1167\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1168\"><span class=\"mi\" id=\"MathJax-Span-1169\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-133\">V</script>, embedding size <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-134-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1170\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1171\"><span class=\"msubsup\" id=\"MathJax-Span-1172\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1173\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1174\"><span class=\"mrow\" id=\"MathJax-Span-1175\"><span class=\"mtext\" id=\"MathJax-Span-1176\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-134\">d_{\\text{model}}</script>, and depth <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-135-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1177\" style=\"width: 0.784em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.63em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1178\"><span class=\"mi\" id=\"MathJax-Span-1179\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>L</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-135\">L</script> mostly in isolation. In reality, these parameters interact in ways that compound runtime and memory demands.</li>\n</ul>\n<h4 id=\"compound-parameter-scaling\">Compound Parameter Scaling</h4>\n<ul>\n  <li>By examining the compute vs. memory analysis for <a href=\"#tokenizer-and-vocabulary-size\">tokenizer and vocabulary size</a>, <a href=\"#modelembedding-dimension\">model/embedding size <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-136-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>m</mi><mi>o</mi><mi>d</mi><mi>e</mi><mi>l</mi></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1180\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1181\"><span class=\"msubsup\" id=\"MathJax-Span-1182\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1183\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1184\"><span class=\"mrow\" id=\"MathJax-Span-1185\"><span class=\"mi\" id=\"MathJax-Span-1186\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">m</span><span class=\"mi\" id=\"MathJax-Span-1187\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">o</span><span class=\"mi\" id=\"MathJax-Span-1188\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mi\" id=\"MathJax-Span-1189\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">e</span><span class=\"mi\" id=\"MathJax-Span-1190\" style=\"font-size: 70.7%; font-family: STIXGeneral-Italic;\">l<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mi>m</mi><mi>o</mi><mi>d</mi><mi>e</mi><mi>l</mi></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-136\">d_{model}</script></a>, <a href=\"#sequence-length-and-kv-cache-size\">sequence length and KV cache size</a>, and <a href=\"#parameter-count-and-model-depth\">model parameter count and depth <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-137-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1191\" style=\"width: 0.784em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.63em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1192\"><span class=\"mi\" id=\"MathJax-Span-1193\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>L</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-137\">L</script></a>, a decoder-only transformer’s <strong>core parameter count</strong> is approximately:</li>\n</ul>\n<div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-138-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><msub><mi>P</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>total</mtext></mrow></msub><mo>&amp;#x2248;</mo><mi>V</mi><mo>&amp;#x22C5;</mo><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub><mo>+</mo><mi>L</mi><mo>&amp;#x22C5;</mo><mo stretchy=&quot;false&quot;>(</mo><mn>12</mn><mo>&amp;#x22C5;</mo><msubsup><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow><mn>2</mn></msubsup><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1194\" style=\"width: 17.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 14.846em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.253em, 1014.79em, 2.711em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1195\"><span class=\"msubsup\" id=\"MathJax-Span-1196\"><span style=\"display: inline-block; position: relative; width: 1.93em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.63em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1197\" style=\"font-family: STIXGeneral-Italic;\">P</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.628em;\"><span class=\"texatom\" id=\"MathJax-Span-1198\"><span class=\"mrow\" id=\"MathJax-Span-1199\"><span class=\"mtext\" id=\"MathJax-Span-1200\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">total</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1201\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">≈</span><span class=\"mi\" id=\"MathJax-Span-1202\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1203\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"msubsup\" id=\"MathJax-Span-1204\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1205\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1206\"><span class=\"mrow\" id=\"MathJax-Span-1207\"><span class=\"mtext\" id=\"MathJax-Span-1208\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1209\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">+</span><span class=\"mi\" id=\"MathJax-Span-1210\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.263em;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1211\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"mo\" id=\"MathJax-Span-1212\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">(</span><span class=\"mn\" id=\"MathJax-Span-1213\" style=\"font-family: STIXGeneral-Regular;\">12</span><span class=\"mo\" id=\"MathJax-Span-1214\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"msubsup\" id=\"MathJax-Span-1215\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1216\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1000.42em, 4.169em, -999.997em); top: -4.372em; left: 0.576em;\"><span class=\"mn\" id=\"MathJax-Span-1217\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1001.83em, 4.169em, -999.997em); top: -3.695em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1218\"><span class=\"mrow\" id=\"MathJax-Span-1219\"><span class=\"mtext\" id=\"MathJax-Span-1220\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1221\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.503em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><msub><mi>P</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>total</mtext></mrow></msub><mo>≈</mo><mi>V</mi><mo>⋅</mo><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub><mo>+</mo><mi>L</mi><mo>⋅</mo><mo stretchy=\"false\">(</mo><mn>12</mn><mo>⋅</mo><msubsup><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow><mn>2</mn></msubsup><mo stretchy=\"false\">)</mo></math></span></span></div>\n<ul>\n  <li>The <strong>output projection cost</strong> per token is:</li>\n</ul>\n<div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-139-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><msub><mi>C</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>out</mtext></mrow></msub><mo>&amp;#x2248;</mo><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><mi>V</mi><mo>&amp;#x22C5;</mo><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1222\" style=\"width: 10.003em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 8.336em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.409em, 1008.28em, 2.555em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1223\"><span class=\"msubsup\" id=\"MathJax-Span-1224\"><span style=\"display: inline-block; position: relative; width: 1.669em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.68em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1225\" style=\"font-family: STIXGeneral-Italic;\">C<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.68em;\"><span class=\"texatom\" id=\"MathJax-Span-1226\"><span class=\"mrow\" id=\"MathJax-Span-1227\"><span class=\"mtext\" id=\"MathJax-Span-1228\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">out</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1229\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">≈</span><span class=\"mi\" id=\"MathJax-Span-1230\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">O</span><span class=\"mo\" id=\"MathJax-Span-1231\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-1232\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1233\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"msubsup\" id=\"MathJax-Span-1234\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1235\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1236\"><span class=\"mrow\" id=\"MathJax-Span-1237\"><span class=\"mtext\" id=\"MathJax-Span-1238\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1239\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><msub><mi>C</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>out</mtext></mrow></msub><mo>≈</mo><mi>O</mi><mo stretchy=\"false\">(</mo><mi>V</mi><mo>⋅</mo><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub><mo stretchy=\"false\">)</mo></math></span></span></div>\n<ul>\n  <li>\n    <p>The <strong>layer cost</strong> per token is:</p>\n  </li>\n  <li>\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-140-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><msub><mi>C</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>layer</mtext></mrow></msub><mo>&amp;#x2248;</mo><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><mi>L</mi><mo>&amp;#x22C5;</mo><msubsup><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow><mn>2</mn></msubsup><mo stretchy=&quot;false&quot;>)</mo></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1240\" style=\"width: 10.419em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 8.648em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.253em, 1008.6em, 2.711em, -999.997em); top: -2.237em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1241\"><span class=\"msubsup\" id=\"MathJax-Span-1242\"><span style=\"display: inline-block; position: relative; width: 2.138em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.68em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1243\" style=\"font-family: STIXGeneral-Italic;\">C<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.68em;\"><span class=\"texatom\" id=\"MathJax-Span-1244\"><span class=\"mrow\" id=\"MathJax-Span-1245\"><span class=\"mtext\" id=\"MathJax-Span-1246\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">layer</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1247\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">≈</span><span class=\"mi\" id=\"MathJax-Span-1248\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.315em;\">O</span><span class=\"mo\" id=\"MathJax-Span-1249\" style=\"font-family: STIXGeneral-Regular;\">(</span><span class=\"mi\" id=\"MathJax-Span-1250\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1251\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.263em;\">⋅</span><span class=\"msubsup\" id=\"MathJax-Span-1252\" style=\"padding-left: 0.263em;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1253\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1000.42em, 4.169em, -999.997em); top: -4.372em; left: 0.576em;\"><span class=\"mn\" id=\"MathJax-Span-1254\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">2</span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; clip: rect(3.388em, 1001.83em, 4.169em, -999.997em); top: -3.695em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1255\"><span class=\"mrow\" id=\"MathJax-Span-1256\"><span class=\"mtext\" id=\"MathJax-Span-1257\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1258\" style=\"font-family: STIXGeneral-Regular;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.242em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.503em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><msub><mi>C</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>layer</mtext></mrow></msub><mo>≈</mo><mi>O</mi><mo stretchy=\"false\">(</mo><mi>L</mi><mo>⋅</mo><msubsup><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow><mn>2</mn></msubsup><mo stretchy=\"false\">)</mo></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-140\">C_{\\text{layer}} \\approx O(L \\cdot d_{\\text{model}}^2)</script>\n  </li>\n  <li>\n    <p>This implies:</p>\n\n    <ul>\n      <li>Increasing <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-141-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1259\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1260\"><span class=\"msubsup\" id=\"MathJax-Span-1261\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1262\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1263\"><span class=\"mrow\" id=\"MathJax-Span-1264\"><span class=\"mtext\" id=\"MathJax-Span-1265\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-141\">d_{\\text{model}}</script> scales <strong>both</strong> terms quadratically (via layers) and linearly (via vocab projection).</li>\n      <li>Increasing <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-142-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1266\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1267\"><span class=\"mi\" id=\"MathJax-Span-1268\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-142\">V</script> scales only the embedding/output projection term, but that term appears <strong>every decoding step</strong>.</li>\n      <li>Increasing <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-143-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1269\" style=\"width: 0.784em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.63em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1270\"><span class=\"mi\" id=\"MathJax-Span-1271\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>L</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-143\">L</script> increases sequential operations per token, which is critical for autoregressive decoding latency.</li>\n    </ul>\n  </li>\n</ul>\n<p>The <strong>layer cost</strong> per token is:</p>\n<p>This implies:</p>\n<ul>\n      <li>Increasing <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-141-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1259\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1260\"><span class=\"msubsup\" id=\"MathJax-Span-1261\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1262\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1263\"><span class=\"mrow\" id=\"MathJax-Span-1264\"><span class=\"mtext\" id=\"MathJax-Span-1265\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-141\">d_{\\text{model}}</script> scales <strong>both</strong> terms quadratically (via layers) and linearly (via vocab projection).</li>\n      <li>Increasing <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-142-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1266\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1267\"><span class=\"mi\" id=\"MathJax-Span-1268\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-142\">V</script> scales only the embedding/output projection term, but that term appears <strong>every decoding step</strong>.</li>\n      <li>Increasing <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-143-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1269\" style=\"width: 0.784em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.63em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1270\"><span class=\"mi\" id=\"MathJax-Span-1271\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>L</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-143\">L</script> increases sequential operations per token, which is critical for autoregressive decoding latency.</li>\n    </ul>\n<h4 id=\"interactions-in-practice\">Interactions in Practice</h4>\n<ul>\n  <li><strong>Large <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-144-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1272\" style=\"width: 0.932em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.777em; height: 0px; font-size: 121%;\"><span style=\"position: absolute; clip: rect(1.346em, 1000.78em, 2.327em, -999.997em); top: -2.167em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1273\"><span class=\"mi\" id=\"MathJax-Span-1274\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.054em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.172em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-144\">V</script> + Large <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-145-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1275\" style=\"width: 2.843em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.327em; height: 0px; font-size: 121%;\"><span style=\"position: absolute; clip: rect(1.294em, 1002.33em, 2.43em, -999.997em); top: -2.115em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1276\"><span class=\"msubsup\" id=\"MathJax-Span-1277\"><span style=\"display: inline-block; position: relative; width: 2.327em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.153em, 1000.52em, 4.135em, -999.997em); top: -3.975em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1278\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.054em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 3.98em;\"></span></span><span style=\"position: absolute; top: -3.82em; left: 0.519em;\"><span class=\"texatom\" id=\"MathJax-Span-1279\"><span class=\"mrow\" id=\"MathJax-Span-1280\"><span class=\"mtext\" id=\"MathJax-Span-1281\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 3.98em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.12em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-145\">d_{\\text{model}}</script></strong>: Output projection dominates decode latency, especially on memory-bound devices.</li>\n  <li><strong>Large <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-146-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1282\" style=\"width: 0.777em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.622em; height: 0px; font-size: 121%;\"><span style=\"position: absolute; clip: rect(1.346em, 1000.62em, 2.327em, -999.997em); top: -2.167em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1283\"><span class=\"mi\" id=\"MathJax-Span-1284\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.172em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>L</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-146\">L</script> + Long Sequence <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-147-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>n</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1285\" style=\"width: 0.622em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.519em; height: 0px; font-size: 121%;\"><span style=\"position: absolute; clip: rect(1.552em, 1000.47em, 2.327em, -999.997em); top: -2.167em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1286\"><span class=\"mi\" id=\"MathJax-Span-1287\" style=\"font-family: STIXGeneral-Italic;\">n</span></span><span style=\"display: inline-block; width: 0px; height: 2.172em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>n</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-147\">n</script></strong>: Prefill becomes a quadratic wall due to attention; decode slows due to sequential depth.</li>\n  <li><strong>Small <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-148-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1288\" style=\"width: 0.932em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.777em; height: 0px; font-size: 121%;\"><span style=\"position: absolute; clip: rect(1.346em, 1000.78em, 2.327em, -999.997em); top: -2.167em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1289\"><span class=\"mi\" id=\"MathJax-Span-1290\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.054em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.172em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-148\">V</script> + Small <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-149-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1291\" style=\"width: 2.843em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.327em; height: 0px; font-size: 121%;\"><span style=\"position: absolute; clip: rect(1.294em, 1002.33em, 2.43em, -999.997em); top: -2.115em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1292\"><span class=\"msubsup\" id=\"MathJax-Span-1293\"><span style=\"display: inline-block; position: relative; width: 2.327em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.153em, 1000.52em, 4.135em, -999.997em); top: -3.975em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1294\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.054em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 3.98em;\"></span></span><span style=\"position: absolute; top: -3.82em; left: 0.519em;\"><span class=\"texatom\" id=\"MathJax-Span-1295\"><span class=\"mrow\" id=\"MathJax-Span-1296\"><span class=\"mtext\" id=\"MathJax-Span-1297\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 3.98em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.12em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-149\">d_{\\text{model}}</script> + Moderate <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-150-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1298\" style=\"width: 0.777em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.622em; height: 0px; font-size: 121%;\"><span style=\"position: absolute; clip: rect(1.346em, 1000.62em, 2.327em, -999.997em); top: -2.167em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1299\"><span class=\"mi\" id=\"MathJax-Span-1300\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.172em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>L</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-150\">L</script></strong>: Often the sweet spot for edge devices — balanced compute and memory, but can sacrifice accuracy.</li>\n</ul>\n<h4 id=\"optimization-strategies-by-deployment-context\">Optimization Strategies by Deployment Context</h4>\n<ul>\n  <li>\n    <p><strong>Server (NanoGPT, TensorRT-LLM, vLLM, DeepSpeed-Inference)</strong>:</p>\n\n    <ul>\n      <li>High <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-151-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1301\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1302\"><span class=\"mi\" id=\"MathJax-Span-1303\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-151\">V</script>, high <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-152-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1304\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1305\"><span class=\"msubsup\" id=\"MathJax-Span-1306\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1307\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1308\"><span class=\"mrow\" id=\"MathJax-Span-1309\"><span class=\"mtext\" id=\"MathJax-Span-1310\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-152\">d_{\\text{model}}</script>, large <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-153-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1311\" style=\"width: 0.784em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.63em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1312\"><span class=\"mi\" id=\"MathJax-Span-1313\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>L</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-153\">L</script> are fine if GPUs are saturated.</li>\n      <li>Use fused output softmax kernels and half-precision Tensor Core paths.</li>\n      <li>Speculative decoding helps mitigate large <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-154-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1314\" style=\"width: 0.784em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.63em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1315\"><span class=\"mi\" id=\"MathJax-Span-1316\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>L</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-154\">L</script> in decode.</li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>On-Device CPU (<code class=\"language-plaintext highlighter-rouge\">llama.cpp</code>, GGML, ONNX Runtime Mobile)</strong>:</p>\n\n    <ul>\n      <li>Reduce <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-155-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1317\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1318\"><span class=\"mi\" id=\"MathJax-Span-1319\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-155\">V</script> aggressively to cut output projection cost.</li>\n      <li>Moderate <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-156-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1320\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1321\"><span class=\"msubsup\" id=\"MathJax-Span-1322\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1323\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1324\"><span class=\"mrow\" id=\"MathJax-Span-1325\"><span class=\"mtext\" id=\"MathJax-Span-1326\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-156\">d_{\\text{model}}</script> (512–1024) to keep KV cache and GEMMs manageable.</li>\n      <li>Lower <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-157-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1327\" style=\"width: 0.784em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.63em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1328\"><span class=\"mi\" id=\"MathJax-Span-1329\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>L</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-157\">L</script> to speed sequential decode; apply quantization (<code class=\"language-plaintext highlighter-rouge\">int8</code>/<code class=\"language-plaintext highlighter-rouge\">int4</code>) to fit in RAM.</li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Edge NPU (LidarTLM, MediaPipe + TFLite LLMs, Qualcomm AI Engine Direct)</strong>:</p>\n\n    <ul>\n      <li>Task-specific <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-158-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1330\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1331\"><span class=\"mi\" id=\"MathJax-Span-1332\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-158\">V</script> (often &lt;10k) to minimize projection latency.</li>\n      <li>Small <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-159-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1333\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1334\"><span class=\"msubsup\" id=\"MathJax-Span-1335\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1336\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1337\"><span class=\"mrow\" id=\"MathJax-Span-1338\"><span class=\"mtext\" id=\"MathJax-Span-1339\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-159\">d_{\\text{model}}</script> (256–512) for throughput under strict power budgets.</li>\n      <li>Shallow <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-160-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1340\" style=\"width: 0.784em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.63em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1341\"><span class=\"mi\" id=\"MathJax-Span-1342\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>L</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-160\">L</script> (4–8) to ensure deterministic real-time latency for sensor fusion loops.</li>\n    </ul>\n  </li>\n</ul>\n<p><strong>Server (NanoGPT, TensorRT-LLM, vLLM, DeepSpeed-Inference)</strong>:</p>\n<ul>\n      <li>High <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-151-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1301\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1302\"><span class=\"mi\" id=\"MathJax-Span-1303\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-151\">V</script>, high <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-152-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1304\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1305\"><span class=\"msubsup\" id=\"MathJax-Span-1306\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1307\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1308\"><span class=\"mrow\" id=\"MathJax-Span-1309\"><span class=\"mtext\" id=\"MathJax-Span-1310\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-152\">d_{\\text{model}}</script>, large <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-153-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1311\" style=\"width: 0.784em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.63em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1312\"><span class=\"mi\" id=\"MathJax-Span-1313\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>L</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-153\">L</script> are fine if GPUs are saturated.</li>\n      <li>Use fused output softmax kernels and half-precision Tensor Core paths.</li>\n      <li>Speculative decoding helps mitigate large <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-154-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1314\" style=\"width: 0.784em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.63em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1315\"><span class=\"mi\" id=\"MathJax-Span-1316\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>L</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-154\">L</script> in decode.</li>\n    </ul>\n<p><strong>On-Device CPU (<code class=\"language-plaintext highlighter-rouge\">llama.cpp</code>, GGML, ONNX Runtime Mobile)</strong>:</p>\n<ul>\n      <li>Reduce <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-155-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1317\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1318\"><span class=\"mi\" id=\"MathJax-Span-1319\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-155\">V</script> aggressively to cut output projection cost.</li>\n      <li>Moderate <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-156-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1320\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1321\"><span class=\"msubsup\" id=\"MathJax-Span-1322\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1323\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1324\"><span class=\"mrow\" id=\"MathJax-Span-1325\"><span class=\"mtext\" id=\"MathJax-Span-1326\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-156\">d_{\\text{model}}</script> (512–1024) to keep KV cache and GEMMs manageable.</li>\n      <li>Lower <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-157-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1327\" style=\"width: 0.784em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.63em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1328\"><span class=\"mi\" id=\"MathJax-Span-1329\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>L</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-157\">L</script> to speed sequential decode; apply quantization (<code class=\"language-plaintext highlighter-rouge\">int8</code>/<code class=\"language-plaintext highlighter-rouge\">int4</code>) to fit in RAM.</li>\n    </ul>\n<p><strong>Edge NPU (LidarTLM, MediaPipe + TFLite LLMs, Qualcomm AI Engine Direct)</strong>:</p>\n<ul>\n      <li>Task-specific <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-158-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1330\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1331\"><span class=\"mi\" id=\"MathJax-Span-1332\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-158\">V</script> (often &lt;10k) to minimize projection latency.</li>\n      <li>Small <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-159-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1333\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1334\"><span class=\"msubsup\" id=\"MathJax-Span-1335\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1336\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1337\"><span class=\"mrow\" id=\"MathJax-Span-1338\"><span class=\"mtext\" id=\"MathJax-Span-1339\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-159\">d_{\\text{model}}</script> (256–512) for throughput under strict power budgets.</li>\n      <li>Shallow <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-160-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1340\" style=\"width: 0.784em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.63em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1341\"><span class=\"mi\" id=\"MathJax-Span-1342\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>L</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-160\">L</script> (4–8) to ensure deterministic real-time latency for sensor fusion loops.</li>\n    </ul>\n<h4 id=\"tradeoffs\">Tradeoffs</h4>\n<ul>\n  <li>Reducing <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-161-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1343\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1344\"><span class=\"mi\" id=\"MathJax-Span-1345\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-161\">V</script> trades fewer softmax FLOPs for longer token sequences (more steps).</li>\n  <li>Reducing <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-162-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1346\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1347\"><span class=\"msubsup\" id=\"MathJax-Span-1348\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1349\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1350\"><span class=\"mrow\" id=\"MathJax-Span-1351\"><span class=\"mtext\" id=\"MathJax-Span-1352\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-162\">d_{\\text{model}}</script> cuts compute cost per layer but reduces representation power.</li>\n  <li>Reducing <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-163-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1353\" style=\"width: 0.784em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.63em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1354\"><span class=\"mi\" id=\"MathJax-Span-1355\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>L</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-163\">L</script> cuts sequential latency but lowers reasoning depth and long-context handling.</li>\n</ul>",
    "contentMarkdown": "*   So far, we’ve treated vocabulary size VVV, embedding size dmodeldmodeld\\_{\\\\text{model}}, and depth LLL mostly in isolation. In reality, these parameters interact in ways that compound runtime and memory demands.\n\n#### Compound Parameter Scaling\n\n*   By examining the compute vs. memory analysis for [tokenizer and vocabulary size](#tokenizer-and-vocabulary-size), [model/embedding size dmodeldmodeld\\_{model}](#modelembedding-dimension), [sequence length and KV cache size](#sequence-length-and-kv-cache-size), and [model parameter count and depth LLL](#parameter-count-and-model-depth), a decoder-only transformer’s **core parameter count** is approximately:\n\nPtotal≈V⋅dmodel+L⋅(12⋅d2model)Ptotal≈V⋅dmodel+L⋅(12⋅dmodel2)\n\n*   The **output projection cost** per token is:\n\nCout≈O(V⋅dmodel)Cout≈O(V⋅dmodel)\n\n*   The **layer cost** per token is:\n    \n*   Clayer≈O(L⋅d2model)Clayer≈O(L⋅dmodel2)\n    \n    C\\_{\\\\text{layer}} \\\\approx O(L \\\\cdot d\\_{\\\\text{model}}^2)\n*   This implies:\n    \n    *   Increasing dmodeldmodeld\\_{\\\\text{model}} scales **both** terms quadratically (via layers) and linearly (via vocab projection).\n    *   Increasing VVV scales only the embedding/output projection term, but that term appears **every decoding step**.\n    *   Increasing LLL increases sequential operations per token, which is critical for autoregressive decoding latency.\n\nThe **layer cost** per token is:\n\nThis implies:\n\n*   Increasing dmodeldmodeld\\_{\\\\text{model}} scales **both** terms quadratically (via layers) and linearly (via vocab projection).\n*   Increasing VVV scales only the embedding/output projection term, but that term appears **every decoding step**.\n*   Increasing LLL increases sequential operations per token, which is critical for autoregressive decoding latency.\n\n#### Interactions in Practice\n\n*   **Large VVV + Large dmodeldmodeld\\_{\\\\text{model}}**: Output projection dominates decode latency, especially on memory-bound devices.\n*   **Large LLL + Long Sequence nnn**: Prefill becomes a quadratic wall due to attention; decode slows due to sequential depth.\n*   **Small VVV + Small dmodeldmodeld\\_{\\\\text{model}} + Moderate LLL**: Often the sweet spot for edge devices — balanced compute and memory, but can sacrifice accuracy.\n\n#### Optimization Strategies by Deployment Context\n\n*   **Server (NanoGPT, TensorRT-LLM, vLLM, DeepSpeed-Inference)**:\n    \n    *   High VVV, high dmodeldmodeld\\_{\\\\text{model}}, large LLL are fine if GPUs are saturated.\n    *   Use fused output softmax kernels and half-precision Tensor Core paths.\n    *   Speculative decoding helps mitigate large LLL in decode.\n*   **On-Device CPU (`llama.cpp`, GGML, ONNX Runtime Mobile)**:\n    \n    *   Reduce VVV aggressively to cut output projection cost.\n    *   Moderate dmodeldmodeld\\_{\\\\text{model}} (512–1024) to keep KV cache and GEMMs manageable.\n    *   Lower LLL to speed sequential decode; apply quantization (`int8`/`int4`) to fit in RAM.\n*   **Edge NPU (LidarTLM, MediaPipe + TFLite LLMs, Qualcomm AI Engine Direct)**:\n    \n    *   Task-specific VVV (often <10k) to minimize projection latency.\n    *   Small dmodeldmodeld\\_{\\\\text{model}} (256–512) for throughput under strict power budgets.\n    *   Shallow LLL (4–8) to ensure deterministic real-time latency for sensor fusion loops.\n\n**Server (NanoGPT, TensorRT-LLM, vLLM, DeepSpeed-Inference)**:\n\n*   High VVV, high dmodeldmodeld\\_{\\\\text{model}}, large LLL are fine if GPUs are saturated.\n*   Use fused output softmax kernels and half-precision Tensor Core paths.\n*   Speculative decoding helps mitigate large LLL in decode.\n\n**On-Device CPU (`llama.cpp`, GGML, ONNX Runtime Mobile)**:\n\n*   Reduce VVV aggressively to cut output projection cost.\n*   Moderate dmodeldmodeld\\_{\\\\text{model}} (512–1024) to keep KV cache and GEMMs manageable.\n*   Lower LLL to speed sequential decode; apply quantization (`int8`/`int4`) to fit in RAM.\n\n**Edge NPU (LidarTLM, MediaPipe + TFLite LLMs, Qualcomm AI Engine Direct)**:\n\n*   Task-specific VVV (often <10k) to minimize projection latency.\n*   Small dmodeldmodeld\\_{\\\\text{model}} (256–512) for throughput under strict power budgets.\n*   Shallow LLL (4–8) to ensure deterministic real-time latency for sensor fusion loops.\n\n#### Tradeoffs\n\n*   Reducing VVV trades fewer softmax FLOPs for longer token sequences (more steps).\n*   Reducing dmodeldmodeld\\_{\\\\text{model}} cuts compute cost per layer but reduces representation power.\n*   Reducing LLL cuts sequential latency but lowers reasoning depth and long-context handling.",
    "contentLength": 84330,
    "wordCount": 554,
    "hasCode": true,
    "hasMath": true,
    "hasImages": false,
    "url": "https://aman.ai/primers/ai/on-device-transformers/#embedding-size-××\\times-vocabulary-size-××\\times-depth"
  },
  {
    "id": "ai-on-device-transformers-parameter-tuning-recipes-for-ml-runtimes-27",
    "articleSlug": "on-device-transformers",
    "articleTitle": "On-device Transformers",
    "category": "On-Device AI",
    "chapter": "Parameter Choices and Their Runtime Implications in Transformer Architectures",
    "title": "Parameter Tuning Recipes for ML Runtimes",
    "order": 27,
    "orderInChapter": 6,
    "contentHtml": "<ul>\n  <li>This section distills the relationships between vocabulary size <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-164-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1356\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1357\"><span class=\"mi\" id=\"MathJax-Span-1358\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-164\">V</script>, embedding size <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-165-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1359\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1360\"><span class=\"msubsup\" id=\"MathJax-Span-1361\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1362\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1363\"><span class=\"mrow\" id=\"MathJax-Span-1364\"><span class=\"mtext\" id=\"MathJax-Span-1365\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-165\">d_{\\text{model}}</script>, and depth <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-166-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1366\" style=\"width: 0.784em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.63em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1367\"><span class=\"mi\" id=\"MathJax-Span-1368\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>L</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-166\">L</script> into actionable configurations, balancing accuracy, latency, and memory for three representative environments.</li>\n</ul>\n<h4 id=\"nanogpt-server-inference--gpu-centric\">NanoGPT (Server Inference / GPU-centric)</h4>\n<ul>\n  <li><strong>Hardware Context:</strong> High-bandwidth memory (HBM), tensor cores, strong batched throughput.</li>\n  <li>\n    <p><strong>Parameter Priorities:</strong></p>\n\n    <ul>\n      <li>Large <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-167-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1369\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1370\"><span class=\"mi\" id=\"MathJax-Span-1371\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-167\">V</script> (30k–50k) acceptable due to fused softmax and fast GEMM kernels.</li>\n      <li>High <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-168-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1372\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1373\"><span class=\"msubsup\" id=\"MathJax-Span-1374\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1375\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1376\"><span class=\"mrow\" id=\"MathJax-Span-1377\"><span class=\"mtext\" id=\"MathJax-Span-1378\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-168\">d_{\\text{model}}</script> (1536–2048) to maximize model capacity.</li>\n      <li>Deep <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-169-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1379\" style=\"width: 0.784em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.63em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1380\"><span class=\"mi\" id=\"MathJax-Span-1381\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>L</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-169\">L</script> (24–48) for reasoning and long-context tasks.</li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Typical Config:</strong></p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-170-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>V</mi><mo>=</mo><mn>50,000</mn><mo>,</mo><mspace width=&quot;1em&quot; /><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub><mo>=</mo><mn>2048</mn><mo>,</mo><mspace width=&quot;1em&quot; /><mi>L</mi><mo>=</mo><mn>36</mn><mo>,</mo><mspace width=&quot;1em&quot; /><mtext>seq len</mtext><mo>=</mo><mn>4096</mn></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1382\" style=\"width: 28.701em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 23.909em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1023.86em, 2.555em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1383\"><span class=\"mi\" id=\"MathJax-Span-1384\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1385\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-1386\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">50,000</span><span class=\"mo\" id=\"MathJax-Span-1387\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mspace\" id=\"MathJax-Span-1388\" style=\"height: 0em; vertical-align: 0em; width: 1.148em; display: inline-block; overflow: hidden;\"></span><span class=\"msubsup\" id=\"MathJax-Span-1389\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1390\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1391\"><span class=\"mrow\" id=\"MathJax-Span-1392\"><span class=\"mtext\" id=\"MathJax-Span-1393\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1394\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-1395\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">2048</span><span class=\"mo\" id=\"MathJax-Span-1396\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mspace\" id=\"MathJax-Span-1397\" style=\"height: 0em; vertical-align: 0em; width: 1.148em; display: inline-block; overflow: hidden;\"></span><span class=\"mi\" id=\"MathJax-Span-1398\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.211em;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1399\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-1400\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">36</span><span class=\"mo\" id=\"MathJax-Span-1401\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mspace\" id=\"MathJax-Span-1402\" style=\"height: 0em; vertical-align: 0em; width: 1.148em; display: inline-block; overflow: hidden;\"></span><span class=\"mtext\" id=\"MathJax-Span-1403\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">seq len</span><span class=\"mo\" id=\"MathJax-Span-1404\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-1405\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">4096</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mi>V</mi><mo>=</mo><mn>50,000</mn><mo>,</mo><mspace width=\"1em\"></mspace><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub><mo>=</mo><mn>2048</mn><mo>,</mo><mspace width=\"1em\"></mspace><mi>L</mi><mo>=</mo><mn>36</mn><mo>,</mo><mspace width=\"1em\"></mspace><mtext>seq len</mtext><mo>=</mo><mn>4096</mn></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-170\">V = 50{,}000, \\quad d_{\\text{model}} = 2048, \\quad L = 36, \\quad \\text{seq len} = 4096</script>\n  </li>\n  <li>\n    <p><strong>Expected Behavior:</strong></p>\n\n    <ul>\n      <li>Prefill dominated by attention FLOPs, but GPUs handle with parallelization.</li>\n      <li>Decode latency per token low in absolute terms due to high raw throughput, but still benefits from speculative decoding.</li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Optimization Levers:</strong></p>\n\n    <ul>\n      <li>Mixed precision (<code class=\"language-plaintext highlighter-rouge\">float16</code>/<code class=\"language-plaintext highlighter-rouge\">bfloat16</code>).</li>\n      <li>Layer fusion (e.g., FasterTransformer).</li>\n      <li>Batch multiple decode streams to utilize GPU fully.</li>\n    </ul>\n  </li>\n</ul>\n<p><strong>Parameter Priorities:</strong></p>\n<ul>\n      <li>Large <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-167-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1369\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1370\"><span class=\"mi\" id=\"MathJax-Span-1371\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-167\">V</script> (30k–50k) acceptable due to fused softmax and fast GEMM kernels.</li>\n      <li>High <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-168-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1372\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1373\"><span class=\"msubsup\" id=\"MathJax-Span-1374\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1375\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1376\"><span class=\"mrow\" id=\"MathJax-Span-1377\"><span class=\"mtext\" id=\"MathJax-Span-1378\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-168\">d_{\\text{model}}</script> (1536–2048) to maximize model capacity.</li>\n      <li>Deep <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-169-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1379\" style=\"width: 0.784em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.63em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1380\"><span class=\"mi\" id=\"MathJax-Span-1381\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>L</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-169\">L</script> (24–48) for reasoning and long-context tasks.</li>\n    </ul>\n<p><strong>Typical Config:</strong></p>\n<p><strong>Expected Behavior:</strong></p>\n<ul>\n      <li>Prefill dominated by attention FLOPs, but GPUs handle with parallelization.</li>\n      <li>Decode latency per token low in absolute terms due to high raw throughput, but still benefits from speculative decoding.</li>\n    </ul>\n<p><strong>Optimization Levers:</strong></p>\n<ul>\n      <li>Mixed precision (<code class=\"language-plaintext highlighter-rouge\">float16</code>/<code class=\"language-plaintext highlighter-rouge\">bfloat16</code>).</li>\n      <li>Layer fusion (e.g., FasterTransformer).</li>\n      <li>Batch multiple decode streams to utilize GPU fully.</li>\n    </ul>\n<h4 id=\"vllm-server-inference--gpu-centric\">VLLM (Server Inference / GPU-centric)</h4>\n<ul>\n  <li><strong>Hardware Context:</strong> GPU servers optimized for dynamic batching.</li>\n  <li>\n    <p><strong>Parameter Priorities:</strong></p>\n\n    <ul>\n      <li>Large <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-171-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1406\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1407\"><span class=\"mi\" id=\"MathJax-Span-1408\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-171\">V</script> acceptable with efficient memory layouts.</li>\n      <li>High <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-172-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1409\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1410\"><span class=\"msubsup\" id=\"MathJax-Span-1411\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1412\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1413\"><span class=\"mrow\" id=\"MathJax-Span-1414\"><span class=\"mtext\" id=\"MathJax-Span-1415\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-172\">d_{\\text{model}}</script> paired with aggressive continuous batching.</li>\n      <li>Depth <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-173-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1416\" style=\"width: 0.784em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.63em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1417\"><span class=\"mi\" id=\"MathJax-Span-1418\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>L</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-173\">L</script> tuned for target latency vs throughput.</li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Optimization Levers:</strong></p>\n\n    <ul>\n      <li>Continuous batching to keep GPU fully utilized.</li>\n      <li>KV cache sharing across requests.</li>\n    </ul>\n  </li>\n</ul>\n<p><strong>Parameter Priorities:</strong></p>\n<ul>\n      <li>Large <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-171-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1406\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1407\"><span class=\"mi\" id=\"MathJax-Span-1408\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-171\">V</script> acceptable with efficient memory layouts.</li>\n      <li>High <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-172-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1409\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1410\"><span class=\"msubsup\" id=\"MathJax-Span-1411\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1412\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1413\"><span class=\"mrow\" id=\"MathJax-Span-1414\"><span class=\"mtext\" id=\"MathJax-Span-1415\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-172\">d_{\\text{model}}</script> paired with aggressive continuous batching.</li>\n      <li>Depth <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-173-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1416\" style=\"width: 0.784em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.63em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1417\"><span class=\"mi\" id=\"MathJax-Span-1418\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>L</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-173\">L</script> tuned for target latency vs throughput.</li>\n    </ul>\n<p><strong>Optimization Levers:</strong></p>\n<ul>\n      <li>Continuous batching to keep GPU fully utilized.</li>\n      <li>KV cache sharing across requests.</li>\n    </ul>\n<h4 id=\"tensorrt-llm-server-inference--gpu-centric\">TensorRT-LLM (Server Inference / GPU-centric)</h4>\n<ul>\n  <li><strong>Hardware Context:</strong> NVIDIA GPUs with Tensor Cores and high-bandwidth memory.</li>\n  <li>\n    <p><strong>Parameter Priorities:</strong></p>\n\n    <ul>\n      <li>Large <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-174-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1419\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1420\"><span class=\"mi\" id=\"MathJax-Span-1421\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-174\">V</script> (up to 100k) supported with minimal softmax overhead via fused kernels.</li>\n      <li>High <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-175-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1422\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1423\"><span class=\"msubsup\" id=\"MathJax-Span-1424\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1425\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1426\"><span class=\"mrow\" id=\"MathJax-Span-1427\"><span class=\"mtext\" id=\"MathJax-Span-1428\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-175\">d_{\\text{model}}</script> (up to 4096) leveraged for accuracy without extreme latency.</li>\n      <li>Moderate-to-deep <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-176-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1429\" style=\"width: 0.784em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.63em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1430\"><span class=\"mi\" id=\"MathJax-Span-1431\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>L</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-176\">L</script> (20–48) manageable due to high parallelism.</li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Typical Config:</strong></p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-177-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>V</mi><mo>=</mo><mn>80,000</mn><mo>,</mo><mspace width=&quot;1em&quot; /><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub><mo>=</mo><mn>3072</mn><mo>,</mo><mspace width=&quot;1em&quot; /><mi>L</mi><mo>=</mo><mn>40</mn><mo>,</mo><mspace width=&quot;1em&quot; /><mtext>seq len</mtext><mo>=</mo><mn>8192</mn></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1432\" style=\"width: 28.701em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 23.909em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1023.91em, 2.555em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1433\"><span class=\"mi\" id=\"MathJax-Span-1434\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1435\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-1436\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">80,000</span><span class=\"mo\" id=\"MathJax-Span-1437\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mspace\" id=\"MathJax-Span-1438\" style=\"height: 0em; vertical-align: 0em; width: 1.148em; display: inline-block; overflow: hidden;\"></span><span class=\"msubsup\" id=\"MathJax-Span-1439\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1440\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1441\"><span class=\"mrow\" id=\"MathJax-Span-1442\"><span class=\"mtext\" id=\"MathJax-Span-1443\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1444\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-1445\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">3072</span><span class=\"mo\" id=\"MathJax-Span-1446\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mspace\" id=\"MathJax-Span-1447\" style=\"height: 0em; vertical-align: 0em; width: 1.148em; display: inline-block; overflow: hidden;\"></span><span class=\"mi\" id=\"MathJax-Span-1448\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.211em;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1449\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-1450\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">40</span><span class=\"mo\" id=\"MathJax-Span-1451\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mspace\" id=\"MathJax-Span-1452\" style=\"height: 0em; vertical-align: 0em; width: 1.148em; display: inline-block; overflow: hidden;\"></span><span class=\"mtext\" id=\"MathJax-Span-1453\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">seq len</span><span class=\"mo\" id=\"MathJax-Span-1454\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-1455\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">8192</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mi>V</mi><mo>=</mo><mn>80,000</mn><mo>,</mo><mspace width=\"1em\"></mspace><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub><mo>=</mo><mn>3072</mn><mo>,</mo><mspace width=\"1em\"></mspace><mi>L</mi><mo>=</mo><mn>40</mn><mo>,</mo><mspace width=\"1em\"></mspace><mtext>seq len</mtext><mo>=</mo><mn>8192</mn></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-177\">V = 80{,}000, \\quad d_{\\text{model}} = 3072, \\quad L = 40, \\quad \\text{seq len} = 8192</script>\n  </li>\n  <li>\n    <p><strong>Optimization Levers:</strong></p>\n\n    <ul>\n      <li>Tensor Core–optimized mixed-precision GEMM.</li>\n      <li>Fused attention and output projection.</li>\n    </ul>\n  </li>\n</ul>\n<p><strong>Parameter Priorities:</strong></p>\n<ul>\n      <li>Large <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-174-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1419\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1420\"><span class=\"mi\" id=\"MathJax-Span-1421\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-174\">V</script> (up to 100k) supported with minimal softmax overhead via fused kernels.</li>\n      <li>High <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-175-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1422\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1423\"><span class=\"msubsup\" id=\"MathJax-Span-1424\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1425\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1426\"><span class=\"mrow\" id=\"MathJax-Span-1427\"><span class=\"mtext\" id=\"MathJax-Span-1428\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-175\">d_{\\text{model}}</script> (up to 4096) leveraged for accuracy without extreme latency.</li>\n      <li>Moderate-to-deep <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-176-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1429\" style=\"width: 0.784em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.63em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1430\"><span class=\"mi\" id=\"MathJax-Span-1431\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>L</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-176\">L</script> (20–48) manageable due to high parallelism.</li>\n    </ul>\n<p><strong>Typical Config:</strong></p>\n<p><strong>Optimization Levers:</strong></p>\n<ul>\n      <li>Tensor Core–optimized mixed-precision GEMM.</li>\n      <li>Fused attention and output projection.</li>\n    </ul>\n<h4 id=\"llamacpp-on-device-inference--cpu-centric\"><code class=\"language-plaintext Highlighter-rouge\">llama.cpp</code> (On-Device Inference / CPU-centric)</h4>\n<ul>\n  <li><strong>Hardware Context:</strong> Commodity x86/ARM CPU, limited parallelism, cache-sensitive.</li>\n  <li>\n    <p><strong>Parameter Priorities:</strong></p>\n\n    <ul>\n      <li>Reduce <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-178-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1456\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1457\"><span class=\"mi\" id=\"MathJax-Span-1458\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-178\">V</script> (16k–32k) to keep output projection matrix small and cache-friendly.</li>\n      <li>Moderate <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-179-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1459\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1460\"><span class=\"msubsup\" id=\"MathJax-Span-1461\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1462\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1463\"><span class=\"mrow\" id=\"MathJax-Span-1464\"><span class=\"mtext\" id=\"MathJax-Span-1465\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-179\">d_{\\text{model}}</script> (512–1024) to keep KV cache within LLC.</li>\n      <li>Lower <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-180-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1466\" style=\"width: 0.784em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.63em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1467\"><span class=\"mi\" id=\"MathJax-Span-1468\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>L</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-180\">L</script> (8–16) to reduce sequential decode steps.</li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Typical Config:</strong></p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-181-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>V</mi><mo>=</mo><mn>32,000</mn><mo>,</mo><mspace width=&quot;1em&quot; /><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub><mo>=</mo><mn>768</mn><mo>,</mo><mspace width=&quot;1em&quot; /><mi>L</mi><mo>=</mo><mn>12</mn><mo>,</mo><mspace width=&quot;1em&quot; /><mtext>seq len</mtext><mo>=</mo><mn>1024</mn></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1469\" style=\"width: 28.076em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 23.388em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1023.34em, 2.555em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1470\"><span class=\"mi\" id=\"MathJax-Span-1471\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1472\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-1473\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">32,000</span><span class=\"mo\" id=\"MathJax-Span-1474\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mspace\" id=\"MathJax-Span-1475\" style=\"height: 0em; vertical-align: 0em; width: 1.148em; display: inline-block; overflow: hidden;\"></span><span class=\"msubsup\" id=\"MathJax-Span-1476\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1477\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1478\"><span class=\"mrow\" id=\"MathJax-Span-1479\"><span class=\"mtext\" id=\"MathJax-Span-1480\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1481\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-1482\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">768</span><span class=\"mo\" id=\"MathJax-Span-1483\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mspace\" id=\"MathJax-Span-1484\" style=\"height: 0em; vertical-align: 0em; width: 1.148em; display: inline-block; overflow: hidden;\"></span><span class=\"mi\" id=\"MathJax-Span-1485\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.211em;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1486\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-1487\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">12</span><span class=\"mo\" id=\"MathJax-Span-1488\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mspace\" id=\"MathJax-Span-1489\" style=\"height: 0em; vertical-align: 0em; width: 1.148em; display: inline-block; overflow: hidden;\"></span><span class=\"mtext\" id=\"MathJax-Span-1490\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">seq len</span><span class=\"mo\" id=\"MathJax-Span-1491\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-1492\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">1024</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mi>V</mi><mo>=</mo><mn>32,000</mn><mo>,</mo><mspace width=\"1em\"></mspace><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub><mo>=</mo><mn>768</mn><mo>,</mo><mspace width=\"1em\"></mspace><mi>L</mi><mo>=</mo><mn>12</mn><mo>,</mo><mspace width=\"1em\"></mspace><mtext>seq len</mtext><mo>=</mo><mn>1024</mn></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-181\">V = 32{,}000, \\quad d_{\\text{model}} = 768, \\quad L = 12, \\quad \\text{seq len} = 1024</script>\n  </li>\n  <li>\n    <p><strong>Expected Behavior:</strong></p>\n\n    <ul>\n      <li>Prefill latency noticeable with large <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-182-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>n</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1493\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1494\"><span class=\"mi\" id=\"MathJax-Span-1495\" style=\"font-family: STIXGeneral-Italic;\">n</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>n</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-182\">n</script>, but acceptable for short prompts.</li>\n      <li>Decode speed highly sensitive to <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-183-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1496\" style=\"width: 0.784em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.63em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1497\"><span class=\"mi\" id=\"MathJax-Span-1498\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>L</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-183\">L</script>% and KV cache fit.</li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Optimization Levers:</strong></p>\n\n    <ul>\n      <li>int8/int4 quantization.</li>\n      <li>Operator fusion (ONNX Runtime, GGML backend).</li>\n      <li>Cache-aware layout for KV storage.</li>\n    </ul>\n  </li>\n</ul>\n<p><strong>Parameter Priorities:</strong></p>\n<ul>\n      <li>Reduce <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-178-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1456\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1457\"><span class=\"mi\" id=\"MathJax-Span-1458\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-178\">V</script> (16k–32k) to keep output projection matrix small and cache-friendly.</li>\n      <li>Moderate <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-179-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1459\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1460\"><span class=\"msubsup\" id=\"MathJax-Span-1461\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1462\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1463\"><span class=\"mrow\" id=\"MathJax-Span-1464\"><span class=\"mtext\" id=\"MathJax-Span-1465\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-179\">d_{\\text{model}}</script> (512–1024) to keep KV cache within LLC.</li>\n      <li>Lower <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-180-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1466\" style=\"width: 0.784em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.63em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1467\"><span class=\"mi\" id=\"MathJax-Span-1468\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>L</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-180\">L</script> (8–16) to reduce sequential decode steps.</li>\n    </ul>\n<p><strong>Typical Config:</strong></p>\n<p><strong>Expected Behavior:</strong></p>\n<ul>\n      <li>Prefill latency noticeable with large <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-182-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>n</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1493\" style=\"width: 0.628em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.617em, 1000.52em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1494\"><span class=\"mi\" id=\"MathJax-Span-1495\" style=\"font-family: STIXGeneral-Italic;\">n</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>n</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-182\">n</script>, but acceptable for short prompts.</li>\n      <li>Decode speed highly sensitive to <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-183-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1496\" style=\"width: 0.784em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.63em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1497\"><span class=\"mi\" id=\"MathJax-Span-1498\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>L</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-183\">L</script>% and KV cache fit.</li>\n    </ul>\n<p><strong>Optimization Levers:</strong></p>\n<ul>\n      <li>int8/int4 quantization.</li>\n      <li>Operator fusion (ONNX Runtime, GGML backend).</li>\n      <li>Cache-aware layout for KV storage.</li>\n    </ul>\n<h4 id=\"lidartlm-edge-npu--sensor-fusion\">LidarTLM (Edge NPU / Sensor Fusion)</h4>\n<ul>\n  <li><strong>Hardware Context:</strong> Mobile/embedded NPU with strict SRAM and thermal limits.</li>\n  <li>\n    <p><strong>Parameter Priorities:</strong></p>\n\n    <ul>\n      <li>Task-specific <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-184-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1499\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1500\"><span class=\"mi\" id=\"MathJax-Span-1501\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-184\">V</script> (4k–10k) to minimize projection latency.</li>\n      <li>Small <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-185-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1502\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1503\"><span class=\"msubsup\" id=\"MathJax-Span-1504\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1505\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1506\"><span class=\"mrow\" id=\"MathJax-Span-1507\"><span class=\"mtext\" id=\"MathJax-Span-1508\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-185\">d_{\\text{model}}</script> (256–512) for real-time throughput.</li>\n      <li>Shallow <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-186-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1509\" style=\"width: 0.784em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.63em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1510\"><span class=\"mi\" id=\"MathJax-Span-1511\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>L</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-186\">L</script> (4–8) for deterministic frame-to-frame latency.</li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Typical Config:</strong></p>\n\n<span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><div class=\"MathJax_Display\" style=\"text-align: center;\"><span class=\"MathJax\" id=\"MathJax-Element-187-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>V</mi><mo>=</mo><mn>8,000</mn><mo>,</mo><mspace width=&quot;1em&quot; /><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub><mo>=</mo><mn>384</mn><mo>,</mo><mspace width=&quot;1em&quot; /><mi>L</mi><mo>=</mo><mn>6</mn><mo>,</mo><mspace width=&quot;1em&quot; /><mtext>seq len</mtext><mo>=</mo><mn>256</mn></math>\" role=\"presentation\" style=\"text-align: center; position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1512\" style=\"width: 26.253em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 21.878em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1021.83em, 2.555em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1513\"><span class=\"mi\" id=\"MathJax-Span-1514\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1515\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-1516\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">8,000</span><span class=\"mo\" id=\"MathJax-Span-1517\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mspace\" id=\"MathJax-Span-1518\" style=\"height: 0em; vertical-align: 0em; width: 1.148em; display: inline-block; overflow: hidden;\"></span><span class=\"msubsup\" id=\"MathJax-Span-1519\" style=\"padding-left: 0.211em;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1520\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1521\"><span class=\"mrow\" id=\"MathJax-Span-1522\"><span class=\"mtext\" id=\"MathJax-Span-1523\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-1524\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-1525\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">384</span><span class=\"mo\" id=\"MathJax-Span-1526\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mspace\" id=\"MathJax-Span-1527\" style=\"height: 0em; vertical-align: 0em; width: 1.148em; display: inline-block; overflow: hidden;\"></span><span class=\"mi\" id=\"MathJax-Span-1528\" style=\"font-family: STIXGeneral-Italic; padding-left: 0.211em;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-1529\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-1530\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">6</span><span class=\"mo\" id=\"MathJax-Span-1531\" style=\"font-family: STIXGeneral-Regular;\">,</span><span class=\"mspace\" id=\"MathJax-Span-1532\" style=\"height: 0em; vertical-align: 0em; width: 1.148em; display: inline-block; overflow: hidden;\"></span><span class=\"mtext\" id=\"MathJax-Span-1533\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.211em;\">seq len</span><span class=\"mo\" id=\"MathJax-Span-1534\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">=</span><span class=\"mn\" id=\"MathJax-Span-1535\" style=\"font-family: STIXGeneral-Regular; padding-left: 0.315em;\">256</span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML MJX_Assistive_MathML_Block\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mi>V</mi><mo>=</mo><mn>8,000</mn><mo>,</mo><mspace width=\"1em\"></mspace><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub><mo>=</mo><mn>384</mn><mo>,</mo><mspace width=\"1em\"></mspace><mi>L</mi><mo>=</mo><mn>6</mn><mo>,</mo><mspace width=\"1em\"></mspace><mtext>seq len</mtext><mo>=</mo><mn>256</mn></math></span></span></div><script type=\"math/tex; mode=display\" id=\"MathJax-Element-187\">V = 8{,}000, \\quad d_{\\text{model}} = 384, \\quad L = 6, \\quad \\text{seq len} = 256</script>\n  </li>\n  <li>\n    <p><strong>Expected Behavior:</strong></p>\n\n    <ul>\n      <li>Prefill and decode both complete well within a LiDAR frame budget (~33 ms).</li>\n      <li>KV cache fits entirely in on-chip SRAM, avoiding DRAM latency.</li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Optimization Levers:</strong></p>\n\n    <ul>\n      <li>Static <code class=\"language-plaintext highlighter-rouge\">int8</code> quantization.</li>\n      <li>Operator fusion tailored to NPU’s op-set.</li>\n      <li>Preallocation of all buffers to avoid runtime allocation overhead.</li>\n    </ul>\n  </li>\n</ul>\n<p><strong>Parameter Priorities:</strong></p>\n<ul>\n      <li>Task-specific <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-184-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1499\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1500\"><span class=\"mi\" id=\"MathJax-Span-1501\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-184\">V</script> (4k–10k) to minimize projection latency.</li>\n      <li>Small <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-185-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1502\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1503\"><span class=\"msubsup\" id=\"MathJax-Span-1504\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1505\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1506\"><span class=\"mrow\" id=\"MathJax-Span-1507\"><span class=\"mtext\" id=\"MathJax-Span-1508\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-185\">d_{\\text{model}}</script> (256–512) for real-time throughput.</li>\n      <li>Shallow <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-186-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1509\" style=\"width: 0.784em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.63em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1510\"><span class=\"mi\" id=\"MathJax-Span-1511\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>L</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-186\">L</script> (4–8) for deterministic frame-to-frame latency.</li>\n    </ul>\n<p><strong>Typical Config:</strong></p>\n<p><strong>Expected Behavior:</strong></p>\n<ul>\n      <li>Prefill and decode both complete well within a LiDAR frame budget (~33 ms).</li>\n      <li>KV cache fits entirely in on-chip SRAM, avoiding DRAM latency.</li>\n    </ul>\n<p><strong>Optimization Levers:</strong></p>\n<ul>\n      <li>Static <code class=\"language-plaintext highlighter-rouge\">int8</code> quantization.</li>\n      <li>Operator fusion tailored to NPU’s op-set.</li>\n      <li>Preallocation of all buffers to avoid runtime allocation overhead.</li>\n    </ul>\n<h4 id=\"mediapipe--tflite-llms-mobileedge-inference--specialized-ips-such-as-npusdsps\">MediaPipe + TFLite LLMs (Mobile/Edge Inference / Specialized IPs Such As NPUs/DSPs)</h4>\n<ul>\n  <li><strong>Hardware Context:</strong> Smartphone SoCs with NPUs/DSPs.</li>\n  <li>\n    <p><strong>Parameter Priorities:</strong></p>\n\n    <ul>\n      <li>Reduced <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-188-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1536\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1537\"><span class=\"mi\" id=\"MathJax-Span-1538\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-188\">V</script> (4k–8k) to fit projection in SRAM.</li>\n      <li>Small <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-189-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1539\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1540\"><span class=\"msubsup\" id=\"MathJax-Span-1541\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1542\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1543\"><span class=\"mrow\" id=\"MathJax-Span-1544\"><span class=\"mtext\" id=\"MathJax-Span-1545\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-189\">d_{\\text{model}}</script> (256–512) to fit memory and meet latency budgets.</li>\n      <li>Shallow <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-190-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1546\" style=\"width: 0.784em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.63em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1547\"><span class=\"mi\" id=\"MathJax-Span-1548\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>L</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-190\">L</script> for real-time responses.</li>\n    </ul>\n  </li>\n  <li>\n    <p><strong>Optimization Levers:</strong></p>\n\n    <ul>\n      <li>Fully quantized static graphs.</li>\n      <li>Operator fusion for NPU op-sets.</li>\n    </ul>\n  </li>\n</ul>\n<p><strong>Parameter Priorities:</strong></p>\n<ul>\n      <li>Reduced <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-188-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1536\" style=\"width: 0.94em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.784em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.78em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1537\"><span class=\"mi\" id=\"MathJax-Span-1538\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-188\">V</script> (4k–8k) to fit projection in SRAM.</li>\n      <li>Small <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-189-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1539\" style=\"width: 2.815em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.305em, 1002.35em, 2.451em, -999.997em); top: -2.133em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1540\"><span class=\"msubsup\" id=\"MathJax-Span-1541\"><span style=\"display: inline-block; position: relative; width: 2.346em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.18em, 1000.52em, 4.169em, -999.997em); top: -4.008em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1542\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.055em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span><span style=\"position: absolute; top: -3.852em; left: 0.523em;\"><span class=\"texatom\" id=\"MathJax-Span-1543\"><span class=\"mrow\" id=\"MathJax-Span-1544\"><span class=\"mtext\" id=\"MathJax-Span-1545\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.013em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.138em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-189\">d_{\\text{model}}</script> (256–512) to fit memory and meet latency budgets.</li>\n      <li>Shallow <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-190-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1546\" style=\"width: 0.784em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.628em; height: 0px; font-size: 120%;\"><span style=\"position: absolute; clip: rect(1.357em, 1000.63em, 2.346em, -999.997em); top: -2.185em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1547\"><span class=\"mi\" id=\"MathJax-Span-1548\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.19em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>L</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-190\">L</script> for real-time responses.</li>\n    </ul>\n<p><strong>Optimization Levers:</strong></p>\n<ul>\n      <li>Fully quantized static graphs.</li>\n      <li>Operator fusion for NPU op-sets.</li>\n    </ul>\n<h4 id=\"cross-platform-insights\">Cross-Platform Insights</h4>\n<ul>\n  <li><strong>Large <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-191-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1549\" style=\"width: 0.932em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.777em; height: 0px; font-size: 121%;\"><span style=\"position: absolute; clip: rect(1.346em, 1000.78em, 2.327em, -999.997em); top: -2.167em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1550\"><span class=\"mi\" id=\"MathJax-Span-1551\" style=\"font-family: STIXGeneral-Italic;\">V<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.054em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.172em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>V</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-191\">V</script></strong>: Fine on GPU servers, problematic for CPU/NPU without GEMM acceleration.</li>\n  <li><strong>Large <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-192-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>model</mtext></mrow></msub></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1552\" style=\"width: 2.843em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.327em; height: 0px; font-size: 121%;\"><span style=\"position: absolute; clip: rect(1.294em, 1002.33em, 2.43em, -999.997em); top: -2.115em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1553\"><span class=\"msubsup\" id=\"MathJax-Span-1554\"><span style=\"display: inline-block; position: relative; width: 2.327em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.153em, 1000.52em, 4.135em, -999.997em); top: -3.975em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-1555\" style=\"font-family: STIXGeneral-Italic;\">d<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.054em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 3.98em;\"></span></span><span style=\"position: absolute; top: -3.82em; left: 0.519em;\"><span class=\"texatom\" id=\"MathJax-Span-1556\"><span class=\"mrow\" id=\"MathJax-Span-1557\"><span class=\"mtext\" id=\"MathJax-Span-1558\" style=\"font-size: 70.7%; font-family: STIXGeneral-Regular;\">model</span></span></span><span style=\"display: inline-block; width: 0px; height: 3.98em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.12em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>d</mi><mrow class=\"MJX-TeXAtom-ORD\"><mtext>model</mtext></mrow></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-192\">d_{\\text{model}}</script></strong>: Improves accuracy but hurts both memory and compute — only viable if hardware bandwidth is high.</li>\n  <li><strong>Large <span class=\"MathJax_Preview\" style=\"color: inherit; display: none;\"></span><span class=\"MathJax\" id=\"MathJax-Element-193-Frame\" tabindex=\"0\" data-mathml=\"<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi></math>\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1559\" style=\"width: 0.777em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.622em; height: 0px; font-size: 121%;\"><span style=\"position: absolute; clip: rect(1.346em, 1000.62em, 2.327em, -999.997em); top: -2.167em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-1560\"><span class=\"mi\" id=\"MathJax-Span-1561\" style=\"font-family: STIXGeneral-Italic;\">L<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.172em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>L</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-193\">L</script></strong>: Boosts reasoning but increases decode latency linearly — worst-case for low-parallelism CPUs.</li>\n  <li><strong>Temperature</strong>: Has <strong>zero impact</strong> on runtime — safe to tune purely for output diversity.</li>\n</ul>",
    "contentMarkdown": "*   This section distills the relationships between vocabulary size VVV, embedding size dmodeldmodeld\\_{\\\\text{model}}, and depth LLL into actionable configurations, balancing accuracy, latency, and memory for three representative environments.\n\n#### NanoGPT (Server Inference / GPU-centric)\n\n*   **Hardware Context:** High-bandwidth memory (HBM), tensor cores, strong batched throughput.\n*   **Parameter Priorities:**\n    \n    *   Large VVV (30k–50k) acceptable due to fused softmax and fast GEMM kernels.\n    *   High dmodeldmodeld\\_{\\\\text{model}} (1536–2048) to maximize model capacity.\n    *   Deep LLL (24–48) for reasoning and long-context tasks.\n*   **Typical Config:**\n    \n    V\\=50,000,dmodel\\=2048,L\\=36,seq len\\=4096V\\=50,000,dmodel\\=2048,L\\=36,seq len\\=4096\n    \n    V = 50{,}000, \\\\quad d\\_{\\\\text{model}} = 2048, \\\\quad L = 36, \\\\quad \\\\text{seq len} = 4096\n*   **Expected Behavior:**\n    \n    *   Prefill dominated by attention FLOPs, but GPUs handle with parallelization.\n    *   Decode latency per token low in absolute terms due to high raw throughput, but still benefits from speculative decoding.\n*   **Optimization Levers:**\n    \n    *   Mixed precision (`float16`/`bfloat16`).\n    *   Layer fusion (e.g., FasterTransformer).\n    *   Batch multiple decode streams to utilize GPU fully.\n\n**Parameter Priorities:**\n\n*   Large VVV (30k–50k) acceptable due to fused softmax and fast GEMM kernels.\n*   High dmodeldmodeld\\_{\\\\text{model}} (1536–2048) to maximize model capacity.\n*   Deep LLL (24–48) for reasoning and long-context tasks.\n\n**Typical Config:**\n\n**Expected Behavior:**\n\n*   Prefill dominated by attention FLOPs, but GPUs handle with parallelization.\n*   Decode latency per token low in absolute terms due to high raw throughput, but still benefits from speculative decoding.\n\n**Optimization Levers:**\n\n*   Mixed precision (`float16`/`bfloat16`).\n*   Layer fusion (e.g., FasterTransformer).\n*   Batch multiple decode streams to utilize GPU fully.\n\n#### VLLM (Server Inference / GPU-centric)\n\n*   **Hardware Context:** GPU servers optimized for dynamic batching.\n*   **Parameter Priorities:**\n    \n    *   Large VVV acceptable with efficient memory layouts.\n    *   High dmodeldmodeld\\_{\\\\text{model}} paired with aggressive continuous batching.\n    *   Depth LLL tuned for target latency vs throughput.\n*   **Optimization Levers:**\n    \n    *   Continuous batching to keep GPU fully utilized.\n    *   KV cache sharing across requests.\n\n**Parameter Priorities:**\n\n*   Large VVV acceptable with efficient memory layouts.\n*   High dmodeldmodeld\\_{\\\\text{model}} paired with aggressive continuous batching.\n*   Depth LLL tuned for target latency vs throughput.\n\n**Optimization Levers:**\n\n*   Continuous batching to keep GPU fully utilized.\n*   KV cache sharing across requests.\n\n#### TensorRT-LLM (Server Inference / GPU-centric)\n\n*   **Hardware Context:** NVIDIA GPUs with Tensor Cores and high-bandwidth memory.\n*   **Parameter Priorities:**\n    \n    *   Large VVV (up to 100k) supported with minimal softmax overhead via fused kernels.\n    *   High dmodeldmodeld\\_{\\\\text{model}} (up to 4096) leveraged for accuracy without extreme latency.\n    *   Moderate-to-deep LLL (20–48) manageable due to high parallelism.\n*   **Typical Config:**\n    \n    V\\=80,000,dmodel\\=3072,L\\=40,seq len\\=8192V\\=80,000,dmodel\\=3072,L\\=40,seq len\\=8192\n    \n    V = 80{,}000, \\\\quad d\\_{\\\\text{model}} = 3072, \\\\quad L = 40, \\\\quad \\\\text{seq len} = 8192\n*   **Optimization Levers:**\n    \n    *   Tensor Core–optimized mixed-precision GEMM.\n    *   Fused attention and output projection.\n\n**Parameter Priorities:**\n\n*   Large VVV (up to 100k) supported with minimal softmax overhead via fused kernels.\n*   High dmodeldmodeld\\_{\\\\text{model}} (up to 4096) leveraged for accuracy without extreme latency.\n*   Moderate-to-deep LLL (20–48) manageable due to high parallelism.\n\n**Typical Config:**\n\n**Optimization Levers:**\n\n*   Tensor Core–optimized mixed-precision GEMM.\n*   Fused attention and output projection.\n\n#### `llama.cpp` (On-Device Inference / CPU-centric)\n\n*   **Hardware Context:** Commodity x86/ARM CPU, limited parallelism, cache-sensitive.\n*   **Parameter Priorities:**\n    \n    *   Reduce VVV (16k–32k) to keep output projection matrix small and cache-friendly.\n    *   Moderate dmodeldmodeld\\_{\\\\text{model}} (512–1024) to keep KV cache within LLC.\n    *   Lower LLL (8–16) to reduce sequential decode steps.\n*   **Typical Config:**\n    \n    V\\=32,000,dmodel\\=768,L\\=12,seq len\\=1024V\\=32,000,dmodel\\=768,L\\=12,seq len\\=1024\n    \n    V = 32{,}000, \\\\quad d\\_{\\\\text{model}} = 768, \\\\quad L = 12, \\\\quad \\\\text{seq len} = 1024\n*   **Expected Behavior:**\n    \n    *   Prefill latency noticeable with large nnn, but acceptable for short prompts.\n    *   Decode speed highly sensitive to LLL% and KV cache fit.\n*   **Optimization Levers:**\n    \n    *   int8/int4 quantization.\n    *   Operator fusion (ONNX Runtime, GGML backend).\n    *   Cache-aware layout for KV storage.\n\n**Parameter Priorities:**\n\n*   Reduce VVV (16k–32k) to keep output projection matrix small and cache-friendly.\n*   Moderate dmodeldmodeld\\_{\\\\text{model}} (512–1024) to keep KV cache within LLC.\n*   Lower LLL (8–16) to reduce sequential decode steps.\n\n**Typical Config:**\n\n**Expected Behavior:**\n\n*   Prefill latency noticeable with large nnn, but acceptable for short prompts.\n*   Decode speed highly sensitive to LLL% and KV cache fit.\n\n**Optimization Levers:**\n\n*   int8/int4 quantization.\n*   Operator fusion (ONNX Runtime, GGML backend).\n*   Cache-aware layout for KV storage.\n\n#### LidarTLM (Edge NPU / Sensor Fusion)\n\n*   **Hardware Context:** Mobile/embedded NPU with strict SRAM and thermal limits.\n*   **Parameter Priorities:**\n    \n    *   Task-specific VVV (4k–10k) to minimize projection latency.\n    *   Small dmodeldmodeld\\_{\\\\text{model}} (256–512) for real-time throughput.\n    *   Shallow LLL (4–8) for deterministic frame-to-frame latency.\n*   **Typical Config:**\n    \n    V\\=8,000,dmodel\\=384,L\\=6,seq len\\=256V\\=8,000,dmodel\\=384,L\\=6,seq len\\=256\n    \n    V = 8{,}000, \\\\quad d\\_{\\\\text{model}} = 384, \\\\quad L = 6, \\\\quad \\\\text{seq len} = 256\n*   **Expected Behavior:**\n    \n    *   Prefill and decode both complete well within a LiDAR frame budget (~33 ms).\n    *   KV cache fits entirely in on-chip SRAM, avoiding DRAM latency.\n*   **Optimization Levers:**\n    \n    *   Static `int8` quantization.\n    *   Operator fusion tailored to NPU’s op-set.\n    *   Preallocation of all buffers to avoid runtime allocation overhead.\n\n**Parameter Priorities:**\n\n*   Task-specific VVV (4k–10k) to minimize projection latency.\n*   Small dmodeldmodeld\\_{\\\\text{model}} (256–512) for real-time throughput.\n*   Shallow LLL (4–8) for deterministic frame-to-frame latency.\n\n**Typical Config:**\n\n**Expected Behavior:**\n\n*   Prefill and decode both complete well within a LiDAR frame budget (~33 ms).\n*   KV cache fits entirely in on-chip SRAM, avoiding DRAM latency.\n\n**Optimization Levers:**\n\n*   Static `int8` quantization.\n*   Operator fusion tailored to NPU’s op-set.\n*   Preallocation of all buffers to avoid runtime allocation overhead.\n\n#### MediaPipe + TFLite LLMs (Mobile/Edge Inference / Specialized IPs Such As NPUs/DSPs)\n\n*   **Hardware Context:** Smartphone SoCs with NPUs/DSPs.\n*   **Parameter Priorities:**\n    \n    *   Reduced VVV (4k–8k) to fit projection in SRAM.\n    *   Small dmodeldmodeld\\_{\\\\text{model}} (256–512) to fit memory and meet latency budgets.\n    *   Shallow LLL for real-time responses.\n*   **Optimization Levers:**\n    \n    *   Fully quantized static graphs.\n    *   Operator fusion for NPU op-sets.\n\n**Parameter Priorities:**\n\n*   Reduced VVV (4k–8k) to fit projection in SRAM.\n*   Small dmodeldmodeld\\_{\\\\text{model}} (256–512) to fit memory and meet latency budgets.\n*   Shallow LLL for real-time responses.\n\n**Optimization Levers:**\n\n*   Fully quantized static graphs.\n*   Operator fusion for NPU op-sets.\n\n#### Cross-Platform Insights\n\n*   **Large VVV**: Fine on GPU servers, problematic for CPU/NPU without GEMM acceleration.\n*   **Large dmodeldmodeld\\_{\\\\text{model}}**: Improves accuracy but hurts both memory and compute — only viable if hardware bandwidth is high.\n*   **Large LLL**: Boosts reasoning but increases decode latency linearly — worst-case for low-parallelism CPUs.\n*   **Temperature**: Has **zero impact** on runtime — safe to tune purely for output diversity.",
    "contentLength": 101095,
    "wordCount": 1046,
    "hasCode": true,
    "hasMath": true,
    "hasImages": false,
    "url": "https://aman.ai/primers/ai/on-device-transformers/#parameter-tuning-recipes-for-ml-runtimes"
  }
]