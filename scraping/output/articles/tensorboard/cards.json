[
  {
    "id": "ai-tensorboard-running-tensorboard-locally-1",
    "domain": "ai_primers",
    "category": "Miscellaneous",
    "article": "TensorBoard",
    "articleSlug": "tensorboard",
    "chapter": "TensorBoard",
    "title": "Running TensorBoard Locally",
    "subtitle": null,
    "contentHtml": "<ul>\n  <li>We’ve also created a few Tensorflow 2/Keras examples that you can run on your local machine. These examples demonstrate how to show how to display loss curves, images, and figures like confusion matrices for the MNIST classification task on your local machine.</li>\n</ul>",
    "contentMarkdown": "*   We’ve also created a few Tensorflow 2/Keras examples that you can run on your local machine. These examples demonstrate how to show how to display loss curves, images, and figures like confusion matrices for the MNIST classification task on your local machine.",
    "order": 1,
    "orderInChapter": 1,
    "difficulty": 2,
    "estimatedMinutes": 1,
    "tags": [
      "miscellaneous"
    ],
    "metadata": {
      "hasCode": false,
      "hasMath": false,
      "hasImages": false,
      "wordCount": 43,
      "contentLength": 282
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/tensorboard/#running-tensorboard-locally",
    "scrapedAt": "2025-12-28T11:57:36.923Z"
  },
  {
    "id": "ai-tensorboard-setup-2",
    "domain": "ai_primers",
    "category": "Miscellaneous",
    "article": "TensorBoard",
    "articleSlug": "tensorboard",
    "chapter": "TensorBoard",
    "title": "Setup",
    "subtitle": null,
    "contentHtml": "<ul>\n  <li>You’ll need a couple of python packages to get started with these examples. Run these commands to create a virtual environment for this tutorial and start a TensorBoard server:</li>\n</ul>\n<div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code0\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code0\">virtualenv <span class=\"nt\">-p</span> python3 .venv\n<span class=\"nb\">source</span> .venv/bin/activate\npip <span class=\"nb\">install </span>numpy matplotlib tensorflow tensorboard scikit-learn\ntensorboard <span class=\"nt\">--logdir</span> logs &amp;\n</code></pre></div></div>\n<pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code0\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code0\">virtualenv <span class=\"nt\">-p</span> python3 .venv\n<span class=\"nb\">source</span> .venv/bin/activate\npip <span class=\"nb\">install </span>numpy matplotlib tensorflow tensorboard scikit-learn\ntensorboard <span class=\"nt\">--logdir</span> logs &amp;\n</code></pre>\n<ul>\n  <li>Running <code class=\"language-plaintext highlighter-rouge\">tensorboard --logdir logs &amp;</code> will create a directory called <code class=\"language-plaintext highlighter-rouge\">logs</code> where TensorBoard will store the metrics from your training runs and start a TensorBoard server as a background process.</li>\n  <li>Open the TensorBoard dashboard by going to <code class=\"language-plaintext highlighter-rouge\">localhost:6006</code> in your browser (or whichever port number your server is running on).</li>\n</ul>",
    "contentMarkdown": "*   You’ll need a couple of python packages to get started with these examples. Run these commands to create a virtual environment for this tutorial and start a TensorBoard server:\n\n![](https://aman.ai/images/copy.png)\n\n`virtualenv -p python3 .venv source .venv/bin/activate pip install numpy matplotlib tensorflow tensorboard scikit-learn tensorboard --logdir logs &`\n\n![](https://aman.ai/images/copy.png)\n\n`virtualenv -p python3 .venv source .venv/bin/activate pip install numpy matplotlib tensorflow tensorboard scikit-learn tensorboard --logdir logs &`\n\n*   Running `tensorboard --logdir logs &` will create a directory called `logs` where TensorBoard will store the metrics from your training runs and start a TensorBoard server as a background process.\n*   Open the TensorBoard dashboard by going to `localhost:6006` in your browser (or whichever port number your server is running on).",
    "order": 2,
    "orderInChapter": 2,
    "difficulty": 3,
    "estimatedMinutes": 1,
    "tags": [
      "miscellaneous"
    ],
    "metadata": {
      "hasCode": true,
      "hasMath": false,
      "hasImages": true,
      "wordCount": 118,
      "contentLength": 1878
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/tensorboard/#setup",
    "scrapedAt": "2025-12-28T11:57:36.923Z"
  },
  {
    "id": "ai-tensorboard-plotting-losses-accuracies-and-weight-distribution-3",
    "domain": "ai_primers",
    "category": "Miscellaneous",
    "article": "TensorBoard",
    "articleSlug": "tensorboard",
    "chapter": "TensorBoard",
    "title": "Plotting Losses, Accuracies, and Weight Distributions",
    "subtitle": null,
    "contentHtml": "<ul>\n  <li>For this first example we’ll plot train and val loss and accuracy curves in addition to histograms of the weights of our network as it trains. To do this, we import the TensorBoard callback,\nconfigure where it will store the training logs (we name this directory as a formatted string representing the current time), and pass this callback to <code class=\"language-plaintext highlighter-rouge\">model.fit()</code>:</li>\n</ul>\n<div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code1\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code1\"><span class=\"kn\">import</span> <span class=\"nn\">datetime</span>\n<span class=\"kn\">import</span> <span class=\"nn\">tensorflow</span> <span class=\"k\">as</span> <span class=\"n\">tf</span>\n<span class=\"kn\">from</span> <span class=\"nn\">tensorflow.keras.datasets</span> <span class=\"kn\">import</span> <span class=\"n\">mnist</span>\n<span class=\"kn\">from</span> <span class=\"nn\">tensorflow.keras.models</span> <span class=\"kn\">import</span> <span class=\"n\">Sequential</span>\n<span class=\"kn\">from</span> <span class=\"nn\">tensorflow.keras.layers</span> <span class=\"kn\">import</span> <span class=\"n\">Flatten</span><span class=\"p\">,</span> <span class=\"n\">Dense</span><span class=\"p\">,</span> <span class=\"n\">Dropout</span>\n<span class=\"kn\">from</span> <span class=\"nn\">tensorflow.keras.callbacks</span> <span class=\"kn\">import</span> <span class=\"n\">TensorBoard</span>\n\n<span class=\"p\">(</span><span class=\"n\">x_train</span><span class=\"p\">,</span> <span class=\"n\">y_train</span><span class=\"p\">),</span> <span class=\"p\">(</span><span class=\"n\">x_test</span><span class=\"p\">,</span> <span class=\"n\">y_test</span><span class=\"p\">)</span> <span class=\"o\">=</span> <span class=\"n\">mnist</span><span class=\"p\">.</span><span class=\"n\">load_data</span><span class=\"p\">()</span>\n<span class=\"n\">x_train</span><span class=\"p\">,</span> <span class=\"n\">x_test</span> <span class=\"o\">=</span> <span class=\"n\">x_train</span> <span class=\"o\">/</span> <span class=\"mf\">255.0</span><span class=\"p\">,</span> <span class=\"n\">x_test</span> <span class=\"o\">/</span> <span class=\"mf\">255.0</span>\n\n<span class=\"n\">model</span> <span class=\"o\">=</span> <span class=\"n\">Sequential</span><span class=\"p\">([</span>\n    <span class=\"n\">Flatten</span><span class=\"p\">(</span><span class=\"n\">input_shape</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">28</span><span class=\"p\">,</span> <span class=\"mi\">28</span><span class=\"p\">)),</span>\n    <span class=\"n\">Dense</span><span class=\"p\">(</span><span class=\"mi\">512</span><span class=\"p\">,</span> <span class=\"n\">activation</span><span class=\"o\">=</span><span class=\"s\">'relu'</span><span class=\"p\">),</span>\n    <span class=\"n\">Dropout</span><span class=\"p\">(</span><span class=\"mf\">0.2</span><span class=\"p\">),</span>\n    <span class=\"n\">Dense</span><span class=\"p\">(</span><span class=\"mi\">10</span><span class=\"p\">,</span> <span class=\"n\">activation</span><span class=\"o\">=</span><span class=\"s\">'softmax'</span><span class=\"p\">)</span>\n<span class=\"p\">])</span>\n<span class=\"n\">model</span><span class=\"p\">.</span><span class=\"nb\">compile</span><span class=\"p\">(</span><span class=\"n\">optimizer</span><span class=\"o\">=</span><span class=\"s\">'adam'</span><span class=\"p\">,</span>\n              <span class=\"n\">loss</span><span class=\"o\">=</span><span class=\"s\">'sparse_categorical_crossentropy'</span><span class=\"p\">,</span>\n              <span class=\"n\">metrics</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s\">'accuracy'</span><span class=\"p\">])</span>\n\n<span class=\"n\">time</span> <span class=\"o\">=</span> <span class=\"n\">datetime</span><span class=\"p\">.</span><span class=\"n\">datetime</span><span class=\"p\">.</span><span class=\"n\">now</span><span class=\"p\">().</span><span class=\"n\">strftime</span><span class=\"p\">(</span><span class=\"s\">\"%Y%m%d-%H%M%S\"</span><span class=\"p\">)</span>\n<span class=\"n\">log_dir</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s\">\"logs/</span><span class=\"si\">{</span><span class=\"n\">time</span><span class=\"si\">}</span><span class=\"s\">\"</span>\n<span class=\"n\">tensorboard</span> <span class=\"o\">=</span> <span class=\"n\">TensorBoard</span><span class=\"p\">(</span><span class=\"n\">log_dir</span><span class=\"o\">=</span><span class=\"n\">log_dir</span><span class=\"p\">,</span> <span class=\"n\">histogram_freq</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">)</span> <span class=\"c1\"># added\n</span>\n<span class=\"n\">model</span><span class=\"p\">.</span><span class=\"n\">fit</span><span class=\"p\">(</span>\n    <span class=\"n\">x</span><span class=\"o\">=</span><span class=\"n\">x_train</span><span class=\"p\">,</span>\n    <span class=\"n\">y</span><span class=\"o\">=</span><span class=\"n\">y_train</span><span class=\"p\">,</span>\n    <span class=\"n\">epochs</span><span class=\"o\">=</span><span class=\"mi\">5</span><span class=\"p\">,</span>\n    <span class=\"n\">validation_data</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"n\">x_test</span><span class=\"p\">,</span> <span class=\"n\">y_test</span><span class=\"p\">),</span>\n    <span class=\"n\">callbacks</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"n\">tensorboard</span><span class=\"p\">]</span>\n    <span class=\"p\">)</span>\n</code></pre></div></div>\n<pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code1\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code1\"><span class=\"kn\">import</span> <span class=\"nn\">datetime</span>\n<span class=\"kn\">import</span> <span class=\"nn\">tensorflow</span> <span class=\"k\">as</span> <span class=\"n\">tf</span>\n<span class=\"kn\">from</span> <span class=\"nn\">tensorflow.keras.datasets</span> <span class=\"kn\">import</span> <span class=\"n\">mnist</span>\n<span class=\"kn\">from</span> <span class=\"nn\">tensorflow.keras.models</span> <span class=\"kn\">import</span> <span class=\"n\">Sequential</span>\n<span class=\"kn\">from</span> <span class=\"nn\">tensorflow.keras.layers</span> <span class=\"kn\">import</span> <span class=\"n\">Flatten</span><span class=\"p\">,</span> <span class=\"n\">Dense</span><span class=\"p\">,</span> <span class=\"n\">Dropout</span>\n<span class=\"kn\">from</span> <span class=\"nn\">tensorflow.keras.callbacks</span> <span class=\"kn\">import</span> <span class=\"n\">TensorBoard</span>\n\n<span class=\"p\">(</span><span class=\"n\">x_train</span><span class=\"p\">,</span> <span class=\"n\">y_train</span><span class=\"p\">),</span> <span class=\"p\">(</span><span class=\"n\">x_test</span><span class=\"p\">,</span> <span class=\"n\">y_test</span><span class=\"p\">)</span> <span class=\"o\">=</span> <span class=\"n\">mnist</span><span class=\"p\">.</span><span class=\"n\">load_data</span><span class=\"p\">()</span>\n<span class=\"n\">x_train</span><span class=\"p\">,</span> <span class=\"n\">x_test</span> <span class=\"o\">=</span> <span class=\"n\">x_train</span> <span class=\"o\">/</span> <span class=\"mf\">255.0</span><span class=\"p\">,</span> <span class=\"n\">x_test</span> <span class=\"o\">/</span> <span class=\"mf\">255.0</span>\n\n<span class=\"n\">model</span> <span class=\"o\">=</span> <span class=\"n\">Sequential</span><span class=\"p\">([</span>\n    <span class=\"n\">Flatten</span><span class=\"p\">(</span><span class=\"n\">input_shape</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">28</span><span class=\"p\">,</span> <span class=\"mi\">28</span><span class=\"p\">)),</span>\n    <span class=\"n\">Dense</span><span class=\"p\">(</span><span class=\"mi\">512</span><span class=\"p\">,</span> <span class=\"n\">activation</span><span class=\"o\">=</span><span class=\"s\">'relu'</span><span class=\"p\">),</span>\n    <span class=\"n\">Dropout</span><span class=\"p\">(</span><span class=\"mf\">0.2</span><span class=\"p\">),</span>\n    <span class=\"n\">Dense</span><span class=\"p\">(</span><span class=\"mi\">10</span><span class=\"p\">,</span> <span class=\"n\">activation</span><span class=\"o\">=</span><span class=\"s\">'softmax'</span><span class=\"p\">)</span>\n<span class=\"p\">])</span>\n<span class=\"n\">model</span><span class=\"p\">.</span><span class=\"nb\">compile</span><span class=\"p\">(</span><span class=\"n\">optimizer</span><span class=\"o\">=</span><span class=\"s\">'adam'</span><span class=\"p\">,</span>\n              <span class=\"n\">loss</span><span class=\"o\">=</span><span class=\"s\">'sparse_categorical_crossentropy'</span><span class=\"p\">,</span>\n              <span class=\"n\">metrics</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s\">'accuracy'</span><span class=\"p\">])</span>\n\n<span class=\"n\">time</span> <span class=\"o\">=</span> <span class=\"n\">datetime</span><span class=\"p\">.</span><span class=\"n\">datetime</span><span class=\"p\">.</span><span class=\"n\">now</span><span class=\"p\">().</span><span class=\"n\">strftime</span><span class=\"p\">(</span><span class=\"s\">\"%Y%m%d-%H%M%S\"</span><span class=\"p\">)</span>\n<span class=\"n\">log_dir</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s\">\"logs/</span><span class=\"si\">{</span><span class=\"n\">time</span><span class=\"si\">}</span><span class=\"s\">\"</span>\n<span class=\"n\">tensorboard</span> <span class=\"o\">=</span> <span class=\"n\">TensorBoard</span><span class=\"p\">(</span><span class=\"n\">log_dir</span><span class=\"o\">=</span><span class=\"n\">log_dir</span><span class=\"p\">,</span> <span class=\"n\">histogram_freq</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">)</span> <span class=\"c1\"># added\n</span>\n<span class=\"n\">model</span><span class=\"p\">.</span><span class=\"n\">fit</span><span class=\"p\">(</span>\n    <span class=\"n\">x</span><span class=\"o\">=</span><span class=\"n\">x_train</span><span class=\"p\">,</span>\n    <span class=\"n\">y</span><span class=\"o\">=</span><span class=\"n\">y_train</span><span class=\"p\">,</span>\n    <span class=\"n\">epochs</span><span class=\"o\">=</span><span class=\"mi\">5</span><span class=\"p\">,</span>\n    <span class=\"n\">validation_data</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"n\">x_test</span><span class=\"p\">,</span> <span class=\"n\">y_test</span><span class=\"p\">),</span>\n    <span class=\"n\">callbacks</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"n\">tensorboard</span><span class=\"p\">]</span>\n    <span class=\"p\">)</span>\n</code></pre>\n<ul>\n  <li>We can see plots of the train and val losses and accuracies by navigating to the ‘Scalars’ tab of the TensorBoard dashboard at <code class=\"language-plaintext highlighter-rouge\">localhost:6000</code> in a browser.</li>\n</ul>\n<p><img src=\"/primers/ai/assets/hyperparam-tuning-and-tensorboard/tboard.png\" alt=\"\"></p>\n<ul>\n  <li>\n    <p>By setting <code class=\"language-plaintext highlighter-rouge\">histogram_freq=1</code> in the TensorBoard callback constructor, we can track the distributions of the weights in each layer at each epoch.</p>\n  </li>\n  <li>\n    <p>The ‘Histograms’ tab shows histograms of the weights in each layer at each epoch.</p>\n  </li>\n</ul>\n<p>By setting <code class=\"language-plaintext highlighter-rouge\">histogram_freq=1</code> in the TensorBoard callback constructor, we can track the distributions of the weights in each layer at each epoch.</p>\n<p>The ‘Histograms’ tab shows histograms of the weights in each layer at each epoch.</p>\n<p><img src=\"/primers/ai/assets/hyperparam-tuning-and-tensorboard/hist.png\" alt=\"\"></p>",
    "contentMarkdown": "*   For this first example we’ll plot train and val loss and accuracy curves in addition to histograms of the weights of our network as it trains. To do this, we import the TensorBoard callback, configure where it will store the training logs (we name this directory as a formatted string representing the current time), and pass this callback to `model.fit()`:\n\n![](https://aman.ai/images/copy.png)\n\n`import datetime import tensorflow as tf from tensorflow.keras.datasets import mnist from tensorflow.keras.models import Sequential from tensorflow.keras.layers import Flatten, Dense, Dropout from tensorflow.keras.callbacks import TensorBoard  (x_train, y_train), (x_test, y_test) = mnist.load_data() x_train, x_test = x_train / 255.0, x_test / 255.0  model = Sequential([     Flatten(input_shape=(28, 28)),     Dense(512, activation='relu'),     Dropout(0.2),     Dense(10, activation='softmax') ]) model.compile(optimizer='adam',               loss='sparse_categorical_crossentropy',               metrics=['accuracy'])  time = datetime.datetime.now().strftime(\"%Y%m%d-%H%M%S\") log_dir = f\"logs/{time}\" tensorboard = TensorBoard(log_dir=log_dir, histogram_freq=1) # added model.fit(     x=x_train,     y=y_train,     epochs=5,     validation_data=(x_test, y_test),     callbacks=[tensorboard]     )`\n\n![](https://aman.ai/images/copy.png)\n\n`import datetime import tensorflow as tf from tensorflow.keras.datasets import mnist from tensorflow.keras.models import Sequential from tensorflow.keras.layers import Flatten, Dense, Dropout from tensorflow.keras.callbacks import TensorBoard  (x_train, y_train), (x_test, y_test) = mnist.load_data() x_train, x_test = x_train / 255.0, x_test / 255.0  model = Sequential([     Flatten(input_shape=(28, 28)),     Dense(512, activation='relu'),     Dropout(0.2),     Dense(10, activation='softmax') ]) model.compile(optimizer='adam',               loss='sparse_categorical_crossentropy',               metrics=['accuracy'])  time = datetime.datetime.now().strftime(\"%Y%m%d-%H%M%S\") log_dir = f\"logs/{time}\" tensorboard = TensorBoard(log_dir=log_dir, histogram_freq=1) # added model.fit(     x=x_train,     y=y_train,     epochs=5,     validation_data=(x_test, y_test),     callbacks=[tensorboard]     )`\n\n*   We can see plots of the train and val losses and accuracies by navigating to the ‘Scalars’ tab of the TensorBoard dashboard at `localhost:6000` in a browser.\n\n![](/primers/ai/assets/hyperparam-tuning-and-tensorboard/tboard.png)\n\n*   By setting `histogram_freq=1` in the TensorBoard callback constructor, we can track the distributions of the weights in each layer at each epoch.\n    \n*   The ‘Histograms’ tab shows histograms of the weights in each layer at each epoch.\n    \n\nBy setting `histogram_freq=1` in the TensorBoard callback constructor, we can track the distributions of the weights in each layer at each epoch.\n\nThe ‘Histograms’ tab shows histograms of the weights in each layer at each epoch.\n\n![](/primers/ai/assets/hyperparam-tuning-and-tensorboard/hist.png)",
    "order": 3,
    "orderInChapter": 3,
    "difficulty": 3,
    "estimatedMinutes": 2,
    "tags": [
      "miscellaneous",
      "activation",
      "dropout"
    ],
    "metadata": {
      "hasCode": true,
      "hasMath": false,
      "hasImages": true,
      "wordCount": 313,
      "contentLength": 11602
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/tensorboard/#plotting-losses,-accuracies,-and-weight-distributions",
    "scrapedAt": "2025-12-28T11:57:36.923Z"
  },
  {
    "id": "ai-tensorboard-logging-images-4",
    "domain": "ai_primers",
    "category": "Miscellaneous",
    "article": "TensorBoard",
    "articleSlug": "tensorboard",
    "chapter": "TensorBoard",
    "title": "Logging Images",
    "subtitle": null,
    "contentHtml": "<ul>\n  <li>This next example shows how to use <code class=\"language-plaintext highlighter-rouge\">tf.summary</code> to log image data for visualization. Here we simply log the first five examples in the training set so that we can inspect them in the ‘Images’ tab of the TensorBoard dashboard.</li>\n</ul>\n<div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code2\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code2\"><span class=\"kn\">import</span> <span class=\"nn\">datetime</span>\n<span class=\"kn\">import</span> <span class=\"nn\">tensorflow</span> <span class=\"k\">as</span> <span class=\"n\">tf</span>\n<span class=\"kn\">from</span> <span class=\"nn\">tensorflow.keras.datasets</span> <span class=\"kn\">import</span> <span class=\"n\">mnist</span>\n<span class=\"kn\">from</span> <span class=\"nn\">tensorflow.keras.models</span> <span class=\"kn\">import</span> <span class=\"n\">Sequential</span>\n<span class=\"kn\">from</span> <span class=\"nn\">tensorflow.keras.layers</span> <span class=\"kn\">import</span> <span class=\"n\">Flatten</span><span class=\"p\">,</span> <span class=\"n\">Dense</span><span class=\"p\">,</span> <span class=\"n\">Dropout</span>\n<span class=\"kn\">from</span> <span class=\"nn\">tensorflow.keras.callbacks</span> <span class=\"kn\">import</span> <span class=\"n\">TensorBoard</span>\n\n<span class=\"kn\">import</span> <span class=\"nn\">matplotlib.pyplot</span> <span class=\"k\">as</span> <span class=\"n\">plt</span> <span class=\"c1\"># added\n</span><span class=\"kn\">import</span> <span class=\"nn\">numpy</span> <span class=\"k\">as</span> <span class=\"n\">np</span> <span class=\"c1\"># added\n</span><span class=\"kn\">import</span> <span class=\"nn\">sklearn.metrics</span> <span class=\"c1\"># added\n</span>\n<span class=\"p\">(</span><span class=\"n\">x_train</span><span class=\"p\">,</span> <span class=\"n\">y_train</span><span class=\"p\">),</span> <span class=\"p\">(</span><span class=\"n\">x_test</span><span class=\"p\">,</span> <span class=\"n\">y_test</span><span class=\"p\">)</span> <span class=\"o\">=</span> <span class=\"n\">mnist</span><span class=\"p\">.</span><span class=\"n\">load_data</span><span class=\"p\">()</span>\n<span class=\"n\">x_train</span><span class=\"p\">,</span> <span class=\"n\">x_test</span> <span class=\"o\">=</span> <span class=\"n\">x_train</span> <span class=\"o\">/</span> <span class=\"mf\">255.0</span><span class=\"p\">,</span> <span class=\"n\">x_test</span> <span class=\"o\">/</span> <span class=\"mf\">255.0</span>\n\n<span class=\"n\">time</span> <span class=\"o\">=</span> <span class=\"n\">datetime</span><span class=\"p\">.</span><span class=\"n\">datetime</span><span class=\"p\">.</span><span class=\"n\">now</span><span class=\"p\">().</span><span class=\"n\">strftime</span><span class=\"p\">(</span><span class=\"s\">\"%Y%m%d-%H%M%S\"</span><span class=\"p\">)</span>\n<span class=\"n\">log_dir</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s\">\"logs/</span><span class=\"si\">{</span><span class=\"n\">time</span><span class=\"si\">}</span><span class=\"s\">\"</span>\n<span class=\"n\">tensorboard</span> <span class=\"o\">=</span> <span class=\"n\">TensorBoard</span><span class=\"p\">(</span><span class=\"n\">log_dir</span><span class=\"o\">=</span><span class=\"n\">log_dir</span><span class=\"p\">,</span> <span class=\"n\">histogram_freq</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># Visualize image, added\n</span><span class=\"n\">images</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"p\">.</span><span class=\"n\">reshape</span><span class=\"p\">(</span><span class=\"n\">x_train</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">:</span><span class=\"mi\">5</span><span class=\"p\">],</span> <span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">28</span><span class=\"p\">,</span> <span class=\"mi\">28</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">))</span> <span class=\"c1\"># batch_size first\n</span><span class=\"n\">file_writer</span> <span class=\"o\">=</span> <span class=\"n\">tf</span><span class=\"p\">.</span><span class=\"n\">summary</span><span class=\"p\">.</span><span class=\"n\">create_file_writer</span><span class=\"p\">(</span><span class=\"n\">log_dir</span><span class=\"p\">)</span>\n<span class=\"k\">with</span> <span class=\"n\">file_writer</span><span class=\"p\">.</span><span class=\"n\">as_default</span><span class=\"p\">():</span>\n\t<span class=\"n\">tf</span><span class=\"p\">.</span><span class=\"n\">summary</span><span class=\"p\">.</span><span class=\"n\">image</span><span class=\"p\">(</span><span class=\"s\">\"Training Data\"</span><span class=\"p\">,</span> <span class=\"n\">images</span><span class=\"p\">,</span> <span class=\"n\">max_outputs</span><span class=\"o\">=</span><span class=\"mi\">5</span><span class=\"p\">,</span> <span class=\"n\">step</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">)</span>\n\n<span class=\"n\">model</span> <span class=\"o\">=</span> <span class=\"n\">Sequential</span><span class=\"p\">([</span>\n    <span class=\"n\">Flatten</span><span class=\"p\">(</span><span class=\"n\">input_shape</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">28</span><span class=\"p\">,</span> <span class=\"mi\">28</span><span class=\"p\">)),</span>\n    <span class=\"n\">Dense</span><span class=\"p\">(</span><span class=\"mi\">512</span><span class=\"p\">,</span> <span class=\"n\">activation</span><span class=\"o\">=</span><span class=\"s\">'relu'</span><span class=\"p\">),</span>\n    <span class=\"n\">Dropout</span><span class=\"p\">(</span><span class=\"mf\">0.2</span><span class=\"p\">),</span>\n    <span class=\"n\">Dense</span><span class=\"p\">(</span><span class=\"mi\">10</span><span class=\"p\">,</span> <span class=\"n\">activation</span><span class=\"o\">=</span><span class=\"s\">'softmax'</span><span class=\"p\">)</span>\n<span class=\"p\">])</span>\n<span class=\"n\">model</span><span class=\"p\">.</span><span class=\"nb\">compile</span><span class=\"p\">(</span><span class=\"n\">optimizer</span><span class=\"o\">=</span><span class=\"s\">'adam'</span><span class=\"p\">,</span>\n              <span class=\"n\">loss</span><span class=\"o\">=</span><span class=\"s\">'sparse_categorical_crossentropy'</span><span class=\"p\">,</span>\n              <span class=\"n\">metrics</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s\">'accuracy'</span><span class=\"p\">])</span>\n\n<span class=\"n\">model</span><span class=\"p\">.</span><span class=\"n\">fit</span><span class=\"p\">(</span>\n    <span class=\"n\">x</span><span class=\"o\">=</span><span class=\"n\">x_train</span><span class=\"p\">,</span> \n    <span class=\"n\">y</span><span class=\"o\">=</span><span class=\"n\">y_train</span><span class=\"p\">,</span> \n    <span class=\"n\">epochs</span><span class=\"o\">=</span><span class=\"mi\">5</span><span class=\"p\">,</span> \n    <span class=\"n\">validation_data</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"n\">x_test</span><span class=\"p\">,</span> <span class=\"n\">y_test</span><span class=\"p\">),</span> \n    <span class=\"n\">callbacks</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"n\">tensorboard</span><span class=\"p\">]</span>\n<span class=\"p\">)</span>\n</code></pre></div></div>\n<pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code2\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code2\"><span class=\"kn\">import</span> <span class=\"nn\">datetime</span>\n<span class=\"kn\">import</span> <span class=\"nn\">tensorflow</span> <span class=\"k\">as</span> <span class=\"n\">tf</span>\n<span class=\"kn\">from</span> <span class=\"nn\">tensorflow.keras.datasets</span> <span class=\"kn\">import</span> <span class=\"n\">mnist</span>\n<span class=\"kn\">from</span> <span class=\"nn\">tensorflow.keras.models</span> <span class=\"kn\">import</span> <span class=\"n\">Sequential</span>\n<span class=\"kn\">from</span> <span class=\"nn\">tensorflow.keras.layers</span> <span class=\"kn\">import</span> <span class=\"n\">Flatten</span><span class=\"p\">,</span> <span class=\"n\">Dense</span><span class=\"p\">,</span> <span class=\"n\">Dropout</span>\n<span class=\"kn\">from</span> <span class=\"nn\">tensorflow.keras.callbacks</span> <span class=\"kn\">import</span> <span class=\"n\">TensorBoard</span>\n\n<span class=\"kn\">import</span> <span class=\"nn\">matplotlib.pyplot</span> <span class=\"k\">as</span> <span class=\"n\">plt</span> <span class=\"c1\"># added\n</span><span class=\"kn\">import</span> <span class=\"nn\">numpy</span> <span class=\"k\">as</span> <span class=\"n\">np</span> <span class=\"c1\"># added\n</span><span class=\"kn\">import</span> <span class=\"nn\">sklearn.metrics</span> <span class=\"c1\"># added\n</span>\n<span class=\"p\">(</span><span class=\"n\">x_train</span><span class=\"p\">,</span> <span class=\"n\">y_train</span><span class=\"p\">),</span> <span class=\"p\">(</span><span class=\"n\">x_test</span><span class=\"p\">,</span> <span class=\"n\">y_test</span><span class=\"p\">)</span> <span class=\"o\">=</span> <span class=\"n\">mnist</span><span class=\"p\">.</span><span class=\"n\">load_data</span><span class=\"p\">()</span>\n<span class=\"n\">x_train</span><span class=\"p\">,</span> <span class=\"n\">x_test</span> <span class=\"o\">=</span> <span class=\"n\">x_train</span> <span class=\"o\">/</span> <span class=\"mf\">255.0</span><span class=\"p\">,</span> <span class=\"n\">x_test</span> <span class=\"o\">/</span> <span class=\"mf\">255.0</span>\n\n<span class=\"n\">time</span> <span class=\"o\">=</span> <span class=\"n\">datetime</span><span class=\"p\">.</span><span class=\"n\">datetime</span><span class=\"p\">.</span><span class=\"n\">now</span><span class=\"p\">().</span><span class=\"n\">strftime</span><span class=\"p\">(</span><span class=\"s\">\"%Y%m%d-%H%M%S\"</span><span class=\"p\">)</span>\n<span class=\"n\">log_dir</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s\">\"logs/</span><span class=\"si\">{</span><span class=\"n\">time</span><span class=\"si\">}</span><span class=\"s\">\"</span>\n<span class=\"n\">tensorboard</span> <span class=\"o\">=</span> <span class=\"n\">TensorBoard</span><span class=\"p\">(</span><span class=\"n\">log_dir</span><span class=\"o\">=</span><span class=\"n\">log_dir</span><span class=\"p\">,</span> <span class=\"n\">histogram_freq</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># Visualize image, added\n</span><span class=\"n\">images</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"p\">.</span><span class=\"n\">reshape</span><span class=\"p\">(</span><span class=\"n\">x_train</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">:</span><span class=\"mi\">5</span><span class=\"p\">],</span> <span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">28</span><span class=\"p\">,</span> <span class=\"mi\">28</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">))</span> <span class=\"c1\"># batch_size first\n</span><span class=\"n\">file_writer</span> <span class=\"o\">=</span> <span class=\"n\">tf</span><span class=\"p\">.</span><span class=\"n\">summary</span><span class=\"p\">.</span><span class=\"n\">create_file_writer</span><span class=\"p\">(</span><span class=\"n\">log_dir</span><span class=\"p\">)</span>\n<span class=\"k\">with</span> <span class=\"n\">file_writer</span><span class=\"p\">.</span><span class=\"n\">as_default</span><span class=\"p\">():</span>\n\t<span class=\"n\">tf</span><span class=\"p\">.</span><span class=\"n\">summary</span><span class=\"p\">.</span><span class=\"n\">image</span><span class=\"p\">(</span><span class=\"s\">\"Training Data\"</span><span class=\"p\">,</span> <span class=\"n\">images</span><span class=\"p\">,</span> <span class=\"n\">max_outputs</span><span class=\"o\">=</span><span class=\"mi\">5</span><span class=\"p\">,</span> <span class=\"n\">step</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">)</span>\n\n<span class=\"n\">model</span> <span class=\"o\">=</span> <span class=\"n\">Sequential</span><span class=\"p\">([</span>\n    <span class=\"n\">Flatten</span><span class=\"p\">(</span><span class=\"n\">input_shape</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">28</span><span class=\"p\">,</span> <span class=\"mi\">28</span><span class=\"p\">)),</span>\n    <span class=\"n\">Dense</span><span class=\"p\">(</span><span class=\"mi\">512</span><span class=\"p\">,</span> <span class=\"n\">activation</span><span class=\"o\">=</span><span class=\"s\">'relu'</span><span class=\"p\">),</span>\n    <span class=\"n\">Dropout</span><span class=\"p\">(</span><span class=\"mf\">0.2</span><span class=\"p\">),</span>\n    <span class=\"n\">Dense</span><span class=\"p\">(</span><span class=\"mi\">10</span><span class=\"p\">,</span> <span class=\"n\">activation</span><span class=\"o\">=</span><span class=\"s\">'softmax'</span><span class=\"p\">)</span>\n<span class=\"p\">])</span>\n<span class=\"n\">model</span><span class=\"p\">.</span><span class=\"nb\">compile</span><span class=\"p\">(</span><span class=\"n\">optimizer</span><span class=\"o\">=</span><span class=\"s\">'adam'</span><span class=\"p\">,</span>\n              <span class=\"n\">loss</span><span class=\"o\">=</span><span class=\"s\">'sparse_categorical_crossentropy'</span><span class=\"p\">,</span>\n              <span class=\"n\">metrics</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s\">'accuracy'</span><span class=\"p\">])</span>\n\n<span class=\"n\">model</span><span class=\"p\">.</span><span class=\"n\">fit</span><span class=\"p\">(</span>\n    <span class=\"n\">x</span><span class=\"o\">=</span><span class=\"n\">x_train</span><span class=\"p\">,</span> \n    <span class=\"n\">y</span><span class=\"o\">=</span><span class=\"n\">y_train</span><span class=\"p\">,</span> \n    <span class=\"n\">epochs</span><span class=\"o\">=</span><span class=\"mi\">5</span><span class=\"p\">,</span> \n    <span class=\"n\">validation_data</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"n\">x_test</span><span class=\"p\">,</span> <span class=\"n\">y_test</span><span class=\"p\">),</span> \n    <span class=\"n\">callbacks</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"n\">tensorboard</span><span class=\"p\">]</span>\n<span class=\"p\">)</span>\n</code></pre>\n<p><img src=\"/primers/ai/assets/hyperparam-tuning-and-tensorboard/data.png\" alt=\"\"></p>",
    "contentMarkdown": "*   This next example shows how to use `tf.summary` to log image data for visualization. Here we simply log the first five examples in the training set so that we can inspect them in the ‘Images’ tab of the TensorBoard dashboard.\n\n![](https://aman.ai/images/copy.png)\n\n`import datetime import tensorflow as tf from tensorflow.keras.datasets import mnist from tensorflow.keras.models import Sequential from tensorflow.keras.layers import Flatten, Dense, Dropout from tensorflow.keras.callbacks import TensorBoard  import matplotlib.pyplot as plt # added import numpy as np # added import sklearn.metrics # added (x_train, y_train), (x_test, y_test) = mnist.load_data() x_train, x_test = x_train / 255.0, x_test / 255.0  time = datetime.datetime.now().strftime(\"%Y%m%d-%H%M%S\") log_dir = f\"logs/{time}\" tensorboard = TensorBoard(log_dir=log_dir, histogram_freq=1)  # Visualize image, added images = np.reshape(x_train[0:5], (-1, 28, 28, 1)) # batch_size first file_writer = tf.summary.create_file_writer(log_dir) with file_writer.as_default(): \ttf.summary.image(\"Training Data\", images, max_outputs=5, step=0)  model = Sequential([     Flatten(input_shape=(28, 28)),     Dense(512, activation='relu'),     Dropout(0.2),     Dense(10, activation='softmax') ]) model.compile(optimizer='adam',               loss='sparse_categorical_crossentropy',               metrics=['accuracy'])  model.fit(     x=x_train,      y=y_train,      epochs=5,      validation_data=(x_test, y_test),      callbacks=[tensorboard] )`\n\n![](https://aman.ai/images/copy.png)\n\n`import datetime import tensorflow as tf from tensorflow.keras.datasets import mnist from tensorflow.keras.models import Sequential from tensorflow.keras.layers import Flatten, Dense, Dropout from tensorflow.keras.callbacks import TensorBoard  import matplotlib.pyplot as plt # added import numpy as np # added import sklearn.metrics # added (x_train, y_train), (x_test, y_test) = mnist.load_data() x_train, x_test = x_train / 255.0, x_test / 255.0  time = datetime.datetime.now().strftime(\"%Y%m%d-%H%M%S\") log_dir = f\"logs/{time}\" tensorboard = TensorBoard(log_dir=log_dir, histogram_freq=1)  # Visualize image, added images = np.reshape(x_train[0:5], (-1, 28, 28, 1)) # batch_size first file_writer = tf.summary.create_file_writer(log_dir) with file_writer.as_default(): \ttf.summary.image(\"Training Data\", images, max_outputs=5, step=0)  model = Sequential([     Flatten(input_shape=(28, 28)),     Dense(512, activation='relu'),     Dropout(0.2),     Dense(10, activation='softmax') ]) model.compile(optimizer='adam',               loss='sparse_categorical_crossentropy',               metrics=['accuracy'])  model.fit(     x=x_train,      y=y_train,      epochs=5,      validation_data=(x_test, y_test),      callbacks=[tensorboard] )`\n\n![](/primers/ai/assets/hyperparam-tuning-and-tensorboard/data.png)",
    "order": 4,
    "orderInChapter": 4,
    "difficulty": 3,
    "estimatedMinutes": 2,
    "tags": [
      "miscellaneous",
      "activation",
      "dropout"
    ],
    "metadata": {
      "hasCode": true,
      "hasMath": false,
      "hasImages": true,
      "wordCount": 266,
      "contentLength": 14383
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/tensorboard/#logging-images",
    "scrapedAt": "2025-12-28T11:57:36.923Z"
  },
  {
    "id": "ai-tensorboard-custom-logging-callbacks-5",
    "domain": "ai_primers",
    "category": "Miscellaneous",
    "article": "TensorBoard",
    "articleSlug": "tensorboard",
    "chapter": "TensorBoard",
    "title": "Custom Logging Callbacks",
    "subtitle": null,
    "contentHtml": "<ul>\n  <li>The previous example showed how to log images from the training set at the beginning of training, but it would be more helpful to be able to log images and figures\ncontinusouly over the course of training.</li>\n  <li>For example, if we were training a GAN, monitoring the loss curves of the generator and discriminator over time wouldn’t give much insight into the performance of the model, and it would be much more illuminating to be able to view samples generated over time to see if sample quality is improving.</li>\n  <li>Likewise, for a classification task like MNIST digit classification, being able to see the evolution of confusion matrices or ROC curves over time can give a better sense of model performance than a single number like accuracy. Here we show how to plot confusion matrices at the end of each epoch.</li>\n  <li>We can define custom logging behavior that executes at fixed intervals during training using a <code class=\"language-plaintext highlighter-rouge\">LambdaCallback</code>.</li>\n  <li>In the code below, we define a function <code class=\"language-plaintext highlighter-rouge\">log_confusion_matrix</code> that generates the model’s predictions on the val set and creates a confusion matrix image using the <code class=\"language-plaintext highlighter-rouge\">sklearn.metrics.confusion_matrix()</code> function, and create a callback that plots the confusion matrix at the end of every epoch with <code class=\"language-plaintext highlighter-rouge\">cm_callback = LambdaCallback(on_epoch_end=log_confusion_matrix)</code>.</li>\n</ul>\n<div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code3\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code3\"><span class=\"kn\">import</span> <span class=\"nn\">datetime</span>\n<span class=\"kn\">import</span> <span class=\"nn\">tensorflow</span> <span class=\"k\">as</span> <span class=\"n\">tf</span>\n<span class=\"kn\">from</span> <span class=\"nn\">tensorflow.keras.datasets</span> <span class=\"kn\">import</span> <span class=\"n\">mnist</span>\n<span class=\"kn\">from</span> <span class=\"nn\">tensorflow.keras.models</span> <span class=\"kn\">import</span> <span class=\"n\">Sequential</span>\n<span class=\"kn\">from</span> <span class=\"nn\">tensorflow.keras.layers</span> <span class=\"kn\">import</span> <span class=\"n\">Flatten</span><span class=\"p\">,</span> <span class=\"n\">Dense</span><span class=\"p\">,</span> <span class=\"n\">Dropout</span>\n<span class=\"kn\">from</span> <span class=\"nn\">tensorflow.keras.callbacks</span> <span class=\"kn\">import</span> <span class=\"n\">TensorBoard</span><span class=\"p\">,</span> <span class=\"n\">LambdaCallback</span> <span class=\"c1\"># added\n</span>\n<span class=\"kn\">import</span> <span class=\"nn\">io</span> <span class=\"c1\"># added\n</span><span class=\"kn\">import</span> <span class=\"nn\">itertools</span> <span class=\"c1\"># added\n</span><span class=\"kn\">import</span> <span class=\"nn\">matplotlib.pyplot</span> <span class=\"k\">as</span> <span class=\"n\">plt</span>\n<span class=\"kn\">import</span> <span class=\"nn\">numpy</span> <span class=\"k\">as</span> <span class=\"n\">np</span>\n<span class=\"kn\">import</span> <span class=\"nn\">sklearn.metrics</span>\n\n<span class=\"c1\"># Added\n</span><span class=\"k\">def</span> <span class=\"nf\">plot_to_image</span><span class=\"p\">(</span><span class=\"n\">fig</span><span class=\"p\">):</span>\n\t<span class=\"n\">buf</span> <span class=\"o\">=</span> <span class=\"n\">io</span><span class=\"p\">.</span><span class=\"n\">BytesIO</span><span class=\"p\">()</span>\n\t<span class=\"n\">plt</span><span class=\"p\">.</span><span class=\"n\">savefig</span><span class=\"p\">(</span><span class=\"n\">buf</span><span class=\"p\">,</span> <span class=\"nb\">format</span><span class=\"o\">=</span><span class=\"s\">'png'</span><span class=\"p\">)</span>\n\t<span class=\"n\">plt</span><span class=\"p\">.</span><span class=\"n\">close</span><span class=\"p\">(</span><span class=\"n\">fig</span><span class=\"p\">)</span>\n\t<span class=\"n\">buf</span><span class=\"p\">.</span><span class=\"n\">seek</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">)</span>\n\t<span class=\"n\">img</span> <span class=\"o\">=</span> <span class=\"n\">tf</span><span class=\"p\">.</span><span class=\"n\">image</span><span class=\"p\">.</span><span class=\"n\">decode_png</span><span class=\"p\">(</span><span class=\"n\">buf</span><span class=\"p\">.</span><span class=\"n\">getvalue</span><span class=\"p\">(),</span> <span class=\"n\">channels</span><span class=\"o\">=</span><span class=\"mi\">4</span><span class=\"p\">)</span>\n\t<span class=\"n\">img</span> <span class=\"o\">=</span> <span class=\"n\">tf</span><span class=\"p\">.</span><span class=\"n\">expand_dims</span><span class=\"p\">(</span><span class=\"n\">img</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">)</span>\n\t<span class=\"k\">return</span> <span class=\"n\">img</span>\n\n<span class=\"c1\"># Added\n</span><span class=\"k\">def</span> <span class=\"nf\">plot_confusion_matrix</span><span class=\"p\">(</span><span class=\"n\">cm</span><span class=\"p\">,</span> <span class=\"n\">class_names</span><span class=\"p\">):</span>\n\t<span class=\"n\">figure</span> <span class=\"o\">=</span> <span class=\"n\">plt</span><span class=\"p\">.</span><span class=\"n\">figure</span><span class=\"p\">(</span><span class=\"n\">figsize</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">8</span><span class=\"p\">,</span> <span class=\"mi\">8</span><span class=\"p\">))</span>\n\t<span class=\"n\">plt</span><span class=\"p\">.</span><span class=\"n\">imshow</span><span class=\"p\">(</span><span class=\"n\">cm</span><span class=\"p\">,</span> <span class=\"n\">interpolation</span><span class=\"o\">=</span><span class=\"s\">'nearest'</span><span class=\"p\">,</span> <span class=\"n\">cmap</span><span class=\"o\">=</span><span class=\"n\">plt</span><span class=\"p\">.</span><span class=\"n\">cm</span><span class=\"p\">.</span><span class=\"n\">Blues</span><span class=\"p\">)</span>\n\t<span class=\"n\">plt</span><span class=\"p\">.</span><span class=\"n\">title</span><span class=\"p\">(</span><span class=\"s\">\"Confusion matrix\"</span><span class=\"p\">)</span>\n\t<span class=\"n\">plt</span><span class=\"p\">.</span><span class=\"n\">colorbar</span><span class=\"p\">()</span>\n\t<span class=\"n\">tick_marks</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"p\">.</span><span class=\"n\">arange</span><span class=\"p\">(</span><span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">class_names</span><span class=\"p\">))</span>\n\t<span class=\"n\">plt</span><span class=\"p\">.</span><span class=\"n\">xticks</span><span class=\"p\">(</span><span class=\"n\">tick_marks</span><span class=\"p\">,</span> <span class=\"n\">class_names</span><span class=\"p\">,</span> <span class=\"n\">rotation</span><span class=\"o\">=</span><span class=\"mi\">45</span><span class=\"p\">)</span>\n\t<span class=\"n\">plt</span><span class=\"p\">.</span><span class=\"n\">yticks</span><span class=\"p\">(</span><span class=\"n\">tick_marks</span><span class=\"p\">,</span> <span class=\"n\">class_names</span><span class=\"p\">)</span>\n\n\t<span class=\"n\">cm</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"p\">.</span><span class=\"n\">around</span><span class=\"p\">(</span><span class=\"n\">cm</span><span class=\"p\">.</span><span class=\"n\">astype</span><span class=\"p\">(</span><span class=\"s\">'float'</span><span class=\"p\">)</span> <span class=\"o\">/</span> <span class=\"n\">cm</span><span class=\"p\">.</span><span class=\"nb\">sum</span><span class=\"p\">(</span><span class=\"n\">axis</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">)[:,</span> <span class=\"n\">np</span><span class=\"p\">.</span><span class=\"n\">newaxis</span><span class=\"p\">],</span> <span class=\"n\">decimals</span><span class=\"o\">=</span><span class=\"mi\">2</span><span class=\"p\">)</span>\n\n\t<span class=\"n\">threshold</span> <span class=\"o\">=</span> <span class=\"n\">cm</span><span class=\"p\">.</span><span class=\"nb\">max</span><span class=\"p\">()</span> <span class=\"o\">/</span> <span class=\"mf\">2.</span>\n\t<span class=\"k\">for</span> <span class=\"n\">i</span><span class=\"p\">,</span> <span class=\"n\">j</span> <span class=\"ow\">in</span> <span class=\"n\">itertools</span><span class=\"p\">.</span><span class=\"n\">product</span><span class=\"p\">(</span><span class=\"nb\">range</span><span class=\"p\">(</span><span class=\"n\">cm</span><span class=\"p\">.</span><span class=\"n\">shape</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]),</span> <span class=\"nb\">range</span><span class=\"p\">(</span><span class=\"n\">cm</span><span class=\"p\">.</span><span class=\"n\">shape</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">])):</span>\n\t\t<span class=\"n\">color</span> <span class=\"o\">=</span> <span class=\"s\">\"white\"</span> <span class=\"k\">if</span> <span class=\"n\">cm</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">,</span> <span class=\"n\">j</span><span class=\"p\">]</span> <span class=\"o\">&gt;</span> <span class=\"n\">threshold</span> <span class=\"k\">else</span> <span class=\"s\">\"black\"</span>\n\t\t<span class=\"n\">plt</span><span class=\"p\">.</span><span class=\"n\">text</span><span class=\"p\">(</span><span class=\"n\">j</span><span class=\"p\">,</span> <span class=\"n\">i</span><span class=\"p\">,</span> <span class=\"n\">cm</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">,</span> <span class=\"n\">j</span><span class=\"p\">],</span> <span class=\"n\">horizontalalignment</span><span class=\"o\">=</span><span class=\"s\">\"center\"</span><span class=\"p\">,</span> <span class=\"n\">color</span><span class=\"o\">=</span><span class=\"n\">color</span><span class=\"p\">)</span>\n\n\t<span class=\"n\">plt</span><span class=\"p\">.</span><span class=\"n\">tight_layout</span><span class=\"p\">()</span>\n\t<span class=\"n\">plt</span><span class=\"p\">.</span><span class=\"n\">ylabel</span><span class=\"p\">(</span><span class=\"s\">'True label'</span><span class=\"p\">)</span>\n\t<span class=\"n\">plt</span><span class=\"p\">.</span><span class=\"n\">xlabel</span><span class=\"p\">(</span><span class=\"s\">'Predicted label'</span><span class=\"p\">)</span>\n\t<span class=\"k\">return</span> <span class=\"n\">figure</span>\n\n<span class=\"p\">(</span><span class=\"n\">x_train</span><span class=\"p\">,</span> <span class=\"n\">y_train</span><span class=\"p\">),</span> <span class=\"p\">(</span><span class=\"n\">x_test</span><span class=\"p\">,</span> <span class=\"n\">y_test</span><span class=\"p\">)</span> <span class=\"o\">=</span> <span class=\"n\">mnist</span><span class=\"p\">.</span><span class=\"n\">load_data</span><span class=\"p\">()</span>\n<span class=\"n\">x_train</span><span class=\"p\">,</span> <span class=\"n\">x_test</span> <span class=\"o\">=</span> <span class=\"n\">x_train</span> <span class=\"o\">/</span> <span class=\"mf\">255.0</span><span class=\"p\">,</span> <span class=\"n\">x_test</span> <span class=\"o\">/</span> <span class=\"mf\">255.0</span>\n\n<span class=\"n\">time</span> <span class=\"o\">=</span> <span class=\"n\">datetime</span><span class=\"p\">.</span><span class=\"n\">datetime</span><span class=\"p\">.</span><span class=\"n\">now</span><span class=\"p\">().</span><span class=\"n\">strftime</span><span class=\"p\">(</span><span class=\"s\">\"%Y%m%d-%H%M%S\"</span><span class=\"p\">)</span>\n<span class=\"n\">log_dir</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s\">\"logs/</span><span class=\"si\">{</span><span class=\"n\">time</span><span class=\"si\">}</span><span class=\"s\">\"</span>\n<span class=\"n\">tensorboard</span> <span class=\"o\">=</span> <span class=\"n\">TensorBoard</span><span class=\"p\">(</span><span class=\"n\">log_dir</span><span class=\"o\">=</span><span class=\"n\">log_dir</span><span class=\"p\">,</span> <span class=\"n\">histogram_freq</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># Added\n</span><span class=\"n\">file_writer</span> <span class=\"o\">=</span> <span class=\"n\">tf</span><span class=\"p\">.</span><span class=\"n\">summary</span><span class=\"p\">.</span><span class=\"n\">create_file_writer</span><span class=\"p\">(</span><span class=\"n\">log_dir</span><span class=\"p\">)</span>\n<span class=\"k\">def</span> <span class=\"nf\">log_confusion_matrix</span><span class=\"p\">(</span><span class=\"n\">epoch</span><span class=\"p\">,</span> <span class=\"n\">logs</span><span class=\"p\">):</span>\n\t<span class=\"n\">test_pred_raw</span> <span class=\"o\">=</span> <span class=\"n\">model</span><span class=\"p\">.</span><span class=\"n\">predict</span><span class=\"p\">(</span><span class=\"n\">x_test</span><span class=\"p\">)</span>\n\t<span class=\"n\">test_pred</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"p\">.</span><span class=\"n\">argmax</span><span class=\"p\">(</span><span class=\"n\">test_pred_raw</span><span class=\"p\">,</span> <span class=\"n\">axis</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n\n\t<span class=\"n\">cm</span> <span class=\"o\">=</span> <span class=\"n\">sklearn</span><span class=\"p\">.</span><span class=\"n\">metrics</span><span class=\"p\">.</span><span class=\"n\">confusion_matrix</span><span class=\"p\">(</span><span class=\"n\">y_test</span><span class=\"p\">,</span> <span class=\"n\">test_pred</span><span class=\"p\">)</span>\n\t<span class=\"n\">figure</span> <span class=\"o\">=</span> <span class=\"n\">plot_confusion_matrix</span><span class=\"p\">(</span><span class=\"n\">cm</span><span class=\"p\">,</span> <span class=\"n\">class_names</span><span class=\"o\">=</span><span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"nb\">range</span><span class=\"p\">(</span><span class=\"mi\">10</span><span class=\"p\">)))</span>\n\t<span class=\"n\">cm_image</span> <span class=\"o\">=</span> <span class=\"n\">plot_to_image</span><span class=\"p\">(</span><span class=\"n\">figure</span><span class=\"p\">)</span>\n\t<span class=\"k\">with</span> <span class=\"n\">file_writer</span><span class=\"p\">.</span><span class=\"n\">as_default</span><span class=\"p\">():</span>\n\t\t<span class=\"n\">tf</span><span class=\"p\">.</span><span class=\"n\">summary</span><span class=\"p\">.</span><span class=\"n\">image</span><span class=\"p\">(</span><span class=\"s\">\"Confusion Matrix\"</span><span class=\"p\">,</span> <span class=\"n\">cm_image</span><span class=\"p\">,</span> <span class=\"n\">step</span><span class=\"o\">=</span><span class=\"n\">epoch</span><span class=\"p\">)</span>\n<span class=\"n\">cm_callback</span> <span class=\"o\">=</span> <span class=\"n\">LambdaCallback</span><span class=\"p\">(</span><span class=\"n\">on_epoch_end</span><span class=\"o\">=</span><span class=\"n\">log_confusion_matrix</span><span class=\"p\">)</span>\n\n<span class=\"n\">model</span> <span class=\"o\">=</span> <span class=\"n\">Sequential</span><span class=\"p\">([</span>\n    <span class=\"n\">Flatten</span><span class=\"p\">(</span><span class=\"n\">input_shape</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">28</span><span class=\"p\">,</span> <span class=\"mi\">28</span><span class=\"p\">)),</span>\n    <span class=\"n\">Dense</span><span class=\"p\">(</span><span class=\"mi\">512</span><span class=\"p\">,</span> <span class=\"n\">activation</span><span class=\"o\">=</span><span class=\"s\">'relu'</span><span class=\"p\">),</span>\n    <span class=\"n\">Dropout</span><span class=\"p\">(</span><span class=\"mf\">0.2</span><span class=\"p\">),</span>\n    <span class=\"n\">Dense</span><span class=\"p\">(</span><span class=\"mi\">10</span><span class=\"p\">,</span> <span class=\"n\">activation</span><span class=\"o\">=</span><span class=\"s\">'softmax'</span><span class=\"p\">)</span>\n<span class=\"p\">])</span>\n<span class=\"n\">model</span><span class=\"p\">.</span><span class=\"nb\">compile</span><span class=\"p\">(</span><span class=\"n\">optimizer</span><span class=\"o\">=</span><span class=\"s\">'adam'</span><span class=\"p\">,</span>\n              <span class=\"n\">loss</span><span class=\"o\">=</span><span class=\"s\">'sparse_categorical_crossentropy'</span><span class=\"p\">,</span>\n              <span class=\"n\">metrics</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s\">'accuracy'</span><span class=\"p\">])</span>\n\n<span class=\"n\">model</span><span class=\"p\">.</span><span class=\"n\">fit</span><span class=\"p\">(</span>\n    <span class=\"n\">x</span><span class=\"o\">=</span><span class=\"n\">x_train</span><span class=\"p\">,</span> \n    <span class=\"n\">y</span><span class=\"o\">=</span><span class=\"n\">y_train</span><span class=\"p\">,</span> \n    <span class=\"n\">epochs</span><span class=\"o\">=</span><span class=\"mi\">5</span><span class=\"p\">,</span> \n    <span class=\"n\">validation_data</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"n\">x_test</span><span class=\"p\">,</span> <span class=\"n\">y_test</span><span class=\"p\">),</span> \n    <span class=\"n\">callbacks</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"n\">tensorboard</span><span class=\"p\">,</span> <span class=\"n\">cm_callback</span><span class=\"p\">]</span> <span class=\"c1\"># added\n</span><span class=\"p\">)</span>\n</code></pre></div></div>\n<pre class=\"highlight\"><div><button class=\"btn-copy\" data-clipboard-action=\"copy\" data-clipboard-target=\"#code3\"><img src=\"https://aman.ai/images/copy.png\" style=\"margin:0; border:none; padding:2px 0px; width:100%; height:18px; width:18px;\"></button></div><code id=\"code3\"><span class=\"kn\">import</span> <span class=\"nn\">datetime</span>\n<span class=\"kn\">import</span> <span class=\"nn\">tensorflow</span> <span class=\"k\">as</span> <span class=\"n\">tf</span>\n<span class=\"kn\">from</span> <span class=\"nn\">tensorflow.keras.datasets</span> <span class=\"kn\">import</span> <span class=\"n\">mnist</span>\n<span class=\"kn\">from</span> <span class=\"nn\">tensorflow.keras.models</span> <span class=\"kn\">import</span> <span class=\"n\">Sequential</span>\n<span class=\"kn\">from</span> <span class=\"nn\">tensorflow.keras.layers</span> <span class=\"kn\">import</span> <span class=\"n\">Flatten</span><span class=\"p\">,</span> <span class=\"n\">Dense</span><span class=\"p\">,</span> <span class=\"n\">Dropout</span>\n<span class=\"kn\">from</span> <span class=\"nn\">tensorflow.keras.callbacks</span> <span class=\"kn\">import</span> <span class=\"n\">TensorBoard</span><span class=\"p\">,</span> <span class=\"n\">LambdaCallback</span> <span class=\"c1\"># added\n</span>\n<span class=\"kn\">import</span> <span class=\"nn\">io</span> <span class=\"c1\"># added\n</span><span class=\"kn\">import</span> <span class=\"nn\">itertools</span> <span class=\"c1\"># added\n</span><span class=\"kn\">import</span> <span class=\"nn\">matplotlib.pyplot</span> <span class=\"k\">as</span> <span class=\"n\">plt</span>\n<span class=\"kn\">import</span> <span class=\"nn\">numpy</span> <span class=\"k\">as</span> <span class=\"n\">np</span>\n<span class=\"kn\">import</span> <span class=\"nn\">sklearn.metrics</span>\n\n<span class=\"c1\"># Added\n</span><span class=\"k\">def</span> <span class=\"nf\">plot_to_image</span><span class=\"p\">(</span><span class=\"n\">fig</span><span class=\"p\">):</span>\n\t<span class=\"n\">buf</span> <span class=\"o\">=</span> <span class=\"n\">io</span><span class=\"p\">.</span><span class=\"n\">BytesIO</span><span class=\"p\">()</span>\n\t<span class=\"n\">plt</span><span class=\"p\">.</span><span class=\"n\">savefig</span><span class=\"p\">(</span><span class=\"n\">buf</span><span class=\"p\">,</span> <span class=\"nb\">format</span><span class=\"o\">=</span><span class=\"s\">'png'</span><span class=\"p\">)</span>\n\t<span class=\"n\">plt</span><span class=\"p\">.</span><span class=\"n\">close</span><span class=\"p\">(</span><span class=\"n\">fig</span><span class=\"p\">)</span>\n\t<span class=\"n\">buf</span><span class=\"p\">.</span><span class=\"n\">seek</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">)</span>\n\t<span class=\"n\">img</span> <span class=\"o\">=</span> <span class=\"n\">tf</span><span class=\"p\">.</span><span class=\"n\">image</span><span class=\"p\">.</span><span class=\"n\">decode_png</span><span class=\"p\">(</span><span class=\"n\">buf</span><span class=\"p\">.</span><span class=\"n\">getvalue</span><span class=\"p\">(),</span> <span class=\"n\">channels</span><span class=\"o\">=</span><span class=\"mi\">4</span><span class=\"p\">)</span>\n\t<span class=\"n\">img</span> <span class=\"o\">=</span> <span class=\"n\">tf</span><span class=\"p\">.</span><span class=\"n\">expand_dims</span><span class=\"p\">(</span><span class=\"n\">img</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">)</span>\n\t<span class=\"k\">return</span> <span class=\"n\">img</span>\n\n<span class=\"c1\"># Added\n</span><span class=\"k\">def</span> <span class=\"nf\">plot_confusion_matrix</span><span class=\"p\">(</span><span class=\"n\">cm</span><span class=\"p\">,</span> <span class=\"n\">class_names</span><span class=\"p\">):</span>\n\t<span class=\"n\">figure</span> <span class=\"o\">=</span> <span class=\"n\">plt</span><span class=\"p\">.</span><span class=\"n\">figure</span><span class=\"p\">(</span><span class=\"n\">figsize</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">8</span><span class=\"p\">,</span> <span class=\"mi\">8</span><span class=\"p\">))</span>\n\t<span class=\"n\">plt</span><span class=\"p\">.</span><span class=\"n\">imshow</span><span class=\"p\">(</span><span class=\"n\">cm</span><span class=\"p\">,</span> <span class=\"n\">interpolation</span><span class=\"o\">=</span><span class=\"s\">'nearest'</span><span class=\"p\">,</span> <span class=\"n\">cmap</span><span class=\"o\">=</span><span class=\"n\">plt</span><span class=\"p\">.</span><span class=\"n\">cm</span><span class=\"p\">.</span><span class=\"n\">Blues</span><span class=\"p\">)</span>\n\t<span class=\"n\">plt</span><span class=\"p\">.</span><span class=\"n\">title</span><span class=\"p\">(</span><span class=\"s\">\"Confusion matrix\"</span><span class=\"p\">)</span>\n\t<span class=\"n\">plt</span><span class=\"p\">.</span><span class=\"n\">colorbar</span><span class=\"p\">()</span>\n\t<span class=\"n\">tick_marks</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"p\">.</span><span class=\"n\">arange</span><span class=\"p\">(</span><span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">class_names</span><span class=\"p\">))</span>\n\t<span class=\"n\">plt</span><span class=\"p\">.</span><span class=\"n\">xticks</span><span class=\"p\">(</span><span class=\"n\">tick_marks</span><span class=\"p\">,</span> <span class=\"n\">class_names</span><span class=\"p\">,</span> <span class=\"n\">rotation</span><span class=\"o\">=</span><span class=\"mi\">45</span><span class=\"p\">)</span>\n\t<span class=\"n\">plt</span><span class=\"p\">.</span><span class=\"n\">yticks</span><span class=\"p\">(</span><span class=\"n\">tick_marks</span><span class=\"p\">,</span> <span class=\"n\">class_names</span><span class=\"p\">)</span>\n\n\t<span class=\"n\">cm</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"p\">.</span><span class=\"n\">around</span><span class=\"p\">(</span><span class=\"n\">cm</span><span class=\"p\">.</span><span class=\"n\">astype</span><span class=\"p\">(</span><span class=\"s\">'float'</span><span class=\"p\">)</span> <span class=\"o\">/</span> <span class=\"n\">cm</span><span class=\"p\">.</span><span class=\"nb\">sum</span><span class=\"p\">(</span><span class=\"n\">axis</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">)[:,</span> <span class=\"n\">np</span><span class=\"p\">.</span><span class=\"n\">newaxis</span><span class=\"p\">],</span> <span class=\"n\">decimals</span><span class=\"o\">=</span><span class=\"mi\">2</span><span class=\"p\">)</span>\n\n\t<span class=\"n\">threshold</span> <span class=\"o\">=</span> <span class=\"n\">cm</span><span class=\"p\">.</span><span class=\"nb\">max</span><span class=\"p\">()</span> <span class=\"o\">/</span> <span class=\"mf\">2.</span>\n\t<span class=\"k\">for</span> <span class=\"n\">i</span><span class=\"p\">,</span> <span class=\"n\">j</span> <span class=\"ow\">in</span> <span class=\"n\">itertools</span><span class=\"p\">.</span><span class=\"n\">product</span><span class=\"p\">(</span><span class=\"nb\">range</span><span class=\"p\">(</span><span class=\"n\">cm</span><span class=\"p\">.</span><span class=\"n\">shape</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]),</span> <span class=\"nb\">range</span><span class=\"p\">(</span><span class=\"n\">cm</span><span class=\"p\">.</span><span class=\"n\">shape</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">])):</span>\n\t\t<span class=\"n\">color</span> <span class=\"o\">=</span> <span class=\"s\">\"white\"</span> <span class=\"k\">if</span> <span class=\"n\">cm</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">,</span> <span class=\"n\">j</span><span class=\"p\">]</span> <span class=\"o\">&gt;</span> <span class=\"n\">threshold</span> <span class=\"k\">else</span> <span class=\"s\">\"black\"</span>\n\t\t<span class=\"n\">plt</span><span class=\"p\">.</span><span class=\"n\">text</span><span class=\"p\">(</span><span class=\"n\">j</span><span class=\"p\">,</span> <span class=\"n\">i</span><span class=\"p\">,</span> <span class=\"n\">cm</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">,</span> <span class=\"n\">j</span><span class=\"p\">],</span> <span class=\"n\">horizontalalignment</span><span class=\"o\">=</span><span class=\"s\">\"center\"</span><span class=\"p\">,</span> <span class=\"n\">color</span><span class=\"o\">=</span><span class=\"n\">color</span><span class=\"p\">)</span>\n\n\t<span class=\"n\">plt</span><span class=\"p\">.</span><span class=\"n\">tight_layout</span><span class=\"p\">()</span>\n\t<span class=\"n\">plt</span><span class=\"p\">.</span><span class=\"n\">ylabel</span><span class=\"p\">(</span><span class=\"s\">'True label'</span><span class=\"p\">)</span>\n\t<span class=\"n\">plt</span><span class=\"p\">.</span><span class=\"n\">xlabel</span><span class=\"p\">(</span><span class=\"s\">'Predicted label'</span><span class=\"p\">)</span>\n\t<span class=\"k\">return</span> <span class=\"n\">figure</span>\n\n<span class=\"p\">(</span><span class=\"n\">x_train</span><span class=\"p\">,</span> <span class=\"n\">y_train</span><span class=\"p\">),</span> <span class=\"p\">(</span><span class=\"n\">x_test</span><span class=\"p\">,</span> <span class=\"n\">y_test</span><span class=\"p\">)</span> <span class=\"o\">=</span> <span class=\"n\">mnist</span><span class=\"p\">.</span><span class=\"n\">load_data</span><span class=\"p\">()</span>\n<span class=\"n\">x_train</span><span class=\"p\">,</span> <span class=\"n\">x_test</span> <span class=\"o\">=</span> <span class=\"n\">x_train</span> <span class=\"o\">/</span> <span class=\"mf\">255.0</span><span class=\"p\">,</span> <span class=\"n\">x_test</span> <span class=\"o\">/</span> <span class=\"mf\">255.0</span>\n\n<span class=\"n\">time</span> <span class=\"o\">=</span> <span class=\"n\">datetime</span><span class=\"p\">.</span><span class=\"n\">datetime</span><span class=\"p\">.</span><span class=\"n\">now</span><span class=\"p\">().</span><span class=\"n\">strftime</span><span class=\"p\">(</span><span class=\"s\">\"%Y%m%d-%H%M%S\"</span><span class=\"p\">)</span>\n<span class=\"n\">log_dir</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s\">\"logs/</span><span class=\"si\">{</span><span class=\"n\">time</span><span class=\"si\">}</span><span class=\"s\">\"</span>\n<span class=\"n\">tensorboard</span> <span class=\"o\">=</span> <span class=\"n\">TensorBoard</span><span class=\"p\">(</span><span class=\"n\">log_dir</span><span class=\"o\">=</span><span class=\"n\">log_dir</span><span class=\"p\">,</span> <span class=\"n\">histogram_freq</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># Added\n</span><span class=\"n\">file_writer</span> <span class=\"o\">=</span> <span class=\"n\">tf</span><span class=\"p\">.</span><span class=\"n\">summary</span><span class=\"p\">.</span><span class=\"n\">create_file_writer</span><span class=\"p\">(</span><span class=\"n\">log_dir</span><span class=\"p\">)</span>\n<span class=\"k\">def</span> <span class=\"nf\">log_confusion_matrix</span><span class=\"p\">(</span><span class=\"n\">epoch</span><span class=\"p\">,</span> <span class=\"n\">logs</span><span class=\"p\">):</span>\n\t<span class=\"n\">test_pred_raw</span> <span class=\"o\">=</span> <span class=\"n\">model</span><span class=\"p\">.</span><span class=\"n\">predict</span><span class=\"p\">(</span><span class=\"n\">x_test</span><span class=\"p\">)</span>\n\t<span class=\"n\">test_pred</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"p\">.</span><span class=\"n\">argmax</span><span class=\"p\">(</span><span class=\"n\">test_pred_raw</span><span class=\"p\">,</span> <span class=\"n\">axis</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n\n\t<span class=\"n\">cm</span> <span class=\"o\">=</span> <span class=\"n\">sklearn</span><span class=\"p\">.</span><span class=\"n\">metrics</span><span class=\"p\">.</span><span class=\"n\">confusion_matrix</span><span class=\"p\">(</span><span class=\"n\">y_test</span><span class=\"p\">,</span> <span class=\"n\">test_pred</span><span class=\"p\">)</span>\n\t<span class=\"n\">figure</span> <span class=\"o\">=</span> <span class=\"n\">plot_confusion_matrix</span><span class=\"p\">(</span><span class=\"n\">cm</span><span class=\"p\">,</span> <span class=\"n\">class_names</span><span class=\"o\">=</span><span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"nb\">range</span><span class=\"p\">(</span><span class=\"mi\">10</span><span class=\"p\">)))</span>\n\t<span class=\"n\">cm_image</span> <span class=\"o\">=</span> <span class=\"n\">plot_to_image</span><span class=\"p\">(</span><span class=\"n\">figure</span><span class=\"p\">)</span>\n\t<span class=\"k\">with</span> <span class=\"n\">file_writer</span><span class=\"p\">.</span><span class=\"n\">as_default</span><span class=\"p\">():</span>\n\t\t<span class=\"n\">tf</span><span class=\"p\">.</span><span class=\"n\">summary</span><span class=\"p\">.</span><span class=\"n\">image</span><span class=\"p\">(</span><span class=\"s\">\"Confusion Matrix\"</span><span class=\"p\">,</span> <span class=\"n\">cm_image</span><span class=\"p\">,</span> <span class=\"n\">step</span><span class=\"o\">=</span><span class=\"n\">epoch</span><span class=\"p\">)</span>\n<span class=\"n\">cm_callback</span> <span class=\"o\">=</span> <span class=\"n\">LambdaCallback</span><span class=\"p\">(</span><span class=\"n\">on_epoch_end</span><span class=\"o\">=</span><span class=\"n\">log_confusion_matrix</span><span class=\"p\">)</span>\n\n<span class=\"n\">model</span> <span class=\"o\">=</span> <span class=\"n\">Sequential</span><span class=\"p\">([</span>\n    <span class=\"n\">Flatten</span><span class=\"p\">(</span><span class=\"n\">input_shape</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">28</span><span class=\"p\">,</span> <span class=\"mi\">28</span><span class=\"p\">)),</span>\n    <span class=\"n\">Dense</span><span class=\"p\">(</span><span class=\"mi\">512</span><span class=\"p\">,</span> <span class=\"n\">activation</span><span class=\"o\">=</span><span class=\"s\">'relu'</span><span class=\"p\">),</span>\n    <span class=\"n\">Dropout</span><span class=\"p\">(</span><span class=\"mf\">0.2</span><span class=\"p\">),</span>\n    <span class=\"n\">Dense</span><span class=\"p\">(</span><span class=\"mi\">10</span><span class=\"p\">,</span> <span class=\"n\">activation</span><span class=\"o\">=</span><span class=\"s\">'softmax'</span><span class=\"p\">)</span>\n<span class=\"p\">])</span>\n<span class=\"n\">model</span><span class=\"p\">.</span><span class=\"nb\">compile</span><span class=\"p\">(</span><span class=\"n\">optimizer</span><span class=\"o\">=</span><span class=\"s\">'adam'</span><span class=\"p\">,</span>\n              <span class=\"n\">loss</span><span class=\"o\">=</span><span class=\"s\">'sparse_categorical_crossentropy'</span><span class=\"p\">,</span>\n              <span class=\"n\">metrics</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s\">'accuracy'</span><span class=\"p\">])</span>\n\n<span class=\"n\">model</span><span class=\"p\">.</span><span class=\"n\">fit</span><span class=\"p\">(</span>\n    <span class=\"n\">x</span><span class=\"o\">=</span><span class=\"n\">x_train</span><span class=\"p\">,</span> \n    <span class=\"n\">y</span><span class=\"o\">=</span><span class=\"n\">y_train</span><span class=\"p\">,</span> \n    <span class=\"n\">epochs</span><span class=\"o\">=</span><span class=\"mi\">5</span><span class=\"p\">,</span> \n    <span class=\"n\">validation_data</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"n\">x_test</span><span class=\"p\">,</span> <span class=\"n\">y_test</span><span class=\"p\">),</span> \n    <span class=\"n\">callbacks</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"n\">tensorboard</span><span class=\"p\">,</span> <span class=\"n\">cm_callback</span><span class=\"p\">]</span> <span class=\"c1\"># added\n</span><span class=\"p\">)</span>\n</code></pre>\n<ul>\n  <li><code class=\"language-plaintext highlighter-rouge\">LambdaCallback</code>s allow us to view the history of confusion matrices summarizing our model’s performance on the val set over time:</li>\n</ul>\n<p><img src=\"/primers/ai/assets/hyperparam-tuning-and-tensorboard/confusion.png\" alt=\"\"></p>",
    "contentMarkdown": "*   The previous example showed how to log images from the training set at the beginning of training, but it would be more helpful to be able to log images and figures continusouly over the course of training.\n*   For example, if we were training a GAN, monitoring the loss curves of the generator and discriminator over time wouldn’t give much insight into the performance of the model, and it would be much more illuminating to be able to view samples generated over time to see if sample quality is improving.\n*   Likewise, for a classification task like MNIST digit classification, being able to see the evolution of confusion matrices or ROC curves over time can give a better sense of model performance than a single number like accuracy. Here we show how to plot confusion matrices at the end of each epoch.\n*   We can define custom logging behavior that executes at fixed intervals during training using a `LambdaCallback`.\n*   In the code below, we define a function `log_confusion_matrix` that generates the model’s predictions on the val set and creates a confusion matrix image using the `sklearn.metrics.confusion_matrix()` function, and create a callback that plots the confusion matrix at the end of every epoch with `cm_callback = LambdaCallback(on_epoch_end=log_confusion_matrix)`.\n\n![](https://aman.ai/images/copy.png)\n\n`import datetime import tensorflow as tf from tensorflow.keras.datasets import mnist from tensorflow.keras.models import Sequential from tensorflow.keras.layers import Flatten, Dense, Dropout from tensorflow.keras.callbacks import TensorBoard, LambdaCallback # added import io # added import itertools # added import matplotlib.pyplot as plt import numpy as np import sklearn.metrics  # Added def plot_to_image(fig): \tbuf = io.BytesIO() \tplt.savefig(buf, format='png') \tplt.close(fig) \tbuf.seek(0) \timg = tf.image.decode_png(buf.getvalue(), channels=4) \timg = tf.expand_dims(img, 0) \treturn img  # Added def plot_confusion_matrix(cm, class_names): \tfigure = plt.figure(figsize=(8, 8)) \tplt.imshow(cm, interpolation='nearest', cmap=plt.cm.Blues) \tplt.title(\"Confusion matrix\") \tplt.colorbar() \ttick_marks = np.arange(len(class_names)) \tplt.xticks(tick_marks, class_names, rotation=45) \tplt.yticks(tick_marks, class_names)  \tcm = np.around(cm.astype('float') / cm.sum(axis=1)[:, np.newaxis], decimals=2)  \tthreshold = cm.max() / 2. \tfor i, j in itertools.product(range(cm.shape[0]), range(cm.shape[1])): \t\tcolor = \"white\" if cm[i, j] > threshold else \"black\" \t\tplt.text(j, i, cm[i, j], horizontalalignment=\"center\", color=color)  \tplt.tight_layout() \tplt.ylabel('True label') \tplt.xlabel('Predicted label') \treturn figure  (x_train, y_train), (x_test, y_test) = mnist.load_data() x_train, x_test = x_train / 255.0, x_test / 255.0  time = datetime.datetime.now().strftime(\"%Y%m%d-%H%M%S\") log_dir = f\"logs/{time}\" tensorboard = TensorBoard(log_dir=log_dir, histogram_freq=1)  # Added file_writer = tf.summary.create_file_writer(log_dir) def log_confusion_matrix(epoch, logs): \ttest_pred_raw = model.predict(x_test) \ttest_pred = np.argmax(test_pred_raw, axis=1)  \tcm = sklearn.metrics.confusion_matrix(y_test, test_pred) \tfigure = plot_confusion_matrix(cm, class_names=list(range(10))) \tcm_image = plot_to_image(figure) \twith file_writer.as_default(): \t\ttf.summary.image(\"Confusion Matrix\", cm_image, step=epoch) cm_callback = LambdaCallback(on_epoch_end=log_confusion_matrix)  model = Sequential([     Flatten(input_shape=(28, 28)),     Dense(512, activation='relu'),     Dropout(0.2),     Dense(10, activation='softmax') ]) model.compile(optimizer='adam',               loss='sparse_categorical_crossentropy',               metrics=['accuracy'])  model.fit(     x=x_train,      y=y_train,      epochs=5,      validation_data=(x_test, y_test),      callbacks=[tensorboard, cm_callback] # added )`\n\n![](https://aman.ai/images/copy.png)\n\n`import datetime import tensorflow as tf from tensorflow.keras.datasets import mnist from tensorflow.keras.models import Sequential from tensorflow.keras.layers import Flatten, Dense, Dropout from tensorflow.keras.callbacks import TensorBoard, LambdaCallback # added import io # added import itertools # added import matplotlib.pyplot as plt import numpy as np import sklearn.metrics  # Added def plot_to_image(fig): \tbuf = io.BytesIO() \tplt.savefig(buf, format='png') \tplt.close(fig) \tbuf.seek(0) \timg = tf.image.decode_png(buf.getvalue(), channels=4) \timg = tf.expand_dims(img, 0) \treturn img  # Added def plot_confusion_matrix(cm, class_names): \tfigure = plt.figure(figsize=(8, 8)) \tplt.imshow(cm, interpolation='nearest', cmap=plt.cm.Blues) \tplt.title(\"Confusion matrix\") \tplt.colorbar() \ttick_marks = np.arange(len(class_names)) \tplt.xticks(tick_marks, class_names, rotation=45) \tplt.yticks(tick_marks, class_names)  \tcm = np.around(cm.astype('float') / cm.sum(axis=1)[:, np.newaxis], decimals=2)  \tthreshold = cm.max() / 2. \tfor i, j in itertools.product(range(cm.shape[0]), range(cm.shape[1])): \t\tcolor = \"white\" if cm[i, j] > threshold else \"black\" \t\tplt.text(j, i, cm[i, j], horizontalalignment=\"center\", color=color)  \tplt.tight_layout() \tplt.ylabel('True label') \tplt.xlabel('Predicted label') \treturn figure  (x_train, y_train), (x_test, y_test) = mnist.load_data() x_train, x_test = x_train / 255.0, x_test / 255.0  time = datetime.datetime.now().strftime(\"%Y%m%d-%H%M%S\") log_dir = f\"logs/{time}\" tensorboard = TensorBoard(log_dir=log_dir, histogram_freq=1)  # Added file_writer = tf.summary.create_file_writer(log_dir) def log_confusion_matrix(epoch, logs): \ttest_pred_raw = model.predict(x_test) \ttest_pred = np.argmax(test_pred_raw, axis=1)  \tcm = sklearn.metrics.confusion_matrix(y_test, test_pred) \tfigure = plot_confusion_matrix(cm, class_names=list(range(10))) \tcm_image = plot_to_image(figure) \twith file_writer.as_default(): \t\ttf.summary.image(\"Confusion Matrix\", cm_image, step=epoch) cm_callback = LambdaCallback(on_epoch_end=log_confusion_matrix)  model = Sequential([     Flatten(input_shape=(28, 28)),     Dense(512, activation='relu'),     Dropout(0.2),     Dense(10, activation='softmax') ]) model.compile(optimizer='adam',               loss='sparse_categorical_crossentropy',               metrics=['accuracy'])  model.fit(     x=x_train,      y=y_train,      epochs=5,      validation_data=(x_test, y_test),      callbacks=[tensorboard, cm_callback] # added )`\n\n*   `LambdaCallback`s allow us to view the history of confusion matrices summarizing our model’s performance on the val set over time:\n\n![](/primers/ai/assets/hyperparam-tuning-and-tensorboard/confusion.png)",
    "order": 5,
    "orderInChapter": 5,
    "difficulty": 3,
    "estimatedMinutes": 4,
    "tags": [
      "miscellaneous",
      "activation",
      "dropout"
    ],
    "metadata": {
      "hasCode": true,
      "hasMath": false,
      "hasImages": true,
      "wordCount": 662,
      "contentLength": 32500
    },
    "nextCards": [],
    "relatedCards": [],
    "prerequisites": [],
    "sourceUrl": "https://aman.ai/primers/ai/tensorboard/#custom-logging-callbacks",
    "scrapedAt": "2025-12-28T11:57:36.923Z"
  }
]