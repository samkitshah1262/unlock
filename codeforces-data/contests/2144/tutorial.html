<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tutorial</title>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
      line-height: 1.6;
      color: #333;
      background: #fafafa;
    }
    .ttypography {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    h3 {
      color: #1a1a1a;
      border-bottom: 2px solid #eee;
      padding-bottom: 10px;
    }
    h3 a {
      color: #0066cc;
      text-decoration: none;
    }
    h3 a:hover {
      text-decoration: underline;
    }
    .spoiler {
      margin: 15px 0;
      border: 1px solid #ddd;
      border-radius: 6px;
      overflow: hidden;
    }
    .spoiler-title {
      display: block;
      padding: 12px 15px;
      background: #f0f0f0;
      cursor: pointer;
      font-weight: 600;
      user-select: none;
      border-bottom: 1px solid #ddd;
    }
    .spoiler-title:hover {
      background: #e8e8e8;
    }
    .spoiler-title::before {
      content: '▶ ';
      font-size: 0.8em;
      transition: transform 0.2s;
      display: inline-block;
    }
    .spoiler.open .spoiler-title::before {
      content: '▼ ';
    }
    .spoiler-content {
      padding: 15px;
      background: #fff;
      display: none;
    }
    .spoiler.open .spoiler-content {
      display: block;
    }
    pre, code {
      background: #f5f5f5;
      font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
      font-size: 0.85em;
    }
    pre {
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
    }
    code {
      padding: 2px 5px;
      border-radius: 3px;
    }
    p {
      margin: 10px 0;
    }
    .MathJax {
      font-size: 1.1em;
    }
  </style>
</head>
<body>
  <h1>Editorial</h1>
  <p><a href="https://codeforces.com/blog/entry/146474" target="_blank">View on Codeforces →</a></p>
  
  <div class="ttypography"><p><a href="https://codeforces.com/contest/2144/problem/A" title="Educational Codeforces Round 182 (Rated for Div. 2)">2144A - Cut the Array</a></p><p>Idea: <a class="rated-user user-red" href="https://codeforces.com/profile/BledDest" title="International Grandmaster BledDest">BledDest</a></p> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2144/problem/A" title="Educational Codeforces Round 182 (Rated for Div. 2)">2144A - Cut the Array</a></h3><div class="ttypography"><div class="problem-statement"><div><p>Of course, we can iterate through the positions <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-471"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-472">l</span></span></span><script type="math/tex" id="MathJax-Element-54">l</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-473"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-474">r</span></span></span><script type="math/tex" id="MathJax-Element-55">r</script>, and then check if we get a valid cut. However, there is a simpler solution.</p><p>Let's try to rephrase the condition "either all numbers <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-475"><span class="MJXp-msubsup" id="MJXp-Span-476"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-477" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-478" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-479" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-480"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-481" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-482" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-483" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-484"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-485" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-486" style="vertical-align: -0.4em;">3</span></span></span></span><script type="math/tex" id="MathJax-Element-56">s_1, s_2, s_3</script> are different, or all numbers <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-487"><span class="MJXp-msubsup" id="MJXp-Span-488"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-489" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-490" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-491" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-492"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-493" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-494" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-495" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-496"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-497" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-498" style="vertical-align: -0.4em;">3</span></span></span></span><script type="math/tex" id="MathJax-Element-57">s_1, s_2, s_3</script> are the same". Since these are remainders when divided by <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-499"><span class="MJXp-mn" id="MJXp-Span-500">3</span></span></span><script type="math/tex" id="MathJax-Element-58">3</script>, their sum will be equal to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-501"><span class="MJXp-mn" id="MJXp-Span-502">0</span></span></span><script type="math/tex" id="MathJax-Element-59">0</script> modulo <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-503"><span class="MJXp-mn" id="MJXp-Span-504">3</span></span></span><script type="math/tex" id="MathJax-Element-60">3</script>:</p><ul> <li> if they are all equal to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-505"><span class="MJXp-mn" id="MJXp-Span-506">0</span></span></span><script type="math/tex" id="MathJax-Element-61">0</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-507"><span class="MJXp-mn" id="MJXp-Span-508">1</span></span></span><script type="math/tex" id="MathJax-Element-62">1</script>, or <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-509"><span class="MJXp-mn" id="MJXp-Span-510">2</span></span></span><script type="math/tex" id="MathJax-Element-63">2</script>, then their sum is divisible by <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-511"><span class="MJXp-mn" id="MJXp-Span-512">3</span></span></span><script type="math/tex" id="MathJax-Element-64">3</script>; </li><li> otherwise, one of them is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-513"><span class="MJXp-mn" id="MJXp-Span-514">0</span></span></span><script type="math/tex" id="MathJax-Element-65">0</script>, another is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-515"><span class="MJXp-mn" id="MJXp-Span-516">1</span></span></span><script type="math/tex" id="MathJax-Element-66">1</script>, and the third is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-517"><span class="MJXp-mn" id="MJXp-Span-518">2</span></span></span><script type="math/tex" id="MathJax-Element-67">2</script>, and their sum equals <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-519"><span class="MJXp-mn" id="MJXp-Span-520">3</span></span></span><script type="math/tex" id="MathJax-Element-68">3</script>. </li></ul><p>On the other hand, if <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-521"><span class="MJXp-msubsup" id="MJXp-Span-522"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-523" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-524" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-525" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-526"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-527" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-528" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-529" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-530"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-531" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-532" style="vertical-align: -0.4em;">3</span></span></span></span><script type="math/tex" id="MathJax-Element-69">s_1+s_2+s_3</script> is equal to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-533"><span class="MJXp-mn" id="MJXp-Span-534">0</span></span></span><script type="math/tex" id="MathJax-Element-70">0</script> modulo <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-535"><span class="MJXp-mn" id="MJXp-Span-536">3</span></span></span><script type="math/tex" id="MathJax-Element-71">3</script>, then there are two possible cases:</p><ul> <li> either <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-537"><span class="MJXp-msubsup" id="MJXp-Span-538"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-539" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-540" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-541" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-542"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-543" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-544" style="vertical-align: -0.4em;">2</span></span></span></span><script type="math/tex" id="MathJax-Element-72">s_1 = s_2</script>, in which case <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-545"><span class="MJXp-msubsup" id="MJXp-Span-546"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-547" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-548" style="vertical-align: -0.4em;">3</span></span></span></span><script type="math/tex" id="MathJax-Element-73">s_3</script> will be equal to them (otherwise their sum would not be divisible by <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-549"><span class="MJXp-mn" id="MJXp-Span-550">3</span></span></span><script type="math/tex" id="MathJax-Element-74">3</script>); </li><li> or <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-551"><span class="MJXp-msubsup" id="MJXp-Span-552"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-553" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-554" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-555" style="margin-left: 0.333em; margin-right: 0.333em;">≠</span><span class="MJXp-msubsup" id="MJXp-Span-556"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-557" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-558" style="vertical-align: -0.4em;">2</span></span></span></span><script type="math/tex" id="MathJax-Element-75">s_1 \ne s_2</script>, then <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-559"><span class="MJXp-msubsup" id="MJXp-Span-560"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-561" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-562" style="vertical-align: -0.4em;">3</span></span><span class="MJXp-mo" id="MJXp-Span-563" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-564">3</span><span class="MJXp-mo" id="MJXp-Span-565" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-566"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-567" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-568" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-569" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-570"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-571" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-572" style="vertical-align: -0.4em;">2</span></span></span></span><script type="math/tex" id="MathJax-Element-76">s_3 = 3 - s_1 - s_2</script>, and regardless of the values of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-573"><span class="MJXp-msubsup" id="MJXp-Span-574"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-575" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-576" style="vertical-align: -0.4em;">1</span></span></span></span><script type="math/tex" id="MathJax-Element-77">s_1</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-577"><span class="MJXp-msubsup" id="MJXp-Span-578"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-579" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-580" style="vertical-align: -0.4em;">2</span></span></span></span><script type="math/tex" id="MathJax-Element-78">s_2</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-581"><span class="MJXp-msubsup" id="MJXp-Span-582"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-583" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-584" style="vertical-align: -0.4em;">3</span></span></span></span><script type="math/tex" id="MathJax-Element-79">s_3</script> will differ from them. </li></ul><p>Thus, if the sum of the array is not divisible by <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-585"><span class="MJXp-mn" id="MJXp-Span-586">3</span></span></span><script type="math/tex" id="MathJax-Element-80">3</script>, then there is no suitable cut; and if it is divisible by <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-587"><span class="MJXp-mn" id="MJXp-Span-588">3</span></span></span><script type="math/tex" id="MathJax-Element-81">3</script>, then any cut will be valid.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Solution (BledDest)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="pln">t </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">(</span><span class="pln">input</span><span class="pun">())</span><span class="pln">
</span><span class="kwd">for</span><span class="pln"> i </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="pln">t</span><span class="pun">):</span><span class="pln">
    n </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">(</span><span class="pln">input</span><span class="pun">())</span><span class="pln">
    a </span><span class="pun">=</span><span class="pln"> list</span><span class="pun">(</span><span class="pln">map</span><span class="pun">(</span><span class="kwd">int</span><span class="pun">,</span><span class="pln"> input</span><span class="pun">().</span><span class="pln">split</span><span class="pun">()))</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> sum</span><span class="pun">(</span><span class="pln">a</span><span class="pun">)</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">:</span><span class="pln">
        </span><span class="kwd">print</span><span class="pun">(</span><span class="str">"1 2"</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">else</span><span class="pun">:</span><span class="pln">
        </span><span class="kwd">print</span><span class="pun">(</span><span class="str">"0 0"</span><span class="pun">)</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2144/problem/B" title="Educational Codeforces Round 182 (Rated for Div. 2)">2144B - Maximum Cost Permutation</a></p><p>Idea: <a class="rated-user user-red" href="https://codeforces.com/profile/BledDest" title="International Grandmaster BledDest">BledDest</a></p> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2144/problem/B" title="Educational Codeforces Round 182 (Rated for Div. 2)">2144B - Maximum Cost Permutation</a></h3><div class="ttypography"><div class="problem-statement"><div><p>First, let's understand how to calculate the cost of a permutation. I claim that the minimum subsegment that needs to be sorted is the one whose ends are the leftmost and rightmost elements that are not in their correct positions. On one hand, this segment cannot be shorter because these elements must be included in it. On the other hand, if we sort the subarray that includes all the elements that are not in their correct positions, the permutation will definitely become sorted in ascending order — all the elements outside this segment were already in their correct positions, and all the elements within the segment will be arranged in the correct order.</p><p>Now we need to create a permutation from the given array such that the minimum and maximum positions of the elements that are not in their correct positions are as far apart as possible. If there is only one <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-589"><span class="MJXp-mn" id="MJXp-Span-590">0</span></span></span><script type="math/tex" id="MathJax-Element-82">0</script> in the array, there is only one way to turn it into a permutation, and we just need to check the answer for that case.</p><p>However, if there are multiple elements equal to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-591"><span class="MJXp-mn" id="MJXp-Span-592">0</span></span></span><script type="math/tex" id="MathJax-Element-83">0</script> in the array, there is always a way to place the missing elements such that at all positions where there were previously <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-593"><span class="MJXp-mn" id="MJXp-Span-594">0</span></span></span><script type="math/tex" id="MathJax-Element-84">0</script>s, there are elements that do not equal those positions. To do this, we can proceed as follows: first, we place the missing elements in such a way that as many elements as possible match their positions (if we are missing element <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-595"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-596">i</span></span></span><script type="math/tex" id="MathJax-Element-85">i</script> and position <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-597"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-598">i</span></span></span><script type="math/tex" id="MathJax-Element-86">i</script> in the array contains <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-599"><span class="MJXp-mn" id="MJXp-Span-600">0</span></span></span><script type="math/tex" id="MathJax-Element-87">0</script>, we place <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-601"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-602">i</span></span></span><script type="math/tex" id="MathJax-Element-88">i</script> there; the remaining elements can be placed arbitrarily), and then we cyclically shift all the placed elements (that is, we place the first placed element in the second free position, the second in the third, and so on). This way, for every position of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-603"><span class="MJXp-mn" id="MJXp-Span-604">0</span></span></span><script type="math/tex" id="MathJax-Element-89">0</script>, there will be an element which is not equal the position.</p><p>Therefore, if there is more than one zero in the given array, we can simply find the longest prefix and the longest suffix where all elements match their positions, assuming that zeros can always be replaced in such a way that they do not match their positions. The segment between this prefix and suffix will be the segment that needs to be sorted.</p><p>Time complexity of the solution is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-605"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-606">O</span><span class="MJXp-mo" id="MJXp-Span-607" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-608">n</span><span class="MJXp-mo" id="MJXp-Span-609" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-90">O(n)</script>.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Solution (BledDest)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
 
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">void</span><span class="pln"> solve</span><span class="pun">()</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
    vector</span><span class="str">&lt;int&gt;</span><span class="pln"> p</span><span class="pun">(</span><span class="pln">n</span><span class="pun">);</span><span class="pln">
    vector</span><span class="str">&lt;int&gt;</span><span class="pln"> pos0</span><span class="pun">;</span><span class="pln">
    vector</span><span class="str">&lt;int&gt;</span><span class="pln"> used</span><span class="pun">(</span><span class="pln">n</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
        cin </span><span class="pun">&gt;&gt;</span><span class="pln"> p</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
        </span><span class="pun">--</span><span class="pln">p</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">p</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">)</span><span class="pln">
            pos0</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">i</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">else</span><span class="pln">
            used</span><span class="pun">[</span><span class="pln">p</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">pos0</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> 
    </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> unused </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">used</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> unused </span><span class="pun">=</span><span class="pln"> i</span><span class="pun">;</span><span class="pln">
        p</span><span class="pun">[</span><span class="pln">pos0</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> unused</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> l </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> r </span><span class="pun">=</span><span class="pln"> n </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pun">(</span><span class="pln">l </span><span class="pun">&lt;</span><span class="pln"> n </span><span class="pun">&amp;&amp;</span><span class="pln"> p</span><span class="pun">[</span><span class="pln">l</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> l</span><span class="pun">)</span><span class="pln"> l</span><span class="pun">++;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pun">(</span><span class="pln">r </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> p</span><span class="pun">[</span><span class="pln">r</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> r</span><span class="pun">)</span><span class="pln"> r</span><span class="pun">--;</span><span class="pln">
    cout </span><span class="pun">&lt;&lt;</span><span class="pln"> max</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> r </span><span class="pun">-</span><span class="pln"> l </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"\n"</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    ios_base</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
        solve</span><span class="pun">();</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2144/problem/C" title="Educational Codeforces Round 182 (Rated for Div. 2)">2144C - Non-Descending Arrays</a></p><p>Idea: <a class="rated-user user-red" href="https://codeforces.com/profile/BledDest" title="International Grandmaster BledDest">BledDest</a></p> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2144/problem/C" title="Educational Codeforces Round 182 (Rated for Div. 2)">2144C - Non-Descending Arrays</a></h3><div class="ttypography"><div class="problem-statement"><div><p>First, let's understand how we can always obtain at least one subset. Let's keep the maximum elements from all pairs in one array, and the minimums in another (that is, if <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-610"><span class="MJXp-msubsup" id="MJXp-Span-611"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-612" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-613" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-614" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-msubsup" id="MJXp-Span-615"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-616" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-617" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-91">a_i > b_i</script>, we swap them, so that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-618"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-619">a</span></span></span><script type="math/tex" id="MathJax-Element-92">a</script> will contain the minimums from each pair, and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-620"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-621">b</span></span></span><script type="math/tex" id="MathJax-Element-93">b</script> will contain the maximums).</p><p>We can prove that if there is at least one way to make both arrays sorted, then this way will definitely work. To do this, let's assume that we have reached a situation where one of the arrays is not sorted using this method:</p><ul> <li> if in array <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-622"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-623">a</span></span></span><script type="math/tex" id="MathJax-Element-94">a</script> we have a pair of elements <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-624"><span class="MJXp-msubsup" id="MJXp-Span-625"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-626" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-627" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-628" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-msubsup" id="MJXp-Span-629"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-630" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-631" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-632">i</span><span class="MJXp-mo" id="MJXp-Span-633">+</span><span class="MJXp-mn" id="MJXp-Span-634">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-95">a_i > a_{i+1}</script>, then considering that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-635"><span class="MJXp-msubsup" id="MJXp-Span-636"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-637" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-638" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-639" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-msubsup" id="MJXp-Span-640"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-641" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-642" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-96">a_i \le b_i</script>, it follows that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-643"><span class="MJXp-msubsup" id="MJXp-Span-644"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-645" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-646" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-647" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-msubsup" id="MJXp-Span-648"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-649" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-650" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-651">i</span><span class="MJXp-mo" id="MJXp-Span-652">+</span><span class="MJXp-mn" id="MJXp-Span-653">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-97">b_i > a_{i+1}</script>. This means that whichever of the two elements <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-654"><span class="MJXp-mo" id="MJXp-Span-655" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-656"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-657" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-658" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-659" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-660"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-661" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-662" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-663" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-98">(a_i, b_i)</script> we place before <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-664"><span class="MJXp-msubsup" id="MJXp-Span-665"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-666" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-667" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-668">i</span><span class="MJXp-mo" id="MJXp-Span-669">+</span><span class="MJXp-mn" id="MJXp-Span-670">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-99">a_{i+1}</script>, it will definitely be greater; </li><li> if in array <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-671"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-672">b</span></span></span><script type="math/tex" id="MathJax-Element-100">b</script> we have a pair of elements <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-673"><span class="MJXp-msubsup" id="MJXp-Span-674"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-675" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-676" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-677" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-msubsup" id="MJXp-Span-678"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-679" style="margin-right: 0.05em;">b</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-680" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-681">i</span><span class="MJXp-mo" id="MJXp-Span-682">+</span><span class="MJXp-mn" id="MJXp-Span-683">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-101">b_i > b_{i+1}</script>, then considering that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-684"><span class="MJXp-msubsup" id="MJXp-Span-685"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-686" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-687" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-688">i</span><span class="MJXp-mo" id="MJXp-Span-689">+</span><span class="MJXp-mn" id="MJXp-Span-690">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-691" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-msubsup" id="MJXp-Span-692"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-693" style="margin-right: 0.05em;">b</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-694" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-695">i</span><span class="MJXp-mo" id="MJXp-Span-696">+</span><span class="MJXp-mn" id="MJXp-Span-697">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-102">a_{i+1} \le b_{i+1}</script>, it follows that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-698"><span class="MJXp-msubsup" id="MJXp-Span-699"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-700" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-701" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-702" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-msubsup" id="MJXp-Span-703"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-704" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-705" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-706">i</span><span class="MJXp-mo" id="MJXp-Span-707">+</span><span class="MJXp-mn" id="MJXp-Span-708">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-103">b_i > a_{i+1}</script>. This means that whichever of the two elements <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-709"><span class="MJXp-mo" id="MJXp-Span-710" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-711"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-712" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-713" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-714">i</span><span class="MJXp-mo" id="MJXp-Span-715">+</span><span class="MJXp-mn" id="MJXp-Span-716">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-717" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-718"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-719" style="margin-right: 0.05em;">b</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-720" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-721">i</span><span class="MJXp-mo" id="MJXp-Span-722">+</span><span class="MJXp-mn" id="MJXp-Span-723">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-724" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-104">(a_{i+1}, b_{i+1})</script> we place after <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-725"><span class="MJXp-msubsup" id="MJXp-Span-726"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-727" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-728" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-105">b_i</script>, it will definitely be smaller. </li></ul><p>Thus, if at least one good subset exists, we can always ensure that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-729"><span class="MJXp-msubsup" id="MJXp-Span-730"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-731" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-732" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-733" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-msubsup" id="MJXp-Span-734"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-735" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-736" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-106">a_i \le b_i</script>. Let's initially swap the elements in those pairs where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-737"><span class="MJXp-msubsup" id="MJXp-Span-738"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-739" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-740" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-741" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-msubsup" id="MJXp-Span-742"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-743" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-744" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-107">a_i > b_i</script>; the answer will not change (since the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-745"><span class="MJXp-msubsup" id="MJXp-Span-746"><span class="MJXp-mn" id="MJXp-Span-747" style="margin-right: 0.05em;">2</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-748" style="vertical-align: 0.5em;">n</span></span></span></span><script type="math/tex" id="MathJax-Element-108">2^n</script> subsets of indices we are considering will yield the same results after such a transformation, just in a different order).</p><p>Now let's understand which pairs of elements we can swap while keeping the arrays sorted. For each pair of adjacent indices <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-749"><span class="MJXp-mo" id="MJXp-Span-750" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-751">i</span><span class="MJXp-mo" id="MJXp-Span-752" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-753">i</span><span class="MJXp-mo" id="MJXp-Span-754" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-755">1</span><span class="MJXp-mo" id="MJXp-Span-756" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-109">(i, i+1)</script>, there are two possible situations:</p><ul> <li> either <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-757"><span class="MJXp-msubsup" id="MJXp-Span-758"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-759" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-760" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-761" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-msubsup" id="MJXp-Span-762"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-763" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-764" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-765">i</span><span class="MJXp-mo" id="MJXp-Span-766">+</span><span class="MJXp-mn" id="MJXp-Span-767">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-110">b_i \le a_{i+1}</script>, in which case any element at position <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-768"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-769">i</span></span></span><script type="math/tex" id="MathJax-Element-111">i</script> will be less than or equal to any element at position <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-770"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-771">i</span><span class="MJXp-mo" id="MJXp-Span-772" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-773">1</span></span></span><script type="math/tex" id="MathJax-Element-112">i+1</script> (let's call this a type <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-774"><span class="MJXp-mn" id="MJXp-Span-775">1</span></span></span><script type="math/tex" id="MathJax-Element-113">1</script> index pair); </li><li> or <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-776"><span class="MJXp-msubsup" id="MJXp-Span-777"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-778" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-779" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-780" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-msubsup" id="MJXp-Span-781"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-782" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-783" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-784">i</span><span class="MJXp-mo" id="MJXp-Span-785">+</span><span class="MJXp-mn" id="MJXp-Span-786">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-114">b_i > a_{i+1}</script>, in which case we must place <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-787"><span class="MJXp-msubsup" id="MJXp-Span-788"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-789" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-790" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-791">i</span><span class="MJXp-mo" id="MJXp-Span-792">+</span><span class="MJXp-mn" id="MJXp-Span-793">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-115">a_{i+1}</script> after <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-794"><span class="MJXp-msubsup" id="MJXp-Span-795"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-796" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-797" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-116">a_i</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-798"><span class="MJXp-msubsup" id="MJXp-Span-799"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-800" style="margin-right: 0.05em;">b</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-801" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-802">i</span><span class="MJXp-mo" id="MJXp-Span-803">+</span><span class="MJXp-mn" id="MJXp-Span-804">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-117">b_{i+1}</script> after <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-805"><span class="MJXp-msubsup" id="MJXp-Span-806"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-807" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-808" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-118">b_i</script>. This means we should swap <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-809"><span class="MJXp-msubsup" id="MJXp-Span-810"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-811" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-812" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-119">a_i</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-813"><span class="MJXp-msubsup" id="MJXp-Span-814"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-815" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-816" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-120">b_i</script> if and only if we swap <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-817"><span class="MJXp-msubsup" id="MJXp-Span-818"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-819" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-820" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-821">i</span><span class="MJXp-mo" id="MJXp-Span-822">+</span><span class="MJXp-mn" id="MJXp-Span-823">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-121">a_{i+1}</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-824"><span class="MJXp-msubsup" id="MJXp-Span-825"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-826" style="margin-right: 0.05em;">b</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-827" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-828">i</span><span class="MJXp-mo" id="MJXp-Span-829">+</span><span class="MJXp-mn" id="MJXp-Span-830">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-122">b_{i+1}</script> (let's call this a type <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-831"><span class="MJXp-mn" id="MJXp-Span-832">2</span></span></span><script type="math/tex" id="MathJax-Element-123">2</script> index pair). </li></ul><p>Let's consider the "segments" of indices <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-833"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-834">i</span></span></span><script type="math/tex" id="MathJax-Element-124">i</script> where every two adjacent indices form a type <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-835"><span class="MJXp-mn" id="MJXp-Span-836">2</span></span></span><script type="math/tex" id="MathJax-Element-125">2</script> pair. Then if we choose what to do with any one index in this pair, it will automatically force us to choose an action for all other indices in this segment. However, different segments do not affect each other, as the indices at the boundary of two segments form a type <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-837"><span class="MJXp-mn" id="MJXp-Span-838">1</span></span></span><script type="math/tex" id="MathJax-Element-126">1</script> pair.</p><p>Thus, the answer is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-839"><span class="MJXp-msubsup" id="MJXp-Span-840"><span class="MJXp-mn" id="MJXp-Span-841" style="margin-right: 0.05em;">2</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-842" style="vertical-align: 0.5em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-843">m</span></span></span></span></span><script type="math/tex" id="MathJax-Element-127">2^{m}</script>, where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-844"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-845">m</span></span></span><script type="math/tex" id="MathJax-Element-128">m</script> is the number of segments of type <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-846"><span class="MJXp-mn" id="MJXp-Span-847">2</span></span></span><script type="math/tex" id="MathJax-Element-129">2</script> pairs. Each type <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-848"><span class="MJXp-mn" id="MJXp-Span-849">2</span></span></span><script type="math/tex" id="MathJax-Element-130">2</script> pair "merges" two such segments, so we can calculate the answer as <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-850"><span class="MJXp-msubsup" id="MJXp-Span-851"><span class="MJXp-mn" id="MJXp-Span-852" style="margin-right: 0.05em;">2</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-853" style="vertical-align: 0.5em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-854">n</span><span class="MJXp-mo" id="MJXp-Span-855">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-856">k</span></span></span></span></span><script type="math/tex" id="MathJax-Element-131">2^{n-k}</script>, where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-857"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-858">k</span></span></span><script type="math/tex" id="MathJax-Element-132">k</script> is the number of such <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-859"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-860">i</span></span></span><script type="math/tex" id="MathJax-Element-133">i</script> such that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-861"><span class="MJXp-msubsup" id="MJXp-Span-862"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-863" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-864" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-865" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-msubsup" id="MJXp-Span-866"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-867" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-868" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-869">i</span><span class="MJXp-mo" id="MJXp-Span-870">+</span><span class="MJXp-mn" id="MJXp-Span-871">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-134">b_i > a_{i+1}</script> (after we have swapped <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-872"><span class="MJXp-msubsup" id="MJXp-Span-873"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-874" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-875" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-135">a_i</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-876"><span class="MJXp-msubsup" id="MJXp-Span-877"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-878" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-879" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-136">b_i</script> in pairs where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-880"><span class="MJXp-msubsup" id="MJXp-Span-881"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-882" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-883" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-884" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-msubsup" id="MJXp-Span-885"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-886" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-887" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-137">a_i > b_i</script>).</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Solution (Neon)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
 
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> MOD </span><span class="pun">=</span><span class="pln"> </span><span class="lit">998244353</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
  cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">t</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
    vector</span><span class="str">&lt;int&gt;</span><span class="pln"> a</span><span class="pun">(</span><span class="pln">n</span><span class="pun">),</span><span class="pln"> b</span><span class="pun">(</span><span class="pln">n</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">auto</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">x </span><span class="pun">:</span><span class="pln"> a</span><span class="pun">)</span><span class="pln"> cin </span><span class="pun">&gt;&gt;</span><span class="pln"> x</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">auto</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">x </span><span class="pun">:</span><span class="pln"> b</span><span class="pun">)</span><span class="pln"> cin </span><span class="pun">&gt;&gt;</span><span class="pln"> x</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> ans </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln"> swap</span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">],</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]);</span><span class="pln">
      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">i </span><span class="pun">||</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&gt;=</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">])</span><span class="pln"> ans </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">ans </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2LL</span><span class="pun">)</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> MOD</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    cout </span><span class="pun">&lt;&lt;</span><span class="pln"> ans </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2144/problem/D" title="Educational Codeforces Round 182 (Rated for Div. 2)">2144D - Price Tags</a></p><p>Idea: <a class="rated-user user-red" href="https://codeforces.com/profile/BledDest" title="International Grandmaster BledDest">BledDest</a></p> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2144/problem/D" title="Educational Codeforces Round 182 (Rated for Div. 2)">2144D - Price Tags</a></h3><div class="ttypography"><div class="problem-statement"><div><p>Let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-892"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-893">A</span><span class="MJXp-mo" id="MJXp-Span-894" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-895" style="margin-left: 0.333em; margin-right: 0.333em;">max</span><span class="MJXp-mrow" id="MJXp-Span-896"><span class="MJXp-msubsup" id="MJXp-Span-897"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-898" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-899" style="vertical-align: -0.4em;">i</span></span></span></span></span><script type="math/tex" id="MathJax-Element-138">A = \max{a_i}</script>. Firstly, if <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-900"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-901">x</span><span class="MJXp-mo" id="MJXp-Span-902" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-903">A</span></span></span><script type="math/tex" id="MathJax-Element-139">x > A</script> then the answer for <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-904"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-905">x</span></span></span><script type="math/tex" id="MathJax-Element-140">x</script> will be the same as for <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-906"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-907">x</span><span class="MJXp-mo" id="MJXp-Span-908" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-909">1</span></span></span><script type="math/tex" id="MathJax-Element-141">x - 1</script>, since for each <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-910"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-911">i</span></span></span><script type="math/tex" id="MathJax-Element-142">i</script> value <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-912"><span class="MJXp-mrow" id="MJXp-Span-913"><span class="MJXp-mo" id="MJXp-Span-914" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.689em;"><span class="MJXp-right MJXp-scale4" style="font-size: 3.756em; margin-left: -0.23em;">⌈</span></span><span class="MJXp-mfrac" id="MJXp-Span-915" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-msubsup" id="MJXp-Span-916"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-917" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-918" style="vertical-align: -0.4em;">i</span></span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-919">x</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-920" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.689em;"><span class="MJXp-right MJXp-scale4" style="font-size: 3.756em; margin-left: -0.23em;">⌉</span></span></span><span class="MJXp-mo" id="MJXp-Span-921" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mrow" id="MJXp-Span-922"><span class="MJXp-mo" id="MJXp-Span-923" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.689em;"><span class="MJXp-right MJXp-scale4" style="font-size: 3.756em; margin-left: -0.23em;">⌈</span></span><span class="MJXp-mfrac" id="MJXp-Span-924" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-msubsup" id="MJXp-Span-925"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-926" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-927" style="vertical-align: -0.4em;">i</span></span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-928">x</span><span class="MJXp-mo" id="MJXp-Span-929">−</span><span class="MJXp-mn" id="MJXp-Span-930">1</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-931" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.689em;"><span class="MJXp-right MJXp-scale4" style="font-size: 3.756em; margin-left: -0.23em;">⌉</span></span></span><span class="MJXp-mo" id="MJXp-Span-932" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-933">1</span></span></span><script type="math/tex" id="MathJax-Element-143">\left\lceil \frac{a_i}{x} \right\rceil = \left\lceil \frac{a_i}{x - 1} \right\rceil = 1</script>. In other words, there is no need to check <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-934"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-935">x</span></span></span><script type="math/tex" id="MathJax-Element-144">x</script>-s bigger than <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-936"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-937">A</span></span></span><script type="math/tex" id="MathJax-Element-145">A</script> (the corner case is when <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-938"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-939">A</span><span class="MJXp-mo" id="MJXp-Span-940" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-941">1</span></span></span><script type="math/tex" id="MathJax-Element-146">A = 1</script>).</p><p>Suppose we fixed some value <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-942"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-943">x</span></span></span><script type="math/tex" id="MathJax-Element-147">x</script>. Each <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-944"><span class="MJXp-mrow" id="MJXp-Span-945"><span class="MJXp-mo" id="MJXp-Span-946" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.689em;"><span class="MJXp-right MJXp-scale4" style="font-size: 3.756em; margin-left: -0.23em;">⌈</span></span><span class="MJXp-mfrac" id="MJXp-Span-947" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-msubsup" id="MJXp-Span-948"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-949" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-950" style="vertical-align: -0.4em;">i</span></span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-951">x</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-952" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.689em;"><span class="MJXp-right MJXp-scale4" style="font-size: 3.756em; margin-left: -0.23em;">⌉</span></span></span><span class="MJXp-mo" id="MJXp-Span-953" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mrow" id="MJXp-Span-954"><span class="MJXp-mo" id="MJXp-Span-955" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.5em;"><span class="MJXp-right MJXp-scale5" style="font-size: 3em; margin-left: -0.18em;">⌈</span></span><span class="MJXp-mfrac" id="MJXp-Span-956" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-957">A</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-958">x</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-959" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.5em;"><span class="MJXp-right MJXp-scale5" style="font-size: 3em; margin-left: -0.18em;">⌉</span></span></span></span></span><script type="math/tex" id="MathJax-Element-148">\left\lceil \frac{a_i}{x} \right\rceil \le \left\lceil \frac{A}{x} \right\rceil</script>, so all resulting prices are bounded by <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-960"><span class="MJXp-mrow" id="MJXp-Span-961"><span class="MJXp-mo" id="MJXp-Span-962" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.5em;"><span class="MJXp-right MJXp-scale5" style="font-size: 3em; margin-left: -0.18em;">⌈</span></span><span class="MJXp-mfrac" id="MJXp-Span-963" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-964">A</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-965">x</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-966" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.5em;"><span class="MJXp-right MJXp-scale5" style="font-size: 3em; margin-left: -0.18em;">⌉</span></span></span></span></span><script type="math/tex" id="MathJax-Element-149">\left\lceil \frac{A}{x} \right\rceil</script>. So, if we somehow calculate the answer for <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-967"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-968">x</span></span></span><script type="math/tex" id="MathJax-Element-150">x</script> in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-969"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-970">O</span><span class="MJXp-mrow" id="MJXp-Span-971"><span class="MJXp-mo" id="MJXp-Span-972" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.5em;"><span class="MJXp-right MJXp-scale5" style="font-size: 3em; margin-left: -0.13em;">(</span></span><span class="MJXp-mfrac" id="MJXp-Span-973" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-974">A</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-975">x</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-976" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.5em;"><span class="MJXp-right MJXp-scale5" style="font-size: 3em; margin-left: -0.13em;">)</span></span></span></span></span><script type="math/tex" id="MathJax-Element-151">O\left(\frac{A}{x}\right)</script> time, we can achieve a pretty fast solution in total, since <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-977"><span class="MJXp-munderover" id="MJXp-Span-978"><span><span class="MJXp-over"><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-984" style="margin-right: 0px; margin-left: 0px;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-985">A</span></span></span><span class=""><span class="MJXp-mo" id="MJXp-Span-979" style="margin-left: 0.111em; margin-right: 0.167em;">∑</span></span></span></span><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-980" style="margin-left: 0px;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-981">x</span><span class="MJXp-mo" id="MJXp-Span-982">=</span><span class="MJXp-mn" id="MJXp-Span-983">1</span></span></span></span><span class="MJXp-mrow" id="MJXp-Span-986"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-987">O</span><span class="MJXp-mrow" id="MJXp-Span-988"><span class="MJXp-mo" id="MJXp-Span-989" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.5em;"><span class="MJXp-right MJXp-scale5" style="font-size: 3em; margin-left: -0.13em;">(</span></span><span class="MJXp-mfrac" id="MJXp-Span-990" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-991">A</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-992">x</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-993" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.5em;"><span class="MJXp-right MJXp-scale5" style="font-size: 3em; margin-left: -0.13em;">)</span></span></span></span><span class="MJXp-mo" id="MJXp-Span-994" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-995">O</span><span class="MJXp-mo" id="MJXp-Span-996" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-997">A</span><span class="MJXp-mi" id="MJXp-Span-998">log</span><span class="MJXp-mo" id="MJXp-Span-999" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mrow" id="MJXp-Span-1000"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1001">A</span></span><span class="MJXp-mo" id="MJXp-Span-1002" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-152">\sum\limits_{x=1}^{A}{O\left(\frac{A}{x}\right)} = O(A \log{A})</script>.</p><p>So, how to calculate the answer for a fixed <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1003"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1004">x</span></span></span><script type="math/tex" id="MathJax-Element-153">x</script>? For the start, let's precalculate some statistics: let's calculate the array <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1005"><span class="MJXp-mrow" id="MJXp-Span-1006"><span class="MJXp-mi" id="MJXp-Span-1007">c</span><span class="MJXp-mi" id="MJXp-Span-1008">n</span><span class="MJXp-mi" id="MJXp-Span-1009">t</span></span></span></span><script type="math/tex" id="MathJax-Element-154">\mathrm{cnt}</script> where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1010"><span class="MJXp-mrow" id="MJXp-Span-1011"><span class="MJXp-mi" id="MJXp-Span-1012">c</span><span class="MJXp-mi" id="MJXp-Span-1013">n</span><span class="MJXp-mi" id="MJXp-Span-1014">t</span></span><span class="MJXp-mo" id="MJXp-Span-1015" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1016">p</span><span class="MJXp-mo" id="MJXp-Span-1017" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-155">\mathrm{cnt}[p]</script> is the number of initial price tags equal to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1018"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1019">p</span></span></span><script type="math/tex" id="MathJax-Element-156">p</script>. This array can be calculated once, since it doesn't change for different <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1020"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1021">x</span></span></span><script type="math/tex" id="MathJax-Element-157">x</script>.</p><p>Next, let's iterate over all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1022"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1023">p</span></span></span><script type="math/tex" id="MathJax-Element-158">p</script> from <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1024"><span class="MJXp-mn" id="MJXp-Span-1025">1</span></span></span><script type="math/tex" id="MathJax-Element-159">1</script> to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1026"><span class="MJXp-mrow" id="MJXp-Span-1027"><span class="MJXp-mo" id="MJXp-Span-1028" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.5em;"><span class="MJXp-right MJXp-scale5" style="font-size: 3em; margin-left: -0.18em;">⌈</span></span><span class="MJXp-mfrac" id="MJXp-Span-1029" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1030">A</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1031">x</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-1032" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.5em;"><span class="MJXp-right MJXp-scale5" style="font-size: 3em; margin-left: -0.18em;">⌉</span></span></span></span></span><script type="math/tex" id="MathJax-Element-160">\left\lceil \frac{A}{x} \right\rceil</script>. What initial prices will result in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1033"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1034">p</span></span></span><script type="math/tex" id="MathJax-Element-161">p</script>? It's prices in the segment <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1035"><span class="MJXp-mo" id="MJXp-Span-1036" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mo" id="MJXp-Span-1037" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1038">p</span><span class="MJXp-mo" id="MJXp-Span-1039" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-1040">1</span><span class="MJXp-mo" id="MJXp-Span-1041" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1042" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1043">x</span><span class="MJXp-mo" id="MJXp-Span-1044" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-1045">1</span><span class="MJXp-mo" id="MJXp-Span-1046" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1047">p</span><span class="MJXp-mo" id="MJXp-Span-1048" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1049">x</span><span class="MJXp-mo" id="MJXp-Span-1050" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-162">[(p - 1) \cdot x + 1, p \cdot x]</script> and we can calculate their number (let's name it as <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1051"><span class="MJXp-mrow" id="MJXp-Span-1052"><span class="MJXp-mi" id="MJXp-Span-1053">n</span><span class="MJXp-mi" id="MJXp-Span-1054">e</span><span class="MJXp-mi" id="MJXp-Span-1055">e</span><span class="MJXp-mi" id="MJXp-Span-1056">d</span></span></span></span><script type="math/tex" id="MathJax-Element-163">\mathrm{need}</script>) asking a sum on a segment in the array <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1057"><span class="MJXp-mrow" id="MJXp-Span-1058"><span class="MJXp-mi" id="MJXp-Span-1059">c</span><span class="MJXp-mi" id="MJXp-Span-1060">n</span><span class="MJXp-mi" id="MJXp-Span-1061">t</span></span></span></span><script type="math/tex" id="MathJax-Element-164">\mathrm{cnt}</script> that can be done in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1062"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1063">O</span><span class="MJXp-mo" id="MJXp-Span-1064" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-1065">1</span><span class="MJXp-mo" id="MJXp-Span-1066" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-165">O(1)</script> using prefix sums.</p><p>Since there are exactly <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1067"><span class="MJXp-mrow" id="MJXp-Span-1068"><span class="MJXp-mi" id="MJXp-Span-1069">c</span><span class="MJXp-mi" id="MJXp-Span-1070">n</span><span class="MJXp-mi" id="MJXp-Span-1071">t</span></span><span class="MJXp-mo" id="MJXp-Span-1072" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1073">p</span><span class="MJXp-mo" id="MJXp-Span-1074" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-166">\mathrm{cnt}[p]</script> existing price tags, we'll need <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1075"><span class="MJXp-mo" id="MJXp-Span-1076" style="margin-left: 0.333em; margin-right: 0.333em;">max</span><span class="MJXp-mo" id="MJXp-Span-1077" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-1078">0</span><span class="MJXp-mo" id="MJXp-Span-1079" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mrow" id="MJXp-Span-1080"><span class="MJXp-mi" id="MJXp-Span-1081">n</span><span class="MJXp-mi" id="MJXp-Span-1082">e</span><span class="MJXp-mi" id="MJXp-Span-1083">e</span><span class="MJXp-mi" id="MJXp-Span-1084">d</span></span><span class="MJXp-mo" id="MJXp-Span-1085" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mrow" id="MJXp-Span-1086"><span class="MJXp-mi" id="MJXp-Span-1087">c</span><span class="MJXp-mi" id="MJXp-Span-1088">n</span><span class="MJXp-mi" id="MJXp-Span-1089">t</span></span><span class="MJXp-mo" id="MJXp-Span-1090" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1091">p</span><span class="MJXp-mo" id="MJXp-Span-1092" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1093" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-167">\max(0, \mathrm{need} - \mathrm{cnt}[p])</script> extra tags to print. In total, the resulting price <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1094"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1095">p</span></span></span><script type="math/tex" id="MathJax-Element-168">p</script> will contribute to the total income exactly <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1096"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1097">p</span><span class="MJXp-mo" id="MJXp-Span-1098" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mrow" id="MJXp-Span-1099"><span class="MJXp-mi" id="MJXp-Span-1100">n</span><span class="MJXp-mi" id="MJXp-Span-1101">e</span><span class="MJXp-mi" id="MJXp-Span-1102">e</span><span class="MJXp-mi" id="MJXp-Span-1103">d</span></span><span class="MJXp-mo" id="MJXp-Span-1104" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1105">y</span><span class="MJXp-mo" id="MJXp-Span-1106" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mo" id="MJXp-Span-1107" style="margin-left: 0.333em; margin-right: 0.333em;">max</span><span class="MJXp-mo" id="MJXp-Span-1108" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-1109">0</span><span class="MJXp-mo" id="MJXp-Span-1110" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mrow" id="MJXp-Span-1111"><span class="MJXp-mi" id="MJXp-Span-1112">n</span><span class="MJXp-mi" id="MJXp-Span-1113">e</span><span class="MJXp-mi" id="MJXp-Span-1114">e</span><span class="MJXp-mi" id="MJXp-Span-1115">d</span></span><span class="MJXp-mo" id="MJXp-Span-1116" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mrow" id="MJXp-Span-1117"><span class="MJXp-mi" id="MJXp-Span-1118">c</span><span class="MJXp-mi" id="MJXp-Span-1119">n</span><span class="MJXp-mi" id="MJXp-Span-1120">t</span></span><span class="MJXp-mo" id="MJXp-Span-1121" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1122">p</span><span class="MJXp-mo" id="MJXp-Span-1123" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1124" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-169">p \cdot \mathrm{need} - y \cdot \max(0, \mathrm{need} - \mathrm{cnt}[p])</script> coins.</p><p>As a result, we can calculate an income for each <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1125"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1126">x</span></span></span><script type="math/tex" id="MathJax-Element-170">x</script> in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1127"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1128">O</span><span class="MJXp-mrow" id="MJXp-Span-1129"><span class="MJXp-mo" id="MJXp-Span-1130" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.5em;"><span class="MJXp-right MJXp-scale5" style="font-size: 3em; margin-left: -0.13em;">(</span></span><span class="MJXp-mfrac" id="MJXp-Span-1131" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1132">A</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1133">x</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-1134" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.5em;"><span class="MJXp-right MJXp-scale5" style="font-size: 3em; margin-left: -0.13em;">)</span></span></span></span></span><script type="math/tex" id="MathJax-Element-171">O\left(\frac{A}{x}\right)</script> time that gives us the total complexity <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1135"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1136">O</span><span class="MJXp-mo" id="MJXp-Span-1137" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1138">n</span><span class="MJXp-mo" id="MJXp-Span-1139" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1140">A</span><span class="MJXp-mi" id="MJXp-Span-1141">log</span><span class="MJXp-mo" id="MJXp-Span-1142" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mrow" id="MJXp-Span-1143"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1144">A</span></span><span class="MJXp-mo" id="MJXp-Span-1145" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-172">O(n + A \log{A})</script> per test.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Solution (adedalic)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="kwd">for</span><span class="pln"> _t </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="kwd">int</span><span class="pun">(</span><span class="pln">input</span><span class="pun">())):</span><span class="pln">
    n</span><span class="pun">,</span><span class="pln"> y </span><span class="pun">=</span><span class="pln"> map</span><span class="pun">(</span><span class="kwd">int</span><span class="pun">,</span><span class="pln"> input</span><span class="pun">().</span><span class="pln">split</span><span class="pun">())</span><span class="pln">
    a </span><span class="pun">=</span><span class="pln"> list</span><span class="pun">(</span><span class="pln">map</span><span class="pun">(</span><span class="kwd">int</span><span class="pun">,</span><span class="pln"> input</span><span class="pun">().</span><span class="pln">split</span><span class="pun">()))</span><span class="pln">
    A </span><span class="pun">=</span><span class="pln"> max</span><span class="pun">(</span><span class="pln">a</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
    cntTags </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> A
    </span><span class="kwd">for</span><span class="pln"> v </span><span class="kwd">in</span><span class="pln"> a</span><span class="pun">:</span><span class="pln">
        cntTags</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
    pSum </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> A
    </span><span class="kwd">for</span><span class="pln"> i </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> A</span><span class="pun">):</span><span class="pln">
        pSum</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> pSum</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> cntTags</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln">
    
    ans </span><span class="pun">=</span><span class="pln"> </span><span class="pun">-(</span><span class="lit">10</span><span class="pun">**</span><span class="lit">18</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> A </span><span class="pun">==</span><span class="pln"> </span><span class="lit">2</span><span class="pun">:</span><span class="pln">
        </span><span class="kwd">print</span><span class="pun">(</span><span class="pln">n</span><span class="pun">)</span><span class="pln">
        </span><span class="kwd">continue</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> x </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> A</span><span class="pun">):</span><span class="pln">
        res </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> price </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> A</span><span class="pun">):</span><span class="pln">
            l </span><span class="pun">=</span><span class="pln"> x </span><span class="pun">*</span><span class="pln"> </span><span class="pun">(</span><span class="pln">price </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">
            r </span><span class="pun">=</span><span class="pln"> min</span><span class="pun">(</span><span class="pln">A </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> x </span><span class="pun">*</span><span class="pln"> price</span><span class="pun">)</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> l </span><span class="pun">&gt;=</span><span class="pln"> A</span><span class="pun">:</span><span class="pln">
                </span><span class="kwd">break</span><span class="pln">
            cnt </span><span class="pun">=</span><span class="pln"> pSum</span><span class="pun">[</span><span class="pln">r</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> pSum</span><span class="pun">[</span><span class="pln">l</span><span class="pun">]</span><span class="pln">
            res </span><span class="pun">+=</span><span class="pln"> cnt </span><span class="pun">*</span><span class="pln"> price
            res </span><span class="pun">-=</span><span class="pln"> y </span><span class="pun">*</span><span class="pln"> max</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> cnt </span><span class="pun">-</span><span class="pln"> cntTags</span><span class="pun">[</span><span class="pln">price</span><span class="pun">])</span><span class="pln">
        ans </span><span class="pun">=</span><span class="pln"> max</span><span class="pun">(</span><span class="pln">ans</span><span class="pun">,</span><span class="pln"> res</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">print</span><span class="pun">(</span><span class="pln">ans</span><span class="pun">)</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2144/problem/E1" title="Educational Codeforces Round 182 (Rated for Div. 2)">2144E1 - Looking at Towers (easy version)</a></p><p>Idea: <a class="rated-user user-orange" href="https://codeforces.com/profile/Roms" title="Master Roms">Roms</a></p> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2144/problem/E1" title="Educational Codeforces Round 182 (Rated for Div. 2)">2144E1 - Looking at Towers (easy version)</a></h3><div class="ttypography"><div class="problem-statement"><div><p>To begin with, let's calculaye <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1146"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1147">L</span><span class="MJXp-mo" id="MJXp-Span-1148" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1149">a</span><span class="MJXp-mo" id="MJXp-Span-1150" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-173">L(a)</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1151"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1152">R</span><span class="MJXp-mo" id="MJXp-Span-1153" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1154">a</span><span class="MJXp-mo" id="MJXp-Span-1155" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-174">R(a)</script>; to do this, we can simply find all elements that are greater than all previous or next elements.</p><p>Now, let's look at the criteria that the subsequence must satisfy for the left view to equal <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1156"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1157">L</span><span class="MJXp-mo" id="MJXp-Span-1158" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1159">a</span><span class="MJXp-mo" id="MJXp-Span-1160" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-175">L(a)</script> and the right view to equal <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1161"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1162">R</span><span class="MJXp-mo" id="MJXp-Span-1163" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1164">a</span><span class="MJXp-mo" id="MJXp-Span-1165" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-176">R(a)</script>. The maximum in this subsequence must be equal to the maximum in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1166"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1167">a</span></span></span><script type="math/tex" id="MathJax-Element-177">a</script>, since the tower of maximum height will always be visible from both the left and the right. Let this maximum be <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1168"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1169">m</span></span></span><script type="math/tex" id="MathJax-Element-178">m</script>.</p><p>Let's fix the first and last occurrences of the maximum in the subsequence. Let these be the positions <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1170"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1171">i</span></span></span><script type="math/tex" id="MathJax-Element-179">i</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1172"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1173">j</span></span></span><script type="math/tex" id="MathJax-Element-180">j</script> in the original sequence (<span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1174"><span class="MJXp-msubsup" id="MJXp-Span-1175"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1176" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1177" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1178" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-1179"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1180" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1181" style="vertical-align: -0.4em;">j</span></span><span class="MJXp-mo" id="MJXp-Span-1182" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1183">m</span></span></span><script type="math/tex" id="MathJax-Element-181">a_i = a_j = m</script>; <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1184"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1185">i</span><span class="MJXp-mo" id="MJXp-Span-1186" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1187">j</span></span></span><script type="math/tex" id="MathJax-Element-182">i \le j</script>). Then, for this pair <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1188"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1189">i</span><span class="MJXp-mo" id="MJXp-Span-1190" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1191">j</span></span></span><script type="math/tex" id="MathJax-Element-183">i, j</script>, we need to add the product of these three numbers to the answer:</p><ul> <li> the number of subsequences that have the left view equal to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1192"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1193">L</span><span class="MJXp-mo" id="MJXp-Span-1194" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1195">a</span><span class="MJXp-mo" id="MJXp-Span-1196" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-184">L(a)</script>, end at position <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1197"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1198">i</span></span></span><script type="math/tex" id="MathJax-Element-185">i</script>, and do not have occurrences of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1199"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1200">m</span></span></span><script type="math/tex" id="MathJax-Element-186">m</script> before position <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1201"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1202">i</span></span></span><script type="math/tex" id="MathJax-Element-187">i</script> (if the first occurrence of the maximum is before <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1203"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1204">i</span></span></span><script type="math/tex" id="MathJax-Element-188">i</script>, we will count it when considering another position of the first occurrence). We will call this <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1205"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1206">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1207">p</span><span class="MJXp-msubsup" id="MJXp-Span-1208"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1209" style="margin-right: 0.05em;">L</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1210" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-189">dpL_i</script>; </li><li> the number of subsequences that have the right view equal <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1211"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1212">R</span><span class="MJXp-mo" id="MJXp-Span-1213" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1214">a</span><span class="MJXp-mo" id="MJXp-Span-1215" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-190">R(a)</script>, start at position <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1216"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1217">j</span></span></span><script type="math/tex" id="MathJax-Element-191">j</script>, and do not have occurrences of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1218"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1219">m</span></span></span><script type="math/tex" id="MathJax-Element-192">m</script> after position <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1220"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1221">j</span></span></span><script type="math/tex" id="MathJax-Element-193">j</script> (if the last occurrence of the maximum is after <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1222"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1223">j</span></span></span><script type="math/tex" id="MathJax-Element-194">j</script>, we will count it when considering another position of the last occurrence). We will call this <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1224"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1225">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1226">p</span><span class="MJXp-msubsup" id="MJXp-Span-1227"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1228" style="margin-right: 0.05em;">R</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1229" style="vertical-align: -0.4em;">j</span></span></span></span><script type="math/tex" id="MathJax-Element-195">dpR_j</script>; </li><li> the number of ways to choose elements between <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1230"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1231">i</span></span></span><script type="math/tex" id="MathJax-Element-196">i</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1232"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1233">j</span></span></span><script type="math/tex" id="MathJax-Element-197">j</script>. For each of them, it does not matter whether we include it in the subsequence or not, because it will be between two maxima, and thus will not affect the left/right view. Therefore, this number is equal to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1234"><span class="MJXp-msubsup" id="MJXp-Span-1235"><span class="MJXp-mn" id="MJXp-Span-1236" style="margin-right: 0.05em;">2</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1237" style="vertical-align: 0.5em;">x</span></span></span></span><script type="math/tex" id="MathJax-Element-198">2^x</script>, where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1238"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1239">x</span></span></span><script type="math/tex" id="MathJax-Element-199">x</script> is the number of elements between <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1240"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1241">i</span></span></span><script type="math/tex" id="MathJax-Element-200">i</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1242"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1243">j</span></span></span><script type="math/tex" id="MathJax-Element-201">j</script> (excluding the boundaries). </li></ul><p>Let's learn to calculate the array <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1244"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1245">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1246">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1247">L</span></span></span><script type="math/tex" id="MathJax-Element-202">dpL</script> (the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1248"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1249">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1250">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1251">R</span></span></span><script type="math/tex" id="MathJax-Element-203">dpR</script> can be calculated similarly by reversing the given sequence <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1252"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1253">a</span></span></span><script type="math/tex" id="MathJax-Element-204">a</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1254"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1255">R</span><span class="MJXp-mo" id="MJXp-Span-1256" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1257">a</span><span class="MJXp-mo" id="MJXp-Span-1258" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-205">R(a)</script>, and then reversing the result after counting). Let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1259"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1260">k</span></span></span><script type="math/tex" id="MathJax-Element-206">k</script> be the size of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1261"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1262">L</span><span class="MJXp-mo" id="MJXp-Span-1263" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1264">a</span><span class="MJXp-mo" id="MJXp-Span-1265" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-207">L(a)</script>. We will traverse the sequence <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1266"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1267">a</span></span></span><script type="math/tex" id="MathJax-Element-208">a</script> from left to right and maintain an array <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1268"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1269">c</span></span></span><script type="math/tex" id="MathJax-Element-209">c</script> of size <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1270"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1271">k</span></span></span><script type="math/tex" id="MathJax-Element-210">k</script>, where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1272"><span class="MJXp-msubsup" id="MJXp-Span-1273"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1274" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1275" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-211">c_i</script> is equal to the number of subsequences whose left view matches the first <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1276"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1277">i</span></span></span><script type="math/tex" id="MathJax-Element-212">i</script> elements of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1278"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1279">L</span><span class="MJXp-mo" id="MJXp-Span-1280" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1281">a</span><span class="MJXp-mo" id="MJXp-Span-1282" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-213">L(a)</script> (obviously, we are not interested in subsequences whose left view is not a prefix of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1283"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1284">L</span><span class="MJXp-mo" id="MJXp-Span-1285" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1286">a</span><span class="MJXp-mo" id="MJXp-Span-1287" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-214">L(a)</script>). Initially, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1288"><span class="MJXp-msubsup" id="MJXp-Span-1289"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1290" style="margin-right: 0.05em;">c</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1291" style="vertical-align: -0.4em;">0</span></span><span class="MJXp-mo" id="MJXp-Span-1292" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-1293">1</span></span></span><script type="math/tex" id="MathJax-Element-215">c_0 = 1</script>, and all other elements are equal to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1294"><span class="MJXp-mn" id="MJXp-Span-1295">0</span></span></span><script type="math/tex" id="MathJax-Element-216">0</script>.</p><p>Let's see how this array <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1296"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1297">c</span></span></span><script type="math/tex" id="MathJax-Element-217">c</script> changes when processing the element <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1298"><span class="MJXp-msubsup" id="MJXp-Span-1299"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1300" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1301" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-218">a_i</script>. To do this, we need to understand what happens if we append the element <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1302"><span class="MJXp-msubsup" id="MJXp-Span-1303"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1304" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1305" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-219">a_i</script> to the sequence whose left view matches the first <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1306"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1307">j</span></span></span><script type="math/tex" id="MathJax-Element-220">j</script> elements of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1308"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1309">L</span><span class="MJXp-mo" id="MJXp-Span-1310" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1311">a</span><span class="MJXp-mo" id="MJXp-Span-1312" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-221">L(a)</script>. There are three cases:</p><ul> <li> if <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1313"><span class="MJXp-msubsup" id="MJXp-Span-1314"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1315" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1316" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-222">a_i</script> is equal to the next element that should be in the left view (i.e., the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1317"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1318">j</span></span></span><script type="math/tex" id="MathJax-Element-223">j</script>-th element of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1319"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1320">L</span><span class="MJXp-mo" id="MJXp-Span-1321" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1322">a</span><span class="MJXp-mo" id="MJXp-Span-1323" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-224">L(a)</script> in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1324"><span class="MJXp-mn" id="MJXp-Span-1325">0</span></span></span><script type="math/tex" id="MathJax-Element-225">0</script>-indexing), then we can obtain a subsequence whose prefix matches the prefix that is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1326"><span class="MJXp-mn" id="MJXp-Span-1327">1</span></span></span><script type="math/tex" id="MathJax-Element-226">1</script> longer. Accordingly, we should add <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1328"><span class="MJXp-msubsup" id="MJXp-Span-1329"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1330" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1331" style="vertical-align: -0.4em;">j</span></span></span></span><script type="math/tex" id="MathJax-Element-227">c_j</script> to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1332"><span class="MJXp-msubsup" id="MJXp-Span-1333"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1334" style="margin-right: 0.05em;">c</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1335" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1336">j</span><span class="MJXp-mo" id="MJXp-Span-1337">+</span><span class="MJXp-mn" id="MJXp-Span-1338">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-228">c_{j+1}</script>; </li><li> if <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1339"><span class="MJXp-msubsup" id="MJXp-Span-1340"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1341" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1342" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-229">a_i</script> is greater than the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1343"><span class="MJXp-mo" id="MJXp-Span-1344" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1345">j</span><span class="MJXp-mo" id="MJXp-Span-1346" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-1347">1</span><span class="MJXp-mo" id="MJXp-Span-1348" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-230">(j-1)</script>-th element of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1349"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1350">L</span><span class="MJXp-mo" id="MJXp-Span-1351" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1352">a</span><span class="MJXp-mo" id="MJXp-Span-1353" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-231">L(a)</script> but does not match the next element, we cannot append it to the subsequence because it would violate the left view; </li><li> if <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1354"><span class="MJXp-msubsup" id="MJXp-Span-1355"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1356" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1357" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-232">a_i</script> is less than or equal to the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1358"><span class="MJXp-mo" id="MJXp-Span-1359" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1360">j</span><span class="MJXp-mo" id="MJXp-Span-1361" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-1362">1</span><span class="MJXp-mo" id="MJXp-Span-1363" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-233">(j-1)</script>-th element of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1364"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1365">L</span><span class="MJXp-mo" id="MJXp-Span-1366" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1367">a</span><span class="MJXp-mo" id="MJXp-Span-1368" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-234">L(a)</script>, we can either append it to the subsequence or skip it; this will not affect the left view. Accordingly, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1369"><span class="MJXp-msubsup" id="MJXp-Span-1370"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1371" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1372" style="vertical-align: -0.4em;">j</span></span></span></span><script type="math/tex" id="MathJax-Element-235">c_j</script> should be multiplied by <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1373"><span class="MJXp-mn" id="MJXp-Span-1374">2</span></span></span><script type="math/tex" id="MathJax-Element-236">2</script>. </li></ul><p>How do we obtain the array <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1375"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1376">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1377">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1378">L</span></span></span><script type="math/tex" id="MathJax-Element-237">dpL</script> from this? Each time we encounter an element <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1379"><span class="MJXp-msubsup" id="MJXp-Span-1380"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1381" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1382" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-238">a_i</script> equal to the maximum, we need to count how many subsequences it can be appended to so that the left view matches <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1383"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1384">L</span><span class="MJXp-mo" id="MJXp-Span-1385" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1386">a</span><span class="MJXp-mo" id="MJXp-Span-1387" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-239">L(a)</script> and the element itself is the first occurrence of the maximum. This is actually all subsequences whose left view matches <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1388"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1389">L</span><span class="MJXp-mo" id="MJXp-Span-1390" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1391">a</span><span class="MJXp-mo" id="MJXp-Span-1392" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-240">L(a)</script> without the last element, so it is sufficient to assign <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1393"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1394">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1395">p</span><span class="MJXp-msubsup" id="MJXp-Span-1396"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1397" style="margin-right: 0.05em;">L</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1398" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1399" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-1400"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1401" style="margin-right: 0.05em;">c</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1402" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1403">k</span><span class="MJXp-mo" id="MJXp-Span-1404">−</span><span class="MJXp-mn" id="MJXp-Span-1405">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-241">dpL_i = c_{k-1}</script>.</p><p>Thus, we will obtain a solution in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1406"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1407">O</span><span class="MJXp-mo" id="MJXp-Span-1408" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1409"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1410" style="margin-right: 0.05em;">n</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1411" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1412" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-242">O(n^2)</script>, which is sufficient for the easy version of the problem.</p></div></div></div></div></div></div><p><a href="https://codeforces.com/contest/2144/problem/E2" title="Educational Codeforces Round 182 (Rated for Div. 2)">2144E2 - Looking at Towers (difficult version)</a></p><p>Idea: <a class="rated-user user-orange" href="https://codeforces.com/profile/Roms" title="Master Roms">Roms</a></p> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2144/problem/E2" title="Educational Codeforces Round 182 (Rated for Div. 2)">2144E2 - Looking at Towers (difficult version)</a></h3><div class="ttypography"><div class="problem-statement"><div><p><span class="tex-font-style-it">First, read the editorial for the easy version of the problem.</span></p><p>Let's understand which parts of the solution for the easy version work in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1413"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1414">O</span><span class="MJXp-mo" id="MJXp-Span-1415" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1416"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1417" style="margin-right: 0.05em;">n</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1418" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1419" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-243">O(n^2)</script> and figure out how to speed them up.</p><p>First, so far the arrays <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1420"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1421">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1422">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1423">L</span></span></span><script type="math/tex" id="MathJax-Element-244">dpL</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1424"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1425">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1426">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1427">R</span></span></span><script type="math/tex" id="MathJax-Element-245">dpR</script> are being computed too slowly. The main problem lies in maintaining the array <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1428"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1429">c</span></span></span><script type="math/tex" id="MathJax-Element-246">c</script>, because when processing one element <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1430"><span class="MJXp-msubsup" id="MJXp-Span-1431"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1432" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1433" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-247">a_i</script>, we can change many elements of the array <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1434"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1435">c</span></span></span><script type="math/tex" id="MathJax-Element-248">c</script> at once. However, all these elements are such that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1436"><span class="MJXp-msubsup" id="MJXp-Span-1437"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1438" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1439" style="vertical-align: -0.4em;">j</span></span></span></span><script type="math/tex" id="MathJax-Element-249">c_j</script> is the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1440"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1441">j</span></span></span><script type="math/tex" id="MathJax-Element-250">j</script>-th element of the array <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1442"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1443">L</span><span class="MJXp-mo" id="MJXp-Span-1444" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1445">a</span><span class="MJXp-mo" id="MJXp-Span-1446" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-251">L(a)</script> that is greater than or equal to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1447"><span class="MJXp-msubsup" id="MJXp-Span-1448"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1449" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1450" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-252">a_i</script>; therefore, it is always some suffix of the array <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1451"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1452">c</span></span></span><script type="math/tex" id="MathJax-Element-253">c</script>, which can be found using binary search. Additionally, all of them are multiplied by <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1453"><span class="MJXp-mn" id="MJXp-Span-1454">2</span></span></span><script type="math/tex" id="MathJax-Element-254">2</script>. This means that to maintain the array <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1455"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1456">c</span></span></span><script type="math/tex" id="MathJax-Element-255">c</script>, we can use a segment tree with the following operations:</p><ul> <li> double all elements in a segment; </li><li> increase a certain element by a given value; </li><li> get the value of a certain element. </li></ul><p>This way, we can speed up the construction of the arrays <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1457"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1458">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1459">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1460">L</span></span></span><script type="math/tex" id="MathJax-Element-256">dpL</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1461"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1462">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1463">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1464">R</span></span></span><script type="math/tex" id="MathJax-Element-257">dpR</script> to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1465"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1466">O</span><span class="MJXp-mo" id="MJXp-Span-1467" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1468">n</span><span class="MJXp-mi" id="MJXp-Span-1469">log</span><span class="MJXp-mo" id="MJXp-Span-1470" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1471">n</span><span class="MJXp-mo" id="MJXp-Span-1472" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-258">O(n \log n)</script>.</p><p>The second part of the solution that works in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1473"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1474">O</span><span class="MJXp-mo" id="MJXp-Span-1475" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1476"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1477" style="margin-right: 0.05em;">n</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1478" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1479" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-259">O(n^2)</script> is calculating the answer using <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1480"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1481">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1482">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1483">L</span></span></span><script type="math/tex" id="MathJax-Element-260">dpL</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1484"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1485">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1486">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1487">R</span></span></span><script type="math/tex" id="MathJax-Element-261">dpR</script>. Recall that we need to iterate through all pairs of occurrences of the maximum <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1488"><span class="MJXp-mo" id="MJXp-Span-1489" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1490">i</span><span class="MJXp-mo" id="MJXp-Span-1491" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1492">j</span><span class="MJXp-mo" id="MJXp-Span-1493" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-262">(i, j)</script>, where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1494"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1495">i</span><span class="MJXp-mo" id="MJXp-Span-1496" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1497">j</span></span></span><script type="math/tex" id="MathJax-Element-263">i \le j</script>, and increase the answer by <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1498"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1499">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1500">p</span><span class="MJXp-msubsup" id="MJXp-Span-1501"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1502" style="margin-right: 0.05em;">L</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1503" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1504" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1505">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1506">p</span><span class="MJXp-msubsup" id="MJXp-Span-1507"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1508" style="margin-right: 0.05em;">R</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1509" style="vertical-align: -0.4em;">j</span></span><span class="MJXp-mo" id="MJXp-Span-1510" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-msubsup" id="MJXp-Span-1511"><span class="MJXp-mn" id="MJXp-Span-1512" style="margin-right: 0.05em;">2</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1513" style="vertical-align: 0.5em;"><span class="MJXp-mo" id="MJXp-Span-1514">max</span><span class="MJXp-mo" id="MJXp-Span-1515">(</span><span class="MJXp-mn" id="MJXp-Span-1516">0</span><span class="MJXp-mo" id="MJXp-Span-1517">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1518">j</span><span class="MJXp-mo" id="MJXp-Span-1519">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1520">i</span><span class="MJXp-mo" id="MJXp-Span-1521">−</span><span class="MJXp-mn" id="MJXp-Span-1522">1</span><span class="MJXp-mo" id="MJXp-Span-1523">)</span></span></span></span></span><script type="math/tex" id="MathJax-Element-264">dpL_i \cdot dpR_j \cdot 2^{\max(0, j-i-1)}</script>. This can be sped up to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1524"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1525">O</span><span class="MJXp-mo" id="MJXp-Span-1526" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1527">n</span><span class="MJXp-mo" id="MJXp-Span-1528" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-265">O(n)</script> as follows: when iterating through <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1529"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1530">j</span></span></span><script type="math/tex" id="MathJax-Element-266">j</script>, we will maintain the sum of all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1531"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1532">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1533">p</span><span class="MJXp-msubsup" id="MJXp-Span-1534"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1535" style="margin-right: 0.05em;">L</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1536" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-267">dpL_i</script> for <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1537"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1538">i</span><span class="MJXp-mo" id="MJXp-Span-1539" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1540">j</span></span></span><script type="math/tex" id="MathJax-Element-268">i<j</script>, multiplied by the required power of two; when moving from <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1541"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1542">j</span></span></span><script type="math/tex" id="MathJax-Element-269">j</script> to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1543"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1544">j</span><span class="MJXp-mo" id="MJXp-Span-1545" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-1546">1</span></span></span><script type="math/tex" id="MathJax-Element-270">j+1</script>, it is sufficient to double this sum and add <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1547"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1548">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1549">p</span><span class="MJXp-msubsup" id="MJXp-Span-1550"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1551" style="margin-right: 0.05em;">L</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1552" style="vertical-align: -0.4em;">j</span></span></span></span><script type="math/tex" id="MathJax-Element-271">dpL_j</script> to it.</p><p>The remaining parts of the solution work in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1553"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1554">O</span><span class="MJXp-mo" id="MJXp-Span-1555" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1556">n</span><span class="MJXp-mo" id="MJXp-Span-1557" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-272">O(n)</script>, so we will thus obtain a program that runs in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1558"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1559">O</span><span class="MJXp-mo" id="MJXp-Span-1560" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1561">n</span><span class="MJXp-mi" id="MJXp-Span-1562">log</span><span class="MJXp-mo" id="MJXp-Span-1563" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1564">n</span><span class="MJXp-mo" id="MJXp-Span-1565" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-273">O(n \log n)</script>.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Solution (BledDest)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
 
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> MOD </span><span class="pun">=</span><span class="pln"> </span><span class="lit">998244353</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> N </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1000043</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> </span><span class="kwd">add</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> y</span><span class="pun">)</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    x </span><span class="pun">+=</span><span class="pln"> y</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pun">(</span><span class="pln">x </span><span class="pun">&gt;=</span><span class="pln"> MOD</span><span class="pun">)</span><span class="pln"> x </span><span class="pun">-=</span><span class="pln"> MOD</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pun">(</span><span class="pln">x </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> x </span><span class="pun">+=</span><span class="pln"> MOD</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> x</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> mul</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> y</span><span class="pun">)</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x </span><span class="pun">*</span><span class="pln"> </span><span class="lit">1ll</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> y</span><span class="pun">)</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> MOD</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">   
 
</span><span class="kwd">int</span><span class="pln"> binpow</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> y</span><span class="pun">)</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> z </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pun">(</span><span class="pln">y </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">y </span><span class="pun">%</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> z </span><span class="pun">=</span><span class="pln"> mul</span><span class="pun">(</span><span class="pln">z</span><span class="pun">,</span><span class="pln"> x</span><span class="pun">);</span><span class="pln">
        x </span><span class="pun">=</span><span class="pln"> mul</span><span class="pun">(</span><span class="pln">x</span><span class="pun">,</span><span class="pln"> x</span><span class="pun">);</span><span class="pln">
        y </span><span class="pun">/=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> z</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
vector</span><span class="str">&lt;int&gt;</span><span class="pln"> </span><span class="kwd">get</span><span class="pun">(</span><span class="kwd">const</span><span class="pln"> vector</span><span class="str">&lt;int&gt;</span><span class="pun">&amp;</span><span class="pln"> a</span><span class="pun">)</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> cur </span><span class="pun">=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">;</span><span class="pln">
    vector</span><span class="str">&lt;int&gt;</span><span class="pln"> res</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">auto</span><span class="pln"> x </span><span class="pun">:</span><span class="pln"> a</span><span class="pun">)</span><span class="pln">
        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">x </span><span class="pun">&gt;</span><span class="pln"> cur</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">{</span><span class="pln">
            res</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">x</span><span class="pun">);</span><span class="pln">
            cur </span><span class="pun">=</span><span class="pln"> x</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> res</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">struct</span><span class="pln"> </span><span class="typ">SegTree</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    vector</span><span class="str">&lt;int&gt;</span><span class="pln"> f</span><span class="pun">;</span><span class="pln">
    vector</span><span class="str">&lt;int&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
 
    </span><span class="kwd">int</span><span class="pln"> getVal</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> v</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> pos</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> mul</span><span class="pun">(</span><span class="pln">t</span><span class="pun">[</span><span class="pln">pos</span><span class="pun">],</span><span class="pln"> binpow</span><span class="pun">(</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> f</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]));</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">   
 
    </span><span class="kwd">void</span><span class="pln"> push</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> v</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">f</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">{</span><span class="pln">
            f</span><span class="pun">[</span><span class="lit">2</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> v </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+=</span><span class="pln"> f</span><span class="pun">[</span><span class="pln">v</span><span class="pun">];</span><span class="pln">
            f</span><span class="pun">[</span><span class="lit">2</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> v </span><span class="pun">+</span><span class="pln"> </span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+=</span><span class="pln"> f</span><span class="pun">[</span><span class="pln">v</span><span class="pun">];</span><span class="pln">
            f</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
 
    </span><span class="kwd">void</span><span class="pln"> resolve</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> v</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> pos</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">f</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">{</span><span class="pln">
            t</span><span class="pun">[</span><span class="pln">pos</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> mul</span><span class="pun">(</span><span class="pln">t</span><span class="pun">[</span><span class="pln">pos</span><span class="pun">],</span><span class="pln"> binpow</span><span class="pun">(</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> f</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]));</span><span class="pln">
            f</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">    
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
 
    </span><span class="kwd">int</span><span class="pln"> </span><span class="kwd">get</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> v</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> l</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> r</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> pos</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">l </span><span class="pun">==</span><span class="pln"> r </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> getVal</span><span class="pun">(</span><span class="pln">v</span><span class="pun">,</span><span class="pln"> pos</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">else</span><span class="pln">
        </span><span class="pun">{</span><span class="pln">
            push</span><span class="pun">(</span><span class="pln">v</span><span class="pun">);</span><span class="pln">
            </span><span class="kwd">int</span><span class="pln"> m </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l </span><span class="pun">+</span><span class="pln"> r</span><span class="pun">)</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">pos </span><span class="pun">&lt;</span><span class="pln"> m</span><span class="pun">)</span><span class="pln">
                </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">get</span><span class="pun">(</span><span class="pln">v </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> l</span><span class="pun">,</span><span class="pln"> m</span><span class="pun">,</span><span class="pln"> pos</span><span class="pun">);</span><span class="pln">
            </span><span class="kwd">else</span><span class="pln">
                </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">get</span><span class="pun">(</span><span class="pln">v </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> m</span><span class="pun">,</span><span class="pln"> r</span><span class="pun">,</span><span class="pln"> pos</span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
 
    </span><span class="kwd">int</span><span class="pln"> </span><span class="kwd">get</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> pos</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">get</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> pos</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
 
    </span><span class="kwd">void</span><span class="pln"> inc</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> v</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> l</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> r</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> pos</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> val</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">l </span><span class="pun">==</span><span class="pln"> r </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">{</span><span class="pln">
            resolve</span><span class="pun">(</span><span class="pln">v</span><span class="pun">,</span><span class="pln"> pos</span><span class="pun">);</span><span class="pln">
            t</span><span class="pun">[</span><span class="pln">pos</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">add</span><span class="pun">(</span><span class="pln">t</span><span class="pun">[</span><span class="pln">pos</span><span class="pun">],</span><span class="pln"> val</span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">else</span><span class="pln">
        </span><span class="pun">{</span><span class="pln">
            push</span><span class="pun">(</span><span class="pln">v</span><span class="pun">);</span><span class="pln">
            </span><span class="kwd">int</span><span class="pln"> m </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l </span><span class="pun">+</span><span class="pln"> r</span><span class="pun">)</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">pos </span><span class="pun">&lt;</span><span class="pln"> m</span><span class="pun">)</span><span class="pln">
                inc</span><span class="pun">(</span><span class="pln">v </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> l</span><span class="pun">,</span><span class="pln"> m</span><span class="pun">,</span><span class="pln"> pos</span><span class="pun">,</span><span class="pln"> val</span><span class="pun">);</span><span class="pln">
            </span><span class="kwd">else</span><span class="pln">
                inc</span><span class="pun">(</span><span class="pln">v </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> m</span><span class="pun">,</span><span class="pln"> r</span><span class="pun">,</span><span class="pln"> pos</span><span class="pun">,</span><span class="pln"> val</span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
 
    </span><span class="kwd">void</span><span class="pln"> inc</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> pos</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> val</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> inc</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> pos</span><span class="pun">,</span><span class="pln"> val</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
 
    </span><span class="kwd">void</span><span class="pln"> mulBy2</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> v</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> l</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> r</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> L</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> R</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">L </span><span class="pun">&gt;=</span><span class="pln"> R</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">return</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">l </span><span class="pun">==</span><span class="pln"> L </span><span class="pun">&amp;&amp;</span><span class="pln"> r </span><span class="pun">==</span><span class="pln"> R</span><span class="pun">)</span><span class="pln">
            f</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]++;</span><span class="pln">
        </span><span class="kwd">else</span><span class="pln">
        </span><span class="pun">{</span><span class="pln">
            push</span><span class="pun">(</span><span class="pln">v</span><span class="pun">);</span><span class="pln">
            </span><span class="kwd">int</span><span class="pln"> m </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l </span><span class="pun">+</span><span class="pln"> r</span><span class="pun">)</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln">
            mulBy2</span><span class="pun">(</span><span class="pln">v </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> l</span><span class="pun">,</span><span class="pln"> m</span><span class="pun">,</span><span class="pln"> L</span><span class="pun">,</span><span class="pln"> min</span><span class="pun">(</span><span class="pln">R</span><span class="pun">,</span><span class="pln"> m</span><span class="pun">));</span><span class="pln">
            mulBy2</span><span class="pun">(</span><span class="pln">v </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> m</span><span class="pun">,</span><span class="pln"> r</span><span class="pun">,</span><span class="pln"> max</span><span class="pun">(</span><span class="pln">L</span><span class="pun">,</span><span class="pln"> m</span><span class="pun">),</span><span class="pln"> R</span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
 
    </span><span class="kwd">void</span><span class="pln"> mulBy2</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> l</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> r</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
        mulBy2</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> l</span><span class="pun">,</span><span class="pln"> r</span><span class="pun">);</span><span class="pln">   
    </span><span class="pun">}</span><span class="pln">
 
    </span><span class="typ">SegTree</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> n </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">-&gt;</span><span class="pln">n </span><span class="pun">=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
        f</span><span class="pun">.</span><span class="pln">resize</span><span class="pun">(</span><span class="lit">4</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> n</span><span class="pun">);</span><span class="pln">
        t</span><span class="pun">.</span><span class="pln">resize</span><span class="pun">(</span><span class="pln">n</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">};</span><span class="pln">
 
vector</span><span class="str">&lt;int&gt;</span><span class="pln"> calc</span><span class="pun">(</span><span class="kwd">const</span><span class="pln"> vector</span><span class="str">&lt;int&gt;</span><span class="pun">&amp;</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">const</span><span class="pln"> vector</span><span class="str">&lt;int&gt;</span><span class="pun">&amp;</span><span class="pln"> b</span><span class="pun">)</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> n </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">size</span><span class="pun">();</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> m </span><span class="pun">=</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">size</span><span class="pun">();</span><span class="pln">
    </span><span class="typ">SegTree</span><span class="pln"> tree</span><span class="pun">(</span><span class="pln">m </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
    tree</span><span class="pun">.</span><span class="pln">inc</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
    vector</span><span class="str">&lt;int&gt;</span><span class="pln"> res</span><span class="pun">(</span><span class="pln">n</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> maxVal </span><span class="pun">=</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">back</span><span class="pun">();</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> x </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">x </span><span class="pun">&gt;</span><span class="pln"> maxVal</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">continue</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">else</span><span class="pln">
        </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x </span><span class="pun">==</span><span class="pln"> maxVal</span><span class="pun">)</span><span class="pln"> res</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> tree</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln">m </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
            </span><span class="kwd">int</span><span class="pln"> lf </span><span class="pun">=</span><span class="pln"> lower_bound</span><span class="pun">(</span><span class="pln">b</span><span class="pun">.</span><span class="kwd">begin</span><span class="pun">(),</span><span class="pln"> b</span><span class="pun">.</span><span class="kwd">end</span><span class="pun">(),</span><span class="pln"> x</span><span class="pun">)</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> b</span><span class="pun">.</span><span class="kwd">begin</span><span class="pun">();</span><span class="pln">
            tree</span><span class="pun">.</span><span class="pln">mulBy2</span><span class="pun">(</span><span class="pln">lf </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> m </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
            </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">b</span><span class="pun">[</span><span class="pln">lf</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> x</span><span class="pun">)</span><span class="pln">
            </span><span class="pun">{</span><span class="pln">
                </span><span class="kwd">int</span><span class="pln"> cur </span><span class="pun">=</span><span class="pln"> tree</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln">lf</span><span class="pun">);</span><span class="pln">
                tree</span><span class="pun">.</span><span class="pln">inc</span><span class="pun">(</span><span class="pln">lf </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> cur</span><span class="pun">);</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> res</span><span class="pun">;</span><span class="pln"> 
</span><span class="pun">}</span><span class="pln">   
 
</span><span class="kwd">void</span><span class="pln"> solve</span><span class="pun">()</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
    vector</span><span class="str">&lt;int&gt;</span><span class="pln"> a</span><span class="pun">(</span><span class="pln">n</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
        cin </span><span class="pun">&gt;&gt;</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
    </span><span class="kwd">auto</span><span class="pln"> left_view </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">get</span><span class="pun">(</span><span class="pln">a</span><span class="pun">);</span><span class="pln">
    reverse</span><span class="pun">(</span><span class="pln">a</span><span class="pun">.</span><span class="kwd">begin</span><span class="pun">(),</span><span class="pln"> a</span><span class="pun">.</span><span class="kwd">end</span><span class="pun">());</span><span class="pln">
    </span><span class="kwd">auto</span><span class="pln"> right_view </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">get</span><span class="pun">(</span><span class="pln">a</span><span class="pun">);</span><span class="pln">
    reverse</span><span class="pun">(</span><span class="pln">a</span><span class="pun">.</span><span class="kwd">begin</span><span class="pun">(),</span><span class="pln"> a</span><span class="pun">.</span><span class="kwd">end</span><span class="pun">());</span><span class="pln">
 
    </span><span class="kwd">auto</span><span class="pln"> dpL </span><span class="pun">=</span><span class="pln"> calc</span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class="pln"> left_view</span><span class="pun">);</span><span class="pln">
    reverse</span><span class="pun">(</span><span class="pln">a</span><span class="pun">.</span><span class="kwd">begin</span><span class="pun">(),</span><span class="pln"> a</span><span class="pun">.</span><span class="kwd">end</span><span class="pun">());</span><span class="pln">
    </span><span class="kwd">auto</span><span class="pln"> dpR </span><span class="pun">=</span><span class="pln"> calc</span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class="pln"> right_view</span><span class="pun">);</span><span class="pln">
    reverse</span><span class="pun">(</span><span class="pln">a</span><span class="pun">.</span><span class="kwd">begin</span><span class="pun">(),</span><span class="pln"> a</span><span class="pun">.</span><span class="kwd">end</span><span class="pun">());</span><span class="pln">
    reverse</span><span class="pun">(</span><span class="pln">dpR</span><span class="pun">.</span><span class="kwd">begin</span><span class="pun">(),</span><span class="pln"> dpR</span><span class="pun">.</span><span class="kwd">end</span><span class="pun">());</span><span class="pln">
 
    </span><span class="kwd">int</span><span class="pln"> maxVal </span><span class="pun">=</span><span class="pln"> </span><span class="pun">*</span><span class="pln">max_element</span><span class="pun">(</span><span class="pln">a</span><span class="pun">.</span><span class="kwd">begin</span><span class="pun">(),</span><span class="pln"> a</span><span class="pun">.</span><span class="kwd">end</span><span class="pun">());</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> ans </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> sumLeft </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> maxVal</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">continue</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">else</span><span class="pln">
        </span><span class="pun">{</span><span class="pln">   
            </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> maxVal</span><span class="pun">)</span><span class="pln"> ans </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">add</span><span class="pun">(</span><span class="pln">ans</span><span class="pun">,</span><span class="pln"> mul</span><span class="pun">(</span><span class="kwd">add</span><span class="pun">(</span><span class="pln">sumLeft</span><span class="pun">,</span><span class="pln"> dpL</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]),</span><span class="pln"> dpR</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]));</span><span class="pln">
            sumLeft </span><span class="pun">=</span><span class="pln"> mul</span><span class="pun">(</span><span class="pln">sumLeft</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">);</span><span class="pln">
            </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> maxVal</span><span class="pun">)</span><span class="pln"> sumLeft </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">add</span><span class="pun">(</span><span class="pln">sumLeft</span><span class="pun">,</span><span class="pln"> dpL</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    cout </span><span class="pun">&lt;&lt;</span><span class="pln"> ans </span><span class="pun">&lt;&lt;</span><span class="pln"> endl</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    ios_base</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">    
    </span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> solve</span><span class="pun">();</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2144/problem/F" title="Educational Codeforces Round 182 (Rated for Div. 2)">2144F - Bracket Groups</a></p><p>Idea: <a class="rated-user user-red" href="https://codeforces.com/profile/BledDest" title="International Grandmaster BledDest">BledDest</a></p> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2144/problem/F" title="Educational Codeforces Round 182 (Rated for Div. 2)">2144F - Bracket Groups</a></h3><div class="ttypography"><div class="problem-statement"><div><p>First, consider the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1566"><span class="MJXp-mo" id="MJXp-Span-1567" style="margin-left: 0em; margin-right: 0.111em;">−</span><span class="MJXp-mn" id="MJXp-Span-1568">1</span></span></span><script type="math/tex" id="MathJax-Element-274">-1</script> case. If one of the given bracket sequences is equal to "()", then it's definitely <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1569"><span class="MJXp-mo" id="MJXp-Span-1570" style="margin-left: 0em; margin-right: 0.111em;">−</span><span class="MJXp-mn" id="MJXp-Span-1571">1</span></span></span><script type="math/tex" id="MathJax-Element-275">-1</script>. Every regular bracket sequence has such substring. Turns out, otherwise, the answer always exists. Let's show this constructively and come up with an answer for any number of groups.</p><p>Consider a regular bracket sequence "()()()...()". Notice how it alternates brackets, so if a given bracket sequence has two of the same bracket next to each other, it can always be assigned to a group with that RBS. Otherwise, you can actually use a regular bracket sequence "((((...(())...))))". Since the remaining bracket sequences have alternating brackets and have length at least <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1572"><span class="MJXp-mn" id="MJXp-Span-1573">3</span></span></span><script type="math/tex" id="MathJax-Element-276">3</script> (or equal to ")("), they can always be assigned to a group with this RBS.</p><p>So we actually discovered that the answer is at most <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1574"><span class="MJXp-mn" id="MJXp-Span-1575">2</span></span></span><script type="math/tex" id="MathJax-Element-277">2</script> and have a construction to achieve that answer. Now, we only have to check if it's possible to fit all bracket sequences into one group.</p><p>Ideally, we'd like to take <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1576"><span class="MJXp-mrow" id="MJXp-Span-1577"><span class="MJXp-mtext MJXp-mono" id="MJXp-Span-1578">dp[i][bal]</span></span></span></span><script type="math/tex" id="MathJax-Element-278">\texttt{dp[i][bal]}</script>&nbsp;— whether we can make a bracket sequence with length <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1579"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1580">i</span></span></span><script type="math/tex" id="MathJax-Element-279">i</script> and balance <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1581"><span class="MJXp-mrow" id="MJXp-Span-1582"><span class="MJXp-mi undefined" id="MJXp-Span-1583">b</span><span class="MJXp-mi undefined" id="MJXp-Span-1584">a</span><span class="MJXp-mi undefined" id="MJXp-Span-1585">l</span></span></span></span><script type="math/tex" id="MathJax-Element-280">\mathit{bal}</script> (and also, non-negative balance on every prefix), and adjust that to care about not having any substrings equal to any of the given strings.</p><p>Well, there is a tool for that, and it's called the Aho-Corasick automaton. This automaton is basically a trie with extra properties. So, we build a trie of the given bracket sequences and calculate suffix links (for each node of the trie, the link to the node that corresponds to its longest proper suffix that exists in the trie). Now we can make the node of the trie an additional state of the dp. So, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1586"><span class="MJXp-mrow" id="MJXp-Span-1587"><span class="MJXp-mtext MJXp-mono" id="MJXp-Span-1588">dp[i][bal][v]</span></span></span></span><script type="math/tex" id="MathJax-Element-281">\texttt{dp[i][bal][v]}</script>&nbsp;— whether we can make a bracket sequence with length <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1589"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1590">i</span></span></span><script type="math/tex" id="MathJax-Element-282">i</script> and balance <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1591"><span class="MJXp-mrow" id="MJXp-Span-1592"><span class="MJXp-mi undefined" id="MJXp-Span-1593">b</span><span class="MJXp-mi undefined" id="MJXp-Span-1594">a</span><span class="MJXp-mi undefined" id="MJXp-Span-1595">l</span></span></span></span><script type="math/tex" id="MathJax-Element-283">\mathit{bal}</script> such that the longest suffix of the current string that exists in the trie corresponds to the node <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1596"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1597">v</span></span></span><script type="math/tex" id="MathJax-Element-284">v</script>. Using the suffix links, we calculate the transitions of the automaton, so that we can know the node <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1598"><span class="MJXp-msup" id="MJXp-Span-1599"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1600" style="margin-right: 0.05em;">v</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1601" style="vertical-align: 0.5em;">′</span></span></span></span><script type="math/tex" id="MathJax-Element-285">v'</script> we move to after we append either of the brackets to the string.</p><p>How to check if any of the strings from the set appear in our string as a substring then? Well, let's only make a transition in the dp if the string with an appended bracket doesn't have any of its suffixes equal to a string in the set. Consider the longest suffix of the current string that appears in the trie. Obviously, suffixes longer than that can't be equal to any of the strings in the set. However, even if the longest suffix isn't equal to the string in the set, one of the shorter suffixes might still be equal to some. To check for that, we can again use suffix links. Initially, mark every node that corresponds to a full string as a terminal node. After that, a node is unsafe if it's a terminal or it can reach a terminal while jumping via suffix links. Suffix links form a tree structure (since they always point to a node corresponding to a shorter string), so this can be precalculated with a single dfs/bfs.</p><p>Overall complexity: <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1602"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1603">O</span><span class="MJXp-mo" id="MJXp-Span-1604" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1605">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1606">k</span><span class="MJXp-mo" id="MJXp-Span-1607" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-286">O(nk)</script> to build the AC automaton and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1608"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1609">O</span><span class="MJXp-mo" id="MJXp-Span-1610" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1611">n</span><span class="MJXp-msubsup" id="MJXp-Span-1612"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1613" style="margin-right: 0.05em;">k</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1614" style="vertical-align: 0.5em;">3</span></span><span class="MJXp-mo" id="MJXp-Span-1615" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-287">O(nk^3)</script> for the dynamic programming (O(<span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1616"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1617">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1618">k</span></span></span><script type="math/tex" id="MathJax-Element-288">nk</script>) nodes in the trie and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1619"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1620">O</span><span class="MJXp-mo" id="MJXp-Span-1621" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1622">k</span><span class="MJXp-mo" id="MJXp-Span-1623" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-289">O(k)</script> for the length of the string and the current balance).</p><p>To be fair, the constraints allowed you to be very lazy with the AC automaton implementation. Like, you could collect all prefixes of all strings into a vector and sort that to give the prefixes some indices. To calculate if a string is bad, you could check if any of its suffixes appear in the set of full strings. To calculate the transitions, you could try appending a bracket to each suffix of the string and binary search to find the resulting string in the automaton.</p><p>The complexity of this makeshift automaton is probably <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1624"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1625">O</span><span class="MJXp-mo" id="MJXp-Span-1626" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1627">n</span><span class="MJXp-msubsup" id="MJXp-Span-1628"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1629" style="margin-right: 0.05em;">k</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1630" style="vertical-align: 0.5em;">3</span></span><span class="MJXp-mo" id="MJXp-Span-1631" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mi" id="MJXp-Span-1632">log</span><span class="MJXp-mo" id="MJXp-Span-1633" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1634">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1635">k</span><span class="MJXp-mo" id="MJXp-Span-1636" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-290">O(nk^3 \cdot \log nk)</script>.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Solution 1 (awoo)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
 
</span><span class="com">#define</span><span class="pln"> </span><span class="kwd">forn</span><span class="pun">(</span><span class="pln">i</span><span class="pun">,</span><span class="pln"> n</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">(</span><span class="pln">n</span><span class="pun">);</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
 
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">string</span><span class="pln"> al </span><span class="pun">=</span><span class="pln"> </span><span class="str">"()"</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">struct</span><span class="pln"> aho_corasick </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> AL </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln">
 
    </span><span class="kwd">struct</span><span class="pln"> node </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> nxt</span><span class="pun">[</span><span class="pln">AL</span><span class="pun">],</span><span class="pln"> go</span><span class="pun">[</span><span class="pln">AL</span><span class="pun">];</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> p</span><span class="pun">,</span><span class="pln"> pch</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> suf</span><span class="pun">,</span><span class="pln"> ssuf</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">bool</span><span class="pln"> term</span><span class="pun">;</span><span class="pln">
        
        node</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            memset</span><span class="pun">(</span><span class="pln">nxt</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">sizeof</span><span class="pun">(</span><span class="pln">nxt</span><span class="pun">));</span><span class="pln">
            memset</span><span class="pun">(</span><span class="pln">go</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">sizeof</span><span class="pun">(</span><span class="pln">go</span><span class="pun">));</span><span class="pln">
            suf </span><span class="pun">=</span><span class="pln"> ssuf </span><span class="pun">=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">;</span><span class="pln">
            term </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">};</span><span class="pln">
 
    vector</span><span class="str">&lt;node&gt;</span><span class="pln"> nodes</span><span class="pun">;</span><span class="pln">
    vector</span><span class="pun">&lt;</span><span class="pln">vector</span><span class="str">&lt;int&gt;</span><span class="pun">&gt;</span><span class="pln"> g</span><span class="pun">;</span><span class="pln">
    
    aho_corasick</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        nodes</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">node</span><span class="pun">());</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
 
    </span><span class="kwd">void</span><span class="pln"> </span><span class="kwd">add</span><span class="pun">(</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">string</span><span class="pun">&amp;</span><span class="pln"> s</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> v </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">forn</span><span class="pun">(</span><span class="pln">i</span><span class="pun">,</span><span class="pln"> s</span><span class="pun">.</span><span class="pln">size</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">int</span><span class="pln"> c </span><span class="pun">=</span><span class="pln"> al</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln">s</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]);</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">nodes</span><span class="pun">[</span><span class="pln">v</span><span class="pun">].</span><span class="pln">nxt</span><span class="pun">[</span><span class="pln">c</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                nodes</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">node</span><span class="pun">());</span><span class="pln">
                nodes</span><span class="pun">[</span><span class="pln">v</span><span class="pun">].</span><span class="pln">nxt</span><span class="pun">[</span><span class="pln">c</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> nodes</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
                nodes</span><span class="pun">.</span><span class="pln">back</span><span class="pun">().</span><span class="pln">p </span><span class="pun">=</span><span class="pln"> v</span><span class="pun">;</span><span class="pln">
                nodes</span><span class="pun">.</span><span class="pln">back</span><span class="pun">().</span><span class="pln">pch </span><span class="pun">=</span><span class="pln"> c</span><span class="pun">;</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
            v </span><span class="pun">=</span><span class="pln"> nodes</span><span class="pun">[</span><span class="pln">v</span><span class="pun">].</span><span class="pln">nxt</span><span class="pun">[</span><span class="pln">c</span><span class="pun">];</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        nodes</span><span class="pun">[</span><span class="pln">v</span><span class="pun">].</span><span class="pln">term </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    
    </span><span class="kwd">int</span><span class="pln"> go</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> v</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> c</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">nodes</span><span class="pun">[</span><span class="pln">v</span><span class="pun">].</span><span class="pln">go</span><span class="pun">[</span><span class="pln">c</span><span class="pun">]</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">)</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> nodes</span><span class="pun">[</span><span class="pln">v</span><span class="pun">].</span><span class="pln">go</span><span class="pun">[</span><span class="pln">c</span><span class="pun">];</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">nodes</span><span class="pun">[</span><span class="pln">v</span><span class="pun">].</span><span class="pln">nxt</span><span class="pun">[</span><span class="pln">c</span><span class="pun">]</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">)</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> nodes</span><span class="pun">[</span><span class="pln">v</span><span class="pun">].</span><span class="pln">go</span><span class="pun">[</span><span class="pln">c</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> nodes</span><span class="pun">[</span><span class="pln">v</span><span class="pun">].</span><span class="pln">nxt</span><span class="pun">[</span><span class="pln">c</span><span class="pun">];</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">v </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> nodes</span><span class="pun">[</span><span class="pln">v</span><span class="pun">].</span><span class="pln">go</span><span class="pun">[</span><span class="pln">c</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> nodes</span><span class="pun">[</span><span class="pln">v</span><span class="pun">].</span><span class="pln">go</span><span class="pun">[</span><span class="pln">c</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> go</span><span class="pun">(</span><span class="pln">suf</span><span class="pun">(</span><span class="pln">v</span><span class="pun">),</span><span class="pln"> c</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    
    </span><span class="kwd">int</span><span class="pln"> suf</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> v</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">nodes</span><span class="pun">[</span><span class="pln">v</span><span class="pun">].</span><span class="pln">suf </span><span class="pun">!=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">)</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> nodes</span><span class="pun">[</span><span class="pln">v</span><span class="pun">].</span><span class="pln">suf</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">v </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> nodes</span><span class="pun">[</span><span class="pln">v</span><span class="pun">].</span><span class="pln">p </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> nodes</span><span class="pun">[</span><span class="pln">v</span><span class="pun">].</span><span class="pln">suf </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> nodes</span><span class="pun">[</span><span class="pln">v</span><span class="pun">].</span><span class="pln">suf </span><span class="pun">=</span><span class="pln"> go</span><span class="pun">(</span><span class="pln">suf</span><span class="pun">(</span><span class="pln">nodes</span><span class="pun">[</span><span class="pln">v</span><span class="pun">].</span><span class="pln">p</span><span class="pun">),</span><span class="pln"> nodes</span><span class="pun">[</span><span class="pln">v</span><span class="pun">].</span><span class="pln">pch</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    
    </span><span class="kwd">int</span><span class="pln"> ssuf</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> v</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">nodes</span><span class="pun">[</span><span class="pln">v</span><span class="pun">].</span><span class="pln">ssuf </span><span class="pun">!=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">)</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> nodes</span><span class="pun">[</span><span class="pln">v</span><span class="pun">].</span><span class="pln">ssuf</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">v </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> nodes</span><span class="pun">[</span><span class="pln">v</span><span class="pun">].</span><span class="pln">p </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> nodes</span><span class="pun">[</span><span class="pln">v</span><span class="pun">].</span><span class="pln">ssuf </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> s </span><span class="pun">=</span><span class="pln"> suf</span><span class="pun">(</span><span class="pln">v</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">nodes</span><span class="pun">[</span><span class="pln">s</span><span class="pun">].</span><span class="pln">term</span><span class="pun">)</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> nodes</span><span class="pun">[</span><span class="pln">v</span><span class="pun">].</span><span class="pln">ssuf </span><span class="pun">=</span><span class="pln"> s</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> nodes</span><span class="pun">[</span><span class="pln">v</span><span class="pun">].</span><span class="pln">ssuf </span><span class="pun">=</span><span class="pln"> ssuf</span><span class="pun">(</span><span class="pln">s</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    
    </span><span class="kwd">void</span><span class="pln"> build_tree</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        g</span><span class="pun">.</span><span class="pln">resize</span><span class="pun">(</span><span class="pln">nodes</span><span class="pun">.</span><span class="pln">size</span><span class="pun">());</span><span class="pln">
        </span><span class="kwd">forn</span><span class="pun">(</span><span class="pln">v</span><span class="pun">,</span><span class="pln"> nodes</span><span class="pun">.</span><span class="pln">size</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">int</span><span class="pln"> u </span><span class="pun">=</span><span class="pln"> suf</span><span class="pun">(</span><span class="pln">v</span><span class="pun">);</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">v </span><span class="pun">!=</span><span class="pln"> u</span><span class="pun">)</span><span class="pln">
                g</span><span class="pun">[</span><span class="pln">u</span><span class="pun">].</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">v</span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">};</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> k</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n </span><span class="pun">&gt;&gt;</span><span class="pln"> k</span><span class="pun">;</span><span class="pln">
    vector</span><span class="str">&lt;string&gt;</span><span class="pln"> s</span><span class="pun">(</span><span class="pln">n</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">forn</span><span class="pun">(</span><span class="pln">i</span><span class="pun">,</span><span class="pln"> n</span><span class="pun">)</span><span class="pln"> cin </span><span class="pun">&gt;&gt;</span><span class="pln"> s</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
    </span><span class="kwd">forn</span><span class="pun">(</span><span class="pln">i</span><span class="pun">,</span><span class="pln"> n</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">s</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">"()"</span><span class="pun">){</span><span class="pln">
        cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    aho_corasick ac</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">forn</span><span class="pun">(</span><span class="pln">i</span><span class="pun">,</span><span class="pln"> n</span><span class="pun">)</span><span class="pln"> ac</span><span class="pun">.</span><span class="kwd">add</span><span class="pun">(</span><span class="pln">s</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]);</span><span class="pln">
    vector</span><span class="pun">&lt;</span><span class="pln">vector</span><span class="pun">&lt;</span><span class="pln">vector</span><span class="str">&lt;char&gt;</span><span class="pun">&gt;&gt;</span><span class="pln"> dp</span><span class="pun">(</span><span class="pln">k </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> vector</span><span class="pun">&lt;</span><span class="pln">vector</span><span class="str">&lt;char&gt;</span><span class="pun">&gt;(</span><span class="pln">ac</span><span class="pun">.</span><span class="pln">nodes</span><span class="pun">.</span><span class="pln">size</span><span class="pun">(),</span><span class="pln"> vector</span><span class="str">&lt;char&gt;</span><span class="pun">(</span><span class="pln">k </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)));</span><span class="pln">
    vector</span><span class="pun">&lt;</span><span class="pln">vector</span><span class="pun">&lt;</span><span class="pln">vector</span><span class="pun">&lt;</span><span class="pln">pair</span><span class="pun">&lt;</span><span class="kwd">int</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">&gt;&gt;&gt;&gt;</span><span class="pln"> p</span><span class="pun">(</span><span class="pln">k </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> vector</span><span class="pun">&lt;</span><span class="pln">vector</span><span class="pun">&lt;</span><span class="pln">pair</span><span class="pun">&lt;</span><span class="kwd">int</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">&gt;&gt;&gt;(</span><span class="pln">ac</span><span class="pun">.</span><span class="pln">nodes</span><span class="pun">.</span><span class="pln">size</span><span class="pun">(),</span><span class="pln"> vector</span><span class="pun">&lt;</span><span class="pln">pair</span><span class="pun">&lt;</span><span class="kwd">int</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">&gt;&gt;(</span><span class="pln">k </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)));</span><span class="pln">
    dp</span><span class="pun">[</span><span class="lit">0</span><span class="pun">][</span><span class="lit">0</span><span class="pun">][</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">forn</span><span class="pun">(</span><span class="pln">i</span><span class="pun">,</span><span class="pln"> k</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">forn</span><span class="pun">(</span><span class="pln">v</span><span class="pun">,</span><span class="pln"> ac</span><span class="pun">.</span><span class="pln">nodes</span><span class="pun">.</span><span class="pln">size</span><span class="pun">())</span><span class="pln"> </span><span class="kwd">forn</span><span class="pun">(</span><span class="pln">bal</span><span class="pun">,</span><span class="pln"> i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">dp</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">v</span><span class="pun">][</span><span class="pln">bal</span><span class="pun">]){</span><span class="pln">
        </span><span class="kwd">forn</span><span class="pun">(</span><span class="pln">c</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">){</span><span class="pln">
            </span><span class="kwd">int</span><span class="pln"> nbal </span><span class="pun">=</span><span class="pln"> bal </span><span class="pun">+</span><span class="pln"> </span><span class="pun">(</span><span class="pln">c </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">);</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">nbal </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">continue</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">int</span><span class="pln"> u </span><span class="pun">=</span><span class="pln"> ac</span><span class="pun">.</span><span class="pln">go</span><span class="pun">(</span><span class="pln">v</span><span class="pun">,</span><span class="pln"> c</span><span class="pun">);</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">ac</span><span class="pun">.</span><span class="pln">nodes</span><span class="pun">[</span><span class="pln">u</span><span class="pun">].</span><span class="pln">term </span><span class="pun">||</span><span class="pln"> ac</span><span class="pun">.</span><span class="pln">ssuf</span><span class="pun">(</span><span class="pln">u</span><span class="pun">)</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">continue</span><span class="pun">;</span><span class="pln">
            dp</span><span class="pun">[</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">][</span><span class="pln">u</span><span class="pun">][</span><span class="pln">nbal</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
            p</span><span class="pun">[</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">][</span><span class="pln">u</span><span class="pun">][</span><span class="pln">nbal</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">v</span><span class="pun">,</span><span class="pln"> c</span><span class="pun">};</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> sv </span><span class="pun">=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">forn</span><span class="pun">(</span><span class="pln">v</span><span class="pun">,</span><span class="pln"> ac</span><span class="pun">.</span><span class="pln">nodes</span><span class="pun">.</span><span class="pln">size</span><span class="pun">())</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">dp</span><span class="pun">[</span><span class="pln">k</span><span class="pun">][</span><span class="pln">v</span><span class="pun">][</span><span class="lit">0</span><span class="pun">]){</span><span class="pln">
        sv </span><span class="pun">=</span><span class="pln"> v</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">sv </span><span class="pun">==</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">){</span><span class="pln">
        cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
        vector</span><span class="str">&lt;string&gt;</span><span class="pln"> res</span><span class="pun">(</span><span class="lit">2</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">forn</span><span class="pun">(</span><span class="pln">i</span><span class="pun">,</span><span class="pln"> k </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pun">){</span><span class="pln">
            res</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+=</span><span class="pln"> </span><span class="str">"()"</span><span class="pun">;</span><span class="pln">
            res</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+=</span><span class="pln"> </span><span class="str">'('</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">forn</span><span class="pun">(</span><span class="pln">i</span><span class="pun">,</span><span class="pln"> k </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pun">){</span><span class="pln">
            res</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+=</span><span class="pln"> </span><span class="str">')'</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        vector</span><span class="pun">&lt;</span><span class="pln">vector</span><span class="str">&lt;int&gt;</span><span class="pun">&gt;</span><span class="pln"> ans</span><span class="pun">(</span><span class="lit">2</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">forn</span><span class="pun">(</span><span class="pln">i</span><span class="pun">,</span><span class="pln"> n</span><span class="pun">){</span><span class="pln">
            </span><span class="kwd">bool</span><span class="pln"> any </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">forn</span><span class="pun">(</span><span class="pln">j</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">(</span><span class="pln">s</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">size</span><span class="pun">())</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">
                any </span><span class="pun">|=</span><span class="pln"> s</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> s</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">];</span><span class="pln">
            ans</span><span class="pun">[!</span><span class="pln">any</span><span class="pun">].</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">i</span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">forn</span><span class="pun">(</span><span class="pln">i</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">){</span><span class="pln">
            cout </span><span class="pun">&lt;&lt;</span><span class="pln"> res</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
            cout </span><span class="pun">&lt;&lt;</span><span class="pln"> ans</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">:</span><span class="pln"> ans</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln"> cout </span><span class="pun">&lt;&lt;</span><span class="pln"> j </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">" "</span><span class="pun">;</span><span class="pln">
            cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">else</span><span class="pun">{</span><span class="pln">
        cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">string</span><span class="pln"> res </span><span class="pun">=</span><span class="pln"> </span><span class="str">""</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> bal </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> v </span><span class="pun">=</span><span class="pln"> sv</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> k</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> </span><span class="pun">--</span><span class="pln">i</span><span class="pun">){</span><span class="pln">
            </span><span class="kwd">auto</span><span class="pln"> </span><span class="pun">[</span><span class="pln">u</span><span class="pun">,</span><span class="pln"> c</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> p</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">v</span><span class="pun">][</span><span class="pln">bal</span><span class="pun">];</span><span class="pln">
            v </span><span class="pun">=</span><span class="pln"> u</span><span class="pun">;</span><span class="pln">
            res </span><span class="pun">+=</span><span class="pln"> al</span><span class="pun">[</span><span class="pln">c</span><span class="pun">];</span><span class="pln">
            bal </span><span class="pun">-=</span><span class="pln"> c </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        reverse</span><span class="pun">(</span><span class="pln">res</span><span class="pun">.</span><span class="kwd">begin</span><span class="pun">(),</span><span class="pln"> res</span><span class="pun">.</span><span class="kwd">end</span><span class="pun">());</span><span class="pln">
        cout </span><span class="pun">&lt;&lt;</span><span class="pln"> res </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
        cout </span><span class="pun">&lt;&lt;</span><span class="pln"> n </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">forn</span><span class="pun">(</span><span class="pln">i</span><span class="pun">,</span><span class="pln"> n</span><span class="pun">)</span><span class="pln"> cout </span><span class="pun">&lt;&lt;</span><span class="pln"> i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">" "</span><span class="pun">;</span><span class="pln">
        cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div> <div class="spoiler"><b class="spoiler-title">Solution 2 (awoo)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
 
</span><span class="com">#define</span><span class="pln"> </span><span class="kwd">forn</span><span class="pun">(</span><span class="pln">i</span><span class="pun">,</span><span class="pln"> n</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">(</span><span class="pln">n</span><span class="pun">);</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
 
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">string</span><span class="pln"> al </span><span class="pun">=</span><span class="pln"> </span><span class="str">"()"</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> k</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n </span><span class="pun">&gt;&gt;</span><span class="pln"> k</span><span class="pun">;</span><span class="pln">
    vector</span><span class="str">&lt;string&gt;</span><span class="pln"> s</span><span class="pun">(</span><span class="pln">n</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">forn</span><span class="pun">(</span><span class="pln">i</span><span class="pun">,</span><span class="pln"> n</span><span class="pun">)</span><span class="pln"> cin </span><span class="pun">&gt;&gt;</span><span class="pln"> s</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
    </span><span class="kwd">forn</span><span class="pun">(</span><span class="pln">i</span><span class="pun">,</span><span class="pln"> n</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">s</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">"()"</span><span class="pun">){</span><span class="pln">
        cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
 
    vector</span><span class="str">&lt;string&gt;</span><span class="pln"> ac</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="str">""</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">forn</span><span class="pun">(</span><span class="pln">i</span><span class="pun">,</span><span class="pln"> n</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">forn</span><span class="pun">(</span><span class="pln">j</span><span class="pun">,</span><span class="pln"> s</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">size</span><span class="pun">())</span><span class="pln">
        ac</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">s</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">substr</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> j </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">));</span><span class="pln">
    sort</span><span class="pun">(</span><span class="pln">ac</span><span class="pun">.</span><span class="kwd">begin</span><span class="pun">(),</span><span class="pln"> ac</span><span class="pun">.</span><span class="kwd">end</span><span class="pun">());</span><span class="pln">
    ac</span><span class="pun">.</span><span class="pln">resize</span><span class="pun">(</span><span class="pln">unique</span><span class="pun">(</span><span class="pln">ac</span><span class="pun">.</span><span class="kwd">begin</span><span class="pun">(),</span><span class="pln"> ac</span><span class="pun">.</span><span class="kwd">end</span><span class="pun">())</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> ac</span><span class="pun">.</span><span class="kwd">begin</span><span class="pun">());</span><span class="pln">
 
    vector</span><span class="str">&lt;char&gt;</span><span class="pln"> bad</span><span class="pun">(</span><span class="pln">ac</span><span class="pun">.</span><span class="pln">size</span><span class="pun">());</span><span class="pln">
    </span><span class="kwd">set</span><span class="str">&lt;string&gt;</span><span class="pln"> tot</span><span class="pun">(</span><span class="pln">s</span><span class="pun">.</span><span class="kwd">begin</span><span class="pun">(),</span><span class="pln"> s</span><span class="pun">.</span><span class="kwd">end</span><span class="pun">());</span><span class="pln">
    vector</span><span class="pun">&lt;</span><span class="pln">vector</span><span class="str">&lt;int&gt;</span><span class="pun">&gt;</span><span class="pln"> go</span><span class="pun">(</span><span class="pln">ac</span><span class="pun">.</span><span class="pln">size</span><span class="pun">(),</span><span class="pln"> vector</span><span class="str">&lt;int&gt;</span><span class="pun">(</span><span class="lit">2</span><span class="pun">));</span><span class="pln">
    </span><span class="kwd">forn</span><span class="pun">(</span><span class="pln">i</span><span class="pun">,</span><span class="pln"> ac</span><span class="pun">.</span><span class="pln">size</span><span class="pun">())</span><span class="pln"> </span><span class="kwd">forn</span><span class="pun">(</span><span class="pln">j</span><span class="pun">,</span><span class="pln"> ac</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">){</span><span class="pln">
        bad</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">|=</span><span class="pln"> tot</span><span class="pun">.</span><span class="pln">count</span><span class="pun">(</span><span class="pln">ac</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">substr</span><span class="pun">(</span><span class="pln">j</span><span class="pun">));</span><span class="pln">
        </span><span class="kwd">forn</span><span class="pun">(</span><span class="pln">t</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">go</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">t</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">){</span><span class="pln">
            </span><span class="kwd">string</span><span class="pln"> nw </span><span class="pun">=</span><span class="pln"> ac</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">substr</span><span class="pun">(</span><span class="pln">j</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> al</span><span class="pun">[</span><span class="pln">t</span><span class="pun">];</span><span class="pln">
            </span><span class="kwd">auto</span><span class="pln"> it </span><span class="pun">=</span><span class="pln"> lower_bound</span><span class="pun">(</span><span class="pln">ac</span><span class="pun">.</span><span class="kwd">begin</span><span class="pun">(),</span><span class="pln"> ac</span><span class="pun">.</span><span class="kwd">end</span><span class="pun">(),</span><span class="pln"> nw</span><span class="pun">);</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">it </span><span class="pun">!=</span><span class="pln"> ac</span><span class="pun">.</span><span class="kwd">end</span><span class="pun">()</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> </span><span class="pun">*</span><span class="pln">it </span><span class="pun">==</span><span class="pln"> nw</span><span class="pun">)</span><span class="pln">
                go</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">t</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> it </span><span class="pun">-</span><span class="pln"> ac</span><span class="pun">.</span><span class="kwd">begin</span><span class="pun">();</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
 
    vector</span><span class="pun">&lt;</span><span class="pln">vector</span><span class="pun">&lt;</span><span class="pln">vector</span><span class="str">&lt;char&gt;</span><span class="pun">&gt;&gt;</span><span class="pln"> dp</span><span class="pun">(</span><span class="pln">k </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> vector</span><span class="pun">&lt;</span><span class="pln">vector</span><span class="str">&lt;char&gt;</span><span class="pun">&gt;(</span><span class="pln">ac</span><span class="pun">.</span><span class="pln">size</span><span class="pun">(),</span><span class="pln"> vector</span><span class="str">&lt;char&gt;</span><span class="pun">(</span><span class="pln">k </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)));</span><span class="pln">
    vector</span><span class="pun">&lt;</span><span class="pln">vector</span><span class="pun">&lt;</span><span class="pln">vector</span><span class="pun">&lt;</span><span class="pln">pair</span><span class="pun">&lt;</span><span class="kwd">int</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">&gt;&gt;&gt;&gt;</span><span class="pln"> p</span><span class="pun">(</span><span class="pln">k </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> vector</span><span class="pun">&lt;</span><span class="pln">vector</span><span class="pun">&lt;</span><span class="pln">pair</span><span class="pun">&lt;</span><span class="kwd">int</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">&gt;&gt;&gt;(</span><span class="pln">ac</span><span class="pun">.</span><span class="pln">size</span><span class="pun">(),</span><span class="pln"> vector</span><span class="pun">&lt;</span><span class="pln">pair</span><span class="pun">&lt;</span><span class="kwd">int</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">&gt;&gt;(</span><span class="pln">k </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)));</span><span class="pln">
    dp</span><span class="pun">[</span><span class="lit">0</span><span class="pun">][</span><span class="lit">0</span><span class="pun">][</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">forn</span><span class="pun">(</span><span class="pln">i</span><span class="pun">,</span><span class="pln"> k</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">forn</span><span class="pun">(</span><span class="pln">v</span><span class="pun">,</span><span class="pln"> ac</span><span class="pun">.</span><span class="pln">size</span><span class="pun">())</span><span class="pln"> </span><span class="kwd">forn</span><span class="pun">(</span><span class="pln">bal</span><span class="pun">,</span><span class="pln"> i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">dp</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">v</span><span class="pun">][</span><span class="pln">bal</span><span class="pun">]){</span><span class="pln">
        </span><span class="kwd">forn</span><span class="pun">(</span><span class="pln">c</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">){</span><span class="pln">
            </span><span class="kwd">int</span><span class="pln"> nbal </span><span class="pun">=</span><span class="pln"> bal </span><span class="pun">+</span><span class="pln"> </span><span class="pun">(</span><span class="pln">c </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">);</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">nbal </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">continue</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">int</span><span class="pln"> u </span><span class="pun">=</span><span class="pln"> go</span><span class="pun">[</span><span class="pln">v</span><span class="pun">][</span><span class="pln">c</span><span class="pun">];</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">bad</span><span class="pun">[</span><span class="pln">u</span><span class="pun">])</span><span class="pln"> </span><span class="kwd">continue</span><span class="pun">;</span><span class="pln">
            dp</span><span class="pun">[</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">][</span><span class="pln">u</span><span class="pun">][</span><span class="pln">nbal</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
            p</span><span class="pun">[</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">][</span><span class="pln">u</span><span class="pun">][</span><span class="pln">nbal</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">v</span><span class="pun">,</span><span class="pln"> c</span><span class="pun">};</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> sv </span><span class="pun">=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">forn</span><span class="pun">(</span><span class="pln">v</span><span class="pun">,</span><span class="pln"> ac</span><span class="pun">.</span><span class="pln">size</span><span class="pun">())</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">dp</span><span class="pun">[</span><span class="pln">k</span><span class="pun">][</span><span class="pln">v</span><span class="pun">][</span><span class="lit">0</span><span class="pun">]){</span><span class="pln">
        sv </span><span class="pun">=</span><span class="pln"> v</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">sv </span><span class="pun">==</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">){</span><span class="pln">
        cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
        vector</span><span class="str">&lt;string&gt;</span><span class="pln"> res</span><span class="pun">(</span><span class="lit">2</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">forn</span><span class="pun">(</span><span class="pln">i</span><span class="pun">,</span><span class="pln"> k </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pun">){</span><span class="pln">
            res</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+=</span><span class="pln"> </span><span class="str">"()"</span><span class="pun">;</span><span class="pln">
            res</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+=</span><span class="pln"> </span><span class="str">'('</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">forn</span><span class="pun">(</span><span class="pln">i</span><span class="pun">,</span><span class="pln"> k </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pun">){</span><span class="pln">
            res</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+=</span><span class="pln"> </span><span class="str">')'</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        vector</span><span class="pun">&lt;</span><span class="pln">vector</span><span class="str">&lt;int&gt;</span><span class="pun">&gt;</span><span class="pln"> ans</span><span class="pun">(</span><span class="lit">2</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">forn</span><span class="pun">(</span><span class="pln">i</span><span class="pun">,</span><span class="pln"> n</span><span class="pun">){</span><span class="pln">
            </span><span class="kwd">bool</span><span class="pln"> any </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">forn</span><span class="pun">(</span><span class="pln">j</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">(</span><span class="pln">s</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">size</span><span class="pun">())</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">
                any </span><span class="pun">|=</span><span class="pln"> s</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> s</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">];</span><span class="pln">
            ans</span><span class="pun">[!</span><span class="pln">any</span><span class="pun">].</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">i</span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">forn</span><span class="pun">(</span><span class="pln">i</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">){</span><span class="pln">
            cout </span><span class="pun">&lt;&lt;</span><span class="pln"> res</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
            cout </span><span class="pun">&lt;&lt;</span><span class="pln"> ans</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">:</span><span class="pln"> ans</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln"> cout </span><span class="pun">&lt;&lt;</span><span class="pln"> j </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">" "</span><span class="pun">;</span><span class="pln">
            cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">else</span><span class="pun">{</span><span class="pln">
        cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">string</span><span class="pln"> res </span><span class="pun">=</span><span class="pln"> </span><span class="str">""</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> bal </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> v </span><span class="pun">=</span><span class="pln"> sv</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> k</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> </span><span class="pun">--</span><span class="pln">i</span><span class="pun">){</span><span class="pln">
            </span><span class="kwd">auto</span><span class="pln"> </span><span class="pun">[</span><span class="pln">u</span><span class="pun">,</span><span class="pln"> c</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> p</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">v</span><span class="pun">][</span><span class="pln">bal</span><span class="pun">];</span><span class="pln">
            v </span><span class="pun">=</span><span class="pln"> u</span><span class="pun">;</span><span class="pln">
            res </span><span class="pun">+=</span><span class="pln"> al</span><span class="pun">[</span><span class="pln">c</span><span class="pun">];</span><span class="pln">
            bal </span><span class="pun">-=</span><span class="pln"> c </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        reverse</span><span class="pun">(</span><span class="pln">res</span><span class="pun">.</span><span class="kwd">begin</span><span class="pun">(),</span><span class="pln"> res</span><span class="pun">.</span><span class="kwd">end</span><span class="pun">());</span><span class="pln">
        cout </span><span class="pun">&lt;&lt;</span><span class="pln"> res </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
        cout </span><span class="pun">&lt;&lt;</span><span class="pln"> n </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">forn</span><span class="pun">(</span><span class="pln">i</span><span class="pun">,</span><span class="pln"> n</span><span class="pun">)</span><span class="pln"> cout </span><span class="pun">&lt;&lt;</span><span class="pln"> i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">" "</span><span class="pun">;</span><span class="pln">
        cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div></div>

    </div>


        <div style="font-size: 1.1rem;line-height: 1.1rem;padding-bottom: 0.5em;">
            <img src="https://codeforces.com//codeforces.com/codeforces.org/s/52448/images/icons/paperclip-16x16.png" style="vertical-align: middle;"> <span style="padding: 0 0.35em;">Tutorial of <a href="https://codeforces.com/contest/2144" class="notice" style="text-decoration: none;">Educational Codeforces Round 182 (Rated for Div. 2)</a> </span>
        </div>
        
            

  <script>
    // Make all spoilers toggleable
    document.querySelectorAll('.spoiler-title').forEach(title => {
      title.addEventListener('click', function() {
        const spoiler = this.closest('.spoiler');
        spoiler.classList.toggle('open');
      });
    });
    
    // Open all spoilers by default for easier reading
    document.querySelectorAll('.spoiler').forEach(spoiler => {
      spoiler.classList.add('open');
    });
  </script>
</body>
</html>