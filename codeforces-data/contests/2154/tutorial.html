<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tutorial</title>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
      line-height: 1.6;
      color: #333;
      background: #fafafa;
    }
    .ttypography {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    h3 {
      color: #1a1a1a;
      border-bottom: 2px solid #eee;
      padding-bottom: 10px;
    }
    h3 a {
      color: #0066cc;
      text-decoration: none;
    }
    h3 a:hover {
      text-decoration: underline;
    }
    .spoiler {
      margin: 15px 0;
      border: 1px solid #ddd;
      border-radius: 6px;
      overflow: hidden;
    }
    .spoiler-title {
      display: block;
      padding: 12px 15px;
      background: #f0f0f0;
      cursor: pointer;
      font-weight: 600;
      user-select: none;
      border-bottom: 1px solid #ddd;
    }
    .spoiler-title:hover {
      background: #e8e8e8;
    }
    .spoiler-title::before {
      content: '▶ ';
      font-size: 0.8em;
      transition: transform 0.2s;
      display: inline-block;
    }
    .spoiler.open .spoiler-title::before {
      content: '▼ ';
    }
    .spoiler-content {
      padding: 15px;
      background: #fff;
      display: none;
    }
    .spoiler.open .spoiler-content {
      display: block;
    }
    pre, code {
      background: #f5f5f5;
      font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
      font-size: 0.85em;
    }
    pre {
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
    }
    code {
      padding: 2px 5px;
      border-radius: 3px;
    }
    p {
      margin: 10px 0;
    }
    .MathJax {
      font-size: 1.1em;
    }
  </style>
</head>
<body>
  <h1>Editorial</h1>
  <p><a href="https://codeforces.com/blog/entry/147471" target="_blank">View on Codeforces →</a></p>
  
  <div class="ttypography"><p>Thank you for participating!</p><p>Special thanks to <a class="rated-user user-orange" href="https://codeforces.com/profile/reirugan" title="Master reirugan">reirugan</a> for writing the analysis for <strong>B, D, E</strong> and to <a class="rated-user user-orange" href="https://codeforces.com/profile/Proof_by_QED" title="Master Proof_by_QED">Proof_by_QED</a> and <a class="rated-user user-orange" href="https://codeforces.com/profile/LMeyling" title="Master LMeyling">LMeyling</a> for helping to optimise <strong>F1</strong>, leading to the creation of <strong>F2</strong>.</p> <div class="spoiler"><b class="spoiler-title">Rating Predictions</b><div class="spoiler-content" style="display: block;"><table class="bordertable">   <thead>     <tr>       <th align="left">Problem </th>       <th align="center">A </th>       <th align="center">B </th>       <th align="center">C1 </th>       <th align="center">C2 </th>       <th align="center">D </th>       <th align="center">E </th>       <th align="center">F1 </th>       <th align="right">F2 </th>     </tr>   </thead>   <tbody>     <tr>       <td align="left"><a class="rated-user user-orange" href="https://codeforces.com/profile/reirugan" title="Master reirugan">reirugan</a> </td>       <td align="center">800 </td>       <td align="center">1100 </td>       <td align="center">1200 </td>       <td align="center">1600 </td>       <td align="center">1700 </td>       <td align="center">2000 </td>       <td align="center">2200 </td>       <td align="right">¯\_(ツ)_/¯ </td>     </tr>     <tr>       <td align="left"><a class="rated-user user-green" href="https://codeforces.com/profile/eric899" title="Pupil eric899">eric899</a> </td>       <td align="center">800 </td>       <td align="center">1000 </td>       <td align="center">1300 </td>       <td align="center">¯\_(ツ)_/¯ </td>       <td align="center">1600 </td>       <td align="center">¯\_(ツ)_/¯ </td>       <td align="center">¯\_(ツ)_/¯ </td>       <td align="right">¯\_(ツ)_/¯ </td>     </tr>     <tr>       <td align="left"><a class="rated-user user-orange" href="https://codeforces.com/profile/Proof_by_QED" title="Master Proof_by_QED">Proof_by_QED</a> </td>       <td align="center">800 </td>       <td align="center">1100 </td>       <td align="center">1500 </td>       <td align="center">1900 </td>       <td align="center">1600 </td>       <td align="center">2100 </td>       <td align="center">2300 </td>       <td align="right">2600 </td>     </tr>     <tr>       <td align="left"><a class="rated-user user-red" href="https://codeforces.com/profile/_istil" title="Grandmaster _istil">_istil</a> </td>       <td align="center">800 </td>       <td align="center">1100 </td>       <td align="center">1400 </td>       <td align="center">1800 </td>       <td align="center">1800 </td>       <td align="center">2100 </td>       <td align="center">2000 </td>       <td align="right">2500 </td>     </tr>     <tr>       <td align="left"><a class="rated-user user-orange" href="https://codeforces.com/profile/anango" title="International Master anango">anango</a> </td>       <td align="center">800 </td>       <td align="center">1100 </td>       <td align="center">1300 </td>       <td align="center">1900 </td>       <td align="center">1800 </td>       <td align="center">2200 </td>       <td align="center">2400 </td>       <td align="right">2700 </td>     </tr>     <tr>       <td align="left"><a class="rated-user user-orange" href="https://codeforces.com/profile/FzArK" title="Master FzArK">FzArK</a> </td>       <td align="center">800 </td>       <td align="center">1100 </td>       <td align="center">1400 </td>       <td align="center">1800 </td>       <td align="center">1900 </td>       <td align="center">¯\_(ツ)_/¯ </td>       <td align="center">2400 </td>       <td align="right">¯\_(ツ)_/¯ </td>     </tr>     <tr>       <td align="left"><a class="rated-user user-orange" href="https://codeforces.com/profile/Intellegent" title="International Master Intellegent">Intellegent</a> </td>       <td align="center">800 </td>       <td align="center">1000 </td>       <td align="center">1300 </td>       <td align="center">1900 </td>       <td align="center">1800 </td>       <td align="center">2300 </td>       <td align="center">2200 </td>       <td align="right">2800 </td>     </tr>     <tr>       <td align="left"><a class="rated-user user-red" href="https://codeforces.com/profile/nifeshe" title="Grandmaster nifeshe">nifeshe</a> </td>       <td align="center">800 </td>       <td align="center">1000 </td>       <td align="center">1200 </td>       <td align="center">1800 </td>       <td align="center">1800 </td>       <td align="center">2400 </td>       <td align="center">2500 </td>       <td align="right">2800 </td>     </tr>     <tr>       <td align="left"><a class="rated-user user-violet" href="https://codeforces.com/profile/satyam343" title="Candidate Master satyam343">satyam343</a> </td>       <td align="center">800 </td>       <td align="center">1000 </td>       <td align="center">1400 </td>       <td align="center">1900 </td>       <td align="center">1800 </td>       <td align="center">2400 </td>       <td align="center">2500 </td>       <td align="right">2700 </td>     </tr>     <tr>       <td align="left"><a class="rated-user user-orange" href="https://codeforces.com/profile/catgirl" title="Master catgirl">catgirl</a> </td>       <td align="center">800 </td>       <td align="center">1000 </td>       <td align="center">1300 </td>       <td align="center">1700 </td>       <td align="center">1500 </td>       <td align="center">2200 </td>       <td align="center">2200 </td>       <td align="right">2700 </td>     </tr>     <tr>       <td align="left"><a class="rated-user user-orange" href="https://codeforces.com/profile/wuhudsm" title="Master wuhudsm">wuhudsm</a> </td>       <td align="center">800 </td>       <td align="center">1100 </td>       <td align="center">1400 </td>       <td align="center">2000 </td>       <td align="center">1600 </td>       <td align="center">2200 </td>       <td align="center">¯\_(ツ)_/¯ </td>       <td align="right">¯\_(ツ)_/¯ </td>     </tr>     <tr>       <td align="left"><a class="rated-user user-violet" href="https://codeforces.com/profile/Edeeva" title="Candidate Master Edeeva">Edeeva</a> </td>       <td align="center">800 </td>       <td align="center">900 </td>       <td align="center">1100 </td>       <td align="center">1800 </td>       <td align="center">1700 </td>       <td align="center">2300 </td>       <td align="center">¯\_(ツ)_/¯ </td>       <td align="right">¯\_(ツ)_/¯ </td>     </tr>     <tr>       <td align="left">Actual rating </td>       <td align="center">800 </td>       <td align="center">1000 </td>       <td align="center">1400 </td>       <td align="center">2000 </td>       <td align="center">1900 </td>       <td align="center">2500 </td>       <td align="center">2700 </td>       <td align="right">3300 </td>     </tr>   </tbody> </table></div></div><p><a href="https://codeforces.com/contest/2154/problem/A" title="Codeforces Round 1060 (Div. 2)">2154A - Notelock</a>:</p> <div class="spoiler"><b class="spoiler-title">Hint 1</b><div class="spoiler-content" style="display: block;"><p>If there is a subarray containing <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-1-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1" style="width: 2.925em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.221em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1002.17em, 2.438em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2"><span class="mi" id="MathJax-Span-3" style="font-family: MathJax_Math-italic;">k</span><span class="mo" id="MathJax-Span-4" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mn" id="MathJax-Span-5" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.211em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-1">k - 1</script> zeros, then the next element cannot be prevented from being hit. So any time we see <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-2-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-6" style="width: 2.925em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.221em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1002.17em, 2.438em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-7"><span class="mi" id="MathJax-Span-8" style="font-family: MathJax_Math-italic;">k</span><span class="mo" id="MathJax-Span-9" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mn" id="MathJax-Span-10" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.211em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-2">k - 1</script> zeros follwed by a one then the one must be protected.</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><p>From Hint 1, lets protect every <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-3-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-11" style="width: 0.76em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.544em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.49em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-12"><span class="texatom" id="MathJax-Span-13"><span class="mrow" id="MathJax-Span-14"><span class="mn" id="MathJax-Span-15" style="font-family: MathJax_Typewriter;">1</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.932em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-3">\mathtt{1}</script> that fits the pattern. Furthermore we should always protect the first <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-4-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-16" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-17"><span class="mn" id="MathJax-Span-18" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-4">1</script> in the string so lets do that. It turns out that this is all that we need to do, to prove this think inductively: every element that is not protected will always have a <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-5-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-19" style="width: 0.76em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.544em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.49em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-20"><span class="texatom" id="MathJax-Span-21"><span class="mrow" id="MathJax-Span-22"><span class="mn" id="MathJax-Span-23" style="font-family: MathJax_Typewriter;">1</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.932em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-5">\mathtt{1}</script> in the last <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-6-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-24" style="width: 2.925em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.221em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1002.17em, 2.438em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-25"><span class="mi" id="MathJax-Span-26" style="font-family: MathJax_Math-italic;">k</span><span class="mo" id="MathJax-Span-27" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mn" id="MathJax-Span-28" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.211em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-6">k - 1</script> elements and so it will be unchanged. So to solve the problem we can check the distance between each consecutive <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-7-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-29" style="width: 0.76em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.544em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.49em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-30"><span class="texatom" id="MathJax-Span-31"><span class="mrow" id="MathJax-Span-32"><span class="mn" id="MathJax-Span-33" style="font-family: MathJax_Typewriter;">1</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.932em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-7">\mathtt{1}</script>, if the gap is at least <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-8-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-34" style="width: 0.76em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.544em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.54em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-35"><span class="mi" id="MathJax-Span-36" style="font-family: MathJax_Math-italic;">k</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-8">k</script> then add <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-9-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-37" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-38"><span class="mn" id="MathJax-Span-39" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-9">1</script> to the answer. Final time complexity <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-10-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-40" style="width: 2.871em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.167em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1002.06em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-41"><span class="mi" id="MathJax-Span-42" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-43" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-44" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-45" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-10">O(n)</script>.</p></div></div> <div class="spoiler"><b class="spoiler-title">Implementation(C++)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">typedef</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> ll</span><span class="pun">;</span><span class="pln">
</span><span class="com">#define</span><span class="pln"> debug</span><span class="pun">(</span><span class="pln">x</span><span class="pun">)</span><span class="pln"> cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="com">#x &lt;&lt; " = " &lt;&lt; x &lt;&lt; "\n";</span><span class="pln">
</span><span class="com">#define</span><span class="pln"> vdebug</span><span class="pun">(</span><span class="pln">a</span><span class="pun">)</span><span class="pln"> cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="com">#a &lt;&lt; " = "; for(auto x: a) cout &lt;&lt; x &lt;&lt; " "; cout &lt;&lt; "\n";</span><span class="pln">
mt19937 rng</span><span class="pun">(</span><span class="pln">chrono</span><span class="pun">::</span><span class="pln">steady_clock</span><span class="pun">::</span><span class="pln">now</span><span class="pun">().</span><span class="pln">time_since_epoch</span><span class="pun">().</span><span class="pln">count</span><span class="pun">());</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> uid</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> uniform_int_distribution</span><span class="str">&lt;int&gt;</span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">)(</span><span class="pln">rng</span><span class="pun">);</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
ll uld</span><span class="pun">(</span><span class="pln">ll a</span><span class="pun">,</span><span class="pln"> ll b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> uniform_int_distribution</span><span class="str">&lt;ll&gt;</span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">)(</span><span class="pln">rng</span><span class="pun">);</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

</span><span class="kwd">void</span><span class="pln"> solve</span><span class="pun">(){</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> k</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n </span><span class="pun">&gt;&gt;</span><span class="pln"> k</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">string</span><span class="pln"> s</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> s</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">int</span><span class="pln"> ans </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> </span><span class="kwd">last</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1e9</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++){</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">s</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'1'</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> i </span><span class="pun">-</span><span class="pln"> </span><span class="kwd">last</span><span class="pln"> </span><span class="pun">&gt;=</span><span class="pln"> k</span><span class="pun">)</span><span class="pln">
            ans</span><span class="pun">++;</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">s</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'1'</span><span class="pun">)</span><span class="pln">
            </span><span class="kwd">last</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> i</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    cout </span><span class="pun">&lt;&lt;</span><span class="pln"> ans </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"\n"</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">(){</span><span class="pln">
    ios</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="kwd">false</span><span class="pun">);</span><span class="pln">
    cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    
    </span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">t</span><span class="pun">--)</span><span class="pln"> solve</span><span class="pun">();</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span></code></pre></div></div> <div class="spoiler"><b class="spoiler-title">Implementation(Minecraft)</b><div class="spoiler-content" style="display: block;"><p><a href="https://youtu.be/5Xku9F6Rbqo">https://youtu.be/5Xku9F6Rbqo</a></p></div></div><p><a href="https://codeforces.com/contest/2154/problem/B" title="Codeforces Round 1060 (Div. 2)">2154B - Make it Zigzag</a>: </p> <div class="spoiler"><b class="spoiler-title">Hint 1</b><div class="spoiler-content" style="display: block;"><p>You want odd-indexed values to be small, and even-indexed values to be large. In other words, it is beneficial to apply operation 1 on even indices, and operation 2 on odd indices.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 2</b><div class="spoiler-content" style="display: block;"><p>Since operation 1 is free, you may as well apply it to every even index. None of the operations can increase a prefix max, so you can't possibly do any better than just applying operation 1 immediately to every even index.</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><p>Let's first apply operation 1 to every even index. Now, we can't further increase any even-indexed values, so we just need to decrease odd-indexed values by using operation 2. All of the odd indices are independent from one another, so let's just consider each one separately. For a fixed odd index <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-11-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-46" style="width: 0.436em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.327em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1000.27em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-47"><span class="mi" id="MathJax-Span-48" style="font-family: MathJax_Math-italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-11">i</script>, the number of instances of operation 2 needed to make it smaller than <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-12-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-49" style="width: 2.33em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.734em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1001.73em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-50"><span class="msubsup" id="MathJax-Span-51"><span style="display: inline-block; position: relative; width: 1.734em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-52" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="texatom" id="MathJax-Span-53"><span class="mrow" id="MathJax-Span-54"><span class="mi" id="MathJax-Span-55" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-56" style="font-size: 70.7%; font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-57" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-12">a_{i-1}</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-13-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-58" style="width: 2.33em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.734em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1001.73em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-59"><span class="msubsup" id="MathJax-Span-60"><span style="display: inline-block; position: relative; width: 1.734em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-61" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="texatom" id="MathJax-Span-62"><span class="mrow" id="MathJax-Span-63"><span class="mi" id="MathJax-Span-64" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-65" style="font-size: 70.7%; font-family: MathJax_Main;">+</span><span class="mn" id="MathJax-Span-66" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-13">a_{i+1}</script> is given by <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-14-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-67" style="width: 18.185em; display: inline-block;"><span style="display: inline-block; position: relative; width: 13.747em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1013.64em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-68"><span class="mo" id="MathJax-Span-69" style="font-family: MathJax_Main;">max</span><span class="mo" id="MathJax-Span-70" style="font-family: MathJax_Main;">(</span><span class="mn" id="MathJax-Span-71" style="font-family: MathJax_Main;">0</span><span class="mo" id="MathJax-Span-72" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-73" style="padding-left: 0.165em;"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-74" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-75" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-76" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mo" id="MathJax-Span-77" style="font-family: MathJax_Main; padding-left: 0.219em;">min</span><span class="mo" id="MathJax-Span-78" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-79"><span style="display: inline-block; position: relative; width: 1.734em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-80" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="texatom" id="MathJax-Span-81"><span class="mrow" id="MathJax-Span-82"><span class="mi" id="MathJax-Span-83" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-84" style="font-size: 70.7%; font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-85" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-86" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-87" style="padding-left: 0.165em;"><span style="display: inline-block; position: relative; width: 1.734em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-88" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="texatom" id="MathJax-Span-89"><span class="mrow" id="MathJax-Span-90"><span class="mi" id="MathJax-Span-91" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-92" style="font-size: 70.7%; font-family: MathJax_Main;">+</span><span class="mn" id="MathJax-Span-93" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-94" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-95" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-96" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-97" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-14">\max(0, a_i - \min(a_{i-1}, a_{i+1}) + 1)</script>. (Be careful with indices <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-15-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-98" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-99"><span class="mn" id="MathJax-Span-100" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-15">1</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-16-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-101" style="width: 0.814em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.6em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-102"><span class="mi" id="MathJax-Span-103" style="font-family: MathJax_Math-italic;">n</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-16">n</script> as well; you can treat the out of bounds values as being arbitrarily large, or just take care of them separately.) Now, we sum this value, across all odd indices <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-17-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-104" style="width: 0.436em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.327em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1000.27em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-105"><span class="mi" id="MathJax-Span-106" style="font-family: MathJax_Math-italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-17">i</script>.</p></div></div> <div class="spoiler"><b class="spoiler-title">Implementation(C++)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">typedef</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> ll</span><span class="pun">;</span><span class="pln">
</span><span class="com">#define</span><span class="pln"> debug</span><span class="pun">(</span><span class="pln">x</span><span class="pun">)</span><span class="pln"> cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="com">#x &lt;&lt; " = " &lt;&lt; x &lt;&lt; "\n";</span><span class="pln">
</span><span class="com">#define</span><span class="pln"> vdebug</span><span class="pun">(</span><span class="pln">a</span><span class="pun">)</span><span class="pln"> cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="com">#a &lt;&lt; " = "; for(auto x: a) cout &lt;&lt; x &lt;&lt; " "; cout &lt;&lt; "\n";</span><span class="pln">
mt19937 rng</span><span class="pun">(</span><span class="pln">chrono</span><span class="pun">::</span><span class="pln">steady_clock</span><span class="pun">::</span><span class="pln">now</span><span class="pun">().</span><span class="pln">time_since_epoch</span><span class="pun">().</span><span class="pln">count</span><span class="pun">());</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> uid</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> uniform_int_distribution</span><span class="str">&lt;int&gt;</span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">)(</span><span class="pln">rng</span><span class="pun">);</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
ll uld</span><span class="pun">(</span><span class="pln">ll a</span><span class="pun">,</span><span class="pln"> ll b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> uniform_int_distribution</span><span class="str">&lt;ll&gt;</span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">)(</span><span class="pln">rng</span><span class="pun">);</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

</span><span class="kwd">void</span><span class="pln"> solve</span><span class="pun">(){</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">

    vector</span><span class="str">&lt;int&gt;</span><span class="pln"> a</span><span class="pun">(</span><span class="pln">n</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">x </span><span class="pun">:</span><span class="pln"> a</span><span class="pun">)</span><span class="pln"> cin </span><span class="pun">&gt;&gt;</span><span class="pln"> x</span><span class="pun">;</span><span class="pln">

    vector</span><span class="str">&lt;int&gt;</span><span class="pln"> pre</span><span class="pun">(</span><span class="pln">n</span><span class="pun">);</span><span class="pln">
    pre</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">[</span><span class="lit">0</span><span class="pun">];</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
        pre</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> max</span><span class="pun">(</span><span class="pln">pre</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">],</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]);</span><span class="pln">

    ll ans </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">+=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">){</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> dif </span><span class="pun">=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln">
            dif </span><span class="pun">=</span><span class="pln"> max</span><span class="pun">(</span><span class="pln">dif</span><span class="pun">,</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> pre</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]);</span><span class="pln">

        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="pun">&lt;</span><span class="pln"> n </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">
            dif </span><span class="pun">=</span><span class="pln"> max</span><span class="pun">(</span><span class="pln">dif</span><span class="pun">,</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> pre</span><span class="pun">[</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]);</span><span class="pln">

        ans </span><span class="pun">+=</span><span class="pln"> dif </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    cout </span><span class="pun">&lt;&lt;</span><span class="pln"> ans </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"\n"</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">(){</span><span class="pln">
    ios</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="kwd">false</span><span class="pun">);</span><span class="pln">
    cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    
    </span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">t</span><span class="pun">--)</span><span class="pln"> solve</span><span class="pun">();</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2154/problem/C1" title="Codeforces Round 1060 (Div. 2)">2154C1 - No Cost Too Great (Easy Version)</a>: </p> <div class="spoiler"><b class="spoiler-title">Hint 1</b><div class="spoiler-content" style="display: block;"><p>You can make an element divisible by <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-18-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-107" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-108"><span class="mn" id="MathJax-Span-109" style="font-family: MathJax_Main;">2</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-18">2</script> in <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-19-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-110" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-111"><span class="mn" id="MathJax-Span-112" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-19">1</script> move.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 2</b><div class="spoiler-content" style="display: block;"><p>Can you check if the answer is <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-20-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-113" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-114"><span class="mn" id="MathJax-Span-115" style="font-family: MathJax_Main;">0</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-20">0</script> or if the answer is <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-21-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-116" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-117"><span class="mn" id="MathJax-Span-118" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-21">1</script>?</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><p>By result of Hint 1, the answer cannot be more than <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-22-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-119" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-120"><span class="mn" id="MathJax-Span-121" style="font-family: MathJax_Main;">2</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-22">2</script>, as we can always pick two elements and make them both divisible by <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-23-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-122" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-123"><span class="mn" id="MathJax-Span-124" style="font-family: MathJax_Main;">2</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-23">2</script> using at most <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-24-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-125" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-126"><span class="mn" id="MathJax-Span-127" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-24">1</script> move on each. So now we just need to check if the answer is <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-25-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-128" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-129"><span class="mn" id="MathJax-Span-130" style="font-family: MathJax_Main;">0</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-25">0</script> or <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-26-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-131" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-132"><span class="mn" id="MathJax-Span-133" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-26">1</script>.</p><p>To check if the answer is <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-27-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-134" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-135"><span class="mn" id="MathJax-Span-136" style="font-family: MathJax_Main;">0</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-27">0</script>, we need to determine if there is a common divisor between two elements. Note that it is sufficient to only check if there is a common prime divisor. So, for each element, iterate through all its prime divisors and check if there is another element with the same prime divisor.</p><p>To check if the answer is <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-28-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-137" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-138"><span class="mn" id="MathJax-Span-139" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-28">1</script>, we can do the same as <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-29-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-140" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-141"><span class="mn" id="MathJax-Span-142" style="font-family: MathJax_Main;">0</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-29">0</script>. This time, for each <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-30-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-143" style="width: 0.436em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.327em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1000.27em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-144"><span class="mi" id="MathJax-Span-145" style="font-family: MathJax_Math-italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-30">i</script> we check if <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-31-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-146" style="width: 3.466em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.6em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1002.55em, 2.492em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-147"><span class="msubsup" id="MathJax-Span-148"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-149" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-150" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-151" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-152" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 1.218em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-31">a_i + 1</script> shares a common prime divisor with another element.</p><p>Prime divisors can be pre-calculated with the Sieve of Eratosthenes in <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-32-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-153" style="width: 8.498em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.442em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1006.33em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-154"><span class="mi" id="MathJax-Span-155" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-156" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-157" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.111em;"></span></span><span class="mi" id="MathJax-Span-158" style="font-family: MathJax_Main; padding-left: 0.165em;">log</span><span class="mo" id="MathJax-Span-159"></span><span class="mi" id="MathJax-Span-160" style="font-family: MathJax_Main; padding-left: 0.165em;">log</span><span class="mo" id="MathJax-Span-161"></span><span class="mi" id="MathJax-Span-162" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.111em;"></span></span><span class="mo" id="MathJax-Span-163" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-32">O(N\log\log N)</script> where <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-33-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-164" style="width: 1.247em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.92em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-165"><span class="mi" id="MathJax-Span-166" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.111em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-33">N</script> is the maximum possible element (so <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-34-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-167" style="width: 3.52em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.654em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.139em, 1002.65em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-168"><span class="mn" id="MathJax-Span-169" style="font-family: MathJax_Main;">2</span><span class="mo" id="MathJax-Span-170" style="font-family: MathJax_Main; padding-left: 0.219em;">⋅</span><span class="msubsup" id="MathJax-Span-171" style="padding-left: 0.219em;"><span style="display: inline-block; position: relative; width: 1.41em; height: 0px;"><span style="position: absolute; clip: rect(3.195em, 1000.98em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mn" id="MathJax-Span-172" style="font-family: MathJax_Main;">10</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -4.38em; left: 0.977em;"><span class="mn" id="MathJax-Span-173" style="font-size: 70.7%; font-family: MathJax_Main;">5</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-34">2 \cdot 10^5</script> for this problem). However, the constraints are lenient enough to allow <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-35-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-174" style="width: 5.143em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.899em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.139em, 1003.79em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-175"><span class="mi" id="MathJax-Span-176" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-177" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-178" style="font-family: MathJax_Math-italic;">n</span><span class="msqrt" id="MathJax-Span-179"><span style="display: inline-block; position: relative; width: 1.734em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.87em, 4.169em, -999.997em); top: -4.002em; left: 0.814em;"><span class="mrow" id="MathJax-Span-180"><span class="mi" id="MathJax-Span-181" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.111em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; clip: rect(3.574em, 1000.92em, 3.953em, -999.997em); top: -4.543em; left: 0.814em;"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -4.002em; left: -0.106em;">−<span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -4.002em; left: 0.219em;">−<span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; clip: rect(3.033em, 1000.87em, 4.386em, -999.997em); top: -4.056em; left: 0em;"><span style="font-family: MathJax_Main;">√</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-182" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.575em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-35">O(n\sqrt{N})</script> as well.</p><p>The final complexity comes out to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-36-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-183" style="width: 13.964em; display: inline-block;"><span style="display: inline-block; position: relative; width: 10.555em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1010.45em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-184"><span class="mi" id="MathJax-Span-185" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-186" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-187" style="font-family: MathJax_Math-italic;">n</span><span class="mi" id="MathJax-Span-188" style="font-family: MathJax_Math-italic;">ω</span><span class="mo" id="MathJax-Span-189" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-190" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.111em;"></span></span><span class="mo" id="MathJax-Span-191" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-192" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mi" id="MathJax-Span-193" style="font-family: MathJax_Math-italic; padding-left: 0.219em;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.111em;"></span></span><span class="mi" id="MathJax-Span-194" style="font-family: MathJax_Main; padding-left: 0.165em;">log</span><span class="mo" id="MathJax-Span-195"></span><span class="mi" id="MathJax-Span-196" style="font-family: MathJax_Main; padding-left: 0.165em;">log</span><span class="mo" id="MathJax-Span-197"></span><span class="mi" id="MathJax-Span-198" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.111em;"></span></span><span class="mo" id="MathJax-Span-199" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-36">O(n\omega(N) + N\log\log N)</script>, where <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-37-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-200" style="width: 2.6em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.951em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1001.84em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-201"><span class="mi" id="MathJax-Span-202" style="font-family: MathJax_Math-italic;">ω</span><span class="mo" id="MathJax-Span-203" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-204" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-205" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-37">\omega(x)</script> is used to denote the number of distinct prime divisors of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-38-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-206" style="width: 0.814em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.54em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-207"><span class="mi" id="MathJax-Span-208" style="font-family: MathJax_Math-italic;">x</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-38">x</script>. Note that the editorial implementation is <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-39-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-209" style="width: 20.728em; display: inline-block;"><span style="display: inline-block; position: relative; width: 15.695em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1015.59em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-210"><span class="mi" id="MathJax-Span-211" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-212" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-213" style="font-family: MathJax_Math-italic;">n</span><span class="mi" id="MathJax-Span-214" style="font-family: MathJax_Math-italic;">ω</span><span class="mo" id="MathJax-Span-215" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-216" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.111em;"></span></span><span class="mo" id="MathJax-Span-217" style="font-family: MathJax_Main;">)</span><span class="mi" id="MathJax-Span-218" style="font-family: MathJax_Main; padding-left: 0.165em;">log</span><span class="mo" id="MathJax-Span-219"></span><span class="mo" id="MathJax-Span-220" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-221" style="font-family: MathJax_Math-italic;">n</span><span class="mi" id="MathJax-Span-222" style="font-family: MathJax_Math-italic;">ω</span><span class="mo" id="MathJax-Span-223" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-224" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.111em;"></span></span><span class="mo" id="MathJax-Span-225" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-226" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-227" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mi" id="MathJax-Span-228" style="font-family: MathJax_Math-italic; padding-left: 0.219em;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.111em;"></span></span><span class="mi" id="MathJax-Span-229" style="font-family: MathJax_Main; padding-left: 0.165em;">log</span><span class="mo" id="MathJax-Span-230"></span><span class="mi" id="MathJax-Span-231" style="font-family: MathJax_Main; padding-left: 0.165em;">log</span><span class="mo" id="MathJax-Span-232"></span><span class="mi" id="MathJax-Span-233" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.111em;"></span></span><span class="mo" id="MathJax-Span-234" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-39">O(n\omega(N)\log(n\omega(N)) + N\log\log N)</script> due to use of c++ std::map for the sake of readability.</p></div></div> <div class="spoiler"><b class="spoiler-title">Implementation(C++)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">typedef</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> ll</span><span class="pun">;</span><span class="pln">
</span><span class="com">#define</span><span class="pln"> debug</span><span class="pun">(</span><span class="pln">x</span><span class="pun">)</span><span class="pln"> cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="com">#x &lt;&lt; " = " &lt;&lt; x &lt;&lt; "\n";</span><span class="pln">
</span><span class="com">#define</span><span class="pln"> vdebug</span><span class="pun">(</span><span class="pln">a</span><span class="pun">)</span><span class="pln"> cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="com">#a &lt;&lt; " = "; for(auto x: a) cout &lt;&lt; x &lt;&lt; " "; cout &lt;&lt; "\n";</span><span class="pln">
mt19937 rng</span><span class="pun">(</span><span class="pln">chrono</span><span class="pun">::</span><span class="pln">steady_clock</span><span class="pun">::</span><span class="pln">now</span><span class="pun">().</span><span class="pln">time_since_epoch</span><span class="pun">().</span><span class="pln">count</span><span class="pun">());</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> uid</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> uniform_int_distribution</span><span class="str">&lt;int&gt;</span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">)(</span><span class="pln">rng</span><span class="pun">);</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
ll uld</span><span class="pun">(</span><span class="pln">ll a</span><span class="pun">,</span><span class="pln"> ll b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> uniform_int_distribution</span><span class="str">&lt;ll&gt;</span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">)(</span><span class="pln">rng</span><span class="pun">);</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> N </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2e5</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">10</span><span class="pun">;</span><span class="pln">
vector</span><span class="pun">&lt;</span><span class="pln">vector</span><span class="str">&lt;int&gt;</span><span class="pun">&gt;</span><span class="pln"> pfac</span><span class="pun">(</span><span class="pln">N </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">

</span><span class="kwd">void</span><span class="pln"> solve</span><span class="pun">(){</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">

    vector</span><span class="str">&lt;int&gt;</span><span class="pln"> a</span><span class="pun">(</span><span class="pln">n</span><span class="pun">),</span><span class="pln"> b</span><span class="pun">(</span><span class="pln">n</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">x </span><span class="pun">:</span><span class="pln"> a</span><span class="pun">)</span><span class="pln"> cin </span><span class="pun">&gt;&gt;</span><span class="pln"> x</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">x </span><span class="pun">:</span><span class="pln"> b</span><span class="pun">)</span><span class="pln"> cin </span><span class="pun">&gt;&gt;</span><span class="pln"> x</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">int</span><span class="pln"> ans </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln">
    map</span><span class="pun">&lt;</span><span class="kwd">int</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">&gt;</span><span class="pln"> cnt</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++){</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x </span><span class="pun">:</span><span class="pln"> pfac</span><span class="pun">[</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]]){</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">cnt</span><span class="pun">[</span><span class="pln">x</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln">
                ans </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
            cnt</span><span class="pun">[</span><span class="pln">x</span><span class="pun">]++;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++){</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x </span><span class="pun">:</span><span class="pln"> pfac</span><span class="pun">[</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]])</span><span class="pln">
            cnt</span><span class="pun">[</span><span class="pln">x</span><span class="pun">]--;</span><span class="pln">

        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x </span><span class="pun">:</span><span class="pln"> pfac</span><span class="pun">[</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]){</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">cnt</span><span class="pun">[</span><span class="pln">x</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln">
                ans</span><span class="pun">=</span><span class="pln"> min</span><span class="pun">(</span><span class="pln">ans</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">

        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x </span><span class="pun">:</span><span class="pln"> pfac</span><span class="pun">[</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]])</span><span class="pln">
            cnt</span><span class="pun">[</span><span class="pln">x</span><span class="pun">]++;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    cout </span><span class="pun">&lt;&lt;</span><span class="pln"> ans </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"\n"</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">(){</span><span class="pln">
    ios</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="kwd">false</span><span class="pun">);</span><span class="pln">
    cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">

    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> N</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++){</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">pfac</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">empty</span><span class="pun">())</span><span class="pln">
            </span><span class="kwd">continue</span><span class="pun">;</span><span class="pln">

        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> i</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;=</span><span class="pln"> N</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">+=</span><span class="pln"> i</span><span class="pun">)</span><span class="pln">
            pfac</span><span class="pun">[</span><span class="pln">j</span><span class="pun">].</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">i</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    
    </span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">t</span><span class="pun">--)</span><span class="pln"> solve</span><span class="pun">();</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2154/problem/C2" title="Codeforces Round 1060 (Div. 2)">2154C2 - No Cost Too Great (Hard Version)</a>: </p> <div class="spoiler"><b class="spoiler-title">Hint 1</b><div class="spoiler-content" style="display: block;"><p>Solve the easy version.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 2</b><div class="spoiler-content" style="display: block;"><p>We can always make two elements <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-40-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-235" style="width: 1.572em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.193em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1001.19em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-236"><span class="mi" id="MathJax-Span-237" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-238" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-239" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">j</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-40">i, j</script> divisible by <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-41-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-240" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-241"><span class="mn" id="MathJax-Span-242" style="font-family: MathJax_Main;">2</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-41">2</script> with no more than <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-42-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-243" style="width: 3.736em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.817em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1002.82em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-244"><span class="msubsup" id="MathJax-Span-245"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-246" style="font-family: MathJax_Math-italic;">b</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-247" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-248" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="msubsup" id="MathJax-Span-249" style="padding-left: 0.219em;"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-250" style="font-family: MathJax_Math-italic;">b</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-251" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-42">b_i + b_j</script> cost.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 3</b><div class="spoiler-content" style="display: block;"><p>By hint 2, we should never perform more than one operation on more than one element.</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><p>Lets say we are trying to make the elements at index <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-43-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-252" style="width: 1.572em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.193em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1001.19em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-253"><span class="mi" id="MathJax-Span-254" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-255" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-256" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">j</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-43">i, j</script> have a common divisor. From hint 2 and 3 there are only two cases to consider here. The first case where we make <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-44-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-257" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-258"><span class="mn" id="MathJax-Span-259" style="font-family: MathJax_Main;">0</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-44">0</script> or <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-45-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-260" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-261"><span class="mn" id="MathJax-Span-262" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-45">1</script> operation on both <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-46-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-263" style="width: 0.436em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.327em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1000.27em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-264"><span class="mi" id="MathJax-Span-265" style="font-family: MathJax_Math-italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-46">i</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-47-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-266" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.436em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1000.44em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-267"><span class="mi" id="MathJax-Span-268" style="font-family: MathJax_Math-italic;">j</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-47">j</script>. Or the second case where we make more than <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-48-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-269" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-270"><span class="mn" id="MathJax-Span-271" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-48">1</script> operation on a single element. We should never do more than <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-49-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-272" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-273"><span class="mn" id="MathJax-Span-274" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-49">1</script> operation on both elements because we can always do better by making both elements divisible by <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-50-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-275" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-276"><span class="mn" id="MathJax-Span-277" style="font-family: MathJax_Main;">2</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-50">2</script>.</p><p>So now to solve the problem on the entire array, we should try to solve both of the cases. For convenience lets reorder the elements so that <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-51-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-278" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.436em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.44em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-279"><span class="mi" id="MathJax-Span-280" style="font-family: MathJax_Math-italic;">b</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-51">b</script> is in sorted order.</p><p>The first case can be solve almost identically to the easy version of the problem. We can always do at least as good as <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-52-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-281" style="width: 3.953em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.979em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1002.98em, 2.492em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-282"><span class="msubsup" id="MathJax-Span-283"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-284" style="font-family: MathJax_Math-italic;">b</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mn" id="MathJax-Span-285" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-286" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="msubsup" id="MathJax-Span-287" style="padding-left: 0.219em;"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-288" style="font-family: MathJax_Math-italic;">b</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mn" id="MathJax-Span-289" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-52">b_1 + b_2</script>, the only other possibility is only making one operation. To do this we just check if <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-53-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-290" style="width: 3.466em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.6em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1002.55em, 2.492em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-291"><span class="msubsup" id="MathJax-Span-292"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-293" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-294" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-295" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-296" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 1.218em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-53">a_i + 1</script> has a common prime divisor with another element.</p><p>The second case is the more tricky case, we need to check the optimal way to make more than one operations for each element, and it is probably the crux of the problem. The key thing to notice is that we actually do not need to check every element, in fact we can only check the element with the smallest value of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-54-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-297" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.76em, 2.438em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-298"><span class="msubsup" id="MathJax-Span-299"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-300" style="font-family: MathJax_Math-italic;">b</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-301" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-54">b_i</script> (<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-55-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-302" style="width: 1.139em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.87em, 2.438em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-303"><span class="msubsup" id="MathJax-Span-304"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-305" style="font-family: MathJax_Math-italic;">b</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mn" id="MathJax-Span-306" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-55">b_1</script> because <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-56-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-307" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.436em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.44em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-308"><span class="mi" id="MathJax-Span-309" style="font-family: MathJax_Math-italic;">b</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-56">b</script> is sorted). To prove this lets argue by contradiction, supposed we made <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-57-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-310" style="width: 0.76em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.544em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.54em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-311"><span class="mi" id="MathJax-Span-312" style="font-family: MathJax_Math-italic;">k</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-57">k</script> (<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-58-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-313" style="width: 3.087em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.33em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1002.27em, 2.492em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-314"><span class="mi" id="MathJax-Span-315" style="font-family: MathJax_Math-italic;">k</span><span class="mo" id="MathJax-Span-316" style="font-family: MathJax_Main; padding-left: 0.273em;">≥</span><span class="mn" id="MathJax-Span-317" style="font-family: MathJax_Main; padding-left: 0.273em;">2</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 1.218em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-58">k \ge 2</script>) operations on element <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-59-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-318" style="width: 0.814em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.54em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-319"><span class="mi" id="MathJax-Span-320" style="font-family: MathJax_Math-italic;">x</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-59">x</script> (<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-60-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-321" style="width: 3.141em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.384em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1002.33em, 2.492em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-322"><span class="mi" id="MathJax-Span-323" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-324" style="font-family: MathJax_Main; padding-left: 0.273em;">≥</span><span class="mn" id="MathJax-Span-325" style="font-family: MathJax_Main; padding-left: 0.273em;">2</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 1.218em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-60">x \ge 2</script>). The total cost of this is <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-61-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-326" style="width: 2.871em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.167em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1002.17em, 2.492em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-327"><span class="mi" id="MathJax-Span-328" style="font-family: MathJax_Math-italic;">k</span><span class="mo" id="MathJax-Span-329" style="font-family: MathJax_Main; padding-left: 0.219em;">⋅</span><span class="msubsup" id="MathJax-Span-330" style="padding-left: 0.219em;"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-331" style="font-family: MathJax_Math-italic;">b</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-332" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-61">k \cdot b_x</script>, we know from hint 2 that we can do <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-62-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-333" style="width: 4.007em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.033em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1003.03em, 2.492em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-334"><span class="msubsup" id="MathJax-Span-335"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-336" style="font-family: MathJax_Math-italic;">b</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mn" id="MathJax-Span-337" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-338" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="msubsup" id="MathJax-Span-339" style="padding-left: 0.219em;"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-340" style="font-family: MathJax_Math-italic;">b</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-341" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-62">b_1 + b_x</script> or better, since <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-63-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-342" style="width: 1.139em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.87em, 2.438em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-343"><span class="msubsup" id="MathJax-Span-344"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-345" style="font-family: MathJax_Math-italic;">b</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mn" id="MathJax-Span-346" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-63">b_1</script> is the smallest element we know that <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-64-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-347" style="width: 8.607em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.496em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1006.5em, 2.492em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-348"><span class="msubsup" id="MathJax-Span-349"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-350" style="font-family: MathJax_Math-italic;">b</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mn" id="MathJax-Span-351" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-352" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="msubsup" id="MathJax-Span-353" style="padding-left: 0.219em;"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-354" style="font-family: MathJax_Math-italic;">b</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-355" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-356" style="font-family: MathJax_Main; padding-left: 0.273em;">≤</span><span class="mi" id="MathJax-Span-357" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">k</span><span class="mo" id="MathJax-Span-358" style="font-family: MathJax_Main; padding-left: 0.219em;">⋅</span><span class="msubsup" id="MathJax-Span-359" style="padding-left: 0.219em;"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-360" style="font-family: MathJax_Math-italic;">b</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-361" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-64">b_1 + b_x \le k \cdot b_x</script> and thus we do not need to consider this case!</p><p>So now we need to quickly check what is the optimal way to use multiple operations on the first element. To do this we can iterate through all the prime divisors of the other elements and determine the minimum number of operations to make <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-65-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-362" style="width: 1.301em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.977em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.98em, 2.438em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-363"><span class="msubsup" id="MathJax-Span-364"><span style="display: inline-block; position: relative; width: 0.977em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-365" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mn" id="MathJax-Span-366" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 0.932em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-65">a_1</script> divisible by it.</p><p>The final time complexity comes out to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-66-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-367" style="width: 13.964em; display: inline-block;"><span style="display: inline-block; position: relative; width: 10.555em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1010.45em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-368"><span class="mi" id="MathJax-Span-369" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-370" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-371" style="font-family: MathJax_Math-italic;">n</span><span class="mi" id="MathJax-Span-372" style="font-family: MathJax_Math-italic;">ω</span><span class="mo" id="MathJax-Span-373" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-374" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.111em;"></span></span><span class="mo" id="MathJax-Span-375" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-376" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mi" id="MathJax-Span-377" style="font-family: MathJax_Math-italic; padding-left: 0.219em;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.111em;"></span></span><span class="mi" id="MathJax-Span-378" style="font-family: MathJax_Main; padding-left: 0.165em;">log</span><span class="mo" id="MathJax-Span-379"></span><span class="mi" id="MathJax-Span-380" style="font-family: MathJax_Main; padding-left: 0.165em;">log</span><span class="mo" id="MathJax-Span-381"></span><span class="mi" id="MathJax-Span-382" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.111em;"></span></span><span class="mo" id="MathJax-Span-383" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-66">O(n\omega(N) + N\log\log N)</script>, where <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-67-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-384" style="width: 2.6em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.951em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1001.84em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-385"><span class="mi" id="MathJax-Span-386" style="font-family: MathJax_Math-italic;">ω</span><span class="mo" id="MathJax-Span-387" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-388" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-389" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-67">\omega(x)</script> is used to denote the number of distinct prime divisors of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-68-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-390" style="width: 0.814em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.54em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-391"><span class="mi" id="MathJax-Span-392" style="font-family: MathJax_Math-italic;">x</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-68">x</script>. Note that the editorial implementation is <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-69-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-393" style="width: 20.728em; display: inline-block;"><span style="display: inline-block; position: relative; width: 15.695em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1015.59em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-394"><span class="mi" id="MathJax-Span-395" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-396" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-397" style="font-family: MathJax_Math-italic;">n</span><span class="mi" id="MathJax-Span-398" style="font-family: MathJax_Math-italic;">ω</span><span class="mo" id="MathJax-Span-399" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-400" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.111em;"></span></span><span class="mo" id="MathJax-Span-401" style="font-family: MathJax_Main;">)</span><span class="mi" id="MathJax-Span-402" style="font-family: MathJax_Main; padding-left: 0.165em;">log</span><span class="mo" id="MathJax-Span-403"></span><span class="mo" id="MathJax-Span-404" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-405" style="font-family: MathJax_Math-italic;">n</span><span class="mi" id="MathJax-Span-406" style="font-family: MathJax_Math-italic;">ω</span><span class="mo" id="MathJax-Span-407" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-408" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.111em;"></span></span><span class="mo" id="MathJax-Span-409" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-410" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-411" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mi" id="MathJax-Span-412" style="font-family: MathJax_Math-italic; padding-left: 0.219em;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.111em;"></span></span><span class="mi" id="MathJax-Span-413" style="font-family: MathJax_Main; padding-left: 0.165em;">log</span><span class="mo" id="MathJax-Span-414"></span><span class="mi" id="MathJax-Span-415" style="font-family: MathJax_Main; padding-left: 0.165em;">log</span><span class="mo" id="MathJax-Span-416"></span><span class="mi" id="MathJax-Span-417" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.111em;"></span></span><span class="mo" id="MathJax-Span-418" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-69">O(n\omega(N)\log(n\omega(N)) + N\log\log N)</script> due to use of c++ std::map for the sake of readability.</p></div></div> <div class="spoiler"><b class="spoiler-title">Implementation(C++)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">typedef</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> ll</span><span class="pun">;</span><span class="pln">
</span><span class="com">#define</span><span class="pln"> debug</span><span class="pun">(</span><span class="pln">x</span><span class="pun">)</span><span class="pln"> cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="com">#x &lt;&lt; " = " &lt;&lt; x &lt;&lt; "\n";</span><span class="pln">
</span><span class="com">#define</span><span class="pln"> vdebug</span><span class="pun">(</span><span class="pln">a</span><span class="pun">)</span><span class="pln"> cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="com">#a &lt;&lt; " = "; for(auto x: a) cout &lt;&lt; x &lt;&lt; " "; cout &lt;&lt; "\n";</span><span class="pln">
mt19937 rng</span><span class="pun">(</span><span class="pln">chrono</span><span class="pun">::</span><span class="pln">steady_clock</span><span class="pun">::</span><span class="pln">now</span><span class="pun">().</span><span class="pln">time_since_epoch</span><span class="pun">().</span><span class="pln">count</span><span class="pun">());</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> uid</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> uniform_int_distribution</span><span class="str">&lt;int&gt;</span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">)(</span><span class="pln">rng</span><span class="pun">);</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
ll uld</span><span class="pun">(</span><span class="pln">ll a</span><span class="pun">,</span><span class="pln"> ll b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> uniform_int_distribution</span><span class="str">&lt;ll&gt;</span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">)(</span><span class="pln">rng</span><span class="pun">);</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> N </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2e5</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">10</span><span class="pun">;</span><span class="pln">
vector</span><span class="pun">&lt;</span><span class="pln">vector</span><span class="str">&lt;int&gt;</span><span class="pun">&gt;</span><span class="pln"> pfac</span><span class="pun">(</span><span class="pln">N </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">

</span><span class="kwd">void</span><span class="pln"> solve</span><span class="pun">(){</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">

    vector</span><span class="str">&lt;int&gt;</span><span class="pln"> a</span><span class="pun">(</span><span class="pln">n</span><span class="pun">),</span><span class="pln"> b</span><span class="pun">(</span><span class="pln">n</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">x </span><span class="pun">:</span><span class="pln"> a</span><span class="pun">)</span><span class="pln"> cin </span><span class="pun">&gt;&gt;</span><span class="pln"> x</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">x </span><span class="pun">:</span><span class="pln"> b</span><span class="pun">)</span><span class="pln"> cin </span><span class="pun">&gt;&gt;</span><span class="pln"> x</span><span class="pun">;</span><span class="pln">

    vector</span><span class="str">&lt;int&gt;</span><span class="pln"> ord</span><span class="pun">(</span><span class="pln">n</span><span class="pun">);</span><span class="pln">
    iota</span><span class="pun">(</span><span class="pln">ord</span><span class="pun">.</span><span class="kwd">begin</span><span class="pun">(),</span><span class="pln"> ord</span><span class="pun">.</span><span class="kwd">end</span><span class="pun">(),</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    sort</span><span class="pun">(</span><span class="pln">ord</span><span class="pun">.</span><span class="kwd">begin</span><span class="pun">(),</span><span class="pln"> ord</span><span class="pun">.</span><span class="kwd">end</span><span class="pun">(),</span><span class="pln"> </span><span class="pun">[&amp;](</span><span class="kwd">int</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> y</span><span class="pun">)</span><span class="pln"> </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="kwd">bool</span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">x</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">y</span><span class="pun">];</span><span class="pln">
    </span><span class="pun">});</span><span class="pln">

    </span><span class="kwd">int</span><span class="pln"> ans </span><span class="pun">=</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">ord</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">ord</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]];</span><span class="pln">
    map</span><span class="pun">&lt;</span><span class="kwd">int</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">&gt;</span><span class="pln"> cnt</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++){</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x </span><span class="pun">:</span><span class="pln"> pfac</span><span class="pun">[</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]]){</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">cnt</span><span class="pun">[</span><span class="pln">x</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln">
                ans </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
            cnt</span><span class="pun">[</span><span class="pln">x</span><span class="pun">]++;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++){</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x </span><span class="pun">:</span><span class="pln"> pfac</span><span class="pun">[</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]])</span><span class="pln">
            cnt</span><span class="pun">[</span><span class="pln">x</span><span class="pun">]--;</span><span class="pln">

        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x </span><span class="pun">:</span><span class="pln"> pfac</span><span class="pun">[</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]){</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">cnt</span><span class="pun">[</span><span class="pln">x</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln">
                ans</span><span class="pun">=</span><span class="pln"> min</span><span class="pun">(</span><span class="pln">ans</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">

        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x </span><span class="pun">:</span><span class="pln"> pfac</span><span class="pun">[</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]])</span><span class="pln">
            cnt</span><span class="pun">[</span><span class="pln">x</span><span class="pun">]++;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">int</span><span class="pln"> idx </span><span class="pun">=</span><span class="pln"> ord</span><span class="pun">[</span><span class="lit">0</span><span class="pun">];</span><span class="pln">
    vector</span><span class="str">&lt;int&gt;</span><span class="pln"> check</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++){</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="pun">==</span><span class="pln"> idx</span><span class="pun">)</span><span class="pln">
            </span><span class="kwd">continue</span><span class="pun">;</span><span class="pln">

        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x </span><span class="pun">:</span><span class="pln"> pfac</span><span class="pun">[</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]])</span><span class="pln">
            check</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">x</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x </span><span class="pun">:</span><span class="pln"> check</span><span class="pun">){</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> times </span><span class="pun">=</span><span class="pln"> x </span><span class="pun">-</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">idx</span><span class="pun">]</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> x</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">times </span><span class="pun">==</span><span class="pln"> x</span><span class="pun">)</span><span class="pln">
            times </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">

        ans </span><span class="pun">=</span><span class="pln"> min</span><span class="pun">(</span><span class="lit">1LL</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> ans</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1LL</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> times </span><span class="pun">*</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">idx</span><span class="pun">]);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    cout </span><span class="pun">&lt;&lt;</span><span class="pln"> ans </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"\n"</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">(){</span><span class="pln">
    ios</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="kwd">false</span><span class="pun">);</span><span class="pln">
    cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">

    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> N</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++){</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">pfac</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">empty</span><span class="pun">())</span><span class="pln">
            </span><span class="kwd">continue</span><span class="pun">;</span><span class="pln">

        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> i</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;=</span><span class="pln"> N</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">+=</span><span class="pln"> i</span><span class="pun">)</span><span class="pln">
            pfac</span><span class="pun">[</span><span class="pln">j</span><span class="pun">].</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">i</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    
    </span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">t</span><span class="pun">--)</span><span class="pln"> solve</span><span class="pun">();</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2154/problem/D" title="Codeforces Round 1060 (Div. 2)">2154D - Catshock</a>: </p> <div class="spoiler"><b class="spoiler-title">Hint 1</b><div class="spoiler-content" style="display: block;"><p>Destroying a leaf will never split the tree.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 2</b><div class="spoiler-content" style="display: block;"><p>Trees are bipartite. In particular, you can root the tree arbitrarily, then partition vertices into those with even depth and those with odd depth. All edges connect an even depth vertex to an odd depth vertex.</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><p>We would like to decrease the size of the tree by one vertex using no more than three moves. To do so, we will pick an arbitrary leaf <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-70-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-419" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.49em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-420"><span class="mi" id="MathJax-Span-421" style="font-family: MathJax_Math-italic;">v</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-70">v</script> and destroy it. However, we must make sure that we do not destroy the vertex we are standing on, and that we do not have two consecutive instances of the second instruction. To do so, let's root the tree arbitrarily, and color vertices with even depth red and vertices with odd depth blue. We maintain the color of the vertex we are standing on, noting that every instance of instruction 1 flips the color. Now, if we are standing on the same color as <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-71-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-422" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.49em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-423"><span class="mi" id="MathJax-Span-424" style="font-family: MathJax_Math-italic;">v</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-71">v</script>, we apply operation 1 once. Otherwise, we apply operation 1 twice. Thus, we are not currently standing on leaf <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-72-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-425" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.49em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-426"><span class="mi" id="MathJax-Span-427" style="font-family: MathJax_Math-italic;">v</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-72">v</script>, so now we can destroy <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-73-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-428" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.49em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-429"><span class="mi" id="MathJax-Span-430" style="font-family: MathJax_Math-italic;">v</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-73">v</script>. Since we applied at least one instance of instruction 1, we do not have two consecutive instances of instruction 2. By iterating this process until the only remaining vertex is vertex <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-74-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-431" style="width: 0.814em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.6em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-432"><span class="mi" id="MathJax-Span-433" style="font-family: MathJax_Math-italic;">n</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-74">n</script>, we guarantee that we have reached vertex <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-75-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-434" style="width: 0.814em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.6em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-435"><span class="mi" id="MathJax-Span-436" style="font-family: MathJax_Math-italic;">n</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-75">n</script>.</p></div></div> <div class="spoiler"><b class="spoiler-title">Implementation(C++)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">typedef</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> ll</span><span class="pun">;</span><span class="pln">
</span><span class="com">#define</span><span class="pln"> debug</span><span class="pun">(</span><span class="pln">x</span><span class="pun">)</span><span class="pln"> cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="com">#x &lt;&lt; " = " &lt;&lt; x &lt;&lt; "\n";</span><span class="pln">
</span><span class="com">#define</span><span class="pln"> vdebug</span><span class="pun">(</span><span class="pln">a</span><span class="pun">)</span><span class="pln"> cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="com">#a &lt;&lt; " = "; for(auto x: a) cout &lt;&lt; x &lt;&lt; " "; cout &lt;&lt; "\n";</span><span class="pln">
mt19937 rng</span><span class="pun">(</span><span class="pln">chrono</span><span class="pun">::</span><span class="pln">steady_clock</span><span class="pun">::</span><span class="pln">now</span><span class="pun">().</span><span class="pln">time_since_epoch</span><span class="pun">().</span><span class="pln">count</span><span class="pun">());</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> uid</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> uniform_int_distribution</span><span class="str">&lt;int&gt;</span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">)(</span><span class="pln">rng</span><span class="pun">);</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
ll uld</span><span class="pun">(</span><span class="pln">ll a</span><span class="pun">,</span><span class="pln"> ll b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> uniform_int_distribution</span><span class="str">&lt;ll&gt;</span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">)(</span><span class="pln">rng</span><span class="pun">);</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

</span><span class="kwd">void</span><span class="pln"> solve</span><span class="pun">(){</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">

    vector</span><span class="pun">&lt;</span><span class="pln">vector</span><span class="str">&lt;int&gt;</span><span class="pun">&gt;</span><span class="pln"> g</span><span class="pun">(</span><span class="pln">n</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++){</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> u</span><span class="pun">,</span><span class="pln"> v</span><span class="pun">;</span><span class="pln">
        cin </span><span class="pun">&gt;&gt;</span><span class="pln"> u </span><span class="pun">&gt;&gt;</span><span class="pln"> v</span><span class="pun">;</span><span class="pln">
        u</span><span class="pun">--;</span><span class="pln">
        v</span><span class="pun">--;</span><span class="pln">

        g</span><span class="pun">[</span><span class="pln">u</span><span class="pun">].</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">v</span><span class="pun">);</span><span class="pln">
        g</span><span class="pun">[</span><span class="pln">v</span><span class="pun">].</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">u</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    vector</span><span class="str">&lt;int&gt;</span><span class="pln"> dep</span><span class="pun">(</span><span class="pln">n</span><span class="pun">),</span><span class="pln"> par</span><span class="pun">(</span><span class="pln">n</span><span class="pun">),</span><span class="pln"> ch</span><span class="pun">(</span><span class="pln">n</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">auto</span><span class="pln"> dfs </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[&amp;](</span><span class="kwd">auto</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> c</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> p</span><span class="pun">)</span><span class="pln"> </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="kwd">void</span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">p </span><span class="pun">!=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">)</span><span class="pln">
            dep</span><span class="pun">[</span><span class="pln">c</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> dep</span><span class="pun">[</span><span class="pln">p</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
        par</span><span class="pun">[</span><span class="pln">c</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> p</span><span class="pun">;</span><span class="pln">
        
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x </span><span class="pun">:</span><span class="pln"> g</span><span class="pun">[</span><span class="pln">c</span><span class="pun">]){</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x </span><span class="pun">==</span><span class="pln"> p</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">continue</span><span class="pun">;</span><span class="pln">
            
            </span><span class="kwd">self</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">,</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> c</span><span class="pun">);</span><span class="pln">
            ch</span><span class="pun">[</span><span class="pln">c</span><span class="pun">]++;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">};</span><span class="pln">
    dfs</span><span class="pun">(</span><span class="pln">dfs</span><span class="pun">,</span><span class="pln"> n </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">);</span><span class="pln">

    array</span><span class="pun">&lt;</span><span class="pln">vector</span><span class="str">&lt;int&gt;</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">&gt;</span><span class="pln"> leaves</span><span class="pun">;</span><span class="pln">
    leaves</span><span class="pun">[</span><span class="lit">0</span><span class="pun">];</span><span class="pln">

    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++){</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">ch</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln">
            leaves</span><span class="pun">[</span><span class="pln">dep</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">].</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">i</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    vector</span><span class="pun">&lt;</span><span class="pln">array</span><span class="pun">&lt;</span><span class="kwd">int</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">&gt;&gt;</span><span class="pln"> ans</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> col </span><span class="pun">=</span><span class="pln"> dep</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++){</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">leaves</span><span class="pun">[</span><span class="pln">col </span><span class="pun">^</span><span class="pln"> </span><span class="lit">1</span><span class="pun">].</span><span class="pln">empty</span><span class="pun">()){</span><span class="pln">
            ans</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">({</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">});</span><span class="pln">
            col </span><span class="pun">^=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">

        </span><span class="kwd">int</span><span class="pln"> nxt </span><span class="pun">=</span><span class="pln"> leaves</span><span class="pun">[</span><span class="pln">col </span><span class="pun">^</span><span class="pln"> </span><span class="lit">1</span><span class="pun">].</span><span class="pln">back</span><span class="pun">();</span><span class="pln">
        leaves</span><span class="pun">[</span><span class="pln">col </span><span class="pun">^</span><span class="pln"> </span><span class="lit">1</span><span class="pun">].</span><span class="pln">pop_back</span><span class="pun">();</span><span class="pln">
        ans</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">({</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> nxt</span><span class="pun">});</span><span class="pln">

        </span><span class="kwd">int</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> par</span><span class="pun">[</span><span class="pln">nxt</span><span class="pun">];</span><span class="pln">
        ch</span><span class="pun">[</span><span class="pln">p</span><span class="pun">]--;</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">ch</span><span class="pun">[</span><span class="pln">p</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln">
            leaves</span><span class="pun">[</span><span class="pln">dep</span><span class="pun">[</span><span class="pln">p</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">].</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">p</span><span class="pun">);</span><span class="pln">

        ans</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">({</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">});</span><span class="pln">
        col </span><span class="pun">^=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    cout </span><span class="pun">&lt;&lt;</span><span class="pln"> ans</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"\n"</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">auto</span><span class="pln"> </span><span class="pun">[</span><span class="pln">x</span><span class="pun">,</span><span class="pln"> y</span><span class="pun">]</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> ans</span><span class="pun">){</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">
            cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"1\n"</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">else</span><span class="pln">
            cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"2 "</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> y </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"\n"</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">(){</span><span class="pln">
    ios</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="kwd">false</span><span class="pun">);</span><span class="pln">
    cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    
    </span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">t</span><span class="pun">--)</span><span class="pln"> solve</span><span class="pun">();</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span></code></pre></div></div> <div class="spoiler"><b class="spoiler-title">Bonus</b><div class="spoiler-content" style="display: block;"><p>Can you implement the checker?</p></div></div><p><a href="https://codeforces.com/contest/2154/problem/E" title="Codeforces Round 1060 (Div. 2)">2154E - No Mind To Think</a>: </p> <div class="spoiler"><b class="spoiler-title">Hint 1</b><div class="spoiler-content" style="display: block;"><p>Without loss of generality, assume the array is sorted. Let's fix <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-76-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-437" style="width: 6.117em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.602em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1004.55em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-438"><span class="mi" id="MathJax-Span-439" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-440" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mn" id="MathJax-Span-441" style="font-family: MathJax_Main; padding-left: 0.273em;">2</span><span class="mi" id="MathJax-Span-442" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-443" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-444" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-76">x = 2y+1</script>, and let's also fix the median of a given operation <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-77-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-445" style="width: 1.139em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.87em, 2.438em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-446"><span class="msubsup" id="MathJax-Span-447"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-448" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-449" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 0.932em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-77">a_i</script>, for some <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-78-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-450" style="width: 9.959em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.524em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1007.52em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-451"><span class="mi" id="MathJax-Span-452" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-453" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-454" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-455" style="font-family: MathJax_Main; padding-left: 0.273em;">≤</span><span class="mi" id="MathJax-Span-456" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">i</span><span class="mo" id="MathJax-Span-457" style="font-family: MathJax_Main; padding-left: 0.273em;">≤</span><span class="mi" id="MathJax-Span-458" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">n</span><span class="mo" id="MathJax-Span-459" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mi" id="MathJax-Span-460" style="font-family: MathJax_Math-italic; padding-left: 0.219em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-78">y+1 \leq i\leq n-y</script>. Now, we see that the best subsequence to choose is <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-79-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-461" style="width: 17.21em; display: inline-block;"><span style="display: inline-block; position: relative; width: 13.044em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.572em, 1013.04em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-462"><span class="msubsup" id="MathJax-Span-463"><span style="display: inline-block; position: relative; width: 0.977em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-464" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mn" id="MathJax-Span-465" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-466" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-467" style="padding-left: 0.165em;"><span style="display: inline-block; position: relative; width: 0.977em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-468" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mn" id="MathJax-Span-469" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-470" style="font-family: MathJax_Main;">,</span><span class="mo" id="MathJax-Span-471" style="font-family: MathJax_Main; padding-left: 0.165em;">…</span><span class="mo" id="MathJax-Span-472" style="font-family: MathJax_Main; padding-left: 0.165em;">,</span><span class="msubsup" id="MathJax-Span-473" style="padding-left: 0.165em;"><span style="display: inline-block; position: relative; width: 0.977em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-474" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-475" style="font-size: 70.7%; font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-476" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-477" style="padding-left: 0.165em;"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-478" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-479" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-480" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-481" style="padding-left: 0.165em;"><span style="display: inline-block; position: relative; width: 1.734em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-482" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="texatom" id="MathJax-Span-483"><span class="mrow" id="MathJax-Span-484"><span class="mi" id="MathJax-Span-485" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-486" style="font-size: 70.7%; font-family: MathJax_Main;">+</span><span class="mn" id="MathJax-Span-487" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-488" style="font-family: MathJax_Main;">,</span><span class="mo" id="MathJax-Span-489" style="font-family: MathJax_Main; padding-left: 0.165em;">…</span><span class="mo" id="MathJax-Span-490" style="font-family: MathJax_Main; padding-left: 0.165em;">,</span><span class="msubsup" id="MathJax-Span-491" style="padding-left: 0.165em;"><span style="display: inline-block; position: relative; width: 1.734em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-492" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="texatom" id="MathJax-Span-493"><span class="mrow" id="MathJax-Span-494"><span class="mi" id="MathJax-Span-495" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-496" style="font-size: 70.7%; font-family: MathJax_Main;">+</span><span class="mi" id="MathJax-Span-497" style="font-size: 70.7%; font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-79">a_1, a_2, \dots, a_y, a_i, a_{i+1}, \dots, a_{i+y}</script>, because we must choose <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-80-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-498" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.49em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-499"><span class="mi" id="MathJax-Span-500" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-80">y</script> values to the left of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-81-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-501" style="width: 1.139em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.87em, 2.438em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-502"><span class="msubsup" id="MathJax-Span-503"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-504" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-505" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 0.932em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-81">a_i</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-82-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-506" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.49em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-507"><span class="mi" id="MathJax-Span-508" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-82">y</script> values to the right of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-83-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-509" style="width: 1.139em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.87em, 2.438em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-510"><span class="msubsup" id="MathJax-Span-511"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-512" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-513" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 0.932em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-83">a_i</script>, and we would like to change the smallest values possible.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 2</b><div class="spoiler-content" style="display: block;"><p>Suppose you have applied one operation with median <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-84-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-514" style="width: 1.139em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.87em, 2.438em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-515"><span class="msubsup" id="MathJax-Span-516"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-517" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-518" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 0.932em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-84">a_i</script> and another operation with median <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-85-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-519" style="width: 1.247em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.92em, 2.546em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-520"><span class="msubsup" id="MathJax-Span-521"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-522" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-523" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-85">a_j</script>, for <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-86-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-524" style="width: 12.232em; display: inline-block;"><span style="display: inline-block; position: relative; width: 9.256em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1009.26em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-525"><span class="mi" id="MathJax-Span-526" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-527" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-528" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-529" style="font-family: MathJax_Main; padding-left: 0.273em;">≤</span><span class="mi" id="MathJax-Span-530" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">i</span><span class="mo" id="MathJax-Span-531" style="font-family: MathJax_Main; padding-left: 0.273em;">&lt;</span><span class="mi" id="MathJax-Span-532" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">j</span><span class="mo" id="MathJax-Span-533" style="font-family: MathJax_Main; padding-left: 0.273em;">≤</span><span class="mi" id="MathJax-Span-534" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">n</span><span class="mo" id="MathJax-Span-535" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mi" id="MathJax-Span-536" style="font-family: MathJax_Math-italic; padding-left: 0.219em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-86">y+1 \leq i < j \leq n-y</script>. Now, you have increased up to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-87-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-537" style="width: 7.957em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.009em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1005.9em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-538"><span class="mo" id="MathJax-Span-539" style="font-family: MathJax_Main;">min</span><span class="mo" id="MathJax-Span-540" style="font-family: MathJax_Main;">(</span><span class="mn" id="MathJax-Span-541" style="font-family: MathJax_Main;">2</span><span class="mi" id="MathJax-Span-542" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-543" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-544" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">j</span><span class="mo" id="MathJax-Span-545" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mn" id="MathJax-Span-546" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-547" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-87">\min(2y, j-1)</script> of the smallest values to either <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-88-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-548" style="width: 1.139em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.87em, 2.438em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-549"><span class="msubsup" id="MathJax-Span-550"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-551" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-552" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 0.932em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-88">a_i</script> or <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-89-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-553" style="width: 1.247em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.92em, 2.546em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-554"><span class="msubsup" id="MathJax-Span-555"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-556" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-557" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-89">a_j</script>, since you can increase up to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-90-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-558" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.49em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-559"><span class="mi" id="MathJax-Span-560" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-90">y</script> values smaller than the median each operation. However, you have also decreased <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-91-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-561" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.49em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-562"><span class="mi" id="MathJax-Span-563" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-91">y</script> values after <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-92-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-564" style="width: 1.139em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.87em, 2.438em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-565"><span class="msubsup" id="MathJax-Span-566"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-567" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-568" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 0.932em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-92">a_i</script>, and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-93-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-569" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.49em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-570"><span class="mi" id="MathJax-Span-571" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-93">y</script> values after <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-94-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-572" style="width: 1.247em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.92em, 2.546em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-573"><span class="msubsup" id="MathJax-Span-574"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-575" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-576" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-94">a_j</script>. Instead, you might as well have just applied two operations with median <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-95-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-577" style="width: 1.247em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.92em, 2.546em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-578"><span class="msubsup" id="MathJax-Span-579"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-580" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-581" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-95">a_j</script>, which allows you to increase <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-96-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-582" style="width: 7.957em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.009em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1005.9em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-583"><span class="mo" id="MathJax-Span-584" style="font-family: MathJax_Main;">min</span><span class="mo" id="MathJax-Span-585" style="font-family: MathJax_Main;">(</span><span class="mn" id="MathJax-Span-586" style="font-family: MathJax_Main;">2</span><span class="mi" id="MathJax-Span-587" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-588" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-589" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">j</span><span class="mo" id="MathJax-Span-590" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mn" id="MathJax-Span-591" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-592" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-96">\min(2y, j-1)</script> of the smallest values to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-97-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-593" style="width: 1.247em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.92em, 2.546em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-594"><span class="msubsup" id="MathJax-Span-595"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-596" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-597" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-97">a_j</script>, and decrease only the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-98-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-598" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.49em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-599"><span class="mi" id="MathJax-Span-600" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-98">y</script> values after <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-99-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-601" style="width: 1.247em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.92em, 2.546em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-602"><span class="msubsup" id="MathJax-Span-603"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-604" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-605" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-99">a_j</script>. Therefore, there exists some optimal sequence of operations where we use the same median across all operations.</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><p>By the result of Hint 2, there exists some optimal sequence of operations where we use the same median across all operations. Let's fix the median at <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-100-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-606" style="width: 1.139em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.87em, 2.438em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-607"><span class="msubsup" id="MathJax-Span-608"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-609" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-610" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 0.932em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-100">a_i</script>. Now, if we choose <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-101-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-611" style="width: 6.117em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.602em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1004.55em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-612"><span class="mi" id="MathJax-Span-613" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-614" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mn" id="MathJax-Span-615" style="font-family: MathJax_Main; padding-left: 0.273em;">2</span><span class="mi" id="MathJax-Span-616" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-617" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-618" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-101">x = 2y+1</script> for some <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-102-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-619" style="width: 14.234em; display: inline-block;"><span style="display: inline-block; position: relative; width: 10.771em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1010.66em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-620"><span class="mn" id="MathJax-Span-621" style="font-family: MathJax_Main;">0</span><span class="mo" id="MathJax-Span-622" style="font-family: MathJax_Main; padding-left: 0.273em;">≤</span><span class="mi" id="MathJax-Span-623" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-624" style="font-family: MathJax_Main; padding-left: 0.273em;">≤</span><span class="mo" id="MathJax-Span-625" style="font-family: MathJax_Main; padding-left: 0.273em;">min</span><span class="mo" id="MathJax-Span-626" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-627" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-628" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mn" id="MathJax-Span-629" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-630" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-631" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">n</span><span class="mo" id="MathJax-Span-632" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mi" id="MathJax-Span-633" style="font-family: MathJax_Math-italic; padding-left: 0.219em;">i</span><span class="mo" id="MathJax-Span-634" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-102">0\leq y \leq \min(i-1, n-i)</script>, we are able to increase the values of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-103-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-635" style="width: 11.853em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.985em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.572em, 1008.99em, 2.708em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-636"><span class="msubsup" id="MathJax-Span-637"><span style="display: inline-block; position: relative; width: 0.977em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-638" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mn" id="MathJax-Span-639" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-640" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-641" style="padding-left: 0.165em;"><span style="display: inline-block; position: relative; width: 0.977em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-642" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mn" id="MathJax-Span-643" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-644" style="font-family: MathJax_Main;">,</span><span class="mo" id="MathJax-Span-645" style="font-family: MathJax_Main; padding-left: 0.165em;">…</span><span class="mo" id="MathJax-Span-646" style="font-family: MathJax_Main; padding-left: 0.165em;">,</span><span class="msubsup" id="MathJax-Span-647" style="padding-left: 0.165em;"><span style="display: inline-block; position: relative; width: 4.386em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-648" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="texatom" id="MathJax-Span-649"><span class="mrow" id="MathJax-Span-650"><span class="mo" id="MathJax-Span-651" style="font-size: 70.7%; font-family: MathJax_Main;">min</span><span class="mo" id="MathJax-Span-652" style="font-size: 70.7%; font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-653" style="font-size: 70.7%; font-family: MathJax_Math-italic;">k</span><span class="mi" id="MathJax-Span-654" style="font-size: 70.7%; font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-655" style="font-size: 70.7%; font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-656" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-657" style="font-size: 70.7%; font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-658" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-659" style="font-size: 70.7%; font-family: MathJax_Main;">)</span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.568em; border-left: 0px solid; width: 0px; height: 1.218em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-103">a_1, a_2, \dots, a_{\min(ky, i-1)}</script> to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-104-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-660" style="width: 1.139em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.87em, 2.438em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-661"><span class="msubsup" id="MathJax-Span-662"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-663" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-664" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 0.932em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-104">a_i</script>, but we must also decrease the values of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-105-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-665" style="width: 10.392em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.849em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.572em, 1007.85em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-666"><span class="msubsup" id="MathJax-Span-667"><span style="display: inline-block; position: relative; width: 1.734em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-668" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="texatom" id="MathJax-Span-669"><span class="mrow" id="MathJax-Span-670"><span class="mi" id="MathJax-Span-671" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-672" style="font-size: 70.7%; font-family: MathJax_Main;">+</span><span class="mn" id="MathJax-Span-673" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-674" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-675" style="padding-left: 0.165em;"><span style="display: inline-block; position: relative; width: 1.734em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-676" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="texatom" id="MathJax-Span-677"><span class="mrow" id="MathJax-Span-678"><span class="mi" id="MathJax-Span-679" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-680" style="font-size: 70.7%; font-family: MathJax_Main;">+</span><span class="mn" id="MathJax-Span-681" style="font-size: 70.7%; font-family: MathJax_Main;">2</span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-682" style="font-family: MathJax_Main;">,</span><span class="mo" id="MathJax-Span-683" style="font-family: MathJax_Main; padding-left: 0.165em;">…</span><span class="mo" id="MathJax-Span-684" style="font-family: MathJax_Main; padding-left: 0.165em;">,</span><span class="msubsup" id="MathJax-Span-685" style="padding-left: 0.165em;"><span style="display: inline-block; position: relative; width: 1.734em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-686" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="texatom" id="MathJax-Span-687"><span class="mrow" id="MathJax-Span-688"><span class="mi" id="MathJax-Span-689" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-690" style="font-size: 70.7%; font-family: MathJax_Main;">+</span><span class="mi" id="MathJax-Span-691" style="font-size: 70.7%; font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-105">a_{i+1}, a_{i+2}, \dots, a_{i+y}</script> to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-106-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-692" style="width: 1.139em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.87em, 2.438em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-693"><span class="msubsup" id="MathJax-Span-694"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-695" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-696" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 0.932em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-106">a_i</script>.</p><p>The benefits of increasing <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-107-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-697" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.49em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-698"><span class="mi" id="MathJax-Span-699" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-107">y</script> are that we can increase more values, but notice that these benefits are getting less and less, because we are increasing values that are already larger. For example, the benefit of increasing <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-108-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-700" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.49em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-701"><span class="mi" id="MathJax-Span-702" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-108">y</script> from <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-109-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-703" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-704"><span class="mn" id="MathJax-Span-705" style="font-family: MathJax_Main;">0</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-109">0</script> to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-110-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-706" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-707"><span class="mn" id="MathJax-Span-708" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-110">1</script> is that now we can increase the values <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-111-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-709" style="width: 7.362em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.576em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.572em, 1005.58em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-710"><span class="msubsup" id="MathJax-Span-711"><span style="display: inline-block; position: relative; width: 0.977em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-712" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mn" id="MathJax-Span-713" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-714" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-715" style="padding-left: 0.165em;"><span style="display: inline-block; position: relative; width: 0.977em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-716" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mn" id="MathJax-Span-717" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-718" style="font-family: MathJax_Main;">,</span><span class="mo" id="MathJax-Span-719" style="font-family: MathJax_Main; padding-left: 0.165em;">…</span><span class="mo" id="MathJax-Span-720" style="font-family: MathJax_Main; padding-left: 0.165em;">,</span><span class="msubsup" id="MathJax-Span-721" style="padding-left: 0.165em;"><span style="display: inline-block; position: relative; width: 0.977em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-722" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-723" style="font-size: 70.7%; font-family: MathJax_Math-italic;">k</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-111">a_1, a_2, \dots, a_k</script>, but the benefit from increasing <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-112-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-724" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.49em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-725"><span class="mi" id="MathJax-Span-726" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-112">y</script> from <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-113-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-727" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-728"><span class="mn" id="MathJax-Span-729" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-113">1</script> to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-114-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-730" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-731"><span class="mn" id="MathJax-Span-732" style="font-family: MathJax_Main;">2</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-114">2</script> is that now we can increase the values <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-115-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-733" style="width: 10.284em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.795em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.572em, 1007.79em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-734"><span class="msubsup" id="MathJax-Span-735"><span style="display: inline-block; position: relative; width: 1.897em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-736" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="texatom" id="MathJax-Span-737"><span class="mrow" id="MathJax-Span-738"><span class="mi" id="MathJax-Span-739" style="font-size: 70.7%; font-family: MathJax_Math-italic;">k</span><span class="mo" id="MathJax-Span-740" style="font-size: 70.7%; font-family: MathJax_Main;">+</span><span class="mn" id="MathJax-Span-741" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-742" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-743" style="padding-left: 0.165em;"><span style="display: inline-block; position: relative; width: 1.897em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-744" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="texatom" id="MathJax-Span-745"><span class="mrow" id="MathJax-Span-746"><span class="mi" id="MathJax-Span-747" style="font-size: 70.7%; font-family: MathJax_Math-italic;">k</span><span class="mo" id="MathJax-Span-748" style="font-size: 70.7%; font-family: MathJax_Main;">+</span><span class="mn" id="MathJax-Span-749" style="font-size: 70.7%; font-family: MathJax_Main;">2</span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-750" style="font-family: MathJax_Main;">,</span><span class="mo" id="MathJax-Span-751" style="font-family: MathJax_Main; padding-left: 0.165em;">…</span><span class="mo" id="MathJax-Span-752" style="font-family: MathJax_Main; padding-left: 0.165em;">,</span><span class="msubsup" id="MathJax-Span-753" style="padding-left: 0.165em;"><span style="display: inline-block; position: relative; width: 1.356em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-754" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="texatom" id="MathJax-Span-755"><span class="mrow" id="MathJax-Span-756"><span class="mn" id="MathJax-Span-757" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span class="mi" id="MathJax-Span-758" style="font-size: 70.7%; font-family: MathJax_Math-italic;">k</span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-115">a_{k+1}, a_{k+2}, \dots, a_{2k}</script>; increasing <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-116-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-759" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.49em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-760"><span class="mi" id="MathJax-Span-761" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-116">y</script> from <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-117-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-762" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-763"><span class="mn" id="MathJax-Span-764" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-117">1</script> to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-118-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-765" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-766"><span class="mn" id="MathJax-Span-767" style="font-family: MathJax_Main;">2</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-118">2</script> is not as beneficial as increasing <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-119-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-768" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.49em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-769"><span class="mi" id="MathJax-Span-770" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-119">y</script> from <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-120-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-771" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-772"><span class="mn" id="MathJax-Span-773" style="font-family: MathJax_Main;">0</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-120">0</script> to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-121-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-774" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-775"><span class="mn" id="MathJax-Span-776" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-121">1</script>, because the values we are increasing are already relatively big. (There's a small case to think about, when <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-122-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-777" style="width: 1.356em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1001.03em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-778"><span class="mi" id="MathJax-Span-779" style="font-family: MathJax_Math-italic;">k</span><span class="mi" id="MathJax-Span-780" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.361em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-122">ky</script> first exceeds <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-123-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-781" style="width: 2.708em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.059em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1002em, 2.438em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-782"><span class="mi" id="MathJax-Span-783" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-784" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mn" id="MathJax-Span-785" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.211em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-123">i-1</script>, but note that the number of values you can increase is also monotonically decreasing, so this doesn't cause any issues.) The same reasoning goes for the losses. The losses of increasing <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-124-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-786" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.49em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-787"><span class="mi" id="MathJax-Span-788" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-124">y</script> are that we are forced to decrease more values, and these losses are getting greater and greater. If we increase <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-125-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-789" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.49em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-790"><span class="mi" id="MathJax-Span-791" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-125">y</script> from <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-126-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-792" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-793"><span class="mn" id="MathJax-Span-794" style="font-family: MathJax_Main;">0</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-126">0</script> to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-127-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-795" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-796"><span class="mn" id="MathJax-Span-797" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-127">1</script>, we are only forced to decrease <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-128-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-798" style="width: 2.33em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.734em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1001.73em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-799"><span class="msubsup" id="MathJax-Span-800"><span style="display: inline-block; position: relative; width: 1.734em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-801" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="texatom" id="MathJax-Span-802"><span class="mrow" id="MathJax-Span-803"><span class="mi" id="MathJax-Span-804" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-805" style="font-size: 70.7%; font-family: MathJax_Main;">+</span><span class="mn" id="MathJax-Span-806" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-128">a_{i+1}</script>, but if we increase <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-129-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-807" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.49em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-808"><span class="mi" id="MathJax-Span-809" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-129">y</script> from <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-130-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-810" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-811"><span class="mn" id="MathJax-Span-812" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-130">1</script> to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-131-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-813" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-814"><span class="mn" id="MathJax-Span-815" style="font-family: MathJax_Main;">2</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-131">2</script>, we now have to decrease <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-132-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-816" style="width: 2.33em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.734em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1001.73em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-817"><span class="msubsup" id="MathJax-Span-818"><span style="display: inline-block; position: relative; width: 1.734em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-819" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="texatom" id="MathJax-Span-820"><span class="mrow" id="MathJax-Span-821"><span class="mi" id="MathJax-Span-822" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-823" style="font-size: 70.7%; font-family: MathJax_Main;">+</span><span class="mn" id="MathJax-Span-824" style="font-size: 70.7%; font-family: MathJax_Main;">2</span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-132">a_{i+2}</script>, which is worse because <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-133-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-825" style="width: 2.33em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.734em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1001.73em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-826"><span class="msubsup" id="MathJax-Span-827"><span style="display: inline-block; position: relative; width: 1.734em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-828" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="texatom" id="MathJax-Span-829"><span class="mrow" id="MathJax-Span-830"><span class="mi" id="MathJax-Span-831" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-832" style="font-size: 70.7%; font-family: MathJax_Main;">+</span><span class="mn" id="MathJax-Span-833" style="font-size: 70.7%; font-family: MathJax_Main;">2</span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-133">a_{i+2}</script> is relatively big. In other words, our net gains (that is, the benefits minus the losses) are monotonically decreasing.</p><p>We want to keep incrementing <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-134-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-834" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.49em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-835"><span class="mi" id="MathJax-Span-836" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-134">y</script> as long as our net gains are positive, then stop incrementing <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-135-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-837" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.49em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-838"><span class="mi" id="MathJax-Span-839" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-135">y</script> once our net gains become negative. Since our net gains are monotonically decreasing, we can binary search for this point. (Alternative solutions might use ternary search instead.) So we iterate over all choices of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-136-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-840" style="width: 0.436em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.327em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1000.27em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-841"><span class="mi" id="MathJax-Span-842" style="font-family: MathJax_Math-italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-136">i</script>, then binary search for the optimal choice of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-137-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-843" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.49em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-844"><span class="mi" id="MathJax-Span-845" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-137">y</script>, which in total takes <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-138-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-846" style="width: 5.739em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.332em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1004.22em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-847"><span class="mi" id="MathJax-Span-848" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-849" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-850" style="font-family: MathJax_Math-italic;">n</span><span class="mi" id="MathJax-Span-851" style="font-family: MathJax_Main; padding-left: 0.165em;">log</span><span class="mo" id="MathJax-Span-852"></span><span class="texatom" id="MathJax-Span-853" style="padding-left: 0.165em;"><span class="mrow" id="MathJax-Span-854"><span class="mi" id="MathJax-Span-855" style="font-family: MathJax_Math-italic;">n</span></span></span><span class="mo" id="MathJax-Span-856" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-138">O(n\log{n})</script> time. Note that all computations can be done quickly with prefix sums.</p></div></div> <div class="spoiler"><b class="spoiler-title">Implementation(C++)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">typedef</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> ll</span><span class="pun">;</span><span class="pln">
</span><span class="com">#define</span><span class="pln"> debug</span><span class="pun">(</span><span class="pln">x</span><span class="pun">)</span><span class="pln"> cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="com">#x &lt;&lt; " = " &lt;&lt; x &lt;&lt; "\n";</span><span class="pln">
</span><span class="com">#define</span><span class="pln"> vdebug</span><span class="pun">(</span><span class="pln">a</span><span class="pun">)</span><span class="pln"> cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="com">#a &lt;&lt; " = "; for(auto x: a) cout &lt;&lt; x &lt;&lt; " "; cout &lt;&lt; "\n";</span><span class="pln">
mt19937 rng</span><span class="pun">(</span><span class="pln">chrono</span><span class="pun">::</span><span class="pln">steady_clock</span><span class="pun">::</span><span class="pln">now</span><span class="pun">().</span><span class="pln">time_since_epoch</span><span class="pun">().</span><span class="pln">count</span><span class="pun">());</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> uid</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> uniform_int_distribution</span><span class="str">&lt;int&gt;</span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">)(</span><span class="pln">rng</span><span class="pun">);</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
ll uld</span><span class="pun">(</span><span class="pln">ll a</span><span class="pun">,</span><span class="pln"> ll b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> uniform_int_distribution</span><span class="str">&lt;ll&gt;</span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">)(</span><span class="pln">rng</span><span class="pun">);</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

</span><span class="kwd">void</span><span class="pln"> solve</span><span class="pun">(){</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> k</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n </span><span class="pun">&gt;&gt;</span><span class="pln"> k</span><span class="pun">;</span><span class="pln">

    vector</span><span class="str">&lt;int&gt;</span><span class="pln"> a</span><span class="pun">(</span><span class="pln">n</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">x </span><span class="pun">:</span><span class="pln"> a</span><span class="pun">)</span><span class="pln"> cin </span><span class="pun">&gt;&gt;</span><span class="pln"> x</span><span class="pun">;</span><span class="pln">

    sort</span><span class="pun">(</span><span class="pln">a</span><span class="pun">.</span><span class="kwd">begin</span><span class="pun">(),</span><span class="pln"> a</span><span class="pun">.</span><span class="kwd">end</span><span class="pun">());</span><span class="pln">

    vector</span><span class="str">&lt;ll&gt;</span><span class="pln"> pre</span><span class="pun">(</span><span class="pln">n</span><span class="pun">);</span><span class="pln">
    pre</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">[</span><span class="lit">0</span><span class="pun">];</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
        pre</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> pre</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">

    ll ans </span><span class="pun">=</span><span class="pln"> pre</span><span class="pun">[</span><span class="pln">n </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">];</span><span class="pln">

    </span><span class="kwd">auto</span><span class="pln"> query </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[&amp;](</span><span class="kwd">int</span><span class="pln"> l</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> r</span><span class="pun">)</span><span class="pln"> </span><span class="pun">-&gt;</span><span class="pln"> ll</span><span class="pun">{</span><span class="pln">
        ll res </span><span class="pun">=</span><span class="pln"> pre</span><span class="pun">[</span><span class="pln">r</span><span class="pun">];</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln">
            res </span><span class="pun">-=</span><span class="pln"> pre</span><span class="pun">[</span><span class="pln">l </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">];</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> res</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">};</span><span class="pln">

    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++){</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> l </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> r </span><span class="pun">=</span><span class="pln"> min</span><span class="pun">(</span><span class="pln">i</span><span class="pun">,</span><span class="pln"> n </span><span class="pun">-</span><span class="pln"> i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l </span><span class="pun">&lt;</span><span class="pln"> r</span><span class="pun">){</span><span class="pln">
            </span><span class="kwd">int</span><span class="pln"> mid </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l </span><span class="pun">+</span><span class="pln"> r</span><span class="pun">)</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln">
            
            </span><span class="kwd">int</span><span class="pln"> left </span><span class="pun">=</span><span class="pln"> min</span><span class="pun">(</span><span class="lit">1LL</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">(</span><span class="pln">mid </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> k</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1LL</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> i</span><span class="pun">);</span><span class="pln">
            </span><span class="kwd">int</span><span class="pln"> right </span><span class="pun">=</span><span class="pln"> min</span><span class="pun">(</span><span class="lit">1LL</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> mid </span><span class="pun">*</span><span class="pln"> k </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1LL</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> i</span><span class="pun">);</span><span class="pln">
            ll cost </span><span class="pun">=</span><span class="pln"> query</span><span class="pun">(</span><span class="pln">left</span><span class="pun">,</span><span class="pln"> right</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> mid</span><span class="pun">];</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">cost </span><span class="pun">&lt;=</span><span class="pln"> </span><span class="lit">1LL</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">(</span><span class="pln">right </span><span class="pun">-</span><span class="pln"> left </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">))</span><span class="pln">
                l </span><span class="pun">=</span><span class="pln"> mid </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">else</span><span class="pln">
                r </span><span class="pun">=</span><span class="pln"> mid</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        l</span><span class="pun">--;</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln">
            </span><span class="kwd">continue</span><span class="pun">;</span><span class="pln">

        </span><span class="kwd">int</span><span class="pln"> right </span><span class="pun">=</span><span class="pln"> min</span><span class="pun">(</span><span class="lit">1LL</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> l </span><span class="pun">*</span><span class="pln"> k </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1LL</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> i</span><span class="pun">);</span><span class="pln">
        ll len </span><span class="pun">=</span><span class="pln"> right </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> l</span><span class="pun">;</span><span class="pln">
        ll cost </span><span class="pun">=</span><span class="pln"> len </span><span class="pun">*</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">(</span><span class="pln">query</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> right</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> query</span><span class="pun">(</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> i </span><span class="pun">+</span><span class="pln"> l</span><span class="pun">));</span><span class="pln">
        ans </span><span class="pun">=</span><span class="pln"> max</span><span class="pun">(</span><span class="pln">ans</span><span class="pun">,</span><span class="pln"> pre</span><span class="pun">[</span><span class="pln">n </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> cost</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    cout </span><span class="pun">&lt;&lt;</span><span class="pln"> ans </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"\n"</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">(){</span><span class="pln">
    ios</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="kwd">false</span><span class="pun">);</span><span class="pln">
    cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    
    </span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">t</span><span class="pun">--)</span><span class="pln"> solve</span><span class="pun">();</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2154/problem/F1" title="Codeforces Round 1060 (Div. 2)">2154F1 - Bombing (Easy Version)</a>: </p> <div class="spoiler"><b class="spoiler-title">Hint 1</b><div class="spoiler-content" style="display: block;"><p>For every valid permutation we can always determine the index <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-139-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-857" style="width: 0.76em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.544em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.54em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-858"><span class="mi" id="MathJax-Span-859" style="font-family: MathJax_Math-italic;">k</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-139">k</script> used as the split in the riffle shuffle operation, unless it is the sorted permutation.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 2</b><div class="spoiler-content" style="display: block;"><p>Find the number of riffle shuffles for each split.</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><p>Lets prove Hint 1. For a valid permutation <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-140-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-860" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.436em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.44em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-861"><span class="mi" id="MathJax-Span-862" style="font-family: MathJax_Math-italic;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-140">q</script>, consider the first <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-141-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-863" style="width: 0.76em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.544em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.54em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-864"><span class="mi" id="MathJax-Span-865" style="font-family: MathJax_Math-italic;">k</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-141">k</script> such that <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-142-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-866" style="width: 0.76em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.544em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.54em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-867"><span class="mi" id="MathJax-Span-868" style="font-family: MathJax_Math-italic;">k</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-142">k</script> appers after <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-143-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-869" style="width: 2.925em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.221em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1002.17em, 2.438em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-870"><span class="mi" id="MathJax-Span-871" style="font-family: MathJax_Math-italic;">k</span><span class="mo" id="MathJax-Span-872" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-873" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.211em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-143">k + 1</script> in <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-144-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-874" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.436em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.44em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-875"><span class="mi" id="MathJax-Span-876" style="font-family: MathJax_Math-italic;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-144">q</script>, if <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-145-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-877" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.436em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.44em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-878"><span class="mi" id="MathJax-Span-879" style="font-family: MathJax_Math-italic;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-145">q</script> is a riffle shuffle of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-146-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-880" style="width: 6.388em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.819em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1004.71em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-881"><span class="mo" id="MathJax-Span-882" style="font-family: MathJax_Main;">[</span><span class="mn" id="MathJax-Span-883" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-884" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-885" style="font-family: MathJax_Main; padding-left: 0.165em;">2</span><span class="mo" id="MathJax-Span-886" style="font-family: MathJax_Main;">,</span><span class="mo" id="MathJax-Span-887" style="font-family: MathJax_Main; padding-left: 0.165em;">…</span><span class="mo" id="MathJax-Span-888" style="font-family: MathJax_Main; padding-left: 0.165em;">,</span><span class="mi" id="MathJax-Span-889" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">n</span><span class="mo" id="MathJax-Span-890" style="font-family: MathJax_Main;">]</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-146">[1, 2, \ldots, n]</script> then we know that <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-147-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-891" style="width: 0.76em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.544em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.54em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-892"><span class="mi" id="MathJax-Span-893" style="font-family: MathJax_Math-italic;">k</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-147">k</script> must be the split used. The only permutation where such a item does not exist is the one where the permutation is already sorted.</p><p>Now lets try finding the number of solutions for a specific split point <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-148-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-894" style="width: 0.76em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.544em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.54em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-895"><span class="mi" id="MathJax-Span-896" style="font-family: MathJax_Math-italic;">k</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-148">k</script> in sub-quadratic time. We can think of it like this, colour all the numbers less than or equal to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-149-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-897" style="width: 0.76em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.544em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.54em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-898"><span class="mi" id="MathJax-Span-899" style="font-family: MathJax_Math-italic;">k</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-149">k</script> in blue and the elements bigger than <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-150-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-900" style="width: 0.76em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.544em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.54em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-901"><span class="mi" id="MathJax-Span-902" style="font-family: MathJax_Math-italic;">k</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-150">k</script> in red. Now when we replace all <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-151-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-903" style="width: 1.734em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.301em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1001.25em, 2.438em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-904"><span class="mo" id="MathJax-Span-905" style="font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-906" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.211em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-151">-1</script> in <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-152-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-907" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.49em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-908"><span class="mi" id="MathJax-Span-909" style="font-family: MathJax_Math-italic;">p</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-152">p</script> the following must be true after, for each blue element <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-153-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-910" style="width: 0.814em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.54em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-911"><span class="mi" id="MathJax-Span-912" style="font-family: MathJax_Math-italic;">x</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-153">x</script> exactly <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-154-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-913" style="width: 0.814em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.54em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-914"><span class="mi" id="MathJax-Span-915" style="font-family: MathJax_Math-italic;">x</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-154">x</script> elements are blue in its prefix and for each red element <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-155-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-916" style="width: 0.814em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.54em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-917"><span class="mi" id="MathJax-Span-918" style="font-family: MathJax_Math-italic;">x</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-155">x</script> exactly <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-156-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-919" style="width: 3.087em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.33em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1002.33em, 2.438em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-920"><span class="mi" id="MathJax-Span-921" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-922" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mi" id="MathJax-Span-923" style="font-family: MathJax_Math-italic; padding-left: 0.219em;">k</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.211em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-156">x - k</script> elements are red in its prefix. So now we just need to count the number of ways to insert red and blue elements so that this condition is satisfied. To find this iterate over each index that is not <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-157-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-924" style="width: 1.734em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.301em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1001.25em, 2.438em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-925"><span class="mo" id="MathJax-Span-926" style="font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-927" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.211em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-157">-1</script> and insert the number of elements of its colour that it demands and fill the remaining elements in its prefix with the other colour. This will have worst case <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-158-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-928" style="width: 2.871em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.167em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1002.06em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-929"><span class="mi" id="MathJax-Span-930" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-931" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-932" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-933" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-158">O(n)</script> run time if we can calculate the required binomial coefficients in <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-159-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-934" style="width: 2.708em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.059em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1001.95em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-935"><span class="mi" id="MathJax-Span-936" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-937" style="font-family: MathJax_Main;">(</span><span class="mn" id="MathJax-Span-938" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-939" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-159">O(1)</script> which can be done by pre-calculating factorials.</p><p>So we can just iterate over each split and sum in <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-160-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-940" style="width: 3.466em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.6em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1002.49em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-941"><span class="mi" id="MathJax-Span-942" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-943" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-944"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.6em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-945" style="font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -4.38em; left: 0.598em;"><span class="mn" id="MathJax-Span-946" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-947" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.575em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-160">O(n^2)</script> making sure to remember that we might overcount the sorted permutation.</p></div></div> <div class="spoiler"><b class="spoiler-title">Implementation(C++)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">typedef</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> ll</span><span class="pun">;</span><span class="pln">
</span><span class="com">#define</span><span class="pln"> debug</span><span class="pun">(</span><span class="pln">x</span><span class="pun">)</span><span class="pln"> cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="com">#x &lt;&lt; " = " &lt;&lt; x &lt;&lt; "\n";</span><span class="pln">
</span><span class="com">#define</span><span class="pln"> vdebug</span><span class="pun">(</span><span class="pln">a</span><span class="pun">)</span><span class="pln"> cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="com">#a &lt;&lt; " = "; for(auto x: a) cout &lt;&lt; x &lt;&lt; " "; cout &lt;&lt; "\n";</span><span class="pln">
mt19937 rng</span><span class="pun">(</span><span class="pln">chrono</span><span class="pun">::</span><span class="pln">steady_clock</span><span class="pun">::</span><span class="pln">now</span><span class="pun">().</span><span class="pln">time_since_epoch</span><span class="pun">().</span><span class="pln">count</span><span class="pun">());</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> uid</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> uniform_int_distribution</span><span class="str">&lt;int&gt;</span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">)(</span><span class="pln">rng</span><span class="pun">);</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
ll uld</span><span class="pun">(</span><span class="pln">ll a</span><span class="pun">,</span><span class="pln"> ll b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> uniform_int_distribution</span><span class="str">&lt;ll&gt;</span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">)(</span><span class="pln">rng</span><span class="pun">);</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> MOD </span><span class="pun">=</span><span class="pln"> </span><span class="lit">998244353</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">template</span><span class="pun">&lt;</span><span class="pln">ll mod</span><span class="pun">&gt;</span><span class="pln"> </span><span class="com">// template was not stolen from https://codeforces.com/profile/SharpEdged</span><span class="pln">
</span><span class="kwd">struct</span><span class="pln"> modnum </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">constexpr</span><span class="pln"> </span><span class="kwd">bool</span><span class="pln"> is_big_mod </span><span class="pun">=</span><span class="pln"> mod </span><span class="pun">&gt;</span><span class="pln"> numeric_limits</span><span class="str">&lt;int&gt;</span><span class="pun">::</span><span class="pln">max</span><span class="pun">();</span><span class="pln">

    </span><span class="kwd">using</span><span class="pln"> S </span><span class="pun">=</span><span class="pln"> </span><span class="typ">conditional_t</span><span class="pun">&lt;</span><span class="pln">is_big_mod</span><span class="pun">,</span><span class="pln"> ll</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">&gt;;</span><span class="pln">
    </span><span class="kwd">using</span><span class="pln"> L </span><span class="pun">=</span><span class="pln"> </span><span class="typ">conditional_t</span><span class="pun">&lt;</span><span class="pln">is_big_mod</span><span class="pun">,</span><span class="pln"> __int128</span><span class="pun">,</span><span class="pln"> ll</span><span class="pun">&gt;;</span><span class="pln">

    S x</span><span class="pun">;</span><span class="pln">

    modnum</span><span class="pun">()</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> x</span><span class="pun">(</span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">
    modnum</span><span class="pun">(</span><span class="pln">ll _x</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        _x </span><span class="pun">%=</span><span class="pln"> </span><span class="kwd">static_cast</span><span class="str">&lt;ll&gt;</span><span class="pun">(</span><span class="pln">mod</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">_x </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> _x </span><span class="pun">+=</span><span class="pln"> mod</span><span class="pun">;</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
        x </span><span class="pun">=</span><span class="pln"> _x</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    modnum pow</span><span class="pun">(</span><span class="pln">ll n</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">const</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        modnum res </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
        modnum cur </span><span class="pun">=</span><span class="pln"> </span><span class="pun">*</span><span class="kwd">this</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">n </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">n </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> res </span><span class="pun">*=</span><span class="pln"> cur</span><span class="pun">;</span><span class="pln">
            cur </span><span class="pun">*=</span><span class="pln"> cur</span><span class="pun">;</span><span class="pln">
            n </span><span class="pun">/=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> res</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    modnum inv</span><span class="pun">()</span><span class="pln"> </span><span class="kwd">const</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">(*</span><span class="kwd">this</span><span class="pun">).</span><span class="pln">pow</span><span class="pun">(</span><span class="pln">mod</span><span class="pun">-</span><span class="lit">2</span><span class="pun">);</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    
    modnum</span><span class="pun">&amp;</span><span class="pln"> </span><span class="kwd">operator</span><span class="pun">+=(</span><span class="kwd">const</span><span class="pln"> modnum</span><span class="pun">&amp;</span><span class="pln"> a</span><span class="pun">){</span><span class="pln">
        x </span><span class="pun">+=</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">x</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x </span><span class="pun">&gt;=</span><span class="pln"> mod</span><span class="pun">)</span><span class="pln"> x </span><span class="pun">-=</span><span class="pln"> mod</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">*</span><span class="kwd">this</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    modnum</span><span class="pun">&amp;</span><span class="pln"> </span><span class="kwd">operator</span><span class="pun">-=(</span><span class="kwd">const</span><span class="pln"> modnum</span><span class="pun">&amp;</span><span class="pln"> a</span><span class="pun">){</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x </span><span class="pun">&lt;</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">x</span><span class="pun">)</span><span class="pln"> x </span><span class="pun">+=</span><span class="pln"> mod</span><span class="pun">;</span><span class="pln">
        x </span><span class="pun">-=</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">x</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">*</span><span class="kwd">this</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    modnum</span><span class="pun">&amp;</span><span class="pln"> </span><span class="kwd">operator</span><span class="pun">*=(</span><span class="kwd">const</span><span class="pln"> modnum</span><span class="pun">&amp;</span><span class="pln"> a</span><span class="pun">){</span><span class="pln">
        x </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">static_cast</span><span class="pun">&lt;</span><span class="pln">L</span><span class="pun">&gt;(</span><span class="pln">x</span><span class="pun">)</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">x </span><span class="pun">%</span><span class="pln"> mod</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">*</span><span class="kwd">this</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    modnum</span><span class="pun">&amp;</span><span class="pln"> </span><span class="kwd">operator</span><span class="pun">/=(</span><span class="kwd">const</span><span class="pln"> modnum</span><span class="pun">&amp;</span><span class="pln"> a</span><span class="pun">){</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">*</span><span class="kwd">this</span><span class="pln"> </span><span class="pun">*=</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">inv</span><span class="pun">();</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    
    </span><span class="kwd">friend</span><span class="pln"> modnum </span><span class="kwd">operator</span><span class="pun">+(</span><span class="kwd">const</span><span class="pln"> modnum</span><span class="pun">&amp;</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">const</span><span class="pln"> modnum</span><span class="pun">&amp;</span><span class="pln"> b</span><span class="pun">){</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> modnum</span><span class="pun">(</span><span class="pln">a</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+=</span><span class="pln"> b</span><span class="pun">;</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">friend</span><span class="pln"> modnum </span><span class="kwd">operator</span><span class="pun">-(</span><span class="kwd">const</span><span class="pln"> modnum</span><span class="pun">&amp;</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">const</span><span class="pln"> modnum</span><span class="pun">&amp;</span><span class="pln"> b</span><span class="pun">){</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> modnum</span><span class="pun">(</span><span class="pln">a</span><span class="pun">)</span><span class="pln"> </span><span class="pun">-=</span><span class="pln"> b</span><span class="pun">;</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">friend</span><span class="pln"> modnum </span><span class="kwd">operator</span><span class="pun">*(</span><span class="kwd">const</span><span class="pln"> modnum</span><span class="pun">&amp;</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">const</span><span class="pln"> modnum</span><span class="pun">&amp;</span><span class="pln"> b</span><span class="pun">){</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> modnum</span><span class="pun">(</span><span class="pln">a</span><span class="pun">)</span><span class="pln"> </span><span class="pun">*=</span><span class="pln"> b</span><span class="pun">;</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">friend</span><span class="pln"> modnum </span><span class="kwd">operator</span><span class="pun">/(</span><span class="kwd">const</span><span class="pln"> modnum</span><span class="pun">&amp;</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">const</span><span class="pln"> modnum</span><span class="pun">&amp;</span><span class="pln"> b</span><span class="pun">){</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> modnum</span><span class="pun">(</span><span class="pln">a</span><span class="pun">)</span><span class="pln"> </span><span class="pun">/=</span><span class="pln"> b</span><span class="pun">;</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    
    </span><span class="kwd">friend</span><span class="pln"> </span><span class="kwd">bool</span><span class="pln"> </span><span class="kwd">operator</span><span class="pun">==(</span><span class="kwd">const</span><span class="pln"> modnum</span><span class="pun">&amp;</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">const</span><span class="pln"> modnum</span><span class="pun">&amp;</span><span class="pln"> b</span><span class="pun">){</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">x </span><span class="pun">==</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">x</span><span class="pun">;</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">friend</span><span class="pln"> </span><span class="kwd">bool</span><span class="pln"> </span><span class="kwd">operator</span><span class="pun">!=(</span><span class="kwd">const</span><span class="pln"> modnum</span><span class="pun">&amp;</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">const</span><span class="pln"> modnum</span><span class="pun">&amp;</span><span class="pln"> b</span><span class="pun">){</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">x </span><span class="pun">!=</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">x</span><span class="pun">;</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">friend</span><span class="pln"> </span><span class="kwd">bool</span><span class="pln"> </span><span class="kwd">operator</span><span class="pun">&lt;(</span><span class="kwd">const</span><span class="pln"> modnum</span><span class="pun">&amp;</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">const</span><span class="pln"> modnum</span><span class="pun">&amp;</span><span class="pln"> b</span><span class="pun">){</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">x </span><span class="pun">&lt;</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">x</span><span class="pun">;</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">friend</span><span class="pln"> ostream</span><span class="pun">&amp;</span><span class="pln"> </span><span class="kwd">operator</span><span class="pun">&lt;&lt;(</span><span class="pln">ostream</span><span class="pun">&amp;</span><span class="pln"> os</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">const</span><span class="pln"> modnum</span><span class="pun">&amp;</span><span class="pln"> a</span><span class="pun">){</span><span class="pln"> os </span><span class="pun">&lt;&lt;</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">x</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> os</span><span class="pun">;</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">friend</span><span class="pln"> istream</span><span class="pun">&amp;</span><span class="pln"> </span><span class="kwd">operator</span><span class="pun">&gt;&gt;(</span><span class="pln">istream</span><span class="pun">&amp;</span><span class="pln"> </span><span class="kwd">is</span><span class="pun">,</span><span class="pln"> modnum</span><span class="pun">&amp;</span><span class="pln"> a</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> ll x</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">is</span><span class="pln"> </span><span class="pun">&gt;&gt;</span><span class="pln"> x</span><span class="pun">;</span><span class="pln"> a </span><span class="pun">=</span><span class="pln"> modnum</span><span class="pun">(</span><span class="pln">x</span><span class="pun">);</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">is</span><span class="pun">;</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">};</span><span class="pln">

</span><span class="kwd">using</span><span class="pln"> mint </span><span class="pun">=</span><span class="pln"> modnum</span><span class="pun">&lt;</span><span class="pln">MOD</span><span class="pun">&gt;;</span><span class="pln">

</span><span class="kwd">struct</span><span class="pln"> </span><span class="typ">Combi</span><span class="pun">{</span><span class="pln">
    vector</span><span class="str">&lt;mint&gt;</span><span class="pln"> _fac</span><span class="pun">,</span><span class="pln"> _ifac</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
    
    </span><span class="typ">Combi</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        n </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
        _fac</span><span class="pun">.</span><span class="pln">assign</span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
        _ifac</span><span class="pun">.</span><span class="pln">assign</span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    
    </span><span class="kwd">void</span><span class="pln"> check_size</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> m</span><span class="pun">){</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> need </span><span class="pun">=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">need </span><span class="pun">&lt;</span><span class="pln"> m</span><span class="pun">)</span><span class="pln"> need </span><span class="pun">*=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln">
        m </span><span class="pun">=</span><span class="pln"> need</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">m </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">return</span><span class="pun">;</span><span class="pln">
        
        _fac</span><span class="pun">.</span><span class="pln">resize</span><span class="pun">(</span><span class="pln">m </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
        _ifac</span><span class="pun">.</span><span class="pln">resize</span><span class="pun">(</span><span class="pln">m </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> m</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> _fac</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> i </span><span class="pun">*</span><span class="pln"> _fac</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">];</span><span class="pln">
        
        _ifac</span><span class="pun">[</span><span class="pln">m</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> _fac</span><span class="pun">[</span><span class="pln">m</span><span class="pun">].</span><span class="pln">inv</span><span class="pun">();</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> m </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&gt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">--)</span><span class="pln"> _ifac</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> _ifac</span><span class="pun">[</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
        n </span><span class="pun">=</span><span class="pln"> m</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    
    mint fac</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> m</span><span class="pun">){</span><span class="pln">
        check_size</span><span class="pun">(</span><span class="pln">m</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> _fac</span><span class="pun">[</span><span class="pln">m</span><span class="pun">];</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    
    mint ifac</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> m</span><span class="pun">){</span><span class="pln">
        check_size</span><span class="pun">(</span><span class="pln">m</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> _ifac</span><span class="pun">[</span><span class="pln">m</span><span class="pun">];</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    
    mint ncr</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> r</span><span class="pun">){</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">n </span><span class="pun">&lt;</span><span class="pln"> r </span><span class="pun">||</span><span class="pln"> r </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
        
        </span><span class="kwd">return</span><span class="pln"> fac</span><span class="pun">(</span><span class="pln">n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> ifac</span><span class="pun">(</span><span class="pln">n </span><span class="pun">-</span><span class="pln"> r</span><span class="pun">)</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> ifac</span><span class="pun">(</span><span class="pln">r</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    
    mint npr</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> r</span><span class="pun">){</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">n </span><span class="pun">&lt;</span><span class="pln"> r </span><span class="pun">||</span><span class="pln"> r </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
        
        </span><span class="kwd">return</span><span class="pln"> fac</span><span class="pun">(</span><span class="pln">n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> ifac</span><span class="pun">(</span><span class="pln">n </span><span class="pun">-</span><span class="pln"> r</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> comb</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">void</span><span class="pln"> solve</span><span class="pun">(){</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">

    vector</span><span class="str">&lt;int&gt;</span><span class="pln"> a</span><span class="pun">(</span><span class="pln">n</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">x </span><span class="pun">:</span><span class="pln"> a</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        cin </span><span class="pun">&gt;&gt;</span><span class="pln"> x</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x </span><span class="pun">!=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">)</span><span class="pln">
            x</span><span class="pun">--;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    mint ans </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++){</span><span class="pln">
        mint res </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> spaces </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> less </span><span class="pun">=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> more </span><span class="pun">=</span><span class="pln"> i</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++){</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">){</span><span class="pln">
                spaces</span><span class="pun">++;</span><span class="pln">
                </span><span class="kwd">continue</span><span class="pun">;</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">

            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;=</span><span class="pln"> i</span><span class="pun">){</span><span class="pln">
                </span><span class="kwd">int</span><span class="pln"> need </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> less </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
                res </span><span class="pun">*=</span><span class="pln"> comb</span><span class="pun">.</span><span class="pln">ncr</span><span class="pun">(</span><span class="pln">spaces</span><span class="pun">,</span><span class="pln"> need</span><span class="pun">);</span><span class="pln">
                more </span><span class="pun">+=</span><span class="pln"> spaces </span><span class="pun">-</span><span class="pln"> need</span><span class="pun">;</span><span class="pln">
                less </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">j</span><span class="pun">];</span><span class="pln">

            </span><span class="pun">}</span><span class="pln">

            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> i</span><span class="pun">){</span><span class="pln">
                </span><span class="kwd">int</span><span class="pln"> need </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> more </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
                res </span><span class="pun">*=</span><span class="pln"> comb</span><span class="pun">.</span><span class="pln">ncr</span><span class="pun">(</span><span class="pln">spaces</span><span class="pun">,</span><span class="pln"> need</span><span class="pun">);</span><span class="pln">
                less </span><span class="pun">+=</span><span class="pln"> spaces </span><span class="pun">-</span><span class="pln"> need</span><span class="pun">;</span><span class="pln">
                more </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">j</span><span class="pun">];</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">

            spaces </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">

        res </span><span class="pun">*=</span><span class="pln"> comb</span><span class="pun">.</span><span class="pln">ncr</span><span class="pun">(</span><span class="pln">spaces</span><span class="pun">,</span><span class="pln"> i </span><span class="pun">-</span><span class="pln"> less</span><span class="pun">);</span><span class="pln">

        ans </span><span class="pun">+=</span><span class="pln"> res</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">bool</span><span class="pln"> sorted </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++){</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> i </span><span class="pun">&amp;&amp;</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">)</span><span class="pln">
            sorted </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">sorted</span><span class="pun">)</span><span class="pln">
        ans </span><span class="pun">-=</span><span class="pln"> n </span><span class="pun">-</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln">
    cout </span><span class="pun">&lt;&lt;</span><span class="pln"> ans </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"\n"</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">(){</span><span class="pln">
    ios</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="kwd">false</span><span class="pun">);</span><span class="pln">
    cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    
    </span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">t</span><span class="pun">--)</span><span class="pln"> solve</span><span class="pun">();</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2154/problem/F2" title="Codeforces Round 1060 (Div. 2)">2154F2 - Bombing (Hard Version)</a>: </p> <div class="spoiler"><b class="spoiler-title">Step 1</b><div class="spoiler-content" style="display: block;"><p>Solve the easy version.</p></div></div> <div class="spoiler"><b class="spoiler-title">Step 2</b><div class="spoiler-content" style="display: block;"><p>If <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-161-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-948" style="width: 3.304em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.492em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1002.44em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-949"><span class="msubsup" id="MathJax-Span-950"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-951" style="font-family: MathJax_Math-italic;">p</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.49em;"><span class="mi" id="MathJax-Span-952" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-953" style="font-family: MathJax_Main; padding-left: 0.273em;">&lt;</span><span class="mi" id="MathJax-Span-954" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">i</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-161">p_i < i</script> we know that <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-162-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-955" style="width: 1.085em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.81em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-956"><span class="msubsup" id="MathJax-Span-957"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-958" style="font-family: MathJax_Math-italic;">p</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.49em;"><span class="mi" id="MathJax-Span-959" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-162">p_i</script> must belong to the left side of the split, similarly if <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-163-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-960" style="width: 3.304em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.492em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1002.44em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-961"><span class="msubsup" id="MathJax-Span-962"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-963" style="font-family: MathJax_Math-italic;">p</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.49em;"><span class="mi" id="MathJax-Span-964" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-965" style="font-family: MathJax_Main; padding-left: 0.273em;">&gt;</span><span class="mi" id="MathJax-Span-966" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">i</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-163">p_i > i</script> we know that <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-164-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-967" style="width: 1.085em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.81em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-968"><span class="msubsup" id="MathJax-Span-969"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-970" style="font-family: MathJax_Math-italic;">p</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.49em;"><span class="mi" id="MathJax-Span-971" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-164">p_i</script> must belong to the right side of the split.</p></div></div> <div class="spoiler"><b class="spoiler-title">Step 3</b><div class="spoiler-content" style="display: block;"><p>If a permutation p is a riffle shuffle of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-165-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-972" style="width: 6.388em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.819em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1004.71em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-973"><span class="mo" id="MathJax-Span-974" style="font-family: MathJax_Main;">[</span><span class="mn" id="MathJax-Span-975" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-976" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-977" style="font-family: MathJax_Main; padding-left: 0.165em;">2</span><span class="mo" id="MathJax-Span-978" style="font-family: MathJax_Main;">,</span><span class="mo" id="MathJax-Span-979" style="font-family: MathJax_Main; padding-left: 0.165em;">…</span><span class="mo" id="MathJax-Span-980" style="font-family: MathJax_Main; padding-left: 0.165em;">,</span><span class="mi" id="MathJax-Span-981" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">n</span><span class="mo" id="MathJax-Span-982" style="font-family: MathJax_Main;">]</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-165">[1,2,\ldots,n]</script>, then it will have three regions described by two integers <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-166-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-983" style="width: 1.572em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.193em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1001.19em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-984"><span class="mi" id="MathJax-Span-985" style="font-family: MathJax_Math-italic;">l</span><span class="mo" id="MathJax-Span-986" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-987" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">r</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-166">l, r</script> as follows:</p> <ul>   <li><p>a prefix where for all <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-167-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-988" style="width: 0.436em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.327em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1000.27em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-989"><span class="mi" id="MathJax-Span-990" style="font-family: MathJax_Math-italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-167">i</script> (<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-168-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-991" style="width: 5.035em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.791em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1003.74em, 2.492em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-992"><span class="mn" id="MathJax-Span-993" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-994" style="font-family: MathJax_Main; padding-left: 0.273em;">≤</span><span class="mi" id="MathJax-Span-995" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">i</span><span class="mo" id="MathJax-Span-996" style="font-family: MathJax_Main; padding-left: 0.273em;">≤</span><span class="mi" id="MathJax-Span-997" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">l</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 1.218em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-168">1 \le i \le l</script>) we have <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-169-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-998" style="width: 3.304em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.492em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1002.44em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-999"><span class="msubsup" id="MathJax-Span-1000"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-1001" style="font-family: MathJax_Math-italic;">p</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.49em;"><span class="mi" id="MathJax-Span-1002" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-1003" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mi" id="MathJax-Span-1004" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">i</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-169">p_i = i</script>.</p></li>   <li><p>a suffix where for all <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-170-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1005" style="width: 0.436em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.327em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1000.27em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1006"><span class="mi" id="MathJax-Span-1007" style="font-family: MathJax_Math-italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-170">i</script> (<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-171-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1008" style="width: 5.36em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.061em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1004.06em, 2.492em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1009"><span class="mi" id="MathJax-Span-1010" style="font-family: MathJax_Math-italic;">r</span><span class="mo" id="MathJax-Span-1011" style="font-family: MathJax_Main; padding-left: 0.273em;">≤</span><span class="mi" id="MathJax-Span-1012" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">i</span><span class="mo" id="MathJax-Span-1013" style="font-family: MathJax_Main; padding-left: 0.273em;">≤</span><span class="mi" id="MathJax-Span-1014" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">n</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 1.218em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-171">r \le i \le n</script>) we have <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-172-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1015" style="width: 3.304em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.492em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1002.44em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1016"><span class="msubsup" id="MathJax-Span-1017"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-1018" style="font-family: MathJax_Math-italic;">p</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.49em;"><span class="mi" id="MathJax-Span-1019" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-1020" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mi" id="MathJax-Span-1021" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">i</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-172">p_i = i</script>.</p></li>   <li><p>a middle region where for all <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-173-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1022" style="width: 0.436em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.327em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1000.27em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1023"><span class="mi" id="MathJax-Span-1024" style="font-family: MathJax_Math-italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-173">i</script> (<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-174-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1025" style="width: 4.927em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.736em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1003.74em, 2.384em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1026"><span class="mi" id="MathJax-Span-1027" style="font-family: MathJax_Math-italic;">l</span><span class="mo" id="MathJax-Span-1028" style="font-family: MathJax_Main; padding-left: 0.273em;">&lt;</span><span class="mi" id="MathJax-Span-1029" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">i</span><span class="mo" id="MathJax-Span-1030" style="font-family: MathJax_Main; padding-left: 0.273em;">&lt;</span><span class="mi" id="MathJax-Span-1031" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">r</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.139em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-174">l < i < r</script>) we have <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-175-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1032" style="width: 3.304em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.492em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1002.44em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1033"><span class="msubsup" id="MathJax-Span-1034"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-1035" style="font-family: MathJax_Math-italic;">p</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.49em;"><span class="mi" id="MathJax-Span-1036" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-1037" style="font-family: MathJax_Main; padding-left: 0.273em;">≠</span><span class="mi" id="MathJax-Span-1038" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">i</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.361em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-175">p_i \ne i</script>.</p></li> </ul><p>See that the first region will all belong to the left side of the split, and the last region will all belong to the right side of the split. Additionally, we can deduce the side of the entire middle region from Step 2. There is a single edge case to this where <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-176-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1039" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.49em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1040"><span class="mi" id="MathJax-Span-1041" style="font-family: MathJax_Math-italic;">p</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-176">p</script> is the sorted permutation.</p></div></div> <div class="spoiler"><b class="spoiler-title">Step 4</b><div class="spoiler-content" style="display: block;"><p>Suppose there is an index <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-177-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1042" style="width: 0.436em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.327em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1000.27em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1043"><span class="mi" id="MathJax-Span-1044" style="font-family: MathJax_Math-italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-177">i</script> where <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-178-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1045" style="width: 3.358em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.546em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1002.49em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1046"><span class="msubsup" id="MathJax-Span-1047"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-1048" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-1049" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-1050" style="font-family: MathJax_Main; padding-left: 0.273em;">≠</span><span class="mi" id="MathJax-Span-1051" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">i</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.361em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-178">a_i \ne i</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-179-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1052" style="width: 4.602em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.466em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1003.41em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1053"><span class="msubsup" id="MathJax-Span-1054"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-1055" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-1056" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-1057" style="font-family: MathJax_Main; padding-left: 0.273em;">≠</span><span class="mo" id="MathJax-Span-1058" style="font-family: MathJax_Main; padding-left: 0.273em;">−</span><span class="mn" id="MathJax-Span-1059" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.361em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-179">a_i \ne -1</script>, or in other words, the sorted permutation is not valid. In this case, from Step 3, we can deduce the side of every element <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-180-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1060" style="width: 0.436em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.327em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1000.27em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1061"><span class="mi" id="MathJax-Span-1062" style="font-family: MathJax_Math-italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-180">i</script> where <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-181-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1063" style="width: 4.602em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.466em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1003.41em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1064"><span class="msubsup" id="MathJax-Span-1065"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-1066" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-1067" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-1068" style="font-family: MathJax_Main; padding-left: 0.273em;">≠</span><span class="mo" id="MathJax-Span-1069" style="font-family: MathJax_Main; padding-left: 0.273em;">−</span><span class="mn" id="MathJax-Span-1070" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.361em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-181">a_i \ne -1</script>.</p></div></div> <div class="spoiler"><b class="spoiler-title">Step 5</b><div class="spoiler-content" style="display: block;"><p>For the opposite case to Step 4 (i.e, the case where the sorted permutation is valid), can you think of a way to solve this?</p> <div class="spoiler"><b class="spoiler-title">Step 5.1</b><div class="spoiler-content" style="display: block;"><p>Can you find a closed form formula for the case where <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-182-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1071" style="width: 4.494em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.412em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1003.36em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1072"><span class="msubsup" id="MathJax-Span-1073"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-1074" style="font-family: MathJax_Math-italic;">p</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.49em;"><span class="mi" id="MathJax-Span-1075" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-1076" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mo" id="MathJax-Span-1077" style="font-family: MathJax_Main; padding-left: 0.273em;">−</span><span class="mn" id="MathJax-Span-1078" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-182">p_i = -1</script> for all <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-183-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1079" style="width: 0.436em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.327em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1000.27em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1080"><span class="mi" id="MathJax-Span-1081" style="font-family: MathJax_Math-italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-183">i</script>?</p></div></div> <div class="spoiler"><b class="spoiler-title">Step 5.2</b><div class="spoiler-content" style="display: block;"><p>There is almost a bijection between colouring an array in two colours and valid riffle shuffles of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-184-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1082" style="width: 6.388em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.819em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1004.71em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1083"><span class="mo" id="MathJax-Span-1084" style="font-family: MathJax_Main;">[</span><span class="mn" id="MathJax-Span-1085" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-1086" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-1087" style="font-family: MathJax_Main; padding-left: 0.165em;">2</span><span class="mo" id="MathJax-Span-1088" style="font-family: MathJax_Main;">,</span><span class="mo" id="MathJax-Span-1089" style="font-family: MathJax_Main; padding-left: 0.165em;">…</span><span class="mo" id="MathJax-Span-1090" style="font-family: MathJax_Main; padding-left: 0.165em;">,</span><span class="mi" id="MathJax-Span-1091" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">n</span><span class="mo" id="MathJax-Span-1092" style="font-family: MathJax_Main;">]</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-184">[1,2,\ldots,n]</script> with the sole edge case being the sorted permutation, which is counted <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-185-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1093" style="width: 3.087em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.33em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1002.27em, 2.438em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1094"><span class="mi" id="MathJax-Span-1095" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-1096" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mn" id="MathJax-Span-1097" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.211em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-185">n - 1</script> times, if we account for this we obtain the formula <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-186-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1098" style="width: 3.736em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.817em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1002.82em, 2.438em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1099"><span class="msubsup" id="MathJax-Span-1100"><span style="display: inline-block; position: relative; width: 0.977em; height: 0px;"><span style="position: absolute; clip: rect(3.195em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mn" id="MathJax-Span-1101" style="font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -4.38em; left: 0.49em;"><span class="mi" id="MathJax-Span-1102" style="font-size: 70.7%; font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-1103" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mi" id="MathJax-Span-1104" style="font-family: MathJax_Math-italic; padding-left: 0.219em;">n</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.211em; border-left: 0px solid; width: 0px; height: 1.218em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-186">2^n - n</script>.</p></div></div> <div class="spoiler"><b class="spoiler-title">Step 5.3</b><div class="spoiler-content" style="display: block;"><p>Now that we have a formula, from Step 3 we should just find the number of ways to fill each run of consecutive <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-187-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1105" style="width: 1.734em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.301em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1001.25em, 2.438em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1106"><span class="mo" id="MathJax-Span-1107" style="font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-1108" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.211em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-187">-1</script>, leaving everything outside as the prefix and suffix as discussed in Hint 3. Solving a consecutive run of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-188-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1109" style="width: 1.734em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.301em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1001.25em, 2.438em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1110"><span class="mo" id="MathJax-Span-1111" style="font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-1112" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.211em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-188">-1</script> is equivalent to solving the case in Step 5.1 on a smaller array. So we just solve each of these runs and sum to get the answer for this case.</p></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Step 6</b><div class="spoiler-content" style="display: block;"><p>Now lets solve the same case as Step 4. For each <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-189-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1113" style="width: 0.76em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.544em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.54em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1114"><span class="mi" id="MathJax-Span-1115" style="font-family: MathJax_Math-italic;">k</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-189">k</script>, consider a consecutive run of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-190-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1116" style="width: 1.734em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.301em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1001.25em, 2.438em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1117"><span class="mo" id="MathJax-Span-1118" style="font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-1119" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.211em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-190">-1</script> and try to find the number of ways to fill it, lets try to find some nice properties for some cases. Let me introduce some notation, I will type each gap in the following way:</p> <ul>   <li><p>an <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-191-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1120" style="width: 2.871em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.167em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1002.11em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1121"><span class="mi" id="MathJax-Span-1122" style="font-family: MathJax_Math-italic;">l</span><span class="mo" id="MathJax-Span-1123" style="font-family: MathJax_Main; padding-left: 0.273em;">→</span><span class="mi" id="MathJax-Span-1124" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">l</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-191">l \rightarrow l</script> gap means the element immediately before the gap belongs to the left side of the split and the element after belongs to the left side of the split.</p></li>   <li><p>an <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-192-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1125" style="width: 3.033em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.275em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1002.27em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1126"><span class="mi" id="MathJax-Span-1127" style="font-family: MathJax_Math-italic;">l</span><span class="mo" id="MathJax-Span-1128" style="font-family: MathJax_Main; padding-left: 0.273em;">→</span><span class="mi" id="MathJax-Span-1129" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">r</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-192">l \rightarrow r</script> gap means the element immediately before the gap belongs to the left side of the split and the element after belongs to the right side of the split.</p></li>   <li><p>similar notation for <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-193-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1130" style="width: 3.033em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.275em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1002.22em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1131"><span class="mi" id="MathJax-Span-1132" style="font-family: MathJax_Math-italic;">r</span><span class="mo" id="MathJax-Span-1133" style="font-family: MathJax_Main; padding-left: 0.273em;">→</span><span class="mi" id="MathJax-Span-1134" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">l</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-193">r \rightarrow l</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-194-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1135" style="width: 3.249em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.438em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1002.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1136"><span class="mi" id="MathJax-Span-1137" style="font-family: MathJax_Math-italic;">r</span><span class="mo" id="MathJax-Span-1138" style="font-family: MathJax_Main; padding-left: 0.273em;">→</span><span class="mi" id="MathJax-Span-1139" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">r</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.861em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-194">r \rightarrow r</script>.</p></li> </ul><p>Now notice that for any <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-195-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1140" style="width: 0.76em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.544em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.54em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1141"><span class="mi" id="MathJax-Span-1142" style="font-family: MathJax_Math-italic;">k</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-195">k</script>, the number of ways to fill an <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-196-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1143" style="width: 2.871em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.167em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1002.11em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1144"><span class="mi" id="MathJax-Span-1145" style="font-family: MathJax_Math-italic;">l</span><span class="mo" id="MathJax-Span-1146" style="font-family: MathJax_Main; padding-left: 0.273em;">→</span><span class="mi" id="MathJax-Span-1147" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">l</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-196">l \rightarrow l</script> or <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-197-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1148" style="width: 3.249em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.438em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1002.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1149"><span class="mi" id="MathJax-Span-1150" style="font-family: MathJax_Math-italic;">r</span><span class="mo" id="MathJax-Span-1151" style="font-family: MathJax_Main; padding-left: 0.273em;">→</span><span class="mi" id="MathJax-Span-1152" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">r</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.861em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-197">r \rightarrow r</script> gap will always be the same.</p></div></div> <div class="spoiler"><b class="spoiler-title">Step 7</b><div class="spoiler-content" style="display: block;"><p>For the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-198-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1153" style="width: 3.033em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.275em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1002.27em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1154"><span class="mi" id="MathJax-Span-1155" style="font-family: MathJax_Math-italic;">l</span><span class="mo" id="MathJax-Span-1156" style="font-family: MathJax_Main; padding-left: 0.273em;">→</span><span class="mi" id="MathJax-Span-1157" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">r</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-198">l \rightarrow r</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-199-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1158" style="width: 3.033em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.275em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1002.22em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1159"><span class="mi" id="MathJax-Span-1160" style="font-family: MathJax_Math-italic;">r</span><span class="mo" id="MathJax-Span-1161" style="font-family: MathJax_Main; padding-left: 0.273em;">→</span><span class="mi" id="MathJax-Span-1162" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">l</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-199">r \rightarrow l</script> gaps, we have to get a bit more creative. The key thing to notice is that each <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-200-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1163" style="width: 0.76em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.544em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.54em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1164"><span class="mi" id="MathJax-Span-1165" style="font-family: MathJax_Math-italic;">k</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-200">k</script> will demand a unique number of elements from the left side of the split to be placed inside the gap. Now since the number of left elements must be between <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-201-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1166" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1167"><span class="mn" id="MathJax-Span-1168" style="font-family: MathJax_Main;">0</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-201">0</script> and the size of the gap, we can restrict the number of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-202-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1169" style="width: 0.76em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.544em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.54em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1170"><span class="mi" id="MathJax-Span-1171" style="font-family: MathJax_Math-italic;">k</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-202">k</script> we need to consider to no more than the size of the gap!</p></div></div> <div class="spoiler"><b class="spoiler-title">Step 8</b><div class="spoiler-content" style="display: block;"><p>For each gap, calculate this range of valid <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-203-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1172" style="width: 0.76em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.544em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.54em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1173"><span class="mi" id="MathJax-Span-1174" style="font-family: MathJax_Math-italic;">k</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-203">k</script>, and take the intersection of all the ranges. Now if we use a very similar implementation to the easy version of the problem but only consider <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-204-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1175" style="width: 0.76em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.544em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.54em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1176"><span class="mi" id="MathJax-Span-1177" style="font-family: MathJax_Math-italic;">k</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-204">k</script> within this range, and skipping <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-205-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1178" style="width: 2.871em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.167em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1002.11em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1179"><span class="mi" id="MathJax-Span-1180" style="font-family: MathJax_Math-italic;">l</span><span class="mo" id="MathJax-Span-1181" style="font-family: MathJax_Main; padding-left: 0.273em;">→</span><span class="mi" id="MathJax-Span-1182" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">l</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-205">l \rightarrow l</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-206-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1183" style="width: 3.249em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.438em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1002.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1184"><span class="mi" id="MathJax-Span-1185" style="font-family: MathJax_Math-italic;">r</span><span class="mo" id="MathJax-Span-1186" style="font-family: MathJax_Main; padding-left: 0.273em;">→</span><span class="mi" id="MathJax-Span-1187" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">r</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.861em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-206">r \rightarrow r</script> gaps by calculating their contribution separately, the problem will be solved. Since, say, the range of valid <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-207-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1188" style="width: 0.76em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.544em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.54em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1189"><span class="mi" id="MathJax-Span-1190" style="font-family: MathJax_Math-italic;">k</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-207">k</script> has size <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-208-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1191" style="width: 0.814em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.54em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1192"><span class="mi" id="MathJax-Span-1193" style="font-family: MathJax_Math-italic;">x</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-208">x</script>, then the number of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-209-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1194" style="width: 3.033em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.275em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1002.27em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1195"><span class="mi" id="MathJax-Span-1196" style="font-family: MathJax_Math-italic;">l</span><span class="mo" id="MathJax-Span-1197" style="font-family: MathJax_Main; padding-left: 0.273em;">→</span><span class="mi" id="MathJax-Span-1198" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">r</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-209">l \rightarrow r</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-210-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1199" style="width: 3.033em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.275em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1002.22em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1200"><span class="mi" id="MathJax-Span-1201" style="font-family: MathJax_Math-italic;">r</span><span class="mo" id="MathJax-Span-1202" style="font-family: MathJax_Main; padding-left: 0.273em;">→</span><span class="mi" id="MathJax-Span-1203" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">l</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-210">r \rightarrow l</script> gaps will be no more than approximately <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-211-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1204" style="width: 2.221em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.68em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1001.63em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1205"><span class="mi" id="MathJax-Span-1206" style="font-family: MathJax_Math-italic;">n</span><span class="texatom" id="MathJax-Span-1207"><span class="mrow" id="MathJax-Span-1208"><span class="mo" id="MathJax-Span-1209" style="font-family: MathJax_Main;">/</span></span></span><span class="mi" id="MathJax-Span-1210" style="font-family: MathJax_Math-italic;">x</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-211">n/x</script>, and so the final time complexity is <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-212-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1211" style="width: 5.955em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.494em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1004.39em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1212"><span class="mi" id="MathJax-Span-1213" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-1214" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1215" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-1216" style="font-family: MathJax_Main; padding-left: 0.219em;">⋅</span><span class="mi" id="MathJax-Span-1217" style="font-family: MathJax_Math-italic; padding-left: 0.219em;">n</span><span class="texatom" id="MathJax-Span-1218"><span class="mrow" id="MathJax-Span-1219"><span class="mo" id="MathJax-Span-1220" style="font-family: MathJax_Main;">/</span></span></span><span class="mi" id="MathJax-Span-1221" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-1222" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-212">O(x \cdot n/x)</script>, which is <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-213-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1223" style="width: 2.871em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.167em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1002.06em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1224"><span class="mi" id="MathJax-Span-1225" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-1226" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1227" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-1228" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-213">O(n)</script>.</p></div></div> <div class="spoiler"><b class="spoiler-title">Implementation(C++)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">typedef</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> ll</span><span class="pun">;</span><span class="pln">
</span><span class="com">#define</span><span class="pln"> debug</span><span class="pun">(</span><span class="pln">x</span><span class="pun">)</span><span class="pln"> cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="com">#x &lt;&lt; " = " &lt;&lt; x &lt;&lt; "\n";</span><span class="pln">
</span><span class="com">#define</span><span class="pln"> vdebug</span><span class="pun">(</span><span class="pln">a</span><span class="pun">)</span><span class="pln"> cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="com">#a &lt;&lt; " = "; for(auto x: a) cout &lt;&lt; x &lt;&lt; " "; cout &lt;&lt; "\n";</span><span class="pln">
mt19937 rng</span><span class="pun">(</span><span class="pln">chrono</span><span class="pun">::</span><span class="pln">steady_clock</span><span class="pun">::</span><span class="pln">now</span><span class="pun">().</span><span class="pln">time_since_epoch</span><span class="pun">().</span><span class="pln">count</span><span class="pun">());</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> uid</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> uniform_int_distribution</span><span class="str">&lt;int&gt;</span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">)(</span><span class="pln">rng</span><span class="pun">);</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
ll uld</span><span class="pun">(</span><span class="pln">ll a</span><span class="pun">,</span><span class="pln"> ll b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> uniform_int_distribution</span><span class="str">&lt;ll&gt;</span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">)(</span><span class="pln">rng</span><span class="pun">);</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> MOD </span><span class="pun">=</span><span class="pln"> </span><span class="lit">998244353</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">template</span><span class="pun">&lt;</span><span class="pln">ll mod</span><span class="pun">&gt;</span><span class="pln"> </span><span class="com">// template was not stolen from https://codeforces.com/profile/SharpEdged</span><span class="pln">
</span><span class="kwd">struct</span><span class="pln"> modnum </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">constexpr</span><span class="pln"> </span><span class="kwd">bool</span><span class="pln"> is_big_mod </span><span class="pun">=</span><span class="pln"> mod </span><span class="pun">&gt;</span><span class="pln"> numeric_limits</span><span class="str">&lt;int&gt;</span><span class="pun">::</span><span class="pln">max</span><span class="pun">();</span><span class="pln">

    </span><span class="kwd">using</span><span class="pln"> S </span><span class="pun">=</span><span class="pln"> </span><span class="typ">conditional_t</span><span class="pun">&lt;</span><span class="pln">is_big_mod</span><span class="pun">,</span><span class="pln"> ll</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">&gt;;</span><span class="pln">
    </span><span class="kwd">using</span><span class="pln"> L </span><span class="pun">=</span><span class="pln"> </span><span class="typ">conditional_t</span><span class="pun">&lt;</span><span class="pln">is_big_mod</span><span class="pun">,</span><span class="pln"> __int128</span><span class="pun">,</span><span class="pln"> ll</span><span class="pun">&gt;;</span><span class="pln">

    S x</span><span class="pun">;</span><span class="pln">

    modnum</span><span class="pun">()</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> x</span><span class="pun">(</span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">
    modnum</span><span class="pun">(</span><span class="pln">ll _x</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        _x </span><span class="pun">%=</span><span class="pln"> </span><span class="kwd">static_cast</span><span class="str">&lt;ll&gt;</span><span class="pun">(</span><span class="pln">mod</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">_x </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> _x </span><span class="pun">+=</span><span class="pln"> mod</span><span class="pun">;</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
        x </span><span class="pun">=</span><span class="pln"> _x</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    modnum pow</span><span class="pun">(</span><span class="pln">ll n</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">const</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        modnum res </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
        modnum cur </span><span class="pun">=</span><span class="pln"> </span><span class="pun">*</span><span class="kwd">this</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">n </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">n </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> res </span><span class="pun">*=</span><span class="pln"> cur</span><span class="pun">;</span><span class="pln">
            cur </span><span class="pun">*=</span><span class="pln"> cur</span><span class="pun">;</span><span class="pln">
            n </span><span class="pun">/=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> res</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    modnum inv</span><span class="pun">()</span><span class="pln"> </span><span class="kwd">const</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">(*</span><span class="kwd">this</span><span class="pun">).</span><span class="pln">pow</span><span class="pun">(</span><span class="pln">mod</span><span class="pun">-</span><span class="lit">2</span><span class="pun">);</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    
    modnum</span><span class="pun">&amp;</span><span class="pln"> </span><span class="kwd">operator</span><span class="pun">+=(</span><span class="kwd">const</span><span class="pln"> modnum</span><span class="pun">&amp;</span><span class="pln"> a</span><span class="pun">){</span><span class="pln">
        x </span><span class="pun">+=</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">x</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x </span><span class="pun">&gt;=</span><span class="pln"> mod</span><span class="pun">)</span><span class="pln"> x </span><span class="pun">-=</span><span class="pln"> mod</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">*</span><span class="kwd">this</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    modnum</span><span class="pun">&amp;</span><span class="pln"> </span><span class="kwd">operator</span><span class="pun">-=(</span><span class="kwd">const</span><span class="pln"> modnum</span><span class="pun">&amp;</span><span class="pln"> a</span><span class="pun">){</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x </span><span class="pun">&lt;</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">x</span><span class="pun">)</span><span class="pln"> x </span><span class="pun">+=</span><span class="pln"> mod</span><span class="pun">;</span><span class="pln">
        x </span><span class="pun">-=</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">x</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">*</span><span class="kwd">this</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    modnum</span><span class="pun">&amp;</span><span class="pln"> </span><span class="kwd">operator</span><span class="pun">*=(</span><span class="kwd">const</span><span class="pln"> modnum</span><span class="pun">&amp;</span><span class="pln"> a</span><span class="pun">){</span><span class="pln">
        x </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">static_cast</span><span class="pun">&lt;</span><span class="pln">L</span><span class="pun">&gt;(</span><span class="pln">x</span><span class="pun">)</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">x </span><span class="pun">%</span><span class="pln"> mod</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">*</span><span class="kwd">this</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    modnum</span><span class="pun">&amp;</span><span class="pln"> </span><span class="kwd">operator</span><span class="pun">/=(</span><span class="kwd">const</span><span class="pln"> modnum</span><span class="pun">&amp;</span><span class="pln"> a</span><span class="pun">){</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">*</span><span class="kwd">this</span><span class="pln"> </span><span class="pun">*=</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">inv</span><span class="pun">();</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    
    </span><span class="kwd">friend</span><span class="pln"> modnum </span><span class="kwd">operator</span><span class="pun">+(</span><span class="kwd">const</span><span class="pln"> modnum</span><span class="pun">&amp;</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">const</span><span class="pln"> modnum</span><span class="pun">&amp;</span><span class="pln"> b</span><span class="pun">){</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> modnum</span><span class="pun">(</span><span class="pln">a</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+=</span><span class="pln"> b</span><span class="pun">;</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">friend</span><span class="pln"> modnum </span><span class="kwd">operator</span><span class="pun">-(</span><span class="kwd">const</span><span class="pln"> modnum</span><span class="pun">&amp;</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">const</span><span class="pln"> modnum</span><span class="pun">&amp;</span><span class="pln"> b</span><span class="pun">){</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> modnum</span><span class="pun">(</span><span class="pln">a</span><span class="pun">)</span><span class="pln"> </span><span class="pun">-=</span><span class="pln"> b</span><span class="pun">;</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">friend</span><span class="pln"> modnum </span><span class="kwd">operator</span><span class="pun">*(</span><span class="kwd">const</span><span class="pln"> modnum</span><span class="pun">&amp;</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">const</span><span class="pln"> modnum</span><span class="pun">&amp;</span><span class="pln"> b</span><span class="pun">){</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> modnum</span><span class="pun">(</span><span class="pln">a</span><span class="pun">)</span><span class="pln"> </span><span class="pun">*=</span><span class="pln"> b</span><span class="pun">;</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">friend</span><span class="pln"> modnum </span><span class="kwd">operator</span><span class="pun">/(</span><span class="kwd">const</span><span class="pln"> modnum</span><span class="pun">&amp;</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">const</span><span class="pln"> modnum</span><span class="pun">&amp;</span><span class="pln"> b</span><span class="pun">){</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> modnum</span><span class="pun">(</span><span class="pln">a</span><span class="pun">)</span><span class="pln"> </span><span class="pun">/=</span><span class="pln"> b</span><span class="pun">;</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    
    </span><span class="kwd">friend</span><span class="pln"> </span><span class="kwd">bool</span><span class="pln"> </span><span class="kwd">operator</span><span class="pun">==(</span><span class="kwd">const</span><span class="pln"> modnum</span><span class="pun">&amp;</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">const</span><span class="pln"> modnum</span><span class="pun">&amp;</span><span class="pln"> b</span><span class="pun">){</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">x </span><span class="pun">==</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">x</span><span class="pun">;</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">friend</span><span class="pln"> </span><span class="kwd">bool</span><span class="pln"> </span><span class="kwd">operator</span><span class="pun">!=(</span><span class="kwd">const</span><span class="pln"> modnum</span><span class="pun">&amp;</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">const</span><span class="pln"> modnum</span><span class="pun">&amp;</span><span class="pln"> b</span><span class="pun">){</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">x </span><span class="pun">!=</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">x</span><span class="pun">;</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">friend</span><span class="pln"> </span><span class="kwd">bool</span><span class="pln"> </span><span class="kwd">operator</span><span class="pun">&lt;(</span><span class="kwd">const</span><span class="pln"> modnum</span><span class="pun">&amp;</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">const</span><span class="pln"> modnum</span><span class="pun">&amp;</span><span class="pln"> b</span><span class="pun">){</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">x </span><span class="pun">&lt;</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">x</span><span class="pun">;</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">friend</span><span class="pln"> ostream</span><span class="pun">&amp;</span><span class="pln"> </span><span class="kwd">operator</span><span class="pun">&lt;&lt;(</span><span class="pln">ostream</span><span class="pun">&amp;</span><span class="pln"> os</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">const</span><span class="pln"> modnum</span><span class="pun">&amp;</span><span class="pln"> a</span><span class="pun">){</span><span class="pln"> os </span><span class="pun">&lt;&lt;</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">x</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> os</span><span class="pun">;</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">friend</span><span class="pln"> istream</span><span class="pun">&amp;</span><span class="pln"> </span><span class="kwd">operator</span><span class="pun">&gt;&gt;(</span><span class="pln">istream</span><span class="pun">&amp;</span><span class="pln"> </span><span class="kwd">is</span><span class="pun">,</span><span class="pln"> modnum</span><span class="pun">&amp;</span><span class="pln"> a</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> ll x</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">is</span><span class="pln"> </span><span class="pun">&gt;&gt;</span><span class="pln"> x</span><span class="pun">;</span><span class="pln"> a </span><span class="pun">=</span><span class="pln"> modnum</span><span class="pun">(</span><span class="pln">x</span><span class="pun">);</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">is</span><span class="pun">;</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">};</span><span class="pln">

</span><span class="kwd">using</span><span class="pln"> mint </span><span class="pun">=</span><span class="pln"> modnum</span><span class="pun">&lt;</span><span class="pln">MOD</span><span class="pun">&gt;;</span><span class="pln">

</span><span class="kwd">struct</span><span class="pln"> </span><span class="typ">Combi</span><span class="pun">{</span><span class="pln">
    vector</span><span class="str">&lt;mint&gt;</span><span class="pln"> _fac</span><span class="pun">,</span><span class="pln"> _ifac</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
    
    </span><span class="typ">Combi</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        n </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
        _fac</span><span class="pun">.</span><span class="pln">assign</span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
        _ifac</span><span class="pun">.</span><span class="pln">assign</span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    
    </span><span class="kwd">void</span><span class="pln"> check_size</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> m</span><span class="pun">){</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> need </span><span class="pun">=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">need </span><span class="pun">&lt;</span><span class="pln"> m</span><span class="pun">)</span><span class="pln"> need </span><span class="pun">*=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln">
        m </span><span class="pun">=</span><span class="pln"> need</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">m </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">return</span><span class="pun">;</span><span class="pln">
        
        _fac</span><span class="pun">.</span><span class="pln">resize</span><span class="pun">(</span><span class="pln">m </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
        _ifac</span><span class="pun">.</span><span class="pln">resize</span><span class="pun">(</span><span class="pln">m </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> m</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> _fac</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> i </span><span class="pun">*</span><span class="pln"> _fac</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">];</span><span class="pln">
        
        _ifac</span><span class="pun">[</span><span class="pln">m</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> _fac</span><span class="pun">[</span><span class="pln">m</span><span class="pun">].</span><span class="pln">inv</span><span class="pun">();</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> m </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&gt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">--)</span><span class="pln"> _ifac</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> _ifac</span><span class="pun">[</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
        n </span><span class="pun">=</span><span class="pln"> m</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    
    mint fac</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> m</span><span class="pun">){</span><span class="pln">
        check_size</span><span class="pun">(</span><span class="pln">m</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> _fac</span><span class="pun">[</span><span class="pln">m</span><span class="pun">];</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    
    mint ifac</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> m</span><span class="pun">){</span><span class="pln">
        check_size</span><span class="pun">(</span><span class="pln">m</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> _ifac</span><span class="pun">[</span><span class="pln">m</span><span class="pun">];</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    
    mint ncr</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> r</span><span class="pun">){</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">n </span><span class="pun">&lt;</span><span class="pln"> r </span><span class="pun">||</span><span class="pln"> r </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
        
        </span><span class="kwd">return</span><span class="pln"> fac</span><span class="pun">(</span><span class="pln">n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> ifac</span><span class="pun">(</span><span class="pln">n </span><span class="pun">-</span><span class="pln"> r</span><span class="pun">)</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> ifac</span><span class="pun">(</span><span class="pln">r</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    
    mint npr</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> r</span><span class="pun">){</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">n </span><span class="pun">&lt;</span><span class="pln"> r </span><span class="pun">||</span><span class="pln"> r </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
        
        </span><span class="kwd">return</span><span class="pln"> fac</span><span class="pun">(</span><span class="pln">n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> ifac</span><span class="pun">(</span><span class="pln">n </span><span class="pun">-</span><span class="pln"> r</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> comb</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">void</span><span class="pln"> solve</span><span class="pun">(){</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">

    vector</span><span class="str">&lt;int&gt;</span><span class="pln"> a</span><span class="pun">(</span><span class="pln">n</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">x </span><span class="pun">:</span><span class="pln"> a</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        cin </span><span class="pun">&gt;&gt;</span><span class="pln"> x</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x </span><span class="pun">!=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">)</span><span class="pln">
            x</span><span class="pun">--;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">bool</span><span class="pln"> </span><span class="kwd">fixed</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> i</span><span class="pun">)</span><span class="pln">
            </span><span class="kwd">fixed</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">fixed</span><span class="pun">){</span><span class="pln"> </span><span class="com">//case where all a[i] != -1 has a[i] = i</span><span class="pln">
        vector</span><span class="str">&lt;mint&gt;</span><span class="pln"> prod</span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
        prod</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
            prod</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> prod</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln">

        </span><span class="kwd">int</span><span class="pln"> </span><span class="kwd">last</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">;</span><span class="pln">
        mint ans </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++){</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="pun">==</span><span class="pln"> n </span><span class="pun">||</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">){</span><span class="pln">
                </span><span class="kwd">int</span><span class="pln"> len </span><span class="pun">=</span><span class="pln"> i </span><span class="pun">-</span><span class="pln"> </span><span class="kwd">last</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
                ans </span><span class="pun">+=</span><span class="pln"> prod</span><span class="pun">[</span><span class="pln">len</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> len </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
                </span><span class="kwd">last</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> i</span><span class="pun">;</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">

        ans </span><span class="pun">+=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
        cout </span><span class="pun">&lt;&lt;</span><span class="pln"> ans </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"\n"</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">return</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    vector</span><span class="str">&lt;bool&gt;</span><span class="pln"> side</span><span class="pun">(</span><span class="pln">n</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">bool</span><span class="pln"> found </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++){</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">)</span><span class="pln">
            </span><span class="kwd">continue</span><span class="pun">;</span><span class="pln">

        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> i</span><span class="pun">)</span><span class="pln">
            side</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln"> </span><span class="com">// left side</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> i</span><span class="pun">)</span><span class="pln">
            side</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln"> </span><span class="com">// right side</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> i</span><span class="pun">)</span><span class="pln">
            side</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> found</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> i</span><span class="pun">)</span><span class="pln">
            found </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">int</span><span class="pln"> </span><span class="kwd">last</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">;</span><span class="pln">
    vector</span><span class="pun">&lt;</span><span class="pln">array</span><span class="pun">&lt;</span><span class="kwd">int</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">&gt;&gt;</span><span class="pln"> ranges</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++){</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">)</span><span class="pln">
            </span><span class="kwd">continue</span><span class="pun">;</span><span class="pln">
        
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">last</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">){</span><span class="pln">
            </span><span class="kwd">last</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> i</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">continue</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">

        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">side</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> </span><span class="pun">!</span><span class="pln">side</span><span class="pun">[</span><span class="kwd">last</span><span class="pun">]){</span><span class="pln"> </span><span class="com">// left -&gt; right gap</span><span class="pln">
            </span><span class="kwd">int</span><span class="pln"> mn </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">last</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> a</span><span class="pun">[</span><span class="kwd">last</span><span class="pun">];</span><span class="pln"> </span><span class="com">// min right already placed</span><span class="pln">
            </span><span class="kwd">int</span><span class="pln"> mx </span><span class="pun">=</span><span class="pln"> mn </span><span class="pun">+</span><span class="pln"> i </span><span class="pun">-</span><span class="pln"> </span><span class="kwd">last</span><span class="pun">;</span><span class="pln"> </span><span class="com">// max right already placed</span><span class="pln">
            ranges</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">({</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> mx</span><span class="pun">,</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> mn </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">});</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">

        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">side</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> side</span><span class="pun">[</span><span class="kwd">last</span><span class="pun">]){</span><span class="pln"> </span><span class="com">// right -&gt; left gap</span><span class="pln">
            </span><span class="kwd">int</span><span class="pln"> mx </span><span class="pun">=</span><span class="pln"> i </span><span class="pun">-</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln"> </span><span class="com">// max right placed by last</span><span class="pln">
            </span><span class="kwd">int</span><span class="pln"> mn </span><span class="pun">=</span><span class="pln"> mx </span><span class="pun">-</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="kwd">last</span><span class="pun">);</span><span class="pln"> </span><span class="com">// min right placed by last</span><span class="pln">
            ranges</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">({</span><span class="pln">a</span><span class="pun">[</span><span class="kwd">last</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> mx</span><span class="pun">,</span><span class="pln"> a</span><span class="pun">[</span><span class="kwd">last</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> mn </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">});</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">

        </span><span class="kwd">last</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> i</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">int</span><span class="pln"> l </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> r </span><span class="pun">=</span><span class="pln"> n </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">auto</span><span class="pln"> </span><span class="pun">[</span><span class="pln">u</span><span class="pun">,</span><span class="pln"> v</span><span class="pun">]</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> ranges</span><span class="pun">){</span><span class="pln">
        l </span><span class="pun">=</span><span class="pln"> max</span><span class="pun">(</span><span class="pln">l</span><span class="pun">,</span><span class="pln"> u</span><span class="pun">);</span><span class="pln">
        r </span><span class="pun">=</span><span class="pln"> min</span><span class="pun">(</span><span class="pln">r</span><span class="pun">,</span><span class="pln"> v</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    mint coef </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
    vector</span><span class="str">&lt;mint&gt;</span><span class="pln"> score</span><span class="pun">(</span><span class="pln">n</span><span class="pun">);</span><span class="pln"> </span><span class="com">// score[i] = contribution when splitting at i</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> l</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> r</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
        score</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">last</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++){</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">)</span><span class="pln">
            </span><span class="kwd">continue</span><span class="pun">;</span><span class="pln">
        
        </span><span class="kwd">bool</span><span class="pln"> prev </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">last</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">)</span><span class="pln">
            prev </span><span class="pun">=</span><span class="pln"> side</span><span class="pun">[</span><span class="kwd">last</span><span class="pun">];</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> spaces </span><span class="pun">=</span><span class="pln"> i </span><span class="pun">-</span><span class="pln"> </span><span class="kwd">last</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">

        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">side</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> prev </span><span class="pun">||</span><span class="pln"> </span><span class="pun">!</span><span class="pln">side</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> </span><span class="pun">!</span><span class="pln">prev</span><span class="pun">){</span><span class="pln">
            </span><span class="kwd">int</span><span class="pln"> cnt </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">last</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">)</span><span class="pln">
                cnt </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
            </span><span class="kwd">else</span><span class="pln">
                cnt </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> a</span><span class="pun">[</span><span class="kwd">last</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">

            coef </span><span class="pun">*=</span><span class="pln"> comb</span><span class="pun">.</span><span class="pln">ncr</span><span class="pun">(</span><span class="pln">spaces</span><span class="pun">,</span><span class="pln"> cnt</span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">

        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">side</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> </span><span class="pun">!</span><span class="pln">prev</span><span class="pun">){</span><span class="pln"> </span><span class="com">// left -&gt; right</span><span class="pln">
            </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> l</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;=</span><span class="pln"> r</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++){</span><span class="pln">
                </span><span class="kwd">int</span><span class="pln"> placed </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">last</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">)</span><span class="pln">
                    placed </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">last</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> a</span><span class="pun">[</span><span class="kwd">last</span><span class="pun">];</span><span class="pln"> </span><span class="com">// how many right i have placed by last</span><span class="pln">

                </span><span class="kwd">int</span><span class="pln"> need </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">(</span><span class="pln">j </span><span class="pun">+</span><span class="pln"> placed</span><span class="pun">);</span><span class="pln"> </span><span class="com">// j + placed is the next one i need to place after last</span><span class="pln">
                score</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">*=</span><span class="pln"> comb</span><span class="pun">.</span><span class="pln">ncr</span><span class="pun">(</span><span class="pln">spaces</span><span class="pun">,</span><span class="pln"> need</span><span class="pun">);</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">

        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">side</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> prev</span><span class="pun">){</span><span class="pln"> </span><span class="com">// right -&gt; left</span><span class="pln">
            </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> l</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;=</span><span class="pln"> r</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++){</span><span class="pln">
                </span><span class="kwd">int</span><span class="pln"> big </span><span class="pun">=</span><span class="pln"> i </span><span class="pun">-</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> j </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> </span><span class="com">// last right to be placed by i</span><span class="pln">
                
                </span><span class="kwd">int</span><span class="pln"> need </span><span class="pun">=</span><span class="pln"> big </span><span class="pun">-</span><span class="pln"> a</span><span class="pun">[</span><span class="kwd">last</span><span class="pun">];</span><span class="pln">
                score</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">*=</span><span class="pln"> comb</span><span class="pun">.</span><span class="pln">ncr</span><span class="pun">(</span><span class="pln">spaces</span><span class="pun">,</span><span class="pln"> need</span><span class="pun">);</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">

        </span><span class="kwd">last</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> i</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> l</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;=</span><span class="pln"> r</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++){</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">side</span><span class="pun">[</span><span class="kwd">last</span><span class="pun">]){</span><span class="pln">
            score</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">*=</span><span class="pln"> comb</span><span class="pun">.</span><span class="pln">ncr</span><span class="pun">(</span><span class="pln">n </span><span class="pun">-</span><span class="pln"> </span><span class="kwd">last</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> j </span><span class="pun">-</span><span class="pln"> a</span><span class="pun">[</span><span class="kwd">last</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">else</span><span class="pun">{</span><span class="pln">
            score</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">*=</span><span class="pln"> comb</span><span class="pun">.</span><span class="pln">ncr</span><span class="pun">(</span><span class="pln">n </span><span class="pun">-</span><span class="pln"> </span><span class="kwd">last</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> n </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> a</span><span class="pun">[</span><span class="kwd">last</span><span class="pun">]);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    mint ans </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
        ans </span><span class="pun">+=</span><span class="pln"> score</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
    ans </span><span class="pun">*=</span><span class="pln"> coef</span><span class="pun">;</span><span class="pln">
    cout </span><span class="pun">&lt;&lt;</span><span class="pln"> ans </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"\n"</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">(){</span><span class="pln">
    ios</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="kwd">false</span><span class="pun">);</span><span class="pln">
    cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    
    </span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">t</span><span class="pun">--)</span><span class="pln"> solve</span><span class="pun">();</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span></code></pre></div></div><p>Bonus editorial by <a class="rated-user user-orange" href="https://codeforces.com/profile/LMeyling" title="Master LMeyling">LMeyling</a>:</p> <div class="spoiler"><b class="spoiler-title">Solution 2</b><div class="spoiler-content" style="display: block;"><div class="spoiler"><b class="spoiler-title">Hint 1</b><div class="spoiler-content" style="display: block;"><p>Can you uniquely determine, for each element <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-214-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1229" style="width: 1.897em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.41em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1001.3em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1230"><span class="mi" id="MathJax-Span-1231" style="font-family: MathJax_Math-italic;">a</span><span class="mo" id="MathJax-Span-1232" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-1233" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-1234" style="font-family: MathJax_Main;">]</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-214">a[i]</script>, which subsequence it belongs to?</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 2</b><div class="spoiler-content" style="display: block;"><p>For which values of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-215-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1235" style="width: 0.76em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.544em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.54em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1236"><span class="mi" id="MathJax-Span-1237" style="font-family: MathJax_Math-italic;">k</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-215">k</script> does a solution exist?</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><p>Let the subsequence on indices <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-216-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1238" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1239"><span class="mn" id="MathJax-Span-1240" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-216">1</script> to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-217-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1241" style="width: 0.76em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.544em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.54em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1242"><span class="mi" id="MathJax-Span-1243" style="font-family: MathJax_Math-italic;">k</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-217">k</script> be <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-218-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1244" style="width: 0.923em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.65em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1245"><span class="mi" id="MathJax-Span-1246" style="font-family: MathJax_Math-italic;">L</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-218">L</script> and the subsequence on indices <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-219-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1247" style="width: 2.925em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.221em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1002.17em, 2.438em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1248"><span class="mi" id="MathJax-Span-1249" style="font-family: MathJax_Math-italic;">k</span><span class="mo" id="MathJax-Span-1250" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-1251" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.211em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-219">k+1</script> to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-220-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1252" style="width: 0.814em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.6em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1253"><span class="mi" id="MathJax-Span-1254" style="font-family: MathJax_Math-italic;">n</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-220">n</script> be <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-221-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1255" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.76em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1256"><span class="mi" id="MathJax-Span-1257" style="font-family: MathJax_Math-italic;">R</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-221">R</script>.</p><p>For every <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-222-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1258" style="width: 4.386em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.304em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1003.25em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1259"><span class="mi" id="MathJax-Span-1260" style="font-family: MathJax_Math-italic;">a</span><span class="mo" id="MathJax-Span-1261" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-1262" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-1263" style="font-family: MathJax_Main;">]</span><span class="mo" id="MathJax-Span-1264" style="font-family: MathJax_Main; padding-left: 0.273em;">∈</span><span class="mi" id="MathJax-Span-1265" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">L</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-222">a[i]\in L</script> we have <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-223-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1266" style="width: 6.388em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.819em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1004.76em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1267"><span class="mi" id="MathJax-Span-1268" style="font-family: MathJax_Math-italic;">a</span><span class="mo" id="MathJax-Span-1269" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-1270" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-1271" style="font-family: MathJax_Main;">]</span><span class="mo" id="MathJax-Span-1272" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mi" id="MathJax-Span-1273" style="font-family: MathJax_Math-italic; padding-left: 0.219em;">i</span><span class="mo" id="MathJax-Span-1274" style="font-family: MathJax_Main; padding-left: 0.273em;">≤</span><span class="mn" id="MathJax-Span-1275" style="font-family: MathJax_Main; padding-left: 0.273em;">0</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-223">a[i]-i\le 0</script>, since there must be exactly <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-224-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1276" style="width: 4.169em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.141em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1003.09em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1277"><span class="mi" id="MathJax-Span-1278" style="font-family: MathJax_Math-italic;">a</span><span class="mo" id="MathJax-Span-1279" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-1280" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-1281" style="font-family: MathJax_Main;">]</span><span class="mo" id="MathJax-Span-1282" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mn" id="MathJax-Span-1283" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-224">a[i]-1</script> elements of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-225-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1284" style="width: 0.923em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.65em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1285"><span class="mi" id="MathJax-Span-1286" style="font-family: MathJax_Math-italic;">L</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-225">L</script> before position <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-226-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1287" style="width: 0.436em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.327em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1000.27em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1288"><span class="mi" id="MathJax-Span-1289" style="font-family: MathJax_Math-italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-226">i</script>. Symmetrically, for every <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-227-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1290" style="width: 4.494em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.412em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1003.41em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1291"><span class="mi" id="MathJax-Span-1292" style="font-family: MathJax_Math-italic;">a</span><span class="mo" id="MathJax-Span-1293" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-1294" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-1295" style="font-family: MathJax_Main;">]</span><span class="mo" id="MathJax-Span-1296" style="font-family: MathJax_Main; padding-left: 0.273em;">∈</span><span class="mi" id="MathJax-Span-1297" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">R</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-227">a[i]\in R</script> we have <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-228-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1298" style="width: 6.388em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.819em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1004.76em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1299"><span class="mi" id="MathJax-Span-1300" style="font-family: MathJax_Math-italic;">a</span><span class="mo" id="MathJax-Span-1301" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-1302" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-1303" style="font-family: MathJax_Main;">]</span><span class="mo" id="MathJax-Span-1304" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mi" id="MathJax-Span-1305" style="font-family: MathJax_Math-italic; padding-left: 0.219em;">i</span><span class="mo" id="MathJax-Span-1306" style="font-family: MathJax_Main; padding-left: 0.273em;">≥</span><span class="mn" id="MathJax-Span-1307" style="font-family: MathJax_Main; padding-left: 0.273em;">0</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-228">a[i]-i\ge 0</script>.</p><p>From the same observation, if <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-229-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1308" style="width: 4.386em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.304em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1003.25em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1309"><span class="mi" id="MathJax-Span-1310" style="font-family: MathJax_Math-italic;">a</span><span class="mo" id="MathJax-Span-1311" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-1312" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-1313" style="font-family: MathJax_Main;">]</span><span class="mo" id="MathJax-Span-1314" style="font-family: MathJax_Main; padding-left: 0.273em;">∈</span><span class="mi" id="MathJax-Span-1315" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">L</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-229">a[i]\in L</script> then there must be exactly <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-230-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1316" style="width: 3.953em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.979em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1002.87em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1317"><span class="mi" id="MathJax-Span-1318" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-1319" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mi" id="MathJax-Span-1320" style="font-family: MathJax_Math-italic; padding-left: 0.219em;">a</span><span class="mo" id="MathJax-Span-1321" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-1322" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-1323" style="font-family: MathJax_Main;">]</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-230">i-a[i]</script> indices <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-231-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1324" style="width: 2.708em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.059em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1002em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1325"><span class="mi" id="MathJax-Span-1326" style="font-family: MathJax_Math-italic;">j</span><span class="mo" id="MathJax-Span-1327" style="font-family: MathJax_Main; padding-left: 0.273em;">&lt;</span><span class="mi" id="MathJax-Span-1328" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">i</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-231">j<i</script> with <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-232-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1329" style="width: 4.602em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.466em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1003.47em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1330"><span class="mi" id="MathJax-Span-1331" style="font-family: MathJax_Math-italic;">a</span><span class="mo" id="MathJax-Span-1332" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-1333" style="font-family: MathJax_Math-italic;">j</span><span class="mo" id="MathJax-Span-1334" style="font-family: MathJax_Main;">]</span><span class="mo" id="MathJax-Span-1335" style="font-family: MathJax_Main; padding-left: 0.273em;">∈</span><span class="mi" id="MathJax-Span-1336" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">R</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-232">a[j]\in R</script>. This lets us decide the side of each element except when <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-233-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1337" style="width: 4.115em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.087em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1003.03em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1338"><span class="mi" id="MathJax-Span-1339" style="font-family: MathJax_Math-italic;">a</span><span class="mo" id="MathJax-Span-1340" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-1341" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-1342" style="font-family: MathJax_Main;">]</span><span class="mo" id="MathJax-Span-1343" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mi" id="MathJax-Span-1344" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">i</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-233">a[i]=i</script>, which is ambiguous. Once there exists some <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-234-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1345" style="width: 4.332em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.249em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1003.25em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1346"><span class="mi" id="MathJax-Span-1347" style="font-family: MathJax_Math-italic;">a</span><span class="mo" id="MathJax-Span-1348" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-1349" style="font-family: MathJax_Math-italic;">j</span><span class="mo" id="MathJax-Span-1350" style="font-family: MathJax_Main;">]</span><span class="mo" id="MathJax-Span-1351" style="font-family: MathJax_Main; padding-left: 0.273em;">≠</span><span class="mi" id="MathJax-Span-1352" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">j</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-234">a[j]\ne j</script>, the counts of elements in <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-235-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1353" style="width: 0.923em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.65em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1354"><span class="mi" id="MathJax-Span-1355" style="font-family: MathJax_Math-italic;">L</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-235">L</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-236-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1356" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.76em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1357"><span class="mi" id="MathJax-Span-1358" style="font-family: MathJax_Math-italic;">R</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-236">R</script> to the left and right are constrained and cannot both decrease, so within any interval between fixed points <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-237-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1359" style="width: 4.115em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.087em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1003.03em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1360"><span class="mi" id="MathJax-Span-1361" style="font-family: MathJax_Math-italic;">a</span><span class="mo" id="MathJax-Span-1362" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-1363" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-1364" style="font-family: MathJax_Main;">]</span><span class="mo" id="MathJax-Span-1365" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mi" id="MathJax-Span-1366" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">i</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-237">a[i]=i</script> both types <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-238-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1367" style="width: 0.923em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.65em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1368"><span class="mi" id="MathJax-Span-1369" style="font-family: MathJax_Math-italic;">L</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-238">L</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-239-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1370" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.76em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1371"><span class="mi" id="MathJax-Span-1372" style="font-family: MathJax_Math-italic;">R</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-239">R</script> must appear unless the whole interval consists of fixed points.</p><p><strong>First case.</strong> There are positions with <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-240-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1373" style="width: 4.115em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.087em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1003.03em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1374"><span class="mi" id="MathJax-Span-1375" style="font-family: MathJax_Math-italic;">a</span><span class="mo" id="MathJax-Span-1376" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-1377" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-1378" style="font-family: MathJax_Main;">]</span><span class="mo" id="MathJax-Span-1379" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mi" id="MathJax-Span-1380" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">i</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-240">a[i]=i</script>. Consider the gaps between consecutive fixed points. In a gap of size <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-241-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1381" style="width: 1.139em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.87em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1382"><span class="mi" id="MathJax-Span-1383" style="font-family: MathJax_Math-italic;">m</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-241">m</script> between indices <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-242-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1384" style="width: 0.436em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.327em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1000.27em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1385"><span class="mi" id="MathJax-Span-1386" style="font-family: MathJax_Math-italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-242">i</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-243-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1387" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.436em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1000.44em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1388"><span class="mi" id="MathJax-Span-1389" style="font-family: MathJax_Math-italic;">j</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-243">j</script> with <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-244-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1390" style="width: 4.115em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.087em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1003.03em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1391"><span class="mi" id="MathJax-Span-1392" style="font-family: MathJax_Math-italic;">a</span><span class="mo" id="MathJax-Span-1393" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-1394" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-1395" style="font-family: MathJax_Main;">]</span><span class="mo" id="MathJax-Span-1396" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mi" id="MathJax-Span-1397" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">i</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-244">a[i]=i</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-245-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1398" style="width: 4.332em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.249em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1003.25em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1399"><span class="mi" id="MathJax-Span-1400" style="font-family: MathJax_Math-italic;">a</span><span class="mo" id="MathJax-Span-1401" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-1402" style="font-family: MathJax_Math-italic;">j</span><span class="mo" id="MathJax-Span-1403" style="font-family: MathJax_Main;">]</span><span class="mo" id="MathJax-Span-1404" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mi" id="MathJax-Span-1405" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">j</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-245">a[j]=j</script>, we can count the valid assignments of the elements <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-246-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1406" style="width: 8.498em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.442em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1006.39em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1407"><span class="mi" id="MathJax-Span-1408" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-1409" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-1410" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-1411" style="font-family: MathJax_Main;">,</span><span class="mo" id="MathJax-Span-1412" style="font-family: MathJax_Main; padding-left: 0.165em;">…</span><span class="mo" id="MathJax-Span-1413" style="font-family: MathJax_Main; padding-left: 0.165em;">,</span><span class="mi" id="MathJax-Span-1414" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">j</span><span class="mo" id="MathJax-Span-1415" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mn" id="MathJax-Span-1416" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-246">i+1,\dots,j-1</script> to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-247-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1417" style="width: 0.923em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.65em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1418"><span class="mi" id="MathJax-Span-1419" style="font-family: MathJax_Math-italic;">L</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-247">L</script> or <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-248-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1420" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.76em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1421"><span class="mi" id="MathJax-Span-1422" style="font-family: MathJax_Math-italic;">R</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-248">R</script>. Summing over all possible splits gives <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-249-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1423" style="width: 18.509em; display: inline-block;"><span style="display: inline-block; position: relative; width: 14.018em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1013.96em, 2.762em, -999.997em); top: -2.216em; left: 0em;"><span class="mrow" id="MathJax-Span-1424"><span class="mrow" id="MathJax-Span-1425"><span class="TeXmathchoice" id="MathJax-Span-1426"><span class="mstyle" id="MathJax-Span-1427"><span class="mrow" id="MathJax-Span-1428"><span class="texatom" id="MathJax-Span-1429"><span class="mrow" id="MathJax-Span-1430"><span class="mo" id="MathJax-Span-1431" style="vertical-align: 0em;"><span style="font-family: MathJax_Size1;">(</span></span></span></span></span></span></span><span class="mfrac" id="MathJax-Span-1432"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px;"><span style="position: absolute; clip: rect(3.52em, 1000.6em, 4.169em, -999.997em); top: -4.435em; left: 50%; margin-left: -0.322em;"><span class="mi" id="MathJax-Span-1433" style="font-size: 70.7%; font-family: MathJax_Math-italic;">m</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; clip: rect(3.358em, 1000.33em, 4.169em, -999.997em); top: -3.677em; left: 50%; margin-left: -0.16em;"><span class="mn" id="MathJax-Span-1434" style="font-size: 70.7%; font-family: MathJax_Main;">0</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="TeXmathchoice" id="MathJax-Span-1435"><span class="mstyle" id="MathJax-Span-1436"><span class="mrow" id="MathJax-Span-1437"><span class="texatom" id="MathJax-Span-1438"><span class="mrow" id="MathJax-Span-1439"><span class="mo" id="MathJax-Span-1440" style="vertical-align: 0em;"><span style="font-family: MathJax_Size1;">)</span></span></span></span></span></span></span></span><span class="mo" id="MathJax-Span-1441" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mrow" id="MathJax-Span-1442" style="padding-left: 0.219em;"><span class="TeXmathchoice" id="MathJax-Span-1443"><span class="mstyle" id="MathJax-Span-1444"><span class="mrow" id="MathJax-Span-1445"><span class="texatom" id="MathJax-Span-1446"><span class="mrow" id="MathJax-Span-1447"><span class="mo" id="MathJax-Span-1448" style="vertical-align: 0em;"><span style="font-family: MathJax_Size1;">(</span></span></span></span></span></span></span><span class="mfrac" id="MathJax-Span-1449"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px;"><span style="position: absolute; clip: rect(3.52em, 1000.6em, 4.169em, -999.997em); top: -4.435em; left: 50%; margin-left: -0.322em;"><span class="mi" id="MathJax-Span-1450" style="font-size: 70.7%; font-family: MathJax_Math-italic;">m</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; clip: rect(3.358em, 1000.33em, 4.169em, -999.997em); top: -3.677em; left: 50%; margin-left: -0.16em;"><span class="mn" id="MathJax-Span-1451" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="TeXmathchoice" id="MathJax-Span-1452"><span class="mstyle" id="MathJax-Span-1453"><span class="mrow" id="MathJax-Span-1454"><span class="texatom" id="MathJax-Span-1455"><span class="mrow" id="MathJax-Span-1456"><span class="mo" id="MathJax-Span-1457" style="vertical-align: 0em;"><span style="font-family: MathJax_Size1;">)</span></span></span></span></span></span></span></span><span class="mo" id="MathJax-Span-1458" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mo" id="MathJax-Span-1459" style="font-family: MathJax_Main; padding-left: 0.219em;">⋯</span><span class="mo" id="MathJax-Span-1460" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mrow" id="MathJax-Span-1461" style="padding-left: 0.219em;"><span class="TeXmathchoice" id="MathJax-Span-1462"><span class="mstyle" id="MathJax-Span-1463"><span class="mrow" id="MathJax-Span-1464"><span class="texatom" id="MathJax-Span-1465"><span class="mrow" id="MathJax-Span-1466"><span class="mo" id="MathJax-Span-1467" style="vertical-align: 0em;"><span style="font-family: MathJax_Size1;">(</span></span></span></span></span></span></span><span class="mfrac" id="MathJax-Span-1468"><span style="display: inline-block; position: relative; width: 1.518em; height: 0px;"><span style="position: absolute; clip: rect(3.52em, 1000.6em, 4.169em, -999.997em); top: -4.435em; left: 50%; margin-left: -0.322em;"><span class="mi" id="MathJax-Span-1469" style="font-size: 70.7%; font-family: MathJax_Math-italic;">m</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; clip: rect(3.358em, 1001.46em, 4.223em, -999.997em); top: -3.677em; left: 50%; margin-left: -0.755em;"><span class="mrow" id="MathJax-Span-1470"><span class="mi" id="MathJax-Span-1471" style="font-size: 70.7%; font-family: MathJax_Math-italic;">m</span><span class="mo" id="MathJax-Span-1472" style="font-size: 70.7%; font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-1473" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="TeXmathchoice" id="MathJax-Span-1474"><span class="mstyle" id="MathJax-Span-1475"><span class="mrow" id="MathJax-Span-1476"><span class="texatom" id="MathJax-Span-1477"><span class="mrow" id="MathJax-Span-1478"><span class="mo" id="MathJax-Span-1479" style="vertical-align: 0em;"><span style="font-family: MathJax_Size1;">)</span></span></span></span></span></span></span></span><span class="mo" id="MathJax-Span-1480" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="msubsup" id="MathJax-Span-1481" style="padding-left: 0.273em;"><span style="display: inline-block; position: relative; width: 2.113em; height: 0px;"><span style="position: absolute; clip: rect(3.195em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mn" id="MathJax-Span-1482" style="font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -4.38em; left: 0.49em;"><span class="texatom" id="MathJax-Span-1483"><span class="mrow" id="MathJax-Span-1484"><span class="mi" id="MathJax-Span-1485" style="font-size: 70.7%; font-family: MathJax_Math-italic;">m</span><span class="mo" id="MathJax-Span-1486" style="font-size: 70.7%; font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-1487" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-1488" style="font-family: MathJax_Main;">.</span></span><span style="display: inline-block; width: 0px; height: 2.221em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.568em; border-left: 0px solid; width: 0px; height: 1.789em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-249">\binom{m}{0}+\binom{m}{1}+\cdots+\binom{m}{m-1}=2^{m-1}.</script> To avoid overcounting the fully ordered arrangement, for each gap of size <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-250-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1489" style="width: 1.139em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.87em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1490"><span class="mi" id="MathJax-Span-1491" style="font-family: MathJax_Math-italic;">m</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-250">m</script> we count <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-251-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1492" style="width: 7.795em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.901em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.139em, 1005.85em, 2.438em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1493"><span class="msubsup" id="MathJax-Span-1494"><span style="display: inline-block; position: relative; width: 2.113em; height: 0px;"><span style="position: absolute; clip: rect(3.195em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mn" id="MathJax-Span-1495" style="font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -4.38em; left: 0.49em;"><span class="texatom" id="MathJax-Span-1496"><span class="mrow" id="MathJax-Span-1497"><span class="mi" id="MathJax-Span-1498" style="font-size: 70.7%; font-family: MathJax_Math-italic;">m</span><span class="mo" id="MathJax-Span-1499" style="font-size: 70.7%; font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-1500" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-1501" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mi" id="MathJax-Span-1502" style="font-family: MathJax_Math-italic; padding-left: 0.219em;">m</span><span class="mo" id="MathJax-Span-1503" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mn" id="MathJax-Span-1504" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.211em; border-left: 0px solid; width: 0px; height: 1.361em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-251">2^{m-1}-m-1</script>, and then add <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-252-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1505" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1506"><span class="mn" id="MathJax-Span-1507" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-252">1</script> at the end for the completely ordered sequence.</p><p><strong>Second case.</strong> Every element can be assigned unambiguously to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-253-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1508" style="width: 0.923em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.65em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1509"><span class="mi" id="MathJax-Span-1510" style="font-family: MathJax_Math-italic;">L</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-253">L</script> or <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-254-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1511" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.76em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1512"><span class="mi" id="MathJax-Span-1513" style="font-family: MathJax_Math-italic;">R</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-254">R</script>. Add a sentinel <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-255-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1514" style="width: 4.494em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.412em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1003.36em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1515"><span class="mi" id="MathJax-Span-1516" style="font-family: MathJax_Math-italic;">a</span><span class="mo" id="MathJax-Span-1517" style="font-family: MathJax_Main;">[</span><span class="mn" id="MathJax-Span-1518" style="font-family: MathJax_Main;">0</span><span class="mo" id="MathJax-Span-1519" style="font-family: MathJax_Main;">]</span><span class="mo" id="MathJax-Span-1520" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mn" id="MathJax-Span-1521" style="font-family: MathJax_Main; padding-left: 0.273em;">0</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-255">a[0]=0</script> and assign it to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-256-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1522" style="width: 0.923em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.65em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1523"><span class="mi" id="MathJax-Span-1524" style="font-family: MathJax_Math-italic;">L</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-256">L</script>. Track <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-257-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1525" style="width: 3.087em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.33em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1002.27em, 2.438em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1526"><span class="mi" id="MathJax-Span-1527" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-1528" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-1529" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.211em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-257">n+1</script> dynamic states <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-258-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1530" style="width: 2.654em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.005em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1001.9em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1531"><span class="mo" id="MathJax-Span-1532" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1533" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-1534" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1535" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">j</span><span class="mo" id="MathJax-Span-1536" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-258">(i,j)</script> with initial states <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-259-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1537" style="width: 14.721em; display: inline-block;"><span style="display: inline-block; position: relative; width: 11.15em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1011.04em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1538"><span class="mo" id="MathJax-Span-1539" style="font-family: MathJax_Main;">(</span><span class="mn" id="MathJax-Span-1540" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-1541" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-1542" style="font-family: MathJax_Main; padding-left: 0.165em;">1</span><span class="mo" id="MathJax-Span-1543" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-1544" style="font-family: MathJax_Main;">,</span><span class="mo" id="MathJax-Span-1545" style="font-family: MathJax_Main; padding-left: 0.165em;">(</span><span class="mn" id="MathJax-Span-1546" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-1547" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-1548" style="font-family: MathJax_Main; padding-left: 0.165em;">2</span><span class="mo" id="MathJax-Span-1549" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-1550" style="font-family: MathJax_Main;">,</span><span class="mo" id="MathJax-Span-1551" style="font-family: MathJax_Main; padding-left: 0.165em;">…</span><span class="mo" id="MathJax-Span-1552" style="font-family: MathJax_Main; padding-left: 0.165em;">,</span><span class="mo" id="MathJax-Span-1553" style="font-family: MathJax_Main; padding-left: 0.165em;">(</span><span class="mn" id="MathJax-Span-1554" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-1555" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1556" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">n</span><span class="mo" id="MathJax-Span-1557" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-1558" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-1559" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-259">(1,1),(1,2),\dots,(1,n+1)</script>, where <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-260-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1560" style="width: 0.436em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.327em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1000.27em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1561"><span class="mi" id="MathJax-Span-1562" style="font-family: MathJax_Math-italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-260">i</script> is the next index needed in <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-261-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1563" style="width: 0.923em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.65em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1564"><span class="mi" id="MathJax-Span-1565" style="font-family: MathJax_Math-italic;">L</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-261">L</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-262-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1566" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.436em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1000.44em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1567"><span class="mi" id="MathJax-Span-1568" style="font-family: MathJax_Math-italic;">j</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-262">j</script> is the next index needed in <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-263-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1569" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.76em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1570"><span class="mi" id="MathJax-Span-1571" style="font-family: MathJax_Math-italic;">R</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-263">R</script>. Each state stores the number of ways to reach it, initially <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-264-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1572" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1573"><span class="mn" id="MathJax-Span-1574" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-264">1</script>.</p><p>Updating every state at every step would be too slow, so only update at gap boundaries. There are two subcases for a gap of size <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-265-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1575" style="width: 1.139em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.87em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1576"><span class="mi" id="MathJax-Span-1577" style="font-family: MathJax_Math-italic;">m</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-265">m</script>:</p> <ol>   <li><p>The endpoints of the gap belong to the same side. For each state, we know how many of the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-266-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1578" style="width: 1.139em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.87em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1579"><span class="mi" id="MathJax-Span-1580" style="font-family: MathJax_Math-italic;">m</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-266">m</script> elements, say <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-267-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1581" style="width: 0.76em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.544em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.54em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1582"><span class="mi" id="MathJax-Span-1583" style="font-family: MathJax_Math-italic;">k</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-267">k</script>, must go to that side, so we multiply the state’s count by <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-268-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1584" style="width: 2.005em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.518em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1001.36em, 2.762em, -999.997em); top: -2.216em; left: 0em;"><span class="mrow" id="MathJax-Span-1585"><span class="mrow" id="MathJax-Span-1586"><span class="TeXmathchoice" id="MathJax-Span-1587"><span class="mstyle" id="MathJax-Span-1588"><span class="mrow" id="MathJax-Span-1589"><span class="texatom" id="MathJax-Span-1590"><span class="mrow" id="MathJax-Span-1591"><span class="mo" id="MathJax-Span-1592" style="vertical-align: 0em;"><span style="font-family: MathJax_Size1;">(</span></span></span></span></span></span></span><span class="mfrac" id="MathJax-Span-1593"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px;"><span style="position: absolute; clip: rect(3.52em, 1000.6em, 4.169em, -999.997em); top: -4.435em; left: 50%; margin-left: -0.322em;"><span class="mi" id="MathJax-Span-1594" style="font-size: 70.7%; font-family: MathJax_Math-italic;">m</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; clip: rect(3.358em, 1000.38em, 4.169em, -999.997em); top: -3.677em; left: 50%; margin-left: -0.16em;"><span class="mi" id="MathJax-Span-1595" style="font-size: 70.7%; font-family: MathJax_Math-italic;">k</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="TeXmathchoice" id="MathJax-Span-1596"><span class="mstyle" id="MathJax-Span-1597"><span class="mrow" id="MathJax-Span-1598"><span class="texatom" id="MathJax-Span-1599"><span class="mrow" id="MathJax-Span-1600"><span class="mo" id="MathJax-Span-1601" style="vertical-align: 0em;"><span style="font-family: MathJax_Size1;">)</span></span></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.221em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.568em; border-left: 0px solid; width: 0px; height: 1.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-268">\binom{m}{k}</script> and advance <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-269-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1602" style="width: 2.654em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.005em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1001.9em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1603"><span class="mo" id="MathJax-Span-1604" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1605" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-1606" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1607" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">j</span><span class="mo" id="MathJax-Span-1608" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-269">(i,j)</script> accordingly by <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-270-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1609" style="width: 0.76em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.544em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.54em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1610"><span class="mi" id="MathJax-Span-1611" style="font-family: MathJax_Math-italic;">k</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-270">k</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-271-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1612" style="width: 3.466em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.6em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1002.6em, 2.438em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1613"><span class="mi" id="MathJax-Span-1614" style="font-family: MathJax_Math-italic;">m</span><span class="mo" id="MathJax-Span-1615" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mi" id="MathJax-Span-1616" style="font-family: MathJax_Math-italic; padding-left: 0.219em;">k</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.211em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-271">m-k</script>.</p></li>   <li><p>The endpoints belong to different sides. First apply any deferred updates. Now either <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-272-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1617" style="width: 0.436em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.327em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1000.27em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1618"><span class="mi" id="MathJax-Span-1619" style="font-family: MathJax_Math-italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-272">i</script> or <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-273-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1620" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.436em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1000.44em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1621"><span class="mi" id="MathJax-Span-1622" style="font-family: MathJax_Math-italic;">j</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-273">j</script> is identical across all current states because the last element before the gap was forced to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-274-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1623" style="width: 0.923em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.65em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1624"><span class="mi" id="MathJax-Span-1625" style="font-family: MathJax_Math-italic;">L</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-274">L</script> or <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-275-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1626" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.76em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1627"><span class="mi" id="MathJax-Span-1628" style="font-family: MathJax_Math-italic;">R</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-275">R</script>. For a gap of size <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-276-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1629" style="width: 1.139em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.87em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1630"><span class="mi" id="MathJax-Span-1631" style="font-family: MathJax_Math-italic;">m</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-276">m</script> there are at most <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-277-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1632" style="width: 1.139em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.87em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1633"><span class="mi" id="MathJax-Span-1634" style="font-family: MathJax_Math-italic;">m</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-277">m</script> next states, and for each we can compute the number of shuffles since the counts assigned to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-278-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1635" style="width: 0.923em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.65em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1636"><span class="mi" id="MathJax-Span-1637" style="font-family: MathJax_Math-italic;">L</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-278">L</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-279-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1638" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.76em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1639"><span class="mi" id="MathJax-Span-1640" style="font-family: MathJax_Math-italic;">R</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-279">R</script> are fixed. This gives <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-280-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1641" style="width: 3.249em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.438em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1002.33em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1642"><span class="mi" id="MathJax-Span-1643" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-1644" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1645" style="font-family: MathJax_Math-italic;">m</span><span class="mo" id="MathJax-Span-1646" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-280">O(m)</script> work per gap, hence <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-281-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1647" style="width: 2.871em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.167em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1002.06em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1648"><span class="mi" id="MathJax-Span-1649" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-1650" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1651" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-1652" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-281">O(n)</script> overall.</p></li> </ol><p>This completes the counting in <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-282-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1653" style="width: 2.871em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.167em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1002.06em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1654"><span class="mi" id="MathJax-Span-1655" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-1656" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1657" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-1658" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-282">O(n)</script> time.</p></div></div> <div class="spoiler"><b class="spoiler-title">Implementation(Python)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="kwd">import</span><span class="pln"> sys
input </span><span class="pun">=</span><span class="pln"> sys</span><span class="pun">.</span><span class="pln">stdin</span><span class="pun">.</span><span class="pln">readline
MOD </span><span class="pun">=</span><span class="pln"> </span><span class="lit">998244353</span><span class="pln">

fac_arr </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
finv_arr </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">


</span><span class="kwd">def</span><span class="pln"> enlarge_fac</span><span class="pun">():</span><span class="pln">
    old_size </span><span class="pun">=</span><span class="pln"> len</span><span class="pun">(</span><span class="pln">fac_arr</span><span class="pun">)</span><span class="pln">
    new_size </span><span class="pun">=</span><span class="pln"> old_size </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> i </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="pln">old_size</span><span class="pun">,</span><span class="pln"> new_size </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">):</span><span class="pln">
        fac_arr</span><span class="pun">.</span><span class="pln">append</span><span class="pun">((</span><span class="pln">fac_arr</span><span class="pun">[-</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> MOD</span><span class="pun">)</span><span class="pln">
    ifac </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">pow</span><span class="pun">(</span><span class="pln">fac_arr</span><span class="pun">[-</span><span class="lit">1</span><span class="pun">],</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> MOD</span><span class="pun">)]</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> i </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="pln">new_size</span><span class="pun">,</span><span class="pln"> old_size</span><span class="pun">,-</span><span class="lit">1</span><span class="pun">):</span><span class="pln">
        ifac</span><span class="pun">.</span><span class="pln">append</span><span class="pun">((</span><span class="pln">ifac</span><span class="pun">[-</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> MOD</span><span class="pun">)</span><span class="pln">
    ifac</span><span class="pun">.</span><span class="pln">reverse</span><span class="pun">()</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> x </span><span class="kwd">in</span><span class="pln"> ifac</span><span class="pun">:</span><span class="pln">
        finv_arr</span><span class="pun">.</span><span class="pln">append</span><span class="pun">(</span><span class="pln">x</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> fac</span><span class="pun">(</span><span class="pln">n</span><span class="pun">):</span><span class="pln">
    </span><span class="kwd">while</span><span class="pln"> n </span><span class="pun">&gt;=</span><span class="pln"> len</span><span class="pun">(</span><span class="pln">fac_arr</span><span class="pun">):</span><span class="pln"> enlarge_fac</span><span class="pun">()</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> fac_arr</span><span class="pun">[</span><span class="pln">n</span><span class="pun">]</span><span class="pln">


</span><span class="kwd">def</span><span class="pln"> finv</span><span class="pun">(</span><span class="pln">n</span><span class="pun">):</span><span class="pln">
    </span><span class="kwd">while</span><span class="pln"> n </span><span class="pun">&gt;=</span><span class="pln"> len</span><span class="pun">(</span><span class="pln">finv_arr</span><span class="pun">):</span><span class="pln"> enlarge_fac</span><span class="pun">()</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> finv_arr</span><span class="pun">[</span><span class="pln">n</span><span class="pun">]</span><span class="pln">


</span><span class="kwd">def</span><span class="pln"> binom</span><span class="pun">(</span><span class="pln">n</span><span class="pun">,</span><span class="pln"> k</span><span class="pun">):</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> k </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="kwd">or</span><span class="pln"> k </span><span class="pun">&gt;</span><span class="pln"> n</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">((</span><span class="pln">fac</span><span class="pun">(</span><span class="pln">n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> finv</span><span class="pun">(</span><span class="pln">k</span><span class="pun">))</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> MOD </span><span class="pun">*</span><span class="pln"> finv</span><span class="pun">(</span><span class="pln">n </span><span class="pun">-</span><span class="pln"> k</span><span class="pun">))</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> MOD
</span><span class="kwd">for</span><span class="pln"> _ </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="kwd">int</span><span class="pun">(</span><span class="pln">input</span><span class="pun">())):</span><span class="pln">
    n </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">(</span><span class="pln">input</span><span class="pun">())</span><span class="pln">
    a </span><span class="pun">=</span><span class="pln"> list</span><span class="pun">(</span><span class="pln">map</span><span class="pun">(</span><span class="kwd">int</span><span class="pun">,</span><span class="pln"> input</span><span class="pun">().</span><span class="pln">split</span><span class="pun">()))</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="pun">[</span><span class="pln">n</span><span class="pun">+</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> max</span><span class="pun">([</span><span class="lit">0</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> abs</span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]-</span><span class="pln">i</span><span class="pun">-</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> i </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="pln">n</span><span class="pun">)])</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">:</span><span class="pln">
        sol </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
        </span><span class="kwd">last</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> i </span><span class="kwd">in</span><span class="pln"> a</span><span class="pun">:</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> i </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">:</span><span class="pln">
                sol </span><span class="pun">+=</span><span class="pln"> pow</span><span class="pun">(</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> i </span><span class="pun">-</span><span class="pln"> </span><span class="kwd">last</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> MOD</span><span class="pun">)</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="kwd">last</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">
                </span><span class="kwd">last</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> i
                sol </span><span class="pun">%=</span><span class="pln"> MOD
        </span><span class="kwd">print</span><span class="pun">(</span><span class="pln">sol</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">else</span><span class="pun">:</span><span class="pln">
        S </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[(</span><span class="lit">0</span><span class="pun">,</span><span class="pln">i</span><span class="pun">,</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> i </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln">n</span><span class="pun">)]</span><span class="pln">
        </span><span class="kwd">last</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pln">
        left </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
        eq </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
        pl </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
        mult </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
        lastv </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
        nd </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> idx </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="pln">n</span><span class="pun">+</span><span class="lit">1</span><span class="pun">):</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">idx</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">continue</span><span class="pln">
            gap </span><span class="pun">=</span><span class="pln"> idx </span><span class="pun">-</span><span class="pln"> </span><span class="kwd">last</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
            at </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> idx </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">idx</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">or</span><span class="pln"> </span><span class="pun">(</span><span class="pln">idx </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">idx</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">and</span><span class="pln"> eq </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">):</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> idx </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">idx</span><span class="pun">]:</span><span class="pln"> eq </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
                at </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
            </span><span class="kwd">else</span><span class="pun">:</span><span class="pln"> eq </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
            TMP </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[]</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> at </span><span class="pun">^</span><span class="pln"> left</span><span class="pun">:</span><span class="pln">
                </span><span class="kwd">for</span><span class="pln"> i</span><span class="pun">,</span><span class="pln">j</span><span class="pun">,</span><span class="pln">k </span><span class="kwd">in</span><span class="pln"> S</span><span class="pun">:</span><span class="pln">
                    </span><span class="kwd">if</span><span class="pln"> left</span><span class="pun">:</span><span class="pln"> j </span><span class="pun">+=</span><span class="pln"> pl</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> nd
                    </span><span class="kwd">else</span><span class="pun">:</span><span class="pln"> i </span><span class="pun">+=</span><span class="pln"> pl</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> nd
                    </span><span class="kwd">if</span><span class="pln"> left</span><span class="pun">:</span><span class="pln"> rev </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">idx</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> j </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
                    </span><span class="kwd">else</span><span class="pun">:</span><span class="pln"> rev </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">idx</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
                    </span><span class="kwd">if</span><span class="pln"> left</span><span class="pun">:</span><span class="pln"> i </span><span class="pun">+=</span><span class="pln"> gap </span><span class="pun">-</span><span class="pln"> rev
                    </span><span class="kwd">else</span><span class="pun">:</span><span class="pln"> j </span><span class="pun">+=</span><span class="pln"> gap </span><span class="pun">-</span><span class="pln"> rev
                    </span><span class="kwd">if</span><span class="pln"> at</span><span class="pun">:</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">idx</span><span class="pun">]</span><span class="pln">
                    </span><span class="kwd">else</span><span class="pun">:</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">idx</span><span class="pun">]</span><span class="pln">
                    f </span><span class="pun">=</span><span class="pln"> binom</span><span class="pun">(</span><span class="pln">gap</span><span class="pun">,</span><span class="pln">rev</span><span class="pun">)</span><span class="pln">
                    </span><span class="kwd">if</span><span class="pln"> f</span><span class="pun">:</span><span class="pln"> TMP</span><span class="pun">.</span><span class="pln">append</span><span class="pun">((</span><span class="pln">i</span><span class="pun">,</span><span class="pln">j</span><span class="pun">,(</span><span class="pln">k</span><span class="pun">*</span><span class="pln">f</span><span class="pun">)%</span><span class="pln">MOD</span><span class="pun">))</span><span class="pln">
                left </span><span class="pun">^=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
                pl </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
                lastv </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">idx</span><span class="pun">]</span><span class="pln">
                nd </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">idx</span><span class="pun">]</span><span class="pln">
                S </span><span class="pun">=</span><span class="pln"> TMP
            </span><span class="kwd">else</span><span class="pun">:</span><span class="pln">
                rev </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">idx</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> lastv </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
                pl </span><span class="pun">+=</span><span class="pln"> gap </span><span class="pun">-</span><span class="pln"> rev
                nd </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">idx</span><span class="pun">]</span><span class="pln">
                lastv </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">idx</span><span class="pun">]</span><span class="pln">
                mult </span><span class="pun">*=</span><span class="pln"> binom</span><span class="pun">(</span><span class="pln">gap</span><span class="pun">,</span><span class="pln">rev</span><span class="pun">)</span><span class="pln">
                mult </span><span class="pun">%=</span><span class="pln"> MOD
            </span><span class="kwd">last</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> idx
        </span><span class="kwd">print</span><span class="pun">(((</span><span class="pln">sum</span><span class="pun">([</span><span class="pln">x</span><span class="pun">[-</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> x </span><span class="kwd">in</span><span class="pln"> S</span><span class="pun">])%</span><span class="pln">MOD</span><span class="pun">)*</span><span class="pln">mult</span><span class="pun">)%</span><span class="pln">MOD</span><span class="pun">)</span></code></pre></div></div></div></div></div>

    </div>


        <div style="font-size: 1.1rem;line-height: 1.1rem;padding-bottom: 0.5em;">
            <img src="https://codeforces.com//codeforces.com/codeforces.org/s/52448/images/icons/paperclip-16x16.png" style="vertical-align: middle;"> <span style="padding: 0 0.35em;">Tutorial of <a href="https://codeforces.com/contest/2154" class="notice" style="text-decoration: none;">Codeforces Round 1060 (Div. 2)</a> </span>
        </div>
        
            

  <script>
    // Make all spoilers toggleable
    document.querySelectorAll('.spoiler-title').forEach(title => {
      title.addEventListener('click', function() {
        const spoiler = this.closest('.spoiler');
        spoiler.classList.toggle('open');
      });
    });
    
    // Open all spoilers by default for easier reading
    document.querySelectorAll('.spoiler').forEach(spoiler => {
      spoiler.classList.add('open');
    });
  </script>
</body>
</html>