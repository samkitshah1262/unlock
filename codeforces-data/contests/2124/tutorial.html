<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tutorial</title>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
      line-height: 1.6;
      color: #333;
      background: #fafafa;
    }
    .ttypography {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    h3 {
      color: #1a1a1a;
      border-bottom: 2px solid #eee;
      padding-bottom: 10px;
    }
    h3 a {
      color: #0066cc;
      text-decoration: none;
    }
    h3 a:hover {
      text-decoration: underline;
    }
    .spoiler {
      margin: 15px 0;
      border: 1px solid #ddd;
      border-radius: 6px;
      overflow: hidden;
    }
    .spoiler-title {
      display: block;
      padding: 12px 15px;
      background: #f0f0f0;
      cursor: pointer;
      font-weight: 600;
      user-select: none;
      border-bottom: 1px solid #ddd;
    }
    .spoiler-title:hover {
      background: #e8e8e8;
    }
    .spoiler-title::before {
      content: '▶ ';
      font-size: 0.8em;
      transition: transform 0.2s;
      display: inline-block;
    }
    .spoiler.open .spoiler-title::before {
      content: '▼ ';
    }
    .spoiler-content {
      padding: 15px;
      background: #fff;
      display: none;
    }
    .spoiler.open .spoiler-content {
      display: block;
    }
    pre, code {
      background: #f5f5f5;
      font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
      font-size: 0.85em;
    }
    pre {
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
    }
    code {
      padding: 2px 5px;
      border-radius: 3px;
    }
    p {
      margin: 10px 0;
    }
    .MathJax {
      font-size: 1.1em;
    }
  </style>
</head>
<body>
  <h1>Editorial</h1>
  <p><a href="https://codeforces.com/blog/entry/144382" target="_blank">View on Codeforces →</a></p>
  
  <div class="ttypography"><p>Thanks for participation! We hope you loved the contest.</p><h4><a href="https://codeforces.com/contest/2124/problem/A">2124A - Deranged Deletions</a></h4><p>Problem Credits: <a class="rated-user user-orange" href="https://codeforces.com/profile/Lilypad" title="Master Lilypad">Lilypad</a> <br></p> <div class="spoiler"><b class="spoiler-title">Hint</b><div class="spoiler-content" style="display: block;"><p>When is there definitely <em>not</em> a solution?</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><p>First, note that since relative order is preserved no matter which elements are deleted, if <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2">a</span></span></span><script type="math/tex" id="MathJax-Element-1">a</script> is originally sorted in nondecreasing order, the array cannot be a derangement no matter which elements are deleted.</p><p>If <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4">a</span></span></span><script type="math/tex" id="MathJax-Element-2">a</script> is not sorted, we can note that any two elements that form an inversion pair satisfies the requirements. The total runtime is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-5"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-6">O</span><span class="MJXp-mo" id="MJXp-Span-7" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-8">n</span><span class="MJXp-mo" id="MJXp-Span-9" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-3">O(n)</script>.</p></div></div> <div class="spoiler"><b class="spoiler-title">Code</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">

</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">void</span><span class="pln"> solve</span><span class="pun">(){</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">

    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">

    vector</span><span class="str">&lt;int&gt;</span><span class="pln"> arr</span><span class="pun">(</span><span class="pln">n</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">auto</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">x </span><span class="pun">:</span><span class="pln"> arr</span><span class="pun">)</span><span class="pln"> cin </span><span class="pun">&gt;&gt;</span><span class="pln"> x</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++){</span><span class="pln">
        </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++){</span><span class="pln">
            </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">arr</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> arr</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]){</span><span class="pln">
                cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"YES\n2\n"</span><span class="pun">;</span><span class="pln">
                cout </span><span class="pun">&lt;&lt;</span><span class="pln"> arr</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">" "</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> arr</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"\n"</span><span class="pun">;</span><span class="pln">
                </span><span class="kwd">return</span><span class="pun">;</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"NO\n"</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">(){</span><span class="pln">
    ios_base</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="kwd">false</span><span class="pun">);</span><span class="pln">
    cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="kwd">nullptr</span><span class="pun">);</span><span class="pln">

    </span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pun">(</span><span class="pln">t</span><span class="pun">--)</span><span class="pln"> solve</span><span class="pun">();</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div> <div class="spoiler"><b class="spoiler-title">Rate the Problem</b><div class="spoiler-content" style="display: block;"><ul>   <li>
<style data-nocturne="true" type="text/css">

</style>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="10769">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="90">90</span>
            </i>
        </a>
    </span>

    <script>
        $(function() {
            const likeFormUtil = {};
            likeFormUtil.getCount = function ($count) {
                return Number($count.attr("data-value"));
            };
            likeFormUtil.setCount = function ($count, value) {
                $count.attr("data-value", value);
                $count.text(value);
            };
            likeFormUtil.like = function ($likeForm) {
                $likeForm.find(".likeState").addClass("liked");
                const $likeCount = $likeForm.find(".likeCount");
                likeFormUtil.setCount($likeCount, likeFormUtil.getCount($likeCount) + 1);
            };
            likeFormUtil.unLike = function ($likeForm) {
                if ($likeForm.find(".likeState").hasClass("liked")) {
                    $likeForm.find(".likeState").removeClass("liked");
                    const $likeCount = $likeForm.find(".likeCount");
                    likeFormUtil.setCount($likeCount, likeFormUtil.getCount($likeCount) - 1);
                }
            };
            likeFormUtil.dislike = function ($likeForm) {
                $likeForm.find(".dislikeState").addClass("disliked");
                const $dislikeCount = $likeForm.find(".dislikeCount");
                likeFormUtil.setCount($dislikeCount, likeFormUtil.getCount($dislikeCount) + 1);
            };
            likeFormUtil.unDislike = function ($likeForm) {
                if ($likeForm.find(".dislikeState").hasClass("disliked")) {
                    $likeForm.find(".dislikeState").removeClass("disliked");
                    const $dislikeCount = $likeForm.find(".dislikeCount");
                    likeFormUtil.setCount($dislikeCount, likeFormUtil.getCount($dislikeCount) - 1);
                }
            };
            likeFormUtil.disable = function ($likeForm) {
                $likeForm.find(".likeActionLink").off("click");
                $likeForm.find(".likeActionLink").on("click", function () {
                    return false;
                });
                $likeForm.find(".dislikeActionLink").off("click");
                $likeForm.find(".dislikeActionLink").on("click", function () {
                    return false;
                });
            };
            likeFormUtil.enable = function ($likeForm) {
                $likeForm.find(".likeActionLink").off("click");
                $likeForm.find(".likeActionLink").on("click", onLike);
                $likeForm.find(".dislikeActionLink").off("click");
                $likeForm.find(".dislikeActionLink").on("click", onDislike);
            };
            likeFormUtil.applyLikeableInformation = function(likeableInformation) {
                const id = likeableInformation.likeable.id;
                console.log(id);
                const $likeForm = $(".likeActionLink[data-likeableId='" + id + "']").closest(".likeForm");
                console.log($likeForm);
                likeFormUtil.setCount($likeForm.find(".likeCount"), likeableInformation.likeCount);
                likeFormUtil.setCount($likeForm.find(".dislikeCount"), likeableInformation.dislikeCount);
                if (likeableInformation.liked) {
                    $likeForm.find(".likeState").addClass("liked");
                } else {
                    $likeForm.find(".likeState").removeClass("liked");
                }
                if (likeableInformation.disliked) {
                    $likeForm.find(".likeState").addClass("disliked");
                } else {
                    $likeForm.find(".likeState").removeClass("disliked");
                }
            }
            likeFormUtil.applyLikeableInformations = function(likeableInformations) {
                likeableInformations.forEach((applyLikeableInformation) => {
                    likeFormUtil.applyLikeableInformation(applyLikeableInformation);
                });
            }

            function onLike() {
                const $likeActionLink = $(this);
                const likeableId = $likeActionLink.attr("data-likeableId");
                const $likeForm = $likeActionLink.parent();

                likeFormUtil.disable($likeForm);
                $.post("/data/like", {
                    action: "like",
                    likeableId: likeableId
                }, function (data) {
                    if (data["success"] === true) {
                        if (data["liked"]) {
                            Codeforces.showMessage('Added to liked');
                        } else {
                            Codeforces.showMessage('Removed from liked');
                        }
                        likeFormUtil.applyLikeableInformations(data["likeableInformations"]);
                    } else {
                        Codeforces.showMessage(data["message"] || "Error");
                    }
                    likeFormUtil.enable($likeForm);
                }, "json");
                return false;
            }

            function onDislike() {
                const $dislikeActionLink = $(this);
                const likeableId = $dislikeActionLink.attr("data-likeableId");
                const $likeForm = $dislikeActionLink.parent();

                likeFormUtil.disable($likeForm);
                $.post("/data/like", {
                    action: "dislike",
                    likeableId: likeableId
                }, function (data) {
                    if (data["success"] === true) {
                        if (data["disliked"]) {
                            Codeforces.showMessage('Added to disliked');
                        } else {
                            Codeforces.showMessage('Removed from disliked');
                        }
                        likeFormUtil.applyLikeableInformations(data["likeableInformations"]);
                    } else {
                        Codeforces.showMessage(data["message"] || "Error");
                    }
                    likeFormUtil.enable($likeForm);
                }, "json");
                return false;
            }

            $(".likeActionLink").click(onLike);
            $(".dislikeActionLink").click(onDislike);

            $(".likeCount").add(".dislikeCount").each(function () {
                const $count = $(this);
                likeFormUtil.setCount($count, likeFormUtil.getCount($count));
            });
        });
    </script>

<script data-nocturne="true"> $(function () {
}); </script>

 Great Problem</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="10770">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="193">193</span>
            </i>
        </a>
    </span>


 Good Problem</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="10771">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="52">52</span>
            </i>
        </a>
    </span>


 Okay Problem</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="10772">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="24">24</span>
            </i>
        </a>
    </span>


 Bad Problem</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="10818">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="14">14</span>
            </i>
        </a>
    </span>


 Did not solve</li> </ul></div></div><h4><a href="https://codeforces.com/contest/2124/problem/B">2124B - Minimise Sum</a></h4><p>Problem Credits: <a class="rated-user user-orange" href="https://codeforces.com/profile/cry" title="International Master cry">cry</a> <br></p><p>Special thanks to <a class="rated-user user-red" href="https://codeforces.com/profile/prvocislo" title="Grandmaster prvocislo">prvocislo</a> for misreading problem G to the statement of this problem, <a class="rated-user user-red" href="https://codeforces.com/profile/nifeshe" title="Grandmaster nifeshe">nifeshe</a> for solving it, and <a class="rated-user user-red" href="https://codeforces.com/profile/Dominater069" title="International Grandmaster Dominater069">Dominater069</a> for suggesting we use this problem!</p> <div class="spoiler"><b class="spoiler-title">Hint</b><div class="spoiler-content" style="display: block;"><p>Write some examples of arrays down.</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><p>The answer is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-12"><span class="MJXp-mo" id="MJXp-Span-13" style="margin-left: 0.333em; margin-right: 0.333em;">min</span><span class="MJXp-mo" id="MJXp-Span-14" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-15"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-16" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-17" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-18" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-19"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-20" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-21" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-22" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-23" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-24"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-25" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-26" style="vertical-align: -0.4em;">1</span></span></span></span><script type="math/tex" id="MathJax-Element-4">\min(a_1,a_2)+a_1</script>.</p><p>If <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-27"><span class="MJXp-msubsup" id="MJXp-Span-28"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-29" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-30" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-31" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-msubsup" id="MJXp-Span-32"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-33" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-34" style="vertical-align: -0.4em;">2</span></span></span></span><script type="math/tex" id="MathJax-Element-5">a_1>a_2</script>, we can perform the operation with <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-35"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-36">i</span><span class="MJXp-mo" id="MJXp-Span-37" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-38">1</span></span></span><script type="math/tex" id="MathJax-Element-6">i=1</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-39"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-40">j</span><span class="MJXp-mo" id="MJXp-Span-41" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-42">2</span></span></span><script type="math/tex" id="MathJax-Element-7">j=2</script>, so that the prefix minimum after index <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-43"><span class="MJXp-mn" id="MJXp-Span-44">2</span></span></span><script type="math/tex" id="MathJax-Element-8">2</script> will always be <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-45"><span class="MJXp-mn" id="MJXp-Span-46">0</span></span></span><script type="math/tex" id="MathJax-Element-9">0</script> to get <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-47"><span class="MJXp-msubsup" id="MJXp-Span-48"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-49" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-50" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-51" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-52"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-53" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-54" style="vertical-align: -0.4em;">2</span></span></span></span><script type="math/tex" id="MathJax-Element-10">a_1+a_2</script> as our answer. </p><p>If <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-55"><span class="MJXp-msubsup" id="MJXp-Span-56"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-57" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-58" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-59" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-msubsup" id="MJXp-Span-60"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-61" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-62" style="vertical-align: -0.4em;">2</span></span></span></span><script type="math/tex" id="MathJax-Element-11">a_1<a_2</script>, we can perform the operation with <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-63"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-64">i</span><span class="MJXp-mo" id="MJXp-Span-65" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-66">2</span></span></span><script type="math/tex" id="MathJax-Element-12">i=2</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-67"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-68">j</span><span class="MJXp-mo" id="MJXp-Span-69" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-70">3</span></span></span><script type="math/tex" id="MathJax-Element-13">j=3</script>. Since <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-71"><span class="MJXp-msubsup" id="MJXp-Span-72"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-73" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-74" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-75" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-msubsup" id="MJXp-Span-76"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-77" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-78" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-79" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-80">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-81">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-82">n</span><span class="MJXp-mo" id="MJXp-Span-83" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-84"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-85" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-86" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-87" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-88"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-89" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-90" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-91" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-92" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-93"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-94" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-95" style="vertical-align: -0.4em;">1</span></span></span></span><script type="math/tex" id="MathJax-Element-14">a_1<a_2, min(a_1,a_2)=a_1</script>. The prefix minimum will be <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-96"><span class="MJXp-mn" id="MJXp-Span-97">0</span></span></span><script type="math/tex" id="MathJax-Element-15">0</script> in index <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-98"><span class="MJXp-mn" id="MJXp-Span-99">3</span></span></span><script type="math/tex" id="MathJax-Element-16">3</script> and later. We should be careful about the edge case <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-100"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-101">n</span><span class="MJXp-mo" id="MJXp-Span-102" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-103">2</span></span></span><script type="math/tex" id="MathJax-Element-17">n=2</script>, as there is no index <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-104"><span class="MJXp-mn" id="MJXp-Span-105">3</span></span></span><script type="math/tex" id="MathJax-Element-18">3</script> we can use. However, if <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-106"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-107">n</span><span class="MJXp-mo" id="MJXp-Span-108" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-109">2</span></span></span><script type="math/tex" id="MathJax-Element-19">n=2</script>, we can simply not perform the operation.</p><p>We can easily show that the above cases are optimal for this problem. The code runs in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-110"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-111">O</span><span class="MJXp-mo" id="MJXp-Span-112" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-113">n</span><span class="MJXp-mo" id="MJXp-Span-114" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-20">O(n)</script>, bottlenecked by reading the array.</p></div></div> <div class="spoiler"><b class="spoiler-title">Code</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="kwd">import</span><span class="pln"> sys
input </span><span class="pun">=</span><span class="pln"> sys</span><span class="pun">.</span><span class="pln">stdin</span><span class="pun">.</span><span class="pln">readline
</span><span class="kwd">for</span><span class="pln"> _ </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="kwd">int</span><span class="pun">(</span><span class="pln">input</span><span class="pun">())):</span><span class="pln">
    n </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">(</span><span class="pln">input</span><span class="pun">())</span><span class="pln">
    a </span><span class="pun">=</span><span class="pln"> list</span><span class="pun">(</span><span class="pln">map</span><span class="pun">(</span><span class="kwd">int</span><span class="pun">,</span><span class="pln"> input</span><span class="pun">().</span><span class="pln">split</span><span class="pun">()))</span><span class="pln">
    </span><span class="kwd">print</span><span class="pun">(</span><span class="pln">min</span><span class="pun">(</span><span class="lit">2</span><span class="pun">*</span><span class="pln">a</span><span class="pun">[</span><span class="lit">0</span><span class="pun">],</span><span class="pln"> a</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> a</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]))</span></code></pre></div></div> <div class="spoiler"><b class="spoiler-title">Rate the Problem</b><div class="spoiler-content" style="display: block;"><ul>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="10773">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="317">317</span>
            </i>
        </a>
    </span>


 Great Problem</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="10774">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="95">95</span>
            </i>
        </a>
    </span>


 Good Problem</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="10775">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="84">84</span>
            </i>
        </a>
    </span>


 Okay Problem</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="10776">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="42">42</span>
            </i>
        </a>
    </span>


 Bad Problem</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="10819">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="26">26</span>
            </i>
        </a>
    </span>


 Did not solve</li> </ul></div></div><h4><a href="https://codeforces.com/contest/2124/problem/C">2124C - Subset Multiplication</a></h4><p>Problem Credits: <a class="rated-user user-orange" href="https://codeforces.com/profile/Proof_by_QED" title="Master Proof_by_QED">Proof_by_QED</a> <br></p> <div class="spoiler"><b class="spoiler-title">Hint 1</b><div class="spoiler-content" style="display: block;"><p>Come up with some numbers that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-115"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-116">x</span></span></span><script type="math/tex" id="MathJax-Element-21">x</script> must be a multiple of.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 2</b><div class="spoiler-content" style="display: block;"><p>Take the LCM. Prove its sufficient (optional).</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><p>First, note that in order for <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-117"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-118">b</span></span></span><script type="math/tex" id="MathJax-Element-22">b</script> to be obtainable after an array <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-119"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-120">a</span></span></span><script type="math/tex" id="MathJax-Element-23">a</script>, each <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-121"><span class="MJXp-msubsup" id="MJXp-Span-122"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-123" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-124" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-24">a_i</script> should be a factor of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-125"><span class="MJXp-msubsup" id="MJXp-Span-126"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-127" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-128" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-25">b_i</script>. We can find that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-129"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-130">x</span></span></span><script type="math/tex" id="MathJax-Element-26">x</script> must be a multiple of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-131"><span class="MJXp-msubsup" id="MJXp-Span-132"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-133" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-134" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mrow" id="MJXp-Span-135"><span class="MJXp-mo" id="MJXp-Span-136" style="margin-left: 0.111em; margin-right: 0.111em;">/</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-137">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-138">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-139">d</span><span class="MJXp-mo" id="MJXp-Span-140" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-141"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-142" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-143" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-144" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-145"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-146" style="margin-right: 0.05em;">b</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-147" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-148">i</span><span class="MJXp-mo" id="MJXp-Span-149">+</span><span class="MJXp-mn" id="MJXp-Span-150">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-151" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-27">b_i/gcd(b_i, b_{i+1})</script> for each <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-152"><span class="MJXp-mn" id="MJXp-Span-153">1</span><span class="MJXp-mo" id="MJXp-Span-154" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-155">i</span><span class="MJXp-mo" id="MJXp-Span-156" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-157">n</span></span></span><script type="math/tex" id="MathJax-Element-28">1 \leq i < n</script> as a lower bound for the answer.</p><p>Let's prove that these conditions are also sufficient. To do this, let's analyze each pair <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-158"><span class="MJXp-mo" id="MJXp-Span-159" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-160">i</span><span class="MJXp-mo" id="MJXp-Span-161" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-162">i</span><span class="MJXp-mo" id="MJXp-Span-163" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-164">1</span><span class="MJXp-mo" id="MJXp-Span-165" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-29">(i,i+1)</script> separately. We analyze the following cases:</p> <ul>   <li>if <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-166"><span class="MJXp-msubsup" id="MJXp-Span-167"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-168" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-169" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-170" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-171"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-172" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-173" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-174" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-175">x</span></span></span><script type="math/tex" id="MathJax-Element-30">b_i=a_i\cdot x</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-176"><span class="MJXp-msubsup" id="MJXp-Span-177"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-178" style="margin-right: 0.05em;">b</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-179" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-180">i</span><span class="MJXp-mo" id="MJXp-Span-181">+</span><span class="MJXp-mn" id="MJXp-Span-182">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-183" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-184"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-185" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-186" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-187">i</span><span class="MJXp-mo" id="MJXp-Span-188">+</span><span class="MJXp-mn" id="MJXp-Span-189">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-190" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-191">x</span></span></span><script type="math/tex" id="MathJax-Element-31">b_{i+1}=a_{i+1}\cdot x</script>, or <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-192"><span class="MJXp-msubsup" id="MJXp-Span-193"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-194" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-195" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-196" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-197"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-198" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-199" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-32">b_i=a_i</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-200"><span class="MJXp-msubsup" id="MJXp-Span-201"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-202" style="margin-right: 0.05em;">b</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-203" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-204">i</span><span class="MJXp-mo" id="MJXp-Span-205">+</span><span class="MJXp-mn" id="MJXp-Span-206">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-207" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-208"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-209" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-210" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-211">i</span><span class="MJXp-mo" id="MJXp-Span-212">+</span><span class="MJXp-mn" id="MJXp-Span-213">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-33">b_{i+1}=a_{i+1}</script>: in both cases, the choice of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-214"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-215">x</span></span></span><script type="math/tex" id="MathJax-Element-34">x</script> does not matter. The array is good if <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-216"><span class="MJXp-msubsup" id="MJXp-Span-217"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-218" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-219" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-35">b_i</script> divides <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-220"><span class="MJXp-msubsup" id="MJXp-Span-221"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-222" style="margin-right: 0.05em;">b</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-223" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-224">i</span><span class="MJXp-mo" id="MJXp-Span-225">+</span><span class="MJXp-mn" id="MJXp-Span-226">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-36">b_{i+1}</script> initially.</li>   <li>If <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-227"><span class="MJXp-msubsup" id="MJXp-Span-228"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-229" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-230" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-231" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-232"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-233" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-234" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-235" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-236">x</span></span></span><script type="math/tex" id="MathJax-Element-37">b_i=a_i\cdot x</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-237"><span class="MJXp-msubsup" id="MJXp-Span-238"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-239" style="margin-right: 0.05em;">b</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-240" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-241">i</span><span class="MJXp-mo" id="MJXp-Span-242">+</span><span class="MJXp-mn" id="MJXp-Span-243">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-244" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-245"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-246" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-247" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-248">i</span><span class="MJXp-mo" id="MJXp-Span-249">+</span><span class="MJXp-mn" id="MJXp-Span-250">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-38">b_{i+1}=a_{i+1}</script>, then taking the LCM over all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-251"><span class="MJXp-mn" id="MJXp-Span-252">1</span><span class="MJXp-mo" id="MJXp-Span-253" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-254">i</span><span class="MJXp-mo" id="MJXp-Span-255" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-256">n</span></span></span><script type="math/tex" id="MathJax-Element-39">1 \leq i < n</script> should ensure this case is always correct.</li>   <li>If <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-257"><span class="MJXp-msubsup" id="MJXp-Span-258"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-259" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-260" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-261" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-262"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-263" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-264" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-40">b_i=a_i</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-265"><span class="MJXp-msubsup" id="MJXp-Span-266"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-267" style="margin-right: 0.05em;">b</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-268" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-269">i</span><span class="MJXp-mo" id="MJXp-Span-270">+</span><span class="MJXp-mn" id="MJXp-Span-271">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-272" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-273"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-274" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-275" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-276">i</span><span class="MJXp-mo" id="MJXp-Span-277">+</span><span class="MJXp-mn" id="MJXp-Span-278">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-279" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-280">x</span></span></span><script type="math/tex" id="MathJax-Element-41">b_{i+1}=a_{i+1}\cdot x</script>, then a larger value of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-281"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-282">x</span></span></span><script type="math/tex" id="MathJax-Element-42">x</script> cannot possibly be beneficial, as the product <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-283"><span class="MJXp-mfrac" id="MJXp-Span-284" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-msubsup" id="MJXp-Span-285"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-286" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-287" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-288">i</span><span class="MJXp-mo" id="MJXp-Span-289">+</span><span class="MJXp-mn" id="MJXp-Span-290">1</span></span></span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-msubsup" id="MJXp-Span-291"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-292" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-293" style="vertical-align: -0.4em;">i</span></span></span></span></span></span></span></span></span><script type="math/tex" id="MathJax-Element-43">\frac{a_{i+1}}{a_i}</script> decreases.</li> </ul><p>Since the problem guarantees <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-294"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-295">x</span></span></span><script type="math/tex" id="MathJax-Element-44">x</script> exists, taking the LCM and outputting suffices. The solution runs in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-296"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-297">O</span><span class="MJXp-mo" id="MJXp-Span-298" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-299">n</span><span class="MJXp-mi" id="MJXp-Span-300">log</span><span class="MJXp-mo" id="MJXp-Span-301" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mrow" id="MJXp-Span-302"><span class="MJXp-msubsup" id="MJXp-Span-303"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-304" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-305" style="vertical-align: -0.4em;">i</span></span></span><span class="MJXp-mo" id="MJXp-Span-306" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-45">O(n \log{a_i})</script>.</p></div></div> <div class="spoiler"><b class="spoiler-title">Code</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="kwd">import</span><span class="pln"> sys
input </span><span class="pun">=</span><span class="pln"> sys</span><span class="pun">.</span><span class="pln">stdin</span><span class="pun">.</span><span class="pln">readline
</span><span class="kwd">import</span><span class="pln"> math
</span><span class="kwd">for</span><span class="pln"> _ </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="kwd">int</span><span class="pun">(</span><span class="pln">input</span><span class="pun">())):</span><span class="pln">
    n </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">(</span><span class="pln">input</span><span class="pun">())</span><span class="pln">
    a </span><span class="pun">=</span><span class="pln"> list</span><span class="pun">(</span><span class="pln">map</span><span class="pun">(</span><span class="kwd">int</span><span class="pun">,</span><span class="pln"> input</span><span class="pun">().</span><span class="pln">split</span><span class="pun">()))</span><span class="pln">
    gcd </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
    lcm </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> i </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="pln">n</span><span class="pun">-</span><span class="lit">1</span><span class="pun">,-</span><span class="lit">1</span><span class="pun">,-</span><span class="lit">1</span><span class="pun">):</span><span class="pln">
        gcd </span><span class="pun">=</span><span class="pln"> math</span><span class="pun">.</span><span class="pln">gcd</span><span class="pun">(</span><span class="pln">gcd</span><span class="pun">,</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln">
        lcm </span><span class="pun">=</span><span class="pln"> math</span><span class="pun">.</span><span class="pln">lcm</span><span class="pun">(</span><span class="pln">lcm</span><span class="pun">,</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="com">// gcd)</span><span class="pln">
    </span><span class="kwd">print</span><span class="pun">(</span><span class="pln">lcm</span><span class="pun">)</span></code></pre></div></div> <div class="spoiler"><b class="spoiler-title">Bonus</b><div class="spoiler-content" style="display: block;"><p>Solve the old version of this problem: given the array <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-307"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-308">b</span></span></span><script type="math/tex" id="MathJax-Element-46">b</script> (where a solution is no longer guaranteed), output any array <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-309"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-310">a</span></span></span><script type="math/tex" id="MathJax-Element-47">a</script> or claim it is not possible to obtain <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-311"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-312">b</span></span></span><script type="math/tex" id="MathJax-Element-48">b</script> through a valid array <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-313"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-314">a</span></span></span><script type="math/tex" id="MathJax-Element-49">a</script>.</p></div></div> <div class="spoiler"><b class="spoiler-title">Rate the Problem</b><div class="spoiler-content" style="display: block;"><ul>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="10777">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="404">404</span>
            </i>
        </a>
    </span>


 Great Problem</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="10778">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="69">69</span>
            </i>
        </a>
    </span>


 Good Problem</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="10779">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="37">37</span>
            </i>
        </a>
    </span>


 Okay Problem</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="10780">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="78">78</span>
            </i>
        </a>
    </span>


 Bad Problem</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="10820">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="62">62</span>
            </i>
        </a>
    </span>


 Did not solve</li> </ul></div></div><h4><a href="https://codeforces.com/contest/2124/problem/D">2124D - Make a Palindrome</a></h4><p>Problem Credits: <a class="rated-user user-orange" href="https://codeforces.com/profile/satyam343" title="Master satyam343">satyam343</a> <br></p> <div class="spoiler"><b class="spoiler-title">Hint 1</b><div class="spoiler-content" style="display: block;"><p>Determine which elements you can delete with the operation.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 2</b><div class="spoiler-content" style="display: block;"><p>Come up with a greedy solution that erases as little elements as possible.</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><p>First, let's come up with some conditions that determines whether erasing an element is possible. </p><p>Claim: as long as the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-315"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-316">k</span><span class="MJXp-mo" id="MJXp-Span-317" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-318">1</span></span></span><script type="math/tex" id="MathJax-Element-50">k-1</script> smallest elements remain in the array, we can erase other elements in any way we want.</p><p>Proof: It is obvious why we cannot erase the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-319"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-320">k</span><span class="MJXp-mo" id="MJXp-Span-321" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-322">1</span></span></span><script type="math/tex" id="MathJax-Element-51">k-1</script> smallest elements. If we want to erase any other element, we can simply start the following process to determine a pair of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-323"><span class="MJXp-mo" id="MJXp-Span-324" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-325">l</span><span class="MJXp-mo" id="MJXp-Span-326" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-327">r</span><span class="MJXp-mo" id="MJXp-Span-328" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-52">(l,r)</script> where we can erase the element: initially, start <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-329"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-330">l</span><span class="MJXp-mo" id="MJXp-Span-331" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-332">1</span></span></span><script type="math/tex" id="MathJax-Element-53">l=1</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-333"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-334">r</span><span class="MJXp-mo" id="MJXp-Span-335" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-336">n</span></span></span><script type="math/tex" id="MathJax-Element-54">r=n</script>. Clearly, the element we want to erase is at least the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-337"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-338">k</span></span></span><script type="math/tex" id="MathJax-Element-55">k</script>-th smallest element. After that, we can incrementally either increase <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-339"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-340">l</span></span></span><script type="math/tex" id="MathJax-Element-56">l</script> or decrease <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-341"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-342">r</span></span></span><script type="math/tex" id="MathJax-Element-57">r</script> until the element is exactly the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-343"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-344">k</span></span></span><script type="math/tex" id="MathJax-Element-58">k</script>-th smallest. This process should always terminate because after <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-345"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-346">r</span><span class="MJXp-mo" id="MJXp-Span-347" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-348">l</span><span class="MJXp-mo" id="MJXp-Span-349" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-350">1</span><span class="MJXp-mo" id="MJXp-Span-351" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-352">k</span></span></span><script type="math/tex" id="MathJax-Element-59">r-l+1<k</script>, the element we want to delete is definitely less than the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-353"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-354">k</span></span></span><script type="math/tex" id="MathJax-Element-60">k</script>-th smallest.</p><p>Let the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-355"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-356">k</span><span class="MJXp-mo" id="MJXp-Span-357" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-358">1</span></span></span><script type="math/tex" id="MathJax-Element-61">k-1</script>-th smallest element be <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-359"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-360">x</span></span></span><script type="math/tex" id="MathJax-Element-62">x</script>. Now, we can categorize each element in the array into three groups: elements less than <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-361"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-362">x</span></span></span><script type="math/tex" id="MathJax-Element-63">x</script>, elements equal to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-363"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-364">x</span></span></span><script type="math/tex" id="MathJax-Element-64">x</script>, and elements greater than <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-365"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-366">x</span></span></span><script type="math/tex" id="MathJax-Element-65">x</script>. Note there is no point in keeping any elements in the third group, so we can erase them first (by creating a second array <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-367"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-368">b</span></span></span><script type="math/tex" id="MathJax-Element-66">b</script> filled with only elements of the first and second groups). Now, we must strategically delete elements of the second group to make a palindrome. Note that we should try to erase as little elements as possible, because we must ensure the number of elements we don't erase is at least <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-369"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-370">k</span><span class="MJXp-mo" id="MJXp-Span-371" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-372">1</span></span></span><script type="math/tex" id="MathJax-Element-67">k-1</script>. We can maintain this process with a two-pointers approach. Initialize <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-373"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-374">l</span><span class="MJXp-mo" id="MJXp-Span-375" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-376">1</span></span></span><script type="math/tex" id="MathJax-Element-68">l=1</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-377"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-378">r</span><span class="MJXp-mo" id="MJXp-Span-379" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mrow" id="MJXp-Span-380"><span class="MJXp-mo" id="MJXp-Span-381" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-382">b</span><span class="MJXp-mrow" id="MJXp-Span-383"><span class="MJXp-mo" id="MJXp-Span-384" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span></span></span><script type="math/tex" id="MathJax-Element-69">r=|b|</script>. Then, if <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-385"><span class="MJXp-msubsup" id="MJXp-Span-386"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-387" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-388" style="vertical-align: -0.4em;">l</span></span><span class="MJXp-mo" id="MJXp-Span-389" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-390"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-391" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-392" style="vertical-align: -0.4em;">r</span></span></span></span><script type="math/tex" id="MathJax-Element-70">b_l=b_r</script>, we can keep both. If <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-393"><span class="MJXp-msubsup" id="MJXp-Span-394"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-395" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-396" style="vertical-align: -0.4em;">l</span></span><span class="MJXp-mo" id="MJXp-Span-397" style="margin-left: 0.333em; margin-right: 0.333em;">≠</span><span class="MJXp-msubsup" id="MJXp-Span-398"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-399" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-400" style="vertical-align: -0.4em;">r</span></span></span></span><script type="math/tex" id="MathJax-Element-71">b_l\neq b_r</script> and neither elements is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-401"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-402">x</span></span></span><script type="math/tex" id="MathJax-Element-72">x</script>, we can conclude it's impossible. If one of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-403"><span class="MJXp-msubsup" id="MJXp-Span-404"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-405" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-406" style="vertical-align: -0.4em;">l</span></span><span class="MJXp-mo" id="MJXp-Span-407" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-408"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-409" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-410" style="vertical-align: -0.4em;">r</span></span></span></span><script type="math/tex" id="MathJax-Element-73">b_l,b_r</script> is equal to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-411"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-412">x</span></span></span><script type="math/tex" id="MathJax-Element-74">x</script>, we should flag the one equal to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-413"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-414">x</span></span></span><script type="math/tex" id="MathJax-Element-75">x</script> as being deleted and move the pointer. In the end, we can do a final check to ensure we did not erase too many elements.</p><p>The final solution runs in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-415"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-416">O</span><span class="MJXp-mo" id="MJXp-Span-417" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-418">n</span><span class="MJXp-mi" id="MJXp-Span-419">log</span><span class="MJXp-mo" id="MJXp-Span-420" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-421" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-422">n</span><span class="MJXp-mo" id="MJXp-Span-423" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-424" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-76">O(n \log(n))</script> due to sorting to find the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-425"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-426">k</span></span></span><script type="math/tex" id="MathJax-Element-77">k</script>-th smallest element.</p></div></div> <div class="spoiler"><b class="spoiler-title">Code</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">typedef</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> ll</span><span class="pun">;</span><span class="pln">
</span><span class="com">#define</span><span class="pln"> all</span><span class="pun">(</span><span class="pln">x</span><span class="pun">)</span><span class="pln"> x</span><span class="pun">.</span><span class="kwd">begin</span><span class="pun">(),</span><span class="pln"> x</span><span class="pun">.</span><span class="kwd">end</span><span class="pun">()</span><span class="pln">
</span><span class="com">#define</span><span class="pln"> vecin</span><span class="pun">(</span><span class="pln">name</span><span class="pun">,</span><span class="pln"> len</span><span class="pun">)</span><span class="pln"> vector</span><span class="str">&lt;int&gt;</span><span class="pln"> name</span><span class="pun">(</span><span class="pln">len</span><span class="pun">);</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">auto</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">_ </span><span class="pun">:</span><span class="pln"> name</span><span class="pun">)</span><span class="pln"> cin </span><span class="pun">&gt;&gt;</span><span class="pln"> _</span><span class="pun">;</span><span class="pln">
</span><span class="com">#define</span><span class="pln"> vecout</span><span class="pun">(</span><span class="pln">v</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">auto</span><span class="pln"> _ </span><span class="pun">:</span><span class="pln"> v</span><span class="pun">)</span><span class="pln"> cout </span><span class="pun">&lt;&lt;</span><span class="pln"> _ </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">" "</span><span class="pun">;</span><span class="pln"> cout </span><span class="pun">&lt;&lt;</span><span class="pln"> endl</span><span class="pun">;</span><span class="pln">
 
 
</span><span class="kwd">void</span><span class="pln"> solve</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> k</span><span class="pun">;</span><span class="pln"> cin </span><span class="pun">&gt;&gt;</span><span class="pln"> k</span><span class="pun">;</span><span class="pln">
    vecin</span><span class="pun">(</span><span class="pln">aa</span><span class="pun">,</span><span class="pln"> n</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">k </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"YES"</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> endl</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">return</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
 
    vector</span><span class="str">&lt;int&gt;</span><span class="pln"> bb </span><span class="pun">=</span><span class="pln"> aa</span><span class="pun">;</span><span class="pln">
    sort</span><span class="pun">(</span><span class="pln">all</span><span class="pun">(</span><span class="pln">bb</span><span class="pun">));</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> cutoff </span><span class="pun">=</span><span class="pln"> bb</span><span class="pun">[</span><span class="pln">k </span><span class="pun">-</span><span class="pln"> </span><span class="lit">2</span><span class="pun">];</span><span class="pln">
    vector</span><span class="str">&lt;int&gt;</span><span class="pln"> cc</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">auto</span><span class="pln"> a </span><span class="pun">:</span><span class="pln"> aa</span><span class="pun">)</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a </span><span class="pun">&lt;=</span><span class="pln"> cutoff</span><span class="pun">)</span><span class="pln">
            cc</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">a</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> spare </span><span class="pun">=</span><span class="pln"> cc</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> k </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> L </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> R </span><span class="pun">=</span><span class="pln"> cc</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">bool</span><span class="pln"> bad </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">L </span><span class="pun">&lt;</span><span class="pln"> R</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">cc</span><span class="pun">[</span><span class="pln">L</span><span class="pun">]</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> cc</span><span class="pun">[</span><span class="pln">R</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">spare </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                bad </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">cc</span><span class="pun">[</span><span class="pln">L</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> cutoff</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                L </span><span class="pun">++;</span><span class="pln">
                spare </span><span class="pun">--;</span><span class="pln">
            </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">cc</span><span class="pun">[</span><span class="pln">R</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> cutoff</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                R </span><span class="pun">--;</span><span class="pln">
                spare </span><span class="pun">--;</span><span class="pln">
            </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                bad </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
            </span><span class="kwd">continue</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        L </span><span class="pun">++;</span><span class="pln">
        R </span><span class="pun">--;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">bad</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"NO"</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> endl</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"YES"</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> endl</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	ios_base</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="kwd">false</span><span class="pun">);</span><span class="pln">
    cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="pln">NULL</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> tt </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
 
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> tt</span><span class="pun">;</span><span class="pln">
 
    </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">tt</span><span class="pun">--)</span><span class="pln"> solve</span><span class="pun">();</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div> <div class="spoiler"><b class="spoiler-title">Rate the Problem</b><div class="spoiler-content" style="display: block;"><ul>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="10781">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="354">354</span>
            </i>
        </a>
    </span>


 Great Problem</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="10782">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="39">39</span>
            </i>
        </a>
    </span>


 Good Problem</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="10783">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="21">21</span>
            </i>
        </a>
    </span>


 Okay Problem</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="10784">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="47">47</span>
            </i>
        </a>
    </span>


 Bad Problem</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="10821">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="57">57</span>
            </i>
        </a>
    </span>


 Did not solve</li> </ul></div></div><h4><a href="https://codeforces.com/contest/2124/problem/E">2124E - Make it Zero</a></h4><p>Problem Credits: <a class="rated-user user-orange" href="https://codeforces.com/profile/satyam343" title="Master satyam343">satyam343</a> <br></p> <div class="spoiler"><b class="spoiler-title">Hint 0</b><div class="spoiler-content" style="display: block;"><p>Solve the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-427"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-428">n</span><span class="MJXp-mo" id="MJXp-Span-429" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-430">3</span></span></span><script type="math/tex" id="MathJax-Element-78">n=3</script> case first.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 1</b><div class="spoiler-content" style="display: block;"><p>The answer is either <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-431"><span class="MJXp-mo" id="MJXp-Span-432" style="margin-left: 0em; margin-right: 0.111em;">−</span><span class="MJXp-mn" id="MJXp-Span-433">1</span></span></span><script type="math/tex" id="MathJax-Element-79">-1</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-434"><span class="MJXp-mn" id="MJXp-Span-435">1</span></span></span><script type="math/tex" id="MathJax-Element-80">1</script>, or <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-436"><span class="MJXp-mn" id="MJXp-Span-437">2</span></span></span><script type="math/tex" id="MathJax-Element-81">2</script>.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 2</b><div class="spoiler-content" style="display: block;"><p>First, find a construction in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-438"><span class="MJXp-mn" id="MJXp-Span-439">3</span></span></span><script type="math/tex" id="MathJax-Element-82">3</script>. Then, optimize that to be done in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-440"><span class="MJXp-mn" id="MJXp-Span-441">2</span></span></span><script type="math/tex" id="MathJax-Element-83">2</script> moves.</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><p>First, let's determine when the answer is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-442"><span class="MJXp-mo" id="MJXp-Span-443" style="margin-left: 0em; margin-right: 0.111em;">−</span><span class="MJXp-mn" id="MJXp-Span-444">1</span></span></span><script type="math/tex" id="MathJax-Element-84">-1</script>. Let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-445"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-446">s</span></span></span><script type="math/tex" id="MathJax-Element-85">s</script> be the sum of all elements in the array. The answer is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-447"><span class="MJXp-mo" id="MJXp-Span-448" style="margin-left: 0em; margin-right: 0.111em;">−</span><span class="MJXp-mn" id="MJXp-Span-449">1</span></span></span><script type="math/tex" id="MathJax-Element-86">-1</script> if:</p> <ul>   <li><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-450"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-451">s</span></span></span><script type="math/tex" id="MathJax-Element-87">s</script> is odd, or</li>   <li>There exists an element that is greater than half of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-452"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-453">s</span></span></span><script type="math/tex" id="MathJax-Element-88">s</script>.</li> </ul><p>If neither of the above conditions hold, we can definitely get a solution in finitely many moves by simply subtracting <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-454"><span class="MJXp-mn" id="MJXp-Span-455">1</span></span></span><script type="math/tex" id="MathJax-Element-89">1</script> from the largest element and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-456"><span class="MJXp-mn" id="MJXp-Span-457">1</span></span></span><script type="math/tex" id="MathJax-Element-90">1</script> from an arbitrary element in one move.</p><p>Let's now solve the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-458"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-459">n</span><span class="MJXp-mo" id="MJXp-Span-460" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-461">3</span></span></span><script type="math/tex" id="MathJax-Element-91">n=3</script> case to grab some intuition. There's of course trivial cases where the answer is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-462"><span class="MJXp-mn" id="MJXp-Span-463">1</span></span></span><script type="math/tex" id="MathJax-Element-92">1</script> (where the first or last element is the sum of the other two). One array we may want to examine is where the second element is the sum of the first and last, like <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-464"><span class="MJXp-mo" id="MJXp-Span-465" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mn" id="MJXp-Span-466">1</span><span class="MJXp-mo" id="MJXp-Span-467" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-468">3</span><span class="MJXp-mo" id="MJXp-Span-469" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-470">2</span><span class="MJXp-mo" id="MJXp-Span-471" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-93">[1,3,2]</script>. We can of course solve this in two moves, by setting <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-472"><span class="MJXp-msubsup" id="MJXp-Span-473"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-474" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-475" style="vertical-align: -0.4em;">1</span></span></span></span><script type="math/tex" id="MathJax-Element-94">a_1</script> to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-476"><span class="MJXp-mn" id="MJXp-Span-477">0</span></span></span><script type="math/tex" id="MathJax-Element-95">0</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-478"><span class="MJXp-msubsup" id="MJXp-Span-479"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-480" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-481" style="vertical-align: -0.4em;">2</span></span></span></span><script type="math/tex" id="MathJax-Element-96">a_2</script> to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-482"><span class="MJXp-msubsup" id="MJXp-Span-483"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-484" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-485" style="vertical-align: -0.4em;">3</span></span></span></span><script type="math/tex" id="MathJax-Element-97">a_3</script> on the first move. What about some array where the middle element is less than the sum of the other two? For example, the array <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-486"><span class="MJXp-mo" id="MJXp-Span-487" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mn" id="MJXp-Span-488">3</span><span class="MJXp-mo" id="MJXp-Span-489" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-490">4</span><span class="MJXp-mo" id="MJXp-Span-491" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-492">3</span><span class="MJXp-mo" id="MJXp-Span-493" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-98">[3,4,3]</script>. One thing we can try is trying to subtract from <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-494"><span class="MJXp-msubsup" id="MJXp-Span-495"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-496" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-497" style="vertical-align: -0.4em;">1</span></span></span></span><script type="math/tex" id="MathJax-Element-99">a_1</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-498"><span class="MJXp-msubsup" id="MJXp-Span-499"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-500" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-501" style="vertical-align: -0.4em;">3</span></span></span></span><script type="math/tex" id="MathJax-Element-100">a_3</script> so we can reduce to the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-502"><span class="MJXp-msubsup" id="MJXp-Span-503"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-504" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-505" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-506" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-507"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-508" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-509" style="vertical-align: -0.4em;">3</span></span><span class="MJXp-mo" id="MJXp-Span-510" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-511"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-512" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-513" style="vertical-align: -0.4em;">2</span></span></span></span><script type="math/tex" id="MathJax-Element-101">a_1+a_3=a_2</script> case. Is this always possible? Turns out, it is always possible as long as <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-514"><span class="MJXp-msubsup" id="MJXp-Span-515"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-516" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-517" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-518" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-msubsup" id="MJXp-Span-519"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-520" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-521" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-522" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-523"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-524" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-525" style="vertical-align: -0.4em;">3</span></span></span></span><script type="math/tex" id="MathJax-Element-102">a_2<a_1+a_3</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-526"><span class="MJXp-msubsup" id="MJXp-Span-527"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-528" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-529" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-530" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-531"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-532" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-533" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-534" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-535"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-536" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-537" style="vertical-align: -0.4em;">3</span></span></span></span><script type="math/tex" id="MathJax-Element-103">a_1+a_2+a_3</script> is even (in this case, we would turn it into <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-538"><span class="MJXp-mo" id="MJXp-Span-539" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mn" id="MJXp-Span-540">2</span><span class="MJXp-mo" id="MJXp-Span-541" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-542">4</span><span class="MJXp-mo" id="MJXp-Span-543" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-544">2</span><span class="MJXp-mo" id="MJXp-Span-545" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-104">[2,4,2]</script> after our first move). We can even optimize it to two moves by combining two moves into one. In the case of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-546"><span class="MJXp-mo" id="MJXp-Span-547" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mn" id="MJXp-Span-548">3</span><span class="MJXp-mo" id="MJXp-Span-549" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-550">4</span><span class="MJXp-mo" id="MJXp-Span-551" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-552">3</span><span class="MJXp-mo" id="MJXp-Span-553" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-105">[3,4,3]</script>, we can transform the array to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-554"><span class="MJXp-mo" id="MJXp-Span-555" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mn" id="MJXp-Span-556">2</span><span class="MJXp-mo" id="MJXp-Span-557" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-558">2</span><span class="MJXp-mo" id="MJXp-Span-559" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-560">0</span><span class="MJXp-mo" id="MJXp-Span-561" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-106">[2,2,0]</script> after the first move, combining two of the moves.</p><p>It turns out we can generalize the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-562"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-563">n</span><span class="MJXp-mo" id="MJXp-Span-564" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-565">3</span></span></span><script type="math/tex" id="MathJax-Element-107">n=3</script> case for any <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-566"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-567">n</span></span></span><script type="math/tex" id="MathJax-Element-108">n</script>, by simply finding one "pivot" element to act as <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-568"><span class="MJXp-msubsup" id="MJXp-Span-569"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-570" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-571" style="vertical-align: -0.4em;">2</span></span></span></span><script type="math/tex" id="MathJax-Element-109">a_2</script>, then letting <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-572"><span class="MJXp-msubsup" id="MJXp-Span-573"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-574" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-575" style="vertical-align: -0.4em;">1</span></span></span></span><script type="math/tex" id="MathJax-Element-110">a_1</script> be the sum of prefix before that and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-576"><span class="MJXp-msubsup" id="MJXp-Span-577"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-578" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-579" style="vertical-align: -0.4em;">3</span></span></span></span><script type="math/tex" id="MathJax-Element-111">a_3</script> be the sum of suffix after that. Let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-580"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-581">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-582">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-583">s</span></span></span><script type="math/tex" id="MathJax-Element-112">pos</script> be the unique position in the array where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-584"><span class="MJXp-msubsup" id="MJXp-Span-585"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-586" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-587" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-588" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-589"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-590" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-591" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-592" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mo" id="MJXp-Span-593" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-594" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-595"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-596" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-597" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-598">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-599">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-600">s</span><span class="MJXp-mo" id="MJXp-Span-601">−</span><span class="MJXp-mn" id="MJXp-Span-602">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-603" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mfrac" id="MJXp-Span-604" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-605">s</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mn" id="MJXp-Span-606">2</span></span></span></span></span></span></span></span><script type="math/tex" id="MathJax-Element-113">a_1+a_2+\ldots+a_{pos-1}< \frac{s}{2}</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-607"><span class="MJXp-msubsup" id="MJXp-Span-608"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-609" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-610" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-611" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-612"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-613" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-614" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-615" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mo" id="MJXp-Span-616" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-617" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-618"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-619" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-620" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-621">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-622">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-623">s</span></span></span><span class="MJXp-mo" id="MJXp-Span-624" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mfrac" id="MJXp-Span-625" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-626">s</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mn" id="MJXp-Span-627">2</span></span></span></span></span></span></span></span><script type="math/tex" id="MathJax-Element-114">a_1+a_2+\ldots+a_{pos}\geq\frac{s}{2}</script>. Let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-628"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-629">x</span><span class="MJXp-mo" id="MJXp-Span-630" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-631">y</span><span class="MJXp-mo" id="MJXp-Span-632" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-633">z</span></span></span><script type="math/tex" id="MathJax-Element-115">x,y,z</script> denote <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-634"><span class="MJXp-msubsup" id="MJXp-Span-635"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-636" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-637" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-638" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-639"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-640" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-641" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-642" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mo" id="MJXp-Span-643" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-644" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-645"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-646" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-647" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-648">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-649">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-650">s</span><span class="MJXp-mo" id="MJXp-Span-651">−</span><span class="MJXp-mn" id="MJXp-Span-652">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-116">a_1+a_2+\ldots+a_{pos-1}</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-653"><span class="MJXp-msubsup" id="MJXp-Span-654"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-655" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-656" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-657">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-658">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-659">s</span></span></span></span></span><script type="math/tex" id="MathJax-Element-117">a_{pos}</script>, and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-660"><span class="MJXp-msubsup" id="MJXp-Span-661"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-662" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-663" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-664">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-665">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-666">s</span><span class="MJXp-mo" id="MJXp-Span-667">+</span><span class="MJXp-mn" id="MJXp-Span-668">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-669" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-670"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-671" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-672" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-673">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-674">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-675">s</span><span class="MJXp-mo" id="MJXp-Span-676">+</span><span class="MJXp-mn" id="MJXp-Span-677">2</span></span></span><span class="MJXp-mo" id="MJXp-Span-678" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mo" id="MJXp-Span-679" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-680" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-681"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-682" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-683" style="vertical-align: -0.4em;">n</span></span></span></span><script type="math/tex" id="MathJax-Element-118">a_{pos+1}+a_{pos+2}+\ldots+a_n</script> respectively. Precisely, our goal is to make <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-684"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-685">x</span><span class="MJXp-mo" id="MJXp-Span-686" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-687">z</span><span class="MJXp-mo" id="MJXp-Span-688" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-689">y</span></span></span><script type="math/tex" id="MathJax-Element-119">x+z=y</script> in the first move after subtracting a non-negative integer <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-690"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-691">w</span></span></span><script type="math/tex" id="MathJax-Element-120">w</script> from both <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-692"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-693">x</span></span></span><script type="math/tex" id="MathJax-Element-121">x</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-694"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-695">y</span></span></span><script type="math/tex" id="MathJax-Element-122">y</script>, make <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-696"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-697">x</span><span class="MJXp-mo" id="MJXp-Span-698" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-699">0</span></span></span><script type="math/tex" id="MathJax-Element-123">x=0</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-700"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-701">z</span><span class="MJXp-mo" id="MJXp-Span-702" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-703">y</span></span></span><script type="math/tex" id="MathJax-Element-124">z=y</script> after the second move, and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-704"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-705">x</span><span class="MJXp-mo" id="MJXp-Span-706" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-707">y</span><span class="MJXp-mo" id="MJXp-Span-708" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-709">z</span><span class="MJXp-mo" id="MJXp-Span-710" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-711">0</span></span></span><script type="math/tex" id="MathJax-Element-125">x=y=z=0</script> after the third. To prove the first move is always possible, note that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-712"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-713">x</span><span class="MJXp-mo" id="MJXp-Span-714" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-715">z</span><span class="MJXp-mo" id="MJXp-Span-716" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-717">y</span></span></span><script type="math/tex" id="MathJax-Element-126">x+z-y</script> is always even (since sum of all elements in the array is even), and because <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-718"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-719">y</span><span class="MJXp-mo" id="MJXp-Span-720" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mfrac" id="MJXp-Span-721" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-722">s</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mn" id="MJXp-Span-723">2</span></span></span></span></span></span></span></span><script type="math/tex" id="MathJax-Element-127">y\leq \frac{s}{2}</script> implies <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-724"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-725">x</span><span class="MJXp-mo" id="MJXp-Span-726" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-727">z</span><span class="MJXp-mo" id="MJXp-Span-728" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mfrac" id="MJXp-Span-729" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-730">s</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mn" id="MJXp-Span-731">2</span></span></span></span></span></span></span></span><script type="math/tex" id="MathJax-Element-128">x+z\geq\frac{s}{2}</script>. </p><p>Finally, to optimize this solution to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-732"><span class="MJXp-mn" id="MJXp-Span-733">2</span></span></span><script type="math/tex" id="MathJax-Element-129">2</script> moves, instead of subtracting <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-734"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-735">w</span></span></span><script type="math/tex" id="MathJax-Element-130">w</script> from both <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-736"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-737">x</span></span></span><script type="math/tex" id="MathJax-Element-131">x</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-738"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-739">z</span></span></span><script type="math/tex" id="MathJax-Element-132">z</script> in the first move, let's subtract <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-740"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-741">x</span></span></span><script type="math/tex" id="MathJax-Element-133">x</script> from the first block, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-742"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-743">x</span><span class="MJXp-mo" id="MJXp-Span-744" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-745">w</span></span></span><script type="math/tex" id="MathJax-Element-134">x-w</script> from the second block, and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-746"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-747">w</span></span></span><script type="math/tex" id="MathJax-Element-135">w</script> from the third block. Essentially, we are combining the first two operations into one. </p><p>The solution runs in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-748"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-749">O</span><span class="MJXp-mo" id="MJXp-Span-750" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-751">n</span><span class="MJXp-mo" id="MJXp-Span-752" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-136">O(n)</script>.</p></div></div> <div class="spoiler"><b class="spoiler-title">Code</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
 
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">using</span><span class="pln"> ll </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">const</span><span class="pln"> ll MOD </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1E9</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">7</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> INF </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1E9</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">const</span><span class="pln"> ll INFLL </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1E18</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    ios_base</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="kwd">false</span><span class="pun">);</span><span class="pln">
    cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln"> 
    </span><span class="kwd">int</span><span class="pln"> T</span><span class="pun">;</span><span class="pln"> cin </span><span class="pun">&gt;&gt;</span><span class="pln"> T</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> test </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> test </span><span class="pun">&lt;=</span><span class="pln"> T</span><span class="pun">;</span><span class="pln"> test</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
        vector</span><span class="str">&lt;ll&gt;</span><span class="pln"> a</span><span class="pun">(</span><span class="pln">n</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            cin </span><span class="pun">&gt;&gt;</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        ll sum </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">for</span><span class="pun">(</span><span class="pln">ll i </span><span class="pun">:</span><span class="pln"> a</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            sum </span><span class="pun">+=</span><span class="pln"> i</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">sum </span><span class="pun">%</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"-1\n"</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">continue</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        ll mx </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">for</span><span class="pun">(</span><span class="pln">ll i </span><span class="pun">:</span><span class="pln"> a</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            mx </span><span class="pun">=</span><span class="pln"> max</span><span class="pun">(</span><span class="pln">mx</span><span class="pun">,</span><span class="pln"> i</span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">mx </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> sum</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"-1\n"</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">continue</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        ll cur </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> ind </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">for</span><span class="pun">(;</span><span class="pln"> ind </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> ind</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">cur </span><span class="pun">+</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">ind</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> sum </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                ind</span><span class="pun">--;</span><span class="pln">
                </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
            cur </span><span class="pun">+=</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">ind</span><span class="pun">];</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">cur </span><span class="pun">==</span><span class="pln"> sum </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"1\n"</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">for</span><span class="pun">(</span><span class="pln">ll i </span><span class="pun">:</span><span class="pln"> a</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                cout </span><span class="pun">&lt;&lt;</span><span class="pln"> i </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">" "</span><span class="pun">;</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
            cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"\n"</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"2\n"</span><span class="pun">;</span><span class="pln">
            vector</span><span class="str">&lt;ll&gt;</span><span class="pln"> aa</span><span class="pun">(</span><span class="pln">n</span><span class="pun">);</span><span class="pln">
            ll extra </span><span class="pun">=</span><span class="pln"> sum </span><span class="pun">-</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> cur</span><span class="pun">;</span><span class="pln">
            aa</span><span class="pun">[</span><span class="pln">ind </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> extra </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln">
            a</span><span class="pun">[</span><span class="pln">ind </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-=</span><span class="pln"> aa</span><span class="pun">[</span><span class="pln">ind </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">];</span><span class="pln">
            extra </span><span class="pun">/=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> n </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&gt;</span><span class="pln"> ind </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> extra</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&gt;=</span><span class="pln"> extra</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    aa</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> extra</span><span class="pun">;</span><span class="pln">
                    a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-=</span><span class="pln"> extra</span><span class="pun">;</span><span class="pln">
                    extra </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
                </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    aa</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
                    extra </span><span class="pun">-=</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
                    a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
            </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                cout </span><span class="pun">&lt;&lt;</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">" "</span><span class="pun">;</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
            cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"\n"</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                cout </span><span class="pun">&lt;&lt;</span><span class="pln"> aa</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">" "</span><span class="pun">;</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
            cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"\n"</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div> <div class="spoiler"><b class="spoiler-title">Rate the Problem</b><div class="spoiler-content" style="display: block;"><ul>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="10785">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="136">136</span>
            </i>
        </a>
    </span>


 Great Problem</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="10786">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="32">32</span>
            </i>
        </a>
    </span>


 Good Problem</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="10787">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="26">26</span>
            </i>
        </a>
    </span>


 Okay Problem</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="10788">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="173">173</span>
            </i>
        </a>
    </span>


 Bad Problem</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="10822">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="37">37</span>
            </i>
        </a>
    </span>


 Did not solve</li> </ul></div></div><h4><a href="https://codeforces.com/contest/2124/problem/F1">2124F1 - Appending Permutations (Easy Version)</a> and <a href="https://codeforces.com/contest/2124/problem/F2">2124F2 - Appending Permutations (Hard Version)</a></h4><p>Problem Credits: <a class="rated-user user-orange" href="https://codeforces.com/profile/Proof_by_QED" title="Master Proof_by_QED">Proof_by_QED</a> <br></p><p>Huge thanks to <a class="rated-user user-legendary" href="https://codeforces.com/profile/Benq" title="Legendary Grandmaster Benq"><span class="legendary-user-first-letter">B</span>enq</a> for transforming my original problem (which is solvable using a sequence found in OEIS) to the current problem!</p> <div class="spoiler"><b class="spoiler-title">Original Problem</b><div class="spoiler-content" style="display: block;"><p>Given an integer <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-753"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-754">n</span></span></span><script type="math/tex" id="MathJax-Element-137">n</script> and no restrictions, count the number of possible arrays you can form <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-755"><span class="MJXp-mo" id="MJXp-Span-756" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-757">n</span><span class="MJXp-mo" id="MJXp-Span-758" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mn" id="MJXp-Span-759">2</span><span class="MJXp-mo" id="MJXp-Span-760" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-msubsup" id="MJXp-Span-761"><span class="MJXp-mn" id="MJXp-Span-762" style="margin-right: 0.05em;">10</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-763" style="vertical-align: 0.5em;">5</span></span><span class="MJXp-mo" id="MJXp-Span-764" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-138">(n \leq 2\cdot 10^5)</script>.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 1</b><div class="spoiler-content" style="display: block;"><p>Characterize the arrays that we might overcount.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 2</b><div class="spoiler-content" style="display: block;"><p>Optimize the DP using some cumulative sums.</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><p><strong>Coming up with a polynomial solution</strong></p><p>It's clear we need to do some sort of dynamic programming to count for this task. Initially, one may come up with let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-765"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-766">d</span><span class="MJXp-msubsup" id="MJXp-Span-767"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-768" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-769" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-139">dp_i</script> be the number of ways to fill completely permutations with total length <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-770"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-771">i</span></span></span><script type="math/tex" id="MathJax-Element-140">i</script>.</p><p>Unfortunately, one downfall of the above solution is that some arrays are obtainable through many ways: for example, the array <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-772"><span class="MJXp-mo" id="MJXp-Span-773" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mn" id="MJXp-Span-774">1</span><span class="MJXp-mo" id="MJXp-Span-775" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-776">2</span><span class="MJXp-mo" id="MJXp-Span-777" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-778">1</span><span class="MJXp-mo" id="MJXp-Span-779" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-141">[1,2,1]</script> can be constructed with <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-780"><span class="MJXp-mo" id="MJXp-Span-781" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mn" id="MJXp-Span-782">1</span><span class="MJXp-mo" id="MJXp-Span-783" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-784" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mo" id="MJXp-Span-785" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mn" id="MJXp-Span-786">2</span><span class="MJXp-mo" id="MJXp-Span-787" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-788">1</span><span class="MJXp-mo" id="MJXp-Span-789" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-142">[1]+[2,1]</script> or <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-790"><span class="MJXp-mo" id="MJXp-Span-791" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mn" id="MJXp-Span-792">1</span><span class="MJXp-mo" id="MJXp-Span-793" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-794">2</span><span class="MJXp-mo" id="MJXp-Span-795" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-796" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mo" id="MJXp-Span-797" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mn" id="MJXp-Span-798">1</span><span class="MJXp-mo" id="MJXp-Span-799" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-143">[1,2]+[1]</script>. </p><p>Upon further investigation, we can see that this occurs when we add two identity permutations of size <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-800"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-801">x</span></span></span><script type="math/tex" id="MathJax-Element-144">x</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-802"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-803">y</span></span></span><script type="math/tex" id="MathJax-Element-145">y</script> with <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-804"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-805">x</span><span class="MJXp-mo" id="MJXp-Span-806" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-807">y</span></span></span><script type="math/tex" id="MathJax-Element-146">x>y</script>, as this can also be counted with a permutation of size <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-808"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-809">y</span></span></span><script type="math/tex" id="MathJax-Element-147">y</script> and a shifted permutation of size <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-810"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-811">x</span></span></span><script type="math/tex" id="MathJax-Element-148">x</script>. We will choose to ban the second option (appending a shifted permutation that starts with <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-812"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-813">y</span><span class="MJXp-mo" id="MJXp-Span-814" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-815">1</span></span></span><script type="math/tex" id="MathJax-Element-149">y+1</script> when we just added a permutation of size <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-816"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-817">y</span></span></span><script type="math/tex" id="MathJax-Element-150">y</script>). We can come up with a counterexample to banning two identity permutations (a bigger one following a smaller one) with the array <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-818"><span class="MJXp-mo" id="MJXp-Span-819" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mn" id="MJXp-Span-820">1</span><span class="MJXp-mo" id="MJXp-Span-821" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-822">2</span><span class="MJXp-mo" id="MJXp-Span-823" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-824">3</span><span class="MJXp-mo" id="MJXp-Span-825" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-826">1</span><span class="MJXp-mo" id="MJXp-Span-827" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-828">2</span><span class="MJXp-mo" id="MJXp-Span-829" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-830">1</span><span class="MJXp-mo" id="MJXp-Span-831" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-151">[1,2,3,1,2,1]</script>, which can be counted as both <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-832"><span class="MJXp-mo" id="MJXp-Span-833" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mn" id="MJXp-Span-834">1</span><span class="MJXp-mo" id="MJXp-Span-835" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-836">2</span><span class="MJXp-mo" id="MJXp-Span-837" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-838" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mo" id="MJXp-Span-839" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mn" id="MJXp-Span-840">3</span><span class="MJXp-mo" id="MJXp-Span-841" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-842">1</span><span class="MJXp-mo" id="MJXp-Span-843" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-844">2</span><span class="MJXp-mo" id="MJXp-Span-845" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-846" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mo" id="MJXp-Span-847" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mn" id="MJXp-Span-848">1</span><span class="MJXp-mo" id="MJXp-Span-849" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-152">[1,2]+[3,1,2]+[1]</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-850"><span class="MJXp-mo" id="MJXp-Span-851" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mn" id="MJXp-Span-852">1</span><span class="MJXp-mo" id="MJXp-Span-853" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-854" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mo" id="MJXp-Span-855" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mn" id="MJXp-Span-856">2</span><span class="MJXp-mo" id="MJXp-Span-857" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-858">3</span><span class="MJXp-mo" id="MJXp-Span-859" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-860">1</span><span class="MJXp-mo" id="MJXp-Span-861" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-862" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mo" id="MJXp-Span-863" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mn" id="MJXp-Span-864">2</span><span class="MJXp-mo" id="MJXp-Span-865" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-866">1</span><span class="MJXp-mo" id="MJXp-Span-867" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-153">[1]+[2,3,1]+[2,1]</script>. </p><p>This gives us a <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-868"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-869">O</span><span class="MJXp-mo" id="MJXp-Span-870" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-871"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-872" style="margin-right: 0.05em;">n</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-873" style="vertical-align: 0.5em;">4</span></span><span class="MJXp-mo" id="MJXp-Span-874" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-154">O(n^4)</script> solution. Let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-875"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-876">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-877">p</span><span class="MJXp-mo" id="MJXp-Span-878" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-879">i</span><span class="MJXp-mo" id="MJXp-Span-880" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-881">j</span><span class="MJXp-mo" id="MJXp-Span-882" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-155">dp(i,j)</script> be the number of ways to make the sequence from indices <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-883"><span class="MJXp-mn" id="MJXp-Span-884">1</span></span></span><script type="math/tex" id="MathJax-Element-156">1</script> through <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-885"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-886">i</span></span></span><script type="math/tex" id="MathJax-Element-157">i</script>, such that the last permutation added was an identity permutation of length <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-887"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-888">j</span></span></span><script type="math/tex" id="MathJax-Element-158">j</script> (or not an identity permutation if <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-889"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-890">j</span><span class="MJXp-mo" id="MJXp-Span-891" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-892">0</span></span></span><script type="math/tex" id="MathJax-Element-159">j=0</script>). We can build a solution by looping through (index, length of permutation, which cyclic shift to use), and checking if we can add this permutation naively. </p><p><strong>Optimizing the solution to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-893"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-894">O</span><span class="MJXp-mo" id="MJXp-Span-895" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-896"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-897" style="margin-right: 0.05em;">n</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-898" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-899" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-160">O(n^2)</script></strong></p><p>There are several ways to do this part. Below shows one approach.</p><p>First, let's precalculate <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-900"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-901">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-902">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-903">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-904">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-905">n</span><span class="MJXp-mo" id="MJXp-Span-906" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-907">i</span><span class="MJXp-mo" id="MJXp-Span-908" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-909">j</span><span class="MJXp-mo" id="MJXp-Span-910" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-161">chain(i,j)</script>, which returns the largest integer <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-911"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-912">k</span></span></span><script type="math/tex" id="MathJax-Element-162">k</script> such that it is possible to fill numbers <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-913"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-914">i</span><span class="MJXp-mo" id="MJXp-Span-915" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-916">i</span><span class="MJXp-mo" id="MJXp-Span-917" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-918">1</span><span class="MJXp-mo" id="MJXp-Span-919" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-920" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-921" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-922">i</span><span class="MJXp-mo" id="MJXp-Span-923" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-924">k</span><span class="MJXp-mo" id="MJXp-Span-925" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-926">1</span></span></span><script type="math/tex" id="MathJax-Element-163">i, i+1, \ldots, i+k-1</script> with numbers <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-927"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-928">j</span><span class="MJXp-mo" id="MJXp-Span-929" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-930">j</span><span class="MJXp-mo" id="MJXp-Span-931" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-932">1</span><span class="MJXp-mo" id="MJXp-Span-933" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-934" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-935" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-936">j</span><span class="MJXp-mo" id="MJXp-Span-937" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-938">k</span><span class="MJXp-mo" id="MJXp-Span-939" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-940">1</span></span></span><script type="math/tex" id="MathJax-Element-164">j,j+1,\ldots,j+k-1</script>. We can calculate this as <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-941"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-942">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-943">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-944">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-945">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-946">n</span><span class="MJXp-mo" id="MJXp-Span-947" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-948">i</span><span class="MJXp-mo" id="MJXp-Span-949" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-950">j</span><span class="MJXp-mo" id="MJXp-Span-951" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-952" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-953">0</span></span></span><script type="math/tex" id="MathJax-Element-165">chain(i,j)=0</script> if <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-954"><span class="MJXp-msubsup" id="MJXp-Span-955"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-956" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-957" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-958" style="margin-left: 0.333em; margin-right: 0.333em;">≠</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-959">j</span></span></span><script type="math/tex" id="MathJax-Element-166">a_i\neq j</script> is a requirement, and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-960"><span class="MJXp-mn" id="MJXp-Span-961">1</span><span class="MJXp-mo" id="MJXp-Span-962" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-963">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-964">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-965">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-966">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-967">n</span><span class="MJXp-mo" id="MJXp-Span-968" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-969">i</span><span class="MJXp-mo" id="MJXp-Span-970" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-971">1</span><span class="MJXp-mo" id="MJXp-Span-972" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-973">j</span><span class="MJXp-mo" id="MJXp-Span-974" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-975">1</span><span class="MJXp-mo" id="MJXp-Span-976" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-167">1+chain(i+1,j+1)</script> otherwise. Let </p> <ul>   <li><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-977"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-978">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-979">p</span><span class="MJXp-mo" id="MJXp-Span-980" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-981">i</span><span class="MJXp-mo" id="MJXp-Span-982" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-983">j</span><span class="MJXp-mo" id="MJXp-Span-984" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-168">dp(i,j)</script> be the number of ways to fill indices <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-985"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-986">i</span><span class="MJXp-mo" id="MJXp-Span-987" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-988">i</span><span class="MJXp-mo" id="MJXp-Span-989" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-990">1</span><span class="MJXp-mo" id="MJXp-Span-991" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-992" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-993" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-994">n</span></span></span><script type="math/tex" id="MathJax-Element-169">i,i+1,\ldots,n</script> such that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-995"><span class="MJXp-msubsup" id="MJXp-Span-996"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-997" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-998" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-999" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1000">j</span></span></span><script type="math/tex" id="MathJax-Element-170">a_i=j</script></li>   <li><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1001"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1002">d</span><span class="MJXp-msubsup" id="MJXp-Span-1003"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1004" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1005" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1006" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1007">i</span><span class="MJXp-mo" id="MJXp-Span-1008" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-171">dp_2(i)</script> be the sum of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1009"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1010">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1011">p</span><span class="MJXp-mo" id="MJXp-Span-1012" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1013">i</span><span class="MJXp-mo" id="MJXp-Span-1014" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1015">j</span><span class="MJXp-mo" id="MJXp-Span-1016" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-172">dp(i,j)</script> over all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1017"><span class="MJXp-mn" id="MJXp-Span-1018">1</span><span class="MJXp-mo" id="MJXp-Span-1019" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1020">j</span><span class="MJXp-mo" id="MJXp-Span-1021" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1022">n</span></span></span><script type="math/tex" id="MathJax-Element-173">1 \leq j \leq n</script>.</li>   <li><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1023"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1024">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1025">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1026">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1027">f</span><span class="MJXp-mo" id="MJXp-Span-1028" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1029">i</span><span class="MJXp-mo" id="MJXp-Span-1030" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1031">j</span><span class="MJXp-mo" id="MJXp-Span-1032" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-174">suff(i,j)</script> be the number of ways such that we are ready to insert <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1033"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1034">j</span></span></span><script type="math/tex" id="MathJax-Element-175">j</script> to complete the suffix from <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1035"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1036">i</span></span></span><script type="math/tex" id="MathJax-Element-176">i</script> to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1037"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1038">n</span></span></span><script type="math/tex" id="MathJax-Element-177">n</script>, but without taking into account restrictions.</li> </ul><p>We can calculate <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1039"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1040">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1041">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1042">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1043">f</span><span class="MJXp-mo" id="MJXp-Span-1044" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1045">i</span><span class="MJXp-mo" id="MJXp-Span-1046" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1047">j</span><span class="MJXp-mo" id="MJXp-Span-1048" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-178">suff(i,j)</script> as <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1049"><span class="MJXp-msubsup" id="MJXp-Span-1050"><span class="MJXp-mo" id="MJXp-Span-1051" style="margin-left: 0.111em; margin-right: 0.05em;">∑</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1056">n</span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mrow" id="MJXp-Span-1052"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1053">x</span><span class="MJXp-mo" id="MJXp-Span-1054">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1055">i</span></span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-1057" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1058">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1059">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1060">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1061">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1062">n</span><span class="MJXp-mo" id="MJXp-Span-1063" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1064">x</span><span class="MJXp-mo" id="MJXp-Span-1065" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-1066">1</span><span class="MJXp-mo" id="MJXp-Span-1067" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1068" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1069">j</span><span class="MJXp-mo" id="MJXp-Span-1070" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-1071">1</span><span class="MJXp-mo" id="MJXp-Span-1072" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1073" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1074">d</span><span class="MJXp-msubsup" id="MJXp-Span-1075"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1076" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1077" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1078" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1079">x</span><span class="MJXp-mo" id="MJXp-Span-1080" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1081">j</span><span class="MJXp-mo" id="MJXp-Span-1082" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-1083">1</span><span class="MJXp-mo" id="MJXp-Span-1084" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-179">\sum_{x=i}^n(chain(x,1)\geq j-1)\cdot dp_2(x+j-1)</script>. Why is this helpful? Let's create an example. Suppose we fix <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1085"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1086">j</span><span class="MJXp-mo" id="MJXp-Span-1087" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-1088">3</span></span></span><script type="math/tex" id="MathJax-Element-180">j=3</script>, and we have <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1089"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1090">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1091">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1092">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1093">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1094">n</span><span class="MJXp-mo" id="MJXp-Span-1095" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1096">x</span><span class="MJXp-mo" id="MJXp-Span-1097" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-1098">1</span><span class="MJXp-mo" id="MJXp-Span-1099" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1100" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mn" id="MJXp-Span-1101">2</span></span></span><script type="math/tex" id="MathJax-Element-181">chain(x,1)\geq 2</script> is true for <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1102"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1103">x</span><span class="MJXp-mo" id="MJXp-Span-1104" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-1105">3</span><span class="MJXp-mo" id="MJXp-Span-1106" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-1107">4</span><span class="MJXp-mo" id="MJXp-Span-1108" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-1109">6</span></span></span><script type="math/tex" id="MathJax-Element-182">x=3,4,6</script>. That is, it's possible to place <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1110"><span class="MJXp-mn" id="MJXp-Span-1111">1</span></span></span><script type="math/tex" id="MathJax-Element-183">1</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1112"><span class="MJXp-mn" id="MJXp-Span-1113">2</span></span></span><script type="math/tex" id="MathJax-Element-184">2</script> in positions <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1114"><span class="MJXp-mo" id="MJXp-Span-1115" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-1116">3</span><span class="MJXp-mo" id="MJXp-Span-1117" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-1118">4</span><span class="MJXp-mo" id="MJXp-Span-1119" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-185">(3,4)</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1120"><span class="MJXp-mo" id="MJXp-Span-1121" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-1122">4</span><span class="MJXp-mo" id="MJXp-Span-1123" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-1124">5</span><span class="MJXp-mo" id="MJXp-Span-1125" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-186">(4,5)</script>, and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1126"><span class="MJXp-mo" id="MJXp-Span-1127" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-1128">6</span><span class="MJXp-mo" id="MJXp-Span-1129" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-1130">7</span><span class="MJXp-mo" id="MJXp-Span-1131" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-187">(6,7)</script>. Then, we should have <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1132"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1133">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1134">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1135">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1136">f</span><span class="MJXp-mo" id="MJXp-Span-1137" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-1138">2</span><span class="MJXp-mo" id="MJXp-Span-1139" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-1140">3</span><span class="MJXp-mo" id="MJXp-Span-1141" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1142" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1143">d</span><span class="MJXp-msubsup" id="MJXp-Span-1144"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1145" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1146" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1147" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-1148">5</span><span class="MJXp-mo" id="MJXp-Span-1149" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1150" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1151">d</span><span class="MJXp-msubsup" id="MJXp-Span-1152"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1153" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1154" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1155" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-1156">6</span><span class="MJXp-mo" id="MJXp-Span-1157" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1158" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1159">d</span><span class="MJXp-msubsup" id="MJXp-Span-1160"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1161" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1162" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1163" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-1164">8</span><span class="MJXp-mo" id="MJXp-Span-1165" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-188">suff(2,3)=dp_2(5)+dp_2(6)+dp_2(8)</script>. This is because suppose we set <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1166"><span class="MJXp-msubsup" id="MJXp-Span-1167"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1168" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1169" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1170" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-1171">3</span></span></span><script type="math/tex" id="MathJax-Element-189">a_2=3</script>. Then our <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1172"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1173">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1174">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1175">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1176">f</span><span class="MJXp-mo" id="MJXp-Span-1177" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-1178">2</span><span class="MJXp-mo" id="MJXp-Span-1179" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-1180">3</span><span class="MJXp-mo" id="MJXp-Span-1181" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-190">suff(2,3)</script> means that we can theoretically put <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1182"><span class="MJXp-mo" id="MJXp-Span-1183" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-1184">3</span><span class="MJXp-mo" id="MJXp-Span-1185" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-1186">1</span><span class="MJXp-mo" id="MJXp-Span-1187" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-1188">2</span><span class="MJXp-mo" id="MJXp-Span-1189" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1190" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-1191" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-1192">3</span><span class="MJXp-mo" id="MJXp-Span-1193" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-1194">4</span><span class="MJXp-mo" id="MJXp-Span-1195" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-1196">1</span><span class="MJXp-mo" id="MJXp-Span-1197" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-1198">2</span><span class="MJXp-mo" id="MJXp-Span-1199" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1200" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-1201" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-1202">3</span><span class="MJXp-mo" id="MJXp-Span-1203" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-1204">4</span><span class="MJXp-mo" id="MJXp-Span-1205" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-1206">5</span><span class="MJXp-mo" id="MJXp-Span-1207" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-1208">6</span><span class="MJXp-mo" id="MJXp-Span-1209" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-1210">1</span><span class="MJXp-mo" id="MJXp-Span-1211" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-1212">2</span><span class="MJXp-mo" id="MJXp-Span-1213" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-191">(3,1,2), (3,4,1,2), (3,4,5,6,1,2)</script> starting at index <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1214"><span class="MJXp-mn" id="MJXp-Span-1215">2</span></span></span><script type="math/tex" id="MathJax-Element-192">2</script>, assuming there are no further restrictions.</p><p>Now our actual DP loop:</p> <ul>   <li>Calculate <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1216"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1217">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1218">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1219">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1220">f</span><span class="MJXp-mo" id="MJXp-Span-1221" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1222">i</span><span class="MJXp-mo" id="MJXp-Span-1223" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1224">j</span><span class="MJXp-mo" id="MJXp-Span-1225" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-193">suff(i,j)</script> as above</li>   <li>Calculate <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1226"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1227">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1228">p</span><span class="MJXp-mo" id="MJXp-Span-1229" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1230">i</span><span class="MJXp-mo" id="MJXp-Span-1231" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-1232">1</span><span class="MJXp-mo" id="MJXp-Span-1233" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-194">dp(i,1)</script> by looping through all identity permutations we can append at index <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1234"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1235">i</span></span></span><script type="math/tex" id="MathJax-Element-195">i</script>. Say we are trying to add identity permutation of length <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1236"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1237">x</span></span></span><script type="math/tex" id="MathJax-Element-196">x</script>. We should add <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1238"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1239">d</span><span class="MJXp-msubsup" id="MJXp-Span-1240"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1241" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1242" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1243" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1244">i</span><span class="MJXp-mo" id="MJXp-Span-1245" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1246">x</span><span class="MJXp-mo" id="MJXp-Span-1247" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-197">dp_2(i+x)</script> and subtract <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1248"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1249">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1250">p</span><span class="MJXp-mo" id="MJXp-Span-1251" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1252">i</span><span class="MJXp-mo" id="MJXp-Span-1253" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1254">x</span><span class="MJXp-mo" id="MJXp-Span-1255" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1256">x</span><span class="MJXp-mo" id="MJXp-Span-1257" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-1258">1</span><span class="MJXp-mo" id="MJXp-Span-1259" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-198">dp(i+x,x+1)</script> (this is to prevent overcounting as outlined before).</li>   <li>Calculate <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1260"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1261">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1262">p</span><span class="MJXp-mo" id="MJXp-Span-1263" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1264">i</span><span class="MJXp-mo" id="MJXp-Span-1265" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1266">j</span><span class="MJXp-mo" id="MJXp-Span-1267" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-199">dp(i,j)</script> for <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1268"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1269">j</span><span class="MJXp-mo" id="MJXp-Span-1270" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-mn" id="MJXp-Span-1271">1</span></span></span><script type="math/tex" id="MathJax-Element-200">j>1</script> as <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1272"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1273">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1274">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1275">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1276">f</span><span class="MJXp-mo" id="MJXp-Span-1277" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1278">i</span><span class="MJXp-mo" id="MJXp-Span-1279" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-1280">1</span><span class="MJXp-mo" id="MJXp-Span-1281" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1282">j</span><span class="MJXp-mo" id="MJXp-Span-1283" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1284" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1285">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1286">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1287">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1288">f</span><span class="MJXp-mo" id="MJXp-Span-1289" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1290">i</span><span class="MJXp-mo" id="MJXp-Span-1291" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-1292">1</span><span class="MJXp-mo" id="MJXp-Span-1293" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1294">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1295">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1296">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1297">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1298">n</span><span class="MJXp-mo" id="MJXp-Span-1299" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1300">i</span><span class="MJXp-mo" id="MJXp-Span-1301" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1302">j</span><span class="MJXp-mo" id="MJXp-Span-1303" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1304" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1305">j</span><span class="MJXp-mo" id="MJXp-Span-1306" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-201">suff(i+1,j)-suff(i+1+chain(i,j),j)</script>. The subtraction is to remove contribution from <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1307"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1308">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1309">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1310">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1311">f</span></span></span><script type="math/tex" id="MathJax-Element-202">suff</script> that is not accessible due to constraints on <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1312"><span class="MJXp-msubsup" id="MJXp-Span-1313"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1314" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1315" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1316" style="margin-left: 0.333em; margin-right: 0.333em;">≠</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1317">j</span></span></span><script type="math/tex" id="MathJax-Element-203">a_i \neq j</script> using our chain array.</li> </ul><p>This solution works in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1318"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1319">O</span><span class="MJXp-mo" id="MJXp-Span-1320" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1321"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1322" style="margin-right: 0.05em;">n</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1323" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1324" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1325">m</span><span class="MJXp-mo" id="MJXp-Span-1326" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-204">O(n^2+m)</script>. <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1327"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1328">m</span></span></span><script type="math/tex" id="MathJax-Element-205">m</script> was kept low to allow <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1329"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1330">O</span><span class="MJXp-mo" id="MJXp-Span-1331" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1332">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1333">m</span><span class="MJXp-mo" id="MJXp-Span-1334" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-1335"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1336" style="margin-right: 0.05em;">n</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1337" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1338" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-206">O(nm+n^2)</script> to pass as well.</p></div></div> <div class="spoiler"><b class="spoiler-title">Code</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> MOD </span><span class="pun">=</span><span class="pln"> </span><span class="lit">998244353</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">template</span><span class="pun">&lt;</span><span class="kwd">typename</span><span class="pln"> T</span><span class="pun">&gt;</span><span class="pln"> std</span><span class="pun">::</span><span class="pln">ostream</span><span class="pun">&amp;</span><span class="pln"> </span><span class="kwd">operator</span><span class="pun">&lt;&lt;(</span><span class="pln">std</span><span class="pun">::</span><span class="pln">ostream</span><span class="pun">&amp;</span><span class="pln"> os</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">const</span><span class="pln"> std</span><span class="pun">::</span><span class="pln">vector</span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;&amp;</span><span class="pln"> vec</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    os </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"[ "</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">auto</span><span class="pun">&amp;</span><span class="pln"> elem </span><span class="pun">:</span><span class="pln"> vec</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        os </span><span class="pun">&lt;&lt;</span><span class="pln"> elem </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">" "</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    os </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"]"</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> os</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">struct</span><span class="pln"> </span><span class="typ">Mint</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> v</span><span class="pun">;</span><span class="pln">
    </span><span class="typ">Mint</span><span class="pun">(</span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> val </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        v </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">(</span><span class="pln">val </span><span class="pun">%</span><span class="pln"> MOD</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">v </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> v </span><span class="pun">+=</span><span class="pln"> MOD</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="typ">Mint</span><span class="pln"> </span><span class="kwd">operator</span><span class="pun">+(</span><span class="kwd">const</span><span class="pln"> </span><span class="typ">Mint</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">o</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">const</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Mint</span><span class="pun">(</span><span class="pln">v </span><span class="pun">+</span><span class="pln"> o</span><span class="pun">.</span><span class="pln">v</span><span class="pun">);</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="typ">Mint</span><span class="pln"> </span><span class="kwd">operator</span><span class="pun">-(</span><span class="kwd">const</span><span class="pln"> </span><span class="typ">Mint</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">o</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">const</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Mint</span><span class="pun">(</span><span class="pln">v </span><span class="pun">-</span><span class="pln"> o</span><span class="pun">.</span><span class="pln">v</span><span class="pun">);</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="typ">Mint</span><span class="pln"> </span><span class="kwd">operator</span><span class="pun">*(</span><span class="kwd">const</span><span class="pln"> </span><span class="typ">Mint</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">o</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">const</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Mint</span><span class="pun">(</span><span class="lit">1LL</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> v </span><span class="pun">*</span><span class="pln"> o</span><span class="pun">.</span><span class="pln">v</span><span class="pun">);</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="typ">Mint</span><span class="pln"> </span><span class="kwd">operator</span><span class="pun">/(</span><span class="kwd">const</span><span class="pln"> </span><span class="typ">Mint</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">o</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">const</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">*</span><span class="kwd">this</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> o</span><span class="pun">.</span><span class="pln">inv</span><span class="pun">();</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="typ">Mint</span><span class="pun">&amp;</span><span class="pln"> </span><span class="kwd">operator</span><span class="pun">+=(</span><span class="kwd">const</span><span class="pln"> </span><span class="typ">Mint</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">o</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> v </span><span class="pun">+=</span><span class="pln"> o</span><span class="pun">.</span><span class="pln">v</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">v </span><span class="pun">&gt;=</span><span class="pln"> MOD</span><span class="pun">)</span><span class="pln"> v </span><span class="pun">-=</span><span class="pln"> MOD</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">*</span><span class="kwd">this</span><span class="pun">;</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="typ">Mint</span><span class="pun">&amp;</span><span class="pln"> </span><span class="kwd">operator</span><span class="pun">-=(</span><span class="kwd">const</span><span class="pln"> </span><span class="typ">Mint</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">o</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> v </span><span class="pun">-=</span><span class="pln"> o</span><span class="pun">.</span><span class="pln">v</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">v </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> v </span><span class="pun">+=</span><span class="pln"> MOD</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">*</span><span class="kwd">this</span><span class="pun">;</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="typ">Mint</span><span class="pun">&amp;</span><span class="pln"> </span><span class="kwd">operator</span><span class="pun">*=(</span><span class="kwd">const</span><span class="pln"> </span><span class="typ">Mint</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">o</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> v </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">(</span><span class="lit">1LL</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> v </span><span class="pun">*</span><span class="pln"> o</span><span class="pun">.</span><span class="pln">v </span><span class="pun">%</span><span class="pln"> MOD</span><span class="pun">);</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">*</span><span class="kwd">this</span><span class="pun">;</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="typ">Mint</span><span class="pln"> pow</span><span class="pun">(</span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> p</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">const</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="typ">Mint</span><span class="pln"> a </span><span class="pun">=</span><span class="pln"> </span><span class="pun">*</span><span class="kwd">this</span><span class="pun">,</span><span class="pln"> res </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">p </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">p </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> res </span><span class="pun">*=</span><span class="pln"> a</span><span class="pun">;</span><span class="pln">
            a </span><span class="pun">*=</span><span class="pln"> a</span><span class="pun">;</span><span class="pln">
            p </span><span class="pun">&gt;&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> res</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="typ">Mint</span><span class="pln"> inv</span><span class="pun">()</span><span class="pln"> </span><span class="kwd">const</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> pow</span><span class="pun">(</span><span class="pln">MOD </span><span class="pun">-</span><span class="pln"> </span><span class="lit">2</span><span class="pun">);</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">friend</span><span class="pln"> ostream</span><span class="pun">&amp;</span><span class="pln"> </span><span class="kwd">operator</span><span class="pun">&lt;&lt;(</span><span class="pln">ostream</span><span class="pun">&amp;</span><span class="pln"> os</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">const</span><span class="pln"> </span><span class="typ">Mint</span><span class="pun">&amp;</span><span class="pln"> m</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        os </span><span class="pun">&lt;&lt;</span><span class="pln"> m</span><span class="pun">.</span><span class="pln">v</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> os</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">};</span><span class="pln">
</span><span class="kwd">void</span><span class="pln"> solve</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> N</span><span class="pun">,</span><span class="pln"> K</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> N </span><span class="pun">&gt;&gt;</span><span class="pln"> K</span><span class="pun">;</span><span class="pln">

    vector</span><span class="pun">&lt;</span><span class="pln">vector</span><span class="str">&lt;bool&gt;</span><span class="pun">&gt;</span><span class="pln"> banned</span><span class="pun">(</span><span class="pln">N</span><span class="pun">,</span><span class="pln"> vector</span><span class="str">&lt;bool&gt;</span><span class="pun">(</span><span class="pln">N</span><span class="pun">));</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> K</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> y</span><span class="pun">;</span><span class="pln">
        cin </span><span class="pun">&gt;&gt;</span><span class="pln"> x </span><span class="pun">&gt;&gt;</span><span class="pln"> y</span><span class="pun">;</span><span class="pln">
        banned</span><span class="pun">[</span><span class="pln">x </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">][</span><span class="pln">y </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    vector</span><span class="pun">&lt;</span><span class="typ">Mint</span><span class="pun">&gt;</span><span class="pln"> tot</span><span class="pun">(</span><span class="pln">N </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
    tot</span><span class="pun">[</span><span class="pln">N</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
    vector</span><span class="pun">&lt;</span><span class="pln">vector</span><span class="pun">&lt;</span><span class="typ">Mint</span><span class="pun">&gt;&gt;</span><span class="pln"> dp</span><span class="pun">(</span><span class="pln">N </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> vector</span><span class="pun">&lt;</span><span class="typ">Mint</span><span class="pun">&gt;(</span><span class="pln">N </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">));</span><span class="pln">
    vector</span><span class="pun">&lt;</span><span class="pln">vector</span><span class="str">&lt;int&gt;</span><span class="pun">&gt;</span><span class="pln"> chain</span><span class="pun">(</span><span class="pln">N </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> vector</span><span class="str">&lt;int&gt;</span><span class="pun">(</span><span class="pln">N </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">));</span><span class="pln">

    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> N </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> </span><span class="pun">--</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> N </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> </span><span class="pun">--</span><span class="pln">j</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            chain</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> chain</span><span class="pun">[</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">][</span><span class="pln">j </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">];</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">banned</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">])</span><span class="pln"> chain</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    vector</span><span class="pun">&lt;</span><span class="pln">vector</span><span class="pun">&lt;</span><span class="typ">Mint</span><span class="pun">&gt;&gt;</span><span class="pln"> ssum</span><span class="pun">(</span><span class="pln">N </span><span class="pun">+</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> vector</span><span class="pun">&lt;</span><span class="typ">Mint</span><span class="pun">&gt;(</span><span class="pln">N </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">));</span><span class="pln">

    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> N </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> </span><span class="pun">--</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;=</span><span class="pln"> N </span><span class="pun">-</span><span class="pln"> i</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">j</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">j </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> len </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> len </span><span class="pun">&lt;=</span><span class="pln"> N </span><span class="pun">-</span><span class="pln"> i</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">len</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    </span><span class="kwd">bool</span><span class="pln"> ok </span><span class="pun">=</span><span class="pln"> chain</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&gt;=</span><span class="pln"> len</span><span class="pun">;</span><span class="pln">
                    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">ok</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
                    dp</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+=</span><span class="pln"> tot</span><span class="pun">[</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> len</span><span class="pun">];</span><span class="pln">
                    dp</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-=</span><span class="pln"> dp</span><span class="pun">[</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> len</span><span class="pun">][</span><span class="pln">j </span><span class="pun">+</span><span class="pln"> len</span><span class="pun">];</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">
            </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">chain</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    dp</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+=</span><span class="pln"> ssum</span><span class="pun">[</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">][</span><span class="pln">j</span><span class="pun">];</span><span class="pln">
                    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> chain</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;=</span><span class="pln"> N</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                        dp</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-=</span><span class="pln"> ssum</span><span class="pun">[</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> chain</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">]][</span><span class="pln">j</span><span class="pun">];</span><span class="pln">
                    </span><span class="pun">}</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
            tot</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+=</span><span class="pln"> dp</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">];</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">

        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;</span><span class="pln"> N</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">j</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            ssum</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> ssum</span><span class="pun">[</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">][</span><span class="pln">j</span><span class="pun">];</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">chain</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&gt;=</span><span class="pln"> j</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                ssum</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+=</span><span class="pln"> tot</span><span class="pun">[</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> j</span><span class="pun">];</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="com">// cout &lt;&lt; dp &lt;&lt; endl;</span><span class="pln">
    </span><span class="com">// cout &lt;&lt; ssum &lt;&lt; endl;</span><span class="pln">
    cout </span><span class="pun">&lt;&lt;</span><span class="pln"> tot</span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="pln">v </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    ios</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="kwd">false</span><span class="pun">);</span><span class="pln">
    cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="kwd">nullptr</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pun">(</span><span class="pln">t</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        solve</span><span class="pun">();</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    
    </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div> <div class="spoiler"><b class="spoiler-title">Rate the Problem (F1)</b><div class="spoiler-content" style="display: block;"><ul>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="10789">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="82">82</span>
            </i>
        </a>
    </span>


 Great Problem</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="10790">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="12">12</span>
            </i>
        </a>
    </span>


 Good Problem</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="10791">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="24">24</span>
            </i>
        </a>
    </span>


 Okay Problem</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="10792">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="13">13</span>
            </i>
        </a>
    </span>


 Bad Problem</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="10823">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="17">17</span>
            </i>
        </a>
    </span>


 Did not solve</li> </ul></div></div> <div class="spoiler"><b class="spoiler-title">Rate the Problem (F2)</b><div class="spoiler-content" style="display: block;"><ul>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="10793">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="47">47</span>
            </i>
        </a>
    </span>


 Great Problem</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="10794">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="6">6</span>
            </i>
        </a>
    </span>


 Good Problem</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="10795">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="10">10</span>
            </i>
        </a>
    </span>


 Okay Problem</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="10796">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="15">15</span>
            </i>
        </a>
    </span>


 Bad Problem</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="10824">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="37">37</span>
            </i>
        </a>
    </span>


 Did not solve</li> </ul></div></div><h4><a href="https://codeforces.com/contest/2124/problem/G">2124G - Maximise Sum</a></h4><p>Problem Credits: <a class="rated-user user-orange" href="https://codeforces.com/profile/cry" title="International Master cry">cry</a> <br> Special thanks to <a class="rated-user user-red" href="https://codeforces.com/profile/Error_Yuan" title="Grandmaster Error_Yuan">Error_Yuan</a> and <a class="rated-user user-violet" href="https://codeforces.com/profile/LMeyling" title="Candidate Master LMeyling">LMeyling</a> for solving this problem!</p> <div class="spoiler"><b class="spoiler-title">Hint 0</b><div class="spoiler-content" style="display: block;"><p>Disregard cost first. Find the maximum sum of prefix minimums.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 1</b><div class="spoiler-content" style="display: block;"><p>Come up with a way to have <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1339"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1340">O</span><span class="MJXp-mo" id="MJXp-Span-1341" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1342">n</span><span class="MJXp-mo" id="MJXp-Span-1343" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-207">O(n)</script> <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1344"><span class="MJXp-mo" id="MJXp-Span-1345" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1346">i</span><span class="MJXp-mo" id="MJXp-Span-1347" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1348">j</span><span class="MJXp-mo" id="MJXp-Span-1349" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-208">(i,j)</script> pairs to test.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 2</b><div class="spoiler-content" style="display: block;"><p>Let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1350"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1351">f</span><span class="MJXp-mo" id="MJXp-Span-1352" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1353">a</span><span class="MJXp-mo" id="MJXp-Span-1354" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1355" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-1356" style="margin-left: 0.333em; margin-right: 0.333em;">min</span><span class="MJXp-mo" id="MJXp-Span-1357" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1358"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1359" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1360" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-1361" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1362" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mo" id="MJXp-Span-1363" style="margin-left: 0.333em; margin-right: 0.333em;">min</span><span class="MJXp-mo" id="MJXp-Span-1364" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1365"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1366" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1367" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-1368" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1369"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1370" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1371" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1372" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1373" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mo" id="MJXp-Span-1374" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-1375" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mo" id="MJXp-Span-1376" style="margin-left: 0.333em; margin-right: 0.333em;">min</span><span class="MJXp-mo" id="MJXp-Span-1377" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1378"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1379" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1380" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-1381" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1382"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1383" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1384" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1385" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-1386" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-1387" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1388"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1389" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1390" style="vertical-align: -0.4em;">n</span></span><span class="MJXp-mo" id="MJXp-Span-1391" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-209">f(a)=\min(a_1)+\min(a_1,a_2)+\ldots+\min(a_1,a_2,\ldots,a_n)</script>. Can you come up with a way to solve <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1392"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1393">q</span></span></span><script type="math/tex" id="MathJax-Element-210">q</script> queries of what <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1394"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1395">f</span><span class="MJXp-mo" id="MJXp-Span-1396" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1397">a</span><span class="MJXp-mo" id="MJXp-Span-1398" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-211">f(a)</script> will be after performing the operation on <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1399"><span class="MJXp-mo" id="MJXp-Span-1400" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1401">i</span><span class="MJXp-mo" id="MJXp-Span-1402" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1403">j</span><span class="MJXp-mo" id="MJXp-Span-1404" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-212">(i,j)</script>? (queries are not persistent here)</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><p>Let's disregard the cost part of the problem completely and try to solve the problem just for the maximum sum.</p><p>To solve this problem, we make the following observations:</p> <ol>   <li>If <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1405"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1406">i</span></span></span><script type="math/tex" id="MathJax-Element-213">i</script> is not a prefix minimum, there is no point in using the operation to increase <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1407"><span class="MJXp-msubsup" id="MJXp-Span-1408"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1409" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1410" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-214">a_i</script>.</li>   <li>If <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1411"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1412">j</span></span></span><script type="math/tex" id="MathJax-Element-215">j</script> is not a suffix maximum, there is no point in using the operation to set <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1413"><span class="MJXp-msubsup" id="MJXp-Span-1414"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1415" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1416" style="vertical-align: -0.4em;">j</span></span><span class="MJXp-mo" id="MJXp-Span-1417" style="margin-left: 0.111em; margin-right: 0.167em;">:=</span><span class="MJXp-mn" id="MJXp-Span-1418">0</span></span></span><script type="math/tex" id="MathJax-Element-216">a_j:=0</script>. This is because we can instead use the closest suffix maximum to its right, and the final answer can only be larger.</li> </ol><p>Knowing this, let's enumerate <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1419"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1420">i</span></span></span><script type="math/tex" id="MathJax-Element-217">i</script>. If <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1421"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1422">i</span></span></span><script type="math/tex" id="MathJax-Element-218">i</script> is not a prefix minima, we can skip it. Otherwise, there is no point to increasing <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1423"><span class="MJXp-msubsup" id="MJXp-Span-1424"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1425" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1426" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-219">a_i</script> past the previous prefix minima. Let's enumerate the number that we would like to increase <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1427"><span class="MJXp-msubsup" id="MJXp-Span-1428"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1429" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1430" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-220">a_i</script> to, and there should be a clear candidate on which suffix maximum to use as <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1431"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1432">j</span></span></span><script type="math/tex" id="MathJax-Element-221">j</script>. Since each <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1433"><span class="MJXp-msubsup" id="MJXp-Span-1434"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1435" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1436" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-222">a_i</script> is bounded by <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1437"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1438">n</span></span></span><script type="math/tex" id="MathJax-Element-223">n</script>, there is only <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1439"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1440">O</span><span class="MJXp-mo" id="MJXp-Span-1441" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1442">n</span><span class="MJXp-mo" id="MJXp-Span-1443" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-224">O(n)</script> pairs of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1444"><span class="MJXp-mo" id="MJXp-Span-1445" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1446">i</span><span class="MJXp-mo" id="MJXp-Span-1447" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1448">j</span><span class="MJXp-mo" id="MJXp-Span-1449" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-225">(i,j)</script> produced.</p><p>We now have to solve for what the score is after each operation. Suppose we increased <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1450"><span class="MJXp-msubsup" id="MJXp-Span-1451"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1452" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1453" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-226">a_i</script> to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1454"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1455">x</span></span></span><script type="math/tex" id="MathJax-Element-227">x</script>. Let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1456"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1457">k</span></span></span><script type="math/tex" id="MathJax-Element-228">k</script> be the smallest index <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1458"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1459">k</span><span class="MJXp-mo" id="MJXp-Span-1460" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1461">i</span></span></span><script type="math/tex" id="MathJax-Element-229">k>i</script> with <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1462"><span class="MJXp-msubsup" id="MJXp-Span-1463"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1464" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1465" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-mo" id="MJXp-Span-1466" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1467">x</span></span></span><script type="math/tex" id="MathJax-Element-230">a_k\leq x</script> (<span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1468"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1469">k</span></span></span><script type="math/tex" id="MathJax-Element-231">k</script> can be found by using a sparse table and binary search). We can now decompose <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1470"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1471">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1472">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1473">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1474">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1475">e</span><span class="MJXp-mo" id="MJXp-Span-1476" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1477">a</span><span class="MJXp-mo" id="MJXp-Span-1478" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-232">score(a)</script> into the sum of the following four parts:</p> <ol>   <li>The prefix sum up to index <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1479"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1480">i</span></span></span><script type="math/tex" id="MathJax-Element-233">i</script> — this can be precomputed easily</li>   <li>The score from <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1481"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1482">i</span></span></span><script type="math/tex" id="MathJax-Element-234">i</script> to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1483"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1484">k</span><span class="MJXp-mo" id="MJXp-Span-1485" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-1486">1</span></span></span><script type="math/tex" id="MathJax-Element-235">k-1</script> — this can be calculated easily as <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1487"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1488">x</span><span class="MJXp-mo" id="MJXp-Span-1489" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mo" id="MJXp-Span-1490" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1491">k</span><span class="MJXp-mo" id="MJXp-Span-1492" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1493">i</span><span class="MJXp-mo" id="MJXp-Span-1494" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-236">x\cdot(k-i)</script>.</li>   <li>The score from <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1495"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1496">k</span></span></span><script type="math/tex" id="MathJax-Element-237">k</script> to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1497"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1498">n</span></span></span><script type="math/tex" id="MathJax-Element-238">n</script> assuming <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1499"><span class="MJXp-msubsup" id="MJXp-Span-1500"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1501" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1502" style="vertical-align: -0.4em;">k</span></span></span></span><script type="math/tex" id="MathJax-Element-239">a_k</script> is the prefix minimum. Call this <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1503"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1504">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1505">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1506">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1507">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1508">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1509">x</span><span class="MJXp-mo" id="MJXp-Span-1510" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1511">k</span><span class="MJXp-mo" id="MJXp-Span-1512" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-240">suffix(k)</script>. This can be precalculated as well using a monotonic stack. We can find the smallest number <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1513"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1514">l</span><span class="MJXp-mo" id="MJXp-Span-1515" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1516">k</span></span></span><script type="math/tex" id="MathJax-Element-241">l>k</script> with <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1517"><span class="MJXp-msubsup" id="MJXp-Span-1518"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1519" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1520" style="vertical-align: -0.4em;">l</span></span><span class="MJXp-mo" id="MJXp-Span-1521" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-msubsup" id="MJXp-Span-1522"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1523" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1524" style="vertical-align: -0.4em;">k</span></span></span></span><script type="math/tex" id="MathJax-Element-242">a_l<a_k</script>, then compute the answer as <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1525"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1526">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1527">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1528">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1529">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1530">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1531">x</span><span class="MJXp-mo" id="MJXp-Span-1532" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1533">l</span><span class="MJXp-mo" id="MJXp-Span-1534" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1535" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-1536"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1537" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1538" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-mo" id="MJXp-Span-1539" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mo" id="MJXp-Span-1540" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1541">l</span><span class="MJXp-mo" id="MJXp-Span-1542" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1543">k</span><span class="MJXp-mo" id="MJXp-Span-1544" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-243">suffix(l)+a_k\cdot(l-k)</script>.</li>   <li>Finally, we have to subtract the contribution from <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1545"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1546">j</span></span></span><script type="math/tex" id="MathJax-Element-244">j</script> to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1547"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1548">n</span></span></span><script type="math/tex" id="MathJax-Element-245">n</script> since we set <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1549"><span class="MJXp-msubsup" id="MJXp-Span-1550"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1551" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1552" style="vertical-align: -0.4em;">j</span></span><span class="MJXp-mo" id="MJXp-Span-1553" style="margin-left: 0.111em; margin-right: 0.167em;">:=</span><span class="MJXp-mn" id="MJXp-Span-1554">0</span></span></span><script type="math/tex" id="MathJax-Element-246">a_j:=0</script>. Note that up to index <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1555"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1556">j</span></span></span><script type="math/tex" id="MathJax-Element-247">j</script>, the minimum <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1557"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1558">M</span></span></span><script type="math/tex" id="MathJax-Element-248">M</script> is now <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1559"><span class="MJXp-mo" id="MJXp-Span-1560" style="margin-left: 0.333em; margin-right: 0.333em;">min</span><span class="MJXp-mo" id="MJXp-Span-1561" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1562"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1563" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1564" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-1565" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1566"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1567" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1568" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1569" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-1570" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-1571" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1572"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1573" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1574" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1575" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-1576">1</span><span class="MJXp-mo" id="MJXp-Span-1577" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1578">x</span><span class="MJXp-mo" id="MJXp-Span-1579" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1580"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1581" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1582" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1583">i</span><span class="MJXp-mo" id="MJXp-Span-1584">+</span><span class="MJXp-mn" id="MJXp-Span-1585">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-1586" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1587"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1588" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1589" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1590">i</span><span class="MJXp-mo" id="MJXp-Span-1591">+</span><span class="MJXp-mn" id="MJXp-Span-1592">2</span></span></span><span class="MJXp-mo" id="MJXp-Span-1593" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-1594" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-1595" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1596"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1597" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1598" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1599">j</span><span class="MJXp-mo" id="MJXp-Span-1600">−</span><span class="MJXp-mn" id="MJXp-Span-1601">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-1602" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-249">\min(a_1,a_2,\ldots,a_i-1, x, a_{i+1},a_{i+2},\ldots,a_{j-1})</script>. Now, we can use the same trick — binary search and sparse table to find the first <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1603"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1604">m</span><span class="MJXp-mo" id="MJXp-Span-1605" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1606">j</span></span></span><script type="math/tex" id="MathJax-Element-250">m\geq j</script> with <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1607"><span class="MJXp-msubsup" id="MJXp-Span-1608"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1609" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1610" style="vertical-align: -0.4em;">m</span></span><span class="MJXp-mo" id="MJXp-Span-1611" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1612">M</span></span></span><script type="math/tex" id="MathJax-Element-251">a_m\leq M</script>, and subtract <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1613"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1614">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1615">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1616">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1617">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1618">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1619">x</span><span class="MJXp-mo" id="MJXp-Span-1620" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1621">m</span><span class="MJXp-mo" id="MJXp-Span-1622" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1623" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1624">M</span><span class="MJXp-mo" id="MJXp-Span-1625" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1626">m</span><span class="MJXp-mo" id="MJXp-Span-1627" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1628">j</span><span class="MJXp-mo" id="MJXp-Span-1629" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-252">suffix(m)+M(m-j)</script> from our count here.</li> </ol><p>Now that we have a way to solve the full array, let's solve for all possible costs. </p><p>It can be shown that the same <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1630"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1631">O</span><span class="MJXp-mo" id="MJXp-Span-1632" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1633">n</span><span class="MJXp-mo" id="MJXp-Span-1634" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-253">O(n)</script> queries from before will necessarily obtain the correct answers (proof is left as an exercise). Thus, to solve the problem, let's create an array <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1635"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1636">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1637">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1638">s</span></span></span><script type="math/tex" id="MathJax-Element-254">ans</script>, and while processing each <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1639"><span class="MJXp-mo" id="MJXp-Span-1640" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1641">i</span><span class="MJXp-mo" id="MJXp-Span-1642" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1643">j</span><span class="MJXp-mo" id="MJXp-Span-1644" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-255">(i,j)</script> pair, update <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1645"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1646">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1647">n</span><span class="MJXp-msubsup" id="MJXp-Span-1648"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1649" style="margin-right: 0.05em;">s</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1650" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1651">j</span><span class="MJXp-mo" id="MJXp-Span-1652">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1653">i</span></span></span></span></span><script type="math/tex" id="MathJax-Element-256">ans_{j-i}</script>. After that, taking the suffix maximum will suffice.</p></div></div> <div class="spoiler"><b class="spoiler-title">Code</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#ifdef</span><span class="pln"> DEBUG
</span><span class="com">#define</span><span class="pln"> _GLIBCXX_DEBUG
</span><span class="com">#endif</span><span class="pln">
</span><span class="com">//#pragma GCC optimize("O3")</span><span class="pln">
</span><span class="com">#include</span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
 
</span><span class="com">#ifdef</span><span class="pln"> DEBUG
</span><span class="com">#include</span><span class="pln"> </span><span class="str">"lib/debug.h"</span><span class="pln">
</span><span class="com">#else</span><span class="pln">
</span><span class="com">#define</span><span class="pln"> debug</span><span class="pun">(...)</span><span class="pln"> </span><span class="lit">228</span><span class="pln">
</span><span class="com">#endif</span><span class="pln">
 
</span><span class="com">#define</span><span class="pln"> pb push_back
 
</span><span class="kwd">typedef</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> ll</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">typedef</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">double</span><span class="pln"> ld</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> maxN </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1e6</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">10</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">maxN</span><span class="pun">];</span><span class="pln">
ll best</span><span class="pun">[</span><span class="pln">maxN</span><span class="pun">];</span><span class="pln">
ll pref</span><span class="pun">[</span><span class="pln">maxN</span><span class="pun">];</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> sec_mn</span><span class="pun">[</span><span class="pln">maxN</span><span class="pun">];</span><span class="pln">
ll pref_sec</span><span class="pun">[</span><span class="pln">maxN</span><span class="pun">];</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> MN</span><span class="pun">[</span><span class="pln">maxN</span><span class="pun">];</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> f</span><span class="pun">[</span><span class="pln">maxN</span><span class="pun">];</span><span class="pln">
</span><span class="kwd">void</span><span class="pln"> solve</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> cin </span><span class="pun">&gt;&gt;</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        best</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    vector</span><span class="str">&lt;int&gt;</span><span class="pln"> suf_max</span><span class="pun">;</span><span class="pln">
    suf_max</span><span class="pun">.</span><span class="pln">reserve</span><span class="pun">(</span><span class="pln">n</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">suf_max</span><span class="pun">.</span><span class="pln">empty</span><span class="pun">()</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">suf_max</span><span class="pun">.</span><span class="pln">back</span><span class="pun">()])</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            suf_max</span><span class="pun">.</span><span class="pln">emplace_back</span><span class="pun">(</span><span class="pln">i</span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> mn </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1e9</span><span class="pun">;</span><span class="pln">
    sec_mn</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1e9</span><span class="pun">;</span><span class="pln">
    MN</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1e9</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> ind </span><span class="pun">=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        sec_mn</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> sec_mn</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">];</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> mn</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">ind </span><span class="pun">!=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                f</span><span class="pun">[</span><span class="pln">ind</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> i</span><span class="pun">;</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
            sec_mn</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> mn</span><span class="pun">;</span><span class="pln">
            mn </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
            ind </span><span class="pun">=</span><span class="pln"> i</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> sec_mn</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            sec_mn</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        MN</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> mn</span><span class="pun">;</span><span class="pln">
        pref</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> pref</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> mn</span><span class="pun">;</span><span class="pln">
        pref_sec</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> pref_sec</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> sec_mn</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pun">(</span><span class="pln">ind </span><span class="pun">!=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">);</span><span class="pln">
    f</span><span class="pun">[</span><span class="pln">ind</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
    best</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> pref</span><span class="pun">[</span><span class="pln">n</span><span class="pun">];</span><span class="pln">
    vector</span><span class="str">&lt;int&gt;</span><span class="pln"> st</span><span class="pun">{</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">};</span><span class="pln">
    a</span><span class="pun">[</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1e9</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">MN</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> id</span><span class="pun">:</span><span class="pln"> suf_max</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">id </span><span class="pun">&lt;=</span><span class="pln"> i</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
                </span><span class="kwd">int</span><span class="pln"> cur_mn </span><span class="pun">=</span><span class="pln"> min</span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">id</span><span class="pun">],</span><span class="pln"> MN</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]);</span><span class="pln">
                </span><span class="kwd">int</span><span class="pln"> l </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
                </span><span class="kwd">int</span><span class="pln"> r </span><span class="pun">=</span><span class="pln"> st</span><span class="pun">.</span><span class="pln">size</span><span class="pun">();</span><span class="pln">
                </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">r </span><span class="pun">-</span><span class="pln"> l </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    </span><span class="kwd">int</span><span class="pln"> mid </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l </span><span class="pun">+</span><span class="pln"> r</span><span class="pun">)</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln">
                    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">st</span><span class="pun">[</span><span class="pln">mid</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">&lt;=</span><span class="pln"> cur_mn</span><span class="pun">)</span><span class="pln"> l </span><span class="pun">=</span><span class="pln"> mid</span><span class="pun">;</span><span class="pln">
                    </span><span class="kwd">else</span><span class="pln"> r </span><span class="pun">=</span><span class="pln"> mid</span><span class="pun">;</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">
                </span><span class="kwd">int</span><span class="pln"> upto </span><span class="pun">=</span><span class="pln"> min</span><span class="pun">(</span><span class="pln">id </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> st</span><span class="pun">[</span><span class="pln">l</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
                ll val </span><span class="pun">=</span><span class="pln"> pref</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> cur_mn </span><span class="pun">*</span><span class="pln"> </span><span class="lit">1LL</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">(</span><span class="pln">upto </span><span class="pun">-</span><span class="pln"> i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
</span><span class="com">//                if (i == 3 &amp;&amp; id == 5) {</span><span class="pln">
</span><span class="com">//                    cout &lt;&lt; " HI " &lt;&lt; endl;</span><span class="pln">
</span><span class="com">//                    cout &lt;&lt; val &lt;&lt; " " &lt;&lt; cur_mn &lt;&lt; " " &lt;&lt; upto &lt;&lt; endl;</span><span class="pln">
</span><span class="com">//                }</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">upto </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> id</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    </span><span class="kwd">int</span><span class="pln"> upup </span><span class="pun">=</span><span class="pln"> min</span><span class="pun">(</span><span class="pln">f</span><span class="pun">[</span><span class="pln">i</span><span class="pun">],</span><span class="pln"> id</span><span class="pun">);</span><span class="pln">
</span><span class="com">//                    if (i == 1 &amp;&amp; id == 4) {</span><span class="pln">
</span><span class="com">//                        cout &lt;&lt; val &lt;&lt; " ???? " &lt;&lt; upup &lt;&lt; endl;</span><span class="pln">
</span><span class="com">//                    }</span><span class="pln">
                    </span><span class="kwd">assert</span><span class="pun">(</span><span class="pln">upup </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">&gt;=</span><span class="pln"> upto</span><span class="pun">);</span><span class="pln">
                    val </span><span class="pun">+=</span><span class="pln"> pref_sec</span><span class="pun">[</span><span class="pln">upup </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> pref_sec</span><span class="pun">[</span><span class="pln">upto</span><span class="pun">];</span><span class="pln">
                    val </span><span class="pun">+=</span><span class="pln"> pref</span><span class="pun">[</span><span class="pln">id </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> pref</span><span class="pun">[</span><span class="pln">upup </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">];</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">
                best</span><span class="pun">[</span><span class="pln">id </span><span class="pun">-</span><span class="pln"> i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> max</span><span class="pun">(</span><span class="pln">best</span><span class="pun">[</span><span class="pln">id </span><span class="pun">-</span><span class="pln"> i</span><span class="pun">],</span><span class="pln"> val</span><span class="pun">);</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">id</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&gt;=</span><span class="pln"> MN</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">])</span><span class="pln"> </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">st</span><span class="pun">.</span><span class="pln">empty</span><span class="pun">()</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;=</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">st</span><span class="pun">.</span><span class="pln">back</span><span class="pun">()])</span><span class="pln"> st</span><span class="pun">.</span><span class="pln">pop_back</span><span class="pun">();</span><span class="pln">
        st</span><span class="pun">.</span><span class="pln">emplace_back</span><span class="pun">(</span><span class="pln">i</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> n </span><span class="pun">-</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">--)</span><span class="pln"> best</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> max</span><span class="pun">(</span><span class="pln">best</span><span class="pun">[</span><span class="pln">i</span><span class="pun">],</span><span class="pln"> best</span><span class="pun">[</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]);</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> cout </span><span class="pun">&lt;&lt;</span><span class="pln"> best</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">" "</span><span class="pun">;</span><span class="pln">
    cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    ios_base</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="kwd">false</span><span class="pun">);</span><span class="pln">
    cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="kwd">nullptr</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">auto</span><span class="pln"> start </span><span class="pun">=</span><span class="pln"> std</span><span class="pun">::</span><span class="pln">chrono</span><span class="pun">::</span><span class="pln">high_resolution_clock</span><span class="pun">::</span><span class="pln">now</span><span class="pun">();</span><span class="pln">
</span><span class="com">#ifdef</span><span class="pln"> DEBUG
    freopen</span><span class="pun">(</span><span class="str">"input.txt"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"r"</span><span class="pun">,</span><span class="pln"> stdin</span><span class="pun">);</span><span class="pln">
</span><span class="com">#endif</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> tst</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> tst</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">tst</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        solve</span><span class="pun">();</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div> <div class="spoiler"><b class="spoiler-title">Rate the Problem</b><div class="spoiler-content" style="display: block;"><ul>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="10797">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="31">31</span>
            </i>
        </a>
    </span>


 Great Problem</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="10798">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="4">4</span>
            </i>
        </a>
    </span>


 Good Problem</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="10799">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="6">6</span>
            </i>
        </a>
    </span>


 Okay Problem</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="10800">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="1">1</span>
            </i>
        </a>
    </span>


 Bad Problem</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="10825">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="22">22</span>
            </i>
        </a>
    </span>


 Did not solve</li> </ul></div></div><h4><a href="https://codeforces.com/contest/2124/problem/H">2124H - Longest Good Subsequence</a></h4><p>Problem Credits: <a class="rated-user user-orange" href="https://codeforces.com/profile/Proof_by_QED" title="Master Proof_by_QED">Proof_by_QED</a> <br></p><p>Special thanks to <a class="rated-user user-orange" href="https://codeforces.com/profile/satyam343" title="Master satyam343">satyam343</a> for helping with improving the problem, and <a class="rated-user user-red" href="https://codeforces.com/profile/Dominater069" title="International Grandmaster Dominater069">Dominater069</a> for the full solution!</p> <div class="spoiler"><b class="spoiler-title">Hint 1</b><div class="spoiler-content" style="display: block;"><p>Characterize what a good subsequence is.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 2</b><div class="spoiler-content" style="display: block;"><p>Use a range DP approach and some greedy techniques to find the answer</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><p>Let's first determine whether a given sequence can be good. We claim that a sequence <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1654"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1655">b</span></span></span><script type="math/tex" id="MathJax-Element-257">b</script> is good if for each index <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1656"><span class="MJXp-mn" id="MJXp-Span-1657">1</span><span class="MJXp-mo" id="MJXp-Span-1658" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1659">i</span><span class="MJXp-mo" id="MJXp-Span-1660" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mrow" id="MJXp-Span-1661"><span class="MJXp-mo" id="MJXp-Span-1662" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1663">b</span><span class="MJXp-mrow" id="MJXp-Span-1664"><span class="MJXp-mo" id="MJXp-Span-1665" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span></span></span><script type="math/tex" id="MathJax-Element-258">1 \leq i \leq |b|</script>, if <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1666"><span class="MJXp-msubsup" id="MJXp-Span-1667"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1668" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1669" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1670" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1671">x</span></span></span><script type="math/tex" id="MathJax-Element-259">b_i=x</script>, then one of the following must be true:</p> <ol>   <li><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1672"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1673">x</span><span class="MJXp-mo" id="MJXp-Span-1674" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1675">i</span></span></span><script type="math/tex" id="MathJax-Element-260">x=i</script></li>   <li><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1676"><span class="MJXp-msubsup" id="MJXp-Span-1677"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1678" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1679" style="vertical-align: -0.4em;">x</span></span><span class="MJXp-mo" id="MJXp-Span-1680" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1681">x</span></span></span><script type="math/tex" id="MathJax-Element-261">b_x=x</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1682"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1683">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1684">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1685">n</span><span class="MJXp-mo" id="MJXp-Span-1686" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1687"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1688" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1689" style="vertical-align: -0.4em;">x</span></span><span class="MJXp-mo" id="MJXp-Span-1690" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1691"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1692" style="margin-right: 0.05em;">b</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1693" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1694">x</span><span class="MJXp-mo" id="MJXp-Span-1695">+</span><span class="MJXp-mn" id="MJXp-Span-1696">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-1697" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-1698" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-1699" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1700"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1701" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1702" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1703" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1704" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1705">x</span></span></span><script type="math/tex" id="MathJax-Element-262">min(b_x,b_{x+1},\ldots,b_i)\geq x</script>.</li> </ol><p>To prove this, we can note that this is necessary by transitivity of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1706"><span class="MJXp-mo" id="MJXp-Span-1707" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span></span></span><script type="math/tex" id="MathJax-Element-263">></script>, and sufficient as we can construct a permutation (the method of doing so is left as an exercise to the reader).</p><p>Another way of thinking about this is: let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1708"><span class="MJXp-mo" id="MJXp-Span-1709" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1710">i</span><span class="MJXp-mo" id="MJXp-Span-1711" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1712">j</span><span class="MJXp-mo" id="MJXp-Span-1713" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-264">(i,j)</script> be an interval where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1714"><span class="MJXp-msubsup" id="MJXp-Span-1715"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1716" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1717" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1718" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1719">i</span></span></span><script type="math/tex" id="MathJax-Element-265">b_i=i</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1720"><span class="MJXp-msubsup" id="MJXp-Span-1721"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1722" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1723" style="vertical-align: -0.4em;">j</span></span><span class="MJXp-mo" id="MJXp-Span-1724" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1725">i</span></span></span><script type="math/tex" id="MathJax-Element-266">b_j=i</script>, and there exists no index <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1726"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1727">k</span><span class="MJXp-mo" id="MJXp-Span-1728" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1729">j</span></span></span><script type="math/tex" id="MathJax-Element-267">k>j</script> such that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1730"><span class="MJXp-msubsup" id="MJXp-Span-1731"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1732" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1733" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-mo" id="MJXp-Span-1734" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1735">i</span></span></span><script type="math/tex" id="MathJax-Element-268">b_k=i</script>. The condition <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1736"><span class="MJXp-msubsup" id="MJXp-Span-1737"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1738" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1739" style="vertical-align: -0.4em;">p</span></span><span class="MJXp-mo" id="MJXp-Span-1740" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1741">i</span></span></span><script type="math/tex" id="MathJax-Element-269">b_p \geq i</script> should be satisfied for all indices <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1742"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1743">i</span><span class="MJXp-mo" id="MJXp-Span-1744" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1745">p</span><span class="MJXp-mo" id="MJXp-Span-1746" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1747">j</span></span></span><script type="math/tex" id="MathJax-Element-270">i \leq p \leq j</script>. </p><p>Uisng the above, we can construct a range DP solution. Let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1748"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1749">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1750">p</span><span class="MJXp-mo" id="MJXp-Span-1751" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1752">i</span><span class="MJXp-mo" id="MJXp-Span-1753" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1754">j</span><span class="MJXp-mo" id="MJXp-Span-1755" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-271">dp(i,j)</script> be the maximum length of a sequence if <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1756"><span class="MJXp-msubsup" id="MJXp-Span-1757"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1758" style="margin-right: 0.05em;">b</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1759" style="vertical-align: -0.4em;"><span class="MJXp-msubsup" id="MJXp-Span-1760"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1761" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1762" style="vertical-align: -0.4em;">i</span></span></span></span><span class="MJXp-mo" id="MJXp-Span-1763" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-1764"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1765" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1766" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-272">b_{a_i}=a_i</script>, and we only consider numbers greater than or equal to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1767"><span class="MJXp-msubsup" id="MJXp-Span-1768"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1769" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1770" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-273">a_i</script> from <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1771"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1772">i</span></span></span><script type="math/tex" id="MathJax-Element-274">i</script> to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1773"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1774">j</span></span></span><script type="math/tex" id="MathJax-Element-275">j</script> while building the subsequence (essentially, this acts as one complete segment). We can initialize <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1775"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1776">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1777">p</span><span class="MJXp-mo" id="MJXp-Span-1778" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1779">i</span><span class="MJXp-mo" id="MJXp-Span-1780" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1781">i</span><span class="MJXp-mo" id="MJXp-Span-1782" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1783" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-1784"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1785" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1786" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-276">dp(i,i)=a_i</script> for each <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1787"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1788">i</span></span></span><script type="math/tex" id="MathJax-Element-277">i</script>. Then, we can enumerate <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1789"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1790">i</span></span></span><script type="math/tex" id="MathJax-Element-278">i</script> from the back, and calculate the answer for each possible <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1791"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1792">j</span></span></span><script type="math/tex" id="MathJax-Element-279">j</script>. As we travel from <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1793"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1794">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1795">p</span><span class="MJXp-mo" id="MJXp-Span-1796" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1797">i</span><span class="MJXp-mo" id="MJXp-Span-1798" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1799">j</span><span class="MJXp-mo" id="MJXp-Span-1800" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-1801">1</span><span class="MJXp-mo" id="MJXp-Span-1802" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-280">dp(i,j-1)</script> to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1803"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1804">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1805">p</span><span class="MJXp-mo" id="MJXp-Span-1806" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1807">i</span><span class="MJXp-mo" id="MJXp-Span-1808" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1809">j</span><span class="MJXp-mo" id="MJXp-Span-1810" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-281">dp(i,j)</script>, there are a few cases to consider:</p> <ol>   <li><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1811"><span class="MJXp-msubsup" id="MJXp-Span-1812"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1813" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1814" style="vertical-align: -0.4em;">j</span></span><span class="MJXp-mo" id="MJXp-Span-1815" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-1816"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1817" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1818" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-282">a_j=a_i</script>: we can simply add <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1819"><span class="MJXp-mn" id="MJXp-Span-1820">1</span></span></span><script type="math/tex" id="MathJax-Element-283">1</script> to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1821"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1822">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1823">p</span><span class="MJXp-mo" id="MJXp-Span-1824" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1825">i</span><span class="MJXp-mo" id="MJXp-Span-1826" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1827">j</span><span class="MJXp-mo" id="MJXp-Span-1828" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-1829">1</span><span class="MJXp-mo" id="MJXp-Span-1830" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-284">dp(i,j-1)</script> to get <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1831"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1832">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1833">p</span><span class="MJXp-mo" id="MJXp-Span-1834" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1835">i</span><span class="MJXp-mo" id="MJXp-Span-1836" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1837">j</span><span class="MJXp-mo" id="MJXp-Span-1838" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-285">dp(i,j)</script> as we can append it to our sequence for no cost.</li>   <li><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1839"><span class="MJXp-msubsup" id="MJXp-Span-1840"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1841" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1842" style="vertical-align: -0.4em;">j</span></span><span class="MJXp-mo" id="MJXp-Span-1843" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-msubsup" id="MJXp-Span-1844"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1845" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1846" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-286">a_j<a_i</script>: we cannot append this due to the definition of good, so <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1847"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1848">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1849">p</span><span class="MJXp-mo" id="MJXp-Span-1850" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1851">i</span><span class="MJXp-mo" id="MJXp-Span-1852" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1853">j</span><span class="MJXp-mo" id="MJXp-Span-1854" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1855" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1856">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1857">p</span><span class="MJXp-mo" id="MJXp-Span-1858" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1859">i</span><span class="MJXp-mo" id="MJXp-Span-1860" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1861">j</span><span class="MJXp-mo" id="MJXp-Span-1862" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-1863">1</span><span class="MJXp-mo" id="MJXp-Span-1864" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-287">dp(i,j)=dp(i,j-1)</script>.</li>   <li><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1865"><span class="MJXp-msubsup" id="MJXp-Span-1866"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1867" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1868" style="vertical-align: -0.4em;">j</span></span><span class="MJXp-mo" id="MJXp-Span-1869" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-msubsup" id="MJXp-Span-1870"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1871" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1872" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-288">a_j>a_i</script>: Let's use a greedy approach to find where the segment beginning with <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1873"><span class="MJXp-msubsup" id="MJXp-Span-1874"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1875" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1876" style="vertical-align: -0.4em;">j</span></span></span></span><script type="math/tex" id="MathJax-Element-289">a_j</script> should start. Clearly, it should start as soon as possible (since the starting point must have length <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1877"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1878">j</span></span></span><script type="math/tex" id="MathJax-Element-290">j</script> already, and we cannot append anything less than <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1879"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1880">j</span></span></span><script type="math/tex" id="MathJax-Element-291">j</script> before we begin). To do this, maintain a new array <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1881"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1882">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1883">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1884">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1885">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1886">t</span></span></span><script type="math/tex" id="MathJax-Element-292">first</script> such that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1887"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1888">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1889">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1890">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1891">s</span><span class="MJXp-msubsup" id="MJXp-Span-1892"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1893" style="margin-right: 0.05em;">t</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1894" style="vertical-align: -0.4em;">k</span></span></span></span><script type="math/tex" id="MathJax-Element-293">first_k</script> holds the smallest index <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1895"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1896">y</span></span></span><script type="math/tex" id="MathJax-Element-294">y</script> where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1897"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1898">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1899">p</span><span class="MJXp-mo" id="MJXp-Span-1900" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1901">i</span><span class="MJXp-mo" id="MJXp-Span-1902" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1903">y</span><span class="MJXp-mo" id="MJXp-Span-1904" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1905" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-msubsup" id="MJXp-Span-1906"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1907" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1908" style="vertical-align: -0.4em;">y</span></span></span></span><script type="math/tex" id="MathJax-Element-295">dp(i,y)\geq a_y</script> (so it is possible to start another segment with <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1909"><span class="MJXp-msubsup" id="MJXp-Span-1910"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1911" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1912" style="vertical-align: -0.4em;">y</span></span></span></span><script type="math/tex" id="MathJax-Element-296">a_y</script> here, since we can delete any elements from a good sequence, and the sequence will still be good). Then, we can make the transition <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1913"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1914">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1915">p</span><span class="MJXp-mo" id="MJXp-Span-1916" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1917">i</span><span class="MJXp-mo" id="MJXp-Span-1918" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1919">j</span><span class="MJXp-mo" id="MJXp-Span-1920" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1921" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-1922" style="margin-left: 0.333em; margin-right: 0.333em;">max</span><span class="MJXp-mo" id="MJXp-Span-1923" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1924">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1925">p</span><span class="MJXp-mo" id="MJXp-Span-1926" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1927">i</span><span class="MJXp-mo" id="MJXp-Span-1928" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1929">j</span><span class="MJXp-mo" id="MJXp-Span-1930" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-1931">1</span><span class="MJXp-mo" id="MJXp-Span-1932" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1933" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1934">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1935">p</span><span class="MJXp-mo" id="MJXp-Span-1936" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1937">y</span><span class="MJXp-mo" id="MJXp-Span-1938" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1939">j</span><span class="MJXp-mo" id="MJXp-Span-1940" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1941" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-297">dp(i,j)=\max(dp(i,j-1), dp(y,j))</script>.</li> </ol><p>The problem is solved in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1942"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1943">O</span><span class="MJXp-mo" id="MJXp-Span-1944" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1945"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1946" style="margin-right: 0.05em;">n</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1947" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1948" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-298">O(n^2)</script> time.</p></div></div> <div class="spoiler"><b class="spoiler-title">Code</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
</span><span class="com">#define</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> </span><span class="kwd">short</span><span class="pln">
</span><span class="com">#define</span><span class="pln"> INF </span><span class="pun">(</span><span class="kwd">int</span><span class="pun">)</span><span class="lit">1e18</span><span class="pln">

mt19937_64 RNG</span><span class="pun">(</span><span class="pln">chrono</span><span class="pun">::</span><span class="pln">steady_clock</span><span class="pun">::</span><span class="pln">now</span><span class="pun">().</span><span class="pln">time_since_epoch</span><span class="pun">().</span><span class="pln">count</span><span class="pun">());</span><span class="pln">

</span><span class="kwd">void</span><span class="pln"> </span><span class="typ">Solve</span><span class="pun">()</span><span class="pln"> 
</span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
    
    vector </span><span class="str">&lt;int&gt;</span><span class="pln"> a</span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++){</span><span class="pln">
        cin </span><span class="pun">&gt;&gt;</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    
    vector</span><span class="pun">&lt;</span><span class="pln">vector</span><span class="str">&lt;int&gt;</span><span class="pun">&gt;</span><span class="pln"> dp</span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> vector</span><span class="str">&lt;int&gt;</span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">));</span><span class="pln">
    
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">--){</span><span class="pln">
        vector </span><span class="str">&lt;int&gt;</span><span class="pln"> good</span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> curr </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
        
        dp</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> curr</span><span class="pun">;</span><span class="pln">
        
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++){</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]){</span><span class="pln">
                </span><span class="kwd">continue</span><span class="pun">;</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
            
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]){</span><span class="pln">
                curr </span><span class="pun">+=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
                dp</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> curr</span><span class="pun">;</span><span class="pln">
                </span><span class="kwd">continue</span><span class="pun">;</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
            
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">good</span><span class="pun">[</span><span class="pln">a</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;=</span><span class="pln"> curr </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">){</span><span class="pln">
                good</span><span class="pun">[</span><span class="pln">a</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> j</span><span class="pun">;</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
            
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">good</span><span class="pun">[</span><span class="pln">a</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">){</span><span class="pln">
                </span><span class="kwd">int</span><span class="pln"> idx </span><span class="pun">=</span><span class="pln"> good</span><span class="pun">[</span><span class="pln">a</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]];</span><span class="pln">
                curr </span><span class="pun">=</span><span class="pln"> max</span><span class="pun">(</span><span class="pln">curr</span><span class="pun">,</span><span class="pln"> dp</span><span class="pun">[</span><span class="pln">idx</span><span class="pun">][</span><span class="pln">j</span><span class="pun">]);</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    
    </span><span class="com">// for (int l = 1; l &lt;= n; l++){</span><span class="pln">
    </span><span class="com">//     for (int r = l; r &lt;= n; r++){</span><span class="pln">
    </span><span class="com">//         if (dp[l][r])</span><span class="pln">
    </span><span class="com">//         cout &lt;&lt; l &lt;&lt; " " &lt;&lt; r &lt;&lt; " " &lt;&lt; dp[l][r] &lt;&lt; "\n";</span><span class="pln">
    </span><span class="com">//     }</span><span class="pln">
    </span><span class="com">// }</span><span class="pln">
    
    </span><span class="kwd">int</span><span class="pln"> curr </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    vector </span><span class="str">&lt;int&gt;</span><span class="pln"> good</span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++){</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">good</span><span class="pun">[</span><span class="pln">a</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;=</span><span class="pln"> curr </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">){</span><span class="pln">
            good</span><span class="pun">[</span><span class="pln">a</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> j</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">good</span><span class="pun">[</span><span class="pln">a</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">){</span><span class="pln">
            </span><span class="kwd">int</span><span class="pln"> idx </span><span class="pun">=</span><span class="pln"> good</span><span class="pun">[</span><span class="pln">a</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]];</span><span class="pln">
            curr </span><span class="pun">=</span><span class="pln"> max</span><span class="pun">(</span><span class="pln">curr</span><span class="pun">,</span><span class="pln"> dp</span><span class="pun">[</span><span class="pln">idx</span><span class="pun">][</span><span class="pln">j</span><span class="pun">]);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    
    cout </span><span class="pun">&lt;&lt;</span><span class="pln"> curr </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"\n"</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="typ">int32_t</span><span class="pln"> main</span><span class="pun">()</span><span class="pln"> 
</span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">auto</span><span class="pln"> </span><span class="kwd">begin</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> std</span><span class="pun">::</span><span class="pln">chrono</span><span class="pun">::</span><span class="pln">high_resolution_clock</span><span class="pun">::</span><span class="pln">now</span><span class="pun">();</span><span class="pln">
    ios_base</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> t </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
    </span><span class="com">// freopen("in",  "r", stdin);</span><span class="pln">
    </span><span class="com">// freopen("out", "w", stdout);</span><span class="pln">
    
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> t</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> 
    </span><span class="pun">{</span><span class="pln">
        </span><span class="com">//cout &lt;&lt; "Case #" &lt;&lt; i &lt;&lt; ": ";</span><span class="pln">
        </span><span class="typ">Solve</span><span class="pun">();</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">auto</span><span class="pln"> </span><span class="kwd">end</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> std</span><span class="pun">::</span><span class="pln">chrono</span><span class="pun">::</span><span class="pln">high_resolution_clock</span><span class="pun">::</span><span class="pln">now</span><span class="pun">();</span><span class="pln">
    </span><span class="kwd">auto</span><span class="pln"> elapsed </span><span class="pun">=</span><span class="pln"> std</span><span class="pun">::</span><span class="pln">chrono</span><span class="pun">::</span><span class="pln">duration_cast</span><span class="pun">&lt;</span><span class="pln">std</span><span class="pun">::</span><span class="pln">chrono</span><span class="pun">::</span><span class="pln">nanoseconds</span><span class="pun">&gt;(</span><span class="kwd">end</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="kwd">begin</span><span class="pun">);</span><span class="pln">
    cerr </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"Time measured: "</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> elapsed</span><span class="pun">.</span><span class="pln">count</span><span class="pun">()</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="lit">1e-9</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">" seconds.\n"</span><span class="pun">;</span><span class="pln"> 
    </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div> <div class="spoiler"><b class="spoiler-title">Rate the Problem</b><div class="spoiler-content" style="display: block;"><ul>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="10801">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="30">30</span>
            </i>
        </a>
    </span>


 Great Problem</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="10802">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="0">0</span>
            </i>
        </a>
    </span>


 Good Problem</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="10803">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="0">0</span>
            </i>
        </a>
    </span>


 Okay Problem</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="10804">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="3">3</span>
            </i>
        </a>
    </span>


 Bad Problem</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="10826">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="17">17</span>
            </i>
        </a>
    </span>


 Did not solve</li> </ul></div></div><h4><a href="https://codeforces.com/contest/2124/problem/I">2124I - Lexicographic Partition</a></h4><p>Problem Credits: <a class="rated-user user-orange" href="https://codeforces.com/profile/Proof_by_QED" title="Master Proof_by_QED">Proof_by_QED</a> <br></p> <div class="spoiler"><b class="spoiler-title">Hint 1</b><div class="spoiler-content" style="display: block;"><p>Solve the inverse of this problem first. That is, given a permutation <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1949"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1950">p</span></span></span><script type="math/tex" id="MathJax-Element-299">p</script>, output <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1951"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1952">f</span><span class="MJXp-mo" id="MJXp-Span-1953" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1954">p</span><span class="MJXp-mo" id="MJXp-Span-1955" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-300">f(p)</script>.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 2</b><div class="spoiler-content" style="display: block;"><p>Analyze the case of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1956"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1957">x</span><span class="MJXp-mo" id="MJXp-Span-1958" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-1959" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mn" id="MJXp-Span-1960">1</span><span class="MJXp-mo" id="MJXp-Span-1961" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-1962">2</span><span class="MJXp-mo" id="MJXp-Span-1963" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-1964">2</span><span class="MJXp-mo" id="MJXp-Span-1965" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-1966">3</span><span class="MJXp-mo" id="MJXp-Span-1967" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-1968">3</span><span class="MJXp-mo" id="MJXp-Span-1969" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-301">x=[1,2,2,3,3]</script>. There is no solution to this <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1970"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1971">x</span></span></span><script type="math/tex" id="MathJax-Element-302">x</script>. Why?</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><p>Let's first come up with an algorithm to find <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1972"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1973">b</span></span></span><script type="math/tex" id="MathJax-Element-303">b</script> given <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1974"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1975">p</span></span></span><script type="math/tex" id="MathJax-Element-304">p</script>.</p><p>Let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1976"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1977">i</span></span></span><script type="math/tex" id="MathJax-Element-305">i</script> be the first index with <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1978"><span class="MJXp-msubsup" id="MJXp-Span-1979"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1980" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1981" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1982" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-msubsup" id="MJXp-Span-1983"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1984" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1985" style="vertical-align: -0.4em;">1</span></span></span></span><script type="math/tex" id="MathJax-Element-306">p_i<p_1</script>. We can easily prove that the first subarray cannot go up to index <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1986"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1987">i</span></span></span><script type="math/tex" id="MathJax-Element-307">i</script>. This is because otherwise, the first element in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1988"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1989">b</span></span></span><script type="math/tex" id="MathJax-Element-308">b</script> will decrease, and this will be lexicographically smaller than a partition that does not include <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1990"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1991">i</span></span></span><script type="math/tex" id="MathJax-Element-309">i</script>. </p><p>Now, if <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1992"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1993">i</span><span class="MJXp-mo" id="MJXp-Span-1994" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-1995">2</span></span></span><script type="math/tex" id="MathJax-Element-310">i=2</script>, then of course we should partition <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1996"><span class="MJXp-msubsup" id="MJXp-Span-1997"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1998" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1999" style="vertical-align: -0.4em;">1</span></span></span></span><script type="math/tex" id="MathJax-Element-311">p_1</script> by itself. Otherwise, we should find the index <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2000"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2001">j</span></span></span><script type="math/tex" id="MathJax-Element-312">j</script> with <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2002"><span class="MJXp-mn" id="MJXp-Span-2003">1</span><span class="MJXp-mo" id="MJXp-Span-2004" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2005">j</span><span class="MJXp-mo" id="MJXp-Span-2006" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2007">i</span></span></span><script type="math/tex" id="MathJax-Element-313">1 \leq j \leq i</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2008"><span class="MJXp-msubsup" id="MJXp-Span-2009"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2010" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2011" style="vertical-align: -0.4em;">j</span></span></span></span><script type="math/tex" id="MathJax-Element-314">p_j</script> is the maximum element in the segment <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2012"><span class="MJXp-mo" id="MJXp-Span-2013" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mn" id="MJXp-Span-2014">1</span><span class="MJXp-mo" id="MJXp-Span-2015" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2016">i</span><span class="MJXp-mo" id="MJXp-Span-2017" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-315">[1,i]</script>, and partition up to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2018"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2019">j</span><span class="MJXp-mo" id="MJXp-Span-2020" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-2021">1</span></span></span><script type="math/tex" id="MathJax-Element-316">j-1</script> (since this maximises the second element, which is what we want to do after maximising the first). We can now continue the process recursively, but assuming that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2022"><span class="MJXp-msubsup" id="MJXp-Span-2023"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2024" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2025" style="vertical-align: -0.4em;">j</span></span></span></span><script type="math/tex" id="MathJax-Element-317">p_j</script> is the front of the array.</p><p>Let's solve the actual problem now. Suppose we have <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2026"><span class="MJXp-msubsup" id="MJXp-Span-2027"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2028" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2029" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-2030" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2031">k</span></span></span><script type="math/tex" id="MathJax-Element-318">x_i=k</script>. Let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2032"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2033">j</span></span></span><script type="math/tex" id="MathJax-Element-319">j</script> be the largest index with <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2034"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2035">j</span><span class="MJXp-mo" id="MJXp-Span-2036" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2037">i</span></span></span><script type="math/tex" id="MathJax-Element-320">j<i</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2038"><span class="MJXp-msubsup" id="MJXp-Span-2039"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2040" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2041" style="vertical-align: -0.4em;">j</span></span><span class="MJXp-mo" id="MJXp-Span-2042" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2043">k</span><span class="MJXp-mo" id="MJXp-Span-2044" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-2045">1</span></span></span><script type="math/tex" id="MathJax-Element-321">x_j=k-1</script>. We can show that the sequence we obtain up to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2046"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2047">i</span></span></span><script type="math/tex" id="MathJax-Element-322">i</script> is the sequence up to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2048"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2049">j</span></span></span><script type="math/tex" id="MathJax-Element-323">j</script>, plus <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2050"><span class="MJXp-msubsup" id="MJXp-Span-2051"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2052" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2053" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-324">p_i</script>. This means that we can see the input array <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2054"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2055">b</span></span></span><script type="math/tex" id="MathJax-Element-325">b</script> as the depths in a tree, where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2056"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2057">j</span></span></span><script type="math/tex" id="MathJax-Element-326">j</script> is the parent of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2058"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2059">i</span></span></span><script type="math/tex" id="MathJax-Element-327">i</script>. We make the following observations:</p> <ol>   <li>If <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2060"><span class="MJXp-msubsup" id="MJXp-Span-2061"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2062" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2063" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-2064" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-2065"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2066" style="margin-right: 0.05em;">x</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2067" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2068">i</span><span class="MJXp-mo" id="MJXp-Span-2069">−</span><span class="MJXp-mn" id="MJXp-Span-2070">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-2071" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-mn" id="MJXp-Span-2072">1</span></span></span><script type="math/tex" id="MathJax-Element-328">x_i-x_{i-1}>1</script>, then this is a trivial impossible case (the sequence up to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2073"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2074">i</span></span></span><script type="math/tex" id="MathJax-Element-329">i</script> or <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2075"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2076">i</span><span class="MJXp-mo" id="MJXp-Span-2077" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-2078">1</span></span></span><script type="math/tex" id="MathJax-Element-330">i-1</script> is invalid).</li>   <li>What does it mean if <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2079"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2080">i</span><span class="MJXp-mo" id="MJXp-Span-2081" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2082">j</span><span class="MJXp-mo" id="MJXp-Span-2083" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-mn" id="MJXp-Span-2084">1</span></span></span><script type="math/tex" id="MathJax-Element-331">i-j>1</script>? This means that the sequence up to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2085"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2086">i</span></span></span><script type="math/tex" id="MathJax-Element-332">i</script> is an extension of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2087"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2088">j</span></span></span><script type="math/tex" id="MathJax-Element-333">j</script> (which is more than <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2089"><span class="MJXp-mn" id="MJXp-Span-2090">1</span></span></span><script type="math/tex" id="MathJax-Element-334">1</script> index ago), plus one number. From our analysis above, we know this means that all of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2091"><span class="MJXp-msubsup" id="MJXp-Span-2092"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2093" style="margin-right: 0.05em;">p</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2094" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2095">j</span><span class="MJXp-mo" id="MJXp-Span-2096">+</span><span class="MJXp-mn" id="MJXp-Span-2097">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-2098" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-2099"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2100" style="margin-right: 0.05em;">p</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2101" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2102">j</span><span class="MJXp-mo" id="MJXp-Span-2103">+</span><span class="MJXp-mn" id="MJXp-Span-2104">2</span></span></span><span class="MJXp-mo" id="MJXp-Span-2105" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-2106" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-2107" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-2108"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2109" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2110" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-335">p_{j+1},p_{j+2},\ldots,p_i</script> is greater than <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2111"><span class="MJXp-msubsup" id="MJXp-Span-2112"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2113" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2114" style="vertical-align: -0.4em;">j</span></span></span></span><script type="math/tex" id="MathJax-Element-336">p_j</script>, and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2115"><span class="MJXp-msubsup" id="MJXp-Span-2116"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2117" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2118" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-337">p_i</script> is the largest of them all.</li>   <li>What does it mean if <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2119"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2120">i</span><span class="MJXp-mo" id="MJXp-Span-2121" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2122">j</span><span class="MJXp-mo" id="MJXp-Span-2123" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-2124">1</span></span></span><script type="math/tex" id="MathJax-Element-338">i-j=1</script>? In this case, we cannot make any conclusions about the comparison of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2125"><span class="MJXp-msubsup" id="MJXp-Span-2126"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2127" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2128" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-339">p_i</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2129"><span class="MJXp-msubsup" id="MJXp-Span-2130"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2131" style="margin-right: 0.05em;">p</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2132" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2133">i</span><span class="MJXp-mo" id="MJXp-Span-2134">−</span><span class="MJXp-mn" id="MJXp-Span-2135">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-340">p_{i-1}</script>. Because index <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2136"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2137">i</span></span></span><script type="math/tex" id="MathJax-Element-341">i</script> will be included no matter the comparison.</li>   <li>What does point <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2138"><span class="MJXp-mn" id="MJXp-Span-2139">2</span></span></span><script type="math/tex" id="MathJax-Element-342">2</script> mean? Observe the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2140"><span class="MJXp-mo" id="MJXp-Span-2141" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mn" id="MJXp-Span-2142">1</span><span class="MJXp-mo" id="MJXp-Span-2143" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-2144">2</span><span class="MJXp-mo" id="MJXp-Span-2145" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-2146">2</span><span class="MJXp-mo" id="MJXp-Span-2147" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-2148">3</span><span class="MJXp-mo" id="MJXp-Span-2149" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-2150">3</span><span class="MJXp-mo" id="MJXp-Span-2151" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-343">[1,2,2,3,3]</script> case again. Here, we should have <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2152"><span class="MJXp-msubsup" id="MJXp-Span-2153"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2154" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2155" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-2156" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-msubsup" id="MJXp-Span-2157"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2158" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2159" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-2160" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-msubsup" id="MJXp-Span-2161"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2162" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2163" style="vertical-align: -0.4em;">3</span></span></span></span><script type="math/tex" id="MathJax-Element-344">p_1<p_2<p_3</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2164"><span class="MJXp-msubsup" id="MJXp-Span-2165"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2166" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2167" style="vertical-align: -0.4em;">3</span></span><span class="MJXp-mo" id="MJXp-Span-2168" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-msubsup" id="MJXp-Span-2169"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2170" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2171" style="vertical-align: -0.4em;">4</span></span><span class="MJXp-mo" id="MJXp-Span-2172" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-msubsup" id="MJXp-Span-2173"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2174" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2175" style="vertical-align: -0.4em;">5</span></span></span></span><script type="math/tex" id="MathJax-Element-345">p_3<p_4<p_5</script>. This implies <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2176"><span class="MJXp-msubsup" id="MJXp-Span-2177"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2178" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2179" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-2180" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-msubsup" id="MJXp-Span-2181"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2182" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2183" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-2184" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-msubsup" id="MJXp-Span-2185"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2186" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2187" style="vertical-align: -0.4em;">3</span></span><span class="MJXp-mo" id="MJXp-Span-2188" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-msubsup" id="MJXp-Span-2189"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2190" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2191" style="vertical-align: -0.4em;">4</span></span><span class="MJXp-mo" id="MJXp-Span-2192" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-msubsup" id="MJXp-Span-2193"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2194" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2195" style="vertical-align: -0.4em;">5</span></span></span></span><script type="math/tex" id="MathJax-Element-346">p_1<p_2<p_3<p_4<p_5</script>, but if this were the case then the array <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2196"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2197">x</span></span></span><script type="math/tex" id="MathJax-Element-347">x</script> would be <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2198"><span class="MJXp-mo" id="MJXp-Span-2199" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mn" id="MJXp-Span-2200">1</span><span class="MJXp-mo" id="MJXp-Span-2201" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-2202">2</span><span class="MJXp-mo" id="MJXp-Span-2203" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-2204">2</span><span class="MJXp-mo" id="MJXp-Span-2205" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-2206">2</span><span class="MJXp-mo" id="MJXp-Span-2207" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-2208">2</span><span class="MJXp-mo" id="MJXp-Span-2209" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-348">[1,2,2,2,2]</script> instead. More formally, looking at the tree, if node <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2210"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2211">i</span></span></span><script type="math/tex" id="MathJax-Element-349">i</script> has more than one children, all of its children must have at most one children, or this contradiction will occur.</li> </ol><p>Using this, let's come up with a recursive function that traverses this tree and finds the permutation. Let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2212"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2213">f</span><span class="MJXp-mo" id="MJXp-Span-2214" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2215">i</span><span class="MJXp-mo" id="MJXp-Span-2216" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2217">j</span><span class="MJXp-mo" id="MJXp-Span-2218" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2219">a</span><span class="MJXp-mo" id="MJXp-Span-2220" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2221">b</span><span class="MJXp-mo" id="MJXp-Span-2222" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-350">f(i,j,a,b)</script> fill in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2223"><span class="MJXp-msubsup" id="MJXp-Span-2224"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2225" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2226" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-2227" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-2228"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2229" style="margin-right: 0.05em;">p</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2230" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2231">i</span><span class="MJXp-mo" id="MJXp-Span-2232">+</span><span class="MJXp-mn" id="MJXp-Span-2233">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-2234" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-2235"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2236" style="margin-right: 0.05em;">p</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2237" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2238">i</span><span class="MJXp-mo" id="MJXp-Span-2239">+</span><span class="MJXp-mn" id="MJXp-Span-2240">2</span></span></span><span class="MJXp-mo" id="MJXp-Span-2241" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-2242" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-2243" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-2244"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2245" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2246" style="vertical-align: -0.4em;">j</span></span></span></span><script type="math/tex" id="MathJax-Element-351">p_i,p_{i+1},p_{i+2},\ldots,p_j</script> with numbers <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2247"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2248">a</span><span class="MJXp-mo" id="MJXp-Span-2249" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2250">a</span><span class="MJXp-mo" id="MJXp-Span-2251" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-2252">1</span><span class="MJXp-mo" id="MJXp-Span-2253" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2254">a</span><span class="MJXp-mo" id="MJXp-Span-2255" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-2256">2</span><span class="MJXp-mo" id="MJXp-Span-2257" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-2258" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-2259" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2260">b</span></span></span><script type="math/tex" id="MathJax-Element-352">a,a+1,a+2,\ldots,b</script>, where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2261"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2262">i</span></span></span><script type="math/tex" id="MathJax-Element-353">i</script> to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2263"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2264">j</span></span></span><script type="math/tex" id="MathJax-Element-354">j</script> is one full subtree, assuming that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2265"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2266">i</span></span></span><script type="math/tex" id="MathJax-Element-355">i</script> is already filled. First, let's find all direct children of node <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2267"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2268">i</span></span></span><script type="math/tex" id="MathJax-Element-356">i</script> — that is all of the indices with <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2269"><span class="MJXp-msubsup" id="MJXp-Span-2270"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2271" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2272" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-mo" id="MJXp-Span-2273" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-2274"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2275" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2276" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-2277" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-2278">1</span></span></span><script type="math/tex" id="MathJax-Element-357">x_k=x_i+1</script>. If <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2279"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2280">i</span></span></span><script type="math/tex" id="MathJax-Element-358">i</script> has more than one child and any of its children has more than one child, this is the impossible case as above. If <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2281"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2282">i</span></span></span><script type="math/tex" id="MathJax-Element-359">i</script> has more than one child, then each of its children should have at most one child. First, let's assume that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2283"><span class="MJXp-msubsup" id="MJXp-Span-2284"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2285" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2286" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-360">p_i</script> is already the smallest in the entire subtree. Let the sizes of subtrees of children be <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2287"><span class="MJXp-msubsup" id="MJXp-Span-2288"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2289" style="margin-right: 0.05em;">b</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2290" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-2291" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-2292"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2293" style="margin-right: 0.05em;">b</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2294" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-2295" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-2296" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-2297" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-2298"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2299" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2300" style="vertical-align: -0.4em;">y</span></span></span></span><script type="math/tex" id="MathJax-Element-361">b_1,b_2,\ldots,b_y</script>. We can reserve <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2301"><span class="MJXp-msubsup" id="MJXp-Span-2302"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2303" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2304" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-362">b_i</script> numbers for each subtree, and set each direct child to the largest number possible in each interval, and call our function recursively. Finally, if there is only one direct child, we can assume that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2305"><span class="MJXp-msubsup" id="MJXp-Span-2306"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2307" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2308" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-363">p_i</script> is the largest number in the subtree, and we can assign the direct child to either be the largest or smallest number, depending on the number of children. We can first assign <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2309"><span class="MJXp-msubsup" id="MJXp-Span-2310"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2311" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2312" style="vertical-align: -0.4em;">1</span></span></span></span><script type="math/tex" id="MathJax-Element-364">p_1</script> to be either <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2313"><span class="MJXp-mn" id="MJXp-Span-2314">1</span></span></span><script type="math/tex" id="MathJax-Element-365">1</script> or <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2315"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2316">n</span></span></span><script type="math/tex" id="MathJax-Element-366">n</script> depending on how many indices <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2317"><span class="MJXp-msubsup" id="MJXp-Span-2318"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2319" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2320" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-2321" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-2322">2</span></span></span><script type="math/tex" id="MathJax-Element-367">x_i=2</script> there are, then call the recursive function. This will create the valid permutation. </p></div></div> <div class="spoiler"><b class="spoiler-title">Code</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> ll </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pun">;</span><span class="pln">
</span><span class="com">#define</span><span class="pln"> vt vector

vt</span><span class="str">&lt;int&gt;</span><span class="pln"> solve</span><span class="pun">(</span><span class="kwd">const</span><span class="pln"> vt</span><span class="str">&lt;int&gt;</span><span class="pun">&amp;</span><span class="pln"> b</span><span class="pun">,</span><span class="pln"> vt</span><span class="pun">&lt;</span><span class="pln">vt</span><span class="str">&lt;int&gt;</span><span class="pun">&gt;&amp;</span><span class="pln"> inv</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> n </span><span class="pun">=</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">size</span><span class="pun">();</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">inv</span><span class="pun">[</span><span class="lit">1</span><span class="pun">].</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">{};</span><span class="pln">

    vt</span><span class="str">&lt;int&gt;</span><span class="pln"> a</span><span class="pun">(</span><span class="pln">n</span><span class="pun">);</span><span class="pln">
    stack</span><span class="pun">&lt;</span><span class="pln">array</span><span class="pun">&lt;</span><span class="kwd">int</span><span class="pun">,</span><span class="lit">5</span><span class="pun">&gt;&gt;</span><span class="pln"> s</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">inv</span><span class="pun">[</span><span class="lit">2</span><span class="pun">].</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        a</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
        s</span><span class="pun">.</span><span class="pln">push</span><span class="pun">({</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> n</span><span class="pun">-</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">});</span><span class="pln">
    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        a</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
        s</span><span class="pun">.</span><span class="pln">push</span><span class="pun">({</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> n</span><span class="pun">-</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> n</span><span class="pun">-</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">});</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">s</span><span class="pun">.</span><span class="pln">empty</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">auto</span><span class="pln"> tp </span><span class="pun">=</span><span class="pln"> s</span><span class="pun">.</span><span class="pln">top</span><span class="pun">();</span><span class="pln"> 
        s</span><span class="pun">.</span><span class="pln">pop</span><span class="pun">();</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> l </span><span class="pun">=</span><span class="pln"> tp</span><span class="pun">[</span><span class="lit">0</span><span class="pun">],</span><span class="pln"> r </span><span class="pun">=</span><span class="pln"> tp</span><span class="pun">[</span><span class="lit">1</span><span class="pun">],</span><span class="pln"> leftNum </span><span class="pun">=</span><span class="pln"> tp</span><span class="pun">[</span><span class="lit">2</span><span class="pun">],</span><span class="pln"> rightNum </span><span class="pun">=</span><span class="pln"> tp</span><span class="pun">[</span><span class="lit">3</span><span class="pun">],</span><span class="pln"> ok </span><span class="pun">=</span><span class="pln"> tp</span><span class="pun">[</span><span class="lit">4</span><span class="pun">];</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l </span><span class="pun">==</span><span class="pln"> r</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">continue</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">b</span><span class="pun">[</span><span class="pln">l</span><span class="pun">+</span><span class="lit">1</span><span class="pun">]!=</span><span class="pln">b</span><span class="pun">[</span><span class="pln">l</span><span class="pun">]+</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">{};</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> num </span><span class="pun">=</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">l</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">num </span><span class="pun">&gt;=</span><span class="pln"> inv</span><span class="pun">.</span><span class="pln">size</span><span class="pun">())</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">{};</span><span class="pln">

        vt</span><span class="str">&lt;int&gt;</span><span class="pln"> nxt</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">inv</span><span class="pun">[</span><span class="pln">num</span><span class="pun">].</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> inv</span><span class="pun">[</span><span class="pln">num</span><span class="pun">].</span><span class="pln">back</span><span class="pun">()</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> l</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            nxt</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">inv</span><span class="pun">[</span><span class="pln">num</span><span class="pun">].</span><span class="pln">back</span><span class="pun">());</span><span class="pln">
            inv</span><span class="pun">[</span><span class="pln">num</span><span class="pun">].</span><span class="pln">pop_back</span><span class="pun">();</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">nxt</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()==</span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">{};</span><span class="pln">  
        </span><span class="kwd">if</span><span class="pun">(!</span><span class="pln">ok </span><span class="pun">&amp;&amp;</span><span class="pln"> nxt</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()!=</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">{};</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">nxt</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">num</span><span class="pun">+</span><span class="lit">1</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> inv</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> inv</span><span class="pun">[</span><span class="pln">num</span><span class="pun">+</span><span class="lit">1</span><span class="pun">].</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> inv</span><span class="pun">[</span><span class="pln">num</span><span class="pun">+</span><span class="lit">1</span><span class="pun">][</span><span class="pln">inv</span><span class="pun">[</span><span class="pln">num</span><span class="pun">+</span><span class="lit">1</span><span class="pun">].</span><span class="pln">size</span><span class="pun">()-</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> l</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                a</span><span class="pun">[</span><span class="pln">nxt</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> leftNum</span><span class="pun">++;</span><span class="pln">
            </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                a</span><span class="pun">[</span><span class="pln">nxt</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> rightNum</span><span class="pun">--;</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
            s</span><span class="pun">.</span><span class="pln">push</span><span class="pun">({</span><span class="pln">l</span><span class="pun">+</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> r</span><span class="pun">,</span><span class="pln"> leftNum</span><span class="pun">,</span><span class="pln"> rightNum</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">});</span><span class="pln">
        </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            rightNum </span><span class="pun">-=</span><span class="pln"> nxt</span><span class="pun">.</span><span class="pln">size</span><span class="pun">();</span><span class="pln">
            </span><span class="kwd">int</span><span class="pln"> nx </span><span class="pun">=</span><span class="pln"> rightNum </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
            reverse</span><span class="pun">(</span><span class="pln">nxt</span><span class="pun">.</span><span class="kwd">begin</span><span class="pun">(),</span><span class="pln"> nxt</span><span class="pun">.</span><span class="kwd">end</span><span class="pun">());</span><span class="pln">
            </span><span class="kwd">int</span><span class="pln"> curLeft </span><span class="pun">=</span><span class="pln"> leftNum</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pun">)</span><span class="pln">nxt</span><span class="pun">.</span><span class="pln">size</span><span class="pun">();</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="kwd">int</span><span class="pln"> pos </span><span class="pun">=</span><span class="pln"> nxt</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
                a</span><span class="pun">[</span><span class="pln">pos</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> nx</span><span class="pun">++;</span><span class="pln">
                </span><span class="kwd">int</span><span class="pln"> nextInd </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i</span><span class="pun">+</span><span class="lit">1</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pun">)</span><span class="pln">nxt</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> nxt</span><span class="pun">[</span><span class="pln">i</span><span class="pun">+</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> r</span><span class="pun">);</span><span class="pln">
                </span><span class="kwd">int</span><span class="pln"> sz </span><span class="pun">=</span><span class="pln"> nextInd </span><span class="pun">-</span><span class="pln"> pos </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
                s</span><span class="pun">.</span><span class="pln">push</span><span class="pun">({</span><span class="pln">pos</span><span class="pun">,</span><span class="pln"> nextInd</span><span class="pun">,</span><span class="pln"> curLeft</span><span class="pun">,</span><span class="pln"> curLeft </span><span class="pun">+</span><span class="pln"> sz</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">});</span><span class="pln">
                curLeft </span><span class="pun">+=</span><span class="pln"> sz </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">return</span><span class="pln"> a</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    ios</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="kwd">false</span><span class="pun">);</span><span class="pln">
    cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="kwd">nullptr</span><span class="pun">);</span><span class="pln">

    </span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">t</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
        cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
        vt</span><span class="str">&lt;int&gt;</span><span class="pln"> x</span><span class="pun">(</span><span class="pln">n</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> cin </span><span class="pun">&gt;&gt;</span><span class="pln"> x</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">

        vt</span><span class="pun">&lt;</span><span class="pln">vt</span><span class="str">&lt;int&gt;</span><span class="pun">&gt;</span><span class="pln"> inv</span><span class="pun">(</span><span class="pln">n</span><span class="pun">+</span><span class="lit">3</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> inv</span><span class="pun">[</span><span class="pln">x</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]].</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">i</span><span class="pun">);</span><span class="pln">

        </span><span class="kwd">auto</span><span class="pln"> a </span><span class="pun">=</span><span class="pln"> solve</span><span class="pun">(</span><span class="pln">x</span><span class="pun">,</span><span class="pln"> inv</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">.</span><span class="pln">empty</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"NO\n"</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"YES\n"</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> v </span><span class="pun">:</span><span class="pln"> a</span><span class="pun">)</span><span class="pln"> cout </span><span class="pun">&lt;&lt;</span><span class="pln"> v </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">' '</span><span class="pun">;</span><span class="pln">
            cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"\n"</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span></code></pre></div></div> <div class="spoiler"><b class="spoiler-title">Rate the Problem</b><div class="spoiler-content" style="display: block;"><ul>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="10805">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="10">10</span>
            </i>
        </a>
    </span>


 Great Problem</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="10806">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="3">3</span>
            </i>
        </a>
    </span>


 Good Problem</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="10807">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="1">1</span>
            </i>
        </a>
    </span>


 Okay Problem</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="10808">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="1">1</span>
            </i>
        </a>
    </span>


 Bad Problem</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="10827">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="32">32</span>
            </i>
        </a>
    </span>


 Did not solve</li> </ul></div></div></div>

    </div>


        <div style="font-size: 1.1rem;line-height: 1.1rem;padding-bottom: 0.5em;">
            <img src="https://codeforces.com//codeforces.com/codeforces.org/s/52448/images/icons/paperclip-16x16.png" style="vertical-align: middle;"> <span style="padding: 0 0.35em;">Tutorial of <a href="https://codeforces.com/contest/2124" class="notice" style="text-decoration: none;">EPIC Institute of Technology Round Summer 2025 (Codeforces Round 1036, Div. 1 + Div. 2)</a> </span>
        </div>
        
            

  <script>
    // Make all spoilers toggleable
    document.querySelectorAll('.spoiler-title').forEach(title => {
      title.addEventListener('click', function() {
        const spoiler = this.closest('.spoiler');
        spoiler.classList.toggle('open');
      });
    });
    
    // Open all spoilers by default for easier reading
    document.querySelectorAll('.spoiler').forEach(spoiler => {
      spoiler.classList.add('open');
    });
  </script>
</body>
</html>