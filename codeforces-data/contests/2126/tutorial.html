<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tutorial</title>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
      line-height: 1.6;
      color: #333;
      background: #fafafa;
    }
    .ttypography {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    h3 {
      color: #1a1a1a;
      border-bottom: 2px solid #eee;
      padding-bottom: 10px;
    }
    h3 a {
      color: #0066cc;
      text-decoration: none;
    }
    h3 a:hover {
      text-decoration: underline;
    }
    .spoiler {
      margin: 15px 0;
      border: 1px solid #ddd;
      border-radius: 6px;
      overflow: hidden;
    }
    .spoiler-title {
      display: block;
      padding: 12px 15px;
      background: #f0f0f0;
      cursor: pointer;
      font-weight: 600;
      user-select: none;
      border-bottom: 1px solid #ddd;
    }
    .spoiler-title:hover {
      background: #e8e8e8;
    }
    .spoiler-title::before {
      content: '▶ ';
      font-size: 0.8em;
      transition: transform 0.2s;
      display: inline-block;
    }
    .spoiler.open .spoiler-title::before {
      content: '▼ ';
    }
    .spoiler-content {
      padding: 15px;
      background: #fff;
      display: none;
    }
    .spoiler.open .spoiler-content {
      display: block;
    }
    pre, code {
      background: #f5f5f5;
      font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
      font-size: 0.85em;
    }
    pre {
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
    }
    code {
      padding: 2px 5px;
      border-radius: 3px;
    }
    p {
      margin: 10px 0;
    }
    .MathJax {
      font-size: 1.1em;
    }
  </style>
</head>
<body>
  <h1>Editorial</h1>
  <p><a href="https://codeforces.com/blog/entry/144845" target="_blank">View on Codeforces →</a></p>
  
  <div class="ttypography"><p><a href="https://codeforces.com/contest/2126/problem/A" title="Codeforces Round 1037 (Div. 3)">2126A - Only One Digit</a></p><p>Idea: <a class="rated-user user-orange" href="https://codeforces.com/profile/soullless" title="Master soullless">soullless</a></p> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2126/problem/A" title="Codeforces Round 1037 (Div. 3)">2126A - Only One Digit</a></h3><div class="ttypography"><div class="problem-statement"><div><p>Key idea The minimal valid <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-154-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1610" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.49em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1611"><span class="mi" id="MathJax-Span-1612" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-154">y</script> is always a single digit. Simply find the smallest digit <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-155-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1613" style="width: 5.576em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.223em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1004.17em, 2.384em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1614"><span class="mi" id="MathJax-Span-1615" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-1616" style="font-family: MathJax_Main; padding-left: 0.273em;">∈</span><span class="texatom" id="MathJax-Span-1617" style="padding-left: 0.273em;"><span class="mrow" id="MathJax-Span-1618"><span class="mn" id="MathJax-Span-1619" style="font-family: MathJax_Main;">0</span><span class="mo" id="MathJax-Span-1620" style="font-family: MathJax_Main; padding-left: 0.165em;">…</span><span class="mn" id="MathJax-Span-1621" style="font-family: MathJax_Main; padding-left: 0.165em;">9</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.139em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-155">d ∈ {0 … 9}</script> that appears in the decimal representation of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-156-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1622" style="width: 0.814em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.54em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1623"><span class="mi" id="MathJax-Span-1624" style="font-family: MathJax_Math-italic;">x</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-156">x</script>; set <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-157-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1625" style="width: 3.087em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.33em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1002.33em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1626"><span class="mi" id="MathJax-Span-1627" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-1628" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mi" id="MathJax-Span-1629" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.361em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-157">y = d</script>. Any multi-digit number would start with some digit already checked, so scanning beyond <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-158-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1630" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1631"><span class="mn" id="MathJax-Span-1632" style="font-family: MathJax_Main;">9</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-158">9</script> is pointless.</p><p>What to do</p><p>- Build the set of digits occurring in <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-159-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1633" style="width: 0.814em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.54em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1634"><span class="mi" id="MathJax-Span-1635" style="font-family: MathJax_Math-italic;">x</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-159">x</script>.</p><p>- Iterate through digits   → <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-160-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1636" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1637"><span class="mn" id="MathJax-Span-1638" style="font-family: MathJax_Main;">9</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-160">9</script>; the first one that belongs to the set is the answer.</p><p>  </p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
  cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">while</span><span class="pun">(</span><span class="pln">t</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> x</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> x</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> mn </span><span class="pun">=</span><span class="pln"> </span><span class="lit">9</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pun">(</span><span class="pln">x </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      mn </span><span class="pun">=</span><span class="pln"> min</span><span class="pun">(</span><span class="pln">mn</span><span class="pun">,</span><span class="pln"> x </span><span class="pun">%</span><span class="pln"> </span><span class="lit">10</span><span class="pun">);</span><span class="pln">
      x</span><span class="pun">/=</span><span class="lit">10</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    cout </span><span class="pun">&lt;&lt;</span><span class="pln"> mn </span><span class="pun">&lt;&lt;</span><span class="pln"> endl</span><span class="pun">;</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2126/problem/B" title="Codeforces Round 1037 (Div. 3)">2126B - No Casino in the Mountains</a></p><p>Idea: <a class="rated-user user-orange" href="https://codeforces.com/profile/soullless" title="Master soullless">soullless</a></p> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2126/problem/B" title="Codeforces Round 1037 (Div. 3)">2126B - No Casino in the Mountains</a></h3><div class="ttypography"><div class="problem-statement"><div><p>Key observation</p><p>Inside one block of length len (all zeros) we must place patterns of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-161-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1639" style="width: 0.76em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.544em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.54em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1640"><span class="mi" id="MathJax-Span-1641" style="font-family: MathJax_Math-italic;">k</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-161">k</script> good days (the hike) plus one mandatory rest day after each hike except the last. Thus each hike consumes <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-162-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1642" style="width: 3.249em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.438em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1002.38em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1643"><span class="mi" id="MathJax-Span-1644" style="font-family: MathJax_Math-italic;">k</span><span class="mo" id="MathJax-Span-1645"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mo" id="MathJax-Span-1646" style="font-family: MathJax_Main; padding-left: 0.165em;">+</span><span class="mo" id="MathJax-Span-1647"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mn" id="MathJax-Span-1648" style="font-family: MathJax_Main; padding-left: 0.165em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-162">k + 1</script> slots, except the final one, which does not need a trailing rest day.</p><p>Therefore, the maximum number of hikes in one block is</p><p>hikes_in_block = <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-163-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1649" style="width: 4.873em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.682em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(0.869em, 1003.52em, 2.925em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1650"><span class="mo" id="MathJax-Span-1651" style="font-family: MathJax_Main;">⌊</span><span class="mfrac" id="MathJax-Span-1652"><span style="display: inline-block; position: relative; width: 2.546em; height: 0px; margin-right: 0.111em; margin-left: 0.111em;"><span style="position: absolute; clip: rect(3.304em, 1002.33em, 4.332em, -999.997em); top: -4.597em; left: 50%; margin-left: -1.188em;"><span class="mrow" id="MathJax-Span-1653"><span class="mo" id="MathJax-Span-1654" style="font-size: 70.7%; font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1655" style="font-size: 70.7%; font-family: MathJax_Math-italic;">l</span><span class="mi" id="MathJax-Span-1656" style="font-size: 70.7%; font-family: MathJax_Math-italic;">e</span><span class="mi" id="MathJax-Span-1657" style="font-size: 70.7%; font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-1658" style="font-size: 70.7%; font-family: MathJax_Main;">+</span><span class="mn" id="MathJax-Span-1659" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-1660" style="font-size: 70.7%; font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; clip: rect(3.304em, 1001.73em, 4.332em, -999.997em); top: -3.569em; left: 50%; margin-left: -0.917em;"><span class="mrow" id="MathJax-Span-1661"><span class="mo" id="MathJax-Span-1662" style="font-size: 70.7%; font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1663" style="font-size: 70.7%; font-family: MathJax_Math-italic;">k</span><span class="mo" id="MathJax-Span-1664" style="font-size: 70.7%; font-family: MathJax_Main;">+</span><span class="mn" id="MathJax-Span-1665" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-1666" style="font-size: 70.7%; font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; clip: rect(0.869em, 1002.55em, 1.247em, -999.997em); top: -1.296em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.546em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.085em;"></span></span></span></span><span class="mo" id="MathJax-Span-1667" style="font-family: MathJax_Main;">⌋</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.854em; border-left: 0px solid; width: 0px; height: 2.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-163">\lfloor \frac {(len + 1)} {(k + 1)} \rfloor</script></p><p>Intuition: add an imaginary rest day to the end of the block, then just cut the segment into chunks of size <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-164-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1668" style="width: 3.249em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.438em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1002.38em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1669"><span class="mi" id="MathJax-Span-1670" style="font-family: MathJax_Math-italic;">k</span><span class="mo" id="MathJax-Span-1671"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mo" id="MathJax-Span-1672" style="font-family: MathJax_Main; padding-left: 0.165em;">+</span><span class="mo" id="MathJax-Span-1673"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mn" id="MathJax-Span-1674" style="font-family: MathJax_Main; padding-left: 0.165em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-164">k + 1</script>.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
  cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">while</span><span class="pun">(</span><span class="pln">t</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">,</span><span class="pln">k</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n </span><span class="pun">&gt;&gt;</span><span class="pln"> k</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">];</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">i</span><span class="pun">++)</span><span class="pln"> cin </span><span class="pun">&gt;&gt;</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> ans </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> cnt </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        ans</span><span class="pun">+=(</span><span class="pln">cnt </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)/(</span><span class="pln">k </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
        cnt </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">continue</span><span class="pun">;</span><span class="pln">
      </span><span class="pun">}</span><span class="pln">
      </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        cnt</span><span class="pun">++;</span><span class="pln">
      </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    ans</span><span class="pun">+=(</span><span class="pln">cnt </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)/(</span><span class="pln">k </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
    cout </span><span class="pun">&lt;&lt;</span><span class="pln"> ans </span><span class="pun">&lt;&lt;</span><span class="pln"> endl</span><span class="pun">;</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2126/problem/C" title="Codeforces Round 1037 (Div. 3)">2126C - I Will Definitely Make It</a></p><p>Idea: <a class="rated-user user-orange" href="https://codeforces.com/profile/soullless" title="Master soullless">soullless</a></p> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2126/problem/C" title="Codeforces Round 1037 (Div. 3)">2126C - I Will Definitely Make It</a></h3><div class="ttypography"><div class="problem-statement"><div><p>Key idea While you stand on a tower of height <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-165-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1675" style="width: 0.814em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.6em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1676"><span class="mi" id="MathJax-Span-1677" style="font-family: MathJax_Math-italic;">h</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-165">h</script>, you must depart no later than time <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-166-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1678" style="width: 3.033em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.275em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1002.22em, 2.438em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1679"><span class="mi" id="MathJax-Span-1680" style="font-family: MathJax_Math-italic;">h</span><span class="mo" id="MathJax-Span-1681" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mn" id="MathJax-Span-1682" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.211em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-166">h − 1</script> (water hits level&nbsp;<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-167-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1683" style="width: 0.814em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.6em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1684"><span class="mi" id="MathJax-Span-1685" style="font-family: MathJax_Math-italic;">h</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-167">h</script> at that instant). Therefore, if you arrive at height <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-168-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1686" style="width: 0.814em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.6em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1687"><span class="mi" id="MathJax-Span-1688" style="font-family: MathJax_Math-italic;">h</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-168">h</script> at global time <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-169-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1689" style="width: 0.544em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.381em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1000.33em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1690"><span class="mi" id="MathJax-Span-1691" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-169">t</script>, you have a slack of</p><p><span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-170-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1692" style="width: 9.851em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.47em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1007.42em, 2.438em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1693"><span class="mi" id="MathJax-Span-1694" style="font-family: MathJax_Math-italic;">s</span><span class="mi" id="MathJax-Span-1695" style="font-family: MathJax_Math-italic;">l</span><span class="mi" id="MathJax-Span-1696" style="font-family: MathJax_Math-italic;">a</span><span class="mi" id="MathJax-Span-1697" style="font-family: MathJax_Math-italic;">c</span><span class="mi" id="MathJax-Span-1698" style="font-family: MathJax_Math-italic;">k</span><span class="mo" id="MathJax-Span-1699" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mi" id="MathJax-Span-1700" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">h</span><span class="mo" id="MathJax-Span-1701" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mn" id="MathJax-Span-1702" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-1703" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mi" id="MathJax-Span-1704" style="font-family: MathJax_Math-italic; padding-left: 0.219em;">t</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.211em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-170">slack = h − 1 − t</script></p><p>A move to a taller tower <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-171-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1705" style="width: 1.139em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.87em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1706"><span class="mi" id="MathJax-Span-1707" style="font-family: MathJax_Math-italic;">H<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-171">H</script> costs <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-172-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1708" style="width: 3.574em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.708em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1002.71em, 2.438em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1709"><span class="mi" id="MathJax-Span-1710" style="font-family: MathJax_Math-italic;">H<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span><span class="mo" id="MathJax-Span-1711" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mi" id="MathJax-Span-1712" style="font-family: MathJax_Math-italic; padding-left: 0.219em;">h</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.211em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-172">H − h</script> seconds. Feasibility condition:</p><p>t<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-173-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1713" style="width: 10.392em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.849em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1007.79em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1714"><span class="mo" id="MathJax-Span-1715" style="font-family: MathJax_Main;">+</span><span class="mo" id="MathJax-Span-1716" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1717" style="font-family: MathJax_Math-italic;">H<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span><span class="mo" id="MathJax-Span-1718" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mi" id="MathJax-Span-1719" style="font-family: MathJax_Math-italic; padding-left: 0.219em;">h</span><span class="mo" id="MathJax-Span-1720" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-1721" style="font-family: MathJax_Main; padding-left: 0.273em;">≤</span><span class="mi" id="MathJax-Span-1722" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">h</span><span class="mo" id="MathJax-Span-1723" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mn" id="MathJax-Span-1724" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-173"> + (H − h) \leq h − 1</script> ⇔ <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-174-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1725" style="width: 9.148em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.929em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1006.93em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1726"><span class="mi" id="MathJax-Span-1727" style="font-family: MathJax_Math-italic;">t</span><span class="mo" id="MathJax-Span-1728" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mo" id="MathJax-Span-1729" style="font-family: MathJax_Main; padding-left: 0.219em;">(</span><span class="mi" id="MathJax-Span-1730" style="font-family: MathJax_Math-italic;">H<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span><span class="mo" id="MathJax-Span-1731" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mi" id="MathJax-Span-1732" style="font-family: MathJax_Math-italic; padding-left: 0.219em;">h</span><span class="mo" id="MathJax-Span-1733" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-1734" style="font-family: MathJax_Main; padding-left: 0.273em;">&lt;</span><span class="mi" id="MathJax-Span-1735" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">h</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-174">t + (H − h) < h</script>   Greedy path (monotone-ascending) Any detour to a lower tower only wastes time and shrinks slack, so an optimal route is strictly non-decreasing in height. Thus:</p><p>1. Collect all tower heights, mark your start height <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-175-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1736" style="width: 1.356em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1001.03em, 2.438em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1737"><span class="msubsup" id="MathJax-Span-1738"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.54em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-1739" style="font-family: MathJax_Math-italic;">h</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.598em;"><span class="mn" id="MathJax-Span-1740" style="font-size: 70.7%; font-family: MathJax_Main;">0</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-175">h_0</script>.</p><p>2. Sort the heights ascending.</p><p>3. Starting with <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-176-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1741" style="width: 5.143em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.899em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1003.85em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1742"><span class="mi" id="MathJax-Span-1743" style="font-family: MathJax_Math-italic;">t</span><span class="mi" id="MathJax-Span-1744" style="font-family: MathJax_Math-italic;">i</span><span class="mi" id="MathJax-Span-1745" style="font-family: MathJax_Math-italic;">m</span><span class="mi" id="MathJax-Span-1746" style="font-family: MathJax_Math-italic;">e</span><span class="mo" id="MathJax-Span-1747" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mn" id="MathJax-Span-1748" style="font-family: MathJax_Main; padding-left: 0.273em;">0</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-176">time = 0</script>, <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-177-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1749" style="width: 5.035em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.791em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1003.79em, 2.492em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1750"><span class="mi" id="MathJax-Span-1751" style="font-family: MathJax_Math-italic;">c</span><span class="mi" id="MathJax-Span-1752" style="font-family: MathJax_Math-italic;">u</span><span class="mi" id="MathJax-Span-1753" style="font-family: MathJax_Math-italic;">r</span><span class="mo" id="MathJax-Span-1754" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="msubsup" id="MathJax-Span-1755" style="padding-left: 0.273em;"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.54em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-1756" style="font-family: MathJax_Math-italic;">h</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.598em;"><span class="mn" id="MathJax-Span-1757" style="font-size: 70.7%; font-family: MathJax_Main;">0</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-177">cur = h_0</script>, walk through every height <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-178-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1758" style="width: 4.873em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.682em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1003.68em, 2.384em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1759"><span class="mi" id="MathJax-Span-1760" style="font-family: MathJax_Math-italic;">H<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span><span class="mo" id="MathJax-Span-1761" style="font-family: MathJax_Main; padding-left: 0.273em;">&gt;</span><span class="mi" id="MathJax-Span-1762" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">c</span><span class="mi" id="MathJax-Span-1763" style="font-family: MathJax_Math-italic;">u</span><span class="mi" id="MathJax-Span-1764" style="font-family: MathJax_Math-italic;">r</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.139em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-178">H > cur</script> in order:</p><p>- <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-179-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1765" style="width: 10.176em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.687em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1007.69em, 2.438em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1766"><span class="mi" id="MathJax-Span-1767" style="font-family: MathJax_Math-italic;">t</span><span class="mi" id="MathJax-Span-1768" style="font-family: MathJax_Math-italic;">i</span><span class="mi" id="MathJax-Span-1769" style="font-family: MathJax_Math-italic;">m</span><span class="mi" id="MathJax-Span-1770" style="font-family: MathJax_Math-italic;">e</span><span class="mo" id="MathJax-Span-1771" style="font-family: MathJax_Main;">+</span><span class="mo" id="MathJax-Span-1772" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mi" id="MathJax-Span-1773" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">H<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span><span class="mo" id="MathJax-Span-1774" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mi" id="MathJax-Span-1775" style="font-family: MathJax_Math-italic; padding-left: 0.219em;">c</span><span class="mi" id="MathJax-Span-1776" style="font-family: MathJax_Math-italic;">u</span><span class="mi" id="MathJax-Span-1777" style="font-family: MathJax_Math-italic;">r</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.211em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-179">time += H − cur</script> (teleport duration)</p><p>- if <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-180-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1778" style="width: 6.388em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.819em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1004.82em, 2.492em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1779"><span class="mi" id="MathJax-Span-1780" style="font-family: MathJax_Math-italic;">t</span><span class="mi" id="MathJax-Span-1781" style="font-family: MathJax_Math-italic;">i</span><span class="mi" id="MathJax-Span-1782" style="font-family: MathJax_Math-italic;">m</span><span class="mi" id="MathJax-Span-1783" style="font-family: MathJax_Math-italic;">e</span><span class="mo" id="MathJax-Span-1784" style="font-family: MathJax_Main; padding-left: 0.273em;">≥</span><span class="mi" id="MathJax-Span-1785" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">c</span><span class="mi" id="MathJax-Span-1786" style="font-family: MathJax_Math-italic;">u</span><span class="mi" id="MathJax-Span-1787" style="font-family: MathJax_Math-italic;">r</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 1.218em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-180">time ≥ cur</script> ⇒ drowned ⇒ answer NO</p><p>- else <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-181-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1788" style="width: 4.873em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.682em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1003.68em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1789"><span class="mi" id="MathJax-Span-1790" style="font-family: MathJax_Math-italic;">c</span><span class="mi" id="MathJax-Span-1791" style="font-family: MathJax_Math-italic;">u</span><span class="mi" id="MathJax-Span-1792" style="font-family: MathJax_Math-italic;">r</span><span class="mo" id="MathJax-Span-1793" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mi" id="MathJax-Span-1794" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">H<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-181">cur = H</script> and continue.</p><p>4. If the loop finishes (or you began on the highest tower), output YES</p><p>Correctness sketch For each step we enforce <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-182-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1795" style="width: 6.388em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.819em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1004.82em, 2.384em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1796"><span class="mi" id="MathJax-Span-1797" style="font-family: MathJax_Math-italic;">t</span><span class="mi" id="MathJax-Span-1798" style="font-family: MathJax_Math-italic;">i</span><span class="mi" id="MathJax-Span-1799" style="font-family: MathJax_Math-italic;">m</span><span class="mi" id="MathJax-Span-1800" style="font-family: MathJax_Math-italic;">e</span><span class="mo" id="MathJax-Span-1801" style="font-family: MathJax_Main; padding-left: 0.273em;">&lt;</span><span class="mi" id="MathJax-Span-1802" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">c</span><span class="mi" id="MathJax-Span-1803" style="font-family: MathJax_Math-italic;">u</span><span class="mi" id="MathJax-Span-1804" style="font-family: MathJax_Math-italic;">r</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.139em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-182">time < cur</script>, exactly the survival requirement for the tower we are leaving. Because total time accumulated along an ascending chain equals the direct height difference <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-183-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1805" style="width: 7.091em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.36em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1005.25em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1806"><span class="mo" id="MathJax-Span-1807" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-1808"><span style="display: inline-block; position: relative; width: 2.33em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.87em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-1809" style="font-family: MathJax_Math-italic;">H<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.814em;"><span class="texatom" id="MathJax-Span-1810"><span class="mrow" id="MathJax-Span-1811"><span class="mi" id="MathJax-Span-1812" style="font-size: 70.7%; font-family: MathJax_Math-italic;">m</span><span class="mi" id="MathJax-Span-1813" style="font-size: 70.7%; font-family: MathJax_Math-italic;">a</span><span class="mi" id="MathJax-Span-1814" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-1815" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="msubsup" id="MathJax-Span-1816" style="padding-left: 0.219em;"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.54em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-1817" style="font-family: MathJax_Math-italic;">h</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.598em;"><span class="mn" id="MathJax-Span-1818" style="font-size: 70.7%; font-family: MathJax_Main;">0</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-1819" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-183">(H_{max} − h_0)</script>, any other path cannot finish earlier. Hence the greedy check is both necessary and sufficient.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
  cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">while</span><span class="pun">(</span><span class="pln">t</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">,</span><span class="pln">p</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n </span><span class="pun">&gt;&gt;</span><span class="pln"> p</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">];</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">i</span><span class="pun">++)</span><span class="pln"> cin </span><span class="pun">&gt;&gt;</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> cur </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">p</span><span class="pun">];</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> dist </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">p</span><span class="pun">];</span><span class="pln">
    sort</span><span class="pun">(</span><span class="pln">a </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln">a </span><span class="pun">+</span><span class="pln"> n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">bool</span><span class="pln"> ans </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> cur</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">continue</span><span class="pun">;</span><span class="pln">
      </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">mdash</span><span class="pun">;</span><span class="pln"> cur </span><span class="pun">&gt;</span><span class="pln"> dist</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        ans </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
      </span><span class="pun">}</span><span class="pln">
      cur </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">ans</span><span class="pun">)</span><span class="pln"> cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"YES"</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> endl</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">else</span><span class="pln"> cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"NO"</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> endl</span><span class="pun">;</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2126/problem/D" title="Codeforces Round 1037 (Div. 3)">2126D - This Is the Last Time</a></p><p>Idea: <a class="rated-user user-orange" href="https://codeforces.com/profile/soullless" title="Master soullless">soullless</a></p> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2126/problem/D" title="Codeforces Round 1037 (Div. 3)">2126D - This Is the Last Time</a></h3><div class="ttypography"><div class="problem-statement"><div><p>Core insight The process is monotone non-decreasing: coins never drop after a visit (<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-184-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1820" style="width: 5.252em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.953em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1003.95em, 2.492em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1821"><span class="mi" id="MathJax-Span-1822" style="font-family: MathJax_Math-italic;">r</span><span class="mi" id="MathJax-Span-1823" style="font-family: MathJax_Math-italic;">e</span><span class="mi" id="MathJax-Span-1824" style="font-family: MathJax_Math-italic;">a</span><span class="msubsup" id="MathJax-Span-1825"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.27em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-1826" style="font-family: MathJax_Math-italic;">l</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.327em;"><span class="mi" id="MathJax-Span-1827" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-1828" style="font-family: MathJax_Main; padding-left: 0.273em;">≥</span><span class="msubsup" id="MathJax-Span-1829" style="padding-left: 0.273em;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.27em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-1830" style="font-family: MathJax_Math-italic;">l</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.327em;"><span class="mi" id="MathJax-Span-1831" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-184">real_i ≥ l_i</script>). Hence we can repeatedly grab any casino whose interval currently covers <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-185-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1832" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.436em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.44em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1833"><span class="mi" id="MathJax-Span-1834" style="font-family: MathJax_Math-italic;">c</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-185">c</script>; doing so can only enlarge the set of playable casinos.</p><p>To obtain the best final value, whenever multiple casinos are currently available, choose the one with the largest <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-186-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1835" style="width: 7.903em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.955em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1005.9em, 2.492em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1836"><span class="mi" id="MathJax-Span-1837" style="font-family: MathJax_Math-italic;">r</span><span class="mi" id="MathJax-Span-1838" style="font-family: MathJax_Math-italic;">e</span><span class="mi" id="MathJax-Span-1839" style="font-family: MathJax_Math-italic;">a</span><span class="msubsup" id="MathJax-Span-1840"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.27em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-1841" style="font-family: MathJax_Math-italic;">l</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.327em;"><span class="mi" id="MathJax-Span-1842" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-1843" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mo" id="MathJax-Span-1844" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mo" id="MathJax-Span-1845" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mi" id="MathJax-Span-1846" style="font-family: MathJax_Math-italic; padding-left: 0.219em;">i</span><span class="mi" id="MathJax-Span-1847" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-186">real_i --- it</script> gives the greatest immediate boost and cannot harm future options.</p><p>Greedy algorithm with a heap</p><p>1. Sort casinos by <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-187-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1848" style="width: 0.814em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.6em, 2.438em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1849"><span class="msubsup" id="MathJax-Span-1850"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.27em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-1851" style="font-family: MathJax_Math-italic;">l</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.327em;"><span class="mi" id="MathJax-Span-1852" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-187">l_i</script> asc.</p><p>2. Maintain an index ptr over the sorted list and a max-heap (priority queue) keyed by <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-188-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1853" style="width: 2.708em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.059em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1002.06em, 2.438em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1854"><span class="mi" id="MathJax-Span-1855" style="font-family: MathJax_Math-italic;">r</span><span class="mi" id="MathJax-Span-1856" style="font-family: MathJax_Math-italic;">e</span><span class="mi" id="MathJax-Span-1857" style="font-family: MathJax_Math-italic;">a</span><span class="msubsup" id="MathJax-Span-1858"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.27em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-1859" style="font-family: MathJax_Math-italic;">l</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.327em;"><span class="mi" id="MathJax-Span-1860" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-188">real_i</script>.</p><p>3. Let <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-189-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1861" style="width: 4.386em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.304em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1003.3em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1862"><span class="mi" id="MathJax-Span-1863" style="font-family: MathJax_Math-italic;">c</span><span class="mi" id="MathJax-Span-1864" style="font-family: MathJax_Math-italic;">u</span><span class="mi" id="MathJax-Span-1865" style="font-family: MathJax_Math-italic;">r</span><span class="mo" id="MathJax-Span-1866" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mi" id="MathJax-Span-1867" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">k</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-189">cur = k</script>.</p><p>4. Loop</p><p>- Push into the heap every casino with <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-190-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1868" style="width: 4.44em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.358em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1003.36em, 2.492em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1869"><span class="msubsup" id="MathJax-Span-1870"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.27em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-1871" style="font-family: MathJax_Math-italic;">l</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.327em;"><span class="mi" id="MathJax-Span-1872" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-1873" style="font-family: MathJax_Main; padding-left: 0.273em;">≤</span><span class="mi" id="MathJax-Span-1874" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">c</span><span class="mi" id="MathJax-Span-1875" style="font-family: MathJax_Math-italic;">u</span><span class="mi" id="MathJax-Span-1876" style="font-family: MathJax_Math-italic;">r</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-190">l_i ≤ cur</script> (advance ptr while that holds).</p><p>- Pop from the heap until you find one with <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-191-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1877" style="width: 4.656em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.52em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1003.52em, 2.492em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1878"><span class="mi" id="MathJax-Span-1879" style="font-family: MathJax_Math-italic;">c</span><span class="mi" id="MathJax-Span-1880" style="font-family: MathJax_Math-italic;">u</span><span class="mi" id="MathJax-Span-1881" style="font-family: MathJax_Math-italic;">r</span><span class="mo" id="MathJax-Span-1882" style="font-family: MathJax_Main; padding-left: 0.273em;">≤</span><span class="msubsup" id="MathJax-Span-1883" style="padding-left: 0.273em;"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-1884" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-1885" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 1.218em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-191">cur ≤ r_i</script> (still covers current coins).</p><p>- If none exists ⇒ no more moves, stop.</p><p>- Otherwise set cur = <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-192-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1886" style="width: 2.708em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.059em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1002.06em, 2.438em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1887"><span class="mi" id="MathJax-Span-1888" style="font-family: MathJax_Math-italic;">r</span><span class="mi" id="MathJax-Span-1889" style="font-family: MathJax_Math-italic;">e</span><span class="mi" id="MathJax-Span-1890" style="font-family: MathJax_Math-italic;">a</span><span class="msubsup" id="MathJax-Span-1891"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.27em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-1892" style="font-family: MathJax_Math-italic;">l</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.327em;"><span class="mi" id="MathJax-Span-1893" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-192">real_i</script> and continue.</p><p>5. Output cur.</p><p>Because each casino enters the heap once and leaves once, the complexity is <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-193-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1894" style="width: 5.306em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.007em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1003.9em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1895"><span class="mi" id="MathJax-Span-1896" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-1897" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1898" style="font-family: MathJax_Math-italic;">n</span><span class="mi" id="MathJax-Span-1899" style="font-family: MathJax_Math-italic;">l</span><span class="mi" id="MathJax-Span-1900" style="font-family: MathJax_Math-italic;">o</span><span class="mi" id="MathJax-Span-1901" style="font-family: MathJax_Math-italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-1902" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-1903" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-193">O(n log n)</script> per test case, <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-194-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1904" style="width: 2.871em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.167em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1002.06em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1905"><span class="mi" id="MathJax-Span-1906" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-1907" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1908" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-1909" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-194">O(n)</script> memory</p><p>Correctness sketch Choice of maximal <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-195-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1910" style="width: 2.708em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.059em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1002.06em, 2.438em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1911"><span class="mi" id="MathJax-Span-1912" style="font-family: MathJax_Math-italic;">r</span><span class="mi" id="MathJax-Span-1913" style="font-family: MathJax_Math-italic;">e</span><span class="mi" id="MathJax-Span-1914" style="font-family: MathJax_Math-italic;">a</span><span class="msubsup" id="MathJax-Span-1915"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.27em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-1916" style="font-family: MathJax_Math-italic;">l</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.327em;"><span class="mi" id="MathJax-Span-1917" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-195">real_i</script>: suppose we pick a smaller real. The larger one remains playable now (it covers cur) and yields <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-196-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1918" style="width: 7.524em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.685em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1005.63em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1919"><span class="mi" id="MathJax-Span-1920" style="font-family: MathJax_Math-italic;">a</span><span class="mo" id="MathJax-Span-1921" style="font-family: MathJax_Main; padding-left: 0.273em;">≥</span><span class="mo" id="MathJax-Span-1922"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mi" id="MathJax-Span-1923" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">i</span><span class="mi" id="MathJax-Span-1924" style="font-family: MathJax_Math-italic;">n</span><span class="mi" id="MathJax-Span-1925" style="font-family: MathJax_Math-italic;">c</span><span class="mi" id="MathJax-Span-1926" style="font-family: MathJax_Math-italic;">r</span><span class="mi" id="MathJax-Span-1927" style="font-family: MathJax_Math-italic;">e</span><span class="mi" id="MathJax-Span-1928" style="font-family: MathJax_Math-italic;">a</span><span class="mi" id="MathJax-Span-1929" style="font-family: MathJax_Math-italic;">s</span><span class="mi" id="MathJax-Span-1930" style="font-family: MathJax_Math-italic;">e</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-196">a ≥ increase</script>, so delaying it cannot enlarge the reachable set; taking it immediately is never worse.</p><p>The heap loop simulates exactly the greedy sequence above, terminating only when no playable casino remains — then cur is provably maximal.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
  cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">while</span><span class="pun">(</span><span class="pln">t</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">,</span><span class="pln">k</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n </span><span class="pun">&gt;&gt;</span><span class="pln"> k</span><span class="pun">;</span><span class="pln">
    pair </span><span class="pun">&lt;</span><span class="kwd">int</span><span class="pun">,</span><span class="pln">pair </span><span class="pun">&lt;</span><span class="kwd">int</span><span class="pun">,</span><span class="kwd">int</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> p</span><span class="pun">[</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">];</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">i</span><span class="pun">++)</span><span class="pln"> cin </span><span class="pun">&gt;&gt;</span><span class="pln"> p</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">first </span><span class="pun">&gt;&gt;</span><span class="pln"> p</span><span class="pun">[ы</span><span class="pln">i</span><span class="pun">].</span><span class="pln">second</span><span class="pun">.</span><span class="pln">first </span><span class="pun">&gt;&gt;</span><span class="pln"> p</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">second</span><span class="pun">.</span><span class="pln">second</span><span class="pun">;</span><span class="pln">
    sort</span><span class="pun">(</span><span class="pln">p </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln">p </span><span class="pun">+</span><span class="pln"> n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> cur </span><span class="pun">=</span><span class="pln"> k</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">p</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">first </span><span class="pun">&gt;</span><span class="pln"> cur</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
      cur </span><span class="pun">=</span><span class="pln"> max</span><span class="pun">(</span><span class="pln">cur</span><span class="pun">,</span><span class="pln">p</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">second</span><span class="pun">.</span><span class="pln">second</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    cout </span><span class="pun">&lt;&lt;</span><span class="pln"> cur </span><span class="pun">&lt;&lt;</span><span class="pln"> endl</span><span class="pun">;</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2126/problem/E" title="Codeforces Round 1037 (Div. 3)">2126E - G-C-D, Unlucky!</a></p><p>Idea: <a class="rated-user user-blue" href="https://codeforces.com/profile/Away_in_the_heavens" title="Expert Away_in_the_heavens">Away_in_the_heavens</a></p> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2126/problem/E" title="Codeforces Round 1037 (Div. 3)">2126E - G-C-D, Unlucky!</a></h3><div class="ttypography"><div class="problem-statement"><div><p>Problem. We are given two integer arrays <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-197-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1931" style="width: 4.873em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.682em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1003.57em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1932"><span class="mi" id="MathJax-Span-1933" style="font-family: MathJax_Math-italic;">p</span><span class="mo" id="MathJax-Span-1934" style="font-family: MathJax_Main;">[</span><span class="mn" id="MathJax-Span-1935" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-1936" style="font-family: MathJax_Main; padding-left: 0.165em;">…</span><span class="mi" id="MathJax-Span-1937" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">n</span><span class="mo" id="MathJax-Span-1938" style="font-family: MathJax_Main;">]</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-197">p[1 … n]</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-198-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1939" style="width: 4.819em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.628em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1003.52em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1940"><span class="mi" id="MathJax-Span-1941" style="font-family: MathJax_Math-italic;">s</span><span class="mo" id="MathJax-Span-1942" style="font-family: MathJax_Main;">[</span><span class="mn" id="MathJax-Span-1943" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-1944" style="font-family: MathJax_Main; padding-left: 0.165em;">…</span><span class="mi" id="MathJax-Span-1945" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">n</span><span class="mo" id="MathJax-Span-1946" style="font-family: MathJax_Main;">]</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-198">s[1 … n]</script>. They are alleged to be the prefix-GCDs and suffix-GCDs of some hidden array <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-199-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1947" style="width: 4.873em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.682em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1003.57em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1948"><span class="mi" id="MathJax-Span-1949" style="font-family: MathJax_Math-italic;">a</span><span class="mo" id="MathJax-Span-1950" style="font-family: MathJax_Main;">[</span><span class="mn" id="MathJax-Span-1951" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-1952" style="font-family: MathJax_Main; padding-left: 0.165em;">…</span><span class="mi" id="MathJax-Span-1953" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">n</span><span class="mo" id="MathJax-Span-1954" style="font-family: MathJax_Main;">]</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-199">a[1 … n]</script>:</p><p> <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-200-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1955" style="width: 1.085em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.81em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1956"><span class="msubsup" id="MathJax-Span-1957"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-1958" style="font-family: MathJax_Math-italic;">p</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.49em;"><span class="mi" id="MathJax-Span-1959" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-200">p_i</script> = <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-201-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1960" style="width: 8.282em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.28em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1006.17em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1961"><span class="mi" id="MathJax-Span-1962" style="font-family: MathJax_Math-italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-1963" style="font-family: MathJax_Math-italic;">c</span><span class="mi" id="MathJax-Span-1964" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-1965" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-1966"><span style="display: inline-block; position: relative; width: 0.977em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-1967" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mn" id="MathJax-Span-1968" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-1969" style="font-family: MathJax_Main;">,</span><span class="mo" id="MathJax-Span-1970" style="font-family: MathJax_Main; padding-left: 0.165em;">.</span><span class="mo" id="MathJax-Span-1971" style="font-family: MathJax_Main; padding-left: 0.165em;">.</span><span class="mo" id="MathJax-Span-1972" style="font-family: MathJax_Main; padding-left: 0.165em;">.</span><span class="mo" id="MathJax-Span-1973" style="font-family: MathJax_Main; padding-left: 0.165em;">,</span><span class="msubsup" id="MathJax-Span-1974" style="padding-left: 0.165em;"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-1975" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-1976" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-1977" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-201">gcd(a_1,...,a_i)</script>, <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-202-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1978" style="width: 1.085em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.81em, 2.438em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1979"><span class="msubsup" id="MathJax-Span-1980"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-1981" style="font-family: MathJax_Math-italic;">s</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.49em;"><span class="mi" id="MathJax-Span-1982" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 0.932em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-202">s_i</script> = <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-203-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1983" style="width: 8.39em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.334em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1006.23em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1984"><span class="mi" id="MathJax-Span-1985" style="font-family: MathJax_Math-italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-1986" style="font-family: MathJax_Math-italic;">c</span><span class="mi" id="MathJax-Span-1987" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-1988" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-1989"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-1990" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-1991" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-1992" style="font-family: MathJax_Main;">,</span><span class="mo" id="MathJax-Span-1993" style="font-family: MathJax_Main; padding-left: 0.165em;">.</span><span class="mo" id="MathJax-Span-1994" style="font-family: MathJax_Main; padding-left: 0.165em;">.</span><span class="mo" id="MathJax-Span-1995" style="font-family: MathJax_Main; padding-left: 0.165em;">.</span><span class="mo" id="MathJax-Span-1996" style="font-family: MathJax_Main; padding-left: 0.165em;">,</span><span class="msubsup" id="MathJax-Span-1997" style="padding-left: 0.165em;"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-1998" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-1999" style="font-size: 70.7%; font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-2000" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-203">gcd(a_i,...,a_n)</script>.</p><p>Decide whether such an array a exists.</p><p>Step 1. Immediate divisibility checks. For any prefix GCD chain one always has <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-204-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2001" style="width: 1.085em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.81em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2002"><span class="msubsup" id="MathJax-Span-2003"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2004" style="font-family: MathJax_Math-italic;">p</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.49em;"><span class="mi" id="MathJax-Span-2005" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-204">p_i</script> | <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-205-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2006" style="width: 2.33em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.734em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1001.73em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2007"><span class="msubsup" id="MathJax-Span-2008"><span style="display: inline-block; position: relative; width: 1.734em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2009" style="font-family: MathJax_Math-italic;">p</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.49em;"><span class="texatom" id="MathJax-Span-2010"><span class="mrow" id="MathJax-Span-2011"><span class="mi" id="MathJax-Span-2012" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-2013" style="font-size: 70.7%; font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-2014" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-205">p_{i - 1}</script> (moving right never introduces new prime factors). Likewise, for the suffix chain <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-206-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2015" style="width: 4.494em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.412em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1003.41em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2016"><span class="msubsup" id="MathJax-Span-2017"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2018" style="font-family: MathJax_Math-italic;">s</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.49em;"><span class="mi" id="MathJax-Span-2019" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-2020"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="texatom" id="MathJax-Span-2021" style="padding-left: 0.165em;"><span class="mrow" id="MathJax-Span-2022"><span class="mo" id="MathJax-Span-2023" style="font-family: MathJax_Main;">|</span></span></span><span class="mo" id="MathJax-Span-2024"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="msubsup" id="MathJax-Span-2025" style="padding-left: 0.165em;"><span style="display: inline-block; position: relative; width: 1.68em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2026" style="font-family: MathJax_Math-italic;">s</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.49em;"><span class="texatom" id="MathJax-Span-2027"><span class="mrow" id="MathJax-Span-2028"><span class="mi" id="MathJax-Span-2029" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-2030" style="font-size: 70.7%; font-family: MathJax_Main;">+</span><span class="mn" id="MathJax-Span-2031" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.504em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-206">s_i | s_{i+1}</script>. So we must have</p><p> <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-207-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2032" style="width: 2.33em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.734em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1001.73em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2033"><span class="msubsup" id="MathJax-Span-2034"><span style="display: inline-block; position: relative; width: 1.734em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2035" style="font-family: MathJax_Math-italic;">p</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.49em;"><span class="texatom" id="MathJax-Span-2036"><span class="mrow" id="MathJax-Span-2037"><span class="mi" id="MathJax-Span-2038" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-2039" style="font-size: 70.7%; font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-2040" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-207">p_{i-1}</script> mod <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-208-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2041" style="width: 3.52em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.654em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1002.6em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2042"><span class="msubsup" id="MathJax-Span-2043"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2044" style="font-family: MathJax_Math-italic;">p</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.49em;"><span class="mi" id="MathJax-Span-2045" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-2046" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mn" id="MathJax-Span-2047" style="font-family: MathJax_Main; padding-left: 0.273em;">0</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-208">p_i = 0</script> for every <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-209-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2048" style="width: 3.033em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.275em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1002.22em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2049"><span class="mi" id="MathJax-Span-2050" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-2051"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mo" id="MathJax-Span-2052" style="font-family: MathJax_Main; padding-left: 0.165em;">≥</span><span class="mo" id="MathJax-Span-2053"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mn" id="MathJax-Span-2054" style="font-family: MathJax_Main; padding-left: 0.165em;">2</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-209">i ≥ 2</script>, <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-210-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2055" style="width: 2.221em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.68em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1001.68em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2056"><span class="msubsup" id="MathJax-Span-2057"><span style="display: inline-block; position: relative; width: 1.68em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2058" style="font-family: MathJax_Math-italic;">s</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.49em;"><span class="texatom" id="MathJax-Span-2059"><span class="mrow" id="MathJax-Span-2060"><span class="mi" id="MathJax-Span-2061" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-2062" style="font-size: 70.7%; font-family: MathJax_Main;">+</span><span class="mn" id="MathJax-Span-2063" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-210">s_{i+1}</script> mod <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-211-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2064" style="width: 3.52em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.654em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1002.6em, 2.492em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2065"><span class="msubsup" id="MathJax-Span-2066"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2067" style="font-family: MathJax_Math-italic;">s</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.49em;"><span class="mi" id="MathJax-Span-2068" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-2069" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mn" id="MathJax-Span-2070" style="font-family: MathJax_Main; padding-left: 0.273em;">0</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 1.218em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-211">s_i = 0</script> for every <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-212-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2071" style="width: 5.685em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.278em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1004.22em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2072"><span class="mi" id="MathJax-Span-2073" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-2074"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mo" id="MathJax-Span-2075" style="font-family: MathJax_Main; padding-left: 0.165em;">≤</span><span class="mo" id="MathJax-Span-2076"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mi" id="MathJax-Span-2077" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">n</span><span class="mo" id="MathJax-Span-2078"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mo" id="MathJax-Span-2079" style="font-family: MathJax_Main; padding-left: 0.165em;">−</span><span class="mo" id="MathJax-Span-2080"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mn" id="MathJax-Span-2081" style="font-family: MathJax_Main; padding-left: 0.165em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-212">i ≤ n − 1</script>.</p><p>Both chains describe the GCD of the entire array when they meet in the middle, therefore <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-213-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2082" style="width: 1.356em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1001.03em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2083"><span class="msubsup" id="MathJax-Span-2084"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2085" style="font-family: MathJax_Math-italic;">p</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.49em;"><span class="mi" id="MathJax-Span-2086" style="font-size: 70.7%; font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-213">p_n</script> must equal <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-214-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2087" style="width: 1.247em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.92em, 2.438em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2088"><span class="msubsup" id="MathJax-Span-2089"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2090" style="font-family: MathJax_Math-italic;">s</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.49em;"><span class="mn" id="MathJax-Span-2091" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 0.932em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-214">s_1</script>. Denote that common value by <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-215-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2092" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.49em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2093"><span class="mi" id="MathJax-Span-2094" style="font-family: MathJax_Math-italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-215">g</script>. If any of these conditions fails, the answer is immediately "NO".</p><p>Step 2. Factor <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-216-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2095" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.49em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2096"><span class="mi" id="MathJax-Span-2097" style="font-family: MathJax_Math-italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-216">g</script> out. Write <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-217-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2098" style="width: 4.332em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.249em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.139em, 1003.25em, 2.817em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2099"><span class="msubsup" id="MathJax-Span-2100"><span style="display: inline-block; position: relative; width: 0.977em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.76em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2101" style="font-family: MathJax_Math-italic;">P<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.111em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.652em;"><span class="mi" id="MathJax-Span-2102" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-2103" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mfrac" id="MathJax-Span-2104" style="padding-left: 0.273em;"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px; margin-right: 0.111em; margin-left: 0.111em;"><span style="position: absolute; clip: rect(3.52em, 1000.6em, 4.332em, -999.997em); top: -4.597em; left: 50%; margin-left: -0.268em;"><span class="msubsup" id="MathJax-Span-2105"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px;"><span style="position: absolute; clip: rect(3.52em, 1000.33em, 4.332em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2106" style="font-size: 70.7%; font-family: MathJax_Math-italic;">p</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.381em;"><span class="mi" id="MathJax-Span-2107" style="font-size: 50%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; clip: rect(3.52em, 1000.33em, 4.332em, -999.997em); top: -3.677em; left: 50%; margin-left: -0.16em;"><span class="mi" id="MathJax-Span-2108" style="font-size: 70.7%; font-family: MathJax_Math-italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; clip: rect(0.869em, 1000.71em, 1.247em, -999.997em); top: -1.296em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.706em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.085em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.711em; border-left: 0px solid; width: 0px; height: 2.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-217">P_i = \frac {p_i} {g} </script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-218-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2109" style="width: 4.223em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.195em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1003.2em, 2.817em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2110"><span class="msubsup" id="MathJax-Span-2111"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.65em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2112" style="font-family: MathJax_Math-italic;">S<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.598em;"><span class="mi" id="MathJax-Span-2113" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-2114" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mfrac" id="MathJax-Span-2115" style="padding-left: 0.273em;"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px; margin-right: 0.111em; margin-left: 0.111em;"><span style="position: absolute; clip: rect(3.52em, 1000.54em, 4.278em, -999.997em); top: -4.543em; left: 50%; margin-left: -0.268em;"><span class="msubsup" id="MathJax-Span-2116"><span style="display: inline-block; position: relative; width: 0.544em; height: 0px;"><span style="position: absolute; clip: rect(3.52em, 1000.27em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2117" style="font-size: 70.7%; font-family: MathJax_Math-italic;">s</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.893em; left: 0.327em;"><span class="mi" id="MathJax-Span-2118" style="font-size: 50%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; clip: rect(3.52em, 1000.33em, 4.332em, -999.997em); top: -3.677em; left: 50%; margin-left: -0.16em;"><span class="mi" id="MathJax-Span-2119" style="font-size: 70.7%; font-family: MathJax_Math-italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; clip: rect(0.869em, 1000.71em, 1.247em, -999.997em); top: -1.296em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.706em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.085em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.711em; border-left: 0px solid; width: 0px; height: 1.861em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-218">S_i = \frac {s_i} {g}</script>. From now on we only reason about the reduced chains <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-219-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2120" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.76em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2121"><span class="mi" id="MathJax-Span-2122" style="font-family: MathJax_Math-italic;">P<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.111em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-219">P</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-220-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2123" style="width: 0.869em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.652em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.65em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2124"><span class="mi" id="MathJax-Span-2125" style="font-family: MathJax_Math-italic;">S<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-220">S</script>; <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-221-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2126" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.49em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2127"><span class="mi" id="MathJax-Span-2128" style="font-family: MathJax_Math-italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-221">g</script> can be multiplied back into every <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-222-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2129" style="width: 1.139em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.87em, 2.438em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2130"><span class="msubsup" id="MathJax-Span-2131"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2132" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-2133" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 0.932em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-222">a_i</script> at the end.</p><p>Step 3. What must hold at a single position <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-223-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2134" style="width: 0.436em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.327em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1000.27em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2135"><span class="mi" id="MathJax-Span-2136" style="font-family: MathJax_Math-italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-223">i</script>. Suppose we already know <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-224-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2137" style="width: 13.531em; display: inline-block;"><span style="display: inline-block; position: relative; width: 10.23em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1010.23em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2138"><span class="mi" id="MathJax-Span-2139" style="font-family: MathJax_Math-italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-2140" style="font-family: MathJax_Math-italic;">c</span><span class="mi" id="MathJax-Span-2141" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-2142" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-2143"><span style="display: inline-block; position: relative; width: 0.977em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2144" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mn" id="MathJax-Span-2145" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-2146" style="font-family: MathJax_Main;">,</span><span class="mo" id="MathJax-Span-2147" style="font-family: MathJax_Main; padding-left: 0.165em;">…</span><span class="mo" id="MathJax-Span-2148" style="font-family: MathJax_Main; padding-left: 0.165em;">,</span><span class="msubsup" id="MathJax-Span-2149" style="padding-left: 0.165em;"><span style="display: inline-block; position: relative; width: 1.734em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2150" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="texatom" id="MathJax-Span-2151"><span class="mrow" id="MathJax-Span-2152"><span class="mi" id="MathJax-Span-2153" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-2154" style="font-size: 70.7%; font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-2155" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-2156" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-2157" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="msubsup" id="MathJax-Span-2158" style="padding-left: 0.273em;"><span style="display: inline-block; position: relative; width: 1.734em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2159" style="font-family: MathJax_Math-italic;">p</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.49em;"><span class="texatom" id="MathJax-Span-2160"><span class="mrow" id="MathJax-Span-2161"><span class="mi" id="MathJax-Span-2162" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-2163" style="font-size: 70.7%; font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-2164" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-224">gcd(a_1,…,a_{i-1}) = p_{i-1}</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-225-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2165" style="width: 13.531em; display: inline-block;"><span style="display: inline-block; position: relative; width: 10.23em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1010.23em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2166"><span class="mi" id="MathJax-Span-2167" style="font-family: MathJax_Math-italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-2168" style="font-family: MathJax_Math-italic;">c</span><span class="mi" id="MathJax-Span-2169" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-2170" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-2171"><span style="display: inline-block; position: relative; width: 1.734em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2172" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="texatom" id="MathJax-Span-2173"><span class="mrow" id="MathJax-Span-2174"><span class="mi" id="MathJax-Span-2175" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-2176" style="font-size: 70.7%; font-family: MathJax_Main;">+</span><span class="mn" id="MathJax-Span-2177" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-2178" style="font-family: MathJax_Main;">,</span><span class="mo" id="MathJax-Span-2179" style="font-family: MathJax_Main; padding-left: 0.165em;">…</span><span class="mo" id="MathJax-Span-2180" style="font-family: MathJax_Main; padding-left: 0.165em;">,</span><span class="msubsup" id="MathJax-Span-2181" style="padding-left: 0.165em;"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2182" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-2183" style="font-size: 70.7%; font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-2184" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-2185" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="msubsup" id="MathJax-Span-2186" style="padding-left: 0.273em;"><span style="display: inline-block; position: relative; width: 1.68em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2187" style="font-family: MathJax_Math-italic;">s</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.49em;"><span class="texatom" id="MathJax-Span-2188"><span class="mrow" id="MathJax-Span-2189"><span class="mi" id="MathJax-Span-2190" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-2191" style="font-size: 70.7%; font-family: MathJax_Main;">+</span><span class="mn" id="MathJax-Span-2192" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-225">gcd(a_{i+1},…,a_n) = s_{i+1}</script>. We must choose a positive integer <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-226-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2193" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.76em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2194"><span class="mi" id="MathJax-Span-2195" style="font-family: MathJax_Math-italic;">A</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-226">A</script> such that</p><p><span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-227-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2196" style="width: 9.581em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.254em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1007.25em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2197"><span class="mi" id="MathJax-Span-2198" style="font-family: MathJax_Math-italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-2199" style="font-family: MathJax_Math-italic;">c</span><span class="mi" id="MathJax-Span-2200" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-2201" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-2202"><span style="display: inline-block; position: relative; width: 1.734em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2203" style="font-family: MathJax_Math-italic;">p</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.49em;"><span class="texatom" id="MathJax-Span-2204"><span class="mrow" id="MathJax-Span-2205"><span class="mi" id="MathJax-Span-2206" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-2207" style="font-size: 70.7%; font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-2208" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-2209" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-2210" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">A</span><span class="mo" id="MathJax-Span-2211" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-2212" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="msubsup" id="MathJax-Span-2213" style="padding-left: 0.273em;"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2214" style="font-family: MathJax_Math-italic;">p</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.49em;"><span class="mi" id="MathJax-Span-2215" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-227">gcd(p_{i-1}, A) = p_i</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-228-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2216" style="width: 9.527em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.2em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1007.2em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2217"><span class="mi" id="MathJax-Span-2218" style="font-family: MathJax_Math-italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-2219" style="font-family: MathJax_Math-italic;">c</span><span class="mi" id="MathJax-Span-2220" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-2221" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-2222" style="font-family: MathJax_Math-italic;">A</span><span class="mo" id="MathJax-Span-2223" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-2224" style="padding-left: 0.165em;"><span style="display: inline-block; position: relative; width: 1.68em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2225" style="font-family: MathJax_Math-italic;">s</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.49em;"><span class="texatom" id="MathJax-Span-2226"><span class="mrow" id="MathJax-Span-2227"><span class="mi" id="MathJax-Span-2228" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-2229" style="font-size: 70.7%; font-family: MathJax_Main;">+</span><span class="mn" id="MathJax-Span-2230" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-2231" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-2232" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="msubsup" id="MathJax-Span-2233" style="padding-left: 0.273em;"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2234" style="font-family: MathJax_Math-italic;">s</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.49em;"><span class="mi" id="MathJax-Span-2235" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-228">gcd(A, s_{i+1}) = s_i</script>.</p><p>Divide by g everywhere and let</p><p> <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-229-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2236" style="width: 4.602em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.466em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.085em, 1003.47em, 2.817em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2237"><span class="mi" id="MathJax-Span-2238" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-2239" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mfrac" id="MathJax-Span-2240" style="padding-left: 0.273em;"><span style="display: inline-block; position: relative; width: 1.356em; height: 0px; margin-right: 0.111em; margin-left: 0.111em;"><span style="position: absolute; clip: rect(3.52em, 1001.25em, 4.386em, -999.997em); top: -4.597em; left: 50%; margin-left: -0.593em;"><span class="msubsup" id="MathJax-Span-2241"><span style="display: inline-block; position: relative; width: 1.247em; height: 0px;"><span style="position: absolute; clip: rect(3.52em, 1000.33em, 4.332em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2242" style="font-size: 70.7%; font-family: MathJax_Math-italic;">p</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.381em;"><span class="texatom" id="MathJax-Span-2243"><span class="mrow" id="MathJax-Span-2244"><span class="mi" id="MathJax-Span-2245" style="font-size: 50%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-2246" style="font-size: 50%; font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-2247" style="font-size: 50%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; clip: rect(3.52em, 1000.6em, 4.332em, -999.997em); top: -3.677em; left: 50%; margin-left: -0.268em;"><span class="msubsup" id="MathJax-Span-2248"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px;"><span style="position: absolute; clip: rect(3.52em, 1000.33em, 4.332em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2249" style="font-size: 70.7%; font-family: MathJax_Math-italic;">p</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.381em;"><span class="mi" id="MathJax-Span-2250" style="font-size: 50%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; clip: rect(0.869em, 1001.36em, 1.247em, -999.997em); top: -1.296em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.356em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.085em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.711em; border-left: 0px solid; width: 0px; height: 2.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-229">x = \frac {p_{i-1}} {p_i}</script> (an integer <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-230-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2251" style="width: 2.113em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.572em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1001.52em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2252"><span class="mo" id="MathJax-Span-2253" style="font-family: MathJax_Main;">≥</span><span class="mo" id="MathJax-Span-2254"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mn" id="MathJax-Span-2255" style="font-family: MathJax_Main; padding-left: 0.165em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-230">≥ 1</script>), <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-231-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2256" style="width: 4.44em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.358em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.139em, 1003.36em, 2.762em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2257"><span class="mi" id="MathJax-Span-2258" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-2259" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mfrac" id="MathJax-Span-2260" style="padding-left: 0.273em;"><span style="display: inline-block; position: relative; width: 1.301em; height: 0px; margin-right: 0.111em; margin-left: 0.111em;"><span style="position: absolute; clip: rect(3.52em, 1001.19em, 4.332em, -999.997em); top: -4.543em; left: 50%; margin-left: -0.593em;"><span class="msubsup" id="MathJax-Span-2261"><span style="display: inline-block; position: relative; width: 1.193em; height: 0px;"><span style="position: absolute; clip: rect(3.52em, 1000.27em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2262" style="font-size: 70.7%; font-family: MathJax_Math-italic;">s</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.893em; left: 0.327em;"><span class="texatom" id="MathJax-Span-2263"><span class="mrow" id="MathJax-Span-2264"><span class="mi" id="MathJax-Span-2265" style="font-size: 50%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-2266" style="font-size: 50%; font-family: MathJax_Main;">+</span><span class="mn" id="MathJax-Span-2267" style="font-size: 50%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; clip: rect(3.52em, 1000.54em, 4.278em, -999.997em); top: -3.677em; left: 50%; margin-left: -0.268em;"><span class="msubsup" id="MathJax-Span-2268"><span style="display: inline-block; position: relative; width: 0.544em; height: 0px;"><span style="position: absolute; clip: rect(3.52em, 1000.27em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2269" style="font-size: 70.7%; font-family: MathJax_Math-italic;">s</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.893em; left: 0.327em;"><span class="mi" id="MathJax-Span-2270" style="font-size: 50%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; clip: rect(0.869em, 1001.3em, 1.247em, -999.997em); top: -1.296em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.301em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.085em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.639em; border-left: 0px solid; width: 0px; height: 1.932em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-231">y = \frac {s_{i+1}} {s_i} </script> (also <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-232-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2271" style="width: 2.113em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.572em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1001.52em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2272"><span class="mo" id="MathJax-Span-2273" style="font-family: MathJax_Main;">≥</span><span class="mo" id="MathJax-Span-2274"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mn" id="MathJax-Span-2275" style="font-family: MathJax_Main; padding-left: 0.165em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-232">≥ 1</script>).</p><p>The two equations become</p><p> <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-233-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2276" style="width: 7.795em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.901em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.085em, 1005.85em, 2.817em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2277"><span class="mi" id="MathJax-Span-2278" style="font-family: MathJax_Math-italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-2279" style="font-family: MathJax_Math-italic;">c</span><span class="mi" id="MathJax-Span-2280" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-2281" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-2282" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-2283" style="font-family: MathJax_Main;">,</span><span class="mfrac" id="MathJax-Span-2284" style="padding-left: 0.165em;"><span style="display: inline-block; position: relative; width: 0.652em; height: 0px; margin-right: 0.111em; margin-left: 0.111em;"><span style="position: absolute; clip: rect(3.358em, 1000.49em, 4.169em, -999.997em); top: -4.435em; left: 50%; margin-left: -0.268em;"><span class="mi" id="MathJax-Span-2285" style="font-size: 70.7%; font-family: MathJax_Math-italic;">A</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; clip: rect(3.52em, 1000.33em, 4.332em, -999.997em); top: -3.677em; left: 50%; margin-left: -0.16em;"><span class="mi" id="MathJax-Span-2286" style="font-size: 70.7%; font-family: MathJax_Math-italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; clip: rect(0.869em, 1000.65em, 1.247em, -999.997em); top: -1.296em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.652em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.085em;"></span></span></span></span><span class="mo" id="MathJax-Span-2287" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-2288" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mn" id="MathJax-Span-2289" style="font-family: MathJax_Main; padding-left: 0.273em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.711em; border-left: 0px solid; width: 0px; height: 2.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-233">gcd(x, \frac {A} {g}) = 1</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-234-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2290" style="width: 7.741em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.847em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.085em, 1005.79em, 2.817em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2291"><span class="mi" id="MathJax-Span-2292" style="font-family: MathJax_Math-italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-2293" style="font-family: MathJax_Math-italic;">c</span><span class="mi" id="MathJax-Span-2294" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-2295" style="font-family: MathJax_Main;">(</span><span class="mfrac" id="MathJax-Span-2296"><span style="display: inline-block; position: relative; width: 0.652em; height: 0px; margin-right: 0.111em; margin-left: 0.111em;"><span style="position: absolute; clip: rect(3.358em, 1000.49em, 4.169em, -999.997em); top: -4.435em; left: 50%; margin-left: -0.268em;"><span class="mi" id="MathJax-Span-2297" style="font-size: 70.7%; font-family: MathJax_Math-italic;">A</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; clip: rect(3.52em, 1000.33em, 4.332em, -999.997em); top: -3.677em; left: 50%; margin-left: -0.16em;"><span class="mi" id="MathJax-Span-2298" style="font-size: 70.7%; font-family: MathJax_Math-italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; clip: rect(0.869em, 1000.65em, 1.247em, -999.997em); top: -1.296em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.652em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.085em;"></span></span></span></span><span class="mo" id="MathJax-Span-2299" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-2300" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-2301" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-2302" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mn" id="MathJax-Span-2303" style="font-family: MathJax_Main; padding-left: 0.273em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.711em; border-left: 0px solid; width: 0px; height: 2.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-234">gcd(\frac {A}{g}, y) = 1</script>, <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-235-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2304" style="width: 1.301em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.977em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.98em, 2.438em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2305"><span class="msubsup" id="MathJax-Span-2306"><span style="display: inline-block; position: relative; width: 0.977em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.76em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2307" style="font-family: MathJax_Math-italic;">P<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.111em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.652em;"><span class="mi" id="MathJax-Span-2308" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-235">P_i</script> divides <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-236-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2309" style="width: 1.139em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.031em, 1000.87em, 2.762em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2310"><span class="mfrac" id="MathJax-Span-2311"><span style="display: inline-block; position: relative; width: 0.652em; height: 0px; margin-right: 0.111em; margin-left: 0.111em;"><span style="position: absolute; clip: rect(3.358em, 1000.49em, 4.169em, -999.997em); top: -4.435em; left: 50%; margin-left: -0.268em;"><span class="mi" id="MathJax-Span-2312" style="font-size: 70.7%; font-family: MathJax_Math-italic;">A</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; clip: rect(3.52em, 1000.33em, 4.332em, -999.997em); top: -3.677em; left: 50%; margin-left: -0.16em;"><span class="mi" id="MathJax-Span-2313" style="font-size: 70.7%; font-family: MathJax_Math-italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; clip: rect(0.869em, 1000.65em, 1.247em, -999.997em); top: -1.296em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.652em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.085em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.711em; border-left: 0px solid; width: 0px; height: 2.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-236">\frac {A}{g}</script>, <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-237-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2314" style="width: 1.247em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.92em, 2.438em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2315"><span class="msubsup" id="MathJax-Span-2316"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.65em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2317" style="font-family: MathJax_Math-italic;">S<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.598em;"><span class="mi" id="MathJax-Span-2318" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-237">S_i</script> divides <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-238-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2319" style="width: 1.139em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.031em, 1000.87em, 2.762em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2320"><span class="mfrac" id="MathJax-Span-2321"><span style="display: inline-block; position: relative; width: 0.652em; height: 0px; margin-right: 0.111em; margin-left: 0.111em;"><span style="position: absolute; clip: rect(3.358em, 1000.49em, 4.169em, -999.997em); top: -4.435em; left: 50%; margin-left: -0.268em;"><span class="mi" id="MathJax-Span-2322" style="font-size: 70.7%; font-family: MathJax_Math-italic;">A</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; clip: rect(3.52em, 1000.33em, 4.332em, -999.997em); top: -3.677em; left: 50%; margin-left: -0.16em;"><span class="mi" id="MathJax-Span-2323" style="font-size: 70.7%; font-family: MathJax_Math-italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; clip: rect(0.869em, 1000.65em, 1.247em, -999.997em); top: -1.296em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.652em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.085em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.711em; border-left: 0px solid; width: 0px; height: 2.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-238">\frac {A} {g}</script>.</p><p>Set <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-239-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2324" style="width: 3.682em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.762em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.085em, 1002.76em, 2.817em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2325"><span class="mfrac" id="MathJax-Span-2326"><span style="display: inline-block; position: relative; width: 0.652em; height: 0px; margin-right: 0.111em; margin-left: 0.111em;"><span style="position: absolute; clip: rect(3.358em, 1000.49em, 4.169em, -999.997em); top: -4.435em; left: 50%; margin-left: -0.268em;"><span class="mi" id="MathJax-Span-2327" style="font-size: 70.7%; font-family: MathJax_Math-italic;">A</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; clip: rect(3.52em, 1000.33em, 4.332em, -999.997em); top: -3.677em; left: 50%; margin-left: -0.16em;"><span class="mi" id="MathJax-Span-2328" style="font-size: 70.7%; font-family: MathJax_Math-italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; clip: rect(0.869em, 1000.65em, 1.247em, -999.997em); top: -1.296em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.652em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.085em;"></span></span></span></span><span class="mo" id="MathJax-Span-2329" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mi" id="MathJax-Span-2330" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">u</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.711em; border-left: 0px solid; width: 0px; height: 2.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-239">\frac {A}{g} = u</script>. We need a <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-240-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2331" style="width: 0.814em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.6em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2332"><span class="mi" id="MathJax-Span-2333" style="font-family: MathJax_Math-italic;">u</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-240">u</script> that is a common multiple of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-241-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2334" style="width: 1.301em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.977em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.98em, 2.438em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2335"><span class="msubsup" id="MathJax-Span-2336"><span style="display: inline-block; position: relative; width: 0.977em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.76em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2337" style="font-family: MathJax_Math-italic;">P<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.111em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.652em;"><span class="mi" id="MathJax-Span-2338" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-241">P_i</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-242-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2339" style="width: 1.247em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.92em, 2.438em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2340"><span class="msubsup" id="MathJax-Span-2341"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.65em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2342" style="font-family: MathJax_Math-italic;">S<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.598em;"><span class="mi" id="MathJax-Span-2343" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-242">S_i</script> and is simultaneously coprime to both <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-243-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2344" style="width: 0.814em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.54em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2345"><span class="mi" id="MathJax-Span-2346" style="font-family: MathJax_Math-italic;">x</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-243">x</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-244-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2347" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.49em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2348"><span class="mi" id="MathJax-Span-2349" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-244">y</script>.</p><p>Key arithmetic facts: <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-245-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2350" style="width: 1.301em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.977em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.98em, 2.438em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2351"><span class="msubsup" id="MathJax-Span-2352"><span style="display: inline-block; position: relative; width: 0.977em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.76em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2353" style="font-family: MathJax_Math-italic;">P<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.111em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.652em;"><span class="mi" id="MathJax-Span-2354" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-245">P_i</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-246-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2355" style="width: 0.814em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.54em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2356"><span class="mi" id="MathJax-Span-2357" style="font-family: MathJax_Math-italic;">x</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-246">x</script> are always coprime, because <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-247-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2358" style="width: 4.71em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.574em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(0.977em, 1003.57em, 2.817em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2359"><span class="mi" id="MathJax-Span-2360" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-2361" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mfrac" id="MathJax-Span-2362" style="padding-left: 0.273em;"><span style="display: inline-block; position: relative; width: 1.464em; height: 0px; margin-right: 0.111em; margin-left: 0.111em;"><span style="position: absolute; clip: rect(3.358em, 1001.3em, 4.332em, -999.997em); top: -4.543em; left: 50%; margin-left: -0.647em;"><span class="msubsup" id="MathJax-Span-2363"><span style="display: inline-block; position: relative; width: 1.301em; height: 0px;"><span style="position: absolute; clip: rect(3.358em, 1000.54em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2364" style="font-size: 70.7%; font-family: MathJax_Math-italic;">P<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.893em; left: 0.436em;"><span class="texatom" id="MathJax-Span-2365"><span class="mrow" id="MathJax-Span-2366"><span class="mi" id="MathJax-Span-2367" style="font-size: 50%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-2368" style="font-size: 50%; font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-2369" style="font-size: 50%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; clip: rect(3.358em, 1000.71em, 4.278em, -999.997em); top: -3.623em; left: 50%; margin-left: -0.322em;"><span class="msubsup" id="MathJax-Span-2370"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px;"><span style="position: absolute; clip: rect(3.358em, 1000.54em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2371" style="font-size: 70.7%; font-family: MathJax_Math-italic;">P<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.893em; left: 0.436em;"><span class="mi" id="MathJax-Span-2372" style="font-size: 50%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; clip: rect(0.869em, 1001.46em, 1.247em, -999.997em); top: -1.296em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.464em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.085em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.711em; border-left: 0px solid; width: 0px; height: 2.218em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-247">x = \frac {P_{i-1}} {P_i}</script> and no prime can divide both a number and its own quotient. Symmetrically, <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-248-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2373" style="width: 1.247em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.92em, 2.438em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2374"><span class="msubsup" id="MathJax-Span-2375"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.65em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2376" style="font-family: MathJax_Math-italic;">S<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.598em;"><span class="mi" id="MathJax-Span-2377" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-248">S_i</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-249-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2378" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.49em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2379"><span class="mi" id="MathJax-Span-2380" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-249">y</script> are coprime.</p><p>Therefore <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-250-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2381" style="width: 6.496em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.927em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1004.93em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2382"><span class="mi" id="MathJax-Span-2383" style="font-family: MathJax_Math-italic;">u</span><span class="mo" id="MathJax-Span-2384" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="msubsup" id="MathJax-Span-2385" style="padding-left: 0.273em;"><span style="display: inline-block; position: relative; width: 0.977em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.76em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2386" style="font-family: MathJax_Math-italic;">P<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.111em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.652em;"><span class="mi" id="MathJax-Span-2387" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-2388"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mo" id="MathJax-Span-2389" style="font-family: MathJax_Main; padding-left: 0.165em;">∗</span><span class="mo" id="MathJax-Span-2390"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="msubsup" id="MathJax-Span-2391" style="padding-left: 0.165em;"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.65em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2392" style="font-family: MathJax_Math-italic;">S<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.598em;"><span class="mi" id="MathJax-Span-2393" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-250">u = P_i * S_i</script> works iff</p><p><span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-251-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2394" style="width: 7.903em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.955em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1005.9em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2395"><span class="mi" id="MathJax-Span-2396" style="font-family: MathJax_Math-italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-2397" style="font-family: MathJax_Math-italic;">c</span><span class="mi" id="MathJax-Span-2398" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-2399" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-2400" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-2401" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-2402" style="padding-left: 0.165em;"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.65em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2403" style="font-family: MathJax_Math-italic;">S<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.598em;"><span class="mi" id="MathJax-Span-2404" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-2405" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-2406" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mn" id="MathJax-Span-2407" style="font-family: MathJax_Main; padding-left: 0.273em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-251">gcd(x, S_i) = 1</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-252-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2408" style="width: 7.903em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.955em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1005.9em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2409"><span class="mi" id="MathJax-Span-2410" style="font-family: MathJax_Math-italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-2411" style="font-family: MathJax_Math-italic;">c</span><span class="mi" id="MathJax-Span-2412" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-2413" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-2414" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-2415" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-2416" style="padding-left: 0.165em;"><span style="display: inline-block; position: relative; width: 0.977em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.76em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2417" style="font-family: MathJax_Math-italic;">P<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.111em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.652em;"><span class="mi" id="MathJax-Span-2418" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-2419" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-2420" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mn" id="MathJax-Span-2421" style="font-family: MathJax_Main; padding-left: 0.273em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-252">gcd(y, P_i) = 1</script>.</p><p>These two gcd tests are both necessary and sufficient; if they pass we can put <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-253-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2422" style="width: 9.04em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.821em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1006.82em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2423"><span class="msubsup" id="MathJax-Span-2424"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2425" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-2426" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-2427" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mi" id="MathJax-Span-2428" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-2429"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mo" id="MathJax-Span-2430" style="font-family: MathJax_Main; padding-left: 0.165em;">∗</span><span class="mo" id="MathJax-Span-2431"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="msubsup" id="MathJax-Span-2432" style="padding-left: 0.165em;"><span style="display: inline-block; position: relative; width: 0.977em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.76em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2433" style="font-family: MathJax_Math-italic;">P<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.111em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.652em;"><span class="mi" id="MathJax-Span-2434" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-2435"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mo" id="MathJax-Span-2436" style="font-family: MathJax_Main; padding-left: 0.165em;">∗</span><span class="mo" id="MathJax-Span-2437"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="msubsup" id="MathJax-Span-2438" style="padding-left: 0.165em;"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.65em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2439" style="font-family: MathJax_Math-italic;">S<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.598em;"><span class="mi" id="MathJax-Span-2440" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.504em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-253">a_i = g * P_i * S_i</script>.</p><p>Step 4. Global algorithm.</p><p>1. Verify the divisibility chains and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-254-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2441" style="width: 4.386em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.304em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.572em, 1003.3em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2442"><span class="msubsup" id="MathJax-Span-2443"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2444" style="font-family: MathJax_Math-italic;">p</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.49em;"><span class="mi" id="MathJax-Span-2445" style="font-size: 70.7%; font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-2446" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="msubsup" id="MathJax-Span-2447" style="padding-left: 0.273em;"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2448" style="font-family: MathJax_Math-italic;">s</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.49em;"><span class="mn" id="MathJax-Span-2449" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-254">p_n = s_1</script>; if something fails, print NO.</p><p>2. For every <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-255-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2450" style="width: 5.685em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.278em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1004.28em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2451"><span class="mi" id="MathJax-Span-2452" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-2453" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mn" id="MathJax-Span-2454" style="font-family: MathJax_Main; padding-left: 0.273em;">2</span><span class="mo" id="MathJax-Span-2455" style="font-family: MathJax_Main; padding-left: 0.165em;">…</span><span class="mi" id="MathJax-Span-2456" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">n</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-255">i = 2…n</script> check <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-256-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2457" style="width: 10.23em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.741em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.085em, 1007.69em, 2.817em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2458"><span class="mi" id="MathJax-Span-2459" style="font-family: MathJax_Math-italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-2460" style="font-family: MathJax_Math-italic;">c</span><span class="mi" id="MathJax-Span-2461" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-2462" style="font-family: MathJax_Main;">(</span><span class="mo" id="MathJax-Span-2463" style="font-family: MathJax_Main;">(</span><span class="mfrac" id="MathJax-Span-2464"><span style="display: inline-block; position: relative; width: 1.356em; height: 0px; margin-right: 0.111em; margin-left: 0.111em;"><span style="position: absolute; clip: rect(3.52em, 1001.25em, 4.386em, -999.997em); top: -4.597em; left: 50%; margin-left: -0.593em;"><span class="msubsup" id="MathJax-Span-2465"><span style="display: inline-block; position: relative; width: 1.247em; height: 0px;"><span style="position: absolute; clip: rect(3.52em, 1000.33em, 4.332em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2466" style="font-size: 70.7%; font-family: MathJax_Math-italic;">p</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.381em;"><span class="texatom" id="MathJax-Span-2467"><span class="mrow" id="MathJax-Span-2468"><span class="mi" id="MathJax-Span-2469" style="font-size: 50%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-2470" style="font-size: 50%; font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-2471" style="font-size: 50%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; clip: rect(3.52em, 1000.6em, 4.332em, -999.997em); top: -3.677em; left: 50%; margin-left: -0.268em;"><span class="msubsup" id="MathJax-Span-2472"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px;"><span style="position: absolute; clip: rect(3.52em, 1000.33em, 4.332em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2473" style="font-size: 70.7%; font-family: MathJax_Math-italic;">p</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.381em;"><span class="mi" id="MathJax-Span-2474" style="font-size: 50%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; clip: rect(0.869em, 1001.36em, 1.247em, -999.997em); top: -1.296em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.356em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.085em;"></span></span></span></span><span class="mo" id="MathJax-Span-2475" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-2476" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-2477" style="padding-left: 0.165em;"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.65em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2478" style="font-family: MathJax_Math-italic;">S<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.598em;"><span class="mi" id="MathJax-Span-2479" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-2480" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-2481" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mn" id="MathJax-Span-2482" style="font-family: MathJax_Main; padding-left: 0.273em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.711em; border-left: 0px solid; width: 0px; height: 2.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-256">gcd((\frac {p_{i-1}}{p_i}), S_i) = 1</script>.</p><p>3. For every <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-257-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2483" style="width: 7.957em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.009em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1005.96em, 2.438em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2484"><span class="mi" id="MathJax-Span-2485" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-2486" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mi" id="MathJax-Span-2487" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">n</span><span class="mo" id="MathJax-Span-2488" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mn" id="MathJax-Span-2489" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-2490" style="font-family: MathJax_Main; padding-left: 0.165em;">…</span><span class="mn" id="MathJax-Span-2491" style="font-family: MathJax_Main; padding-left: 0.165em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.211em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-257">i = n-1…1</script> check <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-258-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2492" style="width: 10.23em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.741em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.139em, 1007.69em, 2.762em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2493"><span class="mi" id="MathJax-Span-2494" style="font-family: MathJax_Math-italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-2495" style="font-family: MathJax_Math-italic;">c</span><span class="mi" id="MathJax-Span-2496" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-2497" style="font-family: MathJax_Main;">(</span><span class="mo" id="MathJax-Span-2498" style="font-family: MathJax_Main;">(</span><span class="mfrac" id="MathJax-Span-2499"><span style="display: inline-block; position: relative; width: 1.301em; height: 0px; margin-right: 0.111em; margin-left: 0.111em;"><span style="position: absolute; clip: rect(3.52em, 1001.19em, 4.332em, -999.997em); top: -4.543em; left: 50%; margin-left: -0.593em;"><span class="msubsup" id="MathJax-Span-2500"><span style="display: inline-block; position: relative; width: 1.193em; height: 0px;"><span style="position: absolute; clip: rect(3.52em, 1000.27em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2501" style="font-size: 70.7%; font-family: MathJax_Math-italic;">s</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.893em; left: 0.327em;"><span class="texatom" id="MathJax-Span-2502"><span class="mrow" id="MathJax-Span-2503"><span class="mi" id="MathJax-Span-2504" style="font-size: 50%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-2505" style="font-size: 50%; font-family: MathJax_Main;">+</span><span class="mn" id="MathJax-Span-2506" style="font-size: 50%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; clip: rect(3.52em, 1000.54em, 4.278em, -999.997em); top: -3.677em; left: 50%; margin-left: -0.268em;"><span class="msubsup" id="MathJax-Span-2507"><span style="display: inline-block; position: relative; width: 0.544em; height: 0px;"><span style="position: absolute; clip: rect(3.52em, 1000.27em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2508" style="font-size: 70.7%; font-family: MathJax_Math-italic;">s</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.893em; left: 0.327em;"><span class="mi" id="MathJax-Span-2509" style="font-size: 50%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; clip: rect(0.869em, 1001.3em, 1.247em, -999.997em); top: -1.296em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.301em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.085em;"></span></span></span></span><span class="mo" id="MathJax-Span-2510" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-2511" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-2512" style="padding-left: 0.165em;"><span style="display: inline-block; position: relative; width: 0.977em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.76em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2513" style="font-family: MathJax_Math-italic;">P<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.111em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.652em;"><span class="mi" id="MathJax-Span-2514" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-2515" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-2516" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mn" id="MathJax-Span-2517" style="font-family: MathJax_Main; padding-left: 0.273em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.639em; border-left: 0px solid; width: 0px; height: 1.932em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-258">gcd((\frac {s_{i+1}}{s_i}), P_i) = 1</script>. (All divisions are exact by the chain property.)</p><p>4. If every test passes, print YES; otherwise NO.</p><p>Step 5. Complexity. Each gcd call is logarithmic in the values involved; we make <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-259-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2518" style="width: 2.871em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.167em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1002.06em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2519"><span class="mi" id="MathJax-Span-2520" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-2521" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-2522" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-2523" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-259">O(n)</script> such calls and a constant number of simple passes over the arrays, so the total running time per test case is <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-260-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2524" style="width: 11.096em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.39em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1008.28em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2525"><span class="mi" id="MathJax-Span-2526" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-2527" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-2528" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-2529"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mi" id="MathJax-Span-2530" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">l</span><span class="mi" id="MathJax-Span-2531" style="font-family: MathJax_Math-italic;">o</span><span class="mi" id="MathJax-Span-2532" style="font-family: MathJax_Math-italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-2533"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mi" id="MathJax-Span-2534" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">m</span><span class="mi" id="MathJax-Span-2535" style="font-family: MathJax_Math-italic;">a</span><span class="mi" id="MathJax-Span-2536" style="font-family: MathJax_Math-italic;">x</span><span class="mi" id="MathJax-Span-2537" style="font-family: MathJax_Math-italic;">v</span><span class="mi" id="MathJax-Span-2538" style="font-family: MathJax_Math-italic;">a</span><span class="mi" id="MathJax-Span-2539" style="font-family: MathJax_Math-italic;">l</span><span class="mi" id="MathJax-Span-2540" style="font-family: MathJax_Math-italic;">u</span><span class="mi" id="MathJax-Span-2541" style="font-family: MathJax_Math-italic;">e</span><span class="mo" id="MathJax-Span-2542" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.504em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-260">O(n log maxvalue)</script> with <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-261-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2543" style="width: 2.708em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.059em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1001.95em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2544"><span class="mi" id="MathJax-Span-2545" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-2546" style="font-family: MathJax_Main;">(</span><span class="mn" id="MathJax-Span-2547" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-2548" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-261">O(1)</script> extra memory.</p><p>If the algorithm answers YES, one explicit witness array is <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-262-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2549" style="width: 9.04em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.821em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1006.82em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2550"><span class="msubsup" id="MathJax-Span-2551"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2552" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-2553" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-2554" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mi" id="MathJax-Span-2555" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-2556"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mo" id="MathJax-Span-2557" style="font-family: MathJax_Main; padding-left: 0.165em;">∗</span><span class="mo" id="MathJax-Span-2558"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="msubsup" id="MathJax-Span-2559" style="padding-left: 0.165em;"><span style="display: inline-block; position: relative; width: 0.977em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.76em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2560" style="font-family: MathJax_Math-italic;">P<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.111em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.652em;"><span class="mi" id="MathJax-Span-2561" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-2562"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mo" id="MathJax-Span-2563" style="font-family: MathJax_Main; padding-left: 0.165em;">∗</span><span class="mo" id="MathJax-Span-2564"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="msubsup" id="MathJax-Span-2565" style="padding-left: 0.165em;"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.65em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2566" style="font-family: MathJax_Math-italic;">S<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.598em;"><span class="mi" id="MathJax-Span-2567" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.504em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-262">a_i = g * P_i * S_i</script>.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">t</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
        cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">];</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            cin </span><span class="pun">&gt;&gt;</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">];</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            cin </span><span class="pun">&gt;&gt;</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> ans</span><span class="pun">[</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">];</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            ans</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> lcm</span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">],</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">bool</span><span class="pln"> ch </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">ans</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> a</span><span class="pun">[</span><span class="lit">1</span><span class="pun">])</span><span class="pln"> ch </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">ans</span><span class="pun">[</span><span class="pln">n</span><span class="pun">]</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">n</span><span class="pun">])</span><span class="pln"> ch </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">__gcd</span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i </span><span class="pun">&amp;</span><span class="pln">mdash</span><span class="pun">;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">],</span><span class="pln"> ans</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                ch </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> n </span><span class="pun">&amp;</span><span class="pln">mdash</span><span class="pun">;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">__gcd</span><span class="pun">(</span><span class="pln">b</span><span class="pun">[</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">],</span><span class="pln"> ans</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                ch </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">ch</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"YES"</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"\n"</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"NO"</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"\n"</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2126/problem/F" title="Codeforces Round 1037 (Div. 3)">2126F - 1-1-1, Free Tree!</a></p><p>Idea: <a class="rated-user user-orange" href="https://codeforces.com/profile/soullless" title="Master soullless">soullless</a></p> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2126/problem/F" title="Codeforces Round 1037 (Div. 3)">2126F - 1-1-1, Free Tree!</a></h3><div class="ttypography"><div class="problem-statement"><div><p>Root the tree at vertex <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-263-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2568" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2569"><span class="mn" id="MathJax-Span-2570" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-263">1</script>. During one <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-264-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2571" style="width: 3.033em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.275em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1002.27em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2572"><span class="mi" id="MathJax-Span-2573" style="font-family: MathJax_Math-italic;">D</span><span class="mi" id="MathJax-Span-2574" style="font-family: MathJax_Math-italic;">F<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.111em;"></span></span><span class="mi" id="MathJax-Span-2575" style="font-family: MathJax_Math-italic;">S<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-264">DFS</script> store, for every vertex <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-265-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2576" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.49em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2577"><span class="mi" id="MathJax-Span-2578" style="font-family: MathJax_Math-italic;">v</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-265">v</script>, its parent <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-266-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2579" style="width: 2.546em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.897em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1001.9em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2580"><span class="mi" id="MathJax-Span-2581" style="font-family: MathJax_Math-italic;">p</span><span class="mi" id="MathJax-Span-2582" style="font-family: MathJax_Math-italic;">a</span><span class="msubsup" id="MathJax-Span-2583"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2584" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-2585" style="font-size: 70.7%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-266">par_v</script> and the weight <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-267-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2586" style="width: 2.871em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.167em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1002.17em, 2.438em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2587"><span class="mi" id="MathJax-Span-2588" style="font-family: MathJax_Math-italic;">c</span><span class="mi" id="MathJax-Span-2589" style="font-family: MathJax_Math-italic;">o</span><span class="mi" id="MathJax-Span-2590" style="font-family: MathJax_Math-italic;">s</span><span class="msubsup" id="MathJax-Span-2591"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px;"><span style="position: absolute; clip: rect(3.195em, 1000.33em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2592" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.381em;"><span class="mi" id="MathJax-Span-2593" style="font-size: 70.7%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-267">cost_v</script> of the edge <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-268-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2594" style="width: 5.252em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.953em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1003.85em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2595"><span class="mo" id="MathJax-Span-2596" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-2597" style="font-family: MathJax_Math-italic;">p</span><span class="mi" id="MathJax-Span-2598" style="font-family: MathJax_Math-italic;">a</span><span class="msubsup" id="MathJax-Span-2599"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2600" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-2601" style="font-size: 70.7%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-2602" style="font-family: MathJax_Main;">,</span><span class="mo" id="MathJax-Span-2603" style="padding-left: 0.165em;"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mi" id="MathJax-Span-2604" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">v</span><span class="mo" id="MathJax-Span-2605" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.504em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-268">(par_v, v)</script>. While visiting a child <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-269-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2606" style="width: 0.814em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.6em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2607"><span class="mi" id="MathJax-Span-2608" style="font-family: MathJax_Math-italic;">u</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-269">u</script> of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-270-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2609" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.49em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2610"><span class="mi" id="MathJax-Span-2611" style="font-family: MathJax_Math-italic;">v</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-270">v</script>, also add <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-271-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2612" style="width: 3.033em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.275em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1002.27em, 2.438em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2613"><span class="mi" id="MathJax-Span-2614" style="font-family: MathJax_Math-italic;">c</span><span class="mi" id="MathJax-Span-2615" style="font-family: MathJax_Math-italic;">o</span><span class="mi" id="MathJax-Span-2616" style="font-family: MathJax_Math-italic;">s</span><span class="msubsup" id="MathJax-Span-2617"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.195em, 1000.33em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2618" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.381em;"><span class="mi" id="MathJax-Span-2619" style="font-size: 70.7%; font-family: MathJax_Math-italic;">u</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-271">cost_u</script> to a dictionary <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-272-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2620" style="width: 5.36em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.061em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1004.06em, 2.546em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2621"><span class="mi" id="MathJax-Span-2622" style="font-family: MathJax_Math-italic;">m</span><span class="mi" id="MathJax-Span-2623" style="font-family: MathJax_Math-italic;">e</span><span class="msubsup" id="MathJax-Span-2624"><span style="display: inline-block; position: relative; width: 2.708em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.87em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2625" style="font-family: MathJax_Math-italic;">m</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.869em;"><span class="texatom" id="MathJax-Span-2626"><span class="mrow" id="MathJax-Span-2627"><span class="msubsup" id="MathJax-Span-2628"><span style="display: inline-block; position: relative; width: 1.734em; height: 0px;"><span style="position: absolute; clip: rect(3.52em, 1000.33em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2629" style="font-size: 70.7%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.893em; left: 0.327em;"><span class="texatom" id="MathJax-Span-2630"><span class="mrow" id="MathJax-Span-2631"><span class="mi" id="MathJax-Span-2632" style="font-size: 50%; font-family: MathJax_Math-italic;">c</span><span class="mi" id="MathJax-Span-2633" style="font-size: 50%; font-family: MathJax_Math-italic;">o</span><span class="mi" id="MathJax-Span-2634" style="font-size: 50%; font-family: MathJax_Math-italic;">l</span><span class="mi" id="MathJax-Span-2635" style="font-size: 50%; font-family: MathJax_Math-italic;">o</span><span class="mi" id="MathJax-Span-2636" style="font-size: 50%; font-family: MathJax_Math-italic;">u</span><span class="mi" id="MathJax-Span-2637" style="font-size: 50%; font-family: MathJax_Math-italic;">r</span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-272">mem_{v_{colour}}</script> under key <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-273-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2638" style="width: 1.356em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1001.03em, 2.438em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2639"><span class="msubsup" id="MathJax-Span-2640"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2641" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-2642" style="font-size: 70.7%; font-family: MathJax_Math-italic;">u</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 0.932em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-273">a_u</script>; thus <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-274-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2643" style="width: 3.899em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.925em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1002.92em, 2.546em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2644"><span class="mi" id="MathJax-Span-2645" style="font-family: MathJax_Math-italic;">m</span><span class="mi" id="MathJax-Span-2646" style="font-family: MathJax_Math-italic;">e</span><span class="msubsup" id="MathJax-Span-2647"><span style="display: inline-block; position: relative; width: 1.572em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.87em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2648" style="font-family: MathJax_Math-italic;">m</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.869em;"><span class="texatom" id="MathJax-Span-2649"><span class="mrow" id="MathJax-Span-2650"><span class="msubsup" id="MathJax-Span-2651"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px;"><span style="position: absolute; clip: rect(3.52em, 1000.33em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2652" style="font-size: 70.7%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.893em; left: 0.327em;"><span class="mi" id="MathJax-Span-2653" style="font-size: 50%; font-family: MathJax_Math-italic;">c</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-274">mem_{v_c}</script> is the total weight of edges from <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-275-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2654" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.49em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2655"><span class="mi" id="MathJax-Span-2656" style="font-family: MathJax_Math-italic;">v</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-275">v</script> to children that currently have colour <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-276-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2657" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.436em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.44em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2658"><span class="mi" id="MathJax-Span-2659" style="font-family: MathJax_Math-italic;">c</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-276">c</script>. The <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-277-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2660" style="width: 3.033em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.275em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1002.27em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2661"><span class="mi" id="MathJax-Span-2662" style="font-family: MathJax_Math-italic;">D</span><span class="mi" id="MathJax-Span-2663" style="font-family: MathJax_Math-italic;">F<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.111em;"></span></span><span class="mi" id="MathJax-Span-2664" style="font-family: MathJax_Math-italic;">S<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-277">DFS</script> finishes in <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-278-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2665" style="width: 2.871em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.167em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1002.06em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2666"><span class="mi" id="MathJax-Span-2667" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-2668" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-2669" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-2670" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-278">O(n)</script>.</p><p>Compute the initial answer <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-279-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2671" style="width: 41.507em; display: inline-block;"><span style="display: inline-block; position: relative; width: 31.442em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1031.39em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2672"><span class="mi" id="MathJax-Span-2673" style="font-family: MathJax_Math-italic;">a</span><span class="mi" id="MathJax-Span-2674" style="font-family: MathJax_Math-italic;">n</span><span class="mi" id="MathJax-Span-2675" style="font-family: MathJax_Math-italic;">s</span><span class="mo" id="MathJax-Span-2676" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mo" id="MathJax-Span-2677" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mo" id="MathJax-Span-2678" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mi" id="MathJax-Span-2679" style="font-family: MathJax_Math-italic; padding-left: 0.219em;">t</span><span class="mi" id="MathJax-Span-2680" style="font-family: MathJax_Math-italic;">h</span><span class="mi" id="MathJax-Span-2681" style="font-family: MathJax_Math-italic;">e</span><span class="mi" id="MathJax-Span-2682" style="font-family: MathJax_Math-italic;">s</span><span class="mi" id="MathJax-Span-2683" style="font-family: MathJax_Math-italic;">u</span><span class="mi" id="MathJax-Span-2684" style="font-family: MathJax_Math-italic;">m</span><span class="mi" id="MathJax-Span-2685" style="font-family: MathJax_Math-italic;">o</span><span class="mi" id="MathJax-Span-2686" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span><span class="mi" id="MathJax-Span-2687" style="font-family: MathJax_Math-italic;">c</span><span class="mi" id="MathJax-Span-2688" style="font-family: MathJax_Math-italic;">o</span><span class="mi" id="MathJax-Span-2689" style="font-family: MathJax_Math-italic;">s</span><span class="mi" id="MathJax-Span-2690" style="font-family: MathJax_Math-italic;">t</span><span class="mi" id="MathJax-Span-2691" style="font-family: MathJax_Math-italic;">s</span><span class="mi" id="MathJax-Span-2692" style="font-family: MathJax_Math-italic;">o</span><span class="mi" id="MathJax-Span-2693" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span><span class="mi" id="MathJax-Span-2694" style="font-family: MathJax_Math-italic;">e</span><span class="mi" id="MathJax-Span-2695" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-2696" style="font-family: MathJax_Math-italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-2697" style="font-family: MathJax_Math-italic;">e</span><span class="mi" id="MathJax-Span-2698" style="font-family: MathJax_Math-italic;">s</span><span class="mi" id="MathJax-Span-2699" style="font-family: MathJax_Math-italic;">w</span><span class="mi" id="MathJax-Span-2700" style="font-family: MathJax_Math-italic;">h</span><span class="mi" id="MathJax-Span-2701" style="font-family: MathJax_Math-italic;">o</span><span class="mi" id="MathJax-Span-2702" style="font-family: MathJax_Math-italic;">s</span><span class="mi" id="MathJax-Span-2703" style="font-family: MathJax_Math-italic;">e</span><span class="mi" id="MathJax-Span-2704" style="font-family: MathJax_Math-italic;">e</span><span class="mi" id="MathJax-Span-2705" style="font-family: MathJax_Math-italic;">n</span><span class="mi" id="MathJax-Span-2706" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-2707" style="font-family: MathJax_Math-italic;">p</span><span class="mi" id="MathJax-Span-2708" style="font-family: MathJax_Math-italic;">o</span><span class="mi" id="MathJax-Span-2709" style="font-family: MathJax_Math-italic;">i</span><span class="mi" id="MathJax-Span-2710" style="font-family: MathJax_Math-italic;">n</span><span class="mi" id="MathJax-Span-2711" style="font-family: MathJax_Math-italic;">t</span><span class="mi" id="MathJax-Span-2712" style="font-family: MathJax_Math-italic;">s</span><span class="mi" id="MathJax-Span-2713" style="font-family: MathJax_Math-italic;">h</span><span class="mi" id="MathJax-Span-2714" style="font-family: MathJax_Math-italic;">a</span><span class="mi" id="MathJax-Span-2715" style="font-family: MathJax_Math-italic;">v</span><span class="mi" id="MathJax-Span-2716" style="font-family: MathJax_Math-italic;">e</span><span class="mi" id="MathJax-Span-2717" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-2718" style="font-family: MathJax_Math-italic;">i</span><span class="mi" id="MathJax-Span-2719" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span><span class="mi" id="MathJax-Span-2720" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span><span class="mi" id="MathJax-Span-2721" style="font-family: MathJax_Math-italic;">e</span><span class="mi" id="MathJax-Span-2722" style="font-family: MathJax_Math-italic;">r</span><span class="mi" id="MathJax-Span-2723" style="font-family: MathJax_Math-italic;">e</span><span class="mi" id="MathJax-Span-2724" style="font-family: MathJax_Math-italic;">n</span><span class="mi" id="MathJax-Span-2725" style="font-family: MathJax_Math-italic;">t</span><span class="mi" id="MathJax-Span-2726" style="font-family: MathJax_Math-italic;">c</span><span class="mi" id="MathJax-Span-2727" style="font-family: MathJax_Math-italic;">o</span><span class="mi" id="MathJax-Span-2728" style="font-family: MathJax_Math-italic;">l</span><span class="mi" id="MathJax-Span-2729" style="font-family: MathJax_Math-italic;">o</span><span class="mi" id="MathJax-Span-2730" style="font-family: MathJax_Math-italic;">u</span><span class="mi" id="MathJax-Span-2731" style="font-family: MathJax_Math-italic;">r</span><span class="mi" id="MathJax-Span-2732" style="font-family: MathJax_Math-italic;">s</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.361em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-279">ans --- the sum of costs of edges whose endpoints have different colours</script>. Walk over all vertices <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-280-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2733" style="width: 3.141em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.384em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1002.33em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2734"><span class="mi" id="MathJax-Span-2735" style="font-family: MathJax_Math-italic;">v</span><span class="mo" id="MathJax-Span-2736"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mo" id="MathJax-Span-2737" style="font-family: MathJax_Main; padding-left: 0.165em;">≠</span><span class="mo" id="MathJax-Span-2738"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mn" id="MathJax-Span-2739" style="font-family: MathJax_Main; padding-left: 0.165em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.504em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-280">v ≠ 1</script> and, if <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-281-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2740" style="width: 1.247em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.92em, 2.438em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2741"><span class="msubsup" id="MathJax-Span-2742"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2743" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-2744" style="font-size: 70.7%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 0.932em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-281">a_v</script> differs from <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-282-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2745" style="width: 2.6em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.951em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1001.95em, 2.546em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2746"><span class="msubsup" id="MathJax-Span-2747"><span style="display: inline-block; position: relative; width: 1.951em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2748" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="texatom" id="MathJax-Span-2749"><span class="mrow" id="MathJax-Span-2750"><span class="mi" id="MathJax-Span-2751" style="font-size: 70.7%; font-family: MathJax_Math-italic;">p</span><span class="mi" id="MathJax-Span-2752" style="font-size: 70.7%; font-family: MathJax_Math-italic;">a</span><span class="msubsup" id="MathJax-Span-2753"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px;"><span style="position: absolute; clip: rect(3.52em, 1000.33em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2754" style="font-size: 70.7%; font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.893em; left: 0.327em;"><span class="mi" id="MathJax-Span-2755" style="font-size: 50%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-282">a_{par_v}</script>, add <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-283-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2756" style="width: 2.871em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.167em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1002.17em, 2.438em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2757"><span class="mi" id="MathJax-Span-2758" style="font-family: MathJax_Math-italic;">c</span><span class="mi" id="MathJax-Span-2759" style="font-family: MathJax_Math-italic;">o</span><span class="mi" id="MathJax-Span-2760" style="font-family: MathJax_Math-italic;">s</span><span class="msubsup" id="MathJax-Span-2761"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px;"><span style="position: absolute; clip: rect(3.195em, 1000.33em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2762" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.381em;"><span class="mi" id="MathJax-Span-2763" style="font-size: 70.7%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-283">cost_v</script> to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-284-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2764" style="width: 2.167em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.626em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1001.57em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2765"><span class="mi" id="MathJax-Span-2766" style="font-family: MathJax_Math-italic;">a</span><span class="mi" id="MathJax-Span-2767" style="font-family: MathJax_Math-italic;">n</span><span class="mi" id="MathJax-Span-2768" style="font-family: MathJax_Math-italic;">s</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-284">ans</script>. This is <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-285-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2769" style="width: 2.871em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.167em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1002.06em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2770"><span class="mi" id="MathJax-Span-2771" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-2772" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-2773" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-2774" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-285">O(n)</script>.</p><p>A query gives a vertex <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-286-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2775" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.49em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2776"><span class="mi" id="MathJax-Span-2777" style="font-family: MathJax_Math-italic;">v</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-286">v</script> and a new colour <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-287-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2778" style="width: 0.814em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.54em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2779"><span class="mi" id="MathJax-Span-2780" style="font-family: MathJax_Math-italic;">x</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-287">x</script>. Let <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-288-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2781" style="width: 4.71em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.574em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1003.57em, 2.492em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2782"><span class="mi" id="MathJax-Span-2783" style="font-family: MathJax_Math-italic;">o</span><span class="mi" id="MathJax-Span-2784" style="font-family: MathJax_Math-italic;">l</span><span class="mi" id="MathJax-Span-2785" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-2786" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="msubsup" id="MathJax-Span-2787" style="padding-left: 0.273em;"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2788" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-2789" style="font-size: 70.7%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-288">old = a_v</script>. First handle the edges from <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-289-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2790" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.49em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2791"><span class="mi" id="MathJax-Span-2792" style="font-family: MathJax_Math-italic;">v</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-289">v</script> to its children. All those edges whose children had colour old were previously free; after the repaint they become paid, so add mem_{v_{old}} to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-290-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2793" style="width: 2.167em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.626em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1001.57em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2794"><span class="mi" id="MathJax-Span-2795" style="font-family: MathJax_Math-italic;">a</span><span class="mi" id="MathJax-Span-2796" style="font-family: MathJax_Math-italic;">n</span><span class="mi" id="MathJax-Span-2797" style="font-family: MathJax_Math-italic;">s</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-290">ans</script>. Conversely, the edges counted in <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-291-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2798" style="width: 3.953em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.979em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1002.98em, 2.546em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2799"><span class="mi" id="MathJax-Span-2800" style="font-family: MathJax_Math-italic;">m</span><span class="mi" id="MathJax-Span-2801" style="font-family: MathJax_Math-italic;">e</span><span class="msubsup" id="MathJax-Span-2802"><span style="display: inline-block; position: relative; width: 1.626em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.87em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2803" style="font-family: MathJax_Math-italic;">m</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.869em;"><span class="texatom" id="MathJax-Span-2804"><span class="mrow" id="MathJax-Span-2805"><span class="msubsup" id="MathJax-Span-2806"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px;"><span style="position: absolute; clip: rect(3.52em, 1000.33em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2807" style="font-size: 70.7%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.893em; left: 0.327em;"><span class="mi" id="MathJax-Span-2808" style="font-size: 50%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-291">mem_{v_x}</script> were previously paid and now become free, so subtract <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-292-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2809" style="width: 3.953em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.979em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1002.98em, 2.546em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2810"><span class="mi" id="MathJax-Span-2811" style="font-family: MathJax_Math-italic;">m</span><span class="mi" id="MathJax-Span-2812" style="font-family: MathJax_Math-italic;">e</span><span class="msubsup" id="MathJax-Span-2813"><span style="display: inline-block; position: relative; width: 1.626em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.87em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2814" style="font-family: MathJax_Math-italic;">m</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.869em;"><span class="texatom" id="MathJax-Span-2815"><span class="mrow" id="MathJax-Span-2816"><span class="msubsup" id="MathJax-Span-2817"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px;"><span style="position: absolute; clip: rect(3.52em, 1000.33em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2818" style="font-size: 70.7%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.893em; left: 0.327em;"><span class="mi" id="MathJax-Span-2819" style="font-size: 50%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-292">mem_{v_x}</script> from <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-293-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2820" style="width: 2.167em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.626em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1001.57em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2821"><span class="mi" id="MathJax-Span-2822" style="font-family: MathJax_Math-italic;">a</span><span class="mi" id="MathJax-Span-2823" style="font-family: MathJax_Math-italic;">n</span><span class="mi" id="MathJax-Span-2824" style="font-family: MathJax_Math-italic;">s</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-293">ans</script>.</p><p>Next handle the edge <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-294-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2825" style="width: 5.252em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.953em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1003.85em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2826"><span class="mo" id="MathJax-Span-2827" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-2828" style="font-family: MathJax_Math-italic;">p</span><span class="mi" id="MathJax-Span-2829" style="font-family: MathJax_Math-italic;">a</span><span class="msubsup" id="MathJax-Span-2830"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2831" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-2832" style="font-size: 70.7%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-2833" style="font-family: MathJax_Main;">,</span><span class="mo" id="MathJax-Span-2834" style="padding-left: 0.165em;"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mi" id="MathJax-Span-2835" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">v</span><span class="mo" id="MathJax-Span-2836" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.504em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-294">(par_v, v)</script> if <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-295-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2837" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.49em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2838"><span class="mi" id="MathJax-Span-2839" style="font-family: MathJax_Math-italic;">v</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-295">v</script> is not the root. Its weight <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-296-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2840" style="width: 5.522em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.169em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1004.17em, 2.492em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2841"><span class="mi" id="MathJax-Span-2842" style="font-family: MathJax_Math-italic;">w</span><span class="mo" id="MathJax-Span-2843" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mi" id="MathJax-Span-2844" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">c</span><span class="mi" id="MathJax-Span-2845" style="font-family: MathJax_Math-italic;">o</span><span class="mi" id="MathJax-Span-2846" style="font-family: MathJax_Math-italic;">s</span><span class="msubsup" id="MathJax-Span-2847"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px;"><span style="position: absolute; clip: rect(3.195em, 1000.33em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2848" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.381em;"><span class="mi" id="MathJax-Span-2849" style="font-size: 70.7%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-296">w = cost_v</script> was included in ans exactly when old differed from the parent's colour; if so, subtract <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-297-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2850" style="width: 0.923em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.71em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2851"><span class="mi" id="MathJax-Span-2852" style="font-family: MathJax_Math-italic;">w</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-297">w</script>. After the repaint the edge must be included exactly when <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-298-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2853" style="width: 0.814em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.54em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2854"><span class="mi" id="MathJax-Span-2855" style="font-family: MathJax_Math-italic;">x</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-298">x</script> differs from the parent's colour; if so, add <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-299-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2856" style="width: 0.923em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.71em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2857"><span class="mi" id="MathJax-Span-2858" style="font-family: MathJax_Math-italic;">w</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-299">w</script>. After that update the parent's dictionary: decrease <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-300-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2859" style="width: 5.739em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.332em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1004.33em, 2.708em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2860"><span class="mi" id="MathJax-Span-2861" style="font-family: MathJax_Math-italic;">m</span><span class="mi" id="MathJax-Span-2862" style="font-family: MathJax_Math-italic;">e</span><span class="msubsup" id="MathJax-Span-2863"><span style="display: inline-block; position: relative; width: 2.979em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.87em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2864" style="font-family: MathJax_Math-italic;">m</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.869em;"><span class="texatom" id="MathJax-Span-2865"><span class="mrow" id="MathJax-Span-2866"><span class="mi" id="MathJax-Span-2867" style="font-size: 70.7%; font-family: MathJax_Math-italic;">p</span><span class="mi" id="MathJax-Span-2868" style="font-size: 70.7%; font-family: MathJax_Math-italic;">a</span><span class="msubsup" id="MathJax-Span-2869"><span style="display: inline-block; position: relative; width: 1.301em; height: 0px;"><span style="position: absolute; clip: rect(3.52em, 1000.33em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2870" style="font-size: 70.7%; font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.893em; left: 0.327em;"><span class="texatom" id="MathJax-Span-2871"><span class="mrow" id="MathJax-Span-2872"><span class="msubsup" id="MathJax-Span-2873"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px;"><span style="position: absolute; clip: rect(3.628em, 1000.22em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2874" style="font-size: 50%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.219em;"><span class="texatom" id="MathJax-Span-2875"><span class="mrow" id="MathJax-Span-2876"><span class="mi" id="MathJax-Span-2877" style="font-size: 50%; font-family: MathJax_Math-italic;">o</span><span class="mi" id="MathJax-Span-2878" style="font-size: 50%; font-family: MathJax_Math-italic;">l</span><span class="mi" id="MathJax-Span-2879" style="font-size: 50%; font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.639em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-300">mem_{par_{v_{old}}}</script> by <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-301-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2880" style="width: 0.923em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.71em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2881"><span class="mi" id="MathJax-Span-2882" style="font-family: MathJax_Math-italic;">w</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-301">w</script> and increase <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-302-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2883" style="width: 5.252em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.953em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1003.95em, 2.6em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2884"><span class="mi" id="MathJax-Span-2885" style="font-family: MathJax_Math-italic;">m</span><span class="mi" id="MathJax-Span-2886" style="font-family: MathJax_Math-italic;">e</span><span class="msubsup" id="MathJax-Span-2887"><span style="display: inline-block; position: relative; width: 2.6em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.87em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2888" style="font-family: MathJax_Math-italic;">m</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.869em;"><span class="texatom" id="MathJax-Span-2889"><span class="mrow" id="MathJax-Span-2890"><span class="mi" id="MathJax-Span-2891" style="font-size: 70.7%; font-family: MathJax_Math-italic;">p</span><span class="mi" id="MathJax-Span-2892" style="font-size: 70.7%; font-family: MathJax_Math-italic;">a</span><span class="msubsup" id="MathJax-Span-2893"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px;"><span style="position: absolute; clip: rect(3.52em, 1000.33em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2894" style="font-size: 70.7%; font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.893em; left: 0.327em;"><span class="texatom" id="MathJax-Span-2895"><span class="mrow" id="MathJax-Span-2896"><span class="msubsup" id="MathJax-Span-2897"><span style="display: inline-block; position: relative; width: 0.544em; height: 0px;"><span style="position: absolute; clip: rect(3.628em, 1000.22em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2898" style="font-size: 50%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.948em; left: 0.219em;"><span class="mi" id="MathJax-Span-2899" style="font-size: 50%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.496em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-302">mem_{par_{v_x}}</script> by <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-303-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2900" style="width: 0.923em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.71em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2901"><span class="mi" id="MathJax-Span-2902" style="font-family: MathJax_Math-italic;">w</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-303">w</script>.</p><p>Write <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-304-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2903" style="width: 3.736em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.817em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.572em, 1002.76em, 2.492em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2904"><span class="msubsup" id="MathJax-Span-2905"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2906" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-2907" style="font-size: 70.7%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-2908" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mi" id="MathJax-Span-2909" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">x</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 0.932em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-304">a_v = x</script> and output the new <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-305-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2910" style="width: 2.167em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.626em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1001.57em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2911"><span class="mi" id="MathJax-Span-2912" style="font-family: MathJax_Math-italic;">a</span><span class="mi" id="MathJax-Span-2913" style="font-family: MathJax_Math-italic;">n</span><span class="mi" id="MathJax-Span-2914" style="font-family: MathJax_Math-italic;">s</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-305">ans</script>. Every dictionary access is an <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-306-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2915" style="width: 6.659em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.035em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1004.93em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2916"><span class="mi" id="MathJax-Span-2917" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-2918" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-2919" style="font-family: MathJax_Math-italic;">l</span><span class="mi" id="MathJax-Span-2920" style="font-family: MathJax_Math-italic;">o</span><span class="mi" id="MathJax-Span-2921" style="font-family: MathJax_Math-italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-2922"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mi" id="MathJax-Span-2923" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-2924" style="font-family: MathJax_Math-italic;">e</span><span class="msubsup" id="MathJax-Span-2925"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2926" style="font-family: MathJax_Math-italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.49em;"><span class="mi" id="MathJax-Span-2927" style="font-size: 70.7%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-2928" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.504em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-306">O(log deg_v)</script> map operation, so each query costs <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-307-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2929" style="width: 4.927em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.736em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1003.63em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2930"><span class="mi" id="MathJax-Span-2931" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-2932" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-2933" style="font-family: MathJax_Math-italic;">l</span><span class="mi" id="MathJax-Span-2934" style="font-family: MathJax_Math-italic;">o</span><span class="mi" id="MathJax-Span-2935" style="font-family: MathJax_Math-italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-2936"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mi" id="MathJax-Span-2937" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">n</span><span class="mo" id="MathJax-Span-2938" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.504em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-307">O(log n)</script> in the worst case. Overall complexity for one test case is <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-308-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2939" style="width: 9.581em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.254em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1007.15em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2940"><span class="mi" id="MathJax-Span-2941" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-2942" style="font-family: MathJax_Main;">(</span><span class="mo" id="MathJax-Span-2943" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-2944" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-2945"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mo" id="MathJax-Span-2946" style="font-family: MathJax_Main; padding-left: 0.165em;">+</span><span class="mo" id="MathJax-Span-2947"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mi" id="MathJax-Span-2948" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-2949" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-2950"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mi" id="MathJax-Span-2951" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">l</span><span class="mi" id="MathJax-Span-2952" style="font-family: MathJax_Math-italic;">o</span><span class="mi" id="MathJax-Span-2953" style="font-family: MathJax_Math-italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-2954"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mi" id="MathJax-Span-2955" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">n</span><span class="mo" id="MathJax-Span-2956" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.504em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-308">O((n + q) log n)</script> time and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-309-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2957" style="width: 2.871em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.167em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1002.06em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2958"><span class="mi" id="MathJax-Span-2959" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-2960" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-2961" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-2962" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-309">O(n)</script> memory, which fits easily in the limits.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> B </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2e5</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">100</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> col</span><span class="pun">[</span><span class="pln">B</span><span class="pun">];</span><span class="pln">
</span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> costt </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
vector </span><span class="pun">&lt;</span><span class="pln">pair </span><span class="pun">&lt;</span><span class="kwd">int</span><span class="pun">,</span><span class="kwd">int</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> reb</span><span class="pun">[</span><span class="pln">B</span><span class="pun">];</span><span class="pln">
</span><span class="kwd">bool</span><span class="pln"> was</span><span class="pun">[</span><span class="pln">B</span><span class="pun">];</span><span class="pln">
map </span><span class="pun">&lt;</span><span class="kwd">int</span><span class="pun">,</span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pun">&gt;</span><span class="pln"> cnt</span><span class="pun">[</span><span class="pln">B</span><span class="pun">];</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> pred</span><span class="pun">[</span><span class="pln">B</span><span class="pun">];</span><span class="pln">
</span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> zn</span><span class="pun">[</span><span class="pln">B</span><span class="pun">];</span><span class="pln">
</span><span class="kwd">void</span><span class="pln"> dfs</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> v</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  was</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">auto</span><span class="pln"> u</span><span class="pun">:</span><span class="pln">reb</span><span class="pun">[</span><span class="pln">v</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">was</span><span class="pun">[</span><span class="pln">u</span><span class="pun">.</span><span class="pln">first</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      pred</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> u</span><span class="pun">.</span><span class="pln">first</span><span class="pun">;</span><span class="pln">
      </span><span class="kwd">continue</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">col</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> col</span><span class="pun">[</span><span class="pln">u</span><span class="pun">.</span><span class="pln">first</span><span class="pun">])</span><span class="pln"> costt</span><span class="pun">+=</span><span class="pln">u</span><span class="pun">.</span><span class="pln">second</span><span class="pun">;</span><span class="pln">
    dfs</span><span class="pun">(</span><span class="pln">u</span><span class="pun">.</span><span class="pln">first</span><span class="pun">);</span><span class="pln">
    zn</span><span class="pun">[</span><span class="pln">u</span><span class="pun">.</span><span class="pln">first</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> u</span><span class="pun">.</span><span class="pln">second</span><span class="pun">;</span><span class="pln">
    cnt</span><span class="pun">[</span><span class="pln">v</span><span class="pun">][</span><span class="pln">col</span><span class="pun">[</span><span class="pln">u</span><span class="pun">.</span><span class="pln">first</span><span class="pun">]]+=</span><span class="pln">zn</span><span class="pun">[</span><span class="pln">u</span><span class="pun">.</span><span class="pln">first</span><span class="pun">];</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">void</span><span class="pln"> update</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> v</span><span class="pun">,</span><span class="kwd">int</span><span class="pln"> x</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">v </span><span class="pun">!=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    cnt</span><span class="pun">[</span><span class="pln">pred</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]][</span><span class="pln">col</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]]-=</span><span class="pln">zn</span><span class="pun">[</span><span class="pln">v</span><span class="pun">];</span><span class="pln">
    </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">col</span><span class="pun">[</span><span class="pln">pred</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> col</span><span class="pun">[</span><span class="pln">v</span><span class="pun">])</span><span class="pln"> costt</span><span class="pun">+=</span><span class="pln">zn</span><span class="pun">[</span><span class="pln">v</span><span class="pun">];</span><span class="pln">
    cnt</span><span class="pun">[</span><span class="pln">pred</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]][</span><span class="pln">x</span><span class="pun">]+=</span><span class="pln">zn</span><span class="pun">[</span><span class="pln">v</span><span class="pun">];</span><span class="pln">
    </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">col</span><span class="pun">[</span><span class="pln">pred</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> x</span><span class="pun">)</span><span class="pln"> costt</span><span class="pun">-=</span><span class="pln">zn</span><span class="pun">[</span><span class="pln">v</span><span class="pun">];</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
  </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      
  </span><span class="pun">}</span><span class="pln">
  costt</span><span class="pun">+=</span><span class="pln">cnt</span><span class="pun">[</span><span class="pln">v</span><span class="pun">][</span><span class="pln">col</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]];</span><span class="pln">
  costt</span><span class="pun">-=</span><span class="pln">cnt</span><span class="pun">[</span><span class="pln">v</span><span class="pun">][</span><span class="pln">x</span><span class="pun">];</span><span class="pln">
  col</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> x</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">void</span><span class="pln"> clr</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    reb</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">clear</span><span class="pun">();</span><span class="pln">
    was</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
    cnt</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">clear</span><span class="pun">();</span><span class="pln">
    zn</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
  costt </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
  cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">while</span><span class="pun">(</span><span class="pln">t</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> q</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n </span><span class="pun">&gt;&gt;</span><span class="pln"> q</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> cin </span><span class="pun">&gt;&gt;</span><span class="pln"> col</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      </span><span class="kwd">int</span><span class="pln"> u</span><span class="pun">,</span><span class="pln"> v</span><span class="pun">,</span><span class="pln"> c</span><span class="pun">;</span><span class="pln">
      cin </span><span class="pun">&gt;&gt;</span><span class="pln"> u </span><span class="pun">&gt;&gt;</span><span class="pln"> v </span><span class="pun">&gt;&gt;</span><span class="pln"> c</span><span class="pun">;</span><span class="pln">
      reb</span><span class="pun">[</span><span class="pln">v</span><span class="pun">].</span><span class="pln">push_back</span><span class="pun">({</span><span class="pln">u</span><span class="pun">,</span><span class="pln">c</span><span class="pun">});</span><span class="pln">
      reb</span><span class="pun">[</span><span class="pln">u</span><span class="pun">].</span><span class="pln">push_back</span><span class="pun">({</span><span class="pln">v</span><span class="pun">,</span><span class="pln">c</span><span class="pun">});</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    dfs</span><span class="pun">(</span><span class="lit">1</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">while</span><span class="pun">(</span><span class="pln">q</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      </span><span class="kwd">int</span><span class="pln"> pos</span><span class="pun">,</span><span class="pln">x</span><span class="pun">;</span><span class="pln">
      cin </span><span class="pun">&gt;&gt;</span><span class="pln"> pos </span><span class="pun">&gt;&gt;</span><span class="pln"> x</span><span class="pun">;</span><span class="pln">
      update</span><span class="pun">(</span><span class="pln">pos</span><span class="pun">,</span><span class="pln">x</span><span class="pun">);</span><span class="pln">
      cout </span><span class="pun">&lt;&lt;</span><span class="pln"> costt </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"\n"</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    clr</span><span class="pun">();</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2126/problem/G1" title="Codeforces Round 1037 (Div. 3)">2126G1 - Big Wins! (easy version)</a></p><p>Idea: <a class="rated-user user-orange" href="https://codeforces.com/profile/soullless" title="Master soullless">soullless</a></p> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2126/problem/G1" title="Codeforces Round 1037 (Div. 3)">2126G1 - Big Wins! (easy version)</a></h3><div class="ttypography"><div class="problem-statement"><div><p>The array values do not exceed <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-310-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2963" style="width: 2.005em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.518em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1001.46em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2964"><span class="mn" id="MathJax-Span-2965" style="font-family: MathJax_Main;">100</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-310">100</script>, so the median we are hunting for can be any integer <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-311-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2966" style="width: 1.139em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.87em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2967"><span class="mi" id="MathJax-Span-2968" style="font-family: MathJax_Math-italic;">m</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-311">m</script> from <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-312-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2969" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2970"><span class="mn" id="MathJax-Span-2971" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-312">1</script> to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-313-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2972" style="width: 2.005em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.518em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1001.46em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2973"><span class="mn" id="MathJax-Span-2974" style="font-family: MathJax_Main;">100</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-313">100</script>.</p><p>For a fixed <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-314-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2975" style="width: 1.139em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.87em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2976"><span class="mi" id="MathJax-Span-2977" style="font-family: MathJax_Math-italic;">m</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-314">m</script> mark every position <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-315-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2978" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.436em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1000.44em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2979"><span class="mi" id="MathJax-Span-2980" style="font-family: MathJax_Math-italic;">j</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-315">j</script> by</p><p><span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-316-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2981" style="width: 4.494em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.412em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1003.36em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2982"><span class="msubsup" id="MathJax-Span-2983"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2984" style="font-family: MathJax_Math-italic;">b</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-2985" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-2986" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mo" id="MathJax-Span-2987" style="font-family: MathJax_Main; padding-left: 0.273em;">+</span><span class="mn" id="MathJax-Span-2988" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-316">b_j = +1</script> if <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-317-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2989" style="width: 4.169em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.141em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1003.14em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2990"><span class="msubsup" id="MathJax-Span-2991"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2992" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-2993" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-2994" style="font-family: MathJax_Main; padding-left: 0.273em;">≥</span><span class="mi" id="MathJax-Span-2995" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">m</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.361em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-317">a_j ≥ m</script></p><p><span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-318-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2996" style="width: 4.494em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.412em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1003.36em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2997"><span class="msubsup" id="MathJax-Span-2998"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-2999" style="font-family: MathJax_Math-italic;">b</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-3000" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-3001" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mo" id="MathJax-Span-3002" style="font-family: MathJax_Main; padding-left: 0.273em;">−</span><span class="mn" id="MathJax-Span-3003" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-318">b_j = −1</script> otherwise.</p><p>For any subarray its median is at least <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-319-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3004" style="width: 1.139em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.87em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-3005"><span class="mi" id="MathJax-Span-3006" style="font-family: MathJax_Math-italic;">m</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-319">m</script> ⇔ the majority of its elements are <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-320-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3007" style="width: 2.6em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.951em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1001.95em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-3008"><span class="mo" id="MathJax-Span-3009" style="font-family: MathJax_Main;">≥</span><span class="mo" id="MathJax-Span-3010"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mi" id="MathJax-Span-3011" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">m</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-320">≥ m</script> ⇔ the sum of the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-321-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3012" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.436em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.44em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-3013"><span class="mi" id="MathJax-Span-3014" style="font-family: MathJax_Math-italic;">b</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-321">b</script>'s on that segment is positive. Let <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-322-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3015" style="width: 3.087em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.33em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1002.33em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-3016"><span class="mi" id="MathJax-Span-3017" style="font-family: MathJax_Math-italic;">p</span><span class="mi" id="MathJax-Span-3018" style="font-family: MathJax_Math-italic;">r</span><span class="mi" id="MathJax-Span-3019" style="font-family: MathJax_Math-italic;">e</span><span class="msubsup" id="MathJax-Span-3020"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.54em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-3021" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.49em;"><span class="mi" id="MathJax-Span-3022" style="font-size: 70.7%; font-family: MathJax_Math-italic;">k</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.361em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-322">pref_k</script>&nbsp;=&nbsp;<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-323-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3023" style="width: 5.035em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.791em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.031em, 1003.68em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-3024"><span class="munderover" id="MathJax-Span-3025"><span style="display: inline-block; position: relative; width: 2.275em; height: 0px;"><span style="position: absolute; clip: rect(3.087em, 1000.98em, 4.44em, -999.997em); top: -4.002em; left: 0em;"><span class="mo" id="MathJax-Span-3026" style="font-family: MathJax_Size1; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; clip: rect(3.358em, 1000.44em, 4.169em, -999.997em); top: -4.489em; left: 1.085em;"><span class="texatom" id="MathJax-Span-3027"><span class="mrow" id="MathJax-Span-3028"><span class="mi" id="MathJax-Span-3029" style="font-size: 70.7%; font-family: MathJax_Math-italic;">k</span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; clip: rect(3.358em, 1001.25em, 4.169em, -999.997em); top: -3.731em; left: 1.085em;"><span class="texatom" id="MathJax-Span-3030"><span class="mrow" id="MathJax-Span-3031"><span class="mi" id="MathJax-Span-3032" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-3033" style="font-size: 70.7%; font-family: MathJax_Main;">=</span><span class="mn" id="MathJax-Span-3034" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mi" id="MathJax-Span-3035" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">b</span><span class="mo" id="MathJax-Span-3036" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-3037" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-3038" style="font-family: MathJax_Main;">]</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.789em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-323">\sum_{i = 1}^{k} b[i]</script>. Then a subarray <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-324-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3039" style="width: 2.871em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.167em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1002.06em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-3040"><span class="mo" id="MathJax-Span-3041" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-3042" style="font-family: MathJax_Math-italic;">l</span><span class="mo" id="MathJax-Span-3043" style="font-family: MathJax_Main;">,</span><span class="mo" id="MathJax-Span-3044" style="padding-left: 0.165em;"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mi" id="MathJax-Span-3045" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">r</span><span class="mo" id="MathJax-Span-3046" style="font-family: MathJax_Main;">]</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.504em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-324">(l, r]</script> has positive sum iff <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-325-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3047" style="width: 7.687em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.793em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1005.79em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-3048"><span class="mi" id="MathJax-Span-3049" style="font-family: MathJax_Math-italic;">p</span><span class="mi" id="MathJax-Span-3050" style="font-family: MathJax_Math-italic;">r</span><span class="mi" id="MathJax-Span-3051" style="font-family: MathJax_Math-italic;">e</span><span class="msubsup" id="MathJax-Span-3052"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.54em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-3053" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.49em;"><span class="mi" id="MathJax-Span-3054" style="font-size: 70.7%; font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-3055" style="font-family: MathJax_Main; padding-left: 0.273em;">&gt;</span><span class="mi" id="MathJax-Span-3056" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">p</span><span class="mi" id="MathJax-Span-3057" style="font-family: MathJax_Math-italic;">r</span><span class="mi" id="MathJax-Span-3058" style="font-family: MathJax_Math-italic;">e</span><span class="msubsup" id="MathJax-Span-3059"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.54em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-3060" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.49em;"><span class="mi" id="MathJax-Span-3061" style="font-size: 70.7%; font-family: MathJax_Math-italic;">l</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.361em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-325">pref_r > pref_l</script>.</p><p>For the same fixed <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-326-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3062" style="width: 1.139em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.87em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-3063"><span class="mi" id="MathJax-Span-3064" style="font-family: MathJax_Math-italic;">m</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-326">m</script> we would like to know, for every position <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-327-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3065" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.436em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1000.44em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-3066"><span class="mi" id="MathJax-Span-3067" style="font-family: MathJax_Math-italic;">j</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-327">j</script>, whether there is a positive - sum subarray that contains <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-328-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3068" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.436em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1000.44em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-3069"><span class="mi" id="MathJax-Span-3070" style="font-family: MathJax_Math-italic;">j</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-328">j</script>. That is true whenever <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-329-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3071" style="width: 12.719em; display: inline-block;"><span style="display: inline-block; position: relative; width: 9.635em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1009.63em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-3072"><span class="munderover" id="MathJax-Span-3073"><span style="display: inline-block; position: relative; width: 3.682em; height: 0px;"><span style="position: absolute; clip: rect(3.195em, 1001.68em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mo" id="MathJax-Span-3074" style="font-family: MathJax_Main;">min</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 1.68em;"><span class="texatom" id="MathJax-Span-3075"><span class="mrow" id="MathJax-Span-3076"><span class="mn" id="MathJax-Span-3077" style="font-size: 70.7%; font-family: MathJax_Main;">0</span><span class="mo" id="MathJax-Span-3078" style="font-size: 70.7%; font-family: MathJax_Main;">≤</span><span class="mi" id="MathJax-Span-3079" style="font-size: 70.7%; font-family: MathJax_Math-italic;">l</span><span class="mo" id="MathJax-Span-3080" style="font-size: 70.7%; font-family: MathJax_Main;">&lt;</span><span class="mi" id="MathJax-Span-3081" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mi" id="MathJax-Span-3082" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">p</span><span class="mi" id="MathJax-Span-3083" style="font-family: MathJax_Math-italic;">r</span><span class="mi" id="MathJax-Span-3084" style="font-family: MathJax_Math-italic;">e</span><span class="msubsup" id="MathJax-Span-3085"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.54em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-3086" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.49em;"><span class="mi" id="MathJax-Span-3087" style="font-size: 70.7%; font-family: MathJax_Math-italic;">l</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-3088" style="font-family: MathJax_Main; padding-left: 0.273em;">&lt;</span><span class="mi" id="MathJax-Span-3089" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">p</span><span class="mi" id="MathJax-Span-3090" style="font-family: MathJax_Math-italic;">r</span><span class="mi" id="MathJax-Span-3091" style="font-family: MathJax_Math-italic;">e</span><span class="msubsup" id="MathJax-Span-3092"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.54em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-3093" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.49em;"><span class="mi" id="MathJax-Span-3094" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-329">\min_{0≤l<j} pref_l < pref_j</script>&nbsp;&nbsp;&nbsp;or&nbsp;&nbsp;&nbsp;<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-330-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3095" style="width: 14.613em; display: inline-block;"><span style="display: inline-block; position: relative; width: 11.042em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1011.04em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-3096"><span class="mi" id="MathJax-Span-3097" style="font-family: MathJax_Math-italic;">p</span><span class="mi" id="MathJax-Span-3098" style="font-family: MathJax_Math-italic;">r</span><span class="mi" id="MathJax-Span-3099" style="font-family: MathJax_Math-italic;">e</span><span class="msubsup" id="MathJax-Span-3100"><span style="display: inline-block; position: relative; width: 1.788em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.54em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-3101" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.49em;"><span class="texatom" id="MathJax-Span-3102"><span class="mrow" id="MathJax-Span-3103"><span class="mi" id="MathJax-Span-3104" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span class="mo" id="MathJax-Span-3105" style="font-size: 70.7%; font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-3106" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-3107" style="font-family: MathJax_Main; padding-left: 0.273em;">&lt;</span><span class="munderover" id="MathJax-Span-3108" style="padding-left: 0.273em;"><span style="display: inline-block; position: relative; width: 4.061em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1001.84em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mo" id="MathJax-Span-3109" style="font-family: MathJax_Main;">max</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 1.843em;"><span class="texatom" id="MathJax-Span-3110"><span class="mrow" id="MathJax-Span-3111"><span class="mi" id="MathJax-Span-3112" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span class="mo" id="MathJax-Span-3113" style="font-size: 70.7%; font-family: MathJax_Main;">≤</span><span class="mi" id="MathJax-Span-3114" style="font-size: 70.7%; font-family: MathJax_Math-italic;">r</span><span class="mo" id="MathJax-Span-3115" style="font-size: 70.7%; font-family: MathJax_Main;">≤</span><span class="mi" id="MathJax-Span-3116" style="font-size: 70.7%; font-family: MathJax_Math-italic;">n</span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mi" id="MathJax-Span-3117" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">p</span><span class="mi" id="MathJax-Span-3118" style="font-family: MathJax_Math-italic;">r</span><span class="mi" id="MathJax-Span-3119" style="font-family: MathJax_Math-italic;">e</span><span class="msubsup" id="MathJax-Span-3120"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.54em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-3121" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.49em;"><span class="mi" id="MathJax-Span-3122" style="font-size: 70.7%; font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-330">pref_{j - 1} < \max_{j≤r≤n} pref_r</script>. Pre-compute left-side prefix minima <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-331-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3123" style="width: 15.641em; display: inline-block;"><span style="display: inline-block; position: relative; width: 11.853em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1011.75em, 2.708em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-3124"><span class="mi" id="MathJax-Span-3125" style="font-family: MathJax_Math-italic;">p</span><span class="mi" id="MathJax-Span-3126" style="font-family: MathJax_Math-italic;">r</span><span class="mi" id="MathJax-Span-3127" style="font-family: MathJax_Math-italic;">e</span><span class="mi" id="MathJax-Span-3128" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span><span class="mi" id="MathJax-Span-3129" style="font-family: MathJax_Math-italic;">m</span><span class="msubsup" id="MathJax-Span-3130"><span style="display: inline-block; position: relative; width: 0.977em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.6em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-3131" style="font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.598em;"><span class="mi" id="MathJax-Span-3132" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-3133" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="munderover" id="MathJax-Span-3134" style="padding-left: 0.273em;"><span style="display: inline-block; position: relative; width: 2.005em; height: 0px;"><span style="position: absolute; clip: rect(3.195em, 1001.68em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mo" id="MathJax-Span-3135" style="font-family: MathJax_Main;">min</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 1.68em;"><span class="mo" id="MathJax-Span-3136" style="font-size: 70.7%; font-family: MathJax_Main;">(</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mi" id="MathJax-Span-3137" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">p</span><span class="mi" id="MathJax-Span-3138" style="font-family: MathJax_Math-italic;">r</span><span class="mi" id="MathJax-Span-3139" style="font-family: MathJax_Math-italic;">e</span><span class="msubsup" id="MathJax-Span-3140"><span style="display: inline-block; position: relative; width: 2.708em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.54em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-3141" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.49em;"><span class="texatom" id="MathJax-Span-3142"><span class="mrow" id="MathJax-Span-3143"><span class="mn" id="MathJax-Span-3144" style="font-size: 70.7%; font-family: MathJax_Main;">0</span><span class="mo" id="MathJax-Span-3145" style="font-size: 70.7%; font-family: MathJax_Main;">≤</span><span class="mi" id="MathJax-Span-3146" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-3147" style="font-size: 70.7%; font-family: MathJax_Main;">≤</span><span class="mi" id="MathJax-Span-3148" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-3149" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.568em; border-left: 0px solid; width: 0px; height: 1.646em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-331">prefmn_j = \min_(pref_{0\leq x \leq j})</script> and right-side suffix maxima <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-332-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3150" style="width: 16.182em; display: inline-block;"><span style="display: inline-block; position: relative; width: 12.232em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1012.12em, 2.708em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-3151"><span class="mi" id="MathJax-Span-3152" style="font-family: MathJax_Math-italic;">s</span><span class="mi" id="MathJax-Span-3153" style="font-family: MathJax_Math-italic;">u</span><span class="mi" id="MathJax-Span-3154" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span><span class="mi" id="MathJax-Span-3155" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span><span class="mi" id="MathJax-Span-3156" style="font-family: MathJax_Math-italic;">m</span><span class="msubsup" id="MathJax-Span-3157"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.54em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-3158" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.598em;"><span class="mi" id="MathJax-Span-3159" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-3160" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="munderover" id="MathJax-Span-3161" style="padding-left: 0.273em;"><span style="display: inline-block; position: relative; width: 2.221em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1001.84em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mo" id="MathJax-Span-3162" style="font-family: MathJax_Main;">max</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 1.843em;"><span class="mo" id="MathJax-Span-3163" style="font-size: 70.7%; font-family: MathJax_Main;">(</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mi" id="MathJax-Span-3164" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">p</span><span class="mi" id="MathJax-Span-3165" style="font-family: MathJax_Math-italic;">r</span><span class="mi" id="MathJax-Span-3166" style="font-family: MathJax_Math-italic;">e</span><span class="msubsup" id="MathJax-Span-3167"><span style="display: inline-block; position: relative; width: 2.762em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.54em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-3168" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.49em;"><span class="texatom" id="MathJax-Span-3169"><span class="mrow" id="MathJax-Span-3170"><span class="mi" id="MathJax-Span-3171" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span class="mo" id="MathJax-Span-3172" style="font-size: 70.7%; font-family: MathJax_Main;">≤</span><span class="mi" id="MathJax-Span-3173" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-3174" style="font-size: 70.7%; font-family: MathJax_Main;">≤</span><span class="mi" id="MathJax-Span-3175" style="font-size: 70.7%; font-family: MathJax_Math-italic;">n</span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-3176" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.568em; border-left: 0px solid; width: 0px; height: 1.646em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-332"> suffmx_j = \max_(pref_{j \leq x \leq n})</script> in two linear passes.</p><p>If either inequality holds, index <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-333-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3177" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.436em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1000.44em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-3178"><span class="mi" id="MathJax-Span-3179" style="font-family: MathJax_Math-italic;">j</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-333">j</script> can lie in some subarray whose median is <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-334-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3180" style="width: 2.6em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.951em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1001.95em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-3181"><span class="mo" id="MathJax-Span-3182" style="font-family: MathJax_Main;">≥</span><span class="mo" id="MathJax-Span-3183"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mi" id="MathJax-Span-3184" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">m</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-334">≥ m</script>. We are free to take that same <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-335-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3185" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.436em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1000.44em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-3186"><span class="mi" id="MathJax-Span-3187" style="font-family: MathJax_Math-italic;">j</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-335">j</script> as the minimum of the chosen subarray, giving value <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-336-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3188" style="width: 1.247em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.92em, 2.546em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-3189"><span class="msubsup" id="MathJax-Span-3190"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-3191" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-3192" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-336">a_j</script>. Hence, for that <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-337-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3193" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.436em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1000.44em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-3194"><span class="mi" id="MathJax-Span-3195" style="font-family: MathJax_Math-italic;">j</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-337">j</script> we can realise the gap <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-338-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3196" style="width: 4.007em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.033em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.41em, 1003.03em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-3197"><span class="mi" id="MathJax-Span-3198" style="font-family: MathJax_Math-italic;">m</span><span class="mo" id="MathJax-Span-3199" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="msubsup" id="MathJax-Span-3200" style="padding-left: 0.219em;"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-3201" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-3202" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-338">m − a_j</script>. Among all indices that satisfy the test keep the largest difference.</p><p>Repeat the whole procedure for <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-339-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3203" style="width: 7.524em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.685em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1005.63em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-3204"><span class="mi" id="MathJax-Span-3205" style="font-family: MathJax_Math-italic;">m</span><span class="mo" id="MathJax-Span-3206" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mn" id="MathJax-Span-3207" style="font-family: MathJax_Main; padding-left: 0.273em;">1</span><span class="mo" id="MathJax-Span-3208" style="font-family: MathJax_Main; padding-left: 0.165em;">…</span><span class="mn" id="MathJax-Span-3209" style="font-family: MathJax_Main; padding-left: 0.165em;">100</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-339">m = 1…100</script> and output the global maximum. Every round over <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-340-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3210" style="width: 1.139em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.87em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-3211"><span class="mi" id="MathJax-Span-3212" style="font-family: MathJax_Math-italic;">m</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-340">m</script> costs <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-341-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3213" style="width: 2.871em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.167em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1002.06em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-3214"><span class="mi" id="MathJax-Span-3215" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-3216" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-3217" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-3218" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-341">O(n)</script>: build <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-342-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3219" style="width: 1.301em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.977em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.87em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-3220"><span class="mi" id="MathJax-Span-3221" style="font-family: MathJax_Math-italic;">b</span><span class="mo" id="MathJax-Span-3222" style="font-family: MathJax_Main;">[</span><span class="mo" id="MathJax-Span-3223" style="font-family: MathJax_Main;">]</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-342">b[ ]</script>, prefix sums, prefix minima, suffix maxima, then scan once more. Total work <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-343-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3224" style="width: 10.23em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.741em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1007.74em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-3225"><span class="mi" id="MathJax-Span-3226" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-3227" style="font-family: MathJax_Main;">(</span><span class="mn" id="MathJax-Span-3228" style="font-family: MathJax_Main;">100</span><span class="mi" id="MathJax-Span-3229" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-3230" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-3231" style="font-family: MathJax_Main; padding-left: 0.273em;">≤</span><span class="mo" id="MathJax-Span-3232"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mn" id="MathJax-Span-3233" style="font-family: MathJax_Main; padding-left: 0.165em;">2</span><span class="mo" id="MathJax-Span-3234"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mo" id="MathJax-Span-3235" style="font-family: MathJax_Main; padding-left: 0.165em;">⋅</span><span class="mo" id="MathJax-Span-3236"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mn" id="MathJax-Span-3237" style="font-family: MathJax_Main; padding-left: 0.165em;">10</span><span class="texatom" id="MathJax-Span-3238"><span class="mrow" id="MathJax-Span-3239"><span class="mo" id="MathJax-Span-3240"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;">⁷</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.504em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-343">O(100n) ≤ 2 · 10⁷</script> for <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-344-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3241" style="width: 6.226em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.71em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1004.71em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-3242"><span class="mi" id="MathJax-Span-3243" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-3244"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mo" id="MathJax-Span-3245" style="font-family: MathJax_Main; padding-left: 0.165em;">≤</span><span class="mo" id="MathJax-Span-3246"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mn" id="MathJax-Span-3247" style="font-family: MathJax_Main; padding-left: 0.165em;">2</span><span class="mo" id="MathJax-Span-3248"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mo" id="MathJax-Span-3249" style="font-family: MathJax_Main; padding-left: 0.165em;">⋅</span><span class="mo" id="MathJax-Span-3250"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mn" id="MathJax-Span-3251" style="font-family: MathJax_Main; padding-left: 0.165em;">10</span><span class="texatom" id="MathJax-Span-3252"><span class="mrow" id="MathJax-Span-3253"><span class="mo" id="MathJax-Span-3254"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;">⁵</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-344">n ≤ 2 · 10⁵</script>, which fits easily. Memory is <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-345-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3255" style="width: 2.871em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.167em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1002.06em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-3256"><span class="mi" id="MathJax-Span-3257" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-3258" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-3259" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-3260" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-345">O(n)</script>.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> B </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2e5</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">100</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
  cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">while</span><span class="pun">(</span><span class="pln">t</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">];</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">i</span><span class="pun">++)</span><span class="pln"> cin </span><span class="pun">&gt;&gt;</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> ans </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">i </span><span class="pun">&lt;=</span><span class="pln"> </span><span class="lit">100</span><span class="pun">;</span><span class="pln">i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      </span><span class="kwd">int</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{};</span><span class="pln">
      </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">j </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">j</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&gt;=</span><span class="pln"> i</span><span class="pun">)</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">else</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">;</span><span class="pln">
      </span><span class="pun">}</span><span class="pln">
      </span><span class="kwd">int</span><span class="pln"> pref</span><span class="pun">[</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{};</span><span class="pln">
      </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        pref</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> pref</span><span class="pun">[</span><span class="pln">j </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">j</span><span class="pun">];</span><span class="pln"> 
      </span><span class="pun">}</span><span class="pln">
      </span><span class="kwd">int</span><span class="pln"> prefmn</span><span class="pun">[</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{},</span><span class="pln">suffmx</span><span class="pun">[</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{};</span><span class="pln">
      prefmn</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln">suffmx</span><span class="pun">[</span><span class="pln">n</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> pref</span><span class="pun">[</span><span class="pln">n</span><span class="pun">];</span><span class="pln">
      </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        prefmn</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> min</span><span class="pun">(</span><span class="pln">prefmn</span><span class="pun">[</span><span class="pln">j </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">],</span><span class="pln">pref</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]);</span><span class="pln">
      </span><span class="pun">}</span><span class="pln">
      </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> n </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        suffmx</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> max</span><span class="pun">(</span><span class="pln">suffmx</span><span class="pun">[</span><span class="pln">j </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">],</span><span class="pln">pref</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]);</span><span class="pln">
      </span><span class="pun">}</span><span class="pln">
      </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">prefmn</span><span class="pun">[</span><span class="pln">j </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;=</span><span class="pln"> pref</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> pref</span><span class="pun">[</span><span class="pln">j </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;=</span><span class="pln"> suffmx</span><span class="pun">[</span><span class="pln">j</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
          ans </span><span class="pun">=</span><span class="pln"> max</span><span class="pun">(</span><span class="pln">ans</span><span class="pun">,</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
      </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln"> 
    cout </span><span class="pun">&lt;&lt;</span><span class="pln"> ans </span><span class="pun">&lt;&lt;</span><span class="pln"> endl</span><span class="pun">;</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2126/problem/G2" title="Codeforces Round 1037 (Div. 3)">2126G2 - Big Wins! (hard version)</a></p><p>Idea: <a class="rated-user user-orange" href="https://codeforces.com/profile/soullless" title="Master soullless">soullless</a></p> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2126/problem/G2" title="Codeforces Round 1037 (Div. 3)">2126G2 - Big Wins! (hard version)</a></h3><div class="ttypography"><div class="problem-statement"><div><p>Goal: maximise  <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-346-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3261" style="width: 24.678em; display: inline-block;"><span style="display: inline-block; position: relative; width: 18.672em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1018.56em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-3262"><span class="mi" id="MathJax-Span-3263" style="font-family: MathJax_Math-italic;">m</span><span class="mi" id="MathJax-Span-3264" style="font-family: MathJax_Math-italic;">e</span><span class="mi" id="MathJax-Span-3265" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-3266" style="font-family: MathJax_Math-italic;">i</span><span class="mi" id="MathJax-Span-3267" style="font-family: MathJax_Math-italic;">a</span><span class="mi" id="MathJax-Span-3268" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-3269" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-3270" style="font-family: MathJax_Math-italic;">s</span><span class="mi" id="MathJax-Span-3271" style="font-family: MathJax_Math-italic;">u</span><span class="mi" id="MathJax-Span-3272" style="font-family: MathJax_Math-italic;">b</span><span class="mi" id="MathJax-Span-3273" style="font-family: MathJax_Math-italic;">a</span><span class="mi" id="MathJax-Span-3274" style="font-family: MathJax_Math-italic;">r</span><span class="mi" id="MathJax-Span-3275" style="font-family: MathJax_Math-italic;">r</span><span class="mi" id="MathJax-Span-3276" style="font-family: MathJax_Math-italic;">a</span><span class="mi" id="MathJax-Span-3277" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-3278" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-3279"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mo" id="MathJax-Span-3280" style="font-family: MathJax_Main; padding-left: 0.165em;">−</span><span class="mo" id="MathJax-Span-3281"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mi" id="MathJax-Span-3282" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">m</span><span class="mi" id="MathJax-Span-3283" style="font-family: MathJax_Math-italic;">i</span><span class="mi" id="MathJax-Span-3284" style="font-family: MathJax_Math-italic;">n</span><span class="mi" id="MathJax-Span-3285" style="font-family: MathJax_Math-italic;">i</span><span class="mi" id="MathJax-Span-3286" style="font-family: MathJax_Math-italic;">m</span><span class="mi" id="MathJax-Span-3287" style="font-family: MathJax_Math-italic;">u</span><span class="mi" id="MathJax-Span-3288" style="font-family: MathJax_Math-italic;">m</span><span class="mo" id="MathJax-Span-3289" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-3290" style="font-family: MathJax_Math-italic;">s</span><span class="mi" id="MathJax-Span-3291" style="font-family: MathJax_Math-italic;">u</span><span class="mi" id="MathJax-Span-3292" style="font-family: MathJax_Math-italic;">b</span><span class="mi" id="MathJax-Span-3293" style="font-family: MathJax_Math-italic;">a</span><span class="mi" id="MathJax-Span-3294" style="font-family: MathJax_Math-italic;">r</span><span class="mi" id="MathJax-Span-3295" style="font-family: MathJax_Math-italic;">r</span><span class="mi" id="MathJax-Span-3296" style="font-family: MathJax_Math-italic;">a</span><span class="mi" id="MathJax-Span-3297" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-3298" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.504em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-346">median(subarray) − minimum(subarray)</script>. Treat the minimum as the "left pointer" <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-347-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3299" style="width: 1.951em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.464em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1001.46em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-3300"><span class="mi" id="MathJax-Span-3301" style="font-family: MathJax_Math-italic;">m</span><span class="mi" id="MathJax-Span-3302" style="font-family: MathJax_Math-italic;">n</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-347">mn</script> that we increase from <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-348-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3303" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-3304"><span class="mn" id="MathJax-Span-3305" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-348">1</script> up to max <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-349-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3306" style="width: 1.139em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.87em, 2.438em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-3307"><span class="msubsup" id="MathJax-Span-3308"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-3309" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-3310" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 0.932em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-349">a_i</script>. For every fixed <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-350-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3311" style="width: 1.951em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.464em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1001.46em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-3312"><span class="mi" id="MathJax-Span-3313" style="font-family: MathJax_Math-italic;">m</span><span class="mi" id="MathJax-Span-3314" style="font-family: MathJax_Math-italic;">n</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-350">mn</script> we try to push a second pointer <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-351-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3315" style="width: 2.438em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.843em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1001.84em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-3316"><span class="mi" id="MathJax-Span-3317" style="font-family: MathJax_Math-italic;">m</span><span class="mi" id="MathJax-Span-3318" style="font-family: MathJax_Math-italic;">e</span><span class="mi" id="MathJax-Span-3319" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-351">med</script> (the candidate median) as high as possible while some subarray exists whose minimum is exactly <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-352-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3320" style="width: 1.951em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.464em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1001.46em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-3321"><span class="mi" id="MathJax-Span-3322" style="font-family: MathJax_Math-italic;">m</span><span class="mi" id="MathJax-Span-3323" style="font-family: MathJax_Math-italic;">n</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-352">mn</script> and whose median is at least <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-353-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3324" style="width: 2.438em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.843em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1001.84em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-3325"><span class="mi" id="MathJax-Span-3326" style="font-family: MathJax_Math-italic;">m</span><span class="mi" id="MathJax-Span-3327" style="font-family: MathJax_Math-italic;">e</span><span class="mi" id="MathJax-Span-3328" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-353">med</script>. The answer is the largest difference <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-354-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3329" style="width: 6.28em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.765em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1004.76em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-3330"><span class="mi" id="MathJax-Span-3331" style="font-family: MathJax_Math-italic;">m</span><span class="mi" id="MathJax-Span-3332" style="font-family: MathJax_Math-italic;">e</span><span class="mi" id="MathJax-Span-3333" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-3334"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mo" id="MathJax-Span-3335" style="font-family: MathJax_Main; padding-left: 0.165em;">−</span><span class="mo" id="MathJax-Span-3336"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mi" id="MathJax-Span-3337" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">m</span><span class="mi" id="MathJax-Span-3338" style="font-family: MathJax_Math-italic;">n</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-354">med − mn</script> reached during this sweep.</p><p>Fix a value <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-355-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3339" style="width: 1.951em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.464em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1001.46em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-3340"><span class="mi" id="MathJax-Span-3341" style="font-family: MathJax_Math-italic;">m</span><span class="mi" id="MathJax-Span-3342" style="font-family: MathJax_Math-italic;">n</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-355">mn</script>. Any subarray whose minimum equals <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-356-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3343" style="width: 1.951em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.464em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1001.46em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-3344"><span class="mi" id="MathJax-Span-3345" style="font-family: MathJax_Math-italic;">m</span><span class="mi" id="MathJax-Span-3346" style="font-family: MathJax_Math-italic;">n</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-356">mn</script> must contain at least one position <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-357-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3347" style="width: 0.814em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.6em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-3348"><span class="mi" id="MathJax-Span-3349" style="font-family: MathJax_Math-italic;">u</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-357">u</script> with <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-358-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3350" style="width: 5.143em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.899em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1003.9em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-3351"><span class="msubsup" id="MathJax-Span-3352"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-3353" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-3354" style="font-size: 70.7%; font-family: MathJax_Math-italic;">u</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-3355"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mo" id="MathJax-Span-3356" style="font-family: MathJax_Main; padding-left: 0.165em;">=</span><span class="mo" id="MathJax-Span-3357"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mi" id="MathJax-Span-3358" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">m</span><span class="mi" id="MathJax-Span-3359" style="font-family: MathJax_Math-italic;">n</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-358">a_u = mn</script>, and the whole subarray must lie inside the maximal span where that <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-359-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3360" style="width: 0.814em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.6em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-3361"><span class="mi" id="MathJax-Span-3362" style="font-family: MathJax_Math-italic;">u</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-359">u</script> is the strict minimum. Those spans are computed once by the usual monotone stack: <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-360-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3363" style="width: 2.384em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.788em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1001.73em, 2.492em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-3364"><span class="msubsup" id="MathJax-Span-3365"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.27em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-3366" style="font-family: MathJax_Math-italic;">l</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.327em;"><span class="mi" id="MathJax-Span-3367" style="font-size: 70.7%; font-family: MathJax_Math-italic;">u</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-3368" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-360">l_u =</script> first index to the left that has <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-361-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3369" style="width: 9.256em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.983em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1006.93em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-3370"><span class="mi" id="MathJax-Span-3371" style="font-family: MathJax_Math-italic;">v</span><span class="mi" id="MathJax-Span-3372" style="font-family: MathJax_Math-italic;">a</span><span class="mi" id="MathJax-Span-3373" style="font-family: MathJax_Math-italic;">l</span><span class="mi" id="MathJax-Span-3374" style="font-family: MathJax_Math-italic;">u</span><span class="mi" id="MathJax-Span-3375" style="font-family: MathJax_Math-italic;">e</span><span class="mo" id="MathJax-Span-3376" style="font-family: MathJax_Main; padding-left: 0.273em;">&lt;</span><span class="mo" id="MathJax-Span-3377"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mi" id="MathJax-Span-3378" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">a</span><span class="mo" id="MathJax-Span-3379" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-3380" style="font-family: MathJax_Math-italic;">u</span><span class="mo" id="MathJax-Span-3381" style="font-family: MathJax_Main;">]</span><span class="mo" id="MathJax-Span-3382" style="font-family: MathJax_Main;">+</span><span class="mo" id="MathJax-Span-3383"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mn" id="MathJax-Span-3384" style="font-family: MathJax_Main; padding-left: 0.165em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.504em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-361">value < a[u] + 1</script>, <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-362-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3385" style="width: 2.6em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.951em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.572em, 1001.9em, 2.492em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-3386"><span class="msubsup" id="MathJax-Span-3387"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-3388" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-3389" style="font-size: 70.7%; font-family: MathJax_Math-italic;">u</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-3390" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 0.932em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-362">r_u = </script>first index to the right that has <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-363-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3391" style="width: 8.39em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.334em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1006.28em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-3392"><span class="mi" id="MathJax-Span-3393" style="font-family: MathJax_Math-italic;">v</span><span class="mi" id="MathJax-Span-3394" style="font-family: MathJax_Math-italic;">a</span><span class="mi" id="MathJax-Span-3395" style="font-family: MathJax_Math-italic;">l</span><span class="mi" id="MathJax-Span-3396" style="font-family: MathJax_Math-italic;">u</span><span class="mi" id="MathJax-Span-3397" style="font-family: MathJax_Math-italic;">e</span><span class="mo" id="MathJax-Span-3398" style="font-family: MathJax_Main; padding-left: 0.273em;">&lt;</span><span class="mo" id="MathJax-Span-3399"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="msubsup" id="MathJax-Span-3400" style="padding-left: 0.165em;"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-3401" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-3402" style="font-size: 70.7%; font-family: MathJax_Math-italic;">u</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-3403" style="font-family: MathJax_Main;">−</span><span class="mo" id="MathJax-Span-3404"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mn" id="MathJax-Span-3405" style="font-family: MathJax_Main; padding-left: 0.165em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-363">value < a_u - 1</script>.</p><p>For a potential median <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-364-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3406" style="width: 1.356em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1001.03em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-3407"><span class="mi" id="MathJax-Span-3408" style="font-family: MathJax_Math-italic;">M<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-364">M</script> define an array <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-365-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3409" style="width: 2.925em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.221em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1002.22em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-3410"><span class="mi" id="MathJax-Span-3411" style="font-family: MathJax_Math-italic;">s</span><span class="mi" id="MathJax-Span-3412" style="font-family: MathJax_Math-italic;">i</span><span class="mi" id="MathJax-Span-3413" style="font-family: MathJax_Math-italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="msubsup" id="MathJax-Span-3414"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.6em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-3415" style="font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.598em;"><span class="mi" id="MathJax-Span-3416" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-365">sign_i</script> = <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-366-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3417" style="width: 1.734em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.301em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1001.25em, 2.438em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-3418"><span class="mo" id="MathJax-Span-3419" style="font-family: MathJax_Main;">+</span><span class="mn" id="MathJax-Span-3420" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.211em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-366">+1</script> if <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-367-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3421" style="width: 4.386em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.304em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1003.3em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-3422"><span class="msubsup" id="MathJax-Span-3423"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-3424" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-3425" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-3426"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mo" id="MathJax-Span-3427" style="font-family: MathJax_Main; padding-left: 0.165em;">≥</span><span class="mo" id="MathJax-Span-3428"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mi" id="MathJax-Span-3429" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">M<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-367">a_i ≥ M</script>, <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-368-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3430" style="width: 1.734em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.301em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1001.25em, 2.438em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-3431"><span class="mo" id="MathJax-Span-3432" style="font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-3433" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.211em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-368">−1</script> otherwise. Inside any interval its median is <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-369-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3434" style="width: 2.817em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.113em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1002.11em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-3435"><span class="mo" id="MathJax-Span-3436" style="font-family: MathJax_Main;">≥</span><span class="mo" id="MathJax-Span-3437"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mi" id="MathJax-Span-3438" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">M<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-369">≥ M</script> exactly when the total sum of sign over that interval is positive (at least half the elements are high). Therefore, for a particular position <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-370-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3439" style="width: 0.814em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.6em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-3440"><span class="mi" id="MathJax-Span-3441" style="font-family: MathJax_Math-italic;">u</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-370">u</script> to serve as the minimum we need</p><p><span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-371-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3442" style="width: 34.797em; display: inline-block;"><span style="display: inline-block; position: relative; width: 26.356em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1026.3em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-3443"><span class="mi" id="MathJax-Span-3444" style="font-family: MathJax_Math-italic;">m</span><span class="mi" id="MathJax-Span-3445" style="font-family: MathJax_Math-italic;">a</span><span class="mi" id="MathJax-Span-3446" style="font-family: MathJax_Math-italic;">x</span><span class="mi" id="MathJax-Span-3447" style="font-family: MathJax_Math-italic;">S<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span><span class="mi" id="MathJax-Span-3448" style="font-family: MathJax_Math-italic;">u</span><span class="mi" id="MathJax-Span-3449" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span><span class="mi" id="MathJax-Span-3450" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span><span class="mi" id="MathJax-Span-3451" style="font-family: MathJax_Math-italic;">i</span><span class="mi" id="MathJax-Span-3452" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-3453" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-3454"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.27em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-3455" style="font-family: MathJax_Math-italic;">l</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.327em;"><span class="mi" id="MathJax-Span-3456" style="font-size: 70.7%; font-family: MathJax_Math-italic;">u</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-3457" style="font-family: MathJax_Main;">,</span><span class="mo" id="MathJax-Span-3458" style="padding-left: 0.165em;"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mi" id="MathJax-Span-3459" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">u</span><span class="mo" id="MathJax-Span-3460" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mn" id="MathJax-Span-3461" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-3462" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-3463" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mi" id="MathJax-Span-3464" style="font-family: MathJax_Math-italic; padding-left: 0.219em;">s</span><span class="mi" id="MathJax-Span-3465" style="font-family: MathJax_Math-italic;">i</span><span class="mi" id="MathJax-Span-3466" style="font-family: MathJax_Math-italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="msubsup" id="MathJax-Span-3467"><span style="display: inline-block; position: relative; width: 1.085em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.6em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-3468" style="font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.598em;"><span class="mi" id="MathJax-Span-3469" style="font-size: 70.7%; font-family: MathJax_Math-italic;">u</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-3470" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mi" id="MathJax-Span-3471" style="font-family: MathJax_Math-italic; padding-left: 0.219em;">m</span><span class="mi" id="MathJax-Span-3472" style="font-family: MathJax_Math-italic;">a</span><span class="mi" id="MathJax-Span-3473" style="font-family: MathJax_Math-italic;">x</span><span class="mi" id="MathJax-Span-3474" style="font-family: MathJax_Math-italic;">P<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.111em;"></span></span><span class="mi" id="MathJax-Span-3475" style="font-family: MathJax_Math-italic;">r</span><span class="mi" id="MathJax-Span-3476" style="font-family: MathJax_Math-italic;">e</span><span class="mi" id="MathJax-Span-3477" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span><span class="mi" id="MathJax-Span-3478" style="font-family: MathJax_Math-italic;">i</span><span class="mi" id="MathJax-Span-3479" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-3480" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-3481" style="font-family: MathJax_Math-italic;">u</span><span class="mo" id="MathJax-Span-3482" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-3483" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-3484" style="font-family: MathJax_Main;">,</span><span class="mo" id="MathJax-Span-3485" style="padding-left: 0.165em;"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="msubsup" id="MathJax-Span-3486" style="padding-left: 0.165em;"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-3487" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-3488" style="font-size: 70.7%; font-family: MathJax_Math-italic;">u</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-3489" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-3490" style="font-family: MathJax_Main; padding-left: 0.273em;">≥</span><span class="mo" id="MathJax-Span-3491"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mn" id="MathJax-Span-3492" style="font-family: MathJax_Main; padding-left: 0.165em;">0</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.504em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-371">maxSuffix(l_u, u−1) + sign_u + maxPrefix(u+1, r_u) ≥ 0</script>.</p><p>Here <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-372-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3493" style="width: 6.929em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.252em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1005.2em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-3494"><span class="mi" id="MathJax-Span-3495" style="font-family: MathJax_Math-italic;">m</span><span class="mi" id="MathJax-Span-3496" style="font-family: MathJax_Math-italic;">a</span><span class="mi" id="MathJax-Span-3497" style="font-family: MathJax_Math-italic;">x</span><span class="mi" id="MathJax-Span-3498" style="font-family: MathJax_Math-italic;">S<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span><span class="mi" id="MathJax-Span-3499" style="font-family: MathJax_Math-italic;">u</span><span class="mi" id="MathJax-Span-3500" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span><span class="mi" id="MathJax-Span-3501" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span><span class="mi" id="MathJax-Span-3502" style="font-family: MathJax_Math-italic;">i</span><span class="mi" id="MathJax-Span-3503" style="font-family: MathJax_Math-italic;">x</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.361em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-372">maxSuffix</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-373-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3504" style="width: 6.821em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.143em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1005.09em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-3505"><span class="mi" id="MathJax-Span-3506" style="font-family: MathJax_Math-italic;">m</span><span class="mi" id="MathJax-Span-3507" style="font-family: MathJax_Math-italic;">a</span><span class="mi" id="MathJax-Span-3508" style="font-family: MathJax_Math-italic;">x</span><span class="mi" id="MathJax-Span-3509" style="font-family: MathJax_Math-italic;">P<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.111em;"></span></span><span class="mi" id="MathJax-Span-3510" style="font-family: MathJax_Math-italic;">r</span><span class="mi" id="MathJax-Span-3511" style="font-family: MathJax_Math-italic;">e</span><span class="mi" id="MathJax-Span-3512" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span><span class="mi" id="MathJax-Span-3513" style="font-family: MathJax_Math-italic;">i</span><span class="mi" id="MathJax-Span-3514" style="font-family: MathJax_Math-italic;">x</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.361em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-373">maxPrefix</script> are, respectively, the largest suffix sum ending at <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-374-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3515" style="width: 3.033em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.275em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1002.22em, 2.438em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-3516"><span class="mi" id="MathJax-Span-3517" style="font-family: MathJax_Math-italic;">u</span><span class="mo" id="MathJax-Span-3518" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mn" id="MathJax-Span-3519" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.211em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-374">u−1</script> and the largest prefix sum starting at <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-375-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3520" style="width: 3.033em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.275em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1002.22em, 2.438em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-3521"><span class="mi" id="MathJax-Span-3522" style="font-family: MathJax_Math-italic;">u</span><span class="mo" id="MathJax-Span-3523" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-3524" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.211em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-375">u+1</script>, measured in the sign array.</p><p>All max-prefix / max-suffix / total-sum queries can be answered in <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-376-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3525" style="width: 4.927em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.736em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1003.63em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-3526"><span class="mi" id="MathJax-Span-3527" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-3528" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-3529" style="font-family: MathJax_Math-italic;">l</span><span class="mi" id="MathJax-Span-3530" style="font-family: MathJax_Math-italic;">o</span><span class="mi" id="MathJax-Span-3531" style="font-family: MathJax_Math-italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-3532"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mi" id="MathJax-Span-3533" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">n</span><span class="mo" id="MathJax-Span-3534" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.504em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-376">O(log n)</script> with a segment-tree that stores at each node (<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-377-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3535" style="width: 22.351em; display: inline-block;"><span style="display: inline-block; position: relative; width: 16.94em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1016.94em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-3536"><span class="mi" id="MathJax-Span-3537" style="font-family: MathJax_Math-italic;">a</span><span class="mi" id="MathJax-Span-3538" style="font-family: MathJax_Math-italic;">n</span><span class="mi" id="MathJax-Span-3539" style="font-family: MathJax_Math-italic;">s</span><span class="mo" id="MathJax-Span-3540" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-3541" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">b</span><span class="mi" id="MathJax-Span-3542" style="font-family: MathJax_Math-italic;">e</span><span class="mi" id="MathJax-Span-3543" style="font-family: MathJax_Math-italic;">s</span><span class="mi" id="MathJax-Span-3544" style="font-family: MathJax_Math-italic;">t</span><span class="mi" id="MathJax-Span-3545" style="font-family: MathJax_Math-italic;">P<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.111em;"></span></span><span class="mi" id="MathJax-Span-3546" style="font-family: MathJax_Math-italic;">r</span><span class="mi" id="MathJax-Span-3547" style="font-family: MathJax_Math-italic;">e</span><span class="mi" id="MathJax-Span-3548" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span><span class="mi" id="MathJax-Span-3549" style="font-family: MathJax_Math-italic;">i</span><span class="mi" id="MathJax-Span-3550" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-3551" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-3552" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">b</span><span class="mi" id="MathJax-Span-3553" style="font-family: MathJax_Math-italic;">e</span><span class="mi" id="MathJax-Span-3554" style="font-family: MathJax_Math-italic;">s</span><span class="mi" id="MathJax-Span-3555" style="font-family: MathJax_Math-italic;">t</span><span class="mi" id="MathJax-Span-3556" style="font-family: MathJax_Math-italic;">S<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span><span class="mi" id="MathJax-Span-3557" style="font-family: MathJax_Math-italic;">u</span><span class="mi" id="MathJax-Span-3558" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span><span class="mi" id="MathJax-Span-3559" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span><span class="mi" id="MathJax-Span-3560" style="font-family: MathJax_Math-italic;">i</span><span class="mi" id="MathJax-Span-3561" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-3562" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-3563" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">t</span><span class="mi" id="MathJax-Span-3564" style="font-family: MathJax_Math-italic;">o</span><span class="mi" id="MathJax-Span-3565" style="font-family: MathJax_Math-italic;">t</span><span class="mi" id="MathJax-Span-3566" style="font-family: MathJax_Math-italic;">a</span><span class="mi" id="MathJax-Span-3567" style="font-family: MathJax_Math-italic;">l</span><span class="mi" id="MathJax-Span-3568" style="font-family: MathJax_Math-italic;">S<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span><span class="mi" id="MathJax-Span-3569" style="font-family: MathJax_Math-italic;">u</span><span class="mi" id="MathJax-Span-3570" style="font-family: MathJax_Math-italic;">m</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.361em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-377">ans, bestPrefix, bestSuffix, totalSum</script>). Merging two children follows the standard Kadane-style formulas.</p><p>Algorithm loop. Initialise the segment tree with <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-378-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3571" style="width: 6.117em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.602em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1004.55em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-3572"><span class="mi" id="MathJax-Span-3573" style="font-family: MathJax_Math-italic;">s</span><span class="mi" id="MathJax-Span-3574" style="font-family: MathJax_Math-italic;">i</span><span class="mi" id="MathJax-Span-3575" style="font-family: MathJax_Math-italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-3576" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-3577"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mo" id="MathJax-Span-3578" style="font-family: MathJax_Main; padding-left: 0.165em;">≡</span><span class="mo" id="MathJax-Span-3579"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mo" id="MathJax-Span-3580" style="font-family: MathJax_Main; padding-left: 0.165em;">+</span><span class="mn" id="MathJax-Span-3581" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.504em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-378">sign ≡ +1</script>, so total sum everywhere is positive; set <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-379-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3582" style="width: 5.035em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.791em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1003.74em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-3583"><span class="mi" id="MathJax-Span-3584" style="font-family: MathJax_Math-italic;">m</span><span class="mi" id="MathJax-Span-3585" style="font-family: MathJax_Math-italic;">e</span><span class="mi" id="MathJax-Span-3586" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-3587"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mo" id="MathJax-Span-3588" style="font-family: MathJax_Main; padding-left: 0.165em;">=</span><span class="mo" id="MathJax-Span-3589"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mn" id="MathJax-Span-3590" style="font-family: MathJax_Main; padding-left: 0.165em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-379">med = 1</script>. For <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-380-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3591" style="width: 5.143em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.899em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1003.85em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-3592"><span class="mi" id="MathJax-Span-3593" style="font-family: MathJax_Math-italic;">m</span><span class="mi" id="MathJax-Span-3594" style="font-family: MathJax_Math-italic;">e</span><span class="mi" id="MathJax-Span-3595" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-3596" style="font-family: MathJax_Main; padding-left: 0.273em;">←</span><span class="mn" id="MathJax-Span-3597" style="font-family: MathJax_Main; padding-left: 0.273em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-380">med←1</script> we must exclude from the tree every position whose value is <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-381-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3598" style="width: 3.953em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.979em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1002.98em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-3599"><span class="mo" id="MathJax-Span-3600" style="font-family: MathJax_Main;">&lt;</span><span class="mo" id="MathJax-Span-3601"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mi" id="MathJax-Span-3602" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">m</span><span class="mi" id="MathJax-Span-3603" style="font-family: MathJax_Math-italic;">e</span><span class="mi" id="MathJax-Span-3604" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-381">< med</script>, by updating that point to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-382-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3605" style="width: 1.734em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.301em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1001.25em, 2.438em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-3606"><span class="mo" id="MathJax-Span-3607" style="font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-3608" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.211em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-382">−1</script>. Now iterate <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-383-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3609" style="width: 1.951em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.464em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1001.46em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-3610"><span class="mi" id="MathJax-Span-3611" style="font-family: MathJax_Math-italic;">m</span><span class="mi" id="MathJax-Span-3612" style="font-family: MathJax_Math-italic;">n</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-383">mn</script> from <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-384-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3613" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-3614"><span class="mn" id="MathJax-Span-3615" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-384">1</script> upward:</p><p> - for every index <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-385-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3616" style="width: 0.814em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.6em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-3617"><span class="mi" id="MathJax-Span-3618" style="font-family: MathJax_Math-italic;">u</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-385">u</script> with <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-386-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3619" style="width: 5.143em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.899em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1003.9em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-3620"><span class="msubsup" id="MathJax-Span-3621"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-3622" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-3623" style="font-size: 70.7%; font-family: MathJax_Math-italic;">u</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-3624"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mo" id="MathJax-Span-3625" style="font-family: MathJax_Main; padding-left: 0.165em;">=</span><span class="mo" id="MathJax-Span-3626"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mi" id="MathJax-Span-3627" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">m</span><span class="mi" id="MathJax-Span-3628" style="font-family: MathJax_Math-italic;">n</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-386">a_u = mn</script> evaluate the inequality above.</p><p> - while the inequality is satisfied for all such indices, increment <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-387-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3629" style="width: 2.438em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.843em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1001.84em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-3630"><span class="mi" id="MathJax-Span-3631" style="font-family: MathJax_Math-italic;">m</span><span class="mi" id="MathJax-Span-3632" style="font-family: MathJax_Math-italic;">e</span><span class="mi" id="MathJax-Span-3633" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-387">med</script> by <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-388-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3634" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-3635"><span class="mn" id="MathJax-Span-3636" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-388">1</script> and for every position whose value just became <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-389-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3637" style="width: 3.953em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.979em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1002.98em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-3638"><span class="mo" id="MathJax-Span-3639" style="font-family: MathJax_Main;">&lt;</span><span class="mo" id="MathJax-Span-3640"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mi" id="MathJax-Span-3641" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">m</span><span class="mi" id="MathJax-Span-3642" style="font-family: MathJax_Math-italic;">e</span><span class="mi" id="MathJax-Span-3643" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-389">< med</script> perform one point-update to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-390-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3644" style="width: 1.734em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.301em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1001.25em, 2.438em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-3645"><span class="mo" id="MathJax-Span-3646" style="font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-3647" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.211em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-390">−1</script> in the segment tree.</p><p> - when the test fails for some <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-391-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3648" style="width: 0.814em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.6em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-3649"><span class="mi" id="MathJax-Span-3650" style="font-family: MathJax_Math-italic;">u</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-391">u</script>, stop raising med.</p><p> - record <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-392-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3651" style="width: 16.507em; display: inline-block;"><span style="display: inline-block; position: relative; width: 12.503em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1012.39em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-3652"><span class="mi" id="MathJax-Span-3653" style="font-family: MathJax_Math-italic;">a</span><span class="mi" id="MathJax-Span-3654" style="font-family: MathJax_Math-italic;">n</span><span class="mi" id="MathJax-Span-3655" style="font-family: MathJax_Math-italic;">s</span><span class="mo" id="MathJax-Span-3656" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mi" id="MathJax-Span-3657" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">m</span><span class="mi" id="MathJax-Span-3658" style="font-family: MathJax_Math-italic;">a</span><span class="mi" id="MathJax-Span-3659" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-3660" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-3661" style="font-family: MathJax_Math-italic;">a</span><span class="mi" id="MathJax-Span-3662" style="font-family: MathJax_Math-italic;">n</span><span class="mi" id="MathJax-Span-3663" style="font-family: MathJax_Math-italic;">s</span><span class="mo" id="MathJax-Span-3664" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-3665" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">m</span><span class="mi" id="MathJax-Span-3666" style="font-family: MathJax_Math-italic;">e</span><span class="mi" id="MathJax-Span-3667" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-3668"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mo" id="MathJax-Span-3669" style="font-family: MathJax_Main; padding-left: 0.165em;">−</span><span class="mo" id="MathJax-Span-3670"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mi" id="MathJax-Span-3671" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">m</span><span class="mi" id="MathJax-Span-3672" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-3673" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.504em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-392">ans = max(ans, med − mn)</script>.</p><p>Because med only increases and never exceeds <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-393-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3674" style="width: 0.814em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.6em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-3675"><span class="mi" id="MathJax-Span-3676" style="font-family: MathJax_Math-italic;">n</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-393">n</script>, the total number of tree updates is <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-394-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3677" style="width: 2.871em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.167em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1002.06em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-3678"><span class="mi" id="MathJax-Span-3679" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-3680" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-3681" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-3682" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-394">O(n)</script> and every update / query costs <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-395-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3683" style="width: 4.927em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.736em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1003.63em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-3684"><span class="mi" id="MathJax-Span-3685" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-3686" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-3687" style="font-family: MathJax_Math-italic;">l</span><span class="mi" id="MathJax-Span-3688" style="font-family: MathJax_Math-italic;">o</span><span class="mi" id="MathJax-Span-3689" style="font-family: MathJax_Math-italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-3690"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mi" id="MathJax-Span-3691" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">n</span><span class="mo" id="MathJax-Span-3692" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.504em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-395">O(log n)</script>, so the whole run is <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-396-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3693" style="width: 6.172em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.656em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1004.55em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-3694"><span class="mi" id="MathJax-Span-3695" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-3696" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-3697" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-3698"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mi" id="MathJax-Span-3699" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">l</span><span class="mi" id="MathJax-Span-3700" style="font-family: MathJax_Math-italic;">o</span><span class="mi" id="MathJax-Span-3701" style="font-family: MathJax_Math-italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-3702"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mi" id="MathJax-Span-3703" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">n</span><span class="mo" id="MathJax-Span-3704" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.504em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-396">O(n log n)</script>. Memory is <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-397-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3705" style="width: 2.871em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.167em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1002.06em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-3706"><span class="mi" id="MathJax-Span-3707" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-3708" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-3709" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-3710" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-397">O(n)</script>.</p><p>Why correct. For each mn the inner while moves med upward greedily until the moment no subarray with minimum mn can keep the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-398-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3711" style="width: 8.661em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.55em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1006.55em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-3712"><span class="mi" id="MathJax-Span-3713" style="font-family: MathJax_Math-italic;">m</span><span class="mi" id="MathJax-Span-3714" style="font-family: MathJax_Math-italic;">e</span><span class="mi" id="MathJax-Span-3715" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-3716" style="font-family: MathJax_Math-italic;">i</span><span class="mi" id="MathJax-Span-3717" style="font-family: MathJax_Math-italic;">a</span><span class="mi" id="MathJax-Span-3718" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-3719" style="font-family: MathJax_Main; padding-left: 0.273em;">≥</span><span class="mo" id="MathJax-Span-3720"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 76%; font-style: normal; font-weight: normal;"> </span></span><span class="mi" id="MathJax-Span-3721" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">m</span><span class="mi" id="MathJax-Span-3722" style="font-family: MathJax_Math-italic;">e</span><span class="mi" id="MathJax-Span-3723" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-398">median ≥ med</script>; thus the last valid value of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-399-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3724" style="width: 2.438em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.843em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1001.84em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-3725"><span class="mi" id="MathJax-Span-3726" style="font-family: MathJax_Math-italic;">m</span><span class="mi" id="MathJax-Span-3727" style="font-family: MathJax_Math-italic;">e</span><span class="mi" id="MathJax-Span-3728" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-399">med</script> realises the true maximum for this <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-400-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-3729" style="width: 1.951em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.464em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1001.46em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-3730"><span class="mi" id="MathJax-Span-3731" style="font-family: MathJax_Math-italic;">m</span><span class="mi" id="MathJax-Span-3732" style="font-family: MathJax_Math-italic;">n</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-400">mn</script>. The outer sweep examines every possible minimum, hence the largest gap ever recorded is the global optimum.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> a</span><span class="pun">[</span><span class="lit">200005</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">2</span><span class="pun">];</span><span class="pln">
array</span><span class="pun">&lt;</span><span class="kwd">int</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">&gt;</span><span class="pln"> t</span><span class="pun">[</span><span class="lit">800005</span><span class="pun">];</span><span class="pln">
array</span><span class="pun">&lt;</span><span class="kwd">int</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">&gt;</span><span class="pln"> merge</span><span class="pun">(</span><span class="pln">array</span><span class="pun">&lt;</span><span class="kwd">int</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">&gt;</span><span class="pln">a</span><span class="pun">,</span><span class="pln"> array</span><span class="pun">&lt;</span><span class="kwd">int</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">&gt;</span><span class="pln">b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> ans </span><span class="pun">=</span><span class="pln"> max</span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="lit">0</span><span class="pun">],</span><span class="pln"> b</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]);</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> mxpref </span><span class="pun">=</span><span class="pln"> max</span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="lit">1</span><span class="pun">],</span><span class="pln"> a</span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> b</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]);</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> mxsuff </span><span class="pun">=</span><span class="pln"> max</span><span class="pun">(</span><span class="pln">b</span><span class="pun">[</span><span class="lit">2</span><span class="pun">],</span><span class="pln"> a</span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> b</span><span class="pun">[</span><span class="lit">3</span><span class="pun">]);</span><span class="pln">
    ans </span><span class="pun">=</span><span class="pln"> max</span><span class="pun">({</span><span class="pln">ans</span><span class="pun">,</span><span class="pln"> mxpref</span><span class="pun">,</span><span class="pln"> mxsuff</span><span class="pun">});</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> sum </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> b</span><span class="pun">[</span><span class="lit">3</span><span class="pun">];</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">{</span><span class="pln">ans</span><span class="pun">,</span><span class="pln"> mxpref</span><span class="pun">,</span><span class="pln"> mxsuff</span><span class="pun">,</span><span class="pln"> sum</span><span class="pun">};</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">void</span><span class="pln"> update</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> v</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> tl</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> tr</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> pos</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> val</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">tl </span><span class="pun">==</span><span class="pln"> tr</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        t</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">max</span><span class="pun">(</span><span class="pln">val</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">),</span><span class="pln"> max</span><span class="pun">(</span><span class="pln">val</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">),</span><span class="pln"> max</span><span class="pun">(</span><span class="pln">val</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">),</span><span class="pln"> val</span><span class="pun">};</span><span class="pln">
    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> tm </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">tl </span><span class="pun">+</span><span class="pln"> tr</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&gt;&gt;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">pos </span><span class="pun">&lt;=</span><span class="pln"> tm</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            update</span><span class="pun">(</span><span class="pln">v </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> tl</span><span class="pun">,</span><span class="pln"> tm</span><span class="pun">,</span><span class="pln"> pos</span><span class="pun">,</span><span class="pln"> val</span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            update</span><span class="pun">(</span><span class="pln">v </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> tm </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> tr</span><span class="pun">,</span><span class="pln"> pos</span><span class="pun">,</span><span class="pln"> val</span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        t</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> merge</span><span class="pun">(</span><span class="pln">t</span><span class="pun">[</span><span class="pln">v </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pun">],</span><span class="pln"> t</span><span class="pun">[</span><span class="pln">v </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
array</span><span class="pun">&lt;</span><span class="kwd">int</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">&gt;</span><span class="pln"> </span><span class="kwd">get</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> v</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> tl</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> tr</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> l</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> r</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">tl </span><span class="pun">==</span><span class="pln"> l </span><span class="pun">&amp;&amp;</span><span class="pln"> tr </span><span class="pun">==</span><span class="pln"> r</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> t</span><span class="pun">[</span><span class="pln">v</span><span class="pun">];</span><span class="pln">
    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l </span><span class="pun">&gt;</span><span class="pln"> r</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">{</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">};</span><span class="pln">
    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> tm </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">tl </span><span class="pun">+</span><span class="pln"> tr</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&gt;&gt;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> merge</span><span class="pun">(</span><span class="kwd">get</span><span class="pun">(</span><span class="pln">v </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> tl</span><span class="pun">,</span><span class="pln"> tm</span><span class="pun">,</span><span class="pln"> l</span><span class="pun">,</span><span class="pln"> min</span><span class="pun">(</span><span class="pln">r</span><span class="pun">,</span><span class="pln"> tm</span><span class="pun">)),</span><span class="pln"> </span><span class="kwd">get</span><span class="pun">(</span><span class="pln">v </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> tm </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> tr</span><span class="pun">,</span><span class="pln"> max</span><span class="pun">(</span><span class="pln">l</span><span class="pun">,</span><span class="pln"> tm </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">),</span><span class="pln"> r</span><span class="pun">));</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> solve</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> vector</span><span class="str">&lt;int&gt;</span><span class="pln">A</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> m </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> A</span><span class="pun">[</span><span class="pln">i </span><span class="pun">&amp;</span><span class="pln">mdash</span><span class="pun">;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">];</span><span class="pln">
        m </span><span class="pun">=</span><span class="pln"> max</span><span class="pun">(</span><span class="pln">m</span><span class="pun">,</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    vector</span><span class="str">&lt;int&gt;</span><span class="pln">ind</span><span class="pun">[</span><span class="pln">m </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">];</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        ind</span><span class="pun">[</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]].</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">i</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    stack</span><span class="str">&lt;int&gt;</span><span class="pln">s</span><span class="pun">;</span><span class="pln">
    s</span><span class="pun">.</span><span class="pln">push</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    a</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">-</span><span class="pln">INT_MAX</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> l</span><span class="pun">[</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">];</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">s</span><span class="pun">.</span><span class="pln">top</span><span class="pun">()]</span><span class="pln"> </span><span class="pun">&gt;=</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            s</span><span class="pun">.</span><span class="pln">pop</span><span class="pun">();</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        l</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> s</span><span class="pun">.</span><span class="pln">top</span><span class="pun">()</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
        s</span><span class="pun">.</span><span class="pln">push</span><span class="pun">(</span><span class="pln">i</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    a</span><span class="pun">[</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">-</span><span class="pln">INT_MAX</span><span class="pun">;</span><span class="pln">
    s</span><span class="pun">.</span><span class="pln">push</span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> r</span><span class="pun">[</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">];</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">s</span><span class="pun">.</span><span class="pln">top</span><span class="pun">()]</span><span class="pln"> </span><span class="pun">&gt;=</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            s</span><span class="pun">.</span><span class="pln">pop</span><span class="pun">();</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        r</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> s</span><span class="pun">.</span><span class="pln">top</span><span class="pun">()</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">mdash</span><span class="pun">;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
        s</span><span class="pun">.</span><span class="pln">push</span><span class="pun">(</span><span class="pln">i</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> med </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        update</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> i</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">auto</span><span class="pln"> u </span><span class="pun">:</span><span class="pln"> ind</span><span class="pun">[</span><span class="lit">1</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        update</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> u</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> ans </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> mn </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> mn </span><span class="pun">&lt;=</span><span class="pln"> m</span><span class="pun">;</span><span class="pln"> mn</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">auto</span><span class="pln"> u </span><span class="pun">:</span><span class="pln"> ind</span><span class="pun">[</span><span class="pln">mn</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">int</span><span class="pln"> lg </span><span class="pun">=</span><span class="pln"> l</span><span class="pun">[</span><span class="pln">u</span><span class="pun">],</span><span class="pln"> rg </span><span class="pun">=</span><span class="pln"> r</span><span class="pun">[</span><span class="pln">u</span><span class="pun">];</span><span class="pln">
            </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">med </span><span class="pun">&lt;</span><span class="pln"> m </span><span class="pun">&amp;&amp;</span><span class="pln"> </span><span class="kwd">get</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> lg</span><span class="pun">,</span><span class="pln"> u </span><span class="pun">&amp;</span><span class="pln">mdash</span><span class="pun">;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="kwd">get</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> u </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> rg</span><span class="pun">)[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">u</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> </span><span class="pun">(</span><span class="pln">med</span><span class="pun">)</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                med</span><span class="pun">++;</span><span class="pln">
                </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">auto</span><span class="pln"> u </span><span class="pun">:</span><span class="pln"> ind</span><span class="pun">[</span><span class="pln">med</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    update</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> u</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">);</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="com">// cout &lt;&lt; med &lt;&lt; ' ' &lt;&lt; mn &lt;&lt; endl;</span><span class="pln">
        ans </span><span class="pun">=</span><span class="pln"> max</span><span class="pun">(</span><span class="pln">ans</span><span class="pun">,</span><span class="pln"> med </span><span class="pun">&amp;</span><span class="pln">mdash</span><span class="pun">;</span><span class="pln"> mn</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> ans</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> solveslow</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> vector</span><span class="str">&lt;int&gt;</span><span class="pln">A</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> A</span><span class="pun">[</span><span class="pln">i </span><span class="pun">&amp;</span><span class="pln">mdash</span><span class="pun">;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">];</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> mx </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        vector</span><span class="str">&lt;int&gt;</span><span class="pln">v</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> i</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            v</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]);</span><span class="pln">
            sort</span><span class="pun">(</span><span class="pln">v</span><span class="pun">.</span><span class="kwd">begin</span><span class="pun">(),</span><span class="pln"> v</span><span class="pun">.</span><span class="kwd">end</span><span class="pun">());</span><span class="pln">
            mx </span><span class="pun">=</span><span class="pln"> max</span><span class="pun">(</span><span class="pln">mx</span><span class="pun">,</span><span class="pln"> v</span><span class="pun">[</span><span class="pln">v</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">mdash</span><span class="pun">;</span><span class="pln"> v</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> mx</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> rnd</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">(</span><span class="pln">rand</span><span class="pun">()</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> rand</span><span class="pun">()</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> RAND_MAX</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    ios_base</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="kwd">false</span><span class="pun">);</span><span class="pln">
    cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> tt</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> tt</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pun">(</span><span class="pln">tt</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
        cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
        vector</span><span class="str">&lt;int&gt;</span><span class="pln">v</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">int</span><span class="pln"> x</span><span class="pun">;</span><span class="pln">
            cin </span><span class="pun">&gt;&gt;</span><span class="pln"> x</span><span class="pun">;</span><span class="pln">
            v</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">x</span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        cout </span><span class="pun">&lt;&lt;</span><span class="pln"> solve</span><span class="pun">(</span><span class="pln">n</span><span class="pun">,</span><span class="pln"> v</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> endl</span><span class="pun">;</span><span class="pln">
        </span><span class="com">// cout &lt;&lt; solveslow(n, v) &lt;&lt; endl;</span><span class="pln">
        </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">*</span><span class="lit">4</span><span class="pun">;</span><span class="pln">i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            t</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
            t</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
            t</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
            t</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div></div>

    </div>


        <div style="font-size: 1.1rem;line-height: 1.1rem;padding-bottom: 0.5em;">
            <img src="https://codeforces.com//codeforces.com/codeforces.org/s/52448/images/icons/paperclip-16x16.png" style="vertical-align: middle;"> <span style="padding: 0 0.35em;">Tutorial of <a href="https://codeforces.com/contest/2126" class="notice" style="text-decoration: none;">Codeforces Round 1037 (Div. 3)</a> </span>
        </div>
        
            

  <script>
    // Make all spoilers toggleable
    document.querySelectorAll('.spoiler-title').forEach(title => {
      title.addEventListener('click', function() {
        const spoiler = this.closest('.spoiler');
        spoiler.classList.toggle('open');
      });
    });
    
    // Open all spoilers by default for easier reading
    document.querySelectorAll('.spoiler').forEach(spoiler => {
      spoiler.classList.add('open');
    });
  </script>
</body>
</html>