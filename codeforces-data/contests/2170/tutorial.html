<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tutorial</title>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
      line-height: 1.6;
      color: #333;
      background: #fafafa;
    }
    .ttypography {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    h3 {
      color: #1a1a1a;
      border-bottom: 2px solid #eee;
      padding-bottom: 10px;
    }
    h3 a {
      color: #0066cc;
      text-decoration: none;
    }
    h3 a:hover {
      text-decoration: underline;
    }
    .spoiler {
      margin: 15px 0;
      border: 1px solid #ddd;
      border-radius: 6px;
      overflow: hidden;
    }
    .spoiler-title {
      display: block;
      padding: 12px 15px;
      background: #f0f0f0;
      cursor: pointer;
      font-weight: 600;
      user-select: none;
      border-bottom: 1px solid #ddd;
    }
    .spoiler-title:hover {
      background: #e8e8e8;
    }
    .spoiler-title::before {
      content: '▶ ';
      font-size: 0.8em;
      transition: transform 0.2s;
      display: inline-block;
    }
    .spoiler.open .spoiler-title::before {
      content: '▼ ';
    }
    .spoiler-content {
      padding: 15px;
      background: #fff;
      display: none;
    }
    .spoiler.open .spoiler-content {
      display: block;
    }
    pre, code {
      background: #f5f5f5;
      font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
      font-size: 0.85em;
    }
    pre {
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
    }
    code {
      padding: 2px 5px;
      border-radius: 3px;
    }
    p {
      margin: 10px 0;
    }
    .MathJax {
      font-size: 1.1em;
    }
  </style>
</head>
<body>
  <h1>Editorial</h1>
  <p><a href="https://codeforces.com/blog/entry/148798" target="_blank">View on Codeforces →</a></p>
  
  <div class="ttypography"><p><a href="https://codeforces.com/contest/2170/problem/A" title="Educational Codeforces Round 185 (Rated for Div. 2)">2170A - Maximum Neighborhood</a></p><p>Idea: <a class="rated-user user-red" href="https://codeforces.com/profile/BledDest" title="International Grandmaster BledDest">BledDest</a></p> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2170/problem/A" title="Educational Codeforces Round 185 (Rated for Div. 2)">2170A - Maximum Neighborhood</a></h3><div class="ttypography"><div class="problem-statement"><div><p>Because the matrix is small enough, you can iterate over each cell <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-1-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1" style="width: 2.654em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.005em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1001.9em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-2"><span class="mo" id="MathJax-Span-3" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-4" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-5" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-6" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">j</span><span class="mo" id="MathJax-Span-7" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-1">(i, j)</script> and its neighbors: <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-2-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-8" style="width: 4.873em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.682em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1003.57em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-9"><span class="mo" id="MathJax-Span-10" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-11" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-12" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mn" id="MathJax-Span-13" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-14" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-15" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">j</span><span class="mo" id="MathJax-Span-16" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-2">(i - 1, j)</script>, <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-3-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-17" style="width: 4.873em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.682em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1003.57em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-18"><span class="mo" id="MathJax-Span-19" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-20" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-21" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-22" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-23" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-24" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">j</span><span class="mo" id="MathJax-Span-25" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-3">(i + 1, j)</script>, <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-4-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-26" style="width: 4.873em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.682em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1003.57em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-27"><span class="mo" id="MathJax-Span-28" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-29" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-30" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-31" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">j</span><span class="mo" id="MathJax-Span-32" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mn" id="MathJax-Span-33" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-34" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-4">(i, j - 1)</script>, and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-5-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-35" style="width: 4.873em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.682em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1003.57em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-36"><span class="mo" id="MathJax-Span-37" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-38" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-39" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-40" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">j</span><span class="mo" id="MathJax-Span-41" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-42" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-43" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-5">(i, j + 1)</script> (don't forget to check if these cells exists). This allows you to calculate the cost for each cell.</p><p>However, there are solutions which don't need to consider the whole matrix. We can show that the only four cells we have to consider are <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-6-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-44" style="width: 3.249em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.438em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1002.33em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-45"><span class="mo" id="MathJax-Span-46" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-47" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-48" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-49" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">n</span><span class="mo" id="MathJax-Span-50" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-6">(n, n)</script>, <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-7-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-51" style="width: 5.468em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.115em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1004.01em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-52"><span class="mo" id="MathJax-Span-53" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-54" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-55" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mn" id="MathJax-Span-56" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-57" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-58" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">n</span><span class="mo" id="MathJax-Span-59" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-7">(n-1, n)</script>, <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-8-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-60" style="width: 5.468em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.115em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1004.01em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-61"><span class="mo" id="MathJax-Span-62" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-63" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-64" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-65" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">n</span><span class="mo" id="MathJax-Span-66" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mn" id="MathJax-Span-67" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-68" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-8">(n, n-1)</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-9-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-69" style="width: 7.741em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.847em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1005.74em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-70"><span class="mo" id="MathJax-Span-71" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-72" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-73" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mn" id="MathJax-Span-74" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-75" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-76" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">n</span><span class="mo" id="MathJax-Span-77" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mn" id="MathJax-Span-78" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-79" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-9">(n-1, n-1)</script> — the two rightmost cells in the last two rows. For every other cell, the cost of the cell below it or to the right of it will be strictly greater. This allows us to check only four cells.</p><p>In fact, we can also show that for <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-10-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-80" style="width: 3.249em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.438em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1002.38em, 2.492em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-81"><span class="mi" id="MathJax-Span-82" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-83" style="font-family: MathJax_Main; padding-left: 0.273em;">≥</span><span class="mn" id="MathJax-Span-84" style="font-family: MathJax_Main; padding-left: 0.273em;">5</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 1.218em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-10">n \ge 5</script>, the cell <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-11-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-85" style="width: 7.741em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.847em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1005.74em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-86"><span class="mo" id="MathJax-Span-87" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-88" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-89" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mn" id="MathJax-Span-90" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-91" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-92" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">n</span><span class="mo" id="MathJax-Span-93" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mn" id="MathJax-Span-94" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-95" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-11">(n-1, n-1)</script> is the optimal one, and its cost can be calculated using a simple formula. And the answers for <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-12-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-96" style="width: 3.249em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.438em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1002.38em, 2.384em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-97"><span class="mi" id="MathJax-Span-98" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-99" style="font-family: MathJax_Main; padding-left: 0.273em;">&lt;</span><span class="mn" id="MathJax-Span-100" style="font-family: MathJax_Main; padding-left: 0.273em;">5</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.139em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-12">n < 5</script> are given in the problem statement.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Solution 1 (Neon)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
 
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> dx</span><span class="pun">[]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{-</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">};</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> dy</span><span class="pun">[]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">};</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">t</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
        cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">auto</span><span class="pln"> </span><span class="kwd">get</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[&amp;](</span><span class="kwd">int</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> y</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> x </span><span class="pun">&lt;</span><span class="pln"> n </span><span class="pun">&amp;&amp;</span><span class="pln"> y </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> y </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> x </span><span class="pun">*</span><span class="pln"> n </span><span class="pun">+</span><span class="pln"> y </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">};</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> ans </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">j</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="kwd">int</span><span class="pln"> cur </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">get</span><span class="pun">(</span><span class="pln">i</span><span class="pun">,</span><span class="pln"> j</span><span class="pun">);</span><span class="pln">
                </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> d </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> d </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">4</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">d</span><span class="pun">)</span><span class="pln"> cur </span><span class="pun">+=</span><span class="pln"> </span><span class="kwd">get</span><span class="pun">(</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> dx</span><span class="pun">[</span><span class="pln">d</span><span class="pun">],</span><span class="pln"> j </span><span class="pun">+</span><span class="pln"> dy</span><span class="pun">[</span><span class="pln">d</span><span class="pun">]);</span><span class="pln">
                ans </span><span class="pun">=</span><span class="pln"> max</span><span class="pun">(</span><span class="pln">ans</span><span class="pun">,</span><span class="pln"> cur</span><span class="pun">);</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        cout </span><span class="pun">&lt;&lt;</span><span class="pln"> ans </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div> <div class="spoiler"><b class="spoiler-title">Solution 2 (Neon)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
 
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
  cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">t</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> ans </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">n </span><span class="pun">==</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> ans </span><span class="pun">=</span><span class="pln"> </span><span class="lit">9</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">n </span><span class="pun">==</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> n </span><span class="pun">==</span><span class="pln"> </span><span class="lit">4</span><span class="pun">)</span><span class="pln"> ans </span><span class="pun">=</span><span class="pln"> </span><span class="lit">4</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> n </span><span class="pun">*</span><span class="pln"> n </span><span class="pun">-</span><span class="pln"> n </span><span class="pun">-</span><span class="pln"> </span><span class="lit">4</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">n </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">4</span><span class="pun">)</span><span class="pln"> ans </span><span class="pun">=</span><span class="pln"> </span><span class="lit">5</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> n </span><span class="pun">*</span><span class="pln"> n </span><span class="pun">-</span><span class="pln"> </span><span class="lit">5</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> n </span><span class="pun">-</span><span class="pln"> </span><span class="lit">5</span><span class="pun">;</span><span class="pln">
    cout </span><span class="pun">&lt;&lt;</span><span class="pln"> ans </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2170/problem/B" title="Educational Codeforces Round 185 (Rated for Div. 2)">2170B - Addition on a Segment</a></p><p>Idea: <a class="rated-user user-orange" href="https://codeforces.com/profile/FelixArg" title="Master FelixArg">FelixArg</a></p> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2170/problem/B" title="Educational Codeforces Round 185 (Rated for Div. 2)">2170B - Addition on a Segment</a></h3><div class="ttypography"><div class="problem-statement"><div><p>Let's count the number of non-zero elements in the array <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-13-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-101" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.436em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.44em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-102"><span class="mi" id="MathJax-Span-103" style="font-family: MathJax_Math-italic;">c</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-13">c</script>, as well as the sum of its elements <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-14-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-104" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.44em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-105"><span class="mi" id="MathJax-Span-106" style="font-family: MathJax_Math-italic;">s</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-14">s</script>. If <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-15-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-107" style="width: 7.578em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.739em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1005.68em, 2.492em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-108"><span class="mi" id="MathJax-Span-109" style="font-family: MathJax_Math-italic;">s</span><span class="mo" id="MathJax-Span-110" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mi" id="MathJax-Span-111" style="font-family: MathJax_Math-italic; padding-left: 0.219em;">c</span><span class="mo" id="MathJax-Span-112" style="font-family: MathJax_Main; padding-left: 0.273em;">≥</span><span class="mi" id="MathJax-Span-113" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">n</span><span class="mo" id="MathJax-Span-114" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mn" id="MathJax-Span-115" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 1.218em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-15">s - c \ge n - 1</script>, then the answer is <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-16-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-116" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.436em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.44em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-117"><span class="mi" id="MathJax-Span-118" style="font-family: MathJax_Math-italic;">c</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-16">c</script>; otherwise, the answer is the largest <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-17-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-119" style="width: 0.923em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1000.71em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-120"><span class="msup" id="MathJax-Span-121"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-122" style="font-family: MathJax_Math-italic;">c</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -4.38em; left: 0.436em;"><span class="mo" id="MathJax-Span-123" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-17">c'</script> such that <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-18-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-124" style="width: 5.685em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.278em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1004.28em, 2.384em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-125"><span class="mn" id="MathJax-Span-126" style="font-family: MathJax_Main;">0</span><span class="mo" id="MathJax-Span-127" style="font-family: MathJax_Main; padding-left: 0.273em;">&lt;</span><span class="msup" id="MathJax-Span-128" style="padding-left: 0.273em;"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-129" style="font-family: MathJax_Math-italic;">c</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -4.38em; left: 0.436em;"><span class="mo" id="MathJax-Span-130" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-131" style="font-family: MathJax_Main; padding-left: 0.273em;">&lt;</span><span class="mi" id="MathJax-Span-132" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">c</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.139em; border-left: 0px solid; width: 0px; height: 1.218em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-18">0 < c' < c</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-19-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-133" style="width: 7.957em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.009em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1005.96em, 2.492em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-134"><span class="mi" id="MathJax-Span-135" style="font-family: MathJax_Math-italic;">s</span><span class="mo" id="MathJax-Span-136" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="msup" id="MathJax-Span-137" style="padding-left: 0.219em;"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-138" style="font-family: MathJax_Math-italic;">c</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -4.38em; left: 0.436em;"><span class="mo" id="MathJax-Span-139" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-140" style="font-family: MathJax_Main; padding-left: 0.273em;">≥</span><span class="mi" id="MathJax-Span-141" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">n</span><span class="mo" id="MathJax-Span-142" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mn" id="MathJax-Span-143" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 1.361em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-19">s - c' \ge n - 1</script>.</p><p>Such a <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-20-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-144" style="width: 0.923em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1000.71em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-145"><span class="msup" id="MathJax-Span-146"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-147" style="font-family: MathJax_Math-italic;">c</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -4.38em; left: 0.436em;"><span class="mo" id="MathJax-Span-148" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-20">c'</script> can be found by simple enumeration or calculated using the formula:</p><p><span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-21-Frame" tabindex="0" style="text-align: center;"><nobr><span class="math" id="MathJax-Span-149" style="width: 12.611em; display: inline-block;"><span style="display: inline-block; position: relative; width: 9.527em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1009.42em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-150"><span class="msup" id="MathJax-Span-151"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-152" style="font-family: MathJax_Math-italic;">c</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -4.435em; left: 0.436em;"><span class="mo" id="MathJax-Span-153" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-154" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mo" id="MathJax-Span-155" style="font-family: MathJax_Main; padding-left: 0.273em;">min</span><span class="mrow" id="MathJax-Span-156" style="padding-left: 0.165em;"><span class="mo" id="MathJax-Span-157" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-158" style="font-family: MathJax_Math-italic;">c</span><span class="mo" id="MathJax-Span-159" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-160" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">s</span><span class="mo" id="MathJax-Span-161" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mi" id="MathJax-Span-162" style="font-family: MathJax_Math-italic; padding-left: 0.219em;">n</span><span class="mo" id="MathJax-Span-163" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-164" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-165" style="font-family: MathJax_Main;">)</span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.575em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-21"> c' = \min \left( c, s - n + 1 \right)</script></p><p>The first bound in the formula is quite obvious: if an element is equal to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-22-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-166" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-167"><span class="mn" id="MathJax-Span-168" style="font-family: MathJax_Main;">0</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-22">0</script>, then no operation has changed it, and therefore the longest segment could not be longer than <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-23-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-169" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.436em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.44em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-170"><span class="mi" id="MathJax-Span-171" style="font-family: MathJax_Math-italic;">c</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-23">c</script>.</p><p>The second bound is a bit trickier. Each operation is a segment of length <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-24-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-172" style="width: 8.282em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.28em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1006.23em, 2.492em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-173"><span class="mi" id="MathJax-Span-174" style="font-family: MathJax_Math-italic;">L</span><span class="mo" id="MathJax-Span-175" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="msubsup" id="MathJax-Span-176" style="padding-left: 0.273em;"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-177" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="texatom" id="MathJax-Span-178"><span class="mrow" id="MathJax-Span-179"><span class="mi" id="MathJax-Span-180" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-181" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="msubsup" id="MathJax-Span-182" style="padding-left: 0.219em;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.27em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-183" style="font-family: MathJax_Math-italic;">l</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.327em;"><span class="texatom" id="MathJax-Span-184"><span class="mrow" id="MathJax-Span-185"><span class="mi" id="MathJax-Span-186" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-187" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-188" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-24">L = r_{i} - l_{i} + 1</script> on which we add <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-25-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-189" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-190"><span class="mn" id="MathJax-Span-191" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-25">1</script> to all its elements. In total, across all operations, we have added <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-26-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-192" style="width: 13.314em; display: inline-block;"><span style="display: inline-block; position: relative; width: 10.068em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1010.07em, 2.492em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-193"><span class="mi" id="MathJax-Span-194" style="font-family: MathJax_Math-italic;">s</span><span class="mo" id="MathJax-Span-195" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="msubsup" id="MathJax-Span-196" style="padding-left: 0.273em;"><span style="display: inline-block; position: relative; width: 1.139em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.65em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-197" style="font-family: MathJax_Math-italic;">L</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.706em;"><span class="texatom" id="MathJax-Span-198"><span class="mrow" id="MathJax-Span-199"><span class="mn" id="MathJax-Span-200" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-201" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="msubsup" id="MathJax-Span-202" style="padding-left: 0.219em;"><span style="display: inline-block; position: relative; width: 1.139em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.65em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-203" style="font-family: MathJax_Math-italic;">L</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.706em;"><span class="texatom" id="MathJax-Span-204"><span class="mrow" id="MathJax-Span-205"><span class="mn" id="MathJax-Span-206" style="font-size: 70.7%; font-family: MathJax_Main;">2</span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-207" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mo" id="MathJax-Span-208" style="font-family: MathJax_Main; padding-left: 0.219em;">⋯</span><span class="mo" id="MathJax-Span-209" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="msubsup" id="MathJax-Span-210" style="padding-left: 0.219em;"><span style="display: inline-block; position: relative; width: 1.193em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.65em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-211" style="font-family: MathJax_Math-italic;">L</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.706em;"><span class="texatom" id="MathJax-Span-212"><span class="mrow" id="MathJax-Span-213"><span class="mi" id="MathJax-Span-214" style="font-size: 70.7%; font-family: MathJax_Math-italic;">n</span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-26">s = L_{1} + L_{2} + \dots + L_{n}</script>. The longest segment among all operations is <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-27-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-215" style="width: 0.923em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1000.71em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-216"><span class="msup" id="MathJax-Span-217"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-218" style="font-family: MathJax_Math-italic;">c</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -4.38em; left: 0.436em;"><span class="mo" id="MathJax-Span-219" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-27">c'</script>, then:</p><ul> <li> one segment has length <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-28-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-220" style="width: 0.923em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1000.71em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-221"><span class="msup" id="MathJax-Span-222"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-223" style="font-family: MathJax_Math-italic;">c</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -4.38em; left: 0.436em;"><span class="mo" id="MathJax-Span-224" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-28">c'</script>; </li><li> the other segments have length of at least <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-29-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-225" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-226"><span class="mn" id="MathJax-Span-227" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-29">1</script> according to the problem statement. </li></ul><p>This means:</p><p><span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-30-Frame" tabindex="0" style="text-align: center;"><nobr><span class="math" id="MathJax-Span-228" style="width: 11.042em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.336em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1008.28em, 2.492em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-229"><span class="mi" id="MathJax-Span-230" style="font-family: MathJax_Math-italic;">s</span><span class="mo" id="MathJax-Span-231" style="font-family: MathJax_Main; padding-left: 0.273em;">≥</span><span class="msup" id="MathJax-Span-232" style="padding-left: 0.273em;"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-233" style="font-family: MathJax_Math-italic;">c</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -4.435em; left: 0.436em;"><span class="mo" id="MathJax-Span-234" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-235" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-236" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-237" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mo" id="MathJax-Span-238" style="font-family: MathJax_Main; padding-left: 0.219em;">⋯</span><span class="mo" id="MathJax-Span-239" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-240" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 1.361em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-30">s \ge c' + 1 + \dots + 1</script></p><p><span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-31-Frame" tabindex="0" style="text-align: center;"><nobr><span class="math" id="MathJax-Span-241" style="width: 9.04em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.821em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1006.71em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-242"><span class="mi" id="MathJax-Span-243" style="font-family: MathJax_Math-italic;">s</span><span class="mo" id="MathJax-Span-244" style="font-family: MathJax_Main; padding-left: 0.273em;">≥</span><span class="msup" id="MathJax-Span-245" style="padding-left: 0.273em;"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-246" style="font-family: MathJax_Math-italic;">c</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -4.435em; left: 0.436em;"><span class="mo" id="MathJax-Span-247" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-248" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mo" id="MathJax-Span-249" style="font-family: MathJax_Main; padding-left: 0.219em;">(</span><span class="mi" id="MathJax-Span-250" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-251" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mn" id="MathJax-Span-252" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-253" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.575em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-31">s \ge c' + (n - 1)</script></p><p><span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-32-Frame" tabindex="0" style="text-align: center;"><nobr><span class="math" id="MathJax-Span-254" style="width: 7.957em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.009em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1005.96em, 2.492em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-255"><span class="msup" id="MathJax-Span-256"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-257" style="font-family: MathJax_Math-italic;">c</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -4.435em; left: 0.436em;"><span class="mo" id="MathJax-Span-258" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-259" style="font-family: MathJax_Main; padding-left: 0.273em;">≤</span><span class="mi" id="MathJax-Span-260" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">s</span><span class="mo" id="MathJax-Span-261" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mi" id="MathJax-Span-262" style="font-family: MathJax_Math-italic; padding-left: 0.219em;">n</span><span class="mo" id="MathJax-Span-263" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-264" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 1.361em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-32">c' \le s - n + 1</script></p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Solution (FelixArg)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
 
</span><span class="com">#define</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pln">
 
</span><span class="kwd">void</span><span class="pln"> solve</span><span class="pun">(){</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
    vector</span><span class="str">&lt;int&gt;</span><span class="pln"> a</span><span class="pun">(</span><span class="pln">n</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++){</span><span class="pln">
        cin </span><span class="pun">&gt;&gt;</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
 
    </span><span class="kwd">int</span><span class="pln"> sum </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> cnt_one </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
 
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++){</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">){</span><span class="pln">
            cnt_one</span><span class="pun">++;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        sum </span><span class="pun">+=</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
 
    </span><span class="kwd">int</span><span class="pln"> sum2 </span><span class="pun">=</span><span class="pln"> sum </span><span class="pun">-</span><span class="pln"> cnt_one</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> </span><span class="kwd">sub</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> n </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> sum2</span><span class="pun">;</span><span class="pln">
 
    cout </span><span class="pun">&lt;&lt;</span><span class="pln"> cnt_one </span><span class="pun">-</span><span class="pln"> max</span><span class="pun">(</span><span class="lit">0ll</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">sub</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">signed</span><span class="pln"> main</span><span class="pun">()</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
</span><span class="com">#ifdef</span><span class="pln"> FELIX
    </span><span class="kwd">auto</span><span class="pln"> _clock_start </span><span class="pun">=</span><span class="pln"> chrono</span><span class="pun">::</span><span class="pln">high_resolution_clock</span><span class="pun">::</span><span class="pln">now</span><span class="pun">();</span><span class="pln">
</span><span class="com">#endif</span><span class="pln">
    ios_base</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="kwd">false</span><span class="pun">);</span><span class="pln">
    cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    cout</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
 
    </span><span class="kwd">int</span><span class="pln"> t </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pun">(</span><span class="pln">t</span><span class="pun">--){</span><span class="pln">
        solve</span><span class="pun">();</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
 
</span><span class="com">#ifdef</span><span class="pln"> FELIX
    cerr </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"Executed in "</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> chrono</span><span class="pun">::</span><span class="pln">duration_cast</span><span class="pun">&lt;</span><span class="pln">chrono</span><span class="pun">::</span><span class="pln">milliseconds</span><span class="pun">&gt;(</span><span class="pln">
        chrono</span><span class="pun">::</span><span class="pln">high_resolution_clock</span><span class="pun">::</span><span class="pln">now</span><span class="pun">()</span><span class="pln">
            </span><span class="pun">-</span><span class="pln"> _clock_start</span><span class="pun">).</span><span class="pln">count</span><span class="pun">()</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"ms."</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> endl</span><span class="pun">;</span><span class="pln">
</span><span class="com">#endif</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2170/problem/C" title="Educational Codeforces Round 185 (Rated for Div. 2)">2170C - Quotient and Remainder</a></p><p>Idea: <a class="rated-user user-red" href="https://codeforces.com/profile/BledDest" title="International Grandmaster BledDest">BledDest</a></p> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2170/problem/C" title="Educational Codeforces Round 185 (Rated for Div. 2)">2170C - Quotient and Remainder</a></h3><div class="ttypography"><div class="problem-statement"><div><p>Suppose we want to remove a pair of numbers <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-33-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-265" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.76em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-266"><span class="msubsup" id="MathJax-Span-267"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-268" style="font-family: MathJax_Math-italic;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-269" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-33">q_i</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-34-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-270" style="width: 1.085em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.81em, 2.546em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-271"><span class="msubsup" id="MathJax-Span-272"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-273" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-274" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-34">r_j</script>. We need to determine the minimum <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-35-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-275" style="width: 0.814em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.54em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-276"><span class="mi" id="MathJax-Span-277" style="font-family: MathJax_Math-italic;">x</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-35">x</script> required for this. Since <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-36-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-278" style="width: 7.362em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.576em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1005.58em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-279"><span class="mi" id="MathJax-Span-280" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-281" style="font-family: MathJax_Main; padding-left: 0.273em; padding-right: 0.273em;">mod</span><span class="mi" id="MathJax-Span-282" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-283" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="msubsup" id="MathJax-Span-284" style="padding-left: 0.273em;"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-285" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-286" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.361em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-36">x \bmod y = r_i</script>, then <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-37-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-287" style="width: 3.466em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.6em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.464em, 1002.6em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-288"><span class="mi" id="MathJax-Span-289" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-290" style="font-family: MathJax_Main; padding-left: 0.273em;">&gt;</span><span class="msubsup" id="MathJax-Span-291" style="padding-left: 0.273em;"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-292" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-293" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-37">y > r_i</script>, or <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-38-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-294" style="width: 5.739em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.332em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1004.28em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-295"><span class="mi" id="MathJax-Span-296" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-297" style="font-family: MathJax_Main; padding-left: 0.273em;">≥</span><span class="msubsup" id="MathJax-Span-298" style="padding-left: 0.273em;"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-299" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-300" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-301" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-302" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-38">y \ge r_j + 1</script>. We also know that <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-39-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-303" style="width: 5.143em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.899em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.897em, 1003.9em, 4.007em, -999.997em); top: -3.19em; left: 0em;"><span class="mrow" id="MathJax-Span-304"><span class="mrow" id="MathJax-Span-305"><span class="mo" id="MathJax-Span-306" style="vertical-align: 0em;"><span style="font-family: MathJax_Size2;">⌊</span></span><span class="mfrac" id="MathJax-Span-307"><span style="display: inline-block; position: relative; width: 0.544em; height: 0px; margin-right: 0.111em; margin-left: 0.111em;"><span style="position: absolute; clip: rect(3.52em, 1000.38em, 4.169em, -999.997em); top: -4.435em; left: 50%; margin-left: -0.214em;"><span class="mi" id="MathJax-Span-308" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; clip: rect(3.52em, 1000.33em, 4.332em, -999.997em); top: -3.677em; left: 50%; margin-left: -0.16em;"><span class="mi" id="MathJax-Span-309" style="font-size: 70.7%; font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; clip: rect(0.869em, 1000.54em, 1.247em, -999.997em); top: -1.296em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.544em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.085em;"></span></span></span></span><span class="mo" id="MathJax-Span-310" style="vertical-align: 0em;"><span style="font-family: MathJax_Size2;">⌋</span></span></span><span class="mo" id="MathJax-Span-311" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="msubsup" id="MathJax-Span-312" style="padding-left: 0.273em;"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-313" style="font-family: MathJax_Math-italic;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-314" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.195em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.925em; border-left: 0px solid; width: 0px; height: 2.504em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-39">\left\lfloor \frac{x}{y} \right\rfloor = q_i</script>, thus <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-40-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-315" style="width: 31.496em; display: inline-block;"><span style="display: inline-block; position: relative; width: 23.866em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.897em, 1023.87em, 4.007em, -999.997em); top: -3.19em; left: 0em;"><span class="mrow" id="MathJax-Span-316"><span class="mi" id="MathJax-Span-317" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-318" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mi" id="MathJax-Span-319" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-320" style="font-family: MathJax_Main; padding-left: 0.219em;">⋅</span><span class="mrow" id="MathJax-Span-321" style="padding-left: 0.219em;"><span class="mo" id="MathJax-Span-322" style="vertical-align: 0em;"><span style="font-family: MathJax_Size2;">⌊</span></span><span class="mfrac" id="MathJax-Span-323"><span style="display: inline-block; position: relative; width: 0.544em; height: 0px; margin-right: 0.111em; margin-left: 0.111em;"><span style="position: absolute; clip: rect(3.52em, 1000.38em, 4.169em, -999.997em); top: -4.435em; left: 50%; margin-left: -0.214em;"><span class="mi" id="MathJax-Span-324" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; clip: rect(3.52em, 1000.33em, 4.332em, -999.997em); top: -3.677em; left: 50%; margin-left: -0.16em;"><span class="mi" id="MathJax-Span-325" style="font-size: 70.7%; font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; clip: rect(0.869em, 1000.54em, 1.247em, -999.997em); top: -1.296em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.544em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.085em;"></span></span></span></span><span class="mo" id="MathJax-Span-326" style="vertical-align: 0em;"><span style="font-family: MathJax_Size2;">⌋</span></span></span><span class="mo" id="MathJax-Span-327" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mo" id="MathJax-Span-328" style="font-family: MathJax_Main; padding-left: 0.219em;">(</span><span class="mi" id="MathJax-Span-329" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-330" style="font-family: MathJax_Main; padding-left: 0.273em; padding-right: 0.273em;">mod</span><span class="mi" id="MathJax-Span-331" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-332" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-333" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mi" id="MathJax-Span-334" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-335" style="font-family: MathJax_Main; padding-left: 0.219em;">⋅</span><span class="msubsup" id="MathJax-Span-336" style="padding-left: 0.219em;"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-337" style="font-family: MathJax_Math-italic;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-338" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-339" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="msubsup" id="MathJax-Span-340" style="padding-left: 0.219em;"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-341" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-342" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-343" style="font-family: MathJax_Main; padding-left: 0.273em;">≥</span><span class="mo" id="MathJax-Span-344" style="font-family: MathJax_Main; padding-left: 0.273em;">(</span><span class="msubsup" id="MathJax-Span-345"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-346" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-347" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-348" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-349" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-350" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-351" style="font-family: MathJax_Main; padding-left: 0.219em;">⋅</span><span class="msubsup" id="MathJax-Span-352" style="padding-left: 0.219em;"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-353" style="font-family: MathJax_Math-italic;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-354" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-355" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="msubsup" id="MathJax-Span-356" style="padding-left: 0.219em;"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-357" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-358" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.195em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.925em; border-left: 0px solid; width: 0px; height: 2.504em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-40">x = y \cdot \left\lfloor \frac{x}{y} \right\rfloor + (x \bmod y) = y \cdot q_i + r_j \ge (r_j + 1) \cdot q_i + r_j</script>.</p><p>Notice that if we take <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-41-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-359" style="width: 10.609em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.011em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1008.01em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-360"><span class="mi" id="MathJax-Span-361" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-362" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="msubsup" id="MathJax-Span-363" style="padding-left: 0.273em;"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-364" style="font-family: MathJax_Math-italic;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-365" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-366" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-367"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-368" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-369" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-370" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-371" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-372" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-373" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="msubsup" id="MathJax-Span-374" style="padding-left: 0.219em;"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-375" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-376" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.504em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-41">x = q_i (r_j + 1) + r_j</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-42-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-377" style="width: 5.739em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.332em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1004.28em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-378"><span class="mi" id="MathJax-Span-379" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-380" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="msubsup" id="MathJax-Span-381" style="padding-left: 0.273em;"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-382" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-383" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-384" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-385" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-42">y = r_j + 1</script>, then this pair <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-43-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-386" style="width: 0.814em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.54em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-387"><span class="mi" id="MathJax-Span-388" style="font-family: MathJax_Math-italic;">x</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-43">x</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-44-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-389" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.49em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-390"><span class="mi" id="MathJax-Span-391" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-44">y</script> indeed works for us. Therefore, we can remove the pair of elements <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-45-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-392" style="width: 3.736em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.817em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1002.71em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-393"><span class="mo" id="MathJax-Span-394" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-395"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-396" style="font-family: MathJax_Math-italic;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-397" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-398" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-399" style="padding-left: 0.165em;"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-400" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-401" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-402" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.504em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-45">(q_i, r_j)</script> if and only if <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-46-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-403" style="width: 10.501em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.957em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1007.96em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-404"><span class="msubsup" id="MathJax-Span-405"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-406" style="font-family: MathJax_Math-italic;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-407" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-408" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-409"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-410" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-411" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-412" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-413" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-414" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-415" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="msubsup" id="MathJax-Span-416" style="padding-left: 0.219em;"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-417" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-418" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-419" style="font-family: MathJax_Main; padding-left: 0.273em;">≤</span><span class="mi" id="MathJax-Span-420" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">k</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.504em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-46">q_i (r_j + 1) + r_j \le k</script>.</p><p>Thus, our task is to form the largest number of pairs <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-47-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-421" style="width: 3.736em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.817em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1002.71em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-422"><span class="mo" id="MathJax-Span-423" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-424"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-425" style="font-family: MathJax_Math-italic;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-426" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-427" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-428" style="padding-left: 0.165em;"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-429" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-430" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-431" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.504em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-47">(q_i, r_j)</script> such that <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-48-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-432" style="width: 23.163em; display: inline-block;"><span style="display: inline-block; position: relative; width: 17.535em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1017.53em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-433"><span class="msubsup" id="MathJax-Span-434"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-435" style="font-family: MathJax_Math-italic;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-436" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-437" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-438"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-439" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-440" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-441" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-442" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-443" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-444" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="msubsup" id="MathJax-Span-445" style="padding-left: 0.219em;"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-446" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-447" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-448" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mo" id="MathJax-Span-449" style="font-family: MathJax_Main; padding-left: 0.273em;">(</span><span class="msubsup" id="MathJax-Span-450"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-451" style="font-family: MathJax_Math-italic;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-452" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-453" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-454" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-455" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-456" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-457"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-458" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-459" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-460" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-461" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-462" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-463" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mn" id="MathJax-Span-464" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-465" style="font-family: MathJax_Main; padding-left: 0.273em;">≤</span><span class="mi" id="MathJax-Span-466" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">k</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.504em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-48">q_i (r_j + 1) + r_j = (q_i + 1)(r_j + 1) - 1 \le k</script>. Since if we can form <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-49-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-467" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.436em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.44em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-468"><span class="mi" id="MathJax-Span-469" style="font-family: MathJax_Math-italic;">c</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-49">c</script> pairs, we can also form <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-50-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-470" style="width: 2.871em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.167em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1002.11em, 2.438em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-471"><span class="mi" id="MathJax-Span-472" style="font-family: MathJax_Math-italic;">c</span><span class="mo" id="MathJax-Span-473" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mn" id="MathJax-Span-474" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.211em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-50">c - 1</script> pairs, we can apply binary search on the answer.</p><p>Now our task is to determine whether we can form exactly <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-51-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-475" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.436em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.44em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-476"><span class="mi" id="MathJax-Span-477" style="font-family: MathJax_Math-italic;">c</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-51">c</script> pairs. Since our constraint is an upper limit on the product, it is always optimal to take the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-52-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-478" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.436em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.44em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-479"><span class="mi" id="MathJax-Span-480" style="font-family: MathJax_Math-italic;">c</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-52">c</script> smallest <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-53-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-481" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.76em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-482"><span class="msubsup" id="MathJax-Span-483"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-484" style="font-family: MathJax_Math-italic;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-485" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-53">q_i</script> and pair them with the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-54-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-486" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.436em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.44em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-487"><span class="mi" id="MathJax-Span-488" style="font-family: MathJax_Math-italic;">c</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-54">c</script> smallest <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-55-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-489" style="width: 1.085em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.81em, 2.546em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-490"><span class="msubsup" id="MathJax-Span-491"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-492" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-493" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-55">r_j</script>. Therefore, let's sort the arrays <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-56-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-494" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.436em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.44em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-495"><span class="mi" id="MathJax-Span-496" style="font-family: MathJax_Math-italic;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-56">q</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-57-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-497" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.436em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.44em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-498"><span class="mi" id="MathJax-Span-499" style="font-family: MathJax_Math-italic;">r</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-57">r</script> in ascending order&nbsp;— then our task is to pair prefix of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-58-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-500" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.436em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.44em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-501"><span class="mi" id="MathJax-Span-502" style="font-family: MathJax_Math-italic;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-58">q</script> with prefix of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-59-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-503" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.436em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.44em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-504"><span class="mi" id="MathJax-Span-505" style="font-family: MathJax_Math-italic;">r</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-59">r</script> of length <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-60-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-506" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.436em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.44em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-507"><span class="mi" id="MathJax-Span-508" style="font-family: MathJax_Math-italic;">c</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-60">c</script>.</p><p>Next, we need to show that it is always optimal to pair the smallest <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-61-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-509" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.76em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-510"><span class="msubsup" id="MathJax-Span-511"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-512" style="font-family: MathJax_Math-italic;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-513" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-61">q_i</script> with the largest <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-62-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-514" style="width: 1.085em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.81em, 2.546em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-515"><span class="msubsup" id="MathJax-Span-516"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-517" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-518" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-62">r_j</script>, that is, <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-63-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-519" style="width: 1.139em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.87em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-520"><span class="msubsup" id="MathJax-Span-521"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-522" style="font-family: MathJax_Math-italic;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mn" id="MathJax-Span-523" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-63">q_1</script> with <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-64-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-524" style="width: 1.085em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.81em, 2.438em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-525"><span class="msubsup" id="MathJax-Span-526"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-527" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-528" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 0.932em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-64">r_c</script>, <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-65-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-529" style="width: 1.139em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.87em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-530"><span class="msubsup" id="MathJax-Span-531"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-532" style="font-family: MathJax_Math-italic;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mn" id="MathJax-Span-533" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-65">q_2</script> with <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-66-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-534" style="width: 2.33em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.734em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1001.73em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-535"><span class="msubsup" id="MathJax-Span-536"><span style="display: inline-block; position: relative; width: 1.734em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-537" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="texatom" id="MathJax-Span-538"><span class="mrow" id="MathJax-Span-539"><span class="mi" id="MathJax-Span-540" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span class="mo" id="MathJax-Span-541" style="font-size: 70.7%; font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-542" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-66">r_{c-1}</script>, <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-67-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-543" style="width: 1.139em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.87em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-544"><span class="msubsup" id="MathJax-Span-545"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-546" style="font-family: MathJax_Math-italic;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mn" id="MathJax-Span-547" style="font-size: 70.7%; font-family: MathJax_Main;">3</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-67">q_3</script> with <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-68-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-548" style="width: 2.33em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.734em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1001.73em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-549"><span class="msubsup" id="MathJax-Span-550"><span style="display: inline-block; position: relative; width: 1.734em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-551" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="texatom" id="MathJax-Span-552"><span class="mrow" id="MathJax-Span-553"><span class="mi" id="MathJax-Span-554" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span class="mo" id="MathJax-Span-555" style="font-size: 70.7%; font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-556" style="font-size: 70.7%; font-family: MathJax_Main;">2</span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-68">r_{c-2}</script>, and so on. To prove this, we will show that <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-69-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-557" style="width: 1.139em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.87em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-558"><span class="msubsup" id="MathJax-Span-559"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-560" style="font-family: MathJax_Math-italic;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mn" id="MathJax-Span-561" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-69">q_1</script> is optimal to pair with <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-70-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-562" style="width: 1.085em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.81em, 2.438em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-563"><span class="msubsup" id="MathJax-Span-564"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-565" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-566" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 0.932em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-70">r_c</script>.</p><p>By contradiction: suppose that in the optimal answer, the pairs <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-71-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-567" style="width: 3.953em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.979em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1002.87em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-568"><span class="mo" id="MathJax-Span-569" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-570"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-571" style="font-family: MathJax_Math-italic;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mn" id="MathJax-Span-572" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-573" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-574" style="padding-left: 0.165em;"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-575" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-576" style="font-size: 70.7%; font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-577" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.504em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-71">(q_1, r_y)</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-72-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-578" style="width: 3.953em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.979em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1002.87em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-579"><span class="mo" id="MathJax-Span-580" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-581"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-582" style="font-family: MathJax_Math-italic;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-583" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-584" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-585" style="padding-left: 0.165em;"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-586" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-587" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-588" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-72">(q_x, r_c)</script> are formed. We know that <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-73-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-589" style="width: 4.169em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.141em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1003.14em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-590"><span class="msubsup" id="MathJax-Span-591"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-592" style="font-family: MathJax_Math-italic;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mn" id="MathJax-Span-593" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-594" style="font-family: MathJax_Main; padding-left: 0.273em;">≤</span><span class="msubsup" id="MathJax-Span-595" style="padding-left: 0.273em;"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-596" style="font-family: MathJax_Math-italic;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-597" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.218em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-73">q_1 \le q_x</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-74-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-598" style="width: 4.007em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.033em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1003.03em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-599"><span class="msubsup" id="MathJax-Span-600"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-601" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-602" style="font-size: 70.7%; font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-603" style="font-family: MathJax_Main; padding-left: 0.273em;">≤</span><span class="msubsup" id="MathJax-Span-604" style="padding-left: 0.273em;"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-605" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-606" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.361em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-74">r_y \le r_c</script>. Also, since the pairs exist, it means that <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-75-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-607" style="width: 13.585em; display: inline-block;"><span style="display: inline-block; position: relative; width: 10.284em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1010.28em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-608"><span class="mo" id="MathJax-Span-609" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-610"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-611" style="font-family: MathJax_Math-italic;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mn" id="MathJax-Span-612" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-613" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-614" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-615" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-616" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-617"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-618" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-619" style="font-size: 70.7%; font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-620" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-621" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-622" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-623" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mn" id="MathJax-Span-624" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-625" style="font-family: MathJax_Main; padding-left: 0.273em;">≤</span><span class="mi" id="MathJax-Span-626" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">k</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.504em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-75">(q_1 + 1)(r_y + 1) - 1 \le k</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-76-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-627" style="width: 13.585em; display: inline-block;"><span style="display: inline-block; position: relative; width: 10.284em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1010.28em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-628"><span class="mo" id="MathJax-Span-629" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-630"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-631" style="font-family: MathJax_Math-italic;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-632" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-633" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-634" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-635" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-636" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-637"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-638" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-639" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-640" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-641" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-642" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-643" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mn" id="MathJax-Span-644" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-645" style="font-family: MathJax_Main; padding-left: 0.273em;">≤</span><span class="mi" id="MathJax-Span-646" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">k</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-76">(q_x + 1)(r_c + 1) - 1 \le k</script>. We will prove that we can swap the elements in the pairs and construct <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-77-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-647" style="width: 3.899em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.925em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1002.82em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-648"><span class="mo" id="MathJax-Span-649" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-650"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-651" style="font-family: MathJax_Math-italic;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mn" id="MathJax-Span-652" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-653" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-654" style="padding-left: 0.165em;"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-655" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-656" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-657" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-77">(q_1, r_c)</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-78-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-658" style="width: 4.007em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.033em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1002.92em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-659"><span class="mo" id="MathJax-Span-660" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-661"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-662" style="font-family: MathJax_Math-italic;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-663" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-664" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-665" style="padding-left: 0.165em;"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-666" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-667" style="font-size: 70.7%; font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-668" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.504em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-78">(q_x, r_y)</script>: </p><ul> <li> <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-79-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-669" style="width: 3.899em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.925em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1002.82em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-670"><span class="mo" id="MathJax-Span-671" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-672"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-673" style="font-family: MathJax_Math-italic;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mn" id="MathJax-Span-674" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-675" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-676" style="padding-left: 0.165em;"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-677" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-678" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-679" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-79">(q_1, r_c)</script>: <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-80-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-680" style="width: 26.356em; display: inline-block;"><span style="display: inline-block; position: relative; width: 19.97em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1019.97em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-681"><span class="mo" id="MathJax-Span-682" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-683"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-684" style="font-family: MathJax_Math-italic;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mn" id="MathJax-Span-685" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-686" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-687" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-688" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-689" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-690"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-691" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-692" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-693" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-694" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-695" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-696" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mn" id="MathJax-Span-697" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-698" style="font-family: MathJax_Main; padding-left: 0.273em;">≤</span><span class="mo" id="MathJax-Span-699" style="font-family: MathJax_Main; padding-left: 0.273em;">(</span><span class="msubsup" id="MathJax-Span-700"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-701" style="font-family: MathJax_Math-italic;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-702" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-703" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-704" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-705" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-706" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-707"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-708" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-709" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-710" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-711" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-712" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-713" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mn" id="MathJax-Span-714" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-715" style="font-family: MathJax_Main; padding-left: 0.273em;">≤</span><span class="mi" id="MathJax-Span-716" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">k</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-80">(q_1 + 1)(r_c + 1) - 1 \le (q_x + 1)(r_c + 1) - 1 \le k</script>; </li><li> <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-81-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-717" style="width: 4.007em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.033em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1002.92em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-718"><span class="mo" id="MathJax-Span-719" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-720"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-721" style="font-family: MathJax_Math-italic;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-722" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-723" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-724" style="padding-left: 0.165em;"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-725" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-726" style="font-size: 70.7%; font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-727" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.504em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-81">(q_x, r_y)</script>: <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-82-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-728" style="width: 26.518em; display: inline-block;"><span style="display: inline-block; position: relative; width: 20.078em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1020.08em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-729"><span class="mo" id="MathJax-Span-730" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-731"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-732" style="font-family: MathJax_Math-italic;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-733" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-734" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-735" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-736" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-737" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-738"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-739" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-740" style="font-size: 70.7%; font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-741" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-742" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-743" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-744" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mn" id="MathJax-Span-745" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-746" style="font-family: MathJax_Main; padding-left: 0.273em;">≤</span><span class="mo" id="MathJax-Span-747" style="font-family: MathJax_Main; padding-left: 0.273em;">(</span><span class="msubsup" id="MathJax-Span-748"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-749" style="font-family: MathJax_Math-italic;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-750" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-751" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-752" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-753" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-754" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-755"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-756" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-757" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-758" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-759" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-760" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-761" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mn" id="MathJax-Span-762" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-763" style="font-family: MathJax_Main; padding-left: 0.273em;">≤</span><span class="mi" id="MathJax-Span-764" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">k</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.504em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-82">(q_x + 1)(r_y + 1) - 1 \le (q_x + 1)(r_c + 1) - 1 \le k</script>. </li></ul> Thus, it is always optimal to pair <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-83-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-765" style="width: 1.139em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.87em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-766"><span class="msubsup" id="MathJax-Span-767"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-768" style="font-family: MathJax_Math-italic;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mn" id="MathJax-Span-769" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-83">q_1</script> with <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-84-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-770" style="width: 1.085em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.81em, 2.438em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-771"><span class="msubsup" id="MathJax-Span-772"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-773" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-774" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 0.932em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-84">r_c</script> and so on. Therefore, it is sufficient to check that if for all pairs <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-85-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-775" style="width: 15.641em; display: inline-block;"><span style="display: inline-block; position: relative; width: 11.853em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1011.85em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-776"><span class="mo" id="MathJax-Span-777" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-778"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-779" style="font-family: MathJax_Math-italic;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-780" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-781" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-782" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-783" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-784" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-785"><span style="display: inline-block; position: relative; width: 2.546em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-786" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="texatom" id="MathJax-Span-787"><span class="mrow" id="MathJax-Span-788"><span class="mi" id="MathJax-Span-789" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span class="mo" id="MathJax-Span-790" style="font-size: 70.7%; font-family: MathJax_Main;">−</span><span class="mi" id="MathJax-Span-791" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-792" style="font-size: 70.7%; font-family: MathJax_Main;">+</span><span class="mn" id="MathJax-Span-793" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-794" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-795" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-796" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-797" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mn" id="MathJax-Span-798" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-799" style="font-family: MathJax_Main; padding-left: 0.273em;">≤</span><span class="mi" id="MathJax-Span-800" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">k</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-85">(q_i + 1)(r_{c - i + 1} + 1) - 1 \le k</script>, then <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-86-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-801" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.436em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.44em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-802"><span class="mi" id="MathJax-Span-803" style="font-family: MathJax_Math-italic;">c</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-86">c</script> pairs can be formed; otherwise, they cannot.<p>Thus, the solution works in <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-87-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-804" style="width: 5.739em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.332em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1004.22em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-805"><span class="mi" id="MathJax-Span-806" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-807" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-808" style="font-family: MathJax_Math-italic;">n</span><span class="mi" id="MathJax-Span-809" style="font-family: MathJax_Main; padding-left: 0.165em;">log</span><span class="mo" id="MathJax-Span-810"></span><span class="texatom" id="MathJax-Span-811" style="padding-left: 0.165em;"><span class="mrow" id="MathJax-Span-812"><span class="mi" id="MathJax-Span-813" style="font-family: MathJax_Math-italic;">n</span></span></span><span class="mo" id="MathJax-Span-814" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-87">O(n \log{n})</script> time due to sorting and binary search.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Solution (adedalic)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
 
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
 
</span><span class="com">#define</span><span class="pln"> fore</span><span class="pun">(</span><span class="pln">i</span><span class="pun">,</span><span class="pln"> l</span><span class="pun">,</span><span class="pln"> r</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">(</span><span class="pln">l</span><span class="pun">);</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">(</span><span class="pln">r</span><span class="pun">);</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
</span><span class="com">#define</span><span class="pln"> sz</span><span class="pun">(</span><span class="pln">a</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">((</span><span class="pln">a</span><span class="pun">).</span><span class="pln">size</span><span class="pun">())</span><span class="pln">
 
</span><span class="kwd">typedef</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> li</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">template</span><span class="pun">&lt;</span><span class="kwd">class</span><span class="pln"> A</span><span class="pun">&gt;</span><span class="pln"> ostream</span><span class="pun">&amp;</span><span class="pln"> </span><span class="kwd">operator</span><span class="pln"> </span><span class="pun">&lt;&lt;(</span><span class="pln">ostream</span><span class="pun">&amp;</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">const</span><span class="pln"> vector</span><span class="pun">&lt;</span><span class="pln">A</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">v</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    fore</span><span class="pun">(</span><span class="pln">i</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> sz</span><span class="pun">(</span><span class="pln">v</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">out</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">" "</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">out</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> v</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> INF </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">(</span><span class="lit">1e9</span><span class="pun">);</span><span class="pln">
</span><span class="kwd">const</span><span class="pln"> li INF64 </span><span class="pun">=</span><span class="pln"> li</span><span class="pun">(</span><span class="lit">1e18</span><span class="pun">);</span><span class="pln">
 
</span><span class="kwd">inline</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> solve</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> li k</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n </span><span class="pun">&gt;&gt;</span><span class="pln"> k</span><span class="pun">;</span><span class="pln">
    vector</span><span class="str">&lt;int&gt;</span><span class="pln"> q</span><span class="pun">(</span><span class="pln">n</span><span class="pun">),</span><span class="pln"> r</span><span class="pun">(</span><span class="pln">n</span><span class="pun">);</span><span class="pln">
    fore </span><span class="pun">(</span><span class="pln">i</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> n</span><span class="pun">)</span><span class="pln">
        cin </span><span class="pun">&gt;&gt;</span><span class="pln"> q</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
    fore </span><span class="pun">(</span><span class="pln">i</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> n</span><span class="pun">)</span><span class="pln">
        cin </span><span class="pun">&gt;&gt;</span><span class="pln"> r</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
    
    sort</span><span class="pun">(</span><span class="pln">q</span><span class="pun">.</span><span class="kwd">begin</span><span class="pun">(),</span><span class="pln"> q</span><span class="pun">.</span><span class="kwd">end</span><span class="pun">());</span><span class="pln">
    sort</span><span class="pun">(</span><span class="pln">r</span><span class="pun">.</span><span class="kwd">begin</span><span class="pun">(),</span><span class="pln"> r</span><span class="pun">.</span><span class="kwd">end</span><span class="pun">());</span><span class="pln">
 
    </span><span class="kwd">auto</span><span class="pln"> check </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[&amp;](</span><span class="kwd">int</span><span class="pln"> cnt</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        fore </span><span class="pun">(</span><span class="pln">i</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> cnt</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">li</span><span class="pun">(</span><span class="pln">q</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">(</span><span class="pln">r</span><span class="pun">[</span><span class="pln">cnt </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> k</span><span class="pun">)</span><span class="pln">
                </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">};</span><span class="pln">
 
    </span><span class="kwd">int</span><span class="pln"> lf </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> rg </span><span class="pun">=</span><span class="pln"> n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">rg </span><span class="pun">-</span><span class="pln"> lf </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> mid </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">lf </span><span class="pun">+</span><span class="pln"> rg</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&gt;&gt;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">check</span><span class="pun">(</span><span class="pln">mid</span><span class="pun">))</span><span class="pln">
            lf </span><span class="pun">=</span><span class="pln"> mid</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">else</span><span class="pln">
            rg </span><span class="pun">=</span><span class="pln"> mid</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    cout </span><span class="pun">&lt;&lt;</span><span class="pln"> lf </span><span class="pun">&lt;&lt;</span><span class="pln"> endl</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
</span><span class="com">#ifdef</span><span class="pln"> _DEBUG
    freopen</span><span class="pun">(</span><span class="str">"input.txt"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"r"</span><span class="pun">,</span><span class="pln"> stdin</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> tt </span><span class="pun">=</span><span class="pln"> clock</span><span class="pun">();</span><span class="pln">
</span><span class="com">#endif</span><span class="pln">
    ios_base</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="kwd">false</span><span class="pun">);</span><span class="pln">
    cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">),</span><span class="pln"> cout</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="kwd">fixed</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> setprecision</span><span class="pun">(</span><span class="lit">15</span><span class="pun">);</span><span class="pln">
    
    </span><span class="kwd">int</span><span class="pln"> t </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">t</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        solve</span><span class="pun">();</span><span class="pln">
        
</span><span class="com">#ifdef</span><span class="pln"> _DEBUG
        cerr </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"TIME = "</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> clock</span><span class="pun">()</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> tt </span><span class="pun">&lt;&lt;</span><span class="pln"> endl</span><span class="pun">;</span><span class="pln">
        tt </span><span class="pun">=</span><span class="pln"> clock</span><span class="pun">();</span><span class="pln">
</span><span class="com">#endif</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2170/problem/D" title="Educational Codeforces Round 185 (Rated for Div. 2)">2170D - Almost Roman</a></p><p>Idea: <a class="rated-user user-red" href="https://codeforces.com/profile/BledDest" title="International Grandmaster BledDest">BledDest</a></p> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2170/problem/D" title="Educational Codeforces Round 185 (Rated for Div. 2)">2170D - Almost Roman</a></h3><div class="ttypography"><div class="problem-statement"><div><p>First, let's try to solve it with only one query. Which characters should we use, and where do we put them?</p><p>Greedy idea: let's use the maximum possible number of Is, then the maximum possible number of Vs, and only then use Xs. It's because if we replace any I with V, it increases the value by at least <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-88-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-815" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-816"><span class="mn" id="MathJax-Span-817" style="font-family: MathJax_Main;">3</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-88">3</script>, and if we replace any V with X, it increases the value by exactly <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-89-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-818" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-819"><span class="mn" id="MathJax-Span-820" style="font-family: MathJax_Main;">5</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-89">5</script>.</p><p>Okay, now we know which characters in which quantities we use. Now, let's choose their ordering in such a way that the number of pairs "<span class="tex-font-style-tt">IV</span>" and "<span class="tex-font-style-tt">IX</span>" is the maximum possible. V and X differ only in their costs, so let's replace every X (both in the original string and in characters we will use in the query) with V, and add the number of replaced characters times <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-90-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-821" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-822"><span class="mn" id="MathJax-Span-823" style="font-family: MathJax_Main;">5</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-90">5</script> to the answer.</p><p>Now imagine the following process. We replace every question mark with I and evaluate the string. But if we have too few Is in a query, we should change some of Is to Vs. When we change an I to a V, one of the following three things can happen:</p><ul> <li> we either increase the number of pairs "<span class="tex-font-style-tt">IV</span>" by <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-91-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-824" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-825"><span class="mn" id="MathJax-Span-826" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-91">1</script>; </li><li> or we don't change it; </li><li> or we decrease it by <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-92-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-827" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-828"><span class="mn" id="MathJax-Span-829" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-92">1</script>. </li></ul><p>Obviously, we want to make as many changes that increase the number of such pairs as we can, then as many changes that keep it as it is as we can, and only then apply changes that decrease it. Let's calculate two variables <span class="tex-font-style-tt">inc</span> and <span class="tex-font-style-tt">same</span>&nbsp;— the maximum number of changes of the first and the second type we can make.</p><p>Every segment of question marks is independent of each other. Suppose a segment is <span class="tex-font-style-it">isolated</span>; then the number of increasing changes is its length divided by <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-93-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-830" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-831"><span class="mn" id="MathJax-Span-832" style="font-family: MathJax_Main;">2</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-93">2</script> (because it is the maximum number of pairs we can have), and the number of changes of the second type is its length modulo <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-94-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-833" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-834"><span class="mn" id="MathJax-Span-835" style="font-family: MathJax_Main;">2</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-94">2</script> (because if it has even length, every character I we replace after making the pairs <span class="tex-font-style-it">breaks</span> one pair, and if it has odd length, we can transform an "<span class="tex-font-style-tt">IIV</span>" pattern into an "<span class="tex-font-style-tt">IVV</span>" pattern).</p><p>However, if there is an I before the segment or a V after it, they can also participate in forming pairs, so each of them increases its length by <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-95-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-836" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-837"><span class="mn" id="MathJax-Span-838" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-95">1</script>. V after the segment also reduces the number of <span class="tex-font-style-it">increasing</span> operations by <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-96-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-839" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-840"><span class="mn" id="MathJax-Span-841" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-96">1</script>, because we initially already have one pair "<span class="tex-font-style-tt">IV</span>".</p><p>And that's about it: calculate the length of each segment of question marks, use it to calculate the values of <span class="tex-font-style-tt">inc</span> and <span class="tex-font-style-tt">same</span>. Then replace all question marks by Is to calculate the value of the string in the <span class="tex-font-style-it">perfect</span> case (when we have enough Is to replace), then use <span class="tex-font-style-tt">inc</span> and <span class="tex-font-style-tt">same</span> to find out how many replacements I <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-97-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-842" style="width: 1.301em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.977em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.92em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-843"><span class="mo" id="MathJax-Span-844" style="font-family: MathJax_Main;">→</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.861em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-97">\rightarrow</script> V increase or keep the number of pairs "<span class="tex-font-style-tt">IV</span>". Processing queries also becomes easy if we know these values.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Solution (BledDest)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">

</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> cost</span><span class="pun">(</span><span class="kwd">char</span><span class="pln"> c</span><span class="pun">)</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">c </span><span class="pun">==</span><span class="pln"> </span><span class="str">'I'</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">5</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> </span><span class="kwd">eval</span><span class="pun">(</span><span class="kwd">string</span><span class="pln"> s</span><span class="pun">)</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> n </span><span class="pun">=</span><span class="pln"> s</span><span class="pun">.</span><span class="pln">size</span><span class="pun">();</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> ans </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">s</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'I'</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> n </span><span class="pun">&amp;&amp;</span><span class="pln"> s</span><span class="pun">[</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'V'</span><span class="pun">)</span><span class="pln">
            ans</span><span class="pun">--;</span><span class="pln">
        </span><span class="kwd">else</span><span class="pln"> ans </span><span class="pun">+=</span><span class="pln"> cost</span><span class="pun">(</span><span class="pln">s</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]);</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> ans</span><span class="pun">;</span><span class="pln">    
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">void</span><span class="pln"> solve</span><span class="pun">()</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> q</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n </span><span class="pun">&gt;&gt;</span><span class="pln"> q</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">string</span><span class="pln"> s</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> s</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> ans </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">s</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'X'</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">{</span><span class="pln">
            s</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'V'</span><span class="pun">;</span><span class="pln">
            ans </span><span class="pun">+=</span><span class="pln"> </span><span class="lit">5</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> inc </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> same </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> qcount </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">s</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="str">'?'</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">continue</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> r </span><span class="pun">=</span><span class="pln"> i</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">while</span><span class="pun">(</span><span class="pln">r </span><span class="pun">&lt;</span><span class="pln"> n </span><span class="pun">&amp;&amp;</span><span class="pln"> s</span><span class="pun">[</span><span class="pln">r</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'?'</span><span class="pun">)</span><span class="pln"> r</span><span class="pun">++;</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> len </span><span class="pun">=</span><span class="pln"> r </span><span class="pun">-</span><span class="pln"> i</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">i </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> s</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'I'</span><span class="pun">)</span><span class="pln"> len</span><span class="pun">++;</span><span class="pln">
        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">r </span><span class="pun">&lt;</span><span class="pln"> n </span><span class="pun">&amp;&amp;</span><span class="pln"> s</span><span class="pun">[</span><span class="pln">r</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'V'</span><span class="pun">)</span><span class="pln"> 
        </span><span class="pun">{</span><span class="pln">
            inc</span><span class="pun">--;</span><span class="pln">
            len</span><span class="pun">++;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        inc </span><span class="pun">+=</span><span class="pln"> len </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln">
        same </span><span class="pun">+=</span><span class="pln"> len </span><span class="pun">%</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln">
        qcount </span><span class="pun">+=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">r </span><span class="pun">-</span><span class="pln"> i</span><span class="pun">);</span><span class="pln">
        i </span><span class="pun">=</span><span class="pln"> r </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">        
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">s</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'?'</span><span class="pun">)</span><span class="pln"> s</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'I'</span><span class="pun">;</span><span class="pln">
    ans </span><span class="pun">+=</span><span class="pln"> </span><span class="kwd">eval</span><span class="pun">(</span><span class="pln">s</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> q</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">,</span><span class="pln"> c</span><span class="pun">;</span><span class="pln">
        cin </span><span class="pun">&gt;&gt;</span><span class="pln"> a </span><span class="pun">&gt;&gt;</span><span class="pln"> b </span><span class="pun">&gt;&gt;</span><span class="pln"> c</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> used_v </span><span class="pun">=</span><span class="pln"> max</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> min</span><span class="pun">(</span><span class="pln">b</span><span class="pun">,</span><span class="pln"> qcount </span><span class="pun">-</span><span class="pln"> c</span><span class="pun">));</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> used_x </span><span class="pun">=</span><span class="pln"> max</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> qcount </span><span class="pun">-</span><span class="pln"> c </span><span class="pun">-</span><span class="pln"> b</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> cur </span><span class="pun">=</span><span class="pln"> ans</span><span class="pun">;</span><span class="pln">
        cur </span><span class="pun">+=</span><span class="pln"> used_v </span><span class="pun">*</span><span class="pln"> </span><span class="lit">4</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> used_x </span><span class="pun">*</span><span class="pln"> </span><span class="lit">9</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> rep </span><span class="pun">=</span><span class="pln"> used_v </span><span class="pun">+</span><span class="pln"> used_x</span><span class="pun">;</span><span class="pln">
        cur </span><span class="pun">-=</span><span class="pln"> min</span><span class="pun">(</span><span class="pln">inc</span><span class="pun">,</span><span class="pln"> rep</span><span class="pun">)</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln">
        rep </span><span class="pun">-=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">inc </span><span class="pun">+</span><span class="pln"> same</span><span class="pun">);</span><span class="pln">
        cur </span><span class="pun">+=</span><span class="pln"> max</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> rep</span><span class="pun">)</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln">
        cout </span><span class="pun">&lt;&lt;</span><span class="pln"> cur </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"\n"</span><span class="pun">;</span><span class="pln">  
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    ios_base</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
        solve</span><span class="pun">();</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2170/problem/E" title="Educational Codeforces Round 185 (Rated for Div. 2)">2170E - Binary Strings and Blocks</a></p><p>Idea: <a class="rated-user user-orange" href="https://codeforces.com/profile/Roms" title="Master Roms">Roms</a></p> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2170/problem/E" title="Educational Codeforces Round 185 (Rated for Div. 2)">2170E - Binary Strings and Blocks</a></h3><div class="ttypography"><div class="problem-statement"><div><p>First, let's try to simplify the definition of beautiful strings. If a string has only <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-98-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-845" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-846"><span class="mn" id="MathJax-Span-847" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-98">1</script> block, then by removing that block, we will definitely end up with <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-99-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-848" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-849"><span class="mn" id="MathJax-Span-850" style="font-family: MathJax_Main;">0</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-99">0</script> blocks. However, if there is more than one block in the string, removing one of the outer blocks decreases the number of blocks by <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-100-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-851" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-852"><span class="mn" id="MathJax-Span-853" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-100">1</script>, while removing a block between two other blocks decreases the number of blocks by <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-101-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-854" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-855"><span class="mn" id="MathJax-Span-856" style="font-family: MathJax_Main;">2</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-101">2</script> (those two blocks merge). If there are <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-102-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-857" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-858"><span class="mn" id="MathJax-Span-859" style="font-family: MathJax_Main;">2</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-102">2</script> blocks in the string, we always end up with <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-103-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-860" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-861"><span class="mn" id="MathJax-Span-862" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-103">1</script>, and if there are more than <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-104-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-863" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-864"><span class="mn" id="MathJax-Span-865" style="font-family: MathJax_Main;">2</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-104">2</script>, both options are available, so we can achieve any parity.</p><p>This actually means that a string is beautiful if and only if it contains more than one block (in other words, a string is not beautiful if and only if all its characters are the same).</p><p>Now our problem becomes the following: we need to count the number of binary strings in which both characters are present in every subsegment <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-105-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-866" style="width: 3.141em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.384em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1002.27em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-867"><span class="mo" id="MathJax-Span-868" style="font-family: MathJax_Main;">[</span><span class="msubsup" id="MathJax-Span-869"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.27em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-870" style="font-family: MathJax_Math-italic;">l</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.327em;"><span class="mi" id="MathJax-Span-871" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-872" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-873" style="padding-left: 0.165em;"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-874" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-875" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-876" style="font-family: MathJax_Main;">]</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-105">[l_i, r_i]</script>. There are several approaches to solving this problem; in my opinion, the simplest is as follows:</p><p>Let <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-106-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-877" style="width: 1.788em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.356em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1001.36em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-878"><span class="mi" id="MathJax-Span-879" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="msubsup" id="MathJax-Span-880"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-881" style="font-family: MathJax_Math-italic;">p</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.49em;"><span class="mi" id="MathJax-Span-882" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-106">dp_i</script> be the number of binary strings of length <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-107-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-883" style="width: 0.436em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.327em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1000.27em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-884"><span class="mi" id="MathJax-Span-885" style="font-family: MathJax_Math-italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-107">i</script> for which the <span class="tex-font-style-bf">characters in positions <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-108-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-886" style="width: 2.708em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.059em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1002em, 2.438em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-887"><span class="mi" id="MathJax-Span-888" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-889" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mn" id="MathJax-Span-890" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.211em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-108">i-1</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-109-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-891" style="width: 0.436em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.327em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1000.27em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-892"><span class="mi" id="MathJax-Span-893" style="font-family: MathJax_Math-italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-109">i</script> differ</span> (that is, <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-110-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-894" style="width: 0.436em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.327em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1000.27em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-895"><span class="mi" id="MathJax-Span-896" style="font-family: MathJax_Math-italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-110">i</script> is the position of the last difference between the characters), and the constraints on all segments ending to the left of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-111-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-897" style="width: 0.436em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.327em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1000.27em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-898"><span class="mi" id="MathJax-Span-899" style="font-family: MathJax_Math-italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-111">i</script> are satisfied. Let's try to understand how to calculate <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-112-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-900" style="width: 1.788em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.356em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1001.36em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-901"><span class="mi" id="MathJax-Span-902" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="msubsup" id="MathJax-Span-903"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-904" style="font-family: MathJax_Math-italic;">p</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.49em;"><span class="mi" id="MathJax-Span-905" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-112">dp_i</script> knowing the previous values <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-113-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-906" style="width: 1.897em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.41em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1001.41em, 2.546em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-907"><span class="mi" id="MathJax-Span-908" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="msubsup" id="MathJax-Span-909"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-910" style="font-family: MathJax_Math-italic;">p</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.49em;"><span class="mi" id="MathJax-Span-911" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-113">dp_j</script>. If some segment <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-114-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-912" style="width: 2.33em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.734em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1001.63em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-913"><span class="mo" id="MathJax-Span-914" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-915" style="font-family: MathJax_Math-italic;">l</span><span class="mo" id="MathJax-Span-916" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-917" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">r</span><span class="mo" id="MathJax-Span-918" style="font-family: MathJax_Main;">]</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-114">[l, r]</script> is contained within <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-115-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-919" style="width: 4.602em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.466em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1003.36em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-920"><span class="mo" id="MathJax-Span-921" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-922" style="font-family: MathJax_Math-italic;">j</span><span class="mo" id="MathJax-Span-923" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-924" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">i</span><span class="mo" id="MathJax-Span-925" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mn" id="MathJax-Span-926" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-927" style="font-family: MathJax_Main;">]</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-115">[j, i-1]</script>, then all characters in it will be the same. Therefore, we need to sum only those <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-116-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-928" style="width: 1.897em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.41em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1001.41em, 2.546em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-929"><span class="mi" id="MathJax-Span-930" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="msubsup" id="MathJax-Span-931"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-932" style="font-family: MathJax_Math-italic;">p</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.49em;"><span class="mi" id="MathJax-Span-933" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-116">dp_j</script> such that no segment <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-117-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-934" style="width: 2.33em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.734em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1001.63em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-935"><span class="mo" id="MathJax-Span-936" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-937" style="font-family: MathJax_Math-italic;">l</span><span class="mo" id="MathJax-Span-938" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-939" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">r</span><span class="mo" id="MathJax-Span-940" style="font-family: MathJax_Main;">]</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-117">[l, r]</script> is fully contained within the segment <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-118-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-941" style="width: 4.602em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.466em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1003.36em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-942"><span class="mo" id="MathJax-Span-943" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-944" style="font-family: MathJax_Math-italic;">j</span><span class="mo" id="MathJax-Span-945" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-946" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">i</span><span class="mo" id="MathJax-Span-947" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mn" id="MathJax-Span-948" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-949" style="font-family: MathJax_Main;">]</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-118">[j, i-1]</script>.</p><p>Let's somehow find the minimum suitable <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-119-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-950" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.436em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1000.44em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-951"><span class="mi" id="MathJax-Span-952" style="font-family: MathJax_Math-italic;">j</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-119">j</script> for each position <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-120-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-953" style="width: 0.436em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.327em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1000.27em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-954"><span class="mi" id="MathJax-Span-955" style="font-family: MathJax_Math-italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-120">i</script> (obviously, all larger <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-121-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-956" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.436em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1000.44em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-957"><span class="mi" id="MathJax-Span-958" style="font-family: MathJax_Math-italic;">j</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-121">j</script> will also be suitable). After that, we will simply need to perform a range sum query, for which we can use either a Fenwick tree or prefix sums (which should be built in parallel to our dynamic programming).</p><p>How do we find such a position <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-122-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-959" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.436em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1000.44em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-960"><span class="mi" id="MathJax-Span-961" style="font-family: MathJax_Math-italic;">j</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-122">j</script> for <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-123-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-962" style="width: 0.436em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.327em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1000.27em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-963"><span class="mi" id="MathJax-Span-964" style="font-family: MathJax_Math-italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-123">i</script>? Let's find the maximum left boundary of the segment ending at each right boundary <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-124-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-965" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.436em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.44em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-966"><span class="mi" id="MathJax-Span-967" style="font-family: MathJax_Math-italic;">r</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-124">r</script>. However, this is not quite what we need, because the segment can end not only at exactly <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-125-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-968" style="width: 2.708em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.059em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1002em, 2.438em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-969"><span class="mi" id="MathJax-Span-970" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-971" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mn" id="MathJax-Span-972" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.211em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-125">i-1</script>, but also before <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-126-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-973" style="width: 2.708em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.059em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1002em, 2.438em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-974"><span class="mi" id="MathJax-Span-975" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-976" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mn" id="MathJax-Span-977" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.211em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-126">i-1</script>. But we can build prefix maxima for these values, so for each right boundary <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-127-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-978" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.436em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.44em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-979"><span class="mi" id="MathJax-Span-980" style="font-family: MathJax_Math-italic;">r</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-127">r</script>, we will know the maximum left boundary for all segments ending <span class="tex-font-style-bf">no later than</span> <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-128-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-981" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.436em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.44em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-982"><span class="mi" id="MathJax-Span-983" style="font-family: MathJax_Math-italic;">r</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-128">r</script>, which is what we need.</p><p>Now let's understand how to calculate the answer based on this dynamic programming. In my opinion, the simplest way is to "extend" our string by <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-129-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-984" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-985"><span class="mn" id="MathJax-Span-986" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-129">1</script> character and say that the character in position <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-130-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-987" style="width: 0.814em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.6em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-988"><span class="mi" id="MathJax-Span-989" style="font-family: MathJax_Math-italic;">n</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-130">n</script> must differ from the previous one. Thus, <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-131-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-990" style="width: 2.113em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.572em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1001.57em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-991"><span class="mi" id="MathJax-Span-992" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="msubsup" id="MathJax-Span-993"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-994" style="font-family: MathJax_Math-italic;">p</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.49em;"><span class="mi" id="MathJax-Span-995" style="font-size: 70.7%; font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-131">dp_n</script> will contain the number of strings of length <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-132-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-996" style="width: 3.087em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.33em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1002.27em, 2.438em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-997"><span class="mi" id="MathJax-Span-998" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-999" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-1000" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.211em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-132">n+1</script> for which all conditions are satisfied and the last two characters differ. By removing the last character, we obtain the number of strings of length <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-133-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1001" style="width: 0.814em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.6em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1002"><span class="mi" id="MathJax-Span-1003" style="font-family: MathJax_Math-italic;">n</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-133">n</script> for which all constraints are met. Therefore, the answer will be exactly <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-134-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1004" style="width: 2.113em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.572em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1001.57em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1005"><span class="mi" id="MathJax-Span-1006" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="msubsup" id="MathJax-Span-1007"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-1008" style="font-family: MathJax_Math-italic;">p</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.49em;"><span class="mi" id="MathJax-Span-1009" style="font-size: 70.7%; font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-134">dp_n</script>.</p><p>Thus, we have obtained a solution in <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-135-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1010" style="width: 5.739em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.332em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1004.22em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1011"><span class="mi" id="MathJax-Span-1012" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-1013" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1014" style="font-family: MathJax_Math-italic;">n</span><span class="mi" id="MathJax-Span-1015" style="font-family: MathJax_Main; padding-left: 0.165em;">log</span><span class="mo" id="MathJax-Span-1016"></span><span class="mi" id="MathJax-Span-1017" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">n</span><span class="mo" id="MathJax-Span-1018" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-135">O(n \log n)</script> or <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-136-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1019" style="width: 2.871em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.167em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1002.06em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1020"><span class="mi" id="MathJax-Span-1021" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-1022" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1023" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-1024" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-136">O(n)</script> depending on how we perform the range sum query.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Solution (BledDest)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
 
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> INF </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1e9</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> MOD </span><span class="pun">=</span><span class="pln"> </span><span class="lit">998244353</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> </span><span class="kwd">add</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> y</span><span class="pun">)</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    x </span><span class="pun">+=</span><span class="pln"> y</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pun">(</span><span class="pln">x </span><span class="pun">&gt;=</span><span class="pln"> MOD</span><span class="pun">)</span><span class="pln"> x </span><span class="pun">-=</span><span class="pln"> MOD</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pun">(</span><span class="pln">x </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> x </span><span class="pun">+=</span><span class="pln"> MOD</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> x</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">void</span><span class="pln"> solve</span><span class="pun">()</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> m</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n </span><span class="pun">&gt;&gt;</span><span class="pln"> m</span><span class="pun">;</span><span class="pln">
    vector</span><span class="str">&lt;int&gt;</span><span class="pln"> max_left</span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> m</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> l</span><span class="pun">,</span><span class="pln"> r</span><span class="pun">;</span><span class="pln">
        cin </span><span class="pun">&gt;&gt;</span><span class="pln"> l </span><span class="pun">&gt;&gt;</span><span class="pln"> r</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">--</span><span class="pln">l</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">--</span><span class="pln">r</span><span class="pun">;</span><span class="pln">
        max_left</span><span class="pun">[</span><span class="pln">r</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> max</span><span class="pun">(</span><span class="pln">max_left</span><span class="pun">[</span><span class="pln">r</span><span class="pun">],</span><span class="pln"> l</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
        max_left</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> max</span><span class="pun">(</span><span class="pln">max_left</span><span class="pun">[</span><span class="pln">i</span><span class="pun">],</span><span class="pln"> max_left</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]);</span><span class="pln">
    vector</span><span class="str">&lt;int&gt;</span><span class="pln"> dp</span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
    vector</span><span class="str">&lt;int&gt;</span><span class="pln"> prefsum</span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">2</span><span class="pun">);</span><span class="pln">
    dp</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln">
    prefsum</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> max_left</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
        dp</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">add</span><span class="pun">(</span><span class="pln">prefsum</span><span class="pun">[</span><span class="pln">i</span><span class="pun">],</span><span class="pln"> </span><span class="pun">-</span><span class="pln">prefsum</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]);</span><span class="pln">
        prefsum</span><span class="pun">[</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">add</span><span class="pun">(</span><span class="pln">prefsum</span><span class="pun">[</span><span class="pln">i</span><span class="pun">],</span><span class="pln"> dp</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    cout </span><span class="pun">&lt;&lt;</span><span class="pln"> dp</span><span class="pun">[</span><span class="pln">n</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"\n"</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    ios_base</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> solve</span><span class="pun">();</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2170/problem/F" title="Educational Codeforces Round 185 (Rated for Div. 2)">2170F - Build XOR on a Segment</a></p><p>Idea: <a class="rated-user user-red" href="https://codeforces.com/profile/BledDest" title="International Grandmaster BledDest">BledDest</a></p> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2170/problem/F" title="Educational Codeforces Round 185 (Rated for Div. 2)">2170F - Build XOR on a Segment</a></h3><div class="ttypography"><div class="problem-statement"><div><p>This looks like a problem that requires linear algebra and XOR bases. However, we only need one fact from linear algebra: the size of the XOR base does not exceed the number of bits in the integers we are working with, so the answer to each query does not exceed <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-137-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1025" style="width: 4.115em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.087em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1003.03em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1026"><span class="mi" id="MathJax-Span-1027" style="font-family: MathJax_Math-italic;">B</span><span class="mo" id="MathJax-Span-1028" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mn" id="MathJax-Span-1029" style="font-family: MathJax_Main; padding-left: 0.273em;">12</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-137">B = 12</script>.</p><p>Let's try to write a dynamic programming solution: <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-138-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1030" style="width: 6.226em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.71em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1004.6em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1031"><span class="mi" id="MathJax-Span-1032" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-1033" style="font-family: MathJax_Math-italic;">p</span><span class="mo" id="MathJax-Span-1034" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-1035" style="font-family: MathJax_Math-italic;">l</span><span class="mo" id="MathJax-Span-1036" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1037" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">r</span><span class="mo" id="MathJax-Span-1038" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1039" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">x</span><span class="mo" id="MathJax-Span-1040" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1041" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-1042" style="font-family: MathJax_Main;">]</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-138">dp[l,r,x,y]</script> — can we form the number <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-139-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1043" style="width: 0.814em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.54em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1044"><span class="mi" id="MathJax-Span-1045" style="font-family: MathJax_Math-italic;">x</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-139">x</script> in the interval <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-140-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1046" style="width: 2.438em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.843em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1001.73em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1047"><span class="mo" id="MathJax-Span-1048" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-1049" style="font-family: MathJax_Math-italic;">l</span><span class="mo" id="MathJax-Span-1050" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1051" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">r</span><span class="mo" id="MathJax-Span-1052" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-140">[l, r)</script> using <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-141-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1053" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.49em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1054"><span class="mi" id="MathJax-Span-1055" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-141">y</script> elements (the value of the dynamic programming will be <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-142-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1056" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1057"><span class="mn" id="MathJax-Span-1058" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-142">1</script> if it is possible, or <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-143-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1059" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1060"><span class="mn" id="MathJax-Span-1061" style="font-family: MathJax_Main;">0</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-143">0</script> if it is not). For now, we won't go into detail about how this dynamic programming is implemented; we just need to understand that it exists and that we can compute the answer to each query as follows: we need to find the minimum <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-144-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1062" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.49em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1063"><span class="mi" id="MathJax-Span-1064" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-144">y</script> such <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-145-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1065" style="width: 8.661em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.55em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1006.5em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1066"><span class="mi" id="MathJax-Span-1067" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-1068" style="font-family: MathJax_Math-italic;">p</span><span class="mo" id="MathJax-Span-1069" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-1070" style="font-family: MathJax_Math-italic;">l</span><span class="mo" id="MathJax-Span-1071" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1072" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">r</span><span class="mo" id="MathJax-Span-1073" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1074" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">x</span><span class="mo" id="MathJax-Span-1075" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1076" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-1077" style="font-family: MathJax_Main;">]</span><span class="mo" id="MathJax-Span-1078" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mn" id="MathJax-Span-1079" style="font-family: MathJax_Main; padding-left: 0.273em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-145">dp[l,r,x,y] = 1</script>.</p><p>This dynamic programming has the following property: if <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-146-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1080" style="width: 8.661em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.55em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1006.5em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1081"><span class="mi" id="MathJax-Span-1082" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-1083" style="font-family: MathJax_Math-italic;">p</span><span class="mo" id="MathJax-Span-1084" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-1085" style="font-family: MathJax_Math-italic;">l</span><span class="mo" id="MathJax-Span-1086" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1087" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">r</span><span class="mo" id="MathJax-Span-1088" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1089" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">x</span><span class="mo" id="MathJax-Span-1090" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1091" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-1092" style="font-family: MathJax_Main;">]</span><span class="mo" id="MathJax-Span-1093" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mn" id="MathJax-Span-1094" style="font-family: MathJax_Main; padding-left: 0.273em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-146">dp[l,r,x,y] = 1</script>, then <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-147-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1095" style="width: 10.933em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.282em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1008.23em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1096"><span class="mi" id="MathJax-Span-1097" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-1098" style="font-family: MathJax_Math-italic;">p</span><span class="mo" id="MathJax-Span-1099" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-1100" style="font-family: MathJax_Math-italic;">l</span><span class="mo" id="MathJax-Span-1101" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mn" id="MathJax-Span-1102" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-1103" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1104" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">r</span><span class="mo" id="MathJax-Span-1105" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1106" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">x</span><span class="mo" id="MathJax-Span-1107" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1108" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-1109" style="font-family: MathJax_Main;">]</span><span class="mo" id="MathJax-Span-1110" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mn" id="MathJax-Span-1111" style="font-family: MathJax_Main; padding-left: 0.273em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-147">dp[l-1,r,x,y] = 1</script>, because we can use all the same elements in the segment <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-148-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1112" style="width: 4.602em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.466em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1003.36em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1113"><span class="mo" id="MathJax-Span-1114" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-1115" style="font-family: MathJax_Math-italic;">l</span><span class="mo" id="MathJax-Span-1116" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mn" id="MathJax-Span-1117" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-1118" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1119" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">r</span><span class="mo" id="MathJax-Span-1120" style="font-family: MathJax_Main;">]</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-148">[l-1,r]</script>. Therefore, for each triple <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-149-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1121" style="width: 4.223em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.195em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1003.09em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1122"><span class="mo" id="MathJax-Span-1123" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1124" style="font-family: MathJax_Math-italic;">r</span><span class="mo" id="MathJax-Span-1125" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1126" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">x</span><span class="mo" id="MathJax-Span-1127" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1128" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-1129" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-149">(r,x,y)</script>, there exists a maximum value of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-150-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1130" style="width: 0.436em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.327em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.27em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1131"><span class="mi" id="MathJax-Span-1132" style="font-family: MathJax_Math-italic;">l</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-150">l</script> such that <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-151-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1133" style="width: 8.661em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.55em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1006.5em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1134"><span class="mi" id="MathJax-Span-1135" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-1136" style="font-family: MathJax_Math-italic;">p</span><span class="mo" id="MathJax-Span-1137" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-1138" style="font-family: MathJax_Math-italic;">l</span><span class="mo" id="MathJax-Span-1139" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1140" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">r</span><span class="mo" id="MathJax-Span-1141" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1142" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">x</span><span class="mo" id="MathJax-Span-1143" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1144" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-1145" style="font-family: MathJax_Main;">]</span><span class="mo" id="MathJax-Span-1146" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mn" id="MathJax-Span-1147" style="font-family: MathJax_Main; padding-left: 0.273em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-151">dp[l,r,x,y] = 1</script>. This means we can move this state of the dynamic programming to its value: we will obtain a new dynamic programming <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-152-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1148" style="width: 5.576em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.223em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1004.12em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1149"><span class="mi" id="MathJax-Span-1150" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="msup" id="MathJax-Span-1151"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-1152" style="font-family: MathJax_Math-italic;">p</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -4.38em; left: 0.49em;"><span class="mo" id="MathJax-Span-1153" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-1154" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-1155" style="font-family: MathJax_Math-italic;">r</span><span class="mo" id="MathJax-Span-1156" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1157" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">x</span><span class="mo" id="MathJax-Span-1158" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1159" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-1160" style="font-family: MathJax_Main;">]</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.504em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-152">dp'[r,x,y]</script> — the maximum <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-153-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1161" style="width: 0.436em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.327em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.27em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1162"><span class="mi" id="MathJax-Span-1163" style="font-family: MathJax_Math-italic;">l</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-153">l</script> such that we can form the number <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-154-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1164" style="width: 0.814em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.54em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1165"><span class="mi" id="MathJax-Span-1166" style="font-family: MathJax_Math-italic;">x</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-154">x</script> out of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-155-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1167" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.49em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1168"><span class="mi" id="MathJax-Span-1169" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-155">y</script> elements in the interval <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-156-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1170" style="width: 2.438em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.843em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1001.73em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1171"><span class="mo" id="MathJax-Span-1172" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-1173" style="font-family: MathJax_Math-italic;">l</span><span class="mo" id="MathJax-Span-1174" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1175" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">r</span><span class="mo" id="MathJax-Span-1176" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-156">[l, r)</script>. It is also easy to answer queries based on this: to answer a query, we need the minimum <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-157-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1177" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.49em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1178"><span class="mi" id="MathJax-Span-1179" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-157">y</script> for which <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-158-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1180" style="width: 7.741em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.847em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1005.79em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1181"><span class="mi" id="MathJax-Span-1182" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="msup" id="MathJax-Span-1183"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-1184" style="font-family: MathJax_Math-italic;">p</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -4.38em; left: 0.49em;"><span class="mo" id="MathJax-Span-1185" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-1186" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-1187" style="font-family: MathJax_Math-italic;">r</span><span class="mo" id="MathJax-Span-1188" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1189" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">x</span><span class="mo" id="MathJax-Span-1190" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1191" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-1192" style="font-family: MathJax_Main;">]</span><span class="mo" id="MathJax-Span-1193" style="font-family: MathJax_Main; padding-left: 0.273em;">≥</span><span class="mi" id="MathJax-Span-1194" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">l</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.504em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-158">dp'[r,x,y] \ge l</script>.</p><p>Let's try to understand how to compute this dynamic programming. We initialize <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-159-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1195" style="width: 8.282em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.28em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1006.23em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1196"><span class="mi" id="MathJax-Span-1197" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-1198" style="font-family: MathJax_Math-italic;">p</span><span class="mo" id="MathJax-Span-1199" style="font-family: MathJax_Main;">[</span><span class="mn" id="MathJax-Span-1200" style="font-family: MathJax_Main;">0</span><span class="mo" id="MathJax-Span-1201" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-1202" style="font-family: MathJax_Main; padding-left: 0.165em;">0</span><span class="mo" id="MathJax-Span-1203" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-1204" style="font-family: MathJax_Main; padding-left: 0.165em;">0</span><span class="mo" id="MathJax-Span-1205" style="font-family: MathJax_Main;">]</span><span class="mo" id="MathJax-Span-1206" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mi" id="MathJax-Span-1207" style="font-family: MathJax_Main; padding-left: 0.273em;">∞</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-159">dp[0,0,0] = \infty</script>, and for all other states we set <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-160-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1208" style="width: 2.384em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.788em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.41em, 1001.73em, 2.438em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1209"><span class="mo" id="MathJax-Span-1210" style="font-family: MathJax_Main;">−</span><span class="mi" id="MathJax-Span-1211" style="font-family: MathJax_Main;">∞</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.211em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-160">-\infty</script>. How do the values of dp change when transitioning from the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-161-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1212" style="width: 0.436em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.327em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1000.27em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1213"><span class="mi" id="MathJax-Span-1214" style="font-family: MathJax_Math-italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-161">i</script>-th layer to the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-162-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1215" style="width: 3.736em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.817em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1002.71em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1216"><span class="mo" id="MathJax-Span-1217" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1218" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-1219" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-1220" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-1221" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-162">(i+1)</script>-th layer? First, we can set that <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-163-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1222" style="width: 6.496em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.927em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1004.93em, 2.708em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1223"><span class="mi" id="MathJax-Span-1224" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="msubsup" id="MathJax-Span-1225"><span style="display: inline-block; position: relative; width: 1.734em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-1226" style="font-family: MathJax_Math-italic;">p</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; clip: rect(3.466em, 1000.27em, 4.115em, -999.997em); top: -4.326em; left: 0.49em;"><span class="mo" id="MathJax-Span-1227" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; clip: rect(3.358em, 1001.25em, 4.223em, -999.997em); top: -3.677em; left: 0.49em;"><span class="texatom" id="MathJax-Span-1228"><span class="mrow" id="MathJax-Span-1229"><span class="mi" id="MathJax-Span-1230" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-1231" style="font-size: 70.7%; font-family: MathJax_Main;">+</span><span class="mn" id="MathJax-Span-1232" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-1233" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mi" id="MathJax-Span-1234" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="msubsup" id="MathJax-Span-1235"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-1236" style="font-family: MathJax_Math-italic;">p</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; clip: rect(3.466em, 1000.27em, 4.115em, -999.997em); top: -4.326em; left: 0.49em;"><span class="mo" id="MathJax-Span-1237" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; clip: rect(3.358em, 1000.33em, 4.169em, -999.997em); top: -3.677em; left: 0.49em;"><span class="mi" id="MathJax-Span-1238" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.568em; border-left: 0px solid; width: 0px; height: 1.575em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-163">dp'_{i+1} = dp'_i</script> for all pairs <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-164-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1239" style="width: 3.033em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.275em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1002.17em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1240"><span class="mo" id="MathJax-Span-1241" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1242" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-1243" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1244" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-1245" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-164">(x,y)</script> (all subsets available with the right boundary <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-165-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1246" style="width: 0.436em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.327em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1000.27em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1247"><span class="mi" id="MathJax-Span-1248" style="font-family: MathJax_Math-italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-165">i</script> remain available with the right boundary <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-166-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1249" style="width: 2.708em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.059em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1002em, 2.438em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1250"><span class="mi" id="MathJax-Span-1251" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-1252" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-1253" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.211em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-166">i+1</script>), and then we will try to "improve" it using the new element.</p><p>How can the new element <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-167-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1254" style="width: 1.139em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.87em, 2.438em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1255"><span class="msubsup" id="MathJax-Span-1256"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-1257" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-1258" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 0.932em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-167">a_i</script> "improve" the values of the dynamic programming? For some <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-168-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1259" style="width: 3.033em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.275em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1002.17em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1260"><span class="mo" id="MathJax-Span-1261" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1262" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-1263" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1264" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-1265" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-168">(x,y)</script>, there may be a way to form <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-169-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1266" style="width: 0.814em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.54em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1267"><span class="mi" id="MathJax-Span-1268" style="font-family: MathJax_Math-italic;">x</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-169">x</script> using <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-170-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1269" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.49em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1270"><span class="mi" id="MathJax-Span-1271" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-170">y</script> elements with a more optimal left boundary. Firstly, the way to form <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-171-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1272" style="width: 1.139em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.87em, 2.438em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1273"><span class="msubsup" id="MathJax-Span-1274"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-1275" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-1276" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 0.932em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-171">a_i</script> using <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-172-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1277" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1278"><span class="mn" id="MathJax-Span-1279" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-172">1</script> element will definitely improve, so we can assign <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-173-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1280" style="width: 10.392em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.849em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1007.79em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1281"><span class="mi" id="MathJax-Span-1282" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="msup" id="MathJax-Span-1283"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-1284" style="font-family: MathJax_Math-italic;">p</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -4.38em; left: 0.49em;"><span class="mo" id="MathJax-Span-1285" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-1286" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-1287" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-1288" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-1289" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-1290" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-1291" style="padding-left: 0.165em;"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-1292" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-1293" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-1294" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-1295" style="font-family: MathJax_Main; padding-left: 0.165em;">1</span><span class="mo" id="MathJax-Span-1296" style="font-family: MathJax_Main;">]</span><span class="mo" id="MathJax-Span-1297" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="mi" id="MathJax-Span-1298" style="font-family: MathJax_Math-italic; padding-left: 0.273em;">i</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.504em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-173">dp'[i+1,a_i,1] = i</script>. Secondly, we can take some set that is reachable for the right boundary <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-174-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1299" style="width: 0.436em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.327em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1000.27em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1300"><span class="mi" id="MathJax-Span-1301" style="font-family: MathJax_Math-italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-174">i</script> and add the element <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-175-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1302" style="width: 1.139em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.87em, 2.438em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1303"><span class="msubsup" id="MathJax-Span-1304"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-1305" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-1306" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 0.932em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-175">a_i</script> to it; that is, we transition from <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-176-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1307" style="width: 5.468em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.115em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1004.01em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1308"><span class="mi" id="MathJax-Span-1309" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="msup" id="MathJax-Span-1310"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-1311" style="font-family: MathJax_Math-italic;">p</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -4.38em; left: 0.49em;"><span class="mo" id="MathJax-Span-1312" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-1313" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-1314" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-1315" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1316" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">x</span><span class="mo" id="MathJax-Span-1317" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1318" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-1319" style="font-family: MathJax_Main;">]</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.504em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-176">dp'[i,x,y]</script> to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-177-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1320" style="width: 12.719em; display: inline-block;"><span style="display: inline-block; position: relative; width: 9.635em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1009.53em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1321"><span class="mi" id="MathJax-Span-1322" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="msup" id="MathJax-Span-1323"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-1324" style="font-family: MathJax_Math-italic;">p</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -4.38em; left: 0.49em;"><span class="mo" id="MathJax-Span-1325" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-1326" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-1327" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-1328" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-1329" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-1330" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1331" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">x</span><span class="mo" id="MathJax-Span-1332" style="font-family: MathJax_Main; padding-left: 0.219em;">⊕</span><span class="msubsup" id="MathJax-Span-1333" style="padding-left: 0.219em;"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-1334" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-1335" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-1336" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1337" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-1338" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-1339" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-1340" style="font-family: MathJax_Main;">]</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.504em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-177">dp'[i+1, x \oplus a_i, y+1]</script>. The minimum index of the number that we will use in such a set will still be <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-178-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1341" style="width: 5.468em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.115em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1004.01em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1342"><span class="mi" id="MathJax-Span-1343" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="msup" id="MathJax-Span-1344"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-1345" style="font-family: MathJax_Math-italic;">p</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -4.38em; left: 0.49em;"><span class="mo" id="MathJax-Span-1346" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-1347" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-1348" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-1349" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1350" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">x</span><span class="mo" id="MathJax-Span-1351" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1352" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-1353" style="font-family: MathJax_Main;">]</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.504em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-178">dp'[i,x,y]</script>, because the new number <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-179-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1354" style="width: 1.139em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.87em, 2.438em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1355"><span class="msubsup" id="MathJax-Span-1356"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-1357" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-1358" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 0.932em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-179">a_i</script> has a higher index than all the previous numbers we have used. Therefore, if there is a way to form <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-180-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1359" style="width: 0.814em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.54em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1360"><span class="mi" id="MathJax-Span-1361" style="font-family: MathJax_Math-italic;">x</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-180">x</script> using <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-181-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1362" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.49em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1363"><span class="mi" id="MathJax-Span-1364" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-181">y</script> elements with the right boundary <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-182-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1365" style="width: 0.436em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.327em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1000.27em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-1366"><span class="mi" id="MathJax-Span-1367" style="font-family: MathJax_Math-italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-182">i</script> and the left boundary <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-183-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1368" style="width: 5.468em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.115em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1004.01em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1369"><span class="mi" id="MathJax-Span-1370" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="msup" id="MathJax-Span-1371"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-1372" style="font-family: MathJax_Math-italic;">p</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -4.38em; left: 0.49em;"><span class="mo" id="MathJax-Span-1373" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-1374" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-1375" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-1376" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1377" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">x</span><span class="mo" id="MathJax-Span-1378" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1379" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-1380" style="font-family: MathJax_Main;">]</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.504em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-183">dp'[i,x,y]</script>, we can form <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-184-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1381" style="width: 12.719em; display: inline-block;"><span style="display: inline-block; position: relative; width: 9.635em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1009.53em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1382"><span class="mi" id="MathJax-Span-1383" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="msup" id="MathJax-Span-1384"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-1385" style="font-family: MathJax_Math-italic;">p</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -4.38em; left: 0.49em;"><span class="mo" id="MathJax-Span-1386" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-1387" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-1388" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-1389" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-1390" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-1391" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1392" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">x</span><span class="mo" id="MathJax-Span-1393" style="font-family: MathJax_Main; padding-left: 0.219em;">⊕</span><span class="msubsup" id="MathJax-Span-1394" style="padding-left: 0.219em;"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-1395" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-1396" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-1397" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1398" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-1399" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-1400" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-1401" style="font-family: MathJax_Main;">]</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.504em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-184">dp'[i+1, x \oplus a_i, y+1]</script> with the same left boundary.</p><p>This dynamic programming has a complexity of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-185-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1402" style="width: 7.254em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.468em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.139em, 1005.36em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1403"><span class="mi" id="MathJax-Span-1404" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-1405" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1406" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-1407" style="font-family: MathJax_Main; padding-left: 0.219em;">⋅</span><span class="mi" id="MathJax-Span-1408" style="font-family: MathJax_Math-italic; padding-left: 0.219em;">B</span><span class="mo" id="MathJax-Span-1409" style="font-family: MathJax_Main; padding-left: 0.219em;">⋅</span><span class="msubsup" id="MathJax-Span-1410" style="padding-left: 0.219em;"><span style="display: inline-block; position: relative; width: 1.139em; height: 0px;"><span style="position: absolute; clip: rect(3.195em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mn" id="MathJax-Span-1411" style="font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -4.38em; left: 0.49em;"><span class="mi" id="MathJax-Span-1412" style="font-size: 70.7%; font-family: MathJax_Math-italic;">B</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-1413" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.646em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-185">O(n \cdot B \cdot 2^B)</script>, which is quite fast but does not fit into memory limits. To fix this, let's group all queries according to their right boundaries, and store only two (or even only one!) layer of dynamic programming, moving the right boundary and answering all queries for the current right boundary. This will reduce memory usage to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-186-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1414" style="width: 5.522em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.169em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.139em, 1004.06em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-1415"><span class="mi" id="MathJax-Span-1416" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-1417" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1418" style="font-family: MathJax_Math-italic;">B</span><span class="mo" id="MathJax-Span-1419" style="font-family: MathJax_Main; padding-left: 0.219em;">⋅</span><span class="msubsup" id="MathJax-Span-1420" style="padding-left: 0.219em;"><span style="display: inline-block; position: relative; width: 1.139em; height: 0px;"><span style="position: absolute; clip: rect(3.195em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mn" id="MathJax-Span-1421" style="font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -4.38em; left: 0.49em;"><span class="mi" id="MathJax-Span-1422" style="font-size: 70.7%; font-family: MathJax_Math-italic;">B</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-1423" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.646em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-186">O(B \cdot 2^B)</script>, which fits within the constraints.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Solution (BledDest)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
 
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> B </span><span class="pun">=</span><span class="pln"> </span><span class="lit">13</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> M </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="lit">1</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="pun">(</span><span class="pln">B </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">));</span><span class="pln">
</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> INF </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1e9</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> dp</span><span class="pun">[</span><span class="pln">B</span><span class="pun">][</span><span class="pln">M</span><span class="pun">];</span><span class="pln">
 
</span><span class="kwd">void</span><span class="pln"> upd</span><span class="pun">(</span><span class="kwd">int</span><span class="pun">&amp;</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> b</span><span class="pun">)</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">a </span><span class="pun">&lt;</span><span class="pln"> b</span><span class="pun">)</span><span class="pln"> a </span><span class="pun">=</span><span class="pln"> b</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    ios_base</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
    vector</span><span class="str">&lt;int&gt;</span><span class="pln"> a</span><span class="pun">(</span><span class="pln">n</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> cin </span><span class="pun">&gt;&gt;</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
    vector</span><span class="pun">&lt;</span><span class="pln">vector</span><span class="str">&lt;int&gt;</span><span class="pun">&gt;</span><span class="pln"> id</span><span class="pun">(</span><span class="pln">n</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> q</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> q</span><span class="pun">;</span><span class="pln">
    vector</span><span class="str">&lt;int&gt;</span><span class="pln"> l</span><span class="pun">(</span><span class="pln">q</span><span class="pun">),</span><span class="pln"> x</span><span class="pun">(</span><span class="pln">q</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> q</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> r</span><span class="pun">;</span><span class="pln">
        cin </span><span class="pun">&gt;&gt;</span><span class="pln"> l</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&gt;&gt;</span><span class="pln"> r </span><span class="pun">&gt;&gt;</span><span class="pln"> x</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
        </span><span class="pun">--</span><span class="pln">l</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
        </span><span class="pun">--</span><span class="pln">r</span><span class="pun">;</span><span class="pln">
        id</span><span class="pun">[</span><span class="pln">r</span><span class="pun">].</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">i</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> B</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
        </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;</span><span class="pln"> M</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++)</span><span class="pln">
            dp</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">-</span><span class="pln">INF</span><span class="pun">;</span><span class="pln">
    dp</span><span class="pun">[</span><span class="lit">0</span><span class="pun">][</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> INF</span><span class="pun">;</span><span class="pln">
    vector</span><span class="str">&lt;int&gt;</span><span class="pln"> ans</span><span class="pun">(</span><span class="pln">q</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> val </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
        upd</span><span class="pun">(</span><span class="pln">dp</span><span class="pun">[</span><span class="lit">1</span><span class="pun">][</span><span class="pln">val</span><span class="pun">],</span><span class="pln"> i</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;</span><span class="pln"> B </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++)</span><span class="pln">
        </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> k </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> k </span><span class="pun">&lt;</span><span class="pln"> M</span><span class="pun">;</span><span class="pln"> k</span><span class="pun">++)</span><span class="pln">
            </span><span class="pun">{</span><span class="pln">
                upd</span><span class="pun">(</span><span class="pln">dp</span><span class="pun">[</span><span class="pln">j </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">][</span><span class="pln">k </span><span class="pun">^</span><span class="pln"> val</span><span class="pun">],</span><span class="pln"> dp</span><span class="pun">[</span><span class="pln">j</span><span class="pun">][</span><span class="pln">k</span><span class="pun">]);</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">auto</span><span class="pln"> qr </span><span class="pun">:</span><span class="pln"> id</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln">
        </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">int</span><span class="pln"> cur </span><span class="pun">=</span><span class="pln"> x</span><span class="pun">[</span><span class="pln">qr</span><span class="pun">];</span><span class="pln">
            </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> B </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">--)</span><span class="pln">
                </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">dp</span><span class="pun">[</span><span class="pln">j</span><span class="pun">][</span><span class="pln">cur</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&gt;=</span><span class="pln"> l</span><span class="pun">[</span><span class="pln">qr</span><span class="pun">])</span><span class="pln">
                    ans</span><span class="pun">[</span><span class="pln">qr</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> j</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> q</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
        cout </span><span class="pun">&lt;&lt;</span><span class="pln"> ans</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">" "</span><span class="pun">;</span><span class="pln">
    cout </span><span class="pun">&lt;&lt;</span><span class="pln"> endl</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div></div>

    </div>


        <div style="font-size: 1.1rem;line-height: 1.1rem;padding-bottom: 0.5em;">
            <img src="https://codeforces.com//codeforces.com/codeforces.org/s/52448/images/icons/paperclip-16x16.png" style="vertical-align: middle;"> <span style="padding: 0 0.35em;">Tutorial of <a href="https://codeforces.com/contest/2170" class="notice" style="text-decoration: none;">Educational Codeforces Round 185 (Rated for Div. 2)</a> </span>
        </div>
        
            

  <script>
    // Make all spoilers toggleable
    document.querySelectorAll('.spoiler-title').forEach(title => {
      title.addEventListener('click', function() {
        const spoiler = this.closest('.spoiler');
        spoiler.classList.toggle('open');
      });
    });
    
    // Open all spoilers by default for easier reading
    document.querySelectorAll('.spoiler').forEach(spoiler => {
      spoiler.classList.add('open');
    });
  </script>
</body>
</html>