<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tutorial</title>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
      line-height: 1.6;
      color: #333;
      background: #fafafa;
    }
    .ttypography {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    h3 {
      color: #1a1a1a;
      border-bottom: 2px solid #eee;
      padding-bottom: 10px;
    }
    h3 a {
      color: #0066cc;
      text-decoration: none;
    }
    h3 a:hover {
      text-decoration: underline;
    }
    .spoiler {
      margin: 15px 0;
      border: 1px solid #ddd;
      border-radius: 6px;
      overflow: hidden;
    }
    .spoiler-title {
      display: block;
      padding: 12px 15px;
      background: #f0f0f0;
      cursor: pointer;
      font-weight: 600;
      user-select: none;
      border-bottom: 1px solid #ddd;
    }
    .spoiler-title:hover {
      background: #e8e8e8;
    }
    .spoiler-title::before {
      content: '▶ ';
      font-size: 0.8em;
      transition: transform 0.2s;
      display: inline-block;
    }
    .spoiler.open .spoiler-title::before {
      content: '▼ ';
    }
    .spoiler-content {
      padding: 15px;
      background: #fff;
      display: none;
    }
    .spoiler.open .spoiler-content {
      display: block;
    }
    pre, code {
      background: #f5f5f5;
      font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
      font-size: 0.85em;
    }
    pre {
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
    }
    code {
      padding: 2px 5px;
      border-radius: 3px;
    }
    p {
      margin: 10px 0;
    }
    .MathJax {
      font-size: 1.1em;
    }
  </style>
</head>
<body>
  <h1>Editorial</h1>
  <p><a href="https://codeforces.com/blog/entry/146526" target="_blank">View on Codeforces →</a></p>
  
  <div class="ttypography"><p>Thanks everybody for participating in the round!</p><p><a href="https://codeforces.com/contest/2143/problem/A" title="Codeforces Round 1051 (Div. 2)">2143A - All Lengths Subtraction</a></p><p>Author: <a class="rated-user user-orange" href="https://codeforces.com/profile/LucaLucaM" title="Master LucaLucaM">LucaLucaM</a>, Preparation: <a class="rated-user user-orange" href="https://codeforces.com/profile/LucaLucaM" title="Master LucaLucaM">LucaLucaM</a>, Editorial: <a class="rated-user user-orange" href="https://codeforces.com/profile/MateiKing80" title="Master MateiKing80">MateiKing80</a></p> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2143/problem/A" title="Codeforces Round 1051 (Div. 2)">2143A - All Lengths Subtraction</a></h3><div class="ttypography"><div class="problem-statement"><div><p>We want to make all elements zero by performing exactly one operation for each <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-393"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-394">k</span><span class="MJXp-mo" id="MJXp-Span-395" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-396">1</span><span class="MJXp-mo" id="MJXp-Span-397" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-398" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-399" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-400">n</span></span></span><script type="math/tex" id="MathJax-Element-61">k = 1,\dots,n</script>: choose a subarray of length <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-401"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-402">k</span></span></span><script type="math/tex" id="MathJax-Element-62">k</script> and subtract <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-403"><span class="MJXp-mn" id="MJXp-Span-404">1</span></span></span><script type="math/tex" id="MathJax-Element-63">1</script> from all its elements.</p><p>Look at the element with value <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-405"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-406">n</span></span></span><script type="math/tex" id="MathJax-Element-64">n</script>. It must be decreased <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-407"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-408">n</span></span></span><script type="math/tex" id="MathJax-Element-65">n</script> times, and there are only <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-409"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-410">n</span></span></span><script type="math/tex" id="MathJax-Element-66">n</script> operations, so every chosen subarray must contain it.</p><p>Now look at <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-411"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-412">n</span><span class="MJXp-mo" id="MJXp-Span-413" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-414">1</span></span></span><script type="math/tex" id="MathJax-Element-67">n-1</script>. It must be decreased <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-415"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-416">n</span><span class="MJXp-mo" id="MJXp-Span-417" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-418">1</span></span></span><script type="math/tex" id="MathJax-Element-68">n-1</script> times. The only subarray that can exclude it is the length-<span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-419"><span class="MJXp-mn" id="MJXp-Span-420">1</span></span></span><script type="math/tex" id="MathJax-Element-69">1</script> subarray (which hits only <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-421"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-422">n</span></span></span><script type="math/tex" id="MathJax-Element-70">n</script>). The length-<span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-423"><span class="MJXp-mn" id="MJXp-Span-424">2</span></span></span><script type="math/tex" id="MathJax-Element-71">2</script> subarray must include both <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-425"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-426">n</span></span></span><script type="math/tex" id="MathJax-Element-72">n</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-427"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-428">n</span><span class="MJXp-mo" id="MJXp-Span-429" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-430">1</span></span></span><script type="math/tex" id="MathJax-Element-73">n-1</script>. So <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-431"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-432">n</span><span class="MJXp-mo" id="MJXp-Span-433" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-434">1</span></span></span><script type="math/tex" id="MathJax-Element-74">n-1</script> must be adjacent to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-435"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-436">n</span></span></span><script type="math/tex" id="MathJax-Element-75">n</script>.</p><p>Then look at <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-437"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-438">n</span><span class="MJXp-mo" id="MJXp-Span-439" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-440">2</span></span></span><script type="math/tex" id="MathJax-Element-76">n-2</script>. It must be decreased <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-441"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-442">n</span><span class="MJXp-mo" id="MJXp-Span-443" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-444">2</span></span></span><script type="math/tex" id="MathJax-Element-77">n-2</script> times, so it can be excluded only from the length-<span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-445"><span class="MJXp-mn" id="MJXp-Span-446">1</span></span></span><script type="math/tex" id="MathJax-Element-78">1</script> and length-<span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-447"><span class="MJXp-mn" id="MJXp-Span-448">2</span></span></span><script type="math/tex" id="MathJax-Element-79">2</script> subarrays. The length-<span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-449"><span class="MJXp-mn" id="MJXp-Span-450">3</span></span></span><script type="math/tex" id="MathJax-Element-80">3</script> subarray must contain <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-451"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-452">n</span><span class="MJXp-mo" id="MJXp-Span-453" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-454">n</span><span class="MJXp-mo" id="MJXp-Span-455" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-456">1</span><span class="MJXp-mo" id="MJXp-Span-457" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-458">n</span><span class="MJXp-mo" id="MJXp-Span-459" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-460">2</span></span></span><script type="math/tex" id="MathJax-Element-81">n,n-1,n-2</script>, so they should form an contiguous segment.</p><p>In general, the positions of the values <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-461"><span class="MJXp-mo" id="MJXp-Span-462" style="margin-left: 0em; margin-right: 0em;">{</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-463">i</span><span class="MJXp-mo" id="MJXp-Span-464" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-465">i</span><span class="MJXp-mo" id="MJXp-Span-466" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-467">1</span><span class="MJXp-mo" id="MJXp-Span-468" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-469" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-470" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-471">n</span><span class="MJXp-mo" id="MJXp-Span-472" style="margin-left: 0em; margin-right: 0em;">}</span></span></span><script type="math/tex" id="MathJax-Element-82">\{i,i+1,\dots,n\}</script> must always form a contiguous segment for every <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-473"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-474">i</span></span></span><script type="math/tex" id="MathJax-Element-83">i</script>.</p><p>As such, we can iterate a value <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-475"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-476">x</span></span></span><script type="math/tex" id="MathJax-Element-84">x</script> from <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-477"><span class="MJXp-mn" id="MJXp-Span-478">1</span></span></span><script type="math/tex" id="MathJax-Element-85">1</script> to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-479"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-480">n</span></span></span><script type="math/tex" id="MathJax-Element-86">n</script>, and if the given permutation admits a solution, then we should expect that this <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-481"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-482">x</span></span></span><script type="math/tex" id="MathJax-Element-87">x</script> would be in either end. After finding this end, we can erase <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-483"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-484">x</span></span></span><script type="math/tex" id="MathJax-Element-88">x</script> and continue with <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-485"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-486">x</span><span class="MJXp-mo" id="MJXp-Span-487" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-488">1</span></span></span><script type="math/tex" id="MathJax-Element-89">x+1</script>. In short, this condition at the end will imply that the given permutation is a mountain, i.e. at first it increases and then it decreases. It remains that we check this condition in any equivalent way to produce the answer.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Code</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pln"> </span><span class="str">&lt;iostream&gt;</span><span class="pln">
</span><span class="com">#include</span><span class="pln"> </span><span class="str">&lt;cassert&gt;</span><span class="pln">
</span><span class="com">#include</span><span class="pln"> </span><span class="str">&lt;vector&gt;</span><span class="pln">
</span><span class="com">#include</span><span class="pln"> </span><span class="str">&lt;algorithm&gt;</span><span class="pln">
 
</span><span class="com">#define</span><span class="pln"> debug</span><span class="pun">(</span><span class="pln">x</span><span class="pun">)</span><span class="pln"> </span><span class="com">#x &lt;&lt; " = " &lt;&lt; x &lt;&lt; '\n'</span><span class="pln">
 
</span><span class="kwd">using</span><span class="pln"> ll </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pun">;</span><span class="pln">
</span><span class="com">#define</span><span class="pln"> YES std</span><span class="pun">::</span><span class="pln">cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"YES"</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> std</span><span class="pun">::</span><span class="pln">endl</span><span class="pun">;</span><span class="pln">
</span><span class="com">#define</span><span class="pln"> NO std</span><span class="pun">::</span><span class="pln">cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"NO"</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> std</span><span class="pun">::</span><span class="pln">endl</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">void</span><span class="pln"> solve</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
  std</span><span class="pun">::</span><span class="pln">cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
  std</span><span class="pun">::</span><span class="pln">vector</span><span class="str">&lt;int&gt;</span><span class="pln"> p</span><span class="pun">(</span><span class="pln">n</span><span class="pun">);</span><span class="pln">
  </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    std</span><span class="pun">::</span><span class="pln">cin </span><span class="pun">&gt;&gt;</span><span class="pln"> p</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">  
 
  </span><span class="kwd">int</span><span class="pln"> l </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> r </span><span class="pun">=</span><span class="pln"> n </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">p</span><span class="pun">[</span><span class="pln">l</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      l</span><span class="pun">++;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">p</span><span class="pun">[</span><span class="pln">r</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      r</span><span class="pun">--;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      NO</span><span class="pun">;</span><span class="pln">
      </span><span class="kwd">return</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
  YES</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
   </span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
   std</span><span class="pun">::</span><span class="pln">cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
   </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> tc </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> tc </span><span class="pun">&lt;=</span><span class="pln"> t</span><span class="pun">;</span><span class="pln"> tc</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    solve</span><span class="pun">();</span><span class="pln">
   </span><span class="pun">}</span><span class="pln">
 
  </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2143/problem/B" title="Codeforces Round 1051 (Div. 2)">2143B - Discounts</a></p><p>Author: <a class="rated-user user-red" href="https://codeforces.com/profile/anpaio" title="International Grandmaster anpaio">anpaio</a>, Preparation: <a class="rated-user user-red" href="https://codeforces.com/profile/anpaio" title="International Grandmaster anpaio">anpaio</a>, Editorial: <a class="rated-user user-red" href="https://codeforces.com/profile/anpaio" title="International Grandmaster anpaio">anpaio</a></p> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2143/problem/B" title="Codeforces Round 1051 (Div. 2)">2143B - Discounts</a></h3><div class="ttypography"><div class="problem-statement"><div><p>Consider first the costs of the products in decreasing order. It is clear that is always makes sense to have vouchers occupy a continuous range of such costs as to maximize the minimum value taken for free in each voucher. Further on, it makes sense for these vouchers to occupy a prefix of these costs for the same reasons, potentially leaving a suffix of these unaccounted in any voucher.</p><p>Consider now two such adjacent vouchers. If the left one spans for less costs than the right one, then swapping the ranges they cover (i.e. putting the shorter one first) would only optimize the target value. Furthermore, every single arrangement of vouchers can be brought by such optimizations to the universal optimum, that is, where all the vouchers cover costs in increasing order of power.</p><p>We remind now that we have proven that any optimum distribution of products into vouchers respects the following conditions: every voucher covers a contiguous set of costs, the reunion of all the vouchers cover a prefix of the costs (where these are written in decreasing order), and these vouchers are listed in increasing order of length throughout this prefix.</p><p>It remains that we prove that the set of used vouchers is a prefix of that of the sorted vector of vouchers. This can be proven by noticing that exchanging a bigger voucher for a smaller one, and then reapplying the rules before, would make all the free elements shift towards the left, i.e. obtaining a lexicographically bigger set of free elements. Furthermore, it can also be the case that a smaller voucher can be added to cover some of the uncovered products. In this case, including it is obviously optimal and the current configuration can be optimized given the rules before.</p><p>As such, in the end we will employ the following algorithm: We traverse the set of discounts in increasing order and apply them to the set of products sorted in decreasing order. If the voucher to be used cannot be applied on these (on the premise that there are not enough products), it is ommitted and the algorithm is stopped.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Code</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
 
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> k</span><span class="pun">,</span><span class="pln"> a</span><span class="pun">[</span><span class="lit">200005</span><span class="pun">],</span><span class="pln"> b</span><span class="pun">[</span><span class="lit">200005</span><span class="pun">];</span><span class="pln">
 
</span><span class="kwd">void</span><span class="pln"> testcase</span><span class="pun">()</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n </span><span class="pun">&gt;&gt;</span><span class="pln"> k</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
        cin </span><span class="pun">&gt;&gt;</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> k</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
        cin </span><span class="pun">&gt;&gt;</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
    </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> ans </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    sort</span><span class="pun">(</span><span class="pln">a </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> a </span><span class="pun">+</span><span class="pln"> n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
    sort</span><span class="pun">(</span><span class="pln">b </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> b </span><span class="pun">+</span><span class="pln"> k </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
        ans </span><span class="pun">+=</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
    </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> id </span><span class="pun">=</span><span class="pln"> n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> k</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
        id </span><span class="pun">-=</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">id </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">
            ans </span><span class="pun">-=</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">id</span><span class="pun">];</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    cout </span><span class="pun">&lt;&lt;</span><span class="pln"> ans </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> tc</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> tc</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">tc</span><span class="pun">--)</span><span class="pln">
        testcase</span><span class="pun">();</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2143/problem/C" title="Codeforces Round 1051 (Div. 2)">2143C - Max Tree</a></p><p>Author: <a class="rated-user user-orange" href="https://codeforces.com/profile/LucaLucaM" title="Master LucaLucaM">LucaLucaM</a>, Preparation: <a class="rated-user user-orange" href="https://codeforces.com/profile/LucaLucaM" title="Master LucaLucaM">LucaLucaM</a>, Editorial: <a class="rated-user user-violet" href="https://codeforces.com/profile/tvladm" title="Candidate Master tvladm">tvladm</a></p> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2143/problem/C" title="Codeforces Round 1051 (Div. 2)">2143C - Max Tree</a></h3><div class="ttypography"><div class="problem-statement"><div><p><span class="tex-font-style-bf">Claim: </span> For each edge <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-489"><span class="MJXp-mo" id="MJXp-Span-490" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-491">u</span><span class="MJXp-mo" id="MJXp-Span-492" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-493">v</span><span class="MJXp-mo" id="MJXp-Span-494" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-495">x</span><span class="MJXp-mo" id="MJXp-Span-496" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-497">y</span><span class="MJXp-mo" id="MJXp-Span-498" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-90">(u, v, x, y)</script> we can make it's contribution equal to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-499"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-500">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-501">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-502">x</span><span class="MJXp-mo" id="MJXp-Span-503" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-504">x</span><span class="MJXp-mo" id="MJXp-Span-505" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-506">y</span><span class="MJXp-mo" id="MJXp-Span-507" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-91">max(x, y)</script>.</p><p><span class="tex-font-style-bf">Proof: </span> </p><p>Let's assign an orientation to each edge. If <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-508"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-509">x</span><span class="MJXp-mo" id="MJXp-Span-510" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-511">y</span></span></span><script type="math/tex" id="MathJax-Element-92">x \leq y</script> then our edge in the newly formed graph will be <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-512"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-513">u</span><span class="MJXp-mo" id="MJXp-Span-514" style="margin-left: 0.333em; margin-right: 0.333em;">→</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-515">v</span></span></span><script type="math/tex" id="MathJax-Element-93">u \to v</script>, otherwise it will be <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-516"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-517">v</span><span class="MJXp-mo" id="MJXp-Span-518" style="margin-left: 0.333em; margin-right: 0.333em;">→</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-519">u</span></span></span><script type="math/tex" id="MathJax-Element-94">v \to u</script>. </p><p>It's easy to see that this graph is a DAG (Directed Acyclic Graph). </p><p>Now, we can topologically sort our DAG to obtain an ordering of its vertices. Let's say <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-520"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-521">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-522">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-523">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-524">e</span><span class="MJXp-msubsup" id="MJXp-Span-525"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-526" style="margin-right: 0.05em;">r</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-527" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-528" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-529">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-530">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-531">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-532">e</span><span class="MJXp-msubsup" id="MJXp-Span-533"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-534" style="margin-right: 0.05em;">r</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-535" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-536" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-537" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-538" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-539">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-540">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-541">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-542">e</span><span class="MJXp-msubsup" id="MJXp-Span-543"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-544" style="margin-right: 0.05em;">r</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-545" style="vertical-align: -0.4em;">n</span></span></span></span><script type="math/tex" id="MathJax-Element-95">order_1, order_2, \dots, order_n</script> is the resulting order. If we make <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-546"><span class="MJXp-msubsup" id="MJXp-Span-547"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-548" style="margin-right: 0.05em;">p</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-549" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-550">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-551">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-552">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-553">e</span><span class="MJXp-msubsup" id="MJXp-Span-554"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-555" style="margin-right: 0.05em;">r</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-556" style="vertical-align: -0.4em;">i</span></span></span></span><span class="MJXp-mo" id="MJXp-Span-557" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-558">i</span></span></span><script type="math/tex" id="MathJax-Element-96">p_{order_i} = i</script> then all our conditions will be satisfied. Why? </p><p>Let's say that we have an edge <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-559"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-560">x</span><span class="MJXp-mo" id="MJXp-Span-561" style="margin-left: 0.333em; margin-right: 0.333em;">→</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-562">y</span></span></span><script type="math/tex" id="MathJax-Element-97">x \to y</script>. We know that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-563"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-564">x</span></span></span><script type="math/tex" id="MathJax-Element-98">x</script> appears earlier in the ordering than <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-565"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-566">y</span></span></span><script type="math/tex" id="MathJax-Element-99">y</script>, thus <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-567"><span class="MJXp-msubsup" id="MJXp-Span-568"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-569" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-570" style="vertical-align: -0.4em;">x</span></span><span class="MJXp-mo" id="MJXp-Span-571" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-msubsup" id="MJXp-Span-572"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-573" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-574" style="vertical-align: -0.4em;">y</span></span></span></span><script type="math/tex" id="MathJax-Element-100">p_x \lt p_y</script> which is exactly what we wanted. </p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Code</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pln"> </span><span class="str">&lt;iostream&gt;</span><span class="pln">
</span><span class="com">#include</span><span class="pln"> </span><span class="str">&lt;cassert&gt;</span><span class="pln">
</span><span class="com">#include</span><span class="pln"> </span><span class="str">&lt;vector&gt;</span><span class="pln">
</span><span class="com">#include</span><span class="pln"> </span><span class="str">&lt;algorithm&gt;</span><span class="pln">
</span><span class="com">#include</span><span class="pln"> </span><span class="str">&lt;queue&gt;</span><span class="pln">
 
</span><span class="com">#define</span><span class="pln"> debug</span><span class="pun">(</span><span class="pln">x</span><span class="pun">)</span><span class="pln"> </span><span class="com">#x &lt;&lt; " = " &lt;&lt; x &lt;&lt; '\n'</span><span class="pln">
 
</span><span class="kwd">using</span><span class="pln"> ll </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pun">;</span><span class="pln">
</span><span class="com">#define</span><span class="pln"> YES std</span><span class="pun">::</span><span class="pln">cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"YES\n"</span><span class="pln">
</span><span class="com">#define</span><span class="pln"> NO std</span><span class="pun">::</span><span class="pln">cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"NO\n"</span><span class="pln">
 
</span><span class="kwd">struct</span><span class="pln"> </span><span class="typ">Edge</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">int</span><span class="pln"> u</span><span class="pun">,</span><span class="pln"> v</span><span class="pun">,</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> y</span><span class="pun">;</span><span class="pln">
</span><span class="pun">};</span><span class="pln">
 
</span><span class="kwd">void</span><span class="pln"> solve</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
  std</span><span class="pun">::</span><span class="pln">cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
 
  std</span><span class="pun">::</span><span class="pln">vector</span><span class="str">&lt;int&gt;</span><span class="pln"> deg</span><span class="pun">(</span><span class="pln">n</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span><span class="pln">
  std</span><span class="pun">::</span><span class="pln">vector</span><span class="pun">&lt;</span><span class="pln">std</span><span class="pun">::</span><span class="pln">vector</span><span class="str">&lt;int&gt;</span><span class="pun">&gt;</span><span class="pln"> g</span><span class="pun">(</span><span class="pln">n</span><span class="pun">);</span><span class="pln">
  std</span><span class="pun">::</span><span class="pln">vector</span><span class="pun">&lt;</span><span class="pln">std</span><span class="pun">::</span><span class="pln">vector</span><span class="str">&lt;int&gt;</span><span class="pun">&gt;</span><span class="pln"> gg</span><span class="pun">(</span><span class="pln">n</span><span class="pun">);</span><span class="pln">
 
  std</span><span class="pun">::</span><span class="pln">vector</span><span class="pun">&lt;</span><span class="typ">Edge</span><span class="pun">&gt;</span><span class="pln"> e</span><span class="pun">(</span><span class="pln">n </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
 
  </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">auto</span><span class="pln"> </span><span class="pun">&amp;[</span><span class="pln">u</span><span class="pun">,</span><span class="pln"> v</span><span class="pun">,</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> y</span><span class="pun">]</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    std</span><span class="pun">::</span><span class="pln">cin </span><span class="pun">&gt;&gt;</span><span class="pln"> u </span><span class="pun">&gt;&gt;</span><span class="pln"> v </span><span class="pun">&gt;&gt;</span><span class="pln"> x </span><span class="pun">&gt;&gt;</span><span class="pln"> y</span><span class="pun">;</span><span class="pln">
    u</span><span class="pun">--,</span><span class="pln"> v</span><span class="pun">--;</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x </span><span class="pun">&gt;</span><span class="pln"> y</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      g</span><span class="pun">[</span><span class="pln">u</span><span class="pun">].</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">v</span><span class="pun">);</span><span class="pln">
      gg</span><span class="pun">[</span><span class="pln">v</span><span class="pun">].</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">u</span><span class="pun">);</span><span class="pln">
      deg</span><span class="pun">[</span><span class="pln">u</span><span class="pun">]++;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      g</span><span class="pun">[</span><span class="pln">v</span><span class="pun">].</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">u</span><span class="pun">);</span><span class="pln">
      gg</span><span class="pun">[</span><span class="pln">u</span><span class="pun">].</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">v</span><span class="pun">);</span><span class="pln">
      deg</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]++;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
 
  std</span><span class="pun">::</span><span class="pln">queue</span><span class="str">&lt;int&gt;</span><span class="pln"> q</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">deg</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      q</span><span class="pun">.</span><span class="pln">push</span><span class="pun">(</span><span class="pln">i</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
 
  std</span><span class="pun">::</span><span class="pln">vector</span><span class="str">&lt;int&gt;</span><span class="pln"> p</span><span class="pun">(</span><span class="pln">n</span><span class="pun">);</span><span class="pln">
 
  </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> u </span><span class="pun">=</span><span class="pln"> q</span><span class="pun">.</span><span class="pln">front</span><span class="pun">();</span><span class="pln">
    p</span><span class="pun">[</span><span class="pln">u</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> i</span><span class="pun">;</span><span class="pln">
    q</span><span class="pun">.</span><span class="pln">pop</span><span class="pun">();</span><span class="pln">
 
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">auto</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">v </span><span class="pun">:</span><span class="pln"> gg</span><span class="pun">[</span><span class="pln">u</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      deg</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]--;</span><span class="pln">
      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">deg</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        q</span><span class="pun">.</span><span class="pln">push</span><span class="pun">(</span><span class="pln">v</span><span class="pun">);</span><span class="pln">
      </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
  
  </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">auto</span><span class="pln"> </span><span class="pun">[</span><span class="pln">u</span><span class="pun">,</span><span class="pln"> v</span><span class="pun">,</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> y</span><span class="pun">]</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x </span><span class="pun">&gt;</span><span class="pln"> y</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      </span><span class="kwd">assert</span><span class="pun">(</span><span class="pln">p</span><span class="pun">[</span><span class="pln">u</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> p</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x </span><span class="pun">&lt;</span><span class="pln"> y</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      </span><span class="kwd">assert</span><span class="pun">(</span><span class="pln">p</span><span class="pun">[</span><span class="pln">u</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> p</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
 
  </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x </span><span class="pun">:</span><span class="pln"> p</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    std</span><span class="pun">::</span><span class="pln">cout </span><span class="pun">&lt;&lt;</span><span class="pln"> x </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">' '</span><span class="pun">;</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="com">#ifdef</span><span class="pln"> LOCAL
freopen</span><span class="pun">(</span><span class="str">"input.txt"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"r"</span><span class="pun">,</span><span class="pln"> stdin</span><span class="pun">);</span><span class="pln">
  </span><span class="com">#endif</span><span class="pln">
  std</span><span class="pun">::</span><span class="pln">ios_base</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="kwd">false</span><span class="pun">);</span><span class="pln">
  std</span><span class="pun">::</span><span class="pln">cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
  std</span><span class="pun">::</span><span class="pln">cout</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
 
   </span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
   std</span><span class="pun">::</span><span class="pln">cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
   </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> tc </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> tc </span><span class="pun">&lt;=</span><span class="pln"> t</span><span class="pun">;</span><span class="pln"> tc</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    std</span><span class="pun">::</span><span class="pln">cerr </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"Case #"</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> tc </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">":\n"</span><span class="pun">;</span><span class="pln">
    solve</span><span class="pun">();</span><span class="pln">
    std</span><span class="pun">::</span><span class="pln">cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
   </span><span class="pun">}</span><span class="pln">
 
  </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2143/problem/D1" title="Codeforces Round 1051 (Div. 2)">2143D1 - Inversion Graph Coloring (Easy Version)</a></p><p>Author: <a class="rated-user user-orange" href="https://codeforces.com/profile/LucaLucaM" title="Master LucaLucaM">LucaLucaM</a>, Preparation: <a class="rated-user user-red" href="https://codeforces.com/profile/anpaio" title="International Grandmaster anpaio">anpaio</a>, Editorial: <a class="rated-user user-red" href="https://codeforces.com/profile/anpaio" title="International Grandmaster anpaio">anpaio</a></p> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2143/problem/D1" title="Codeforces Round 1051 (Div. 2)">2143D1 - Inversion Graph Coloring (Easy Version)</a></h3><div class="ttypography"><div class="problem-statement"><div><p>First, what does it mean for a sequence to be "good"? It turns out, the graph created by drawing an edge between <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-575"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-576">i</span></span></span><script type="math/tex" id="MathJax-Element-101">i</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-577"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-578">j</span></span></span><script type="math/tex" id="MathJax-Element-102">j</script> only if <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-579"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-580">i</span><span class="MJXp-mo" id="MJXp-Span-581" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-582">j</span></span></span><script type="math/tex" id="MathJax-Element-103">i < j</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-583"><span class="MJXp-msubsup" id="MJXp-Span-584"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-585" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-586" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-587">i</span></span></span><span class="MJXp-mo" id="MJXp-Span-588" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-msubsup" id="MJXp-Span-589"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-590" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-591" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-592">j</span></span></span></span></span><script type="math/tex" id="MathJax-Element-104">a_{i} > a_{j}</script> is "<span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-593"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-594">k</span></span></span><script type="math/tex" id="MathJax-Element-105">k</script>-colorable" if and only if the length of its LDS (longest decreasing subsequence) is at most <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-595"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-596">k</span></span></span><script type="math/tex" id="MathJax-Element-106">k</script>. Proving this is actually quite easy: if the length of the LDS is more than <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-597"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-598">k</span></span></span><script type="math/tex" id="MathJax-Element-107">k</script>, there exists a clique of size more than <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-599"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-600">k</span></span></span><script type="math/tex" id="MathJax-Element-108">k</script>, which is not <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-601"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-602">k</span></span></span><script type="math/tex" id="MathJax-Element-109">k</script>-colorable. If, however, the length of the LDS is at most <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-603"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-604">k</span></span></span><script type="math/tex" id="MathJax-Element-110">k</script>, we can color element <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-605"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-606">i</span></span></span><script type="math/tex" id="MathJax-Element-111">i</script> in "the length of the LDS starting at <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-607"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-608">i</span></span></span><script type="math/tex" id="MathJax-Element-112">i</script>". This way, colors will be between 1 and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-609"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-610">k</span></span></span><script type="math/tex" id="MathJax-Element-113">k</script>, and no two elements of the same color will be directly connected, since then the one with the lower index would have a bigger LDS starting from it than the other one. </p><p>Now back to our problem. We basically have to count the number of subsequences such that their LDS is at most 2. Assume we have already set a subsequence and want to verify whether its LDS is at most 2 in linear time. A possible way to do it is to try, for each prefix, to find some value <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-611"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-612">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-613">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-614">x</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-615">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-616">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-617">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-618">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-619">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-620">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-621">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-622">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-623">d</span></span></span><script type="math/tex" id="MathJax-Element-114">maxpreceeded</script> (<span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-624"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-625">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-626">p</span></span></span><script type="math/tex" id="MathJax-Element-115">mp</script> for short), representing the biggest value that we've met on this prefix that has a bigger value to its left. If we have this for each prefix, we should just check whether <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-627"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-628">m</span><span class="MJXp-msubsup" id="MJXp-Span-629"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-630" style="margin-right: 0.05em;">p</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-631" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-632">i</span></span></span><span class="MJXp-mo" id="MJXp-Span-633" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;=</span><span class="MJXp-msubsup" id="MJXp-Span-634"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-635" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-636" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-637">i</span><span class="MJXp-mo" id="MJXp-Span-638">+</span><span class="MJXp-mn" id="MJXp-Span-639">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-116">mp_{i} <= a_{i+1}</script> for each <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-640"><span class="MJXp-mn" id="MJXp-Span-641">1</span><span class="MJXp-mo" id="MJXp-Span-642" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-643">i</span><span class="MJXp-mo" id="MJXp-Span-644" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-645">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-646">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-647">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-648">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-649">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-650">h</span></span></span><script type="math/tex" id="MathJax-Element-117">1 < i < length</script>. To calculate <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-651"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-652">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-653">p</span></span></span><script type="math/tex" id="MathJax-Element-118">mp</script>, we'll probably also need to keep track of the maximum value on each prefix, call it <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-654"><span class="MJXp-msubsup" id="MJXp-Span-655"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-656" style="margin-right: 0.05em;">m</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-657" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-658">i</span></span></span></span></span><script type="math/tex" id="MathJax-Element-119">m_{i}</script>.</p><p>This allows us to formulate the following dp: <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-659"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-660">w</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-661">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-662">y</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-663">s</span><span class="MJXp-mo" id="MJXp-Span-664" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-665">i</span><span class="MJXp-mo" id="MJXp-Span-666" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-667" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-668">m</span><span class="MJXp-mo" id="MJXp-Span-669" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-670" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-671">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-672">p</span><span class="MJXp-mo" id="MJXp-Span-673" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-674" style="margin-left: 0.333em; margin-right: 0.333em;">=</span></span></span><script type="math/tex" id="MathJax-Element-120">ways[i][m][mp] =</script> the number of ways to select a subsequence of the first <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-675"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-676">i</span></span></span><script type="math/tex" id="MathJax-Element-121">i</script> elements, so that the maximum element selected is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-677"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-678">m</span></span></span><script type="math/tex" id="MathJax-Element-122">m</script>, and the maximum element preceeded by a bigger one is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-679"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-680">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-681">p</span></span></span><script type="math/tex" id="MathJax-Element-123">mp</script>. We could say that a value of 0 for <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-682"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-683">m</span></span></span><script type="math/tex" id="MathJax-Element-124">m</script> or <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-684"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-685">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-686">p</span></span></span><script type="math/tex" id="MathJax-Element-125">mp</script> means "inexistence". </p><p>What would be the transitions? </p><ul> <li> if we don't use element <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-687"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-688">i</span></span></span><script type="math/tex" id="MathJax-Element-126">i</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-689"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-690">w</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-691">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-692">y</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-693">s</span><span class="MJXp-mo" id="MJXp-Span-694" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-695">i</span><span class="MJXp-mo" id="MJXp-Span-696" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-697">1</span><span class="MJXp-mo" id="MJXp-Span-698" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-699" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-700">m</span><span class="MJXp-mo" id="MJXp-Span-701" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-702" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-703">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-704">p</span><span class="MJXp-mo" id="MJXp-Span-705" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-127">ways[i - 1][m][mp]</script> transitions to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-706"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-707">w</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-708">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-709">y</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-710">s</span><span class="MJXp-mo" id="MJXp-Span-711" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-712">i</span><span class="MJXp-mo" id="MJXp-Span-713" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-714" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-715">m</span><span class="MJXp-mo" id="MJXp-Span-716" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-717" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-718">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-719">p</span><span class="MJXp-mo" id="MJXp-Span-720" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-128">ways[i][m][mp]</script> for all pairs of (<span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-721"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-722">m</span></span></span><script type="math/tex" id="MathJax-Element-129">m</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-723"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-724">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-725">p</span></span></span><script type="math/tex" id="MathJax-Element-130">mp</script>) </li><li> if we use element <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-726"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-727">i</span></span></span><script type="math/tex" id="MathJax-Element-131">i</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-728"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-729">w</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-730">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-731">y</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-732">s</span><span class="MJXp-mo" id="MJXp-Span-733" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-734">i</span><span class="MJXp-mo" id="MJXp-Span-735" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-736">1</span><span class="MJXp-mo" id="MJXp-Span-737" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-738" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-739">m</span><span class="MJXp-mo" id="MJXp-Span-740" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-741" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-742">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-743">p</span><span class="MJXp-mo" id="MJXp-Span-744" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-132">ways[i - 1][m][mp]</script> transitions to: <ul> <li> <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-745"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-746">w</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-747">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-748">y</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-749">s</span><span class="MJXp-mo" id="MJXp-Span-750" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-751">i</span><span class="MJXp-mo" id="MJXp-Span-752" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-753" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-msubsup" id="MJXp-Span-754"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-755" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-756" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-757">i</span></span></span><span class="MJXp-mo" id="MJXp-Span-758" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-759" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-760">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-761">p</span><span class="MJXp-mo" id="MJXp-Span-762" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-133">ways[i][a_{i}][mp]</script> if <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-763"><span class="MJXp-msubsup" id="MJXp-Span-764"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-765" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-766" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-767">i</span></span></span><span class="MJXp-mo" id="MJXp-Span-768" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-769">m</span></span></span><script type="math/tex" id="MathJax-Element-134">a_{i} \geq m</script> </li><li> <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-770"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-771">w</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-772">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-773">y</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-774">s</span><span class="MJXp-mo" id="MJXp-Span-775" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-776">i</span><span class="MJXp-mo" id="MJXp-Span-777" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-778" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-779">m</span><span class="MJXp-mo" id="MJXp-Span-780" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-781" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-msubsup" id="MJXp-Span-782"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-783" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-784" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-785">i</span></span></span><span class="MJXp-mo" id="MJXp-Span-786" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-135">ways[i][m][a_{i}]</script> if <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-787"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-788">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-789">p</span><span class="MJXp-mo" id="MJXp-Span-790" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-msubsup" id="MJXp-Span-791"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-792" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-793" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-794">i</span></span></span><span class="MJXp-mo" id="MJXp-Span-795" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-796">m</span></span></span><script type="math/tex" id="MathJax-Element-136">mp \leq a_{i} < m</script> </li><li> <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-797"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-798">w</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-799">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-800">y</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-801">s</span><span class="MJXp-mo" id="MJXp-Span-802" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-803">i</span><span class="MJXp-mo" id="MJXp-Span-804" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-805" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-806">m</span><span class="MJXp-mo" id="MJXp-Span-807" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-808" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-809">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-810">p</span><span class="MJXp-mo" id="MJXp-Span-811" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-137">ways[i][m][mp]</script> if <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-812"><span class="MJXp-msubsup" id="MJXp-Span-813"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-814" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-815" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-816">i</span></span></span><span class="MJXp-mo" id="MJXp-Span-817" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-818">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-819">p</span></span></span><script type="math/tex" id="MathJax-Element-138">a_{i} < mp</script>. This transition is, however, not valid, because it breaks our LDS with <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-820"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-821">m</span><span class="MJXp-mo" id="MJXp-Span-822" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-823">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-824">p</span><span class="MJXp-mo" id="MJXp-Span-825" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-msubsup" id="MJXp-Span-826"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-827" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-828" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-829">i</span></span></span></span></span><script type="math/tex" id="MathJax-Element-139">m > mp > a_{i}</script> </li></ul> </li></ul><p>All the transitions are constant, and the dp has <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-830"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-831">O</span><span class="MJXp-mo" id="MJXp-Span-832" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-833"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-834" style="margin-right: 0.05em;">n</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-835" style="vertical-align: 0.5em;"><span class="MJXp-mn" id="MJXp-Span-836">3</span></span></span><span class="MJXp-mo" id="MJXp-Span-837" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-140">O(n^{3})</script> states, so the complexity is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-838"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-839">O</span><span class="MJXp-mo" id="MJXp-Span-840" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-841"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-842" style="margin-right: 0.05em;">n</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-843" style="vertical-align: 0.5em;"><span class="MJXp-mn" id="MJXp-Span-844">3</span></span></span><span class="MJXp-mo" id="MJXp-Span-845" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-141">O(n^{3})</script>. The answer is just the sum of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-846"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-847">w</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-848">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-849">y</span><span class="MJXp-msubsup" id="MJXp-Span-850"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-851" style="margin-right: 0.05em;">s</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-852" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-853">n</span><span class="MJXp-mo" id="MJXp-Span-854">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-855">m</span><span class="MJXp-mo" id="MJXp-Span-856">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-857">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-858">p</span></span></span></span></span><script type="math/tex" id="MathJax-Element-142">ways_{n, m, mp}</script> over all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-859"><span class="MJXp-mn" id="MJXp-Span-860">0</span><span class="MJXp-mo" id="MJXp-Span-861" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-862">m</span><span class="MJXp-mo" id="MJXp-Span-863" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-864">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-865">p</span><span class="MJXp-mo" id="MJXp-Span-866" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-867">n</span></span></span><script type="math/tex" id="MathJax-Element-143">0 \leq m, mp \leq n</script> (of course, all states with <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-868"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-869">m</span><span class="MJXp-mo" id="MJXp-Span-870" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-871">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-872">p</span></span></span><script type="math/tex" id="MathJax-Element-144">m \leq mp</script> will be 0).</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Code</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
 
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> NMAX </span><span class="pun">=</span><span class="pln"> </span><span class="lit">3000</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> modulo </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1e9</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">7</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">void</span><span class="pln"> addSelf</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">x</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> y</span><span class="pun">)</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    x </span><span class="pun">+=</span><span class="pln"> y</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x </span><span class="pun">&gt;=</span><span class="pln"> modulo</span><span class="pun">)</span><span class="pln">
        x </span><span class="pun">-=</span><span class="pln"> modulo</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> </span><span class="kwd">add</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> y</span><span class="pun">)</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    addSelf</span><span class="pun">(</span><span class="pln">x</span><span class="pun">,</span><span class="pln"> y</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> x</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">NMAX </span><span class="pun">+</span><span class="pln"> </span><span class="lit">5</span><span class="pun">],</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">NMAX </span><span class="pun">+</span><span class="pln"> </span><span class="lit">5</span><span class="pun">];</span><span class="com">///b -&gt; initial array, a -&gt; equivalent permutation</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> dp</span><span class="pun">[</span><span class="lit">2</span><span class="pun">][</span><span class="pln">NMAX </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">][</span><span class="pln">NMAX </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">];</span><span class="com">///considering elements 1..i, the biggest value is j, and the biggest value preceeded by a bigger one is q</span><span class="pln">
 
</span><span class="kwd">void</span><span class="pln"> testcase</span><span class="pun">()</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
        cin </span><span class="pun">&gt;&gt;</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
        a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;</span><span class="pln"> i</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++)</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">b</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;=</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln">
                a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]++;</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++)</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">b</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln">
                a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]++;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++)</span><span class="pln">
            </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> q </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> q </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> q</span><span class="pun">++)</span><span class="pln">
                dp</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">][</span><span class="pln">q</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    dp</span><span class="pun">[</span><span class="lit">0</span><span class="pun">][</span><span class="lit">0</span><span class="pun">][</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> cr </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
        cr </span><span class="pun">^=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> x </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++)</span><span class="pln">
            </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> q </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> q </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> q</span><span class="pun">++)</span><span class="pln">
                dp</span><span class="pun">[</span><span class="pln">cr</span><span class="pun">][</span><span class="pln">j</span><span class="pun">][</span><span class="pln">q</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> dp</span><span class="pun">[</span><span class="pln">cr </span><span class="pun">^</span><span class="pln"> </span><span class="lit">1</span><span class="pun">][</span><span class="pln">j</span><span class="pun">][</span><span class="pln">q</span><span class="pun">];</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++)</span><span class="pln">
        </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> q </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> q </span><span class="pun">&lt;=</span><span class="pln"> j</span><span class="pun">;</span><span class="pln"> q</span><span class="pun">++)</span><span class="pln">
            </span><span class="pun">{</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">dp</span><span class="pun">[</span><span class="pln">cr </span><span class="pun">^</span><span class="pln"> </span><span class="lit">1</span><span class="pun">][</span><span class="pln">j</span><span class="pun">][</span><span class="pln">q</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln">
                    </span><span class="kwd">continue</span><span class="pun">;</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">j </span><span class="pun">&gt;</span><span class="pln"> x </span><span class="kwd">and</span><span class="pln"> x </span><span class="pun">&gt;</span><span class="pln"> q</span><span class="pun">)</span><span class="pln">
                    addSelf</span><span class="pun">(</span><span class="pln">dp</span><span class="pun">[</span><span class="pln">cr</span><span class="pun">][</span><span class="pln">j</span><span class="pun">][</span><span class="pln">x</span><span class="pun">],</span><span class="pln"> dp</span><span class="pun">[</span><span class="pln">cr </span><span class="pun">^</span><span class="pln"> </span><span class="lit">1</span><span class="pun">][</span><span class="pln">j</span><span class="pun">][</span><span class="pln">q</span><span class="pun">]);</span><span class="pln">
                </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x </span><span class="pun">&gt;</span><span class="pln"> j</span><span class="pun">)</span><span class="pln">
                    addSelf</span><span class="pun">(</span><span class="pln">dp</span><span class="pun">[</span><span class="pln">cr</span><span class="pun">][</span><span class="pln">x</span><span class="pun">][</span><span class="pln">q</span><span class="pun">],</span><span class="pln"> dp</span><span class="pun">[</span><span class="pln">cr </span><span class="pun">^</span><span class="pln"> </span><span class="lit">1</span><span class="pun">][</span><span class="pln">j</span><span class="pun">][</span><span class="pln">q</span><span class="pun">]);</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> ans </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++)</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> q </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> q </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> q</span><span class="pun">++)</span><span class="pln">
            addSelf</span><span class="pun">(</span><span class="pln">ans</span><span class="pun">,</span><span class="pln"> dp</span><span class="pun">[</span><span class="pln">cr</span><span class="pun">][</span><span class="pln">j</span><span class="pun">][</span><span class="pln">q</span><span class="pun">]);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    cout </span><span class="pun">&lt;&lt;</span><span class="pln"> ans </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="com">///empty subsequence inclusive</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> tc</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> tc</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">tc</span><span class="pun">--)</span><span class="pln">
        testcase</span><span class="pun">();</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2143/problem/D2" title="Codeforces Round 1051 (Div. 2)">2143D2 - Inversion Graph Coloring (Hard Version)</a></p><p>Author: <a class="rated-user user-orange" href="https://codeforces.com/profile/LucaLucaM" title="Master LucaLucaM">LucaLucaM</a>, Preparation: <a class="rated-user user-red" href="https://codeforces.com/profile/anpaio" title="International Grandmaster anpaio">anpaio</a>, Editorial: <a class="rated-user user-red" href="https://codeforces.com/profile/anpaio" title="International Grandmaster anpaio">anpaio</a></p> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2143/problem/D2" title="Codeforces Round 1051 (Div. 2)">2143D2 - Inversion Graph Coloring (Hard Version)</a></h3><div class="ttypography"><div class="problem-statement"><div><p>Read the tutorial of the easy version first. Since this problem does not admit <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-873"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-874">O</span><span class="MJXp-mo" id="MJXp-Span-875" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-876"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-877" style="margin-right: 0.05em;">n</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-878" style="vertical-align: 0.5em;"><span class="MJXp-mn" id="MJXp-Span-879">3</span></span></span><span class="MJXp-mo" id="MJXp-Span-880" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-145">O(n^{3})</script>, we should try to somehow reduce the states of the (currently) tridimensional array <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-881"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-882">w</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-883">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-884">y</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-885">s</span></span></span><script type="math/tex" id="MathJax-Element-146">ways</script>. One important thing to notice is that the first type of transition literally copies the matrix of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-886"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-887">w</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-888">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-889">y</span><span class="MJXp-msubsup" id="MJXp-Span-890"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-891" style="margin-right: 0.05em;">s</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-892" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-893">i</span><span class="MJXp-mo" id="MJXp-Span-894">−</span><span class="MJXp-mn" id="MJXp-Span-895">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-147">ways_{i - 1}</script> to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-896"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-897">w</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-898">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-899">y</span><span class="MJXp-msubsup" id="MJXp-Span-900"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-901" style="margin-right: 0.05em;">s</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-902" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-903">i</span></span></span></span></span><script type="math/tex" id="MathJax-Element-148">ways_{i}</script>, and the second type of transition only changes elements on line or column <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-904"><span class="MJXp-msubsup" id="MJXp-Span-905"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-906" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-907" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-908">i</span></span></span></span></span><script type="math/tex" id="MathJax-Element-149">a_{i}</script>, meaning a total of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-909"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-910">O</span><span class="MJXp-mo" id="MJXp-Span-911" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-912">n</span><span class="MJXp-mo" id="MJXp-Span-913" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-150">O(n)</script> elements at step <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-914"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-915">i</span></span></span><script type="math/tex" id="MathJax-Element-151">i</script>. </p><p>An idea that comes to mind is to then completely forget about the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-916"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-917">i</span></span></span><script type="math/tex" id="MathJax-Element-152">i</script> state in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-918"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-919">w</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-920">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-921">y</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-922">s</span></span></span><script type="math/tex" id="MathJax-Element-153">ways</script>, so that "copying" the matrix from <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-923"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-924">i</span><span class="MJXp-mo" id="MJXp-Span-925" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-926">1</span></span></span><script type="math/tex" id="MathJax-Element-154">i - 1</script> to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-927"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-928">i</span></span></span><script type="math/tex" id="MathJax-Element-155">i</script> becomes automatic. We'll denote previous (for <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-929"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-930">i</span><span class="MJXp-mo" id="MJXp-Span-931" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-932">1</span></span></span><script type="math/tex" id="MathJax-Element-156">i-1</script>) maximum, maximum preceeded and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-933"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-934">w</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-935">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-936">y</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-937">s</span></span></span><script type="math/tex" id="MathJax-Element-157">ways</script> as <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-938"><span class="MJXp-msup" id="MJXp-Span-939"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-940" style="margin-right: 0.05em;">m</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-941" style="vertical-align: 0.5em;">′</span></span></span></span><script type="math/tex" id="MathJax-Element-158">m'</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-942"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-943">m</span><span class="MJXp-msup" id="MJXp-Span-944"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-945" style="margin-right: 0.05em;">p</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-946" style="vertical-align: 0.5em;">′</span></span></span></span><script type="math/tex" id="MathJax-Element-159">mp'</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-947"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-948">w</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-949">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-950">y</span><span class="MJXp-msup" id="MJXp-Span-951"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-952" style="margin-right: 0.05em;">s</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-953" style="vertical-align: 0.5em;">′</span></span></span></span><script type="math/tex" id="MathJax-Element-160">ways'</script>. Now let's look at the transitions from the step when taking <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-954"><span class="MJXp-msubsup" id="MJXp-Span-955"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-956" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-957" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-958">i</span></span></span></span></span><script type="math/tex" id="MathJax-Element-161">a_{i}</script>: </p><ul> <li> if now <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-959"><span class="MJXp-msubsup" id="MJXp-Span-960"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-961" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-962" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-963">i</span></span></span><span class="MJXp-mo" id="MJXp-Span-964" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-965">m</span></span></span><script type="math/tex" id="MathJax-Element-162">a_{i} = m</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-966"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-967">w</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-968">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-969">y</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-970">s</span><span class="MJXp-mo" id="MJXp-Span-971" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-msubsup" id="MJXp-Span-972"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-973" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-974" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-975">i</span></span></span><span class="MJXp-mo" id="MJXp-Span-976" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-977" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-978">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-979">p</span><span class="MJXp-mo" id="MJXp-Span-980" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-163">ways[a_{i}][mp]</script> += <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-981"><span class="MJXp-msubsup" id="MJXp-Span-982"><span class="MJXp-mo" id="MJXp-Span-983" style="margin-left: 0.111em; margin-right: 0.05em;">∑</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.59em;"><span class="MJXp-mrow" id="MJXp-Span-990"><span class="MJXp-msubsup" id="MJXp-Span-991"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-992" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-993" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-994">i</span></span></span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mrow" id="MJXp-Span-984"><span class="MJXp-msup" id="MJXp-Span-985"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-986" style="margin-right: 0.05em;">m</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-987" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-988">=</span><span class="MJXp-mn" id="MJXp-Span-989">0</span></span></span></span></span></span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-995">w</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-996">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-997">y</span><span class="MJXp-msup" id="MJXp-Span-998"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-999" style="margin-right: 0.05em;">s</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1000" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-1001" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-msup" id="MJXp-Span-1002"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1003" style="margin-right: 0.05em;">m</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1004" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-1005" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1006" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1007">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1008">p</span><span class="MJXp-mo" id="MJXp-Span-1009" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-164">\sum_{m'=0}^{a_{i}} ways'[m'][mp]</script> </li><li> if now <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1010"><span class="MJXp-msubsup" id="MJXp-Span-1011"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1012" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1013" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1014">i</span></span></span><span class="MJXp-mo" id="MJXp-Span-1015" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1016">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1017">p</span></span></span><script type="math/tex" id="MathJax-Element-165">a_{i} = mp</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1018"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1019">w</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1020">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1021">y</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1022">s</span><span class="MJXp-mo" id="MJXp-Span-1023" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1024">m</span><span class="MJXp-mo" id="MJXp-Span-1025" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1026" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-msubsup" id="MJXp-Span-1027"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1028" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1029" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1030">i</span></span></span><span class="MJXp-mo" id="MJXp-Span-1031" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-166">ways[m][a_{i}]</script> += <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1032"><span class="MJXp-msubsup" id="MJXp-Span-1033"><span class="MJXp-mo" id="MJXp-Span-1034" style="margin-left: 0.111em; margin-right: 0.05em;">∑</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.59em;"><span class="MJXp-mrow" id="MJXp-Span-1042"><span class="MJXp-msubsup" id="MJXp-Span-1043"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1044" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1045" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1046">i</span></span></span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mrow" id="MJXp-Span-1035"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1036">m</span><span class="MJXp-msup" id="MJXp-Span-1037"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1038" style="margin-right: 0.05em;">p</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1039" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-1040">=</span><span class="MJXp-mn" id="MJXp-Span-1041">0</span></span></span></span></span></span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1047">w</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1048">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1049">y</span><span class="MJXp-msup" id="MJXp-Span-1050"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1051" style="margin-right: 0.05em;">s</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1052" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-1053" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1054">m</span><span class="MJXp-mo" id="MJXp-Span-1055" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1056" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1057">m</span><span class="MJXp-msup" id="MJXp-Span-1058"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1059" style="margin-right: 0.05em;">p</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1060" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-1061" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-167">\sum_{mp'=0}^{a_{i}} ways'[m][mp']</script> </li><li> otherwise, as also shown in the tutorial for D1, the LDS condition fails due to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1062"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1063">m</span><span class="MJXp-mo" id="MJXp-Span-1064" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1065">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1066">p</span><span class="MJXp-mo" id="MJXp-Span-1067" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1068"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1069" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1070" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1071">i</span></span></span></span></span><script type="math/tex" id="MathJax-Element-168">m, mp, a_{i}</script> </li></ul><p>So now we only have <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1072"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1073">O</span><span class="MJXp-mo" id="MJXp-Span-1074" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1075"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1076" style="margin-right: 0.05em;">n</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1077" style="vertical-align: 0.5em;"><span class="MJXp-mn" id="MJXp-Span-1078">2</span></span></span><span class="MJXp-mo" id="MJXp-Span-1079" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-169">O(n^{2})</script> "state updates", but each takes linear time, keeping us at <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1080"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1081">O</span><span class="MJXp-mo" id="MJXp-Span-1082" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1083"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1084" style="margin-right: 0.05em;">n</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1085" style="vertical-align: 0.5em;"><span class="MJXp-mn" id="MJXp-Span-1086">3</span></span></span><span class="MJXp-mo" id="MJXp-Span-1087" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-170">O(n^{3})</script>. However, the transitions are now simple enough to apply a data structure on them, such as a fenwick tree. We can keep a fenwick tree on every line and every column of the matrix <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1088"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1089">w</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1090">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1091">y</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1092">s</span></span></span><script type="math/tex" id="MathJax-Element-171">ways</script>, finding out, for each <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1093"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1094">i</span></span></span><script type="math/tex" id="MathJax-Element-172">i</script>, at what positions should we update our matrix, and updating it at the end of iteration <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1095"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1096">i</span></span></span><script type="math/tex" id="MathJax-Element-173">i</script> (so that we are querying the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1097"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1098">w</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1099">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1100">y</span><span class="MJXp-msup" id="MJXp-Span-1101"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1102" style="margin-right: 0.05em;">s</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1103" style="vertical-align: 0.5em;">′</span></span></span></span><script type="math/tex" id="MathJax-Element-174">ways'</script> version). An update on position <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1104"><span class="MJXp-mo" id="MJXp-Span-1105" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1106">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1107">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1108">n</span><span class="MJXp-mo" id="MJXp-Span-1109" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1110">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1111">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1112">l</span><span class="MJXp-mo" id="MJXp-Span-1113" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-175">(lin, col)</script> with value <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1114"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1115">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1116">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1117">l</span></span></span><script type="math/tex" id="MathJax-Element-176">val</script> means just updating position <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1118"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1119">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1120">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1121">l</span></span></span><script type="math/tex" id="MathJax-Element-177">col</script> in the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1122"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1123">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1124">i</span><span class="MJXp-msubsup" id="MJXp-Span-1125"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1126" style="margin-right: 0.05em;">n</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1127" style="vertical-align: 0.5em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1128">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1129">h</span></span></span></span></span><script type="math/tex" id="MathJax-Element-178">lin^{th}</script> line fenwick tree by <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1130"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1131">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1132">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1133">l</span></span></span><script type="math/tex" id="MathJax-Element-179">val</script> and similarly updating position <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1134"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1135">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1136">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1137">n</span></span></span><script type="math/tex" id="MathJax-Element-180">lin</script> in the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1138"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1139">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1140">o</span><span class="MJXp-msubsup" id="MJXp-Span-1141"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1142" style="margin-right: 0.05em;">l</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1143" style="vertical-align: 0.5em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1144">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1145">h</span></span></span></span></span><script type="math/tex" id="MathJax-Element-181">col^{th}</script> column fenwick tree by <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1146"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1147">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1148">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1149">l</span></span></span><script type="math/tex" id="MathJax-Element-182">val</script>. </p><p>Thus, we've reduced our memory to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1150"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1151">O</span><span class="MJXp-mo" id="MJXp-Span-1152" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1153"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1154" style="margin-right: 0.05em;">n</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1155" style="vertical-align: 0.5em;"><span class="MJXp-mn" id="MJXp-Span-1156">2</span></span></span><span class="MJXp-mo" id="MJXp-Span-1157" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-183">O(n^{2})</script> and our complexity to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1158"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1159">O</span><span class="MJXp-mo" id="MJXp-Span-1160" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1161"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1162" style="margin-right: 0.05em;">n</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1163" style="vertical-align: 0.5em;"><span class="MJXp-mn" id="MJXp-Span-1164">2</span></span></span><span class="MJXp-msubsup" id="MJXp-Span-1165"><span class="MJXp-mi" id="MJXp-Span-1166" style="margin-right: 0.05em;">log</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1167" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1168" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1169">n</span><span class="MJXp-mo" id="MJXp-Span-1170" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-184">O(n^{2}\log_2 n)</script>.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Code</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
 
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> NMAX </span><span class="pun">=</span><span class="pln"> </span><span class="lit">3000</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> modulo </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1e9</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">7</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">void</span><span class="pln"> addSelf</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">x</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> y</span><span class="pun">)</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    x </span><span class="pun">+=</span><span class="pln"> y</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x </span><span class="pun">&gt;=</span><span class="pln"> modulo</span><span class="pun">)</span><span class="pln">
        x </span><span class="pun">-=</span><span class="pln"> modulo</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> </span><span class="kwd">add</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> y</span><span class="pun">)</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    addSelf</span><span class="pun">(</span><span class="pln">x</span><span class="pun">,</span><span class="pln"> y</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> x</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">NMAX </span><span class="pun">+</span><span class="pln"> </span><span class="lit">5</span><span class="pun">],</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">NMAX </span><span class="pun">+</span><span class="pln"> </span><span class="lit">5</span><span class="pun">];</span><span class="com">///b -&gt; initial array, a -&gt; equivalent permutation</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> bit_lin</span><span class="pun">[</span><span class="pln">NMAX </span><span class="pun">+</span><span class="pln"> </span><span class="lit">5</span><span class="pun">][</span><span class="pln">NMAX </span><span class="pun">+</span><span class="pln"> </span><span class="lit">5</span><span class="pun">],</span><span class="pln"> bit_col</span><span class="pun">[</span><span class="pln">NMAX </span><span class="pun">+</span><span class="pln"> </span><span class="lit">5</span><span class="pun">][</span><span class="pln">NMAX </span><span class="pun">+</span><span class="pln"> </span><span class="lit">5</span><span class="pun">];</span><span class="com">///will use an offset of one because of [0..n] range</span><span class="pln">
 
</span><span class="kwd">void</span><span class="pln"> update_lin</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> lin</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> pos</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> val</span><span class="pun">)</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    pos</span><span class="pun">++;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> pos</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">+=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="pun">&amp;</span><span class="pln"> </span><span class="pun">-</span><span class="pln">i</span><span class="pun">))</span><span class="pln">
        addSelf</span><span class="pun">(</span><span class="pln">bit_lin</span><span class="pun">[</span><span class="pln">lin</span><span class="pun">][</span><span class="pln">i</span><span class="pun">],</span><span class="pln"> val</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">void</span><span class="pln"> update_col</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> col</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> pos</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> val</span><span class="pun">)</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    pos</span><span class="pun">++;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> pos</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">+=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="pun">&amp;</span><span class="pln"> </span><span class="pun">-</span><span class="pln">i</span><span class="pun">))</span><span class="pln">
        addSelf</span><span class="pun">(</span><span class="pln">bit_col</span><span class="pun">[</span><span class="pln">col</span><span class="pun">][</span><span class="pln">i</span><span class="pun">],</span><span class="pln"> val</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> query_lin</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> lin</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> pos</span><span class="pun">)</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    pos</span><span class="pun">++;</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> rr </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> pos</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">-=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="pun">&amp;</span><span class="pln"> </span><span class="pun">-</span><span class="pln">i</span><span class="pun">))</span><span class="pln">
        addSelf</span><span class="pun">(</span><span class="pln">rr</span><span class="pun">,</span><span class="pln"> bit_lin</span><span class="pun">[</span><span class="pln">lin</span><span class="pun">][</span><span class="pln">i</span><span class="pun">]);</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> rr</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> query_col</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> col</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> pos</span><span class="pun">)</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    pos</span><span class="pun">++;</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> rr </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> pos</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">-=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="pun">&amp;</span><span class="pln"> </span><span class="pun">-</span><span class="pln">i</span><span class="pun">))</span><span class="pln">
        addSelf</span><span class="pun">(</span><span class="pln">rr</span><span class="pun">,</span><span class="pln"> bit_col</span><span class="pun">[</span><span class="pln">col</span><span class="pun">][</span><span class="pln">i</span><span class="pun">]);</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> rr</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">void</span><span class="pln"> testcase</span><span class="pun">()</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
        cin </span><span class="pun">&gt;&gt;</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
        a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;</span><span class="pln"> i</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++)</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">b</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;=</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln">
                a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]++;</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++)</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">b</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln">
                a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]++;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;=</span><span class="pln"> n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++)</span><span class="pln">
            bit_lin</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> bit_col</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    update_lin</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
    update_col</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
        vector</span><span class="pun">&lt;</span><span class="pln">pair</span><span class="pun">&lt;</span><span class="kwd">int</span><span class="pun">,</span><span class="pln"> pair</span><span class="pun">&lt;</span><span class="kwd">int</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">&gt;&gt;&gt;</span><span class="pln"> buffs</span><span class="pun">;</span><span class="com">///where to update at the end</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> x </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> x </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++)</span><span class="pln">
        </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">int</span><span class="pln"> lin</span><span class="pun">,</span><span class="pln"> col</span><span class="pun">,</span><span class="pln"> buff</span><span class="pun">;</span><span class="pln">
            lin </span><span class="pun">=</span><span class="pln"> j</span><span class="pun">;</span><span class="pln">
            col </span><span class="pun">=</span><span class="pln"> x</span><span class="pun">;</span><span class="pln">
            buff </span><span class="pun">=</span><span class="pln"> query_lin</span><span class="pun">(</span><span class="pln">j</span><span class="pun">,</span><span class="pln"> x </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
            buffs</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">({</span><span class="pln">buff</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{</span><span class="pln">lin</span><span class="pun">,</span><span class="pln"> col</span><span class="pun">}});</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> q </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> q </span><span class="pun">&lt;</span><span class="pln"> x</span><span class="pun">;</span><span class="pln"> q</span><span class="pun">++)</span><span class="pln">
        </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">int</span><span class="pln"> lin</span><span class="pun">,</span><span class="pln"> col</span><span class="pun">,</span><span class="pln"> buff</span><span class="pun">;</span><span class="pln">
            lin </span><span class="pun">=</span><span class="pln"> x</span><span class="pun">;</span><span class="pln">
            col </span><span class="pun">=</span><span class="pln"> q</span><span class="pun">;</span><span class="pln">
            buff </span><span class="pun">=</span><span class="pln"> query_col</span><span class="pun">(</span><span class="pln">q</span><span class="pun">,</span><span class="pln"> x </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
            buffs</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">({</span><span class="pln">buff</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{</span><span class="pln">lin</span><span class="pun">,</span><span class="pln"> col</span><span class="pun">}});</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">auto</span><span class="pln"> it </span><span class="pun">:</span><span class="pln"> buffs</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">{</span><span class="pln">
            update_lin</span><span class="pun">(</span><span class="pln">it</span><span class="pun">.</span><span class="pln">second</span><span class="pun">.</span><span class="pln">first</span><span class="pun">,</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">second</span><span class="pun">.</span><span class="pln">second</span><span class="pun">,</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">first</span><span class="pun">);</span><span class="pln">
            update_col</span><span class="pun">(</span><span class="pln">it</span><span class="pun">.</span><span class="pln">second</span><span class="pun">.</span><span class="pln">second</span><span class="pun">,</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">second</span><span class="pun">.</span><span class="pln">first</span><span class="pun">,</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">first</span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> ans </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> lin </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> lin </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> lin</span><span class="pun">++)</span><span class="pln">
        addSelf</span><span class="pun">(</span><span class="pln">ans</span><span class="pun">,</span><span class="pln"> query_lin</span><span class="pun">(</span><span class="pln">lin</span><span class="pun">,</span><span class="pln"> n</span><span class="pun">));</span><span class="pln">
    cout </span><span class="pun">&lt;&lt;</span><span class="pln"> ans </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> tc</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> tc</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">tc</span><span class="pun">--)</span><span class="pln">
        testcase</span><span class="pun">();</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2143/problem/E" title="Codeforces Round 1051 (Div. 2)">2143E - Make Good</a></p><p>Author: <a class="rated-user user-orange" href="https://codeforces.com/profile/LucaLucaM" title="Master LucaLucaM">LucaLucaM</a>, Preparation: <a class="rated-user user-orange" href="https://codeforces.com/profile/LucaLucaM" title="Master LucaLucaM">LucaLucaM</a>, Editorial: <a class="rated-user user-orange" href="https://codeforces.com/profile/LucaLucaM" title="Master LucaLucaM">LucaLucaM</a></p> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2143/problem/E" title="Codeforces Round 1051 (Div. 2)">2143E - Make Good</a></h3><div class="ttypography"><div class="problem-statement"><div><p>The operations are pretty annoying to work with in this form. We can make the following transformation: Flip brackets on even positions. (we'll use <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1171"><span class="MJXp-mn" id="MJXp-Span-1172">1</span></span></span><script type="math/tex" id="MathJax-Element-185">1</script>-indexing, but note that this idea works just as well if we used <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1173"><span class="MJXp-mn" id="MJXp-Span-1174">0</span></span></span><script type="math/tex" id="MathJax-Element-186">0</script>-indexing)</p><p>Now the operations we can make are the following:</p><p><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-1175"><span class="MJXp-mrow" id="MJXp-Span-1176"><span class="MJXp-mtext MJXp-mono" id="MJXp-Span-1177">()</span></span><span class="MJXp-mo" id="MJXp-Span-1178" style="margin-left: 0.333em; margin-right: 0.333em;">→</span><span class="MJXp-mrow" id="MJXp-Span-1179"><span class="MJXp-mtext MJXp-mono" id="MJXp-Span-1180">)(</span></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-187">\texttt{()} \rightarrow \texttt{)(}</script></p><p><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-1181"><span class="MJXp-mrow" id="MJXp-Span-1182"><span class="MJXp-mtext MJXp-mono" id="MJXp-Span-1183">)(</span></span><span class="MJXp-mo" id="MJXp-Span-1184" style="margin-left: 0.333em; margin-right: 0.333em;">→</span><span class="MJXp-mrow" id="MJXp-Span-1185"><span class="MJXp-mtext MJXp-mono" id="MJXp-Span-1186">()</span></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-188">\texttt{)(} \rightarrow \texttt{()}</script></p><p>Basically, if two adjacent brackets are of different types, we can swap them. If they are of the same type, swapping does nothing so we may as well imagine that any two adjacent brackets can be swapped. </p><p>So we can swap any two adjacent brackets. This means that we can reach any other configuration with the same number of open brackets and the same number of closed brackets.</p><p>Note that if there are no open brackets, then clearly the first bracket can't be an open bracket which means that we can't reach a regular bracket string. (The first bracket should be open because it doesn't get flipped)</p><p>So for the answer to be <span class="tex-font-style-tt">YES</span> we must have at least one open bracket string.</p><p>By this point, we can find a construction which works in most cases. </p><p>For example: <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-1187"><span class="MJXp-mrow" id="MJXp-Span-1188"><span class="MJXp-mtext MJXp-mono" id="MJXp-Span-1189">())))))))(((((</span></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-189">\texttt{())))))))(((((}</script>, which before flipping would look like this: <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-1190"><span class="MJXp-mrow" id="MJXp-Span-1191"><span class="MJXp-mtext MJXp-mono" id="MJXp-Span-1192">(()()()())()()</span></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-190">\texttt{(()()()())()()}</script> which is a regular bracket string. Note that this works if and only if both the number of closed brackets and the number of open brackets are even.</p><p>But what if the number of closed brackets is odd? Well, then we can prove that there is no solution at all.</p><p>Let's take a step back and consider the original string (before doing the flip on even positions transformation). Note that in any regular bracket string, an open bracket on an even position is matched with a closed bracket on an odd position and vice versa. That is because the bracket string between them should be regular, thus it's length should be even. Let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1193"><span class="MJXp-msubsup" id="MJXp-Span-1194"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1195" style="margin-right: 0.05em;">o</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1196" style="vertical-align: -0.4em;">0</span></span><span class="MJXp-mo" id="MJXp-Span-1197" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1198"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1199" style="margin-right: 0.05em;">o</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1200" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-1201" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1202"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1203" style="margin-right: 0.05em;">c</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1204" style="vertical-align: -0.4em;">0</span></span><span class="MJXp-mo" id="MJXp-Span-1205" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1206"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1207" style="margin-right: 0.05em;">c</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1208" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-1209" style="margin-left: 0em; margin-right: 0.222em;">.</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1210">o</span><span class="MJXp-mo" id="MJXp-Span-1211" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1212">c</span></span></span><script type="math/tex" id="MathJax-Element-191">o_0, o_1, c_0, c_1. o, c</script> be the following:</p><ul><li> <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1213"><span class="MJXp-msubsup" id="MJXp-Span-1214"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1215" style="margin-right: 0.05em;">o</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1216" style="vertical-align: -0.4em;">0</span></span><span class="MJXp-mo" id="MJXp-Span-1217" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi" id="MJXp-Span-1218">#</span></span></span><script type="math/tex" id="MathJax-Element-192">o_0 = \#</script> open brackets on even positions before flipping</li><li> <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1219"><span class="MJXp-msubsup" id="MJXp-Span-1220"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1221" style="margin-right: 0.05em;">o</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1222" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-1223" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi" id="MJXp-Span-1224">#</span></span></span><script type="math/tex" id="MathJax-Element-193">o_1 = \#</script> open brackets on odd positions before flipping</li><li> <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1225"><span class="MJXp-msubsup" id="MJXp-Span-1226"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1227" style="margin-right: 0.05em;">c</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1228" style="vertical-align: -0.4em;">0</span></span><span class="MJXp-mo" id="MJXp-Span-1229" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi" id="MJXp-Span-1230">#</span></span></span><script type="math/tex" id="MathJax-Element-194">c_0 = \#</script> closed brackets on even positions before flipping</li><li> <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1231"><span class="MJXp-msubsup" id="MJXp-Span-1232"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1233" style="margin-right: 0.05em;">c</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1234" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-1235" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi" id="MJXp-Span-1236">#</span></span></span><script type="math/tex" id="MathJax-Element-195">c_1 = \#</script> closed brackets on odd positions before flipping</li><li> <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1237"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1238">o</span><span class="MJXp-mo" id="MJXp-Span-1239" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi" id="MJXp-Span-1240">#</span></span></span><script type="math/tex" id="MathJax-Element-196">o = \#</script> open brackets after flipping</li><li> <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1241"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1242">c</span><span class="MJXp-mo" id="MJXp-Span-1243" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi" id="MJXp-Span-1244">#</span></span></span><script type="math/tex" id="MathJax-Element-197">c = \#</script> closed brackets after flipping</li></ul><p>Then we have the following: <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1245"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1246">o</span><span class="MJXp-mo" id="MJXp-Span-1247" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-1248"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1249" style="margin-right: 0.05em;">o</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1250" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-1251" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-1252"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1253" style="margin-right: 0.05em;">c</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1254" style="vertical-align: -0.4em;">0</span></span></span></span><script type="math/tex" id="MathJax-Element-198">o = o_1 + c _0</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1255"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1256">c</span><span class="MJXp-mo" id="MJXp-Span-1257" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-1258"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1259" style="margin-right: 0.05em;">o</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1260" style="vertical-align: -0.4em;">0</span></span><span class="MJXp-mo" id="MJXp-Span-1261" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-1262"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1263" style="margin-right: 0.05em;">c</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1264" style="vertical-align: -0.4em;">1</span></span></span></span><script type="math/tex" id="MathJax-Element-199">c = o_0 + c_1</script>, but <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1265"><span class="MJXp-msubsup" id="MJXp-Span-1266"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1267" style="margin-right: 0.05em;">o</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1268" style="vertical-align: -0.4em;">0</span></span><span class="MJXp-mo" id="MJXp-Span-1269" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-1270"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1271" style="margin-right: 0.05em;">c</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1272" style="vertical-align: -0.4em;">1</span></span></span></span><script type="math/tex" id="MathJax-Element-200">o_0 = c_1</script> so <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1273"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1274">c</span><span class="MJXp-mo" id="MJXp-Span-1275" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-1276">2</span><span class="MJXp-mo" id="MJXp-Span-1277" style="margin-left: 0.267em; margin-right: 0.267em;">∗</span><span class="MJXp-msubsup" id="MJXp-Span-1278"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1279" style="margin-right: 0.05em;">o</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1280" style="vertical-align: -0.4em;">0</span></span></span></span><script type="math/tex" id="MathJax-Element-201">c = 2 * o_0</script> so <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1281"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1282">c</span></span></span><script type="math/tex" id="MathJax-Element-202">c</script> must be even. Also, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1283"><span class="MJXp-msubsup" id="MJXp-Span-1284"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1285" style="margin-right: 0.05em;">o</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1286" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-1287" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-1288"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1289" style="margin-right: 0.05em;">c</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1290" style="vertical-align: -0.4em;">0</span></span></span></span><script type="math/tex" id="MathJax-Element-203">o_1 = c_0</script> so <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1291"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1292">o</span><span class="MJXp-mo" id="MJXp-Span-1293" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-1294"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1295" style="margin-right: 0.05em;">o</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1296" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-1297" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-1298"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1299" style="margin-right: 0.05em;">c</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1300" style="vertical-align: -0.4em;">0</span></span><span class="MJXp-mo" id="MJXp-Span-1301" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-1302">2</span><span class="MJXp-mo" id="MJXp-Span-1303" style="margin-left: 0.267em; margin-right: 0.267em;">∗</span><span class="MJXp-msubsup" id="MJXp-Span-1304"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1305" style="margin-right: 0.05em;">o</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1306" style="vertical-align: -0.4em;">1</span></span></span></span><script type="math/tex" id="MathJax-Element-204">o = o_1 + c_0 = 2 * o_1</script> so <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1307"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1308">o</span></span></span><script type="math/tex" id="MathJax-Element-205">o</script> must be even aswell. Thus, both the number of open and close brackets should both be even for the answer to be <span class="tex-font-style-tt">YES</span>.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Code</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pln"> </span><span class="str">&lt;iostream&gt;</span><span class="pln">
</span><span class="com">#include</span><span class="pln"> </span><span class="str">&lt;cassert&gt;</span><span class="pln">
</span><span class="com">#include</span><span class="pln"> </span><span class="str">&lt;vector&gt;</span><span class="pln">
</span><span class="com">#include</span><span class="pln"> </span><span class="str">&lt;algorithm&gt;</span><span class="pln">
 
</span><span class="com">#define</span><span class="pln"> debug</span><span class="pun">(</span><span class="pln">x</span><span class="pun">)</span><span class="pln"> </span><span class="com">#x &lt;&lt; " = " &lt;&lt; x &lt;&lt; '\n'</span><span class="pln">
 
</span><span class="kwd">using</span><span class="pln"> ll </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pun">;</span><span class="pln">
</span><span class="com">#define</span><span class="pln"> YES std</span><span class="pun">::</span><span class="pln">cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"YES\n"</span><span class="pln">
</span><span class="com">#define</span><span class="pln"> NO std</span><span class="pun">::</span><span class="pln">cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"NO\n"</span><span class="pln">
 
</span><span class="kwd">void</span><span class="pln"> solve</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
  std</span><span class="pun">::</span><span class="pln">cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
 
  std</span><span class="pun">::</span><span class="kwd">string</span><span class="pln"> s</span><span class="pun">;</span><span class="pln">
  std</span><span class="pun">::</span><span class="pln">cin </span><span class="pun">&gt;&gt;</span><span class="pln"> s</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">s  </span><span class="pun">==</span><span class="pln"> </span><span class="str">"))))))))"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    std</span><span class="pun">::</span><span class="pln">cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"(()(()))"</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">return</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
  </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">n </span><span class="pun">%</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    std</span><span class="pun">::</span><span class="pln">cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">return</span><span class="pun">;</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
  
  </span><span class="kwd">int</span><span class="pln"> delta </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
 
  </span><span class="kwd">assert</span><span class="pun">((</span><span class="kwd">int</span><span class="pun">)</span><span class="pln"> s</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> n</span><span class="pun">);</span><span class="pln">
 
  </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pun">)</span><span class="pln"> s</span><span class="pun">.</span><span class="pln">size</span><span class="pun">();</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> </span><span class="kwd">value</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">s</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'('</span><span class="pun">?</span><span class="pln"> </span><span class="pun">+</span><span class="lit">1</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      </span><span class="kwd">value</span><span class="pln"> </span><span class="pun">*=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    delta </span><span class="pun">+=</span><span class="pln"> </span><span class="kwd">value</span><span class="pun">;</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
 
  </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">delta </span><span class="pun">==</span><span class="pln"> </span><span class="pun">-</span><span class="pln">n </span><span class="pun">||</span><span class="pln"> std</span><span class="pun">::</span><span class="pln">abs</span><span class="pun">(</span><span class="pln">delta</span><span class="pun">)</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> </span><span class="lit">4</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> n </span><span class="pun">%</span><span class="pln"> </span><span class="lit">4</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    std</span><span class="pun">::</span><span class="pln">cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">return</span><span class="pun">;</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
 
  </span><span class="kwd">int</span><span class="pln"> plus </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> delta</span><span class="pun">)</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">int</span><span class="pln"> minus </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">n </span><span class="pun">-</span><span class="pln"> delta</span><span class="pun">)</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln">
 
  </span><span class="kwd">assert</span><span class="pun">(</span><span class="pln">minus </span><span class="pun">%</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span><span class="pln">
 
  std</span><span class="pun">::</span><span class="pln">cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"("</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> minus </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    std</span><span class="pun">::</span><span class="pln">cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"()"</span><span class="pun">;</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
  std</span><span class="pun">::</span><span class="pln">cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">")"</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> </span><span class="pun">(</span><span class="pln">plus </span><span class="pun">-</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    std</span><span class="pun">::</span><span class="pln">cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"()"</span><span class="pun">;</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  std</span><span class="pun">::</span><span class="pln">ios_base</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="kwd">false</span><span class="pun">);</span><span class="pln">
  std</span><span class="pun">::</span><span class="pln">cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
 
  </span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
  std</span><span class="pun">::</span><span class="pln">cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> tc </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> tc </span><span class="pun">&lt;=</span><span class="pln"> t</span><span class="pun">;</span><span class="pln"> tc</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    std</span><span class="pun">::</span><span class="pln">cerr </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"Case #"</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> tc </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">":\n"</span><span class="pun">;</span><span class="pln">
    solve</span><span class="pun">();</span><span class="pln">
    std</span><span class="pun">::</span><span class="pln">cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
 
  </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2143/problem/F" title="Codeforces Round 1051 (Div. 2)">2143F - Increasing Xor</a></p><p>Author: <a class="rated-user user-orange" href="https://codeforces.com/profile/LucaLucaM" title="Master LucaLucaM">LucaLucaM</a>, Preparation: <a class="rated-user user-orange" href="https://codeforces.com/profile/LucaLucaM" title="Master LucaLucaM">LucaLucaM</a>, Editorial: <a class="rated-user user-orange" href="https://codeforces.com/profile/MateiKing80" title="Master MateiKing80">MateiKing80</a></p> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2143/problem/F" title="Codeforces Round 1051 (Div. 2)">2143F - Increasing Xor</a></h3><div class="ttypography"><div class="problem-statement"><div><p>First, let us think carefully about what values each element <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1309"><span class="MJXp-msubsup" id="MJXp-Span-1310"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1311" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1312" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-206">a_i</script> can achieve under the allowed operations. Since any <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1313"><span class="MJXp-msubsup" id="MJXp-Span-1314"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1315" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1316" style="vertical-align: -0.4em;">j</span></span></span></span><script type="math/tex" id="MathJax-Element-207">a_j</script> can be XORed with any previous element in the chosen range, the set of all reachable values of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1317"><span class="MJXp-msubsup" id="MJXp-Span-1318"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1319" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1320" style="vertical-align: -0.4em;">j</span></span></span></span><script type="math/tex" id="MathJax-Element-208">a_j</script> is exactly the set of all XOR combinations of the elements in the range <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1321"><span class="MJXp-msubsup" id="MJXp-Span-1322"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1323" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1324" style="vertical-align: -0.4em;">l</span></span><span class="MJXp-mo" id="MJXp-Span-1325" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-1326" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-1327" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1328"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1329" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1330" style="vertical-align: -0.4em;">j</span></span></span></span><script type="math/tex" id="MathJax-Element-209">a_l,\dots,a_j</script>. This naturally leads us to consider a XOR basis. We want to see for each <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1331"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1332">l</span></span></span><script type="math/tex" id="MathJax-Element-210">l</script> the places where the xor basis of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1333"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1334">l</span><span class="MJXp-mo" id="MJXp-Span-1335" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1336">r</span></span></span><script type="math/tex" id="MathJax-Element-211">l \dots r</script> changes. We can preprocess for each starting index <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1337"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1338">l</span></span></span><script type="math/tex" id="MathJax-Element-212">l</script> the XOR basis of the suffix beginning at <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1339"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1340">l</span></span></span><script type="math/tex" id="MathJax-Element-213">l</script>. This can be done efficiently by iterating <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1341"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1342">l</span></span></span><script type="math/tex" id="MathJax-Element-214">l</script> from <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1343"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1344">n</span></span></span><script type="math/tex" id="MathJax-Element-215">n</script> down to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1345"><span class="MJXp-mn" id="MJXp-Span-1346">1</span></span></span><script type="math/tex" id="MathJax-Element-216">1</script>, trying to insert the new element <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1347"><span class="MJXp-msubsup" id="MJXp-Span-1348"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1349" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1350" style="vertical-align: -0.4em;">l</span></span></span></span><script type="math/tex" id="MathJax-Element-217">a_l</script> into the current basis. If it cannot expand the basis, we just create a new basis including it and all subsequent elements in increasing order of their indices, thus creating a new, updated basis. This new basis will have the same amount of elements as the one before, but with <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1351"><span class="MJXp-msubsup" id="MJXp-Span-1352"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1353" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1354" style="vertical-align: -0.4em;">l</span></span></span></span><script type="math/tex" id="MathJax-Element-218">a_l</script> and without one of the previous elements.</p><p>Once we have the XOR basis for a suffix, we want to determine the largest <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1355"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1356">r</span></span></span><script type="math/tex" id="MathJax-Element-219">r</script> such that the subsequence <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1357"><span class="MJXp-msubsup" id="MJXp-Span-1358"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1359" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1360" style="vertical-align: -0.4em;">l</span></span><span class="MJXp-mo" id="MJXp-Span-1361" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1362"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1363" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1364" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1365">l</span><span class="MJXp-mo" id="MJXp-Span-1366">+</span><span class="MJXp-mn" id="MJXp-Span-1367">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-1368" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-1369" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-1370" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1371"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1372" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1373" style="vertical-align: -0.4em;">r</span></span></span></span><script type="math/tex" id="MathJax-Element-220">a_l, a_{l+1}, \dots, a_r</script> can be made strictly increasing. To do this, we define two functions on the basis: one that counts how many numbers smaller than a given value can be formed, and one that finds the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1374"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1375">k</span></span></span><script type="math/tex" id="MathJax-Element-221">k</script>-th smallest number that can be written. Using these, we simulate building the strictly increasing sequence by picking chunks of elements in ascending order of the indices of the elements in the basis. For each element of the basis, we check whether there are enough numbers larger than the last chosen value to continue the increasing sequence. This allows us to determine the farthest index <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1376"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1377">r</span></span></span><script type="math/tex" id="MathJax-Element-222">r</script> reachable from each <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1378"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1379">l</span></span></span><script type="math/tex" id="MathJax-Element-223">l</script>.</p><p>After this preprocessing, answering each query <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1380"><span class="MJXp-mo" id="MJXp-Span-1381" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1382">l</span><span class="MJXp-mo" id="MJXp-Span-1383" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1384">r</span><span class="MJXp-mo" id="MJXp-Span-1385" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-224">(l,r)</script> reduces to a simple comparison: if <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1386"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1387">r</span></span></span><script type="math/tex" id="MathJax-Element-225">r</script> is less than or equal to the maximal reachable index from <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1388"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1389">l</span></span></span><script type="math/tex" id="MathJax-Element-226">l</script>, the answer is YES; otherwise, it is NO. The preprocessing takes <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1390"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1391">O</span><span class="MJXp-mo" id="MJXp-Span-1392" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1393">n</span><span class="MJXp-msubsup" id="MJXp-Span-1394"><span class="MJXp-mi" id="MJXp-Span-1395" style="margin-right: 0.05em;">log</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1396" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1397" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-msubsup" id="MJXp-Span-1398"><span class="MJXp-mtext" id="MJXp-Span-1399" style="margin-right: 0.05em;">MAX</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1400" style="vertical-align: -0.4em;">A</span></span><span class="MJXp-mo" id="MJXp-Span-1401" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-227">O(n \log^2 \text{MAX}_A)</script> time, and each query can be answered in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1402"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1403">O</span><span class="MJXp-mo" id="MJXp-Span-1404" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-1405">1</span><span class="MJXp-mo" id="MJXp-Span-1406" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-228">O(1)</script>.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Code</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pln"> </span><span class="str">&lt;iostream&gt;</span><span class="pln">
</span><span class="com">#include</span><span class="pln"> </span><span class="str">&lt;cassert&gt;</span><span class="pln">
</span><span class="com">#include</span><span class="pln"> </span><span class="str">&lt;vector&gt;</span><span class="pln">
</span><span class="com">#include</span><span class="pln"> </span><span class="str">&lt;algorithm&gt;</span><span class="pln">
 
</span><span class="com">#define</span><span class="pln"> debug</span><span class="pun">(</span><span class="pln">x</span><span class="pun">)</span><span class="pln"> </span><span class="com">#x &lt;&lt; " = " &lt;&lt; x &lt;&lt; '\n'</span><span class="pln">
 
</span><span class="kwd">using</span><span class="pln"> ll </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pun">;</span><span class="pln">
</span><span class="com">#define</span><span class="pln"> YES std</span><span class="pun">::</span><span class="pln">cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"YES\n"</span><span class="pln">
</span><span class="com">#define</span><span class="pln"> NO std</span><span class="pun">::</span><span class="pln">cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"NO\n"</span><span class="pln">
 
</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> B </span><span class="pun">=</span><span class="pln"> </span><span class="lit">21</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">struct</span><span class="pln"> </span><span class="typ">XorBasis</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  std</span><span class="pun">::</span><span class="pln">vector</span><span class="str">&lt;int&gt;</span><span class="pln"> basis</span><span class="pun">;</span><span class="pln">
  std</span><span class="pun">::</span><span class="pln">vector</span><span class="str">&lt;int&gt;</span><span class="pln"> who</span><span class="pun">;</span><span class="pln">
  
  </span><span class="kwd">int</span><span class="pln"> sz</span><span class="pun">;</span><span class="pln">
 
  </span><span class="kwd">void</span><span class="pln"> reset</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    basis</span><span class="pun">.</span><span class="pln">assign</span><span class="pun">(</span><span class="pln">B</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    who</span><span class="pun">.</span><span class="pln">clear</span><span class="pun">();</span><span class="pln">
    sz </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
 
  </span><span class="kwd">bool</span><span class="pln"> </span><span class="kwd">add</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> index</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> B </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x </span><span class="pun">&gt;&gt;</span><span class="pln"> i </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">basis</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
          basis</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> x</span><span class="pun">;</span><span class="pln">
          who</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">index</span><span class="pun">);</span><span class="pln">
          sz</span><span class="pun">++;</span><span class="pln">
          </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        x </span><span class="pun">^=</span><span class="pln"> basis</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
      </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
 
  </span><span class="kwd">int</span><span class="pln"> kth</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> k</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="com">// al k-lea cel mai mic subset xor </span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">k </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> k </span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">(</span><span class="lit">1</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> sz</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> x </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> cnt </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="lit">1</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> sz</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> B </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">basis</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">k </span><span class="pun">&gt;</span><span class="pln"> cnt </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
          </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!(</span><span class="pln">x </span><span class="pun">&gt;&gt;</span><span class="pln"> i </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            x </span><span class="pun">^=</span><span class="pln"> basis</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
          </span><span class="pun">}</span><span class="pln">
          </span><span class="com">// il fac sa fie 1</span><span class="pln">
          k </span><span class="pun">-=</span><span class="pln"> cnt </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
          </span><span class="com">// il fac sa fie 0</span><span class="pln">
          </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x </span><span class="pun">&gt;&gt;</span><span class="pln"> i </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            x </span><span class="pun">^=</span><span class="pln"> basis</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
          </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        cnt </span><span class="pun">/=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln">
      </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> x</span><span class="pun">;</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
 
  </span><span class="kwd">int</span><span class="pln"> count_le</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="com">// cate subset uri au xor &lt; x?</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> ret </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> cnt </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="lit">1</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> sz</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> mask </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> B </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">basis</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x </span><span class="pun">&gt;&gt;</span><span class="pln"> i </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
          ret </span><span class="pun">+=</span><span class="pln"> cnt </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln">
          </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!(</span><span class="pln">mask </span><span class="pun">&gt;&gt;</span><span class="pln"> i </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            mask </span><span class="pun">^=</span><span class="pln"> basis</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
          </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
          </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">mask </span><span class="pun">&gt;&gt;</span><span class="pln"> i </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            mask </span><span class="pun">^=</span><span class="pln"> basis</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
          </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        cnt </span><span class="pun">/=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln">
      </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">((</span><span class="pln">x </span><span class="pun">^</span><span class="pln"> mask</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&gt;&gt;</span><span class="pln"> i </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
          </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x </span><span class="pun">&gt;&gt;</span><span class="pln"> i </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> ret </span><span class="pun">+</span><span class="pln"> cnt</span><span class="pun">;</span><span class="pln">
          </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> ret</span><span class="pun">;</span><span class="pln"> 
          </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
      </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> ret</span><span class="pun">;</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
  </span><span class="kwd">int</span><span class="pln"> count_leq</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="com">// &lt;= x</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> count_le</span><span class="pun">(</span><span class="pln">x </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
  </span><span class="kwd">int</span><span class="pln"> jumpK</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> </span><span class="kwd">value</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> k</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> count_leq</span><span class="pun">(</span><span class="kwd">value</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> kth</span><span class="pun">(</span><span class="pln">p </span><span class="pun">+</span><span class="pln"> k</span><span class="pun">);</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">};</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="com">#ifdef</span><span class="pln"> LOCAL
freopen</span><span class="pun">(</span><span class="str">"input.txt"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"r"</span><span class="pun">,</span><span class="pln"> stdin</span><span class="pun">);</span><span class="pln">
  </span><span class="com">#endif</span><span class="pln">
  std</span><span class="pun">::</span><span class="pln">ios_base</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="kwd">false</span><span class="pun">);</span><span class="pln">
  std</span><span class="pun">::</span><span class="pln">cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
  std</span><span class="pun">::</span><span class="pln">cout</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> tc</span><span class="pun">;</span><span class="pln">
std</span><span class="pun">::</span><span class="pln">cin </span><span class="pun">&gt;&gt;</span><span class="pln"> tc</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">tc</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> q</span><span class="pun">;</span><span class="pln">
  std</span><span class="pun">::</span><span class="pln">cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n </span><span class="pun">&gt;&gt;</span><span class="pln"> q</span><span class="pun">;</span><span class="pln">
  std</span><span class="pun">::</span><span class="pln">vector</span><span class="str">&lt;int&gt;</span><span class="pln"> a</span><span class="pun">(</span><span class="pln">n</span><span class="pun">);</span><span class="pln">
  </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">x </span><span class="pun">:</span><span class="pln"> a</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    std</span><span class="pun">::</span><span class="pln">cin </span><span class="pun">&gt;&gt;</span><span class="pln"> x</span><span class="pun">;</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
  
  </span><span class="typ">XorBasis</span><span class="pln"> B</span><span class="pun">;</span><span class="pln">
  B</span><span class="pun">.</span><span class="pln">reset</span><span class="pun">();</span><span class="pln">
 
  std</span><span class="pun">::</span><span class="pln">vector</span><span class="str">&lt;int&gt;</span><span class="pln"> maxR</span><span class="pun">(</span><span class="pln">n</span><span class="pun">);</span><span class="pln">
 
  </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> l </span><span class="pun">=</span><span class="pln"> n </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> l </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> l</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">B</span><span class="pun">.</span><span class="kwd">add</span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">l</span><span class="pun">],</span><span class="pln"> l</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      std</span><span class="pun">::</span><span class="pln">vector</span><span class="str">&lt;int&gt;</span><span class="pln"> ids </span><span class="pun">=</span><span class="pln"> B</span><span class="pun">.</span><span class="pln">who</span><span class="pun">;</span><span class="pln">
      ids</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">l</span><span class="pun">);</span><span class="pln">
      std</span><span class="pun">::</span><span class="pln">sort</span><span class="pun">(</span><span class="pln">ids</span><span class="pun">.</span><span class="kwd">begin</span><span class="pun">(),</span><span class="pln"> ids</span><span class="pun">.</span><span class="kwd">end</span><span class="pun">());</span><span class="pln">
      B</span><span class="pun">.</span><span class="pln">reset</span><span class="pun">();</span><span class="pln">
      </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> index </span><span class="pun">:</span><span class="pln"> ids</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        B</span><span class="pun">.</span><span class="kwd">add</span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">index</span><span class="pun">],</span><span class="pln"> index</span><span class="pun">);</span><span class="pln">
      </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln"> 
 
    std</span><span class="pun">::</span><span class="pln">sort</span><span class="pun">(</span><span class="pln">B</span><span class="pun">.</span><span class="pln">who</span><span class="pun">.</span><span class="kwd">begin</span><span class="pun">(),</span><span class="pln"> B</span><span class="pun">.</span><span class="pln">who</span><span class="pun">.</span><span class="kwd">end</span><span class="pun">());</span><span class="pln">
 
    </span><span class="typ">XorBasis</span><span class="pln"> aux</span><span class="pun">;</span><span class="pln">
    aux</span><span class="pun">.</span><span class="pln">reset</span><span class="pun">();</span><span class="pln">
    std</span><span class="pun">::</span><span class="pln">swap</span><span class="pun">(</span><span class="pln">B</span><span class="pun">,</span><span class="pln"> aux</span><span class="pun">);</span><span class="pln">
 
    </span><span class="kwd">int</span><span class="pln"> r </span><span class="pun">=</span><span class="pln"> n </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
 
    </span><span class="kwd">int</span><span class="pln"> maxExtend </span><span class="pun">=</span><span class="pln"> l</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> prevIndex </span><span class="pun">=</span><span class="pln"> l </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> prevValue </span><span class="pun">=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">;</span><span class="pln">
    
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> index </span><span class="pun">:</span><span class="pln"> aux</span><span class="pun">.</span><span class="pln">who</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">index </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> maxExtend</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        r </span><span class="pun">=</span><span class="pln"> std</span><span class="pun">::</span><span class="pln">min</span><span class="pun">(</span><span class="pln">r</span><span class="pun">,</span><span class="pln"> maxExtend</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
      </span><span class="pun">}</span><span class="pln">
      </span><span class="kwd">int</span><span class="pln"> before </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">prevValue </span><span class="pun">==</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">?</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> B</span><span class="pun">.</span><span class="pln">jumpK</span><span class="pun">(</span><span class="pln">prevValue</span><span class="pun">,</span><span class="pln"> index </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> prevIndex</span><span class="pun">));</span><span class="pln">
      B</span><span class="pun">.</span><span class="kwd">add</span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">index</span><span class="pun">],</span><span class="pln"> index</span><span class="pun">);</span><span class="pln">
      </span><span class="kwd">int</span><span class="pln"> me </span><span class="pun">=</span><span class="pln"> B</span><span class="pun">.</span><span class="pln">jumpK</span><span class="pun">(</span><span class="pln">before</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">me </span><span class="pun">==</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        r </span><span class="pun">=</span><span class="pln"> std</span><span class="pun">::</span><span class="pln">min</span><span class="pun">(</span><span class="pln">r</span><span class="pun">,</span><span class="pln"> index </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
      </span><span class="pun">}</span><span class="pln">
      maxExtend </span><span class="pun">=</span><span class="pln"> index </span><span class="pun">+</span><span class="pln"> </span><span class="pun">(</span><span class="lit">1</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> B</span><span class="pun">.</span><span class="pln">sz</span><span class="pun">)</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> B</span><span class="pun">.</span><span class="pln">count_leq</span><span class="pun">(</span><span class="pln">me</span><span class="pun">);</span><span class="pln"> 
      prevValue </span><span class="pun">=</span><span class="pln"> me</span><span class="pun">;</span><span class="pln">
      prevIndex </span><span class="pun">=</span><span class="pln"> index</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    r </span><span class="pun">=</span><span class="pln"> std</span><span class="pun">::</span><span class="pln">min</span><span class="pun">(</span><span class="pln">r</span><span class="pun">,</span><span class="pln"> maxExtend</span><span class="pun">);</span><span class="pln">
 
    std</span><span class="pun">::</span><span class="pln">swap</span><span class="pun">(</span><span class="pln">aux</span><span class="pun">,</span><span class="pln"> B</span><span class="pun">);</span><span class="pln">
    maxR</span><span class="pun">[</span><span class="pln">l</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> r</span><span class="pun">;</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
 
  </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">q</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> l</span><span class="pun">,</span><span class="pln"> r</span><span class="pun">;</span><span class="pln">
    std</span><span class="pun">::</span><span class="pln">cin </span><span class="pun">&gt;&gt;</span><span class="pln"> l </span><span class="pun">&gt;&gt;</span><span class="pln"> r</span><span class="pun">;</span><span class="pln">
    l</span><span class="pun">--,</span><span class="pln"> r</span><span class="pun">--;</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">r </span><span class="pun">&lt;=</span><span class="pln"> maxR</span><span class="pun">[</span><span class="pln">l</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      YES</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      NO</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
  </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span></code></pre></div></div></div>

    </div>


        <div style="font-size: 1.1rem;line-height: 1.1rem;padding-bottom: 0.5em;">
            <img src="https://codeforces.com//codeforces.com/codeforces.org/s/52448/images/icons/paperclip-16x16.png" style="vertical-align: middle;"> <span style="padding: 0 0.35em;">Tutorial of <a href="https://codeforces.com/contest/2143" class="notice" style="text-decoration: none;">Codeforces Round 1051 (Div. 2)</a> </span>
        </div>
        
            

  <script>
    // Make all spoilers toggleable
    document.querySelectorAll('.spoiler-title').forEach(title => {
      title.addEventListener('click', function() {
        const spoiler = this.closest('.spoiler');
        spoiler.classList.toggle('open');
      });
    });
    
    // Open all spoilers by default for easier reading
    document.querySelectorAll('.spoiler').forEach(spoiler => {
      spoiler.classList.add('open');
    });
  </script>
</body>
</html>