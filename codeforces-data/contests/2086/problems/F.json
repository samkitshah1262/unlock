{
  "contestId": 2086,
  "index": "F",
  "title": "Online Palindrome",
  "timeLimit": "1 second",
  "memoryLimit": "512 megabytes",
  "rating": 3000,
  "tags": [
    "brute force",
    "constructive algorithms",
    "interactive"
  ],
  "statementHtml": "",
  "inputSpecHtml": "",
  "outputSpecHtml": "",
  "noteHtml": "",
  "samples": [
    {
      "input": "a\n\na\n\nb\n\n0",
      "output": "0 0\n\n1 2\n\n2 3"
    },
    {
      "input": "a\n\na\n\nb\n\na\n\nb\n\n0",
      "output": "0 0\n\n2 1\n\n3 2\n\n4 4\n\n4 5"
    }
  ],
  "images": [],
  "url": "https://codeforces.com/contest/2086/problem/F",
  "tutorialHtml": "<div><div class=\"ttypography\"><div class=\"problem-statement\"><div><p>From the problem statement, it can be understood that at each step, when we have an odd number of characters, the string $$$t$$$ must be a palindrome, since the length of the string $$$s$$$ is not provided. Therefore, we need to come up with a strategy for swaps to ensure this condition is met.</p><p>The first thought is to try a brute-force approach of the following kind:</p><p>When the current step is odd (i.e., $$$|t| \\bmod 2 = 1$$$), let's obtain the next character $$$s_{i}$$$, add it to the end of $$$t$$$, and perform some swap. After this, two conditions must be satisfied:</p><ul> <li> if we then add the character \"<span class=\"tex-font-style-tt\">a</span>\", the string $$$t$$$ can be turned into a palindrome with no more than one swap; </li><li> if we then add the character \"<span class=\"tex-font-style-tt\">b</span>\", the string $$$t$$$ can be turned into a palindrome with no more than one swap. </li></ul><p>If the step is even, let's obtain the next character $$$s_{i}$$$, add it to the end of $$$t$$$, and perform a swap so that $$$t$$$ becomes a palindrome.</p><p>If we try to submit this solution, we will get <span class=\"tex-font-style-tt\">WA</span>, as there can be situations where both conditions for the odd step are not satisfied simultaneously. This is due to the fact that we allow the construction of any palindromes.</p><p>Based on this, we conclude that any palindrome is not suitable for us, and we need to maintain some template palindrome. The most challenging part of this problem is to find such a template.</p><p>Next, I will describe how the template should look:</p><ul> <li> if there is more than one letter \"<span class=\"tex-font-style-tt\">a</span>\", then we place the letter \"<span class=\"tex-font-style-tt\">a</span>\" as the first and last character; </li><li> if there is more than one letter \"<span class=\"tex-font-style-tt\">b</span>\", then we place the letter \"<span class=\"tex-font-style-tt\">b</span>\" as the second and second-to-last character; </li><li> if there is more than one letter \"<span class=\"tex-font-style-tt\">a</span>\", then we place the letter \"<span class=\"tex-font-style-tt\">a</span>\" as the third and third-to-last character; </li><li> we alternate this way while possible; </li><li> then we fill all paired positions with the letter that has more than one left; </li><li> the center is filled unambiguously. </li></ul><p>All palindromes that start with the letter \"<span class=\"tex-font-style-tt\">b</span>\" and have the same form are also suitable for us. For example, the following strings fit the template:</p><ul> <li> \"<span class=\"tex-font-style-tt\">a</span>\"; </li><li> \"<span class=\"tex-font-style-tt\">bab</span>\"; </li><li> \"<span class=\"tex-font-style-tt\">abbabba</span>\"; </li><li> \"<span class=\"tex-font-style-tt\">abababaaaaabababa</span>\"; </li></ul><p>For this template, there are transitions (i.e., swaps such that from a template of length $$$x$$$ we can transition to a template of length $$$x + 2$$$ by adding any possible pair of characters), however, deriving them manually is quite complicated, as there are many situations.</p><p>However, this can be added to our brute-force approach for the odd step. Once again, here's how it will look:</p><ul> <li> obtain the next character from the input; </li><li> iterate through a pair of characters in the string that we want to swap; </li><li> for each iterated pair, consider two variants of the second incoming character. Check if we can obtain the expected template from the current string with no more than one swap; this can be checked unambiguously with a linear pass through the string and the expected template, looking at the differing positions; </li><li> if for the checked permutation we can transition to the template with any next letter, then we perform that permutation. </li></ul><p>For the even step, we can simply find the necessary swap in a linear manner.</p><p>Thus, the asymptotic complexity of this solution is $$$O(|s|^{4})$$$.</p><p>As an appendix, I will list examples of transitions by pairs of characters in the template:</p><ul> <li> \"<span class=\"tex-font-style-tt\">aaa</span>\" + \"<span class=\"tex-font-style-tt\">aa</span>\" $$$\\to$$$ \"<span class=\"tex-font-style-tt\">aaaaa</span>\"; </li><li> \"<span class=\"tex-font-style-tt\">aaa</span>\" + \"<span class=\"tex-font-style-tt\">ab</span>\" $$$\\to$$$ \"<span class=\"tex-font-style-tt\">aabaa</span>\"; </li><li> \"<span class=\"tex-font-style-tt\">aaa</span>\" + \"<span class=\"tex-font-style-tt\">bb</span>\" $$$\\to$$$ \"<span class=\"tex-font-style-tt\">ababa</span>\"; </li></ul><ul> <li> \"<span class=\"tex-font-style-tt\">bab</span>\" + \"<span class=\"tex-font-style-tt\">aa</span>\" $$$\\to$$$ \"<span class=\"tex-font-style-tt\">ababa</span>\"; </li><li> \"<span class=\"tex-font-style-tt\">bab</span>\" + \"<span class=\"tex-font-style-tt\">ab</span>\" $$$\\to$$$ \"<span class=\"tex-font-style-tt\">abbba</span>\"; </li><li> \"<span class=\"tex-font-style-tt\">bab</span>\" + \"<span class=\"tex-font-style-tt\">bb</span>\" $$$\\to$$$ \"<span class=\"tex-font-style-tt\">bbabb</span>\"; </li></ul><ul> <li> \"<span class=\"tex-font-style-tt\">ababa</span>\" + \"<span class=\"tex-font-style-tt\">aa</span>\" $$$\\to$$$ \"<span class=\"tex-font-style-tt\">abaaaba</span>\"; </li><li> \"<span class=\"tex-font-style-tt\">ababa</span>\" + \"<span class=\"tex-font-style-tt\">ab</span>\" $$$\\to$$$ \"<span class=\"tex-font-style-tt\">abababa</span>\"; </li><li> \"<span class=\"tex-font-style-tt\">ababa</span>\" + \"<span class=\"tex-font-style-tt\">bb</span>\" $$$\\to$$$ \"<span class=\"tex-font-style-tt\">abbabba</span>\"; </li></ul><ul> <li> \"<span class=\"tex-font-style-tt\">abbba</span>\" + \"<span class=\"tex-font-style-tt\">aa</span>\" $$$\\to$$$ \"<span class=\"tex-font-style-tt\">abababa</span>\"; </li><li> \"<span class=\"tex-font-style-tt\">abbba</span>\" + \"<span class=\"tex-font-style-tt\">ab</span>\" $$$\\to$$$ \"<span class=\"tex-font-style-tt\">abbabba</span>\"; </li><li> \"<span class=\"tex-font-style-tt\">abbba</span>\" + \"<span class=\"tex-font-style-tt\">bb</span>\" $$$\\to$$$ \"<span class=\"tex-font-style-tt\">abbbbba</span>\"; </li></ul><ul> <li> \"<span class=\"tex-font-style-tt\">bbabb</span>\" + \"<span class=\"tex-font-style-tt\">aa</span>\" $$$\\to$$$ \"<span class=\"tex-font-style-tt\">abbabba</span>\"; </li><li> \"<span class=\"tex-font-style-tt\">bbabb</span>\" + \"<span class=\"tex-font-style-tt\">ab</span>\" $$$\\to$$$ \"<span class=\"tex-font-style-tt\">abbbbba</span>\"; </li><li> \"<span class=\"tex-font-style-tt\">bbabb</span>\" + \"<span class=\"tex-font-style-tt\">bb</span>\" $$$\\to$$$ \"<span class=\"tex-font-style-tt\">bbbabbb</span>\"; </li></ul><ul> <li> \"<span class=\"tex-font-style-tt\">ababbbbbbbaba</span>\" + \"<span class=\"tex-font-style-tt\">aa</span>\" $$$\\to$$$ \"<span class=\"tex-font-style-tt\">abababbbbbababa</span>\"; </li><li> \"<span class=\"tex-font-style-tt\">ababbbbbbbaba</span>\" + \"<span class=\"tex-font-style-tt\">ab</span>\" $$$\\to$$$ \"<span class=\"tex-font-style-tt\">ababbbbabbbbaba</span>\"; </li><li> \"<span class=\"tex-font-style-tt\">ababbbbbbbaba</span>\" + \"<span class=\"tex-font-style-tt\">bb</span>\" $$$\\to$$$ \"<span class=\"tex-font-style-tt\">ababbbbbbbbbaba</span>\"; </li></ul><ul> <li> \"<span class=\"tex-font-style-tt\">ababbbabbbaba</span>\" + \"<span class=\"tex-font-style-tt\">aa</span>\" $$$\\to$$$ \"<span class=\"tex-font-style-tt\">abababbabbababa</span>\"; </li><li> \"<span class=\"tex-font-style-tt\">ababbbabbbaba</span>\" + \"<span class=\"tex-font-style-tt\">ab</span>\" $$$\\to$$$ \"<span class=\"tex-font-style-tt\">abababbbbbababa</span>\"; </li><li> \"<span class=\"tex-font-style-tt\">ababbbabbbaba</span>\" + \"<span class=\"tex-font-style-tt\">bb</span>\" $$$\\to$$$ \"<span class=\"tex-font-style-tt\">ababbbbabbbbaba</span>\"; </li></ul><ul> <li> \"<span class=\"tex-font-style-tt\">ababaaaaababa</span>\" + \"<span class=\"tex-font-style-tt\">aa</span>\" $$$\\to$$$ \"<span class=\"tex-font-style-tt\">ababaaaaaaababa</span>\"; </li><li> \"<span class=\"tex-font-style-tt\">ababaaaaababa</span>\" + \"<span class=\"tex-font-style-tt\">ab</span>\" $$$\\to$$$ \"<span class=\"tex-font-style-tt\">ababaaabaaababa</span>\"; </li><li> \"<span class=\"tex-font-style-tt\">ababaaaaababa</span>\" + \"<span class=\"tex-font-style-tt\">bb</span>\" $$$\\to$$$ \"<span class=\"tex-font-style-tt\">abababaaabababa</span>\"; </li></ul><ul> <li> \"<span class=\"tex-font-style-tt\">ababaabaababa</span>\" + \"<span class=\"tex-font-style-tt\">aa</span>\" $$$\\to$$$ \"<span class=\"tex-font-style-tt\">ababaaabaaababa</span>\"; </li><li> \"<span class=\"tex-font-style-tt\">ababaabaababa</span>\" + \"<span class=\"tex-font-style-tt\">ab</span>\" $$$\\to$$$ \"<span class=\"tex-font-style-tt\">abababaaabababa</span>\"; </li><li> \"<span class=\"tex-font-style-tt\">ababaabaababa</span>\" + \"<span class=\"tex-font-style-tt\">bb</span>\" $$$\\to$$$ \"<span class=\"tex-font-style-tt\">abababababababa</span>\"; </li></ul></div></div></div></div>"
}