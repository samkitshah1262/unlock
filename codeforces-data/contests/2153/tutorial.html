<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tutorial</title>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
      line-height: 1.6;
      color: #333;
      background: #fafafa;
    }
    .ttypography {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    h3 {
      color: #1a1a1a;
      border-bottom: 2px solid #eee;
      padding-bottom: 10px;
    }
    h3 a {
      color: #0066cc;
      text-decoration: none;
    }
    h3 a:hover {
      text-decoration: underline;
    }
    .spoiler {
      margin: 15px 0;
      border: 1px solid #ddd;
      border-radius: 6px;
      overflow: hidden;
    }
    .spoiler-title {
      display: block;
      padding: 12px 15px;
      background: #f0f0f0;
      cursor: pointer;
      font-weight: 600;
      user-select: none;
      border-bottom: 1px solid #ddd;
    }
    .spoiler-title:hover {
      background: #e8e8e8;
    }
    .spoiler-title::before {
      content: '▶ ';
      font-size: 0.8em;
      transition: transform 0.2s;
      display: inline-block;
    }
    .spoiler.open .spoiler-title::before {
      content: '▼ ';
    }
    .spoiler-content {
      padding: 15px;
      background: #fff;
      display: none;
    }
    .spoiler.open .spoiler-content {
      display: block;
    }
    pre, code {
      background: #f5f5f5;
      font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
      font-size: 0.85em;
    }
    pre {
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
    }
    code {
      padding: 2px 5px;
      border-radius: 3px;
    }
    p {
      margin: 10px 0;
    }
    .MathJax {
      font-size: 1.1em;
    }
  </style>
</head>
<body>
  <h1>Editorial</h1>
  <p><a href="https://codeforces.com/blog/entry/147264" target="_blank">View on Codeforces →</a></p>
  
  <div class="ttypography"><h3><a href="https://codeforces.com/contest/2153/problem/A" title="Codeforces Round 1057 (Div. 2)">2153A - Circle of Apple Trees</a></h3> <div class="spoiler"><b class="spoiler-title">Hint 1</b><div class="spoiler-content" style="display: block;"><p>You can't eat two apples of the same beauty value.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 2</b><div class="spoiler-content" style="display: block;"><p>Is there a way to eat apples of all kinds of beauty values that appearred? </p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><p>First of all, since the beauty values of the apples you eat are in strictly increasing order, any two of them have different beauty values.</p><p>So, for each beauty value, you can eat at most one apple.</p><p>In fact, it can be shown that it is always possible to eat exactly one apple of each beauty value. Let's say all the distinct beauty values are <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1"><span class="MJXp-msubsup" id="MJXp-Span-2"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3" style="margin-right: 0.05em;">v</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-5" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-6"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-7" style="margin-right: 0.05em;">v</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-8" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-9" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-10" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-11" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-12"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-13" style="margin-right: 0.05em;">v</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-14" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-mtext" id="MJXp-Span-15">&nbsp;</span><span class="MJXp-mo" id="MJXp-Span-16" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-17"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-18" style="margin-right: 0.05em;">v</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-19" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-20" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-msubsup" id="MJXp-Span-21"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-22" style="margin-right: 0.05em;">v</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-23" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-24" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mo" id="MJXp-Span-25" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-26" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-msubsup" id="MJXp-Span-27"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-28" style="margin-right: 0.05em;">v</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-29" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-mo" id="MJXp-Span-30" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-1">v_1,v_2,\ldots,v_k\ (v_1\lt v_2\lt\ldots\lt v_k)</script>. You can eat one apple of beauty value <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-31"><span class="MJXp-msubsup" id="MJXp-Span-32"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-33" style="margin-right: 0.05em;">v</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-34" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-2">v_i</script> during the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-35"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-36">i</span></span></span><script type="math/tex" id="MathJax-Element-3">i</script>-th time you move along the full circle. </p><p>Therefore, the answer is the number of distinct numbers in beauty values. The time complexity is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-37"><span class="MJXp-mrow" id="MJXp-Span-38"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-39">O</span></span><span class="MJXp-mo" id="MJXp-Span-40" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-41">n</span><span class="MJXp-mo" id="MJXp-Span-42" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-4">\mathcal{O}(n)</script>.</p></div></div> <div class="spoiler"><b class="spoiler-title">Code (C++, maomao90)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">,</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
 
    </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">t</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
        
        </span><span class="kwd">set</span><span class="str">&lt;int&gt;</span><span class="pln"> st</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">int</span><span class="pln"> x</span><span class="pun">;</span><span class="pln">
            cin </span><span class="pun">&gt;&gt;</span><span class="pln"> x</span><span class="pun">;</span><span class="pln">
            st</span><span class="pun">.</span><span class="pln">insert</span><span class="pun">(</span><span class="pln">x</span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
 
        cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pun">)</span><span class="pln"> st</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
 
    </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div> <div class="spoiler"><b class="spoiler-title">Code (Pypy3.10, Little_Sheep_Yawn)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="kwd">import</span><span class="pln"> sys
input </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">lambda</span><span class="pun">:</span><span class="pln"> sys</span><span class="pun">.</span><span class="pln">stdin</span><span class="pun">.</span><span class="pln">readline</span><span class="pun">().</span><span class="pln">strip</span><span class="pun">()</span><span class="pln">

t </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">(</span><span class="pln">input</span><span class="pun">())</span><span class="pln">
outs </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[]</span><span class="pln">
 
</span><span class="kwd">for</span><span class="pln"> _ </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="pln">t</span><span class="pun">):</span><span class="pln">
    n </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">(</span><span class="pln">input</span><span class="pun">())</span><span class="pln">
    nums </span><span class="pun">=</span><span class="pln"> list</span><span class="pun">(</span><span class="pln">map</span><span class="pun">(</span><span class="kwd">int</span><span class="pun">,</span><span class="pln"> input</span><span class="pun">().</span><span class="pln">split</span><span class="pun">()))</span><span class="pln">
    </span><span class="com"># There can be hash collisions, but n is small enough.</span><span class="pln">
    outs</span><span class="pun">.</span><span class="pln">append</span><span class="pun">(</span><span class="pln">len</span><span class="pun">(</span><span class="kwd">set</span><span class="pun">(</span><span class="pln">nums</span><span class="pun">)))</span><span class="pln">
 
</span><span class="kwd">print</span><span class="pun">(</span><span class="str">'\n'</span><span class="pun">.</span><span class="kwd">join</span><span class="pun">(</span><span class="pln">map</span><span class="pun">(</span><span class="pln">str</span><span class="pun">,</span><span class="pln"> outs</span><span class="pun">)))</span></code></pre></div></div><h3><a href="https://codeforces.com/contest/2153/problem/B" title="Codeforces Round 1057 (Div. 2)">2153B - Bitwise Reversion</a></h3> <div class="spoiler"><b class="spoiler-title">Hint</b><div class="spoiler-content" style="display: block;"><p>Consider each bit of the numbers separately.</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><p>Different bits don't interfere with one another when you do bitwise operations. So, for each bit <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-43"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-44">k</span></span></span><script type="math/tex" id="MathJax-Element-5">k</script>, we can iterate over <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-45"><span class="MJXp-msubsup" id="MJXp-Span-46"><span class="MJXp-mn" id="MJXp-Span-47" style="margin-right: 0.05em;">2</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-48" style="vertical-align: 0.5em;">3</span></span></span></span><script type="math/tex" id="MathJax-Element-6">2^3</script> possibilities of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-49"><span class="MJXp-msubsup" id="MJXp-Span-50"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-51" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-52" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-mo" id="MJXp-Span-53" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mrow" id="MJXp-Span-54"><span class="MJXp-mn MJXp-mono" id="MJXp-Span-55">0</span></span><span class="MJXp-mtext" id="MJXp-Span-56">&nbsp;or&nbsp;</span><span class="MJXp-mrow" id="MJXp-Span-57"><span class="MJXp-mn MJXp-mono" id="MJXp-Span-58">1</span></span></span></span><script type="math/tex" id="MathJax-Element-7">a_k = \mathtt{0} \text{ or } \mathtt{1}</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-59"><span class="MJXp-msubsup" id="MJXp-Span-60"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-61" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-62" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-mo" id="MJXp-Span-63" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mrow" id="MJXp-Span-64"><span class="MJXp-mn MJXp-mono" id="MJXp-Span-65">0</span></span><span class="MJXp-mtext" id="MJXp-Span-66">&nbsp;or&nbsp;</span><span class="MJXp-mrow" id="MJXp-Span-67"><span class="MJXp-mn MJXp-mono" id="MJXp-Span-68">1</span></span></span></span><script type="math/tex" id="MathJax-Element-8">b_k = \mathtt{0} \text{ or } \mathtt{1}</script>, and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-69"><span class="MJXp-msubsup" id="MJXp-Span-70"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-71" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-72" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-mo" id="MJXp-Span-73" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mrow" id="MJXp-Span-74"><span class="MJXp-mn MJXp-mono" id="MJXp-Span-75">0</span></span><span class="MJXp-mtext" id="MJXp-Span-76">&nbsp;or&nbsp;</span><span class="MJXp-mrow" id="MJXp-Span-77"><span class="MJXp-mn MJXp-mono" id="MJXp-Span-78">1</span></span></span></span><script type="math/tex" id="MathJax-Element-9">c_k = \mathtt{0} \text{ or } \mathtt{1}</script>, and check whether it is consistent with the given numbers.</p><p>The time complexity for each test case is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-86"><span class="MJXp-mrow" id="MJXp-Span-87"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-88">O</span></span><span class="MJXp-mo" id="MJXp-Span-89" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi" id="MJXp-Span-90">log</span><span class="MJXp-mo" id="MJXp-Span-91" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-92" style="margin-left: 0.333em; margin-right: 0.333em;">max</span><span class="MJXp-mo" id="MJXp-Span-93" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-94">x</span><span class="MJXp-mo" id="MJXp-Span-95" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-96">y</span><span class="MJXp-mo" id="MJXp-Span-97" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-98">z</span><span class="MJXp-mo" id="MJXp-Span-99" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-100" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-10">\mathcal{O}(\log \max(x, y, z))</script>.</p></div></div> <div class="spoiler"><b class="spoiler-title">Code (C++, maomao90)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">using</span><span class="pln"> ll </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> MAXL </span><span class="pun">=</span><span class="pln"> </span><span class="lit">60</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
ll x</span><span class="pun">,</span><span class="pln"> y</span><span class="pun">,</span><span class="pln"> z</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">t</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        cin </span><span class="pun">&gt;&gt;</span><span class="pln"> x </span><span class="pun">&gt;&gt;</span><span class="pln"> y </span><span class="pun">&gt;&gt;</span><span class="pln"> z</span><span class="pun">;</span><span class="pln">
        ll a </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> b </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> c </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">bool</span><span class="pln"> ans </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> l </span><span class="pun">=</span><span class="pln"> MAXL </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> l </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> l</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            ll bit_x </span><span class="pun">=</span><span class="pln"> x </span><span class="pun">&gt;&gt;</span><span class="pln"> l </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> bit_y </span><span class="pun">=</span><span class="pln"> y </span><span class="pun">&gt;&gt;</span><span class="pln"> l </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> bit_z </span><span class="pun">=</span><span class="pln"> z </span><span class="pun">&gt;&gt;</span><span class="pln"> l </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">bool</span><span class="pln"> found </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">ll bit_a </span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">})</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">ll bit_b </span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">})</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">ll bit_c </span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">})</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">((</span><span class="pln">bit_a </span><span class="pun">&amp;</span><span class="pln"> bit_b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> bit_x </span><span class="pun">&amp;&amp;</span><span class="pln">
                            </span><span class="pun">(</span><span class="pln">bit_b </span><span class="pun">&amp;</span><span class="pln"> bit_c</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> bit_y </span><span class="pun">&amp;&amp;</span><span class="pln">
                            </span><span class="pun">(</span><span class="pln">bit_a </span><span class="pun">&amp;</span><span class="pln"> bit_c</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> bit_z</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                            found </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
                            a </span><span class="pun">|=</span><span class="pln"> bit_a </span><span class="pun">&lt;&lt;</span><span class="pln"> l</span><span class="pun">;</span><span class="pln">
                            b </span><span class="pun">|=</span><span class="pln"> bit_b </span><span class="pun">&lt;&lt;</span><span class="pln"> l</span><span class="pun">;</span><span class="pln">
                            c </span><span class="pun">|=</span><span class="pln"> bit_c </span><span class="pun">&lt;&lt;</span><span class="pln"> l</span><span class="pun">;</span><span class="pln">
                            </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
                        </span><span class="pun">}</span><span class="pln">
                    </span><span class="pun">}</span><span class="pln">
                    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">found</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                        </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
                    </span><span class="pun">}</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">found</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">found</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                ans </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
                </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">ans</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"NO\n"</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">assert</span><span class="pun">((</span><span class="pln">a </span><span class="pun">&amp;</span><span class="pln"> b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> x</span><span class="pun">);</span><span class="pln">
            </span><span class="kwd">assert</span><span class="pun">((</span><span class="pln">b </span><span class="pun">&amp;</span><span class="pln"> c</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> y</span><span class="pun">);</span><span class="pln">
            </span><span class="kwd">assert</span><span class="pun">((</span><span class="pln">a </span><span class="pun">&amp;</span><span class="pln"> c</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> z</span><span class="pun">);</span><span class="pln">
            cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"YES\n"</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span></code></pre></div></div> <div class="spoiler"><b class="spoiler-title">Code (Pypy3.10, Little_Sheep_Yawn, using the bonus)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="kwd">import</span><span class="pln"> sys
input </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">lambda</span><span class="pun">:</span><span class="pln"> sys</span><span class="pun">.</span><span class="pln">stdin</span><span class="pun">.</span><span class="pln">readline</span><span class="pun">().</span><span class="pln">strip</span><span class="pun">()</span><span class="pln">

t </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">(</span><span class="pln">input</span><span class="pun">())</span><span class="pln">
outs </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[]</span><span class="pln">
 
</span><span class="kwd">for</span><span class="pln"> _ </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="pln">t</span><span class="pun">):</span><span class="pln">
    x</span><span class="pun">,</span><span class="pln"> y</span><span class="pun">,</span><span class="pln"> z </span><span class="pun">=</span><span class="pln"> map</span><span class="pun">(</span><span class="kwd">int</span><span class="pun">,</span><span class="pln"> input</span><span class="pun">().</span><span class="pln">split</span><span class="pun">())</span><span class="pln">
    
    a </span><span class="pun">=</span><span class="pln"> x </span><span class="pun">|</span><span class="pln"> z
    b </span><span class="pun">=</span><span class="pln"> x </span><span class="pun">|</span><span class="pln"> y
    c </span><span class="pun">=</span><span class="pln"> y </span><span class="pun">|</span><span class="pln"> z
    
    outs</span><span class="pun">.</span><span class="pln">append</span><span class="pun">(</span><span class="str">'YES'</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> a </span><span class="pun">&amp;</span><span class="pln"> b </span><span class="pun">==</span><span class="pln"> x </span><span class="kwd">and</span><span class="pln"> b </span><span class="pun">&amp;</span><span class="pln"> c </span><span class="pun">==</span><span class="pln"> y </span><span class="kwd">and</span><span class="pln"> a </span><span class="pun">&amp;</span><span class="pln"> c </span><span class="pun">==</span><span class="pln"> z </span><span class="kwd">else</span><span class="pln"> </span><span class="str">'NO'</span><span class="pun">)</span><span class="pln">
 
</span><span class="kwd">print</span><span class="pun">(</span><span class="str">'\n'</span><span class="pun">.</span><span class="kwd">join</span><span class="pun">(</span><span class="pln">outs</span><span class="pun">))</span></code></pre></div></div> <div class="spoiler"><b class="spoiler-title">Bonus</b><div class="spoiler-content" style="display: block;"><p>You just need to check whether <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-101"><span class="MJXp-mo" id="MJXp-Span-102" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-103">a</span><span class="MJXp-mo" id="MJXp-Span-104" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-105">b</span><span class="MJXp-mo" id="MJXp-Span-106" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-107">c</span><span class="MJXp-mo" id="MJXp-Span-108" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-109" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-110" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-111">x</span><span class="MJXp-mrow" id="MJXp-Span-112"><span class="MJXp-mo" id="MJXp-Span-113" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-114">z</span><span class="MJXp-mo" id="MJXp-Span-115" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-116">x</span><span class="MJXp-mrow" id="MJXp-Span-117"><span class="MJXp-mo" id="MJXp-Span-118" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-119">y</span><span class="MJXp-mo" id="MJXp-Span-120" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-121">y</span><span class="MJXp-mrow" id="MJXp-Span-122"><span class="MJXp-mo" id="MJXp-Span-123" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-124">z</span><span class="MJXp-mo" id="MJXp-Span-125" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-11">(a,b,c)=(x|z,x|y,y|z)</script> is a valid solution, where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-126"><span class="MJXp-mrow" id="MJXp-Span-127"><span class="MJXp-mo" id="MJXp-Span-128" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span></span></span><script type="math/tex" id="MathJax-Element-12">|</script> denotes the <a href="https://en.wikipedia.org/wiki/Bitwise_operation#OR">bitwise OR operation</a>. Why?</p></div></div><h3><a href="https://codeforces.com/contest/2153/problem/C" title="Codeforces Round 1057 (Div. 2)">2153C - Symmetrical Polygons</a></h3> <div class="spoiler"><b class="spoiler-title">Hint 1</b><div class="spoiler-content" style="display: block;"><p>Consider the line of symmetry. It intersects with the polygon at no more than <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-129"><span class="MJXp-mn" id="MJXp-Span-130">2</span></span></span><script type="math/tex" id="MathJax-Element-13">2</script> sticks if we don't consider the endpoints of the sides.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 2</b><div class="spoiler-content" style="display: block;"><p>Other sticks come in pairs.</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><p>Any line intersects with the polygon at no more than <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-131"><span class="MJXp-mn" id="MJXp-Span-132">2</span></span></span><script type="math/tex" id="MathJax-Element-14">2</script> sticks (Here, we don't consider the endpoints of the sides when talking about intersection).</p><p>Consider the line of symmetry. The sticks not intersecting with it come in pairs of the same length.</p><p>Once we group the sticks in pairs of the same length (some sticks are not grouped), we should always use all of the pairs to construct the symmetrical convex polygon.</p><p>That is because, if we do not use all the pairs, for each unchosen pair, we can always add a copy of the stick on each side of the line of symmetry, which enlarges the perimeter. And if there exists a pair which we only use one of them as a side, it has to intersects with the line of symmetry. We can replace it with the pair on both sides of the line of symmetry and make the polygon convex with a larger perimeter.</p><p><strong>Case 1:</strong> The line of symmetry intersects none of the sticks.</p><p>Only pairs of sticks with same length can be used. To obtain the largest perimeter, it is the most optimal to use all possible pairs.</p><p><strong>Case 2:</strong> The line of symmetry intersects exactly one stick.</p><p>Let us call the stick that intersects the line of symmetry the <em>odd</em> stick. As long as the length of the odd stick is less than the total length of the pairs of sticks with identical length, we can use the odd stick. Hence, we can iterate through all possible sticks and check whether it is possible for it to be the odd stick in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-133"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-134">O</span><span class="MJXp-mo" id="MJXp-Span-135" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-136">1</span><span class="MJXp-mo" id="MJXp-Span-137" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-15">O(1)</script> time for each odd stick.</p><p><strong>Case 3:</strong> The line of symmetry intersects exactly two sticks.</p><p>Let the longer of the two sticks that intersect the line of symmetry be the <em>long odd</em> stick, and the shorter be the <em>short odd</em> stick. As long as the difference in the length of the long odd stick and even odd stick is less than the total length of the pairs of sticks with identical length, we can use the long odd stick and short odd stick.</p><p>Let's say the remaining sticks in ascending order are <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-138"><span class="MJXp-msubsup" id="MJXp-Span-139"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-140" style="margin-right: 0.05em;">v</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-141" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-142" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-143"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-144" style="margin-right: 0.05em;">v</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-145" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-146" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-147" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-148" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-149"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-150" style="margin-right: 0.05em;">v</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-151" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-mtext" id="MJXp-Span-152">&nbsp;</span><span class="MJXp-mo" id="MJXp-Span-153" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-154"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-155" style="margin-right: 0.05em;">v</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-156" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-157" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-msubsup" id="MJXp-Span-158"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-159" style="margin-right: 0.05em;">v</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-160" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-161" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mo" id="MJXp-Span-162" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-163" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-msubsup" id="MJXp-Span-164"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-165" style="margin-right: 0.05em;">v</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-166" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-mo" id="MJXp-Span-167" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-16">v_1,v_2,\ldots,v_k\ (v_1\lt v_2\lt\ldots\lt v_k)</script>. If the longer stick we choose is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-168"><span class="MJXp-msubsup" id="MJXp-Span-169"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-170" style="margin-right: 0.05em;">v</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-171" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mtext" id="MJXp-Span-172">&nbsp;</span><span class="MJXp-mo" id="MJXp-Span-173" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-174">i</span><span class="MJXp-mo" id="MJXp-Span-175" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-mn" id="MJXp-Span-176">1</span><span class="MJXp-mo" id="MJXp-Span-177" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-17">v_i\ (i\gt 1)</script>, then the shorter one we choose should always be <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-178"><span class="MJXp-msubsup" id="MJXp-Span-179"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-180" style="margin-right: 0.05em;">v</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-181" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-182">i</span><span class="MJXp-mo" id="MJXp-Span-183">−</span><span class="MJXp-mn" id="MJXp-Span-184">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-18">v_{i-1}</script>, because it is the longest one we can choose and the difference of the two sticks chosen is minimized.</p><p>So you just need to check these pairs: <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-185"><span class="MJXp-mo" id="MJXp-Span-186" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-187"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-188" style="margin-right: 0.05em;">v</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-189" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-190" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-191"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-192" style="margin-right: 0.05em;">v</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-193" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-194" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-195" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-196" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-197"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-198" style="margin-right: 0.05em;">v</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-199" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-200" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-201"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-202" style="margin-right: 0.05em;">v</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-203" style="vertical-align: -0.4em;">3</span></span><span class="MJXp-mo" id="MJXp-Span-204" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-205" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-206" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-207" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-208" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-209"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-210" style="margin-right: 0.05em;">v</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-211" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-212">k</span><span class="MJXp-mo" id="MJXp-Span-213">−</span><span class="MJXp-mn" id="MJXp-Span-214">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-215" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-216"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-217" style="margin-right: 0.05em;">v</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-218" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-mo" id="MJXp-Span-219" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-19">(v_1,v_2),(v_2,v_3),\ldots,(v_{k-1},v_k)</script>.</p><p>The time complexity is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-220"><span class="MJXp-mrow" id="MJXp-Span-221"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-222">O</span></span><span class="MJXp-mo" id="MJXp-Span-223" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-224">n</span><span class="MJXp-mi" id="MJXp-Span-225">log</span><span class="MJXp-mo" id="MJXp-Span-226" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-227">n</span><span class="MJXp-mo" id="MJXp-Span-228" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-20">\mathcal{O}(n\log n)</script>.</p></div></div> <div class="spoiler"><b class="spoiler-title">Code (C++, maomao90)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">using</span><span class="pln"> ll </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> MAXN </span><span class="pun">=</span><span class="pln"> </span><span class="lit">200</span><span class="str">'005;
 
int t;
int n;
int a[MAXN];
map&lt;int, int&gt; cnt;
 
int main() {
    ios::sync_with_stdio(0), cin.tie(0);
    cin &gt;&gt; t;
    while (t--) {
        cnt.clear();
 
        cin &gt;&gt; n;
        for (int i = 0; i &lt; n; i++) {
            cin &gt;&gt; a[i];
        }
        for (int i = 0; i &lt; n; i++) {
            cnt[a[i]]++;
        }
 
        ll base = 0;
        vector&lt;int&gt; odd, even;
        for (auto [x, c] : cnt) {
            base += (ll)x * (c / 2);
            if (c % 2 == 1) {
                odd.push_back(x);
            } else if (c &gt;= 2) {
                even.push_back(x);
            }
        }
 
        if (base == 0) {
            cout &lt;&lt; 0 &lt;&lt; '</span><span class="pln">\n</span><span class="str">';
            continue;
        }
 
        ll ans = 0;
        for (int x : odd) {
            if (2 * base &gt; x) {
                ans = max(ans, 2 * base + x);
            }
        }
 
        assert(is_sorted(odd.begin(), odd.end()));
        for (int i = 1; i &lt; (int)odd.size(); i++) {
            if (odd[i - 1] + 2 * base &gt; odd[i]) {
                ans = max(ans, odd[i - 1] + 2 * base + odd[i]);
            }
        }
 
        for (int x : even) {
            if (base - x &gt; 0) {
                ans = max(ans, 2 * base);
            }
        }
 
        cout &lt;&lt; ans &lt;&lt; '</span><span class="pln">\n</span><span class="str">';
    }
    return 0;
}</span></code></pre></div></div> <div class="spoiler"><b class="spoiler-title">Code (Pypy3.10, Little_Sheep_Yawn)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="kwd">import</span><span class="pln"> sys
input </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">lambda</span><span class="pun">:</span><span class="pln"> sys</span><span class="pun">.</span><span class="pln">stdin</span><span class="pun">.</span><span class="pln">readline</span><span class="pun">().</span><span class="pln">strip</span><span class="pun">()</span><span class="pln">

t </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">(</span><span class="pln">input</span><span class="pun">())</span><span class="pln">
outs </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[]</span><span class="pln">
 
</span><span class="com"># avoiding hash collisions, which we don't have tests in the pretests</span><span class="pln">
rnd </span><span class="pun">=</span><span class="pln"> random</span><span class="pun">.</span><span class="pln">getrandbits</span><span class="pun">(</span><span class="lit">30</span><span class="pun">)</span><span class="pln">
fmax </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">lambda</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> y</span><span class="pun">:</span><span class="pln"> x </span><span class="kwd">if</span><span class="pln"> x </span><span class="pun">&gt;</span><span class="pln"> y </span><span class="kwd">else</span><span class="pln"> y
 
</span><span class="kwd">for</span><span class="pln"> _ </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="pln">t</span><span class="pun">):</span><span class="pln">
    n </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">(</span><span class="pln">input</span><span class="pun">())</span><span class="pln">
    nums </span><span class="pun">=</span><span class="pln"> list</span><span class="pun">(</span><span class="pln">map</span><span class="pun">(</span><span class="kwd">int</span><span class="pun">,</span><span class="pln"> input</span><span class="pun">().</span><span class="pln">split</span><span class="pun">()))</span><span class="pln">
    
    cnt </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Counter</span><span class="pun">(</span><span class="pln">x </span><span class="pun">^</span><span class="pln"> rnd </span><span class="kwd">for</span><span class="pln"> x </span><span class="kwd">in</span><span class="pln"> nums</span><span class="pun">)</span><span class="pln">
    
    c </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
    half </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
    tmp </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[]</span><span class="pln">
    
    </span><span class="kwd">for</span><span class="pln"> x </span><span class="kwd">in</span><span class="pln"> cnt</span><span class="pun">:</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> cnt</span><span class="pun">[</span><span class="pln">x</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">:</span><span class="pln">
            c </span><span class="pun">+=</span><span class="pln"> cnt</span><span class="pun">[</span><span class="pln">x</span><span class="pun">]</span><span class="pln"> </span><span class="com">// 2</span><span class="pln">
            half </span><span class="pun">+=</span><span class="pln"> cnt</span><span class="pun">[</span><span class="pln">x</span><span class="pun">]</span><span class="pln"> </span><span class="com">// 2 * (x ^ rnd)</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> cnt</span><span class="pun">[</span><span class="pln">x</span><span class="pun">]</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> </span><span class="lit">2</span><span class="pun">:</span><span class="pln">
            tmp</span><span class="pun">.</span><span class="pln">append</span><span class="pun">(</span><span class="pln">x </span><span class="pun">^</span><span class="pln"> rnd</span><span class="pun">)</span><span class="pln">
    
    tmp</span><span class="pun">.</span><span class="pln">sort</span><span class="pun">()</span><span class="pln">
    
    ans </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> c </span><span class="pun">&lt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> half </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pln">
    
    </span><span class="kwd">for</span><span class="pln"> x </span><span class="kwd">in</span><span class="pln"> tmp</span><span class="pun">:</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> half </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> x</span><span class="pun">:</span><span class="pln">
            ans </span><span class="pun">=</span><span class="pln"> fmax</span><span class="pun">(</span><span class="pln">ans</span><span class="pun">,</span><span class="pln"> half </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> x</span><span class="pun">)</span><span class="pln">
    
    </span><span class="kwd">for</span><span class="pln"> i </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> len</span><span class="pun">(</span><span class="pln">tmp</span><span class="pun">)):</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> half </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> tmp</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> tmp</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]:</span><span class="pln">
            ans </span><span class="pun">=</span><span class="pln"> fmax</span><span class="pun">(</span><span class="pln">ans</span><span class="pun">,</span><span class="pln"> half </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> tmp</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> tmp</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln">
    
    outs</span><span class="pun">.</span><span class="pln">append</span><span class="pun">(</span><span class="pln">ans</span><span class="pun">)</span><span class="pln">
 
</span><span class="kwd">print</span><span class="pun">(</span><span class="str">'\n'</span><span class="pun">.</span><span class="kwd">join</span><span class="pun">(</span><span class="pln">map</span><span class="pun">(</span><span class="pln">str</span><span class="pun">,</span><span class="pln"> outs</span><span class="pun">)))</span></code></pre></div></div><h3><a href="https://codeforces.com/contest/2153/problem/D" title="Codeforces Round 1057 (Div. 2)">2153D - Not Alone</a></h3> <div class="spoiler"><b class="spoiler-title">Hint 1</b><div class="spoiler-content" style="display: block;"><p>Break up a nice array into "blocks" of same values.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 2</b><div class="spoiler-content" style="display: block;"><p>Each block can be considered as blocks of size <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-229"><span class="MJXp-mn" id="MJXp-Span-230">2</span></span></span><script type="math/tex" id="MathJax-Element-21">2</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-231"><span class="MJXp-mn" id="MJXp-Span-232">3</span></span></span><script type="math/tex" id="MathJax-Element-22">3</script> concatenating together.</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><p>We can divide the nice circular array in blocks, where each block consists of equal values.</p><p>The final circular array can be divided into blocks with size of at least <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-233"><span class="MJXp-mn" id="MJXp-Span-234">2</span></span></span><script type="math/tex" id="MathJax-Element-23">2</script>.</p><p>And, since <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-235"><span class="MJXp-mn" id="MJXp-Span-236">2</span><span class="MJXp-mo" id="MJXp-Span-237" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-238">2</span><span class="MJXp-mo" id="MJXp-Span-239" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-240">3</span><span class="MJXp-mo" id="MJXp-Span-241" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-242">3</span><span class="MJXp-mo" id="MJXp-Span-243" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-244">4</span><span class="MJXp-mo" id="MJXp-Span-245" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-246">2</span><span class="MJXp-mo" id="MJXp-Span-247" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-248">2</span></span></span><script type="math/tex" id="MathJax-Element-24">2=2,3=3,4=2+2</script>, each block can be divided into sub-blocks of size <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-249"><span class="MJXp-mn" id="MJXp-Span-250">2</span></span></span><script type="math/tex" id="MathJax-Element-25">2</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-251"><span class="MJXp-mn" id="MJXp-Span-252">3</span></span></span><script type="math/tex" id="MathJax-Element-26">3</script>:</p> <ul>   <li>If the block is of size <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-253"><span class="MJXp-mn" id="MJXp-Span-254">3</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-255">k</span><span class="MJXp-mo" id="MJXp-Span-256" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-257">1</span><span class="MJXp-mtext" id="MJXp-Span-258">&nbsp;</span><span class="MJXp-mo" id="MJXp-Span-259" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-260">k</span><span class="MJXp-mo" id="MJXp-Span-261" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-mn" id="MJXp-Span-262">0</span><span class="MJXp-mo" id="MJXp-Span-263" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-27">3k-1\ (k\gt 0)</script>, then <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-264"><span class="MJXp-mn" id="MJXp-Span-265">3</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-266">k</span><span class="MJXp-mo" id="MJXp-Span-267" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-268">1</span><span class="MJXp-mo" id="MJXp-Span-269" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-270">1</span><span class="MJXp-mo" id="MJXp-Span-271" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mn" id="MJXp-Span-272">2</span><span class="MJXp-mo" id="MJXp-Span-273" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mo" id="MJXp-Span-274" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-275">k</span><span class="MJXp-mo" id="MJXp-Span-276" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-277">1</span><span class="MJXp-mo" id="MJXp-Span-278" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-279" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mn" id="MJXp-Span-280">3</span></span></span><script type="math/tex" id="MathJax-Element-28">3k-1=1\cdot 2+(k-1)\cdot 3</script>.</li>   <li>If the block is of size <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-281"><span class="MJXp-mn" id="MJXp-Span-282">3</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-283">k</span><span class="MJXp-mtext" id="MJXp-Span-284">&nbsp;</span><span class="MJXp-mo" id="MJXp-Span-285" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-286">k</span><span class="MJXp-mo" id="MJXp-Span-287" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-mn" id="MJXp-Span-288">0</span><span class="MJXp-mo" id="MJXp-Span-289" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-29">3k\ (k\gt 0)</script>, then <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-290"><span class="MJXp-mn" id="MJXp-Span-291">3</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-292">k</span><span class="MJXp-mo" id="MJXp-Span-293" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-294">0</span><span class="MJXp-mo" id="MJXp-Span-295" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mn" id="MJXp-Span-296">2</span><span class="MJXp-mo" id="MJXp-Span-297" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-298">k</span><span class="MJXp-mo" id="MJXp-Span-299" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mn" id="MJXp-Span-300">3</span></span></span><script type="math/tex" id="MathJax-Element-30">3k=0\cdot 2+k\cdot 3</script>.</li>   <li>If the block is of size <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-301"><span class="MJXp-mn" id="MJXp-Span-302">3</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-303">k</span><span class="MJXp-mo" id="MJXp-Span-304" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-305">1</span><span class="MJXp-mtext" id="MJXp-Span-306">&nbsp;</span><span class="MJXp-mo" id="MJXp-Span-307" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-308">k</span><span class="MJXp-mo" id="MJXp-Span-309" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-mn" id="MJXp-Span-310">0</span><span class="MJXp-mo" id="MJXp-Span-311" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-31">3k+1\ (k\gt 0)</script>, then <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-312"><span class="MJXp-mn" id="MJXp-Span-313">3</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-314">k</span><span class="MJXp-mo" id="MJXp-Span-315" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-316">1</span><span class="MJXp-mo" id="MJXp-Span-317" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-318">2</span><span class="MJXp-mo" id="MJXp-Span-319" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mn" id="MJXp-Span-320">2</span><span class="MJXp-mo" id="MJXp-Span-321" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mo" id="MJXp-Span-322" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-323">k</span><span class="MJXp-mo" id="MJXp-Span-324" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-325">1</span><span class="MJXp-mo" id="MJXp-Span-326" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-327" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mn" id="MJXp-Span-328">3</span></span></span><script type="math/tex" id="MathJax-Element-32">3k+1=2\cdot 2+(k-1)\cdot 3</script>.</li> </ul><p>With this observation, we can modify the condition of a nice circular array as follows:</p> <blockquote><p>A circular array is nice if we can split it into contiguous blocks of length 2 or length 3, such that each block has equal value, and each element belongs to exactly one block.</p> </blockquote><p>Let us first try to solve the easier problem where the array is not circular. Let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-329"><span class="MJXp-mtext" id="MJXp-Span-330">dp</span><span class="MJXp-mo" id="MJXp-Span-331" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-332">i</span><span class="MJXp-mo" id="MJXp-Span-333" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-33">\text{dp}[i]</script> be the minimum number of operations to make <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-334"><span class="MJXp-mo" id="MJXp-Span-335" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-msubsup" id="MJXp-Span-336"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-337" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-338" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-339" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-340"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-341" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-342" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-343" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-344" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-345" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-346"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-347" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-348" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-349" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-34">[a_1,a_2,\ldots,a_i]</script> nice. Then, by considering whether the last block containing <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-350"><span class="MJXp-msubsup" id="MJXp-Span-351"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-352" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-353" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-35">a_i</script> is of length <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-354"><span class="MJXp-mn" id="MJXp-Span-355">2</span></span></span><script type="math/tex" id="MathJax-Element-36">2</script> or length <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-356"><span class="MJXp-mn" id="MJXp-Span-357">3</span></span></span><script type="math/tex" id="MathJax-Element-37">3</script>, we can come up with the transition: </p> <center><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-358"><span class="MJXp-mtext" id="MJXp-Span-359">dp</span><span class="MJXp-mo" id="MJXp-Span-360" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-361">i</span><span class="MJXp-mo" id="MJXp-Span-362" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-363" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-364" style="margin-left: 0.333em; margin-right: 0.333em;">min</span><span class="MJXp-mo" id="MJXp-Span-365" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mtext" id="MJXp-Span-366">dp</span><span class="MJXp-mo" id="MJXp-Span-367" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-368">i</span><span class="MJXp-mo" id="MJXp-Span-369" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-370">2</span><span class="MJXp-mo" id="MJXp-Span-371" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-372" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mtext" id="MJXp-Span-373">cost</span><span class="MJXp-mo" id="MJXp-Span-374" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-375"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-376" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-377" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-378">i</span><span class="MJXp-mo" id="MJXp-Span-379">−</span><span class="MJXp-mn" id="MJXp-Span-380">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-381" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-382"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-383" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-384" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-385" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-386" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mtext" id="MJXp-Span-387">dp</span><span class="MJXp-mo" id="MJXp-Span-388" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-389">i</span><span class="MJXp-mo" id="MJXp-Span-390" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-391">3</span><span class="MJXp-mo" id="MJXp-Span-392" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-393" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mtext" id="MJXp-Span-394">cost</span><span class="MJXp-mo" id="MJXp-Span-395" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-396"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-397" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-398" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-399">i</span><span class="MJXp-mo" id="MJXp-Span-400">−</span><span class="MJXp-mn" id="MJXp-Span-401">2</span></span></span><span class="MJXp-mo" id="MJXp-Span-402" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-403"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-404" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-405" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-406">i</span><span class="MJXp-mo" id="MJXp-Span-407">−</span><span class="MJXp-mn" id="MJXp-Span-408">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-409" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-410"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-411" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-412" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-413" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-414" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-38">\text{dp}[i] = \min(\text{dp}[i - 2] + \text{cost}(a_{i - 1}, a_i), \text{dp}[i - 3] + \text{cost}(a_{i - 2}, a_{i - 1}, a_i))</script></center><p>where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-415"><span class="MJXp-mtext" id="MJXp-Span-416">cost</span></span></span><script type="math/tex" id="MathJax-Element-39">\text{cost}</script> denotes the minimum number of operations to make the elements equal.</p><p>To solve the original problem where the array is circular, we can use the standard technique of splitting the circular array by cutting the circle between <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-417"><span class="MJXp-mo" id="MJXp-Span-418" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-419">i</span><span class="MJXp-mo" id="MJXp-Span-420" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-421">i</span><span class="MJXp-mo" id="MJXp-Span-422" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-423">1</span><span class="MJXp-mo" id="MJXp-Span-424" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-40">(i, i + 1)</script> for each <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-425"><span class="MJXp-mn" id="MJXp-Span-426">1</span><span class="MJXp-mo" id="MJXp-Span-427" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-428">i</span><span class="MJXp-mo" id="MJXp-Span-429" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-430">n</span></span></span><script type="math/tex" id="MathJax-Element-41">1\le i\le n</script>. This will take <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-431"><span class="MJXp-mrow" id="MJXp-Span-432"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-433">O</span></span><span class="MJXp-mo" id="MJXp-Span-434" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-435"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-436" style="margin-right: 0.05em;">n</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-437" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-438" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-42">\mathcal{O}(n^2)</script> time. However, since the length of the blocks do not exceed <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-439"><span class="MJXp-mn" id="MJXp-Span-440">3</span></span></span><script type="math/tex" id="MathJax-Element-43">3</script>, we only need to try three splitting points <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-441"><span class="MJXp-mo" id="MJXp-Span-442" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-443">1</span><span class="MJXp-mo" id="MJXp-Span-444" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-445">2</span><span class="MJXp-mo" id="MJXp-Span-446" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-44">(1, 2)</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-447"><span class="MJXp-mo" id="MJXp-Span-448" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-449">2</span><span class="MJXp-mo" id="MJXp-Span-450" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-451">3</span><span class="MJXp-mo" id="MJXp-Span-452" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-45">(2, 3)</script>, and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-453"><span class="MJXp-mo" id="MJXp-Span-454" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-455">3</span><span class="MJXp-mo" id="MJXp-Span-456" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-457">4</span><span class="MJXp-mo" id="MJXp-Span-458" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-46">(3, 4)</script>.</p><p>The time complexity is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-459"><span class="MJXp-mrow" id="MJXp-Span-460"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-461">O</span></span><span class="MJXp-mo" id="MJXp-Span-462" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-463">n</span><span class="MJXp-mo" id="MJXp-Span-464" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-47">\mathcal{O}(n)</script>.</p></div></div> <div class="spoiler"><b class="spoiler-title">Code (C++, maomao90)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">using</span><span class="pln"> ll </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">const</span><span class="pln"> ll LINF </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1000000000000000005</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> MAXN </span><span class="pun">=</span><span class="pln"> </span><span class="lit">500005</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">MAXN</span><span class="pun">];</span><span class="pln">
ll dp</span><span class="pun">[</span><span class="pln">MAXN</span><span class="pun">];</span><span class="pln">
 
ll cost</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> y</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> abs</span><span class="pun">(</span><span class="pln">x </span><span class="pun">-</span><span class="pln"> y</span><span class="pun">);</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
 
ll cost</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> y</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> z</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x </span><span class="pun">&gt;</span><span class="pln"> y</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        swap</span><span class="pun">(</span><span class="pln">x</span><span class="pun">,</span><span class="pln"> y</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">y </span><span class="pun">&gt;</span><span class="pln"> z</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        swap</span><span class="pun">(</span><span class="pln">y</span><span class="pun">,</span><span class="pln"> z</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x </span><span class="pun">&gt;</span><span class="pln"> y</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        swap</span><span class="pun">(</span><span class="pln">x</span><span class="pun">,</span><span class="pln"> y</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> z </span><span class="pun">-</span><span class="pln"> x</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    ios</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="lit">0</span><span class="pun">),</span><span class="pln"> cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">t</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            cin </span><span class="pun">&gt;&gt;</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
 
        ll ans </span><span class="pun">=</span><span class="pln"> LINF</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> cyc </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> cyc </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">4</span><span class="pun">;</span><span class="pln"> cyc</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            dp</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
            dp</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> LINF</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                dp</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> dp</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> cost</span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">],</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]);</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">3</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    dp</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln">
                        min</span><span class="pun">(</span><span class="pln">dp</span><span class="pun">[</span><span class="pln">i</span><span class="pun">],</span><span class="pln"> dp</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> cost</span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">2</span><span class="pun">],</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">],</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]));</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
            ans </span><span class="pun">=</span><span class="pln"> min</span><span class="pun">(</span><span class="pln">ans</span><span class="pun">,</span><span class="pln"> dp</span><span class="pun">[</span><span class="pln">n</span><span class="pun">]);</span><span class="pln">
 
            </span><span class="com">// cyclic shift anti-clockwise</span><span class="pln">
            </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                swap</span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">],</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]);</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
 
        cout </span><span class="pun">&lt;&lt;</span><span class="pln"> ans </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div> <div class="spoiler"><b class="spoiler-title">Code (Pypy3.10, Little_Sheep_Yawn)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="kwd">import</span><span class="pln"> sys
input </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">lambda</span><span class="pun">:</span><span class="pln"> sys</span><span class="pun">.</span><span class="pln">stdin</span><span class="pun">.</span><span class="pln">readline</span><span class="pun">().</span><span class="pln">strip</span><span class="pun">()</span><span class="pln">

t </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">(</span><span class="pln">input</span><span class="pun">())</span><span class="pln">
outs </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[]</span><span class="pln">
fmin </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">lambda</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> y</span><span class="pun">:</span><span class="pln"> x </span><span class="kwd">if</span><span class="pln"> x </span><span class="pun">&lt;</span><span class="pln"> y </span><span class="kwd">else</span><span class="pln"> y
 
inf </span><span class="pun">=</span><span class="pln"> </span><span class="lit">10</span><span class="pln"> </span><span class="pun">**</span><span class="pln"> </span><span class="lit">15</span><span class="pln">
</span><span class="kwd">for</span><span class="pln"> _ </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="pln">t</span><span class="pun">):</span><span class="pln">
    n </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">(</span><span class="pln">input</span><span class="pun">())</span><span class="pln">
    nums </span><span class="pun">=</span><span class="pln"> list</span><span class="pun">(</span><span class="pln">map</span><span class="pun">(</span><span class="kwd">int</span><span class="pun">,</span><span class="pln"> input</span><span class="pun">().</span><span class="pln">split</span><span class="pun">()))</span><span class="pln">
    
    ans </span><span class="pun">=</span><span class="pln"> inf
    
    </span><span class="kwd">for</span><span class="pln"> _ </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="lit">3</span><span class="pun">):</span><span class="pln">
        nums </span><span class="pun">=</span><span class="pln"> nums</span><span class="pun">[-</span><span class="lit">1</span><span class="pun">:]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> nums</span><span class="pun">[:-</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
        dp </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">inf</span><span class="pun">]</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">
        dp</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
        
        </span><span class="kwd">for</span><span class="pln"> i </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">):</span><span class="pln">
            dp</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> fmin</span><span class="pun">(</span><span class="pln">dp</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> max</span><span class="pun">(</span><span class="pln">nums</span><span class="pun">[</span><span class="pln">i</span><span class="pun">-</span><span class="lit">2</span><span class="pun">:</span><span class="pln">i</span><span class="pun">])</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> min</span><span class="pun">(</span><span class="pln">nums</span><span class="pun">[</span><span class="pln">i</span><span class="pun">-</span><span class="lit">2</span><span class="pun">:</span><span class="pln">i</span><span class="pun">]),</span><span class="pln">
                         dp</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> max</span><span class="pun">(</span><span class="pln">nums</span><span class="pun">[</span><span class="pln">i</span><span class="pun">-</span><span class="lit">3</span><span class="pun">:</span><span class="pln">i</span><span class="pun">])</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> min</span><span class="pun">(</span><span class="pln">nums</span><span class="pun">[</span><span class="pln">i</span><span class="pun">-</span><span class="lit">3</span><span class="pun">:</span><span class="pln">i</span><span class="pun">])</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> i </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> inf</span><span class="pun">)</span><span class="pln">
        
        ans </span><span class="pun">=</span><span class="pln"> fmin</span><span class="pun">(</span><span class="pln">ans</span><span class="pun">,</span><span class="pln"> dp</span><span class="pun">[</span><span class="pln">n</span><span class="pun">])</span><span class="pln">
    
    outs</span><span class="pun">.</span><span class="pln">append</span><span class="pun">(</span><span class="pln">ans</span><span class="pun">)</span><span class="pln">
 
</span><span class="kwd">print</span><span class="pun">(</span><span class="str">'\n'</span><span class="pun">.</span><span class="kwd">join</span><span class="pun">(</span><span class="pln">map</span><span class="pun">(</span><span class="pln">str</span><span class="pun">,</span><span class="pln"> outs</span><span class="pun">)))</span></code></pre></div></div><h3><a href="https://codeforces.com/contest/2153/problem/E" title="Codeforces Round 1057 (Div. 2)">2153E - Zero Trailing Factorial</a></h3> <div class="spoiler"><b class="spoiler-title">Hint 1</b><div class="spoiler-content" style="display: block;"><p>Why is the answer always smaller than <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-465"><span class="MJXp-msubsup" id="MJXp-Span-466"><span class="MJXp-mn" id="MJXp-Span-467" style="margin-right: 0.05em;">10</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-468" style="vertical-align: 0.5em;"><span class="MJXp-mn" id="MJXp-Span-469">100</span></span></span></span></span><script type="math/tex" id="MathJax-Element-48">10^{100}</script> ?</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 2</b><div class="spoiler-content" style="display: block;"><p>There are only a few <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-470"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-471">k</span></span></span><script type="math/tex" id="MathJax-Element-49">k</script>-s that are worth choosing.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 3</b><div class="spoiler-content" style="display: block;"><p><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-472"><span class="MJXp-msubsup" id="MJXp-Span-473"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-474" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-475" style="vertical-align: -0.4em;">m</span></span><span class="MJXp-mo" id="MJXp-Span-476" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-477">x</span><span class="MJXp-mo" id="MJXp-Span-478" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-479">n</span><span class="MJXp-mo" id="MJXp-Span-480" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-50">f_m(x, n)</script> is equal to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-481"><span class="MJXp-mn" id="MJXp-Span-482">0</span></span></span><script type="math/tex" id="MathJax-Element-51">0</script> for a lot of the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-483"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-484">x</span></span></span><script type="math/tex" id="MathJax-Element-52">x</script>.</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><p>Let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-485"><span class="MJXp-msubsup" id="MJXp-Span-486"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-487" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-488" style="vertical-align: -0.4em;">0</span></span></span></span><script type="math/tex" id="MathJax-Element-53">p_0</script> be the largest prime that is not greater than <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-489"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-490">n</span></span></span><script type="math/tex" id="MathJax-Element-54">n</script>. Then, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-491"><span class="MJXp-msubsup" id="MJXp-Span-492"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-493" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-494" style="vertical-align: -0.4em;">m</span></span><span class="MJXp-mo" id="MJXp-Span-495" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-496">x</span><span class="MJXp-mo" id="MJXp-Span-497" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-498">n</span><span class="MJXp-mo" id="MJXp-Span-499" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-500" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-501">0</span></span></span><script type="math/tex" id="MathJax-Element-55">f_m(x, n) = 0</script> for all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-502"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-503">x</span><span class="MJXp-mo" id="MJXp-Span-504" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-msubsup" id="MJXp-Span-505"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-506" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-507" style="vertical-align: -0.4em;">0</span></span></span></span><script type="math/tex" id="MathJax-Element-56">x < p_0</script>.</p> <div class="spoiler"><b class="spoiler-title">Proof</b><div class="spoiler-content" style="display: block;"><p><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-508"><span class="MJXp-msubsup" id="MJXp-Span-509"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-510" style="margin-right: 0.05em;">v</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-511" style="vertical-align: -0.4em;"><span class="MJXp-msubsup" id="MJXp-Span-512"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-513" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-514" style="vertical-align: -0.4em;">0</span></span></span></span><span class="MJXp-mo" id="MJXp-Span-515" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-516">x</span><span class="MJXp-mo" id="MJXp-Span-517" style="margin-left: 0.111em; margin-right: 0em;">!</span><span class="MJXp-mo" id="MJXp-Span-518" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-519" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-520">0</span></span></span><script type="math/tex" id="MathJax-Element-57">v_{p_0}(x!) = 0</script> for all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-521"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-522">x</span><span class="MJXp-mo" id="MJXp-Span-523" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-msubsup" id="MJXp-Span-524"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-525" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-526" style="vertical-align: -0.4em;">0</span></span></span></span><script type="math/tex" id="MathJax-Element-58">x < p_0</script>, and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-527"><span class="MJXp-msubsup" id="MJXp-Span-528"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-529" style="margin-right: 0.05em;">v</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-530" style="vertical-align: -0.4em;"><span class="MJXp-msubsup" id="MJXp-Span-531"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-532" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-533" style="vertical-align: -0.4em;">0</span></span></span></span><span class="MJXp-mo" id="MJXp-Span-534" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-535">n</span><span class="MJXp-mo" id="MJXp-Span-536" style="margin-left: 0.111em; margin-right: 0em;">!</span><span class="MJXp-mo" id="MJXp-Span-537" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-538" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-mn" id="MJXp-Span-539">0</span></span></span><script type="math/tex" id="MathJax-Element-59">v_{p_0}(n!) > 0</script>. Hence, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-540"><span class="MJXp-msubsup" id="MJXp-Span-541"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-542" style="margin-right: 0.05em;">w</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-543" style="vertical-align: -0.4em;"><span class="MJXp-msubsup" id="MJXp-Span-544"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-545" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-546" style="vertical-align: -0.4em;">0</span></span></span></span><span class="MJXp-mo" id="MJXp-Span-547" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-548">x</span><span class="MJXp-mo" id="MJXp-Span-549" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-550">n</span><span class="MJXp-mo" id="MJXp-Span-551" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-552" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-553" style="margin-left: 0.333em; margin-right: 0.333em;">min</span><span class="MJXp-mo" id="MJXp-Span-554" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-555"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-556" style="margin-right: 0.05em;">v</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-557" style="vertical-align: -0.4em;"><span class="MJXp-msubsup" id="MJXp-Span-558"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-559" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-560" style="vertical-align: -0.4em;">0</span></span></span></span><span class="MJXp-mo" id="MJXp-Span-561" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-562">x</span><span class="MJXp-mo" id="MJXp-Span-563" style="margin-left: 0.111em; margin-right: 0em;">!</span><span class="MJXp-mo" id="MJXp-Span-564" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-565" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-566"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-567" style="margin-right: 0.05em;">v</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-568" style="vertical-align: -0.4em;"><span class="MJXp-msubsup" id="MJXp-Span-569"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-570" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-571" style="vertical-align: -0.4em;">0</span></span></span></span><span class="MJXp-mo" id="MJXp-Span-572" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-573">n</span><span class="MJXp-mo" id="MJXp-Span-574" style="margin-left: 0.111em; margin-right: 0em;">!</span><span class="MJXp-mo" id="MJXp-Span-575" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-576" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-577" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-578">0</span></span></span><script type="math/tex" id="MathJax-Element-60">w_{p_0}(x, n) = \min(v_{p_0}(x!), v_{p_0}(n!)) = 0</script>.</p></div></div><p>Let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-579"><span class="MJXp-mrow" id="MJXp-Span-580"><span class="MJXp-mi" id="MJXp-Span-581">P</span><span class="MJXp-mi" id="MJXp-Span-582">r</span><span class="MJXp-mi" id="MJXp-Span-583">i</span><span class="MJXp-mi" id="MJXp-Span-584">m</span><span class="MJXp-mi" id="MJXp-Span-585">e</span><span class="MJXp-mi" id="MJXp-Span-586">G</span><span class="MJXp-mi" id="MJXp-Span-587">a</span><span class="MJXp-mi" id="MJXp-Span-588">p</span></span><span class="MJXp-mo" id="MJXp-Span-589" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-590">M</span><span class="MJXp-mo" id="MJXp-Span-591" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-61">\mathrm{PrimeGap}(M)</script> be the maximum difference between a number <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-592"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-593">x</span><span class="MJXp-mtext" id="MJXp-Span-594">&nbsp;</span><span class="MJXp-mo" id="MJXp-Span-595" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-596">2</span><span class="MJXp-mo" id="MJXp-Span-597" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-598">x</span><span class="MJXp-mo" id="MJXp-Span-599" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-600">M</span><span class="MJXp-mo" id="MJXp-Span-601" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-62">x\ (2\leq x\leq M)</script> and the largest prime number no larger than it. We only need to compute <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-602"><span class="MJXp-mrow" id="MJXp-Span-603"><span class="MJXp-mi" id="MJXp-Span-604">P</span><span class="MJXp-mi" id="MJXp-Span-605">r</span><span class="MJXp-mi" id="MJXp-Span-606">i</span><span class="MJXp-mi" id="MJXp-Span-607">m</span><span class="MJXp-mi" id="MJXp-Span-608">e</span><span class="MJXp-mi" id="MJXp-Span-609">G</span><span class="MJXp-mi" id="MJXp-Span-610">a</span><span class="MJXp-mi" id="MJXp-Span-611">p</span></span><span class="MJXp-mo" id="MJXp-Span-612" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-613">n</span><span class="MJXp-mo" id="MJXp-Span-614" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-615" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mrow" id="MJXp-Span-616"><span class="MJXp-mi" id="MJXp-Span-617">P</span><span class="MJXp-mi" id="MJXp-Span-618">r</span><span class="MJXp-mi" id="MJXp-Span-619">i</span><span class="MJXp-mi" id="MJXp-Span-620">m</span><span class="MJXp-mi" id="MJXp-Span-621">e</span><span class="MJXp-mi" id="MJXp-Span-622">G</span><span class="MJXp-mi" id="MJXp-Span-623">a</span><span class="MJXp-mi" id="MJXp-Span-624">p</span></span><span class="MJXp-mo" id="MJXp-Span-625" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-626"><span class="MJXp-mn" id="MJXp-Span-627" style="margin-right: 0.05em;">10</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-628" style="vertical-align: 0.5em;">7</span></span><span class="MJXp-mo" id="MJXp-Span-629" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-630" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-631">152</span></span></span><script type="math/tex" id="MathJax-Element-63">\mathrm{PrimeGap}(n) \le \mathrm{PrimeGap}(10^7) = 152</script> values of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-632"><span class="MJXp-msubsup" id="MJXp-Span-633"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-634" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-635" style="vertical-align: -0.4em;">m</span></span><span class="MJXp-mo" id="MJXp-Span-636" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-637">x</span><span class="MJXp-mo" id="MJXp-Span-638" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-639">n</span><span class="MJXp-mo" id="MJXp-Span-640" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-64">f_m(x, n)</script>. As this is reasonably small, we will now try to calculate the value of each <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-641"><span class="MJXp-msubsup" id="MJXp-Span-642"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-643" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-644" style="vertical-align: -0.4em;">m</span></span><span class="MJXp-mo" id="MJXp-Span-645" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-646">x</span><span class="MJXp-mo" id="MJXp-Span-647" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-648">n</span><span class="MJXp-mo" id="MJXp-Span-649" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-65">f_m(x, n)</script> for all possible <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-650"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-651">x</span><span class="MJXp-mo" id="MJXp-Span-652" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-msubsup" id="MJXp-Span-653"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-654" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-655" style="vertical-align: -0.4em;">0</span></span></span></span><script type="math/tex" id="MathJax-Element-66">x \ge p_0</script>.</p><p>First, we state a simple but useful lemma: for all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-656"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-657">k</span><span class="MJXp-mo" id="MJXp-Span-658" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mn" id="MJXp-Span-659">2</span></span></span><script type="math/tex" id="MathJax-Element-67">k\ge 2</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-660"><span class="MJXp-msubsup" id="MJXp-Span-661"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-662" style="margin-right: 0.05em;">v</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-663" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-mo" id="MJXp-Span-664" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-665">a</span><span class="MJXp-mo" id="MJXp-Span-666" style="margin-left: 0.111em; margin-right: 0em;">!</span><span class="MJXp-mo" id="MJXp-Span-667" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-668" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-msubsup" id="MJXp-Span-669"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-670" style="margin-right: 0.05em;">v</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-671" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-mo" id="MJXp-Span-672" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-673">b</span><span class="MJXp-mo" id="MJXp-Span-674" style="margin-left: 0.111em; margin-right: 0em;">!</span><span class="MJXp-mo" id="MJXp-Span-675" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-68">v_k(a!) \le v_k(b!)</script> if <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-676"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-677">a</span><span class="MJXp-mo" id="MJXp-Span-678" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-679">b</span></span></span><script type="math/tex" id="MathJax-Element-69">a\le b</script>.</p> <div class="spoiler"><b class="spoiler-title">Proof</b><div class="spoiler-content" style="display: block;"><p><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-680"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-681">a</span><span class="MJXp-mo" id="MJXp-Span-682" style="margin-left: 0.111em; margin-right: 0em;">!</span></span></span><script type="math/tex" id="MathJax-Element-70">a!</script> divides <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-683"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-684">b</span><span class="MJXp-mo" id="MJXp-Span-685" style="margin-left: 0.111em; margin-right: 0em;">!</span></span></span><script type="math/tex" id="MathJax-Element-71">b!</script> if <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-686"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-687">a</span><span class="MJXp-mo" id="MJXp-Span-688" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-689">b</span></span></span><script type="math/tex" id="MathJax-Element-72">a\le b</script>. Hence, if <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-690"><span class="MJXp-msubsup" id="MJXp-Span-691"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-692" style="margin-right: 0.05em;">k</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-693" style="vertical-align: 0.5em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-73">k^i</script> divides <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-694"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-695">a</span><span class="MJXp-mo" id="MJXp-Span-696" style="margin-left: 0.111em; margin-right: 0em;">!</span></span></span><script type="math/tex" id="MathJax-Element-74">a!</script>, it also divides <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-697"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-698">b</span><span class="MJXp-mo" id="MJXp-Span-699" style="margin-left: 0.111em; margin-right: 0em;">!</span></span></span><script type="math/tex" id="MathJax-Element-75">b!</script>.</p></div></div><p>To find out some more about <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-700"><span class="MJXp-msubsup" id="MJXp-Span-701"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-702" style="margin-right: 0.05em;">w</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-703" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-mo" id="MJXp-Span-704" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-705">a</span><span class="MJXp-mo" id="MJXp-Span-706" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-707">b</span><span class="MJXp-mo" id="MJXp-Span-708" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-76">w_k(a,b)</script>, let's factor <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-709"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-710">k</span></span></span><script type="math/tex" id="MathJax-Element-77">k</script> as <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-711"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-712">k</span><span class="MJXp-mo" id="MJXp-Span-713" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-714"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-715" style="margin-right: 0.05em;">p</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.59em;"><span class="MJXp-mrow" id="MJXp-Span-717"><span class="MJXp-msubsup" id="MJXp-Span-718"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-719" style="margin-right: 0.05em;">v</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-720" style="vertical-align: -0.4em;">1</span></span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mn" id="MJXp-Span-716">1</span></span></span></span></span></span><span class="MJXp-msubsup" id="MJXp-Span-721"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-722" style="margin-right: 0.05em;">p</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.59em;"><span class="MJXp-mrow" id="MJXp-Span-724"><span class="MJXp-msubsup" id="MJXp-Span-725"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-726" style="margin-right: 0.05em;">v</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-727" style="vertical-align: -0.4em;">2</span></span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mn" id="MJXp-Span-723">2</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-728" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-msubsup" id="MJXp-Span-729"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-730" style="margin-right: 0.05em;">p</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.59em;"><span class="MJXp-mrow" id="MJXp-Span-732"><span class="MJXp-msubsup" id="MJXp-Span-733"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-734" style="margin-right: 0.05em;">v</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-735" style="vertical-align: -0.4em;">t</span></span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-731">t</span></span></span></span></span></span></span></span><script type="math/tex" id="MathJax-Element-78">k=p_1^{v_1}p_2^{v_2}\ldots p_t^{v_t}</script> where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-736"><span class="MJXp-msubsup" id="MJXp-Span-737"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-738" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-739" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-740" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-741"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-742" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-743" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-744" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-745" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-746" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-747"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-748" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-749" style="vertical-align: -0.4em;">t</span></span></span></span><script type="math/tex" id="MathJax-Element-79">p_1,p_2,\ldots,p_t</script> are disctinct primes and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-750"><span class="MJXp-msubsup" id="MJXp-Span-751"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-752" style="margin-right: 0.05em;">v</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-753" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-754" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-755"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-756" style="margin-right: 0.05em;">v</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-757" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-758" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-759" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-760" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-761"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-762" style="margin-right: 0.05em;">v</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-763" style="vertical-align: -0.4em;">t</span></span></span></span><script type="math/tex" id="MathJax-Element-80">v_1,v_2,\ldots,v_t</script> are positive integers.</p><p>Then, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-764"><span class="MJXp-msubsup" id="MJXp-Span-765"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-766" style="margin-right: 0.05em;">w</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-767" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-mo" id="MJXp-Span-768" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-769">a</span><span class="MJXp-mo" id="MJXp-Span-770" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-771">b</span><span class="MJXp-mo" id="MJXp-Span-772" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-773" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-munderover" id="MJXp-Span-774"><span class=""><span class="MJXp-mo" id="MJXp-Span-775" style="margin-left: 0.333em; margin-right: 0.333em;">min</span></span><span class=" MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-776" style="margin-left: 0px;">i</span></span></span><span class="MJXp-msubsup" id="MJXp-Span-777"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-778" style="margin-right: 0.05em;">w</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-779" style="vertical-align: -0.4em;"><span class="MJXp-msubsup" id="MJXp-Span-780"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-781" style="margin-right: 0.05em;">p</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.59em;"><span class="MJXp-mrow" id="MJXp-Span-783"><span class="MJXp-msubsup" id="MJXp-Span-784"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-785" style="margin-right: 0.05em;">v</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-786" style="vertical-align: -0.4em;">i</span></span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-782">i</span></span></span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-787" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-788">a</span><span class="MJXp-mo" id="MJXp-Span-789" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-790">b</span><span class="MJXp-mo" id="MJXp-Span-791" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-81">w_k(a,b)\geq\min\limits_i w_{p_i^{v_i}}(a,b)</script>.</p> <div class="spoiler"><b class="spoiler-title">Proof</b><div class="spoiler-content" style="display: block;"><p>Without loss of generality, let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-792"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-793">a</span><span class="MJXp-mo" id="MJXp-Span-794" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-795">b</span></span></span><script type="math/tex" id="MathJax-Element-82">a\le b</script>. Consider the array <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-796"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-797">c</span><span class="MJXp-mo" id="MJXp-Span-798" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-799" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-msubsup" id="MJXp-Span-800"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-801" style="margin-right: 0.05em;">v</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-802" style="vertical-align: -0.4em;"><span class="MJXp-msubsup" id="MJXp-Span-803"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-804" style="margin-right: 0.05em;">p</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.59em;"><span class="MJXp-mrow" id="MJXp-Span-806"><span class="MJXp-msubsup" id="MJXp-Span-807"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-808" style="margin-right: 0.05em;">v</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-809" style="vertical-align: -0.4em;">1</span></span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mn" id="MJXp-Span-805">1</span></span></span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-810" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-811">a</span><span class="MJXp-mo" id="MJXp-Span-812" style="margin-left: 0.111em; margin-right: 0em;">!</span><span class="MJXp-mo" id="MJXp-Span-813" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-814" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-815"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-816" style="margin-right: 0.05em;">v</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-817" style="vertical-align: -0.4em;"><span class="MJXp-msubsup" id="MJXp-Span-818"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-819" style="margin-right: 0.05em;">p</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.59em;"><span class="MJXp-mrow" id="MJXp-Span-821"><span class="MJXp-msubsup" id="MJXp-Span-822"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-823" style="margin-right: 0.05em;">v</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-824" style="vertical-align: -0.4em;">2</span></span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mn" id="MJXp-Span-820">2</span></span></span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-825" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-826">a</span><span class="MJXp-mo" id="MJXp-Span-827" style="margin-left: 0.111em; margin-right: 0em;">!</span><span class="MJXp-mo" id="MJXp-Span-828" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-829" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-830" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-831" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-832"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-833" style="margin-right: 0.05em;">v</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-834" style="vertical-align: -0.4em;"><span class="MJXp-msubsup" id="MJXp-Span-835"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-836" style="margin-right: 0.05em;">p</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.59em;"><span class="MJXp-mrow" id="MJXp-Span-838"><span class="MJXp-msubsup" id="MJXp-Span-839"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-840" style="margin-right: 0.05em;">v</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-841" style="vertical-align: -0.4em;">t</span></span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-837">t</span></span></span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-842" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-843">a</span><span class="MJXp-mo" id="MJXp-Span-844" style="margin-left: 0.111em; margin-right: 0em;">!</span><span class="MJXp-mo" id="MJXp-Span-845" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-846" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-83">c=[v_{p_1^{v_1}}(a!),v_{p_2^{v_2}}(a!),\ldots,v_{p_t^{v_t}}(a!)]</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-847"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-848">d</span><span class="MJXp-mo" id="MJXp-Span-849" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-850" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-msubsup" id="MJXp-Span-851"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-852" style="margin-right: 0.05em;">v</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-853" style="vertical-align: -0.4em;"><span class="MJXp-msubsup" id="MJXp-Span-854"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-855" style="margin-right: 0.05em;">p</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.59em;"><span class="MJXp-mrow" id="MJXp-Span-857"><span class="MJXp-msubsup" id="MJXp-Span-858"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-859" style="margin-right: 0.05em;">v</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-860" style="vertical-align: -0.4em;">1</span></span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mn" id="MJXp-Span-856">1</span></span></span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-861" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-862">b</span><span class="MJXp-mo" id="MJXp-Span-863" style="margin-left: 0.111em; margin-right: 0em;">!</span><span class="MJXp-mo" id="MJXp-Span-864" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-865" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-866"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-867" style="margin-right: 0.05em;">v</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-868" style="vertical-align: -0.4em;"><span class="MJXp-msubsup" id="MJXp-Span-869"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-870" style="margin-right: 0.05em;">p</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.59em;"><span class="MJXp-mrow" id="MJXp-Span-872"><span class="MJXp-msubsup" id="MJXp-Span-873"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-874" style="margin-right: 0.05em;">v</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-875" style="vertical-align: -0.4em;">2</span></span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mn" id="MJXp-Span-871">2</span></span></span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-876" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-877">b</span><span class="MJXp-mo" id="MJXp-Span-878" style="margin-left: 0.111em; margin-right: 0em;">!</span><span class="MJXp-mo" id="MJXp-Span-879" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-880" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-881" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-882" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-883"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-884" style="margin-right: 0.05em;">v</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-885" style="vertical-align: -0.4em;"><span class="MJXp-msubsup" id="MJXp-Span-886"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-887" style="margin-right: 0.05em;">p</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.59em;"><span class="MJXp-mrow" id="MJXp-Span-889"><span class="MJXp-msubsup" id="MJXp-Span-890"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-891" style="margin-right: 0.05em;">v</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-892" style="vertical-align: -0.4em;">t</span></span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-888">t</span></span></span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-893" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-894">b</span><span class="MJXp-mo" id="MJXp-Span-895" style="margin-left: 0.111em; margin-right: 0em;">!</span><span class="MJXp-mo" id="MJXp-Span-896" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-897" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-84">d=[v_{p_1^{v_1}}(b!),v_{p_2^{v_2}}(b!),\ldots,v_{p_t^{v_t}}(b!)]</script>. Then <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-898"><span class="MJXp-msubsup" id="MJXp-Span-899"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-900" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-901" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-902" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-msubsup" id="MJXp-Span-903"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-904" style="margin-right: 0.05em;">d</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-905" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-85">c_i\leq d_i</script>, for all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-906"><span class="MJXp-mn" id="MJXp-Span-907">1</span><span class="MJXp-mo" id="MJXp-Span-908" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-909">i</span><span class="MJXp-mo" id="MJXp-Span-910" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-911">n</span></span></span><script type="math/tex" id="MathJax-Element-86">1\leq i\leq n</script>, since <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-912"><span class="MJXp-msubsup" id="MJXp-Span-913"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-914" style="margin-right: 0.05em;">v</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-915" style="vertical-align: -0.4em;"><span class="MJXp-msubsup" id="MJXp-Span-916"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-917" style="margin-right: 0.05em;">p</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.59em;"><span class="MJXp-mrow" id="MJXp-Span-919"><span class="MJXp-msubsup" id="MJXp-Span-920"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-921" style="margin-right: 0.05em;">v</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-922" style="vertical-align: -0.4em;">i</span></span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-918">i</span></span></span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-923" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-924">a</span><span class="MJXp-mo" id="MJXp-Span-925" style="margin-left: 0.111em; margin-right: 0em;">!</span><span class="MJXp-mo" id="MJXp-Span-926" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-927" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-msubsup" id="MJXp-Span-928"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-929" style="margin-right: 0.05em;">v</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-930" style="vertical-align: -0.4em;"><span class="MJXp-msubsup" id="MJXp-Span-931"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-932" style="margin-right: 0.05em;">p</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.59em;"><span class="MJXp-mrow" id="MJXp-Span-934"><span class="MJXp-msubsup" id="MJXp-Span-935"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-936" style="margin-right: 0.05em;">v</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-937" style="vertical-align: -0.4em;">i</span></span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-933">i</span></span></span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-938" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-939">b</span><span class="MJXp-mo" id="MJXp-Span-940" style="margin-left: 0.111em; margin-right: 0em;">!</span><span class="MJXp-mo" id="MJXp-Span-941" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-87">v_{p_i^{v_i}}(a!)\leq v_{p_i^{v_i}}(b!)</script> from the earlier lemma.</p><p>By definition, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-942"><span class="MJXp-msubsup" id="MJXp-Span-943"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-944" style="margin-right: 0.05em;">v</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-945" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-mo" id="MJXp-Span-946" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-947">a</span><span class="MJXp-mo" id="MJXp-Span-948" style="margin-left: 0.111em; margin-right: 0em;">!</span><span class="MJXp-mo" id="MJXp-Span-949" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-950" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-951" style="margin-left: 0.333em; margin-right: 0.333em;">min</span><span class="MJXp-mo" id="MJXp-Span-952" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-953">c</span><span class="MJXp-mo" id="MJXp-Span-954" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-88">v_k(a!) = \min(c)</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-955"><span class="MJXp-msubsup" id="MJXp-Span-956"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-957" style="margin-right: 0.05em;">v</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-958" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-mo" id="MJXp-Span-959" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-960">b</span><span class="MJXp-mo" id="MJXp-Span-961" style="margin-left: 0.111em; margin-right: 0em;">!</span><span class="MJXp-mo" id="MJXp-Span-962" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-963" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-964" style="margin-left: 0.333em; margin-right: 0.333em;">min</span><span class="MJXp-mo" id="MJXp-Span-965" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-966">d</span><span class="MJXp-mo" id="MJXp-Span-967" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-89">v_k(b!) = \min(d)</script>, and </p> <center><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-968"><span class="MJXp-msubsup" id="MJXp-Span-969"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-970" style="margin-right: 0.05em;">w</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-971" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-mo" id="MJXp-Span-972" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-973">a</span><span class="MJXp-mo" id="MJXp-Span-974" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-975">b</span><span class="MJXp-mo" id="MJXp-Span-976" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-977" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mrow" id="MJXp-Span-978"><span class="MJXp-mo" id="MJXp-Span-979" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.561em;"><span class="MJXp-right MJXp-scale4" style="font-size: 3.244em; margin-left: -0.278em;">{</span></span><span class="MJXp-mtable" id="MJXp-Span-980"><span><span class="MJXp-mtr" id="MJXp-Span-981" style="vertical-align: baseline;"><span class="MJXp-mtd" id="MJXp-Span-982" style="text-align: left;"><span class="MJXp-msubsup" id="MJXp-Span-983"><span class="MJXp-mn" id="MJXp-Span-984" style="margin-right: 0.05em;">10</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-985" style="vertical-align: 0.5em;"><span class="MJXp-mn" id="MJXp-Span-986">100</span></span></span></span><span class="MJXp-mtd" id="MJXp-Span-987" style="padding-left: 1em; text-align: left;"><span class="MJXp-mtext" id="MJXp-Span-988">if&nbsp;</span><span class="MJXp-mo" id="MJXp-Span-989" style="margin-left: 0.333em; margin-right: 0.333em;">min</span><span class="MJXp-mo" id="MJXp-Span-990" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-991">c</span><span class="MJXp-mo" id="MJXp-Span-992" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-993" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-994" style="margin-left: 0.333em; margin-right: 0.333em;">min</span><span class="MJXp-mo" id="MJXp-Span-995" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-996">d</span><span class="MJXp-mo" id="MJXp-Span-997" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MJXp-mtr" id="MJXp-Span-998" style="vertical-align: baseline;"><span class="MJXp-mtd" id="MJXp-Span-999" style="padding-top: 0.2em; text-align: left;"><span class="MJXp-mo" id="MJXp-Span-1000" style="margin-left: 0.333em; margin-right: 0.333em;">min</span><span class="MJXp-mo" id="MJXp-Span-1001" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1002">c</span><span class="MJXp-mo" id="MJXp-Span-1003" style="margin-left: 0em; margin-right: 0em;">)</span></span><span class="MJXp-mtd" id="MJXp-Span-1004" style="padding-left: 1em; padding-top: 0.2em; text-align: left;"><span class="MJXp-mtext" id="MJXp-Span-1005">otherwise</span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-1006" style="margin-left: 0em; margin-right: 0em;"></span></span></span></span><script type="math/tex" id="MathJax-Element-90">w_k(a, b) = \begin{cases}10^{100} & \text{if } \min(c) = \min(d)\\ \min(c) &\text{otherwise}\end{cases}</script></center><p>(the second case is due to the lemma <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1007"><span class="MJXp-msubsup" id="MJXp-Span-1008"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1009" style="margin-right: 0.05em;">v</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1010" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-mo" id="MJXp-Span-1011" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1012">a</span><span class="MJXp-mo" id="MJXp-Span-1013" style="margin-left: 0.111em; margin-right: 0em;">!</span><span class="MJXp-mo" id="MJXp-Span-1014" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1015" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-msubsup" id="MJXp-Span-1016"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1017" style="margin-right: 0.05em;">v</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1018" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-mo" id="MJXp-Span-1019" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1020">b</span><span class="MJXp-mo" id="MJXp-Span-1021" style="margin-left: 0.111em; margin-right: 0em;">!</span><span class="MJXp-mo" id="MJXp-Span-1022" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-91">v_k(a!)\le v_k(b!)</script>).</p> <ul>   <li>If <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1023"><span class="MJXp-msubsup" id="MJXp-Span-1024"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1025" style="margin-right: 0.05em;">v</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1026" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-mo" id="MJXp-Span-1027" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1028">a</span><span class="MJXp-mo" id="MJXp-Span-1029" style="margin-left: 0.111em; margin-right: 0em;">!</span><span class="MJXp-mo" id="MJXp-Span-1030" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1031" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-1032"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1033" style="margin-right: 0.05em;">v</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1034" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-mo" id="MJXp-Span-1035" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1036">b</span><span class="MJXp-mo" id="MJXp-Span-1037" style="margin-left: 0.111em; margin-right: 0em;">!</span><span class="MJXp-mo" id="MJXp-Span-1038" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-92">v_k(a!) = v_k(b!)</script>, then <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1039"><span class="MJXp-msubsup" id="MJXp-Span-1040"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1041" style="margin-right: 0.05em;">w</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1042" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-mo" id="MJXp-Span-1043" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1044">a</span><span class="MJXp-mo" id="MJXp-Span-1045" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1046">b</span><span class="MJXp-mo" id="MJXp-Span-1047" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1048" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-1049"><span class="MJXp-mn" id="MJXp-Span-1050" style="margin-right: 0.05em;">10</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1051" style="vertical-align: 0.5em;"><span class="MJXp-mn" id="MJXp-Span-1052">100</span></span></span></span></span><script type="math/tex" id="MathJax-Element-93">w_k(a,b)=10^{100}</script>. The inequality already holds.</li>   <li>Otherwise, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1053"><span class="MJXp-msubsup" id="MJXp-Span-1054"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1055" style="margin-right: 0.05em;">v</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1056" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-mo" id="MJXp-Span-1057" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1058">a</span><span class="MJXp-mo" id="MJXp-Span-1059" style="margin-left: 0.111em; margin-right: 0em;">!</span><span class="MJXp-mo" id="MJXp-Span-1060" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1061" style="margin-left: 0.333em; margin-right: 0.333em;">≠</span><span class="MJXp-msubsup" id="MJXp-Span-1062"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1063" style="margin-right: 0.05em;">v</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1064" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-mo" id="MJXp-Span-1065" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1066">b</span><span class="MJXp-mo" id="MJXp-Span-1067" style="margin-left: 0.111em; margin-right: 0em;">!</span><span class="MJXp-mo" id="MJXp-Span-1068" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-94">v_k(a!) \neq v_k(b!)</script>, i.e., <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1069"><span class="MJXp-mo" id="MJXp-Span-1070" style="margin-left: 0.333em; margin-right: 0.333em;">min</span><span class="MJXp-mo" id="MJXp-Span-1071" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1072">c</span><span class="MJXp-mo" id="MJXp-Span-1073" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1074" style="margin-left: 0.333em; margin-right: 0.333em;">≠</span><span class="MJXp-mo" id="MJXp-Span-1075" style="margin-left: 0.333em; margin-right: 0.333em;">min</span><span class="MJXp-mo" id="MJXp-Span-1076" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1077">d</span><span class="MJXp-mo" id="MJXp-Span-1078" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-95">\min(c)\neq\min(d)</script>. Since <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1079"><span class="MJXp-msubsup" id="MJXp-Span-1080"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1081" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1082" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1083" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-msubsup" id="MJXp-Span-1084"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1085" style="margin-right: 0.05em;">d</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1086" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-96">c_i\leq d_i</script> for all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1087"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1088">i</span></span></span><script type="math/tex" id="MathJax-Element-97">i</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1089"><span class="MJXp-mo" id="MJXp-Span-1090" style="margin-left: 0.333em; margin-right: 0.333em;">min</span><span class="MJXp-mo" id="MJXp-Span-1091" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1092">c</span><span class="MJXp-mo" id="MJXp-Span-1093" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1094" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mo" id="MJXp-Span-1095" style="margin-left: 0.333em; margin-right: 0.333em;">min</span><span class="MJXp-mo" id="MJXp-Span-1096" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1097">d</span><span class="MJXp-mo" id="MJXp-Span-1098" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-98">\min(c) < \min(d)</script>. Let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1099"><span class="MJXp-msup" id="MJXp-Span-1100"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1101" style="margin-right: 0.05em;">i</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1102" style="vertical-align: 0.5em;">′</span></span></span></span><script type="math/tex" id="MathJax-Element-99">i'</script> be the index such that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1103"><span class="MJXp-msubsup" id="MJXp-Span-1104"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1105" style="margin-right: 0.05em;">c</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mo" id="MJXp-Span-1107">′</span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1106">i</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-1108" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-1109" style="margin-left: 0.333em; margin-right: 0.333em;">min</span><span class="MJXp-mo" id="MJXp-Span-1110" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1111">c</span><span class="MJXp-mo" id="MJXp-Span-1112" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-100">c_i' = \min(c)</script>. Then, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1113"><span class="MJXp-msubsup" id="MJXp-Span-1114"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1115" style="margin-right: 0.05em;">c</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1116" style="vertical-align: -0.4em;"><span class="MJXp-msup" id="MJXp-Span-1117"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1118" style="margin-right: 0.05em;">i</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1119" style="vertical-align: 0.5em;">′</span></span></span></span><span class="MJXp-mo" id="MJXp-Span-1120" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-1121" style="margin-left: 0.333em; margin-right: 0.333em;">min</span><span class="MJXp-mo" id="MJXp-Span-1122" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1123">c</span><span class="MJXp-mo" id="MJXp-Span-1124" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1125" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mo" id="MJXp-Span-1126" style="margin-left: 0.333em; margin-right: 0.333em;">min</span><span class="MJXp-mo" id="MJXp-Span-1127" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1128">d</span><span class="MJXp-mo" id="MJXp-Span-1129" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1130" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-msubsup" id="MJXp-Span-1131"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1132" style="margin-right: 0.05em;">d</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1133" style="vertical-align: -0.4em;"><span class="MJXp-msup" id="MJXp-Span-1134"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1135" style="margin-right: 0.05em;">i</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1136" style="vertical-align: 0.5em;">′</span></span></span></span></span></span><script type="math/tex" id="MathJax-Element-101">c_{i'} = \min(c) < \min(d) \le d_{i'}</script>. Hence, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1137"><span class="MJXp-msubsup" id="MJXp-Span-1138"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1139" style="margin-right: 0.05em;">w</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1140" style="vertical-align: -0.4em;"><span class="MJXp-msubsup" id="MJXp-Span-1141"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1142" style="margin-right: 0.05em;">p</span><span class="MJXp-script-box" style="height: 2.116em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.59em;"><span class="MJXp-mrow" id="MJXp-Span-1147"><span class="MJXp-msubsup" id="MJXp-Span-1148"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1149" style="margin-right: 0.05em;">v</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mo" id="MJXp-Span-1151">′</span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1150">i</span></span></span></span></span></span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -1.17em;"><span class="MJXp-mrow" id="MJXp-Span-1143"><span class="MJXp-msup" id="MJXp-Span-1144"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1145" style="margin-right: 0.05em;">i</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1146" style="vertical-align: 0.5em;">′</span></span></span></span></span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-1152" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1153">a</span><span class="MJXp-mo" id="MJXp-Span-1154" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1155">b</span><span class="MJXp-mo" id="MJXp-Span-1156" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1157" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-1158"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1159" style="margin-right: 0.05em;">c</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1160" style="vertical-align: -0.4em;"><span class="MJXp-msup" id="MJXp-Span-1161"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1162" style="margin-right: 0.05em;">i</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1163" style="vertical-align: 0.5em;">′</span></span></span></span><span class="MJXp-mo" id="MJXp-Span-1164" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-1165"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1166" style="margin-right: 0.05em;">w</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1167" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-mo" id="MJXp-Span-1168" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1169">a</span><span class="MJXp-mo" id="MJXp-Span-1170" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1171">b</span><span class="MJXp-mo" id="MJXp-Span-1172" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-102">w_{p_{i'}^{v_i'}}(a, b) = c_{i'} = w_k(a, b)</script>.</li> </ul></div></div><p>Since <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1173"><span class="MJXp-msubsup" id="MJXp-Span-1174"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1175" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1176" style="vertical-align: -0.4em;">m</span></span><span class="MJXp-mo" id="MJXp-Span-1177" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1178">a</span><span class="MJXp-mo" id="MJXp-Span-1179" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1180">b</span><span class="MJXp-mo" id="MJXp-Span-1181" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-103">f_m(a, b)</script> considers the minimum of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1182"><span class="MJXp-msubsup" id="MJXp-Span-1183"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1184" style="margin-right: 0.05em;">w</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1185" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-mo" id="MJXp-Span-1186" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1187">a</span><span class="MJXp-mo" id="MJXp-Span-1188" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1189">b</span><span class="MJXp-mo" id="MJXp-Span-1190" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-104">w_k(a, b)</script> over all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1191"><span class="MJXp-mn" id="MJXp-Span-1192">2</span><span class="MJXp-mo" id="MJXp-Span-1193" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1194">k</span><span class="MJXp-mo" id="MJXp-Span-1195" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1196">m</span></span></span><script type="math/tex" id="MathJax-Element-105">2\le k\le m</script>, we only need to consider <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1197"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1198">k</span></span></span><script type="math/tex" id="MathJax-Element-106">k</script> that are primes, or powers of primes. Formally, we only need to consider integers of the form <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1199"><span class="MJXp-msubsup" id="MJXp-Span-1200"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1201" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1202" style="vertical-align: 0.5em;">v</span></span></span></span><script type="math/tex" id="MathJax-Element-107">p^v</script> where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1203"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1204">p</span></span></span><script type="math/tex" id="MathJax-Element-108">p</script> is a prime number and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1205"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1206">v</span></span></span><script type="math/tex" id="MathJax-Element-109">v</script> is a positive integer.</p><p>Furthermore, we only need to consider numbers of the form <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1207"><span class="MJXp-msubsup" id="MJXp-Span-1208"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1209" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1210" style="vertical-align: 0.5em;">v</span></span></span></span><script type="math/tex" id="MathJax-Element-110">p^v</script> where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1211"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1212">p</span></span></span><script type="math/tex" id="MathJax-Element-111">p</script> is a prime number and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1213"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1214">p</span></span></span><script type="math/tex" id="MathJax-Element-112">p</script> divides at least one of the numbers in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1215"><span class="MJXp-mo" id="MJXp-Span-1216" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-msubsup" id="MJXp-Span-1217"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1218" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1219" style="vertical-align: -0.4em;">0</span></span><span class="MJXp-mo" id="MJXp-Span-1220" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1221">n</span><span class="MJXp-mo" id="MJXp-Span-1222" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-113">[p_0, n]</script>.</p> <div class="spoiler"><b class="spoiler-title">Proof</b><div class="spoiler-content" style="display: block;"><p>For each <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1223"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1224">x</span></span></span><script type="math/tex" id="MathJax-Element-114">x</script> in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1225"><span class="MJXp-mo" id="MJXp-Span-1226" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-msubsup" id="MJXp-Span-1227"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1228" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1229" style="vertical-align: -0.4em;">0</span></span><span class="MJXp-mo" id="MJXp-Span-1230" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1231">n</span><span class="MJXp-mo" id="MJXp-Span-1232" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-115">[p_0,n]</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1233"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1234">x</span><span class="MJXp-mo" id="MJXp-Span-1235" style="margin-left: 0.111em; margin-right: 0em;">!</span><span class="MJXp-mo" id="MJXp-Span-1236" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-1237" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1238"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1239" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1240" style="vertical-align: -0.4em;">0</span></span><span class="MJXp-mo" id="MJXp-Span-1241" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-1242">1</span><span class="MJXp-mo" id="MJXp-Span-1243" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1244" style="margin-left: 0.111em; margin-right: 0em;">!</span><span class="MJXp-msubsup" id="MJXp-Span-1245"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1246" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1247" style="vertical-align: -0.4em;">0</span></span><span class="MJXp-mo" id="MJXp-Span-1248" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1249"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1250" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1251" style="vertical-align: -0.4em;">0</span></span><span class="MJXp-mo" id="MJXp-Span-1252" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-1253">1</span><span class="MJXp-mo" id="MJXp-Span-1254" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1255" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1256">x</span></span></span><script type="math/tex" id="MathJax-Element-116">x!=(p_0-1)!p_0(p_0+1)\ldots x</script>, which means <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1257"><span class="MJXp-msubsup" id="MJXp-Span-1258"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1259" style="margin-right: 0.05em;">v</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1260" style="vertical-align: -0.4em;">p</span></span><span class="MJXp-mo" id="MJXp-Span-1261" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1262">x</span><span class="MJXp-mo" id="MJXp-Span-1263" style="margin-left: 0.111em; margin-right: 0em;">!</span><span class="MJXp-mo" id="MJXp-Span-1264" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1265" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-1266"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1267" style="margin-right: 0.05em;">v</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1268" style="vertical-align: -0.4em;">p</span></span><span class="MJXp-mo" id="MJXp-Span-1269" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mo" id="MJXp-Span-1270" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1271"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1272" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1273" style="vertical-align: -0.4em;">0</span></span><span class="MJXp-mo" id="MJXp-Span-1274" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-1275">1</span><span class="MJXp-mo" id="MJXp-Span-1276" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1277" style="margin-left: 0.111em; margin-right: 0em;">!</span><span class="MJXp-mo" id="MJXp-Span-1278" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-117">v_p(x!)=v_p((p_0-1)!)</script>. So it always holds that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1279"><span class="MJXp-msubsup" id="MJXp-Span-1280"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1281" style="margin-right: 0.05em;">v</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1282" style="vertical-align: -0.4em;">p</span></span><span class="MJXp-mo" id="MJXp-Span-1283" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1284">x</span><span class="MJXp-mo" id="MJXp-Span-1285" style="margin-left: 0.111em; margin-right: 0em;">!</span><span class="MJXp-mo" id="MJXp-Span-1286" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1287" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-1288"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1289" style="margin-right: 0.05em;">v</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1290" style="vertical-align: -0.4em;">p</span></span><span class="MJXp-mo" id="MJXp-Span-1291" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1292">n</span><span class="MJXp-mo" id="MJXp-Span-1293" style="margin-left: 0.111em; margin-right: 0em;">!</span><span class="MJXp-mo" id="MJXp-Span-1294" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-118">v_p(x!)=v_p(n!)</script>, which also implies that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1295"><span class="MJXp-msubsup" id="MJXp-Span-1296"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1297" style="margin-right: 0.05em;">v</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1298" style="vertical-align: -0.4em;"><span class="MJXp-msubsup" id="MJXp-Span-1299"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1300" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1301" style="vertical-align: 0.5em;">k</span></span></span></span><span class="MJXp-mo" id="MJXp-Span-1302" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1303">x</span><span class="MJXp-mo" id="MJXp-Span-1304" style="margin-left: 0.111em; margin-right: 0em;">!</span><span class="MJXp-mo" id="MJXp-Span-1305" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1306" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-1307"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1308" style="margin-right: 0.05em;">v</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1309" style="vertical-align: -0.4em;"><span class="MJXp-msubsup" id="MJXp-Span-1310"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1311" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1312" style="vertical-align: 0.5em;">k</span></span></span></span><span class="MJXp-mo" id="MJXp-Span-1313" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1314">n</span><span class="MJXp-mo" id="MJXp-Span-1315" style="margin-left: 0.111em; margin-right: 0em;">!</span><span class="MJXp-mo" id="MJXp-Span-1316" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-119">v_{p^k}(x!)=v_{p^k}(n!)</script>.</p></div></div><p>There are <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1317"><span class="MJXp-mrow" id="MJXp-Span-1318"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-1319">O</span></span><span class="MJXp-mo" id="MJXp-Span-1320" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mrow" id="MJXp-Span-1321"><span class="MJXp-mi" id="MJXp-Span-1322">P</span><span class="MJXp-mi" id="MJXp-Span-1323">r</span><span class="MJXp-mi" id="MJXp-Span-1324">i</span><span class="MJXp-mi" id="MJXp-Span-1325">m</span><span class="MJXp-mi" id="MJXp-Span-1326">e</span><span class="MJXp-mi" id="MJXp-Span-1327">G</span><span class="MJXp-mi" id="MJXp-Span-1328">a</span><span class="MJXp-mi" id="MJXp-Span-1329">p</span></span><span class="MJXp-mo" id="MJXp-Span-1330" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1331">n</span><span class="MJXp-mo" id="MJXp-Span-1332" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-msubsup" id="MJXp-Span-1333"><span class="MJXp-mi" id="MJXp-Span-1334" style="margin-right: 0.05em;">log</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1335" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1336" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1337">n</span><span class="MJXp-mo" id="MJXp-Span-1338" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-120">\mathcal{O}(\mathrm{PrimeGap}(n)\log_2 n)</script> primes <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1339"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1340">p</span></span></span><script type="math/tex" id="MathJax-Element-121">p</script> that divide at least one of the numbers in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1341"><span class="MJXp-mo" id="MJXp-Span-1342" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-msubsup" id="MJXp-Span-1343"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1344" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1345" style="vertical-align: -0.4em;">0</span></span><span class="MJXp-mo" id="MJXp-Span-1346" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1347">n</span><span class="MJXp-mo" id="MJXp-Span-1348" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-122">[p_0, n]</script>. We can calculate the value of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1349"><span class="MJXp-msubsup" id="MJXp-Span-1350"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1351" style="margin-right: 0.05em;">v</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1352" style="vertical-align: -0.4em;">p</span></span><span class="MJXp-mo" id="MJXp-Span-1353" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1354">x</span><span class="MJXp-mo" id="MJXp-Span-1355" style="margin-left: 0.111em; margin-right: 0em;">!</span><span class="MJXp-mo" id="MJXp-Span-1356" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-123">v_p(x!)</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1357"><span class="MJXp-msubsup" id="MJXp-Span-1358"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1359" style="margin-right: 0.05em;">v</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1360" style="vertical-align: -0.4em;">p</span></span><span class="MJXp-mo" id="MJXp-Span-1361" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1362">n</span><span class="MJXp-mo" id="MJXp-Span-1363" style="margin-left: 0.111em; margin-right: 0em;">!</span><span class="MJXp-mo" id="MJXp-Span-1364" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-124">v_p(n!)</script> in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1365"><span class="MJXp-mrow" id="MJXp-Span-1366"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-1367">O</span></span><span class="MJXp-mo" id="MJXp-Span-1368" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1369"><span class="MJXp-mi" id="MJXp-Span-1370" style="margin-right: 0.05em;">log</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1371" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1372" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1373">n</span><span class="MJXp-mo" id="MJXp-Span-1374" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-125">\mathcal{O}(\log_2 n)</script> using the given formula. For each prime <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1375"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1376">p</span></span></span><script type="math/tex" id="MathJax-Element-126">p</script>, there are at most <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1377"><span class="MJXp-mrow" id="MJXp-Span-1378"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-1379">O</span></span><span class="MJXp-mo" id="MJXp-Span-1380" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1381"><span class="MJXp-mi" id="MJXp-Span-1382" style="margin-right: 0.05em;">log</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1383" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1384" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1385">m</span><span class="MJXp-mo" id="MJXp-Span-1386" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-127">\mathcal{O}(\log_2 m)</script> prime powers <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1387"><span class="MJXp-msubsup" id="MJXp-Span-1388"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1389" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1390" style="vertical-align: 0.5em;">v</span></span><span class="MJXp-mo" id="MJXp-Span-1391" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1392">m</span></span></span><script type="math/tex" id="MathJax-Element-128">p^v \le m</script>, and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1393"><span class="MJXp-msubsup" id="MJXp-Span-1394"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1395" style="margin-right: 0.05em;">v</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1396" style="vertical-align: -0.4em;"><span class="MJXp-msubsup" id="MJXp-Span-1397"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1398" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1399" style="vertical-align: 0.5em;">k</span></span></span></span><span class="MJXp-mo" id="MJXp-Span-1400" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1401">x</span><span class="MJXp-mo" id="MJXp-Span-1402" style="margin-left: 0.111em; margin-right: 0em;">!</span><span class="MJXp-mo" id="MJXp-Span-1403" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-129">v_{p^k}(x!)</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1404"><span class="MJXp-msubsup" id="MJXp-Span-1405"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1406" style="margin-right: 0.05em;">v</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1407" style="vertical-align: -0.4em;"><span class="MJXp-msubsup" id="MJXp-Span-1408"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1409" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1410" style="vertical-align: 0.5em;">k</span></span></span></span><span class="MJXp-mo" id="MJXp-Span-1411" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1412">n</span><span class="MJXp-mo" id="MJXp-Span-1413" style="margin-left: 0.111em; margin-right: 0em;">!</span><span class="MJXp-mo" id="MJXp-Span-1414" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-130">v_{p^k}(n!)</script> can both be calculated in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1415"><span class="MJXp-mrow" id="MJXp-Span-1416"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-1417">O</span></span><span class="MJXp-mo" id="MJXp-Span-1418" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-1419">1</span><span class="MJXp-mo" id="MJXp-Span-1420" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-131">\mathcal{O}(1)</script> time after computing <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1421"><span class="MJXp-msubsup" id="MJXp-Span-1422"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1423" style="margin-right: 0.05em;">v</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1424" style="vertical-align: -0.4em;">p</span></span><span class="MJXp-mo" id="MJXp-Span-1425" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1426">x</span><span class="MJXp-mo" id="MJXp-Span-1427" style="margin-left: 0.111em; margin-right: 0em;">!</span><span class="MJXp-mo" id="MJXp-Span-1428" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-132">v_p(x!)</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1429"><span class="MJXp-msubsup" id="MJXp-Span-1430"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1431" style="margin-right: 0.05em;">v</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1432" style="vertical-align: -0.4em;">p</span></span><span class="MJXp-mo" id="MJXp-Span-1433" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1434">n</span><span class="MJXp-mo" id="MJXp-Span-1435" style="margin-left: 0.111em; margin-right: 0em;">!</span><span class="MJXp-mo" id="MJXp-Span-1436" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-133">v_p(n!)</script> in the previous step. Hence, a single <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1437"><span class="MJXp-msubsup" id="MJXp-Span-1438"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1439" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1440" style="vertical-align: -0.4em;">m</span></span><span class="MJXp-mo" id="MJXp-Span-1441" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1442">x</span><span class="MJXp-mo" id="MJXp-Span-1443" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1444">n</span><span class="MJXp-mo" id="MJXp-Span-1445" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-134">f_m(x, n)</script> can be computed in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1446"><span class="MJXp-mrow" id="MJXp-Span-1447"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-1448">O</span></span><span class="MJXp-mo" id="MJXp-Span-1449" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mrow" id="MJXp-Span-1450"><span class="MJXp-mi" id="MJXp-Span-1451">P</span><span class="MJXp-mi" id="MJXp-Span-1452">r</span><span class="MJXp-mi" id="MJXp-Span-1453">i</span><span class="MJXp-mi" id="MJXp-Span-1454">m</span><span class="MJXp-mi" id="MJXp-Span-1455">e</span><span class="MJXp-mi" id="MJXp-Span-1456">G</span><span class="MJXp-mi" id="MJXp-Span-1457">a</span><span class="MJXp-mi" id="MJXp-Span-1458">p</span></span><span class="MJXp-mo" id="MJXp-Span-1459" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1460">n</span><span class="MJXp-mo" id="MJXp-Span-1461" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-msubsup" id="MJXp-Span-1462"><span class="MJXp-mi" id="MJXp-Span-1463" style="margin-right: 0.05em;">log</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1464" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1465" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1466">n</span><span class="MJXp-mo" id="MJXp-Span-1467" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1468"><span class="MJXp-mi" id="MJXp-Span-1469" style="margin-right: 0.05em;">log</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1470" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1471" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1472">n</span><span class="MJXp-mo" id="MJXp-Span-1473" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-1474"><span class="MJXp-mi" id="MJXp-Span-1475" style="margin-right: 0.05em;">log</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1476" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1477" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1478">m</span><span class="MJXp-mo" id="MJXp-Span-1479" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1480" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-135">\mathcal{O}(\mathrm{PrimeGap}(n)\log_2 n(\log_2 n + \log_2 m))</script> time.</p><p>The total time complexity if <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1481"><span class="MJXp-mrow" id="MJXp-Span-1482"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-1483">O</span></span><span class="MJXp-mo" id="MJXp-Span-1484" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1485">t</span><span class="MJXp-mo" id="MJXp-Span-1486" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mrow" id="MJXp-Span-1487"><span class="MJXp-mi" id="MJXp-Span-1488">P</span><span class="MJXp-mi" id="MJXp-Span-1489">r</span><span class="MJXp-mi" id="MJXp-Span-1490">i</span><span class="MJXp-mi" id="MJXp-Span-1491">m</span><span class="MJXp-mi" id="MJXp-Span-1492">e</span><span class="MJXp-mi" id="MJXp-Span-1493">G</span><span class="MJXp-mi" id="MJXp-Span-1494">a</span><span class="MJXp-mi" id="MJXp-Span-1495">p</span></span><span class="MJXp-mo" id="MJXp-Span-1496" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1497">n</span><span class="MJXp-msubsup" id="MJXp-Span-1498"><span class="MJXp-mo" id="MJXp-Span-1499" style="margin-left: 0em; margin-right: 0.05em;">)</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1500" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-msubsup" id="MJXp-Span-1501"><span class="MJXp-mi" id="MJXp-Span-1502" style="margin-right: 0.05em;">log</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1503" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1504" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1505">n</span><span class="MJXp-mo" id="MJXp-Span-1506" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1507"><span class="MJXp-mi" id="MJXp-Span-1508" style="margin-right: 0.05em;">log</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1509" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1510" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1511">n</span><span class="MJXp-mo" id="MJXp-Span-1512" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-1513"><span class="MJXp-mi" id="MJXp-Span-1514" style="margin-right: 0.05em;">log</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1515" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1516" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1517">m</span><span class="MJXp-mo" id="MJXp-Span-1518" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1519" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-136">\mathcal{O}(t\cdot \mathrm{PrimeGap}(n)^2\log_2 n(\log_2 n + \log_2 m))</script>. Even though this seems very big, the constant is very small, so it passess comfortably.</p></div></div> <div class="spoiler"><b class="spoiler-title">Code (C++, maomao90)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">using</span><span class="pln"> ll </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> MAXN </span><span class="pun">=</span><span class="pln"> </span><span class="lit">10000005</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> INF </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1000000005</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">bool</span><span class="pln"> is_prime</span><span class="pun">[</span><span class="pln">MAXN</span><span class="pun">];</span><span class="pln">
 
</span><span class="kwd">inline</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> calc_v</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> p</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> x</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> res </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    ll pw_p </span><span class="pun">=</span><span class="pln"> p</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">pw_p </span><span class="pun">&lt;=</span><span class="pln"> x</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        res </span><span class="pun">+=</span><span class="pln"> x </span><span class="pun">/</span><span class="pln"> pw_p</span><span class="pun">;</span><span class="pln">
        pw_p </span><span class="pun">*=</span><span class="pln"> p</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> res</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> m</span><span class="pun">;</span><span class="pln">
vector</span><span class="str">&lt;int&gt;</span><span class="pln"> small_primes</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
</span><span class="com">#ifndef</span><span class="pln"> DEBUG
    ios</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="lit">0</span><span class="pun">),</span><span class="pln"> cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
</span><span class="com">#endif</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> MAXN</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        is_prime</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln"> </span><span class="pun">(</span><span class="pln">ll</span><span class="pun">)</span><span class="pln">p </span><span class="pun">*</span><span class="pln"> p </span><span class="pun">&lt;</span><span class="pln"> MAXN</span><span class="pun">;</span><span class="pln"> p</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">is_prime</span><span class="pun">[</span><span class="pln">p</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">continue</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        small_primes</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">p</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> p </span><span class="pun">*</span><span class="pln"> p</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> MAXN</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">+=</span><span class="pln"> p</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            is_prime</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
 
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">t</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n </span><span class="pun">&gt;&gt;</span><span class="pln"> m</span><span class="pun">;</span><span class="pln">
 
        </span><span class="com">// find largest prime q &lt;= n. Requires at most 142 iterations (due to</span><span class="pln">
        </span><span class="com">// prime gap)</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> q </span><span class="pun">=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">is_prime</span><span class="pun">[</span><span class="pln">q</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            q</span><span class="pun">--;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
 
        </span><span class="com">// precompute the useful big primes</span><span class="pln">
        vector</span><span class="str">&lt;int&gt;</span><span class="pln"> useful_p</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> f </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> </span><span class="pun">(</span><span class="pln">ll</span><span class="pun">)</span><span class="pln">f </span><span class="pun">*</span><span class="pln"> f </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> f</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="com">// p_bnd is the largest possible value such that floor(n / p_bnd) =</span><span class="pln">
            </span><span class="com">// f n / p_bnd &gt;= f p_bnd &lt;= n / f</span><span class="pln">
            </span><span class="kwd">int</span><span class="pln"> p_bnd </span><span class="pun">=</span><span class="pln"> n </span><span class="pun">/</span><span class="pln"> f</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">int</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> p_bnd</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">is_prime</span><span class="pun">[</span><span class="pln">p</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                p</span><span class="pun">--;</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
            useful_p</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">p</span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
 
        ll ans </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
        </span><span class="com">// for all x &lt; q, f_m(x, n) = 0. try all x &gt;= q</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x </span><span class="pun">=</span><span class="pln"> q</span><span class="pun">;</span><span class="pln"> x </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> x</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">int</span><span class="pln"> res </span><span class="pun">=</span><span class="pln"> INF</span><span class="pun">;</span><span class="pln">
 
            </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> p </span><span class="pun">:</span><span class="pln"> useful_p</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="kwd">int</span><span class="pln"> vx </span><span class="pun">=</span><span class="pln"> calc_v</span><span class="pun">(</span><span class="pln">p</span><span class="pun">,</span><span class="pln"> x</span><span class="pun">),</span><span class="pln"> vn </span><span class="pun">=</span><span class="pln"> calc_v</span><span class="pun">(</span><span class="pln">p</span><span class="pun">,</span><span class="pln"> n</span><span class="pun">);</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">vx </span><span class="pun">!=</span><span class="pln"> vn</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    res </span><span class="pun">=</span><span class="pln"> min</span><span class="pun">(</span><span class="pln">res</span><span class="pun">,</span><span class="pln"> vx</span><span class="pun">);</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
 
            </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> p </span><span class="pun">:</span><span class="pln"> small_primes</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">((</span><span class="pln">ll</span><span class="pun">)</span><span class="pln">p </span><span class="pun">*</span><span class="pln"> p </span><span class="pun">&gt;</span><span class="pln"> m</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">
 
                </span><span class="kwd">int</span><span class="pln"> base_vx </span><span class="pun">=</span><span class="pln"> calc_v</span><span class="pun">(</span><span class="pln">p</span><span class="pun">,</span><span class="pln"> x</span><span class="pun">),</span><span class="pln"> base_vn </span><span class="pun">=</span><span class="pln"> calc_v</span><span class="pun">(</span><span class="pln">p</span><span class="pun">,</span><span class="pln"> n</span><span class="pun">);</span><span class="pln">
                </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">ll exp </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> pw_p </span><span class="pun">=</span><span class="pln"> p</span><span class="pun">;</span><span class="pln"> pw_p </span><span class="pun">&lt;=</span><span class="pln"> m</span><span class="pun">;</span><span class="pln"> exp</span><span class="pun">++,</span><span class="pln"> pw_p </span><span class="pun">*=</span><span class="pln"> p</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    </span><span class="kwd">int</span><span class="pln"> vx </span><span class="pun">=</span><span class="pln"> base_vx </span><span class="pun">/</span><span class="pln"> exp</span><span class="pun">,</span><span class="pln"> vn </span><span class="pun">=</span><span class="pln"> base_vn </span><span class="pun">/</span><span class="pln"> exp</span><span class="pun">;</span><span class="pln">
                    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">vx </span><span class="pun">!=</span><span class="pln"> vn</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                        res </span><span class="pun">=</span><span class="pln"> min</span><span class="pun">(</span><span class="pln">res</span><span class="pun">,</span><span class="pln"> vx</span><span class="pun">);</span><span class="pln">
                    </span><span class="pun">}</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
 
            ans </span><span class="pun">+=</span><span class="pln"> res</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
 
        cout </span><span class="pun">&lt;&lt;</span><span class="pln"> ans </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span></code></pre></div></div> <div class="spoiler"><b class="spoiler-title">Code (Pypy3.10, Little_Sheep_Yawn)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="kwd">import</span><span class="pln"> sys
input </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">lambda</span><span class="pun">:</span><span class="pln"> sys</span><span class="pun">.</span><span class="pln">stdin</span><span class="pun">.</span><span class="pln">readline</span><span class="pun">().</span><span class="pln">strip</span><span class="pun">()</span><span class="pln">

M </span><span class="pun">=</span><span class="pln"> </span><span class="lit">10</span><span class="pln"> </span><span class="pun">**</span><span class="pln"> </span><span class="lit">7</span><span class="pln">
pr </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">(</span><span class="pln">M </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">
 
</span><span class="kwd">for</span><span class="pln"> i </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> M </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">):</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> pr</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pun">:</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> j </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="pln">i</span><span class="pun">,</span><span class="pln"> M </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> i</span><span class="pun">):</span><span class="pln">
            pr</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> i

t </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">(</span><span class="pln">input</span><span class="pun">())</span><span class="pln">
outs </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[]</span><span class="pln">

fmin </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">lambda</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> y</span><span class="pun">:</span><span class="pln"> x </span><span class="kwd">if</span><span class="pln"> x </span><span class="pun">&lt;</span><span class="pln"> y </span><span class="kwd">else</span><span class="pln"> y
 
inf </span><span class="pun">=</span><span class="pln"> </span><span class="lit">10</span><span class="pln"> </span><span class="pun">**</span><span class="pln"> </span><span class="lit">9</span><span class="pln">
 
</span><span class="kwd">for</span><span class="pln"> _ </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="pln">t</span><span class="pun">):</span><span class="pln">
    n</span><span class="pun">,</span><span class="pln"> m </span><span class="pun">=</span><span class="pln"> map</span><span class="pun">(</span><span class="kwd">int</span><span class="pun">(</span><span class="pln">input</span><span class="pun">().</span><span class="pln">split</span><span class="pun">()))</span><span class="pln">
    
    vis </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">set</span><span class="pun">()</span><span class="pln">
    
    </span><span class="kwd">for</span><span class="pln"> i </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="pln">n</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">):</span><span class="pln">
        x </span><span class="pun">=</span><span class="pln"> i
        </span><span class="kwd">while</span><span class="pln"> x </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">:</span><span class="pln">
            vis</span><span class="pun">.</span><span class="kwd">add</span><span class="pun">(</span><span class="pln">pr</span><span class="pun">[</span><span class="pln">x</span><span class="pun">])</span><span class="pln">
            x </span><span class="com">//= pr[x]</span><span class="pln">
        
        </span><span class="kwd">if</span><span class="pln"> pr</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> i</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">break</span><span class="pln">
    
    ans </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
    
    </span><span class="kwd">def</span><span class="pln"> f</span><span class="pun">(</span><span class="pln">val</span><span class="pun">,</span><span class="pln"> p</span><span class="pun">):</span><span class="pln">
        c </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
        </span><span class="kwd">while</span><span class="pln"> val</span><span class="pun">:</span><span class="pln">
            val </span><span class="com">//= p</span><span class="pln">
            c </span><span class="pun">+=</span><span class="pln"> val
        </span><span class="kwd">return</span><span class="pln"> c
    
    </span><span class="kwd">for</span><span class="pln"> i </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="pln">n </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">):</span><span class="pln">
        res </span><span class="pun">=</span><span class="pln"> inf
        
        </span><span class="kwd">for</span><span class="pln"> v </span><span class="kwd">in</span><span class="pln"> vis</span><span class="pun">:</span><span class="pln">
            cur </span><span class="pun">=</span><span class="pln"> v
            c </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
            
            v1 </span><span class="pun">=</span><span class="pln"> f</span><span class="pun">(</span><span class="pln">i</span><span class="pun">,</span><span class="pln"> v</span><span class="pun">)</span><span class="pln">
            v2 </span><span class="pun">=</span><span class="pln"> f</span><span class="pun">(</span><span class="pln">n</span><span class="pun">,</span><span class="pln"> v</span><span class="pun">)</span><span class="pln">
            
            </span><span class="kwd">while</span><span class="pln"> cur </span><span class="pun">&lt;=</span><span class="pln"> m</span><span class="pun">:</span><span class="pln">
                
                </span><span class="kwd">if</span><span class="pln"> v1 </span><span class="com">// c != v2 // c:</span><span class="pln">
                    res </span><span class="pun">=</span><span class="pln"> fmin</span><span class="pun">(</span><span class="pln">res</span><span class="pun">,</span><span class="pln"> v1 </span><span class="com">// c)</span><span class="pln">
                
                cur </span><span class="pun">*=</span><span class="pln"> v
                c </span><span class="pun">+=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
        
        ans </span><span class="pun">+=</span><span class="pln"> res
        
        </span><span class="kwd">if</span><span class="pln"> pr</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> i</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">break</span><span class="pln">
    
    outs</span><span class="pun">.</span><span class="pln">append</span><span class="pun">(</span><span class="pln">ans</span><span class="pun">)</span><span class="pln">
 
</span><span class="kwd">print</span><span class="pun">(</span><span class="str">'\n'</span><span class="pun">.</span><span class="kwd">join</span><span class="pun">(</span><span class="pln">map</span><span class="pun">(</span><span class="pln">str</span><span class="pun">,</span><span class="pln"> outs</span><span class="pun">)))</span></code></pre></div></div><h3><a href="https://codeforces.com/contest/2153/problem/F" title="Codeforces Round 1057 (Div. 2)">2153F - Odd Queries on Odd Array</a></h3> <div class="spoiler"><b class="spoiler-title">Hint 1</b><div class="spoiler-content" style="display: block;"><p>What does the condition "there do not exist four indices <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1520"><span class="MJXp-mn" id="MJXp-Span-1521">1</span><span class="MJXp-mo" id="MJXp-Span-1522" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1523">i</span><span class="MJXp-mo" id="MJXp-Span-1524" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1525">j</span><span class="MJXp-mo" id="MJXp-Span-1526" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1527">k</span><span class="MJXp-mo" id="MJXp-Span-1528" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1529">l</span><span class="MJXp-mo" id="MJXp-Span-1530" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1531">m</span></span></span><script type="math/tex" id="MathJax-Element-137">1\leq i\lt j\lt k\lt l\leq m</script> such that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1532"><span class="MJXp-msubsup" id="MJXp-Span-1533"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1534" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1535" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1536" style="margin-left: 0.333em; margin-right: 0.333em;">≠</span><span class="MJXp-msubsup" id="MJXp-Span-1537"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1538" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1539" style="vertical-align: -0.4em;">j</span></span></span></span><script type="math/tex" id="MathJax-Element-138">b_i\neq b_j</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1540"><span class="MJXp-msubsup" id="MJXp-Span-1541"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1542" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1543" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1544" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-1545"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1546" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1547" style="vertical-align: -0.4em;">k</span></span></span></span><script type="math/tex" id="MathJax-Element-139">b_i=b_k</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1548"><span class="MJXp-msubsup" id="MJXp-Span-1549"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1550" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1551" style="vertical-align: -0.4em;">j</span></span><span class="MJXp-mo" id="MJXp-Span-1552" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-1553"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1554" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1555" style="vertical-align: -0.4em;">l</span></span></span></span><script type="math/tex" id="MathJax-Element-140">b_j=b_l</script>." reminds you of?</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 2</b><div class="spoiler-content" style="display: block;"><p>You can construct a tree based on the array. How can you do so?</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><p>The strange condition given by the problem is that there are no subsequences in the form of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1556"><span class="MJXp-mo" id="MJXp-Span-1557" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1558">x</span><span class="MJXp-mo" id="MJXp-Span-1559" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1560">y</span><span class="MJXp-mo" id="MJXp-Span-1561" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1562">x</span><span class="MJXp-mo" id="MJXp-Span-1563" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1564">y</span><span class="MJXp-mo" id="MJXp-Span-1565" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mtext" id="MJXp-Span-1566">&nbsp;</span><span class="MJXp-mo" id="MJXp-Span-1567" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1568">x</span><span class="MJXp-mo" id="MJXp-Span-1569" style="margin-left: 0.333em; margin-right: 0.333em;">≠</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1570">y</span><span class="MJXp-mo" id="MJXp-Span-1571" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-141">[x,y,x,y]\ (x\neq y)</script>.</p><p>Let us construct a tree such that its DFS order <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1572"><span class="MJXp-msubsup" id="MJXp-Span-1573"><span class="MJXp-mi" id="MJXp-Span-1574" style="margin-right: 0.05em;"></span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1575" style="vertical-align: 0.5em;">†</span></span></span></span><script type="math/tex" id="MathJax-Element-142">^\dagger</script> is equal to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1576"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1577">a</span></span></span><script type="math/tex" id="MathJax-Element-143">a</script>. We can build the tree as follows:</p> <ul>   <li>Initialize a stack containing a vertex <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1578"><span class="MJXp-mn" id="MJXp-Span-1579">0</span></span></span><script type="math/tex" id="MathJax-Element-144">0</script>.</li>   <li>Iterate over the array <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1580"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1581">a</span></span></span><script type="math/tex" id="MathJax-Element-145">a</script> from index <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1582"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1583">i</span><span class="MJXp-mo" id="MJXp-Span-1584" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-1585">1</span></span></span><script type="math/tex" id="MathJax-Element-146">i = 1</script> to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1586"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1587">i</span><span class="MJXp-mo" id="MJXp-Span-1588" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1589">n</span></span></span><script type="math/tex" id="MathJax-Element-147">i = n</script>.</li>   <li>For each element <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1590"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1591">a</span><span class="MJXp-mo" id="MJXp-Span-1592" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1593">i</span><span class="MJXp-mo" id="MJXp-Span-1594" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-148">a[i]</script>:   <ul>     <li>Add an edge between the vertex on top of the stack and vertex <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1595"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1596">i</span></span></span><script type="math/tex" id="MathJax-Element-149">i</script>. Assign vertex <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1597"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1598">i</span></span></span><script type="math/tex" id="MathJax-Element-150">i</script> the value <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1599"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1600">a</span><span class="MJXp-mo" id="MJXp-Span-1601" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1602">i</span><span class="MJXp-mo" id="MJXp-Span-1603" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-151">a[i]</script>.</li>     <li>If this is the first occurrence of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1604"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1605">a</span><span class="MJXp-mo" id="MJXp-Span-1606" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1607">i</span><span class="MJXp-mo" id="MJXp-Span-1608" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-152">a[i]</script>, push <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1609"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1610">i</span></span></span><script type="math/tex" id="MathJax-Element-153">i</script> onto the stack.</li>     <li>If this is the last occurrence of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1611"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1612">a</span><span class="MJXp-mo" id="MJXp-Span-1613" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1614">i</span><span class="MJXp-mo" id="MJXp-Span-1615" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-154">a[i]</script>, pop the top element from the stack (even if you have just pushed it).</li>   </ul></li> </ul><p>Only the first and last occurrence of each value affects the stack. It can be proven that at the last occurence of each value, the vertex being popped from the stack will have the same value as the value of the processed vertex. This is because all elements in between the first and last occurrence of a value <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1616"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1617">x</span></span></span><script type="math/tex" id="MathJax-Element-155">x</script> must be strictly contained in the range (due to the property of a cute array). Hence, all vertices that are pushed into the stack after the first occurrence of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1618"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1619">x</span></span></span><script type="math/tex" id="MathJax-Element-156">x</script> will be popped out before the last occurrence of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1620"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1621">x</span></span></span><script type="math/tex" id="MathJax-Element-157">x</script>.</p><p>Due to the property of a cute array, the set of vertices with equal values forms a single connected component in the tre</p> <div class="spoiler"><b class="spoiler-title">Proof</b><div class="spoiler-content" style="display: block;"><p>Suppose that the set of vertices with equal values do not form a single connected component. Let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1622"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1623">k</span></span></span><script type="math/tex" id="MathJax-Element-158">k</script> be the value that do not form a single connected component, and let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1624"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1625">u</span></span></span><script type="math/tex" id="MathJax-Element-159">u</script> be the first occurrence of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1626"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1627">a</span><span class="MJXp-mo" id="MJXp-Span-1628" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1629">u</span><span class="MJXp-mo" id="MJXp-Span-1630" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1631" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1632">k</span></span></span><script type="math/tex" id="MathJax-Element-160">a[u] = k</script>. Let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1633"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1634">v</span></span></span><script type="math/tex" id="MathJax-Element-161">v</script> be a vertex that is not connected to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1635"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1636">u</span></span></span><script type="math/tex" id="MathJax-Element-162">u</script>, i.e., there exists a vertex <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1637"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1638">w</span></span></span><script type="math/tex" id="MathJax-Element-163">w</script> on the simple path between <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1639"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1640">u</span></span></span><script type="math/tex" id="MathJax-Element-164">u</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1641"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1642">v</span></span></span><script type="math/tex" id="MathJax-Element-165">v</script> such that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1643"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1644">a</span><span class="MJXp-mo" id="MJXp-Span-1645" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1646">w</span><span class="MJXp-mo" id="MJXp-Span-1647" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1648" style="margin-left: 0.333em; margin-right: 0.333em;">≠</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1649">a</span><span class="MJXp-mo" id="MJXp-Span-1650" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1651">u</span><span class="MJXp-mo" id="MJXp-Span-1652" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-166">a[w] \neq a[u]</script>.</p><p>Vertex <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1653"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1654">u</span></span></span><script type="math/tex" id="MathJax-Element-167">u</script> has to be an ancestor of vertex <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1655"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1656">v</span></span></span><script type="math/tex" id="MathJax-Element-168">v</script>. This is because vertex <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1657"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1658">u</span></span></span><script type="math/tex" id="MathJax-Element-169">u</script> will be pushed into the stack, and will remain in the stack until the last occurrence of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1659"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1660">a</span><span class="MJXp-mo" id="MJXp-Span-1661" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1662">u</span><span class="MJXp-mo" id="MJXp-Span-1663" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-170">a[u]</script>, so <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1664"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1665">u</span></span></span><script type="math/tex" id="MathJax-Element-171">u</script> will still be in the stack when <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1666"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1667">v</span></span></span><script type="math/tex" id="MathJax-Element-172">v</script> is being processed.</p><p>Let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1668"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1669">w</span></span></span><script type="math/tex" id="MathJax-Element-173">w</script> be a vertex on the simple path between <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1670"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1671">u</span></span></span><script type="math/tex" id="MathJax-Element-174">u</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1672"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1673">v</span></span></span><script type="math/tex" id="MathJax-Element-175">v</script> such that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1674"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1675">a</span><span class="MJXp-mo" id="MJXp-Span-1676" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1677">w</span><span class="MJXp-mo" id="MJXp-Span-1678" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1679" style="margin-left: 0.333em; margin-right: 0.333em;">≠</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1680">a</span><span class="MJXp-mo" id="MJXp-Span-1681" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1682">u</span><span class="MJXp-mo" id="MJXp-Span-1683" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-176">a[w] \neq a[u]</script>. <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1684"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1685">w</span></span></span><script type="math/tex" id="MathJax-Element-177">w</script> is also an ancestor of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1686"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1687">v</span></span></span><script type="math/tex" id="MathJax-Element-178">v</script> since <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1688"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1689">u</span></span></span><script type="math/tex" id="MathJax-Element-179">u</script> is an ancestor of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1690"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1691">v</span></span></span><script type="math/tex" id="MathJax-Element-180">v</script>. <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1692"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1693">w</span></span></span><script type="math/tex" id="MathJax-Element-181">w</script> has to be the first occurrence of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1694"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1695">a</span><span class="MJXp-mo" id="MJXp-Span-1696" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1697">w</span><span class="MJXp-mo" id="MJXp-Span-1698" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-182">a[w]</script> (for it to be pushed into the stack), and the last occurrence of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1699"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1700">a</span><span class="MJXp-mo" id="MJXp-Span-1701" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1702">w</span><span class="MJXp-mo" id="MJXp-Span-1703" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-183">a[w]</script> has to be after <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1704"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1705">v</span></span></span><script type="math/tex" id="MathJax-Element-184">v</script> (otherwise it would be popped from the stack before <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1706"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1707">v</span></span></span><script type="math/tex" id="MathJax-Element-185">v</script>). This means that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1708"><span class="MJXp-mo" id="MJXp-Span-1709" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1710">a</span><span class="MJXp-mo" id="MJXp-Span-1711" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1712">u</span><span class="MJXp-mo" id="MJXp-Span-1713" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1714" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1715">a</span><span class="MJXp-mo" id="MJXp-Span-1716" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1717">w</span><span class="MJXp-mo" id="MJXp-Span-1718" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1719" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1720">a</span><span class="MJXp-mo" id="MJXp-Span-1721" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1722">v</span><span class="MJXp-mo" id="MJXp-Span-1723" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1724" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1725">a</span><span class="MJXp-mo" id="MJXp-Span-1726" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1727">w</span><span class="MJXp-mo" id="MJXp-Span-1728" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1729" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-186">[a[u], a[w], a[v], a[w]]</script> exists as a subsequence of array <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1730"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1731">a</span></span></span><script type="math/tex" id="MathJax-Element-187">a</script>, which contradicts the condition of a cute array as <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1732"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1733">a</span><span class="MJXp-mo" id="MJXp-Span-1734" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1735">u</span><span class="MJXp-mo" id="MJXp-Span-1736" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1737" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1738">a</span><span class="MJXp-mo" id="MJXp-Span-1739" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1740">v</span><span class="MJXp-mo" id="MJXp-Span-1741" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-188">a[u] = a[v]</script>.</p></div></div><p>Since there can only be one vertex in the stack for each value, all vertices of the same value have the same parent.</p><p>To answer the queries, we decompose the range <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1742"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1743">l</span></span></span><script type="math/tex" id="MathJax-Element-189">l</script> to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1744"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1745">r</span></span></span><script type="math/tex" id="MathJax-Element-190">r</script> into three parts by considering the lowest common ancestor (LCA) of vertex <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1746"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1747">l</span></span></span><script type="math/tex" id="MathJax-Element-191">l</script> and vertex <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1748"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1749">r</span></span></span><script type="math/tex" id="MathJax-Element-192">r</script>:</p> <ul>   <li>From <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1750"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1751">l</span></span></span><script type="math/tex" id="MathJax-Element-193">l</script> to LCA:   <ul>     <li>If <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1752"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1753">l</span></span></span><script type="math/tex" id="MathJax-Element-194">l</script> has the same value as LCA, you can leave it to the second part.</li>     <li>Otherwise, let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1754"><span class="MJXp-msup" id="MJXp-Span-1755"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1756" style="margin-right: 0.05em;">l</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1757" style="vertical-align: 0.5em;">′</span></span></span></span><script type="math/tex" id="MathJax-Element-195">l'</script> be the child vertex of LCA which is an ancestor of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1758"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1759">l</span></span></span><script type="math/tex" id="MathJax-Element-196">l</script>, and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1760"><span class="MJXp-msubsup" id="MJXp-Span-1761"><span class="MJXp-mtext" id="MJXp-Span-1762" style="margin-right: 0.05em;">last</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1763" style="vertical-align: -0.4em;"><span class="MJXp-msup" id="MJXp-Span-1764"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1765" style="margin-right: 0.05em;">l</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1766" style="vertical-align: 0.5em;">′</span></span></span></span></span></span><script type="math/tex" id="MathJax-Element-197">\text{last}_{l'}</script> be the vertex with the largest index in the subtree of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1767"><span class="MJXp-msup" id="MJXp-Span-1768"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1769" style="margin-right: 0.05em;">l</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1770" style="vertical-align: 0.5em;">′</span></span></span></span><script type="math/tex" id="MathJax-Element-198">l'</script>. The values that appear in the subtree of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1771"><span class="MJXp-msup" id="MJXp-Span-1772"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1773" style="margin-right: 0.05em;">l</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1774" style="vertical-align: 0.5em;">′</span></span></span></span><script type="math/tex" id="MathJax-Element-199">l'</script> never occur in other parts of the tree. Hence, the answer for the subarray <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1775"><span class="MJXp-msubsup" id="MJXp-Span-1776"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1777" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1778" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1779">l</span><span class="MJXp-mo" id="MJXp-Span-1780">…</span><span class="MJXp-msubsup" id="MJXp-Span-1781"><span class="MJXp-mtext" id="MJXp-Span-1782" style="margin-right: 0.05em;">last</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1783" style="vertical-align: -0.4em;"><span class="MJXp-msup" id="MJXp-Span-1784"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1785" style="margin-right: 0.05em;">l</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1786" style="vertical-align: 0.5em;">′</span></span></span></span></span></span></span></span><script type="math/tex" id="MathJax-Element-200">a_{l\ldots \text{last}_{l'}}</script> is equals to the answer for the suffix <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1787"><span class="MJXp-msubsup" id="MJXp-Span-1788"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1789" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1790" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1791">l</span><span class="MJXp-mo" id="MJXp-Span-1792">…</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1793">n</span></span></span></span></span><script type="math/tex" id="MathJax-Element-201">a_{l\ldots n}</script> minus the answer for the suffix <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1794"><span class="MJXp-msubsup" id="MJXp-Span-1795"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1796" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1797" style="vertical-align: -0.4em;"><span class="MJXp-msubsup" id="MJXp-Span-1798"><span class="MJXp-mtext" id="MJXp-Span-1799" style="margin-right: 0.05em;">last</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1800" style="vertical-align: -0.4em;"><span class="MJXp-msup" id="MJXp-Span-1801"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1802" style="margin-right: 0.05em;">l</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1803" style="vertical-align: 0.5em;">′</span></span></span></span><span class="MJXp-mo" id="MJXp-Span-1804">+</span><span class="MJXp-mn" id="MJXp-Span-1805">1</span><span class="MJXp-mo" id="MJXp-Span-1806">…</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1807">n</span></span></span></span></span><script type="math/tex" id="MathJax-Element-202">a_{\text{last}_{l'} + 1\ldots n}</script>. By precomputing the answer for each suffix of the entire array <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1808"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1809">a</span></span></span><script type="math/tex" id="MathJax-Element-203">a</script>, we can find the answer for subarray <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1810"><span class="MJXp-msubsup" id="MJXp-Span-1811"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1812" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1813" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1814">l</span><span class="MJXp-mo" id="MJXp-Span-1815">…</span><span class="MJXp-msubsup" id="MJXp-Span-1816"><span class="MJXp-mtext" id="MJXp-Span-1817" style="margin-right: 0.05em;">last</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1818" style="vertical-align: -0.4em;"><span class="MJXp-msup" id="MJXp-Span-1819"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1820" style="margin-right: 0.05em;">l</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1821" style="vertical-align: 0.5em;">′</span></span></span></span></span></span></span></span><script type="math/tex" id="MathJax-Element-204">a_{l\ldots \text{last}_{l'}}</script> in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1822"><span class="MJXp-mrow" id="MJXp-Span-1823"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-1824">O</span></span><span class="MJXp-mo" id="MJXp-Span-1825" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-1826">1</span><span class="MJXp-mo" id="MJXp-Span-1827" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-205">\mathcal{O}(1)</script> time.</li>   </ul></li>   <li>At LCA:   <ul>     <li>Let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1828"><span class="MJXp-msup" id="MJXp-Span-1829"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1830" style="margin-right: 0.05em;">r</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1831" style="vertical-align: 0.5em;">′</span></span></span></span><script type="math/tex" id="MathJax-Element-206">r'</script> be the child vertex of the LCA which is an ancestor of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1832"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1833">r</span></span></span><script type="math/tex" id="MathJax-Element-207">r</script>. We want to compute the answer for the subarray <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1834"><span class="MJXp-msubsup" id="MJXp-Span-1835"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1836" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1837" style="vertical-align: -0.4em;"><span class="MJXp-msubsup" id="MJXp-Span-1838"><span class="MJXp-mtext" id="MJXp-Span-1839" style="margin-right: 0.05em;">last</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1840" style="vertical-align: -0.4em;"><span class="MJXp-msup" id="MJXp-Span-1841"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1842" style="margin-right: 0.05em;">l</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1843" style="vertical-align: 0.5em;">′</span></span></span></span><span class="MJXp-mo" id="MJXp-Span-1844">+</span><span class="MJXp-mn" id="MJXp-Span-1845">1</span><span class="MJXp-mo" id="MJXp-Span-1846">…</span><span class="MJXp-msup" id="MJXp-Span-1847"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1848" style="margin-right: 0.05em;">r</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1849" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-1850">−</span><span class="MJXp-mn" id="MJXp-Span-1851">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-208">a_{\text{last}_{l'} + 1\ldots r'-1}</script>.</li>     <li>This can be done by considering the children of the LCA between <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1852"><span class="MJXp-msup" id="MJXp-Span-1853"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1854" style="margin-right: 0.05em;">l</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1855" style="vertical-align: 0.5em;">′</span></span></span></span><script type="math/tex" id="MathJax-Element-209">l'</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1856"><span class="MJXp-msup" id="MJXp-Span-1857"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1858" style="margin-right: 0.05em;">r</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1859" style="vertical-align: 0.5em;">′</span></span></span></span><script type="math/tex" id="MathJax-Element-210">r'</script>, then summing up the answer for the subtrees of those children.     <ul>       <li>For subtrees that are a single vertex, they have the same value as the LCA. We can count the occurrence of the value between vertex <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1860"><span class="MJXp-msup" id="MJXp-Span-1861"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1862" style="margin-right: 0.05em;">l</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1863" style="vertical-align: 0.5em;">′</span></span></span></span><script type="math/tex" id="MathJax-Element-211">l'</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1864"><span class="MJXp-msup" id="MJXp-Span-1865"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1866" style="margin-right: 0.05em;">r</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1867" style="vertical-align: 0.5em;">′</span></span></span></span><script type="math/tex" id="MathJax-Element-212">r'</script> in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1868"><span class="MJXp-mrow" id="MJXp-Span-1869"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-1870">O</span></span><span class="MJXp-mo" id="MJXp-Span-1871" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-1872">1</span><span class="MJXp-mo" id="MJXp-Span-1873" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-213">\mathcal{O}(1)</script> time after precomputing prefix sums.</li>       <li>For other subtrees, the answer for their corresponding subarray is independent of the rest of the array. Hence, we can precompute the answer for the subtree of each vertex with a simple DFS. Then, we can sum up the answer for the subtrees of all children between <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1874"><span class="MJXp-msup" id="MJXp-Span-1875"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1876" style="margin-right: 0.05em;">l</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1877" style="vertical-align: 0.5em;">′</span></span></span></span><script type="math/tex" id="MathJax-Element-214">l'</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1878"><span class="MJXp-msup" id="MJXp-Span-1879"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1880" style="margin-right: 0.05em;">r</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1881" style="vertical-align: 0.5em;">′</span></span></span></span><script type="math/tex" id="MathJax-Element-215">r'</script> using perfix sums.</li>     </ul></li>   </ul></li>   <li>From LCA to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1882"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1883">r</span></span></span><script type="math/tex" id="MathJax-Element-216">r</script>:   <ul>     <li>This is handled in the same way as the first part, except that we need to precompute the answer for each prefix of the entire array instead of the suffix.</li>   </ul></li> </ul><p>The time complexity is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1884"><span class="MJXp-mrow" id="MJXp-Span-1885"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-1886">O</span></span><span class="MJXp-mo" id="MJXp-Span-1887" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1888">n</span><span class="MJXp-mo" id="MJXp-Span-1889" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1890">q</span><span class="MJXp-mi" id="MJXp-Span-1891">log</span><span class="MJXp-mo" id="MJXp-Span-1892" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1893">n</span><span class="MJXp-mo" id="MJXp-Span-1894" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-217">\mathcal{O}(n+q\log n)</script>.</p><p><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1895"><span class="MJXp-msubsup" id="MJXp-Span-1896"><span class="MJXp-mi" id="MJXp-Span-1897" style="margin-right: 0.05em;"></span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1898" style="vertical-align: 0.5em;">†</span></span></span></span><script type="math/tex" id="MathJax-Element-218">^\dagger</script> The DFS order of a tree is found by calling the following <code class="tt">dfs</code> function on the tree.</p> <pre><code class="prettyprint prettyprinted" style=""><span class="pln">dfs_order </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[]</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> dfs</span><span class="pun">(</span><span class="pln">v</span><span class="pun">):</span><span class="pln">
	dfs_order</span><span class="pun">.</span><span class="pln">append</span><span class="pun">(</span><span class="pln">v</span><span class="pun">)</span><span class="pln">
	</span><span class="com"># children[v] is the set of children of vertex v</span><span class="pln">
	</span><span class="kwd">for</span><span class="pln"> child </span><span class="kwd">in</span><span class="pln"> children</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]:</span><span class="pln">
		dfs</span><span class="pun">(</span><span class="pln">child</span><span class="pun">)</span><span class="pln">

dfs</span><span class="pun">(</span><span class="lit">0</span><span class="pun">)</span></code></pre></div></div> <div class="spoiler"><b class="spoiler-title">Code (Pypy 3.10, Little_Sheep_Yawn)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="kwd">import</span><span class="pln"> sys
</span><span class="kwd">import</span><span class="pln"> bisect
input </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">lambda</span><span class="pun">:</span><span class="pln"> sys</span><span class="pun">.</span><span class="pln">stdin</span><span class="pun">.</span><span class="pln">readline</span><span class="pun">().</span><span class="pln">strip</span><span class="pun">()</span><span class="pln">

t </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">(</span><span class="pln">input</span><span class="pun">())</span><span class="pln">
outs </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[]</span><span class="pln">

fmax </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">lambda</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> y</span><span class="pun">:</span><span class="pln"> x </span><span class="kwd">if</span><span class="pln"> x </span><span class="pun">&gt;</span><span class="pln"> y </span><span class="kwd">else</span><span class="pln"> y
 
</span><span class="kwd">for</span><span class="pln"> _ </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="pln">t</span><span class="pun">):</span><span class="pln">
    n</span><span class="pun">,</span><span class="pln"> q </span><span class="pun">=</span><span class="pln"> map</span><span class="pun">(</span><span class="kwd">int</span><span class="pun">,</span><span class="pln"> input</span><span class="pun">().</span><span class="pln">split</span><span class="pun">())</span><span class="pln">
    nums </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> list</span><span class="pun">(</span><span class="pln">map</span><span class="pun">(</span><span class="kwd">int</span><span class="pun">,</span><span class="pln"> input</span><span class="pun">().</span><span class="pln">split</span><span class="pun">()))</span><span class="pln">
    
    first_pos </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">
    last_pos </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">
    
    </span><span class="kwd">for</span><span class="pln"> i </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">):</span><span class="pln">
        last_pos</span><span class="pun">[</span><span class="pln">nums</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> i
    
    </span><span class="kwd">for</span><span class="pln"> i </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="pln">n</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">):</span><span class="pln">
        first_pos</span><span class="pun">[</span><span class="pln">nums</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> i
    
    path </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[[]</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> _ </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)]</span><span class="pln">
    nth_parent </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[[-</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> _ </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="lit">20</span><span class="pun">)]</span><span class="pln">
    depth </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">
    
    stk </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln">
    
    </span><span class="kwd">for</span><span class="pln"> i </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">):</span><span class="pln">
        path</span><span class="pun">[</span><span class="pln">stk</span><span class="pun">[-</span><span class="lit">1</span><span class="pun">]].</span><span class="pln">append</span><span class="pun">(</span><span class="pln">i</span><span class="pun">)</span><span class="pln">
        nth_parent</span><span class="pun">[</span><span class="lit">0</span><span class="pun">][</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> stk</span><span class="pun">[-</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
        depth</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> depth</span><span class="pun">[</span><span class="pln">stk</span><span class="pun">[-</span><span class="lit">1</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
        
        </span><span class="kwd">if</span><span class="pln"> first_pos</span><span class="pun">[</span><span class="pln">nums</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> i</span><span class="pun">:</span><span class="pln">
            stk</span><span class="pun">.</span><span class="pln">append</span><span class="pun">(</span><span class="pln">i</span><span class="pun">)</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> last_pos</span><span class="pun">[</span><span class="pln">nums</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> i</span><span class="pun">:</span><span class="pln">
            stk</span><span class="pun">.</span><span class="pln">pop</span><span class="pun">()</span><span class="pln">
    
    depth</span><span class="pun">.</span><span class="pln">append</span><span class="pun">(-</span><span class="lit">1</span><span class="pun">)</span><span class="pln">
    
    </span><span class="kwd">for</span><span class="pln"> i </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="lit">19</span><span class="pun">):</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> j </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">):</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> nth_parent</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">:</span><span class="pln">
                nth_parent</span><span class="pun">[</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">][</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> nth_parent</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">nth_parent</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">]]</span><span class="pln">
    
    cnt </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">
    cur </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
    
    pref_val </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">
    
    </span><span class="kwd">for</span><span class="pln"> i </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">):</span><span class="pln">
        cur </span><span class="pun">+=</span><span class="pln"> </span><span class="pun">-</span><span class="pln">nums</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> cnt</span><span class="pun">[</span><span class="pln">nums</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]]</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> nums</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln">
        cnt</span><span class="pun">[</span><span class="pln">nums</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">^=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
        pref_val</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> cur
    
    cnt </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">
    cur </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
 
    suff_val </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">
    
    </span><span class="kwd">for</span><span class="pln"> i </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="pln">n</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">):</span><span class="pln">
        cur </span><span class="pun">+=</span><span class="pln"> </span><span class="pun">-</span><span class="pln">nums</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> cnt</span><span class="pun">[</span><span class="pln">nums</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]]</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> nums</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln">
        cnt</span><span class="pun">[</span><span class="pln">nums</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">^=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
        suff_val</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> cur
 
    subtree_val </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">
    subtree_max_idx </span><span class="pun">=</span><span class="pln"> list</span><span class="pun">(</span><span class="pln">range</span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">))</span><span class="pln">
    
    </span><span class="kwd">for</span><span class="pln"> i </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="pln">n</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">):</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> first_pos</span><span class="pun">[</span><span class="pln">nums</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> i</span><span class="pun">:</span><span class="pln">
            c </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
            total </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
            
            </span><span class="kwd">for</span><span class="pln"> j </span><span class="kwd">in</span><span class="pln"> path</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]:</span><span class="pln">
                total </span><span class="pun">+=</span><span class="pln"> subtree_val</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> nums</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> nums</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]:</span><span class="pln">
                    c </span><span class="pun">^=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
                subtree_max_idx</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> fmax</span><span class="pun">(</span><span class="pln">subtree_max_idx</span><span class="pun">[</span><span class="pln">i</span><span class="pun">],</span><span class="pln"> subtree_max_idx</span><span class="pun">[</span><span class="pln">j</span><span class="pun">])</span><span class="pln">
            
            subtree_val</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> total </span><span class="pun">+</span><span class="pln"> c </span><span class="pun">*</span><span class="pln"> nums</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln">
    
    accs </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">(</span><span class="pln">len</span><span class="pun">(</span><span class="pln">path</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> first_pos</span><span class="pun">[</span><span class="pln">nums</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> i </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">[]</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> i </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)]</span><span class="pln">
    
    </span><span class="kwd">for</span><span class="pln"> i </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">):</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> first_pos</span><span class="pun">[</span><span class="pln">nums</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> i</span><span class="pun">:</span><span class="pln">
            total </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
            c </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
            accs</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> total </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> c
            
            </span><span class="kwd">for</span><span class="pln"> j </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="pln">len</span><span class="pun">(</span><span class="pln">path</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])):</span><span class="pln">
                total </span><span class="pun">+=</span><span class="pln"> subtree_val</span><span class="pun">[</span><span class="pln">path</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">]]</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> nums</span><span class="pun">[</span><span class="pln">path</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> nums</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]:</span><span class="pln">
                    c </span><span class="pun">^=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
                accs</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j </span><span class="pun">+</span><span class="pln"> </span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> total </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> c
    
    </span><span class="kwd">def</span><span class="pln"> lca</span><span class="pun">(</span><span class="pln">u</span><span class="pun">,</span><span class="pln"> v</span><span class="pun">):</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> depth</span><span class="pun">[</span><span class="pln">u</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> depth</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]:</span><span class="pln">
            u</span><span class="pun">,</span><span class="pln"> v </span><span class="pun">=</span><span class="pln"> v</span><span class="pun">,</span><span class="pln"> u
        d </span><span class="pun">=</span><span class="pln"> depth</span><span class="pun">[</span><span class="pln">u</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> depth</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]</span><span class="pln">
        
        </span><span class="kwd">while</span><span class="pln"> d</span><span class="pun">:</span><span class="pln">
            x </span><span class="pun">=</span><span class="pln"> d </span><span class="pun">&amp;</span><span class="pln"> </span><span class="pun">-</span><span class="pln">d
            bit </span><span class="pun">=</span><span class="pln"> x</span><span class="pun">.</span><span class="pln">bit_length</span><span class="pun">()</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
            u </span><span class="pun">=</span><span class="pln"> nth_parent</span><span class="pun">[</span><span class="pln">bit</span><span class="pun">][</span><span class="pln">u</span><span class="pun">]</span><span class="pln">
            d </span><span class="pun">-=</span><span class="pln"> x
        
        </span><span class="kwd">if</span><span class="pln"> u </span><span class="pun">==</span><span class="pln"> v</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> u
        
        </span><span class="kwd">for</span><span class="pln"> i </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="lit">19</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">):</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> nth_parent</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">u</span><span class="pun">]</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> nth_parent</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">v</span><span class="pun">]:</span><span class="pln">
                u </span><span class="pun">=</span><span class="pln"> nth_parent</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">u</span><span class="pun">]</span><span class="pln">
                v </span><span class="pun">=</span><span class="pln"> nth_parent</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">v</span><span class="pun">]</span><span class="pln">
 
        </span><span class="kwd">return</span><span class="pln"> nth_parent</span><span class="pun">[</span><span class="lit">0</span><span class="pun">][</span><span class="pln">u</span><span class="pun">]</span><span class="pln">
    
    </span><span class="kwd">last</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
    ans </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> q
    
    </span><span class="kwd">for</span><span class="pln"> idx </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="pln">q</span><span class="pun">):</span><span class="pln">
        l</span><span class="pun">,</span><span class="pln"> r </span><span class="pun">=</span><span class="pln"> map</span><span class="pun">(</span><span class="kwd">int</span><span class="pun">,</span><span class="pln"> input</span><span class="pun">().</span><span class="pln">split</span><span class="pun">())</span><span class="pln">
        l </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l </span><span class="pun">+</span><span class="pln"> </span><span class="kwd">last</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
        r </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">r </span><span class="pun">+</span><span class="pln"> </span><span class="kwd">last</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
        
        </span><span class="kwd">if</span><span class="pln"> l </span><span class="pun">&gt;</span><span class="pln"> r</span><span class="pun">:</span><span class="pln"> l</span><span class="pun">,</span><span class="pln"> r </span><span class="pun">=</span><span class="pln"> r</span><span class="pun">,</span><span class="pln"> l
        ancestor </span><span class="pun">=</span><span class="pln"> lca</span><span class="pun">(</span><span class="pln">l</span><span class="pun">,</span><span class="pln"> r</span><span class="pun">)</span><span class="pln">
 
        </span><span class="kwd">if</span><span class="pln"> l </span><span class="pun">==</span><span class="pln"> r</span><span class="pun">:</span><span class="pln">
            </span><span class="kwd">last</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> nums</span><span class="pun">[</span><span class="pln">l</span><span class="pun">]</span><span class="pln">
        </span><span class="kwd">else</span><span class="pun">:</span><span class="pln">
            </span><span class="kwd">last</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
            
            </span><span class="kwd">if</span><span class="pln"> l </span><span class="pun">==</span><span class="pln"> ancestor </span><span class="kwd">and</span><span class="pln"> first_pos</span><span class="pun">[</span><span class="pln">nums</span><span class="pun">[</span><span class="pln">l</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> l</span><span class="pun">:</span><span class="pln">
                pl </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
            </span><span class="kwd">elif</span><span class="pln"> nth_parent</span><span class="pun">[</span><span class="lit">0</span><span class="pun">][</span><span class="pln">l</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> ancestor </span><span class="kwd">and</span><span class="pln"> first_pos</span><span class="pun">[</span><span class="pln">nums</span><span class="pun">[</span><span class="pln">ancestor</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> ancestor </span><span class="kwd">and</span><span class="pln"> first_pos</span><span class="pun">[</span><span class="pln">nums</span><span class="pun">[</span><span class="pln">l</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> l</span><span class="pun">:</span><span class="pln">
                pl </span><span class="pun">=</span><span class="pln"> bisect</span><span class="pun">.</span><span class="pln">bisect_left</span><span class="pun">(</span><span class="pln">path</span><span class="pun">[</span><span class="pln">ancestor</span><span class="pun">],</span><span class="pln"> l</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
            </span><span class="kwd">else</span><span class="pun">:</span><span class="pln">
                cl </span><span class="pun">=</span><span class="pln"> l
                </span><span class="kwd">for</span><span class="pln"> i </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="lit">19</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">):</span><span class="pln">
                    </span><span class="kwd">if</span><span class="pln"> depth</span><span class="pun">[</span><span class="pln">nth_parent</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">cl</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> depth</span><span class="pun">[</span><span class="pln">ancestor</span><span class="pun">]:</span><span class="pln">
                        cl </span><span class="pun">=</span><span class="pln"> nth_parent</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">cl</span><span class="pun">]</span><span class="pln">
                </span><span class="kwd">last</span><span class="pln"> </span><span class="pun">+=</span><span class="pln"> suff_val</span><span class="pun">[</span><span class="pln">l </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> suff_val</span><span class="pun">[</span><span class="pln">subtree_max_idx</span><span class="pun">[</span><span class="pln">cl</span><span class="pun">]]</span><span class="pln">
                pl </span><span class="pun">=</span><span class="pln"> bisect</span><span class="pun">.</span><span class="pln">bisect_left</span><span class="pun">(</span><span class="pln">path</span><span class="pun">[</span><span class="pln">ancestor</span><span class="pun">],</span><span class="pln"> cl</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">2</span><span class="pln">
            
            </span><span class="kwd">if</span><span class="pln"> r </span><span class="pun">==</span><span class="pln"> ancestor </span><span class="kwd">and</span><span class="pln"> first_pos</span><span class="pun">[</span><span class="pln">nums</span><span class="pun">[</span><span class="pln">r</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> r</span><span class="pun">:</span><span class="pln">
                pr </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
            </span><span class="kwd">elif</span><span class="pln"> nth_parent</span><span class="pun">[</span><span class="lit">0</span><span class="pun">][</span><span class="pln">r</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> ancestor </span><span class="kwd">and</span><span class="pln"> first_pos</span><span class="pun">[</span><span class="pln">nums</span><span class="pun">[</span><span class="pln">ancestor</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> ancestor </span><span class="kwd">and</span><span class="pln"> first_pos</span><span class="pun">[</span><span class="pln">nums</span><span class="pun">[</span><span class="pln">r</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> r</span><span class="pun">:</span><span class="pln">
                pr </span><span class="pun">=</span><span class="pln"> bisect</span><span class="pun">.</span><span class="pln">bisect_left</span><span class="pun">(</span><span class="pln">path</span><span class="pun">[</span><span class="pln">ancestor</span><span class="pun">],</span><span class="pln"> r</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
            </span><span class="kwd">else</span><span class="pun">:</span><span class="pln">
                cr </span><span class="pun">=</span><span class="pln"> r
                </span><span class="kwd">for</span><span class="pln"> i </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="lit">19</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">):</span><span class="pln">
                    </span><span class="kwd">if</span><span class="pln"> depth</span><span class="pun">[</span><span class="pln">nth_parent</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">cr</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> depth</span><span class="pun">[</span><span class="pln">ancestor</span><span class="pun">]:</span><span class="pln">
                        cr </span><span class="pun">=</span><span class="pln"> nth_parent</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">cr</span><span class="pun">]</span><span class="pln">
                </span><span class="kwd">last</span><span class="pln"> </span><span class="pun">+=</span><span class="pln"> pref_val</span><span class="pun">[</span><span class="pln">r</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> pref_val</span><span class="pun">[</span><span class="pln">cr </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln">
                pr </span><span class="pun">=</span><span class="pln"> bisect</span><span class="pun">.</span><span class="pln">bisect_left</span><span class="pun">(</span><span class="pln">path</span><span class="pun">[</span><span class="pln">ancestor</span><span class="pun">],</span><span class="pln"> cr</span><span class="pun">)</span><span class="pln">
 
            xl </span><span class="pun">=</span><span class="pln"> accs</span><span class="pun">[</span><span class="pln">ancestor</span><span class="pun">][</span><span class="pln">pl</span><span class="pun">]</span><span class="pln">
            xr </span><span class="pun">=</span><span class="pln"> accs</span><span class="pun">[</span><span class="pln">ancestor</span><span class="pun">][</span><span class="pln">pr </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln">
            
            vl</span><span class="pun">,</span><span class="pln"> cl </span><span class="pun">=</span><span class="pln"> divmod</span><span class="pun">(</span><span class="pln">xl</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln">
            vr</span><span class="pun">,</span><span class="pln"> cr </span><span class="pun">=</span><span class="pln"> divmod</span><span class="pun">(</span><span class="pln">xr</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln">
            
            </span><span class="kwd">last</span><span class="pln"> </span><span class="pun">+=</span><span class="pln"> vr </span><span class="pun">-</span><span class="pln"> vl </span><span class="pun">+</span><span class="pln"> </span><span class="pun">(</span><span class="pln">cl </span><span class="pun">^</span><span class="pln"> cr</span><span class="pun">)</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> nums</span><span class="pun">[</span><span class="pln">ancestor</span><span class="pun">]</span><span class="pln">
 
        ans</span><span class="pun">[</span><span class="pln">idx</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">last</span><span class="pln">
    
    outs</span><span class="pun">.</span><span class="pln">append</span><span class="pun">(</span><span class="str">' '</span><span class="pun">.</span><span class="kwd">join</span><span class="pun">(</span><span class="pln">map</span><span class="pun">(</span><span class="pln">str</span><span class="pun">,</span><span class="pln"> ans</span><span class="pun">)))</span><span class="pln">
 
</span><span class="kwd">print</span><span class="pun">(</span><span class="str">'\n'</span><span class="pun">.</span><span class="kwd">join</span><span class="pun">(</span><span class="pln">outs</span><span class="pun">))</span></code></pre></div></div> <div class="spoiler"><b class="spoiler-title">Code (C++, maomao90, slightly different)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">using</span><span class="pln"> ll </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">namespace</span><span class="pln"> solution </span><span class="pun">{</span><span class="pln">
 
</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> MAXL </span><span class="pun">=</span><span class="pln"> </span><span class="lit">21</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> MAXN </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1000005</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> q</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">MAXN</span><span class="pun">];</span><span class="pln">
vector</span><span class="str">&lt;int&gt;</span><span class="pln"> occ</span><span class="pun">[</span><span class="pln">MAXN</span><span class="pun">];</span><span class="pln">
ll pfx</span><span class="pun">[</span><span class="pln">MAXN</span><span class="pun">],</span><span class="pln"> sfx</span><span class="pun">[</span><span class="pln">MAXN</span><span class="pun">];</span><span class="pln">
ll sm_pfx</span><span class="pun">[</span><span class="pln">MAXN</span><span class="pun">],</span><span class="pln"> sm_sfx</span><span class="pun">[</span><span class="pln">MAXN</span><span class="pun">];</span><span class="pln">
 
</span><span class="kwd">inline</span><span class="pln"> </span><span class="kwd">bool</span><span class="pln"> is_first_occ</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> occ</span><span class="pun">[</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]][</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> i</span><span class="pun">;</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">inline</span><span class="pln"> </span><span class="kwd">bool</span><span class="pln"> is_last_occ</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> occ</span><span class="pun">[</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]].</span><span class="pln">back</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> i</span><span class="pun">;</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="com">// returns minimum j &gt;= p such that a[j] == x, or n + 1 if does not exist</span><span class="pln">
</span><span class="kwd">inline</span><span class="pln"> </span><span class="kwd">auto</span><span class="pln"> nxt_occ</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> p</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> x</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> lower_bound</span><span class="pun">(</span><span class="pln">occ</span><span class="pun">[</span><span class="pln">x</span><span class="pun">].</span><span class="kwd">begin</span><span class="pun">(),</span><span class="pln"> occ</span><span class="pun">[</span><span class="pln">x</span><span class="pun">].</span><span class="kwd">end</span><span class="pun">(),</span><span class="pln"> p</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> p</span><span class="pun">[</span><span class="pln">MAXL</span><span class="pun">][</span><span class="pln">MAXN</span><span class="pun">];</span><span class="pln">
vector</span><span class="str">&lt;int&gt;</span><span class="pln"> adj</span><span class="pun">[</span><span class="pln">MAXN</span><span class="pun">];</span><span class="pln">
</span><span class="kwd">inline</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> add_edge</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> u</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> v</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    p</span><span class="pun">[</span><span class="lit">0</span><span class="pun">][</span><span class="pln">v</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> u</span><span class="pun">;</span><span class="pln">
    adj</span><span class="pun">[</span><span class="pln">u</span><span class="pun">].</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">v</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> lvl</span><span class="pun">[</span><span class="pln">MAXN</span><span class="pun">];</span><span class="pln">
</span><span class="kwd">void</span><span class="pln"> dfs</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> u</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> l </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> l </span><span class="pun">&lt;</span><span class="pln"> MAXL</span><span class="pun">;</span><span class="pln"> l</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        p</span><span class="pun">[</span><span class="pln">l</span><span class="pun">][</span><span class="pln">u</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> p</span><span class="pun">[</span><span class="pln">l </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">][</span><span class="pln">p</span><span class="pun">[</span><span class="pln">l </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">][</span><span class="pln">u</span><span class="pun">]];</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">u</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        sm_pfx</span><span class="pun">[</span><span class="pln">u</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+=</span><span class="pln"> pfx</span><span class="pun">[</span><span class="pln">u</span><span class="pun">];</span><span class="pln">
        </span><span class="kwd">auto</span><span class="pln"> ptr </span><span class="pun">=</span><span class="pln"> nxt_occ</span><span class="pun">(</span><span class="pln">u </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">u</span><span class="pun">]);</span><span class="pln">
        sm_sfx</span><span class="pun">[</span><span class="pln">u</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+=</span><span class="pln"> ptr </span><span class="pun">==</span><span class="pln"> occ</span><span class="pun">[</span><span class="pln">a</span><span class="pun">[</span><span class="pln">u</span><span class="pun">]].</span><span class="kwd">end</span><span class="pun">()</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> sfx</span><span class="pun">[*</span><span class="pln">ptr</span><span class="pun">];</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> v </span><span class="pun">:</span><span class="pln"> adj</span><span class="pun">[</span><span class="pln">u</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        lvl</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> lvl</span><span class="pun">[</span><span class="pln">u</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
        sm_pfx</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> sm_pfx</span><span class="pun">[</span><span class="pln">u</span><span class="pun">];</span><span class="pln">
        sm_sfx</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> sm_sfx</span><span class="pun">[</span><span class="pln">u</span><span class="pun">];</span><span class="pln">
        dfs</span><span class="pun">(</span><span class="pln">v</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
tuple</span><span class="pun">&lt;</span><span class="kwd">int</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">&gt;</span><span class="pln"> get_lca</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">bool</span><span class="pln"> swp </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">lvl</span><span class="pun">[</span><span class="pln">a</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> lvl</span><span class="pun">[</span><span class="pln">b</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        swap</span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">);</span><span class="pln">
        swp </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> l </span><span class="pun">=</span><span class="pln"> MAXL </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> l </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> l</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">lvl</span><span class="pun">[</span><span class="pln">p</span><span class="pun">[</span><span class="pln">l</span><span class="pun">][</span><span class="pln">a</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">&gt;=</span><span class="pln"> lvl</span><span class="pun">[</span><span class="pln">b</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            a </span><span class="pun">=</span><span class="pln"> p</span><span class="pun">[</span><span class="pln">l</span><span class="pun">][</span><span class="pln">a</span><span class="pun">];</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a </span><span class="pun">==</span><span class="pln"> b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">{</span><span class="pln">a</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">};</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">swp</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        swap</span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> l </span><span class="pun">=</span><span class="pln"> MAXL </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> l </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> l</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">p</span><span class="pun">[</span><span class="pln">l</span><span class="pun">][</span><span class="pln">a</span><span class="pun">]</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> p</span><span class="pun">[</span><span class="pln">l</span><span class="pun">][</span><span class="pln">b</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            a </span><span class="pun">=</span><span class="pln"> p</span><span class="pun">[</span><span class="pln">l</span><span class="pun">][</span><span class="pln">a</span><span class="pun">];</span><span class="pln">
            b </span><span class="pun">=</span><span class="pln"> p</span><span class="pun">[</span><span class="pln">l</span><span class="pun">][</span><span class="pln">b</span><span class="pun">];</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">{</span><span class="pln">p</span><span class="pun">[</span><span class="lit">0</span><span class="pun">][</span><span class="pln">a</span><span class="pun">],</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">};</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
ll solve_same_layer</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> l</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> r</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pun">(</span><span class="pln">p</span><span class="pun">[</span><span class="lit">0</span><span class="pun">][</span><span class="pln">l</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> p</span><span class="pun">[</span><span class="lit">0</span><span class="pun">][</span><span class="pln">r</span><span class="pun">]);</span><span class="pln">
    ll res </span><span class="pun">=</span><span class="pln">
        </span><span class="pun">(</span><span class="pln">pfx</span><span class="pun">[</span><span class="pln">r</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln">
         </span><span class="pun">((</span><span class="pln">nxt_occ</span><span class="pun">(</span><span class="pln">r </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">l</span><span class="pun">])</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> occ</span><span class="pun">[</span><span class="pln">a</span><span class="pun">[</span><span class="pln">l</span><span class="pun">]].</span><span class="kwd">begin</span><span class="pun">())</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">l</span><span class="pun">]</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="lit">0</span><span class="pun">))</span><span class="pln"> </span><span class="pun">-</span><span class="pln">
        </span><span class="pun">(</span><span class="pln">pfx</span><span class="pun">[</span><span class="pln">l</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln">
         </span><span class="pun">((</span><span class="pln">nxt_occ</span><span class="pun">(</span><span class="pln">l</span><span class="pun">,</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">l</span><span class="pun">])</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> occ</span><span class="pun">[</span><span class="pln">a</span><span class="pun">[</span><span class="pln">l</span><span class="pun">]].</span><span class="kwd">begin</span><span class="pun">()</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">l</span><span class="pun">]</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="lit">0</span><span class="pun">));</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">((</span><span class="pln">nxt_occ</span><span class="pun">(</span><span class="pln">r </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">l</span><span class="pun">])</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> nxt_occ</span><span class="pun">(</span><span class="pln">l</span><span class="pun">,</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">l</span><span class="pun">]))</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        res </span><span class="pun">+=</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">l</span><span class="pun">];</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> res</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">void</span><span class="pln"> precompute</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        occ</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">clear</span><span class="pun">();</span><span class="pln">
        adj</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">clear</span><span class="pun">();</span><span class="pln">
        pfx</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> sfx</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> sm_pfx</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> sm_sfx</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        occ</span><span class="pun">[</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]].</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">i</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    vector</span><span class="str">&lt;int&gt;</span><span class="pln"> stk</span><span class="pun">;</span><span class="pln">
    stk</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">is_first_occ</span><span class="pun">(</span><span class="pln">i</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">assert</span><span class="pun">(!</span><span class="pln">stk</span><span class="pun">.</span><span class="pln">empty</span><span class="pun">()</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">stk</span><span class="pun">.</span><span class="pln">back</span><span class="pun">()]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]);</span><span class="pln">
            stk</span><span class="pun">.</span><span class="pln">pop_back</span><span class="pun">();</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pun">(!</span><span class="pln">stk</span><span class="pun">.</span><span class="pln">empty</span><span class="pun">());</span><span class="pln">
        add_edge</span><span class="pun">(</span><span class="pln">stk</span><span class="pun">.</span><span class="pln">back</span><span class="pun">(),</span><span class="pln"> i</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">is_last_occ</span><span class="pun">(</span><span class="pln">i</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            stk</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">i</span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
 
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> u </span><span class="pun">=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> u </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> u</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="pun">{</span><span class="pln">
            ll prv </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pun">)</span><span class="pln">adj</span><span class="pun">[</span><span class="pln">u</span><span class="pun">].</span><span class="pln">size</span><span class="pun">();</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="kwd">int</span><span class="pln"> v </span><span class="pun">=</span><span class="pln"> adj</span><span class="pun">[</span><span class="pln">u</span><span class="pun">][</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
                </span><span class="kwd">auto</span><span class="pln"> ptr </span><span class="pun">=</span><span class="pln"> nxt_occ</span><span class="pun">(</span><span class="pln">v</span><span class="pun">,</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]);</span><span class="pln">
                pfx</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln">
                    prv </span><span class="pun">+</span><span class="pln"> </span><span class="pun">((</span><span class="pln">ptr </span><span class="pun">-</span><span class="pln"> occ</span><span class="pun">[</span><span class="pln">a</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]].</span><span class="kwd">begin</span><span class="pun">()</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">adj</span><span class="pun">[</span><span class="pln">v</span><span class="pun">].</span><span class="pln">empty</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    prv </span><span class="pun">+=</span><span class="pln"> pfx</span><span class="pun">[</span><span class="pln">adj</span><span class="pun">[</span><span class="pln">v</span><span class="pun">].</span><span class="pln">back</span><span class="pun">()];</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">is_last_occ</span><span class="pun">(</span><span class="pln">v</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    prv </span><span class="pun">+=</span><span class="pln"> occ</span><span class="pun">[</span><span class="pln">a</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]].</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">{</span><span class="pln">
            ll prv </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pun">)</span><span class="pln">adj</span><span class="pun">[</span><span class="pln">u</span><span class="pun">].</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="kwd">int</span><span class="pln"> v </span><span class="pun">=</span><span class="pln"> adj</span><span class="pun">[</span><span class="pln">u</span><span class="pun">][</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
                </span><span class="kwd">auto</span><span class="pln"> ptr </span><span class="pun">=</span><span class="pln"> nxt_occ</span><span class="pun">(</span><span class="pln">v</span><span class="pun">,</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]);</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">adj</span><span class="pun">[</span><span class="pln">v</span><span class="pun">].</span><span class="pln">empty</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    prv </span><span class="pun">+=</span><span class="pln"> sfx</span><span class="pun">[</span><span class="pln">adj</span><span class="pun">[</span><span class="pln">v</span><span class="pun">][</span><span class="lit">0</span><span class="pun">]];</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">
                sfx</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> prv </span><span class="pun">+</span><span class="pln"> </span><span class="pun">((</span><span class="pln">occ</span><span class="pun">[</span><span class="pln">a</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]].</span><span class="kwd">end</span><span class="pun">()</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> ptr</span><span class="pun">)</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">is_first_occ</span><span class="pun">(</span><span class="pln">v</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    prv </span><span class="pun">+=</span><span class="pln"> occ</span><span class="pun">[</span><span class="pln">a</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]].</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
 
    dfs</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">void</span><span class="pln"> init</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> _n</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> _q</span><span class="pun">,</span><span class="pln"> vector</span><span class="str">&lt;int&gt;</span><span class="pln"> _a</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    n </span><span class="pun">=</span><span class="pln"> _n</span><span class="pun">;</span><span class="pln">
    q </span><span class="pun">=</span><span class="pln"> _q</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> _a</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">];</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    precompute</span><span class="pun">();</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
ll query</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> l</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> r</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l </span><span class="pun">==</span><span class="pln"> r</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">l</span><span class="pun">];</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">auto</span><span class="pln"> </span><span class="pun">[</span><span class="pln">lca</span><span class="pun">,</span><span class="pln"> lc</span><span class="pun">,</span><span class="pln"> rc</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> get_lca</span><span class="pun">(</span><span class="pln">l</span><span class="pun">,</span><span class="pln"> r</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pun">(</span><span class="pln">lca </span><span class="pun">!=</span><span class="pln"> r</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">lca </span><span class="pun">==</span><span class="pln"> l</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        ll ans </span><span class="pun">=</span><span class="pln"> sm_pfx</span><span class="pun">[</span><span class="pln">r</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> sm_pfx</span><span class="pun">[</span><span class="pln">l</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">l</span><span class="pun">];</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> ans</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">lc </span><span class="pun">==</span><span class="pln"> l</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        ll ans </span><span class="pun">=</span><span class="pln"> sm_pfx</span><span class="pun">[</span><span class="pln">r</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> sm_pfx</span><span class="pun">[</span><span class="pln">rc</span><span class="pun">];</span><span class="pln">
        ans </span><span class="pun">+=</span><span class="pln"> solve_same_layer</span><span class="pun">(</span><span class="pln">l</span><span class="pun">,</span><span class="pln"> rc</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> ans</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        ll ans </span><span class="pun">=</span><span class="pln"> sfx</span><span class="pun">[</span><span class="pln">l</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> sm_sfx</span><span class="pun">[</span><span class="pln">p</span><span class="pun">[</span><span class="lit">0</span><span class="pun">][</span><span class="pln">l</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> sm_sfx</span><span class="pun">[</span><span class="pln">lc</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> sm_pfx</span><span class="pun">[</span><span class="pln">r</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> sm_pfx</span><span class="pun">[</span><span class="pln">rc</span><span class="pun">];</span><span class="pln">
        ans </span><span class="pun">+=</span><span class="pln"> solve_same_layer</span><span class="pun">(*</span><span class="pln">nxt_occ</span><span class="pun">(</span><span class="pln">lc </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">lc</span><span class="pun">]),</span><span class="pln"> rc</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> ans</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="pun">}</span><span class="pln"> </span><span class="com">// namespace solution</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    ios</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="lit">0</span><span class="pun">),</span><span class="pln"> cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">t</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> q</span><span class="pun">;</span><span class="pln">
        cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n </span><span class="pun">&gt;&gt;</span><span class="pln"> q</span><span class="pun">;</span><span class="pln">
        vector</span><span class="str">&lt;int&gt;</span><span class="pln"> a</span><span class="pun">(</span><span class="pln">n</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            cin </span><span class="pun">&gt;&gt;</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
 
        solution</span><span class="pun">::</span><span class="pln">init</span><span class="pun">(</span><span class="pln">n</span><span class="pun">,</span><span class="pln"> q</span><span class="pun">,</span><span class="pln"> a</span><span class="pun">);</span><span class="pln">
        ll prv_ans </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">q</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">int</span><span class="pln"> l</span><span class="pun">,</span><span class="pln"> r</span><span class="pun">;</span><span class="pln">
            cin </span><span class="pun">&gt;&gt;</span><span class="pln"> l </span><span class="pun">&gt;&gt;</span><span class="pln"> r</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">auto</span><span class="pln"> decode </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[&amp;](</span><span class="kwd">int</span><span class="pln"> x</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> prv_ans</span><span class="pun">)</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> </span><span class="pun">};</span><span class="pln">
            l </span><span class="pun">=</span><span class="pln"> decode</span><span class="pun">(</span><span class="pln">l</span><span class="pun">);</span><span class="pln">
            r </span><span class="pun">=</span><span class="pln"> decode</span><span class="pun">(</span><span class="pln">r</span><span class="pun">);</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l </span><span class="pun">&gt;</span><span class="pln"> r</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                swap</span><span class="pun">(</span><span class="pln">l</span><span class="pun">,</span><span class="pln"> r</span><span class="pun">);</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
            ll ans </span><span class="pun">=</span><span class="pln"> solution</span><span class="pun">::</span><span class="pln">query</span><span class="pun">(</span><span class="pln">l</span><span class="pun">,</span><span class="pln"> r</span><span class="pun">);</span><span class="pln">
            cout </span><span class="pun">&lt;&lt;</span><span class="pln"> ans </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">' '</span><span class="pun">;</span><span class="pln">
            prv_ans </span><span class="pun">=</span><span class="pln"> ans</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div></div>

    </div>


        <div style="font-size: 1.1rem;line-height: 1.1rem;padding-bottom: 0.5em;">
            <img src="https://codeforces.com//codeforces.com/codeforces.org/s/52448/images/icons/paperclip-16x16.png" style="vertical-align: middle;"> <span style="padding: 0 0.35em;">Tutorial of <a href="https://codeforces.com/contest/2153" class="notice" style="text-decoration: none;">Codeforces Round 1057 (Div. 2)</a> </span>
        </div>
        
            

  <script>
    // Make all spoilers toggleable
    document.querySelectorAll('.spoiler-title').forEach(title => {
      title.addEventListener('click', function() {
        const spoiler = this.closest('.spoiler');
        spoiler.classList.toggle('open');
      });
    });
    
    // Open all spoilers by default for easier reading
    document.querySelectorAll('.spoiler').forEach(spoiler => {
      spoiler.classList.add('open');
    });
  </script>
</body>
</html>