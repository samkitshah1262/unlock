{
  "contestId": 2125,
  "index": "D",
  "title": "Segments Covering",
  "timeLimit": "2 seconds",
  "memoryLimit": "256 megabytes",
  "rating": 1600,
  "tags": [
    "dp",
    "math",
    "probabilities"
  ],
  "statementHtml": "<p>There is a linear strip divided into <span class=\"MathJax_Preview\" style=\"color: inherit;\"></span><span class=\"MathJax\" id=\"MathJax-Element-1-Frame\" tabindex=\"0\" data-mathml=\"&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;/math&gt;\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1\" style=\"width: 1.139em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.869em; height: 0px; font-size: 132%;\"><span style=\"position: absolute; clip: rect(1.518em, 1000.87em, 2.275em, -999.997em); top: -2.108em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-2\"><span class=\"mi\" id=\"MathJax-Span-3\" style=\"font-family: MathJax_Math-italic;\">m</span></span><span style=\"display: inline-block; width: 0px; height: 2.113em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>m</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-1\">m</script> cells, numbered from <span class=\"MathJax_Preview\" style=\"color: inherit;\"></span><span class=\"MathJax\" id=\"MathJax-Element-2-Frame\" tabindex=\"0\" data-mathml=\"&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/math&gt;\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-4\" style=\"width: 0.652em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;\"><span style=\"position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-5\"><span class=\"mn\" id=\"MathJax-Span-6\" style=\"font-family: MathJax_Main;\">1</span></span><span style=\"display: inline-block; width: 0px; height: 2.167em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mn>1</mn></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-2\">1</script> to <span class=\"MathJax_Preview\" style=\"color: inherit;\"></span><span class=\"MathJax\" id=\"MathJax-Element-3-Frame\" tabindex=\"0\" data-mathml=\"&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;/math&gt;\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-7\" style=\"width: 1.139em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.869em; height: 0px; font-size: 132%;\"><span style=\"position: absolute; clip: rect(1.518em, 1000.87em, 2.275em, -999.997em); top: -2.108em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-8\"><span class=\"mi\" id=\"MathJax-Span-9\" style=\"font-family: MathJax_Math-italic;\">m</span></span><span style=\"display: inline-block; width: 0px; height: 2.113em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>m</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-3\">m</script> from left to right.</p>\n<p>You are given <span class=\"MathJax_Preview\" style=\"color: inherit;\"></span><span class=\"MathJax\" id=\"MathJax-Element-4-Frame\" tabindex=\"0\" data-mathml=\"&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/math&gt;\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-10\" style=\"width: 0.814em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 132%;\"><span style=\"position: absolute; clip: rect(1.518em, 1000.6em, 2.275em, -999.997em); top: -2.108em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-11\"><span class=\"mi\" id=\"MathJax-Span-12\" style=\"font-family: MathJax_Math-italic;\">n</span></span><span style=\"display: inline-block; width: 0px; height: 2.113em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>n</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-4\">n</script> segments. Each segment is defined by four numbers: <span class=\"MathJax_Preview\" style=\"color: inherit;\"></span><span class=\"MathJax\" id=\"MathJax-Element-5-Frame\" tabindex=\"0\" data-mathml=\"&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;/math&gt;\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-13\" style=\"width: 0.436em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.327em; height: 0px; font-size: 132%;\"><span style=\"position: absolute; clip: rect(1.247em, 1000.27em, 2.275em, -999.997em); top: -2.108em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-14\"><span class=\"mi\" id=\"MathJax-Span-15\" style=\"font-family: MathJax_Math-italic;\">l</span></span><span style=\"display: inline-block; width: 0px; height: 2.113em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>l</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-5\">l</script>, <span class=\"MathJax_Preview\" style=\"color: inherit;\"></span><span class=\"MathJax\" id=\"MathJax-Element-6-Frame\" tabindex=\"0\" data-mathml=\"&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;/math&gt;\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-16\" style=\"width: 0.598em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.436em; height: 0px; font-size: 132%;\"><span style=\"position: absolute; clip: rect(1.518em, 1000.44em, 2.275em, -999.997em); top: -2.108em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-17\"><span class=\"mi\" id=\"MathJax-Span-18\" style=\"font-family: MathJax_Math-italic;\">r</span></span><span style=\"display: inline-block; width: 0px; height: 2.113em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>r</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-6\">r</script>, <span class=\"MathJax_Preview\" style=\"color: inherit;\"></span><span class=\"MathJax\" id=\"MathJax-Element-7-Frame\" tabindex=\"0\" data-mathml=\"&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;/math&gt;\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-19\" style=\"width: 0.652em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;\"><span style=\"position: absolute; clip: rect(1.518em, 1000.49em, 2.492em, -999.997em); top: -2.108em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-20\"><span class=\"mi\" id=\"MathJax-Span-21\" style=\"font-family: MathJax_Math-italic;\">p</span></span><span style=\"display: inline-block; width: 0px; height: 2.113em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>p</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-7\">p</script> and <span class=\"MathJax_Preview\" style=\"color: inherit;\"></span><span class=\"MathJax\" id=\"MathJax-Element-8-Frame\" tabindex=\"0\" data-mathml=\"&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;q&lt;/mi&gt;&lt;/math&gt;\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-22\" style=\"width: 0.598em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.436em; height: 0px; font-size: 132%;\"><span style=\"position: absolute; clip: rect(1.518em, 1000.44em, 2.492em, -999.997em); top: -2.108em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-23\"><span class=\"mi\" id=\"MathJax-Span-24\" style=\"font-family: MathJax_Math-italic;\">q<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.113em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>q</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-8\">q</script>&nbsp;— the segment covers cells from <span class=\"MathJax_Preview\" style=\"color: inherit;\"></span><span class=\"MathJax\" id=\"MathJax-Element-9-Frame\" tabindex=\"0\" data-mathml=\"&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;/math&gt;\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-25\" style=\"width: 0.436em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.327em; height: 0px; font-size: 132%;\"><span style=\"position: absolute; clip: rect(1.247em, 1000.27em, 2.275em, -999.997em); top: -2.108em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-26\"><span class=\"mi\" id=\"MathJax-Span-27\" style=\"font-family: MathJax_Math-italic;\">l</span></span><span style=\"display: inline-block; width: 0px; height: 2.113em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>l</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-9\">l</script> to <span class=\"MathJax_Preview\" style=\"color: inherit;\"></span><span class=\"MathJax\" id=\"MathJax-Element-10-Frame\" tabindex=\"0\" data-mathml=\"&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;/math&gt;\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-28\" style=\"width: 0.598em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.436em; height: 0px; font-size: 132%;\"><span style=\"position: absolute; clip: rect(1.518em, 1000.44em, 2.275em, -999.997em); top: -2.108em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-29\"><span class=\"mi\" id=\"MathJax-Span-30\" style=\"font-family: MathJax_Math-italic;\">r</span></span><span style=\"display: inline-block; width: 0px; height: 2.113em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>r</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-10\">r</script> inclusively and exists with probability <span class=\"MathJax_Preview\" style=\"color: inherit;\"></span><span class=\"MathJax\" id=\"MathJax-Element-11-Frame\" tabindex=\"0\" data-mathml=\"&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mfrac&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;q&lt;/mi&gt;&lt;/mfrac&gt;&lt;/math&gt;\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-31\" style=\"width: 0.923em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.706em; height: 0px; font-size: 132%;\"><span style=\"position: absolute; clip: rect(1.085em, 1000.71em, 2.762em, -999.997em); top: -2.108em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-32\"><span class=\"mfrac\" id=\"MathJax-Span-33\"><span style=\"display: inline-block; position: relative; width: 0.49em; height: 0px; margin-right: 0.111em; margin-left: 0.111em;\"><span style=\"position: absolute; clip: rect(3.52em, 1000.33em, 4.332em, -999.997em); top: -4.543em; left: 50%; margin-left: -0.16em;\"><span class=\"mi\" id=\"MathJax-Span-34\" style=\"font-size: 70.7%; font-family: MathJax_Math-italic;\">p</span><span style=\"display: inline-block; width: 0px; height: 4.007em;\"></span></span><span style=\"position: absolute; clip: rect(3.52em, 1000.33em, 4.332em, -999.997em); top: -3.677em; left: 50%; margin-left: -0.16em;\"><span class=\"mi\" id=\"MathJax-Span-35\" style=\"font-size: 70.7%; font-family: MathJax_Math-italic;\">q<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.007em;\"></span></span><span style=\"position: absolute; clip: rect(0.869em, 1000.49em, 1.247em, -999.997em); top: -1.296em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.49em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.085em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.113em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.711em; border-left: 0px solid; width: 0px; height: 1.932em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mfrac><mi>p</mi><mi>q</mi></mfrac></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-11\">\\frac{p}{q}</script> (independently).</p>\n<p>Your task is to calculate the probability that each cell is covered by <span class=\"tex-font-style-bf\">exactly</span> one segment.</p>",
  "inputSpecHtml": "<p>The first line contains two integers <span class=\"MathJax_Preview\" style=\"color: inherit;\"></span><span class=\"MathJax\" id=\"MathJax-Element-12-Frame\" tabindex=\"0\" data-mathml=\"&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/math&gt;\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-36\" style=\"width: 0.814em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 132%;\"><span style=\"position: absolute; clip: rect(1.518em, 1000.6em, 2.275em, -999.997em); top: -2.108em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-37\"><span class=\"mi\" id=\"MathJax-Span-38\" style=\"font-family: MathJax_Math-italic;\">n</span></span><span style=\"display: inline-block; width: 0px; height: 2.113em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>n</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-12\">n</script> and <span class=\"MathJax_Preview\" style=\"color: inherit;\"></span><span class=\"MathJax\" id=\"MathJax-Element-13-Frame\" tabindex=\"0\" data-mathml=\"&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;/math&gt;\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-39\" style=\"width: 1.139em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.869em; height: 0px; font-size: 132%;\"><span style=\"position: absolute; clip: rect(1.518em, 1000.87em, 2.275em, -999.997em); top: -2.108em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-40\"><span class=\"mi\" id=\"MathJax-Span-41\" style=\"font-family: MathJax_Math-italic;\">m</span></span><span style=\"display: inline-block; width: 0px; height: 2.113em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>m</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-13\">m</script> (<span class=\"MathJax_Preview\" style=\"color: inherit;\"></span><span class=\"MathJax\" id=\"MathJax-Element-14-Frame\" tabindex=\"0\" data-mathml=\"&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x2264;&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mo&gt;&amp;#x2264;&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;msup&gt;&lt;mn&gt;10&lt;/mn&gt;&lt;mn&gt;5&lt;/mn&gt;&lt;/msup&gt;&lt;/math&gt;\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-42\" style=\"width: 10.176em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 7.687em; height: 0px; font-size: 132%;\"><span style=\"position: absolute; clip: rect(1.139em, 1007.69em, 2.546em, -999.997em); top: -2.162em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-43\"><span class=\"mn\" id=\"MathJax-Span-44\" style=\"font-family: MathJax_Main;\">1</span><span class=\"mo\" id=\"MathJax-Span-45\" style=\"font-family: MathJax_Main; padding-left: 0.273em;\">≤</span><span class=\"mi\" id=\"MathJax-Span-46\" style=\"font-family: MathJax_Math-italic; padding-left: 0.273em;\">n</span><span class=\"mo\" id=\"MathJax-Span-47\" style=\"font-family: MathJax_Main;\">,</span><span class=\"mi\" id=\"MathJax-Span-48\" style=\"font-family: MathJax_Math-italic; padding-left: 0.165em;\">m</span><span class=\"mo\" id=\"MathJax-Span-49\" style=\"font-family: MathJax_Main; padding-left: 0.273em;\">≤</span><span class=\"mn\" id=\"MathJax-Span-50\" style=\"font-family: MathJax_Main; padding-left: 0.273em;\">2</span><span class=\"mo\" id=\"MathJax-Span-51\" style=\"font-family: MathJax_Main; padding-left: 0.219em;\">⋅</span><span class=\"msubsup\" id=\"MathJax-Span-52\" style=\"padding-left: 0.219em;\"><span style=\"display: inline-block; position: relative; width: 1.41em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.195em, 1000.98em, 4.169em, -999.997em); top: -4.002em; left: 0em;\"><span class=\"mn\" id=\"MathJax-Span-53\" style=\"font-family: MathJax_Main;\">10</span><span style=\"display: inline-block; width: 0px; height: 4.007em;\"></span></span><span style=\"position: absolute; top: -4.38em; left: 0.977em;\"><span class=\"mn\" id=\"MathJax-Span-54\" style=\"font-size: 70.7%; font-family: MathJax_Main;\">5</span><span style=\"display: inline-block; width: 0px; height: 4.007em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.167em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.575em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mn>1</mn><mo>≤</mo><mi>n</mi><mo>,</mo><mi>m</mi><mo>≤</mo><mn>2</mn><mo>⋅</mo><msup><mn>10</mn><mn>5</mn></msup></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-14\">1 \\le n, m \\le 2 \\cdot 10^5</script>).</p><p>Then <span class=\"MathJax_Preview\" style=\"color: inherit;\"></span><span class=\"MathJax\" id=\"MathJax-Element-15-Frame\" tabindex=\"0\" data-mathml=\"&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/math&gt;\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-55\" style=\"width: 0.814em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 132%;\"><span style=\"position: absolute; clip: rect(1.518em, 1000.6em, 2.275em, -999.997em); top: -2.108em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-56\"><span class=\"mi\" id=\"MathJax-Span-57\" style=\"font-family: MathJax_Math-italic;\">n</span></span><span style=\"display: inline-block; width: 0px; height: 2.113em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>n</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-15\">n</script> lines follow. The <span class=\"MathJax_Preview\" style=\"color: inherit;\"></span><span class=\"MathJax\" id=\"MathJax-Element-16-Frame\" tabindex=\"0\" data-mathml=\"&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/math&gt;\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-58\" style=\"width: 0.436em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.327em; height: 0px; font-size: 132%;\"><span style=\"position: absolute; clip: rect(1.301em, 1000.27em, 2.275em, -999.997em); top: -2.108em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-59\"><span class=\"mi\" id=\"MathJax-Span-60\" style=\"font-family: MathJax_Math-italic;\">i</span></span><span style=\"display: inline-block; width: 0px; height: 2.113em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>i</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-16\">i</script>-th of them contains four integers <span class=\"MathJax_Preview\" style=\"color: inherit;\"></span><span class=\"MathJax\" id=\"MathJax-Element-17-Frame\" tabindex=\"0\" data-mathml=\"&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-61\" style=\"width: 0.814em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 132%;\"><span style=\"position: absolute; clip: rect(1.247em, 1000.6em, 2.438em, -999.997em); top: -2.108em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-62\"><span class=\"msubsup\" id=\"MathJax-Span-63\"><span style=\"display: inline-block; position: relative; width: 0.598em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.141em, 1000.27em, 4.169em, -999.997em); top: -4.002em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-64\" style=\"font-family: MathJax_Math-italic;\">l</span><span style=\"display: inline-block; width: 0px; height: 4.007em;\"></span></span><span style=\"position: absolute; top: -3.839em; left: 0.327em;\"><span class=\"mi\" id=\"MathJax-Span-65\" style=\"font-size: 70.7%; font-family: MathJax_Math-italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.007em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.113em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 1.289em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>l</mi><mi>i</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-17\">l_i</script>, <span class=\"MathJax_Preview\" style=\"color: inherit;\"></span><span class=\"MathJax\" id=\"MathJax-Element-18-Frame\" tabindex=\"0\" data-mathml=\"&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-66\" style=\"width: 1.031em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.76em; height: 0px; font-size: 132%;\"><span style=\"position: absolute; clip: rect(1.518em, 1000.76em, 2.438em, -999.997em); top: -2.108em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-67\"><span class=\"msubsup\" id=\"MathJax-Span-68\"><span style=\"display: inline-block; position: relative; width: 0.76em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-69\" style=\"font-family: MathJax_Math-italic;\">r</span><span style=\"display: inline-block; width: 0px; height: 4.007em;\"></span></span><span style=\"position: absolute; top: -3.839em; left: 0.436em;\"><span class=\"mi\" id=\"MathJax-Span-70\" style=\"font-size: 70.7%; font-family: MathJax_Math-italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.007em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.113em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 0.932em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>r</mi><mi>i</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-18\">r_i</script>, <span class=\"MathJax_Preview\" style=\"color: inherit;\"></span><span class=\"MathJax\" id=\"MathJax-Element-19-Frame\" tabindex=\"0\" data-mathml=\"&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-71\" style=\"width: 1.085em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.814em; height: 0px; font-size: 132%;\"><span style=\"position: absolute; clip: rect(1.518em, 1000.81em, 2.492em, -999.997em); top: -2.108em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-72\"><span class=\"msubsup\" id=\"MathJax-Span-73\"><span style=\"display: inline-block; position: relative; width: 0.814em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-74\" style=\"font-family: MathJax_Math-italic;\">p</span><span style=\"display: inline-block; width: 0px; height: 4.007em;\"></span></span><span style=\"position: absolute; top: -3.839em; left: 0.49em;\"><span class=\"mi\" id=\"MathJax-Span-75\" style=\"font-size: 70.7%; font-family: MathJax_Math-italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.007em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.113em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>p</mi><mi>i</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-19\">p_i</script> and <span class=\"MathJax_Preview\" style=\"color: inherit;\"></span><span class=\"MathJax\" id=\"MathJax-Element-20-Frame\" tabindex=\"0\" data-mathml=\"&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;q&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-76\" style=\"width: 1.031em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.76em; height: 0px; font-size: 132%;\"><span style=\"position: absolute; clip: rect(1.518em, 1000.76em, 2.492em, -999.997em); top: -2.108em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-77\"><span class=\"msubsup\" id=\"MathJax-Span-78\"><span style=\"display: inline-block; position: relative; width: 0.76em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-79\" style=\"font-family: MathJax_Math-italic;\">q<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.007em;\"></span></span><span style=\"position: absolute; top: -3.839em; left: 0.436em;\"><span class=\"mi\" id=\"MathJax-Span-80\" style=\"font-size: 70.7%; font-family: MathJax_Math-italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.007em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.113em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>q</mi><mi>i</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-20\">q_i</script> (<span class=\"MathJax_Preview\" style=\"color: inherit;\"></span><span class=\"MathJax\" id=\"MathJax-Element-21-Frame\" tabindex=\"0\" data-mathml=\"&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x2264;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2264;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2264;&lt;/mo&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;/math&gt;\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-81\" style=\"width: 8.877em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 6.713em; height: 0px; font-size: 132%;\"><span style=\"position: absolute; clip: rect(1.301em, 1006.71em, 2.492em, -999.997em); top: -2.162em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-82\"><span class=\"mn\" id=\"MathJax-Span-83\" style=\"font-family: MathJax_Main;\">1</span><span class=\"mo\" id=\"MathJax-Span-84\" style=\"font-family: MathJax_Main; padding-left: 0.273em;\">≤</span><span class=\"msubsup\" id=\"MathJax-Span-85\" style=\"padding-left: 0.273em;\"><span style=\"display: inline-block; position: relative; width: 0.598em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.141em, 1000.27em, 4.169em, -999.997em); top: -4.002em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-86\" style=\"font-family: MathJax_Math-italic;\">l</span><span style=\"display: inline-block; width: 0px; height: 4.007em;\"></span></span><span style=\"position: absolute; top: -3.839em; left: 0.327em;\"><span class=\"mi\" id=\"MathJax-Span-87\" style=\"font-size: 70.7%; font-family: MathJax_Math-italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.007em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-88\" style=\"font-family: MathJax_Main; padding-left: 0.273em;\">≤</span><span class=\"msubsup\" id=\"MathJax-Span-89\" style=\"padding-left: 0.273em;\"><span style=\"display: inline-block; position: relative; width: 0.76em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-90\" style=\"font-family: MathJax_Math-italic;\">r</span><span style=\"display: inline-block; width: 0px; height: 4.007em;\"></span></span><span style=\"position: absolute; top: -3.839em; left: 0.436em;\"><span class=\"mi\" id=\"MathJax-Span-91\" style=\"font-size: 70.7%; font-family: MathJax_Math-italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.007em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-92\" style=\"font-family: MathJax_Main; padding-left: 0.273em;\">≤</span><span class=\"mi\" id=\"MathJax-Span-93\" style=\"font-family: MathJax_Math-italic; padding-left: 0.273em;\">m</span></span><span style=\"display: inline-block; width: 0px; height: 2.167em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 1.289em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mn>1</mn><mo>≤</mo><msub><mi>l</mi><mi>i</mi></msub><mo>≤</mo><msub><mi>r</mi><mi>i</mi></msub><mo>≤</mo><mi>m</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-21\">1 \\le l_i \\le r_i \\le m</script>; <span class=\"MathJax_Preview\" style=\"color: inherit;\"></span><span class=\"MathJax\" id=\"MathJax-Element-22-Frame\" tabindex=\"0\" data-mathml=\"&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x2264;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;lt;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;q&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;lt;&lt;/mo&gt;&lt;mn&gt;998244353&lt;/mn&gt;&lt;/math&gt;\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-94\" style=\"width: 13.964em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 10.555em; height: 0px; font-size: 132%;\"><span style=\"position: absolute; clip: rect(1.301em, 1010.5em, 2.546em, -999.997em); top: -2.162em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-95\"><span class=\"mn\" id=\"MathJax-Span-96\" style=\"font-family: MathJax_Main;\">1</span><span class=\"mo\" id=\"MathJax-Span-97\" style=\"font-family: MathJax_Main; padding-left: 0.273em;\">≤</span><span class=\"msubsup\" id=\"MathJax-Span-98\" style=\"padding-left: 0.273em;\"><span style=\"display: inline-block; position: relative; width: 0.814em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-99\" style=\"font-family: MathJax_Math-italic;\">p</span><span style=\"display: inline-block; width: 0px; height: 4.007em;\"></span></span><span style=\"position: absolute; top: -3.839em; left: 0.49em;\"><span class=\"mi\" id=\"MathJax-Span-100\" style=\"font-size: 70.7%; font-family: MathJax_Math-italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.007em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-101\" style=\"font-family: MathJax_Main; padding-left: 0.273em;\">&lt;</span><span class=\"msubsup\" id=\"MathJax-Span-102\" style=\"padding-left: 0.273em;\"><span style=\"display: inline-block; position: relative; width: 0.76em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-103\" style=\"font-family: MathJax_Math-italic;\">q<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.007em;\"></span></span><span style=\"position: absolute; top: -3.839em; left: 0.436em;\"><span class=\"mi\" id=\"MathJax-Span-104\" style=\"font-size: 70.7%; font-family: MathJax_Math-italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.007em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-105\" style=\"font-family: MathJax_Main; padding-left: 0.273em;\">&lt;</span><span class=\"mn\" id=\"MathJax-Span-106\" style=\"font-family: MathJax_Main; padding-left: 0.273em;\">998244353</span></span><span style=\"display: inline-block; width: 0px; height: 2.167em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.289em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mn>1</mn><mo>≤</mo><msub><mi>p</mi><mi>i</mi></msub><mo>&lt;</mo><msub><mi>q</mi><mi>i</mi></msub><mo>&lt;</mo><mn>998244353</mn></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-22\">1 \\le p_i < q_i < 998244353</script>).</p>",
  "outputSpecHtml": "<p>Print a single integer&nbsp;— the probability that each cell is covered by exactly one segment, taken modulo <span class=\"MathJax_Preview\" style=\"color: inherit;\"></span><span class=\"MathJax\" id=\"MathJax-Element-23-Frame\" tabindex=\"0\" data-mathml=\"&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;998244353&lt;/mn&gt;&lt;/math&gt;\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-107\" style=\"width: 5.955em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 4.494em; height: 0px; font-size: 132%;\"><span style=\"position: absolute; clip: rect(1.301em, 1004.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-108\"><span class=\"mn\" id=\"MathJax-Span-109\" style=\"font-family: MathJax_Main;\">998244353</span></span><span style=\"display: inline-block; width: 0px; height: 2.167em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mn>998244353</mn></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-23\">998244353</script>.</p><p>Formally, the probability can be expressed as an irreducible fraction <span class=\"MathJax_Preview\" style=\"color: inherit;\"></span><span class=\"MathJax\" id=\"MathJax-Element-24-Frame\" tabindex=\"0\" data-mathml=\"&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mfrac&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/mfrac&gt;&lt;/math&gt;\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-110\" style=\"width: 1.031em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.76em; height: 0px; font-size: 132%;\"><span style=\"position: absolute; clip: rect(1.193em, 1000.76em, 2.762em, -999.997em); top: -2.108em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-111\"><span class=\"mfrac\" id=\"MathJax-Span-112\"><span style=\"display: inline-block; position: relative; width: 0.544em; height: 0px; margin-right: 0.111em; margin-left: 0.111em;\"><span style=\"position: absolute; clip: rect(3.52em, 1000.38em, 4.169em, -999.997em); top: -4.435em; left: 50%; margin-left: -0.214em;\"><span class=\"mi\" id=\"MathJax-Span-113\" style=\"font-size: 70.7%; font-family: MathJax_Math-italic;\">x</span><span style=\"display: inline-block; width: 0px; height: 4.007em;\"></span></span><span style=\"position: absolute; clip: rect(3.52em, 1000.33em, 4.332em, -999.997em); top: -3.677em; left: 50%; margin-left: -0.16em;\"><span class=\"mi\" id=\"MathJax-Span-114\" style=\"font-size: 70.7%; font-family: MathJax_Math-italic;\">y<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.007em;\"></span></span><span style=\"position: absolute; clip: rect(0.869em, 1000.54em, 1.247em, -999.997em); top: -1.296em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.544em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.085em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.113em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.711em; border-left: 0px solid; width: 0px; height: 1.789em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mfrac><mi>x</mi><mi>y</mi></mfrac></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-24\">\\frac{x}{y}</script>. You have to print the value of <span class=\"MathJax_Preview\" style=\"color: inherit;\"></span><span class=\"MathJax\" id=\"MathJax-Element-25-Frame\" tabindex=\"0\" data-mathml=\"&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;mo lspace=&quot;thickmathspace&quot; rspace=&quot;thickmathspace&quot;&gt;mod&lt;/mo&gt;&lt;mn&gt;998244353&lt;/mn&gt;&lt;/math&gt;\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-115\" style=\"width: 12.881em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 9.743em; height: 0px; font-size: 132%;\"><span style=\"position: absolute; clip: rect(1.193em, 1009.69em, 2.546em, -999.997em); top: -2.162em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-116\"><span class=\"mi\" id=\"MathJax-Span-117\" style=\"font-family: MathJax_Math-italic;\">x</span><span class=\"mo\" id=\"MathJax-Span-118\" style=\"font-family: MathJax_Main; padding-left: 0.219em;\">⋅</span><span class=\"msubsup\" id=\"MathJax-Span-119\" style=\"padding-left: 0.219em;\"><span style=\"display: inline-block; position: relative; width: 1.518em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-120\" style=\"font-family: MathJax_Math-italic;\">y<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.007em;\"></span></span><span style=\"position: absolute; top: -4.38em; left: 0.544em;\"><span class=\"texatom\" id=\"MathJax-Span-121\"><span class=\"mrow\" id=\"MathJax-Span-122\"><span class=\"mo\" id=\"MathJax-Span-123\" style=\"font-size: 70.7%; font-family: MathJax_Main;\">−</span><span class=\"mn\" id=\"MathJax-Span-124\" style=\"font-size: 70.7%; font-family: MathJax_Main;\">1</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.007em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-125\" style=\"font-family: MathJax_Main; padding-left: 0.273em; padding-right: 0.273em;\">mod</span><span class=\"mn\" id=\"MathJax-Span-126\" style=\"font-family: MathJax_Main;\">998244353</span></span><span style=\"display: inline-block; width: 0px; height: 2.167em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.504em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>x</mi><mo>⋅</mo><msup><mi>y</mi><mrow class=\"MJX-TeXAtom-ORD\"><mo>−</mo><mn>1</mn></mrow></msup><mo lspace=\"thickmathspace\" rspace=\"thickmathspace\">mod</mo><mn>998244353</mn></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-25\">x \\cdot y^{-1} \\bmod 998244353</script>, where <span class=\"MathJax_Preview\" style=\"color: inherit;\"></span><span class=\"MathJax\" id=\"MathJax-Element-26-Frame\" tabindex=\"0\" data-mathml=\"&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;/math&gt;\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-127\" style=\"width: 2.005em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.518em; height: 0px; font-size: 132%;\"><span style=\"position: absolute; clip: rect(1.139em, 1001.52em, 2.492em, -999.997em); top: -2.108em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-128\"><span class=\"msubsup\" id=\"MathJax-Span-129\"><span style=\"display: inline-block; position: relative; width: 1.518em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-130\" style=\"font-family: MathJax_Math-italic;\">y<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.007em;\"></span></span><span style=\"position: absolute; top: -4.38em; left: 0.544em;\"><span class=\"texatom\" id=\"MathJax-Span-131\"><span class=\"mrow\" id=\"MathJax-Span-132\"><span class=\"mo\" id=\"MathJax-Span-133\" style=\"font-size: 70.7%; font-family: MathJax_Main;\">−</span><span class=\"mn\" id=\"MathJax-Span-134\" style=\"font-size: 70.7%; font-family: MathJax_Main;\">1</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.007em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.113em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.504em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msup><mi>y</mi><mrow class=\"MJX-TeXAtom-ORD\"><mo>−</mo><mn>1</mn></mrow></msup></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-26\">y^{-1}</script> is an integer such that <span class=\"MathJax_Preview\" style=\"color: inherit;\"></span><span class=\"MathJax\" id=\"MathJax-Element-27-Frame\" tabindex=\"0\" data-mathml=\"&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;mo lspace=&quot;thickmathspace&quot; rspace=&quot;thickmathspace&quot;&gt;mod&lt;/mo&gt;&lt;mn&gt;998244353&lt;/mn&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/math&gt;\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-135\" style=\"width: 15.154em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 11.475em; height: 0px; font-size: 132%;\"><span style=\"position: absolute; clip: rect(1.193em, 1011.42em, 2.546em, -999.997em); top: -2.162em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-136\"><span class=\"mi\" id=\"MathJax-Span-137\" style=\"font-family: MathJax_Math-italic;\">y<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span class=\"mo\" id=\"MathJax-Span-138\" style=\"font-family: MathJax_Main; padding-left: 0.219em;\">⋅</span><span class=\"msubsup\" id=\"MathJax-Span-139\" style=\"padding-left: 0.219em;\"><span style=\"display: inline-block; position: relative; width: 1.518em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-140\" style=\"font-family: MathJax_Math-italic;\">y<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.007em;\"></span></span><span style=\"position: absolute; top: -4.38em; left: 0.544em;\"><span class=\"texatom\" id=\"MathJax-Span-141\"><span class=\"mrow\" id=\"MathJax-Span-142\"><span class=\"mo\" id=\"MathJax-Span-143\" style=\"font-size: 70.7%; font-family: MathJax_Main;\">−</span><span class=\"mn\" id=\"MathJax-Span-144\" style=\"font-size: 70.7%; font-family: MathJax_Main;\">1</span></span></span><span style=\"display: inline-block; width: 0px; height: 4.007em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-145\" style=\"font-family: MathJax_Main; padding-left: 0.273em; padding-right: 0.273em;\">mod</span><span class=\"mn\" id=\"MathJax-Span-146\" style=\"font-family: MathJax_Main;\">998244353</span><span class=\"mo\" id=\"MathJax-Span-147\" style=\"font-family: MathJax_Main; padding-left: 0.273em;\">=</span><span class=\"mn\" id=\"MathJax-Span-148\" style=\"font-family: MathJax_Main; padding-left: 0.273em;\">1</span></span><span style=\"display: inline-block; width: 0px; height: 2.167em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.504em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>y</mi><mo>⋅</mo><msup><mi>y</mi><mrow class=\"MJX-TeXAtom-ORD\"><mo>−</mo><mn>1</mn></mrow></msup><mo lspace=\"thickmathspace\" rspace=\"thickmathspace\">mod</mo><mn>998244353</mn><mo>=</mo><mn>1</mn></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-27\">y \\cdot y^{-1} \\bmod 998244353 = 1</script>.</p>",
  "noteHtml": "<p>In the first example, the probability is equal to <span class=\"MathJax_Preview\" style=\"color: inherit;\"></span><span class=\"MathJax\" id=\"MathJax-Element-28-Frame\" tabindex=\"0\" data-mathml=\"&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mfrac&gt;&lt;mn&gt;5&lt;/mn&gt;&lt;mn&gt;18&lt;/mn&gt;&lt;/mfrac&gt;&lt;/math&gt;\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-149\" style=\"width: 1.356em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 1.031em; height: 0px; font-size: 132%;\"><span style=\"position: absolute; clip: rect(1.031em, 1001.03em, 2.654em, -999.997em); top: -2.108em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-150\"><span class=\"mfrac\" id=\"MathJax-Span-151\"><span style=\"display: inline-block; position: relative; width: 0.814em; height: 0px; margin-right: 0.111em; margin-left: 0.111em;\"><span style=\"position: absolute; clip: rect(3.358em, 1000.33em, 4.169em, -999.997em); top: -4.435em; left: 50%; margin-left: -0.16em;\"><span class=\"mn\" id=\"MathJax-Span-152\" style=\"font-size: 70.7%; font-family: MathJax_Main;\">5</span><span style=\"display: inline-block; width: 0px; height: 4.007em;\"></span></span><span style=\"position: absolute; clip: rect(3.358em, 1000.71em, 4.169em, -999.997em); top: -3.623em; left: 50%; margin-left: -0.376em;\"><span class=\"mn\" id=\"MathJax-Span-153\" style=\"font-size: 70.7%; font-family: MathJax_Main;\">18</span><span style=\"display: inline-block; width: 0px; height: 4.007em;\"></span></span><span style=\"position: absolute; clip: rect(0.869em, 1000.81em, 1.247em, -999.997em); top: -1.296em; left: 0em;\"><span style=\"display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.814em; height: 0px;\"></span><span style=\"display: inline-block; width: 0px; height: 1.085em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.113em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.568em; border-left: 0px solid; width: 0px; height: 1.861em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mfrac><mn>5</mn><mn>18</mn></mfrac></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-28\">\\frac{5}{18}</script>.</p>",
  "samples": [
    {
      "input": "3 31 2 1 33 3 1 21 3 2 3",
      "output": "610038216"
    },
    {
      "input": "2 31 2 1 22 3 1 2",
      "output": "0"
    },
    {
      "input": "8 51 3 1 21 5 1 61 4 4 55 5 1 74 5 1 24 5 2 53 3 2 71 2 1 3",
      "output": "94391813"
    }
  ],
  "images": [],
  "url": "https://codeforces.com/contest/2125/problem/D",
  "tutorialHtml": "<div><div class=\"ttypography\"><div class=\"problem-statement\"><div><p>There are two ways to solve this problem, both based on dynamic programming.</p><p>The first approach is to calculate a dynamic programming of the form <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-645\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-646\">d</span><span class=\"MJXp-msubsup\" id=\"MJXp-Span-647\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-648\" style=\"margin-right: 0.05em;\">p</span><span class=\"MJXp-mi MJXp-italic MJXp-script\" id=\"MJXp-Span-649\" style=\"vertical-align: -0.4em;\">x</span></span></span></span><script type=\"math/tex\" id=\"MathJax-Element-97\">dp_x</script> — the probability that all cells from <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-650\"><span class=\"MJXp-mn\" id=\"MJXp-Span-651\">1</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-98\">1</script> to <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-652\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-653\">x</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-99\">x</script> are covered exactly once. The base case for the dynamic programming is <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-654\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-655\">d</span><span class=\"MJXp-msubsup\" id=\"MJXp-Span-656\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-657\" style=\"margin-right: 0.05em;\">p</span><span class=\"MJXp-mn MJXp-script\" id=\"MJXp-Span-658\" style=\"vertical-align: -0.4em;\">0</span></span><span class=\"MJXp-mo\" id=\"MJXp-Span-659\" style=\"margin-left: 0.333em; margin-right: 0.333em;\">=</span><span class=\"MJXp-mn\" id=\"MJXp-Span-660\">1</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-100\">dp_0 = 1</script>. The transitions are as follows: to compute <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-661\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-662\">d</span><span class=\"MJXp-msubsup\" id=\"MJXp-Span-663\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-664\" style=\"margin-right: 0.05em;\">p</span><span class=\"MJXp-mi MJXp-italic MJXp-script\" id=\"MJXp-Span-665\" style=\"vertical-align: -0.4em;\">x</span></span></span></span><script type=\"math/tex\" id=\"MathJax-Element-101\">dp_x</script>, we need to iterate over all segments <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-666\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-667\">i</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-102\">i</script> that end at <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-668\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-669\">x</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-103\">x</script> (i.e., segments <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-670\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-671\">i</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-104\">i</script> such that <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-672\"><span class=\"MJXp-msubsup\" id=\"MJXp-Span-673\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-674\" style=\"margin-right: 0.05em;\">r</span><span class=\"MJXp-mi MJXp-italic MJXp-script\" id=\"MJXp-Span-675\" style=\"vertical-align: -0.4em;\">i</span></span><span class=\"MJXp-mo\" id=\"MJXp-Span-676\" style=\"margin-left: 0.333em; margin-right: 0.333em;\">=</span><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-677\">x</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-105\">r_i = x</script>; these can be pre-stored in a cell numbered <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-678\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-679\">x</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-106\">x</script>), and for each such segment, we increase <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-680\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-681\">d</span><span class=\"MJXp-msubsup\" id=\"MJXp-Span-682\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-683\" style=\"margin-right: 0.05em;\">p</span><span class=\"MJXp-mi MJXp-italic MJXp-script\" id=\"MJXp-Span-684\" style=\"vertical-align: -0.4em;\">x</span></span></span></span><script type=\"math/tex\" id=\"MathJax-Element-107\">dp_x</script> by the probability that the following three conditions are met:</p><ul> <li> we covered everything up to <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-685\"><span class=\"MJXp-msubsup\" id=\"MJXp-Span-686\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-687\" style=\"margin-right: 0.05em;\">l</span><span class=\"MJXp-mi MJXp-italic MJXp-script\" id=\"MJXp-Span-688\" style=\"vertical-align: -0.4em;\">i</span></span><span class=\"MJXp-mo\" id=\"MJXp-Span-689\" style=\"margin-left: 0.267em; margin-right: 0.267em;\">−</span><span class=\"MJXp-mn\" id=\"MJXp-Span-690\">1</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-108\">l_i - 1</script> exactly once (this is simply <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-691\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-692\">d</span><span class=\"MJXp-msubsup\" id=\"MJXp-Span-693\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-694\" style=\"margin-right: 0.05em;\">p</span><span class=\"MJXp-mrow MJXp-script\" id=\"MJXp-Span-695\" style=\"vertical-align: -0.4em;\"><span class=\"MJXp-msubsup\" id=\"MJXp-Span-696\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-697\" style=\"margin-right: 0.05em;\">l</span><span class=\"MJXp-mi MJXp-italic MJXp-script\" id=\"MJXp-Span-698\" style=\"vertical-align: -0.4em;\">i</span></span><span class=\"MJXp-mo\" id=\"MJXp-Span-699\">−</span><span class=\"MJXp-mn\" id=\"MJXp-Span-700\">1</span></span></span></span></span><script type=\"math/tex\" id=\"MathJax-Element-109\">dp_{l_i - 1}</script>); </li><li> segment <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-701\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-702\">i</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-110\">i</script> exists (this is <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-703\"><span class=\"MJXp-mfrac\" id=\"MJXp-Span-704\" style=\"vertical-align: 0.25em;\"><span class=\"MJXp-box MJXp-script\"><span class=\"MJXp-msubsup\" id=\"MJXp-Span-705\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-706\" style=\"margin-right: 0.05em;\">p</span><span class=\"MJXp-mi MJXp-italic MJXp-script\" id=\"MJXp-Span-707\" style=\"vertical-align: -0.4em;\">i</span></span></span><span class=\"MJXp-box\" style=\"margin-top: -0.9em;\"><span class=\"MJXp-denom\"><span><span class=\"MJXp-rule\" style=\"height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;\"></span></span><span><span class=\"MJXp-box MJXp-script\"><span class=\"MJXp-msubsup\" id=\"MJXp-Span-708\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-709\" style=\"margin-right: 0.05em;\">q</span><span class=\"MJXp-mi MJXp-italic MJXp-script\" id=\"MJXp-Span-710\" style=\"vertical-align: -0.4em;\">i</span></span></span></span></span></span></span></span></span><script type=\"math/tex\" id=\"MathJax-Element-111\">\\frac{p_i}{q_i}</script>); </li><li> we did not cover any cells from <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-711\"><span class=\"MJXp-msubsup\" id=\"MJXp-Span-712\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-713\" style=\"margin-right: 0.05em;\">l</span><span class=\"MJXp-mi MJXp-italic MJXp-script\" id=\"MJXp-Span-714\" style=\"vertical-align: -0.4em;\">i</span></span></span></span><script type=\"math/tex\" id=\"MathJax-Element-112\">l_i</script> to <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-715\"><span class=\"MJXp-msubsup\" id=\"MJXp-Span-716\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-717\" style=\"margin-right: 0.05em;\">r</span><span class=\"MJXp-mi MJXp-italic MJXp-script\" id=\"MJXp-Span-718\" style=\"vertical-align: -0.4em;\">i</span></span></span></span><script type=\"math/tex\" id=\"MathJax-Element-113\">r_i</script> with other segments. The probability of this can be calculated as follows: all segments covering cells from <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-719\"><span class=\"MJXp-msubsup\" id=\"MJXp-Span-720\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-721\" style=\"margin-right: 0.05em;\">l</span><span class=\"MJXp-mi MJXp-italic MJXp-script\" id=\"MJXp-Span-722\" style=\"vertical-align: -0.4em;\">i</span></span></span></span><script type=\"math/tex\" id=\"MathJax-Element-114\">l_i</script> to <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-723\"><span class=\"MJXp-msubsup\" id=\"MJXp-Span-724\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-725\" style=\"margin-right: 0.05em;\">r</span><span class=\"MJXp-mi MJXp-italic MJXp-script\" id=\"MJXp-Span-726\" style=\"vertical-align: -0.4em;\">i</span></span></span></span><script type=\"math/tex\" id=\"MathJax-Element-115\">r_i</script> are divided into two groups: segments that start before <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-727\"><span class=\"MJXp-msubsup\" id=\"MJXp-Span-728\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-729\" style=\"margin-right: 0.05em;\">l</span><span class=\"MJXp-mi MJXp-italic MJXp-script\" id=\"MJXp-Span-730\" style=\"vertical-align: -0.4em;\">i</span></span></span></span><script type=\"math/tex\" id=\"MathJax-Element-116\">l_i</script> but end in <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-731\"><span class=\"MJXp-mo\" id=\"MJXp-Span-732\" style=\"margin-left: 0em; margin-right: 0em;\">[</span><span class=\"MJXp-msubsup\" id=\"MJXp-Span-733\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-734\" style=\"margin-right: 0.05em;\">l</span><span class=\"MJXp-mi MJXp-italic MJXp-script\" id=\"MJXp-Span-735\" style=\"vertical-align: -0.4em;\">i</span></span><span class=\"MJXp-mo\" id=\"MJXp-Span-736\" style=\"margin-left: 0em; margin-right: 0.222em;\">,</span><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-737\">m</span><span class=\"MJXp-mo\" id=\"MJXp-Span-738\" style=\"margin-left: 0em; margin-right: 0em;\">]</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-117\">[l_i, m]</script>, and segments that start in <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-739\"><span class=\"MJXp-mo\" id=\"MJXp-Span-740\" style=\"margin-left: 0em; margin-right: 0em;\">[</span><span class=\"MJXp-msubsup\" id=\"MJXp-Span-741\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-742\" style=\"margin-right: 0.05em;\">l</span><span class=\"MJXp-mi MJXp-italic MJXp-script\" id=\"MJXp-Span-743\" style=\"vertical-align: -0.4em;\">i</span></span><span class=\"MJXp-mo\" id=\"MJXp-Span-744\" style=\"margin-left: 0em; margin-right: 0.222em;\">,</span><span class=\"MJXp-msubsup\" id=\"MJXp-Span-745\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-746\" style=\"margin-right: 0.05em;\">r</span><span class=\"MJXp-mi MJXp-italic MJXp-script\" id=\"MJXp-Span-747\" style=\"vertical-align: -0.4em;\">i</span></span><span class=\"MJXp-mo\" id=\"MJXp-Span-748\" style=\"margin-left: 0em; margin-right: 0em;\">]</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-118\">[l_i, r_i]</script>. For segments of the first group, we already know that they do not exist, since all cells up to <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-749\"><span class=\"MJXp-msubsup\" id=\"MJXp-Span-750\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-751\" style=\"margin-right: 0.05em;\">l</span><span class=\"MJXp-mi MJXp-italic MJXp-script\" id=\"MJXp-Span-752\" style=\"vertical-align: -0.4em;\">i</span></span><span class=\"MJXp-mo\" id=\"MJXp-Span-753\" style=\"margin-left: 0.267em; margin-right: 0.267em;\">−</span><span class=\"MJXp-mn\" id=\"MJXp-Span-754\">1</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-119\">l_i - 1</script> are covered exactly once (otherwise, cell <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-755\"><span class=\"MJXp-msubsup\" id=\"MJXp-Span-756\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-757\" style=\"margin-right: 0.05em;\">l</span><span class=\"MJXp-mi MJXp-italic MJXp-script\" id=\"MJXp-Span-758\" style=\"vertical-align: -0.4em;\">i</span></span><span class=\"MJXp-mo\" id=\"MJXp-Span-759\" style=\"margin-left: 0.267em; margin-right: 0.267em;\">−</span><span class=\"MJXp-mn\" id=\"MJXp-Span-760\">1</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-120\">l_i - 1</script> would be covered by at least two segments); for segments of the second group, we do not know anything yet, so we need to take the probability that none of them exist. To quickly calculate such a probability, we can form an array where the <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-761\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-762\">j</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-121\">j</script>-th cell contains the probability that no segment starting at <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-763\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-764\">j</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-122\">j</script> exists (i.e., the product <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-765\"><span class=\"MJXp-mfrac\" id=\"MJXp-Span-766\" style=\"vertical-align: 0.25em;\"><span class=\"MJXp-box MJXp-script\"><span class=\"MJXp-msubsup\" id=\"MJXp-Span-767\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-768\" style=\"margin-right: 0.05em;\">q</span><span class=\"MJXp-mi MJXp-italic MJXp-script\" id=\"MJXp-Span-769\" style=\"vertical-align: -0.4em;\">k</span></span><span class=\"MJXp-mo\" id=\"MJXp-Span-770\">−</span><span class=\"MJXp-msubsup\" id=\"MJXp-Span-771\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-772\" style=\"margin-right: 0.05em;\">p</span><span class=\"MJXp-mi MJXp-italic MJXp-script\" id=\"MJXp-Span-773\" style=\"vertical-align: -0.4em;\">k</span></span></span><span class=\"MJXp-box\" style=\"margin-top: -0.9em;\"><span class=\"MJXp-denom\"><span><span class=\"MJXp-rule\" style=\"height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;\"></span></span><span><span class=\"MJXp-box MJXp-script\"><span class=\"MJXp-msubsup\" id=\"MJXp-Span-774\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-775\" style=\"margin-right: 0.05em;\">q</span><span class=\"MJXp-mi MJXp-italic MJXp-script\" id=\"MJXp-Span-776\" style=\"vertical-align: -0.4em;\">k</span></span></span></span></span></span></span></span></span><script type=\"math/tex\" id=\"MathJax-Element-123\">\\frac{q_k - p_k}{q_k}</script> for all segments where <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-777\"><span class=\"MJXp-msubsup\" id=\"MJXp-Span-778\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-779\" style=\"margin-right: 0.05em;\">l</span><span class=\"MJXp-mi MJXp-italic MJXp-script\" id=\"MJXp-Span-780\" style=\"vertical-align: -0.4em;\">k</span></span><span class=\"MJXp-mo\" id=\"MJXp-Span-781\" style=\"margin-left: 0.333em; margin-right: 0.333em;\">=</span><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-782\">j</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-124\">l_k = j</script>), and take the product over that segment of the array (this can be done using prefix products, similar to how sums over segments are calculated using prefix sums). </li></ul><p>The second solution is similar to the first but is significantly simpler to implement. We will consider the dynamic programming array <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-783\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-784\">d</span><span class=\"MJXp-msubsup\" id=\"MJXp-Span-785\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-786\" style=\"margin-right: 0.05em;\">p</span><span class=\"MJXp-script-box\" style=\"height: 1.86em; vertical-align: -0.64em;\"><span class=\" MJXp-script\"><span><span style=\"margin-bottom: -0.25em;\"><span class=\"MJXp-mo\" id=\"MJXp-Span-788\">′</span></span></span></span><span class=\" MJXp-script\"><span><span style=\"margin-top: -0.85em;\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-787\">x</span></span></span></span></span></span></span></span><script type=\"math/tex\" id=\"MathJax-Element-125\">dp'_x</script> — the probability that all cells from <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-789\"><span class=\"MJXp-mn\" id=\"MJXp-Span-790\">1</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-126\">1</script> to <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-791\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-792\">x</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-127\">x</script> are covered exactly once, <span class=\"tex-font-style-bf\">and none of the other cells are covered</span>. The base case for this dynamic programming is: <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-793\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-794\">d</span><span class=\"MJXp-msubsup\" id=\"MJXp-Span-795\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-796\" style=\"margin-right: 0.05em;\">p</span><span class=\"MJXp-script-box\" style=\"height: 1.86em; vertical-align: -0.64em;\"><span class=\" MJXp-script\"><span><span style=\"margin-bottom: -0.25em;\"><span class=\"MJXp-mo\" id=\"MJXp-Span-798\">′</span></span></span></span><span class=\" MJXp-script\"><span><span style=\"margin-top: -0.85em;\"><span class=\"MJXp-mn\" id=\"MJXp-Span-797\">0</span></span></span></span></span></span></span></span><script type=\"math/tex\" id=\"MathJax-Element-128\">dp'_0</script> is equal to the probability that no segment exists (i.e., the product <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-799\"><span class=\"MJXp-mfrac\" id=\"MJXp-Span-800\" style=\"vertical-align: 0.25em;\"><span class=\"MJXp-box MJXp-script\"><span class=\"MJXp-msubsup\" id=\"MJXp-Span-801\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-802\" style=\"margin-right: 0.05em;\">q</span><span class=\"MJXp-mi MJXp-italic MJXp-script\" id=\"MJXp-Span-803\" style=\"vertical-align: -0.4em;\">i</span></span><span class=\"MJXp-mo\" id=\"MJXp-Span-804\">−</span><span class=\"MJXp-msubsup\" id=\"MJXp-Span-805\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-806\" style=\"margin-right: 0.05em;\">p</span><span class=\"MJXp-mi MJXp-italic MJXp-script\" id=\"MJXp-Span-807\" style=\"vertical-align: -0.4em;\">i</span></span></span><span class=\"MJXp-box\" style=\"margin-top: -0.9em;\"><span class=\"MJXp-denom\"><span><span class=\"MJXp-rule\" style=\"height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;\"></span></span><span><span class=\"MJXp-box MJXp-script\"><span class=\"MJXp-msubsup\" id=\"MJXp-Span-808\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-809\" style=\"margin-right: 0.05em;\">q</span><span class=\"MJXp-mi MJXp-italic MJXp-script\" id=\"MJXp-Span-810\" style=\"vertical-align: -0.4em;\">i</span></span></span></span></span></span></span></span></span><script type=\"math/tex\" id=\"MathJax-Element-129\">\\frac{q_i - p_i}{q_i}</script> for all segments). The transitions are as follows: to compute <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-811\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-812\">d</span><span class=\"MJXp-msubsup\" id=\"MJXp-Span-813\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-814\" style=\"margin-right: 0.05em;\">p</span><span class=\"MJXp-script-box\" style=\"height: 1.86em; vertical-align: -0.64em;\"><span class=\" MJXp-script\"><span><span style=\"margin-bottom: -0.25em;\"><span class=\"MJXp-mo\" id=\"MJXp-Span-816\">′</span></span></span></span><span class=\" MJXp-script\"><span><span style=\"margin-top: -0.85em;\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-815\">x</span></span></span></span></span></span></span></span><script type=\"math/tex\" id=\"MathJax-Element-130\">dp'_x</script>, we need to iterate over all segments <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-817\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-818\">i</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-131\">i</script> that end at <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-819\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-820\">x</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-132\">x</script>, and for each of them, increase <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-821\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-822\">d</span><span class=\"MJXp-msubsup\" id=\"MJXp-Span-823\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-824\" style=\"margin-right: 0.05em;\">p</span><span class=\"MJXp-script-box\" style=\"height: 1.86em; vertical-align: -0.64em;\"><span class=\" MJXp-script\"><span><span style=\"margin-bottom: -0.25em;\"><span class=\"MJXp-mo\" id=\"MJXp-Span-826\">′</span></span></span></span><span class=\" MJXp-script\"><span><span style=\"margin-top: -0.85em;\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-825\">x</span></span></span></span></span></span></span></span><script type=\"math/tex\" id=\"MathJax-Element-133\">dp'_x</script> by the probability that all cells from <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-827\"><span class=\"MJXp-mn\" id=\"MJXp-Span-828\">1</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-134\">1</script> to <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-829\"><span class=\"MJXp-msubsup\" id=\"MJXp-Span-830\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-831\" style=\"margin-right: 0.05em;\">l</span><span class=\"MJXp-mi MJXp-italic MJXp-script\" id=\"MJXp-Span-832\" style=\"vertical-align: -0.4em;\">i</span></span><span class=\"MJXp-mo\" id=\"MJXp-Span-833\" style=\"margin-left: 0.267em; margin-right: 0.267em;\">−</span><span class=\"MJXp-mn\" id=\"MJXp-Span-834\">1</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-135\">l_i - 1</script> are covered exactly once, and that segment <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-835\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-836\">i</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-136\">i</script> exists. At the first glance, this is equal to <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-837\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-838\">d</span><span class=\"MJXp-msubsup\" id=\"MJXp-Span-839\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-840\" style=\"margin-right: 0.05em;\">p</span><span class=\"MJXp-script-box\" style=\"height: 2.132em; vertical-align: -0.912em;\"><span class=\" MJXp-script\"><span><span style=\"margin-bottom: -0.25em;\"><span class=\"MJXp-mo\" id=\"MJXp-Span-847\">′</span></span></span></span><span class=\" MJXp-script\"><span><span style=\"margin-top: -0.85em;\"><span class=\"MJXp-mrow\" id=\"MJXp-Span-841\"><span class=\"MJXp-msubsup\" id=\"MJXp-Span-842\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-843\" style=\"margin-right: 0.05em;\">l</span><span class=\"MJXp-mi MJXp-italic MJXp-script\" id=\"MJXp-Span-844\" style=\"vertical-align: -0.4em;\">i</span></span><span class=\"MJXp-mo\" id=\"MJXp-Span-845\">−</span><span class=\"MJXp-mn\" id=\"MJXp-Span-846\">1</span></span></span></span></span></span></span><span class=\"MJXp-mo\" id=\"MJXp-Span-848\" style=\"margin-left: 0.267em; margin-right: 0.267em;\">⋅</span><span class=\"MJXp-mfrac\" id=\"MJXp-Span-849\" style=\"vertical-align: 0.25em;\"><span class=\"MJXp-box MJXp-script\"><span class=\"MJXp-msubsup\" id=\"MJXp-Span-850\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-851\" style=\"margin-right: 0.05em;\">p</span><span class=\"MJXp-mi MJXp-italic MJXp-script\" id=\"MJXp-Span-852\" style=\"vertical-align: -0.4em;\">i</span></span></span><span class=\"MJXp-box\" style=\"margin-top: -0.9em;\"><span class=\"MJXp-denom\"><span><span class=\"MJXp-rule\" style=\"height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;\"></span></span><span><span class=\"MJXp-box MJXp-script\"><span class=\"MJXp-msubsup\" id=\"MJXp-Span-853\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-854\" style=\"margin-right: 0.05em;\">q</span><span class=\"MJXp-mi MJXp-italic MJXp-script\" id=\"MJXp-Span-855\" style=\"vertical-align: -0.4em;\">i</span></span></span></span></span></span></span></span></span><script type=\"math/tex\" id=\"MathJax-Element-137\">dp'_{l_i - 1} \\cdot \\frac{p_i}{q_i}</script>; however, this expression <span class=\"tex-font-style-bf\">needs to be divided by <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-856\"><span class=\"MJXp-mfrac\" id=\"MJXp-Span-857\" style=\"vertical-align: 0.25em;\"><span class=\"MJXp-box MJXp-script\"><span class=\"MJXp-msubsup\" id=\"MJXp-Span-858\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-859\" style=\"margin-right: 0.05em;\">q</span><span class=\"MJXp-mi MJXp-italic MJXp-script\" id=\"MJXp-Span-860\" style=\"vertical-align: -0.4em;\">i</span></span><span class=\"MJXp-mo\" id=\"MJXp-Span-861\">−</span><span class=\"MJXp-msubsup\" id=\"MJXp-Span-862\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-863\" style=\"margin-right: 0.05em;\">p</span><span class=\"MJXp-mi MJXp-italic MJXp-script\" id=\"MJXp-Span-864\" style=\"vertical-align: -0.4em;\">i</span></span></span><span class=\"MJXp-box\" style=\"margin-top: -0.9em;\"><span class=\"MJXp-denom\"><span><span class=\"MJXp-rule\" style=\"height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;\"></span></span><span><span class=\"MJXp-box MJXp-script\"><span class=\"MJXp-msubsup\" id=\"MJXp-Span-865\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-866\" style=\"margin-right: 0.05em;\">q</span><span class=\"MJXp-mi MJXp-italic MJXp-script\" id=\"MJXp-Span-867\" style=\"vertical-align: -0.4em;\">i</span></span></span></span></span></span></span></span></span><script type=\"math/tex\" id=\"MathJax-Element-138\">\\frac{q_i - p_i}{q_i}</script></span>, since in <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-868\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-869\">d</span><span class=\"MJXp-msubsup\" id=\"MJXp-Span-870\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-871\" style=\"margin-right: 0.05em;\">p</span><span class=\"MJXp-script-box\" style=\"height: 2.132em; vertical-align: -0.912em;\"><span class=\" MJXp-script\"><span><span style=\"margin-bottom: -0.25em;\"><span class=\"MJXp-mo\" id=\"MJXp-Span-878\">′</span></span></span></span><span class=\" MJXp-script\"><span><span style=\"margin-top: -0.85em;\"><span class=\"MJXp-mrow\" id=\"MJXp-Span-872\"><span class=\"MJXp-msubsup\" id=\"MJXp-Span-873\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-874\" style=\"margin-right: 0.05em;\">l</span><span class=\"MJXp-mi MJXp-italic MJXp-script\" id=\"MJXp-Span-875\" style=\"vertical-align: -0.4em;\">i</span></span><span class=\"MJXp-mo\" id=\"MJXp-Span-876\">−</span><span class=\"MJXp-mn\" id=\"MJXp-Span-877\">1</span></span></span></span></span></span></span></span></span><script type=\"math/tex\" id=\"MathJax-Element-139\">dp'_{l_i - 1}</script> it is assumed that this segment does not exist. This solution does not require any prefix products (unlike the first solution), so it is easier to code.</p><p>Finally, let's talk about how to work with fractions modulo <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-879\"><span class=\"MJXp-mn\" id=\"MJXp-Span-880\">998244353</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-140\">998244353</script> (I will refer to this number as <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-881\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-882\">M</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-141\">M</script>). This is a prime number, so every integer from <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-883\"><span class=\"MJXp-mn\" id=\"MJXp-Span-884\">1</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-142\">1</script> to <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-885\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-886\">M</span><span class=\"MJXp-mo\" id=\"MJXp-Span-887\" style=\"margin-left: 0.267em; margin-right: 0.267em;\">−</span><span class=\"MJXp-mn\" id=\"MJXp-Span-888\">1</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-143\">M-1</script> has an inverse element modulo this number. To find it, one can either use the extended Euclidean algorithm, or raise the number to the power of <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-889\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-890\">M</span><span class=\"MJXp-mo\" id=\"MJXp-Span-891\" style=\"margin-left: 0.267em; margin-right: 0.267em;\">−</span><span class=\"MJXp-mn\" id=\"MJXp-Span-892\">2</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-144\">M-2</script> using binary exponentiation (for a prime <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-893\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-894\">M</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-145\">M</script> and each number <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-895\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-896\">x</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-146\">x</script> from <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-897\"><span class=\"MJXp-mn\" id=\"MJXp-Span-898\">1</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-147\">1</script> to <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-899\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-900\">M</span><span class=\"MJXp-mo\" id=\"MJXp-Span-901\" style=\"margin-left: 0.267em; margin-right: 0.267em;\">−</span><span class=\"MJXp-mn\" id=\"MJXp-Span-902\">1</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-148\">M-1</script>, the equality <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-903\"><span class=\"MJXp-msubsup\" id=\"MJXp-Span-904\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-905\" style=\"margin-right: 0.05em;\">x</span><span class=\"MJXp-mrow MJXp-script\" id=\"MJXp-Span-906\" style=\"vertical-align: 0.5em;\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-907\">M</span><span class=\"MJXp-mo\" id=\"MJXp-Span-908\">−</span><span class=\"MJXp-mn\" id=\"MJXp-Span-909\">1</span></span></span><span class=\"MJXp-mo\" id=\"MJXp-Span-910\" style=\"margin-left: 0.278em; margin-right: 0.278em;\">mod</span><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-911\">M</span><span class=\"MJXp-mo\" id=\"MJXp-Span-912\" style=\"margin-left: 0.333em; margin-right: 0.333em;\">=</span><span class=\"MJXp-mn\" id=\"MJXp-Span-913\">1</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-149\">x^{M-1} \\bmod M = 1</script> holds, so the inverse element for <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-914\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-915\">x</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-150\">x</script> will be <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-916\"><span class=\"MJXp-msubsup\" id=\"MJXp-Span-917\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-918\" style=\"margin-right: 0.05em;\">x</span><span class=\"MJXp-mrow MJXp-script\" id=\"MJXp-Span-919\" style=\"vertical-align: 0.5em;\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-920\">M</span><span class=\"MJXp-mo\" id=\"MJXp-Span-921\">−</span><span class=\"MJXp-mn\" id=\"MJXp-Span-922\">2</span></span></span></span></span><script type=\"math/tex\" id=\"MathJax-Element-151\">x^{M-2}</script>). Each fraction of the form <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-923\"><span class=\"MJXp-mfrac\" id=\"MJXp-Span-924\" style=\"vertical-align: 0.25em;\"><span class=\"MJXp-box MJXp-script\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-925\">x</span></span><span class=\"MJXp-box\" style=\"margin-top: -0.9em;\"><span class=\"MJXp-denom\"><span><span class=\"MJXp-rule\" style=\"height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;\"></span></span><span><span class=\"MJXp-box MJXp-script\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-926\">y</span></span></span></span></span></span></span></span><script type=\"math/tex\" id=\"MathJax-Element-152\">\\frac{x}{y}</script> can simply be treated as the number <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-927\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-928\">x</span><span class=\"MJXp-mo\" id=\"MJXp-Span-929\" style=\"margin-left: 0.267em; margin-right: 0.267em;\">⋅</span><span class=\"MJXp-msubsup\" id=\"MJXp-Span-930\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-931\" style=\"margin-right: 0.05em;\">y</span><span class=\"MJXp-mrow MJXp-script\" id=\"MJXp-Span-932\" style=\"vertical-align: 0.5em;\"><span class=\"MJXp-mo\" id=\"MJXp-Span-933\">−</span><span class=\"MJXp-mn\" id=\"MJXp-Span-934\">1</span></span></span><span class=\"MJXp-mo\" id=\"MJXp-Span-935\" style=\"margin-left: 0.278em; margin-right: 0.278em;\">mod</span><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-936\">M</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-153\">x \\cdot y^{-1} \\bmod M</script>, and when adding fractions, one can simply add the corresponding numbers without worrying about reducing fractions, finding a common denominator, and similar issues. In the first solution using prefix products, we will have to divide by some precomputed number to obtain the product over a segment — for this, it is sufficient to find its inverse element and multiply by it.</p></div></div></div></div>"
}