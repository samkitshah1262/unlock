<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tutorial</title>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
      line-height: 1.6;
      color: #333;
      background: #fafafa;
    }
    .ttypography {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    h3 {
      color: #1a1a1a;
      border-bottom: 2px solid #eee;
      padding-bottom: 10px;
    }
    h3 a {
      color: #0066cc;
      text-decoration: none;
    }
    h3 a:hover {
      text-decoration: underline;
    }
    .spoiler {
      margin: 15px 0;
      border: 1px solid #ddd;
      border-radius: 6px;
      overflow: hidden;
    }
    .spoiler-title {
      display: block;
      padding: 12px 15px;
      background: #f0f0f0;
      cursor: pointer;
      font-weight: 600;
      user-select: none;
      border-bottom: 1px solid #ddd;
    }
    .spoiler-title:hover {
      background: #e8e8e8;
    }
    .spoiler-title::before {
      content: '▶ ';
      font-size: 0.8em;
      transition: transform 0.2s;
      display: inline-block;
    }
    .spoiler.open .spoiler-title::before {
      content: '▼ ';
    }
    .spoiler-content {
      padding: 15px;
      background: #fff;
      display: none;
    }
    .spoiler.open .spoiler-content {
      display: block;
    }
    pre, code {
      background: #f5f5f5;
      font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
      font-size: 0.85em;
    }
    pre {
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
    }
    code {
      padding: 2px 5px;
      border-radius: 3px;
    }
    p {
      margin: 10px 0;
    }
    .MathJax {
      font-size: 1.1em;
    }
  </style>
</head>
<body>
  <h1>Editorial</h1>
  <p><a href="https://codeforces.com/blog/entry/147242" target="_blank">View on Codeforces →</a></p>
  
  <div class="ttypography"><p><a href="https://codeforces.com/contest/2162/problem/A" title="Codeforces Round 1059 (Div. 3)">2162A - Beautiful Average</a></p><p>Idea: <a class="rated-user user-blue" href="https://codeforces.com/profile/wakanda-forever" title="Expert wakanda-forever">wakanda-forever</a> Preparation: <a class="rated-user user-blue" href="https://codeforces.com/profile/wakanda-forever" title="Expert wakanda-forever">wakanda-forever</a></p> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><p>Let's say we have a sequence of numbers with an average equal to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2">k</span></span></span><script type="math/tex" id="MathJax-Element-1">k</script>.</p><p>Adding a number greater than <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4">k</span></span></span><script type="math/tex" id="MathJax-Element-2">k</script> increases the average, while adding a smaller one decreases it.</p><p>Therefore, the maximum average subarray is formed by taking the maximum element, since including anything smaller would only lower the average.</p><p>Hence, the final answer is the maximum element of the given array.</p><p>Time Complexity: <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-5"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-6">O</span><span class="MJXp-mo" id="MJXp-Span-7" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-8">n</span><span class="MJXp-mo" id="MJXp-Span-9" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-3">O(n)</script> per testcase.</p></div></div> <div class="spoiler"><b class="spoiler-title">Implementation</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
 
</span><span class="com">#define</span><span class="pln"> ll </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">(){</span><span class="pln">
 
    </span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
 
    </span><span class="kwd">while</span><span class="pun">(</span><span class="pln">t</span><span class="pun">--){</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
        cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
 
        vector</span><span class="str">&lt;int&gt;</span><span class="pln"> a</span><span class="pun">(</span><span class="pln">n</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> cin </span><span class="pun">&gt;&gt;</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
 
        cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="pun">*</span><span class="pln">max_element</span><span class="pun">(</span><span class="pln">a</span><span class="pun">.</span><span class="kwd">begin</span><span class="pun">(),</span><span class="pln"> a</span><span class="pun">.</span><span class="kwd">end</span><span class="pun">())</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> endl</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
 
    </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2162/problem/B" title="Codeforces Round 1059 (Div. 3)">2162B - Beautiful String</a></p><p>Idea: <a class="rated-user user-blue" href="https://codeforces.com/profile/wakanda-forever" title="Expert wakanda-forever">wakanda-forever</a> Preparation: <a class="rated-user user-blue" href="https://codeforces.com/profile/tridipta2806" title="Expert tridipta2806">tridipta2806</a></p> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><p>We need to find a non-decreasing subsequence <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-10"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-11">p</span></span></span><script type="math/tex" id="MathJax-Element-4">p</script> such that, after removing its characters from the string <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-12"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-13">s</span></span></span><script type="math/tex" id="MathJax-Element-5">s</script>, the remaining string <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-14"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-15">x</span></span></span><script type="math/tex" id="MathJax-Element-6">x</script> becomes a palindrome.</p><p>Observe that if we choose <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-16"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-17">p</span></span></span><script type="math/tex" id="MathJax-Element-7">p</script> to consist of all the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-18"><span class="MJXp-mn" id="MJXp-Span-19">0</span></span></span><script type="math/tex" id="MathJax-Element-8">0</script>'s in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-20"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-21">s</span></span></span><script type="math/tex" id="MathJax-Element-9">s</script>, then <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-22"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-23">x</span></span></span><script type="math/tex" id="MathJax-Element-10">x</script> will contain only <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-24"><span class="MJXp-mn" id="MJXp-Span-25">1</span></span></span><script type="math/tex" id="MathJax-Element-11">1</script>'s, which always forms a palindrome. Similarly, if we take <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-26"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-27">p</span></span></span><script type="math/tex" id="MathJax-Element-12">p</script> as all the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-28"><span class="MJXp-mn" id="MJXp-Span-29">1</span></span></span><script type="math/tex" id="MathJax-Element-13">1</script>'s, then <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-30"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-31">x</span></span></span><script type="math/tex" id="MathJax-Element-14">x</script> will contain only <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-32"><span class="MJXp-mn" id="MJXp-Span-33">0</span></span></span><script type="math/tex" id="MathJax-Element-15">0</script>'s, which is also a palindrome.</p><p>In both cases, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-34"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-35">p</span></span></span><script type="math/tex" id="MathJax-Element-16">p</script> is clearly a non-decreasing subsequence (since all its elements are equal).</p><p>Therefore, a valid solution always exists — we can simply output the indices of either all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-36"><span class="MJXp-mn" id="MJXp-Span-37">0</span></span></span><script type="math/tex" id="MathJax-Element-17">0</script>'s or all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-38"><span class="MJXp-mn" id="MJXp-Span-39">1</span></span></span><script type="math/tex" id="MathJax-Element-18">1</script>'s in the string.</p><p>Time Complexity: <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-40"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-41">O</span><span class="MJXp-mo" id="MJXp-Span-42" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-43">n</span><span class="MJXp-mo" id="MJXp-Span-44" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-19">O(n)</script> per testcase.</p></div></div> <div class="spoiler"><b class="spoiler-title">Implementation</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
 
</span><span class="com">#define</span><span class="pln"> ll </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">(){</span><span class="pln">
 
    </span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
 
    </span><span class="kwd">while</span><span class="pun">(</span><span class="pln">t</span><span class="pun">--){</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
        cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
 
        </span><span class="kwd">string</span><span class="pln"> s</span><span class="pun">;</span><span class="pln">
        cin </span><span class="pun">&gt;&gt;</span><span class="pln"> s</span><span class="pun">;</span><span class="pln">

        vector</span><span class="str">&lt;int&gt;</span><span class="pln"> pos</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">s</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'0'</span><span class="pun">)</span><span class="pln"> pos</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">

        cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pun">)</span><span class="pln">pos</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">auto</span><span class="pun">&amp;</span><span class="pln"> z </span><span class="pun">:</span><span class="pln"> pos</span><span class="pun">)</span><span class="pln"> cout </span><span class="pun">&lt;&lt;</span><span class="pln"> z </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">' '</span><span class="pun">;</span><span class="pln">

        cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
 
    </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2162/problem/C" title="Codeforces Round 1059 (Div. 3)">2162C - Beautiful XOR</a></p><p>Idea: <a class="rated-user user-blue" href="https://codeforces.com/profile/wakanda-forever" title="Expert wakanda-forever">wakanda-forever</a> Preparation: <a class="rated-user user-blue" href="https://codeforces.com/profile/wakanda-forever" title="Expert wakanda-forever">wakanda-forever</a></p> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><p>We are allowed to choose any <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-45"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-46">x</span></span></span><script type="math/tex" id="MathJax-Element-20">x</script> such that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-47"><span class="MJXp-mn" id="MJXp-Span-48">0</span><span class="MJXp-mo" id="MJXp-Span-49" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-50">x</span><span class="MJXp-mo" id="MJXp-Span-51" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-52">a</span></span></span><script type="math/tex" id="MathJax-Element-21">0 \le x \le a</script> and set <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-53"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-54">a</span><span class="MJXp-mo" id="MJXp-Span-55" style="margin-left: 0.111em; margin-right: 0.167em;">:=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-56">a</span><span class="MJXp-mo" id="MJXp-Span-57" style="margin-left: 0.267em; margin-right: 0.267em;">⊕</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-58">x</span></span></span><script type="math/tex" id="MathJax-Element-22">a := a \oplus x</script>. Our goal is to make <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-59"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-60">a</span></span></span><script type="math/tex" id="MathJax-Element-23">a</script> equal to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-61"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-62">b</span></span></span><script type="math/tex" id="MathJax-Element-24">b</script>.</p><p>Let's think of the binary representation of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-63"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-64">a</span></span></span><script type="math/tex" id="MathJax-Element-25">a</script>. Consider the highest set bit (most significant bit) of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-65"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-66">a</span></span></span><script type="math/tex" id="MathJax-Element-26">a</script> and let's assume its position is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-67"><span class="MJXp-mi" id="MJXp-Span-68">msb</span><span class="MJXp-mo" id="MJXp-Span-69" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-70" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-71">a</span><span class="MJXp-mo" id="MJXp-Span-72" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-27">\operatorname{msb}(a)</script>.</p><p>At each operation, we are choosing <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-73"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-74">x</span><span class="MJXp-mo" id="MJXp-Span-75" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-76">a</span></span></span><script type="math/tex" id="MathJax-Element-28">x \le a</script>, which implies that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-77"><span class="MJXp-mi" id="MJXp-Span-78">msb</span><span class="MJXp-mo" id="MJXp-Span-79" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-80" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-81">x</span><span class="MJXp-mo" id="MJXp-Span-82" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-83" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi" id="MJXp-Span-84">msb</span><span class="MJXp-mo" id="MJXp-Span-85" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-86" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-87">a</span><span class="MJXp-mo" id="MJXp-Span-88" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-29">\operatorname{msb}(x) \le \operatorname{msb}(a)</script> (otherwise, we have <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-89"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-90">x</span><span class="MJXp-mo" id="MJXp-Span-91" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-92">a</span></span></span><script type="math/tex" id="MathJax-Element-30">x > a</script>).</p> <center><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-93"><span class="MJXp-mstyle" id="MJXp-Span-94"><span class="MJXp-mtable" id="MJXp-Span-95"><span><span class="MJXp-mtr" id="MJXp-Span-96" style="vertical-align: baseline;"><span class="MJXp-mtd" id="MJXp-Span-97" style="text-align: center;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-98">a</span><span class="MJXp-mo" id="MJXp-Span-99" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-100" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-101">00</span><span class="MJXp-mo" id="MJXp-Span-102" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mn" id="MJXp-Span-103">01</span><span class="MJXp-mo" id="MJXp-Span-104" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-105" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-msubsup" id="MJXp-Span-106"><span class="MJXp-mo" id="MJXp-Span-107" style="margin-left: 0em; margin-right: 0.05em;">)</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-108" style="vertical-align: -0.4em;">2</span></span></span></span><span class="MJXp-mtr" id="MJXp-Span-109" style="vertical-align: baseline;"><span class="MJXp-mtd" id="MJXp-Span-110" style="padding-top: 0.4em; text-align: center;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-111">x</span><span class="MJXp-mo" id="MJXp-Span-112" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-113" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-114">00</span><span class="MJXp-mo" id="MJXp-Span-115" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mn" id="MJXp-Span-116">0</span><span class="MJXp-mo" id="MJXp-Span-117" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mn" id="MJXp-Span-118">1</span><span class="MJXp-mo" id="MJXp-Span-119" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-msubsup" id="MJXp-Span-120"><span class="MJXp-mo" id="MJXp-Span-121" style="margin-left: 0em; margin-right: 0.05em;">)</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-122" style="vertical-align: -0.4em;">2</span></span></span></span></span></span></span></span></span><script type="math/tex" id="MathJax-Element-31"> \displaystyle \begin{matrix} a = (00\dots01\dots\dots)_2 \\ x = (00\dots0\dots1\dots)_2 \end{matrix} </script></center><p>Now, we can surely say that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-123"><span class="MJXp-mi" id="MJXp-Span-124">msb</span><span class="MJXp-mo" id="MJXp-Span-125" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-126" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-127">a</span><span class="MJXp-mo" id="MJXp-Span-128" style="margin-left: 0.267em; margin-right: 0.267em;">⊕</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-129">x</span><span class="MJXp-mo" id="MJXp-Span-130" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-131" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi" id="MJXp-Span-132">msb</span><span class="MJXp-mo" id="MJXp-Span-133" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-134" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-135">a</span><span class="MJXp-mo" id="MJXp-Span-136" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-32">\operatorname{msb}(a \oplus x) \le \operatorname{msb}(a)</script>.</p><p>Thus, by performing the given operation, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-137"><span class="MJXp-mi" id="MJXp-Span-138">msb</span><span class="MJXp-mo" id="MJXp-Span-139" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-140" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-141">a</span><span class="MJXp-mo" id="MJXp-Span-142" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-33">\operatorname{msb}(a)</script> will never increase. So, if <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-143"><span class="MJXp-mi" id="MJXp-Span-144">msb</span><span class="MJXp-mo" id="MJXp-Span-145" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-146" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-147">b</span><span class="MJXp-mo" id="MJXp-Span-148" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-149" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-mi" id="MJXp-Span-150">msb</span><span class="MJXp-mo" id="MJXp-Span-151" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-152" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-153">a</span><span class="MJXp-mo" id="MJXp-Span-154" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-34">\operatorname{msb}(b) > \operatorname{msb}(a)</script>, the answer is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-155"><span class="MJXp-mo" id="MJXp-Span-156" style="margin-left: 0em; margin-right: 0.111em;">−</span><span class="MJXp-mn" id="MJXp-Span-157">1</span></span></span><script type="math/tex" id="MathJax-Element-35">-1</script>.</p><p>Otherwise, we can always transform <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-158"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-159">a</span></span></span><script type="math/tex" id="MathJax-Element-36">a</script> into <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-160"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-161">b</span></span></span><script type="math/tex" id="MathJax-Element-37">b</script> in a constructive manner.</p><p>First, we set all bits below <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-162"><span class="MJXp-mi" id="MJXp-Span-163">msb</span><span class="MJXp-mo" id="MJXp-Span-164" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-165" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-166">a</span><span class="MJXp-mo" id="MJXp-Span-167" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-38">\operatorname{msb}(a)</script> one by one to ensure that every required bit can be manipulated. Then, for each bit that is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-168"><span class="MJXp-mn" id="MJXp-Span-169">0</span></span></span><script type="math/tex" id="MathJax-Element-39">0</script> in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-170"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-171">b</span></span></span><script type="math/tex" id="MathJax-Element-40">b</script>, we unset it using an appropriate XOR operation.</p><p>By following this process, we can reach <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-172"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-173">b</span></span></span><script type="math/tex" id="MathJax-Element-41">b</script> from <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-174"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-175">a</span></span></span><script type="math/tex" id="MathJax-Element-42">a</script> in less than <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-176"><span class="MJXp-mn" id="MJXp-Span-177">60</span></span></span><script type="math/tex" id="MathJax-Element-43">60</script> operations.</p><p>Time Complexity: <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-178"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-179">O</span><span class="MJXp-mo" id="MJXp-Span-180" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-181"><span class="MJXp-mi" id="MJXp-Span-182" style="margin-right: 0.05em;">log</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-183" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-184" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-185" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-186">a</span><span class="MJXp-mo" id="MJXp-Span-187" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-188" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-44">O(\log_2(a))</script> per testcase.</p></div></div> <div class="spoiler"><b class="spoiler-title">Implementation</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">(){</span><span class="pln">
 
    </span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
 
    </span><span class="kwd">while</span><span class="pun">(</span><span class="pln">t</span><span class="pun">--){</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">;</span><span class="pln">
        cin </span><span class="pun">&gt;&gt;</span><span class="pln"> a </span><span class="pun">&gt;&gt;</span><span class="pln"> b</span><span class="pun">;</span><span class="pln">
        
        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">__builtin_clz</span><span class="pun">(</span><span class="pln">a</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> __builtin_clz</span><span class="pun">(</span><span class="pln">b</span><span class="pun">))</span><span class="pln"> cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"-1\n"</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">a </span><span class="pun">==</span><span class="pln"> b</span><span class="pun">)</span><span class="pln"> cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"0\n"</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">else</span><span class="pun">{</span><span class="pln">
            vector</span><span class="str">&lt;int&gt;</span><span class="pln"> val</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">31</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++){</span><span class="pln">
                </span><span class="kwd">int</span><span class="pln"> x </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="lit">1</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> i</span><span class="pun">);</span><span class="pln">
                </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">x </span><span class="pun">&lt;=</span><span class="pln"> a </span><span class="pun">&amp;&amp;</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a </span><span class="pun">&amp;</span><span class="pln"> x</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> a </span><span class="pun">+=</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> val</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">x</span><span class="pun">);</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
            </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">31</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++){</span><span class="pln">
                </span><span class="kwd">int</span><span class="pln"> x </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="lit">1</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> i</span><span class="pun">);</span><span class="pln">
                </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">x </span><span class="pun">&lt;=</span><span class="pln"> a </span><span class="pun">&amp;&amp;</span><span class="pln"> </span><span class="pun">(</span><span class="pln">b </span><span class="pun">&amp;</span><span class="pln"> x</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> val</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">x</span><span class="pun">);</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
            cout </span><span class="pun">&lt;&lt;</span><span class="pln"> val</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">auto</span><span class="pln"> z </span><span class="pun">:</span><span class="pln"> val</span><span class="pun">)</span><span class="pln"> cout </span><span class="pun">&lt;&lt;</span><span class="pln"> z </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">' '</span><span class="pun">;</span><span class="pln">
            cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2162/problem/D" title="Codeforces Round 1059 (Div. 3)">2162D - Beautiful Permutation</a></p><p>Idea: <a class="rated-user user-blue" href="https://codeforces.com/profile/wakanda-forever" title="Expert wakanda-forever">wakanda-forever</a> Preparation: <a class="rated-user user-blue" href="https://codeforces.com/profile/wakanda-forever" title="Expert wakanda-forever">wakanda-forever</a></p> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><p>We denote </p> <center><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-189"><span class="MJXp-mi" id="MJXp-Span-190">query</span><span class="MJXp-mo" id="MJXp-Span-191" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-192" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-193">1</span><span class="MJXp-mo" id="MJXp-Span-194" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-195">l</span><span class="MJXp-mo" id="MJXp-Span-196" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-197">r</span><span class="MJXp-mo" id="MJXp-Span-198" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-199" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-200"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-201" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-202" style="vertical-align: -0.4em;">l</span></span><span class="MJXp-mo" id="MJXp-Span-203" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-204"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-205" style="margin-right: 0.05em;">p</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-206" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-207">l</span><span class="MJXp-mo" id="MJXp-Span-208">+</span><span class="MJXp-mn" id="MJXp-Span-209">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-210" style="margin-left: 0em; margin-right: 0em;">⋯</span><span class="MJXp-mo" id="MJXp-Span-211" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-212"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-213" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-214" style="vertical-align: -0.4em;">r</span></span></span></span><script type="math/tex" id="MathJax-Element-45"> \operatorname{query}(1, l, r) = p_l + p_{l + 1} \dots + p_r </script></center> <center><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-215"><span class="MJXp-mi" id="MJXp-Span-216">query</span><span class="MJXp-mo" id="MJXp-Span-217" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-218" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-219">2</span><span class="MJXp-mo" id="MJXp-Span-220" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-221">l</span><span class="MJXp-mo" id="MJXp-Span-222" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-223">r</span><span class="MJXp-mo" id="MJXp-Span-224" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-225" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-226"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-227" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-228" style="vertical-align: -0.4em;">l</span></span><span class="MJXp-mo" id="MJXp-Span-229" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-230"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-231" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-232" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-233">l</span><span class="MJXp-mo" id="MJXp-Span-234">+</span><span class="MJXp-mn" id="MJXp-Span-235">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-236" style="margin-left: 0em; margin-right: 0em;">⋯</span><span class="MJXp-mo" id="MJXp-Span-237" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-238"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-239" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-240" style="vertical-align: -0.4em;">r</span></span></span></span><script type="math/tex" id="MathJax-Element-46"> \operatorname{query}(2, l, r) = a_l + a_{l + 1} \dots + a_r </script></center><p>Now, let us try to find <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-241"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-242">l</span></span></span><script type="math/tex" id="MathJax-Element-47">l</script> first.</p><p>Consider two additional arrays representing the prefix sums of the arrays <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-243"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-244">p</span></span></span><script type="math/tex" id="MathJax-Element-48">p</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-245"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-246">a</span></span></span><script type="math/tex" id="MathJax-Element-49">a</script>, defined as follows:</p> <center><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-247"><span class="MJXp-mrow" id="MJXp-Span-248"><span class="MJXp-mi" id="MJXp-Span-249">p</span><span class="MJXp-mi" id="MJXp-Span-250">r</span><span class="MJXp-mi" id="MJXp-Span-251">e</span><span class="MJXp-mi" id="MJXp-Span-252">f</span><span class="MJXp-mi" id="MJXp-Span-253">_</span><span class="MJXp-mi" id="MJXp-Span-254">s</span><span class="MJXp-mi" id="MJXp-Span-255">u</span><span class="MJXp-mi" id="MJXp-Span-256">m</span><span class="MJXp-mi" id="MJXp-Span-257">_</span><span class="MJXp-mi" id="MJXp-Span-258">p</span></span><span class="MJXp-mo" id="MJXp-Span-259" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-260">i</span><span class="MJXp-mo" id="MJXp-Span-261" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-262" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-263"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-264" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-265" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-266" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-267"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-268" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-269" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-270" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mo" id="MJXp-Span-271" style="margin-left: 0em; margin-right: 0em;">⋯</span><span class="MJXp-mo" id="MJXp-Span-272" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-273"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-274" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-275" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-276" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mspace" id="MJXp-Span-277" style="width: 1em; height: 0em;"></span><span class="MJXp-mn" id="MJXp-Span-278">1</span><span class="MJXp-mo" id="MJXp-Span-279" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-280">i</span><span class="MJXp-mo" id="MJXp-Span-281" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-282">n</span></span></span><script type="math/tex" id="MathJax-Element-50"> \mathrm{pref\_sum\_p}[i] = p_1 + p_2 + \dots + p_i, \quad 1 \le i \le n </script></center> <center><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-283"><span class="MJXp-mrow" id="MJXp-Span-284"><span class="MJXp-mi" id="MJXp-Span-285">p</span><span class="MJXp-mi" id="MJXp-Span-286">r</span><span class="MJXp-mi" id="MJXp-Span-287">e</span><span class="MJXp-mi" id="MJXp-Span-288">f</span><span class="MJXp-mi" id="MJXp-Span-289">_</span><span class="MJXp-mi" id="MJXp-Span-290">s</span><span class="MJXp-mi" id="MJXp-Span-291">u</span><span class="MJXp-mi" id="MJXp-Span-292">m</span><span class="MJXp-mi" id="MJXp-Span-293">_</span><span class="MJXp-mi" id="MJXp-Span-294">a</span></span><span class="MJXp-mo" id="MJXp-Span-295" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-296">i</span><span class="MJXp-mo" id="MJXp-Span-297" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-298" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-299"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-300" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-301" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-302" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-303"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-304" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-305" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-306" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mo" id="MJXp-Span-307" style="margin-left: 0em; margin-right: 0em;">⋯</span><span class="MJXp-mo" id="MJXp-Span-308" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-309"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-310" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-311" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-312" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mspace" id="MJXp-Span-313" style="width: 1em; height: 0em;"></span><span class="MJXp-mn" id="MJXp-Span-314">1</span><span class="MJXp-mo" id="MJXp-Span-315" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-316">i</span><span class="MJXp-mo" id="MJXp-Span-317" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-318">n</span></span></span><script type="math/tex" id="MathJax-Element-51"> \mathrm{pref\_sum\_a}[i] = a_1 + a_2 + \dots + a_i, \quad 1 \le i \le n </script></center><p>Analysing these, we can say that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-319"><span class="MJXp-mtext" id="MJXp-Span-320">pref_sum_a</span><span class="MJXp-mo" id="MJXp-Span-321" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-322">i</span><span class="MJXp-mo" id="MJXp-Span-323" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-324" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mtext" id="MJXp-Span-325">pref_sum_p</span><span class="MJXp-mo" id="MJXp-Span-326" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-327">i</span><span class="MJXp-mo" id="MJXp-Span-328" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-52">\text{pref_sum_a}[i] \ge \text{pref_sum_p}[i]</script> for all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-329"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-330">i</span></span></span><script type="math/tex" id="MathJax-Element-53">i</script>. In fact, the inequality holds true only when <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-331"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-332">l</span><span class="MJXp-mo" id="MJXp-Span-333" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-334">i</span><span class="MJXp-mo" id="MJXp-Span-335" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-336">n</span></span></span><script type="math/tex" id="MathJax-Element-54">l \le i \le n</script>.</p><p>Thus, we can binary search for <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-337"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-338">l</span></span></span><script type="math/tex" id="MathJax-Element-55">l</script>.</p><p>At each stage, we make <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-339"><span class="MJXp-mn" id="MJXp-Span-340">2</span></span></span><script type="math/tex" id="MathJax-Element-56">2</script> queries <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-341"><span class="MJXp-mi" id="MJXp-Span-342">query</span><span class="MJXp-mo" id="MJXp-Span-343" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-344" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-345">1</span><span class="MJXp-mo" id="MJXp-Span-346" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-347">1</span><span class="MJXp-mo" id="MJXp-Span-348" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mtext" id="MJXp-Span-349">mid</span><span class="MJXp-mo" id="MJXp-Span-350" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-57">\operatorname{query}(1, 1, \text{mid})</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-351"><span class="MJXp-mi" id="MJXp-Span-352">query</span><span class="MJXp-mo" id="MJXp-Span-353" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-354" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-355">2</span><span class="MJXp-mo" id="MJXp-Span-356" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-357">1</span><span class="MJXp-mo" id="MJXp-Span-358" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mtext" id="MJXp-Span-359">mid</span><span class="MJXp-mo" id="MJXp-Span-360" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-58">\operatorname{query}(2, 1, \text{mid})</script>, and by comparing these, we can adjust <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-361"><span class="MJXp-mtext" id="MJXp-Span-362">left</span></span></span><script type="math/tex" id="MathJax-Element-59">\text{left}</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-363"><span class="MJXp-mtext" id="MJXp-Span-364">right</span></span></span><script type="math/tex" id="MathJax-Element-60">\text{right}</script> in binary search.</p><p>We can also find <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-365"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-366">r</span></span></span><script type="math/tex" id="MathJax-Element-61">r</script> by querying suffixes in a similar way, but that would take a total of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-367"><span class="MJXp-mn" id="MJXp-Span-368">4</span><span class="MJXp-mo" id="MJXp-Span-369" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mo" id="MJXp-Span-370" style="margin-left: 0em; margin-right: 0em;">⌈</span><span class="MJXp-msubsup" id="MJXp-Span-371"><span class="MJXp-mi" id="MJXp-Span-372" style="margin-right: 0.05em;">log</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-373" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-374" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-375" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-376">n</span><span class="MJXp-mo" id="MJXp-Span-377" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-378" style="margin-left: 0em; margin-right: 0em;">⌉</span></span></span><script type="math/tex" id="MathJax-Element-62">4 \cdot \lceil \log_2(n) \rceil</script> queries. This exceeds the query limit.</p><p>Instead, we can query the whole array once and find <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-379"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-380">r</span></span></span><script type="math/tex" id="MathJax-Element-63">r</script>. In other words, </p> <center><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-381"><span class="MJXp-mi" id="MJXp-Span-382">query</span><span class="MJXp-mo" id="MJXp-Span-383" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-384" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-385">2</span><span class="MJXp-mo" id="MJXp-Span-386" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-387">1</span><span class="MJXp-mo" id="MJXp-Span-388" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-389">n</span><span class="MJXp-mo" id="MJXp-Span-390" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-391" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi" id="MJXp-Span-392">query</span><span class="MJXp-mo" id="MJXp-Span-393" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-394" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-395">1</span><span class="MJXp-mo" id="MJXp-Span-396" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-397">1</span><span class="MJXp-mo" id="MJXp-Span-398" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-399">n</span><span class="MJXp-mo" id="MJXp-Span-400" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-401" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-402">r</span><span class="MJXp-mo" id="MJXp-Span-403" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-404">l</span><span class="MJXp-mo" id="MJXp-Span-405" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-406">1</span></span></span><script type="math/tex" id="MathJax-Element-64"> \operatorname{query}(2, 1, n) - \operatorname{query}(1, 1, n) = r - l + 1 </script></center><p>So, after finding <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-407"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-408">l</span></span></span><script type="math/tex" id="MathJax-Element-65">l</script>, we can find <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-409"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-410">r</span></span></span><script type="math/tex" id="MathJax-Element-66">r</script> in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-411"><span class="MJXp-mn" id="MJXp-Span-412">2</span></span></span><script type="math/tex" id="MathJax-Element-67">2</script> queries. Total queries will be equal to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-413"><span class="MJXp-mn" id="MJXp-Span-414">2</span><span class="MJXp-mo" id="MJXp-Span-415" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mo" id="MJXp-Span-416" style="margin-left: 0em; margin-right: 0em;">⌈</span><span class="MJXp-msubsup" id="MJXp-Span-417"><span class="MJXp-mi" id="MJXp-Span-418" style="margin-right: 0.05em;">log</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-419" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-420" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-421" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-422">n</span><span class="MJXp-mo" id="MJXp-Span-423" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-424" style="margin-left: 0em; margin-right: 0em;">⌉</span><span class="MJXp-mo" id="MJXp-Span-425" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-426">2</span></span></span><script type="math/tex" id="MathJax-Element-68">2 \cdot \lceil \log_2(n) \rceil + 2</script> (<span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-427"><span class="MJXp-mo" id="MJXp-Span-428" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mn" id="MJXp-Span-429">40</span></span></span><script type="math/tex" id="MathJax-Element-69"> < 40</script>).</p><p>Time Complexity: <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-430"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-431">O</span><span class="MJXp-mo" id="MJXp-Span-432" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-433"><span class="MJXp-mi" id="MJXp-Span-434" style="margin-right: 0.05em;">log</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-435" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-436" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-437" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-438">n</span><span class="MJXp-mo" id="MJXp-Span-439" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-440" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-70">O(\log_2(n))</script> per testcase.</p></div></div> <div class="spoiler"><b class="spoiler-title">Implementation</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">

</span><span class="com">#define</span><span class="pln"> ll </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pln">

ll query</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> type</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> l</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> r</span><span class="pun">){</span><span class="pln">
    ll x</span><span class="pun">;</span><span class="pln">
    cout </span><span class="pun">&lt;&lt;</span><span class="pln"> type </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">' '</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> l </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">' '</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> r </span><span class="pun">&lt;&lt;</span><span class="pln"> flush </span><span class="pun">&lt;&lt;</span><span class="pln"> endl</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> x</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> x</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">(){</span><span class="pln">
 
    </span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
 
    </span><span class="kwd">while</span><span class="pun">(</span><span class="pln">t</span><span class="pun">--){</span><span class="pln">
        
        </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
        cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">

        ll sum </span><span class="pun">=</span><span class="pln"> query</span><span class="pun">(</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> n</span><span class="pun">);</span><span class="pln">
        sum </span><span class="pun">-=</span><span class="pln"> </span><span class="pun">((</span><span class="pln">n </span><span class="pun">*</span><span class="pln"> </span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">))</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pun">);</span><span class="pln">

        ll diff </span><span class="pun">=</span><span class="pln"> sum </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">

        </span><span class="kwd">int</span><span class="pln"> l </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> r </span><span class="pun">=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">

        </span><span class="kwd">while</span><span class="pun">(</span><span class="pln">l </span><span class="pun">&lt;</span><span class="pln"> r</span><span class="pun">){</span><span class="pln">
            </span><span class="kwd">int</span><span class="pln"> md </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l </span><span class="pun">+</span><span class="pln"> r</span><span class="pun">)</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln">
            ll val1 </span><span class="pun">=</span><span class="pln"> query</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> md</span><span class="pun">);</span><span class="pln">
            ll val2 </span><span class="pun">=</span><span class="pln"> query</span><span class="pun">(</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> md</span><span class="pun">);</span><span class="pln">

            </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">val1 </span><span class="pun">&lt;</span><span class="pln"> val2</span><span class="pun">)</span><span class="pln"> r </span><span class="pun">=</span><span class="pln"> md</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">else</span><span class="pln"> l </span><span class="pun">=</span><span class="pln"> md </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">        

        cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"!"</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">' '</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> l </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">' '</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> diff </span><span class="pun">+</span><span class="pln"> l </span><span class="pun">&lt;&lt;</span><span class="pln"> flush </span><span class="pun">&lt;&lt;</span><span class="pln"> endl</span><span class="pun">;</span><span class="pln">

    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2162/problem/E" title="Codeforces Round 1059 (Div. 3)">2162E - Beautiful Palindromes</a></p><p>Idea: <a class="rated-user user-orange" href="https://codeforces.com/profile/wuhudsm" title="Master wuhudsm">wuhudsm</a> Preparation: <a class="rated-user user-blue" href="https://codeforces.com/profile/wakanda-forever" title="Expert wakanda-forever">wakanda-forever</a></p> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><p>Instead of carefully choosing all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-441"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-442">k</span></span></span><script type="math/tex" id="MathJax-Element-71">k</script> elements individually, it is sufficient to pick <b>three distinct integers</b> <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-443"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-444">x</span></span></span><script type="math/tex" id="MathJax-Element-72">x</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-445"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-446">y</span></span></span><script type="math/tex" id="MathJax-Element-73">y</script>, and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-447"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-448">z</span></span></span><script type="math/tex" id="MathJax-Element-74">z</script> and repeat them cyclically — that is, append</p> <center><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-449"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-450">x</span><span class="MJXp-mo" id="MJXp-Span-451" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-452">y</span><span class="MJXp-mo" id="MJXp-Span-453" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-454">z</span><span class="MJXp-mo" id="MJXp-Span-455" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-456">x</span><span class="MJXp-mo" id="MJXp-Span-457" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-458">y</span><span class="MJXp-mo" id="MJXp-Span-459" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-460">z</span><span class="MJXp-mo" id="MJXp-Span-461" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-462" style="margin-left: 0em; margin-right: 0em;">…</span></span></span><script type="math/tex" id="MathJax-Element-75">x, y, z, x, y, z, \dots</script></center><p>until we perform <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-463"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-464">k</span></span></span><script type="math/tex" id="MathJax-Element-76">k</script> operations. For <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-465"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-466">n</span><span class="MJXp-mo" id="MJXp-Span-467" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mn" id="MJXp-Span-468">3</span></span></span><script type="math/tex" id="MathJax-Element-77">n \ge 3</script>, we can always find such <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-469"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-470">x</span></span></span><script type="math/tex" id="MathJax-Element-78">x</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-471"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-472">y</span></span></span><script type="math/tex" id="MathJax-Element-79">y</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-473"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-474">z</span></span></span><script type="math/tex" id="MathJax-Element-80">z</script> that add no extra palindromic subarrays.</p><p>Now let's try to find such integers <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-475"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-476">x</span></span></span><script type="math/tex" id="MathJax-Element-81">x</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-477"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-478">y</span></span></span><script type="math/tex" id="MathJax-Element-82">y</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-479"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-480">z</span></span></span><script type="math/tex" id="MathJax-Element-83">z</script>. There will be two cases.</p><p><b>Case 1</b>: <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-481"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-482">a</span></span></span><script type="math/tex" id="MathJax-Element-84">a</script> is a permutation of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-483"><span class="MJXp-mrow" id="MJXp-Span-484"><span class="MJXp-mn" id="MJXp-Span-485">1</span><span class="MJXp-mo" id="MJXp-Span-486" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-487">2</span><span class="MJXp-mo" id="MJXp-Span-488" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-489">3</span><span class="MJXp-mo" id="MJXp-Span-490" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-491" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-492" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-493">n</span></span></span></span><script type="math/tex" id="MathJax-Element-85">{1,2,3, \dots ,n}</script>.</p><p>If the array <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-494"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-495">a</span></span></span><script type="math/tex" id="MathJax-Element-86">a</script> is a permutation, we can simply choose the first three elements of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-496"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-497">a</span></span></span><script type="math/tex" id="MathJax-Element-87">a</script> for the construction. That is, let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-498"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-499">x</span><span class="MJXp-mo" id="MJXp-Span-500" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-501"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-502" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-503" style="vertical-align: -0.4em;">1</span></span></span></span><script type="math/tex" id="MathJax-Element-88">x = a_1</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-504"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-505">y</span><span class="MJXp-mo" id="MJXp-Span-506" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-507"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-508" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-509" style="vertical-align: -0.4em;">2</span></span></span></span><script type="math/tex" id="MathJax-Element-89">y = a_2</script>, and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-510"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-511">z</span><span class="MJXp-mo" id="MJXp-Span-512" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-513"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-514" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-515" style="vertical-align: -0.4em;">3</span></span></span></span><script type="math/tex" id="MathJax-Element-90">z = a_3</script>. Since all elements in a permutation are distinct, these choices guarantee that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-516"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-517">x</span></span></span><script type="math/tex" id="MathJax-Element-91">x</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-518"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-519">y</span></span></span><script type="math/tex" id="MathJax-Element-92">y</script>, and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-520"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-521">z</span></span></span><script type="math/tex" id="MathJax-Element-93">z</script> are distinct and add no extra palindromic subarrays.</p><p><b>Case 2</b>: <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-522"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-523">a</span></span></span><script type="math/tex" id="MathJax-Element-94">a</script> is not a permutation of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-524"><span class="MJXp-mrow" id="MJXp-Span-525"><span class="MJXp-mn" id="MJXp-Span-526">1</span><span class="MJXp-mo" id="MJXp-Span-527" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-528">2</span><span class="MJXp-mo" id="MJXp-Span-529" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-530">3</span><span class="MJXp-mo" id="MJXp-Span-531" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-532" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-533" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-534">n</span></span></span></span><script type="math/tex" id="MathJax-Element-95">{1,2,3, \dots ,n}</script>.</p><p>If the array <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-535"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-536">a</span></span></span><script type="math/tex" id="MathJax-Element-96">a</script> is not a permutation, we can choose <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-537"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-538">x</span></span></span><script type="math/tex" id="MathJax-Element-97">x</script> to be any integer that does not appear in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-539"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-540">a</span></span></span><script type="math/tex" id="MathJax-Element-98">a</script>. Let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-541"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-542">z</span></span></span><script type="math/tex" id="MathJax-Element-99">z</script> be the last element of the array, and choose <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-543"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-544">y</span></span></span><script type="math/tex" id="MathJax-Element-100">y</script> as any integer different from both <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-545"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-546">x</span></span></span><script type="math/tex" id="MathJax-Element-101">x</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-547"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-548">z</span></span></span><script type="math/tex" id="MathJax-Element-102">z</script>. These three numbers will always be distinct and add no extra palindromic subarrays.</p><p>Time Complexity: <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-549"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-550">O</span><span class="MJXp-mo" id="MJXp-Span-551" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-552">n</span><span class="MJXp-mo" id="MJXp-Span-553" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-554">k</span><span class="MJXp-mo" id="MJXp-Span-555" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-103">O(n + k)</script> per testcase.</p></div></div> <div class="spoiler"><b class="spoiler-title">Implementation</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">(){</span><span class="pln">
 
    </span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
 
    </span><span class="kwd">while</span><span class="pun">(</span><span class="pln">t</span><span class="pun">--){</span><span class="pln">
        
        </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> k</span><span class="pun">;</span><span class="pln">
        cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n </span><span class="pun">&gt;&gt;</span><span class="pln"> k</span><span class="pun">;</span><span class="pln">

        vector</span><span class="str">&lt;int&gt;</span><span class="pln"> a</span><span class="pun">(</span><span class="pln">n</span><span class="pun">),</span><span class="pln"> cnt</span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> cin </span><span class="pun">&gt;&gt;</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">],</span><span class="pln"> cnt</span><span class="pun">[</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]]++;</span><span class="pln">

        </span><span class="kwd">int</span><span class="pln"> x </span><span class="pun">=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">cnt</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">){</span><span class="pln">
            x </span><span class="pun">=</span><span class="pln"> i</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">

        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">x </span><span class="pun">==</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">){</span><span class="pln">
            </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> k</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> cout </span><span class="pun">&lt;&lt;</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">n </span><span class="pun">-</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="pun">%</span><span class="pln"> </span><span class="lit">3</span><span class="pun">)]</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">' '</span><span class="pun">;</span><span class="pln">
            cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">else</span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">int</span><span class="pln"> y </span><span class="pun">=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">i </span><span class="pun">!=</span><span class="pln"> x </span><span class="pun">&amp;&amp;</span><span class="pln"> i </span><span class="pun">!=</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">n </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]){</span><span class="pln">
                y </span><span class="pun">=</span><span class="pln"> i</span><span class="pun">;</span><span class="pln">
                </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
            vector</span><span class="str">&lt;int&gt;</span><span class="pln"> v </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">x</span><span class="pun">,</span><span class="pln"> y</span><span class="pun">,</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">n </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]};</span><span class="pln">
            </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> k</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> cout </span><span class="pun">&lt;&lt;</span><span class="pln"> v</span><span class="pun">[</span><span class="pln">i </span><span class="pun">%</span><span class="pln"> </span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">' '</span><span class="pun">;</span><span class="pln">
            cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">

    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2162/problem/F" title="Codeforces Round 1059 (Div. 3)">2162F - Beautiful Intervals</a></p><p>Idea: <a class="rated-user user-gray" href="https://codeforces.com/profile/tamzid1" title="Newbie tamzid1">tamzid1</a>, <a class="rated-user user-orange" href="https://codeforces.com/profile/wuhudsm" title="Master wuhudsm">wuhudsm</a>, <a class="rated-user user-blue" href="https://codeforces.com/profile/wakanda-forever" title="Expert wakanda-forever">wakanda-forever</a> Preparation: <a class="rated-user user-blue" href="https://codeforces.com/profile/wakanda-forever" title="Expert wakanda-forever">wakanda-forever</a></p> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><p>Note that if <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-556"><span class="MJXp-mo" id="MJXp-Span-557" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mn" id="MJXp-Span-558">0</span><span class="MJXp-mo" id="MJXp-Span-559" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-560">2</span><span class="MJXp-mo" id="MJXp-Span-561" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-562">1</span><span class="MJXp-mo" id="MJXp-Span-563" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-104">[0,2,1]</script> is a subsequence of permutation <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-564"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-565">p</span></span></span><script type="math/tex" id="MathJax-Element-105">p</script>, any interval that includes <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-566"><span class="MJXp-mn" id="MJXp-Span-567">0</span></span></span><script type="math/tex" id="MathJax-Element-106">0</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-568"><span class="MJXp-mn" id="MJXp-Span-569">1</span></span></span><script type="math/tex" id="MathJax-Element-107">1</script> must also include <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-570"><span class="MJXp-mn" id="MJXp-Span-571">2</span></span></span><script type="math/tex" id="MathJax-Element-108">2</script>. This implies that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-572"><span class="MJXp-mi" id="MJXp-Span-573">mex</span></span></span><script type="math/tex" id="MathJax-Element-109">\operatorname{mex}</script> of any interval will not be equal to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-574"><span class="MJXp-mn" id="MJXp-Span-575">2</span></span></span><script type="math/tex" id="MathJax-Element-110">2</script>. So, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-576"><span class="MJXp-mn" id="MJXp-Span-577">2</span><span class="MJXp-mo" id="MJXp-Span-578" style="margin-left: 0.333em; margin-right: 0.333em;">∉</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-579">M</span></span></span><script type="math/tex" id="MathJax-Element-111">2 \notin M</script>. Hence, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-580"><span class="MJXp-mi" id="MJXp-Span-581">mex</span><span class="MJXp-mo" id="MJXp-Span-582" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-583" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-584">M</span><span class="MJXp-mo" id="MJXp-Span-585" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-586" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mn" id="MJXp-Span-587">2</span></span></span><script type="math/tex" id="MathJax-Element-112">\operatorname{mex}(M) \le 2</script>.</p><p>Thus, we can always ensure that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-588"><span class="MJXp-mi" id="MJXp-Span-589">mex</span><span class="MJXp-mo" id="MJXp-Span-590" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-591" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-592">M</span><span class="MJXp-mo" id="MJXp-Span-593" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-594" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mn" id="MJXp-Span-595">2</span></span></span><script type="math/tex" id="MathJax-Element-113">\operatorname{mex}(M) \le 2</script>. Now, we only need to check when <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-596"><span class="MJXp-mi" id="MJXp-Span-597">mex</span><span class="MJXp-mo" id="MJXp-Span-598" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-599" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-600">M</span><span class="MJXp-mo" id="MJXp-Span-601" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-602" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-603">0</span></span></span><script type="math/tex" id="MathJax-Element-114">\operatorname{mex}(M) = 0</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-604"><span class="MJXp-mi" id="MJXp-Span-605">mex</span><span class="MJXp-mo" id="MJXp-Span-606" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-607" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-608">M</span><span class="MJXp-mo" id="MJXp-Span-609" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-610" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-611">1</span></span></span><script type="math/tex" id="MathJax-Element-115">\operatorname{mex}(M) = 1</script> are possible.</p><p>For <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-612"><span class="MJXp-mi" id="MJXp-Span-613">mex</span><span class="MJXp-mo" id="MJXp-Span-614" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-615" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-616">M</span><span class="MJXp-mo" id="MJXp-Span-617" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-116">\operatorname{mex}(M)</script> to be equal to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-618"><span class="MJXp-mn" id="MJXp-Span-619">0</span></span></span><script type="math/tex" id="MathJax-Element-117">0</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-620"><span class="MJXp-mi" id="MJXp-Span-621">mex</span></span></span><script type="math/tex" id="MathJax-Element-118">\operatorname{mex}</script> of every interval must be positive. So, every interval must include <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-622"><span class="MJXp-mn" id="MJXp-Span-623">0</span></span></span><script type="math/tex" id="MathJax-Element-119">0</script>. This is possible only when all intervals intersect at a common point — that is, there exists at least one point that lies within every interval. Then we place <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-624"><span class="MJXp-mn" id="MJXp-Span-625">0</span></span></span><script type="math/tex" id="MathJax-Element-120">0</script> at some common point and fill the remaining permutation.</p><p>Otherwise, for <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-626"><span class="MJXp-mi" id="MJXp-Span-627">mex</span><span class="MJXp-mo" id="MJXp-Span-628" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-629" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-630">M</span><span class="MJXp-mo" id="MJXp-Span-631" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-121">\operatorname{mex}(M)</script> to be equal to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-632"><span class="MJXp-mn" id="MJXp-Span-633">1</span></span></span><script type="math/tex" id="MathJax-Element-122">1</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-634"><span class="MJXp-mi" id="MJXp-Span-635">mex</span></span></span><script type="math/tex" id="MathJax-Element-123">\operatorname{mex}</script> of each interval must not be equal to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-636"><span class="MJXp-mn" id="MJXp-Span-637">1</span></span></span><script type="math/tex" id="MathJax-Element-124">1</script>. To ensure this, we have to place <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-638"><span class="MJXp-mn" id="MJXp-Span-639">0</span></span></span><script type="math/tex" id="MathJax-Element-125">0</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-640"><span class="MJXp-mn" id="MJXp-Span-641">1</span></span></span><script type="math/tex" id="MathJax-Element-126">1</script> in such a way that if an interval includes <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-642"><span class="MJXp-mn" id="MJXp-Span-643">0</span></span></span><script type="math/tex" id="MathJax-Element-127">0</script>, it must also include <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-644"><span class="MJXp-mn" id="MJXp-Span-645">1</span></span></span><script type="math/tex" id="MathJax-Element-128">1</script>. This is possible if there exists a point that is not simultaneously the starting point of one interval and the ending point of another. In other words, we should be able to find a position that does not act as both a left and a right boundary. Then we place <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-646"><span class="MJXp-mn" id="MJXp-Span-647">0</span></span></span><script type="math/tex" id="MathJax-Element-129">0</script> at such a point and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-648"><span class="MJXp-mn" id="MJXp-Span-649">1</span></span></span><script type="math/tex" id="MathJax-Element-130">1</script> adjacent to it.</p><p>Else, we place <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-650"><span class="MJXp-mo" id="MJXp-Span-651" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mn" id="MJXp-Span-652">0</span><span class="MJXp-mo" id="MJXp-Span-653" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-654">2</span><span class="MJXp-mo" id="MJXp-Span-655" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-656">1</span><span class="MJXp-mo" id="MJXp-Span-657" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-131">[0,2,1]</script> as a subsequence first and then build the remaining permutation.</p><p>Time Complexity: <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-658"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-659">O</span><span class="MJXp-mo" id="MJXp-Span-660" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-661">n</span><span class="MJXp-mo" id="MJXp-Span-662" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-663">m</span><span class="MJXp-mo" id="MJXp-Span-664" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-132">O(n + m)</script> per testcase.</p></div></div> <div class="spoiler"><b class="spoiler-title">Implementation</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
</span><span class="com">#define</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pln">
</span><span class="com">#define</span><span class="pln"> INF </span><span class="pun">(</span><span class="kwd">int</span><span class="pun">)</span><span class="lit">1e18</span><span class="pln">

</span><span class="kwd">void</span><span class="pln"> </span><span class="typ">Solve</span><span class="pun">()</span><span class="pln"> 
</span><span class="pun">{</span><span class="pln">
    
    </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> m</span><span class="pun">;</span><span class="pln"> cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n </span><span class="pun">&gt;&gt;</span><span class="pln"> m</span><span class="pun">;</span><span class="pln">
    
    vector </span><span class="str">&lt;int&gt;</span><span class="pln"> l</span><span class="pun">(</span><span class="pln">m</span><span class="pun">),</span><span class="pln"> r</span><span class="pun">(</span><span class="pln">m</span><span class="pun">),</span><span class="pln"> f</span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">),</span><span class="pln"> st</span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">),</span><span class="pln"> en</span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> m</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++){</span><span class="pln">
        cin </span><span class="pun">&gt;&gt;</span><span class="pln"> l</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&gt;&gt;</span><span class="pln"> r</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
        st</span><span class="pun">[</span><span class="pln">l</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
        en</span><span class="pun">[</span><span class="pln">r</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> l</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln"> j </span><span class="pun">&lt;=</span><span class="pln"> r</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln"> j</span><span class="pun">++){</span><span class="pln">
            f</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]++;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    
    vector </span><span class="str">&lt;int&gt;</span><span class="pln"> ans</span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">);</span><span class="pln">
    
    </span><span class="kwd">auto</span><span class="pln"> fill </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[&amp;](){</span><span class="pln">
        vector </span><span class="str">&lt;bool&gt;</span><span class="pln"> used</span><span class="pun">(</span><span class="pln">n</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">ans</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> used</span><span class="pun">[</span><span class="pln">ans</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
        
        </span><span class="kwd">int</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++){</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">ans</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">){</span><span class="pln">
                </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">used</span><span class="pun">[</span><span class="pln">p</span><span class="pun">])</span><span class="pln"> p</span><span class="pun">++;</span><span class="pln">
                
                ans</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> p</span><span class="pun">;</span><span class="pln">
                used</span><span class="pun">[</span><span class="pln">p</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++){</span><span class="pln">
            cout </span><span class="pun">&lt;&lt;</span><span class="pln"> ans</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">" \n"</span><span class="pun">[</span><span class="pln">i </span><span class="pun">==</span><span class="pln"> n</span><span class="pun">];</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">};</span><span class="pln">
    
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++){</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">f</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> m</span><span class="pun">){</span><span class="pln">
            </span><span class="kwd">int</span><span class="pln"> ptr </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
            ans</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
            
            fill</span><span class="pun">();</span><span class="pln">
            </span><span class="kwd">return</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++){</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">en</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">){</span><span class="pln">
            ans</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
            ans</span><span class="pun">[</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
            fill</span><span class="pun">();</span><span class="pln">
            </span><span class="kwd">return</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">st</span><span class="pun">[</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">){</span><span class="pln">
            ans</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
            ans</span><span class="pun">[</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
            fill</span><span class="pun">();</span><span class="pln">
            </span><span class="kwd">return</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    
    </span><span class="kwd">assert</span><span class="pun">(</span><span class="pln">n </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">3</span><span class="pun">);</span><span class="pln">
    ans</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    ans</span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln">
    ans</span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
    
    fill</span><span class="pun">();</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="typ">int32_t</span><span class="pln"> main</span><span class="pun">()</span><span class="pln"> 
</span><span class="pun">{</span><span class="pln">
    ios_base</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> t </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> t</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> 
    </span><span class="pun">{</span><span class="pln">
        </span><span class="typ">Solve</span><span class="pun">();</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    
    </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2162/problem/G" title="Codeforces Round 1059 (Div. 3)">2162G - Beautiful Tree</a></p><p>Idea: <a class="rated-user user-blue" href="https://codeforces.com/profile/wakanda-forever" title="Expert wakanda-forever">wakanda-forever</a> Preparation: <a class="rated-user user-blue" href="https://codeforces.com/profile/wakanda-forever" title="Expert wakanda-forever">wakanda-forever</a></p> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><p>We have to construct a tree with <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-665"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-666">n</span></span></span><script type="math/tex" id="MathJax-Element-133">n</script> vertices such that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-667"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-668">S</span><span class="MJXp-mo" id="MJXp-Span-669" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-670"><span class="MJXp-mo" id="MJXp-Span-671" style="margin-left: 0.111em; margin-right: 0.05em;">∑</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-672" style="vertical-align: -0.4em;"><span class="MJXp-mrow" id="MJXp-Span-673"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-674">u</span><span class="MJXp-mo" id="MJXp-Span-675">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-676">v</span></span><span class="MJXp-mo" id="MJXp-Span-677">∈</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-678">E</span></span></span><span class="MJXp-mo" id="MJXp-Span-679" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-680">u</span><span class="MJXp-mo" id="MJXp-Span-681" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-682">v</span><span class="MJXp-mo" id="MJXp-Span-683" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-134">S = \sum_{{u, v} \in E} (u \cdot v)</script> is a perfect square.</p><p>Instead of making it any random perfect square, let's try to make <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-684"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-685">S</span><span class="MJXp-mo" id="MJXp-Span-686" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-687" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-688">f</span><span class="MJXp-mo" id="MJXp-Span-689" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-690">n</span><span class="MJXp-mo" id="MJXp-Span-691" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-msubsup" id="MJXp-Span-692"><span class="MJXp-mo" id="MJXp-Span-693" style="margin-left: 0em; margin-right: 0.05em;">)</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-694" style="vertical-align: 0.5em;">2</span></span></span></span><script type="math/tex" id="MathJax-Element-135">S = (f(n))^2</script> where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-695"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-696">f</span><span class="MJXp-mo" id="MJXp-Span-697" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-698">n</span><span class="MJXp-mo" id="MJXp-Span-699" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-136">f(n)</script> is an integer function of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-700"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-701">n</span></span></span><script type="math/tex" id="MathJax-Element-137">n</script>.</p><p>Now, let's check if we can make <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-702"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-703">f</span><span class="MJXp-mo" id="MJXp-Span-704" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-705">n</span><span class="MJXp-mo" id="MJXp-Span-706" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-707" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-708">n</span></span></span><script type="math/tex" id="MathJax-Element-138">f(n) = n</script>. For <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-709"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-710">n</span><span class="MJXp-mo" id="MJXp-Span-711" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-712">5</span></span></span><script type="math/tex" id="MathJax-Element-139">n = 5</script>, we can consider the following tree</p> <center><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-713"><span class="MJXp-mn" id="MJXp-Span-714">5</span><span class="MJXp-mo" id="MJXp-Span-715" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-716">1</span><span class="MJXp-mo" id="MJXp-Span-717" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-718">2</span><span class="MJXp-mo" id="MJXp-Span-719" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-720">3</span><span class="MJXp-mo" id="MJXp-Span-721" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-722">4</span></span></span><script type="math/tex" id="MathJax-Element-140">5-1-2-3-4</script></center><p>where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-723"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-724">S</span><span class="MJXp-mo" id="MJXp-Span-725" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-726">25</span><span class="MJXp-mo" id="MJXp-Span-727" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-728" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-729">5</span><span class="MJXp-msubsup" id="MJXp-Span-730"><span class="MJXp-mo" id="MJXp-Span-731" style="margin-left: 0em; margin-right: 0.05em;">)</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-732" style="vertical-align: 0.5em;">2</span></span></span></span><script type="math/tex" id="MathJax-Element-141">S = 25 = (5)^2</script>.</p><p>Now that we know we have a tree <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-733"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-734">T</span></span></span><script type="math/tex" id="MathJax-Element-142">T</script> with <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-735"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-736">n</span></span></span><script type="math/tex" id="MathJax-Element-143">n</script> (<span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-737"><span class="MJXp-mo" id="MJXp-Span-738" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-739">5</span></span></span><script type="math/tex" id="MathJax-Element-144">=5</script>) vertices having <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-740"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-741">S</span><span class="MJXp-mo" id="MJXp-Span-742" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-743"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-744" style="margin-right: 0.05em;">n</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-745" style="vertical-align: 0.5em;">2</span></span></span></span><script type="math/tex" id="MathJax-Element-145">S = n^2</script>. Using this, let's try to make a tree <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-746"><span class="MJXp-msup" id="MJXp-Span-747"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-748" style="margin-right: 0.05em;">T</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-749" style="vertical-align: 0.5em;">′</span></span></span></span><script type="math/tex" id="MathJax-Element-146">T'</script> with <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-750"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-751">n</span><span class="MJXp-mo" id="MJXp-Span-752" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-753">1</span></span></span><script type="math/tex" id="MathJax-Element-147">n + 1</script> vertices such that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-754"><span class="MJXp-msup" id="MJXp-Span-755"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-756" style="margin-right: 0.05em;">S</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-757" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-758" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-759" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-760">n</span><span class="MJXp-mo" id="MJXp-Span-761" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-762">1</span><span class="MJXp-msubsup" id="MJXp-Span-763"><span class="MJXp-mo" id="MJXp-Span-764" style="margin-left: 0em; margin-right: 0.05em;">)</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-765" style="vertical-align: 0.5em;">2</span></span></span></span><script type="math/tex" id="MathJax-Element-148">S' = (n + 1)^2</script>. Note that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-766"><span class="MJXp-msup" id="MJXp-Span-767"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-768" style="margin-right: 0.05em;">S</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-769" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-770" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-771">S</span><span class="MJXp-mo" id="MJXp-Span-772" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-773">2</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-774">n</span><span class="MJXp-mo" id="MJXp-Span-775" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-776">1</span></span></span><script type="math/tex" id="MathJax-Element-149">S' - S = 2n + 1</script>. So, while constructing <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-777"><span class="MJXp-msup" id="MJXp-Span-778"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-779" style="margin-right: 0.05em;">T</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-780" style="vertical-align: 0.5em;">′</span></span></span></span><script type="math/tex" id="MathJax-Element-150">T'</script>, we have to add a new vertex <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-781"><span class="MJXp-mo" id="MJXp-Span-782" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-783">n</span><span class="MJXp-mo" id="MJXp-Span-784" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-785">1</span><span class="MJXp-mo" id="MJXp-Span-786" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-151">(n + 1)</script> and also adjust this extra sum <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-787"><span class="MJXp-mn" id="MJXp-Span-788">2</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-789">n</span><span class="MJXp-mo" id="MJXp-Span-790" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-791">1</span></span></span><script type="math/tex" id="MathJax-Element-152">2n + 1</script>.</p><p>We can achieve this in the following manner:</p> <ul>   <li>add an edge between <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-792"><span class="MJXp-mn" id="MJXp-Span-793">1</span></span></span><script type="math/tex" id="MathJax-Element-153">1</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-794"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-795">n</span><span class="MJXp-mo" id="MJXp-Span-796" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-797">1</span></span></span><script type="math/tex" id="MathJax-Element-154">n + 1</script>,</li>   <li>remove the edge between <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-798"><span class="MJXp-mn" id="MJXp-Span-799">1</span></span></span><script type="math/tex" id="MathJax-Element-155">1</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-800"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-801">n</span></span></span><script type="math/tex" id="MathJax-Element-156">n</script>,</li>   <li>add an edge between <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-802"><span class="MJXp-mn" id="MJXp-Span-803">2</span></span></span><script type="math/tex" id="MathJax-Element-157">2</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-804"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-805">n</span></span></span><script type="math/tex" id="MathJax-Element-158">n</script>.</li> </ul><p>This analogy can be extended for all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-806"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-807">n</span><span class="MJXp-mo" id="MJXp-Span-808" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mn" id="MJXp-Span-809">5</span></span></span><script type="math/tex" id="MathJax-Element-159">n \ge 5</script>. Such trees have the following structure:</p> <p align="center">   <img src="https://codeforces.com/predownloaded/8a/88/8a88f790f81cf65182f36cf963f910ef0c9a3c54.png" style="max-width: 100.0%;max-height: 100.0%;"> </p><p>So, we can always make <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-810"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-811">S</span><span class="MJXp-mo" id="MJXp-Span-812" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-813"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-814" style="margin-right: 0.05em;">n</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-815" style="vertical-align: 0.5em;">2</span></span></span></span><script type="math/tex" id="MathJax-Element-160">S = n^2</script> for all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-816"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-817">n</span><span class="MJXp-mo" id="MJXp-Span-818" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mn" id="MJXp-Span-819">5</span></span></span><script type="math/tex" id="MathJax-Element-161">n \ge 5</script>. For <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-820"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-821">n</span><span class="MJXp-mo" id="MJXp-Span-822" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mn" id="MJXp-Span-823">5</span></span></span><script type="math/tex" id="MathJax-Element-162">n < 5</script>, we can just print sample outputs.</p><p>One can also assume <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-824"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-825">f</span><span class="MJXp-mo" id="MJXp-Span-826" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-827">n</span><span class="MJXp-mo" id="MJXp-Span-828" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-829" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-830">n</span><span class="MJXp-mo" id="MJXp-Span-831" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-832">1</span></span></span><script type="math/tex" id="MathJax-Element-163">f(n) = n + 1</script> and construct a similar solution with <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-833"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-834">S</span><span class="MJXp-mo" id="MJXp-Span-835" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-836" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-837">n</span><span class="MJXp-mo" id="MJXp-Span-838" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-839">1</span><span class="MJXp-msubsup" id="MJXp-Span-840"><span class="MJXp-mo" id="MJXp-Span-841" style="margin-left: 0em; margin-right: 0.05em;">)</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-842" style="vertical-align: 0.5em;">2</span></span></span></span><script type="math/tex" id="MathJax-Element-164">S = (n + 1)^2</script>.</p><p>Time Complexity: <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-843"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-844">O</span><span class="MJXp-mo" id="MJXp-Span-845" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-846">n</span><span class="MJXp-mo" id="MJXp-Span-847" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-165">O(n)</script> per testcase.</p></div></div> <div class="spoiler"><b class="spoiler-title">Implementation</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">(){</span><span class="pln">
 
    </span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
 
    </span><span class="kwd">while</span><span class="pun">(</span><span class="pln">t</span><span class="pun">--){</span><span class="pln">
 
        </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
        cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
        
        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">n </span><span class="pun">==</span><span class="pln"> </span><span class="lit">2</span><span class="pun">){</span><span class="pln">
            cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">continue</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
 
        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">n </span><span class="pun">==</span><span class="pln"> </span><span class="lit">3</span><span class="pun">){</span><span class="pln">
            cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"1 3\n2 3\n"</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">continue</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
 
        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">n </span><span class="pun">==</span><span class="pln"> </span><span class="lit">4</span><span class="pun">){</span><span class="pln">
            cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"1 2\n3 1\n4 1\n"</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">continue</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
 
        cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"1 2\n"</span><span class="pun">;</span><span class="pln">
        cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"2 3\n"</span><span class="pun">;</span><span class="pln">
        cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"3 4\n"</span><span class="pun">;</span><span class="pln">
 
        cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"1 "</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> n </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
 
        </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">5</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">' '</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> i </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2162/problem/H" title="Codeforces Round 1059 (Div. 3)">2162H - Beautiful Problem</a></p><p>Idea: <a class="rated-user user-orange" href="https://codeforces.com/profile/wuhudsm" title="Master wuhudsm">wuhudsm</a> Preparation: <a class="rated-user user-orange" href="https://codeforces.com/profile/wuhudsm" title="Master wuhudsm">wuhudsm</a></p> <div class="spoiler"><b class="spoiler-title">Spoiler</b><div class="spoiler-content" style="display: block;"><p><img alt=" 2025-10-18 065201.png" src="https://codeforces.com/predownloaded/3d/8f/3d8fb9c96462a71b0f9ea8494f91886d578c1d9f.png" style="max-width: 100.0%;max-height: 100.0%;"></p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><p>When the value of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-848"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-849">f</span></span></span><script type="math/tex" id="MathJax-Element-166">f</script> is 1 for <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-850"><span class="MJXp-mo" id="MJXp-Span-851" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-msubsup" id="MJXp-Span-852"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-853" style="margin-right: 0.05em;">l</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-854" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-855" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-856"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-857" style="margin-right: 0.05em;">r</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-858" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-859" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-167">[l_i, r_i]</script>, all numbers in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-860"><span class="MJXp-mo" id="MJXp-Span-861" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-msubsup" id="MJXp-Span-862"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-863" style="margin-right: 0.05em;">l</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-864" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-865" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-866"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-867" style="margin-right: 0.05em;">r</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-868" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-869" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-168">[l_i, r_i]</script> are either <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-870"><span class="MJXp-mo" id="MJXp-Span-871" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-872">x</span></span></span><script type="math/tex" id="MathJax-Element-169">\leq x</script> or <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-873"><span class="MJXp-mo" id="MJXp-Span-874" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-875">x</span></span></span><script type="math/tex" id="MathJax-Element-170">\geq x</script>.</p><p>We observe that for each interval, we need to divide the intervals into S-intervals (smaller) and B-intervals (bigger). S-intervals can only contain numbers <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-876"><span class="MJXp-mo" id="MJXp-Span-877" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-878">x</span></span></span><script type="math/tex" id="MathJax-Element-171">\leq x</script>, and B-intervals can only contain numbers <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-879"><span class="MJXp-mo" id="MJXp-Span-880" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-881">x</span></span></span><script type="math/tex" id="MathJax-Element-172">\geq x</script>.</p><p>Assuming we have fixed the S-intervals and B-intervals. For each index <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-882"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-883">i</span></span></span><script type="math/tex" id="MathJax-Element-173">i</script>, there are 4 types:</p> <ul>   <li>Type 1: <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-884"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-885">i</span></span></span><script type="math/tex" id="MathJax-Element-174">i</script> is covered only by S-intervals;</li>   <li>Type 2: <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-886"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-887">i</span></span></span><script type="math/tex" id="MathJax-Element-175">i</script> is covered only by B-intervals;</li>   <li>Type 3: <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-888"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-889">i</span></span></span><script type="math/tex" id="MathJax-Element-176">i</script> is covered by both S-intervals and B-intervals;</li>   <li>Type 4: <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-890"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-891">i</span></span></span><script type="math/tex" id="MathJax-Element-177">i</script> is covered by neither S-intervals nor B-intervals.</li> </ul><p>Let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-892"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-893">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-894">n</span><span class="MJXp-msubsup" id="MJXp-Span-895"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-896" style="margin-right: 0.05em;">t</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-897" style="vertical-align: -0.4em;">s</span></span></span></span><script type="math/tex" id="MathJax-Element-178">cnt_s</script> be the number of values <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-898"><span class="MJXp-mo" id="MJXp-Span-899" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-900">x</span></span></span><script type="math/tex" id="MathJax-Element-179">< x</script>, and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-901"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-902">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-903">n</span><span class="MJXp-msubsup" id="MJXp-Span-904"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-905" style="margin-right: 0.05em;">t</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-906" style="vertical-align: -0.4em;">b</span></span></span></span><script type="math/tex" id="MathJax-Element-180">cnt_b</script> be the number of values <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-907"><span class="MJXp-mo" id="MJXp-Span-908" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-909">x</span></span></span><script type="math/tex" id="MathJax-Element-181">> x</script>.</p><p>When there are no type 4 indices, we only need to check whether:</p> <ul>   <li><p><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-910"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-911">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-912">n</span><span class="MJXp-msubsup" id="MJXp-Span-913"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-914" style="margin-right: 0.05em;">t</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-915" style="vertical-align: -0.4em;">s</span></span><span class="MJXp-mo" id="MJXp-Span-916" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span></span></span><script type="math/tex" id="MathJax-Element-182">cnt_s \leq</script> (total number of type 1 indices)</p></li>   <li><p><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-917"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-918">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-919">n</span><span class="MJXp-msubsup" id="MJXp-Span-920"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-921" style="margin-right: 0.05em;">t</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-922" style="vertical-align: -0.4em;">b</span></span><span class="MJXp-mo" id="MJXp-Span-923" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span></span></span><script type="math/tex" id="MathJax-Element-183">cnt_b \leq</script> (total number of type 2 indices)</p></li> </ul><p>When type 4 indices exist, we only need to make a slight modification to the condition (this modification is left to the reader).</p><p>Consider a simpler case: all intervals are non-overlapping. In this case, the problem reduces to a classic knapsack problem, where each interval becomes an independent item. We consider extending the idea of DP to the original problem.</p><p>We find that intervals that are contained within others are useless and can be removed. Then, the intervals can be sorted by their left endpoints. This way, for <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-924"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-925">i</span><span class="MJXp-mo" id="MJXp-Span-926" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-927">j</span></span></span><script type="math/tex" id="MathJax-Element-184">i < j</script>, we can ensure <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-928"><span class="MJXp-msubsup" id="MJXp-Span-929"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-930" style="margin-right: 0.05em;">l</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-931" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-932" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-msubsup" id="MJXp-Span-933"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-934" style="margin-right: 0.05em;">l</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-935" style="vertical-align: -0.4em;">j</span></span></span></span><script type="math/tex" id="MathJax-Element-185">l_i < l_j</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-936"><span class="MJXp-msubsup" id="MJXp-Span-937"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-938" style="margin-right: 0.05em;">r</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-939" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-940" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-msubsup" id="MJXp-Span-941"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-942" style="margin-right: 0.05em;">r</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-943" style="vertical-align: -0.4em;">j</span></span></span></span><script type="math/tex" id="MathJax-Element-186">r_i < r_j</script>. Then, we perform DP based on the order of the intervals.</p><p>We define:</p><p><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-944"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-945">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-946">p</span><span class="MJXp-mo" id="MJXp-Span-947" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-948">i</span><span class="MJXp-mo" id="MJXp-Span-949" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-950" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-951">j</span><span class="MJXp-mo" id="MJXp-Span-952" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-953" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-954">k</span><span class="MJXp-mo" id="MJXp-Span-955" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-956">0</span><span class="MJXp-mtext" id="MJXp-Span-957">&nbsp;or&nbsp;</span><span class="MJXp-mn" id="MJXp-Span-958">1</span><span class="MJXp-mo" id="MJXp-Span-959" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-187">dp[i][j][k = 0 \text{ or } 1]</script>: For the first <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-960"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-961">i</span></span></span><script type="math/tex" id="MathJax-Element-188">i</script> intervals, the total number of type 1 indices is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-962"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-963">j</span></span></span><script type="math/tex" id="MathJax-Element-189">j</script>, and the last interval is an S-interval (<span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-964"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-965">k</span><span class="MJXp-mo" id="MJXp-Span-966" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-967">0</span></span></span><script type="math/tex" id="MathJax-Element-190">k = 0</script>) or a B-interval (<span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-968"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-969">k</span><span class="MJXp-mo" id="MJXp-Span-970" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-971">1</span></span></span><script type="math/tex" id="MathJax-Element-191">k = 1</script>), the maximum total number of type 2 indices obtained.</p><p>Let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-972"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-973">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-974">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-975">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-976">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-977">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-978">n</span><span class="MJXp-mo" id="MJXp-Span-979" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-980">i</span><span class="MJXp-mo" id="MJXp-Span-981" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-192">inslen[i]</script> be the length of the intersection between the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-982"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-983">i</span></span></span><script type="math/tex" id="MathJax-Element-193">i</script>-th interval and the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-984"><span class="MJXp-mo" id="MJXp-Span-985" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-986">i</span><span class="MJXp-mo" id="MJXp-Span-987" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-988">1</span><span class="MJXp-mo" id="MJXp-Span-989" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-194">(i-1)</script>-th interval.</p><p>Transitions:</p> <ul>   <li><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1004"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1005">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1006">p</span><span class="MJXp-mo" id="MJXp-Span-1007" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1008">i</span><span class="MJXp-mo" id="MJXp-Span-1009" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1010" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1011">j</span><span class="MJXp-mo" id="MJXp-Span-1012" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1013" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mn" id="MJXp-Span-1014">0</span><span class="MJXp-mo" id="MJXp-Span-1015" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1016" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-1017" style="margin-left: 0.333em; margin-right: 0.333em;">max</span><span class="MJXp-mo" id="MJXp-Span-1018" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1019">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1020">p</span><span class="MJXp-mo" id="MJXp-Span-1021" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1022">i</span><span class="MJXp-mo" id="MJXp-Span-1023" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-1024">1</span><span class="MJXp-mo" id="MJXp-Span-1025" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1026" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1027">j</span><span class="MJXp-mo" id="MJXp-Span-1028" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1029">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1030">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1031">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1032">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1033">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1034">n</span><span class="MJXp-mo" id="MJXp-Span-1035" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1036">i</span><span class="MJXp-mo" id="MJXp-Span-1037" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1038" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1039" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mn" id="MJXp-Span-1040">0</span><span class="MJXp-mo" id="MJXp-Span-1041" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1042" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1043">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1044">p</span><span class="MJXp-mo" id="MJXp-Span-1045" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1046">i</span><span class="MJXp-mo" id="MJXp-Span-1047" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-1048">1</span><span class="MJXp-mo" id="MJXp-Span-1049" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1050" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1051">j</span><span class="MJXp-mo" id="MJXp-Span-1052" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1053">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1054">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1055">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1056">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1057">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1058">n</span><span class="MJXp-mo" id="MJXp-Span-1059" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1060">i</span><span class="MJXp-mo" id="MJXp-Span-1061" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1062" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1063" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mn" id="MJXp-Span-1064">1</span><span class="MJXp-mo" id="MJXp-Span-1065" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1066" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1067">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1068">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1069">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1070">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1071">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1072">n</span><span class="MJXp-mo" id="MJXp-Span-1073" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1074">i</span><span class="MJXp-mo" id="MJXp-Span-1075" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1076" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-195">dp[i][j][0] = \max(dp[i-1][j - inslen[i]][0], dp[i-1][j - inslen[i]][1] - inslen[i])</script></li>   <li><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1077"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1078">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1079">p</span><span class="MJXp-mo" id="MJXp-Span-1080" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1081">i</span><span class="MJXp-mo" id="MJXp-Span-1082" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1083" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1084">j</span><span class="MJXp-mo" id="MJXp-Span-1085" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1086" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mn" id="MJXp-Span-1087">1</span><span class="MJXp-mo" id="MJXp-Span-1088" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1089" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-1090" style="margin-left: 0.333em; margin-right: 0.333em;">max</span><span class="MJXp-mo" id="MJXp-Span-1091" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1092">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1093">p</span><span class="MJXp-mo" id="MJXp-Span-1094" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1095">i</span><span class="MJXp-mo" id="MJXp-Span-1096" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-1097">1</span><span class="MJXp-mo" id="MJXp-Span-1098" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1099" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1100">j</span><span class="MJXp-mo" id="MJXp-Span-1101" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1102" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mn" id="MJXp-Span-1103">1</span><span class="MJXp-mo" id="MJXp-Span-1104" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1105" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1106">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1107">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1108">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1109">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1110">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1111">n</span><span class="MJXp-mo" id="MJXp-Span-1112" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1113">i</span><span class="MJXp-mo" id="MJXp-Span-1114" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1115" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1116">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1117">p</span><span class="MJXp-mo" id="MJXp-Span-1118" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1119">i</span><span class="MJXp-mo" id="MJXp-Span-1120" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-1121">1</span><span class="MJXp-mo" id="MJXp-Span-1122" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1123" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1124">j</span><span class="MJXp-mo" id="MJXp-Span-1125" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1126">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1127">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1128">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1129">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1130">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1131">n</span><span class="MJXp-mo" id="MJXp-Span-1132" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1133">i</span><span class="MJXp-mo" id="MJXp-Span-1134" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1135" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1136" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mn" id="MJXp-Span-1137">1</span><span class="MJXp-mo" id="MJXp-Span-1138" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1139" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1140">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1141">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1142">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1143">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1144">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1145">n</span><span class="MJXp-mo" id="MJXp-Span-1146" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1147">i</span><span class="MJXp-mo" id="MJXp-Span-1148" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1149" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-196">dp[i][j][1] = \max(dp[i-1][j][1] + inslen[i], dp[i-1][j + inslen[i]][1] + inslen[i])</script></li> </ul><p>Note: For intervals <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1150"><span class="MJXp-mo" id="MJXp-Span-1151" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1152">i</span><span class="MJXp-mo" id="MJXp-Span-1153" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-1154">2</span><span class="MJXp-mo" id="MJXp-Span-1155" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-197">(i-2)</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1156"><span class="MJXp-mo" id="MJXp-Span-1157" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1158">i</span><span class="MJXp-mo" id="MJXp-Span-1159" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-1160">1</span><span class="MJXp-mo" id="MJXp-Span-1161" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-198">(i-1)</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1162"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1163">i</span></span></span><script type="math/tex" id="MathJax-Element-199">i</script>, if the type of interval <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1164"><span class="MJXp-mo" id="MJXp-Span-1165" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1166">i</span><span class="MJXp-mo" id="MJXp-Span-1167" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-1168">1</span><span class="MJXp-mo" id="MJXp-Span-1169" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-200">(i-1)</script> is different from both <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1170"><span class="MJXp-mo" id="MJXp-Span-1171" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1172">i</span><span class="MJXp-mo" id="MJXp-Span-1173" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-1174">2</span><span class="MJXp-mo" id="MJXp-Span-1175" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-201">(i-2)</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1176"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1177">i</span></span></span><script type="math/tex" id="MathJax-Element-202">i</script>, and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1178"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1179">r</span><span class="MJXp-mo" id="MJXp-Span-1180" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1181">i</span><span class="MJXp-mo" id="MJXp-Span-1182" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-1183">2</span><span class="MJXp-mo" id="MJXp-Span-1184" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1185" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1186">l</span><span class="MJXp-mo" id="MJXp-Span-1187" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1188">i</span><span class="MJXp-mo" id="MJXp-Span-1189" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-203">r[i-2] \geq l[i]</script>, some overlapping parts may be subtracted repeatedly. However, we find that this does not affect the final answer because it is not better than the answer when all three intervals are of the same type. Here, a common DP idea is applied: if "incorrect" states are recorded but they cannot be optimal, the DP transitions can remain unchanged (a similar idea is used in: <a href="https://codeforces.com/contest/1859/problem/E)">https://codeforces.com/contest/1859/problem/E)</a>.</p> <table class="bordertable">   <thead>     <tr>       <th align="center">State 1 </th>       <th align="center">State 2 </th>     </tr>   </thead>   <tbody>     <tr>       <td align="center"><img alt=" 2025-10-18 064710.png" src="https://codeforces.com/predownloaded/90/1b/901b4fbfeb4b76b533578f7e0c3b7d3c44fe1aea.png" style="max-width: 100.0%;max-height: 100.0%;">) </td>       <td align="center"><img alt=" 2025-10-18 064836.png" src="https://codeforces.com/predownloaded/d3/02/d302b3d1cbb791ed3b5f90b62c4697a9f26b3d31.png" style="max-width: 100.0%;max-height: 100.0%;"> </td>     </tr>     <tr>       <td align="center">Some overlapping parts (in the middle) are subtracted repeatedly. </td>       <td align="center">Better because the value range of the middle positions is strictly larger. </td>     </tr>   </tbody> </table><p>Afterward, answering queries using the DP array is trivial. The time complexity is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1190"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1191">O</span><span class="MJXp-mo" id="MJXp-Span-1192" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1193"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1194" style="margin-right: 0.05em;">n</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1195" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1196" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-204">O(n^2)</script>.</p> <hr><p>There is another DP approach. Let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1197"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1198">b</span><span class="MJXp-mo" id="MJXp-Span-1199" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1200">i</span><span class="MJXp-mo" id="MJXp-Span-1201" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-205">b[i]</script> be the smallest <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1202"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1203">j</span><span class="MJXp-mo" id="MJXp-Span-1204" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1205">i</span></span></span><script type="math/tex" id="MathJax-Element-206">j \leq i</script> such that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1206"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1207">j</span></span></span><script type="math/tex" id="MathJax-Element-207">j</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1208"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1209">i</span></span></span><script type="math/tex" id="MathJax-Element-208">i</script> are covered by the same interval. Then, if position <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1210"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1211">i</span></span></span><script type="math/tex" id="MathJax-Element-209">i</script> is filled with a number <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1212"><span class="MJXp-mo" id="MJXp-Span-1213" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1214">x</span></span></span><script type="math/tex" id="MathJax-Element-210">< x</script>, we can deduce that all numbers in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1215"><span class="MJXp-msup" id="MJXp-Span-1216"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1217" style="margin-right: 0.05em;">a</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1218" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-1219" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1220">b</span><span class="MJXp-mo" id="MJXp-Span-1221" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1222">i</span><span class="MJXp-mo" id="MJXp-Span-1223" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1224" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-1225" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-1226" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1227">i</span><span class="MJXp-mo" id="MJXp-Span-1228" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-211">a'[b[i], \ldots, i]</script> must be <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1229"><span class="MJXp-mo" id="MJXp-Span-1230" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1231">x</span></span></span><script type="math/tex" id="MathJax-Element-212">< x</script>, and so on. This way, we can write a DP that transitions position by position, without pre-processing each interval.</p><p>For details, refer to <a class="rated-user user-legendary" href="https://codeforces.com/profile/Dominater069" title="Legendary Grandmaster Dominater069"><span class="legendary-user-first-letter">D</span>ominater069</a> 's code.</p></div></div> <div class="spoiler"><b class="spoiler-title">Implementation1(wuhudsm)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pln"> </span><span class="str">&lt;map&gt;</span><span class="pln">
</span><span class="com">#include</span><span class="pln"> </span><span class="str">&lt;set&gt;</span><span class="pln">
</span><span class="com">#include</span><span class="pln"> </span><span class="str">&lt;cmath&gt;</span><span class="pln">
</span><span class="com">#include</span><span class="pln"> </span><span class="str">&lt;ctime&gt;</span><span class="pln">
</span><span class="com">#include</span><span class="pln"> </span><span class="str">&lt;queue&gt;</span><span class="pln">
</span><span class="com">#include</span><span class="pln"> </span><span class="str">&lt;stack&gt;</span><span class="pln">
</span><span class="com">#include</span><span class="pln"> </span><span class="str">&lt;cstdio&gt;</span><span class="pln">
</span><span class="com">#include</span><span class="pln"> </span><span class="str">&lt;cstdlib&gt;</span><span class="pln">
</span><span class="com">#include</span><span class="pln"> </span><span class="str">&lt;vector&gt;</span><span class="pln">
</span><span class="com">#include</span><span class="pln"> </span><span class="str">&lt;cstring&gt;</span><span class="pln">
</span><span class="com">#include</span><span class="pln"> </span><span class="str">&lt;algorithm&gt;</span><span class="pln">
</span><span class="com">#include</span><span class="pln"> </span><span class="str">&lt;iostream&gt;</span><span class="pln">
</span><span class="com">#include</span><span class="pln"> </span><span class="str">&lt;bitset&gt;</span><span class="pln">
</span><span class="com">#include</span><span class="pln"> </span><span class="str">&lt;unordered_map&gt;</span><span class="pln">
</span><span class="com">#define</span><span class="pln"> fastio ios_base</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="kwd">false</span><span class="pun">);</span><span class="pln">cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">cout</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">typedef</span><span class="pln"> </span><span class="kwd">double</span><span class="pln"> db</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">typedef</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> ll</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">typedef</span><span class="pln"> </span><span class="kwd">unsigned</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> ull</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> N</span><span class="pun">=</span><span class="lit">3010</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> LOGN</span><span class="pun">=</span><span class="lit">28</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">const</span><span class="pln"> ll  TMD</span><span class="pun">=</span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">const</span><span class="pln"> ll  INF</span><span class="pun">=</span><span class="lit">100000000</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> T</span><span class="pun">,</span><span class="pln">n</span><span class="pun">,</span><span class="pln">m</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">N</span><span class="pun">],</span><span class="pln">cnt</span><span class="pun">[</span><span class="pln">N</span><span class="pun">],</span><span class="pln">mxr</span><span class="pun">[</span><span class="pln">N</span><span class="pun">];</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> dp</span><span class="pun">[</span><span class="pln">N</span><span class="pun">][</span><span class="pln">N</span><span class="pun">][</span><span class="lit">2</span><span class="pun">];</span><span class="pln">

</span><span class="com">/*
 * stuff you should look for
 * [Before Submission]
 * array bounds, initialization, int overflow, special cases (like n=1), typo
 * [Still WA]
 * check typo carefully
 * casework mistake
 * special bug
 * stress test
 */</span><span class="pln">

</span><span class="com">//--------------------------------------------------------------------------</span><span class="pln">

</span><span class="kwd">struct</span><span class="pln"> seg
</span><span class="pun">{</span><span class="pln">
	</span><span class="kwd">int</span><span class="pln"> l</span><span class="pun">,</span><span class="pln">r</span><span class="pun">;</span><span class="pln">

	seg</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">

	seg</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> l</span><span class="pun">,</span><span class="kwd">int</span><span class="pln"> r</span><span class="pun">):</span><span class="pln">l</span><span class="pun">(</span><span class="pln">l</span><span class="pun">),</span><span class="pln">r</span><span class="pun">(</span><span class="pln">r</span><span class="pun">){}</span><span class="pln">

	</span><span class="kwd">int</span><span class="pln"> len</span><span class="pun">()</span><span class="pln">
	</span><span class="pun">{</span><span class="pln">
	    </span><span class="kwd">return</span><span class="pln"> r</span><span class="pun">-</span><span class="pln">l</span><span class="pun">+</span><span class="lit">1</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">};</span><span class="pln">

seg getins</span><span class="pun">(</span><span class="pln">seg x</span><span class="pun">,</span><span class="pln">seg y</span><span class="pun">)</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
	</span><span class="kwd">if</span><span class="pun">(</span><span class="pln">x</span><span class="pun">.</span><span class="pln">l</span><span class="pun">&gt;</span><span class="pln">y</span><span class="pun">.</span><span class="pln">l</span><span class="pun">)</span><span class="pln"> swap</span><span class="pun">(</span><span class="pln">x</span><span class="pun">,</span><span class="pln">y</span><span class="pun">);</span><span class="pln">
	</span><span class="kwd">if</span><span class="pun">(</span><span class="pln">x</span><span class="pun">.</span><span class="pln">r</span><span class="pun">&lt;</span><span class="pln">y</span><span class="pun">.</span><span class="pln">l</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> seg</span><span class="pun">(</span><span class="pln">INF</span><span class="pun">,</span><span class="pln">INF</span><span class="pun">);</span><span class="pln">
	</span><span class="kwd">if</span><span class="pun">(</span><span class="pln">x</span><span class="pun">.</span><span class="pln">r</span><span class="pun">&lt;</span><span class="pln">y</span><span class="pun">.</span><span class="pln">r</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> seg</span><span class="pun">(</span><span class="pln">y</span><span class="pun">.</span><span class="pln">l</span><span class="pun">,</span><span class="pln">x</span><span class="pun">.</span><span class="pln">r</span><span class="pun">);</span><span class="pln">
	</span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> seg</span><span class="pun">(</span><span class="pln">y</span><span class="pun">.</span><span class="pln">l</span><span class="pun">,</span><span class="pln">y</span><span class="pun">.</span><span class="pln">r</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="com">//--------------------------------------------------------------------------</span><span class="pln">

</span><span class="kwd">void</span><span class="pln"> init</span><span class="pun">()</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    cin</span><span class="pun">&gt;&gt;</span><span class="pln">n</span><span class="pun">&gt;&gt;</span><span class="pln">m</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i</span><span class="pun">=</span><span class="lit">0</span><span class="pun">;</span><span class="pln">i</span><span class="pun">&lt;=</span><span class="pln">n</span><span class="pun">;</span><span class="pln">i</span><span class="pun">++)</span><span class="pln">
        mxr</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]=</span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i</span><span class="pun">=</span><span class="lit">1</span><span class="pun">;</span><span class="pln">i</span><span class="pun">&lt;=</span><span class="pln">n</span><span class="pun">;</span><span class="pln">i</span><span class="pun">++)</span><span class="pln">
        cin</span><span class="pun">&gt;&gt;</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i</span><span class="pun">=</span><span class="lit">1</span><span class="pun">;</span><span class="pln">i</span><span class="pun">&lt;=</span><span class="pln">m</span><span class="pun">;</span><span class="pln">i</span><span class="pun">++)</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> l</span><span class="pun">,</span><span class="pln">r</span><span class="pun">;</span><span class="pln">
        cin</span><span class="pun">&gt;&gt;</span><span class="pln">l</span><span class="pun">&gt;&gt;</span><span class="pln">r</span><span class="pun">;</span><span class="pln">
        mxr</span><span class="pun">[</span><span class="pln">l</span><span class="pun">]=</span><span class="pln">max</span><span class="pun">(</span><span class="pln">mxr</span><span class="pun">[</span><span class="pln">l</span><span class="pun">],</span><span class="pln">r</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i</span><span class="pun">=</span><span class="lit">0</span><span class="pun">;</span><span class="pln">i</span><span class="pun">&lt;=</span><span class="pln">n</span><span class="pun">+</span><span class="lit">4</span><span class="pun">;</span><span class="pln">i</span><span class="pun">++)</span><span class="pln">
        </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j</span><span class="pun">=</span><span class="lit">0</span><span class="pun">;</span><span class="pln">j</span><span class="pun">&lt;=</span><span class="pln">n</span><span class="pun">+</span><span class="lit">4</span><span class="pun">;</span><span class="pln">j</span><span class="pun">++)</span><span class="pln">
            dp</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">][</span><span class="lit">0</span><span class="pun">]=</span><span class="pln">dp</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">][</span><span class="lit">1</span><span class="pun">]=-</span><span class="pln">INF</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">void</span><span class="pln"> solve</span><span class="pun">()</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> sz</span><span class="pun">,</span><span class="pln">cfree</span><span class="pun">=</span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    vector</span><span class="str">&lt;int&gt;</span><span class="pln"> tag</span><span class="pun">(</span><span class="pln">n</span><span class="pun">+</span><span class="lit">4</span><span class="pun">);</span><span class="pln">
    vector</span><span class="str">&lt;seg&gt;</span><span class="pln"> vs</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i</span><span class="pun">=</span><span class="lit">1</span><span class="pun">;</span><span class="pln">i</span><span class="pun">&lt;=</span><span class="pln">n</span><span class="pun">;</span><span class="pln">i</span><span class="pun">++)</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pun">(!</span><span class="pln">mxr</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln"> </span><span class="kwd">continue</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">vs</span><span class="pun">.</span><span class="pln">empty</span><span class="pun">()||</span><span class="pln">vs</span><span class="pun">.</span><span class="pln">back</span><span class="pun">().</span><span class="pln">r</span><span class="pun">&lt;</span><span class="pln">mxr</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln">
            vs</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">seg</span><span class="pun">(</span><span class="pln">i</span><span class="pun">,</span><span class="pln">mxr</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]));</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    sz</span><span class="pun">=</span><span class="pln">vs</span><span class="pun">.</span><span class="pln">size</span><span class="pun">();</span><span class="pln">
    dp</span><span class="pun">[</span><span class="lit">1</span><span class="pun">][</span><span class="lit">0</span><span class="pun">][</span><span class="lit">0</span><span class="pun">]=</span><span class="pln">vs</span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="pln">len</span><span class="pun">();</span><span class="pln">
    dp</span><span class="pun">[</span><span class="lit">1</span><span class="pun">][</span><span class="pln">vs</span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="pln">len</span><span class="pun">()][</span><span class="lit">1</span><span class="pun">]=</span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i</span><span class="pun">=</span><span class="lit">2</span><span class="pun">;</span><span class="pln">i</span><span class="pun">&lt;=</span><span class="pln">sz</span><span class="pun">;</span><span class="pln">i</span><span class="pun">++)</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
        seg cur</span><span class="pun">=</span><span class="pln">vs</span><span class="pun">[</span><span class="pln">i</span><span class="pun">-</span><span class="lit">1</span><span class="pun">],</span><span class="pln">ins</span><span class="pun">=</span><span class="pln">getins</span><span class="pun">(</span><span class="pln">vs</span><span class="pun">[</span><span class="pln">i</span><span class="pun">-</span><span class="lit">2</span><span class="pun">],</span><span class="pln">vs</span><span class="pun">[</span><span class="pln">i</span><span class="pun">-</span><span class="lit">1</span><span class="pun">]);</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> len_ins</span><span class="pun">=(</span><span class="pln">ins</span><span class="pun">.</span><span class="pln">l</span><span class="pun">==</span><span class="pln">INF</span><span class="pun">?</span><span class="lit">0</span><span class="pun">:</span><span class="pln">ins</span><span class="pun">.</span><span class="pln">len</span><span class="pun">());</span><span class="pln">
        </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j</span><span class="pun">=</span><span class="lit">0</span><span class="pun">;</span><span class="pln">j</span><span class="pun">&lt;=</span><span class="pln">n</span><span class="pun">;</span><span class="pln">j</span><span class="pun">++)</span><span class="pln">
        </span><span class="pun">{</span><span class="pln">
            dp</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">][</span><span class="lit">0</span><span class="pun">]=</span><span class="pln">max</span><span class="pun">(</span><span class="pln">dp</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">][</span><span class="lit">0</span><span class="pun">],</span><span class="pln">dp</span><span class="pun">[</span><span class="pln">i</span><span class="pun">-</span><span class="lit">1</span><span class="pun">][</span><span class="pln">j</span><span class="pun">][</span><span class="lit">0</span><span class="pun">]+</span><span class="pln">cur</span><span class="pun">.</span><span class="pln">len</span><span class="pun">()-</span><span class="pln">len_ins</span><span class="pun">);</span><span class="pln">
            </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">j</span><span class="pun">+</span><span class="pln">len_ins</span><span class="pun">&lt;=</span><span class="pln">n</span><span class="pun">)</span><span class="pln">
                dp</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">][</span><span class="lit">0</span><span class="pun">]=</span><span class="pln">max</span><span class="pun">(</span><span class="pln">dp</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">][</span><span class="lit">0</span><span class="pun">],</span><span class="pln">dp</span><span class="pun">[</span><span class="pln">i</span><span class="pun">-</span><span class="lit">1</span><span class="pun">][</span><span class="pln">j</span><span class="pun">+</span><span class="pln">len_ins</span><span class="pun">][</span><span class="lit">1</span><span class="pun">]+</span><span class="pln">cur</span><span class="pun">.</span><span class="pln">len</span><span class="pun">()-</span><span class="pln">len_ins</span><span class="pun">);</span><span class="pln">
            </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">j</span><span class="pun">-(</span><span class="pln">cur</span><span class="pun">.</span><span class="pln">len</span><span class="pun">()-</span><span class="pln">len_ins</span><span class="pun">)&gt;=</span><span class="lit">0</span><span class="pun">)</span><span class="pln">
            </span><span class="pun">{</span><span class="pln">
                dp</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">][</span><span class="lit">1</span><span class="pun">]=</span><span class="pln">max</span><span class="pun">(</span><span class="pln">dp</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">][</span><span class="lit">1</span><span class="pun">],</span><span class="pln">dp</span><span class="pun">[</span><span class="pln">i</span><span class="pun">-</span><span class="lit">1</span><span class="pun">][</span><span class="pln">j</span><span class="pun">-(</span><span class="pln">cur</span><span class="pun">.</span><span class="pln">len</span><span class="pun">()-</span><span class="pln">len_ins</span><span class="pun">)][</span><span class="lit">1</span><span class="pun">]);</span><span class="pln">
                dp</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">][</span><span class="lit">1</span><span class="pun">]=</span><span class="pln">max</span><span class="pun">(</span><span class="pln">dp</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">][</span><span class="lit">1</span><span class="pun">],</span><span class="pln">dp</span><span class="pun">[</span><span class="pln">i</span><span class="pun">-</span><span class="lit">1</span><span class="pun">][</span><span class="pln">j</span><span class="pun">-(</span><span class="pln">cur</span><span class="pun">.</span><span class="pln">len</span><span class="pun">()-</span><span class="pln">len_ins</span><span class="pun">)][</span><span class="lit">0</span><span class="pun">]-</span><span class="pln">len_ins</span><span class="pun">);</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i</span><span class="pun">=</span><span class="lit">0</span><span class="pun">;</span><span class="pln">i</span><span class="pun">&lt;</span><span class="pln">vs</span><span class="pun">.</span><span class="pln">size</span><span class="pun">();</span><span class="pln">i</span><span class="pun">++)</span><span class="pln">
        </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j</span><span class="pun">=</span><span class="pln">vs</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">l</span><span class="pun">;</span><span class="pln">j</span><span class="pun">&lt;=</span><span class="pln">vs</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">r</span><span class="pun">;</span><span class="pln">j</span><span class="pun">++)</span><span class="pln">
            tag</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]=</span><span class="lit">1</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i</span><span class="pun">=</span><span class="lit">1</span><span class="pun">;</span><span class="pln">i</span><span class="pun">&lt;=</span><span class="pln">n</span><span class="pun">;</span><span class="pln">i</span><span class="pun">++)</span><span class="pln">
        </span><span class="kwd">if</span><span class="pun">(!</span><span class="pln">tag</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln"> cfree</span><span class="pun">++;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i</span><span class="pun">=</span><span class="lit">1</span><span class="pun">;</span><span class="pln">i</span><span class="pun">&lt;=</span><span class="pln">n</span><span class="pun">;</span><span class="pln">i</span><span class="pun">++)</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> s</span><span class="pun">=</span><span class="lit">0</span><span class="pun">,</span><span class="pln">b</span><span class="pun">=</span><span class="lit">0</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j</span><span class="pun">=</span><span class="lit">1</span><span class="pun">;</span><span class="pln">j</span><span class="pun">&lt;=</span><span class="pln">n</span><span class="pun">;</span><span class="pln">j</span><span class="pun">++)</span><span class="pln">
        </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]&lt;</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> s</span><span class="pun">++;</span><span class="pln">
            </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]&gt;</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> b</span><span class="pun">++;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> flg</span><span class="pun">=</span><span class="lit">0</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j</span><span class="pun">=</span><span class="lit">0</span><span class="pun">;</span><span class="pln">j</span><span class="pun">&lt;=</span><span class="pln">n</span><span class="pun">;</span><span class="pln">j</span><span class="pun">++)</span><span class="pln">
        </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">int</span><span class="pln"> need1</span><span class="pun">=</span><span class="pln">max</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln">s</span><span class="pun">-</span><span class="pln">j</span><span class="pun">),</span><span class="pln">need2</span><span class="pun">=</span><span class="pln">max</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln">b</span><span class="pun">-</span><span class="pln">max</span><span class="pun">(</span><span class="pln">dp</span><span class="pun">[</span><span class="pln">sz</span><span class="pun">][</span><span class="pln">j</span><span class="pun">][</span><span class="lit">0</span><span class="pun">],</span><span class="pln">dp</span><span class="pun">[</span><span class="pln">sz</span><span class="pun">][</span><span class="pln">j</span><span class="pun">][</span><span class="lit">1</span><span class="pun">]));</span><span class="pln">
            flg</span><span class="pun">|=(</span><span class="pln">cfree</span><span class="pun">&gt;=</span><span class="pln">need1</span><span class="pun">+</span><span class="pln">need2</span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        cout</span><span class="pun">&lt;&lt;</span><span class="pln">flg</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    cout</span><span class="pun">&lt;&lt;</span><span class="str">"\n"</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="com">//-------------------------------------------------------</span><span class="pln">

</span><span class="kwd">void</span><span class="pln"> gen_data</span><span class="pun">()</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    srand</span><span class="pun">(</span><span class="pln">time</span><span class="pun">(</span><span class="pln">NULL</span><span class="pun">));</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> bruteforce</span><span class="pun">()</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="com">//-------------------------------------------------------</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    fastio</span><span class="pun">;</span><span class="pln">

    cin</span><span class="pun">&gt;&gt;</span><span class="pln">T</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">while</span><span class="pun">(</span><span class="pln">T</span><span class="pun">--)</span><span class="pln">
	</span><span class="pun">{</span><span class="pln">
		init</span><span class="pun">();</span><span class="pln">
		solve</span><span class="pun">();</span><span class="pln">

		</span><span class="com">/*

		//Stress Test

		gen_data();
		auto ans1=solve(),ans2=bruteforce();
		if(ans1==ans2) printf("OK!\n");
		else
		{
			//Output Data
 		}

		*/</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span></code></pre></div></div> <div class="spoiler"><b class="spoiler-title">Implementation2 (Dominater069)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
</span><span class="com">#define</span><span class="pln"> INF </span><span class="pun">(</span><span class="kwd">int</span><span class="pun">)</span><span class="lit">1e9</span><span class="pln">

mt19937_64 RNG</span><span class="pun">(</span><span class="pln">chrono</span><span class="pun">::</span><span class="pln">steady_clock</span><span class="pun">::</span><span class="pln">now</span><span class="pun">().</span><span class="pln">time_since_epoch</span><span class="pun">().</span><span class="pln">count</span><span class="pun">());</span><span class="pln">

</span><span class="kwd">void</span><span class="pln"> </span><span class="typ">Solve</span><span class="pun">()</span><span class="pln"> 
</span><span class="pun">{</span><span class="pln">
    </span><span class="com">// x &lt;= min or x &gt;= max </span><span class="pln">
    </span><span class="com">// min &lt; x &lt; max is bad </span><span class="pln">
    </span><span class="com">// =&gt; in range if both smaller and larger exists, cooked </span><span class="pln">
    </span><span class="com">// just spam smaller at one end, and larger at other end? </span><span class="pln">
    </span><span class="com">// i &lt;-&gt; j if there exists interval covering both </span><span class="pln">
    </span><span class="com">// if i &lt;-&gt; j, cannot have diff type on i and j </span><span class="pln">
    </span><span class="com">// dp[i][number of 0s] = max number of 1s, but also need to know what is the last 0 / 1 position </span><span class="pln">
    </span><span class="com">// we can extend last character always </span><span class="pln">
    </span><span class="com">// we can extend other character only after some gap </span><span class="pln">
    </span><span class="com">// prefmax?</span><span class="pln">
    
    </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> m</span><span class="pun">;</span><span class="pln"> cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n </span><span class="pun">&gt;&gt;</span><span class="pln"> m</span><span class="pun">;</span><span class="pln">
    
    vector </span><span class="str">&lt;int&gt;</span><span class="pln"> a</span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">),</span><span class="pln"> f</span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++){</span><span class="pln">
        cin </span><span class="pun">&gt;&gt;</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
        f</span><span class="pun">[</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]]++;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    
    vector </span><span class="str">&lt;int&gt;</span><span class="pln"> b</span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">),</span><span class="pln"> c</span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++){</span><span class="pln">
        b</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> c</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> i</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> m</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++){</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> l</span><span class="pun">,</span><span class="pln"> r</span><span class="pun">;</span><span class="pln"> cin </span><span class="pun">&gt;&gt;</span><span class="pln"> l </span><span class="pun">&gt;&gt;</span><span class="pln"> r</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> l</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;=</span><span class="pln"> r</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++){</span><span class="pln">
            b</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> min</span><span class="pun">(</span><span class="pln">b</span><span class="pun">[</span><span class="pln">j</span><span class="pun">],</span><span class="pln"> l</span><span class="pun">);</span><span class="pln">
            c</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> max</span><span class="pun">(</span><span class="pln">c</span><span class="pun">[</span><span class="pln">j</span><span class="pun">],</span><span class="pln"> r</span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    
    </span><span class="com">// vector dp(n + 1, vector(n + 1, vector &lt;int&gt;(2, -INF)));</span><span class="pln">
    </span><span class="com">// vector pref(n + 1, vector(n + 1, vector &lt;int&gt;(2, -INF)));</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> dp</span><span class="pun">[</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">][</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">][</span><span class="lit">2</span><span class="pun">];</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> pref</span><span class="pun">[</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">][</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">][</span><span class="lit">2</span><span class="pun">];</span><span class="pln">
    
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++){</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++){</span><span class="pln">
            </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> k </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> k </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln"> k</span><span class="pun">++){</span><span class="pln">
                dp</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">][</span><span class="pln">k</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">-</span><span class="pln">INF</span><span class="pun">;</span><span class="pln">
                pref</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">][</span><span class="pln">k</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">-</span><span class="pln">INF</span><span class="pun">;</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    
    dp</span><span class="pun">[</span><span class="lit">0</span><span class="pun">][</span><span class="lit">0</span><span class="pun">][</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> dp</span><span class="pun">[</span><span class="lit">0</span><span class="pun">][</span><span class="lit">0</span><span class="pun">][</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    pref</span><span class="pun">[</span><span class="lit">0</span><span class="pun">][</span><span class="lit">0</span><span class="pun">][</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> pref</span><span class="pun">[</span><span class="lit">0</span><span class="pun">][</span><span class="lit">0</span><span class="pun">][</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++){</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> x </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> x</span><span class="pun">++){</span><span class="pln">
            </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> y </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> y </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln"> y</span><span class="pun">++){</span><span class="pln">
                </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> z </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> z </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln"> z</span><span class="pun">++){</span><span class="pln">
                    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">y </span><span class="pun">==</span><span class="pln"> z</span><span class="pun">){</span><span class="pln">
                        </span><span class="kwd">int</span><span class="pln"> px </span><span class="pun">=</span><span class="pln"> x </span><span class="pun">-</span><span class="pln"> </span><span class="pun">(</span><span class="pln">y </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span><span class="pln">
                        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">px </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">){</span><span class="pln">
                            dp</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">x</span><span class="pun">][</span><span class="pln">y</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> max</span><span class="pun">(</span><span class="pln">dp</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">x</span><span class="pun">][</span><span class="pln">y</span><span class="pun">],</span><span class="pln"> pref</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">][</span><span class="pln">px</span><span class="pun">][</span><span class="pln">z</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="pun">(</span><span class="pln">y </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pun">));</span><span class="pln">
                        </span><span class="pun">}</span><span class="pln">
                    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                        </span><span class="kwd">int</span><span class="pln"> px </span><span class="pun">=</span><span class="pln"> x </span><span class="pun">-</span><span class="pln"> </span><span class="pun">(</span><span class="pln">y </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span><span class="pln">
                        </span><span class="kwd">int</span><span class="pln"> lim </span><span class="pun">=</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
                        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">px </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">){</span><span class="pln">
                            dp</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">x</span><span class="pun">][</span><span class="pln">y</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> max</span><span class="pun">(</span><span class="pln">dp</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">x</span><span class="pun">][</span><span class="pln">y</span><span class="pun">],</span><span class="pln"> pref</span><span class="pun">[</span><span class="pln">lim</span><span class="pun">][</span><span class="pln">px</span><span class="pun">][</span><span class="pln">z</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="pun">(</span><span class="pln">y </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pun">));</span><span class="pln">
                        </span><span class="pun">}</span><span class="pln">
                    </span><span class="pun">}</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">
                
                pref</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">x</span><span class="pun">][</span><span class="pln">y</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> max</span><span class="pun">(</span><span class="pln">pref</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">][</span><span class="pln">x</span><span class="pun">][</span><span class="pln">y</span><span class="pun">],</span><span class="pln"> dp</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">x</span><span class="pun">][</span><span class="pln">y</span><span class="pun">]);</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++){</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> lower </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> upper </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;</span><span class="pln"> i</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++)</span><span class="pln"> lower </span><span class="pun">+=</span><span class="pln"> f</span><span class="pun">[</span><span class="pln">j</span><span class="pun">];</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++)</span><span class="pln"> upper </span><span class="pun">+=</span><span class="pln"> f</span><span class="pun">[</span><span class="pln">j</span><span class="pun">];</span><span class="pln">
        
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">pref</span><span class="pun">[</span><span class="pln">n</span><span class="pun">][</span><span class="pln">lower</span><span class="pun">][</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&gt;=</span><span class="pln"> upper </span><span class="pun">||</span><span class="pln"> pref</span><span class="pun">[</span><span class="pln">n</span><span class="pun">][</span><span class="pln">lower</span><span class="pun">][</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&gt;=</span><span class="pln"> upper</span><span class="pun">){</span><span class="pln">
            cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"1"</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"0"</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"\n"</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="typ">int32_t</span><span class="pln"> main</span><span class="pun">()</span><span class="pln"> 
</span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">auto</span><span class="pln"> </span><span class="kwd">begin</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> std</span><span class="pun">::</span><span class="pln">chrono</span><span class="pun">::</span><span class="pln">high_resolution_clock</span><span class="pun">::</span><span class="pln">now</span><span class="pun">();</span><span class="pln">
    ios_base</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> t </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
    </span><span class="com">// freopen("in",  "r", stdin);</span><span class="pln">
    </span><span class="com">// freopen("out", "w", stdout);</span><span class="pln">
    
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> t</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> 
    </span><span class="pun">{</span><span class="pln">
        </span><span class="com">//cout &lt;&lt; "Case #" &lt;&lt; i &lt;&lt; ": ";</span><span class="pln">
        </span><span class="typ">Solve</span><span class="pun">();</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">auto</span><span class="pln"> </span><span class="kwd">end</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> std</span><span class="pun">::</span><span class="pln">chrono</span><span class="pun">::</span><span class="pln">high_resolution_clock</span><span class="pun">::</span><span class="pln">now</span><span class="pun">();</span><span class="pln">
    </span><span class="kwd">auto</span><span class="pln"> elapsed </span><span class="pun">=</span><span class="pln"> std</span><span class="pun">::</span><span class="pln">chrono</span><span class="pun">::</span><span class="pln">duration_cast</span><span class="pun">&lt;</span><span class="pln">std</span><span class="pun">::</span><span class="pln">chrono</span><span class="pun">::</span><span class="pln">nanoseconds</span><span class="pun">&gt;(</span><span class="kwd">end</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="kwd">begin</span><span class="pun">);</span><span class="pln">
    cerr </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"Time measured: "</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> elapsed</span><span class="pun">.</span><span class="pln">count</span><span class="pun">()</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="lit">1e-9</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">" seconds.\n"</span><span class="pun">;</span><span class="pln"> 
    </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span></code></pre></div></div></div>

    </div>


        <div style="font-size: 1.1rem;line-height: 1.1rem;padding-bottom: 0.5em;">
            <img src="https://codeforces.com//codeforces.com/codeforces.org/s/52448/images/icons/paperclip-16x16.png" style="vertical-align: middle;"> <span style="padding: 0 0.35em;">Tutorial of <a href="https://codeforces.com/contest/2162" class="notice" style="text-decoration: none;">Codeforces Round 1059 (Div. 3)</a> </span>
        </div>
        
            

  <script>
    // Make all spoilers toggleable
    document.querySelectorAll('.spoiler-title').forEach(title => {
      title.addEventListener('click', function() {
        const spoiler = this.closest('.spoiler');
        spoiler.classList.toggle('open');
      });
    });
    
    // Open all spoilers by default for easier reading
    document.querySelectorAll('.spoiler').forEach(spoiler => {
      spoiler.classList.add('open');
    });
  </script>
</body>
</html>