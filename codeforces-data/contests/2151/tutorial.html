<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tutorial</title>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
      line-height: 1.6;
      color: #333;
      background: #fafafa;
    }
    .ttypography {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    h3 {
      color: #1a1a1a;
      border-bottom: 2px solid #eee;
      padding-bottom: 10px;
    }
    h3 a {
      color: #0066cc;
      text-decoration: none;
    }
    h3 a:hover {
      text-decoration: underline;
    }
    .spoiler {
      margin: 15px 0;
      border: 1px solid #ddd;
      border-radius: 6px;
      overflow: hidden;
    }
    .spoiler-title {
      display: block;
      padding: 12px 15px;
      background: #f0f0f0;
      cursor: pointer;
      font-weight: 600;
      user-select: none;
      border-bottom: 1px solid #ddd;
    }
    .spoiler-title:hover {
      background: #e8e8e8;
    }
    .spoiler-title::before {
      content: '▶ ';
      font-size: 0.8em;
      transition: transform 0.2s;
      display: inline-block;
    }
    .spoiler.open .spoiler-title::before {
      content: '▼ ';
    }
    .spoiler-content {
      padding: 15px;
      background: #fff;
      display: none;
    }
    .spoiler.open .spoiler-content {
      display: block;
    }
    pre, code {
      background: #f5f5f5;
      font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
      font-size: 0.85em;
    }
    pre {
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
    }
    code {
      padding: 2px 5px;
      border-radius: 3px;
    }
    p {
      margin: 10px 0;
    }
    .MathJax {
      font-size: 1.1em;
    }
  </style>
</head>
<body>
  <h1>Editorial</h1>
  <p><a href="https://codeforces.com/blog/entry/146651" target="_blank">View on Codeforces →</a></p>
  
  <div class="ttypography"><p><a href="https://codeforces.com/contest/2151/problem/A" title="Codeforces Round 1053 (Div. 2)">2151A - Incremental Subarray</a></p><p>Author: <a class="rated-user user-red" href="https://codeforces.com/profile/TheScrasse" title="Grandmaster TheScrasse">TheScrasse</a><br> Preparation: <a class="rated-user user-red" href="https://codeforces.com/profile/TheScrasse" title="Grandmaster TheScrasse">TheScrasse</a></p> <div class="spoiler"><b class="spoiler-title">Hint 1</b><div class="spoiler-content" style="display: block;"><p>There are two types of subarrays.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 2</b><div class="spoiler-content" style="display: block;"><p>If there exists <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1"><span class="MJXp-msubsup" id="MJXp-Span-2"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-4" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-5" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-msubsup" id="MJXp-Span-6"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-7" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-8" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-9">i</span><span class="MJXp-mo" id="MJXp-Span-10">+</span><span class="MJXp-mn" id="MJXp-Span-11">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-1">a_i \geq a_{i+1}</script>, how many times can the subarray appear?</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><ul>   <li>If there exists an <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-12"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-13">i</span></span></span><script type="math/tex" id="MathJax-Element-2">i</script> such that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-14"><span class="MJXp-msubsup" id="MJXp-Span-15"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-16" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-17" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-18" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-msubsup" id="MJXp-Span-19"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-20" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-21" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-22">i</span><span class="MJXp-mo" id="MJXp-Span-23">+</span><span class="MJXp-mn" id="MJXp-Span-24">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-3">a_i \geq a_{i+1}</script>, we have <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-25"><span class="MJXp-msubsup" id="MJXp-Span-26"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-27" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-28" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-29" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-30">k</span></span></span><script type="math/tex" id="MathJax-Element-4">a_i = k</script> for some <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-31"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-32">k</span></span></span><script type="math/tex" id="MathJax-Element-5">k</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-33"><span class="MJXp-msubsup" id="MJXp-Span-34"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-35" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-36" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-37">i</span><span class="MJXp-mo" id="MJXp-Span-38">+</span><span class="MJXp-mn" id="MJXp-Span-39">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-40" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-41">1</span></span></span><script type="math/tex" id="MathJax-Element-6">a_{i+1} = 1</script>. The subarray <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-42"><span class="MJXp-mo" id="MJXp-Span-43" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-44">k</span><span class="MJXp-mo" id="MJXp-Span-45" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-46">1</span><span class="MJXp-mo" id="MJXp-Span-47" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-7">[k, 1]</script> appears only once on the blackboard (when James writes <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-48"><span class="MJXp-mn" id="MJXp-Span-49">1</span><span class="MJXp-mo" id="MJXp-Span-50" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-51" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-52" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-53">k</span></span></span><script type="math/tex" id="MathJax-Element-8">1, \ldots, k</script> and then <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-54"><span class="MJXp-mn" id="MJXp-Span-55">1</span><span class="MJXp-mo" id="MJXp-Span-56" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-57" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-58" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-59">k</span><span class="MJXp-mo" id="MJXp-Span-60" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-61">1</span></span></span><script type="math/tex" id="MathJax-Element-9">1, \ldots, k+1</script>). Since <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-62"><span class="MJXp-msubsup" id="MJXp-Span-63"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-64" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-65" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-66" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-67"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-68" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-69" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-70" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-71" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-72" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-73"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-74" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-75" style="vertical-align: -0.4em;">m</span></span></span></span><script type="math/tex" id="MathJax-Element-10">a_1, a_2, \ldots, a_m</script> contains <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-76"><span class="MJXp-mo" id="MJXp-Span-77" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-78">k</span><span class="MJXp-mo" id="MJXp-Span-79" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-80">1</span><span class="MJXp-mo" id="MJXp-Span-81" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-11">[k, 1]</script>, it must appear at most once as well, but the statement guarantees that it appears at least once, so the answer is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-82"><span class="MJXp-mn" id="MJXp-Span-83">1</span></span></span><script type="math/tex" id="MathJax-Element-12">1</script>.</li>   <li>Otherwise, the array <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-84"><span class="MJXp-msubsup" id="MJXp-Span-85"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-86" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-87" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-88" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-89"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-90" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-91" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-92" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-93" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-94" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-95"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-96" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-97" style="vertical-align: -0.4em;">m</span></span></span></span><script type="math/tex" id="MathJax-Element-13">a_1, a_2, \ldots, a_m</script> can be rewritten as <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-98"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-99">l</span><span class="MJXp-mo" id="MJXp-Span-100" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-101">l</span><span class="MJXp-mo" id="MJXp-Span-102" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-103">1</span><span class="MJXp-mo" id="MJXp-Span-104" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-105" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-106" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-107">r</span></span></span><script type="math/tex" id="MathJax-Element-14">l, l+1, \ldots, r</script>, and it appears when James writes <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-108"><span class="MJXp-mn" id="MJXp-Span-109">1</span><span class="MJXp-mo" id="MJXp-Span-110" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-111" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-112" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-113">r</span></span></span><script type="math/tex" id="MathJax-Element-15">1, \ldots, r</script>, then when James writes <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-114"><span class="MJXp-mn" id="MJXp-Span-115">1</span><span class="MJXp-mo" id="MJXp-Span-116" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-117" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-118" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-119">r</span><span class="MJXp-mo" id="MJXp-Span-120" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-121">1</span></span></span><script type="math/tex" id="MathJax-Element-16">1, \ldots, r+1</script>, ..., then when James writes <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-122"><span class="MJXp-mn" id="MJXp-Span-123">1</span><span class="MJXp-mo" id="MJXp-Span-124" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-125" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-126" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-127">n</span></span></span><script type="math/tex" id="MathJax-Element-17">1, \ldots, n</script> (so <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-128"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-129">n</span><span class="MJXp-mo" id="MJXp-Span-130" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-131">r</span><span class="MJXp-mo" id="MJXp-Span-132" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-133">1</span></span></span><script type="math/tex" id="MathJax-Element-18">n-r+1</script> times in total).</li> </ul><p>Complexity: <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-134"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-135">O</span><span class="MJXp-mo" id="MJXp-Span-136" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-137">n</span><span class="MJXp-mo" id="MJXp-Span-138" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-19">O(n)</script></p></div></div> <div class="spoiler"><b class="spoiler-title">Code</b><div class="spoiler-content" style="display: block;"><p><a href="https://codeforces.com/contest/2151/submission/340224512" title="Submission 340224512 by Dominater069">340224512</a></p></div></div><p><a href="https://codeforces.com/contest/2150/problem/A" title="Codeforces Round 1053 (Div. 1)">2150A - Incremental Path</a></p><p>Author: <a class="rated-user user-red" href="https://codeforces.com/profile/TheScrasse" title="International Grandmaster TheScrasse">TheScrasse</a><br> Preparation: <a class="rated-user user-red" href="https://codeforces.com/profile/TheScrasse" title="International Grandmaster TheScrasse">TheScrasse</a></p> <div class="spoiler"><b class="spoiler-title">Hint 1</b><div class="spoiler-content" style="display: block;"><p>Suppose you have already calculated where person <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-139"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-140">i</span><span class="MJXp-mo" id="MJXp-Span-141" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-142">1</span></span></span><script type="math/tex" id="MathJax-Element-20">i-1</script> goes. Can you calculate fast where person <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-143"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-144">i</span></span></span><script type="math/tex" id="MathJax-Element-21">i</script> goes?</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 2</b><div class="spoiler-content" style="display: block;"><p>The first <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-145"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-146">i</span><span class="MJXp-mo" id="MJXp-Span-147" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-148">2</span></span></span><script type="math/tex" id="MathJax-Element-22">i-2</script> cells visited by people <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-149"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-150">i</span><span class="MJXp-mo" id="MJXp-Span-151" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-152">1</span></span></span><script type="math/tex" id="MathJax-Element-23">i-1</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-153"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-154">i</span></span></span><script type="math/tex" id="MathJax-Element-24">i</script> coincide.</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><p>Person <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-155"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-156">i</span></span></span><script type="math/tex" id="MathJax-Element-25">i</script> performs the same commands as person <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-157"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-158">i</span><span class="MJXp-mo" id="MJXp-Span-159" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-160">1</span></span></span><script type="math/tex" id="MathJax-Element-26">i-1</script>, with the addition of the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-161"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-162">i</span></span></span><script type="math/tex" id="MathJax-Element-27">i</script>-th command.</p><p>Now we wonder whether performing the same <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-163"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-164">i</span><span class="MJXp-mo" id="MJXp-Span-165" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-166">1</span></span></span><script type="math/tex" id="MathJax-Element-28">i-1</script> commands means that the first <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-167"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-168">i</span><span class="MJXp-mo" id="MJXp-Span-169" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-170">1</span></span></span><script type="math/tex" id="MathJax-Element-29">i-1</script> cells visited are the same. This is actually false in general, because after person <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-171"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-172">i</span><span class="MJXp-mo" id="MJXp-Span-173" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-174">1</span></span></span><script type="math/tex" id="MathJax-Element-30">i-1</script> performs his commands, he colors a new cell black, and this can change the outcome of the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-175"><span class="MJXp-mo" id="MJXp-Span-176" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-177">i</span><span class="MJXp-mo" id="MJXp-Span-178" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-179">1</span><span class="MJXp-mo" id="MJXp-Span-180" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-31">(i-1)</script>-th operation. However, the outcome of the first <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-181"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-182">i</span><span class="MJXp-mo" id="MJXp-Span-183" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-184">2</span></span></span><script type="math/tex" id="MathJax-Element-32">i-2</script> commands remains the same, because the new black cell is too far from the positions visited in the first <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-185"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-186">i</span><span class="MJXp-mo" id="MJXp-Span-187" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-188">2</span></span></span><script type="math/tex" id="MathJax-Element-33">i-2</script> commands.</p><p>So the position visited by person <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-189"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-190">i</span></span></span><script type="math/tex" id="MathJax-Element-34">i</script> after <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-191"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-192">i</span><span class="MJXp-mo" id="MJXp-Span-193" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-194">2</span></span></span><script type="math/tex" id="MathJax-Element-35">i-2</script> commands is the same position visited by person <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-195"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-196">i</span><span class="MJXp-mo" id="MJXp-Span-197" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-198">1</span></span></span><script type="math/tex" id="MathJax-Element-36">i-1</script> after <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-199"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-200">i</span><span class="MJXp-mo" id="MJXp-Span-201" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-202">2</span></span></span><script type="math/tex" id="MathJax-Element-37">i-2</script> commands, and it's enough to simulate the last two commands naively.</p><p>Complexity: <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-203"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-204">O</span><span class="MJXp-mo" id="MJXp-Span-205" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-206">n</span><span class="MJXp-mi" id="MJXp-Span-207">log</span><span class="MJXp-mo" id="MJXp-Span-208" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-209">n</span><span class="MJXp-mo" id="MJXp-Span-210" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-38">O(n \log n)</script> or <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-211"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-212">O</span><span class="MJXp-mo" id="MJXp-Span-213" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-214">n</span><span class="MJXp-mo" id="MJXp-Span-215" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-39">O(n)</script></p></div></div> <div class="spoiler"><b class="spoiler-title">Code</b><div class="spoiler-content" style="display: block;"><p><a href="https://codeforces.com/contest/2150/submission/340224365" title="Submission 340224365 by Dominater069">340224365</a></p></div></div><p><a href="https://codeforces.com/contest/2151/problem/C" title="Codeforces Round 1053 (Div. 2)">2151C - Incremental Stay</a></p><p>Author: <a class="rated-user user-red" href="https://codeforces.com/profile/TheScrasse" title="International Grandmaster TheScrasse">TheScrasse</a><br> Preparation: <a class="rated-user user-red" href="https://codeforces.com/profile/TheScrasse" title="International Grandmaster TheScrasse">TheScrasse</a></p> <div class="spoiler"><b class="spoiler-title">Hint 1</b><div class="spoiler-content" style="display: block;"><p>For a fixed <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-216"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-217">k</span></span></span><script type="math/tex" id="MathJax-Element-40">k</script>, find a greedy strategy.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 2</b><div class="spoiler-content" style="display: block;"><p>You can calculate the answer with prefix sums.</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><p>Consider the following strategy:</p> <ul>   <li>Iterate over events in increasing order.</li>   <li>In the first <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-218"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-219">k</span></span></span><script type="math/tex" id="MathJax-Element-41">k</script> events, people enter the museum. In the last <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-220"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-221">k</span></span></span><script type="math/tex" id="MathJax-Element-42">k</script> events, people exit. For the other events, if the current number of people is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-222"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-223">k</span></span></span><script type="math/tex" id="MathJax-Element-43">k</script> a person exits, otherwise a person enters.</li> </ul><p>This strategy is optimal, because it maximizes the number of people present at any time in the museum.</p> <ul>   <li>After the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-224"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-225">i</span></span></span><script type="math/tex" id="MathJax-Element-44">i</script>-th event with <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-226"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-227">i</span><span class="MJXp-mo" id="MJXp-Span-228" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-229">k</span></span></span><script type="math/tex" id="MathJax-Element-45">i \leq k</script>, at most <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-230"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-231">i</span></span></span><script type="math/tex" id="MathJax-Element-46">i</script> people can be inside the museum, and in fact we have exactly <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-232"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-233">i</span></span></span><script type="math/tex" id="MathJax-Element-47">i</script>.</li>   <li>A similar argument works for the last <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-234"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-235">k</span></span></span><script type="math/tex" id="MathJax-Element-48">k</script> events (you have to use that at the end the museum is empty).</li>   <li>For the other events, after the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-236"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-237">i</span></span></span><script type="math/tex" id="MathJax-Element-49">i</script>-th event we know that the parity of the number of people is equal to the parity of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-238"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-239">i</span></span></span><script type="math/tex" id="MathJax-Element-50">i</script>. In fact, the number of people is either <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-240"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-241">k</span></span></span><script type="math/tex" id="MathJax-Element-51">k</script> or <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-242"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-243">k</span><span class="MJXp-mo" id="MJXp-Span-244" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-245">1</span></span></span><script type="math/tex" id="MathJax-Element-52">k-1</script>, which is the maximum possible number of people <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-246"><span class="MJXp-mo" id="MJXp-Span-247" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-248">k</span></span></span><script type="math/tex" id="MathJax-Element-53">\leq k</script> with the correct parity.</li> </ul><p>Now we have to calculate the following terms:</p> <ul>   <li><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-249"><span class="MJXp-mn" id="MJXp-Span-250">1</span><span class="MJXp-mo" id="MJXp-Span-251" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-msubsup" id="MJXp-Span-252"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-253" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-254" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-255" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-256">2</span><span class="MJXp-mo" id="MJXp-Span-257" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-msubsup" id="MJXp-Span-258"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-259" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-260" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-261" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mo" id="MJXp-Span-262" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-263" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-264">k</span><span class="MJXp-mo" id="MJXp-Span-265" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-msubsup" id="MJXp-Span-266"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-267" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-268" style="vertical-align: -0.4em;">k</span></span></span></span><script type="math/tex" id="MathJax-Element-54">1 \cdot a_1 + 2 \cdot a_2 + \ldots + k \cdot a_k</script>: can be done with prefix sums of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-269"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-270">i</span><span class="MJXp-mo" id="MJXp-Span-271" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-msubsup" id="MJXp-Span-272"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-273" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-274" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-55">i \cdot a_i</script>.</li>   <li><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-275"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-276">k</span><span class="MJXp-mo" id="MJXp-Span-277" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-msubsup" id="MJXp-Span-278"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-279" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-280" style="vertical-align: -0.4em;"><span class="MJXp-mn" id="MJXp-Span-281">2</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-282">n</span><span class="MJXp-mo" id="MJXp-Span-283">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-284">k</span><span class="MJXp-mo" id="MJXp-Span-285">+</span><span class="MJXp-mn" id="MJXp-Span-286">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-287" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mo" id="MJXp-Span-288" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-289">k</span><span class="MJXp-mo" id="MJXp-Span-290" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-291">1</span><span class="MJXp-mo" id="MJXp-Span-292" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-293" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-msubsup" id="MJXp-Span-294"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-295" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-296" style="vertical-align: -0.4em;"><span class="MJXp-mn" id="MJXp-Span-297">2</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-298">n</span><span class="MJXp-mo" id="MJXp-Span-299">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-300">k</span><span class="MJXp-mo" id="MJXp-Span-301">+</span><span class="MJXp-mn" id="MJXp-Span-302">2</span></span></span><span class="MJXp-mo" id="MJXp-Span-303" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mo" id="MJXp-Span-304" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-305" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-306">1</span><span class="MJXp-mo" id="MJXp-Span-307" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-msubsup" id="MJXp-Span-308"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-309" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-310" style="vertical-align: -0.4em;"><span class="MJXp-mn" id="MJXp-Span-311">2</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-312">n</span></span></span></span></span><script type="math/tex" id="MathJax-Element-56">k \cdot a_{2n-k+1} + (k-1) \cdot a_{2n-k+2} + \ldots + 1 \cdot a_{2n}</script>: can be done with prefix sums of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-313"><span class="MJXp-mo" id="MJXp-Span-314" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-315">2</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-316">n</span><span class="MJXp-mo" id="MJXp-Span-317" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-318">i</span><span class="MJXp-mo" id="MJXp-Span-319" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-320">1</span><span class="MJXp-mo" id="MJXp-Span-321" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-322" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-msubsup" id="MJXp-Span-323"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-324" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-325" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-57">(2n-i+1) \cdot a_i</script>:</li>   <li><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-326"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-327">k</span><span class="MJXp-mo" id="MJXp-Span-328" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mo" id="MJXp-Span-329" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-330"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-331" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-332" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-333">k</span><span class="MJXp-mo" id="MJXp-Span-334">+</span><span class="MJXp-mn" id="MJXp-Span-335">2</span></span></span><span class="MJXp-mo" id="MJXp-Span-336" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-337"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-338" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-339" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-340">k</span><span class="MJXp-mo" id="MJXp-Span-341">+</span><span class="MJXp-mn" id="MJXp-Span-342">4</span></span></span><span class="MJXp-mo" id="MJXp-Span-343" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mo" id="MJXp-Span-344" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-345" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-346"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-347" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-348" style="vertical-align: -0.4em;"><span class="MJXp-mn" id="MJXp-Span-349">2</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-350">n</span><span class="MJXp-mo" id="MJXp-Span-351">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-352">k</span></span></span><span class="MJXp-mo" id="MJXp-Span-353" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-58">k \cdot (a_{k+2} + a_{k+4} + \ldots + a_{2n-k})</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-354"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-355">k</span><span class="MJXp-mo" id="MJXp-Span-356" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mo" id="MJXp-Span-357" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-358"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-359" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-360" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-361">k</span><span class="MJXp-mo" id="MJXp-Span-362">+</span><span class="MJXp-mn" id="MJXp-Span-363">2</span></span></span><span class="MJXp-mo" id="MJXp-Span-364" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-365"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-366" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-367" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-368">k</span><span class="MJXp-mo" id="MJXp-Span-369">+</span><span class="MJXp-mn" id="MJXp-Span-370">4</span></span></span><span class="MJXp-mo" id="MJXp-Span-371" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mo" id="MJXp-Span-372" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-373" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-374"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-375" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-376" style="vertical-align: -0.4em;"><span class="MJXp-mn" id="MJXp-Span-377">2</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-378">n</span><span class="MJXp-mo" id="MJXp-Span-379">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-380">k</span><span class="MJXp-mo" id="MJXp-Span-381">−</span><span class="MJXp-mn" id="MJXp-Span-382">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-383" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-59">k \cdot (a_{k+2} + a_{k+4} + \ldots + a_{2n-k-1})</script> and similar: can be done with prefix sums of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-384"><span class="MJXp-msubsup" id="MJXp-Span-385"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-386" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-387" style="vertical-align: -0.4em;"><span class="MJXp-mn" id="MJXp-Span-388">2</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-389">i</span></span></span></span></span><script type="math/tex" id="MathJax-Element-60">a_{2i}</script>, and prefix sums of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-390"><span class="MJXp-msubsup" id="MJXp-Span-391"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-392" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-393" style="vertical-align: -0.4em;"><span class="MJXp-mn" id="MJXp-Span-394">2</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-395">i</span><span class="MJXp-mo" id="MJXp-Span-396">+</span><span class="MJXp-mn" id="MJXp-Span-397">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-61">a_{2i+1}</script>.</li> </ul><p>Alternatively, we can calculate the answer for some <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-398"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-399">k</span></span></span><script type="math/tex" id="MathJax-Element-62">k</script> fast using the answer for <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-400"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-401">k</span><span class="MJXp-mo" id="MJXp-Span-402" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-403">2</span></span></span><script type="math/tex" id="MathJax-Element-63">k-2</script> and changing a few terms.</p><p>Complexity: <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-404"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-405">O</span><span class="MJXp-mo" id="MJXp-Span-406" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-407">n</span><span class="MJXp-mo" id="MJXp-Span-408" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-64">O(n)</script></p></div></div> <div class="spoiler"><b class="spoiler-title">Code</b><div class="spoiler-content" style="display: block;"><p><a href="https://codeforces.com/contest/2151/submission/340224635" title="Submission 340224635 by Dominater069">340224635</a></p></div></div><p><a href="https://codeforces.com/contest/2150/problem/B" title="Codeforces Round 1053 (Div. 1)">2150B - Grid Counting</a></p><p>Author: <a class="rated-user user-red" href="https://codeforces.com/profile/TheScrasse" title="International Grandmaster TheScrasse">TheScrasse</a><br> Preparation: <a class="rated-user user-red" href="https://codeforces.com/profile/Dominater069" title="International Grandmaster Dominater069">Dominater069</a></p> <div class="spoiler"><b class="spoiler-title">Hint 1</b><div class="spoiler-content" style="display: block;"><p>Let's ignore the first condition for now.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 2</b><div class="spoiler-content" style="display: block;"><p>Some cells are necessarily black.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 3</b><div class="spoiler-content" style="display: block;"><p>Then, some cells are necessarily white.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 4</b><div class="spoiler-content" style="display: block;"><p>Now what happens with <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-409"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-410">k</span><span class="MJXp-mo" id="MJXp-Span-411" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-412">2</span></span></span><script type="math/tex" id="MathJax-Element-65">k = 2</script>? You can conclude that some cells in column <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-413"><span class="MJXp-mn" id="MJXp-Span-414">2</span></span></span><script type="math/tex" id="MathJax-Element-66">2</script> are necessarily white.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 5</b><div class="spoiler-content" style="display: block;"><p>Repeat with <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-415"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-416">k</span><span class="MJXp-mo" id="MJXp-Span-417" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-418">3</span></span></span><script type="math/tex" id="MathJax-Element-67">k = 3</script>, etc.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 6</b><div class="spoiler-content" style="display: block;"><p>Once you find all the grids which satisfy the second and the third conditions, iterate over rows in decreasing order.</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><ul>   <li><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-419"><span class="MJXp-mo" id="MJXp-Span-420" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-421">1</span><span class="MJXp-mo" id="MJXp-Span-422" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-423">1</span><span class="MJXp-mo" id="MJXp-Span-424" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-68">(1, 1)</script> is black, because of the second condition with <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-425"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-426">k</span><span class="MJXp-mo" id="MJXp-Span-427" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-428">1</span></span></span><script type="math/tex" id="MathJax-Element-69">k = 1</script>.</li>   <li>Then, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-429"><span class="MJXp-mo" id="MJXp-Span-430" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-431">i</span><span class="MJXp-mo" id="MJXp-Span-432" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-433">1</span><span class="MJXp-mo" id="MJXp-Span-434" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-70">(i, 1)</script> is white for <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-435"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-436">i</span><span class="MJXp-mo" id="MJXp-Span-437" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mn" id="MJXp-Span-438">2</span></span></span><script type="math/tex" id="MathJax-Element-71">i \geq 2</script>, because of the third condition with <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-439"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-440">k</span><span class="MJXp-mo" id="MJXp-Span-441" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-442">n</span></span></span><script type="math/tex" id="MathJax-Element-72">k = n</script>.</li>   <li>Then, either <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-443"><span class="MJXp-mo" id="MJXp-Span-444" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-445">1</span><span class="MJXp-mo" id="MJXp-Span-446" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-447">2</span><span class="MJXp-mo" id="MJXp-Span-448" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-73">(1, 2)</script> or <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-449"><span class="MJXp-mo" id="MJXp-Span-450" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-451">2</span><span class="MJXp-mo" id="MJXp-Span-452" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-453">2</span><span class="MJXp-mo" id="MJXp-Span-454" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-74">(2, 2)</script> is black, because of the second condition with <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-455"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-456">k</span><span class="MJXp-mo" id="MJXp-Span-457" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-458">2</span></span></span><script type="math/tex" id="MathJax-Element-75">k = 2</script>.</li>   <li>Then, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-459"><span class="MJXp-mo" id="MJXp-Span-460" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-461">i</span><span class="MJXp-mo" id="MJXp-Span-462" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-463">2</span><span class="MJXp-mo" id="MJXp-Span-464" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-76">(i, 2)</script> is white for <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-465"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-466">i</span><span class="MJXp-mo" id="MJXp-Span-467" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mn" id="MJXp-Span-468">3</span></span></span><script type="math/tex" id="MathJax-Element-77">i \geq 3</script>, because of the third condition with <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-469"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-470">k</span><span class="MJXp-mo" id="MJXp-Span-471" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-472">n</span><span class="MJXp-mo" id="MJXp-Span-473" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-474">1</span></span></span><script type="math/tex" id="MathJax-Element-78">k = n-1</script>.</li>   <li><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-475"><span class="MJXp-mo" id="MJXp-Span-476" style="margin-left: 0em; margin-right: 0em;">…</span></span></span><script type="math/tex" id="MathJax-Element-79">\ldots</script></li> </ul><p>In general, only <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-477"><span class="MJXp-mo" id="MJXp-Span-478" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-479">i</span><span class="MJXp-mo" id="MJXp-Span-480" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-481">j</span><span class="MJXp-mo" id="MJXp-Span-482" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-80">(i, j)</script> with <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-483"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-484">i</span><span class="MJXp-mo" id="MJXp-Span-485" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-486">j</span></span></span><script type="math/tex" id="MathJax-Element-81">i \leq j</script> can be black. If you repeat the same process starting from <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-487"><span class="MJXp-mo" id="MJXp-Span-488" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-489">1</span><span class="MJXp-mo" id="MJXp-Span-490" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-491">n</span><span class="MJXp-mo" id="MJXp-Span-492" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-82">(1, n)</script>, you can conclude that only <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-493"><span class="MJXp-mo" id="MJXp-Span-494" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-495">i</span><span class="MJXp-mo" id="MJXp-Span-496" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-497">j</span><span class="MJXp-mo" id="MJXp-Span-498" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-83">(i, j)</script> with <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-499"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-500">i</span><span class="MJXp-mo" id="MJXp-Span-501" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-502">n</span><span class="MJXp-mo" id="MJXp-Span-503" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-504">j</span><span class="MJXp-mo" id="MJXp-Span-505" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-506">1</span></span></span><script type="math/tex" id="MathJax-Element-84">i \leq n-j+1</script> can be black.</p><p>So, for each column <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-507"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-508">j</span></span></span><script type="math/tex" id="MathJax-Element-85">j</script>, there is exactly one black cell <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-509"><span class="MJXp-mo" id="MJXp-Span-510" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-511">i</span><span class="MJXp-mo" id="MJXp-Span-512" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-513">j</span><span class="MJXp-mo" id="MJXp-Span-514" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-86">(i, j)</script>, with <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-519"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-520">i</span><span class="MJXp-mo" id="MJXp-Span-521" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mo" id="MJXp-Span-522" style="margin-left: 0.333em; margin-right: 0.333em;">min</span><span class="MJXp-mo" id="MJXp-Span-523" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-524">j</span><span class="MJXp-mo" id="MJXp-Span-525" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-526">n</span><span class="MJXp-mo" id="MJXp-Span-527" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-528">j</span><span class="MJXp-mo" id="MJXp-Span-529" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-530">1</span><span class="MJXp-mo" id="MJXp-Span-531" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-87">i \leq \min(j, n-j+1)</script>.</p><p>Now you can iterate over rows in decreasing order. For each row, you have some number <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-532"><span class="MJXp-msubsup" id="MJXp-Span-533"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-534" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-535" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-88">c_i</script> of available columns, and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-536"><span class="MJXp-msubsup" id="MJXp-Span-537"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-538" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-539" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-89">a_i</script> columns you must fill, and this can be done in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-540"><span class="MJXp-mrow" id="MJXp-Span-541"><span class="MJXp-TeXmathchoice" id="MJXp-Span-542"><span class="MJXp-mstyle" id="MJXp-Span-543"><span class="MJXp-mrow" id="MJXp-Span-544"><span class="MJXp-mo" id="MJXp-Span-545" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.083em;"><span class="MJXp-right MJXp-scale10" style="font-size: 1.333em; margin-left: 0.07em;">(</span></span></span></span></span><span class="MJXp-mfrac" id="MJXp-Span-546"><span class="MJXp-box MJXp-script"><span class="MJXp-msubsup" id="MJXp-Span-547"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-548" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-549" style="vertical-align: -0.4em;">i</span></span></span><span class="MJXp-box" style="margin-top: -0.7em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-msubsup" id="MJXp-Span-550"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-551" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-552" style="vertical-align: -0.4em;">i</span></span></span></span></span></span></span><span class="MJXp-TeXmathchoice" id="MJXp-Span-553"><span class="MJXp-mstyle" id="MJXp-Span-554"><span class="MJXp-mrow" id="MJXp-Span-555"><span class="MJXp-mo" id="MJXp-Span-556" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.083em;"><span class="MJXp-right MJXp-scale10" style="font-size: 1.333em; margin-left: 0.07em;">)</span></span></span></span></span></span></span></span><script type="math/tex" id="MathJax-Element-90">\binom{c_i}{a_i}</script> ways. You can calculate <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-557"><span class="MJXp-msubsup" id="MJXp-Span-558"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-559" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-560" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-91">c_i</script> from <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-561"><span class="MJXp-msubsup" id="MJXp-Span-562"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-563" style="margin-right: 0.05em;">c</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-564" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-565">i</span><span class="MJXp-mo" id="MJXp-Span-566">+</span><span class="MJXp-mn" id="MJXp-Span-567">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-92">c_{i+1}</script> by calculating the number of new available columns, and subtracting the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-568"><span class="MJXp-msubsup" id="MJXp-Span-569"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-570" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-571" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-572">i</span><span class="MJXp-mo" id="MJXp-Span-573">+</span><span class="MJXp-mn" id="MJXp-Span-574">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-93">a_{i+1}</script> columns you must fill.</p><p>Complexity: <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-575"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-576">O</span><span class="MJXp-mo" id="MJXp-Span-577" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-578">n</span><span class="MJXp-mi" id="MJXp-Span-579">log</span><span class="MJXp-mo" id="MJXp-Span-580" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-581">n</span><span class="MJXp-mo" id="MJXp-Span-582" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-94">O(n \log n)</script> or <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-583"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-584">O</span><span class="MJXp-mo" id="MJXp-Span-585" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-586">n</span><span class="MJXp-mo" id="MJXp-Span-587" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-95">O(n)</script></p></div></div> <div class="spoiler"><b class="spoiler-title">Code</b><div class="spoiler-content" style="display: block;"><p><a href="https://codeforces.com/contest/2150/submission/340224711" title="Submission 340224711 by Dominater069">340224711</a></p></div></div><p><a href="https://codeforces.com/contest/2150/problem/C" title="Codeforces Round 1053 (Div. 1)">2150C - Limited Edition Shop</a></p><p>Author: <a class="rated-user user-red" href="https://codeforces.com/profile/TheScrasse" title="International Grandmaster TheScrasse">TheScrasse</a><br> Preparation: <a class="rated-user user-red" href="https://codeforces.com/profile/TheScrasse" title="International Grandmaster TheScrasse">TheScrasse</a></p> <div class="spoiler"><b class="spoiler-title">Hint 1</b><div class="spoiler-content" style="display: block;"><p>Try to come up with a condition for when Alice can choose some subset of items.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 2</b><div class="spoiler-content" style="display: block;"><p>Write a dynamic programming <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-588"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-589">O</span><span class="MJXp-mo" id="MJXp-Span-590" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-591"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-592" style="margin-right: 0.05em;">n</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-593" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-594" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-96">O(n^2)</script> solution based on the condition.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 3</b><div class="spoiler-content" style="display: block;"><p>Optimize the solution with data structures like segment trees.</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><p>We can assume <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-595"><span class="MJXp-msubsup" id="MJXp-Span-596"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-597" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-598" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-599" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-600">i</span></span></span><script type="math/tex" id="MathJax-Element-97">a_i = i</script> for all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-601"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-602">i</span></span></span><script type="math/tex" id="MathJax-Element-98">i</script>. Now, if Alice wants to take some subset <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-603"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-604">S</span></span></span><script type="math/tex" id="MathJax-Element-99">S</script>, we have the following condition:</p> <ul>   <li>For all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-605"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-606">x</span><span class="MJXp-mo" id="MJXp-Span-607" style="margin-left: 0.333em; margin-right: 0.333em;">∉</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-608">S</span></span></span><script type="math/tex" id="MathJax-Element-100">x \notin S</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-609"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-610">y</span><span class="MJXp-mo" id="MJXp-Span-611" style="margin-left: 0.333em; margin-right: 0.333em;">∈</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-612">S</span></span></span><script type="math/tex" id="MathJax-Element-101">y \in S</script>, if <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-613"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-614">x</span><span class="MJXp-mo" id="MJXp-Span-615" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-616">y</span></span></span><script type="math/tex" id="MathJax-Element-102">x < y</script>, then <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-617"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-618">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-619">o</span><span class="MJXp-msubsup" id="MJXp-Span-620"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-621" style="margin-right: 0.05em;">s</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-622" style="vertical-align: -0.4em;">x</span></span><span class="MJXp-mo" id="MJXp-Span-623" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-624">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-625">o</span><span class="MJXp-msubsup" id="MJXp-Span-626"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-627" style="margin-right: 0.05em;">s</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-628" style="vertical-align: -0.4em;">y</span></span></span></span><script type="math/tex" id="MathJax-Element-103">pos_x < pos_y</script>, where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-629"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-630">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-631">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-632">s</span><span class="MJXp-mo" id="MJXp-Span-633" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-634"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-635" style="margin-right: 0.05em;">b</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-636" style="vertical-align: 0.5em;"><span class="MJXp-mo" id="MJXp-Span-637">−</span><span class="MJXp-mn" id="MJXp-Span-638">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-104">pos = b^{-1}</script></li> </ul><p><strong>Proof:</strong> If <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-639"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-640">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-641">o</span><span class="MJXp-msubsup" id="MJXp-Span-642"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-643" style="margin-right: 0.05em;">s</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-644" style="vertical-align: -0.4em;">x</span></span><span class="MJXp-mo" id="MJXp-Span-645" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-646">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-647">o</span><span class="MJXp-msubsup" id="MJXp-Span-648"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-649" style="margin-right: 0.05em;">s</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-650" style="vertical-align: -0.4em;">y</span></span></span></span><script type="math/tex" id="MathJax-Element-105">pos_x > pos_y</script>, the item <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-651"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-652">y</span></span></span><script type="math/tex" id="MathJax-Element-106">y</script> cannot be taken before <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-653"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-654">x</span></span></span><script type="math/tex" id="MathJax-Element-107">x</script> because <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-655"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-656">x</span></span></span><script type="math/tex" id="MathJax-Element-108">x</script> comes first in Alice's priority order. And item <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-657"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-658">x</span></span></span><script type="math/tex" id="MathJax-Element-109">x</script> cannot be taken before <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-659"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-660">y</span></span></span><script type="math/tex" id="MathJax-Element-110">y</script> because <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-661"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-662">y</span></span></span><script type="math/tex" id="MathJax-Element-111">y</script> comes first in Bob's priority order.</p><p>Now, if the condition is satisfied, infact all subsets are valid. A simple algorithm works, just make Alice take all items in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-663"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-664">S</span></span></span><script type="math/tex" id="MathJax-Element-112">S</script> in increasing order, and when Alice wants to take some item but it is not the first remaining item according to her priority order, Bob takes items till it becomes first in her priority order.</p><p>Now, we can write our dynamic programming solution: <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-665"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-666">d</span><span class="MJXp-msubsup" id="MJXp-Span-667"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-668" style="margin-right: 0.05em;">p</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-669" style="vertical-align: -0.4em;"><span class="MJXp-mo" id="MJXp-Span-670">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-671">i</span><span class="MJXp-mo" id="MJXp-Span-672">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-673">j</span><span class="MJXp-mo" id="MJXp-Span-674">)</span></span></span><span class="MJXp-mo" id="MJXp-Span-675" style="margin-left: 0.333em; margin-right: 0.333em;">=</span></span></span><script type="math/tex" id="MathJax-Element-113">dp_{(i, j)} =</script> maximum sum of items taken by Alice within the first <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-676"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-677">i</span></span></span><script type="math/tex" id="MathJax-Element-114">i</script> items such that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-678"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-679">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-680">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-681">x</span><span class="MJXp-mo" id="MJXp-Span-682" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-683">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-684">o</span><span class="MJXp-msubsup" id="MJXp-Span-685"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-686" style="margin-right: 0.05em;">s</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-687" style="vertical-align: -0.4em;">x</span></span><span class="MJXp-mo" id="MJXp-Span-688" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-115">max(pos_x)</script> among Bob's items is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-689"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-690">j</span></span></span><script type="math/tex" id="MathJax-Element-116">j</script>.</p><p>Transitions are:</p> <ul>   <li>We are allowed to let Alice take item <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-691"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-692">i</span><span class="MJXp-mo" id="MJXp-Span-693" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-694">1</span></span></span><script type="math/tex" id="MathJax-Element-117">i + 1</script> if and only if <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-695"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-696">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-697">o</span><span class="MJXp-msubsup" id="MJXp-Span-698"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-699" style="margin-right: 0.05em;">s</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-700" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-701" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-702">j</span></span></span><script type="math/tex" id="MathJax-Element-118">pos_i > j</script>.</li>   <li>Bob can take item <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-703"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-704">i</span><span class="MJXp-mo" id="MJXp-Span-705" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-706">1</span></span></span><script type="math/tex" id="MathJax-Element-119">i + 1</script> without restrictions, and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-707"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-708">j</span></span></span><script type="math/tex" id="MathJax-Element-120">j</script> gets updated to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-709"><span class="MJXp-mo" id="MJXp-Span-710" style="margin-left: 0.333em; margin-right: 0.333em;">max</span><span class="MJXp-mo" id="MJXp-Span-711" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-712">j</span><span class="MJXp-mo" id="MJXp-Span-713" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-714">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-715">o</span><span class="MJXp-msubsup" id="MJXp-Span-716"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-717" style="margin-right: 0.05em;">s</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-718" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-719">i</span><span class="MJXp-mo" id="MJXp-Span-720">+</span><span class="MJXp-mn" id="MJXp-Span-721">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-722" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-121">\max(j, pos_{i + 1})</script></li> </ul><p>We then optimize this with storing a segment tree over the states <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-723"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-724">j</span></span></span><script type="math/tex" id="MathJax-Element-122">j</script>. The first type of transition is a range add query, the second type of transition can be split into <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-725"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-726">j</span><span class="MJXp-mo" id="MJXp-Span-727" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-728">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-729">o</span><span class="MJXp-msubsup" id="MJXp-Span-730"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-731" style="margin-right: 0.05em;">s</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-732" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-733">i</span><span class="MJXp-mo" id="MJXp-Span-734">+</span><span class="MJXp-mn" id="MJXp-Span-735">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-123">j < pos_{i + 1}</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-736"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-737">j</span><span class="MJXp-mo" id="MJXp-Span-738" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-739">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-740">o</span><span class="MJXp-msubsup" id="MJXp-Span-741"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-742" style="margin-right: 0.05em;">s</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-743" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-744">i</span><span class="MJXp-mo" id="MJXp-Span-745">+</span><span class="MJXp-mn" id="MJXp-Span-746">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-124">j > pos_{i + 1}</script>, in the first case we do nothing, and in the second case we need a range max query.</p><p>All of the above operations can be handled with a lazy segment tree. The time complexity is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-747"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-748">O</span><span class="MJXp-mo" id="MJXp-Span-749" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-750">n</span><span class="MJXp-mo" id="MJXp-Span-751" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-752">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-753">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-754">g</span><span class="MJXp-mo" id="MJXp-Span-755" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-756">n</span><span class="MJXp-mo" id="MJXp-Span-757" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-758" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-125">O(n \cdot log(n))</script>.</p></div></div> <div class="spoiler"><b class="spoiler-title">Code</b><div class="spoiler-content" style="display: block;"><p><a href="https://codeforces.com/contest/2150/submission/340224797" title="Submission 340224797 by Dominater069">340224797</a></p></div></div><p><a href="https://codeforces.com/contest/2150/problem/D" title="Codeforces Round 1053 (Div. 1)">2150D - Attraction Theory</a></p><p>Author: <a class="rated-user user-red" href="https://codeforces.com/profile/Dominater069" title="International Grandmaster Dominater069">Dominater069</a><br> Preparation: <a class="rated-user user-red" href="https://codeforces.com/profile/Dominater069" title="International Grandmaster Dominater069">Dominater069</a></p> <div class="spoiler"><b class="spoiler-title">Hint 1</b><div class="spoiler-content" style="display: block;"><p>Find a characterization for when a position array <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-759"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-760">p</span></span></span><script type="math/tex" id="MathJax-Element-126">p</script> is possible. It helps to think in terms of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-761"><span class="MJXp-msubsup" id="MJXp-Span-762"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-763" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-764" style="vertical-align: -0.4em;">x</span></span><span class="MJXp-mo" id="MJXp-Span-765" style="margin-left: 0.333em; margin-right: 0.333em;">=</span></span></span><script type="math/tex" id="MathJax-Element-127">f_x =</script> the number of people at coordinate <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-766"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-767">x</span></span></span><script type="math/tex" id="MathJax-Element-128">x</script> instead.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 2</b><div class="spoiler-content" style="display: block;"><p>Essentially, an attraction at <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-768"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-769">x</span></span></span><script type="math/tex" id="MathJax-Element-129">x</script> combines the people standing at <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-770"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-771">x</span><span class="MJXp-mo" id="MJXp-Span-772" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-773">1</span><span class="MJXp-mo" id="MJXp-Span-774" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-775">x</span></span></span><script type="math/tex" id="MathJax-Element-130">x - 1, x</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-776"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-777">x</span><span class="MJXp-mo" id="MJXp-Span-778" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-779">1</span></span></span><script type="math/tex" id="MathJax-Element-131">x + 1</script>. Each update unites <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-780"><span class="MJXp-mn" id="MJXp-Span-781">3</span></span></span><script type="math/tex" id="MathJax-Element-132">3</script> components into one, except for updates at the edge.</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution Part 1</b><div class="spoiler-content" style="display: block;"><p>Read the hints. We are trying to find a characterization for valid sequences <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-782"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-783">p</span></span></span><script type="math/tex" id="MathJax-Element-133">p</script>. </p><p>We can prove the following necessary conditions easily by considering what happens when an attraction is placed in different positions, </p> <ul>   <li>There exists <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-784"><span class="MJXp-mn" id="MJXp-Span-785">1</span><span class="MJXp-mo" id="MJXp-Span-786" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-787">L</span><span class="MJXp-mo" id="MJXp-Span-788" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-789">R</span><span class="MJXp-mo" id="MJXp-Span-790" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-791">n</span></span></span><script type="math/tex" id="MathJax-Element-134">1 \le L \le R \le n</script> such that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-792"><span class="MJXp-msubsup" id="MJXp-Span-793"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-794" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-795" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-796" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mn" id="MJXp-Span-797">1</span></span></span><script type="math/tex" id="MathJax-Element-135">f_i \ge 1</script> if and only if <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-798"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-799">L</span><span class="MJXp-mo" id="MJXp-Span-800" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-801">i</span><span class="MJXp-mo" id="MJXp-Span-802" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-803">R</span></span></span><script type="math/tex" id="MathJax-Element-136">L \le i \le R</script>.</li>   <li><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-804"><span class="MJXp-msubsup" id="MJXp-Span-805"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-806" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-807" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-137">f_i</script> is odd for all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-808"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-809">L</span><span class="MJXp-mo" id="MJXp-Span-810" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-811">i</span><span class="MJXp-mo" id="MJXp-Span-812" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-813">R</span></span></span><script type="math/tex" id="MathJax-Element-138">L < i < R</script>.</li> </ul><p>Further, these conditions are sufficient, and a simple construction is to do <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-814"><span class="MJXp-mfrac" id="MJXp-Span-815" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-msubsup" id="MJXp-Span-816"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-817" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-818" style="vertical-align: -0.4em;">i</span></span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mn" id="MJXp-Span-819">2</span></span></span></span></span></span></span></span><script type="math/tex" id="MathJax-Element-139">\frac{f_i}{2}</script> attractions at the position of the centre of the group of people finally at <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-820"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-821">i</span></span></span><script type="math/tex" id="MathJax-Element-140">i</script> (The edges are handled easily). Also, you may have to do some translations at the end, which can be done by attracting at <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-822"><span class="MJXp-mn" id="MJXp-Span-823">1</span></span></span><script type="math/tex" id="MathJax-Element-141">1</script> or <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-824"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-825">n</span></span></span><script type="math/tex" id="MathJax-Element-142">n</script>.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 3</b><div class="spoiler-content" style="display: block;"><p>Try to fix <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-826"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-827">L</span></span></span><script type="math/tex" id="MathJax-Element-143">L</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-828"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-829">R</span><span class="MJXp-mo" id="MJXp-Span-830" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-831">L</span><span class="MJXp-mo" id="MJXp-Span-832" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-833">1</span></span></span><script type="math/tex" id="MathJax-Element-144">R - L + 1</script>, and then calculate the sum under these restrictions.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 4</b><div class="spoiler-content" style="display: block;"><p>The middle <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-834"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-835">R</span><span class="MJXp-mo" id="MJXp-Span-836" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-837">L</span><span class="MJXp-mo" id="MJXp-Span-838" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-839">1</span></span></span><script type="math/tex" id="MathJax-Element-145">R - L - 1</script> variables have to be odd, and the outer <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-840"><span class="MJXp-mn" id="MJXp-Span-841">2</span></span></span><script type="math/tex" id="MathJax-Element-146">2</script> variables can have any parity. Fix the parity of the outer elements.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 5</b><div class="spoiler-content" style="display: block;"><p>Use expected value symmetry arguments to calculate the sum fast.</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution Part 2</b><div class="spoiler-content" style="display: block;"><p>Assume <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-842"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-843">L</span><span class="MJXp-mo" id="MJXp-Span-844" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-845">1</span></span></span><script type="math/tex" id="MathJax-Element-147">L = 1</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-846"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-847">R</span><span class="MJXp-mo" id="MJXp-Span-848" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-849">K</span></span></span><script type="math/tex" id="MathJax-Element-148">R = K</script> (<span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-850"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-851">K</span><span class="MJXp-mo" id="MJXp-Span-852" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-mn" id="MJXp-Span-853">1</span></span></span><script type="math/tex" id="MathJax-Element-149">K > 1</script>) for now. We have the equation <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-854"><span class="MJXp-msubsup" id="MJXp-Span-855"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-856" style="margin-right: 0.05em;">f</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-857" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-858" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-859"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-860" style="margin-right: 0.05em;">f</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-861" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-862" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-863"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-864" style="margin-right: 0.05em;">f</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-865" style="vertical-align: -0.4em;">3</span></span><span class="MJXp-mo" id="MJXp-Span-866" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mo" id="MJXp-Span-867" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-868" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-869"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-870" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-871" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-mo" id="MJXp-Span-872" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-873">n</span></span></span><script type="math/tex" id="MathJax-Element-150">f_1 + f_2 + f_3 + \ldots + f_k = n</script>, and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-874"><span class="MJXp-msubsup" id="MJXp-Span-875"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-876" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-877" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-878" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mn" id="MJXp-Span-879">1</span></span></span><script type="math/tex" id="MathJax-Element-151">f_i \ge 1</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-880"><span class="MJXp-msubsup" id="MJXp-Span-881"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-882" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-883" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-152">f_i</script> odd for <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-884"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-885">i</span><span class="MJXp-mo" id="MJXp-Span-886" style="margin-left: 0.333em; margin-right: 0.333em;">≠</span><span class="MJXp-mn" id="MJXp-Span-887">1</span></span></span><script type="math/tex" id="MathJax-Element-153">i \ne 1</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-888"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-889">i</span><span class="MJXp-mo" id="MJXp-Span-890" style="margin-left: 0.333em; margin-right: 0.333em;">≠</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-891">k</span></span></span><script type="math/tex" id="MathJax-Element-154">i \ne k</script>, where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-892"><span class="MJXp-msubsup" id="MJXp-Span-893"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-894" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-895" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-896" style="margin-left: 0.333em; margin-right: 0.333em;">=</span></span></span><script type="math/tex" id="MathJax-Element-155">f_i =</script> the number of people finally at <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-897"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-898">i</span></span></span><script type="math/tex" id="MathJax-Element-156">i</script>. We want <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-899"><span class="MJXp-mo" id="MJXp-Span-900" style="margin-left: 0.111em; margin-right: 0.167em;">∑</span><span class="MJXp-msubsup" id="MJXp-Span-901"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-902" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-903" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-904" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-msubsup" id="MJXp-Span-905"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-906" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-907" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-157">\sum f_i \cdot a_i</script> over all ways.</p><p>Fix parity of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-908"><span class="MJXp-msubsup" id="MJXp-Span-909"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-910" style="margin-right: 0.05em;">f</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-911" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-912" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-913"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-914" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-915" style="vertical-align: -0.4em;">k</span></span></span></span><script type="math/tex" id="MathJax-Element-158">f_1, f_k</script> say <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-916"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-917">x</span></span></span><script type="math/tex" id="MathJax-Element-159">x</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-918"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-919">y</span></span></span><script type="math/tex" id="MathJax-Element-160">y</script> (let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-920"><span class="MJXp-mn" id="MJXp-Span-921">1</span><span class="MJXp-mo" id="MJXp-Span-922" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-923">x</span><span class="MJXp-mo" id="MJXp-Span-924" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-925">y</span><span class="MJXp-mo" id="MJXp-Span-926" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mn" id="MJXp-Span-927">2</span></span></span><script type="math/tex" id="MathJax-Element-161">1 \le x, y \le 2</script>), and then let </p> <ul>   <li><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-928"><span class="MJXp-msubsup" id="MJXp-Span-929"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-930" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-931" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-932" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-933">2</span><span class="MJXp-mo" id="MJXp-Span-934" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-msubsup" id="MJXp-Span-935"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-936" style="margin-right: 0.05em;">g</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-937" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-938" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-939">1</span></span></span><script type="math/tex" id="MathJax-Element-162">f_i = 2 \cdot g_i + 1</script> for all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-940"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-941">i</span><span class="MJXp-mo" id="MJXp-Span-942" style="margin-left: 0.333em; margin-right: 0.333em;">≠</span><span class="MJXp-mn" id="MJXp-Span-943">1</span><span class="MJXp-mo" id="MJXp-Span-944" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-945">i</span><span class="MJXp-mo" id="MJXp-Span-946" style="margin-left: 0.333em; margin-right: 0.333em;">≠</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-947">k</span></span></span><script type="math/tex" id="MathJax-Element-163">i \ne 1, i \ne k</script></li>   <li><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-948"><span class="MJXp-msubsup" id="MJXp-Span-949"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-950" style="margin-right: 0.05em;">f</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-951" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-952" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-953">2</span><span class="MJXp-mo" id="MJXp-Span-954" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-msubsup" id="MJXp-Span-955"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-956" style="margin-right: 0.05em;">g</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-957" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-958" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-959">x</span></span></span><script type="math/tex" id="MathJax-Element-164">f_1 = 2 \cdot g_1 + x</script></li>   <li><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-960"><span class="MJXp-msubsup" id="MJXp-Span-961"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-962" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-963" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-mo" id="MJXp-Span-964" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-965">2</span><span class="MJXp-mo" id="MJXp-Span-966" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-msubsup" id="MJXp-Span-967"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-968" style="margin-right: 0.05em;">g</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-969" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-mo" id="MJXp-Span-970" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-971">y</span></span></span><script type="math/tex" id="MathJax-Element-165">f_k = 2 \cdot g_k + y</script></li> </ul><p>Let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-972"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-973">S</span><span class="MJXp-mo" id="MJXp-Span-974" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-975">n</span><span class="MJXp-mo" id="MJXp-Span-976" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-977">x</span><span class="MJXp-mo" id="MJXp-Span-978" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-979">y</span><span class="MJXp-mo" id="MJXp-Span-980" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mo" id="MJXp-Span-981" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-982">k</span><span class="MJXp-mo" id="MJXp-Span-983" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-984">2</span><span class="MJXp-mo" id="MJXp-Span-985" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-166">S = n - x - y - (k - 2)</script>. Now, the equation becomes <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-986"><span class="MJXp-mo" id="MJXp-Span-987" style="margin-left: 0.111em; margin-right: 0.167em;">∑</span><span class="MJXp-msubsup" id="MJXp-Span-988"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-989" style="margin-right: 0.05em;">g</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-990" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-991" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mfrac" id="MJXp-Span-992" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-993">S</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mn" id="MJXp-Span-994">2</span></span></span></span></span></span></span></span><script type="math/tex" id="MathJax-Element-167">\sum g_i = \frac{S}{2}</script>, and we want <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-995"><span class="MJXp-mo" id="MJXp-Span-996" style="margin-left: 0.111em; margin-right: 0.167em;">∑</span><span class="MJXp-mn" id="MJXp-Span-997">2</span><span class="MJXp-mo" id="MJXp-Span-998" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-msubsup" id="MJXp-Span-999"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1000" style="margin-right: 0.05em;">g</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1001" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1002" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-msubsup" id="MJXp-Span-1003"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1004" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1005" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-168">\sum 2 \cdot g_i \cdot a_i</script> over all ways (<span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1006"><span class="MJXp-mo" id="MJXp-Span-1007" style="margin-left: 0.267em; margin-right: 0.267em;">+</span></span></span><script type="math/tex" id="MathJax-Element-169">+</script> a few more terms arising from the constants <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1008"><span class="MJXp-mn" id="MJXp-Span-1009">1</span></span></span><script type="math/tex" id="MathJax-Element-170">1</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1010"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1011">x</span></span></span><script type="math/tex" id="MathJax-Element-171">x</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1012"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1013">y</span></span></span><script type="math/tex" id="MathJax-Element-172">y</script>). </p><p>If <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1014"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1015">S</span></span></span><script type="math/tex" id="MathJax-Element-173">S</script> is odd, no solution. Assume <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1016"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1017">S</span></span></span><script type="math/tex" id="MathJax-Element-174">S</script> even.</p><p>Since all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1018"><span class="MJXp-msubsup" id="MJXp-Span-1019"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1020" style="margin-right: 0.05em;">g</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1021" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-175">g_i</script> variables are symmetric, we can just say the expected value of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1022"><span class="MJXp-msubsup" id="MJXp-Span-1023"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1024" style="margin-right: 0.05em;">g</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1025" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-176">g_i</script> is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1026"><span class="MJXp-mfrac" id="MJXp-Span-1027" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1028">S</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mn" id="MJXp-Span-1029">2</span><span class="MJXp-mo" id="MJXp-Span-1030">⋅</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1031">k</span></span></span></span></span></span></span></span><script type="math/tex" id="MathJax-Element-177">\frac{S}{2 \cdot k}</script>, and then calculate <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1032"><span class="MJXp-mo" id="MJXp-Span-1033" style="margin-left: 0.111em; margin-right: 0.167em;">∑</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1034">w</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1035">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1036">y</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1037">s</span><span class="MJXp-mo" id="MJXp-Span-1038" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1039">E</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1040">V</span><span class="MJXp-mo" id="MJXp-Span-1041" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1042"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1043" style="margin-right: 0.05em;">g</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1044" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1045" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1046" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-msubsup" id="MJXp-Span-1047"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1048" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1049" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-178">\sum ways \cdot EV(g_i) \cdot a_i</script>, where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1050"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1051">w</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1052">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1053">y</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1054">s</span></span></span><script type="math/tex" id="MathJax-Element-179">ways</script> is the number of solutions (simple stars and bars).</p><p>To solve the full problem, note that it essentially requires you to optimize finding sum of subarrays of size of length <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1055"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1056">k</span></span></span><script type="math/tex" id="MathJax-Element-180">k</script>, and this can be done (cleanly) with prefix sums on prefix sums. Also, you need to handle <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1057"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1058">L</span><span class="MJXp-mo" id="MJXp-Span-1059" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1060">R</span></span></span><script type="math/tex" id="MathJax-Element-181">L = R</script> separately. The final solution is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1061"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1062">O</span><span class="MJXp-mo" id="MJXp-Span-1063" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1064">n</span><span class="MJXp-mo" id="MJXp-Span-1065" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-182">O(n)</script>.</p></div></div> <div class="spoiler"><b class="spoiler-title">Code</b><div class="spoiler-content" style="display: block;"><p><a href="https://codeforces.com/contest/2150/submission/340224836" title="Submission 340224836 by Dominater069">340224836</a></p></div></div><p><a href="https://codeforces.com/contest/2150/problem/E1" title="Codeforces Round 1053 (Div. 1)">2150E1 - Hidden Single (Version 1)</a></p><p>Author: <a class="rated-user user-red" href="https://codeforces.com/profile/TheScrasse" title="International Grandmaster TheScrasse">TheScrasse</a><br> Preparation: <a class="rated-user user-red" href="https://codeforces.com/profile/TheScrasse" title="International Grandmaster TheScrasse">TheScrasse</a>, <a class="rated-user user-red" href="https://codeforces.com/profile/Dominater069" title="International Grandmaster Dominater069">Dominater069</a></p> <div class="spoiler"><b class="spoiler-title">Hint 1</b><div class="spoiler-content" style="display: block;"><p>Assume all elements appear twice, and look for a contradiction.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 2</b><div class="spoiler-content" style="display: block;"><p>Split the array into two.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 3</b><div class="spoiler-content" style="display: block;"><p>Determine whether each value appear on the left, on the right, or in both.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 4</b><div class="spoiler-content" style="display: block;"><p>Continue recursively.</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><p>Write a recursive function <code class="tt">solve(tl, tr, vals, waste)</code>, which means that</p> <ul>   <li>you are looking for the special value in the interval <code class="tt">[tl, tr]</code>;</li>   <li>the vector <code class="tt">vals</code> contains the values which only appear in <code class="tt">[tl, tr]</code>;</li>   <li>the vector <code class="tt">waste</code> contains the value which appear both in <code class="tt">[tl, tr]</code> and outside it.</li> </ul><p>At the beginning, call <code class="tt">solve(1, 2n - 1, {1, 2, ..., n}, {})</code>. In every call,</p> <ul>   <li>let <code class="tt">tm = (tl + tr) / 2</code>, and split the interval <code class="tt">[tl, tr]</code> into two intervals <code class="tt">[tl, tm]</code> and <code class="tt">[tm+1, tr]</code>;</li>   <li>for each value in <code class="tt">waste</code> determine the sub-interval containing it (spending <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1066"><span class="MJXp-mn" id="MJXp-Span-1067">1</span></span></span><script type="math/tex" id="MathJax-Element-183">1</script> query);</li>   <li>for each value in <code class="tt">vals</code> determine the sub-intervals containing it (spending at most <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1068"><span class="MJXp-mn" id="MJXp-Span-1069">2</span></span></span><script type="math/tex" id="MathJax-Element-184">2</script> queries).</li> </ul><p>Now pretend every element appears twice, and calculate the length of <code class="tt">[tl, tm]</code> and <code class="tt">[tm+1, tr]</code> according to the values they contain. One of the lengths turns out to be wrong, because the interval contains a single element which was counted twice, so you can recurse there.</p><p>You visit at most <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1070"><span class="MJXp-mo" id="MJXp-Span-1071" style="margin-left: 0em; margin-right: 0em;">⌈</span><span class="MJXp-msubsup" id="MJXp-Span-1072"><span class="MJXp-mi" id="MJXp-Span-1073" style="margin-right: 0.05em;">log</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1074" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1075" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1076">n</span><span class="MJXp-mo" id="MJXp-Span-1077" style="margin-left: 0em; margin-right: 0em;">⌉</span></span></span><script type="math/tex" id="MathJax-Element-185">\lceil \log_2 n \rceil</script> intervals. The total length of the visited intervals is at most <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1078"><span class="MJXp-mn" id="MJXp-Span-1079">4</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1080">n</span><span class="MJXp-mo" id="MJXp-Span-1081" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mo" id="MJXp-Span-1082" style="margin-left: 0em; margin-right: 0em;">⌈</span><span class="MJXp-msubsup" id="MJXp-Span-1083"><span class="MJXp-mi" id="MJXp-Span-1084" style="margin-right: 0.05em;">log</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1085" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1086" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1087">n</span><span class="MJXp-mo" id="MJXp-Span-1088" style="margin-left: 0em; margin-right: 0em;">⌉</span></span></span><script type="math/tex" id="MathJax-Element-186">4n + \lceil \log_2 n \rceil</script> (the starting interval has length <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1089"><span class="MJXp-mn" id="MJXp-Span-1090">2</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1091">n</span><span class="MJXp-mo" id="MJXp-Span-1092" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-1093">1</span></span></span><script type="math/tex" id="MathJax-Element-187">2n-1</script> and is halved every time).</p><p>For an interval of length <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1094"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1095">l</span></span></span><script type="math/tex" id="MathJax-Element-188">l</script>, you ask at most <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1096"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1097">l</span><span class="MJXp-mo" id="MJXp-Span-1098" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-1099">1</span></span></span><script type="math/tex" id="MathJax-Element-189">l+1</script> queries. So you ask at most <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1100"><span class="MJXp-mn" id="MJXp-Span-1101">4</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1102">n</span><span class="MJXp-mo" id="MJXp-Span-1103" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mo" id="MJXp-Span-1104" style="margin-left: 0em; margin-right: 0em;">⌈</span><span class="MJXp-mn" id="MJXp-Span-1105">2</span><span class="MJXp-msubsup" id="MJXp-Span-1106"><span class="MJXp-mi" id="MJXp-Span-1107" style="margin-right: 0.05em;">log</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1108" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1109" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1110">n</span><span class="MJXp-mo" id="MJXp-Span-1111" style="margin-left: 0em; margin-right: 0em;">⌉</span></span></span><script type="math/tex" id="MathJax-Element-190">4n + \lceil 2 \log_2 n \rceil</script> queries in total.</p></div></div> <div class="spoiler"><b class="spoiler-title">Code</b><div class="spoiler-content" style="display: block;"><p><a href="https://codeforces.com/contest/2150/submission/340224890" title="Submission 340224890 by Dominater069">340224890</a></p></div></div><p><a href="https://codeforces.com/contest/2150/problem/E2" title="Codeforces Round 1053 (Div. 1)">2150E2 - Hidden Single (Version 2)</a></p><p>Author: <a class="rated-user user-red" href="https://codeforces.com/profile/TheScrasse" title="International Grandmaster TheScrasse">TheScrasse</a><br> Preparation: <a class="rated-user user-red" href="https://codeforces.com/profile/TheScrasse" title="International Grandmaster TheScrasse">TheScrasse</a>, <a class="rated-user user-red" href="https://codeforces.com/profile/Dominater069" title="International Grandmaster Dominater069">Dominater069</a></p> <div class="spoiler"><b class="spoiler-title">Hint 1</b><div class="spoiler-content" style="display: block;"><p>For a single value, if it appears twice, how many queries can you spend on average to detect that?</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 2</b><div class="spoiler-content" style="display: block;"><p>Combine a randomized solution with the solution to <a href="https://codeforces.com/contest/2150/problem/E1" title="Codeforces Round 1053 (Div. 1)">2150E1 - Hidden Single (Version 1)</a>.</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><p>After the first layer of recursion in the solution to <a href="https://codeforces.com/contest/2150/problem/E1" title="Codeforces Round 1053 (Div. 1)">2150E1 - Hidden Single (Version 1)</a>, you have spent around <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1112"><span class="MJXp-mn" id="MJXp-Span-1113">7</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1114">n</span><span class="MJXp-mrow" id="MJXp-Span-1115"><span class="MJXp-mo" id="MJXp-Span-1116" style="margin-left: 0.111em; margin-right: 0.111em;">/</span></span><span class="MJXp-mn" id="MJXp-Span-1117">4</span></span></span><script type="math/tex" id="MathJax-Element-191">7n/4</script> queries, and there are around <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1118"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1119">n</span><span class="MJXp-mrow" id="MJXp-Span-1120"><span class="MJXp-mo" id="MJXp-Span-1121" style="margin-left: 0.111em; margin-right: 0.111em;">/</span></span><span class="MJXp-mn" id="MJXp-Span-1122">4</span></span></span><script type="math/tex" id="MathJax-Element-192">n/4</script> candidate values which can be the special value.</p><p>Consider the following procedure to approximately halve the number of candidates:</p> <ul>   <li>split the array randomly into two halves (subsets);</li>   <li>for each candidate, determine whether it appears in both halves.</li> </ul><p>With probability around <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1123"><span class="MJXp-mn" id="MJXp-Span-1124">1</span><span class="MJXp-mrow" id="MJXp-Span-1125"><span class="MJXp-mo" id="MJXp-Span-1126" style="margin-left: 0.111em; margin-right: 0.111em;">/</span></span><span class="MJXp-mn" id="MJXp-Span-1127">2</span></span></span><script type="math/tex" id="MathJax-Element-193">1/2</script>, the candidate appears in both halves and you use <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1128"><span class="MJXp-mn" id="MJXp-Span-1129">2</span></span></span><script type="math/tex" id="MathJax-Element-194">2</script> queries to detect it. Otherwise, you spend <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1130"><span class="MJXp-mn" id="MJXp-Span-1131">3</span><span class="MJXp-mrow" id="MJXp-Span-1132"><span class="MJXp-mo" id="MJXp-Span-1133" style="margin-left: 0.111em; margin-right: 0.111em;">/</span></span><span class="MJXp-mn" id="MJXp-Span-1134">2</span></span></span><script type="math/tex" id="MathJax-Element-195">3/2</script> queries on average. So the average number of queries is approximately the solution to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1135"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1136">x</span><span class="MJXp-mo" id="MJXp-Span-1137" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-1138">2</span><span class="MJXp-mrow" id="MJXp-Span-1139"><span class="MJXp-mo" id="MJXp-Span-1140" style="margin-left: 0.111em; margin-right: 0.111em;">/</span></span><span class="MJXp-mn" id="MJXp-Span-1141">2</span><span class="MJXp-mo" id="MJXp-Span-1142" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mo" id="MJXp-Span-1143" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1144">x</span><span class="MJXp-mo" id="MJXp-Span-1145" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-1146">3</span><span class="MJXp-mrow" id="MJXp-Span-1147"><span class="MJXp-mo" id="MJXp-Span-1148" style="margin-left: 0.111em; margin-right: 0.111em;">/</span></span><span class="MJXp-mn" id="MJXp-Span-1149">2</span><span class="MJXp-mo" id="MJXp-Span-1150" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mrow" id="MJXp-Span-1151"><span class="MJXp-mo" id="MJXp-Span-1152" style="margin-left: 0.111em; margin-right: 0.111em;">/</span></span><span class="MJXp-mn" id="MJXp-Span-1153">2</span></span></span><script type="math/tex" id="MathJax-Element-196">x = 2/2 + (x+3/2)/2</script>, which is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1154"><span class="MJXp-mn" id="MJXp-Span-1155">7</span><span class="MJXp-mrow" id="MJXp-Span-1156"><span class="MJXp-mo" id="MJXp-Span-1157" style="margin-left: 0.111em; margin-right: 0.111em;">/</span></span><span class="MJXp-mn" id="MJXp-Span-1158">2</span></span></span><script type="math/tex" id="MathJax-Element-197">7/2</script>. So you spend around <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1159"><span class="MJXp-mn" id="MJXp-Span-1160">21</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1161">n</span><span class="MJXp-mrow" id="MJXp-Span-1162"><span class="MJXp-mo" id="MJXp-Span-1163" style="margin-left: 0.111em; margin-right: 0.111em;">/</span></span><span class="MJXp-mn" id="MJXp-Span-1164">8</span></span></span><script type="math/tex" id="MathJax-Element-198">21n/8</script> queries in total. Because of variance, you might end up asking significantly more queries, but with high probability you ask at most <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1165"><span class="MJXp-mn" id="MJXp-Span-1166">900</span></span></span><script type="math/tex" id="MathJax-Element-199">900</script> queries.</p><p>Bonus: you can further reduce the number of queries using some minor optimizations. For example, instead of splitting randomly, you can shuffle the array randomly at the beginning, and binary search every candidate. This is better because:</p> <ul>   <li>there is an upper bound on the number of queries you make for each candidate;</li>   <li>you ask queries on smaller subsets, so the probability of a candidate appearing twice in the same subset is slightly lower;</li>   <li>you can break earlier if you find the special value.</li> </ul><p>The model solution based on this approach takes only <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1167"><span class="MJXp-mn" id="MJXp-Span-1168">863</span></span></span><script type="math/tex" id="MathJax-Element-200">863</script> queries on worst case with <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1169"><span class="MJXp-msubsup" id="MJXp-Span-1170"><span class="MJXp-mn" id="MJXp-Span-1171" style="margin-right: 0.05em;">10</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1172" style="vertical-align: 0.5em;">4</span></span></span></span><script type="math/tex" id="MathJax-Element-201">10^4</script> tests of size <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1173"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1174">n</span><span class="MJXp-mo" id="MJXp-Span-1175" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-1176">300</span></span></span><script type="math/tex" id="MathJax-Element-202">n = 300</script>.</p></div></div> <div class="spoiler"><b class="spoiler-title">Code</b><div class="spoiler-content" style="display: block;"><p><a href="https://codeforces.com/contest/2150/submission/340224967" title="Submission 340224967 by Dominater069">340224967</a></p></div></div><p><a href="https://codeforces.com/contest/2150/problem/F" title="Codeforces Round 1053 (Div. 1)">2150F - Cycle Closing</a></p><p>Author: <a class="rated-user user-red" href="https://codeforces.com/profile/TheScrasse" title="International Grandmaster TheScrasse">TheScrasse</a><br> Preparation: <a class="rated-user user-red" href="https://codeforces.com/profile/TheScrasse" title="International Grandmaster TheScrasse">TheScrasse</a>, <a class="rated-user user-red" href="https://codeforces.com/profile/Dominater069" title="International Grandmaster Dominater069">Dominater069</a></p> <div class="spoiler"><b class="spoiler-title">Hint 1</b><div class="spoiler-content" style="display: block;"><p>Use <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1177"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1178">k</span><span class="MJXp-mo" id="MJXp-Span-1179" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-1180">3</span></span></span><script type="math/tex" id="MathJax-Element-203">k = 3</script> for the first operation. Now, you have edges between all vertices at distance <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1181"><span class="MJXp-mn" id="MJXp-Span-1182">1</span></span></span><script type="math/tex" id="MathJax-Element-204">1</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1183"><span class="MJXp-mn" id="MJXp-Span-1184">2</span></span></span><script type="math/tex" id="MathJax-Element-205">2</script>.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 2</b><div class="spoiler-content" style="display: block;"><p>Use <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1185"><span class="MJXp-mfrac" id="MJXp-Span-1186" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1187">D</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mn" id="MJXp-Span-1188">2</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-1189" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-1190">1</span></span></span><script type="math/tex" id="MathJax-Element-206">\frac{D}{2} + 1</script> for your second operation, where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1191"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1192">D</span></span></span><script type="math/tex" id="MathJax-Element-207">D</script> is the diameter.</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><p>Assume the graph is a tree, otherwise take an arbitrary spanning tree. First operation is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1193"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1194">k</span><span class="MJXp-mo" id="MJXp-Span-1195" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-1196">3</span></span></span><script type="math/tex" id="MathJax-Element-208">k = 3</script>, because that adds edges between all vertices at distance <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1197"><span class="MJXp-mn" id="MJXp-Span-1198">2</span></span></span><script type="math/tex" id="MathJax-Element-209">2</script>, and we already have edges of vertices at distance <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1199"><span class="MJXp-mn" id="MJXp-Span-1200">1</span></span></span><script type="math/tex" id="MathJax-Element-210">1</script>. </p><p>The second operation needs to be at least <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1201"><span class="MJXp-mfrac" id="MJXp-Span-1202" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1203">D</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mn" id="MJXp-Span-1204">2</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-1205" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-1206">1</span></span></span><script type="math/tex" id="MathJax-Element-211">\frac{D}{2} + 1</script>, where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1207"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1208">D</span></span></span><script type="math/tex" id="MathJax-Element-212">D</script> is diameter, because otherwise it is impossible to construct a path between the farthest nodes. And infact, it is possible to construct paths of length exactly <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1209"><span class="MJXp-mfrac" id="MJXp-Span-1210" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1211">D</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mn" id="MJXp-Span-1212">2</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-1213" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-1214">1</span></span></span><script type="math/tex" id="MathJax-Element-213">\frac{D}{2} + 1</script> between all pairs of vertices, so we choose second operation as this.</p><p>The construction is as follows, suppose we want a path between nodes <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1215"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1216">u</span></span></span><script type="math/tex" id="MathJax-Element-214">u</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1217"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1218">v</span></span></span><script type="math/tex" id="MathJax-Element-215">v</script> (there are simpler constructions, the editorialist describes his). Let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1219"><span class="MJXp-msubsup" id="MJXp-Span-1220"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1221" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1222" style="vertical-align: -0.4em;">x</span></span></span></span><script type="math/tex" id="MathJax-Element-216">c_x</script> denote the closest node in the diameter to node <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1223"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1224">x</span></span></span><script type="math/tex" id="MathJax-Element-217">x</script>.</p> <ul>   <li><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1225"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1226">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1227">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1228">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1229">t</span><span class="MJXp-mo" id="MJXp-Span-1230" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1231">u</span><span class="MJXp-mo" id="MJXp-Span-1232" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1233">v</span><span class="MJXp-mo" id="MJXp-Span-1234" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1235" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1236">k</span></span></span><script type="math/tex" id="MathJax-Element-218">dist(u, v) \ge k</script> : Just take a direct path between <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1237"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1238">u</span></span></span><script type="math/tex" id="MathJax-Element-219">u</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1239"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1240">v</span></span></span><script type="math/tex" id="MathJax-Element-220">v</script>, and skip appropriate number of vertices.</li> </ul> <ul>   <li><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1241"><span class="MJXp-msubsup" id="MJXp-Span-1242"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1243" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1244" style="vertical-align: -0.4em;">u</span></span><span class="MJXp-mo" id="MJXp-Span-1245" style="margin-left: 0.333em; margin-right: 0.333em;">≠</span><span class="MJXp-msubsup" id="MJXp-Span-1246"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1247" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1248" style="vertical-align: -0.4em;">v</span></span></span></span><script type="math/tex" id="MathJax-Element-221">c_u \ne c_v</script> : First construct a path from <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1249"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1250">u</span></span></span><script type="math/tex" id="MathJax-Element-222">u</script> to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1251"><span class="MJXp-msubsup" id="MJXp-Span-1252"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1253" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1254" style="vertical-align: -0.4em;">u</span></span></span></span><script type="math/tex" id="MathJax-Element-223">c_u</script> and similarly, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1255"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1256">v</span></span></span><script type="math/tex" id="MathJax-Element-224">v</script> to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1257"><span class="MJXp-msubsup" id="MJXp-Span-1258"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1259" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1260" style="vertical-align: -0.4em;">v</span></span></span></span><script type="math/tex" id="MathJax-Element-225">c_v</script>. Now, we need to waste some operations because <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1261"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1262">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1263">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1264">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1265">t</span><span class="MJXp-mo" id="MJXp-Span-1266" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1267">u</span><span class="MJXp-mo" id="MJXp-Span-1268" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1269">v</span><span class="MJXp-mo" id="MJXp-Span-1270" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1271" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1272">k</span></span></span><script type="math/tex" id="MathJax-Element-226">dist(u, v) < k</script>. Assume the diameter is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1273"><span class="MJXp-mn" id="MJXp-Span-1274">1</span><span class="MJXp-mo" id="MJXp-Span-1275" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-1276">2</span><span class="MJXp-mo" id="MJXp-Span-1277" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-1278" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-1279" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1280">D</span></span></span><script type="math/tex" id="MathJax-Element-227">1, 2, \ldots, D</script> WLOG. Then, we can do the following operation: <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1281"><span class="MJXp-mo" id="MJXp-Span-1282" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1283"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1284" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1285" style="vertical-align: -0.4em;">u</span></span><span class="MJXp-mo" id="MJXp-Span-1286" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1287"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1288" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1289" style="vertical-align: -0.4em;">u</span></span><span class="MJXp-mo" id="MJXp-Span-1290" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-1291">2</span><span class="MJXp-mo" id="MJXp-Span-1292" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1293"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1294" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1295" style="vertical-align: -0.4em;">u</span></span><span class="MJXp-mo" id="MJXp-Span-1296" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-1297">4</span><span class="MJXp-mo" id="MJXp-Span-1298" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1299"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1300" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1301" style="vertical-align: -0.4em;">u</span></span><span class="MJXp-mo" id="MJXp-Span-1302" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-1303">3</span><span class="MJXp-mo" id="MJXp-Span-1304" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1305"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1306" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1307" style="vertical-align: -0.4em;">u</span></span><span class="MJXp-mo" id="MJXp-Span-1308" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-1309">1</span><span class="MJXp-mo" id="MJXp-Span-1310" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1311"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1312" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1313" style="vertical-align: -0.4em;">u</span></span><span class="MJXp-mo" id="MJXp-Span-1314" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-1315">1</span><span class="MJXp-mo" id="MJXp-Span-1316" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-228">(c_u, c_u - 2, c_u - 4, c_u - 3, c_u - 1, c_u + 1)</script> and we successfully wasted <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1317"><span class="MJXp-mn" id="MJXp-Span-1318">4</span></span></span><script type="math/tex" id="MathJax-Element-229">4</script> steps.</li> </ul><p>This can be easily generalized to all lengths. Because <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1319"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1320">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1321">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1322">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1323">t</span><span class="MJXp-mo" id="MJXp-Span-1324" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1325">u</span><span class="MJXp-mo" id="MJXp-Span-1326" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1327">v</span><span class="MJXp-mo" id="MJXp-Span-1328" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1329" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1330">k</span></span></span><script type="math/tex" id="MathJax-Element-230">dist(u, v) < k</script> implies <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1331"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1332">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1333">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1334">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1335">t</span><span class="MJXp-mo" id="MJXp-Span-1336" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1337"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1338" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1339" style="vertical-align: -0.4em;">u</span></span><span class="MJXp-mo" id="MJXp-Span-1340" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1341"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1342" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1343" style="vertical-align: -0.4em;">v</span></span><span class="MJXp-mo" id="MJXp-Span-1344" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1345" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1346">k</span></span></span><script type="math/tex" id="MathJax-Element-231">dist(c_u, c_v) < k</script>, and thus, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1347"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1348">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1349">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1350">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1351">t</span><span class="MJXp-mo" id="MJXp-Span-1352" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-1353">1</span><span class="MJXp-mo" id="MJXp-Span-1354" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1355"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1356" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1357" style="vertical-align: -0.4em;">u</span></span><span class="MJXp-mo" id="MJXp-Span-1358" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1359" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1360">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1361">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1362">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1363">t</span><span class="MJXp-mo" id="MJXp-Span-1364" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1365"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1366" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1367" style="vertical-align: -0.4em;">v</span></span><span class="MJXp-mo" id="MJXp-Span-1368" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1369">D</span><span class="MJXp-mo" id="MJXp-Span-1370" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1371" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1372">k</span></span></span><script type="math/tex" id="MathJax-Element-232">dist(1, c_u) + dist(c_v, D) \ge k</script>, so it is always possible to waste sufficient number of steps on the paths <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1373"><span class="MJXp-mn" id="MJXp-Span-1374">1</span></span></span><script type="math/tex" id="MathJax-Element-233">1</script> to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1375"><span class="MJXp-msubsup" id="MJXp-Span-1376"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1377" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1378" style="vertical-align: -0.4em;">u</span></span></span></span><script type="math/tex" id="MathJax-Element-234">c_u</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1379"><span class="MJXp-msubsup" id="MJXp-Span-1380"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1381" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1382" style="vertical-align: -0.4em;">v</span></span></span></span><script type="math/tex" id="MathJax-Element-235">c_v</script> to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1383"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1384">D</span></span></span><script type="math/tex" id="MathJax-Element-236">D</script>.</p> <ul>   <li><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1385"><span class="MJXp-msubsup" id="MJXp-Span-1386"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1387" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1388" style="vertical-align: -0.4em;">u</span></span><span class="MJXp-mo" id="MJXp-Span-1389" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-1390"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1391" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1392" style="vertical-align: -0.4em;">v</span></span></span></span><script type="math/tex" id="MathJax-Element-237">c_u = c_v</script> : Root the tree at <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1393"><span class="MJXp-msubsup" id="MJXp-Span-1394"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1395" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1396" style="vertical-align: -0.4em;">u</span></span></span></span><script type="math/tex" id="MathJax-Element-238">c_u</script>. Assume that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1397"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1398">u</span></span></span><script type="math/tex" id="MathJax-Element-239">u</script> is an ancestor of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1399"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1400">v</span></span></span><script type="math/tex" id="MathJax-Element-240">v</script> (if it is not, make it an ancestor by jumping to parent). Either <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1401"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1402">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1403">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1404">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1405">t</span><span class="MJXp-mo" id="MJXp-Span-1406" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-1407">1</span><span class="MJXp-mo" id="MJXp-Span-1408" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1409">u</span><span class="MJXp-mo" id="MJXp-Span-1410" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1411" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1412">k</span></span></span><script type="math/tex" id="MathJax-Element-241">dist(1, u) \ge k</script> or <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1413"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1414">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1415">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1416">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1417">t</span><span class="MJXp-mo" id="MJXp-Span-1418" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1419">D</span><span class="MJXp-mo" id="MJXp-Span-1420" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1421">u</span><span class="MJXp-mo" id="MJXp-Span-1422" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1423" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1424">k</span></span></span><script type="math/tex" id="MathJax-Element-242">dist(D, u) \ge k</script> [due to property of diameter, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1425"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1426">k</span><span class="MJXp-mo" id="MJXp-Span-1427" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mfrac" id="MJXp-Span-1428" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1429">D</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mn" id="MJXp-Span-1430">2</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-1431" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-1432">1</span></span></span><script type="math/tex" id="MathJax-Element-243">k = \frac{D}{2} + 1</script>]. Then we can waste the sufficient number of steps on the path from <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1433"><span class="MJXp-mn" id="MJXp-Span-1434">1</span></span></span><script type="math/tex" id="MathJax-Element-244">1</script> to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1435"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1436">u</span></span></span><script type="math/tex" id="MathJax-Element-245">u</script>, or <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1437"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1438">L</span></span></span><script type="math/tex" id="MathJax-Element-246">L</script> to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1439"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1440">u</span></span></span><script type="math/tex" id="MathJax-Element-247">u</script> whichever one is larger. (<span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1441"><span class="MJXp-mn" id="MJXp-Span-1442">1</span></span></span><script type="math/tex" id="MathJax-Element-248">1</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1443"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1444">D</span></span></span><script type="math/tex" id="MathJax-Element-249">D</script> are diameter endpoints).</li> </ul><p>The entire solution runs in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1445"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1446">O</span><span class="MJXp-mo" id="MJXp-Span-1447" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1448"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1449" style="margin-right: 0.05em;">n</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1450" style="vertical-align: 0.5em;">3</span></span><span class="MJXp-mo" id="MJXp-Span-1451" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-250">O(n^3)</script>.</p></div></div> <div class="spoiler"><b class="spoiler-title">Code</b><div class="spoiler-content" style="display: block;"><p><a href="https://codeforces.com/contest/2150/submission/340225230" title="Submission 340225230 by Dominater069">340225230</a></p></div></div><p><a href="https://codeforces.com/contest/2150/problem/G" title="Codeforces Round 1053 (Div. 1)">2150G - Counting Is Fun: The Finale</a></p><p>Author: <a class="rated-user user-orange" href="https://codeforces.com/profile/satyam343" title="Master satyam343">satyam343</a><br> Preparation: <a class="rated-user user-orange" href="https://codeforces.com/profile/satyam343" title="Master satyam343">satyam343</a></p> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><p>Let's first solve the following subproblem: given <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1452"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1453">x</span><span class="MJXp-mo" id="MJXp-Span-1454" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1455">y</span><span class="MJXp-mo" id="MJXp-Span-1456" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1457">k</span><span class="MJXp-mo" id="MJXp-Span-1458" style="margin-left: 0em; margin-right: 0.222em;">,</span></span></span><script type="math/tex" id="MathJax-Element-251">x, y, k,</script> how can we find the number of binary strings with Longest Nondecreasing Subsequence <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1459"><span class="MJXp-mo" id="MJXp-Span-1460" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1461">k</span></span></span><script type="math/tex" id="MathJax-Element-252">\geq k</script>?</p><p>The answer is if <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1462"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1463">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1464">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1465">x</span><span class="MJXp-mo" id="MJXp-Span-1466" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1467">x</span><span class="MJXp-mo" id="MJXp-Span-1468" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1469">y</span><span class="MJXp-mo" id="MJXp-Span-1470" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1471" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1472">k</span></span></span><script type="math/tex" id="MathJax-Element-253">max(x,y)\geq k</script>, the answer is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1473"><span class="MJXp-mrow" id="MJXp-Span-1474"><span class="MJXp-TeXmathchoice" id="MJXp-Span-1475"><span class="MJXp-mstyle" id="MJXp-Span-1476"><span class="MJXp-mrow" id="MJXp-Span-1477"><span class="MJXp-mo" id="MJXp-Span-1478" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.083em;"><span class="MJXp-right MJXp-scale10" style="font-size: 1.333em; margin-left: 0.07em;">(</span></span></span></span></span><span class="MJXp-mfrac" id="MJXp-Span-1479"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1480">x</span><span class="MJXp-mo" id="MJXp-Span-1481">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1482">y</span></span><span class="MJXp-box" style="margin-top: -0.7em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1483">x</span></span></span></span></span></span><span class="MJXp-TeXmathchoice" id="MJXp-Span-1484"><span class="MJXp-mstyle" id="MJXp-Span-1485"><span class="MJXp-mrow" id="MJXp-Span-1486"><span class="MJXp-mo" id="MJXp-Span-1487" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.083em;"><span class="MJXp-right MJXp-scale10" style="font-size: 1.333em; margin-left: 0.07em;">)</span></span></span></span></span></span></span></span><script type="math/tex" id="MathJax-Element-254">\binom{x+y}{x}</script>. Otherwise, it is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1488"><span class="MJXp-mrow" id="MJXp-Span-1489"><span class="MJXp-TeXmathchoice" id="MJXp-Span-1490"><span class="MJXp-mstyle" id="MJXp-Span-1491"><span class="MJXp-mrow" id="MJXp-Span-1492"><span class="MJXp-mo" id="MJXp-Span-1493" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.083em;"><span class="MJXp-right MJXp-scale10" style="font-size: 1.333em; margin-left: 0.07em;">(</span></span></span></span></span><span class="MJXp-mfrac" id="MJXp-Span-1494"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1495">x</span><span class="MJXp-mo" id="MJXp-Span-1496">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1497">y</span></span><span class="MJXp-box" style="margin-top: -0.7em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1498">k</span></span></span></span></span></span><span class="MJXp-TeXmathchoice" id="MJXp-Span-1499"><span class="MJXp-mstyle" id="MJXp-Span-1500"><span class="MJXp-mrow" id="MJXp-Span-1501"><span class="MJXp-mo" id="MJXp-Span-1502" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.083em;"><span class="MJXp-right MJXp-scale10" style="font-size: 1.333em; margin-left: 0.07em;">)</span></span></span></span></span></span></span></span><script type="math/tex" id="MathJax-Element-255">\binom{x+y}{k}</script>. The proof for the first case is obvious. In the second case, we can approach it by bijecting it to paths on a grid. We start at the point <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1503"><span class="MJXp-mo" id="MJXp-Span-1504" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-1505">0</span><span class="MJXp-mo" id="MJXp-Span-1506" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-1507">0</span><span class="MJXp-mo" id="MJXp-Span-1508" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-256">(0,0)</script> and we want to get to the point <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1509"><span class="MJXp-mo" id="MJXp-Span-1510" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1511">x</span><span class="MJXp-mo" id="MJXp-Span-1512" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1513">y</span><span class="MJXp-mo" id="MJXp-Span-1514" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-257">(x,y)</script> through going East (<span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1515"><span class="MJXp-mo" id="MJXp-Span-1516" style="margin-left: 0em; margin-right: 0.111em;">+</span><span class="MJXp-mn" id="MJXp-Span-1517">1</span></span></span><script type="math/tex" id="MathJax-Element-258">+1</script> on <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1518"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1519">x</span></span></span><script type="math/tex" id="MathJax-Element-259">x</script>-coordinate) or North (<span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1520"><span class="MJXp-mo" id="MJXp-Span-1521" style="margin-left: 0em; margin-right: 0.111em;">+</span><span class="MJXp-mn" id="MJXp-Span-1522">1</span></span></span><script type="math/tex" id="MathJax-Element-260">+1</script> on <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1523"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1524">y</span></span></span><script type="math/tex" id="MathJax-Element-261">y</script>-coordinate). We claim that any path <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1525"><span class="MJXp-msubsup" id="MJXp-Span-1526"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1527" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1528" style="vertical-align: -0.4em;">0</span></span><span class="MJXp-mo" id="MJXp-Span-1529" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-1530" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-1531">0</span><span class="MJXp-mo" id="MJXp-Span-1532" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-1533">0</span><span class="MJXp-mo" id="MJXp-Span-1534" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1535" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1536"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1537" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1538" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-1539" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1540"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1541" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1542" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1543" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-1544" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-1545" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1546"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1547" style="margin-right: 0.05em;">p</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1548" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1549">x</span><span class="MJXp-mo" id="MJXp-Span-1550">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1551">y</span></span></span><span class="MJXp-mo" id="MJXp-Span-1552" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-1553" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1554">x</span><span class="MJXp-mo" id="MJXp-Span-1555" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1556">y</span><span class="MJXp-mo" id="MJXp-Span-1557" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-262">p_0=(0,0), p_1,p_2,\ldots,p_{x+y}=(x,y)</script>, where there exists an index <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1558"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1559">i</span></span></span><script type="math/tex" id="MathJax-Element-263">i</script> such that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1560"><span class="MJXp-mo" id="MJXp-Span-1561" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1562"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1563" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1564" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1565" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1566" style="margin-left: 0em; margin-right: 0.222em;">.</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1567">x</span><span class="MJXp-mo" id="MJXp-Span-1568" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mo" id="MJXp-Span-1569" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1570"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1571" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1572" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1573" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1574" style="margin-left: 0em; margin-right: 0.222em;">.</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1575">y</span><span class="MJXp-mo" id="MJXp-Span-1576" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1577">y</span><span class="MJXp-mo" id="MJXp-Span-1578" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1579">k</span></span></span><script type="math/tex" id="MathJax-Element-264">(p_i).x-(p_i).y=y-k</script> can be bijected to a good binary string. To prove that this is sufficient, note that by taking every occurrence of North on our path in the future, we have a subsequence of size <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1580"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1581">k</span></span></span><script type="math/tex" id="MathJax-Element-265">k</script>. To prove that this is necessary, note that if the longest nondecreasing subsequence in the binary string is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1582"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1583">a</span></span></span><script type="math/tex" id="MathJax-Element-266">a</script> <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1584"><span class="MJXp-mn" id="MJXp-Span-1585">0</span></span></span><script type="math/tex" id="MathJax-Element-267">0</script>'s followed by <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1586"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1587">b</span></span></span><script type="math/tex" id="MathJax-Element-268">b</script> <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1588"><span class="MJXp-mn" id="MJXp-Span-1589">1</span></span></span><script type="math/tex" id="MathJax-Element-269">1</script>'s, then we can map the point right after <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1590"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1591">a</span></span></span><script type="math/tex" id="MathJax-Element-270">a</script> <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1592"><span class="MJXp-mn" id="MJXp-Span-1593">0</span></span></span><script type="math/tex" id="MathJax-Element-271">0</script>'s to the index <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1594"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1595">i</span></span></span><script type="math/tex" id="MathJax-Element-272">i</script>. Now, why is this mapping helpful? We can use the reflection technique to count the number of good paths. Let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1596"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1597">i</span></span></span><script type="math/tex" id="MathJax-Element-273">i</script> be the first occurrence where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1598"><span class="MJXp-mo" id="MJXp-Span-1599" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1600"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1601" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1602" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1603" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1604" style="margin-left: 0em; margin-right: 0.222em;">.</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1605">x</span><span class="MJXp-mo" id="MJXp-Span-1606" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mo" id="MJXp-Span-1607" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1608"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1609" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1610" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1611" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1612" style="margin-left: 0em; margin-right: 0.222em;">.</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1613">y</span><span class="MJXp-mo" id="MJXp-Span-1614" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1615">y</span><span class="MJXp-mo" id="MJXp-Span-1616" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1617">k</span></span></span><script type="math/tex" id="MathJax-Element-274">(p_i).x-(p_i).y=y-k</script>. Now, reflect the remaining part of the path across the line <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1618"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1619">y</span><span class="MJXp-mo" id="MJXp-Span-1620" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1621">x</span><span class="MJXp-mo" id="MJXp-Span-1622" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1623">y</span><span class="MJXp-mo" id="MJXp-Span-1624" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1625">k</span></span></span><script type="math/tex" id="MathJax-Element-275">y-x=y-k</script>. Now we have mapped the number of good paths to the number of paths that arrive to the point <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1626"><span class="MJXp-mo" id="MJXp-Span-1627" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1628">x</span><span class="MJXp-mo" id="MJXp-Span-1629" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1630">y</span><span class="MJXp-mo" id="MJXp-Span-1631" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1632">k</span><span class="MJXp-mo" id="MJXp-Span-1633" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1634">k</span><span class="MJXp-mo" id="MJXp-Span-1635" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-276">(x+y-k, k)</script>. This is similar to the proof of the closed form of Catalan numbers. Let this function be <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1636"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1637">f</span><span class="MJXp-mo" id="MJXp-Span-1638" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1639">x</span><span class="MJXp-mo" id="MJXp-Span-1640" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1641">y</span><span class="MJXp-mo" id="MJXp-Span-1642" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1643">k</span><span class="MJXp-mo" id="MJXp-Span-1644" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-277">f(x,y,k)</script>.</p><p>Now, let's solve the above problem again, but we are given a prefix of the binary string. Let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1645"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1646">Z</span></span></span><script type="math/tex" id="MathJax-Element-278">Z</script> be the number of zeroes, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1647"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1648">L</span></span></span><script type="math/tex" id="MathJax-Element-279">L</script> be the length of the longest nondecreasing subsequence, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1649"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1650">x</span></span></span><script type="math/tex" id="MathJax-Element-280">x</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1651"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1652">y</span></span></span><script type="math/tex" id="MathJax-Element-281">y</script> be the number of zeroes and ones to concatenate, and let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1653"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1654">k</span></span></span><script type="math/tex" id="MathJax-Element-282">k</script> be the target length of longest nondecreasing subsequence. I claim that the number of ways to finish the binary string is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1655"><span class="MJXp-mrow" id="MJXp-Span-1656"><span class="MJXp-TeXmathchoice" id="MJXp-Span-1657"><span class="MJXp-mstyle" id="MJXp-Span-1658"><span class="MJXp-mrow" id="MJXp-Span-1659"><span class="MJXp-mo" id="MJXp-Span-1660" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.083em;"><span class="MJXp-right MJXp-scale10" style="font-size: 1.333em; margin-left: 0.07em;">(</span></span></span></span></span><span class="MJXp-mfrac" id="MJXp-Span-1661"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1662">x</span><span class="MJXp-mo" id="MJXp-Span-1663">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1664">y</span></span><span class="MJXp-box" style="margin-top: -0.7em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1665">x</span></span></span></span></span></span><span class="MJXp-TeXmathchoice" id="MJXp-Span-1666"><span class="MJXp-mstyle" id="MJXp-Span-1667"><span class="MJXp-mrow" id="MJXp-Span-1668"><span class="MJXp-mo" id="MJXp-Span-1669" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.083em;"><span class="MJXp-right MJXp-scale10" style="font-size: 1.333em; margin-left: 0.07em;">)</span></span></span></span></span></span></span></span><script type="math/tex" id="MathJax-Element-283">\binom{x+y}{x}</script> if <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1670"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1671">L</span><span class="MJXp-mo" id="MJXp-Span-1672" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1673">y</span><span class="MJXp-mo" id="MJXp-Span-1674" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1675">k</span></span></span><script type="math/tex" id="MathJax-Element-284">L+y \geq k</script> or <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1676"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1677">Z</span><span class="MJXp-mo" id="MJXp-Span-1678" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1679">x</span><span class="MJXp-mo" id="MJXp-Span-1680" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1681">k</span></span></span><script type="math/tex" id="MathJax-Element-285">Z+x \geq k</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1682"><span class="MJXp-mn" id="MJXp-Span-1683">0</span></span></span><script type="math/tex" id="MathJax-Element-286">0</script> if <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1684"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1685">Z</span><span class="MJXp-mo" id="MJXp-Span-1686" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1687">x</span><span class="MJXp-mo" id="MJXp-Span-1688" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1689">y</span><span class="MJXp-mo" id="MJXp-Span-1690" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1691">k</span></span></span><script type="math/tex" id="MathJax-Element-287">Z+x+y<k</script>, and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1692"><span class="MJXp-mrow" id="MJXp-Span-1693"><span class="MJXp-TeXmathchoice" id="MJXp-Span-1694"><span class="MJXp-mstyle" id="MJXp-Span-1695"><span class="MJXp-mrow" id="MJXp-Span-1696"><span class="MJXp-mo" id="MJXp-Span-1697" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.083em;"><span class="MJXp-right MJXp-scale10" style="font-size: 1.333em; margin-left: 0.07em;">(</span></span></span></span></span><span class="MJXp-mfrac" id="MJXp-Span-1698"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1699">x</span><span class="MJXp-mo" id="MJXp-Span-1700">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1701">y</span></span><span class="MJXp-box" style="margin-top: -0.7em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1702">k</span><span class="MJXp-mo" id="MJXp-Span-1703">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1704">Z</span></span></span></span></span></span><span class="MJXp-TeXmathchoice" id="MJXp-Span-1705"><span class="MJXp-mstyle" id="MJXp-Span-1706"><span class="MJXp-mrow" id="MJXp-Span-1707"><span class="MJXp-mo" id="MJXp-Span-1708" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.083em;"><span class="MJXp-right MJXp-scale10" style="font-size: 1.333em; margin-left: 0.07em;">)</span></span></span></span></span></span></span></span><script type="math/tex" id="MathJax-Element-288">\binom{x+y}{k-Z}</script> otherwise. The first two cases are relatively simple to show. We can show the last case because the longest nondecreasing subsequence of the entire string must compose entirely of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1709"><span class="MJXp-mn" id="MJXp-Span-1710">0</span></span></span><script type="math/tex" id="MathJax-Element-289">0</script>'s in the prefix (or else <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1711"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1712">L</span><span class="MJXp-mo" id="MJXp-Span-1713" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1714">y</span><span class="MJXp-mo" id="MJXp-Span-1715" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1716">k</span></span></span><script type="math/tex" id="MathJax-Element-290">L+y\geq k</script> would be true), so we can simplify this problem to the above problem as we only need a longest nondecreasing subsequence of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1717"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1718">k</span><span class="MJXp-mo" id="MJXp-Span-1719" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1720">Z</span></span></span><script type="math/tex" id="MathJax-Element-291">k-Z</script> now. Let this function be <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1721"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1722">g</span><span class="MJXp-mo" id="MJXp-Span-1723" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1724">x</span><span class="MJXp-mo" id="MJXp-Span-1725" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1726">y</span><span class="MJXp-mo" id="MJXp-Span-1727" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1728">k</span><span class="MJXp-mo" id="MJXp-Span-1729" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1730">Z</span><span class="MJXp-mo" id="MJXp-Span-1731" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-292">g(x,y,k,Z)</script>.</p><p>Now, to solve the problem, let's enumerate the length of the common prefix of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1732"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1733">s</span></span></span><script type="math/tex" id="MathJax-Element-293">s</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1734"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1735">t</span></span></span><script type="math/tex" id="MathJax-Element-294">t</script>, and then the index where the first half <strong>first</strong> has a longest nondecreasing subsequence length of exactly <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1736"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1737">k</span></span></span><script type="math/tex" id="MathJax-Element-295">k</script> (call this index <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1738"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1739">i</span></span></span><script type="math/tex" id="MathJax-Element-296">i</script>). If this point is within the prefix, then we can complete the second half of the sequence directly using the formula we obtained above. There are two cases: either <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1740"><span class="MJXp-msubsup" id="MJXp-Span-1741"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1742" style="margin-right: 0.05em;">t</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1743" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1744" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-1745">0</span></span></span><script type="math/tex" id="MathJax-Element-297">t_i=0</script> or <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1746"><span class="MJXp-msubsup" id="MJXp-Span-1747"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1748" style="margin-right: 0.05em;">t</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1749" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1750" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-1751">1</span></span></span><script type="math/tex" id="MathJax-Element-298">t_i=1</script>. If <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1752"><span class="MJXp-msubsup" id="MJXp-Span-1753"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1754" style="margin-right: 0.05em;">t</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1755" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1756" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-1757">0</span></span></span><script type="math/tex" id="MathJax-Element-299">t_i=0</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1758"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1759">i</span></span></span><script type="math/tex" id="MathJax-Element-300">i</script> is the first index where the longest nondecreasing subsequence has length <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1760"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1761">k</span></span></span><script type="math/tex" id="MathJax-Element-301">k</script>, then the longest nondecreasing subsequence must compose of only <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1762"><span class="MJXp-mn" id="MJXp-Span-1763">0</span></span></span><script type="math/tex" id="MathJax-Element-302">0</script>'s. In this case, the length of the longest nondecreasing subsequence up to index <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1764"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1765">i</span><span class="MJXp-mo" id="MJXp-Span-1766" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-1767">1</span></span></span><script type="math/tex" id="MathJax-Element-303">i-1</script> must be <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1768"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1769">k</span><span class="MJXp-mo" id="MJXp-Span-1770" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-1771">1</span></span></span><script type="math/tex" id="MathJax-Element-304">k-1</script>, and the number of zeroes are also fixed — this is also a direct application of the original formula. Otherwise (that is, if <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1772"><span class="MJXp-msubsup" id="MJXp-Span-1773"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1774" style="margin-right: 0.05em;">t</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1775" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1776" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-1777">1</span></span></span><script type="math/tex" id="MathJax-Element-305">t_i=1</script>), let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1778"><span class="MJXp-msup" id="MJXp-Span-1779"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1780" style="margin-right: 0.05em;">x</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1781" style="vertical-align: 0.5em;">′</span></span></span></span><script type="math/tex" id="MathJax-Element-306">x'</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1782"><span class="MJXp-msup" id="MJXp-Span-1783"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1784" style="margin-right: 0.05em;">y</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1785" style="vertical-align: 0.5em;">′</span></span></span></span><script type="math/tex" id="MathJax-Element-307">y'</script> be the number of zeroes and ones in this half. At index <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1786"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1787">i</span><span class="MJXp-mo" id="MJXp-Span-1788" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-1789">1</span></span></span><script type="math/tex" id="MathJax-Element-308">i-1</script>, the length of the longest nondecreasing subsequence should be exactly <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1790"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1791">k</span><span class="MJXp-mo" id="MJXp-Span-1792" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-1793">1</span></span></span><script type="math/tex" id="MathJax-Element-309">k-1</script>. We can calculate this by taking the number of binary strings with LNDS length at least <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1794"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1795">k</span><span class="MJXp-mo" id="MJXp-Span-1796" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-1797">1</span></span></span><script type="math/tex" id="MathJax-Element-310">k-1</script>, and subtract the number of binary strings with LNDS length at least <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1798"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1799">k</span></span></span><script type="math/tex" id="MathJax-Element-311">k</script>. Note that the number of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1800"><span class="MJXp-mn" id="MJXp-Span-1801">0</span></span></span><script type="math/tex" id="MathJax-Element-312">0</script>'s and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1802"><span class="MJXp-mn" id="MJXp-Span-1803">1</span></span></span><script type="math/tex" id="MathJax-Element-313">1</script>'s in the second half is also fixed (call them <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1804"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1805">x</span><span class="MJXp-mo" id="MJXp-Span-1806" style="margin-left: 0.333em; margin-right: 0.333em;">"</span></span></span><script type="math/tex" id="MathJax-Element-314">x"</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1807"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1808">y</span><span class="MJXp-mo" id="MJXp-Span-1809" style="margin-left: 0.333em; margin-right: 0.333em;">"</span></span></span><script type="math/tex" id="MathJax-Element-315">y"</script> respectively), so we can multiply the previous result by the number of binary strings with LNDS at least <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1810"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1811">k</span></span></span><script type="math/tex" id="MathJax-Element-316">k</script>. We can write this as getting the sum <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1812"><span class="MJXp-mo" id="MJXp-Span-1813" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1814">g</span><span class="MJXp-mo" id="MJXp-Span-1815" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msup" id="MJXp-Span-1816"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1817" style="margin-right: 0.05em;">x</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1818" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-1819" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msup" id="MJXp-Span-1820"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1821" style="margin-right: 0.05em;">y</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1822" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-1823" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1824">k</span><span class="MJXp-mo" id="MJXp-Span-1825" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-1826">1</span><span class="MJXp-mo" id="MJXp-Span-1827" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1828">Z</span><span class="MJXp-mo" id="MJXp-Span-1829" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1830" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1831">g</span><span class="MJXp-mo" id="MJXp-Span-1832" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msup" id="MJXp-Span-1833"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1834" style="margin-right: 0.05em;">x</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1835" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-1836" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msup" id="MJXp-Span-1837"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1838" style="margin-right: 0.05em;">y</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1839" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-1840" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1841">k</span><span class="MJXp-mo" id="MJXp-Span-1842" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1843">Z</span><span class="MJXp-mo" id="MJXp-Span-1844" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1845" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1846" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1847">f</span><span class="MJXp-mo" id="MJXp-Span-1848" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1849">x</span><span class="MJXp-mo" id="MJXp-Span-1850" style="margin-left: 0.333em; margin-right: 0.333em;">"</span><span class="MJXp-mo" id="MJXp-Span-1851" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1852">y</span><span class="MJXp-mo" id="MJXp-Span-1853" style="margin-left: 0.333em; margin-right: 0.333em;">"</span><span class="MJXp-mo" id="MJXp-Span-1854" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1855">k</span><span class="MJXp-mo" id="MJXp-Span-1856" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-317">(g(x',y',k-1,Z)-g(x',y',k,Z))\cdot f(x",y",k)</script>. </p><p>This looks like the solution will become <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1857"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1858">O</span><span class="MJXp-mo" id="MJXp-Span-1859" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1860"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1861" style="margin-right: 0.05em;">n</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1862" style="vertical-align: 0.5em;">3</span></span><span class="MJXp-mo" id="MJXp-Span-1863" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-318">O(n^3)</script> since we have to loop through all possible <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1864"><span class="MJXp-msup" id="MJXp-Span-1865"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1866" style="margin-right: 0.05em;">x</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1867" style="vertical-align: 0.5em;">′</span></span></span></span><script type="math/tex" id="MathJax-Element-319">x'</script> values. However, let's look at <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1868"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1869">g</span><span class="MJXp-mo" id="MJXp-Span-1870" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1871">x</span><span class="MJXp-mo" id="MJXp-Span-1872" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1873">y</span><span class="MJXp-mo" id="MJXp-Span-1874" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1875">k</span><span class="MJXp-mo" id="MJXp-Span-1876" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1877">Z</span><span class="MJXp-mo" id="MJXp-Span-1878" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-320">g(x,y,k,Z)</script> again. It is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1879"><span class="MJXp-mrow" id="MJXp-Span-1880"><span class="MJXp-TeXmathchoice" id="MJXp-Span-1881"><span class="MJXp-mstyle" id="MJXp-Span-1882"><span class="MJXp-mrow" id="MJXp-Span-1883"><span class="MJXp-mo" id="MJXp-Span-1884" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.083em;"><span class="MJXp-right MJXp-scale10" style="font-size: 1.333em; margin-left: 0.07em;">(</span></span></span></span></span><span class="MJXp-mfrac" id="MJXp-Span-1885"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1886">x</span><span class="MJXp-mo" id="MJXp-Span-1887">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1888">y</span></span><span class="MJXp-box" style="margin-top: -0.7em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1889">x</span></span></span></span></span></span><span class="MJXp-TeXmathchoice" id="MJXp-Span-1890"><span class="MJXp-mstyle" id="MJXp-Span-1891"><span class="MJXp-mrow" id="MJXp-Span-1892"><span class="MJXp-mo" id="MJXp-Span-1893" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.083em;"><span class="MJXp-right MJXp-scale10" style="font-size: 1.333em; margin-left: 0.07em;">)</span></span></span></span></span></span></span></span><script type="math/tex" id="MathJax-Element-321">\binom{x+y}{x}</script> if <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1894"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1895">y</span><span class="MJXp-mo" id="MJXp-Span-1896" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1897">k</span><span class="MJXp-mo" id="MJXp-Span-1898" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-1899"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1900" style="margin-right: 0.05em;">C</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1901" style="vertical-align: -0.4em;">1</span></span></span></span><script type="math/tex" id="MathJax-Element-322">y \geq k-C_1</script> or <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1902"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1903">x</span><span class="MJXp-mo" id="MJXp-Span-1904" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1905">k</span><span class="MJXp-mo" id="MJXp-Span-1906" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-1907"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1908" style="margin-right: 0.05em;">C</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1909" style="vertical-align: -0.4em;">2</span></span></span></span><script type="math/tex" id="MathJax-Element-323">x \geq k-C_2</script> (call this case <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1910"><span class="MJXp-mn" id="MJXp-Span-1911">1</span></span></span><script type="math/tex" id="MathJax-Element-324">1</script>) for some constants <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1912"><span class="MJXp-msubsup" id="MJXp-Span-1913"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1914" style="margin-right: 0.05em;">C</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1915" style="vertical-align: -0.4em;">1</span></span></span></span><script type="math/tex" id="MathJax-Element-325">C_1</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1916"><span class="MJXp-msubsup" id="MJXp-Span-1917"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1918" style="margin-right: 0.05em;">C</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1919" style="vertical-align: -0.4em;">2</span></span></span></span><script type="math/tex" id="MathJax-Element-326">C_2</script>, and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1920"><span class="MJXp-mrow" id="MJXp-Span-1921"><span class="MJXp-TeXmathchoice" id="MJXp-Span-1922"><span class="MJXp-mstyle" id="MJXp-Span-1923"><span class="MJXp-mrow" id="MJXp-Span-1924"><span class="MJXp-mo" id="MJXp-Span-1925" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.083em;"><span class="MJXp-right MJXp-scale10" style="font-size: 1.333em; margin-left: 0.07em;">(</span></span></span></span></span><span class="MJXp-mfrac" id="MJXp-Span-1926"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1927">x</span><span class="MJXp-mo" id="MJXp-Span-1928">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1929">y</span></span><span class="MJXp-box" style="margin-top: -0.7em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1930">k</span><span class="MJXp-mo" id="MJXp-Span-1931">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1932">Z</span></span></span></span></span></span><span class="MJXp-TeXmathchoice" id="MJXp-Span-1933"><span class="MJXp-mstyle" id="MJXp-Span-1934"><span class="MJXp-mrow" id="MJXp-Span-1935"><span class="MJXp-mo" id="MJXp-Span-1936" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.083em;"><span class="MJXp-right MJXp-scale10" style="font-size: 1.333em; margin-left: 0.07em;">)</span></span></span></span></span></span></span></span><script type="math/tex" id="MathJax-Element-327">\binom{x+y}{k-Z}</script> otherwise (call this case <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1937"><span class="MJXp-mn" id="MJXp-Span-1938">2</span></span></span><script type="math/tex" id="MathJax-Element-328">2</script>). Consider <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1939"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1940">g</span><span class="MJXp-mo" id="MJXp-Span-1941" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msup" id="MJXp-Span-1942"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1943" style="margin-right: 0.05em;">x</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1944" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-1945" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msup" id="MJXp-Span-1946"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1947" style="margin-right: 0.05em;">y</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1948" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-1949" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1950">k</span><span class="MJXp-mo" id="MJXp-Span-1951" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-1952">1</span><span class="MJXp-mo" id="MJXp-Span-1953" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1954">Z</span><span class="MJXp-mo" id="MJXp-Span-1955" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-329">g(x',y',k-1,Z)</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1956"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1957">g</span><span class="MJXp-mo" id="MJXp-Span-1958" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msup" id="MJXp-Span-1959"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1960" style="margin-right: 0.05em;">x</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1961" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-1962" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msup" id="MJXp-Span-1963"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1964" style="margin-right: 0.05em;">y</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1965" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-1966" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1967">k</span><span class="MJXp-mo" id="MJXp-Span-1968" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1969">Z</span><span class="MJXp-mo" id="MJXp-Span-1970" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-330">g(x',y',k,Z)</script>. When both functions are in case <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1971"><span class="MJXp-mn" id="MJXp-Span-1972">1</span></span></span><script type="math/tex" id="MathJax-Element-331">1</script>, we have <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1973"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1974">g</span><span class="MJXp-mo" id="MJXp-Span-1975" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msup" id="MJXp-Span-1976"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1977" style="margin-right: 0.05em;">x</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1978" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-1979" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msup" id="MJXp-Span-1980"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1981" style="margin-right: 0.05em;">y</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1982" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-1983" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1984">k</span><span class="MJXp-mo" id="MJXp-Span-1985" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-1986">1</span><span class="MJXp-mo" id="MJXp-Span-1987" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1988">Z</span><span class="MJXp-mo" id="MJXp-Span-1989" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1990" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1991">g</span><span class="MJXp-mo" id="MJXp-Span-1992" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msup" id="MJXp-Span-1993"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1994" style="margin-right: 0.05em;">x</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1995" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-1996" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msup" id="MJXp-Span-1997"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1998" style="margin-right: 0.05em;">y</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1999" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-2000" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2001">k</span><span class="MJXp-mo" id="MJXp-Span-2002" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2003">Z</span><span class="MJXp-mo" id="MJXp-Span-2004" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-2005" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-2006">0</span></span></span><script type="math/tex" id="MathJax-Element-332">g(x',y',k-1,Z)-g(x',y',k,Z)=0</script>. When both functions are in case <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2007"><span class="MJXp-mn" id="MJXp-Span-2008">2</span></span></span><script type="math/tex" id="MathJax-Element-333">2</script>, the difference is a constant. The only case we have to worry about is when one function is in case <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2009"><span class="MJXp-mn" id="MJXp-Span-2010">1</span></span></span><script type="math/tex" id="MathJax-Element-334">1</script> and the other is in case <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2011"><span class="MJXp-mn" id="MJXp-Span-2012">2</span></span></span><script type="math/tex" id="MathJax-Element-335">2</script>. But note the conditions for case <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2013"><span class="MJXp-mn" id="MJXp-Span-2014">1</span></span></span><script type="math/tex" id="MathJax-Element-336">1</script> — it is either if <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2015"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2016">y</span></span></span><script type="math/tex" id="MathJax-Element-337">y</script> is larger than some constant or if <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2017"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2018">x</span></span></span><script type="math/tex" id="MathJax-Element-338">x</script> is larger than some constant. Thus, when <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2019"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2020">g</span><span class="MJXp-mo" id="MJXp-Span-2021" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msup" id="MJXp-Span-2022"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2023" style="margin-right: 0.05em;">x</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-2024" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-2025" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msup" id="MJXp-Span-2026"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2027" style="margin-right: 0.05em;">y</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-2028" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-2029" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2030">k</span><span class="MJXp-mo" id="MJXp-Span-2031" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-2032">1</span><span class="MJXp-mo" id="MJXp-Span-2033" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2034">Z</span><span class="MJXp-mo" id="MJXp-Span-2035" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-339">g(x',y',k-1,Z)</script> leaves case <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2036"><span class="MJXp-mn" id="MJXp-Span-2037">1</span></span></span><script type="math/tex" id="MathJax-Element-340">1</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2038"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2039">g</span><span class="MJXp-mo" id="MJXp-Span-2040" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msup" id="MJXp-Span-2041"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2042" style="margin-right: 0.05em;">x</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-2043" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-2044" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msup" id="MJXp-Span-2045"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2046" style="margin-right: 0.05em;">y</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-2047" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-2048" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2049">k</span><span class="MJXp-mo" id="MJXp-Span-2050" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-2051">1</span><span class="MJXp-mo" id="MJXp-Span-2052" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2053">Z</span><span class="MJXp-mo" id="MJXp-Span-2054" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-341">g(x',y',k-1,Z)</script> will also leave case <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2055"><span class="MJXp-mn" id="MJXp-Span-2056">1</span></span></span><script type="math/tex" id="MathJax-Element-342">1</script>. Similarly, when <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2057"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2058">g</span><span class="MJXp-mo" id="MJXp-Span-2059" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msup" id="MJXp-Span-2060"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2061" style="margin-right: 0.05em;">x</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-2062" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-2063" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msup" id="MJXp-Span-2064"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2065" style="margin-right: 0.05em;">y</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-2066" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-2067" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2068">k</span><span class="MJXp-mo" id="MJXp-Span-2069" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2070">Z</span><span class="MJXp-mo" id="MJXp-Span-2071" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-343">g(x',y',k,Z)</script> enters case <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2072"><span class="MJXp-mn" id="MJXp-Span-2073">1</span></span></span><script type="math/tex" id="MathJax-Element-344">1</script> (when <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2074"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2075">y</span></span></span><script type="math/tex" id="MathJax-Element-345">y</script> becomes too large), <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2076"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2077">g</span><span class="MJXp-mo" id="MJXp-Span-2078" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msup" id="MJXp-Span-2079"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2080" style="margin-right: 0.05em;">x</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-2081" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-2082" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msup" id="MJXp-Span-2083"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2084" style="margin-right: 0.05em;">y</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-2085" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-2086" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2087">k</span><span class="MJXp-mo" id="MJXp-Span-2088" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-2089">1</span><span class="MJXp-mo" id="MJXp-Span-2090" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2091">Z</span><span class="MJXp-mo" id="MJXp-Span-2092" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-346">g(x',y',k-1,Z)</script> will also enter case <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2093"><span class="MJXp-mn" id="MJXp-Span-2094">1</span></span></span><script type="math/tex" id="MathJax-Element-347">1</script> in the next iteration. So, we only have to calculate these cases for <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2095"><span class="MJXp-mn" id="MJXp-Span-2096">2</span></span></span><script type="math/tex" id="MathJax-Element-348">2</script> values of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2097"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2098">X</span></span></span><script type="math/tex" id="MathJax-Element-349">X</script>. Combining this with some prefix sums of binomial factors (to deal with the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2099"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2100">f</span><span class="MJXp-mo" id="MJXp-Span-2101" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2102">x</span><span class="MJXp-mo" id="MJXp-Span-2103" style="margin-left: 0.333em; margin-right: 0.333em;">"</span><span class="MJXp-mo" id="MJXp-Span-2104" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2105">y</span><span class="MJXp-mo" id="MJXp-Span-2106" style="margin-left: 0.333em; margin-right: 0.333em;">"</span><span class="MJXp-mo" id="MJXp-Span-2107" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2108">k</span><span class="MJXp-mo" id="MJXp-Span-2109" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-350">f(x",y",k)</script> portion when <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2110"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2111">g</span><span class="MJXp-mo" id="MJXp-Span-2112" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msup" id="MJXp-Span-2113"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2114" style="margin-right: 0.05em;">x</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-2115" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-2116" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msup" id="MJXp-Span-2117"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2118" style="margin-right: 0.05em;">y</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-2119" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-2120" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2121">k</span><span class="MJXp-mo" id="MJXp-Span-2122" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-2123">1</span><span class="MJXp-mo" id="MJXp-Span-2124" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2125">Z</span><span class="MJXp-mo" id="MJXp-Span-2126" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-2127" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2128">g</span><span class="MJXp-mo" id="MJXp-Span-2129" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msup" id="MJXp-Span-2130"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2131" style="margin-right: 0.05em;">x</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-2132" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-2133" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msup" id="MJXp-Span-2134"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2135" style="margin-right: 0.05em;">y</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-2136" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-2137" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2138">k</span><span class="MJXp-mo" id="MJXp-Span-2139" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2140">Z</span><span class="MJXp-mo" id="MJXp-Span-2141" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-351">g(x',y',k-1,Z)-g(x',y',k,Z)</script> is constant), we actually avoid running the loop entirely. Thus, we can calculate the answer in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2142"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2143">O</span><span class="MJXp-mo" id="MJXp-Span-2144" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-2145"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2146" style="margin-right: 0.05em;">n</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2147" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-2148" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-352">O(n^2)</script>.</p></div></div> <div class="spoiler"><b class="spoiler-title">Code</b><div class="spoiler-content" style="display: block;"><p><a href="https://codeforces.com/contest/2150/submission/340578210" title="Submission 340578210 by Dominater069">340578210</a></p></div></div></div>

    </div>


        <div style="font-size: 1.1rem;line-height: 1.1rem;padding-bottom: 0.5em;">
            <img src="https://codeforces.com//codeforces.com/codeforces.org/s/52448/images/icons/paperclip-16x16.png" style="vertical-align: middle;"> <span style="padding: 0 0.35em;">Tutorial of <a href="https://codeforces.com/contest/2150" class="notice" style="text-decoration: none;">Codeforces Round 1053 (Div. 1)</a> </span>
        </div>
        <div style="font-size: 1.1rem;line-height: 1.1rem;padding-bottom: 0.5em;">
            <img src="https://codeforces.com//codeforces.com/codeforces.org/s/52448/images/icons/paperclip-16x16.png" style="vertical-align: middle;"> <span style="padding: 0 0.35em;">Tutorial of <a href="https://codeforces.com/contest/2151" class="notice" style="text-decoration: none;">Codeforces Round 1053 (Div. 2)</a> </span>
        </div>
        
            

  <script>
    // Make all spoilers toggleable
    document.querySelectorAll('.spoiler-title').forEach(title => {
      title.addEventListener('click', function() {
        const spoiler = this.closest('.spoiler');
        spoiler.classList.toggle('open');
      });
    });
    
    // Open all spoilers by default for easier reading
    document.querySelectorAll('.spoiler').forEach(spoiler => {
      spoiler.classList.add('open');
    });
  </script>
</body>
</html>