<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tutorial</title>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
      line-height: 1.6;
      color: #333;
      background: #fafafa;
    }
    .ttypography {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    h3 {
      color: #1a1a1a;
      border-bottom: 2px solid #eee;
      padding-bottom: 10px;
    }
    h3 a {
      color: #0066cc;
      text-decoration: none;
    }
    h3 a:hover {
      text-decoration: underline;
    }
    .spoiler {
      margin: 15px 0;
      border: 1px solid #ddd;
      border-radius: 6px;
      overflow: hidden;
    }
    .spoiler-title {
      display: block;
      padding: 12px 15px;
      background: #f0f0f0;
      cursor: pointer;
      font-weight: 600;
      user-select: none;
      border-bottom: 1px solid #ddd;
    }
    .spoiler-title:hover {
      background: #e8e8e8;
    }
    .spoiler-title::before {
      content: '▶ ';
      font-size: 0.8em;
      transition: transform 0.2s;
      display: inline-block;
    }
    .spoiler.open .spoiler-title::before {
      content: '▼ ';
    }
    .spoiler-content {
      padding: 15px;
      background: #fff;
      display: none;
    }
    .spoiler.open .spoiler-content {
      display: block;
    }
    pre, code {
      background: #f5f5f5;
      font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
      font-size: 0.85em;
    }
    pre {
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
    }
    code {
      padding: 2px 5px;
      border-radius: 3px;
    }
    p {
      margin: 10px 0;
    }
    .MathJax {
      font-size: 1.1em;
    }
  </style>
</head>
<body>
  <h1>Editorial</h1>
  <p><a href="https://codeforces.com/blog/entry/147322" target="_blank">View on Codeforces →</a></p>
  
  <div class="ttypography"><p>Thanks for the participation! We hope you enjoyed the contest.</p> <div class="spoiler"><b class="spoiler-title">Rate the contest!</b><div class="spoiler-content" style="display: block;"><ul>   <li>
<style data-nocturne="true" type="text/css">

</style>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="12728">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="152">152</span>
            </i>
        </a>
    </span>

    <script>
        $(function() {
            const likeFormUtil = {};
            likeFormUtil.getCount = function ($count) {
                return Number($count.attr("data-value"));
            };
            likeFormUtil.setCount = function ($count, value) {
                $count.attr("data-value", value);
                $count.text(value);
            };
            likeFormUtil.like = function ($likeForm) {
                $likeForm.find(".likeState").addClass("liked");
                const $likeCount = $likeForm.find(".likeCount");
                likeFormUtil.setCount($likeCount, likeFormUtil.getCount($likeCount) + 1);
            };
            likeFormUtil.unLike = function ($likeForm) {
                if ($likeForm.find(".likeState").hasClass("liked")) {
                    $likeForm.find(".likeState").removeClass("liked");
                    const $likeCount = $likeForm.find(".likeCount");
                    likeFormUtil.setCount($likeCount, likeFormUtil.getCount($likeCount) - 1);
                }
            };
            likeFormUtil.dislike = function ($likeForm) {
                $likeForm.find(".dislikeState").addClass("disliked");
                const $dislikeCount = $likeForm.find(".dislikeCount");
                likeFormUtil.setCount($dislikeCount, likeFormUtil.getCount($dislikeCount) + 1);
            };
            likeFormUtil.unDislike = function ($likeForm) {
                if ($likeForm.find(".dislikeState").hasClass("disliked")) {
                    $likeForm.find(".dislikeState").removeClass("disliked");
                    const $dislikeCount = $likeForm.find(".dislikeCount");
                    likeFormUtil.setCount($dislikeCount, likeFormUtil.getCount($dislikeCount) - 1);
                }
            };
            likeFormUtil.disable = function ($likeForm) {
                $likeForm.find(".likeActionLink").off("click");
                $likeForm.find(".likeActionLink").on("click", function () {
                    return false;
                });
                $likeForm.find(".dislikeActionLink").off("click");
                $likeForm.find(".dislikeActionLink").on("click", function () {
                    return false;
                });
            };
            likeFormUtil.enable = function ($likeForm) {
                $likeForm.find(".likeActionLink").off("click");
                $likeForm.find(".likeActionLink").on("click", onLike);
                $likeForm.find(".dislikeActionLink").off("click");
                $likeForm.find(".dislikeActionLink").on("click", onDislike);
            };
            likeFormUtil.applyLikeableInformation = function(likeableInformation) {
                const id = likeableInformation.likeable.id;
                console.log(id);
                const $likeForm = $(".likeActionLink[data-likeableId='" + id + "']").closest(".likeForm");
                console.log($likeForm);
                likeFormUtil.setCount($likeForm.find(".likeCount"), likeableInformation.likeCount);
                likeFormUtil.setCount($likeForm.find(".dislikeCount"), likeableInformation.dislikeCount);
                if (likeableInformation.liked) {
                    $likeForm.find(".likeState").addClass("liked");
                } else {
                    $likeForm.find(".likeState").removeClass("liked");
                }
                if (likeableInformation.disliked) {
                    $likeForm.find(".likeState").addClass("disliked");
                } else {
                    $likeForm.find(".likeState").removeClass("disliked");
                }
            }
            likeFormUtil.applyLikeableInformations = function(likeableInformations) {
                likeableInformations.forEach((applyLikeableInformation) => {
                    likeFormUtil.applyLikeableInformation(applyLikeableInformation);
                });
            }

            function onLike() {
                const $likeActionLink = $(this);
                const likeableId = $likeActionLink.attr("data-likeableId");
                const $likeForm = $likeActionLink.parent();

                likeFormUtil.disable($likeForm);
                $.post("/data/like", {
                    action: "like",
                    likeableId: likeableId
                }, function (data) {
                    if (data["success"] === true) {
                        if (data["liked"]) {
                            Codeforces.showMessage('Added to liked');
                        } else {
                            Codeforces.showMessage('Removed from liked');
                        }
                        likeFormUtil.applyLikeableInformations(data["likeableInformations"]);
                    } else {
                        Codeforces.showMessage(data["message"] || "Error");
                    }
                    likeFormUtil.enable($likeForm);
                }, "json");
                return false;
            }

            function onDislike() {
                const $dislikeActionLink = $(this);
                const likeableId = $dislikeActionLink.attr("data-likeableId");
                const $likeForm = $dislikeActionLink.parent();

                likeFormUtil.disable($likeForm);
                $.post("/data/like", {
                    action: "dislike",
                    likeableId: likeableId
                }, function (data) {
                    if (data["success"] === true) {
                        if (data["disliked"]) {
                            Codeforces.showMessage('Added to disliked');
                        } else {
                            Codeforces.showMessage('Removed from disliked');
                        }
                        likeFormUtil.applyLikeableInformations(data["likeableInformations"]);
                    } else {
                        Codeforces.showMessage(data["message"] || "Error");
                    }
                    likeFormUtil.enable($likeForm);
                }, "json");
                return false;
            }

            $(".likeActionLink").click(onLike);
            $(".dislikeActionLink").click(onDislike);

            $(".likeCount").add(".dislikeCount").each(function () {
                const $count = $(this);
                likeFormUtil.setCount($count, likeFormUtil.getCount($count));
            });
        });
    </script>

<script data-nocturne="true"> $(function () {
}); </script>

 Epic</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="12729">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="149">149</span>
            </i>
        </a>
    </span>


 Good</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="12730">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="44">44</span>
            </i>
        </a>
    </span>


 Moderate</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="12731">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="14">14</span>
            </i>
        </a>
    </span>


 Bad</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="12732">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="65">65</span>
            </i>
        </a>
    </span>


 Horrendous</li> </ul></div></div><p><strike>The solution codes will be added shortly after the system tests are finished.</strike> They have been added.</p><p><a href="https://codeforces.com/contest/2160/problem/A" title="Codeforces Round 1058 (Div. 2)">2160A - MEX Partition</a></p><p>Problem Credit: <a class="rated-user user-orange" href="https://codeforces.com/profile/Proof_by_QED" title="Master Proof_by_QED">Proof_by_QED</a></p> <div class="spoiler"><b class="spoiler-title">Rate the problem!</b><div class="spoiler-content" style="display: block;"><ul>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="12769">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="47">47</span>
            </i>
        </a>
    </span>


 Epic</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="12770">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="141">141</span>
            </i>
        </a>
    </span>


 Good</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="12771">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="185">185</span>
            </i>
        </a>
    </span>


 Moderate</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="12772">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="27">27</span>
            </i>
        </a>
    </span>


 Bad</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="12773">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="17">17</span>
            </i>
        </a>
    </span>


 Horrendous</li> </ul></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><p>First, let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2">m</span><span class="MJXp-mo" id="MJXp-Span-3" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi" id="MJXp-Span-4">mex</span><span class="MJXp-mo" id="MJXp-Span-5" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-6" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-7">A</span><span class="MJXp-mo" id="MJXp-Span-8" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-1">m=\operatorname{mex}(A)</script>. We can ignore all elements that are greater than <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-9"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-10">m</span></span></span><script type="math/tex" id="MathJax-Element-2">m</script>. This is because since <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-11"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-12">m</span></span></span><script type="math/tex" id="MathJax-Element-3">m</script> is the mex, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-13"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-14">m</span></span></span><script type="math/tex" id="MathJax-Element-4">m</script> does not appear in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-15"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-16">A</span></span></span><script type="math/tex" id="MathJax-Element-5">A</script>, and consequently it also cannot appear in any of the partitions. Thus, which of the partitions each element goes to does not matter.</p><p>Now, let's consider the number <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-17"><span class="MJXp-mn" id="MJXp-Span-18">0</span></span></span><script type="math/tex" id="MathJax-Element-6">0</script>. Suppose there is at least one <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-19"><span class="MJXp-mn" id="MJXp-Span-20">0</span></span></span><script type="math/tex" id="MathJax-Element-7">0</script> in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-21"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-22">A</span></span></span><script type="math/tex" id="MathJax-Element-8">A</script>. Then, at least one multiset in the partition must contain <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-23"><span class="MJXp-mn" id="MJXp-Span-24">0</span></span></span><script type="math/tex" id="MathJax-Element-9">0</script> (because each element in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-25"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-26">A</span></span></span><script type="math/tex" id="MathJax-Element-10">A</script> must be in one multiset in the partition). This also implies that all multisets must contain <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-27"><span class="MJXp-mn" id="MJXp-Span-28">0</span></span></span><script type="math/tex" id="MathJax-Element-11">0</script>, as otherwise the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-29"><span class="MJXp-mi" id="MJXp-Span-30">mex</span></span></span><script type="math/tex" id="MathJax-Element-12">\operatorname{mex}</script> of all multisets cannot be the same (it is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-31"><span class="MJXp-mn" id="MJXp-Span-32">0</span></span></span><script type="math/tex" id="MathJax-Element-13">0</script> for some, but greater than <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-33"><span class="MJXp-mn" id="MJXp-Span-34">0</span></span></span><script type="math/tex" id="MathJax-Element-14">0</script> for others).</p><p>Once we reach the conclusion that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-35"><span class="MJXp-mn" id="MJXp-Span-36">0</span></span></span><script type="math/tex" id="MathJax-Element-15">0</script> must be present in all partitions, we can make the same conclusion for <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-37"><span class="MJXp-mn" id="MJXp-Span-38">1</span><span class="MJXp-mo" id="MJXp-Span-39" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-40">2</span><span class="MJXp-mo" id="MJXp-Span-41" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-42" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-43" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-44">m</span><span class="MJXp-mo" id="MJXp-Span-45" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-46">1</span></span></span><script type="math/tex" id="MathJax-Element-16">1,2,\ldots,m-1</script>. That is, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-47"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-48">m</span></span></span><script type="math/tex" id="MathJax-Element-17">m</script> is the only possible score.</p></div></div> <div class="spoiler"><b class="spoiler-title">Code (chromate00)</b><div class="spoiler-content" style="display: block;"><p><a href="https://codeforces.com/contest/2160/submission/343539998" title="Submission 343539998 by chromate00">343539998</a></p></div></div><p><a href="https://codeforces.com/contest/2160/problem/B" title="Codeforces Round 1058 (Div. 2)">2160B - Distinct Elements</a></p><p>Problem Credit: <a class="rated-user user-orange" href="https://codeforces.com/profile/Proof_by_QED" title="Master Proof_by_QED">Proof_by_QED</a></p> <div class="spoiler"><b class="spoiler-title">Rate the problem!</b><div class="spoiler-content" style="display: block;"><ul>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="12775">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="377">377</span>
            </i>
        </a>
    </span>


 Epic</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="12776">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="113">113</span>
            </i>
        </a>
    </span>


 Good</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="12777">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="26">26</span>
            </i>
        </a>
    </span>


 Moderate</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="12778">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="33">33</span>
            </i>
        </a>
    </span>


 Bad</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="12779">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="54">54</span>
            </i>
        </a>
    </span>


 Horrendous</li> </ul></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><p>For simplicity, let's denote <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-49"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-50">f</span><span class="MJXp-mo" id="MJXp-Span-51" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-52">a</span><span class="MJXp-mo" id="MJXp-Span-53" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-54">l</span><span class="MJXp-mo" id="MJXp-Span-55" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-56">r</span><span class="MJXp-mo" id="MJXp-Span-57" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-58" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-18">f(a[l,r])</script> as <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-59"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-60">f</span><span class="MJXp-mo" id="MJXp-Span-61" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-62">l</span><span class="MJXp-mo" id="MJXp-Span-63" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-64">r</span><span class="MJXp-mo" id="MJXp-Span-65" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-19">f(l,r)</script>.</p><p>First, notice that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-66"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-67">f</span><span class="MJXp-mo" id="MJXp-Span-68" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-69">l</span><span class="MJXp-mo" id="MJXp-Span-70" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-71">r</span><span class="MJXp-mo" id="MJXp-Span-72" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-73" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-74">f</span><span class="MJXp-mo" id="MJXp-Span-75" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-76">l</span><span class="MJXp-mo" id="MJXp-Span-77" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-78">r</span><span class="MJXp-mo" id="MJXp-Span-79" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-80">1</span><span class="MJXp-mo" id="MJXp-Span-81" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-20">f(l,r)\leq f(l,r+1)</script>. This is trivially true because each unique element that appears in the range <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-82"><span class="MJXp-mo" id="MJXp-Span-83" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-84">l</span><span class="MJXp-mo" id="MJXp-Span-85" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-86">r</span><span class="MJXp-mo" id="MJXp-Span-87" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-21">(l,r)</script> must appear in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-88"><span class="MJXp-mo" id="MJXp-Span-89" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-90">l</span><span class="MJXp-mo" id="MJXp-Span-91" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-92">r</span><span class="MJXp-mo" id="MJXp-Span-93" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-94">1</span><span class="MJXp-mo" id="MJXp-Span-95" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-22">(l,r+1)</script> also. Now, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-96"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-97">f</span><span class="MJXp-mo" id="MJXp-Span-98" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-99">l</span><span class="MJXp-mo" id="MJXp-Span-100" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-101">r</span><span class="MJXp-mo" id="MJXp-Span-102" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-103">1</span><span class="MJXp-mo" id="MJXp-Span-104" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-23">f(l,r+1)</script> is either equal to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-105"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-106">f</span><span class="MJXp-mo" id="MJXp-Span-107" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-108">l</span><span class="MJXp-mo" id="MJXp-Span-109" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-110">r</span><span class="MJXp-mo" id="MJXp-Span-111" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-24">f(l,r)</script> if <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-112"><span class="MJXp-msubsup" id="MJXp-Span-113"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-114" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-115" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-116">r</span><span class="MJXp-mo" id="MJXp-Span-117">+</span><span class="MJXp-mn" id="MJXp-Span-118">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-25">a_{r+1}</script> already appeared, or <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-119"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-120">f</span><span class="MJXp-mo" id="MJXp-Span-121" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-122">l</span><span class="MJXp-mo" id="MJXp-Span-123" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-124">r</span><span class="MJXp-mo" id="MJXp-Span-125" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-126" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-127">1</span></span></span><script type="math/tex" id="MathJax-Element-26">f(l,r)+1</script> if <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-128"><span class="MJXp-msubsup" id="MJXp-Span-129"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-130" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-131" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-132">r</span><span class="MJXp-mo" id="MJXp-Span-133">+</span><span class="MJXp-mn" id="MJXp-Span-134">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-27">a_{r+1}</script> does not appear in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-135"><span class="MJXp-mo" id="MJXp-Span-136" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-137">l</span><span class="MJXp-mo" id="MJXp-Span-138" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-139">r</span><span class="MJXp-mo" id="MJXp-Span-140" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-28">[l,r]</script>. </p><p>Now, expanding <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-141"><span class="MJXp-msubsup" id="MJXp-Span-142"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-143" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-144" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-145" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-146"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-147" style="margin-right: 0.05em;">b</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-148" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-149">i</span><span class="MJXp-mo" id="MJXp-Span-150">−</span><span class="MJXp-mn" id="MJXp-Span-151">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-29">b_i-b_{i-1}</script> yields <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-152"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-153">f</span><span class="MJXp-mo" id="MJXp-Span-154" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-155">i</span><span class="MJXp-mo" id="MJXp-Span-156" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-157">i</span><span class="MJXp-mo" id="MJXp-Span-158" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-159" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mo" id="MJXp-Span-160" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-161">f</span><span class="MJXp-mo" id="MJXp-Span-162" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-163">i</span><span class="MJXp-mo" id="MJXp-Span-164" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-165">1</span><span class="MJXp-mo" id="MJXp-Span-166" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-167">i</span><span class="MJXp-mo" id="MJXp-Span-168" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-169" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-170">f</span><span class="MJXp-mo" id="MJXp-Span-171" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-172">i</span><span class="MJXp-mo" id="MJXp-Span-173" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-174">1</span><span class="MJXp-mo" id="MJXp-Span-175" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-176">i</span><span class="MJXp-mo" id="MJXp-Span-177" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-178">1</span><span class="MJXp-mo" id="MJXp-Span-179" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-180" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-181" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mo" id="MJXp-Span-182" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-183">f</span><span class="MJXp-mo" id="MJXp-Span-184" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-185">i</span><span class="MJXp-mo" id="MJXp-Span-186" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-187">2</span><span class="MJXp-mo" id="MJXp-Span-188" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-189">i</span><span class="MJXp-mo" id="MJXp-Span-190" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-191" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-192">f</span><span class="MJXp-mo" id="MJXp-Span-193" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-194">i</span><span class="MJXp-mo" id="MJXp-Span-195" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-196">2</span><span class="MJXp-mo" id="MJXp-Span-197" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-198">i</span><span class="MJXp-mo" id="MJXp-Span-199" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-200">1</span><span class="MJXp-mo" id="MJXp-Span-201" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-202" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-203" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mo" id="MJXp-Span-204" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-205" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mo" id="MJXp-Span-206" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-207">f</span><span class="MJXp-mo" id="MJXp-Span-208" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-209">1</span><span class="MJXp-mo" id="MJXp-Span-210" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-211">i</span><span class="MJXp-mo" id="MJXp-Span-212" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-213" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-214">f</span><span class="MJXp-mo" id="MJXp-Span-215" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-216">1</span><span class="MJXp-mo" id="MJXp-Span-217" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-218">i</span><span class="MJXp-mo" id="MJXp-Span-219" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-220">1</span><span class="MJXp-mo" id="MJXp-Span-221" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-222" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-30">f(i,i) + (f(i-1,i)-f(i-1,i-1))+(f(i-2,i)-f(i-2,i-1))+\ldots+(f(1,i)-f(1,i-1))</script>. From the above, we know that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-223"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-224">f</span><span class="MJXp-mo" id="MJXp-Span-225" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-226">l</span><span class="MJXp-mo" id="MJXp-Span-227" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-228">i</span><span class="MJXp-mo" id="MJXp-Span-229" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-230" style="margin-left: 0.333em; margin-right: 0.333em;">≠</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-231">f</span><span class="MJXp-mo" id="MJXp-Span-232" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-233">l</span><span class="MJXp-mo" id="MJXp-Span-234" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-235">i</span><span class="MJXp-mo" id="MJXp-Span-236" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-237">1</span><span class="MJXp-mo" id="MJXp-Span-238" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-31">f(l,i) \neq f(l,i-1)</script> only when <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-239"><span class="MJXp-msubsup" id="MJXp-Span-240"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-241" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-242" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-32">a_i</script> does not appear in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-243"><span class="MJXp-mo" id="MJXp-Span-244" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-245">l</span><span class="MJXp-mo" id="MJXp-Span-246" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-247">i</span><span class="MJXp-mo" id="MJXp-Span-248" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-249">1</span><span class="MJXp-mo" id="MJXp-Span-250" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-33">[l,i-1]</script>. Let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-251"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-252">x</span></span></span><script type="math/tex" id="MathJax-Element-34">x</script> be the largest integer such that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-253"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-254">f</span><span class="MJXp-mo" id="MJXp-Span-255" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-256">x</span><span class="MJXp-mo" id="MJXp-Span-257" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-258">i</span><span class="MJXp-mo" id="MJXp-Span-259" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-260">1</span><span class="MJXp-mo" id="MJXp-Span-261" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-262" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-263">f</span><span class="MJXp-mo" id="MJXp-Span-264" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-265">x</span><span class="MJXp-mo" id="MJXp-Span-266" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-267">i</span><span class="MJXp-mo" id="MJXp-Span-268" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-35">f(x,i-1)=f(x,i)</script>. Note that this implies that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-269"><span class="MJXp-msubsup" id="MJXp-Span-270"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-271" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-272" style="vertical-align: -0.4em;">x</span></span><span class="MJXp-mo" id="MJXp-Span-273" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-274"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-275" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-276" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-36">a_x=a_i</script>. For all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-277"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-278">y</span><span class="MJXp-mo" id="MJXp-Span-279" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-280">x</span></span></span><script type="math/tex" id="MathJax-Element-37">y>x</script>, we have <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-281"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-282">f</span><span class="MJXp-mo" id="MJXp-Span-283" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-284">y</span><span class="MJXp-mo" id="MJXp-Span-285" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-286">i</span><span class="MJXp-mo" id="MJXp-Span-287" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-288" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-289">f</span><span class="MJXp-mo" id="MJXp-Span-290" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-291">y</span><span class="MJXp-mo" id="MJXp-Span-292" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-293">i</span><span class="MJXp-mo" id="MJXp-Span-294" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-295">1</span><span class="MJXp-mo" id="MJXp-Span-296" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-297" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-298">1</span></span></span><script type="math/tex" id="MathJax-Element-38">f(y, i) - f(y,i-1) = 1</script>. Thus, we have <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-299"><span class="MJXp-msubsup" id="MJXp-Span-300"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-301" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-302" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-303" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-304"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-305" style="margin-right: 0.05em;">b</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-306" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-307">i</span><span class="MJXp-mo" id="MJXp-Span-308">−</span><span class="MJXp-mn" id="MJXp-Span-309">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-310" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-311">i</span><span class="MJXp-mo" id="MJXp-Span-312" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mo" id="MJXp-Span-313" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-314">i</span><span class="MJXp-mo" id="MJXp-Span-315" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-316">x</span><span class="MJXp-mo" id="MJXp-Span-317" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-318" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-319">x</span></span></span><script type="math/tex" id="MathJax-Element-39">b_i-b_{i-1}=i-(i-x) = x</script>, because all terms of the expansion above are <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-320"><span class="MJXp-mn" id="MJXp-Span-321">1</span></span></span><script type="math/tex" id="MathJax-Element-40">1</script> except for the ones corresponding to indices <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-322"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-323">x</span></span></span><script type="math/tex" id="MathJax-Element-41">x</script> to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-324"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-325">i</span><span class="MJXp-mo" id="MJXp-Span-326" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-327">1</span></span></span><script type="math/tex" id="MathJax-Element-42">i-1</script>. Since we know that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-328"><span class="MJXp-msubsup" id="MJXp-Span-329"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-330" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-331" style="vertical-align: -0.4em;">x</span></span><span class="MJXp-mo" id="MJXp-Span-332" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-333"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-334" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-335" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-43">a_x = a_i</script>, and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-336"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-337">x</span><span class="MJXp-mo" id="MJXp-Span-338" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-339"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-340" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-341" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-342" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-343"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-344" style="margin-right: 0.05em;">b</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-345" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-346">i</span><span class="MJXp-mo" id="MJXp-Span-347">−</span><span class="MJXp-mn" id="MJXp-Span-348">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-44">x = b_i - b_{i-1}</script>, we should set <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-349"><span class="MJXp-msubsup" id="MJXp-Span-350"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-351" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-352" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-45">a_i</script> to be the same as <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-353"><span class="MJXp-msubsup" id="MJXp-Span-354"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-355" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-356" style="vertical-align: -0.4em;"><span class="MJXp-msubsup" id="MJXp-Span-357"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-358" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-359" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-360">−</span><span class="MJXp-msubsup" id="MJXp-Span-361"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-362" style="margin-right: 0.05em;">b</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-363" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-364">i</span><span class="MJXp-mo" id="MJXp-Span-365">−</span><span class="MJXp-mn" id="MJXp-Span-366">1</span></span></span></span></span></span></span><script type="math/tex" id="MathJax-Element-46">a_{b_i-b_{i-1}}</script>. There is one more case where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-367"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-368">x</span></span></span><script type="math/tex" id="MathJax-Element-47">x</script> is undefined, because <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-369"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-370">f</span><span class="MJXp-mo" id="MJXp-Span-371" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-372">y</span><span class="MJXp-mo" id="MJXp-Span-373" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-374">i</span><span class="MJXp-mo" id="MJXp-Span-375" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-376" style="margin-left: 0.333em; margin-right: 0.333em;">≠</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-377">f</span><span class="MJXp-mo" id="MJXp-Span-378" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-379">y</span><span class="MJXp-mo" id="MJXp-Span-380" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-381">i</span><span class="MJXp-mo" id="MJXp-Span-382" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-383">1</span><span class="MJXp-mo" id="MJXp-Span-384" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-48">f(y,i) \neq f(y,i-1)</script> for all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-385"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-386">y</span><span class="MJXp-mo" id="MJXp-Span-387" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mn" id="MJXp-Span-388">1</span></span></span><script type="math/tex" id="MathJax-Element-49">y \geq 1</script>. This implies <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-389"><span class="MJXp-msubsup" id="MJXp-Span-390"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-391" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-392" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-50">a_i</script> did not appear before in the array. We can just set <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-393"><span class="MJXp-msubsup" id="MJXp-Span-394"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-395" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-396" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-51">a_i</script> to any unused number arbitrarily.</p></div></div> <div class="spoiler"><b class="spoiler-title">Code (chromate00)</b><div class="spoiler-content" style="display: block;"><p><a href="https://codeforces.com/contest/2160/submission/343541349" title="Submission 343541349 by chromate00">343541349</a></p></div></div><p><a href="https://codeforces.com/contest/2160/problem/C" title="Codeforces Round 1058 (Div. 2)">2160C - Reverse XOR</a></p><p>Problem Credit: <a class="rated-user user-orange" href="https://codeforces.com/profile/Proof_by_QED" title="Master Proof_by_QED">Proof_by_QED</a></p> <div class="spoiler"><b class="spoiler-title">Rate the problem!</b><div class="spoiler-content" style="display: block;"><ul>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="12780">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="252">252</span>
            </i>
        </a>
    </span>


 Epic</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="12781">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="174">174</span>
            </i>
        </a>
    </span>


 Good</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="12782">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="43">43</span>
            </i>
        </a>
    </span>


 Moderate</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="12783">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="42">42</span>
            </i>
        </a>
    </span>


 Bad</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="12784">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="45">45</span>
            </i>
        </a>
    </span>


 Horrendous</li> </ul></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><p>Let's view <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-397"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-398">x</span></span></span><script type="math/tex" id="MathJax-Element-52">x</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-399"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-400">f</span><span class="MJXp-mo" id="MJXp-Span-401" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-402">x</span><span class="MJXp-mo" id="MJXp-Span-403" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-53">f(x)</script>, and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-404"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-405">x</span><span class="MJXp-mo" id="MJXp-Span-406" style="margin-left: 0.267em; margin-right: 0.267em;">⊕</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-407">f</span><span class="MJXp-mo" id="MJXp-Span-408" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-409">x</span><span class="MJXp-mo" id="MJXp-Span-410" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-54">x \oplus f(x)</script> each as <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-411"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-412">y</span></span></span><script type="math/tex" id="MathJax-Element-55">y</script>-bit numbers (where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-413"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-414">y</span></span></span><script type="math/tex" id="MathJax-Element-56">y</script> is the smallest integer with <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-415"><span class="MJXp-msubsup" id="MJXp-Span-416"><span class="MJXp-mn" id="MJXp-Span-417" style="margin-right: 0.05em;">2</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-418" style="vertical-align: 0.5em;">y</span></span><span class="MJXp-mo" id="MJXp-Span-419" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-420">x</span></span></span><script type="math/tex" id="MathJax-Element-57">2^y>x</script>). We can see that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-421"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-422">x</span><span class="MJXp-mo" id="MJXp-Span-423" style="margin-left: 0.267em; margin-right: 0.267em;">⊕</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-424">f</span><span class="MJXp-mo" id="MJXp-Span-425" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-426">x</span><span class="MJXp-mo" id="MJXp-Span-427" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-58">x \oplus f(x)</script> is necessarily a palindrome. This is because the last bit of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-428"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-429">x</span><span class="MJXp-mo" id="MJXp-Span-430" style="margin-left: 0.267em; margin-right: 0.267em;">⊕</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-431">f</span><span class="MJXp-mo" id="MJXp-Span-432" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-433">x</span><span class="MJXp-mo" id="MJXp-Span-434" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-59">x \oplus f(x)</script> is the XOR of the last bit of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-435"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-436">x</span></span></span><script type="math/tex" id="MathJax-Element-60">x</script> and the first bit of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-437"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-438">f</span><span class="MJXp-mo" id="MJXp-Span-439" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-440">x</span><span class="MJXp-mo" id="MJXp-Span-441" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-61">f(x)</script>. But since <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-442"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-443">f</span><span class="MJXp-mo" id="MJXp-Span-444" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-445">x</span><span class="MJXp-mo" id="MJXp-Span-446" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-62">f(x)</script> is just <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-447"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-448">x</span></span></span><script type="math/tex" id="MathJax-Element-63">x</script> reversed, this simplifies to the last bit of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-449"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-450">x</span></span></span><script type="math/tex" id="MathJax-Element-64">x</script> XOR'ed with the first bit of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-451"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-452">x</span></span></span><script type="math/tex" id="MathJax-Element-65">x</script>. Now, look at the first bit. It is the XOR of first bit of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-453"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-454">x</span></span></span><script type="math/tex" id="MathJax-Element-66">x</script> and the first bit of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-455"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-456">f</span><span class="MJXp-mo" id="MJXp-Span-457" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-458">x</span><span class="MJXp-mo" id="MJXp-Span-459" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-67">f(x)</script>. By similar reasoning, this also simplifies to the first bit of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-460"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-461">x</span></span></span><script type="math/tex" id="MathJax-Element-68">x</script> and the last bit of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-462"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-463">x</span></span></span><script type="math/tex" id="MathJax-Element-69">x</script>. We can use the same argument to argue that the second and second to last, third and third to last bit, etc. are all the same. This is what a palindrome is.</p><p>One caveat is that although <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-464"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-465">x</span></span></span><script type="math/tex" id="MathJax-Element-70">x</script> is not allowed to have leading zeroes (by our definition of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-466"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-467">y</span></span></span><script type="math/tex" id="MathJax-Element-71">y</script>), both <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-468"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-469">f</span><span class="MJXp-mo" id="MJXp-Span-470" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-471">x</span><span class="MJXp-mo" id="MJXp-Span-472" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-72">f(x)</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-473"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-474">x</span><span class="MJXp-mo" id="MJXp-Span-475" style="margin-left: 0.267em; margin-right: 0.267em;">⊕</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-476">f</span><span class="MJXp-mo" id="MJXp-Span-477" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-478">x</span><span class="MJXp-mo" id="MJXp-Span-479" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-73">x \oplus f(x)</script> is. Thus, if we let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-480"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-481">z</span></span></span><script type="math/tex" id="MathJax-Element-74">z</script> be the smallest integer with <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-482"><span class="MJXp-msubsup" id="MJXp-Span-483"><span class="MJXp-mn" id="MJXp-Span-484" style="margin-right: 0.05em;">2</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-485" style="vertical-align: 0.5em;">z</span></span><span class="MJXp-mo" id="MJXp-Span-486" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-487">n</span></span></span><script type="math/tex" id="MathJax-Element-75">2^z>n</script>, then <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-488"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-489">y</span></span></span><script type="math/tex" id="MathJax-Element-76">y</script> is not necessarily equal to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-490"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-491">z</span></span></span><script type="math/tex" id="MathJax-Element-77">z</script>. Fortunately, using our palindrome condition, we can find the number of leading zeroes <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-492"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-493">n</span></span></span><script type="math/tex" id="MathJax-Element-78">n</script> must have (it is the same as the number of trailing zeroes in the binary representation of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-494"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-495">n</span></span></span><script type="math/tex" id="MathJax-Element-79">n</script>). This is how we can find <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-496"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-497">y</span></span></span><script type="math/tex" id="MathJax-Element-80">y</script>. There is one more trick — suppose <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-498"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-499">z</span></span></span><script type="math/tex" id="MathJax-Element-81">z</script> is odd and there exists a middle. If the middle digit is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-500"><span class="MJXp-mn" id="MJXp-Span-501">1</span></span></span><script type="math/tex" id="MathJax-Element-82">1</script>, then we cannot find an integer <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-502"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-503">x</span></span></span><script type="math/tex" id="MathJax-Element-83">x</script> with <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-504"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-505">x</span><span class="MJXp-mo" id="MJXp-Span-506" style="margin-left: 0.267em; margin-right: 0.267em;">⊕</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-507">f</span><span class="MJXp-mo" id="MJXp-Span-508" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-509">x</span><span class="MJXp-mo" id="MJXp-Span-510" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-511" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-512">n</span></span></span><script type="math/tex" id="MathJax-Element-84">x \oplus f(x)=n</script>. This is because the middle digit is the result of XOR between a bit and itself in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-513"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-514">x</span></span></span><script type="math/tex" id="MathJax-Element-85">x</script> (since it is in the middle), and both <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-515"><span class="MJXp-mn" id="MJXp-Span-516">1</span><span class="MJXp-mo" id="MJXp-Span-517" style="margin-left: 0.267em; margin-right: 0.267em;">⊕</span><span class="MJXp-mn" id="MJXp-Span-518">1</span></span></span><script type="math/tex" id="MathJax-Element-86">1 \oplus 1</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-519"><span class="MJXp-mn" id="MJXp-Span-520">0</span><span class="MJXp-mo" id="MJXp-Span-521" style="margin-left: 0.267em; margin-right: 0.267em;">⊕</span><span class="MJXp-mn" id="MJXp-Span-522">0</span></span></span><script type="math/tex" id="MathJax-Element-87">0 \oplus 0</script> results in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-523"><span class="MJXp-mn" id="MJXp-Span-524">0</span></span></span><script type="math/tex" id="MathJax-Element-88">0</script>. Note all other digits are allowed to be either <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-525"><span class="MJXp-mn" id="MJXp-Span-526">1</span></span></span><script type="math/tex" id="MathJax-Element-89">1</script> or <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-527"><span class="MJXp-mn" id="MJXp-Span-528">0</span></span></span><script type="math/tex" id="MathJax-Element-90">0</script>. If the result is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-529"><span class="MJXp-mn" id="MJXp-Span-530">0</span></span></span><script type="math/tex" id="MathJax-Element-91">0</script>, we can place a <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-531"><span class="MJXp-mn" id="MJXp-Span-532">1</span></span></span><script type="math/tex" id="MathJax-Element-92">1</script> in both the corresponding left bit and corresponding right bit. If the result is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-533"><span class="MJXp-mn" id="MJXp-Span-534">1</span></span></span><script type="math/tex" id="MathJax-Element-93">1</script>, we can arbitrarily place a <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-535"><span class="MJXp-mn" id="MJXp-Span-536">1</span></span></span><script type="math/tex" id="MathJax-Element-94">1</script> in the left bit and a <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-537"><span class="MJXp-mn" id="MJXp-Span-538">0</span></span></span><script type="math/tex" id="MathJax-Element-95">0</script> in the right bit, and this is possible if the left bit and right bit are not the same.</p></div></div> <div class="spoiler"><b class="spoiler-title">Code (chromate00)</b><div class="spoiler-content" style="display: block;"><p><a href="https://codeforces.com/contest/2160/submission/343541478" title="Submission 343541478 by chromate00">343541478</a></p></div></div><p><a href="https://codeforces.com/contest/2159/problem/A" title="Codeforces Round 1058 (Div. 1)">2159A - MAD Interactive Problem</a></p><p>Problem Credit: <a class="rated-user user-orange" href="https://codeforces.com/profile/wuhudsm" title="Master wuhudsm">wuhudsm</a></p> <div class="spoiler"><b class="spoiler-title">Rate the problem!</b><div class="spoiler-content" style="display: block;"><ul>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="12761">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="429">429</span>
            </i>
        </a>
    </span>


 Epic</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="12762">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="79">79</span>
            </i>
        </a>
    </span>


 Good</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="12763">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="20">20</span>
            </i>
        </a>
    </span>


 Moderate</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="12764">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="4">4</span>
            </i>
        </a>
    </span>


 Bad</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="12765">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="40">40</span>
            </i>
        </a>
    </span>


 Horrendous</li> </ul></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><p>It is not hard to see that the following property holds:</p> <ul>   <li>For some subsequence <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-539"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-540">T</span></span></span><script type="math/tex" id="MathJax-Element-96">T</script> and index <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-541"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-542">i</span></span></span><script type="math/tex" id="MathJax-Element-97">i</script> such that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-543"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-544">i</span><span class="MJXp-mo" id="MJXp-Span-545" style="margin-left: 0.333em; margin-right: 0.333em;">∉</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-546">T</span></span></span><script type="math/tex" id="MathJax-Element-98">i \notin T</script>, let the query results be <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-547"><span class="MJXp-mn" id="MJXp-Span-548">0</span></span></span><script type="math/tex" id="MathJax-Element-99">0</script> for <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-549"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-550">T</span></span></span><script type="math/tex" id="MathJax-Element-100">T</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-551"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-552">x</span><span class="MJXp-mo" id="MJXp-Span-553" style="margin-left: 0.333em; margin-right: 0.333em;">≠</span><span class="MJXp-mn" id="MJXp-Span-554">0</span></span></span><script type="math/tex" id="MathJax-Element-101">x \neq 0</script> for <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-555"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-556">T</span><span class="MJXp-mo" id="MJXp-Span-557" style="margin-left: 0.267em; margin-right: 0.267em;">∪</span><span class="MJXp-mrow" id="MJXp-Span-558"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-559">i</span></span></span></span><script type="math/tex" id="MathJax-Element-102">T \cup {i}</script>. Then, we gain the information that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-560"><span class="MJXp-msubsup" id="MJXp-Span-561"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-562" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-563" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-564" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-565">x</span></span></span><script type="math/tex" id="MathJax-Element-103">a_i=x</script>.</li> </ul><p>To use this property to our advantage, let's maintain a subsequence <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-566"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-567">S</span></span></span><script type="math/tex" id="MathJax-Element-104">S</script> whose query result is known to be <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-568"><span class="MJXp-mn" id="MJXp-Span-569">0</span></span></span><script type="math/tex" id="MathJax-Element-105">0</script>. Consider the following subroutine:</p> <ul>   <li>Query the subsequence <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-570"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-571">S</span><span class="MJXp-mo" id="MJXp-Span-572" style="margin-left: 0.267em; margin-right: 0.267em;">∪</span><span class="MJXp-mrow" id="MJXp-Span-573"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-574">i</span></span></span></span><script type="math/tex" id="MathJax-Element-106">S \cup {i}</script> and gain the result <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-575"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-576">x</span></span></span><script type="math/tex" id="MathJax-Element-107">x</script>.</li>   <li>If the result is nonzero, then we know that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-577"><span class="MJXp-msubsup" id="MJXp-Span-578"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-579" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-580" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-581" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-582">x</span></span></span><script type="math/tex" id="MathJax-Element-108">a_i=x</script>.</li>   <li>Otherwise, let's assign <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-583"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-584">S</span><span class="MJXp-mo" id="MJXp-Span-585" style="margin-left: 0.333em; margin-right: 0.333em;">←</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-586">S</span><span class="MJXp-mo" id="MJXp-Span-587" style="margin-left: 0.267em; margin-right: 0.267em;">∪</span><span class="MJXp-mrow" id="MJXp-Span-588"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-589">i</span></span></span></span><script type="math/tex" id="MathJax-Element-109">S \leftarrow S \cup {i}</script>.</li> </ul><p>If we perform this subroutine for <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-590"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-591">i</span><span class="MJXp-mo" id="MJXp-Span-592" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-593">1</span><span class="MJXp-mo" id="MJXp-Span-594" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-595">2</span><span class="MJXp-mo" id="MJXp-Span-596" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-597" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-598" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-599">2</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-600">n</span></span></span><script type="math/tex" id="MathJax-Element-110">i=1,2,\ldots,2n</script>, we gain the information about all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-601"><span class="MJXp-msubsup" id="MJXp-Span-602"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-603" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-604" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-111">a_i</script> such that its value appeared <strong>for the second time</strong>. We now need to find the other <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-605"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-606">n</span></span></span><script type="math/tex" id="MathJax-Element-112">n</script> elements' values.</p><p>Notice that currently the subsequence <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-607"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-608">S</span></span></span><script type="math/tex" id="MathJax-Element-113">S</script> contains each of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-609"><span class="MJXp-mn" id="MJXp-Span-610">1</span><span class="MJXp-mo" id="MJXp-Span-611" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-612">2</span><span class="MJXp-mo" id="MJXp-Span-613" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-614" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-615" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-616">n</span></span></span><script type="math/tex" id="MathJax-Element-114">1,2,\ldots,n</script> <strong>exactly once</strong>, and <strong>so does</strong> <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-617"><span class="MJXp-mo" id="MJXp-Span-618" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mn" id="MJXp-Span-619">1</span><span class="MJXp-mo" id="MJXp-Span-620" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-621">2</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-622">n</span><span class="MJXp-mo" id="MJXp-Span-623" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-624" style="margin-left: 0.267em; margin-right: 0.267em;">∖</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-625">S</span></span></span><script type="math/tex" id="MathJax-Element-115">[1,2n] \setminus S</script>. Therefore, we assign <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-626"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-627">S</span><span class="MJXp-mo" id="MJXp-Span-628" style="margin-left: 0.333em; margin-right: 0.333em;">←</span><span class="MJXp-mo" id="MJXp-Span-629" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mo" id="MJXp-Span-630" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mn" id="MJXp-Span-631">1</span><span class="MJXp-mo" id="MJXp-Span-632" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-633">2</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-634">n</span><span class="MJXp-mo" id="MJXp-Span-635" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-636" style="margin-left: 0.267em; margin-right: 0.267em;">∖</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-637">S</span><span class="MJXp-mo" id="MJXp-Span-638" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-116">S \leftarrow ([1,2n] \setminus S)</script> and perform the subroutine over all undiscovered indices again. Each run of the subroutine will give you a nonzero result, and give you the values of the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-639"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-640">n</span></span></span><script type="math/tex" id="MathJax-Element-117">n</script> undiscovered elements in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-641"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-642">n</span></span></span><script type="math/tex" id="MathJax-Element-118">n</script> additional queries.</p><p>Thus, this solution uses exactly <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-643"><span class="MJXp-mn" id="MJXp-Span-644">3</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-645">n</span></span></span><script type="math/tex" id="MathJax-Element-119">3n</script> queries (or <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-646"><span class="MJXp-mn" id="MJXp-Span-647">3</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-648">n</span><span class="MJXp-mo" id="MJXp-Span-649" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-650">1</span></span></span><script type="math/tex" id="MathJax-Element-120">3n-1</script> if you would) to discover the values of all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-651"><span class="MJXp-mn" id="MJXp-Span-652">2</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-653">n</span></span></span><script type="math/tex" id="MathJax-Element-121">2n</script> elements.</p></div></div> <div class="spoiler"><b class="spoiler-title">Code (_istil)</b><div class="spoiler-content" style="display: block;"><p><a href="https://codeforces.com/contest/2159/submission/343541838" title="Submission 343541838 by chromate00">343541838</a></p></div></div><p><a href="https://codeforces.com/contest/2159/problem/B" title="Codeforces Round 1058 (Div. 1)">2159B - Rectangles</a></p><p>Problem Credit: <a class="rated-user user-blue" href="https://codeforces.com/profile/chromate00" title="Expert chromate00">chromate00</a></p><p>UPD: I sincerely apologize about the weak pretests of the problem. I have greatly underestimated the runtime and memory usage of the worst solutions, while still wanting to be generous about slower solutions. This has led to weak tests during contest. Deeply sorry about the bad contest experiences affected by this.</p> <div class="spoiler"><b class="spoiler-title">Rate the problem!</b><div class="spoiler-content" style="display: block;"><ul>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="12790">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="67">67</span>
            </i>
        </a>
    </span>


 Epic</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="12791">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="35">35</span>
            </i>
        </a>
    </span>


 Good</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="12792">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="22">22</span>
            </i>
        </a>
    </span>


 Moderate</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="12793">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="29">29</span>
            </i>
        </a>
    </span>


 Bad</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="12794">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="349">349</span>
            </i>
        </a>
    </span>


 Horrendous</li> </ul></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><p>Let us define an <strong>minimal</strong> set of rectangles as a set of rectangles on the grid that satisfy the following conditions:</p> <ul>   <li>For all rectangles <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-654"><span class="MJXp-mo" id="MJXp-Span-655" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-656">u</span><span class="MJXp-mo" id="MJXp-Span-657" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-658">d</span><span class="MJXp-mo" id="MJXp-Span-659" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-660">l</span><span class="MJXp-mo" id="MJXp-Span-661" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-662">r</span><span class="MJXp-mo" id="MJXp-Span-663" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-122">(u,d,l,r)</script> in the set, there is no other rectangle <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-664"><span class="MJXp-mo" id="MJXp-Span-665" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-666">u</span><span class="MJXp-mo" id="MJXp-Span-667" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-668">d</span><span class="MJXp-mo" id="MJXp-Span-669" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msup" id="MJXp-Span-670"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-671" style="margin-right: 0.05em;">l</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-672" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-673" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msup" id="MJXp-Span-674"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-675" style="margin-right: 0.05em;">r</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-676" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-677" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-123">(u,d,l',r')</script> on the grid such that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-678"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-679">l</span><span class="MJXp-mo" id="MJXp-Span-680" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-msup" id="MJXp-Span-681"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-682" style="margin-right: 0.05em;">l</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-683" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-684" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-msup" id="MJXp-Span-685"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-686" style="margin-right: 0.05em;">r</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-687" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-688" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-689">r</span></span></span><script type="math/tex" id="MathJax-Element-124">l \le l' \le r' \le r</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-690"><span class="MJXp-msup" id="MJXp-Span-691"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-692" style="margin-right: 0.05em;">r</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-693" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-694" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msup" id="MJXp-Span-695"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-696" style="margin-right: 0.05em;">l</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-697" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-698" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-699">r</span><span class="MJXp-mo" id="MJXp-Span-700" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-701">l</span></span></span><script type="math/tex" id="MathJax-Element-125">r'-l' < r-l</script>.</li> </ul><p>Then, let us call the minimal set of rectangles with maximum cardinality the <strong>exhaustive minimal set</strong> <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-702"><span class="MJXp-mrow" id="MJXp-Span-703"><span class="MJXp-mi undefined" id="MJXp-Span-704">S</span></span></span></span><script type="math/tex" id="MathJax-Element-126">\mathbb{S}</script>.</p><p>This set <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-705"><span class="MJXp-mrow" id="MJXp-Span-706"><span class="MJXp-mi undefined" id="MJXp-Span-707">S</span></span></span></span><script type="math/tex" id="MathJax-Element-127">\mathbb{S}</script> satisfies the following conditions:</p> <ul>   <li><p>The set <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-708"><span class="MJXp-mrow" id="MJXp-Span-709"><span class="MJXp-mi undefined" id="MJXp-Span-710">S</span></span></span></span><script type="math/tex" id="MathJax-Element-128">\mathbb{S}</script> is unique.</p></li>   <li><p><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-711"><span class="MJXp-mrow" id="MJXp-Span-712"><span class="MJXp-mo" id="MJXp-Span-713" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mrow" id="MJXp-Span-714"><span class="MJXp-mi undefined" id="MJXp-Span-715">S</span></span><span class="MJXp-mrow" id="MJXp-Span-716"><span class="MJXp-mo" id="MJXp-Span-717" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mo" id="MJXp-Span-718" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mrow" id="MJXp-Span-719"><span class="MJXp-mrow" id="MJXp-Span-720"><span class="MJXp-TeXmathchoice" id="MJXp-Span-721"><span class="MJXp-mstyle" id="MJXp-Span-722"><span class="MJXp-mrow" id="MJXp-Span-723"><span class="MJXp-mo" id="MJXp-Span-724" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.083em;"><span class="MJXp-right MJXp-scale10" style="font-size: 1.333em; margin-left: 0.07em;">(</span></span></span></span></span><span class="MJXp-mfrac" id="MJXp-Span-725"><span class="MJXp-box MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-726"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-727">n</span></span></span><span class="MJXp-box" style="margin-top: -0.7em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-728"><span class="MJXp-mn" id="MJXp-Span-729">2</span></span></span></span></span></span></span><span class="MJXp-TeXmathchoice" id="MJXp-Span-730"><span class="MJXp-mstyle" id="MJXp-Span-731"><span class="MJXp-mrow" id="MJXp-Span-732"><span class="MJXp-mo" id="MJXp-Span-733" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.083em;"><span class="MJXp-right MJXp-scale10" style="font-size: 1.333em; margin-left: 0.07em;">)</span></span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-734" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-735">m</span></span></span><script type="math/tex" id="MathJax-Element-129">|\mathbb{S}| \le {{n}\choose{2}}\cdot m</script></p></li>   <li><p><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-736"><span class="MJXp-munderover" id="MJXp-Span-737"><span class=""><span class="MJXp-mo" id="MJXp-Span-738" style="margin-left: 0.111em; margin-right: 0.167em;">∑</span></span><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-739" style="margin-left: 0px;"><span class="MJXp-mo" id="MJXp-Span-740">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-741">u</span><span class="MJXp-mo" id="MJXp-Span-742">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-743">d</span><span class="MJXp-mo" id="MJXp-Span-744">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-745">l</span><span class="MJXp-mo" id="MJXp-Span-746">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-747">r</span><span class="MJXp-mo" id="MJXp-Span-748">)</span><span class="MJXp-mo" id="MJXp-Span-749">∈</span><span class="MJXp-mrow" id="MJXp-Span-750"><span class="MJXp-mi undefined" id="MJXp-Span-751">S</span></span></span></span></span><span class="MJXp-mrow" id="MJXp-Span-752"><span class="MJXp-mo" id="MJXp-Span-753" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-754">r</span><span class="MJXp-mo" id="MJXp-Span-755" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-756">l</span><span class="MJXp-mo" id="MJXp-Span-757" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-758">1</span><span class="MJXp-mo" id="MJXp-Span-759" style="margin-left: 0em; margin-right: 0em;">)</span></span><span class="MJXp-mo" id="MJXp-Span-760" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mn" id="MJXp-Span-761">2</span><span class="MJXp-mo" id="MJXp-Span-762" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mrow" id="MJXp-Span-763"><span class="MJXp-mrow" id="MJXp-Span-764"><span class="MJXp-TeXmathchoice" id="MJXp-Span-765"><span class="MJXp-mstyle" id="MJXp-Span-766"><span class="MJXp-mrow" id="MJXp-Span-767"><span class="MJXp-mo" id="MJXp-Span-768" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.083em;"><span class="MJXp-right MJXp-scale10" style="font-size: 1.333em; margin-left: 0.07em;">(</span></span></span></span></span><span class="MJXp-mfrac" id="MJXp-Span-769"><span class="MJXp-box MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-770"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-771">n</span></span></span><span class="MJXp-box" style="margin-top: -0.7em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-772"><span class="MJXp-mn" id="MJXp-Span-773">2</span></span></span></span></span></span></span><span class="MJXp-TeXmathchoice" id="MJXp-Span-774"><span class="MJXp-mstyle" id="MJXp-Span-775"><span class="MJXp-mrow" id="MJXp-Span-776"><span class="MJXp-mo" id="MJXp-Span-777" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.083em;"><span class="MJXp-right MJXp-scale10" style="font-size: 1.333em; margin-left: 0.07em;">)</span></span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-778" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-779">m</span></span></span><script type="math/tex" id="MathJax-Element-130">\sum_\limits{(u,d,l,r) \in \mathbb{S}} {(r-l+1)} \le 2 \cdot {{n}\choose{2}} \cdot m</script></p></li>   <li><p>For each covered cell <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-780"><span class="MJXp-mo" id="MJXp-Span-781" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-782">x</span><span class="MJXp-mo" id="MJXp-Span-783" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-784">y</span><span class="MJXp-mo" id="MJXp-Span-785" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-131">(x,y)</script> on the rectangle, there is at least one rectangle in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-786"><span class="MJXp-mrow" id="MJXp-Span-787"><span class="MJXp-mi undefined" id="MJXp-Span-788">S</span></span></span></span><script type="math/tex" id="MathJax-Element-132">\mathbb{S}</script> that covers <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-789"><span class="MJXp-mo" id="MJXp-Span-790" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-791">x</span><span class="MJXp-mo" id="MJXp-Span-792" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-793">y</span><span class="MJXp-mo" id="MJXp-Span-794" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-133">(x,y)</script> with minimum area.</p></li> </ul><p>Elements of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-795"><span class="MJXp-mrow" id="MJXp-Span-796"><span class="MJXp-mi undefined" id="MJXp-Span-797">S</span></span></span></span><script type="math/tex" id="MathJax-Element-134">\mathbb{S}</script> can be enumerated in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-798"><span class="MJXp-mrow" id="MJXp-Span-799"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-800">O</span></span><span class="MJXp-mo" id="MJXp-Span-801" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-802"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-803" style="margin-right: 0.05em;">n</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-804" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-805">m</span><span class="MJXp-mo" id="MJXp-Span-806" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-135">\mathcal{O}(n^2m)</script> time by the following algorithm:</p> <ul>   <li><p>For all pairs <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-807"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-808">u</span><span class="MJXp-mo" id="MJXp-Span-809" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-810">d</span></span></span><script type="math/tex" id="MathJax-Element-136">u,d</script> of rows, enumerate columns <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-811"><span class="MJXp-msubsup" id="MJXp-Span-812"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-813" style="margin-right: 0.05em;">i</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-814" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-815" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-816"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-817" style="margin-right: 0.05em;">i</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-818" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-819" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-820" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-821" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-822"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-823" style="margin-right: 0.05em;">i</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-824" style="vertical-align: -0.4em;">k</span></span></span></span><script type="math/tex" id="MathJax-Element-137">i_1,i_2,\ldots,i_k</script> such that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-825"><span class="MJXp-msubsup" id="MJXp-Span-826"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-827" style="margin-right: 0.05em;">G</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-828" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-829">u</span><span class="MJXp-mo" id="MJXp-Span-830">,</span><span class="MJXp-msubsup" id="MJXp-Span-831"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-832" style="margin-right: 0.05em;">i</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-833" style="vertical-align: -0.4em;">j</span></span></span></span><span class="MJXp-mo" id="MJXp-Span-834" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-835"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-836" style="margin-right: 0.05em;">G</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-837" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-838">d</span><span class="MJXp-mo" id="MJXp-Span-839">,</span><span class="MJXp-msubsup" id="MJXp-Span-840"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-841" style="margin-right: 0.05em;">i</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-842" style="vertical-align: -0.4em;">j</span></span></span></span></span></span><script type="math/tex" id="MathJax-Element-138">G_{u,i_j}=G_{d,i_j}</script> for all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-843"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-844">j</span></span></span><script type="math/tex" id="MathJax-Element-139">j</script>.</p></li>   <li><p>Then, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-845"><span class="MJXp-mo" id="MJXp-Span-846" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-847">u</span><span class="MJXp-mo" id="MJXp-Span-848" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-849">d</span><span class="MJXp-mo" id="MJXp-Span-850" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-851"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-852" style="margin-right: 0.05em;">i</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-853" style="vertical-align: -0.4em;">j</span></span><span class="MJXp-mo" id="MJXp-Span-854" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-855"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-856" style="margin-right: 0.05em;">i</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-857" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-858">j</span><span class="MJXp-mo" id="MJXp-Span-859">+</span><span class="MJXp-mn" id="MJXp-Span-860">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-861" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-140">(u,d,i_j,i_{j+1})</script> is an element of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-862"><span class="MJXp-mrow" id="MJXp-Span-863"><span class="MJXp-mi undefined" id="MJXp-Span-864">S</span></span></span></span><script type="math/tex" id="MathJax-Element-141">\mathbb{S}</script> for all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-865"><span class="MJXp-mn" id="MJXp-Span-866">1</span><span class="MJXp-mo" id="MJXp-Span-867" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-868">j</span><span class="MJXp-mo" id="MJXp-Span-869" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-870">k</span></span></span><script type="math/tex" id="MathJax-Element-142">1 \le j < k</script>.</p></li> </ul><p>It can be shown that the algorithm finds all elements of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-871"><span class="MJXp-mrow" id="MJXp-Span-872"><span class="MJXp-mi undefined" id="MJXp-Span-873">S</span></span></span></span><script type="math/tex" id="MathJax-Element-143">\mathbb{S}</script>.</p><p>Then, it suffices to propagate the area of each rectangle <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-874"><span class="MJXp-mo" id="MJXp-Span-875" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-876">u</span><span class="MJXp-mo" id="MJXp-Span-877" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-878">d</span><span class="MJXp-mo" id="MJXp-Span-879" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-880">l</span><span class="MJXp-mo" id="MJXp-Span-881" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-882">r</span><span class="MJXp-mo" id="MJXp-Span-883" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-884" style="margin-left: 0.333em; margin-right: 0.333em;">∈</span><span class="MJXp-mrow" id="MJXp-Span-885"><span class="MJXp-mi undefined" id="MJXp-Span-886">S</span></span></span></span><script type="math/tex" id="MathJax-Element-144">(u,d,l,r) \in \mathbb{S}</script> to all cells covered by it.</p><p>This can be done in multiple ways, but the simplest out of all such ways is keeping a range DP for each column and propagating the values based on <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-887"><span class="MJXp-mtext" id="MJXp-Span-888">dp</span><span class="MJXp-mo" id="MJXp-Span-889" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-890">u</span><span class="MJXp-mo" id="MJXp-Span-891" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-892" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-893">d</span><span class="MJXp-mo" id="MJXp-Span-894" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-895" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mtext" id="MJXp-Span-896">dp</span><span class="MJXp-mo" id="MJXp-Span-897" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-898">u</span><span class="MJXp-mo" id="MJXp-Span-899" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-900" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-901">d</span><span class="MJXp-mo" id="MJXp-Span-902" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-903">1</span><span class="MJXp-mo" id="MJXp-Span-904" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-145">\text{dp}[u][d] \le \text{dp}[u][d+1]</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-905"><span class="MJXp-mtext" id="MJXp-Span-906">dp</span><span class="MJXp-mo" id="MJXp-Span-907" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-908">u</span><span class="MJXp-mo" id="MJXp-Span-909" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-910" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-911">d</span><span class="MJXp-mo" id="MJXp-Span-912" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-913" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mtext" id="MJXp-Span-914">dp</span><span class="MJXp-mo" id="MJXp-Span-915" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-916">u</span><span class="MJXp-mo" id="MJXp-Span-917" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-918">1</span><span class="MJXp-mo" id="MJXp-Span-919" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-920" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-921">d</span><span class="MJXp-mo" id="MJXp-Span-922" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-146">\text{dp}[u][d] \le \text{dp}[u-1][d]</script>. Then, the value of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-923"><span class="MJXp-mtext" id="MJXp-Span-924">dp</span><span class="MJXp-mo" id="MJXp-Span-925" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-926">i</span><span class="MJXp-mo" id="MJXp-Span-927" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-928" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-929">i</span><span class="MJXp-mo" id="MJXp-Span-930" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-147">\text{dp}[i][i]</script> on column <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-931"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-932">j</span></span></span><script type="math/tex" id="MathJax-Element-148">j</script> becomes the answer for cell <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-933"><span class="MJXp-mo" id="MJXp-Span-934" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-935">i</span><span class="MJXp-mo" id="MJXp-Span-936" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-937">j</span><span class="MJXp-mo" id="MJXp-Span-938" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-149">(i,j)</script>.</p><p>Finally, the conditions satisfied by <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-939"><span class="MJXp-mrow" id="MJXp-Span-940"><span class="MJXp-mi undefined" id="MJXp-Span-941">S</span></span></span></span><script type="math/tex" id="MathJax-Element-150">\mathbb{S}</script> are also satisfied when the grid is transposed, so if <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-942"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-943">n</span><span class="MJXp-mo" id="MJXp-Span-944" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-945">m</span></span></span><script type="math/tex" id="MathJax-Element-151">n>m</script> you can simply compute the same way on the transposed grid. This gives us a solution with <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-953"><span class="MJXp-mrow" id="MJXp-Span-954"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-955">O</span></span><span class="MJXp-mo" id="MJXp-Span-956" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-957">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-958">m</span><span class="MJXp-mo" id="MJXp-Span-959" style="margin-left: 0.333em; margin-right: 0.333em;">min</span><span class="MJXp-mo" id="MJXp-Span-960" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-961">n</span><span class="MJXp-mo" id="MJXp-Span-962" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-963">m</span><span class="MJXp-mo" id="MJXp-Span-964" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-965" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-966" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mrow" id="MJXp-Span-967"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-968">O</span></span><span class="MJXp-mo" id="MJXp-Span-969" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-970">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-971">m</span><span class="MJXp-msqrt" id="MJXp-Span-972"><span class="MJXp-surd"><span style="font-size: 134%; margin-top: 0.104em;">√</span></span><span class="MJXp-root"><span class="MJXp-rule" style="border-top: 0.08em solid;"></span><span class="MJXp-box"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-973">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-974">m</span></span></span></span><span class="MJXp-mo" id="MJXp-Span-975" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-152">\mathcal{O}(nm \min(n,m))=\mathcal{O}(nm\sqrt{nm})</script> complexity.</p><p>Enumerating all elements of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-976"><span class="MJXp-mrow" id="MJXp-Span-977"><span class="MJXp-mi undefined" id="MJXp-Span-978">S</span></span></span></span><script type="math/tex" id="MathJax-Element-153">\mathbb{S}</script> and saving it in memory might take <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-979"><span class="MJXp-mrow" id="MJXp-Span-980"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-981">O</span></span><span class="MJXp-mo" id="MJXp-Span-982" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-983">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-984">m</span><span class="MJXp-mo" id="MJXp-Span-985" style="margin-left: 0.333em; margin-right: 0.333em;">min</span><span class="MJXp-mo" id="MJXp-Span-986" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-987">n</span><span class="MJXp-mo" id="MJXp-Span-988" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-989">m</span><span class="MJXp-mo" id="MJXp-Span-990" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-991" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-154">\mathcal{O}(nm \min(n,m))</script> memory, but it may still pass if sufficiently optimized. There is a way to modify the solution to use only <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-992"><span class="MJXp-mrow" id="MJXp-Span-993"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-994">O</span></span><span class="MJXp-mo" id="MJXp-Span-995" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mo" id="MJXp-Span-996" style="margin-left: 0.333em; margin-right: 0.333em;">min</span><span class="MJXp-mo" id="MJXp-Span-997" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-998">n</span><span class="MJXp-mo" id="MJXp-Span-999" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1000">m</span><span class="MJXp-mo" id="MJXp-Span-1001" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1002" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1003">n</span><span class="MJXp-mo" id="MJXp-Span-1004" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1005">m</span><span class="MJXp-mo" id="MJXp-Span-1006" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1007" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-155">\mathcal{O}(\min(n,m)(n+m))</script> memory, which is left as a practice for the reader.</p></div></div> <div class="spoiler"><b class="spoiler-title">Code (chromate00, O(min(n,m)(n+m)) memory)</b><div class="spoiler-content" style="display: block;"><p><a href="https://codeforces.com/contest/2159/submission/343541956" title="Submission 343541956 by chromate00">343541956</a></p></div></div><p><a href="https://codeforces.com/contest/2159/problem/C" title="Codeforces Round 1058 (Div. 1)">2159C - Twin Polynomials</a></p><p>Problem Credit: <a class="rated-user user-orange" href="https://codeforces.com/profile/wuhudsm" title="Master wuhudsm">wuhudsm</a></p> <div class="spoiler"><b class="spoiler-title">Rate the problem!</b><div class="spoiler-content" style="display: block;"><ul>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="12785">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="95">95</span>
            </i>
        </a>
    </span>


 Epic</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="12786">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="31">31</span>
            </i>
        </a>
    </span>


 Good</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="12787">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="22">22</span>
            </i>
        </a>
    </span>


 Moderate</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="12788">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="11">11</span>
            </i>
        </a>
    </span>


 Bad</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="12789">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="18">18</span>
            </i>
        </a>
    </span>


 Horrendous</li> </ul></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><p>Let's solve the easy version first: all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1008"><span class="MJXp-msubsup" id="MJXp-Span-1009"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1010" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1011" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1012" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-1013" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-1014">1</span></span></span><script type="math/tex" id="MathJax-Element-156">a_i = -1</script>.</p><p>We can convert the condition to: for <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1015"><span class="MJXp-mn" id="MJXp-Span-1016">0</span><span class="MJXp-mo" id="MJXp-Span-1017" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1018">i</span><span class="MJXp-mo" id="MJXp-Span-1019" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1020">n</span></span></span><script type="math/tex" id="MathJax-Element-157">0 \leq i \leq n</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1021"><span class="MJXp-msubsup" id="MJXp-Span-1022"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1023" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1024" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1025" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-1026"><span class="MJXp-mo" id="MJXp-Span-1027" style="margin-left: 0.111em; margin-right: 0.05em;">∑</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1028" style="vertical-align: -0.4em;"><span class="MJXp-msubsup" id="MJXp-Span-1029"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1030" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1031" style="vertical-align: -0.4em;">j</span></span><span class="MJXp-mo" id="MJXp-Span-1032">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1033">i</span></span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1034">j</span></span></span><script type="math/tex" id="MathJax-Element-158">a_i = \sum_{a_j=i} j</script>.</p><p>Since <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1035"><span class="MJXp-msubsup" id="MJXp-Span-1036"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1037" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1038" style="vertical-align: -0.4em;">0</span></span><span class="MJXp-mo" id="MJXp-Span-1039" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-1040" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-1041">1</span></span></span><script type="math/tex" id="MathJax-Element-159">a_0=-1</script>, we can only consider <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1042"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1043">j</span><span class="MJXp-mo" id="MJXp-Span-1044" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-mn" id="MJXp-Span-1045">0</span></span></span><script type="math/tex" id="MathJax-Element-160">j>0</script> and get <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1046"><span class="MJXp-msubsup" id="MJXp-Span-1047"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1048" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1049" style="vertical-align: -0.4em;">0</span></span><span class="MJXp-mo" id="MJXp-Span-1050" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-1051"><span class="MJXp-mo" id="MJXp-Span-1052" style="margin-left: 0.111em; margin-right: 0.05em;">∑</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1053" style="vertical-align: -0.4em;"><span class="MJXp-msubsup" id="MJXp-Span-1054"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1055" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1056" style="vertical-align: -0.4em;">j</span></span><span class="MJXp-mo" id="MJXp-Span-1057">=</span><span class="MJXp-mn" id="MJXp-Span-1058">0</span></span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1059">j</span></span></span><script type="math/tex" id="MathJax-Element-161">a_0 = \sum_{a_j=0}j</script> automatically.</p><p>We have a claim: for a cool polynomial and all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1060"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1061">i</span><span class="MJXp-mo" id="MJXp-Span-1062" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-mn" id="MJXp-Span-1063">0</span></span></span><script type="math/tex" id="MathJax-Element-162">i > 0</script>, there are only three cases:</p> <ul>   <li><p>Case <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1064"><span class="MJXp-mn" id="MJXp-Span-1065">1</span></span></span><script type="math/tex" id="MathJax-Element-163">1</script>: <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1066"><span class="MJXp-msubsup" id="MJXp-Span-1067"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1068" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1069" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1070" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-1071">0</span></span></span><script type="math/tex" id="MathJax-Element-164">a_i = 0</script>.</p></li>   <li><p>Case <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1072"><span class="MJXp-mn" id="MJXp-Span-1073">2</span></span></span><script type="math/tex" id="MathJax-Element-165">2</script>: <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1074"><span class="MJXp-msubsup" id="MJXp-Span-1075"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1076" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1077" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1078" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1079">i</span></span></span><script type="math/tex" id="MathJax-Element-166">a_i = i</script>.</p></li>   <li><p>Case <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1080"><span class="MJXp-mn" id="MJXp-Span-1081">3</span></span></span><script type="math/tex" id="MathJax-Element-167">3</script>: <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1082"><span class="MJXp-msubsup" id="MJXp-Span-1083"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1084" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1085" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1086" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1087">j</span></span></span><script type="math/tex" id="MathJax-Element-168">a_i = j</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1088"><span class="MJXp-msubsup" id="MJXp-Span-1089"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1090" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1091" style="vertical-align: -0.4em;">j</span></span><span class="MJXp-mo" id="MJXp-Span-1092" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1093">i</span></span></span><script type="math/tex" id="MathJax-Element-169">a_j = i</script>, where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1094"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1095">i</span><span class="MJXp-mo" id="MJXp-Span-1096" style="margin-left: 0.333em; margin-right: 0.333em;">≠</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1097">j</span></span></span><script type="math/tex" id="MathJax-Element-170">i \neq j</script>.</p></li> </ul> <div class="spoiler"><b class="spoiler-title">Proof</b><div class="spoiler-content" style="display: block;"><p>Use the method of proof by contradiction. Assuming a cool polynomial does not meet the above conditions.</p><p>Let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1098"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1099">m</span></span></span><script type="math/tex" id="MathJax-Element-171">m</script> be the minimum positive index not meeting the above three conditions.</p> <ul>   <li><p>If there is no index <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1100"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1101">j</span><span class="MJXp-mo" id="MJXp-Span-1102" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1103">m</span></span></span><script type="math/tex" id="MathJax-Element-172">j>m</script> satisfying <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1104"><span class="MJXp-msubsup" id="MJXp-Span-1105"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1106" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1107" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1108">j</span></span></span><span class="MJXp-mo" id="MJXp-Span-1109" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1110">m</span></span></span><script type="math/tex" id="MathJax-Element-173">a_{j} = m</script>, we get <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1111"><span class="MJXp-msubsup" id="MJXp-Span-1112"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1113" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1114" style="vertical-align: -0.4em;">m</span></span><span class="MJXp-mo" id="MJXp-Span-1115" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-1116">0</span></span></span><script type="math/tex" id="MathJax-Element-174">a_m=0</script> or <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1117"><span class="MJXp-msubsup" id="MJXp-Span-1118"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1119" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1120" style="vertical-align: -0.4em;">m</span></span><span class="MJXp-mo" id="MJXp-Span-1121" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1122">m</span></span></span><script type="math/tex" id="MathJax-Element-175">a_m=m</script>, which meets condition <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1123"><span class="MJXp-mn" id="MJXp-Span-1124">1</span></span></span><script type="math/tex" id="MathJax-Element-176">1</script> or <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1125"><span class="MJXp-mn" id="MJXp-Span-1126">2</span></span></span><script type="math/tex" id="MathJax-Element-177">2</script>.</p></li>   <li><p>If there is only one index <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1127"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1128">j</span><span class="MJXp-mo" id="MJXp-Span-1129" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1130">m</span></span></span><script type="math/tex" id="MathJax-Element-178">j>m</script> satisfying <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1131"><span class="MJXp-msubsup" id="MJXp-Span-1132"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1133" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1134" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1135">j</span></span></span><span class="MJXp-mo" id="MJXp-Span-1136" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1137">m</span></span></span><script type="math/tex" id="MathJax-Element-179">a_{j} = m</script>, we get <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1138"><span class="MJXp-msubsup" id="MJXp-Span-1139"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1140" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1141" style="vertical-align: -0.4em;">m</span></span><span class="MJXp-mo" id="MJXp-Span-1142" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1143">j</span></span></span><script type="math/tex" id="MathJax-Element-180">a_m=j</script>, which meets condition <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1144"><span class="MJXp-mn" id="MJXp-Span-1145">3</span></span></span><script type="math/tex" id="MathJax-Element-181">3</script>.</p></li>   <li><p>If there two indices <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1146"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1147">j</span><span class="MJXp-mo" id="MJXp-Span-1148" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1149">k</span><span class="MJXp-mo" id="MJXp-Span-1150" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1151">m</span></span></span><script type="math/tex" id="MathJax-Element-182">j,k>m</script> such that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1152"><span class="MJXp-msubsup" id="MJXp-Span-1153"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1154" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1155" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1156">j</span></span></span><span class="MJXp-mo" id="MJXp-Span-1157" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1158">m</span></span></span><script type="math/tex" id="MathJax-Element-183">a_{j} = m</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1159"><span class="MJXp-msubsup" id="MJXp-Span-1160"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1161" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1162" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1163">k</span></span></span><span class="MJXp-mo" id="MJXp-Span-1164" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1165">m</span></span></span><script type="math/tex" id="MathJax-Element-184">a_{k} = m</script>. We can get some indices <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1166"><span class="MJXp-msubsup" id="MJXp-Span-1167"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1168" style="margin-right: 0.05em;">x</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1169" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-1170" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1171"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1172" style="margin-right: 0.05em;">x</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1173" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1174" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-1175" style="margin-left: 0em; margin-right: 0.222em;">.</span><span class="MJXp-mo" id="MJXp-Span-1176" style="margin-left: 0em; margin-right: 0.222em;">.</span><span class="MJXp-mo" id="MJXp-Span-1177" style="margin-left: 0em; margin-right: 0.222em;">.</span></span></span><script type="math/tex" id="MathJax-Element-185">x_1,x_2,...</script> satisying <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1178"><span class="MJXp-mo" id="MJXp-Span-1179" style="margin-left: 0.111em; margin-right: 0.167em;">∑</span><span class="MJXp-msubsup" id="MJXp-Span-1180"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1181" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1182" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1183" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1184">m</span></span></span><script type="math/tex" id="MathJax-Element-186">\sum x_i=m</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1185"><span class="MJXp-msubsup" id="MJXp-Span-1186"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1187" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1188" style="vertical-align: -0.4em;"><span class="MJXp-msubsup" id="MJXp-Span-1189"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1190" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1191" style="vertical-align: -0.4em;">i</span></span></span></span><span class="MJXp-mo" id="MJXp-Span-1192" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1193">j</span></span></span><script type="math/tex" id="MathJax-Element-187">a_{x_i}=j</script>, and some indices <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1194"><span class="MJXp-msubsup" id="MJXp-Span-1195"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1196" style="margin-right: 0.05em;">y</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1197" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-1198" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1199"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1200" style="margin-right: 0.05em;">y</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1201" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1202" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-1203" style="margin-left: 0em; margin-right: 0.222em;">.</span><span class="MJXp-mo" id="MJXp-Span-1204" style="margin-left: 0em; margin-right: 0.222em;">.</span><span class="MJXp-mo" id="MJXp-Span-1205" style="margin-left: 0em; margin-right: 0.222em;">.</span></span></span><script type="math/tex" id="MathJax-Element-188">y_1,y_2,...</script> satisying <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1206"><span class="MJXp-mo" id="MJXp-Span-1207" style="margin-left: 0.111em; margin-right: 0.167em;">∑</span><span class="MJXp-msubsup" id="MJXp-Span-1208"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1209" style="margin-right: 0.05em;">y</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1210" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1211" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1212">m</span></span></span><script type="math/tex" id="MathJax-Element-189">\sum y_i=m</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1213"><span class="MJXp-msubsup" id="MJXp-Span-1214"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1215" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1216" style="vertical-align: -0.4em;"><span class="MJXp-msubsup" id="MJXp-Span-1217"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1218" style="margin-right: 0.05em;">y</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1219" style="vertical-align: -0.4em;">i</span></span></span></span><span class="MJXp-mo" id="MJXp-Span-1220" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1221">k</span></span></span><script type="math/tex" id="MathJax-Element-190">a_{y_i}=k</script>. This contradicts the fact that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1222"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1223">m</span></span></span><script type="math/tex" id="MathJax-Element-191">m</script> is the minimum positive index not meeting the above three conditions. In other words, you can not find such indices <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1224"><span class="MJXp-msubsup" id="MJXp-Span-1225"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1226" style="margin-right: 0.05em;">x</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1227" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-1228" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1229"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1230" style="margin-right: 0.05em;">x</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1231" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1232" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-1233" style="margin-left: 0em; margin-right: 0.222em;">.</span><span class="MJXp-mo" id="MJXp-Span-1234" style="margin-left: 0em; margin-right: 0.222em;">.</span><span class="MJXp-mo" id="MJXp-Span-1235" style="margin-left: 0em; margin-right: 0.222em;">.</span></span></span><script type="math/tex" id="MathJax-Element-192">x_1,x_2,...</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1236"><span class="MJXp-msubsup" id="MJXp-Span-1237"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1238" style="margin-right: 0.05em;">y</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1239" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-1240" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1241"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1242" style="margin-right: 0.05em;">y</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1243" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1244" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-1245" style="margin-left: 0em; margin-right: 0em;">…</span></span></span><script type="math/tex" id="MathJax-Element-193">y_1,y_2,\ldots</script></p></li>   <li><p>For more indices, the proof is the same as above.</p></li> </ul></div></div><p>Thus, we can write an easy DP:</p><p><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1246"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1247">d</span><span class="MJXp-msubsup" id="MJXp-Span-1248"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1249" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1250" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1251" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-1252">2</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1253">d</span><span class="MJXp-msubsup" id="MJXp-Span-1254"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1255" style="margin-right: 0.05em;">p</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1256" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1257">i</span><span class="MJXp-mo" id="MJXp-Span-1258">−</span><span class="MJXp-mn" id="MJXp-Span-1259">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-1260" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mo" id="MJXp-Span-1261" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1262">i</span><span class="MJXp-mo" id="MJXp-Span-1263" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-1264">1</span><span class="MJXp-mo" id="MJXp-Span-1265" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1266">d</span><span class="MJXp-msubsup" id="MJXp-Span-1267"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1268" style="margin-right: 0.05em;">p</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1269" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1270">i</span><span class="MJXp-mo" id="MJXp-Span-1271">−</span><span class="MJXp-mn" id="MJXp-Span-1272">2</span></span></span></span></span><script type="math/tex" id="MathJax-Element-194">dp_i=2dp_{i−1}+(i−1)dp_{i−2}</script></p><p>Now, let’s return to the original problem. For all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1273"><span class="MJXp-msubsup" id="MJXp-Span-1274"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1275" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1276" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1277" style="margin-left: 0.333em; margin-right: 0.333em;">≠</span><span class="MJXp-mo" id="MJXp-Span-1278" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-1279">1</span></span></span><script type="math/tex" id="MathJax-Element-195">a_i \neq -1</script>, we need to check whether they form "valid coefficients"(if the coefficients can represent at least one cool polynomial). After that, the problem reduces to the easy version.</p><p>There are several ways to check validity. Cases <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1280"><span class="MJXp-mn" id="MJXp-Span-1281">1</span></span></span><script type="math/tex" id="MathJax-Element-196">1</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1282"><span class="MJXp-mn" id="MJXp-Span-1283">2</span></span></span><script type="math/tex" id="MathJax-Element-197">2</script> are trivial. For Case <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1284"><span class="MJXp-mn" id="MJXp-Span-1285">3</span></span></span><script type="math/tex" id="MathJax-Element-198">3</script>, we can use DSU to merge <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1286"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1287">i</span></span></span><script type="math/tex" id="MathJax-Element-199">i</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1288"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1289">j</span></span></span><script type="math/tex" id="MathJax-Element-200">j</script>, and then check the size of each connected component.</p></div></div> <div class="spoiler"><b class="spoiler-title">Code (wuhudsm)</b><div class="spoiler-content" style="display: block;"><p><a href="https://codeforces.com/contest/2159/submission/343542108" title="Submission 343542108 by chromate00">343542108</a></p></div></div><p><a href="https://codeforces.com/contest/2159/problem/D1" title="Codeforces Round 1058 (Div. 1)">2159D1 - Inverse Minimum Partition (Easy Version)</a>, <a href="https://codeforces.com/contest/2159/problem/D2" title="Codeforces Round 1058 (Div. 1)">2159D2 - Inverse Minimum Partition (Hard Version)</a></p><p>Problem Credit: <a class="rated-user user-blue" href="https://codeforces.com/profile/chromate00" title="Expert chromate00">chromate00</a>, <a class="rated-user user-orange" href="https://codeforces.com/profile/wuhudsm" title="Master wuhudsm">wuhudsm</a>; Special Thanks: <a class="rated-user user-violet" href="https://codeforces.com/profile/satyam343" title="Candidate Master satyam343">satyam343</a></p> <div class="spoiler"><b class="spoiler-title">Rate the problem!</b><div class="spoiler-content" style="display: block;"><ul>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="12751">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="112">112</span>
            </i>
        </a>
    </span>


 Epic</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="12752">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="5">5</span>
            </i>
        </a>
    </span>


 Good</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="12753">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="6">6</span>
            </i>
        </a>
    </span>


 Moderate</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="12754">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="7">7</span>
            </i>
        </a>
    </span>


 Bad</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="12755">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="10">10</span>
            </i>
        </a>
    </span>


 Horrendous</li> </ul></div></div><p>This problem's editorial will be divided into parts. You may need to read all of them to understand the full picture.</p> <div class="spoiler"><b class="spoiler-title">Part 1</b><div class="spoiler-content" style="display: block;"><p>For this problem there exist two versions of a core observation required for solutions:</p> <ul>   <li>When you discard all elements other than suffix minimums, the optimal total cost does not change. (1.a)</li>   <li>Denoting optimal total cost for sequence <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1290"><span class="MJXp-msubsup" id="MJXp-Span-1291"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1292" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1293" style="vertical-align: -0.4em;">l</span></span><span class="MJXp-mo" id="MJXp-Span-1294" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1295"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1296" style="margin-right: 0.05em;">b</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1297" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1298">l</span><span class="MJXp-mo" id="MJXp-Span-1299">+</span><span class="MJXp-mn" id="MJXp-Span-1300">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-1301" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-1302" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-1303" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1304"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1305" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1306" style="vertical-align: -0.4em;">r</span></span></span></span><script type="math/tex" id="MathJax-Element-201">b_l,b_{l+1},\ldots,b_r</script> as <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1307"><span class="MJXp-mi" id="MJXp-Span-1308">opt</span><span class="MJXp-mo" id="MJXp-Span-1309" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-1310" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1311">l</span><span class="MJXp-mo" id="MJXp-Span-1312" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1313">r</span><span class="MJXp-mo" id="MJXp-Span-1314" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-202">\operatorname{opt}(l,r)</script>, it can be shown that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1315"><span class="MJXp-mi" id="MJXp-Span-1316">opt</span><span class="MJXp-mo" id="MJXp-Span-1317" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-1318" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1319">l</span><span class="MJXp-mo" id="MJXp-Span-1320" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-1321">1</span><span class="MJXp-mo" id="MJXp-Span-1322" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1323">r</span><span class="MJXp-mo" id="MJXp-Span-1324" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1325" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mi" id="MJXp-Span-1326">opt</span><span class="MJXp-mo" id="MJXp-Span-1327" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-1328" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1329">l</span><span class="MJXp-mo" id="MJXp-Span-1330" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1331">r</span><span class="MJXp-mo" id="MJXp-Span-1332" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-203">\operatorname{opt}(l-1,r) \ge \operatorname{opt}(l,r)</script> for all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1333"><span class="MJXp-mn" id="MJXp-Span-1334">1</span><span class="MJXp-mo" id="MJXp-Span-1335" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1336">l</span><span class="MJXp-mo" id="MJXp-Span-1337" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1338">r</span><span class="MJXp-mo" id="MJXp-Span-1339" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1340">n</span></span></span><script type="math/tex" id="MathJax-Element-204">1 < l \le r \le n</script>. (1.b)</li> </ul><p>(1.a) can be shown by exchange arguments. Assume a partition consists mainly of two subarrays (and some irrelevant others), <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1341"><span class="MJXp-mo" id="MJXp-Span-1342" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mo" id="MJXp-Span-1343" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-1344" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-1345" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-msubsup" id="MJXp-Span-1346"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1347" style="margin-right: 0.05em;">x</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1348" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-1349" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-1350" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-1351" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1352"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1353" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1354" style="vertical-align: -0.4em;">p</span></span><span class="MJXp-mo" id="MJXp-Span-1355" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1356" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-1357" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-1358" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-1359" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-msubsup" id="MJXp-Span-1360"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1361" style="margin-right: 0.05em;">y</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1362" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-1363" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-1364" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-1365" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1366"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1367" style="margin-right: 0.05em;">y</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1368" style="vertical-align: -0.4em;">q</span></span><span class="MJXp-mo" id="MJXp-Span-1369" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-1370" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-1371" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1372"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1373" style="margin-right: 0.05em;">y</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1374" style="vertical-align: -0.4em;">r</span></span><span class="MJXp-mo" id="MJXp-Span-1375" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1376" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-1377" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-1378" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-205">[\dots,[x_1,\dots,x_p],\dots,[y_1,\dots,y_q,\dots,y_r],\dots]</script>. Then, if <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1379"><span class="MJXp-msubsup" id="MJXp-Span-1380"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1381" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1382" style="vertical-align: -0.4em;">p</span></span><span class="MJXp-mo" id="MJXp-Span-1383" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-msubsup" id="MJXp-Span-1384"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1385" style="margin-right: 0.05em;">y</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1386" style="vertical-align: -0.4em;">q</span></span></span></span><script type="math/tex" id="MathJax-Element-206">x_p \ge y_q</script>, you can find a partition <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1387"><span class="MJXp-mo" id="MJXp-Span-1388" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mo" id="MJXp-Span-1389" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-1390" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-1391" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-msubsup" id="MJXp-Span-1392"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1393" style="margin-right: 0.05em;">x</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1394" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-1395" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-1396" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-1397" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1398"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1399" style="margin-right: 0.05em;">y</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1400" style="vertical-align: -0.4em;">q</span></span><span class="MJXp-mo" id="MJXp-Span-1401" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1402" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-1403" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-msubsup" id="MJXp-Span-1404"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1405" style="margin-right: 0.05em;">y</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1406" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1407">q</span><span class="MJXp-mo" id="MJXp-Span-1408">+</span><span class="MJXp-mn" id="MJXp-Span-1409">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-1410" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-1411" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-1412" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1413"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1414" style="margin-right: 0.05em;">y</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1415" style="vertical-align: -0.4em;">r</span></span><span class="MJXp-mo" id="MJXp-Span-1416" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1417" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-1418" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-1419" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-207">[\dots,[x_1,\dots,y_q],[y_{q+1},\dots,y_r],\dots]</script> which is at least good as the original one. Likewise, if <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1420"><span class="MJXp-msubsup" id="MJXp-Span-1421"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1422" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1423" style="vertical-align: -0.4em;">p</span></span><span class="MJXp-mo" id="MJXp-Span-1424" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-msubsup" id="MJXp-Span-1425"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1426" style="margin-right: 0.05em;">y</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1427" style="vertical-align: -0.4em;">r</span></span></span></span><script type="math/tex" id="MathJax-Element-208">x_p \ge y_r</script>, you can find a partition <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1428"><span class="MJXp-mo" id="MJXp-Span-1429" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mo" id="MJXp-Span-1430" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-1431" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-1432" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-msubsup" id="MJXp-Span-1433"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1434" style="margin-right: 0.05em;">x</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1435" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-1436" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-1437" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-1438" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1439"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1440" style="margin-right: 0.05em;">y</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1441" style="vertical-align: -0.4em;">r</span></span><span class="MJXp-mo" id="MJXp-Span-1442" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1443" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-1444" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-1445" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-209">[\dots,[x_1,\dots,y_r],\dots]</script> which is at least as good as the original one. Repeating this exchange process on any "optimal" partition, you will now have another "optimal" partition whose endpoints all belong to suffix minimums. And because then the denominator of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1446"><span class="MJXp-mrow" id="MJXp-Span-1447"><span class="MJXp-mi MJXp-mono" id="MJXp-Span-1448">c</span><span class="MJXp-mi MJXp-mono" id="MJXp-Span-1449">o</span><span class="MJXp-mi MJXp-mono" id="MJXp-Span-1450">s</span><span class="MJXp-mi MJXp-mono" id="MJXp-Span-1451">t</span></span></span></span><script type="math/tex" id="MathJax-Element-210">\mathtt{cost}</script> will always lie on a suffix minimum, you can discard all of the rest without changing the total cost.</p><p>(1.b) can be shown much easier. Consider the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1452"><span class="MJXp-mrow" id="MJXp-Span-1453"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-1454">O</span></span><span class="MJXp-mo" id="MJXp-Span-1455" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1456"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1457" style="margin-right: 0.05em;">n</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1458" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1459" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-211">\mathcal{O}(n^2)</script> algorithm to compute <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1460"><span class="MJXp-mi" id="MJXp-Span-1461">opt</span></span></span><script type="math/tex" id="MathJax-Element-212">\operatorname{opt}</script>. We know that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1462"><span class="MJXp-mi" id="MJXp-Span-1463">opt</span><span class="MJXp-mo" id="MJXp-Span-1464" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-1465" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1466">l</span><span class="MJXp-mo" id="MJXp-Span-1467" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1468">r</span><span class="MJXp-mo" id="MJXp-Span-1469" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1470" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-munderover" id="MJXp-Span-1471"><span><span class="MJXp-over"><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-1477" style="margin-right: 0px; margin-left: 0px;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1478">r</span></span></span><span class=""><span class="MJXp-mo" id="MJXp-Span-1472" style="margin-left: 0.333em; margin-right: 0.333em;">min</span></span></span></span><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-1473" style="margin-left: 0px;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1474">i</span><span class="MJXp-mo" id="MJXp-Span-1475">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1476">l</span></span></span></span><span class="MJXp-mrow" id="MJXp-Span-1479"><span class="MJXp-mo" id="MJXp-Span-1480" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi" id="MJXp-Span-1481">opt</span><span class="MJXp-mo" id="MJXp-Span-1482" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-1483" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1484">i</span><span class="MJXp-mo" id="MJXp-Span-1485" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-1486">1</span><span class="MJXp-mo" id="MJXp-Span-1487" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1488">r</span><span class="MJXp-mo" id="MJXp-Span-1489" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1490" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1491">c</span><span class="MJXp-mo" id="MJXp-Span-1492" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1493">l</span><span class="MJXp-mo" id="MJXp-Span-1494" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1495">i</span><span class="MJXp-mo" id="MJXp-Span-1496" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1497" style="margin-left: 0em; margin-right: 0em;">)</span></span></span></span><script type="math/tex" id="MathJax-Element-213">\operatorname{opt}(l,r)=\min\limits_{i=l}^{r}{(\operatorname{opt}(i+1,r)+c[l,i])}</script> where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1498"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1499">c</span><span class="MJXp-mo" id="MJXp-Span-1500" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1501">l</span><span class="MJXp-mo" id="MJXp-Span-1502" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1503">r</span><span class="MJXp-mo" id="MJXp-Span-1504" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1505" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mn" id="MJXp-Span-1506">0</span></span></span><script type="math/tex" id="MathJax-Element-214">c[l,r]\ge 0</script> for all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1507"><span class="MJXp-mn" id="MJXp-Span-1508">1</span><span class="MJXp-mo" id="MJXp-Span-1509" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1510">l</span><span class="MJXp-mo" id="MJXp-Span-1511" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1512">r</span><span class="MJXp-mo" id="MJXp-Span-1513" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1514">n</span></span></span><script type="math/tex" id="MathJax-Element-215">1 \le l \le r \le n</script>. Also, observe <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1515"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1516">c</span><span class="MJXp-mo" id="MJXp-Span-1517" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1518">l</span><span class="MJXp-mo" id="MJXp-Span-1519" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1520">r</span><span class="MJXp-mo" id="MJXp-Span-1521" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1522" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1523">c</span><span class="MJXp-mo" id="MJXp-Span-1524" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1525">l</span><span class="MJXp-mo" id="MJXp-Span-1526" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-1527">1</span><span class="MJXp-mo" id="MJXp-Span-1528" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1529">r</span><span class="MJXp-mo" id="MJXp-Span-1530" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-216">c[l,r] \ge c[l+1,r]</script> for all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1531"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1532">l</span><span class="MJXp-mo" id="MJXp-Span-1533" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1534">r</span></span></span><script type="math/tex" id="MathJax-Element-217">l < r</script>. As all terms that constitute the minimum possible value of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1535"><span class="MJXp-mi" id="MJXp-Span-1536">opt</span><span class="MJXp-mo" id="MJXp-Span-1537" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-1538" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1539">l</span><span class="MJXp-mo" id="MJXp-Span-1540" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1541">r</span><span class="MJXp-mo" id="MJXp-Span-1542" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-218">\operatorname{opt}(l,r)</script> are no less than that of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1543"><span class="MJXp-mi" id="MJXp-Span-1544">opt</span><span class="MJXp-mo" id="MJXp-Span-1545" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-1546" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1547">l</span><span class="MJXp-mo" id="MJXp-Span-1548" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-1549">1</span><span class="MJXp-mo" id="MJXp-Span-1550" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1551">r</span><span class="MJXp-mo" id="MJXp-Span-1552" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-219">\operatorname{opt}(l+1,r)</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1553"><span class="MJXp-mi" id="MJXp-Span-1554">opt</span><span class="MJXp-mo" id="MJXp-Span-1555" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-1556" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1557">l</span><span class="MJXp-mo" id="MJXp-Span-1558" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1559">r</span><span class="MJXp-mo" id="MJXp-Span-1560" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1561" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mi" id="MJXp-Span-1562">opt</span><span class="MJXp-mo" id="MJXp-Span-1563" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-1564" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1565">l</span><span class="MJXp-mo" id="MJXp-Span-1566" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-1567">1</span><span class="MJXp-mo" id="MJXp-Span-1568" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1569">r</span><span class="MJXp-mo" id="MJXp-Span-1570" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-220">\operatorname{opt}(l,r) \ge \operatorname{opt}(l+1,r)</script> indeed does hold.</p><p>Both observations hold similar implications, and all subsequent observations for subtask 1 can be shown for both observations. While (1.a) is much convenient for implementing the solution for subtask 1, we will prove all subsequent observations using (1.b) because it will be reused in subtask 2 also.</p><p>We give you <strong>three</strong> solutions to solve subtask 1, <strong>two</strong> of which are helpful in solving subtask 2, while <strong>the other one</strong> is not.</p></div></div> <div class="spoiler"><b class="spoiler-title">Part 2.1</b><div class="spoiler-content" style="display: block;"><p>For the first solution of subtask 1, we show the following.</p> <ul>   <li>The optimal total cost is no greater than <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1571"><span class="MJXp-mn" id="MJXp-Span-1572">2</span><span class="MJXp-msubsup" id="MJXp-Span-1573"><span class="MJXp-mi" id="MJXp-Span-1574" style="margin-right: 0.05em;">log</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1575" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1576" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-1577" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1578"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1579" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1580" style="vertical-align: -0.4em;">n</span></span><span class="MJXp-mo" id="MJXp-Span-1581" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-221">2\log_2(a_n)</script>. (2.1.a)</li> </ul><p>We will show this by an <strong>approximate algorithm</strong> that constructs a partition that might be suboptimal.</p><p>Consider the following method to partition the sequence.</p><p>Starting from the last element of the sequence, we expand the left border of the leftmost subarray greedily:</p> <ul>   <li>If it is possible to use a subarray of cost <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1582"><span class="MJXp-mn" id="MJXp-Span-1583">2</span></span></span><script type="math/tex" id="MathJax-Element-222">2</script>, then do use it.</li>   <li>Otherwise, use a subarray of cost <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1584"><span class="MJXp-mn" id="MJXp-Span-1585">1</span></span></span><script type="math/tex" id="MathJax-Element-223">1</script>.</li> </ul><p>In either event, the rightmost element of the leftmost subarray must be strictly less than the one on the previous leftmost subarray. By contradiction, this event cannot happen more than <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1586"><span class="MJXp-msubsup" id="MJXp-Span-1587"><span class="MJXp-mi" id="MJXp-Span-1588" style="margin-right: 0.05em;">log</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1589" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1590" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-1591" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1592"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1593" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1594" style="vertical-align: -0.4em;">n</span></span><span class="MJXp-mo" id="MJXp-Span-1595" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-224">\log_2(a_n)</script> times. As we only used subarrays of cost no greater than <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1596"><span class="MJXp-mn" id="MJXp-Span-1597">2</span></span></span><script type="math/tex" id="MathJax-Element-225">2</script>, this algorithm always constructs a partition with total cost no greater than <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1598"><span class="MJXp-mn" id="MJXp-Span-1599">2</span><span class="MJXp-msubsup" id="MJXp-Span-1600"><span class="MJXp-mi" id="MJXp-Span-1601" style="margin-right: 0.05em;">log</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1602" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1603" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-1604" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1605"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1606" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1607" style="vertical-align: -0.4em;">n</span></span><span class="MJXp-mo" id="MJXp-Span-1608" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-226">2 \log_2(a_n)</script>.</p><p>As now we know that the optimal total cost is no greater than <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1609"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1610">C</span><span class="MJXp-mo" id="MJXp-Span-1611" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-1612">128</span><span class="MJXp-mo" id="MJXp-Span-1613" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mn" id="MJXp-Span-1614">2</span><span class="MJXp-msubsup" id="MJXp-Span-1615"><span class="MJXp-mi" id="MJXp-Span-1616" style="margin-right: 0.05em;">log</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1617" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1618" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-1619" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1620"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1621" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1622" style="vertical-align: -0.4em;">n</span></span><span class="MJXp-mo" id="MJXp-Span-1623" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-227">C = 128 \ge 2 \log_2(a_n)</script>, we can optimize the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1624"><span class="MJXp-mrow" id="MJXp-Span-1625"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-1626">O</span></span><span class="MJXp-mo" id="MJXp-Span-1627" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1628"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1629" style="margin-right: 0.05em;">n</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1630" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1631" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-228">\mathcal{O}(n^2)</script> DP into a solution that resembles two-pointers, but we will use <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1632"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1633">C</span></span></span><script type="math/tex" id="MathJax-Element-229">C</script> pointers on one side for each possible cost. This is possible due to the monotonicity that we proved either as a corollary of (1.a) or by (1.b).</p><p>This solution has a time complexity of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1634"><span class="MJXp-mrow" id="MJXp-Span-1635"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-1636">O</span></span><span class="MJXp-mo" id="MJXp-Span-1637" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1638">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1639">C</span><span class="MJXp-mo" id="MJXp-Span-1640" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1641" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mrow" id="MJXp-Span-1642"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-1643">O</span></span><span class="MJXp-mo" id="MJXp-Span-1644" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1645">n</span><span class="MJXp-mi" id="MJXp-Span-1646">log</span><span class="MJXp-mo" id="MJXp-Span-1647" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1648">a</span><span class="MJXp-mo" id="MJXp-Span-1649" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-230">\mathcal{O}(nC)=\mathcal{O}(n \log a)</script>.</p></div></div> <div class="spoiler"><b class="spoiler-title">Part 2.2</b><div class="spoiler-content" style="display: block;"><p>For the second solution of the first subtask, we show the following.</p> <ul>   <li>There is always an optimal solution which <strong>only uses subarrays with cost at most <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1650"><span class="MJXp-mn" id="MJXp-Span-1651">3</span></span></span><script type="math/tex" id="MathJax-Element-231">3</script>.</strong> (2.2.a)</li> </ul><p>We will show this by exchange arguments.</p><p>Observe that for any <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1652"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1653">X</span><span class="MJXp-mo" id="MJXp-Span-1654" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mn" id="MJXp-Span-1655">4</span></span></span><script type="math/tex" id="MathJax-Element-232">X \ge 4</script> there exists a pair of integers <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1656"><span class="MJXp-mo" id="MJXp-Span-1657" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1658">x</span><span class="MJXp-mo" id="MJXp-Span-1659" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1660">y</span><span class="MJXp-mo" id="MJXp-Span-1661" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-233">(x,y)</script> that satisfies the following conditions:</p> <ul>   <li><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1662"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1663">x</span><span class="MJXp-mo" id="MJXp-Span-1664" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1665">y</span><span class="MJXp-mo" id="MJXp-Span-1666" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1667">X</span></span></span><script type="math/tex" id="MathJax-Element-234">x \cdot y \ge X</script></li>   <li><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1668"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1669">x</span><span class="MJXp-mo" id="MJXp-Span-1670" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1671">y</span><span class="MJXp-mo" id="MJXp-Span-1672" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1673">X</span></span></span><script type="math/tex" id="MathJax-Element-235">x + y \le X</script></li>   <li><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1674"><span class="MJXp-mn" id="MJXp-Span-1675">1</span><span class="MJXp-mo" id="MJXp-Span-1676" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1677">x</span><span class="MJXp-mo" id="MJXp-Span-1678" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1679">y</span><span class="MJXp-mo" id="MJXp-Span-1680" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1681">X</span></span></span><script type="math/tex" id="MathJax-Element-236">1 \le x,y < X</script></li> </ul><p>The proof for the above is simple; <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1682"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1683">x</span><span class="MJXp-mo" id="MJXp-Span-1684" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mrow" id="MJXp-Span-1685"><span class="MJXp-mo" id="MJXp-Span-1686" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.5em;"><span class="MJXp-right MJXp-scale5" style="font-size: 3em; margin-left: -0.18em;">⌈</span></span><span class="MJXp-mrow" id="MJXp-Span-1687"><span class="MJXp-mfrac" id="MJXp-Span-1688" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1689">X</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mn" id="MJXp-Span-1690">2</span></span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-1691" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.5em;"><span class="MJXp-right MJXp-scale5" style="font-size: 3em; margin-left: -0.18em;">⌉</span></span></span></span></span><script type="math/tex" id="MathJax-Element-237">x=\left \lceil {\frac{X}{2}}\right \rceil</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1692"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1693">y</span><span class="MJXp-mo" id="MJXp-Span-1694" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-1695">2</span></span></span><script type="math/tex" id="MathJax-Element-238">y=2</script> satisfies the conditions for all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1696"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1697">X</span><span class="MJXp-mo" id="MJXp-Span-1698" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mn" id="MJXp-Span-1699">4</span></span></span><script type="math/tex" id="MathJax-Element-239">X \ge 4</script>. Then, it is possible to divide a subarray <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1700"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1701">A</span></span></span><script type="math/tex" id="MathJax-Element-240">A</script> into two subarrays <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1702"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1703">P</span></span></span><script type="math/tex" id="MathJax-Element-241">P</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1704"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1705">Q</span></span></span><script type="math/tex" id="MathJax-Element-242">Q</script> such that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1706"><span class="MJXp-mrow" id="MJXp-Span-1707"><span class="MJXp-mi MJXp-mono" id="MJXp-Span-1708">c</span><span class="MJXp-mi MJXp-mono" id="MJXp-Span-1709">o</span><span class="MJXp-mi MJXp-mono" id="MJXp-Span-1710">s</span><span class="MJXp-mi MJXp-mono" id="MJXp-Span-1711">t</span></span><span class="MJXp-mo" id="MJXp-Span-1712" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1713">P</span><span class="MJXp-mo" id="MJXp-Span-1714" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1715" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1716">x</span></span></span><script type="math/tex" id="MathJax-Element-243">\mathtt{cost}(P) \le x</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1717"><span class="MJXp-mrow" id="MJXp-Span-1718"><span class="MJXp-mi MJXp-mono" id="MJXp-Span-1719">c</span><span class="MJXp-mi MJXp-mono" id="MJXp-Span-1720">o</span><span class="MJXp-mi MJXp-mono" id="MJXp-Span-1721">s</span><span class="MJXp-mi MJXp-mono" id="MJXp-Span-1722">t</span></span><span class="MJXp-mo" id="MJXp-Span-1723" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1724">Q</span><span class="MJXp-mo" id="MJXp-Span-1725" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1726" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1727">y</span></span></span><script type="math/tex" id="MathJax-Element-244">\mathtt{cost}(Q) \le y</script>. Formally, assume a subarray <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1728"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1729">A</span><span class="MJXp-mo" id="MJXp-Span-1730" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-1731" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-msubsup" id="MJXp-Span-1732"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1733" style="margin-right: 0.05em;">A</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1734" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-1735" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1736"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1737" style="margin-right: 0.05em;">A</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1738" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1739" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-1740" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-1741" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1742"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1743" style="margin-right: 0.05em;">A</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1744" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-mo" id="MJXp-Span-1745" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-245">A=[A_1,A_2,\ldots,A_k]</script> where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1746"><span class="MJXp-mrow" id="MJXp-Span-1747"><span class="MJXp-mi MJXp-mono" id="MJXp-Span-1748">c</span><span class="MJXp-mi MJXp-mono" id="MJXp-Span-1749">o</span><span class="MJXp-mi MJXp-mono" id="MJXp-Span-1750">s</span><span class="MJXp-mi MJXp-mono" id="MJXp-Span-1751">t</span></span><span class="MJXp-mo" id="MJXp-Span-1752" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1753">A</span><span class="MJXp-mo" id="MJXp-Span-1754" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1755" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1756">X</span></span></span><script type="math/tex" id="MathJax-Element-246">\mathtt{cost}(A)=X</script>. Let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1757"><span class="MJXp-msubsup" id="MJXp-Span-1758"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1759" style="margin-right: 0.05em;">A</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1760" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-247">A_i</script> be the unique element for which <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1761"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1762">y</span><span class="MJXp-mo" id="MJXp-Span-1763" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-msubsup" id="MJXp-Span-1764"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1765" style="margin-right: 0.05em;">A</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1766" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1767" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-msubsup" id="MJXp-Span-1768"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1769" style="margin-right: 0.05em;">A</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1770" style="vertical-align: -0.4em;">k</span></span></span></span><script type="math/tex" id="MathJax-Element-248">y \cdot A_i < A_k</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1771"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1772">y</span><span class="MJXp-mo" id="MJXp-Span-1773" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-msubsup" id="MJXp-Span-1774"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1775" style="margin-right: 0.05em;">A</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1776" style="vertical-align: -0.4em;">j</span></span><span class="MJXp-mo" id="MJXp-Span-1777" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-msubsup" id="MJXp-Span-1778"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1779" style="margin-right: 0.05em;">A</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1780" style="vertical-align: -0.4em;">k</span></span></span></span><script type="math/tex" id="MathJax-Element-249">y \cdot A_j \ge A_k</script> for all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1781"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1782">i</span><span class="MJXp-mo" id="MJXp-Span-1783" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1784">j</span><span class="MJXp-mo" id="MJXp-Span-1785" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1786">k</span></span></span><script type="math/tex" id="MathJax-Element-250">i < j \le k</script>. Here, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1787"><span class="MJXp-msubsup" id="MJXp-Span-1788"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1789" style="margin-right: 0.05em;">A</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1790" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-251">A_i</script> may be <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1791"><span class="MJXp-msubsup" id="MJXp-Span-1792"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1793" style="margin-right: 0.05em;">A</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1794" style="vertical-align: -0.4em;">1</span></span></span></span><script type="math/tex" id="MathJax-Element-252">A_1</script>. This element <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1795"><span class="MJXp-msubsup" id="MJXp-Span-1796"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1797" style="margin-right: 0.05em;">A</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1798" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-253">A_i</script> always exists, and we can divide <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1799"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1800">A</span></span></span><script type="math/tex" id="MathJax-Element-254">A</script> into <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1801"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1802">P</span><span class="MJXp-mo" id="MJXp-Span-1803" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-1804" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-msubsup" id="MJXp-Span-1805"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1806" style="margin-right: 0.05em;">A</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1807" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-1808" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1809"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1810" style="margin-right: 0.05em;">A</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1811" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1812" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-1813" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-1814" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1815"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1816" style="margin-right: 0.05em;">A</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1817" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1818" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-255">P=[A_1,A_2,\ldots,A_i]</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1819"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1820">Q</span><span class="MJXp-mo" id="MJXp-Span-1821" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-1822" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-msubsup" id="MJXp-Span-1823"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1824" style="margin-right: 0.05em;">A</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1825" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1826">i</span><span class="MJXp-mo" id="MJXp-Span-1827">+</span><span class="MJXp-mn" id="MJXp-Span-1828">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-1829" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1830"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1831" style="margin-right: 0.05em;">A</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1832" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1833">i</span><span class="MJXp-mo" id="MJXp-Span-1834">+</span><span class="MJXp-mn" id="MJXp-Span-1835">2</span></span></span><span class="MJXp-mo" id="MJXp-Span-1836" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-1837" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-1838" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1839"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1840" style="margin-right: 0.05em;">A</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1841" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-mo" id="MJXp-Span-1842" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-256">Q=[A_{i+1},A_{i+2},\ldots,A_k]</script>. Then, it is easy to show that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1843"><span class="MJXp-mrow" id="MJXp-Span-1844"><span class="MJXp-mi MJXp-mono" id="MJXp-Span-1845">c</span><span class="MJXp-mi MJXp-mono" id="MJXp-Span-1846">o</span><span class="MJXp-mi MJXp-mono" id="MJXp-Span-1847">s</span><span class="MJXp-mi MJXp-mono" id="MJXp-Span-1848">t</span></span><span class="MJXp-mo" id="MJXp-Span-1849" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1850">P</span><span class="MJXp-mo" id="MJXp-Span-1851" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1852" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1853">x</span></span></span><script type="math/tex" id="MathJax-Element-257">\mathtt{cost}(P) \le x</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1854"><span class="MJXp-mrow" id="MJXp-Span-1855"><span class="MJXp-mi MJXp-mono" id="MJXp-Span-1856">c</span><span class="MJXp-mi MJXp-mono" id="MJXp-Span-1857">o</span><span class="MJXp-mi MJXp-mono" id="MJXp-Span-1858">s</span><span class="MJXp-mi MJXp-mono" id="MJXp-Span-1859">t</span></span><span class="MJXp-mo" id="MJXp-Span-1860" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1861">Q</span><span class="MJXp-mo" id="MJXp-Span-1862" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1863" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1864">y</span></span></span><script type="math/tex" id="MathJax-Element-258">\mathtt{cost}(Q) \le y</script>. This defines an "exchange scheme" which will never worsen the total cost while decreasing the maximum subarray cost used.</p><p>Repeating this process on an optimal partition, the new partition has a total cost not worse than the original, and will only use subarrays with cost at most <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1865"><span class="MJXp-mn" id="MJXp-Span-1866">3</span></span></span><script type="math/tex" id="MathJax-Element-259">3</script>.</p><p>We can show that this bound is tight by construction. Namely, the sequence <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1867"><span class="MJXp-mo" id="MJXp-Span-1868" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mn" id="MJXp-Span-1869">3</span><span class="MJXp-mo" id="MJXp-Span-1870" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-1871">4</span><span class="MJXp-mo" id="MJXp-Span-1872" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-1873">8</span><span class="MJXp-mo" id="MJXp-Span-1874" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-1875">9</span><span class="MJXp-mo" id="MJXp-Span-1876" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-260">[3,4,8,9]</script> has total cost <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1877"><span class="MJXp-mn" id="MJXp-Span-1878">3</span></span></span><script type="math/tex" id="MathJax-Element-261">3</script>, and splitting it into any <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1879"><span class="MJXp-mn" id="MJXp-Span-1880">2</span></span></span><script type="math/tex" id="MathJax-Element-262">2</script> or more subarrays will have total cost at least <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1881"><span class="MJXp-mn" id="MJXp-Span-1882">4</span></span></span><script type="math/tex" id="MathJax-Element-263">4</script>.</p><p>Applying this to the solution outlined in 2.1, you get a solution with time complexity <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1883"><span class="MJXp-mrow" id="MJXp-Span-1884"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-1885">O</span></span><span class="MJXp-mo" id="MJXp-Span-1886" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1887">n</span><span class="MJXp-mo" id="MJXp-Span-1888" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-264">\mathcal{O}(n)</script>. Alternatively, you can use data structures such as segment tree for a solution with time complexity <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1889"><span class="MJXp-mrow" id="MJXp-Span-1890"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-1891">O</span></span><span class="MJXp-mo" id="MJXp-Span-1892" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1893">n</span><span class="MJXp-mi" id="MJXp-Span-1894">log</span><span class="MJXp-mo" id="MJXp-Span-1895" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1896">n</span><span class="MJXp-mo" id="MJXp-Span-1897" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-265">\mathcal{O}(n \log n)</script>.</p></div></div> <div class="spoiler"><b class="spoiler-title">Part 2.3</b><div class="spoiler-content" style="display: block;"><p>The third solution of the first subtask strays away from using any observation and abuses the cost function directly.</p><p>Recall that the cost function is as follows:</p> <center><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1898"><span class="MJXp-mrow" id="MJXp-Span-1899"><span class="MJXp-mi MJXp-mono" id="MJXp-Span-1900">c</span><span class="MJXp-mi MJXp-mono" id="MJXp-Span-1901">o</span><span class="MJXp-mi MJXp-mono" id="MJXp-Span-1902">s</span><span class="MJXp-mi MJXp-mono" id="MJXp-Span-1903">t</span></span><span class="MJXp-mo" id="MJXp-Span-1904" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1905">b</span><span class="MJXp-mo" id="MJXp-Span-1906" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1907" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mrow" id="MJXp-Span-1908"><span class="MJXp-mo" id="MJXp-Span-1909" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.689em;"><span class="MJXp-right MJXp-scale4" style="font-size: 3.756em; margin-left: -0.23em;">⌈</span></span><span class="MJXp-mrow" id="MJXp-Span-1910"><span class="MJXp-mfrac" id="MJXp-Span-1911" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-msubsup" id="MJXp-Span-1912"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1913" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1914" style="vertical-align: -0.4em;">k</span></span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mo" id="MJXp-Span-1915">min</span><span class="MJXp-mo" id="MJXp-Span-1916">(</span><span class="MJXp-msubsup" id="MJXp-Span-1917"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1918" style="margin-right: 0.05em;">b</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1919" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-1920">,</span><span class="MJXp-msubsup" id="MJXp-Span-1921"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1922" style="margin-right: 0.05em;">b</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1923" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1924">,</span><span class="MJXp-mo" id="MJXp-Span-1925">…</span><span class="MJXp-mo" id="MJXp-Span-1926">,</span><span class="MJXp-msubsup" id="MJXp-Span-1927"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1928" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1929" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-mo" id="MJXp-Span-1930">)</span></span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-1931" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.689em;"><span class="MJXp-right MJXp-scale4" style="font-size: 3.756em; margin-left: -0.23em;">⌉</span></span></span></span></span><script type="math/tex" id="MathJax-Element-266">\mathtt{cost}(b)=\left \lceil{\frac{b_k}{\min(b_1,b_2,\ldots,b_k)}} \right \rceil</script></center><p>Considering <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1932"><span class="MJXp-mo" id="MJXp-Span-1933" style="margin-left: 0.333em; margin-right: 0.333em;">min</span><span class="MJXp-mo" id="MJXp-Span-1934" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1935"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1936" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1937" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1938">j</span><span class="MJXp-mo" id="MJXp-Span-1939">+</span><span class="MJXp-mn" id="MJXp-Span-1940">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-1941" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-1942" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-1943" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1944"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1945" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1946" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1947">i</span></span></span><span class="MJXp-mo" id="MJXp-Span-1948" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-267">\min(a_{j+1},\ldots,a_{i})</script> as a constant, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1949"><span class="MJXp-mrow" id="MJXp-Span-1950"><span class="MJXp-mi MJXp-mono" id="MJXp-Span-1951">c</span><span class="MJXp-mi MJXp-mono" id="MJXp-Span-1952">o</span><span class="MJXp-mi MJXp-mono" id="MJXp-Span-1953">s</span><span class="MJXp-mi MJXp-mono" id="MJXp-Span-1954">t</span></span><span class="MJXp-mo" id="MJXp-Span-1955" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mo" id="MJXp-Span-1956" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-msubsup" id="MJXp-Span-1957"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1958" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1959" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1960">j</span><span class="MJXp-mo" id="MJXp-Span-1961">+</span><span class="MJXp-mn" id="MJXp-Span-1962">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-1963" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-1964" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-1965" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1966"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1967" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1968" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1969" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1970" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1971" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi" id="MJXp-Span-1972">opt</span><span class="MJXp-mo" id="MJXp-Span-1973" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-1974" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-1975">1</span><span class="MJXp-mo" id="MJXp-Span-1976" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1977">j</span><span class="MJXp-mo" id="MJXp-Span-1978" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-268">\mathtt{cost}([a_{j+1},\ldots,a_i])+\operatorname{opt}(1,j)</script> can be regarded a linear function of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1979"><span class="MJXp-msubsup" id="MJXp-Span-1980"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1981" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1982" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-269">a_i</script> rounded up. Therefore, we can consider using Convex Hull Trick to optimize our <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1983"><span class="MJXp-mrow" id="MJXp-Span-1984"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-1985">O</span></span><span class="MJXp-mo" id="MJXp-Span-1986" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1987"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1988" style="margin-right: 0.05em;">n</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1989" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1990" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-270">\mathcal{O}(n^2)</script> DP. The only caveat is how to use Convex Hull Trick with changing values of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1991"><span class="MJXp-mo" id="MJXp-Span-1992" style="margin-left: 0.333em; margin-right: 0.333em;">min</span><span class="MJXp-mo" id="MJXp-Span-1993" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1994"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1995" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1996" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1997">j</span><span class="MJXp-mo" id="MJXp-Span-1998">+</span><span class="MJXp-mn" id="MJXp-Span-1999">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-2000" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-2001" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-2002" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-2003"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2004" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2005" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2006">i</span></span></span><span class="MJXp-mo" id="MJXp-Span-2007" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-271">\min(a_{j+1},\ldots,a_{i})</script>.</p><p>This can be resolved by maintaining values of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2008"><span class="MJXp-mo" id="MJXp-Span-2009" style="margin-left: 0.333em; margin-right: 0.333em;">min</span><span class="MJXp-mo" id="MJXp-Span-2010" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-2011"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2012" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2013" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2014">j</span><span class="MJXp-mo" id="MJXp-Span-2015">+</span><span class="MJXp-mn" id="MJXp-Span-2016">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-2017" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-2018" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-2019" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-2020"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2021" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2022" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2023">i</span></span></span><span class="MJXp-mo" id="MJXp-Span-2024" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-272">\min(a_{j+1},\ldots,a_{i})</script> using a monotone stack. We can simply keep the minimum value of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2025"><span class="MJXp-mi" id="MJXp-Span-2026">opt</span><span class="MJXp-mo" id="MJXp-Span-2027" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-2028" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-2029">1</span><span class="MJXp-mo" id="MJXp-Span-2030" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2031">j</span><span class="MJXp-mo" id="MJXp-Span-2032" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-273">\operatorname{opt}(1,j)</script> for same values of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2033"><span class="MJXp-mo" id="MJXp-Span-2034" style="margin-left: 0.333em; margin-right: 0.333em;">min</span><span class="MJXp-mo" id="MJXp-Span-2035" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-2036"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2037" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2038" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2039">j</span><span class="MJXp-mo" id="MJXp-Span-2040">+</span><span class="MJXp-mn" id="MJXp-Span-2041">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-2042" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-2043" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-2044" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-2045"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2046" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2047" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2048">i</span></span></span><span class="MJXp-mo" id="MJXp-Span-2049" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-274">\min(a_{j+1},\ldots,a_{i})</script>. The updates that might happen on the CHT structure are maintainable if you can roll back the CHT structure (like we did the monotone stack); and a Li-Chao Tree can be rolled back quite easily as its inner behaviour is not different from a segment tree.</p><p>This leads us to a solution with time complexity <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2050"><span class="MJXp-mrow" id="MJXp-Span-2051"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-2052">O</span></span><span class="MJXp-mo" id="MJXp-Span-2053" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2054">n</span><span class="MJXp-mi" id="MJXp-Span-2055">log</span><span class="MJXp-mo" id="MJXp-Span-2056" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mrow" id="MJXp-Span-2057"><span class="MJXp-mn" id="MJXp-Span-2058">1</span><span class="MJXp-mrow" id="MJXp-Span-2059"><span class="MJXp-mo" id="MJXp-Span-2060" style="margin-left: 0.111em; margin-right: 0.111em;">/</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2061">ϵ</span></span><span class="MJXp-mo" id="MJXp-Span-2062" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-275">\mathcal{O}(n \log {1/\epsilon})</script>. Certain solutions with too big constants can get MLE under the given constraints, but there exist solutions with small enough constants that use <code class="tt">double</code> instead of whatever other type you might want to use. Why such solutions are still correct is left as a practice for the reader (seriously, you should be able to take a guess if you understood the other "more elegant" solutions).</p></div></div> <div class="spoiler"><b class="spoiler-title">Part 3 (for Hard subtask)</b><div class="spoiler-content" style="display: block;"><p>Before reading, please read the solutions to the first subtask (and hopefully identify the two solutions that are helpful in solving the second subtask).</p><p>Directly applying the most optimal DP solution to the first subtask, we have a solution with <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2063"><span class="MJXp-mrow" id="MJXp-Span-2064"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-2065">O</span></span><span class="MJXp-mo" id="MJXp-Span-2066" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-2067"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2068" style="margin-right: 0.05em;">n</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2069" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-2070" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-276">\mathcal{O}(n^2)</script> time complexity. However, it seems hard to improve further as even our optimal DP has <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2071"><span class="MJXp-mrow" id="MJXp-Span-2072"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-2073">O</span></span><span class="MJXp-mo" id="MJXp-Span-2074" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2075">n</span><span class="MJXp-mo" id="MJXp-Span-2076" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-277">\mathcal{O}(n)</script> states and it looks like that can't be helped with.</p><p>However, we somehow already have enough resources to improve it even further; there is a way to know all values <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2077"><span class="MJXp-mi" id="MJXp-Span-2078">opt</span><span class="MJXp-mo" id="MJXp-Span-2079" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-2080" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-2081">1</span><span class="MJXp-mo" id="MJXp-Span-2082" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2083">r</span><span class="MJXp-mo" id="MJXp-Span-2084" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-2085" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi" id="MJXp-Span-2086">opt</span><span class="MJXp-mo" id="MJXp-Span-2087" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-2088" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-2089">2</span><span class="MJXp-mo" id="MJXp-Span-2090" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2091">r</span><span class="MJXp-mo" id="MJXp-Span-2092" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-2093" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-2094" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-2095" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi" id="MJXp-Span-2096">opt</span><span class="MJXp-mo" id="MJXp-Span-2097" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-2098" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2099">r</span><span class="MJXp-mo" id="MJXp-Span-2100" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2101">r</span><span class="MJXp-mo" id="MJXp-Span-2102" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-278">\operatorname{opt}(1,r),\operatorname{opt}(2,r),\ldots,\operatorname{opt}(r,r)</script> without using <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2103"><span class="MJXp-mrow" id="MJXp-Span-2104"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-2105">O</span></span><span class="MJXp-mo" id="MJXp-Span-2106" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2107">n</span><span class="MJXp-mo" id="MJXp-Span-2108" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-279">\mathcal{O}(n)</script> states.</p><p>Recall the following:</p> <ul>   <li>There will be only at most <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2109"><span class="MJXp-mn" id="MJXp-Span-2110">2</span><span class="MJXp-msubsup" id="MJXp-Span-2111"><span class="MJXp-mi" id="MJXp-Span-2112" style="margin-right: 0.05em;">log</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2113" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-2114" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-2115" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-2116"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2117" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2118" style="vertical-align: -0.4em;">r</span></span><span class="MJXp-mo" id="MJXp-Span-2119" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-280">2\log_2(a_r)</script> different values of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2120"><span class="MJXp-mi" id="MJXp-Span-2121">opt</span><span class="MJXp-mo" id="MJXp-Span-2122" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-2123" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2124">i</span><span class="MJXp-mo" id="MJXp-Span-2125" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2126">r</span><span class="MJXp-mo" id="MJXp-Span-2127" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-281">\operatorname{opt}(i,r)</script>. (Direct consequence of 2.1.a)</li>   <li>Our DP to compute <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2128"><span class="MJXp-mi" id="MJXp-Span-2129">opt</span><span class="MJXp-mo" id="MJXp-Span-2130" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-2131" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-2132">1</span><span class="MJXp-mo" id="MJXp-Span-2133" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2134">r</span><span class="MJXp-mo" id="MJXp-Span-2135" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-282">\operatorname{opt}(1,r)</script> is monotonic, i.e. <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2136"><span class="MJXp-mi" id="MJXp-Span-2137">opt</span><span class="MJXp-mo" id="MJXp-Span-2138" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-2139" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2140">i</span><span class="MJXp-mo" id="MJXp-Span-2141" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2142">r</span><span class="MJXp-mo" id="MJXp-Span-2143" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-2144" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mi" id="MJXp-Span-2145">opt</span><span class="MJXp-mo" id="MJXp-Span-2146" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-2147" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2148">i</span><span class="MJXp-mo" id="MJXp-Span-2149" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-2150">1</span><span class="MJXp-mo" id="MJXp-Span-2151" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2152">r</span><span class="MJXp-mo" id="MJXp-Span-2153" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-283">\operatorname{opt}(i,r) \ge \operatorname{opt}(i+1,r)</script>. (= 1.b)</li> </ul><p>Using the above, we can infer the following.</p> <ul>   <li>We can model another DP by swapping the places of cost and index, and this new DP will only have at most <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2154"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2155">C</span><span class="MJXp-mo" id="MJXp-Span-2156" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-2157">128</span><span class="MJXp-mo" id="MJXp-Span-2158" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mn" id="MJXp-Span-2159">2</span><span class="MJXp-msubsup" id="MJXp-Span-2160"><span class="MJXp-mi" id="MJXp-Span-2161" style="margin-right: 0.05em;">log</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2162" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-2163" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-2164" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-2165"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2166" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2167" style="vertical-align: -0.4em;">r</span></span><span class="MJXp-mo" id="MJXp-Span-2168" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-284">C=128 \ge 2\log_2(a_r)</script> states.</li> </ul><p>This "swapping cost and index" might sound like it's so unexpected, but surely you may have seen such a DP formulation if you have solved many DP problems. Namely, this technique is used in Knapsack problems when the cost is small and the capacity is huge.</p><p>So, how would we formulate this DP? Let us define a new function:</p> <ul>   <li><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2169"><span class="MJXp-msup" id="MJXp-Span-2170"><span class="MJXp-mi" id="MJXp-Span-2171" style="margin-right: 0.05em;">opt</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-2172" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-2173" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-2174" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2175">c</span><span class="MJXp-mo" id="MJXp-Span-2176" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2177">r</span><span class="MJXp-mo" id="MJXp-Span-2178" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-285">\operatorname{opt}'(c,r)</script>: minimum value of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2179"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2180">l</span></span></span><script type="math/tex" id="MathJax-Element-286">l</script> such that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2181"><span class="MJXp-mi" id="MJXp-Span-2182">opt</span><span class="MJXp-mo" id="MJXp-Span-2183" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-2184" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2185">l</span><span class="MJXp-mo" id="MJXp-Span-2186" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2187">r</span><span class="MJXp-mo" id="MJXp-Span-2188" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-2189" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2190">c</span></span></span><script type="math/tex" id="MathJax-Element-287">\operatorname{opt}(l,r) \le c</script> (<span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2191"><span class="MJXp-mn" id="MJXp-Span-2192">0</span><span class="MJXp-mo" id="MJXp-Span-2193" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2194">c</span><span class="MJXp-mo" id="MJXp-Span-2195" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2196">C</span></span></span><script type="math/tex" id="MathJax-Element-288">0 \le c \le C</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2197"><span class="MJXp-mn" id="MJXp-Span-2198">1</span><span class="MJXp-mo" id="MJXp-Span-2199" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2200">r</span><span class="MJXp-mo" id="MJXp-Span-2201" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2202">n</span></span></span><script type="math/tex" id="MathJax-Element-289">1 \le r \le n</script>).</li> </ul><p>Then, we can see by 1.b that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2203"><span class="MJXp-msup" id="MJXp-Span-2204"><span class="MJXp-mi" id="MJXp-Span-2205" style="margin-right: 0.05em;">opt</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-2206" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-2207" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-2208" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2209">c</span><span class="MJXp-mo" id="MJXp-Span-2210" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-2211">1</span><span class="MJXp-mo" id="MJXp-Span-2212" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2213">r</span><span class="MJXp-mo" id="MJXp-Span-2214" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-2215" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-msup" id="MJXp-Span-2216"><span class="MJXp-mi" id="MJXp-Span-2217" style="margin-right: 0.05em;">opt</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-2218" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-2219" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-2220" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2221">c</span><span class="MJXp-mo" id="MJXp-Span-2222" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2223">r</span><span class="MJXp-mo" id="MJXp-Span-2224" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-290">\operatorname{opt}'(c+1,r) \le \operatorname{opt}'(c,r)</script> for all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2225"><span class="MJXp-mn" id="MJXp-Span-2226">0</span><span class="MJXp-mo" id="MJXp-Span-2227" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2228">c</span></span></span><script type="math/tex" id="MathJax-Element-291">0 \le c</script>. Also, after we know <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2229"><span class="MJXp-msup" id="MJXp-Span-2230"><span class="MJXp-mi" id="MJXp-Span-2231" style="margin-right: 0.05em;">opt</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-2232" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-2233" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-2234" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2235">c</span><span class="MJXp-mo" id="MJXp-Span-2236" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2237">r</span><span class="MJXp-mo" id="MJXp-Span-2238" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-292">\operatorname{opt}'(c,r)</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2239"><span class="MJXp-msup" id="MJXp-Span-2240"><span class="MJXp-mi" id="MJXp-Span-2241" style="margin-right: 0.05em;">opt</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-2242" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-2243" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-2244" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2245">c</span><span class="MJXp-mo" id="MJXp-Span-2246" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-2247">1</span><span class="MJXp-mo" id="MJXp-Span-2248" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2249">r</span><span class="MJXp-mo" id="MJXp-Span-2250" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-293">\operatorname{opt}'(c+1,r)</script>, we can compute the range of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2251"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2252">l</span></span></span><script type="math/tex" id="MathJax-Element-294">l</script> such that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2253"><span class="MJXp-mi" id="MJXp-Span-2254">opt</span><span class="MJXp-mo" id="MJXp-Span-2255" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-2256" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2257">l</span><span class="MJXp-mo" id="MJXp-Span-2258" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2259">r</span><span class="MJXp-mo" id="MJXp-Span-2260" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-2261" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2262">c</span></span></span><script type="math/tex" id="MathJax-Element-295">\operatorname{opt}(l,r) = c</script>, and it lets us find the sum of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2263"><span class="MJXp-mi" id="MJXp-Span-2264">opt</span><span class="MJXp-mo" id="MJXp-Span-2265" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-2266" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2267">l</span><span class="MJXp-mo" id="MJXp-Span-2268" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2269">r</span><span class="MJXp-mo" id="MJXp-Span-2270" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-296">\operatorname{opt}(l,r)</script> over all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2271"><span class="MJXp-mn" id="MJXp-Span-2272">1</span><span class="MJXp-mo" id="MJXp-Span-2273" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2274">i</span><span class="MJXp-mo" id="MJXp-Span-2275" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2276">r</span></span></span><script type="math/tex" id="MathJax-Element-297">1 \le i \le r</script> in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2277"><span class="MJXp-mrow" id="MJXp-Span-2278"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-2279">O</span></span><span class="MJXp-mo" id="MJXp-Span-2280" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2281">C</span><span class="MJXp-mo" id="MJXp-Span-2282" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-298">\mathcal{O}(C)</script> time.</p><p>So let's think of how we will compute values of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2283"><span class="MJXp-msup" id="MJXp-Span-2284"><span class="MJXp-mi" id="MJXp-Span-2285" style="margin-right: 0.05em;">opt</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-2286" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-2287" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-2288" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2289">c</span><span class="MJXp-mo" id="MJXp-Span-2290" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2291">r</span><span class="MJXp-mo" id="MJXp-Span-2292" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-299">\operatorname{opt}'(c,r)</script> for one <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2293"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2294">r</span></span></span><script type="math/tex" id="MathJax-Element-300">r</script> in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2295"><span class="MJXp-mrow" id="MJXp-Span-2296"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-2297">O</span></span><span class="MJXp-mo" id="MJXp-Span-2298" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2299">C</span><span class="MJXp-mo" id="MJXp-Span-2300" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-301">\mathcal{O}(C)</script> time.</p><p>Let us first precompute the <strong>minimum</strong> <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2301"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2302">l</span></span></span><script type="math/tex" id="MathJax-Element-302">l</script> such that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2303"><span class="MJXp-mrow" id="MJXp-Span-2304"><span class="MJXp-mi MJXp-mono" id="MJXp-Span-2305">c</span><span class="MJXp-mi MJXp-mono" id="MJXp-Span-2306">o</span><span class="MJXp-mi MJXp-mono" id="MJXp-Span-2307">s</span><span class="MJXp-mi MJXp-mono" id="MJXp-Span-2308">t</span></span><span class="MJXp-mo" id="MJXp-Span-2309" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mo" id="MJXp-Span-2310" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-msubsup" id="MJXp-Span-2311"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2312" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2313" style="vertical-align: -0.4em;">l</span></span><span class="MJXp-mo" id="MJXp-Span-2314" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-2315"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2316" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2317" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2318">l</span><span class="MJXp-mo" id="MJXp-Span-2319">+</span><span class="MJXp-mn" id="MJXp-Span-2320">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-2321" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-2322" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-2323" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-2324"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2325" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2326" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-2327" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-2328" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-2329" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2330">c</span></span></span><script type="math/tex" id="MathJax-Element-303">\mathtt{cost}([a_l,a_{l+1},\ldots,a_i]) \le c</script> for all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2331"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2332">i</span></span></span><script type="math/tex" id="MathJax-Element-304">i</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2333"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2334">c</span></span></span><script type="math/tex" id="MathJax-Element-305">c</script>. By 2.2.a, it suffices to compute this for only <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2335"><span class="MJXp-mn" id="MJXp-Span-2336">1</span><span class="MJXp-mo" id="MJXp-Span-2337" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2338">c</span><span class="MJXp-mo" id="MJXp-Span-2339" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mn" id="MJXp-Span-2340">3</span></span></span><script type="math/tex" id="MathJax-Element-306">1 \le c \le 3</script>. We will denote this as <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2341"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2342">L</span><span class="MJXp-mo" id="MJXp-Span-2343" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2344">i</span><span class="MJXp-mo" id="MJXp-Span-2345" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2346">c</span><span class="MJXp-mo" id="MJXp-Span-2347" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-307">L(i,c)</script>. These values can be easily preprocessed using walk on segment tree in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2348"><span class="MJXp-mrow" id="MJXp-Span-2349"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-2350">O</span></span><span class="MJXp-mo" id="MJXp-Span-2351" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2352">n</span><span class="MJXp-mi" id="MJXp-Span-2353">log</span><span class="MJXp-mo" id="MJXp-Span-2354" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2355">n</span><span class="MJXp-mo" id="MJXp-Span-2356" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-308">\mathcal{O}(n \log n)</script> time. This will come in handy for our new DP formulation.</p><p>In the formulation of our original <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2357"><span class="MJXp-mrow" id="MJXp-Span-2358"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-2359">O</span></span><span class="MJXp-mo" id="MJXp-Span-2360" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2361">n</span><span class="MJXp-mo" id="MJXp-Span-2362" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-309">\mathcal{O}(n)</script> DP for the first subtask, we required a pointer for each cost <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2363"><span class="MJXp-mn" id="MJXp-Span-2364">1</span><span class="MJXp-mo" id="MJXp-Span-2365" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2366">c</span><span class="MJXp-mo" id="MJXp-Span-2367" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mn" id="MJXp-Span-2368">3</span></span></span><script type="math/tex" id="MathJax-Element-310">1 \le c \le 3</script> on one side. On the new formulation, however, we will need some transition directly for indices. This is where the values <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2369"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2370">L</span><span class="MJXp-mo" id="MJXp-Span-2371" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2372">i</span><span class="MJXp-mo" id="MJXp-Span-2373" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2374">c</span><span class="MJXp-mo" id="MJXp-Span-2375" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-311">L(i,c)</script> comes in handy.</p><p>We can find the following correct DP transition:</p> <ul>   <li><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2376"><span class="MJXp-msup" id="MJXp-Span-2377"><span class="MJXp-mi" id="MJXp-Span-2378" style="margin-right: 0.05em;">opt</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-2379" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-2380" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-2381" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2382">c</span><span class="MJXp-mo" id="MJXp-Span-2383" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2384">r</span><span class="MJXp-mo" id="MJXp-Span-2385" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-2386" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2387">r</span><span class="MJXp-mo" id="MJXp-Span-2388" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-2389">1</span></span></span><script type="math/tex" id="MathJax-Element-312">\operatorname{opt}'(c,r)=r+1</script> (when <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2390"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2391">c</span><span class="MJXp-mo" id="MJXp-Span-2392" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mn" id="MJXp-Span-2393">0</span></span></span><script type="math/tex" id="MathJax-Element-313">c \le 0</script>)</li>   <li><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2394"><span class="MJXp-msup" id="MJXp-Span-2395"><span class="MJXp-mi" id="MJXp-Span-2396" style="margin-right: 0.05em;">opt</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-2397" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-2398" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-2399" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2400">c</span><span class="MJXp-mo" id="MJXp-Span-2401" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2402">r</span><span class="MJXp-mo" id="MJXp-Span-2403" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-2404" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-munderover" id="MJXp-Span-2405"><span class=""><span class="MJXp-mo" id="MJXp-Span-2406" style="margin-left: 0.333em; margin-right: 0.333em;">min</span></span><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-2407" style="margin-left: 0px;"><span class="MJXp-mn" id="MJXp-Span-2408">1</span><span class="MJXp-mo" id="MJXp-Span-2409">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2410">k</span><span class="MJXp-mo" id="MJXp-Span-2411">≤</span><span class="MJXp-mn" id="MJXp-Span-2412">3</span></span></span></span><span class="MJXp-mrow" id="MJXp-Span-2413"><span class="MJXp-mo" id="MJXp-Span-2414" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.731em;"><span class="MJXp-right MJXp-scale4" style="font-size: 3.924em; margin-left: -0.17em;">(</span></span><span class="MJXp-mrow" id="MJXp-Span-2415"><span class="MJXp-munderover" id="MJXp-Span-2416"><span class=""><span class="MJXp-mo" id="MJXp-Span-2417" style="margin-left: 0.333em; margin-right: 0.333em;">min</span></span><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-2418" style="margin-left: 0px;"><span class="MJXp-mo" id="MJXp-Span-2419">max</span><span class="MJXp-mo" id="MJXp-Span-2420">(</span><span class="MJXp-msup" id="MJXp-Span-2421"><span class="MJXp-mi" id="MJXp-Span-2422" style="margin-right: 0.05em;">opt</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-2423" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-2424"></span><span class="MJXp-mo" id="MJXp-Span-2425">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2426">c</span><span class="MJXp-mo" id="MJXp-Span-2427">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2428">k</span><span class="MJXp-mo" id="MJXp-Span-2429">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2430">r</span><span class="MJXp-mo" id="MJXp-Span-2431">)</span><span class="MJXp-mo" id="MJXp-Span-2432">−</span><span class="MJXp-mn" id="MJXp-Span-2433">1</span><span class="MJXp-mo" id="MJXp-Span-2434">,</span><span class="MJXp-mn" id="MJXp-Span-2435">0</span><span class="MJXp-mo" id="MJXp-Span-2436">)</span><span class="MJXp-mo" id="MJXp-Span-2437">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2438">i</span><span class="MJXp-mo" id="MJXp-Span-2439">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2440">r</span></span></span></span><span class="MJXp-mrow" id="MJXp-Span-2441"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2442">L</span><span class="MJXp-mo" id="MJXp-Span-2443" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2444">i</span><span class="MJXp-mo" id="MJXp-Span-2445" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2446">k</span><span class="MJXp-mo" id="MJXp-Span-2447" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MJXp-mo" id="MJXp-Span-2448" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.731em;"><span class="MJXp-right MJXp-scale4" style="font-size: 3.924em; margin-left: -0.17em;">)</span></span></span></span></span><script type="math/tex" id="MathJax-Element-314">\operatorname{opt}'(c,r)= \min_\limits{1 \le k \le 3} \left ({\min_\limits{\max(\operatorname{opt}'(c-k,r)-1,0) \le i \le r}{L(i,k)}}\right )</script> (when <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2449"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2450">c</span><span class="MJXp-mo" id="MJXp-Span-2451" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-mn" id="MJXp-Span-2452">0</span></span></span><script type="math/tex" id="MathJax-Element-315">c>0</script>)</li> </ul><p>The correctness of this DP transition is shown by 1.b and 2.2.a.</p><p>Because we have already preprocessed the values of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2453"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2454">L</span><span class="MJXp-mo" id="MJXp-Span-2455" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2456">i</span><span class="MJXp-mo" id="MJXp-Span-2457" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-2458">1</span><span class="MJXp-mo" id="MJXp-Span-2459" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-316">L(i,1)</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2460"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2461">L</span><span class="MJXp-mo" id="MJXp-Span-2462" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2463">i</span><span class="MJXp-mo" id="MJXp-Span-2464" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-2465">2</span><span class="MJXp-mo" id="MJXp-Span-2466" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-317">L(i,2)</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2467"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2468">L</span><span class="MJXp-mo" id="MJXp-Span-2469" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2470">i</span><span class="MJXp-mo" id="MJXp-Span-2471" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-2472">3</span><span class="MJXp-mo" id="MJXp-Span-2473" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-318">L(i,3)</script> in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2474"><span class="MJXp-mrow" id="MJXp-Span-2475"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-2476">O</span></span><span class="MJXp-mo" id="MJXp-Span-2477" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2478">n</span><span class="MJXp-mi" id="MJXp-Span-2479">log</span><span class="MJXp-mo" id="MJXp-Span-2480" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2481">n</span><span class="MJXp-mo" id="MJXp-Span-2482" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-319">\mathcal{O}(n \log n)</script> time, we can now construct a RMQ data structure for these values in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2483"><span class="MJXp-mrow" id="MJXp-Span-2484"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-2485">O</span></span><span class="MJXp-mo" id="MJXp-Span-2486" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2487">n</span><span class="MJXp-mi" id="MJXp-Span-2488">log</span><span class="MJXp-mo" id="MJXp-Span-2489" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2490">n</span><span class="MJXp-mo" id="MJXp-Span-2491" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-320">\mathcal{O}(n \log n)</script> time for <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2492"><span class="MJXp-mrow" id="MJXp-Span-2493"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-2494">O</span></span><span class="MJXp-mo" id="MJXp-Span-2495" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-2496">1</span><span class="MJXp-mo" id="MJXp-Span-2497" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-321">\mathcal{O}(1)</script> query time. This allows us to process all values of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2498"><span class="MJXp-msup" id="MJXp-Span-2499"><span class="MJXp-mi" id="MJXp-Span-2500" style="margin-right: 0.05em;">opt</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-2501" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-2502" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-2503" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2504">c</span><span class="MJXp-mo" id="MJXp-Span-2505" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2506">r</span><span class="MJXp-mo" id="MJXp-Span-2507" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-322">\operatorname{opt}'(c,r)</script> for one <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2508"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2509">r</span></span></span><script type="math/tex" id="MathJax-Element-323">r</script> in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2510"><span class="MJXp-mrow" id="MJXp-Span-2511"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-2512">O</span></span><span class="MJXp-mo" id="MJXp-Span-2513" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2514">C</span><span class="MJXp-mo" id="MJXp-Span-2515" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-324">\mathcal{O}(C)</script> time according to the transition described above.</p><p>Computing this for each <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2516"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2517">r</span></span></span><script type="math/tex" id="MathJax-Element-325">r</script> independently, we have now computed the sum of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2518"><span class="MJXp-mi" id="MJXp-Span-2519">opt</span><span class="MJXp-mo" id="MJXp-Span-2520" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-2521" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2522">l</span><span class="MJXp-mo" id="MJXp-Span-2523" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2524">r</span><span class="MJXp-mo" id="MJXp-Span-2525" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-326">\operatorname{opt}(l,r)</script> over all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2526"><span class="MJXp-mn" id="MJXp-Span-2527">1</span><span class="MJXp-mo" id="MJXp-Span-2528" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2529">l</span><span class="MJXp-mo" id="MJXp-Span-2530" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2531">r</span><span class="MJXp-mo" id="MJXp-Span-2532" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2533">n</span></span></span><script type="math/tex" id="MathJax-Element-327">1 \le l \le r \le n</script> in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2534"><span class="MJXp-mrow" id="MJXp-Span-2535"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-2536">O</span></span><span class="MJXp-mo" id="MJXp-Span-2537" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2538">n</span><span class="MJXp-mi" id="MJXp-Span-2539">log</span><span class="MJXp-mo" id="MJXp-Span-2540" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2541">n</span><span class="MJXp-mo" id="MJXp-Span-2542" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2543">n</span><span class="MJXp-mi" id="MJXp-Span-2544">log</span><span class="MJXp-mo" id="MJXp-Span-2545" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2546">a</span><span class="MJXp-mo" id="MJXp-Span-2547" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-328">\mathcal{O}(n \log n + n \log a)</script> time. The problem is solved.</p></div></div> <div class="spoiler"><b class="spoiler-title">Code (chromate00, Easy Part 2.1)</b><div class="spoiler-content" style="display: block;"><p><a href="https://codeforces.com/contest/2159/submission/343542209" title="Submission 343542209 by chromate00">343542209</a></p></div></div> <div class="spoiler"><b class="spoiler-title">Code (chromate00, Hard)</b><div class="spoiler-content" style="display: block;"><p><a href="https://codeforces.com/contest/2159/submission/343542358" title="Submission 343542358 by chromate00">343542358</a></p></div></div><p><a href="https://codeforces.com/contest/2159/problem/E" title="Codeforces Round 1058 (Div. 1)">2159E - Super-Short-Polynomial-San</a></p><p>Problem Credit: <a class="rated-user user-blue" href="https://codeforces.com/profile/chromate00" title="Expert chromate00">chromate00</a>; Special Thanks: <a class="rated-user user-orange" href="https://codeforces.com/profile/Proof_by_QED" title="Master Proof_by_QED">Proof_by_QED</a>, <a class="rated-user user-red" href="https://codeforces.com/profile/zeemanz" title="Grandmaster zeemanz">zeemanz</a></p> <div class="spoiler"><b class="spoiler-title">Rate the problem!</b><div class="spoiler-content" style="display: block;"><ul>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="12795">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="20">20</span>
            </i>
        </a>
    </span>


 Epic</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="12796">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="5">5</span>
            </i>
        </a>
    </span>


 Good</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="12797">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="2">2</span>
            </i>
        </a>
    </span>


 Moderate</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="12798">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="1">1</span>
            </i>
        </a>
    </span>


 Bad</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="12799">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="29">29</span>
            </i>
        </a>
    </span>


 Horrendous</li> </ul></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><p>First, we will solve the easier problem of computing just single coefficients <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2548"><span class="MJXp-mo" id="MJXp-Span-2549" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-msubsup" id="MJXp-Span-2550"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2551" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2552" style="vertical-align: 0.5em;">k</span></span><span class="MJXp-mo" id="MJXp-Span-2553" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2554">F</span><span class="MJXp-mo" id="MJXp-Span-2555" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2556">n</span><span class="MJXp-mo" id="MJXp-Span-2557" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-329">[x^k] F(n)</script>. For this, observe the following facts.</p> <ul>   <li><p>It takes <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2558"><span class="MJXp-mi" id="MJXp-Span-2559">Θ</span><span class="MJXp-mo" id="MJXp-Span-2560" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mo" id="MJXp-Span-2561" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2562">n</span><span class="MJXp-mo" id="MJXp-Span-2563" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2564">m</span><span class="MJXp-mo" id="MJXp-Span-2565" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mi" id="MJXp-Span-2566">log</span><span class="MJXp-mo" id="MJXp-Span-2567" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-2568" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2569">n</span><span class="MJXp-mo" id="MJXp-Span-2570" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2571">m</span><span class="MJXp-mo" id="MJXp-Span-2572" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-2573" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-330">\Theta((n+m) \log (n+m))</script> time to multiply two polynomials of size <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2574"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2575">n</span></span></span><script type="math/tex" id="MathJax-Element-331">n</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2576"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2577">m</span></span></span><script type="math/tex" id="MathJax-Element-332">m</script> using FFT.</p></li>   <li><p>However, it takes <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2578"><span class="MJXp-mi" id="MJXp-Span-2579">Θ</span><span class="MJXp-mo" id="MJXp-Span-2580" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mo" id="MJXp-Span-2581" style="margin-left: 0.333em; margin-right: 0.333em;">min</span><span class="MJXp-mo" id="MJXp-Span-2582" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2583">n</span><span class="MJXp-mo" id="MJXp-Span-2584" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2585">m</span><span class="MJXp-mo" id="MJXp-Span-2586" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-2587" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-333">\Theta(\min(n,m))</script> time to retrieve only one coefficient from their product.</p></li> </ul><p>Let's consider how we can make a tradeoff between these two time complexities.</p><p>To make a meaningful tradeoff in time complexity, we can use something that resembles the <em>Baby Step-Giant Step</em> algorithm.</p><p>Formally, consider the following method:</p> <ul>   <li><p>Select a constant <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2588"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2589">B</span><span class="MJXp-mo" id="MJXp-Span-2590" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-mn" id="MJXp-Span-2591">1</span></span></span><script type="math/tex" id="MathJax-Element-334">B > 1</script> arbitrarily.</p></li>   <li><p>For all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2592"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2593">k</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2594">B</span><span class="MJXp-mo" id="MJXp-Span-2595" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2596">N</span></span></span><script type="math/tex" id="MathJax-Element-335">kB \le N</script>, precompute the polynomial <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2597"><span class="MJXp-mrow" id="MJXp-Span-2598"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-2599">F</span></span><span class="MJXp-mo" id="MJXp-Span-2600" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2601">k</span><span class="MJXp-mo" id="MJXp-Span-2602" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-2603" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2604">F</span><span class="MJXp-mo" id="MJXp-Span-2605" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2606">k</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2607">B</span><span class="MJXp-mo" id="MJXp-Span-2608" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-336">\mathcal{F}(k)=F(kB)</script>. This takes <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2609"><span class="MJXp-mrow" id="MJXp-Span-2610"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-2611">O</span></span><span class="MJXp-mo" id="MJXp-Span-2612" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2613">N</span><span class="MJXp-mi" id="MJXp-Span-2614">log</span><span class="MJXp-mo" id="MJXp-Span-2615" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2616">N</span><span class="MJXp-mo" id="MJXp-Span-2617" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mfrac" id="MJXp-Span-2618" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2619">N</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2620">B</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-2621" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-2622" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mrow" id="MJXp-Span-2623"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-2624">O</span></span><span class="MJXp-mo" id="MJXp-Span-2625" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mfrac" id="MJXp-Span-2626" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-msubsup" id="MJXp-Span-2627"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2628" style="margin-right: 0.05em;">N</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2629" style="vertical-align: 0.5em;">2</span></span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2630">B</span></span></span></span></span></span><span class="MJXp-mi" id="MJXp-Span-2631">log</span><span class="MJXp-mo" id="MJXp-Span-2632" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2633">N</span><span class="MJXp-mo" id="MJXp-Span-2634" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-337">\mathcal{O}(N \log N \cdot \frac{N}{B}) = \mathcal{O}(\frac{N^2}{B} \log N)</script> time.</p></li>   <li><p>For all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2635"><span class="MJXp-mn" id="MJXp-Span-2636">0</span><span class="MJXp-mo" id="MJXp-Span-2637" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2638">k</span><span class="MJXp-mo" id="MJXp-Span-2639" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2640">B</span></span></span><script type="math/tex" id="MathJax-Element-338">0 \le k \le B</script>, precompute <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2641"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2642">F</span><span class="MJXp-mo" id="MJXp-Span-2643" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2644">k</span><span class="MJXp-mo" id="MJXp-Span-2645" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-339">F(k)</script>. This takes <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2646"><span class="MJXp-mrow" id="MJXp-Span-2647"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-2648">O</span></span><span class="MJXp-mo" id="MJXp-Span-2649" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-2650"><span class="MJXp-mrow" id="MJXp-Span-2651" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2652">B</span></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2653" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-2654" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-340">\mathcal{O}({B}^2)</script> time.</p></li>   <li><p>For each query, find the respective coefficient of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2655"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2656">F</span><span class="MJXp-mo" id="MJXp-Span-2657" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2658">n</span><span class="MJXp-mo" id="MJXp-Span-2659" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-2660" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mrow" id="MJXp-Span-2661"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-2662">F</span></span><span class="MJXp-mo" id="MJXp-Span-2663" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mrow" id="MJXp-Span-2664"><span class="MJXp-mrow" id="MJXp-Span-2665"><span class="MJXp-mo" id="MJXp-Span-2666" style="margin-left: 0em; margin-right: 0em;">⌊</span><span class="MJXp-mrow" id="MJXp-Span-2667"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2668">n</span><span class="MJXp-mrow" id="MJXp-Span-2669"><span class="MJXp-mo" id="MJXp-Span-2670" style="margin-left: 0.111em; margin-right: 0.111em;">/</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2671">B</span></span><span class="MJXp-mo" id="MJXp-Span-2672" style="margin-left: 0em; margin-right: 0em;">⌋</span></span></span><span class="MJXp-mo" id="MJXp-Span-2673" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2674">F</span><span class="MJXp-mo" id="MJXp-Span-2675" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2676">n</span><span class="MJXp-mo" id="MJXp-Span-2677" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2678">B</span><span class="MJXp-mo" id="MJXp-Span-2679" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-341">F(n)=\mathcal{F}({\left \lfloor{n/B}\right \rfloor}) F(n \bmod B)</script>. This takes <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2680"><span class="MJXp-mrow" id="MJXp-Span-2681"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-2682">O</span></span><span class="MJXp-mo" id="MJXp-Span-2683" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mo" id="MJXp-Span-2684" style="margin-left: 0.333em; margin-right: 0.333em;">min</span><span class="MJXp-mo" id="MJXp-Span-2685" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2686">N</span><span class="MJXp-mo" id="MJXp-Span-2687" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2688">B</span><span class="MJXp-mo" id="MJXp-Span-2689" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-2690" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-2691" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mrow" id="MJXp-Span-2692"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-2693">O</span></span><span class="MJXp-mo" id="MJXp-Span-2694" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2695">B</span><span class="MJXp-mo" id="MJXp-Span-2696" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-342">\mathcal{O}(\min(N,B))=\mathcal{O}(B)</script> time.</p></li> </ul><p>Then, we achieve an algorithm that runs in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2697"><span class="MJXp-mrow" id="MJXp-Span-2698"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-2699">O</span></span><span class="MJXp-mo" id="MJXp-Span-2700" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mfrac" id="MJXp-Span-2701" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-msubsup" id="MJXp-Span-2702"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2703" style="margin-right: 0.05em;">N</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2704" style="vertical-align: 0.5em;">2</span></span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2705">B</span></span></span></span></span></span><span class="MJXp-mi" id="MJXp-Span-2706">log</span><span class="MJXp-mo" id="MJXp-Span-2707" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2708">N</span><span class="MJXp-mo" id="MJXp-Span-2709" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-2710"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2711" style="margin-right: 0.05em;">B</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2712" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-2713" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2714">Q</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2715">B</span><span class="MJXp-mo" id="MJXp-Span-2716" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-343">\mathcal{O}(\frac{N^2}{B}\log N + B^2 + QB)</script> time. By adjusting <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2717"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2718">B</span></span></span><script type="math/tex" id="MathJax-Element-344">B</script> to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2719"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2720">B</span><span class="MJXp-mo" id="MJXp-Span-2721" style="margin-left: 0.333em; margin-right: 0.333em;">≈</span><span class="MJXp-msqrt" id="MJXp-Span-2722"><span class="MJXp-surd"><span style="font-size: 134%; margin-top: 0.104em;">√</span></span><span class="MJXp-root"><span class="MJXp-rule" style="border-top: 0.08em solid;"></span><span class="MJXp-box"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2723">N</span><span class="MJXp-mi" id="MJXp-Span-2724">log</span><span class="MJXp-mo" id="MJXp-Span-2725" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2726">N</span></span></span></span></span></span><script type="math/tex" id="MathJax-Element-345">B \approx \sqrt{N \log N}</script>, we can achieve an algorithm that runs in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2727"><span class="MJXp-mrow" id="MJXp-Span-2728"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-2729">O</span></span><span class="MJXp-mo" id="MJXp-Span-2730" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mo" id="MJXp-Span-2731" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2732">N</span><span class="MJXp-mo" id="MJXp-Span-2733" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2734">Q</span><span class="MJXp-mo" id="MJXp-Span-2735" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-msqrt" id="MJXp-Span-2736"><span class="MJXp-surd"><span style="font-size: 134%; margin-top: 0.104em;">√</span></span><span class="MJXp-root"><span class="MJXp-rule" style="border-top: 0.08em solid;"></span><span class="MJXp-box"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2737">N</span><span class="MJXp-mi" id="MJXp-Span-2738">log</span><span class="MJXp-mo" id="MJXp-Span-2739" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2740">N</span></span></span></span><span class="MJXp-mo" id="MJXp-Span-2741" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-346">\mathcal{O}((N+Q)\sqrt{N \log N})</script> time.</p><p>We only have two issues left:</p> <ul>   <li>We have to compute the prefix sum of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2742"><span class="MJXp-mo" id="MJXp-Span-2743" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-msubsup" id="MJXp-Span-2744"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2745" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2746" style="vertical-align: 0.5em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-2747" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2748">F</span><span class="MJXp-mo" id="MJXp-Span-2749" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2750">n</span><span class="MJXp-mo" id="MJXp-Span-2751" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-347">[x^i]F(n)</script> instead of just <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2752"><span class="MJXp-mo" id="MJXp-Span-2753" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-msubsup" id="MJXp-Span-2754"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2755" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2756" style="vertical-align: 0.5em;">k</span></span><span class="MJXp-mo" id="MJXp-Span-2757" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2758">F</span><span class="MJXp-mo" id="MJXp-Span-2759" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2760">n</span><span class="MJXp-mo" id="MJXp-Span-2761" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-348">[x^k]F(n)</script>.</li>   <li>Our algorithm is going to be slow, especially under the modulus <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2762"><span class="MJXp-msubsup" id="MJXp-Span-2763"><span class="MJXp-mn" id="MJXp-Span-2764" style="margin-right: 0.05em;">10</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2765" style="vertical-align: 0.5em;">9</span></span><span class="MJXp-mo" id="MJXp-Span-2766" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-2767">7</span></span></span><script type="math/tex" id="MathJax-Element-349">10^9+7</script> which makes FFT quite inconvenient.</li> </ul><p>For the first issue, observe the following:</p> <ul>   <li>Define a polynomial <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2768"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2769">G</span><span class="MJXp-mo" id="MJXp-Span-2770" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2771">n</span><span class="MJXp-mo" id="MJXp-Span-2772" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-350">G(n)</script> of infinite degree such that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2773"><span class="MJXp-mo" id="MJXp-Span-2774" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-msubsup" id="MJXp-Span-2775"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2776" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2777" style="vertical-align: 0.5em;">k</span></span><span class="MJXp-mo" id="MJXp-Span-2778" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2779">G</span><span class="MJXp-mo" id="MJXp-Span-2780" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2781">n</span><span class="MJXp-mo" id="MJXp-Span-2782" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-2783" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-munderover" id="MJXp-Span-2784"><span><span class="MJXp-over"><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-2790" style="margin-right: 0px; margin-left: 0px;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2791">k</span></span></span><span class=""><span class="MJXp-mo" id="MJXp-Span-2785" style="margin-left: 0.111em; margin-right: 0.167em;">∑</span></span></span></span><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-2786" style="margin-left: 0px;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2787">i</span><span class="MJXp-mo" id="MJXp-Span-2788">=</span><span class="MJXp-mn" id="MJXp-Span-2789">0</span></span></span></span><span class="MJXp-mo" id="MJXp-Span-2792" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-msubsup" id="MJXp-Span-2793"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2794" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2795" style="vertical-align: 0.5em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-2796" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2797">F</span><span class="MJXp-mo" id="MJXp-Span-2798" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2799">n</span><span class="MJXp-mo" id="MJXp-Span-2800" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-351">[x^k]G(n)=\sum_\limits{i=0}^{k}[x^i]F(n)</script>. Then, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2801"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2802">G</span><span class="MJXp-mo" id="MJXp-Span-2803" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2804">n</span><span class="MJXp-mo" id="MJXp-Span-2805" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2806">m</span><span class="MJXp-mo" id="MJXp-Span-2807" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-2808" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2809">G</span><span class="MJXp-mo" id="MJXp-Span-2810" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2811">n</span><span class="MJXp-mo" id="MJXp-Span-2812" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2813">F</span><span class="MJXp-mo" id="MJXp-Span-2814" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2815">m</span><span class="MJXp-mo" id="MJXp-Span-2816" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-352">G(n+m) = G(n) F(m)</script> holds for all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2817"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2818">n</span><span class="MJXp-mo" id="MJXp-Span-2819" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2820">m</span><span class="MJXp-mo" id="MJXp-Span-2821" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mn" id="MJXp-Span-2822">0</span></span></span><script type="math/tex" id="MathJax-Element-353">n,m \ge 0</script>.</li> </ul><p>The proof is left as a practice for the reader.</p><p>Then, we can transform <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2823"><span class="MJXp-mrow" id="MJXp-Span-2824"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-2825">F</span></span><span class="MJXp-mo" id="MJXp-Span-2826" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2827">k</span><span class="MJXp-mo" id="MJXp-Span-2828" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-2829" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2830">F</span><span class="MJXp-mo" id="MJXp-Span-2831" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2832">k</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2833">B</span><span class="MJXp-mo" id="MJXp-Span-2834" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-354">\mathcal{F}(k)=F(kB)</script> to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2835"><span class="MJXp-mrow" id="MJXp-Span-2836"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-2837">G</span></span><span class="MJXp-mo" id="MJXp-Span-2838" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2839">k</span><span class="MJXp-mo" id="MJXp-Span-2840" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-2841" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2842">G</span><span class="MJXp-mo" id="MJXp-Span-2843" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2844">k</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2845">B</span><span class="MJXp-mo" id="MJXp-Span-2846" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-355">\mathcal{G}(k)=G(kB)</script> easily in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2847"><span class="MJXp-mrow" id="MJXp-Span-2848"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-2849">O</span></span><span class="MJXp-mo" id="MJXp-Span-2850" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2851">N</span><span class="MJXp-mo" id="MJXp-Span-2852" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-356">\mathcal{O}(N)</script> time for each, and then the algorithm can compute the respective coefficient of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2853"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2854">G</span><span class="MJXp-mo" id="MJXp-Span-2855" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2856">n</span><span class="MJXp-mo" id="MJXp-Span-2857" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-2858" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mrow" id="MJXp-Span-2859"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-2860">G</span></span><span class="MJXp-mo" id="MJXp-Span-2861" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mrow" id="MJXp-Span-2862"><span class="MJXp-mrow" id="MJXp-Span-2863"><span class="MJXp-mo" id="MJXp-Span-2864" style="margin-left: 0em; margin-right: 0em;">⌊</span><span class="MJXp-mrow" id="MJXp-Span-2865"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2866">n</span><span class="MJXp-mrow" id="MJXp-Span-2867"><span class="MJXp-mo" id="MJXp-Span-2868" style="margin-left: 0.111em; margin-right: 0.111em;">/</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2869">B</span></span><span class="MJXp-mo" id="MJXp-Span-2870" style="margin-left: 0em; margin-right: 0em;">⌋</span></span></span><span class="MJXp-mo" id="MJXp-Span-2871" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2872">F</span><span class="MJXp-mo" id="MJXp-Span-2873" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2874">n</span><span class="MJXp-mo" id="MJXp-Span-2875" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2876">B</span><span class="MJXp-mo" id="MJXp-Span-2877" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-357">G(n)=\mathcal{G}({\left \lfloor{n/B}\right \rfloor})F(n \bmod B)</script> in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2878"><span class="MJXp-mrow" id="MJXp-Span-2879"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-2880">O</span></span><span class="MJXp-mo" id="MJXp-Span-2881" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mo" id="MJXp-Span-2882" style="margin-left: 0.333em; margin-right: 0.333em;">min</span><span class="MJXp-mo" id="MJXp-Span-2883" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi" id="MJXp-Span-2884">∞</span><span class="MJXp-mo" id="MJXp-Span-2885" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2886">B</span><span class="MJXp-mo" id="MJXp-Span-2887" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-2888" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-2889" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mrow" id="MJXp-Span-2890"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-2891">O</span></span><span class="MJXp-mo" id="MJXp-Span-2892" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2893">B</span><span class="MJXp-mo" id="MJXp-Span-2894" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-358">\mathcal{O}(\min(\infty,B))=\mathcal{O}(B)</script> time likewise. It is not required to save infinitely many coefficients of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2895"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2896">G</span><span class="MJXp-mo" id="MJXp-Span-2897" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2898">n</span><span class="MJXp-mo" id="MJXp-Span-2899" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-359">G(n)</script>; the coefficients <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2900"><span class="MJXp-mo" id="MJXp-Span-2901" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-msubsup" id="MJXp-Span-2902"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2903" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2904" style="vertical-align: 0.5em;">k</span></span><span class="MJXp-mo" id="MJXp-Span-2905" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2906">G</span><span class="MJXp-mo" id="MJXp-Span-2907" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2908">n</span><span class="MJXp-mo" id="MJXp-Span-2909" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-360">[x^k]G(n)</script> are constant for <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2910"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2911">k</span><span class="MJXp-mo" id="MJXp-Span-2912" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-mn" id="MJXp-Span-2913">2</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2914">n</span></span></span><script type="math/tex" id="MathJax-Element-361">k>2n</script>. Thus we have resolved the first issue.</p><p>For the second issue, observe the following:</p> <ul>   <li><p>By expressing <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2915"><span class="MJXp-mo" id="MJXp-Span-2916" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2917">F</span><span class="MJXp-mo" id="MJXp-Span-2918" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2919">n</span><span class="MJXp-mo" id="MJXp-Span-2920" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-2921">1</span><span class="MJXp-mo" id="MJXp-Span-2922" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-msup" id="MJXp-Span-2923"><span class="MJXp-mo" id="MJXp-Span-2924" style="margin-left: 0em; margin-right: 0.05em;">)</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-2925" style="vertical-align: 0.5em;">′</span></span></span></span><script type="math/tex" id="MathJax-Element-362">(F(n+1))'</script> in two ways, we can conclude that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2926"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2927">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2928">F</span><span class="MJXp-mo" id="MJXp-Span-2929" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2930">n</span><span class="MJXp-mo" id="MJXp-Span-2931" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-2932" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2933">F</span><span class="MJXp-mo" id="MJXp-Span-2934" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-2935">1</span><span class="MJXp-mo" id="MJXp-Span-2936" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-msup" id="MJXp-Span-2937"><span class="MJXp-mo" id="MJXp-Span-2938" style="margin-left: 0em; margin-right: 0.05em;">)</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-2939" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-2940" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-2941" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2942">F</span><span class="MJXp-mo" id="MJXp-Span-2943" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2944">n</span><span class="MJXp-mo" id="MJXp-Span-2945" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-msup" id="MJXp-Span-2946"><span class="MJXp-mo" id="MJXp-Span-2947" style="margin-left: 0em; margin-right: 0.05em;">)</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-2948" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2949">F</span><span class="MJXp-mo" id="MJXp-Span-2950" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-2951">1</span><span class="MJXp-mo" id="MJXp-Span-2952" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-363">n F(n) (F(1))' = (F(n))'F(1)</script>.</p></li>   <li><p>Then, comparing the coefficients of both sides, we can derive the coefficients of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2953"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2954">F</span><span class="MJXp-mo" id="MJXp-Span-2955" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2956">n</span><span class="MJXp-mo" id="MJXp-Span-2957" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-364">F(n)</script> in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2958"><span class="MJXp-mrow" id="MJXp-Span-2959"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-2960">O</span></span><span class="MJXp-mo" id="MJXp-Span-2961" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2962">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2963">k</span><span class="MJXp-mo" id="MJXp-Span-2964" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-365">\mathcal{O}(nk)</script> time where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2965"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2966">k</span><span class="MJXp-mo" id="MJXp-Span-2967" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi" id="MJXp-Span-2968">deg</span><span class="MJXp-mo" id="MJXp-Span-2969" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-2970" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2971">F</span><span class="MJXp-mo" id="MJXp-Span-2972" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-2973">1</span><span class="MJXp-mo" id="MJXp-Span-2974" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-2975" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-2976" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mrow" id="MJXp-Span-2977"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-2978">O</span></span><span class="MJXp-mo" id="MJXp-Span-2979" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-2980">1</span><span class="MJXp-mo" id="MJXp-Span-2981" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-366">k=\operatorname{deg}(F(1))=\mathcal{O}(1)</script>.</p></li> </ul><p>This gives us an alternative way to precompute polynomials <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2982"><span class="MJXp-mrow" id="MJXp-Span-2983"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-2984">F</span></span><span class="MJXp-mo" id="MJXp-Span-2985" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2986">k</span><span class="MJXp-mo" id="MJXp-Span-2987" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-2988" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2989">F</span><span class="MJXp-mo" id="MJXp-Span-2990" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2991">k</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2992">B</span><span class="MJXp-mo" id="MJXp-Span-2993" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-367">\mathcal{F}(k)=F(kB)</script>, and using this, the algorithm will run in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2994"><span class="MJXp-mrow" id="MJXp-Span-2995"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-2996">O</span></span><span class="MJXp-mo" id="MJXp-Span-2997" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mfrac" id="MJXp-Span-2998" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-msubsup" id="MJXp-Span-2999"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3000" style="margin-right: 0.05em;">N</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3001" style="vertical-align: 0.5em;">2</span></span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3002">B</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-3003" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-3004"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3005" style="margin-right: 0.05em;">B</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3006" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-3007" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3008">Q</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3009">B</span><span class="MJXp-mo" id="MJXp-Span-3010" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-368">\mathcal{O}(\frac{N^2}{B} + B^2 + QB)</script> time. By adjusting <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3011"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3012">B</span></span></span><script type="math/tex" id="MathJax-Element-369">B</script> to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3013"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3014">B</span><span class="MJXp-mo" id="MJXp-Span-3015" style="margin-left: 0.333em; margin-right: 0.333em;">≈</span><span class="MJXp-msqrt" id="MJXp-Span-3016"><span class="MJXp-surd"><span style="font-size: 134%; margin-top: 0.104em;">√</span></span><span class="MJXp-root"><span class="MJXp-rule" style="border-top: 0.08em solid;"></span><span class="MJXp-box"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3017">N</span></span></span></span></span></span><script type="math/tex" id="MathJax-Element-370">B \approx \sqrt{N}</script>, we achieve an algorithm that runs in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3018"><span class="MJXp-mrow" id="MJXp-Span-3019"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-3020">O</span></span><span class="MJXp-mo" id="MJXp-Span-3021" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mo" id="MJXp-Span-3022" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3023">N</span><span class="MJXp-mo" id="MJXp-Span-3024" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3025">Q</span><span class="MJXp-mo" id="MJXp-Span-3026" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-msqrt" id="MJXp-Span-3027"><span class="MJXp-surd"><span style="font-size: 134%; margin-top: 0.104em;">√</span></span><span class="MJXp-root"><span class="MJXp-rule" style="border-top: 0.08em solid;"></span><span class="MJXp-box"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3028">N</span></span></span></span><span class="MJXp-mo" id="MJXp-Span-3029" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-371">\mathcal{O}((N+Q)\sqrt{N})</script> and does not use FFT. This fits nicely in the given time limit of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3030"><span class="MJXp-mn" id="MJXp-Span-3031">7</span></span></span><script type="math/tex" id="MathJax-Element-372">7</script> seconds.</p><p>Depending on implementation, some smaller values of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3032"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3033">B</span></span></span><script type="math/tex" id="MathJax-Element-373">B</script> might lead to a MLE verdict. However, if this happens, your submission should fail on the first test case as the precomputation itself uses the most amount of memory. It is fine to adjust the value of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3034"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3035">B</span></span></span><script type="math/tex" id="MathJax-Element-374">B</script> larger as there is quite some margin in the time limit. Slower programming languages might also get a TLE verdict, but the implementation for the intended solution should be simple enough to be translated to C++ in a few minutes.</p></div></div> <div class="spoiler"><b class="spoiler-title">Code (chromate00)</b><div class="spoiler-content" style="display: block;"><p><a href="https://codeforces.com/contest/2159/submission/343542463" title="Submission 343542463 by chromate00">343542463</a></p></div></div><p><a href="https://codeforces.com/contest/2159/problem/F" title="Codeforces Round 1058 (Div. 1)">2159F - Grand Finale: Snakes</a></p><p>Problem Credit: <a class="rated-user user-orange" href="https://codeforces.com/profile/wuhudsm" title="Master wuhudsm">wuhudsm</a></p> <div class="spoiler"><b class="spoiler-title">Rate the problem!</b><div class="spoiler-content" style="display: block;"><ul>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="12756">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="18">18</span>
            </i>
        </a>
    </span>


 Epic</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="12757">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="6">6</span>
            </i>
        </a>
    </span>


 Good</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="12758">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="3">3</span>
            </i>
        </a>
    </span>


 Moderate</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="12759">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="0">0</span>
            </i>
        </a>
    </span>


 Bad</li>   <li>

    <span class="likeForm ">
        <a class="likeActionLink" title="I like this" href="https://codeforces.com/data/like?action=like" data-likeableid="12760">
            <i class="likeState icon-thumbs-up">
                <span class="likeCount" data-value="15">15</span>
            </i>
        </a>
    </span>


 Horrendous</li> </ul></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><p>An important observation is that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3036"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3037">f</span><span class="MJXp-mo" id="MJXp-Span-3038" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3039">l</span><span class="MJXp-mo" id="MJXp-Span-3040" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3041">p</span><span class="MJXp-mo" id="MJXp-Span-3042" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3043">i</span><span class="MJXp-mo" id="MJXp-Span-3044" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-375">f(l, p+i)</script> is unimodal for <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3045"><span class="MJXp-mn" id="MJXp-Span-3046">1</span><span class="MJXp-mo" id="MJXp-Span-3047" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3048">i</span><span class="MJXp-mo" id="MJXp-Span-3049" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3050">l</span></span></span><script type="math/tex" id="MathJax-Element-376">1 \le i \le l</script>.</p><p><strong>Proof</strong>: If <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3051"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3052">f</span><span class="MJXp-mo" id="MJXp-Span-3053" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3054">l</span><span class="MJXp-mo" id="MJXp-Span-3055" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3056">x</span><span class="MJXp-mo" id="MJXp-Span-3057" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-3058" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3059">f</span><span class="MJXp-mo" id="MJXp-Span-3060" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3061">l</span><span class="MJXp-mo" id="MJXp-Span-3062" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3063">x</span><span class="MJXp-mo" id="MJXp-Span-3064" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-3065">1</span><span class="MJXp-mo" id="MJXp-Span-3066" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-377">f(l, x) < f(l, x+1)</script>, then the snake head at time <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3067"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3068">T</span><span class="MJXp-mo" id="MJXp-Span-3069" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3070">x</span><span class="MJXp-mo" id="MJXp-Span-3071" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-3072">1</span></span></span><script type="math/tex" id="MathJax-Element-378">T = x+1</script> is the maximum value, and this value will not leave the snake's body until at least <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3073"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3074">l</span></span></span><script type="math/tex" id="MathJax-Element-379">l</script> seconds later.</p><p>Thus, for a snake of length <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3075"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3076">l</span></span></span><script type="math/tex" id="MathJax-Element-380">l</script>, we can divide it into <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3077"><span class="MJXp-mo" id="MJXp-Span-3078" style="margin-left: 0em; margin-right: 0em;">⌊</span><span class="MJXp-mfrac" id="MJXp-Span-3079" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3080">n</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3081">l</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-3082" style="margin-left: 0em; margin-right: 0em;">⌋</span></span></span><script type="math/tex" id="MathJax-Element-381">\lfloor \frac{n}{l} \rfloor</script> segments and perform ternary search on each segment. The total number of segments is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3083"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3084">O</span><span class="MJXp-mo" id="MJXp-Span-3085" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3086">n</span><span class="MJXp-mi" id="MJXp-Span-3087">log</span><span class="MJXp-mo" id="MJXp-Span-3088" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3089">n</span><span class="MJXp-mo" id="MJXp-Span-3090" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-382">O(n \log n)</script>, and the total number of queries is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3091"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3092">O</span><span class="MJXp-mo" id="MJXp-Span-3093" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3094">n</span><span class="MJXp-msubsup" id="MJXp-Span-3095"><span class="MJXp-mi" id="MJXp-Span-3096" style="margin-right: 0.05em;">log</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3097" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-3098" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3099">n</span><span class="MJXp-mo" id="MJXp-Span-3100" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-383">O(n \log^2 n)</script>.</p><p>We also need to handle the case where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3101"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3102">f</span><span class="MJXp-mo" id="MJXp-Span-3103" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3104">l</span><span class="MJXp-mo" id="MJXp-Span-3105" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-3106"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3107" style="margin-right: 0.05em;">M</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3108" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-3109" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-3110" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3111">f</span><span class="MJXp-mo" id="MJXp-Span-3112" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3113">l</span><span class="MJXp-mo" id="MJXp-Span-3114" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-3115"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3116" style="margin-right: 0.05em;">M</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3117" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-3118" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-384">f(l, M_1) = f(l, M_2)</script>. Suppose <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3119"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3120">i</span><span class="MJXp-mo" id="MJXp-Span-3121" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-mn" id="MJXp-Span-3122">1</span></span></span><script type="math/tex" id="MathJax-Element-385">i > 1</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3123"><span class="MJXp-msubsup" id="MJXp-Span-3124"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3125" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-3126" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3127">i</span><span class="MJXp-mo" id="MJXp-Span-3128">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3129">j</span></span></span><span class="MJXp-mo" id="MJXp-Span-3130" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3131">f</span><span class="MJXp-mo" id="MJXp-Span-3132" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3133">l</span><span class="MJXp-mo" id="MJXp-Span-3134" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-3135"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3136" style="margin-right: 0.05em;">M</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3137" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-3138" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-3139" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3140">f</span><span class="MJXp-mo" id="MJXp-Span-3141" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3142">l</span><span class="MJXp-mo" id="MJXp-Span-3143" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-3144"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3145" style="margin-right: 0.05em;">M</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3146" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-3147" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-386">a_{i,j} = f(l, M_1) = f(l, M_2)</script>, the snake reaches <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3148"><span class="MJXp-msubsup" id="MJXp-Span-3149"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3150" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-3151" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3152">i</span><span class="MJXp-mo" id="MJXp-Span-3153">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3154">j</span></span></span></span></span><script type="math/tex" id="MathJax-Element-387">a_{i,j}</script> at time <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3155"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3156">T</span><span class="MJXp-mo" id="MJXp-Span-3157" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3158">i</span><span class="MJXp-mo" id="MJXp-Span-3159" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3160">j</span><span class="MJXp-mo" id="MJXp-Span-3161" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-3162">1</span></span></span><script type="math/tex" id="MathJax-Element-388">T = i + j - 1</script>. We determine whether <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3163"><span class="MJXp-msubsup" id="MJXp-Span-3164"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3165" style="margin-right: 0.05em;">M</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3166" style="vertical-align: -0.4em;">1</span></span></span></span><script type="math/tex" id="MathJax-Element-389">M_1</script> is in the increasing or decreasing half by querying <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3167"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3168">f</span><span class="MJXp-mo" id="MJXp-Span-3169" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3170">l</span><span class="MJXp-mo" id="MJXp-Span-3171" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3172">i</span><span class="MJXp-mo" id="MJXp-Span-3173" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3174">j</span><span class="MJXp-mo" id="MJXp-Span-3175" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-3176">2</span><span class="MJXp-mo" id="MJXp-Span-3177" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-390">f(l, i + j - 2)</script>. A similar approach is used for <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3178"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3179">i</span><span class="MJXp-mo" id="MJXp-Span-3180" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-3181">1</span></span></span><script type="math/tex" id="MathJax-Element-391">i = 1</script>.</p><p>After this, we obtain several monotonic contiguous segments. The classic priority queue method is used to obtain the top <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3182"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3183">m</span></span></span><script type="math/tex" id="MathJax-Element-392">m</script> smallest values.</p></div></div> <div class="spoiler"><b class="spoiler-title">Code (wuhudsm)</b><div class="spoiler-content" style="display: block;"><p><a href="https://codeforces.com/contest/2159/submission/343542554" title="Submission 343542554 by chromate00">343542554</a></p></div></div></div>

    </div>


        <div style="font-size: 1.1rem;line-height: 1.1rem;padding-bottom: 0.5em;">
            <img src="https://codeforces.com//codeforces.com/codeforces.org/s/52448/images/icons/paperclip-16x16.png" style="vertical-align: middle;"> <span style="padding: 0 0.35em;">Tutorial of <a href="https://codeforces.com/contest/2159" class="notice" style="text-decoration: none;">Codeforces Round 1058 (Div. 1)</a> </span>
        </div>
        <div style="font-size: 1.1rem;line-height: 1.1rem;padding-bottom: 0.5em;">
            <img src="https://codeforces.com//codeforces.com/codeforces.org/s/52448/images/icons/paperclip-16x16.png" style="vertical-align: middle;"> <span style="padding: 0 0.35em;">Tutorial of <a href="https://codeforces.com/contest/2160" class="notice" style="text-decoration: none;">Codeforces Round 1058 (Div. 2)</a> </span>
        </div>
        
            

  <script>
    // Make all spoilers toggleable
    document.querySelectorAll('.spoiler-title').forEach(title => {
      title.addEventListener('click', function() {
        const spoiler = this.closest('.spoiler');
        spoiler.classList.toggle('open');
      });
    });
    
    // Open all spoilers by default for easier reading
    document.querySelectorAll('.spoiler').forEach(spoiler => {
      spoiler.classList.add('open');
    });
  </script>
</body>
</html>