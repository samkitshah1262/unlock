<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tutorial</title>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
      line-height: 1.6;
      color: #333;
      background: #fafafa;
    }
    .ttypography {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    h3 {
      color: #1a1a1a;
      border-bottom: 2px solid #eee;
      padding-bottom: 10px;
    }
    h3 a {
      color: #0066cc;
      text-decoration: none;
    }
    h3 a:hover {
      text-decoration: underline;
    }
    .spoiler {
      margin: 15px 0;
      border: 1px solid #ddd;
      border-radius: 6px;
      overflow: hidden;
    }
    .spoiler-title {
      display: block;
      padding: 12px 15px;
      background: #f0f0f0;
      cursor: pointer;
      font-weight: 600;
      user-select: none;
      border-bottom: 1px solid #ddd;
    }
    .spoiler-title:hover {
      background: #e8e8e8;
    }
    .spoiler-title::before {
      content: '▶ ';
      font-size: 0.8em;
      transition: transform 0.2s;
      display: inline-block;
    }
    .spoiler.open .spoiler-title::before {
      content: '▼ ';
    }
    .spoiler-content {
      padding: 15px;
      background: #fff;
      display: none;
    }
    .spoiler.open .spoiler-content {
      display: block;
    }
    pre, code {
      background: #f5f5f5;
      font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
      font-size: 0.85em;
    }
    pre {
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
    }
    code {
      padding: 2px 5px;
      border-radius: 3px;
    }
    p {
      margin: 10px 0;
    }
    .MathJax {
      font-size: 1.1em;
    }
  </style>
</head>
<body>
  <h1>Editorial</h1>
  <p><a href="https://codeforces.com/blog/entry/146347" target="_blank">View on Codeforces →</a></p>
  
  <div class="ttypography"><p>I hope you liked the problems! Thank you for participation. I am sorry that the difference between H and I turned out to be that big, I didn't expect that so many people would solve H.</p><p>The contest was prepared by me, <a class="rated-user user-violet" href="https://codeforces.com/profile/Neon" title="Candidate Master Neon">Neon</a>, <a class="rated-user user-orange" href="https://codeforces.com/profile/adedalic" title="International Master adedalic">adedalic</a>, <a class="rated-user user-orange" href="https://codeforces.com/profile/FelixArg" title="Master FelixArg">FelixArg</a> and <a class="rated-user user-orange" href="https://codeforces.com/profile/Roms" title="Master Roms">Roms</a>. I would like to express my gratitude to the testers who helped us improve the contest: <a class="rated-user user-red" href="https://codeforces.com/profile/pashka" title="International Grandmaster pashka">pashka</a>, <a class="rated-user user-red" href="https://codeforces.com/profile/shnirelman" title="International Grandmaster shnirelman">shnirelman</a> and <a class="rated-user user-red" href="https://codeforces.com/profile/awoo" title="Grandmaster awoo">awoo</a>.</p><p>See you in the next episode of Kotlin Heroes... sometime in the future (probably near the end of 2025).</p><p><a href="https://codeforces.com/contest/2141/problem/A" title="Kotlin Heroes: Episode 13">2141A - Furniture Store</a></p><p>Idea: <a class="rated-user user-red" href="https://codeforces.com/profile/BledDest" title="International Grandmaster BledDest">BledDest</a>, preparation: <a class="rated-user user-violet" href="https://codeforces.com/profile/Neon" title="Candidate Master Neon">Neon</a></p> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2141/problem/A" title="Kotlin Heroes: Episode 13">2141A - Furniture Store</a></h3><div class="ttypography"><div class="problem-statement"><div><p>Observe that if there exists a model $$$j$$$ such that $$$j &lt; i$$$ and $$$a_j &lt; a_i$$$, no one will order the $$$i$$$-th model. Therefore, to solve the problem, we can iterate through the array, maintaining the minimum value on the prefix. If the next element is less than the minimum, then this model will be ordered. Otherwise, it must be included in the answer.</p><p>There is a more beautiful way to solve this problem, though it was not required. You can form an array of minimums on all prefixes of the given array (to do this, the function <span class="tex-font-style-tt">runningReduce</span> can help; it also allows to make an array of prefix sums or most other functions on prefix). Then, a model can be ordered if and only if it is the minimum on its prefix; you can use <span class="tex-font-style-tt">filter</span> to find those which are not minimums on the corresponding prefixes.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Solution (Neon)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="pln">fun main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> repeat</span><span class="pun">(</span><span class="pln">readln</span><span class="pun">().</span><span class="pln">toInt</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  val n </span><span class="pun">=</span><span class="pln"> readln</span><span class="pun">().</span><span class="pln">toInt</span><span class="pun">()</span><span class="pln">
  val a </span><span class="pun">=</span><span class="pln"> readln</span><span class="pun">().</span><span class="pln">split</span><span class="pun">(</span><span class="str">" "</span><span class="pun">).</span><span class="pln">map </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">toInt</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
  val p </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">runningReduce </span><span class="pun">{</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> y </span><span class="pun">-&gt;</span><span class="pln"> minOf</span><span class="pun">(</span><span class="pln">x</span><span class="pun">,</span><span class="pln"> y</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
  val ans </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="lit">1.</span><span class="pun">.</span><span class="pln">n</span><span class="pun">).</span><span class="pln">filter </span><span class="pun">{</span><span class="pln"> i </span><span class="pun">-&gt;</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> p</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
  println</span><span class="pun">(</span><span class="pln">ans</span><span class="pun">.</span><span class="pln">size</span><span class="pun">)</span><span class="pln">
  println</span><span class="pun">(</span><span class="pln">ans</span><span class="pun">.</span><span class="pln">joinToString</span><span class="pun">(</span><span class="str">" "</span><span class="pun">))</span><span class="pln">    
</span><span class="pun">}</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2141/problem/B" title="Kotlin Heroes: Episode 13">2141B - Games</a></p><p>Idea: <a class="rated-user user-red" href="https://codeforces.com/profile/BledDest" title="International Grandmaster BledDest">BledDest</a>, preparation: <a class="rated-user user-violet" href="https://codeforces.com/profile/Neon" title="Candidate Master Neon">Neon</a></p> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2141/problem/B" title="Kotlin Heroes: Episode 13">2141B - Games</a></h3><div class="ttypography"><div class="problem-statement"><div><p>To keep the series of suggestions running as long as possible, players must first name the games that only one of them likes. Let $$$x$$$ be the number of games that only Alice likes, and $$$y$$$ be the number of games that only Bob likes. Then to solve the problem, you can either simulate the process by decreasing $$$x$$$ and $$$y$$$ alternately until one reaches $$$0$$$, or calculate the answer using a formula: $$$2\cdot\min(x, y) + 2$$$ if $$$x &gt; y$$$, and $$$2\cdot\min(x, y) + 1$$$ otherwise (the difference in formulas is due to the alternating turns).</p><p>In <span class="tex-font-style-tt">Kotlin</span>, you can use <span class="tex-font-style-tt">a.intersect(b).size</span> (let's denote it $$$k$$$) to calculate the number of games that both Alice and Bob like, then $$$x=n-k$$$ and $$$y=m-k$$$.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Solution (Neon)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="pln">fun main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> repeat</span><span class="pun">(</span><span class="pln">readln</span><span class="pun">().</span><span class="pln">toInt</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  val </span><span class="pun">(</span><span class="pln">n</span><span class="pun">,</span><span class="pln"> m</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> readln</span><span class="pun">().</span><span class="pln">split</span><span class="pun">(</span><span class="str">" "</span><span class="pun">).</span><span class="pln">map </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">toInt</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
  val a </span><span class="pun">=</span><span class="pln"> readln</span><span class="pun">().</span><span class="pln">split</span><span class="pun">(</span><span class="str">" "</span><span class="pun">).</span><span class="pln">map </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">toInt</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
  val b </span><span class="pun">=</span><span class="pln"> readln</span><span class="pun">().</span><span class="pln">split</span><span class="pun">(</span><span class="str">" "</span><span class="pun">).</span><span class="pln">map </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">toInt</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
  val k </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">intersect</span><span class="pun">(</span><span class="pln">b</span><span class="pun">).</span><span class="pln">size
  println</span><span class="pun">(</span><span class="lit">2</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> minOf</span><span class="pun">(</span><span class="pln">n </span><span class="pun">-</span><span class="pln"> k</span><span class="pun">,</span><span class="pln"> m </span><span class="pun">-</span><span class="pln"> k</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">n </span><span class="pun">&gt;</span><span class="pln"> m</span><span class="pun">)</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2141/problem/C" title="Kotlin Heroes: Episode 13">2141C - Minimum on Subarrays</a></p><p>Idea: <a class="rated-user user-orange" href="https://codeforces.com/profile/FelixArg" title="Master FelixArg">FelixArg</a>, preparation: <a class="rated-user user-orange" href="https://codeforces.com/profile/FelixArg" title="Master FelixArg">FelixArg</a></p> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2141/problem/C" title="Kotlin Heroes: Episode 13">2141C - Minimum on Subarrays</a></h3><div class="ttypography"><div class="problem-statement"><div><p>Using the structure described in the problem statement, we need to iterate through each subarray of the array and call the operation <span class="tex-font-style-tt">min</span> for it.</p><p>One way to do this is as follows:</p><ul> <li> We start by adding all elements to the end of the structure and calling the <span class="tex-font-style-tt">min</span> operation after each <span class="tex-font-style-tt">pushback</span>. This way, we will iterate through all segments of the form <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1"><span class="MJXp-mo" id="MJXp-Span-2" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mn" id="MJXp-Span-3">0</span><span class="MJXp-mo" id="MJXp-Span-4" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5">p</span><span class="MJXp-mo" id="MJXp-Span-6" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-1">[0, p]</script>, where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-7"><span class="MJXp-mn" id="MJXp-Span-8">0</span><span class="MJXp-mo" id="MJXp-Span-9" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-10">p</span><span class="MJXp-mo" id="MJXp-Span-11" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-12">n</span></span></span><script type="math/tex" id="MathJax-Element-2">0 \le p < n</script>. </li><li> Next, we will remove elements from the beginning of the structure, that is, we will call <span class="tex-font-style-tt">popfront</span> and <span class="tex-font-style-tt">min</span>. This way, we will iterate through all segments of the form <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-13"><span class="MJXp-mo" id="MJXp-Span-14" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-15">p</span><span class="MJXp-mo" id="MJXp-Span-16" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-17">n</span><span class="MJXp-mo" id="MJXp-Span-18" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-19">1</span><span class="MJXp-mo" id="MJXp-Span-20" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-3">[p, n-1]</script>, where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-21"><span class="MJXp-mn" id="MJXp-Span-22">1</span><span class="MJXp-mo" id="MJXp-Span-23" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-24">p</span><span class="MJXp-mo" id="MJXp-Span-25" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-26">n</span></span></span><script type="math/tex" id="MathJax-Element-4">1 < p < n</script>. </li><li> After that, we will have an empty structure, and we will process all prefixes and suffixes of the array <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-27"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-28">a</span></span></span><script type="math/tex" id="MathJax-Element-5">a</script>. Therefore, we will repeat this process for the subarray <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-29"><span class="MJXp-mo" id="MJXp-Span-30" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mn" id="MJXp-Span-31">1</span><span class="MJXp-mo" id="MJXp-Span-32" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-33">n</span><span class="MJXp-mo" id="MJXp-Span-34" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-35">2</span><span class="MJXp-mo" id="MJXp-Span-36" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-6">[1, n-2]</script>. </li></ul><p>Let's estimate the number of operations in this algorithm. Each prefix and suffix requires one operation to iterate through it and one operation to call <span class="tex-font-style-tt">min</span>. Thus, we can express the number of operations as:</p><p><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-37"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-38">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-39">p</span><span class="MJXp-mo" id="MJXp-Span-40" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-munderover" id="MJXp-Span-41"><span><span class="MJXp-over"><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-47" style="margin-right: 0px; margin-left: 0px;"><span class="MJXp-mfrac" id="MJXp-Span-48" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-49">n</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mn" id="MJXp-Span-50">2</span></span></span></span></span></span></span></span><span class=""><span class="MJXp-mo" id="MJXp-Span-42" style="margin-left: 0.111em; margin-right: 0.167em;"><span class="MJXp-largeop">∑</span></span></span></span></span><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-43" style="margin-left: 0px;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-44">i</span><span class="MJXp-mo" id="MJXp-Span-45">=</span><span class="MJXp-mn" id="MJXp-Span-46">0</span></span></span></span><span class="MJXp-mn" id="MJXp-Span-51">4</span><span class="MJXp-mo" id="MJXp-Span-52" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mo" id="MJXp-Span-53" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-54">2</span><span class="MJXp-mo" id="MJXp-Span-55" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-56">i</span><span class="MJXp-mo" id="MJXp-Span-57" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex; mode=display" id="MathJax-Element-7">op = \sum_{i = 0}^{\frac{n}{2}} 4 \cdot (2 \cdot i)</script></p><p>From this, we get:</p><p><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-58"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-59">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-60">p</span><span class="MJXp-mo" id="MJXp-Span-61" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-62">4</span><span class="MJXp-mo" id="MJXp-Span-63" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mfrac" id="MJXp-Span-64" style="vertical-align: 0.25em;"><span class="MJXp-box"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-65">n</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box"><span class="MJXp-mn" id="MJXp-Span-66">2</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-67" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mo" id="MJXp-Span-68" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mfrac" id="MJXp-Span-69" style="vertical-align: 0.25em;"><span class="MJXp-box"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-70">n</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box"><span class="MJXp-mn" id="MJXp-Span-71">2</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-72" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-73">1</span><span class="MJXp-mo" id="MJXp-Span-74" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-75" style="margin-left: 0.333em; margin-right: 0.333em;">≈</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-76">n</span><span class="MJXp-mo" id="MJXp-Span-77" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mo" id="MJXp-Span-78" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-79">n</span><span class="MJXp-mo" id="MJXp-Span-80" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-81">1</span><span class="MJXp-mo" id="MJXp-Span-82" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-83" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-84">n</span><span class="MJXp-mo" id="MJXp-Span-85" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mo" id="MJXp-Span-86" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-87">n</span><span class="MJXp-mo" id="MJXp-Span-88" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-89">2</span><span class="MJXp-mo" id="MJXp-Span-90" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex; mode=display" id="MathJax-Element-8">op = 4 \cdot \frac{n}{2} \cdot (\frac{n}{2} + 1) \approx n \cdot (n + 1) < n \cdot (n + 2)</script></p><p>Therefore, this algorithm solves the problem.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Solution (pashka)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="lit">@file</span><span class="pun">:</span><span class="typ">Suppress</span><span class="pun">(</span><span class="str">"CanBeVal"</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">io</span><span class="pun">.</span><span class="typ">BufferedReader</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">io</span><span class="pun">.</span><span class="typ">InputStreamReader</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">io</span><span class="pun">.</span><span class="typ">OutputStreamWriter</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">io</span><span class="pun">.</span><span class="typ">PrintWriter</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.*</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> kotlin</span><span class="pun">.</span><span class="pln">math</span><span class="pun">.</span><span class="pln">max
</span><span class="kwd">import</span><span class="pln"> kotlin</span><span class="pun">.</span><span class="pln">math</span><span class="pun">.</span><span class="pln">min

</span><span class="kwd">private</span><span class="pln"> fun solveTest</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    val n </span><span class="pun">=</span><span class="pln"> readInt</span><span class="pun">()</span><span class="pln">
    val res </span><span class="pun">=</span><span class="pln"> emptyList</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;().</span><span class="pln">toMutableList</span><span class="pun">()</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="kwd">in</span><span class="pln"> </span><span class="lit">0.</span><span class="pun">.</span><span class="pln">n </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="pun">%</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">j </span><span class="kwd">in</span><span class="pln"> i</span><span class="pun">..</span><span class="pln">n </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                res</span><span class="pun">.</span><span class="kwd">add</span><span class="pun">(</span><span class="str">"pushfront a["</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> j </span><span class="pun">+</span><span class="pln"> </span><span class="str">"]"</span><span class="pun">)</span><span class="pln">
                res</span><span class="pun">.</span><span class="kwd">add</span><span class="pun">(</span><span class="str">"min"</span><span class="pun">)</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
            res</span><span class="pun">.</span><span class="kwd">add</span><span class="pun">(</span><span class="str">"popback"</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">j </span><span class="kwd">in</span><span class="pln"> i</span><span class="pun">..</span><span class="pln">n </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                res</span><span class="pun">.</span><span class="kwd">add</span><span class="pun">(</span><span class="str">"min"</span><span class="pun">)</span><span class="pln">
                res</span><span class="pun">.</span><span class="kwd">add</span><span class="pun">(</span><span class="str">"popfront"</span><span class="pun">)</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    println</span><span class="pun">(</span><span class="pln">res</span><span class="pun">.</span><span class="pln">size</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">s </span><span class="kwd">in</span><span class="pln"> res</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        println</span><span class="pun">(</span><span class="pln">s</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">private</span><span class="pln"> fun solve</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
</span><span class="com">//    repeat(readInt()) {</span><span class="pln">
    solveTest</span><span class="pun">()</span><span class="pln">
</span><span class="com">//    }</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="com">// TEMPLATE</span><span class="pln">
fun main</span><span class="pun">(</span><span class="pln">args</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Array</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    reader </span><span class="pun">=</span><span class="pln"> </span><span class="typ">BufferedReader</span><span class="pun">(</span><span class="typ">InputStreamReader</span><span class="pun">(</span><span class="typ">System</span><span class="pun">.</span><span class="str">`in`</span><span class="pun">))</span><span class="pln">
    </span><span class="kwd">out</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">PrintWriter</span><span class="pun">(</span><span class="typ">OutputStreamWriter</span><span class="pun">(</span><span class="typ">System</span><span class="pun">.</span><span class="kwd">out</span><span class="pun">))</span><span class="pln">
    solve</span><span class="pun">()</span><span class="pln">
    </span><span class="kwd">out</span><span class="pun">.</span><span class="pln">close</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">private</span><span class="pln"> lateinit </span><span class="kwd">var</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">:</span><span class="pln"> </span><span class="typ">PrintWriter</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> lateinit </span><span class="kwd">var</span><span class="pln"> reader</span><span class="pun">:</span><span class="pln"> </span><span class="typ">BufferedReader</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">var</span><span class="pln"> tokenizer</span><span class="pun">:</span><span class="pln"> </span><span class="typ">StringTokenizer</span><span class="pun">?</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun read</span><span class="pun">():</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">tokenizer </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> </span><span class="pun">!</span><span class="pln">tokenizer</span><span class="pun">!!.</span><span class="pln">hasMoreTokens</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        tokenizer </span><span class="pun">=</span><span class="pln"> </span><span class="typ">StringTokenizer</span><span class="pun">(</span><span class="pln">readLn</span><span class="pun">())</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> tokenizer</span><span class="pun">!!.</span><span class="pln">nextToken</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">private</span><span class="pln"> fun readInt</span><span class="pun">()</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> read</span><span class="pun">().</span><span class="pln">toInt</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun readLong</span><span class="pun">()</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> read</span><span class="pun">().</span><span class="pln">toLong</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun readLn</span><span class="pun">()</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> reader</span><span class="pun">.</span><span class="pln">readLine</span><span class="pun">()!!</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun readInts</span><span class="pun">()</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> readLn</span><span class="pun">().</span><span class="pln">split</span><span class="pun">(</span><span class="str">" "</span><span class="pun">).</span><span class="pln">map </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">toInt</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun readInts</span><span class="pun">(</span><span class="pln">sz</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Array</span><span class="pun">(</span><span class="pln">sz</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> readInt</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun readLongs</span><span class="pun">()</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> readLn</span><span class="pun">().</span><span class="pln">split</span><span class="pun">(</span><span class="str">" "</span><span class="pun">).</span><span class="pln">map </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">toLong</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun readLongs</span><span class="pun">(</span><span class="pln">sz</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Array</span><span class="pun">(</span><span class="pln">sz</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> readLong</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun </span><span class="kwd">print</span><span class="pun">(</span><span class="pln">b</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Boolean</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="kwd">print</span><span class="pun">(</span><span class="pln">b</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun </span><span class="kwd">print</span><span class="pun">(</span><span class="pln">i</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="kwd">print</span><span class="pun">(</span><span class="pln">i</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun </span><span class="kwd">print</span><span class="pun">(</span><span class="pln">d</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Double</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="kwd">print</span><span class="pun">(</span><span class="pln">d</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun </span><span class="kwd">print</span><span class="pun">(</span><span class="pln">l</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Long</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="kwd">print</span><span class="pun">(</span><span class="pln">l</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun </span><span class="kwd">print</span><span class="pun">(</span><span class="pln">s</span><span class="pun">:</span><span class="pln"> </span><span class="typ">String</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="kwd">print</span><span class="pun">(</span><span class="pln">s</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun </span><span class="kwd">print</span><span class="pun">(</span><span class="pln">message</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Any</span><span class="pun">?)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="kwd">print</span><span class="pun">(</span><span class="pln">message</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun </span><span class="kwd">print</span><span class="pun">(</span><span class="pln">a</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Array</span><span class="pun">&lt;</span><span class="typ">Int</span><span class="pun">&gt;)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">forEach </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">print</span><span class="pun">(</span><span class="str">"$it "</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun </span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;</span><span class="pln"> </span><span class="kwd">print</span><span class="pun">(</span><span class="pln">a</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Array</span><span class="pun">&lt;</span><span class="kwd">out</span><span class="pln"> T</span><span class="pun">&gt;)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">forEach </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">print</span><span class="pun">(</span><span class="str">"$it "</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun </span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;</span><span class="pln"> </span><span class="kwd">print</span><span class="pun">(</span><span class="pln">a</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Collection</span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">forEach </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">print</span><span class="pun">(</span><span class="str">"$it "</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun println</span><span class="pun">(</span><span class="pln">b</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Boolean</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="pln">b</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun println</span><span class="pun">(</span><span class="pln">i</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="pln">i</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun println</span><span class="pun">(</span><span class="pln">d</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Double</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="pln">d</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun println</span><span class="pun">(</span><span class="pln">l</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Long</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="pln">l</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun println</span><span class="pun">(</span><span class="pln">s</span><span class="pun">:</span><span class="pln"> </span><span class="typ">String</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="pln">s</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun println</span><span class="pun">()</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="pln">println</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun println</span><span class="pun">(</span><span class="pln">message</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Any</span><span class="pun">?)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="pln">message</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun </span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;</span><span class="pln"> println</span><span class="pun">(</span><span class="pln">a</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Array</span><span class="pun">&lt;</span><span class="kwd">out</span><span class="pln"> T</span><span class="pun">&gt;)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">forEach </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">print</span><span class="pun">(</span><span class="str">"$it "</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    println</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">private</span><span class="pln"> fun println</span><span class="pun">(</span><span class="pln">a</span><span class="pun">:</span><span class="pln"> </span><span class="typ">IntArray</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">forEach </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">print</span><span class="pun">(</span><span class="str">"$it "</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    println</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">private</span><span class="pln"> fun println</span><span class="pun">(</span><span class="pln">a</span><span class="pun">:</span><span class="pln"> </span><span class="typ">LongArray</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">forEach </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">print</span><span class="pun">(</span><span class="str">"$it "</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    println</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">private</span><span class="pln"> fun </span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;</span><span class="pln"> println</span><span class="pun">(</span><span class="pln">a</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Collection</span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">forEach </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">print</span><span class="pun">(</span><span class="str">"$it "</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    println</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">private</span><span class="pln"> fun intarr</span><span class="pun">(</span><span class="pln">sz</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">,</span><span class="pln"> v</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">IntArray</span><span class="pun">(</span><span class="pln">sz</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> v </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun longarr</span><span class="pun">(</span><span class="pln">sz</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">,</span><span class="pln"> v</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">LongArray</span><span class="pun">(</span><span class="pln">sz</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> v </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun intarr2d</span><span class="pun">(</span><span class="pln">n</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">,</span><span class="pln"> m</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">,</span><span class="pln"> v</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Array</span><span class="pun">(</span><span class="pln">n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> intarr</span><span class="pun">(</span><span class="pln">m</span><span class="pun">,</span><span class="pln"> v</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun longarr2d</span><span class="pun">(</span><span class="pln">n</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">,</span><span class="pln"> m</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">,</span><span class="pln"> v</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Array</span><span class="pun">(</span><span class="pln">n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> longarr</span><span class="pun">(</span><span class="pln">m</span><span class="pun">,</span><span class="pln"> v</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun </span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;</span><span class="pln"> init</span><span class="pun">(</span><span class="pln">vararg elements</span><span class="pun">:</span><span class="pln"> T</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> elements
</span><span class="kwd">private</span><span class="pln"> fun VI</span><span class="pun">(</span><span class="pln">n</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> init</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">MutableList</span><span class="pun">(</span><span class="pln">n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> init </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun VVI</span><span class="pun">(</span><span class="pln">n</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> m</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> init</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">MutableList</span><span class="pun">(</span><span class="pln">n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> VI</span><span class="pun">(</span><span class="pln">m</span><span class="pun">,</span><span class="pln"> init</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun </span><span class="pun">&lt;</span><span class="pln">T1 </span><span class="pun">:</span><span class="pln"> </span><span class="typ">Comparable</span><span class="pun">&lt;</span><span class="pln">T1</span><span class="pun">&gt;,</span><span class="pln"> T2 </span><span class="pun">:</span><span class="pln"> </span><span class="typ">Comparable</span><span class="pun">&lt;</span><span class="pln">T2</span><span class="pun">&gt;&gt;</span><span class="pln"> pairCmp</span><span class="pun">():</span><span class="pln"> </span><span class="typ">Comparator</span><span class="pun">&lt;</span><span class="typ">Pair</span><span class="pun">&lt;</span><span class="pln">T1</span><span class="pun">,</span><span class="pln"> T2</span><span class="pun">&gt;&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Comparator</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> b </span><span class="pun">-&gt;</span><span class="pln">
        val res </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">first</span><span class="pun">.</span><span class="pln">compareTo</span><span class="pun">(</span><span class="pln">b</span><span class="pun">.</span><span class="pln">first</span><span class="pun">)</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">res </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">second</span><span class="pun">.</span><span class="pln">compareTo</span><span class="pun">(</span><span class="pln">b</span><span class="pun">.</span><span class="pln">second</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> res
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">


</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2141/problem/D" title="Kotlin Heroes: Episode 13">2141D - Avoid Minimums</a></p><p>Idea: <a class="rated-user user-red" href="https://codeforces.com/profile/BledDest" title="International Grandmaster BledDest">BledDest</a>, preparation: <a class="rated-user user-orange" href="https://codeforces.com/profile/adedalic" title="International Master adedalic">adedalic</a></p> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2141/problem/D" title="Kotlin Heroes: Episode 13">2141D - Avoid Minimums</a></h3><div class="ttypography"><div class="problem-statement"><div><p>Let's say that an operation that gives you a coin is a "good" operation.</p><p>Suppose that the resulting value of elements of the array <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-91"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-92">a</span></span></span><script type="math/tex" id="MathJax-Element-9">a</script> is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-93"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-94">v</span></span></span><script type="math/tex" id="MathJax-Element-10">v</script>. Let's prove that it's optimal to make <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-95"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-96">v</span></span></span><script type="math/tex" id="MathJax-Element-11">v</script> as big as possible. It will be obvious if we prove that the total profit to make <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-97"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-98">v</span></span></span><script type="math/tex" id="MathJax-Element-12">v</script> is greater than or equal to the total profit of making <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-99"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-100">v</span><span class="MJXp-mo" id="MJXp-Span-101" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-102">1</span></span></span><script type="math/tex" id="MathJax-Element-13">v - 1</script>.</p><p>Let's take the best strategy to make values <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-103"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-104">v</span><span class="MJXp-mo" id="MJXp-Span-105" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-106">1</span></span></span><script type="math/tex" id="MathJax-Element-14">v - 1</script> and then let's increase each <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-107"><span class="MJXp-msubsup" id="MJXp-Span-108"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-109" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-110" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-15">a_i</script> by <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-111"><span class="MJXp-mn" id="MJXp-Span-112">1</span></span></span><script type="math/tex" id="MathJax-Element-16">1</script>. We'll get the whole array equal to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-113"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-114">v</span></span></span><script type="math/tex" id="MathJax-Element-17">v</script>. Each new operation will be "bad" (since each element is equal to the current minimum), so the <span class="tex-font-style-it">current</span> profit will be equal to the maximum profit to make <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-115"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-116">v</span><span class="MJXp-mo" id="MJXp-Span-117" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-118">1</span></span></span><script type="math/tex" id="MathJax-Element-18">v - 1</script>. But it means that the <span class="tex-font-style-it">maximum</span> profit for <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-119"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-120">v</span></span></span><script type="math/tex" id="MathJax-Element-19">v</script> is at least the maximum profit for <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-121"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-122">v</span><span class="MJXp-mo" id="MJXp-Span-123" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-124">1</span></span></span><script type="math/tex" id="MathJax-Element-20">v - 1</script> or even bigger. So, maximizing the resulting value <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-125"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-126">v</span></span></span><script type="math/tex" id="MathJax-Element-21">v</script> is always optimal.</p><p>Let's calculate the maximum value <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-127"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-128">v</span></span></span><script type="math/tex" id="MathJax-Element-22">v</script>: since we have only <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-129"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-130">k</span></span></span><script type="math/tex" id="MathJax-Element-23">k</script> operations, then the total increase of elements can't exceed <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-131"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-132">k</span></span></span><script type="math/tex" id="MathJax-Element-24">k</script>. In other words, we need the maximum <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-133"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-134">v</span></span></span><script type="math/tex" id="MathJax-Element-25">v</script> such that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-135"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-136">n</span><span class="MJXp-mo" id="MJXp-Span-137" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-138">v</span><span class="MJXp-mo" id="MJXp-Span-139" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-140"><span class="MJXp-mo" id="MJXp-Span-141" style="margin-left: 0.111em; margin-right: 0.05em;">∑</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mrow" id="MJXp-Span-146"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-147">n</span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mrow" id="MJXp-Span-142"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-143">i</span><span class="MJXp-mo" id="MJXp-Span-144">=</span><span class="MJXp-mn" id="MJXp-Span-145">1</span></span></span></span></span></span></span><span class="MJXp-mrow" id="MJXp-Span-148"><span class="MJXp-msubsup" id="MJXp-Span-149"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-150" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-151" style="vertical-align: -0.4em;">i</span></span></span><span class="MJXp-mo" id="MJXp-Span-152" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-153">k</span></span></span><script type="math/tex" id="MathJax-Element-26">n \cdot v - \sum_{i=1}^{n}{a_i} \le k</script>, or <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-154"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-155">v</span><span class="MJXp-mo" id="MJXp-Span-156" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mrow" id="MJXp-Span-157"><span class="MJXp-mo" id="MJXp-Span-158" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.867em;"><span class="MJXp-right MJXp-scale3" style="font-size: 4.467em; margin-left: -0.28em;">⌊</span></span><span class="MJXp-mfrac" id="MJXp-Span-159" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-160">k</span><span class="MJXp-mo" id="MJXp-Span-161">+</span><span class="MJXp-msubsup" id="MJXp-Span-162"><span class="MJXp-mo" id="MJXp-Span-163" style="margin-right: 0.05em;">∑</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mrow" id="MJXp-Span-168"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-169">n</span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mrow" id="MJXp-Span-164"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-165">i</span><span class="MJXp-mo" id="MJXp-Span-166">=</span><span class="MJXp-mn" id="MJXp-Span-167">1</span></span></span></span></span></span></span><span class="MJXp-mrow" id="MJXp-Span-170"><span class="MJXp-msubsup" id="MJXp-Span-171"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-172" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-173" style="vertical-align: -0.4em;">i</span></span></span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-174">n</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-175" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.867em;"><span class="MJXp-right MJXp-scale3" style="font-size: 4.467em; margin-left: -0.28em;">⌋</span></span></span></span></span><script type="math/tex" id="MathJax-Element-27">v = \left\lfloor \frac{k + \sum_{i=1}^{n}{a_i}}{n} \right\rfloor</script>.</p><p>Ok, we found the desired value <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-176"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-177">v</span></span></span><script type="math/tex" id="MathJax-Element-28">v</script>, now we need to maximize the number of good operations. Since the total number of operations to reach <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-178"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-179">v</span></span></span><script type="math/tex" id="MathJax-Element-29">v</script> is constant now, we can minimize the number of bad operations instead.</p><p>What is the minimum possible number of bad operations? Obviously, each <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-180"><span class="MJXp-msubsup" id="MJXp-Span-181"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-182" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-183" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-30">a_i</script> that is equal to the minimum in the initial array needs at least one bad operation to increase it.</p><p>Also, since the array <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-184"><span class="MJXp-msubsup" id="MJXp-Span-185"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-186" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-187" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-188" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-189"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-190" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-191" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-192" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-193" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-194" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-195"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-196" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-197" style="vertical-align: -0.4em;">n</span></span></span></span><script type="math/tex" id="MathJax-Element-31">a_1, a_2, \dots, a_n</script> transforms to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-198"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-199">v</span><span class="MJXp-mo" id="MJXp-Span-200" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-201">v</span><span class="MJXp-mo" id="MJXp-Span-202" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-203" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-204" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-205">v</span></span></span><script type="math/tex" id="MathJax-Element-32">v, v, \dots, v</script>, then its minimum will go from <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-208"><span class="MJXp-mo" id="MJXp-Span-209" style="margin-left: 0.333em; margin-right: 0.333em;">min</span><span class="MJXp-mrow" id="MJXp-Span-210"><span class="MJXp-msubsup" id="MJXp-Span-211"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-212" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-213" style="vertical-align: -0.4em;">i</span></span></span></span></span><script type="math/tex" id="MathJax-Element-33">\min{a_i}</script> to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-214"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-215">v</span></span></span><script type="math/tex" id="MathJax-Element-34">v</script>, "visiting" all intermediate values <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-216"><span class="MJXp-mo" id="MJXp-Span-217" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mo" id="MJXp-Span-218" style="margin-left: 0.333em; margin-right: 0.333em;">min</span><span class="MJXp-mrow" id="MJXp-Span-219"><span class="MJXp-msubsup" id="MJXp-Span-220"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-221" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-222" style="vertical-align: -0.4em;">i</span></span></span><span class="MJXp-mo" id="MJXp-Span-223" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-224">1</span><span class="MJXp-mo" id="MJXp-Span-225" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-226" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-227" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mo" id="MJXp-Span-228" style="margin-left: 0.333em; margin-right: 0.333em;">min</span><span class="MJXp-mrow" id="MJXp-Span-229"><span class="MJXp-msubsup" id="MJXp-Span-230"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-231" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-232" style="vertical-align: -0.4em;">i</span></span></span><span class="MJXp-mo" id="MJXp-Span-233" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-234">2</span><span class="MJXp-mo" id="MJXp-Span-235" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-236" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-237" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-238" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-239" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-240">v</span><span class="MJXp-mo" id="MJXp-Span-241" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-242">1</span><span class="MJXp-mo" id="MJXp-Span-243" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-35">(\min{a_i} + 1), (\min{a_i} + 2), \dots, (v - 1)</script>. Since for each intermediate value there will be at least one minimum equal to it, then there will be at least one bad operation for each intermediate value.</p><p>In total, the number of bad operations can't be less than <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-244"><span class="MJXp-mo" id="MJXp-Span-245" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mrow" id="MJXp-Span-246"><span class="MJXp-mtext" id="MJXp-Span-247">number of minimums in&nbsp;</span><span class="MJXp-mrow" id="MJXp-Span-248"></span><span class="MJXp-mrow" id="MJXp-Span-249"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-250">a</span></span><span class="MJXp-mrow" id="MJXp-Span-251"></span></span><span class="MJXp-mo" id="MJXp-Span-252" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-253" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mo" id="MJXp-Span-254" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-255">v</span><span class="MJXp-mo" id="MJXp-Span-256" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mo" id="MJXp-Span-257" style="margin-left: 0.333em; margin-right: 0.333em;">min</span><span class="MJXp-mrow" id="MJXp-Span-258"><span class="MJXp-msubsup" id="MJXp-Span-259"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-260" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-261" style="vertical-align: -0.4em;">i</span></span></span><span class="MJXp-mo" id="MJXp-Span-262" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-263">1</span><span class="MJXp-mo" id="MJXp-Span-264" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-36">(\text{number of minimums in $$$a$$$}) + (v - \min{a_i} - 1)</script>. And, actually, it can be reached with the following greedy algorithm: let's iterate <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-265"><span class="MJXp-msubsup" id="MJXp-Span-266"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-267" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-268" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-37">a_i</script> in descending order and increase them to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-269"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-270">v</span></span></span><script type="math/tex" id="MathJax-Element-38">v</script> one by one.</p><p>The number of good operations is equal to the total number of operations <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-271"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-272">n</span><span class="MJXp-mo" id="MJXp-Span-273" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-274">v</span><span class="MJXp-mo" id="MJXp-Span-275" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mo" id="MJXp-Span-276" style="margin-left: 0.111em; margin-right: 0.167em;">∑</span><span class="MJXp-mrow" id="MJXp-Span-277"><span class="MJXp-msubsup" id="MJXp-Span-278"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-279" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-280" style="vertical-align: -0.4em;">i</span></span></span></span></span><script type="math/tex" id="MathJax-Element-39">n \cdot v - \sum{a_i}</script> minus the number of bad operations, and can be calculated in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-281"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-282">O</span><span class="MJXp-mo" id="MJXp-Span-283" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-284">n</span><span class="MJXp-mo" id="MJXp-Span-285" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-40">O(n)</script> time. Note that the formula for bad operations assumes that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-286"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-287">v</span><span class="MJXp-mo" id="MJXp-Span-288" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-mo" id="MJXp-Span-289" style="margin-left: 0.333em; margin-right: 0.333em;">min</span><span class="MJXp-mrow" id="MJXp-Span-290"><span class="MJXp-msubsup" id="MJXp-Span-291"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-292" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-293" style="vertical-align: -0.4em;">i</span></span></span></span></span><script type="math/tex" id="MathJax-Element-41">v > \min{a_i}</script>.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Solution (adedalic)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="pln">fun main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    repeat</span><span class="pun">(</span><span class="pln">readln</span><span class="pun">().</span><span class="pln">toInt</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        val </span><span class="pun">(</span><span class="pln">n</span><span class="pun">,</span><span class="pln"> k</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> readln</span><span class="pun">().</span><span class="pln">split</span><span class="pun">(</span><span class="str">' '</span><span class="pun">).</span><span class="pln">map </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">toLong</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
        val a </span><span class="pun">=</span><span class="pln"> readln</span><span class="pun">().</span><span class="pln">split</span><span class="pun">(</span><span class="str">' '</span><span class="pun">).</span><span class="pln">map </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">toLong</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
        </span><span class="com">// n * resVal - a.sum() &lt;= k</span><span class="pln">
        val resVal </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">k </span><span class="pun">+</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">sum</span><span class="pun">())</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> n
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">resVal </span><span class="pun">&lt;</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">maxOrNull</span><span class="pun">()!!)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            println</span><span class="pun">(-</span><span class="lit">1</span><span class="pun">)</span><span class="pln">
            </span><span class="kwd">return</span><span class="lit">@repeat</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        val minEl </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">minOrNull</span><span class="pun">()!!</span><span class="pln">
        </span><span class="kwd">var</span><span class="pln"> ans </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">sumOf </span><span class="pun">{</span><span class="pln"> resVal </span><span class="pun">-</span><span class="pln"> it </span><span class="pun">}</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">(</span><span class="pln">resVal </span><span class="pun">-</span><span class="pln"> minEl</span><span class="pun">)</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">minEl </span><span class="pun">&lt;</span><span class="pln"> resVal</span><span class="pun">)</span><span class="pln">
            ans </span><span class="pun">-=</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">count </span><span class="pun">{</span><span class="pln"> it </span><span class="pun">==</span><span class="pln"> minEl </span><span class="pun">}</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
        println</span><span class="pun">(</span><span class="pln">ans</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2141/problem/E" title="Kotlin Heroes: Episode 13">2141E - Perfect Cut</a></p><p>Idea: <a class="rated-user user-orange" href="https://codeforces.com/profile/FelixArg" title="Master FelixArg">FelixArg</a>, preparation: <a class="rated-user user-violet" href="https://codeforces.com/profile/Neon" title="Candidate Master Neon">Neon</a></p> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2141/problem/E" title="Kotlin Heroes: Episode 13">2141E - Perfect Cut</a></h3><div class="ttypography"><div class="problem-statement"><div><p>First, let's understand when a string is perfect. Note that if the string begins with <span class="tex-font-style-tt">1</span>, we can cut the prefix of length <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-294"><span class="MJXp-mn" id="MJXp-Span-295">1</span></span></span><script type="math/tex" id="MathJax-Element-42">1</script>, so the string is perfect. If it starts with <span class="tex-font-style-tt">0</span>, the suffix must also begin with <span class="tex-font-style-tt">0</span>. In this case, we can pick the second <span class="tex-font-style-tt">0</span> in the string, then the prefix looks like <span class="tex-font-style-tt">0111...111</span>, and the suffix starts with <span class="tex-font-style-tt">0</span>(the other characters of the suffix are irrelevant since there are ones in the prefix).</p><p>Thus, a string is not perfect only if it starts with <span class="tex-font-style-tt">0</span> and all other characters are <span class="tex-font-style-tt">1</span>.</p><p>To solve the problem, let's consider two cases. If the first character of the string is <span class="tex-font-style-tt">1</span> or <span class="tex-font-style-tt">?</span> (in the case we replace the first <span class="tex-font-style-tt">?</span> with <span class="tex-font-style-tt">1</span>), then all other question marks can be replaced with any characters, giving us <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-296"><span class="MJXp-msubsup" id="MJXp-Span-297"><span class="MJXp-mn" id="MJXp-Span-298" style="margin-right: 0.05em;">2</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-299" style="vertical-align: 0.5em;">k</span></span></span></span><script type="math/tex" id="MathJax-Element-43">2^k</script> possible ways, where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-300"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-301">k</span></span></span><script type="math/tex" id="MathJax-Element-44">k</script> is the total number of question marks after the first position.</p><p>If the first character of the string is <span class="tex-font-style-tt">0</span> or <span class="tex-font-style-tt">?</span> (in the case we replace the first <span class="tex-font-style-tt">?</span> with <span class="tex-font-style-tt">0</span>), then all subsequent question marks can be replaced with any character, yielding <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-302"><span class="MJXp-msubsup" id="MJXp-Span-303"><span class="MJXp-mn" id="MJXp-Span-304" style="margin-right: 0.05em;">2</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-305" style="vertical-align: 0.5em;">k</span></span></span></span><script type="math/tex" id="MathJax-Element-45">2^k</script> ways, except for the case when there are no zeroes after the first character. If there are no zeroes, we cannot replace all question marks with ones, resulting in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-306"><span class="MJXp-msubsup" id="MJXp-Span-307"><span class="MJXp-mn" id="MJXp-Span-308" style="margin-right: 0.05em;">2</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-309" style="vertical-align: 0.5em;">k</span></span><span class="MJXp-mo" id="MJXp-Span-310" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-311">1</span></span></span><script type="math/tex" id="MathJax-Element-46">2^k - 1</script> ways.</p><p>Another way to solve the problem is to calculate the total number of ways to replace question marks (which is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-312"><span class="MJXp-msubsup" id="MJXp-Span-313"><span class="MJXp-mn" id="MJXp-Span-314" style="margin-right: 0.05em;">2</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-315" style="vertical-align: 0.5em;">q</span></span></span></span><script type="math/tex" id="MathJax-Element-47">2^q</script>, where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-316"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-317">q</span></span></span><script type="math/tex" id="MathJax-Element-48">q</script> is the number of question marks) and subtract the number of ways to get an imperfect string (which is either <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-318"><span class="MJXp-mn" id="MJXp-Span-319">0</span></span></span><script type="math/tex" id="MathJax-Element-49">0</script> or <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-320"><span class="MJXp-mn" id="MJXp-Span-321">1</span></span></span><script type="math/tex" id="MathJax-Element-50">1</script>, depending on whether we can get the string <span class="tex-font-style-tt">0111...</span>).</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Solution (Neon)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="kwd">const</span><span class="pln"> val MOD </span><span class="pun">=</span><span class="pln"> </span><span class="lit">998244353</span><span class="pun">;</span><span class="pln">

fun main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> repeat</span><span class="pun">(</span><span class="pln">readln</span><span class="pun">().</span><span class="pln">toInt</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  val s </span><span class="pun">=</span><span class="pln"> readln</span><span class="pun">()</span><span class="pln">
  </span><span class="kwd">var</span><span class="pln"> pw </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
  repeat</span><span class="pun">(</span><span class="pln">s</span><span class="pun">.</span><span class="pln">drop</span><span class="pun">(</span><span class="lit">1</span><span class="pun">).</span><span class="pln">count </span><span class="pun">{</span><span class="pln"> it </span><span class="pun">==</span><span class="pln"> </span><span class="str">'?'</span><span class="pln"> </span><span class="pun">})</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    pw </span><span class="pun">=</span><span class="pln"> pw </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> MOD
  </span><span class="pun">}</span><span class="pln">
  </span><span class="kwd">var</span><span class="pln"> ans </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
  </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">s</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'1'</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> s</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'?'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    ans </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">ans </span><span class="pun">+</span><span class="pln"> pw</span><span class="pun">)</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> MOD
  </span><span class="pun">}</span><span class="pln">
  </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">s</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'0'</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> s</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'?'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    val x </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">s</span><span class="pun">.</span><span class="pln">indexOf</span><span class="pun">(</span><span class="str">'0'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> 
    ans </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">ans </span><span class="pun">+</span><span class="pln"> pw </span><span class="pun">-</span><span class="pln"> x</span><span class="pun">)</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> MOD
  </span><span class="pun">}</span><span class="pln">
  println</span><span class="pun">(</span><span class="pln">ans</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2141/problem/F" title="Kotlin Heroes: Episode 13">2141F - Array Reduction</a></p><p>Idea: <a class="rated-user user-orange" href="https://codeforces.com/profile/Roms" title="Master Roms">Roms</a>, preparation: <a class="rated-user user-orange" href="https://codeforces.com/profile/Roms" title="Master Roms">Roms</a></p> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2141/problem/F" title="Kotlin Heroes: Episode 13">2141F - Array Reduction</a></h3><div class="ttypography"><div class="problem-statement"><div><p>Let's slightly change the problem: we will learn to calculate the maximum number of elements we can remove for each number of operations. From this, it is quite easy to obtain the answer to the original problem (considering that if we can remove <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-322"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-323">m</span></span></span><script type="math/tex" id="MathJax-Element-51">m</script> elements in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-324"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-325">k</span></span></span><script type="math/tex" id="MathJax-Element-52">k</script> operations, we can also remove any number of elements less than <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-326"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-327">m</span></span></span><script type="math/tex" id="MathJax-Element-53">m</script> in no more than <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-328"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-329">k</span></span></span><script type="math/tex" id="MathJax-Element-54">k</script> operations).</p><p>It is clear that in this version of the problem, we need to either remove one occurrence of all elements or all occurrences of the most frequent element during each operation. Let's construct a new array <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-330"><span class="MJXp-msubsup" id="MJXp-Span-331"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-332" style="margin-right: 0.05em;">C</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-333" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-334" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-335"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-336" style="margin-right: 0.05em;">C</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-337" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-338" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-339" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-340" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-341"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-342" style="margin-right: 0.05em;">C</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-343" style="vertical-align: -0.4em;">n</span></span></span></span><script type="math/tex" id="MathJax-Element-55">C_1, C_2, \dots, C_n</script>, where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-344"><span class="MJXp-msubsup" id="MJXp-Span-345"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-346" style="margin-right: 0.05em;">C</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-347" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-56">C_i</script> is the number of occurrences of the number <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-348"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-349">i</span></span></span><script type="math/tex" id="MathJax-Element-57">i</script> in the original array. Since we actually do not care which specific elements are in the original array, we can sort this array <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-350"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-351">C</span></span></span><script type="math/tex" id="MathJax-Element-58">C</script>.</p><p>Let's consider how our operations affect the array <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-352"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-353">C</span></span></span><script type="math/tex" id="MathJax-Element-59">C</script>. We either decrease all elements by <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-354"><span class="MJXp-mn" id="MJXp-Span-355">1</span></span></span><script type="math/tex" id="MathJax-Element-60">1</script> (but do not make them less than <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-356"><span class="MJXp-mn" id="MJXp-Span-357">0</span></span></span><script type="math/tex" id="MathJax-Element-61">0</script>), or we set the maximum element to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-358"><span class="MJXp-mn" id="MJXp-Span-359">0</span></span></span><script type="math/tex" id="MathJax-Element-62">0</script>. The order of operations does not matter: if we perform <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-360"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-361">x</span></span></span><script type="math/tex" id="MathJax-Element-63">x</script> operations of the first type and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-362"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-363">y</span></span></span><script type="math/tex" id="MathJax-Element-64">y</script> operations of the second type, then regardless of their order, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-364"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-365">y</span></span></span><script type="math/tex" id="MathJax-Element-65">y</script> maximums will turn into <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-366"><span class="MJXp-mn" id="MJXp-Span-367">0</span></span></span><script type="math/tex" id="MathJax-Element-66">0</script>, and the remaining elements will decrease by <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-368"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-369">x</span></span></span><script type="math/tex" id="MathJax-Element-67">x</script>.</p><p>Let's iterate through all possible pairs <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-370"><span class="MJXp-mo" id="MJXp-Span-371" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-372">x</span><span class="MJXp-mo" id="MJXp-Span-373" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-374">y</span><span class="MJXp-mo" id="MJXp-Span-375" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-68">(x, y)</script>. At first glance, it seems that there are <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-376"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-377">O</span><span class="MJXp-mo" id="MJXp-Span-378" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-379"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-380" style="margin-right: 0.05em;">n</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-381" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-382" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-69">O(n^2)</script> of them, but in reality, we need to consider only <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-383"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-384">O</span><span class="MJXp-mo" id="MJXp-Span-385" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-386">n</span><span class="MJXp-mo" id="MJXp-Span-387" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-70">O(n)</script> pairs: if we have removed <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-388"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-389">y</span></span></span><script type="math/tex" id="MathJax-Element-71">y</script> maximum elements, there is no point in taking <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-390"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-391">x</span></span></span><script type="math/tex" id="MathJax-Element-72">x</script> greater than the value of the next maximum element; therefore, the total number of values of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-392"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-393">x</span></span></span><script type="math/tex" id="MathJax-Element-73">x</script> that we need to consider for all values of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-394"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-395">y</span></span></span><script type="math/tex" id="MathJax-Element-74">y</script> is no more than <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-396"><span class="MJXp-mo" id="MJXp-Span-397" style="margin-left: 0.111em; margin-right: 0.167em;">∑</span><span class="MJXp-msubsup" id="MJXp-Span-398"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-399" style="margin-right: 0.05em;">C</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-400" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-401" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-402">n</span><span class="MJXp-mo" id="MJXp-Span-403" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mn" id="MJXp-Span-404">2</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-405">n</span></span></span><script type="math/tex" id="MathJax-Element-75">\sum C_i + n \le 2n</script>.</p><p>We just need to understand how to calculate the sum in the array <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-406"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-407">C</span></span></span><script type="math/tex" id="MathJax-Element-76">C</script> if we perform <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-408"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-409">x</span></span></span><script type="math/tex" id="MathJax-Element-77">x</script> operations of the first type and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-410"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-411">y</span></span></span><script type="math/tex" id="MathJax-Element-78">y</script> operations of the second type. For each <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-412"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-413">x</span></span></span><script type="math/tex" id="MathJax-Element-79">x</script>, we can use two pointers to pre-calculate the first element in the array <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-414"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-415">C</span></span></span><script type="math/tex" id="MathJax-Element-80">C</script> that is greater than <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-416"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-417">x</span></span></span><script type="math/tex" id="MathJax-Element-81">x</script> — then the entire prefix up to that point will be set to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-418"><span class="MJXp-mn" id="MJXp-Span-419">0</span></span></span><script type="math/tex" id="MathJax-Element-82">0</script>, and all elements starting from that point will decrease by <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-420"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-421">x</span></span></span><script type="math/tex" id="MathJax-Element-83">x</script>. Using prefix sums, we can also quickly calculate the sum of the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-422"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-423">y</span></span></span><script type="math/tex" id="MathJax-Element-84">y</script> maximum elements in the array <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-424"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-425">C</span></span></span><script type="math/tex" id="MathJax-Element-85">C</script>.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Solution (pashka)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="lit">@file</span><span class="pun">:</span><span class="typ">Suppress</span><span class="pun">(</span><span class="str">"CanBeVal"</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">io</span><span class="pun">.</span><span class="typ">BufferedReader</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">io</span><span class="pun">.</span><span class="typ">InputStreamReader</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">io</span><span class="pun">.</span><span class="typ">OutputStreamWriter</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">io</span><span class="pun">.</span><span class="typ">PrintWriter</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.*</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> kotlin</span><span class="pun">.</span><span class="pln">math</span><span class="pun">.</span><span class="pln">max
</span><span class="kwd">import</span><span class="pln"> kotlin</span><span class="pun">.</span><span class="pln">math</span><span class="pun">.</span><span class="pln">min

</span><span class="kwd">private</span><span class="pln"> fun solveTest</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    val n </span><span class="pun">=</span><span class="pln"> readInt</span><span class="pun">()</span><span class="pln">
    val a </span><span class="pun">=</span><span class="pln"> readInts</span><span class="pun">(</span><span class="pln">n</span><span class="pun">)</span><span class="pln">
    val c </span><span class="pun">=</span><span class="pln"> intarr</span><span class="pun">(</span><span class="pln">n</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x </span><span class="kwd">in</span><span class="pln"> a</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        c</span><span class="pun">[</span><span class="pln">x </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]++</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    val res </span><span class="pun">=</span><span class="pln"> intarr</span><span class="pun">(</span><span class="pln">n</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">.</span><span class="pln">MAX_VALUE</span><span class="pun">)</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">sort</span><span class="pun">()</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">k </span><span class="kwd">in</span><span class="pln"> </span><span class="lit">0.</span><span class="pun">.</span><span class="pln">n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">j </span><span class="pun">&lt;</span><span class="pln"> n </span><span class="pun">&amp;&amp;</span><span class="pln"> c</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;=</span><span class="pln"> k</span><span class="pun">)</span><span class="pln"> j</span><span class="pun">++</span><span class="pln">
        </span><span class="kwd">var</span><span class="pln"> s </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="kwd">in</span><span class="pln"> j</span><span class="pun">..</span><span class="pln">n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            val d </span><span class="pun">=</span><span class="pln"> k </span><span class="pun">+</span><span class="pln"> </span><span class="pun">(</span><span class="pln">n </span><span class="pun">-</span><span class="pln"> i</span><span class="pun">)</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">s </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">)</span><span class="pln">
            res</span><span class="pun">[</span><span class="pln">s</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> min</span><span class="pun">(</span><span class="pln">res</span><span class="pun">[</span><span class="pln">s</span><span class="pun">],</span><span class="pln"> d</span><span class="pun">)</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">)</span><span class="pln"> s </span><span class="pun">+=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">c</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> k</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="kwd">in</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">..</span><span class="pln"> n </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        res</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> min</span><span class="pun">(</span><span class="pln">res</span><span class="pun">[</span><span class="pln">i</span><span class="pun">],</span><span class="pln"> res</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">])</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    println</span><span class="pun">(</span><span class="pln">res</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">private</span><span class="pln"> fun solve</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    repeat</span><span class="pun">(</span><span class="pln">readInt</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        solveTest</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="com">// TEMPLATE</span><span class="pln">
fun main</span><span class="pun">(</span><span class="pln">args</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Array</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    reader </span><span class="pun">=</span><span class="pln"> </span><span class="typ">BufferedReader</span><span class="pun">(</span><span class="typ">InputStreamReader</span><span class="pun">(</span><span class="typ">System</span><span class="pun">.</span><span class="str">`in`</span><span class="pun">))</span><span class="pln">
    </span><span class="kwd">out</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">PrintWriter</span><span class="pun">(</span><span class="typ">OutputStreamWriter</span><span class="pun">(</span><span class="typ">System</span><span class="pun">.</span><span class="kwd">out</span><span class="pun">))</span><span class="pln">
    solve</span><span class="pun">()</span><span class="pln">
    </span><span class="kwd">out</span><span class="pun">.</span><span class="pln">close</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">private</span><span class="pln"> lateinit </span><span class="kwd">var</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">:</span><span class="pln"> </span><span class="typ">PrintWriter</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> lateinit </span><span class="kwd">var</span><span class="pln"> reader</span><span class="pun">:</span><span class="pln"> </span><span class="typ">BufferedReader</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">var</span><span class="pln"> tokenizer</span><span class="pun">:</span><span class="pln"> </span><span class="typ">StringTokenizer</span><span class="pun">?</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun read</span><span class="pun">():</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">tokenizer </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> </span><span class="pun">!</span><span class="pln">tokenizer</span><span class="pun">!!.</span><span class="pln">hasMoreTokens</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        tokenizer </span><span class="pun">=</span><span class="pln"> </span><span class="typ">StringTokenizer</span><span class="pun">(</span><span class="pln">readLn</span><span class="pun">())</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> tokenizer</span><span class="pun">!!.</span><span class="pln">nextToken</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">private</span><span class="pln"> fun readInt</span><span class="pun">()</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> read</span><span class="pun">().</span><span class="pln">toInt</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun readLong</span><span class="pun">()</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> read</span><span class="pun">().</span><span class="pln">toLong</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun readLn</span><span class="pun">()</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> reader</span><span class="pun">.</span><span class="pln">readLine</span><span class="pun">()!!</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun readInts</span><span class="pun">()</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> readLn</span><span class="pun">().</span><span class="pln">split</span><span class="pun">(</span><span class="str">" "</span><span class="pun">).</span><span class="pln">map </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">toInt</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun readInts</span><span class="pun">(</span><span class="pln">sz</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Array</span><span class="pun">(</span><span class="pln">sz</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> readInt</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun readLongs</span><span class="pun">()</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> readLn</span><span class="pun">().</span><span class="pln">split</span><span class="pun">(</span><span class="str">" "</span><span class="pun">).</span><span class="pln">map </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">toLong</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun readLongs</span><span class="pun">(</span><span class="pln">sz</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Array</span><span class="pun">(</span><span class="pln">sz</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> readLong</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun </span><span class="kwd">print</span><span class="pun">(</span><span class="pln">b</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Boolean</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="kwd">print</span><span class="pun">(</span><span class="pln">b</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun </span><span class="kwd">print</span><span class="pun">(</span><span class="pln">i</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="kwd">print</span><span class="pun">(</span><span class="pln">i</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun </span><span class="kwd">print</span><span class="pun">(</span><span class="pln">d</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Double</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="kwd">print</span><span class="pun">(</span><span class="pln">d</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun </span><span class="kwd">print</span><span class="pun">(</span><span class="pln">l</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Long</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="kwd">print</span><span class="pun">(</span><span class="pln">l</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun </span><span class="kwd">print</span><span class="pun">(</span><span class="pln">s</span><span class="pun">:</span><span class="pln"> </span><span class="typ">String</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="kwd">print</span><span class="pun">(</span><span class="pln">s</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun </span><span class="kwd">print</span><span class="pun">(</span><span class="pln">message</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Any</span><span class="pun">?)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="kwd">print</span><span class="pun">(</span><span class="pln">message</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun </span><span class="kwd">print</span><span class="pun">(</span><span class="pln">a</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Array</span><span class="pun">&lt;</span><span class="typ">Int</span><span class="pun">&gt;)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">forEach </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">print</span><span class="pun">(</span><span class="str">"$it "</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun </span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;</span><span class="pln"> </span><span class="kwd">print</span><span class="pun">(</span><span class="pln">a</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Array</span><span class="pun">&lt;</span><span class="kwd">out</span><span class="pln"> T</span><span class="pun">&gt;)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">forEach </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">print</span><span class="pun">(</span><span class="str">"$it "</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun </span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;</span><span class="pln"> </span><span class="kwd">print</span><span class="pun">(</span><span class="pln">a</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Collection</span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">forEach </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">print</span><span class="pun">(</span><span class="str">"$it "</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun println</span><span class="pun">(</span><span class="pln">b</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Boolean</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="pln">b</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun println</span><span class="pun">(</span><span class="pln">i</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="pln">i</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun println</span><span class="pun">(</span><span class="pln">d</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Double</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="pln">d</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun println</span><span class="pun">(</span><span class="pln">l</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Long</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="pln">l</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun println</span><span class="pun">(</span><span class="pln">s</span><span class="pun">:</span><span class="pln"> </span><span class="typ">String</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="pln">s</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun println</span><span class="pun">()</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="pln">println</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun println</span><span class="pun">(</span><span class="pln">message</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Any</span><span class="pun">?)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="pln">message</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun </span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;</span><span class="pln"> println</span><span class="pun">(</span><span class="pln">a</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Array</span><span class="pun">&lt;</span><span class="kwd">out</span><span class="pln"> T</span><span class="pun">&gt;)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">forEach </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">print</span><span class="pun">(</span><span class="str">"$it "</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    println</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">private</span><span class="pln"> fun println</span><span class="pun">(</span><span class="pln">a</span><span class="pun">:</span><span class="pln"> </span><span class="typ">IntArray</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">forEach </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">print</span><span class="pun">(</span><span class="str">"$it "</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    println</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">private</span><span class="pln"> fun println</span><span class="pun">(</span><span class="pln">a</span><span class="pun">:</span><span class="pln"> </span><span class="typ">LongArray</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">forEach </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">print</span><span class="pun">(</span><span class="str">"$it "</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    println</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">private</span><span class="pln"> fun </span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;</span><span class="pln"> println</span><span class="pun">(</span><span class="pln">a</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Collection</span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">forEach </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">print</span><span class="pun">(</span><span class="str">"$it "</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    println</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">private</span><span class="pln"> fun intarr</span><span class="pun">(</span><span class="pln">sz</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">,</span><span class="pln"> v</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">IntArray</span><span class="pun">(</span><span class="pln">sz</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> v </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun longarr</span><span class="pun">(</span><span class="pln">sz</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">,</span><span class="pln"> v</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">LongArray</span><span class="pun">(</span><span class="pln">sz</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> v </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun intarr2d</span><span class="pun">(</span><span class="pln">n</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">,</span><span class="pln"> m</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">,</span><span class="pln"> v</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Array</span><span class="pun">(</span><span class="pln">n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> intarr</span><span class="pun">(</span><span class="pln">m</span><span class="pun">,</span><span class="pln"> v</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun longarr2d</span><span class="pun">(</span><span class="pln">n</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">,</span><span class="pln"> m</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">,</span><span class="pln"> v</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Array</span><span class="pun">(</span><span class="pln">n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> longarr</span><span class="pun">(</span><span class="pln">m</span><span class="pun">,</span><span class="pln"> v</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun </span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;</span><span class="pln"> init</span><span class="pun">(</span><span class="pln">vararg elements</span><span class="pun">:</span><span class="pln"> T</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> elements
</span><span class="kwd">private</span><span class="pln"> fun VI</span><span class="pun">(</span><span class="pln">n</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> init</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">MutableList</span><span class="pun">(</span><span class="pln">n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> init </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun VVI</span><span class="pun">(</span><span class="pln">n</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> m</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> init</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">MutableList</span><span class="pun">(</span><span class="pln">n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> VI</span><span class="pun">(</span><span class="pln">m</span><span class="pun">,</span><span class="pln"> init</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun </span><span class="pun">&lt;</span><span class="pln">T1 </span><span class="pun">:</span><span class="pln"> </span><span class="typ">Comparable</span><span class="pun">&lt;</span><span class="pln">T1</span><span class="pun">&gt;,</span><span class="pln"> T2 </span><span class="pun">:</span><span class="pln"> </span><span class="typ">Comparable</span><span class="pun">&lt;</span><span class="pln">T2</span><span class="pun">&gt;&gt;</span><span class="pln"> pairCmp</span><span class="pun">():</span><span class="pln"> </span><span class="typ">Comparator</span><span class="pun">&lt;</span><span class="typ">Pair</span><span class="pun">&lt;</span><span class="pln">T1</span><span class="pun">,</span><span class="pln"> T2</span><span class="pun">&gt;&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Comparator</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> b </span><span class="pun">-&gt;</span><span class="pln">
        val res </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">first</span><span class="pun">.</span><span class="pln">compareTo</span><span class="pun">(</span><span class="pln">b</span><span class="pun">.</span><span class="pln">first</span><span class="pun">)</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">res </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">second</span><span class="pun">.</span><span class="pln">compareTo</span><span class="pun">(</span><span class="pln">b</span><span class="pun">.</span><span class="pln">second</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> res
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">


</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2141/problem/G" title="Kotlin Heroes: Episode 13">2141G - Good Robot Paths</a></p><p>Idea: <a class="rated-user user-orange" href="https://codeforces.com/profile/FelixArg" title="Master FelixArg">FelixArg</a>, preparation: <a class="rated-user user-orange" href="https://codeforces.com/profile/FelixArg" title="Master FelixArg">FelixArg</a></p> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2141/problem/G" title="Kotlin Heroes: Episode 13">2141G - Good Robot Paths</a></h3><div class="ttypography"><div class="problem-statement"><div><p>Let there be two black points $$$A = (x_a, y_a)$$$ and $$$B = (x_b, y_b)$$$.</p><p>The shortest length of the robot's path in steps {<span class="tex-font-style-tt">U</span>, <span class="tex-font-style-tt">D</span>, <span class="tex-font-style-tt">L</span>, <span class="tex-font-style-tt">R</span>} between $$$A$$$ and $$$B$$$ is equal to the Manhattan metric:</p><p>$$$$$$d = |x_{a} - x_{b}| + |y_{a} - y_{b}|$$$$$$</p><p><span class="tex-font-style-bf">Fact</span>. The union of all shortest paths between $$$A$$$ and $$$B$$$ over the grid nodes is exactly all integer points inside and on the boundary of the rectangle with vertices $$$(x_{a}, y_{a})$$$ and $$$(x_{b}, y_{b})$$$.</p><p><span class="tex-font-style-it">Proof</span>. For any point $$$P = (x, y)$$$, where $$$x$$$ lies between $$$x_{a}$$$ and $$$x_{b}$$$, and $$$y$$$ lies between $$$y_{a}$$$ and $$$y_{b}$$$, the length of the path $$$A \to P \to B$$$ is equal to:</p><p>$$$$$$|x - x_{a}| + |y - y_{a}| + |x_{b} - x| + |y_{b} - y| = |x_{a} - x_{b}| + |y_{a} - y_{b}| = d$$$$$$</p><p>Thus, point $$$P$$$ lies on some shortest path. Conversely, any point on a shortest path cannot go beyond the specified rectangle. ∎</p><p>From this, it follows that we need to count the number of rectangles that consist entirely of black cells and multiply this count by some constant that depends on which pairs of points will be the starting and ending points of the path.</p><p>Let's divide all rectangles into two classes:</p><ul> <li> Rectangles $$$1 \times k$$$ and $$$k \times 1$$$, where $$$k &gt; 1$$$. </li><li> Other rectangles $$$k \times l$$$, where $$$k, l &gt; 1$$$. </li></ul><p>Let the number of rectangles of the first class be denoted as $$$R_{1}$$$, and the second class as $$$R_{2}$$$. For each class, the contribution to the answer is different; for the first, it is $$$2 \cdot R_{1}$$$, as there are only two ways to choose the starting and ending points (the edges of the rectangle), and for the second, it is $$$4 \cdot R_{2}$$$ for similar reasons (the corners of the rectangle).</p><p>Rectangles of the first type are quite simple to count. For this, let's take all points on some horizontal or vertical line and count the number of consecutive segments consisting of black cells. All of this can be implemented quite simply using a data structure set.</p><p>Rectangles of the second class are counted a bit more complicated. For this, let's use the idea of a sweeping line along the $$$y$$$ coordinate:</p><ul> <li> We scan downwards along $$$y$$$, maintaining a "height histogram" of the columns of black cells whose bottom point has the current $$$y$$$. </li><li> For each level $$$y$$$, we collect a sorted list of all $$$x$$$ such that $$$(x, y)$$$ is a black point. </li><li> We maintain a dictionary $$$H[x] =$$$ height of the column at the current $$$y$$$: how many consecutive black points are above, starting from $$$(x, y)$$$ (including it). </li><li> For the current $$$y$$$, we calculate the number of rectangles using a monotonic stack based on the subtracted $$$H$$$. </li></ul><p>Let's discuss in more detail how to compute the number of rectangles using $$$H$$$ with a monotonic stack:</p><p>Let the heights $$$h_{1}, h_{2}, \dots, h_{m}$$$ (these are the values of $$$H$$$) go from left to right in a block. We count the number of subrectangles whose bottom lies at the current $$$y$$$:</p><ul> <li> We maintain a stack of pairs $$$(height, count)$$$ with non-decreasing heights. </li><li> We keep the current value $$$sum$$$&nbsp;— the sum of the values in the stack. </li><li> When we add a new column $$$h_{i}$$$, we add $$$sum$$$ to the answer and update the stack with the value $$$h_{i} - 1$$$. </li><li> If the value of the key $$$h_{i}$$$ is not equal to the next key value $$$h_{i} - 1$$$, clear the entire stack (i.e., if the columns of the "histogram" are not adjacent). </li></ul><p>Thus, all of this can be implemented in $$$O(n \log n)$$$, requiring sorting, a dictionary, and a set.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Solution (pashka)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="lit">@file</span><span class="pun">:</span><span class="typ">Suppress</span><span class="pun">(</span><span class="str">"CanBeVal"</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">io</span><span class="pun">.</span><span class="typ">BufferedReader</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">io</span><span class="pun">.</span><span class="typ">InputStreamReader</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">io</span><span class="pun">.</span><span class="typ">OutputStreamWriter</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">io</span><span class="pun">.</span><span class="typ">PrintWriter</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.*</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> kotlin</span><span class="pun">.</span><span class="pln">collections</span><span class="pun">.</span><span class="typ">HashMap</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> kotlin</span><span class="pun">.</span><span class="pln">math</span><span class="pun">.</span><span class="pln">max
</span><span class="kwd">import</span><span class="pln"> kotlin</span><span class="pun">.</span><span class="pln">math</span><span class="pun">.</span><span class="pln">min

</span><span class="kwd">private</span><span class="pln"> fun solveTest</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    val n </span><span class="pun">=</span><span class="pln"> readInt</span><span class="pun">()</span><span class="pln">
    val p </span><span class="pun">=</span><span class="pln"> </span><span class="typ">TreeMap</span><span class="pun">&lt;</span><span class="typ">Int</span><span class="pun">,</span><span class="pln"> </span><span class="typ">MutableList</span><span class="pun">&lt;</span><span class="typ">Int</span><span class="pun">&gt;&gt;()</span><span class="pln">
    repeat</span><span class="pun">(</span><span class="pln">n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        val x </span><span class="pun">=</span><span class="pln"> readInt</span><span class="pun">()</span><span class="pln">
        val y </span><span class="pun">=</span><span class="pln"> readInt</span><span class="pun">()</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">p</span><span class="pun">.</span><span class="pln">containsKey</span><span class="pun">(</span><span class="pln">y</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            p</span><span class="pun">[</span><span class="pln">y</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> mutableListOf</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        p</span><span class="pun">[</span><span class="pln">y</span><span class="pun">]!!.</span><span class="kwd">add</span><span class="pun">(</span><span class="pln">x</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> lastY </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">.</span><span class="pln">MIN_VALUE
    </span><span class="kwd">var</span><span class="pln"> lastD </span><span class="pun">=</span><span class="pln"> mutableMapOf</span><span class="pun">&lt;</span><span class="typ">Int</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">&gt;()</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> res </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0L</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">y </span><span class="kwd">in</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">keys</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">y </span><span class="pun">!=</span><span class="pln"> lastY </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            lastD</span><span class="pun">.</span><span class="pln">clear</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">var</span><span class="pln"> d </span><span class="pun">=</span><span class="pln"> mutableMapOf</span><span class="pun">&lt;</span><span class="typ">Int</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">&gt;()</span><span class="pln">

        val xx </span><span class="pun">=</span><span class="pln"> p</span><span class="pun">[</span><span class="pln">y</span><span class="pun">]!!</span><span class="pln">
        xx</span><span class="pun">.</span><span class="pln">sort</span><span class="pun">()</span><span class="pln">

        </span><span class="kwd">var</span><span class="pln"> lastX </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">.</span><span class="pln">MIN_VALUE
        val st </span><span class="pun">=</span><span class="pln"> mutableListOf</span><span class="pun">&lt;</span><span class="typ">Pair</span><span class="pun">&lt;</span><span class="typ">Int</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">&gt;&gt;()</span><span class="pln">
        </span><span class="kwd">var</span><span class="pln"> sum1 </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0L</span><span class="pln">
        </span><span class="kwd">var</span><span class="pln"> sum2 </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0L</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x </span><span class="kwd">in</span><span class="pln"> xx</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            val dd </span><span class="pun">=</span><span class="pln"> lastD</span><span class="pun">.</span><span class="pln">getOrDefault</span><span class="pun">(</span><span class="pln">x</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
            d</span><span class="pun">[</span><span class="pln">x</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> dd

            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x </span><span class="pun">!=</span><span class="pln"> lastX </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                st</span><span class="pun">.</span><span class="pln">clear</span><span class="pun">()</span><span class="pln">
                sum1 </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
                sum2 </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">

            </span><span class="kwd">var</span><span class="pln"> c </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
            </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">st</span><span class="pun">.</span><span class="pln">isNotEmpty</span><span class="pun">()</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> st</span><span class="pun">.</span><span class="kwd">last</span><span class="pun">().</span><span class="pln">first </span><span class="pun">&gt;</span><span class="pln"> dd</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                c </span><span class="pun">+=</span><span class="pln"> st</span><span class="pun">.</span><span class="kwd">last</span><span class="pun">().</span><span class="pln">second
                sum1 </span><span class="pun">-=</span><span class="pln"> st</span><span class="pun">.</span><span class="kwd">last</span><span class="pun">().</span><span class="pln">first </span><span class="pun">*</span><span class="pln"> st</span><span class="pun">.</span><span class="kwd">last</span><span class="pun">().</span><span class="pln">second
                st</span><span class="pun">.</span><span class="pln">removeLast</span><span class="pun">()</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
            sum1 </span><span class="pun">+=</span><span class="pln"> c </span><span class="pun">*</span><span class="pln"> dd
            st</span><span class="pun">.</span><span class="kwd">add</span><span class="pun">(</span><span class="pln">dd to c</span><span class="pun">)</span><span class="pln">
            sum2</span><span class="pun">++</span><span class="pln">

            res </span><span class="pun">+=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">sum1 </span><span class="pun">-</span><span class="pln"> sum2 </span><span class="pun">-</span><span class="pln"> dd </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="lit">4</span><span class="pln">
            res </span><span class="pun">+=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">sum2 </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pln">
            res </span><span class="pun">+=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">dd </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pln">
</span><span class="com">//            println("" + y + " " + x + " " + dd + " " + sum1 + " " + sum2 + " " + res)</span><span class="pln">
            lastX </span><span class="pun">=</span><span class="pln"> x
        </span><span class="pun">}</span><span class="pln">

        lastY </span><span class="pun">=</span><span class="pln"> y
        lastD </span><span class="pun">=</span><span class="pln"> d
    </span><span class="pun">}</span><span class="pln">
    println</span><span class="pun">(</span><span class="pln">res</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">private</span><span class="pln"> fun solve</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    repeat</span><span class="pun">(</span><span class="pln">readInt</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        solveTest</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="com">// TEMPLATE</span><span class="pln">
fun main</span><span class="pun">(</span><span class="pln">args</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Array</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    reader </span><span class="pun">=</span><span class="pln"> </span><span class="typ">BufferedReader</span><span class="pun">(</span><span class="typ">InputStreamReader</span><span class="pun">(</span><span class="typ">System</span><span class="pun">.</span><span class="str">`in`</span><span class="pun">))</span><span class="pln">
    </span><span class="kwd">out</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">PrintWriter</span><span class="pun">(</span><span class="typ">OutputStreamWriter</span><span class="pun">(</span><span class="typ">System</span><span class="pun">.</span><span class="kwd">out</span><span class="pun">))</span><span class="pln">
    solve</span><span class="pun">()</span><span class="pln">
    </span><span class="kwd">out</span><span class="pun">.</span><span class="pln">close</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">private</span><span class="pln"> lateinit </span><span class="kwd">var</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">:</span><span class="pln"> </span><span class="typ">PrintWriter</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> lateinit </span><span class="kwd">var</span><span class="pln"> reader</span><span class="pun">:</span><span class="pln"> </span><span class="typ">BufferedReader</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">var</span><span class="pln"> tokenizer</span><span class="pun">:</span><span class="pln"> </span><span class="typ">StringTokenizer</span><span class="pun">?</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun read</span><span class="pun">():</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">tokenizer </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> </span><span class="pun">!</span><span class="pln">tokenizer</span><span class="pun">!!.</span><span class="pln">hasMoreTokens</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        tokenizer </span><span class="pun">=</span><span class="pln"> </span><span class="typ">StringTokenizer</span><span class="pun">(</span><span class="pln">readLn</span><span class="pun">())</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> tokenizer</span><span class="pun">!!.</span><span class="pln">nextToken</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">private</span><span class="pln"> fun readInt</span><span class="pun">()</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> read</span><span class="pun">().</span><span class="pln">toInt</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun readLong</span><span class="pun">()</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> read</span><span class="pun">().</span><span class="pln">toLong</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun readLn</span><span class="pun">()</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> reader</span><span class="pun">.</span><span class="pln">readLine</span><span class="pun">()!!</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun readInts</span><span class="pun">()</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> readLn</span><span class="pun">().</span><span class="pln">split</span><span class="pun">(</span><span class="str">" "</span><span class="pun">).</span><span class="pln">map </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">toInt</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun readInts</span><span class="pun">(</span><span class="pln">sz</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Array</span><span class="pun">(</span><span class="pln">sz</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> readInt</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun readLongs</span><span class="pun">()</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> readLn</span><span class="pun">().</span><span class="pln">split</span><span class="pun">(</span><span class="str">" "</span><span class="pun">).</span><span class="pln">map </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">toLong</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun readLongs</span><span class="pun">(</span><span class="pln">sz</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Array</span><span class="pun">(</span><span class="pln">sz</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> readLong</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun </span><span class="kwd">print</span><span class="pun">(</span><span class="pln">b</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Boolean</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="kwd">print</span><span class="pun">(</span><span class="pln">b</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun </span><span class="kwd">print</span><span class="pun">(</span><span class="pln">i</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="kwd">print</span><span class="pun">(</span><span class="pln">i</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun </span><span class="kwd">print</span><span class="pun">(</span><span class="pln">d</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Double</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="kwd">print</span><span class="pun">(</span><span class="pln">d</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun </span><span class="kwd">print</span><span class="pun">(</span><span class="pln">l</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Long</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="kwd">print</span><span class="pun">(</span><span class="pln">l</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun </span><span class="kwd">print</span><span class="pun">(</span><span class="pln">s</span><span class="pun">:</span><span class="pln"> </span><span class="typ">String</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="kwd">print</span><span class="pun">(</span><span class="pln">s</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun </span><span class="kwd">print</span><span class="pun">(</span><span class="pln">message</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Any</span><span class="pun">?)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="kwd">print</span><span class="pun">(</span><span class="pln">message</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun </span><span class="kwd">print</span><span class="pun">(</span><span class="pln">a</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Array</span><span class="pun">&lt;</span><span class="typ">Int</span><span class="pun">&gt;)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">forEach </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">print</span><span class="pun">(</span><span class="str">"$it "</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun </span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;</span><span class="pln"> </span><span class="kwd">print</span><span class="pun">(</span><span class="pln">a</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Array</span><span class="pun">&lt;</span><span class="kwd">out</span><span class="pln"> T</span><span class="pun">&gt;)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">forEach </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">print</span><span class="pun">(</span><span class="str">"$it "</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun </span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;</span><span class="pln"> </span><span class="kwd">print</span><span class="pun">(</span><span class="pln">a</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Collection</span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">forEach </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">print</span><span class="pun">(</span><span class="str">"$it "</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun println</span><span class="pun">(</span><span class="pln">b</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Boolean</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="pln">b</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun println</span><span class="pun">(</span><span class="pln">i</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="pln">i</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun println</span><span class="pun">(</span><span class="pln">d</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Double</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="pln">d</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun println</span><span class="pun">(</span><span class="pln">l</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Long</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="pln">l</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun println</span><span class="pun">(</span><span class="pln">s</span><span class="pun">:</span><span class="pln"> </span><span class="typ">String</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="pln">s</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun println</span><span class="pun">()</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="pln">println</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun println</span><span class="pun">(</span><span class="pln">message</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Any</span><span class="pun">?)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="pln">message</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun </span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;</span><span class="pln"> println</span><span class="pun">(</span><span class="pln">a</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Array</span><span class="pun">&lt;</span><span class="kwd">out</span><span class="pln"> T</span><span class="pun">&gt;)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">forEach </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">print</span><span class="pun">(</span><span class="str">"$it "</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    println</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">private</span><span class="pln"> fun println</span><span class="pun">(</span><span class="pln">a</span><span class="pun">:</span><span class="pln"> </span><span class="typ">IntArray</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">forEach </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">print</span><span class="pun">(</span><span class="str">"$it "</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    println</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">private</span><span class="pln"> fun println</span><span class="pun">(</span><span class="pln">a</span><span class="pun">:</span><span class="pln"> </span><span class="typ">LongArray</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">forEach </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">print</span><span class="pun">(</span><span class="str">"$it "</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    println</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">private</span><span class="pln"> fun </span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;</span><span class="pln"> println</span><span class="pun">(</span><span class="pln">a</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Collection</span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">forEach </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">print</span><span class="pun">(</span><span class="str">"$it "</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    println</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">private</span><span class="pln"> fun intarr</span><span class="pun">(</span><span class="pln">sz</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">,</span><span class="pln"> v</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">IntArray</span><span class="pun">(</span><span class="pln">sz</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> v </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun longarr</span><span class="pun">(</span><span class="pln">sz</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">,</span><span class="pln"> v</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">LongArray</span><span class="pun">(</span><span class="pln">sz</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> v </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun intarr2d</span><span class="pun">(</span><span class="pln">n</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">,</span><span class="pln"> m</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">,</span><span class="pln"> v</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Array</span><span class="pun">(</span><span class="pln">n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> intarr</span><span class="pun">(</span><span class="pln">m</span><span class="pun">,</span><span class="pln"> v</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun longarr2d</span><span class="pun">(</span><span class="pln">n</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">,</span><span class="pln"> m</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">,</span><span class="pln"> v</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Array</span><span class="pun">(</span><span class="pln">n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> longarr</span><span class="pun">(</span><span class="pln">m</span><span class="pun">,</span><span class="pln"> v</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun </span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;</span><span class="pln"> init</span><span class="pun">(</span><span class="pln">vararg elements</span><span class="pun">:</span><span class="pln"> T</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> elements
</span><span class="kwd">private</span><span class="pln"> fun VI</span><span class="pun">(</span><span class="pln">n</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> init</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">MutableList</span><span class="pun">(</span><span class="pln">n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> init </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun VVI</span><span class="pun">(</span><span class="pln">n</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> m</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> init</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">MutableList</span><span class="pun">(</span><span class="pln">n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> VI</span><span class="pun">(</span><span class="pln">m</span><span class="pun">,</span><span class="pln"> init</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun </span><span class="pun">&lt;</span><span class="pln">T1 </span><span class="pun">:</span><span class="pln"> </span><span class="typ">Comparable</span><span class="pun">&lt;</span><span class="pln">T1</span><span class="pun">&gt;,</span><span class="pln"> T2 </span><span class="pun">:</span><span class="pln"> </span><span class="typ">Comparable</span><span class="pun">&lt;</span><span class="pln">T2</span><span class="pun">&gt;&gt;</span><span class="pln"> pairCmp</span><span class="pun">():</span><span class="pln"> </span><span class="typ">Comparator</span><span class="pun">&lt;</span><span class="typ">Pair</span><span class="pun">&lt;</span><span class="pln">T1</span><span class="pun">,</span><span class="pln"> T2</span><span class="pun">&gt;&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Comparator</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> b </span><span class="pun">-&gt;</span><span class="pln">
        val res </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">first</span><span class="pun">.</span><span class="pln">compareTo</span><span class="pun">(</span><span class="pln">b</span><span class="pun">.</span><span class="pln">first</span><span class="pun">)</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">res </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">second</span><span class="pun">.</span><span class="pln">compareTo</span><span class="pun">(</span><span class="pln">b</span><span class="pun">.</span><span class="pln">second</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> res
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">


</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2141/problem/H" title="Kotlin Heroes: Episode 13">2141H - Merging Vertices in a Graph</a></p><p>Idea: <a class="rated-user user-red" href="https://codeforces.com/profile/BledDest" title="International Grandmaster BledDest">BledDest</a>, preparation: <a class="rated-user user-red" href="https://codeforces.com/profile/BledDest" title="International Grandmaster BledDest">BledDest</a></p> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2141/problem/H" title="Kotlin Heroes: Episode 13">2141H - Merging Vertices in a Graph</a></h3><div class="ttypography"><div class="problem-statement"><div><p>The main idea that helps to solve this problem is to consider the complement of the given graph instead of the graph itself (that is, a graph on the same vertices where two vertices are connected by an edge if and only if there is no edge between them in the original graph). How does the operation we perform affect the complement of the graph?</p><p>When merging vertices in the original graph, the <span class="tex-font-style-it">intersection</span> of their adjacency lists occurs, so in the complement, a <span class="tex-font-style-it">union</span> is performed instead. The operations end when there is at least one vertex that is connected to all other vertices — and in the complement, this will be an isolated vertex.</p><p>Thus, the problem can be reformulated as follows: given an undirected graph; in one operation, we can "merge" two vertices into one, uniting their adjacency lists. We need to obtain an isolated vertex in the minimum/maximum number of operations.</p><p>First, let's consider the minimum number of operations. To obtain an isolated vertex, we need to merge a set of vertices such that they are not connected to any other vertices (otherwise, the resulting vertex will not be isolated). That is, we are interested in the smallest set of vertices that are not connected to vertices outside the set — this is the minimum connected component. Therefore, the minimum number of operations depends only on the size of the minimum connected component in the complement of the given graph.</p><p>Now, let's consider the maximum number of operations. First, let's merge all components into one, and then compress it to size <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-426"><span class="MJXp-mn" id="MJXp-Span-427">1</span></span></span><script type="math/tex" id="MathJax-Element-86">1</script>. This will take <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-428"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-429">n</span><span class="MJXp-mo" id="MJXp-Span-430" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-431">1</span></span></span><script type="math/tex" id="MathJax-Element-87">n-1</script> operations; if all components initially consisted of at least two vertices, then the resulting component will also consist of at least two vertices after merging. Therefore, if there is initially no vertex in the given graph that is connected to all others, we can perform <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-432"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-433">n</span><span class="MJXp-mo" id="MJXp-Span-434" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-435">1</span></span></span><script type="math/tex" id="MathJax-Element-88">n-1</script> operations.</p><p>We only need to understand how to identify all connected components of the complement of the given graph. The issue is that there may be too many edges in the complement. We need to learn how to implicitly traverse the complement of the given graph.</p><p>Let's write a DFS or BFS and maintain the set of all vertices that have not yet been visited. During the traversal, we need to somehow find all vertices that are not in the adjacency list of the current vertex and have not yet been visited. We will do this as follows: we will go through the set of unvisited vertices and try to check for each of them whether it is in the current adjacency list (either by binary search or by treating the adjacency list as a set). If we find any vertices that are not in the adjacency list, we can continue the traversal from them — and each such vertex reduces the set of unvisited vertices by <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-436"><span class="MJXp-mn" id="MJXp-Span-437">1</span></span></span><script type="math/tex" id="MathJax-Element-89">1</script> (therefore, there will be no more than <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-438"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-439">n</span></span></span><script type="math/tex" id="MathJax-Element-90">n</script> such checks when we do not find a vertex in the adjacency list). As for the cases when a vertex is found in the adjacency list, there will be no more than <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-440"><span class="MJXp-mn" id="MJXp-Span-441">2</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-442">m</span></span></span><script type="math/tex" id="MathJax-Element-91">2m</script> of them in total because the total size of the adjacency lists equals <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-443"><span class="MJXp-mn" id="MJXp-Span-444">2</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-445">m</span></span></span><script type="math/tex" id="MathJax-Element-92">2m</script>. Thus, this algorithm runs in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-446"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-447">O</span><span class="MJXp-mo" id="MJXp-Span-448" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mo" id="MJXp-Span-449" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-450">n</span><span class="MJXp-mo" id="MJXp-Span-451" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-452">m</span><span class="MJXp-mo" id="MJXp-Span-453" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mi" id="MJXp-Span-454">log</span><span class="MJXp-mo" id="MJXp-Span-455" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-456">n</span><span class="MJXp-mo" id="MJXp-Span-457" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-93">O((n+m) \log n)</script>.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Solution (pashka)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="lit">@file</span><span class="pun">:</span><span class="typ">Suppress</span><span class="pun">(</span><span class="str">"CanBeVal"</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">io</span><span class="pun">.</span><span class="typ">BufferedReader</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">io</span><span class="pun">.</span><span class="typ">InputStreamReader</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">io</span><span class="pun">.</span><span class="typ">OutputStreamWriter</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">io</span><span class="pun">.</span><span class="typ">PrintWriter</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.*</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> kotlin</span><span class="pun">.</span><span class="pln">collections</span><span class="pun">.</span><span class="typ">HashMap</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> kotlin</span><span class="pun">.</span><span class="pln">math</span><span class="pun">.</span><span class="pln">max
</span><span class="kwd">import</span><span class="pln"> kotlin</span><span class="pun">.</span><span class="pln">math</span><span class="pun">.</span><span class="pln">min

</span><span class="kwd">private</span><span class="pln"> fun solveTest</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    val n </span><span class="pun">=</span><span class="pln"> readInt</span><span class="pun">()</span><span class="pln">
    val m </span><span class="pun">=</span><span class="pln"> readInt</span><span class="pun">()</span><span class="pln">
    val g </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Array</span><span class="pun">(</span><span class="pln">n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> mutableListOf</span><span class="pun">&lt;</span><span class="typ">Int</span><span class="pun">&gt;()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    repeat</span><span class="pun">(</span><span class="pln">m</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        val x </span><span class="pun">=</span><span class="pln"> readInt</span><span class="pun">()</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
        val y </span><span class="pun">=</span><span class="pln"> readInt</span><span class="pun">()</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
        g</span><span class="pun">[</span><span class="pln">x</span><span class="pun">].</span><span class="kwd">add</span><span class="pun">(</span><span class="pln">y</span><span class="pun">)</span><span class="pln">
        g</span><span class="pun">[</span><span class="pln">y</span><span class="pun">].</span><span class="kwd">add</span><span class="pun">(</span><span class="pln">x</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    val z </span><span class="pun">=</span><span class="pln"> intarr</span><span class="pun">(</span><span class="pln">n</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> a </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="lit">0.</span><span class="pun">.</span><span class="pln">n </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">).</span><span class="pln">toMutableSet</span><span class="pun">()</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> res </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">.</span><span class="pln">MAX_VALUE

    </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">a</span><span class="pun">.</span><span class="pln">isEmpty</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">var</span><span class="pln"> v </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">iterator</span><span class="pun">().</span><span class="kwd">next</span><span class="pun">()</span><span class="pln">
        a</span><span class="pun">.</span><span class="kwd">remove</span><span class="pun">(</span><span class="pln">v</span><span class="pun">)</span><span class="pln">
        z</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
        </span><span class="kwd">var</span><span class="pln"> s </span><span class="pun">=</span><span class="pln"> mutableSetOf</span><span class="pun">&lt;</span><span class="typ">Int</span><span class="pun">&gt;()</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x </span><span class="kwd">in</span><span class="pln"> g</span><span class="pun">[</span><span class="pln">v</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">z</span><span class="pun">[</span><span class="pln">x</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> s</span><span class="pun">.</span><span class="kwd">add</span><span class="pun">(</span><span class="pln">x</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">var</span><span class="pln"> k </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
        </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">true</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">var</span><span class="pln"> ok </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pln">
            </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x </span><span class="kwd">in</span><span class="pln"> a</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">s</span><span class="pun">.</span><span class="pln">contains</span><span class="pun">(</span><span class="pln">x</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> z</span><span class="pun">[</span><span class="pln">x</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    z</span><span class="pun">[</span><span class="pln">x</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
                    a</span><span class="pun">.</span><span class="kwd">remove</span><span class="pun">(</span><span class="pln">x</span><span class="pun">)</span><span class="pln">
                    </span><span class="kwd">var</span><span class="pln"> ss </span><span class="pun">=</span><span class="pln"> mutableSetOf</span><span class="pun">&lt;</span><span class="typ">Int</span><span class="pun">&gt;()</span><span class="pln">
                    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">y </span><span class="kwd">in</span><span class="pln"> g</span><span class="pun">[</span><span class="pln">x</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">z</span><span class="pun">[</span><span class="pln">y</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> s</span><span class="pun">.</span><span class="pln">contains</span><span class="pun">(</span><span class="pln">y</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                            ss</span><span class="pun">.</span><span class="kwd">add</span><span class="pun">(</span><span class="pln">y</span><span class="pun">)</span><span class="pln">
                        </span><span class="pun">}</span><span class="pln">
                    </span><span class="pun">}</span><span class="pln">
                    ok </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pln">
                    s </span><span class="pun">=</span><span class="pln"> ss
                    k</span><span class="pun">++</span><span class="pln">
                    </span><span class="kwd">break</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">ok</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                res </span><span class="pun">=</span><span class="pln"> min</span><span class="pun">(</span><span class="pln">res</span><span class="pun">,</span><span class="pln"> k</span><span class="pun">)</span><span class="pln">
                </span><span class="kwd">break</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">res </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        println</span><span class="pun">(</span><span class="str">""</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> res </span><span class="pun">+</span><span class="pln"> </span><span class="str">" "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        println</span><span class="pun">(</span><span class="str">""</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> res </span><span class="pun">+</span><span class="pln"> </span><span class="str">" "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="pun">(</span><span class="pln">n </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">))</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">private</span><span class="pln"> fun solve</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
</span><span class="com">//    repeat(readInt()) {</span><span class="pln">
        solveTest</span><span class="pun">()</span><span class="pln">
</span><span class="com">//    }</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="com">// TEMPLATE</span><span class="pln">
fun main</span><span class="pun">(</span><span class="pln">args</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Array</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    reader </span><span class="pun">=</span><span class="pln"> </span><span class="typ">BufferedReader</span><span class="pun">(</span><span class="typ">InputStreamReader</span><span class="pun">(</span><span class="typ">System</span><span class="pun">.</span><span class="str">`in`</span><span class="pun">))</span><span class="pln">
    </span><span class="kwd">out</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">PrintWriter</span><span class="pun">(</span><span class="typ">OutputStreamWriter</span><span class="pun">(</span><span class="typ">System</span><span class="pun">.</span><span class="kwd">out</span><span class="pun">))</span><span class="pln">
    solve</span><span class="pun">()</span><span class="pln">
    </span><span class="kwd">out</span><span class="pun">.</span><span class="pln">close</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">private</span><span class="pln"> lateinit </span><span class="kwd">var</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">:</span><span class="pln"> </span><span class="typ">PrintWriter</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> lateinit </span><span class="kwd">var</span><span class="pln"> reader</span><span class="pun">:</span><span class="pln"> </span><span class="typ">BufferedReader</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">var</span><span class="pln"> tokenizer</span><span class="pun">:</span><span class="pln"> </span><span class="typ">StringTokenizer</span><span class="pun">?</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun read</span><span class="pun">():</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">tokenizer </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> </span><span class="pun">!</span><span class="pln">tokenizer</span><span class="pun">!!.</span><span class="pln">hasMoreTokens</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        tokenizer </span><span class="pun">=</span><span class="pln"> </span><span class="typ">StringTokenizer</span><span class="pun">(</span><span class="pln">readLn</span><span class="pun">())</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> tokenizer</span><span class="pun">!!.</span><span class="pln">nextToken</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">private</span><span class="pln"> fun readInt</span><span class="pun">()</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> read</span><span class="pun">().</span><span class="pln">toInt</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun readLong</span><span class="pun">()</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> read</span><span class="pun">().</span><span class="pln">toLong</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun readLn</span><span class="pun">()</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> reader</span><span class="pun">.</span><span class="pln">readLine</span><span class="pun">()!!</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun readInts</span><span class="pun">()</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> readLn</span><span class="pun">().</span><span class="pln">split</span><span class="pun">(</span><span class="str">" "</span><span class="pun">).</span><span class="pln">map </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">toInt</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun readInts</span><span class="pun">(</span><span class="pln">sz</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Array</span><span class="pun">(</span><span class="pln">sz</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> readInt</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun readLongs</span><span class="pun">()</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> readLn</span><span class="pun">().</span><span class="pln">split</span><span class="pun">(</span><span class="str">" "</span><span class="pun">).</span><span class="pln">map </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">toLong</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun readLongs</span><span class="pun">(</span><span class="pln">sz</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Array</span><span class="pun">(</span><span class="pln">sz</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> readLong</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun </span><span class="kwd">print</span><span class="pun">(</span><span class="pln">b</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Boolean</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="kwd">print</span><span class="pun">(</span><span class="pln">b</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun </span><span class="kwd">print</span><span class="pun">(</span><span class="pln">i</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="kwd">print</span><span class="pun">(</span><span class="pln">i</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun </span><span class="kwd">print</span><span class="pun">(</span><span class="pln">d</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Double</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="kwd">print</span><span class="pun">(</span><span class="pln">d</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun </span><span class="kwd">print</span><span class="pun">(</span><span class="pln">l</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Long</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="kwd">print</span><span class="pun">(</span><span class="pln">l</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun </span><span class="kwd">print</span><span class="pun">(</span><span class="pln">s</span><span class="pun">:</span><span class="pln"> </span><span class="typ">String</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="kwd">print</span><span class="pun">(</span><span class="pln">s</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun </span><span class="kwd">print</span><span class="pun">(</span><span class="pln">message</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Any</span><span class="pun">?)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="kwd">print</span><span class="pun">(</span><span class="pln">message</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun </span><span class="kwd">print</span><span class="pun">(</span><span class="pln">a</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Array</span><span class="pun">&lt;</span><span class="typ">Int</span><span class="pun">&gt;)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">forEach </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">print</span><span class="pun">(</span><span class="str">"$it "</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun </span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;</span><span class="pln"> </span><span class="kwd">print</span><span class="pun">(</span><span class="pln">a</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Array</span><span class="pun">&lt;</span><span class="kwd">out</span><span class="pln"> T</span><span class="pun">&gt;)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">forEach </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">print</span><span class="pun">(</span><span class="str">"$it "</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun </span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;</span><span class="pln"> </span><span class="kwd">print</span><span class="pun">(</span><span class="pln">a</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Collection</span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">forEach </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">print</span><span class="pun">(</span><span class="str">"$it "</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun println</span><span class="pun">(</span><span class="pln">b</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Boolean</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="pln">b</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun println</span><span class="pun">(</span><span class="pln">i</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="pln">i</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun println</span><span class="pun">(</span><span class="pln">d</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Double</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="pln">d</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun println</span><span class="pun">(</span><span class="pln">l</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Long</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="pln">l</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun println</span><span class="pun">(</span><span class="pln">s</span><span class="pun">:</span><span class="pln"> </span><span class="typ">String</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="pln">s</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun println</span><span class="pun">()</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="pln">println</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun println</span><span class="pun">(</span><span class="pln">message</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Any</span><span class="pun">?)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="pln">message</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun </span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;</span><span class="pln"> println</span><span class="pun">(</span><span class="pln">a</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Array</span><span class="pun">&lt;</span><span class="kwd">out</span><span class="pln"> T</span><span class="pun">&gt;)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">forEach </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">print</span><span class="pun">(</span><span class="str">"$it "</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    println</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">private</span><span class="pln"> fun println</span><span class="pun">(</span><span class="pln">a</span><span class="pun">:</span><span class="pln"> </span><span class="typ">IntArray</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">forEach </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">print</span><span class="pun">(</span><span class="str">"$it "</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    println</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">private</span><span class="pln"> fun println</span><span class="pun">(</span><span class="pln">a</span><span class="pun">:</span><span class="pln"> </span><span class="typ">LongArray</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">forEach </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">print</span><span class="pun">(</span><span class="str">"$it "</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    println</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">private</span><span class="pln"> fun </span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;</span><span class="pln"> println</span><span class="pun">(</span><span class="pln">a</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Collection</span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">forEach </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">print</span><span class="pun">(</span><span class="str">"$it "</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    println</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">private</span><span class="pln"> fun intarr</span><span class="pun">(</span><span class="pln">sz</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">,</span><span class="pln"> v</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">IntArray</span><span class="pun">(</span><span class="pln">sz</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> v </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun longarr</span><span class="pun">(</span><span class="pln">sz</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">,</span><span class="pln"> v</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">LongArray</span><span class="pun">(</span><span class="pln">sz</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> v </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun intarr2d</span><span class="pun">(</span><span class="pln">n</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">,</span><span class="pln"> m</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">,</span><span class="pln"> v</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Array</span><span class="pun">(</span><span class="pln">n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> intarr</span><span class="pun">(</span><span class="pln">m</span><span class="pun">,</span><span class="pln"> v</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun longarr2d</span><span class="pun">(</span><span class="pln">n</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">,</span><span class="pln"> m</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">,</span><span class="pln"> v</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Array</span><span class="pun">(</span><span class="pln">n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> longarr</span><span class="pun">(</span><span class="pln">m</span><span class="pun">,</span><span class="pln"> v</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun </span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;</span><span class="pln"> init</span><span class="pun">(</span><span class="pln">vararg elements</span><span class="pun">:</span><span class="pln"> T</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> elements
</span><span class="kwd">private</span><span class="pln"> fun VI</span><span class="pun">(</span><span class="pln">n</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> init</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">MutableList</span><span class="pun">(</span><span class="pln">n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> init </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun VVI</span><span class="pun">(</span><span class="pln">n</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> m</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> init</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">MutableList</span><span class="pun">(</span><span class="pln">n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> VI</span><span class="pun">(</span><span class="pln">m</span><span class="pun">,</span><span class="pln"> init</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> fun </span><span class="pun">&lt;</span><span class="pln">T1 </span><span class="pun">:</span><span class="pln"> </span><span class="typ">Comparable</span><span class="pun">&lt;</span><span class="pln">T1</span><span class="pun">&gt;,</span><span class="pln"> T2 </span><span class="pun">:</span><span class="pln"> </span><span class="typ">Comparable</span><span class="pun">&lt;</span><span class="pln">T2</span><span class="pun">&gt;&gt;</span><span class="pln"> pairCmp</span><span class="pun">():</span><span class="pln"> </span><span class="typ">Comparator</span><span class="pun">&lt;</span><span class="typ">Pair</span><span class="pun">&lt;</span><span class="pln">T1</span><span class="pun">,</span><span class="pln"> T2</span><span class="pun">&gt;&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Comparator</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> b </span><span class="pun">-&gt;</span><span class="pln">
        val res </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">first</span><span class="pun">.</span><span class="pln">compareTo</span><span class="pun">(</span><span class="pln">b</span><span class="pun">.</span><span class="pln">first</span><span class="pun">)</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">res </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">second</span><span class="pun">.</span><span class="pln">compareTo</span><span class="pun">(</span><span class="pln">b</span><span class="pun">.</span><span class="pln">second</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> res
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">


</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2141/problem/I" title="Kotlin Heroes: Episode 13">2141I - Color the Tree</a></p><p>Idea: <a class="rated-user user-red" href="https://codeforces.com/profile/BledDest" title="International Grandmaster BledDest">BledDest</a>, preparation: <a class="rated-user user-red" href="https://codeforces.com/profile/BledDest" title="International Grandmaster BledDest">BledDest</a></p> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2141/problem/I" title="Kotlin Heroes: Episode 13">2141I - Color the Tree</a></h3><div class="ttypography"><div class="problem-statement"><div><p><span class="tex-font-style-bf">Disclaimer:</span> I actually do not know the asymptotic complexity of the model solution. It definitely works in polynomial time, and I wrote a program that calculates the maximum number of reachable states and transitions in the worst case to ensure that the solution does not take too long; however, I cannot accurately estimate the complexity. My guess is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-458"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-459">O</span><span class="MJXp-mo" id="MJXp-Span-460" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-461"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-462" style="margin-right: 0.05em;">n</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-463" style="vertical-align: 0.5em;">7</span></span><span class="MJXp-mo" id="MJXp-Span-464" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-94">O(n^7)</script> with a very small hidden constant, but I cannot prove it formally.</p><p>Let's start by solving the "easy" part of the problem — calculating the number of operations required for a complete coloring of a tree. Each operation can affect no more than two leaves of the tree, so the minimum number of operations cannot be less than <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-465"><span class="MJXp-mo" id="MJXp-Span-466" style="margin-left: 0em; margin-right: 0em;">⌈</span><span class="MJXp-mfrac" id="MJXp-Span-467" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-468">m</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mn" id="MJXp-Span-469">2</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-470" style="margin-left: 0em; margin-right: 0em;">⌉</span></span></span><script type="math/tex" id="MathJax-Element-95">\lceil \frac{m}{2} \rceil</script>, where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-471"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-472">m</span></span></span><script type="math/tex" id="MathJax-Element-96">m</script> is the number of leaves. It turns out that this number of operations is always sufficient. This can be proven as follows: in the case where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-473"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-474">m</span></span></span><script type="math/tex" id="MathJax-Element-97">m</script> is even, we can pair the leaves and color all paths between the corresponding pairs of leaves; either we will achieve a complete coloring, or one of the vertices will remain uncolored. If any vertex remains uncolored, let's learn how to color it without uncoloring the other vertices: we will root the tree at this vertex and consider the subtrees of its children. In each of these subtrees, there will definitely be an even number of leaves (otherwise, the root would definitely be colored); we can take a pair of leaves <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-475"><span class="MJXp-mo" id="MJXp-Span-476" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-477">a</span><span class="MJXp-mo" id="MJXp-Span-478" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-479">b</span><span class="MJXp-mo" id="MJXp-Span-480" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-98">(a, b)</script> from one subtree and a pair of leaves <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-481"><span class="MJXp-mo" id="MJXp-Span-482" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-483">c</span><span class="MJXp-mo" id="MJXp-Span-484" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-485">d</span><span class="MJXp-mo" id="MJXp-Span-486" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-99">(c, d)</script> from another subtree, and swap these pairs to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-487"><span class="MJXp-mo" id="MJXp-Span-488" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-489">a</span><span class="MJXp-mo" id="MJXp-Span-490" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-491">c</span><span class="MJXp-mo" id="MJXp-Span-492" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-100">(a, c)</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-493"><span class="MJXp-mo" id="MJXp-Span-494" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-495">b</span><span class="MJXp-mo" id="MJXp-Span-496" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-497">d</span><span class="MJXp-mo" id="MJXp-Span-498" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-101">(b, d)</script>. Then, for the path from the lowest common ancestor of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-499"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-500">a</span></span></span><script type="math/tex" id="MathJax-Element-102">a</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-501"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-502">b</span></span></span><script type="math/tex" id="MathJax-Element-103">b</script> to the lowest common ancestor of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-503"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-504">c</span></span></span><script type="math/tex" id="MathJax-Element-104">c</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-505"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-506">d</span></span></span><script type="math/tex" id="MathJax-Element-105">d</script> (which includes the root), all vertices will be colored, while for the other vertices, the number of paths passing through them will not decrease. By repeating this process several times, we will obtain a correct coloring of the tree. For odd <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-507"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-508">m</span></span></span><script type="math/tex" id="MathJax-Element-106">m</script>, the proof can be conducted in a similar manner if we "split" one of the leaves.</p><p>Now, let's find out how to count the number of complete colorings that can be obtained with the minimum number of operations. For even <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-509"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-510">m</span></span></span><script type="math/tex" id="MathJax-Element-107">m</script>, it is not too complicated. If we fix the pairing of leaves and choose an operation index for each of these pairs, then the color for all other vertices of the tree will be determined automatically, and no two ways to pair and choose operation indices will yield the same coloring (the leaves will be colored differently each time). Therefore, the answer for even <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-511"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-512">m</span></span></span><script type="math/tex" id="MathJax-Element-108">m</script> can be calculated as <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-513"><span class="MJXp-mo" id="MJXp-Span-514" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mfrac" id="MJXp-Span-515" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-516">m</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mn" id="MJXp-Span-517">2</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-518" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-519" style="margin-left: 0.111em; margin-right: 0em;">!</span><span class="MJXp-mo" id="MJXp-Span-520" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-521">C</span></span></span><script type="math/tex" id="MathJax-Element-109">(\frac{m}{2})! \cdot C</script>, where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-522"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-523">C</span></span></span><script type="math/tex" id="MathJax-Element-110">C</script> is the number of ways to pair the leaves such that each vertex of the tree belongs to at least one path. To calculate <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-524"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-525">C</span></span></span><script type="math/tex" id="MathJax-Element-111">C</script>, we can root the tree at any non-leaf and use the following dynamic programming: <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-526"><span class="MJXp-msubsup" id="MJXp-Span-527"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-528" style="margin-right: 0.05em;">d</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-529" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-530">v</span><span class="MJXp-mo" id="MJXp-Span-531">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-532">k</span></span></span></span></span><script type="math/tex" id="MathJax-Element-112">d_{v,k}</script> is the number of ways to process the subtree of vertex <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-533"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-534">v</span></span></span><script type="math/tex" id="MathJax-Element-113">v</script> such that exactly <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-535"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-536">k</span></span></span><script type="math/tex" id="MathJax-Element-114">k</script> leaves from the subtree have a pair outside the subtree (and the remaining leaves in the subtree are paired within the subtree), and for each vertex in the subtree, there is at least one path covering it. For each vertex, this dynamic programming can be quite easily calculated using auxiliary dp of the form <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-537"><span class="MJXp-msup" id="MJXp-Span-538"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-539" style="margin-right: 0.05em;">d</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-540" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mrow" id="MJXp-Span-541"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-542">v</span><span class="MJXp-mo" id="MJXp-Span-543" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-544">k</span><span class="MJXp-mo" id="MJXp-Span-545" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-546">i</span></span></span></span><script type="math/tex" id="MathJax-Element-115">d'{v,k,i}</script> — we have processed the first <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-547"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-548">i</span></span></span><script type="math/tex" id="MathJax-Element-116">i</script> children of vertex <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-549"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-550">v</span></span></span><script type="math/tex" id="MathJax-Element-117">v</script>, and there are <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-551"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-552">k</span></span></span><script type="math/tex" id="MathJax-Element-118">k</script> leaves without pairs among them (when processing the next child, we can iterate over how many leaves without pairs will be in it and how many of them we will pair with already processed leaves). Then the value of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-553"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-554">C</span></span></span><script type="math/tex" id="MathJax-Element-119">C</script> will be stored in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-555"><span class="MJXp-msubsup" id="MJXp-Span-556"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-557" style="margin-right: 0.05em;">d</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-558" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-559">v</span><span class="MJXp-mo" id="MJXp-Span-560">,</span><span class="MJXp-mn" id="MJXp-Span-561">0</span></span></span></span></span><script type="math/tex" id="MathJax-Element-120">d_{v,0}</script> for the vertex <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-562"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-563">v</span></span></span><script type="math/tex" id="MathJax-Element-121">v</script> that is the root.</p><p>What changes in the case of odd <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-564"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-565">m</span></span></span><script type="math/tex" id="MathJax-Element-122">m</script>? Unfortunately, quite a lot. We will have one leaf without a pair (which will not be colored in the color of any other leaf), however, the operation index at which we will color it, and the operation indices for the other pairs of leaves (as well as which internal vertex of the tree we will pair that extra leaf with) significantly affect the coloring. This means that we can no longer simply calculate the number of ways to pair and multiply by some factorial — now the order of operations affects the coloring much more strongly. Let's try to iterate over the leaf that will not have a pair, as well as the operation index at which we will color it — and now we need to count the number of colorings considering the operation index.</p><p>To do this, we will root the tree at the chosen leaf and mentally divide all pairs of the remaining leaves into two types: those with operation index greater than ours, and those with operation index less than ours. Why do we need such a division? It allows us to understand which vertices of the tree can be influenced by the index of our operation — only those that are not covered by any path with a larger operation index. We also need to handle the fact that all vertices colored in our chosen color for the root must belong to one path from the root to some other vertex (which is not a leaf).</p><p>All of this can be attempted to be processed with more complex dynamic programming, in which we will consider the following states:</p><ul> <li> which subtree of which vertex we were processing; </li><li> whether there is at least one vertex of "our" color in the subtree of this vertex (this is important to ensure that we have such a vertex only in one of the children); </li><li> how many leaves without pairs are in the subtree; </li><li> how many leaves without pairs are in the subtree <span class="tex-font-style-bf">with a smaller operation index</span>; </li><li> how many pairs of leaves <span class="tex-font-style-bf">with a smaller operation index</span> are in the subtree (from these three values, we will automatically understand how many pairs of leaves with a larger operation index are in the subtree); </li><li> a parameter indicating which paths cover the current vertex (<span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-566"><span class="MJXp-mn" id="MJXp-Span-567">0</span></span></span><script type="math/tex" id="MathJax-Element-123">0</script> — not covered by any path; <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-568"><span class="MJXp-mn" id="MJXp-Span-569">1</span></span></span><script type="math/tex" id="MathJax-Element-124">1</script> — covered only by paths with a smaller operation index; <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-570"><span class="MJXp-mn" id="MJXp-Span-571">2</span></span></span><script type="math/tex" id="MathJax-Element-125">2</script> — covered by at least one path with a larger operation index). </li></ul><p>To "merge" this dynamic programming from the children of each vertex, we can iterate over how many new pairs with smaller and larger numbers we will create and multiply by the corresponding number of ways to choose these pairs (while ensuring that we do not take more than one subtree that already has a vertex of "our" color). Depending on the last parameter, we sometimes may (if it equals <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-572"><span class="MJXp-mn" id="MJXp-Span-573">1</span></span></span><script type="math/tex" id="MathJax-Element-126">1</script>) or must (if it equals <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-574"><span class="MJXp-mn" id="MJXp-Span-575">0</span></span></span><script type="math/tex" id="MathJax-Element-127">0</script>) color the current vertex in our chosen color.</p><p>How do we extract the answer from this? Let our chosen operation index be <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-576"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-577">x</span></span></span><script type="math/tex" id="MathJax-Element-128">x</script> (<span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-578"><span class="MJXp-mn" id="MJXp-Span-579">0</span></span></span><script type="math/tex" id="MathJax-Element-129">0</script>-indexed), then there must be exactly <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-580"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-581">x</span></span></span><script type="math/tex" id="MathJax-Element-130">x</script> pairs of leaves with operation indices less than <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-582"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-583">x</span></span></span><script type="math/tex" id="MathJax-Element-131">x</script>. We just need to look at the value of the dynamic programming in the state where:</p><ul> <li> the current vertex is the root of the tree; </li><li> there is definitely at least one vertex of our color in the subtree; </li><li> there are <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-584"><span class="MJXp-mn" id="MJXp-Span-585">0</span></span></span><script type="math/tex" id="MathJax-Element-132">0</script> leaves without pairs (as well as <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-586"><span class="MJXp-mn" id="MJXp-Span-587">0</span></span></span><script type="math/tex" id="MathJax-Element-133">0</script> leaves without pairs with a smaller operation number); </li><li> there are exactly <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-588"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-589">x</span></span></span><script type="math/tex" id="MathJax-Element-134">x</script> pairs of leaves with a smaller operation number; </li><li> the parameter for the current vertex is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-590"><span class="MJXp-mn" id="MJXp-Span-591">0</span></span></span><script type="math/tex" id="MathJax-Element-135">0</script> (since we rooted the tree at the only unpaired leaf). </li></ul><p>This still needs to be multiplied by the number of ways to choose operation indices for all pairs of leaves with smaller indices and for all pairs of leaves with larger indices (this is simply two factorials). In fact, we don't even need to iterate on <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-592"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-593">x</span></span></span><script type="math/tex" id="MathJax-Element-136">x</script> (our chosen operation index); our dynamic programming will automatically be calculated for all possible values of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-594"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-595">x</span></span></span><script type="math/tex" id="MathJax-Element-137">x</script>.</p><p>And now for the main question — how to implement all of this in a pleasant way. I cannot say that the model solution turned out to be short, but the process of coding it was quite simple and intuitive. First of all, I do not recommend writing this dynamic programming using six-dimensional arrays (you can do it, but the code will be quite cumbersome). Instead, I suggest creating a class that will store some states of dp and the corresponding number of ways (in the model solution, this is the <span class="tex-font-style-tt">State</span> structure, which stores everything except the current vertex and whether there is at least one vertex of "our" color in the subtree of our vertex); and store all reachable states as instances of this class.</p><p>Why do I suggest using a class? First, it will allow us not to process unreachable states (we will automatically not create any instances for unreachable states); second, it is quite easy to code the merging of two states while iterating over the number of pairs we form (look at the function <span class="tex-font-style-tt">merge2</span> in the model solution — it merges two lists of states with the corresponding values). Of course, when merging, we also need to combine identical dynamic states by summing their values — for this, it is enough to sort them and go through the sorted list (look at the function <span class="tex-font-style-tt">fix</span> in the model solution).</p><p>Now we can use <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-596"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-597">d</span><span class="MJXp-msubsup" id="MJXp-Span-598"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-599" style="margin-right: 0.05em;">p</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-600" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-601">v</span><span class="MJXp-mo" id="MJXp-Span-602">,</span><span class="MJXp-mn" id="MJXp-Span-603">0</span></span></span></span></span><script type="math/tex" id="MathJax-Element-138">dp_{v,0}</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-604"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-605">d</span><span class="MJXp-msubsup" id="MJXp-Span-606"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-607" style="margin-right: 0.05em;">p</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-608" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-609">v</span><span class="MJXp-mo" id="MJXp-Span-610">,</span><span class="MJXp-mn" id="MJXp-Span-611">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-139">dp_{v,1}</script> to store the states and values corresponding to the dynamic programming for each vertex (where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-612"><span class="MJXp-mn" id="MJXp-Span-613">0</span></span></span><script type="math/tex" id="MathJax-Element-140">0</script> means that there is no vertex of "our" color in the subtree, and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-614"><span class="MJXp-mn" id="MJXp-Span-615">1</span></span></span><script type="math/tex" id="MathJax-Element-141">1</script> means that there is at least one such vertex). This dynamic programming, by the way, will also automatically calculate the answer for the case with an even number of leaves.</p><p>I will briefly comment on what the other functions in the model solution do:</p><ul> <li> <span class="tex-font-style-tt">choose</span> simply calculates binomial coefficients using factorials and inverse factorials; </li><li> <span class="tex-font-style-tt">merge</span> allows "merging" the dynamic programming for some prefix of the children of the current vertex and the next child of the same vertex; </li><li> <span class="tex-font-style-tt">forceSpecial</span> processes the color of the current vertex, allowing to automatically determine whether we can have a vertex of "our" color in each state. </li></ul></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Solution (BledDest)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="kwd">import</span><span class="pln"> kotlin</span><span class="pun">.</span><span class="pln">math</span><span class="pun">.</span><span class="pln">min

</span><span class="kwd">const</span><span class="pln"> val K </span><span class="pun">=</span><span class="pln"> </span><span class="lit">17</span><span class="pln">
</span><span class="kwd">const</span><span class="pln"> val N </span><span class="pun">=</span><span class="pln"> K </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pln">
</span><span class="kwd">const</span><span class="pln"> val MOD </span><span class="pun">=</span><span class="pln"> </span><span class="lit">998244353</span><span class="pln">

fun </span><span class="kwd">add</span><span class="pun">(</span><span class="pln">x</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">,</span><span class="pln"> y</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">):</span><span class="pln"> </span><span class="typ">Int</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">((</span><span class="pln">x </span><span class="pun">+</span><span class="pln"> y</span><span class="pun">)</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> MOD </span><span class="pun">+</span><span class="pln"> MOD</span><span class="pun">)</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> MOD
</span><span class="pun">}</span><span class="pln">

fun mul</span><span class="pun">(</span><span class="pln">x</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">,</span><span class="pln"> y</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">):</span><span class="pln"> </span><span class="typ">Int</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x</span><span class="pun">.</span><span class="pln">toLong</span><span class="pun">()</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> y </span><span class="pun">%</span><span class="pln"> MOD</span><span class="pun">).</span><span class="pln">toInt</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

fun binpow</span><span class="pun">(</span><span class="pln">x</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">,</span><span class="pln"> y</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">):</span><span class="pln"> </span><span class="typ">Int</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> z </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> </span><span class="kwd">base</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> x
    </span><span class="kwd">var</span><span class="pln"> exponent </span><span class="pun">=</span><span class="pln"> y
    </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">exponent </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">exponent </span><span class="pun">%</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> z </span><span class="pun">=</span><span class="pln"> mul</span><span class="pun">(</span><span class="pln">z</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">base</span><span class="pun">)</span><span class="pln">
        </span><span class="kwd">base</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> mul</span><span class="pun">(</span><span class="kwd">base</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">base</span><span class="pun">)</span><span class="pln">
        exponent </span><span class="pun">/=</span><span class="pln"> </span><span class="lit">2</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> z
</span><span class="pun">}</span><span class="pln">

data </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">State</span><span class="pun">(</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> unpaired</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> unpairedLess</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> pairedLess</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> flag</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> ways</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

fun comp</span><span class="pun">(</span><span class="pln">a</span><span class="pun">:</span><span class="pln"> </span><span class="typ">State</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">:</span><span class="pln"> </span><span class="typ">State</span><span class="pun">):</span><span class="pln"> </span><span class="typ">Boolean</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">.</span><span class="pln">unpaired </span><span class="pun">!=</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">unpaired</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">unpaired </span><span class="pun">&lt;</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">unpaired
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">.</span><span class="pln">unpairedLess </span><span class="pun">!=</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">unpairedLess</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">unpairedLess </span><span class="pun">&lt;</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">unpairedLess
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">.</span><span class="pln">pairedLess </span><span class="pun">!=</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">pairedLess</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">pairedLess </span><span class="pun">&lt;</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">pairedLess
    </span><span class="kwd">return</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">flag </span><span class="pun">&lt;</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">flag
</span><span class="pun">}</span><span class="pln">

fun fix</span><span class="pun">(</span><span class="pln">v</span><span class="pun">:</span><span class="pln"> </span><span class="typ">MutableList</span><span class="pun">&lt;</span><span class="typ">State</span><span class="pun">&gt;)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    v</span><span class="pun">.</span><span class="pln">sortWith</span><span class="pun">(</span><span class="pln">compareBy</span><span class="pun">(</span><span class="typ">State</span><span class="pun">::</span><span class="pln">unpaired</span><span class="pun">).</span><span class="pln">thenBy </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">unpairedLess </span><span class="pun">}.</span><span class="pln">thenBy </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">pairedLess </span><span class="pun">}.</span><span class="pln">thenBy </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">flag </span><span class="pun">})</span><span class="pln">
    val v2 </span><span class="pun">=</span><span class="pln"> mutableListOf</span><span class="pun">&lt;</span><span class="typ">State</span><span class="pun">&gt;()</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">s </span><span class="kwd">in</span><span class="pln"> v</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">s</span><span class="pun">.</span><span class="pln">ways </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">continue</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">v2</span><span class="pun">.</span><span class="pln">isEmpty</span><span class="pun">()</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> comp</span><span class="pun">(</span><span class="pln">v2</span><span class="pun">.</span><span class="kwd">last</span><span class="pun">(),</span><span class="pln"> s</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            v2</span><span class="pun">.</span><span class="kwd">add</span><span class="pun">(</span><span class="pln">s</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            v2</span><span class="pun">.</span><span class="kwd">last</span><span class="pun">().</span><span class="pln">ways </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">add</span><span class="pun">(</span><span class="pln">v2</span><span class="pun">.</span><span class="kwd">last</span><span class="pun">().</span><span class="pln">ways</span><span class="pun">,</span><span class="pln"> s</span><span class="pun">.</span><span class="pln">ways</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    v</span><span class="pun">.</span><span class="pln">clear</span><span class="pun">()</span><span class="pln">
    v</span><span class="pun">.</span><span class="pln">addAll</span><span class="pun">(</span><span class="pln">v2</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

val fact </span><span class="pun">=</span><span class="pln"> </span><span class="typ">IntArray</span><span class="pun">(</span><span class="pln">N</span><span class="pun">)</span><span class="pln">
val rfact </span><span class="pun">=</span><span class="pln"> </span><span class="typ">IntArray</span><span class="pun">(</span><span class="pln">N</span><span class="pun">)</span><span class="pln">
val g </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Array</span><span class="pun">(</span><span class="pln">N</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> mutableListOf</span><span class="pun">&lt;</span><span class="typ">Int</span><span class="pun">&gt;()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
val dp </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Array</span><span class="pun">(</span><span class="pln">N</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> mutableListOf</span><span class="pun">&lt;</span><span class="typ">MutableList</span><span class="pun">&lt;</span><span class="typ">State</span><span class="pun">&gt;&gt;()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">var</span><span class="pln"> n </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">

fun choose</span><span class="pun">(</span><span class="pln">x</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">,</span><span class="pln"> y</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">):</span><span class="pln"> </span><span class="typ">Int</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> mul</span><span class="pun">(</span><span class="pln">fact</span><span class="pun">[</span><span class="pln">x</span><span class="pun">],</span><span class="pln"> mul</span><span class="pun">(</span><span class="pln">rfact</span><span class="pun">[</span><span class="pln">y</span><span class="pun">],</span><span class="pln"> rfact</span><span class="pun">[</span><span class="pln">x </span><span class="pun">-</span><span class="pln"> y</span><span class="pun">]))</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

fun merge2</span><span class="pun">(</span><span class="pln">x</span><span class="pun">:</span><span class="pln"> </span><span class="typ">MutableList</span><span class="pun">&lt;</span><span class="typ">State</span><span class="pun">&gt;,</span><span class="pln"> y</span><span class="pun">:</span><span class="pln"> </span><span class="typ">MutableList</span><span class="pun">&lt;</span><span class="typ">State</span><span class="pun">&gt;):</span><span class="pln"> </span><span class="typ">MutableList</span><span class="pun">&lt;</span><span class="typ">State</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    val res </span><span class="pun">=</span><span class="pln"> mutableListOf</span><span class="pun">&lt;</span><span class="typ">State</span><span class="pun">&gt;()</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a </span><span class="kwd">in</span><span class="pln"> x</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">b </span><span class="kwd">in</span><span class="pln"> y</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">pairLess </span><span class="kwd">in</span><span class="pln"> </span><span class="lit">0.</span><span class="pun">.</span><span class="pln">min</span><span class="pun">(</span><span class="pln">a</span><span class="pun">.</span><span class="pln">unpairedLess</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">unpairedLess</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">pairGreater </span><span class="kwd">in</span><span class="pln"> </span><span class="lit">0.</span><span class="pun">.</span><span class="pln">min</span><span class="pun">(</span><span class="pln">a</span><span class="pun">.</span><span class="pln">unpaired </span><span class="pun">-</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">unpairedLess</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">unpaired </span><span class="pun">-</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">unpairedLess</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    </span><span class="kwd">var</span><span class="pln"> numOfChoices </span><span class="pun">=</span><span class="pln"> mul</span><span class="pun">(</span><span class="pln">fact</span><span class="pun">[</span><span class="pln">pairLess</span><span class="pun">],</span><span class="pln"> fact</span><span class="pun">[</span><span class="pln">pairGreater</span><span class="pun">])</span><span class="pln">
                    numOfChoices </span><span class="pun">=</span><span class="pln"> mul</span><span class="pun">(</span><span class="pln">numOfChoices</span><span class="pun">,</span><span class="pln"> choose</span><span class="pun">(</span><span class="pln">a</span><span class="pun">.</span><span class="pln">unpairedLess</span><span class="pun">,</span><span class="pln"> pairLess</span><span class="pun">))</span><span class="pln">
                    numOfChoices </span><span class="pun">=</span><span class="pln"> mul</span><span class="pun">(</span><span class="pln">numOfChoices</span><span class="pun">,</span><span class="pln"> choose</span><span class="pun">(</span><span class="pln">a</span><span class="pun">.</span><span class="pln">unpaired </span><span class="pun">-</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">unpairedLess</span><span class="pun">,</span><span class="pln"> pairGreater</span><span class="pun">))</span><span class="pln">
                    numOfChoices </span><span class="pun">=</span><span class="pln"> mul</span><span class="pun">(</span><span class="pln">numOfChoices</span><span class="pun">,</span><span class="pln"> choose</span><span class="pun">(</span><span class="pln">b</span><span class="pun">.</span><span class="pln">unpairedLess</span><span class="pun">,</span><span class="pln"> pairLess</span><span class="pun">))</span><span class="pln">
                    numOfChoices </span><span class="pun">=</span><span class="pln"> mul</span><span class="pun">(</span><span class="pln">numOfChoices</span><span class="pun">,</span><span class="pln"> choose</span><span class="pun">(</span><span class="pln">b</span><span class="pun">.</span><span class="pln">unpaired </span><span class="pun">-</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">unpairedLess</span><span class="pun">,</span><span class="pln"> pairGreater</span><span class="pun">))</span><span class="pln">
                    numOfChoices </span><span class="pun">=</span><span class="pln"> mul</span><span class="pun">(</span><span class="pln">numOfChoices</span><span class="pun">,</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">ways</span><span class="pun">)</span><span class="pln">
                    numOfChoices </span><span class="pun">=</span><span class="pln"> mul</span><span class="pun">(</span><span class="pln">numOfChoices</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">ways</span><span class="pun">)</span><span class="pln">
                    </span><span class="kwd">var</span><span class="pln"> flag </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
                    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">.</span><span class="pln">unpairedLess </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">unpairedLess </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> flag </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
                    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">.</span><span class="pln">unpairedLess </span><span class="pun">&lt;</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">unpaired </span><span class="pun">||</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">unpairedLess </span><span class="pun">&lt;</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">unpaired</span><span class="pun">)</span><span class="pln"> flag </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pln">
                    res</span><span class="pun">.</span><span class="kwd">add</span><span class="pun">(</span><span class="typ">State</span><span class="pun">(</span><span class="pln">a</span><span class="pun">.</span><span class="pln">unpaired </span><span class="pun">+</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">unpaired </span><span class="pun">-</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> pairLess </span><span class="pun">-</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> pairGreater</span><span class="pun">,</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">unpairedLess </span><span class="pun">+</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">unpairedLess </span><span class="pun">-</span><span class="pln"> pairLess </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">pairedLess </span><span class="pun">+</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">pairedLess </span><span class="pun">+</span><span class="pln"> pairLess</span><span class="pun">,</span><span class="pln"> maxOf</span><span class="pun">(</span><span class="pln">flag</span><span class="pun">,</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">flag</span><span class="pun">),</span><span class="pln"> numOfChoices</span><span class="pun">))</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    fix</span><span class="pun">(</span><span class="pln">res</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> res
</span><span class="pun">}</span><span class="pln">

fun merge</span><span class="pun">(</span><span class="pln">a</span><span class="pun">:</span><span class="pln"> </span><span class="typ">MutableList</span><span class="pun">&lt;</span><span class="typ">MutableList</span><span class="pun">&lt;</span><span class="typ">State</span><span class="pun">&gt;&gt;,</span><span class="pln"> b</span><span class="pun">:</span><span class="pln"> </span><span class="typ">MutableList</span><span class="pun">&lt;</span><span class="typ">MutableList</span><span class="pun">&lt;</span><span class="typ">State</span><span class="pun">&gt;&gt;):</span><span class="pln"> </span><span class="typ">MutableList</span><span class="pun">&lt;</span><span class="typ">MutableList</span><span class="pun">&lt;</span><span class="typ">State</span><span class="pun">&gt;&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    val res </span><span class="pun">=</span><span class="pln"> </span><span class="typ">MutableList</span><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> mutableListOf</span><span class="pun">&lt;</span><span class="typ">State</span><span class="pun">&gt;()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="kwd">in</span><span class="pln"> </span><span class="lit">0.</span><span class="pun">.</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">j </span><span class="kwd">in</span><span class="pln"> </span><span class="lit">0.</span><span class="pun">.</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> j </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">continue</span><span class="pln">
            val cur </span><span class="pun">=</span><span class="pln"> merge2</span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">],</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">j</span><span class="pun">])</span><span class="pln">
            res</span><span class="pun">[</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> j</span><span class="pun">].</span><span class="pln">addAll</span><span class="pun">(</span><span class="pln">cur</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="kwd">in</span><span class="pln"> </span><span class="lit">0.</span><span class="pun">.</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> fix</span><span class="pun">(</span><span class="pln">res</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> res
</span><span class="pun">}</span><span class="pln">

fun getDp</span><span class="pun">(</span><span class="pln">s</span><span class="pun">:</span><span class="pln"> </span><span class="typ">MutableList</span><span class="pun">&lt;</span><span class="typ">State</span><span class="pun">&gt;,</span><span class="pln"> cntLess</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">,</span><span class="pln"> flag</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">):</span><span class="pln"> </span><span class="typ">Int</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x </span><span class="kwd">in</span><span class="pln"> s</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x</span><span class="pun">.</span><span class="pln">unpaired </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> x</span><span class="pun">.</span><span class="pln">pairedLess </span><span class="pun">==</span><span class="pln"> cntLess </span><span class="pun">&amp;&amp;</span><span class="pln"> x</span><span class="pun">.</span><span class="pln">flag </span><span class="pun">==</span><span class="pln"> flag</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> x</span><span class="pun">.</span><span class="pln">ways
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

fun forceSpecial</span><span class="pun">(</span><span class="pln">a</span><span class="pun">:</span><span class="pln"> </span><span class="typ">MutableList</span><span class="pun">&lt;</span><span class="typ">MutableList</span><span class="pun">&lt;</span><span class="typ">State</span><span class="pun">&gt;&gt;):</span><span class="pln"> </span><span class="typ">MutableList</span><span class="pun">&lt;</span><span class="typ">MutableList</span><span class="pun">&lt;</span><span class="typ">State</span><span class="pun">&gt;&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    val res </span><span class="pun">=</span><span class="pln"> </span><span class="typ">MutableList</span><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> mutableListOf</span><span class="pun">&lt;</span><span class="typ">State</span><span class="pun">&gt;()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x </span><span class="kwd">in</span><span class="pln"> a</span><span class="pun">[</span><span class="lit">0</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">when</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x</span><span class="pun">.</span><span class="pln">flag</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="lit">0</span><span class="pln"> </span><span class="pun">-&gt;</span><span class="pln"> res</span><span class="pun">[</span><span class="lit">1</span><span class="pun">].</span><span class="kwd">add</span><span class="pun">(</span><span class="pln">x</span><span class="pun">)</span><span class="pln">
            </span><span class="lit">1</span><span class="pln"> </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                res</span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="kwd">add</span><span class="pun">(</span><span class="pln">x</span><span class="pun">.</span><span class="pln">copy</span><span class="pun">())</span><span class="pln">
                res</span><span class="pun">[</span><span class="lit">1</span><span class="pun">].</span><span class="kwd">add</span><span class="pun">(</span><span class="pln">x</span><span class="pun">.</span><span class="pln">copy</span><span class="pun">())</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
            </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">-&gt;</span><span class="pln"> res</span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="kwd">add</span><span class="pun">(</span><span class="pln">x</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x </span><span class="kwd">in</span><span class="pln"> a</span><span class="pun">[</span><span class="lit">1</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        res</span><span class="pun">[</span><span class="lit">1</span><span class="pun">].</span><span class="kwd">add</span><span class="pun">(</span><span class="pln">x</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    fix</span><span class="pun">(</span><span class="pln">res</span><span class="pun">[</span><span class="lit">0</span><span class="pun">])</span><span class="pln">
    fix</span><span class="pun">(</span><span class="pln">res</span><span class="pun">[</span><span class="lit">1</span><span class="pun">])</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> res
</span><span class="pun">}</span><span class="pln">

fun dfs</span><span class="pun">(</span><span class="pln">v</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">,</span><span class="pln"> p</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    val children </span><span class="pun">=</span><span class="pln"> mutableListOf</span><span class="pun">&lt;</span><span class="typ">Int</span><span class="pun">&gt;()</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x </span><span class="kwd">in</span><span class="pln"> g</span><span class="pun">[</span><span class="pln">v</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x </span><span class="pun">!=</span><span class="pln"> p</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            dfs</span><span class="pun">(</span><span class="pln">x</span><span class="pun">,</span><span class="pln"> v</span><span class="pun">)</span><span class="pln">
            children</span><span class="pun">.</span><span class="kwd">add</span><span class="pun">(</span><span class="pln">x</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">g</span><span class="pun">[</span><span class="pln">v</span><span class="pun">].</span><span class="pln">size </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> v </span><span class="pun">!=</span><span class="pln"> p</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        val s1 </span><span class="pun">=</span><span class="pln"> </span><span class="typ">State</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">
        val s2 </span><span class="pun">=</span><span class="pln"> </span><span class="typ">State</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">
        dp</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> mutableListOf</span><span class="pun">(</span><span class="pln">mutableListOf</span><span class="pun">(</span><span class="pln">s1</span><span class="pun">,</span><span class="pln"> s2</span><span class="pun">),</span><span class="pln"> mutableListOf</span><span class="pun">())</span><span class="pln">
        fix</span><span class="pun">(</span><span class="pln">dp</span><span class="pun">[</span><span class="pln">v</span><span class="pun">][</span><span class="lit">0</span><span class="pun">])</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> aux </span><span class="pun">=</span><span class="pln"> </span><span class="typ">MutableList</span><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> mutableListOf</span><span class="pun">&lt;</span><span class="typ">State</span><span class="pun">&gt;()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    aux</span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="kwd">add</span><span class="pun">(</span><span class="typ">State</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">))</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">c </span><span class="kwd">in</span><span class="pln"> children</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        aux </span><span class="pun">=</span><span class="pln"> merge</span><span class="pun">(</span><span class="pln">aux</span><span class="pun">,</span><span class="pln"> dp</span><span class="pun">[</span><span class="pln">c</span><span class="pun">])</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    dp</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> forceSpecial</span><span class="pun">(</span><span class="pln">aux</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

fun main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    val reader </span><span class="pun">=</span><span class="pln"> </span><span class="typ">System</span><span class="pun">.</span><span class="str">`in`</span><span class="pun">.</span><span class="pln">bufferedReader</span><span class="pun">()</span><span class="pln">
    n </span><span class="pun">=</span><span class="pln"> reader</span><span class="pun">.</span><span class="pln">readLine</span><span class="pun">().</span><span class="pln">toInt</span><span class="pun">()</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="kwd">in</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="kwd">until</span><span class="pln"> n </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        val </span><span class="pun">(</span><span class="pln">x</span><span class="pun">,</span><span class="pln"> y</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> reader</span><span class="pun">.</span><span class="pln">readLine</span><span class="pun">().</span><span class="pln">split</span><span class="pun">(</span><span class="str">" "</span><span class="pun">).</span><span class="pln">map </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">toInt</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
        g</span><span class="pun">[</span><span class="pln">x </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">].</span><span class="kwd">add</span><span class="pun">(</span><span class="pln">y </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">
        g</span><span class="pun">[</span><span class="pln">y </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">].</span><span class="kwd">add</span><span class="pun">(</span><span class="pln">x </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    val leaves </span><span class="pun">=</span><span class="pln"> mutableListOf</span><span class="pun">&lt;</span><span class="typ">Int</span><span class="pun">&gt;()</span><span class="pln">
    val nonLeaves </span><span class="pun">=</span><span class="pln"> mutableListOf</span><span class="pun">&lt;</span><span class="typ">Int</span><span class="pun">&gt;()</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="kwd">in</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="kwd">until</span><span class="pln"> n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">g</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">size </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> leaves</span><span class="pun">.</span><span class="kwd">add</span><span class="pun">(</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> nonLeaves</span><span class="pun">.</span><span class="kwd">add</span><span class="pun">(</span><span class="pln">i</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    fact</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="kwd">in</span><span class="pln"> </span><span class="lit">1.</span><span class="pun">.</span><span class="pln">n</span><span class="pun">)</span><span class="pln"> fact</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> mul</span><span class="pun">(</span><span class="pln">fact</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">],</span><span class="pln"> i</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="kwd">in</span><span class="pln"> </span><span class="lit">0.</span><span class="pun">.</span><span class="pln">n</span><span class="pun">)</span><span class="pln"> rfact</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> binpow</span><span class="pun">(</span><span class="pln">fact</span><span class="pun">[</span><span class="pln">i</span><span class="pun">],</span><span class="pln"> MOD </span><span class="pun">-</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> ans </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">leaves</span><span class="pun">.</span><span class="pln">size </span><span class="pun">%</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        val root </span><span class="pun">=</span><span class="pln"> nonLeaves</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln">
        dfs</span><span class="pun">(</span><span class="pln">root</span><span class="pun">,</span><span class="pln"> root</span><span class="pun">)</span><span class="pln">
        ans </span><span class="pun">=</span><span class="pln"> mul</span><span class="pun">(</span><span class="pln">fact</span><span class="pun">[</span><span class="pln">leaves</span><span class="pun">.</span><span class="pln">size </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pun">],</span><span class="pln"> getDp</span><span class="pun">(</span><span class="pln">dp</span><span class="pun">[</span><span class="pln">root</span><span class="pun">][</span><span class="lit">0</span><span class="pun">],</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">))</span><span class="pln">
        println</span><span class="pun">(</span><span class="str">"${leaves.size / 2} $ans"</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">print</span><span class="pun">(</span><span class="str">"${(leaves.size + 1) / 2} "</span><span class="pun">)</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x </span><span class="kwd">in</span><span class="pln"> leaves</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            dfs</span><span class="pun">(</span><span class="pln">x</span><span class="pun">,</span><span class="pln"> x</span><span class="pun">)</span><span class="pln">
            </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">j </span><span class="kwd">in</span><span class="pln"> </span><span class="lit">0.</span><span class="pun">.</span><span class="pln">leaves</span><span class="pun">.</span><span class="pln">size </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                val cur </span><span class="pun">=</span><span class="pln"> getDp</span><span class="pun">(</span><span class="pln">dp</span><span class="pun">[</span><span class="pln">x</span><span class="pun">][</span><span class="lit">1</span><span class="pun">],</span><span class="pln"> j</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln">
                ans </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">add</span><span class="pun">(</span><span class="pln">ans</span><span class="pun">,</span><span class="pln"> mul</span><span class="pun">(</span><span class="pln">cur</span><span class="pun">,</span><span class="pln"> mul</span><span class="pun">(</span><span class="pln">fact</span><span class="pun">[</span><span class="pln">j</span><span class="pun">],</span><span class="pln"> fact</span><span class="pun">[</span><span class="pln">leaves</span><span class="pun">.</span><span class="pln">size </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> j</span><span class="pun">])))</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        println</span><span class="pun">(</span><span class="pln">ans</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div></div>

    </div>


        <div style="font-size: 1.1rem;line-height: 1.1rem;padding-bottom: 0.5em;">
            <img src="https://codeforces.com//codeforces.com/codeforces.org/s/52448/images/icons/paperclip-16x16.png" style="vertical-align: middle;"> <span style="padding: 0 0.35em;">Tutorial of <a href="https://codeforces.com/contest/2141" class="notice" style="text-decoration: none;">Kotlin Heroes: Episode 13</a> </span>
        </div>
        
            

  <script>
    // Make all spoilers toggleable
    document.querySelectorAll('.spoiler-title').forEach(title => {
      title.addEventListener('click', function() {
        const spoiler = this.closest('.spoiler');
        spoiler.classList.toggle('open');
      });
    });
    
    // Open all spoilers by default for easier reading
    document.querySelectorAll('.spoiler').forEach(spoiler => {
      spoiler.classList.add('open');
    });
  </script>
</body>
</html>