{
  "contestId": 2141,
  "index": "I",
  "title": "Color the Tree",
  "timeLimit": "7 seconds",
  "memoryLimit": "512 megabytes",
  "rating": 3500,
  "tags": [
    "*special"
  ],
  "statementHtml": "<p>You are given a tree consisting of <span class=\"MathJax_Preview\" style=\"color: inherit;\"></span><span class=\"MathJax\" id=\"MathJax-Element-1-Frame\" tabindex=\"0\" data-mathml=\"&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/math&gt;\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-1\" style=\"width: 0.814em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 132%;\"><span style=\"position: absolute; clip: rect(1.518em, 1000.6em, 2.275em, -999.997em); top: -2.108em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-2\"><span class=\"mi\" id=\"MathJax-Span-3\" style=\"font-family: MathJax_Math-italic;\">n</span></span><span style=\"display: inline-block; width: 0px; height: 2.113em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>n</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-1\">n</script> vertices. Initially, none of the vertices of the tree are colored.</p>\n<p>You can perform the following operation: choose any two vertices <span class=\"MathJax_Preview\" style=\"color: inherit;\"></span><span class=\"MathJax\" id=\"MathJax-Element-2-Frame\" tabindex=\"0\" data-mathml=\"&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;/math&gt;\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-4\" style=\"width: 0.814em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 132%;\"><span style=\"position: absolute; clip: rect(1.518em, 1000.6em, 2.275em, -999.997em); top: -2.108em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-5\"><span class=\"mi\" id=\"MathJax-Span-6\" style=\"font-family: MathJax_Math-italic;\">u</span></span><span style=\"display: inline-block; width: 0px; height: 2.113em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>u</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-2\">u</script> and <span class=\"MathJax_Preview\" style=\"color: inherit;\"></span><span class=\"MathJax\" id=\"MathJax-Element-3-Frame\" tabindex=\"0\" data-mathml=\"&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;/math&gt;\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-7\" style=\"width: 0.652em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;\"><span style=\"position: absolute; clip: rect(1.518em, 1000.49em, 2.275em, -999.997em); top: -2.108em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-8\"><span class=\"mi\" id=\"MathJax-Span-9\" style=\"font-family: MathJax_Math-italic;\">v</span></span><span style=\"display: inline-block; width: 0px; height: 2.113em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>v</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-3\">v</script> (you are allowed to choose <span class=\"MathJax_Preview\" style=\"color: inherit;\"></span><span class=\"MathJax\" id=\"MathJax-Element-4-Frame\" tabindex=\"0\" data-mathml=\"&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;/math&gt;\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-10\" style=\"width: 3.141em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 2.384em; height: 0px; font-size: 132%;\"><span style=\"position: absolute; clip: rect(1.572em, 1002.38em, 2.33em, -999.997em); top: -2.162em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-11\"><span class=\"mi\" id=\"MathJax-Span-12\" style=\"font-family: MathJax_Math-italic;\">u</span><span class=\"mo\" id=\"MathJax-Span-13\" style=\"font-family: MathJax_Main; padding-left: 0.273em;\">=</span><span class=\"mi\" id=\"MathJax-Span-14\" style=\"font-family: MathJax_Math-italic; padding-left: 0.273em;\">v</span></span><span style=\"display: inline-block; width: 0px; height: 2.167em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>u</mi><mo>=</mo><mi>v</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-4\">u=v</script>) and color all the vertices on the path between them (including the endpoints) with color <span class=\"MathJax_Preview\" style=\"color: inherit;\"></span><span class=\"MathJax\" id=\"MathJax-Element-5-Frame\" tabindex=\"0\" data-mathml=\"&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/math&gt;\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-15\" style=\"width: 0.436em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.327em; height: 0px; font-size: 132%;\"><span style=\"position: absolute; clip: rect(1.301em, 1000.27em, 2.275em, -999.997em); top: -2.108em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-16\"><span class=\"mi\" id=\"MathJax-Span-17\" style=\"font-family: MathJax_Math-italic;\">i</span></span><span style=\"display: inline-block; width: 0px; height: 2.113em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>i</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-5\">i</script>, where <span class=\"MathJax_Preview\" style=\"color: inherit;\"></span><span class=\"MathJax\" id=\"MathJax-Element-6-Frame\" tabindex=\"0\" data-mathml=\"&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/math&gt;\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-18\" style=\"width: 0.436em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.327em; height: 0px; font-size: 132%;\"><span style=\"position: absolute; clip: rect(1.301em, 1000.27em, 2.275em, -999.997em); top: -2.108em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-19\"><span class=\"mi\" id=\"MathJax-Span-20\" style=\"font-family: MathJax_Math-italic;\">i</span></span><span style=\"display: inline-block; width: 0px; height: 2.113em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>i</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-6\">i</script> is the index of the operation you are performing (that is, the first operation uses color <span class=\"MathJax_Preview\" style=\"color: inherit;\"></span><span class=\"MathJax\" id=\"MathJax-Element-7-Frame\" tabindex=\"0\" data-mathml=\"&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/math&gt;\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-21\" style=\"width: 0.652em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;\"><span style=\"position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-22\"><span class=\"mn\" id=\"MathJax-Span-23\" style=\"font-family: MathJax_Main;\">1</span></span><span style=\"display: inline-block; width: 0px; height: 2.167em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mn>1</mn></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-7\">1</script>, the second uses color <span class=\"MathJax_Preview\" style=\"color: inherit;\"></span><span class=\"MathJax\" id=\"MathJax-Element-8-Frame\" tabindex=\"0\" data-mathml=\"&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/math&gt;\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-24\" style=\"width: 0.652em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;\"><span style=\"position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-25\"><span class=\"mn\" id=\"MathJax-Span-26\" style=\"font-family: MathJax_Main;\">2</span></span><span style=\"display: inline-block; width: 0px; height: 2.167em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mn>2</mn></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-8\">2</script>, and so on). If any vertex on the path has already been colored before, its color changes to the new one.</p>\n<p>We call the coloring of the tree <span class=\"tex-font-style-bf\">complete</span> if for each vertex, at least one operation has colored it.</p>\n<p>Your task is to calculate two values:</p>",
  "inputSpecHtml": "<p>The first line contains a single integer <span class=\"MathJax_Preview\" style=\"color: inherit;\"></span><span class=\"MathJax\" id=\"MathJax-Element-12-Frame\" tabindex=\"0\" data-mathml=\"&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/math&gt;\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-36\" style=\"width: 0.814em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 132%;\"><span style=\"position: absolute; clip: rect(1.518em, 1000.6em, 2.275em, -999.997em); top: -2.108em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-37\"><span class=\"mi\" id=\"MathJax-Span-38\" style=\"font-family: MathJax_Math-italic;\">n</span></span><span style=\"display: inline-block; width: 0px; height: 2.113em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>n</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-12\">n</script> (<span class=\"MathJax_Preview\" style=\"color: inherit;\"></span><span class=\"MathJax\" id=\"MathJax-Element-13-Frame\" tabindex=\"0\" data-mathml=\"&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;mo&gt;&amp;#x2264;&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;&amp;#x2264;&lt;/mo&gt;&lt;mn&gt;32&lt;/mn&gt;&lt;/math&gt;\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-39\" style=\"width: 6.28em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 4.765em; height: 0px; font-size: 132%;\"><span style=\"position: absolute; clip: rect(1.356em, 1004.71em, 2.492em, -999.997em); top: -2.162em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-40\"><span class=\"mn\" id=\"MathJax-Span-41\" style=\"font-family: MathJax_Main;\">3</span><span class=\"mo\" id=\"MathJax-Span-42\" style=\"font-family: MathJax_Main; padding-left: 0.273em;\">≤</span><span class=\"mi\" id=\"MathJax-Span-43\" style=\"font-family: MathJax_Math-italic; padding-left: 0.273em;\">n</span><span class=\"mo\" id=\"MathJax-Span-44\" style=\"font-family: MathJax_Main; padding-left: 0.273em;\">≤</span><span class=\"mn\" id=\"MathJax-Span-45\" style=\"font-family: MathJax_Main; padding-left: 0.273em;\">32</span></span><span style=\"display: inline-block; width: 0px; height: 2.167em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 1.218em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mn>3</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>32</mn></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-13\">3 \\le n \\le 32</script>) — the number of vertices in the tree.</p><p>The next <span class=\"MathJax_Preview\" style=\"color: inherit;\"></span><span class=\"MathJax\" id=\"MathJax-Element-14-Frame\" tabindex=\"0\" data-mathml=\"&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-46\" style=\"width: 4.115em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 3.087em; height: 0px; font-size: 132%;\"><span style=\"position: absolute; clip: rect(1.247em, 1002.98em, 2.6em, -999.997em); top: -2.162em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-47\"><span class=\"mo\" id=\"MathJax-Span-48\" style=\"font-family: MathJax_Main;\">(</span><span class=\"mi\" id=\"MathJax-Span-49\" style=\"font-family: MathJax_Math-italic;\">n</span><span class=\"mo\" id=\"MathJax-Span-50\" style=\"font-family: MathJax_Main; padding-left: 0.219em;\">−</span><span class=\"mn\" id=\"MathJax-Span-51\" style=\"font-family: MathJax_Main; padding-left: 0.219em;\">1</span><span class=\"mo\" id=\"MathJax-Span-52\" style=\"font-family: MathJax_Main;\">)</span></span><span style=\"display: inline-block; width: 0px; height: 2.167em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mo stretchy=\"false\">(</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy=\"false\">)</mo></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-14\">(n-1)</script> lines contain two integers <span class=\"MathJax_Preview\" style=\"color: inherit;\"></span><span class=\"MathJax\" id=\"MathJax-Element-15-Frame\" tabindex=\"0\" data-mathml=\"&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-53\" style=\"width: 1.139em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.869em; height: 0px; font-size: 132%;\"><span style=\"position: absolute; clip: rect(1.518em, 1000.87em, 2.438em, -999.997em); top: -2.108em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-54\"><span class=\"msubsup\" id=\"MathJax-Span-55\"><span style=\"display: inline-block; position: relative; width: 0.869em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.412em, 1000.54em, 4.169em, -999.997em); top: -4.002em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-56\" style=\"font-family: MathJax_Math-italic;\">x</span><span style=\"display: inline-block; width: 0px; height: 4.007em;\"></span></span><span style=\"position: absolute; top: -3.839em; left: 0.598em;\"><span class=\"mi\" id=\"MathJax-Span-57\" style=\"font-size: 70.7%; font-family: MathJax_Math-italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.007em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.113em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 0.932em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>x</mi><mi>i</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-15\">x_i</script> and <span class=\"MathJax_Preview\" style=\"color: inherit;\"></span><span class=\"MathJax\" id=\"MathJax-Element-16-Frame\" tabindex=\"0\" data-mathml=\"&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-58\" style=\"width: 1.085em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.814em; height: 0px; font-size: 132%;\"><span style=\"position: absolute; clip: rect(1.518em, 1000.81em, 2.492em, -999.997em); top: -2.108em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-59\"><span class=\"msubsup\" id=\"MathJax-Span-60\"><span style=\"display: inline-block; position: relative; width: 0.814em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-61\" style=\"font-family: MathJax_Math-italic;\">y<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.007em;\"></span></span><span style=\"position: absolute; top: -3.839em; left: 0.49em;\"><span class=\"mi\" id=\"MathJax-Span-62\" style=\"font-size: 70.7%; font-family: MathJax_Math-italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.007em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.113em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>y</mi><mi>i</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-16\">y_i</script> (<span class=\"MathJax_Preview\" style=\"color: inherit;\"></span><span class=\"MathJax\" id=\"MathJax-Element-17-Frame\" tabindex=\"0\" data-mathml=\"&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x2264;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2264;&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/math&gt;\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-63\" style=\"width: 7.741em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 5.847em; height: 0px; font-size: 132%;\"><span style=\"position: absolute; clip: rect(1.356em, 1005.85em, 2.546em, -999.997em); top: -2.162em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-64\"><span class=\"mn\" id=\"MathJax-Span-65\" style=\"font-family: MathJax_Main;\">1</span><span class=\"mo\" id=\"MathJax-Span-66\" style=\"font-family: MathJax_Main; padding-left: 0.273em;\">≤</span><span class=\"msubsup\" id=\"MathJax-Span-67\" style=\"padding-left: 0.273em;\"><span style=\"display: inline-block; position: relative; width: 0.869em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.412em, 1000.54em, 4.169em, -999.997em); top: -4.002em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-68\" style=\"font-family: MathJax_Math-italic;\">x</span><span style=\"display: inline-block; width: 0px; height: 4.007em;\"></span></span><span style=\"position: absolute; top: -3.839em; left: 0.598em;\"><span class=\"mi\" id=\"MathJax-Span-69\" style=\"font-size: 70.7%; font-family: MathJax_Math-italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.007em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-70\" style=\"font-family: MathJax_Main;\">,</span><span class=\"msubsup\" id=\"MathJax-Span-71\" style=\"padding-left: 0.165em;\"><span style=\"display: inline-block; position: relative; width: 0.814em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-72\" style=\"font-family: MathJax_Math-italic;\">y<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.007em;\"></span></span><span style=\"position: absolute; top: -3.839em; left: 0.49em;\"><span class=\"mi\" id=\"MathJax-Span-73\" style=\"font-size: 70.7%; font-family: MathJax_Math-italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.007em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-74\" style=\"font-family: MathJax_Main; padding-left: 0.273em;\">≤</span><span class=\"mi\" id=\"MathJax-Span-75\" style=\"font-family: MathJax_Math-italic; padding-left: 0.273em;\">n</span></span><span style=\"display: inline-block; width: 0px; height: 2.167em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.289em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mn>1</mn><mo>≤</mo><msub><mi>x</mi><mi>i</mi></msub><mo>,</mo><msub><mi>y</mi><mi>i</mi></msub><mo>≤</mo><mi>n</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-17\">1 \\le x_i, y_i \\le n</script>; <span class=\"MathJax_Preview\" style=\"color: inherit;\"></span><span class=\"MathJax\" id=\"MathJax-Element-18-Frame\" tabindex=\"0\" data-mathml=\"&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2260;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-76\" style=\"width: 4.007em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 3.033em; height: 0px; font-size: 132%;\"><span style=\"position: absolute; clip: rect(1.301em, 1003.03em, 2.546em, -999.997em); top: -2.162em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-77\"><span class=\"msubsup\" id=\"MathJax-Span-78\"><span style=\"display: inline-block; position: relative; width: 0.869em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.412em, 1000.54em, 4.169em, -999.997em); top: -4.002em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-79\" style=\"font-family: MathJax_Math-italic;\">x</span><span style=\"display: inline-block; width: 0px; height: 4.007em;\"></span></span><span style=\"position: absolute; top: -3.839em; left: 0.598em;\"><span class=\"mi\" id=\"MathJax-Span-80\" style=\"font-size: 70.7%; font-family: MathJax_Math-italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.007em;\"></span></span></span></span><span class=\"mo\" id=\"MathJax-Span-81\" style=\"font-family: MathJax_Main; padding-left: 0.273em;\">≠</span><span class=\"msubsup\" id=\"MathJax-Span-82\" style=\"padding-left: 0.273em;\"><span style=\"display: inline-block; position: relative; width: 0.814em; height: 0px;\"><span style=\"position: absolute; clip: rect(3.412em, 1000.49em, 4.386em, -999.997em); top: -4.002em; left: 0em;\"><span class=\"mi\" id=\"MathJax-Span-83\" style=\"font-family: MathJax_Math-italic;\">y<span style=\"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;\"></span></span><span style=\"display: inline-block; width: 0px; height: 4.007em;\"></span></span><span style=\"position: absolute; top: -3.839em; left: 0.49em;\"><span class=\"mi\" id=\"MathJax-Span-84\" style=\"font-size: 70.7%; font-family: MathJax_Math-italic;\">i</span><span style=\"display: inline-block; width: 0px; height: 4.007em;\"></span></span></span></span></span><span style=\"display: inline-block; width: 0px; height: 2.167em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.361em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><msub><mi>x</mi><mi>i</mi></msub><mo>≠</mo><msub><mi>y</mi><mi>i</mi></msub></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-18\">x_i \\ne y_i</script>) — the endpoints of the next edge of the tree.</p><p>Additional constraint on the input: the edges define a valid tree with <span class=\"MathJax_Preview\" style=\"color: inherit;\"></span><span class=\"MathJax\" id=\"MathJax-Element-19-Frame\" tabindex=\"0\" data-mathml=\"&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/math&gt;\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-85\" style=\"width: 0.814em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 132%;\"><span style=\"position: absolute; clip: rect(1.518em, 1000.6em, 2.275em, -999.997em); top: -2.108em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-86\"><span class=\"mi\" id=\"MathJax-Span-87\" style=\"font-family: MathJax_Math-italic;\">n</span></span><span style=\"display: inline-block; width: 0px; height: 2.113em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>n</mi></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-19\">n</script> vertices.</p>",
  "outputSpecHtml": "<p>Print two integers — the minimum number of operations and the number of distinct complete colorings that can be obtained with the minimum number of operations. Since the second number can be very large, output it modulo <span class=\"MathJax_Preview\" style=\"color: inherit;\"></span><span class=\"MathJax\" id=\"MathJax-Element-20-Frame\" tabindex=\"0\" data-mathml=\"&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;998244353&lt;/mn&gt;&lt;/math&gt;\" role=\"presentation\" style=\"position: relative;\"><nobr aria-hidden=\"true\"><span class=\"math\" id=\"MathJax-Span-88\" style=\"width: 5.955em; display: inline-block;\"><span style=\"display: inline-block; position: relative; width: 4.494em; height: 0px; font-size: 132%;\"><span style=\"position: absolute; clip: rect(1.301em, 1004.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;\"><span class=\"mrow\" id=\"MathJax-Span-89\"><span class=\"mn\" id=\"MathJax-Span-90\" style=\"font-family: MathJax_Main;\">998244353</span></span><span style=\"display: inline-block; width: 0px; height: 2.167em;\"></span></span></span><span style=\"display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;\"></span></span></nobr><span class=\"MJX_Assistive_MathML\" role=\"presentation\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mn>998244353</mn></math></span></span><script type=\"math/tex\" id=\"MathJax-Element-20\">998244353</script>.</p>",
  "noteHtml": "",
  "samples": [
    {
      "input": "31 22 3",
      "output": "1 1"
    },
    {
      "input": "51 32 15 11 4",
      "output": "2 6"
    },
    {
      "input": "41 42 44 3",
      "output": "2 9"
    },
    {
      "input": "54 21 53 44 1",
      "output": "2 11"
    },
    {
      "input": "107 99 34 28 77 108 54 18 26 8",
      "output": "3 270"
    }
  ],
  "images": [],
  "url": "https://codeforces.com/contest/2141/problem/I",
  "tutorialHtml": "<div><div class=\"ttypography\"><div class=\"problem-statement\"><div><p><span class=\"tex-font-style-bf\">Disclaimer:</span> I actually do not know the asymptotic complexity of the model solution. It definitely works in polynomial time, and I wrote a program that calculates the maximum number of reachable states and transitions in the worst case to ensure that the solution does not take too long; however, I cannot accurately estimate the complexity. My guess is <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-458\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-459\">O</span><span class=\"MJXp-mo\" id=\"MJXp-Span-460\" style=\"margin-left: 0em; margin-right: 0em;\">(</span><span class=\"MJXp-msubsup\" id=\"MJXp-Span-461\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-462\" style=\"margin-right: 0.05em;\">n</span><span class=\"MJXp-mn MJXp-script\" id=\"MJXp-Span-463\" style=\"vertical-align: 0.5em;\">7</span></span><span class=\"MJXp-mo\" id=\"MJXp-Span-464\" style=\"margin-left: 0em; margin-right: 0em;\">)</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-94\">O(n^7)</script> with a very small hidden constant, but I cannot prove it formally.</p><p>Let's start by solving the \"easy\" part of the problem — calculating the number of operations required for a complete coloring of a tree. Each operation can affect no more than two leaves of the tree, so the minimum number of operations cannot be less than <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-465\"><span class=\"MJXp-mo\" id=\"MJXp-Span-466\" style=\"margin-left: 0em; margin-right: 0em;\">⌈</span><span class=\"MJXp-mfrac\" id=\"MJXp-Span-467\" style=\"vertical-align: 0.25em;\"><span class=\"MJXp-box MJXp-script\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-468\">m</span></span><span class=\"MJXp-box\" style=\"margin-top: -0.9em;\"><span class=\"MJXp-denom\"><span><span class=\"MJXp-rule\" style=\"height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;\"></span></span><span><span class=\"MJXp-box MJXp-script\"><span class=\"MJXp-mn\" id=\"MJXp-Span-469\">2</span></span></span></span></span></span><span class=\"MJXp-mo\" id=\"MJXp-Span-470\" style=\"margin-left: 0em; margin-right: 0em;\">⌉</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-95\">\\lceil \\frac{m}{2} \\rceil</script>, where <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-471\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-472\">m</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-96\">m</script> is the number of leaves. It turns out that this number of operations is always sufficient. This can be proven as follows: in the case where <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-473\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-474\">m</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-97\">m</script> is even, we can pair the leaves and color all paths between the corresponding pairs of leaves; either we will achieve a complete coloring, or one of the vertices will remain uncolored. If any vertex remains uncolored, let's learn how to color it without uncoloring the other vertices: we will root the tree at this vertex and consider the subtrees of its children. In each of these subtrees, there will definitely be an even number of leaves (otherwise, the root would definitely be colored); we can take a pair of leaves <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-475\"><span class=\"MJXp-mo\" id=\"MJXp-Span-476\" style=\"margin-left: 0em; margin-right: 0em;\">(</span><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-477\">a</span><span class=\"MJXp-mo\" id=\"MJXp-Span-478\" style=\"margin-left: 0em; margin-right: 0.222em;\">,</span><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-479\">b</span><span class=\"MJXp-mo\" id=\"MJXp-Span-480\" style=\"margin-left: 0em; margin-right: 0em;\">)</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-98\">(a, b)</script> from one subtree and a pair of leaves <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-481\"><span class=\"MJXp-mo\" id=\"MJXp-Span-482\" style=\"margin-left: 0em; margin-right: 0em;\">(</span><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-483\">c</span><span class=\"MJXp-mo\" id=\"MJXp-Span-484\" style=\"margin-left: 0em; margin-right: 0.222em;\">,</span><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-485\">d</span><span class=\"MJXp-mo\" id=\"MJXp-Span-486\" style=\"margin-left: 0em; margin-right: 0em;\">)</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-99\">(c, d)</script> from another subtree, and swap these pairs to <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-487\"><span class=\"MJXp-mo\" id=\"MJXp-Span-488\" style=\"margin-left: 0em; margin-right: 0em;\">(</span><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-489\">a</span><span class=\"MJXp-mo\" id=\"MJXp-Span-490\" style=\"margin-left: 0em; margin-right: 0.222em;\">,</span><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-491\">c</span><span class=\"MJXp-mo\" id=\"MJXp-Span-492\" style=\"margin-left: 0em; margin-right: 0em;\">)</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-100\">(a, c)</script> and <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-493\"><span class=\"MJXp-mo\" id=\"MJXp-Span-494\" style=\"margin-left: 0em; margin-right: 0em;\">(</span><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-495\">b</span><span class=\"MJXp-mo\" id=\"MJXp-Span-496\" style=\"margin-left: 0em; margin-right: 0.222em;\">,</span><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-497\">d</span><span class=\"MJXp-mo\" id=\"MJXp-Span-498\" style=\"margin-left: 0em; margin-right: 0em;\">)</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-101\">(b, d)</script>. Then, for the path from the lowest common ancestor of <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-499\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-500\">a</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-102\">a</script> and <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-501\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-502\">b</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-103\">b</script> to the lowest common ancestor of <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-503\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-504\">c</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-104\">c</script> and <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-505\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-506\">d</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-105\">d</script> (which includes the root), all vertices will be colored, while for the other vertices, the number of paths passing through them will not decrease. By repeating this process several times, we will obtain a correct coloring of the tree. For odd <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-507\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-508\">m</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-106\">m</script>, the proof can be conducted in a similar manner if we \"split\" one of the leaves.</p><p>Now, let's find out how to count the number of complete colorings that can be obtained with the minimum number of operations. For even <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-509\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-510\">m</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-107\">m</script>, it is not too complicated. If we fix the pairing of leaves and choose an operation index for each of these pairs, then the color for all other vertices of the tree will be determined automatically, and no two ways to pair and choose operation indices will yield the same coloring (the leaves will be colored differently each time). Therefore, the answer for even <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-511\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-512\">m</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-108\">m</script> can be calculated as <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-513\"><span class=\"MJXp-mo\" id=\"MJXp-Span-514\" style=\"margin-left: 0em; margin-right: 0em;\">(</span><span class=\"MJXp-mfrac\" id=\"MJXp-Span-515\" style=\"vertical-align: 0.25em;\"><span class=\"MJXp-box MJXp-script\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-516\">m</span></span><span class=\"MJXp-box\" style=\"margin-top: -0.9em;\"><span class=\"MJXp-denom\"><span><span class=\"MJXp-rule\" style=\"height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;\"></span></span><span><span class=\"MJXp-box MJXp-script\"><span class=\"MJXp-mn\" id=\"MJXp-Span-517\">2</span></span></span></span></span></span><span class=\"MJXp-mo\" id=\"MJXp-Span-518\" style=\"margin-left: 0em; margin-right: 0em;\">)</span><span class=\"MJXp-mo\" id=\"MJXp-Span-519\" style=\"margin-left: 0.111em; margin-right: 0em;\">!</span><span class=\"MJXp-mo\" id=\"MJXp-Span-520\" style=\"margin-left: 0.267em; margin-right: 0.267em;\">⋅</span><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-521\">C</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-109\">(\\frac{m}{2})! \\cdot C</script>, where <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-522\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-523\">C</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-110\">C</script> is the number of ways to pair the leaves such that each vertex of the tree belongs to at least one path. To calculate <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-524\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-525\">C</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-111\">C</script>, we can root the tree at any non-leaf and use the following dynamic programming: <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-526\"><span class=\"MJXp-msubsup\" id=\"MJXp-Span-527\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-528\" style=\"margin-right: 0.05em;\">d</span><span class=\"MJXp-mrow MJXp-script\" id=\"MJXp-Span-529\" style=\"vertical-align: -0.4em;\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-530\">v</span><span class=\"MJXp-mo\" id=\"MJXp-Span-531\">,</span><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-532\">k</span></span></span></span></span><script type=\"math/tex\" id=\"MathJax-Element-112\">d_{v,k}</script> is the number of ways to process the subtree of vertex <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-533\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-534\">v</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-113\">v</script> such that exactly <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-535\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-536\">k</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-114\">k</script> leaves from the subtree have a pair outside the subtree (and the remaining leaves in the subtree are paired within the subtree), and for each vertex in the subtree, there is at least one path covering it. For each vertex, this dynamic programming can be quite easily calculated using auxiliary dp of the form <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-537\"><span class=\"MJXp-msup\" id=\"MJXp-Span-538\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-539\" style=\"margin-right: 0.05em;\">d</span><span class=\"MJXp-mo MJXp-script\" id=\"MJXp-Span-540\" style=\"vertical-align: 0.5em;\">′</span></span><span class=\"MJXp-mrow\" id=\"MJXp-Span-541\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-542\">v</span><span class=\"MJXp-mo\" id=\"MJXp-Span-543\" style=\"margin-left: 0em; margin-right: 0.222em;\">,</span><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-544\">k</span><span class=\"MJXp-mo\" id=\"MJXp-Span-545\" style=\"margin-left: 0em; margin-right: 0.222em;\">,</span><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-546\">i</span></span></span></span><script type=\"math/tex\" id=\"MathJax-Element-115\">d'{v,k,i}</script> — we have processed the first <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-547\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-548\">i</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-116\">i</script> children of vertex <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-549\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-550\">v</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-117\">v</script>, and there are <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-551\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-552\">k</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-118\">k</script> leaves without pairs among them (when processing the next child, we can iterate over how many leaves without pairs will be in it and how many of them we will pair with already processed leaves). Then the value of <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-553\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-554\">C</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-119\">C</script> will be stored in <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-555\"><span class=\"MJXp-msubsup\" id=\"MJXp-Span-556\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-557\" style=\"margin-right: 0.05em;\">d</span><span class=\"MJXp-mrow MJXp-script\" id=\"MJXp-Span-558\" style=\"vertical-align: -0.4em;\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-559\">v</span><span class=\"MJXp-mo\" id=\"MJXp-Span-560\">,</span><span class=\"MJXp-mn\" id=\"MJXp-Span-561\">0</span></span></span></span></span><script type=\"math/tex\" id=\"MathJax-Element-120\">d_{v,0}</script> for the vertex <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-562\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-563\">v</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-121\">v</script> that is the root.</p><p>What changes in the case of odd <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-564\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-565\">m</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-122\">m</script>? Unfortunately, quite a lot. We will have one leaf without a pair (which will not be colored in the color of any other leaf), however, the operation index at which we will color it, and the operation indices for the other pairs of leaves (as well as which internal vertex of the tree we will pair that extra leaf with) significantly affect the coloring. This means that we can no longer simply calculate the number of ways to pair and multiply by some factorial — now the order of operations affects the coloring much more strongly. Let's try to iterate over the leaf that will not have a pair, as well as the operation index at which we will color it — and now we need to count the number of colorings considering the operation index.</p><p>To do this, we will root the tree at the chosen leaf and mentally divide all pairs of the remaining leaves into two types: those with operation index greater than ours, and those with operation index less than ours. Why do we need such a division? It allows us to understand which vertices of the tree can be influenced by the index of our operation — only those that are not covered by any path with a larger operation index. We also need to handle the fact that all vertices colored in our chosen color for the root must belong to one path from the root to some other vertex (which is not a leaf).</p><p>All of this can be attempted to be processed with more complex dynamic programming, in which we will consider the following states:</p><ul> <li> which subtree of which vertex we were processing; </li><li> whether there is at least one vertex of \"our\" color in the subtree of this vertex (this is important to ensure that we have such a vertex only in one of the children); </li><li> how many leaves without pairs are in the subtree; </li><li> how many leaves without pairs are in the subtree <span class=\"tex-font-style-bf\">with a smaller operation index</span>; </li><li> how many pairs of leaves <span class=\"tex-font-style-bf\">with a smaller operation index</span> are in the subtree (from these three values, we will automatically understand how many pairs of leaves with a larger operation index are in the subtree); </li><li> a parameter indicating which paths cover the current vertex (<span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-566\"><span class=\"MJXp-mn\" id=\"MJXp-Span-567\">0</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-123\">0</script> — not covered by any path; <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-568\"><span class=\"MJXp-mn\" id=\"MJXp-Span-569\">1</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-124\">1</script> — covered only by paths with a smaller operation index; <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-570\"><span class=\"MJXp-mn\" id=\"MJXp-Span-571\">2</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-125\">2</script> — covered by at least one path with a larger operation index). </li></ul><p>To \"merge\" this dynamic programming from the children of each vertex, we can iterate over how many new pairs with smaller and larger numbers we will create and multiply by the corresponding number of ways to choose these pairs (while ensuring that we do not take more than one subtree that already has a vertex of \"our\" color). Depending on the last parameter, we sometimes may (if it equals <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-572\"><span class=\"MJXp-mn\" id=\"MJXp-Span-573\">1</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-126\">1</script>) or must (if it equals <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-574\"><span class=\"MJXp-mn\" id=\"MJXp-Span-575\">0</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-127\">0</script>) color the current vertex in our chosen color.</p><p>How do we extract the answer from this? Let our chosen operation index be <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-576\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-577\">x</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-128\">x</script> (<span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-578\"><span class=\"MJXp-mn\" id=\"MJXp-Span-579\">0</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-129\">0</script>-indexed), then there must be exactly <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-580\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-581\">x</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-130\">x</script> pairs of leaves with operation indices less than <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-582\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-583\">x</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-131\">x</script>. We just need to look at the value of the dynamic programming in the state where:</p><ul> <li> the current vertex is the root of the tree; </li><li> there is definitely at least one vertex of our color in the subtree; </li><li> there are <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-584\"><span class=\"MJXp-mn\" id=\"MJXp-Span-585\">0</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-132\">0</script> leaves without pairs (as well as <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-586\"><span class=\"MJXp-mn\" id=\"MJXp-Span-587\">0</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-133\">0</script> leaves without pairs with a smaller operation number); </li><li> there are exactly <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-588\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-589\">x</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-134\">x</script> pairs of leaves with a smaller operation number; </li><li> the parameter for the current vertex is <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-590\"><span class=\"MJXp-mn\" id=\"MJXp-Span-591\">0</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-135\">0</script> (since we rooted the tree at the only unpaired leaf). </li></ul><p>This still needs to be multiplied by the number of ways to choose operation indices for all pairs of leaves with smaller indices and for all pairs of leaves with larger indices (this is simply two factorials). In fact, we don't even need to iterate on <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-592\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-593\">x</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-136\">x</script> (our chosen operation index); our dynamic programming will automatically be calculated for all possible values of <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-594\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-595\">x</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-137\">x</script>.</p><p>And now for the main question — how to implement all of this in a pleasant way. I cannot say that the model solution turned out to be short, but the process of coding it was quite simple and intuitive. First of all, I do not recommend writing this dynamic programming using six-dimensional arrays (you can do it, but the code will be quite cumbersome). Instead, I suggest creating a class that will store some states of dp and the corresponding number of ways (in the model solution, this is the <span class=\"tex-font-style-tt\">State</span> structure, which stores everything except the current vertex and whether there is at least one vertex of \"our\" color in the subtree of our vertex); and store all reachable states as instances of this class.</p><p>Why do I suggest using a class? First, it will allow us not to process unreachable states (we will automatically not create any instances for unreachable states); second, it is quite easy to code the merging of two states while iterating over the number of pairs we form (look at the function <span class=\"tex-font-style-tt\">merge2</span> in the model solution — it merges two lists of states with the corresponding values). Of course, when merging, we also need to combine identical dynamic states by summing their values — for this, it is enough to sort them and go through the sorted list (look at the function <span class=\"tex-font-style-tt\">fix</span> in the model solution).</p><p>Now we can use <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-596\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-597\">d</span><span class=\"MJXp-msubsup\" id=\"MJXp-Span-598\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-599\" style=\"margin-right: 0.05em;\">p</span><span class=\"MJXp-mrow MJXp-script\" id=\"MJXp-Span-600\" style=\"vertical-align: -0.4em;\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-601\">v</span><span class=\"MJXp-mo\" id=\"MJXp-Span-602\">,</span><span class=\"MJXp-mn\" id=\"MJXp-Span-603\">0</span></span></span></span></span><script type=\"math/tex\" id=\"MathJax-Element-138\">dp_{v,0}</script> and <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-604\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-605\">d</span><span class=\"MJXp-msubsup\" id=\"MJXp-Span-606\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-607\" style=\"margin-right: 0.05em;\">p</span><span class=\"MJXp-mrow MJXp-script\" id=\"MJXp-Span-608\" style=\"vertical-align: -0.4em;\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-609\">v</span><span class=\"MJXp-mo\" id=\"MJXp-Span-610\">,</span><span class=\"MJXp-mn\" id=\"MJXp-Span-611\">1</span></span></span></span></span><script type=\"math/tex\" id=\"MathJax-Element-139\">dp_{v,1}</script> to store the states and values corresponding to the dynamic programming for each vertex (where <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-612\"><span class=\"MJXp-mn\" id=\"MJXp-Span-613\">0</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-140\">0</script> means that there is no vertex of \"our\" color in the subtree, and <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-614\"><span class=\"MJXp-mn\" id=\"MJXp-Span-615\">1</span></span></span><script type=\"math/tex\" id=\"MathJax-Element-141\">1</script> means that there is at least one such vertex). This dynamic programming, by the way, will also automatically calculate the answer for the case with an even number of leaves.</p><p>I will briefly comment on what the other functions in the model solution do:</p><ul> <li> <span class=\"tex-font-style-tt\">choose</span> simply calculates binomial coefficients using factorials and inverse factorials; </li><li> <span class=\"tex-font-style-tt\">merge</span> allows \"merging\" the dynamic programming for some prefix of the children of the current vertex and the next child of the same vertex; </li><li> <span class=\"tex-font-style-tt\">forceSpecial</span> processes the color of the current vertex, allowing to automatically determine whether we can have a vertex of \"our\" color in each state. </li></ul></div></div></div></div>"
}