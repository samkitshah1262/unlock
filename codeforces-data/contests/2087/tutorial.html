<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tutorial</title>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
      line-height: 1.6;
      color: #333;
      background: #fafafa;
    }
    .ttypography {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    h3 {
      color: #1a1a1a;
      border-bottom: 2px solid #eee;
      padding-bottom: 10px;
    }
    h3 a {
      color: #0066cc;
      text-decoration: none;
    }
    h3 a:hover {
      text-decoration: underline;
    }
    .spoiler {
      margin: 15px 0;
      border: 1px solid #ddd;
      border-radius: 6px;
      overflow: hidden;
    }
    .spoiler-title {
      display: block;
      padding: 12px 15px;
      background: #f0f0f0;
      cursor: pointer;
      font-weight: 600;
      user-select: none;
      border-bottom: 1px solid #ddd;
    }
    .spoiler-title:hover {
      background: #e8e8e8;
    }
    .spoiler-title::before {
      content: '▶ ';
      font-size: 0.8em;
      transition: transform 0.2s;
      display: inline-block;
    }
    .spoiler.open .spoiler-title::before {
      content: '▼ ';
    }
    .spoiler-content {
      padding: 15px;
      background: #fff;
      display: none;
    }
    .spoiler.open .spoiler-content {
      display: block;
    }
    pre, code {
      background: #f5f5f5;
      font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
      font-size: 0.85em;
    }
    pre {
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
    }
    code {
      padding: 2px 5px;
      border-radius: 3px;
    }
    p {
      margin: 10px 0;
    }
    .MathJax {
      font-size: 1.1em;
    }
  </style>
</head>
<body>
  <h1>Editorial</h1>
  <p><a href="https://codeforces.com/blog/entry/141608" target="_blank">View on Codeforces →</a></p>
  
  <div class="ttypography"><p>The contest was prepared by <a class="rated-user user-orange" href="https://codeforces.com/profile/adedalic" title="International Master adedalic">adedalic</a>, <a class="rated-user user-orange" href="https://codeforces.com/profile/awoo" title="Master awoo">awoo</a>, <a class="rated-user user-violet" href="https://codeforces.com/profile/Neon" title="Candidate Master Neon">Neon</a> and me. We had a great team of testers: <a class="rated-user user-red" href="https://codeforces.com/profile/shnirelman" title="International Grandmaster shnirelman">shnirelman</a>, <a class="rated-user user-red" href="https://codeforces.com/profile/ashmelev" title="Grandmaster ashmelev">ashmelev</a>, <a class="rated-user user-orange" href="https://codeforces.com/profile/FelixArg" title="International Master FelixArg">FelixArg</a>, <a class="rated-user user-orange" href="https://codeforces.com/profile/KIRIJIJI" title="Master KIRIJIJI">KIRIJIJI</a>, <a class="rated-user user-blue" href="https://codeforces.com/profile/Alenochka" title="Expert Alenochka">Alenochka</a>, <a class="rated-user user-blue" href="https://codeforces.com/profile/alyoks1" title="Expert alyoks1">alyoks1</a>, <a class="rated-user user-violet" href="https://codeforces.com/profile/Vladosiya" title="Candidate Master Vladosiya">Vladosiya</a>, <a class="rated-user user-cyan" href="https://codeforces.com/profile/mariibykova" title="Specialist mariibykova">mariibykova</a> — huge thanks to all of you!</p> <div class="spoiler"><b class="spoiler-title">One insane moment from the testing phase</b><div class="spoiler-content" style="display: block;"><p>One day before the contest, <a class="rated-user user-red" href="https://codeforces.com/profile/shnirelman" title="International Grandmaster shnirelman">shnirelman</a> completely destroyed problem H in less than 15 minutes. Thankfully, I had an idea of a replacement problem.</p></div></div><p>Thanks to all competitors for participation, I hope you enjoyed the problems we made!</p><p>And last but not least, I would like to express my gratitude to <a class="rated-user user-admin" href="https://codeforces.com/profile/MikeMirzayanov" title="Headquarters, MikeMirzayanov">MikeMirzayanov</a> for keeping Codeforces and Polygon running even under unprecedented pressure from the bots.</p><p>Okay, now for the editorial itself:</p><p><a href="https://codeforces.com/contest/2087/problem/A" title="Kotlin Heroes: Episode 12">2087A - Password Generator</a></p><p>Idea: <a class="rated-user user-red" href="https://codeforces.com/profile/BledDest" title="International Grandmaster BledDest">BledDest</a>, preparation: <a class="rated-user user-red" href="https://codeforces.com/profile/BledDest" title="International Grandmaster BledDest">BledDest</a></p> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2087/problem/A" title="Kotlin Heroes: Episode 12">2087A - Password Generator</a></h3><div class="ttypography"><div class="problem-statement"><div><p>There are many different approaches to this problem. I will describe one of them.</p><p>We can print <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-24"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-25">a</span></span></span><script type="math/tex" id="MathJax-Element-3">a</script> digits, then <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-26"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-27">b</span></span></span><script type="math/tex" id="MathJax-Element-4">b</script> uppercase letters, then <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-28"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-29">c</span></span></span><script type="math/tex" id="MathJax-Element-5">c</script> lowercase letters, and in each category, we will choose two characters which will be alternating. For example, we can use <span class="tex-font-style-tt">0</span> and <span class="tex-font-style-tt">1</span> as alternating digits, <span class="tex-font-style-tt">A</span> and <span class="tex-font-style-tt">B</span> as alternating uppercase letters, <span class="tex-font-style-tt">a</span> and <span class="tex-font-style-tt">b</span> as alternating lowercase letters. When printing the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-30"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-31">j</span></span></span><script type="math/tex" id="MathJax-Element-6">j</script>-th character of a certain type, we can use <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-32"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-33">j</span><span class="MJXp-mo" id="MJXp-Span-34" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mn" id="MJXp-Span-35">2</span></span></span><script type="math/tex" id="MathJax-Element-7">j \bmod 2</script> to determine whether we will use the first option or the second option.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Solution (Neon)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="kwd">const</span><span class="pln"> val chars </span><span class="pun">=</span><span class="pln"> </span><span class="str">"01ABab"</span><span class="pln">

fun main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> repeat</span><span class="pun">(</span><span class="pln">readln</span><span class="pun">().</span><span class="pln">toInt</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  val a </span><span class="pun">=</span><span class="pln"> readln</span><span class="pun">().</span><span class="pln">split</span><span class="pun">(</span><span class="str">" "</span><span class="pun">).</span><span class="pln">map </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">toInt</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
  println</span><span class="pun">(</span><span class="pln">a</span><span class="pun">.</span><span class="pln">mapIndexed </span><span class="pun">{</span><span class="pln"> i</span><span class="pun">,</span><span class="pln"> x </span><span class="pun">-&gt;</span><span class="pln"> 
    </span><span class="typ">CharArray</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> j </span><span class="pun">-&gt;</span><span class="pln"> chars</span><span class="pun">[</span><span class="pln">i </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> j </span><span class="pun">%</span><span class="pln"> </span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
  </span><span class="pun">}.</span><span class="pln">flatMap </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">asIterable</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}.</span><span class="pln">joinToString</span><span class="pun">(</span><span class="str">""</span><span class="pun">))</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2087/problem/B" title="Kotlin Heroes: Episode 12">2087B - Showmatch</a></p><p>Idea: <a class="rated-user user-red" href="https://codeforces.com/profile/BledDest" title="International Grandmaster BledDest">BledDest</a>, preparation: <a class="rated-user user-red" href="https://codeforces.com/profile/BledDest" title="International Grandmaster BledDest">BledDest</a></p> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2087/problem/B" title="Kotlin Heroes: Episode 12">2087B - Showmatch</a></h3><div class="ttypography"><div class="problem-statement"><div><p>Two participants can only be the best opponents for each other if there is no third participant whose rating is strictly between the ratings of these two participants. This means that in sorted order, only pairs of adjacent elements can be the best opponents. Therefore, let's first sort the sequence <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-36"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-37">a</span></span></span><script type="math/tex" id="MathJax-Element-8">a</script>.</p><p>The sorted sequence can only be divided into pairs of adjacent elements in one way: the first element is paired with the second, the third with the fourth, and so on. Thus, we need to check whether such a division is valid.</p><p>For each pair of participants that are adjacent but do not belong to the same pair in the division (<span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-38"><span class="MJXp-msubsup" id="MJXp-Span-39"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-40" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-41" style="vertical-align: -0.4em;">2</span></span></span></span><script type="math/tex" id="MathJax-Element-9">a_2</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-42"><span class="MJXp-msubsup" id="MJXp-Span-43"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-44" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-45" style="vertical-align: -0.4em;">3</span></span></span></span><script type="math/tex" id="MathJax-Element-10">a_3</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-46"><span class="MJXp-msubsup" id="MJXp-Span-47"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-48" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-49" style="vertical-align: -0.4em;">4</span></span></span></span><script type="math/tex" id="MathJax-Element-11">a_4</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-50"><span class="MJXp-msubsup" id="MJXp-Span-51"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-52" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-53" style="vertical-align: -0.4em;">5</span></span></span></span><script type="math/tex" id="MathJax-Element-12">a_5</script>, and so on), we need to check whether this pair makes the pairs in the division invalid. If <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-54"><span class="MJXp-mrow" id="MJXp-Span-55"><span class="MJXp-mo" id="MJXp-Span-56" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-msubsup" id="MJXp-Span-57"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-58" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-59" style="vertical-align: -0.4em;">3</span></span><span class="MJXp-mo" id="MJXp-Span-60" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-61"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-62" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-63" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mrow" id="MJXp-Span-64"><span class="MJXp-mo" id="MJXp-Span-65" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mo" id="MJXp-Span-66" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mrow" id="MJXp-Span-67"><span class="MJXp-mo" id="MJXp-Span-68" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-msubsup" id="MJXp-Span-69"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-70" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-71" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-72" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-73"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-74" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-75" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mrow" id="MJXp-Span-76"><span class="MJXp-mo" id="MJXp-Span-77" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span></span></span><script type="math/tex" id="MathJax-Element-13">|a_3 - a_2| < |a_2 - a_1|</script>, then participant <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-78"><span class="MJXp-mn" id="MJXp-Span-79">1</span></span></span><script type="math/tex" id="MathJax-Element-14">1</script> is not the best opponent for participant <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-80"><span class="MJXp-mn" id="MJXp-Span-81">2</span></span></span><script type="math/tex" id="MathJax-Element-15">2</script>. Similarly, if <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-82"><span class="MJXp-mrow" id="MJXp-Span-83"><span class="MJXp-mo" id="MJXp-Span-84" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-msubsup" id="MJXp-Span-85"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-86" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-87" style="vertical-align: -0.4em;">3</span></span><span class="MJXp-mo" id="MJXp-Span-88" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-89"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-90" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-91" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mrow" id="MJXp-Span-92"><span class="MJXp-mo" id="MJXp-Span-93" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mo" id="MJXp-Span-94" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mrow" id="MJXp-Span-95"><span class="MJXp-mo" id="MJXp-Span-96" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-msubsup" id="MJXp-Span-97"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-98" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-99" style="vertical-align: -0.4em;">4</span></span><span class="MJXp-mo" id="MJXp-Span-100" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-101"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-102" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-103" style="vertical-align: -0.4em;">3</span></span><span class="MJXp-mrow" id="MJXp-Span-104"><span class="MJXp-mo" id="MJXp-Span-105" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span></span></span><script type="math/tex" id="MathJax-Element-16">|a_3 - a_2| < |a_4 - a_3|</script>, then participant <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-106"><span class="MJXp-mn" id="MJXp-Span-107">4</span></span></span><script type="math/tex" id="MathJax-Element-17">4</script> is not the best opponent for participant <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-108"><span class="MJXp-mn" id="MJXp-Span-109">3</span></span></span><script type="math/tex" id="MathJax-Element-18">3</script>. Such checks can be made for all subsequent pairs as well.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Solution (Neon)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="pln">fun main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> repeat</span><span class="pun">(</span><span class="pln">readln</span><span class="pun">().</span><span class="pln">toInt</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  val n </span><span class="pun">=</span><span class="pln"> readln</span><span class="pun">().</span><span class="pln">toInt</span><span class="pun">()</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pln">
  val a </span><span class="pun">=</span><span class="pln"> readln</span><span class="pun">().</span><span class="pln">split</span><span class="pun">(</span><span class="str">" "</span><span class="pun">).</span><span class="pln">map </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">toInt</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}.</span><span class="pln">sorted</span><span class="pun">()</span><span class="pln">
  println</span><span class="pun">(</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">((</span><span class="lit">1</span><span class="pln"> </span><span class="kwd">until</span><span class="pln"> n </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> step </span><span class="lit">2</span><span class="pun">).</span><span class="pln">any </span><span class="pun">{</span><span class="pln"> i </span><span class="pun">-&gt;</span><span class="pln">
    a</span><span class="pun">[</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> maxOf</span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">],</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">])</span><span class="pln">
  </span><span class="pun">})</span><span class="pln"> </span><span class="str">"NO"</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="str">"YES"</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2087/problem/C" title="Kotlin Heroes: Episode 12">2087C - Coin Game</a></p><p>Idea: <a class="rated-user user-red" href="https://codeforces.com/profile/BledDest" title="International Grandmaster BledDest">BledDest</a>, preparation: <a class="rated-user user-violet" href="https://codeforces.com/profile/Neon" title="Candidate Master Neon">Neon</a></p> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2087/problem/C" title="Kotlin Heroes: Episode 12">2087C - Coin Game</a></h3><div class="ttypography"><div class="problem-statement"><div><p>The key observation is that the player always picks the type of coin with the highest frequency of occurrence. This fact allows us to clearly see how the game is played.</p><p>Let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-110"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-111">x</span></span></span><script type="math/tex" id="MathJax-Element-19">x</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-112"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-113">y</span></span></span><script type="math/tex" id="MathJax-Element-20">y</script>, and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-114"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-115">z</span></span></span><script type="math/tex" id="MathJax-Element-21">z</script> be the number of gold, silver, and bronze coins, respectively. The first player takes the maximum among these three numbers. Then the second player takes the second maximum. Finally, the first player takes the third maximum.</p><p>So, the solution is to calculate the number of coins of each type. The number of coins the first player can collect is the maximum plus the minimum among these calculated values.</p><p>To calculate the number of occurrences of each type quickly, you can use prefix sums: or each type of coins, let's form an array where the element on the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-116"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-117">i</span></span></span><script type="math/tex" id="MathJax-Element-22">i</script>-th position is equal to the number of coins having that type among the first <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-118"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-119">i</span></span></span><script type="math/tex" id="MathJax-Element-23">i</script> coins. Then, the number of coins of a specific type in a segment can be computed quickly by subtracting the value for the left boundary from the value for the right boundary.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Solution (Neon)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="kwd">const</span><span class="pln"> val coins </span><span class="pun">=</span><span class="pln"> </span><span class="str">"BSG"</span><span class="pln">

fun main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  val s </span><span class="pun">=</span><span class="pln"> readln</span><span class="pun">()</span><span class="pln">
  val sum </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Array</span><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> 
    s</span><span class="pun">.</span><span class="pln">map </span><span class="pun">{</span><span class="pln"> c </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">c </span><span class="pun">==</span><span class="pln"> coins</span><span class="pun">[</span><span class="pln">it</span><span class="pun">])</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
     </span><span class="pun">.</span><span class="pln">scan</span><span class="pun">(</span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> y </span><span class="pun">-&gt;</span><span class="pln"> x </span><span class="pun">+</span><span class="pln"> y </span><span class="pun">}</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
  
  val q </span><span class="pun">=</span><span class="pln"> readln</span><span class="pun">().</span><span class="pln">toInt</span><span class="pun">()</span><span class="pln">
  println</span><span class="pun">((</span><span class="lit">0</span><span class="pln"> </span><span class="kwd">until</span><span class="pln"> q</span><span class="pun">).</span><span class="pln">map </span><span class="pun">{</span><span class="pln">
    val </span><span class="pun">(</span><span class="pln">l</span><span class="pun">,</span><span class="pln"> r</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> readln</span><span class="pun">().</span><span class="pln">split</span><span class="pun">(</span><span class="str">" "</span><span class="pun">).</span><span class="pln">map </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">toInt</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    val cnt </span><span class="pun">=</span><span class="pln"> sum</span><span class="pun">.</span><span class="pln">map </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">[</span><span class="pln">r</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> it</span><span class="pun">[</span><span class="pln">l </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    cnt</span><span class="pun">.</span><span class="pln">max</span><span class="pun">()</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> cnt</span><span class="pun">.</span><span class="pln">min</span><span class="pun">()</span><span class="pln">
  </span><span class="pun">}.</span><span class="pln">joinToString</span><span class="pun">(</span><span class="str">"\n"</span><span class="pun">))</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2087/problem/D" title="Kotlin Heroes: Episode 12">2087D - Uppercase or Lowercase?</a></p><p>Idea: <a class="rated-user user-orange" href="https://codeforces.com/profile/adedalic" title="International Master adedalic">adedalic</a>, preparation: <a class="rated-user user-orange" href="https://codeforces.com/profile/adedalic" title="International Master adedalic">adedalic</a></p> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2087/problem/D" title="Kotlin Heroes: Episode 12">2087D - Uppercase or Lowercase?</a></h3><div class="ttypography"><div class="problem-statement"><div><p>Note that if the order of words was determined, we could solve it using a regular binary search, that needs <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-120"><span class="MJXp-mrow" id="MJXp-Span-121"><span class="MJXp-mo" id="MJXp-Span-122" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.244em;"><span class="MJXp-right MJXp-scale7" style="font-size: 1.978em; margin-left: -0.08em;">⌈</span></span><span class="MJXp-msubsup" id="MJXp-Span-123"><span class="MJXp-mi" id="MJXp-Span-124" style="margin-right: 0.05em;">log</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-125" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-126" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mrow" id="MJXp-Span-127"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-128">n</span></span><span class="MJXp-mo" id="MJXp-Span-129" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.244em;"><span class="MJXp-right MJXp-scale7" style="font-size: 1.978em; margin-left: -0.08em;">⌉</span></span></span></span></span><script type="math/tex" id="MathJax-Element-24">\left\lceil \log_2{n} \right\rceil</script> queries (we will return to this later). In other words, for <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-130"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-131">n</span><span class="MJXp-mo" id="MJXp-Span-132" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mn" id="MJXp-Span-133">500</span></span></span><script type="math/tex" id="MathJax-Element-25">n \le 500</script>, we will need no more than <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-134"><span class="MJXp-mn" id="MJXp-Span-135">9</span></span></span><script type="math/tex" id="MathJax-Element-26">9</script> queries. This means we have one query to spare.</p><p>So let's ask about the first position. If we receive a handle that starts with an uppercase letter, then either uppercase letters come before lowercase letters, or there are no handles that start with a lowercase letter at all. In both cases, we can say that uppercase letters are less than lowercase letters. If, however, we receive a handle that starts with a lowercase letter, we can similarly conclude that lowercase letters are less than uppercase letters.</p><p>Now, having spent one query, we have determined the relative order of the letters and can proceed to search for the desired handle using binary search.</p><p>To do this, let's maintain a semi-interval of the list <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-136"><span class="MJXp-mo" id="MJXp-Span-137" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-138">l</span><span class="MJXp-mo" id="MJXp-Span-139" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-140">r</span><span class="MJXp-mo" id="MJXp-Span-141" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-27">[l, r)</script>, about which we know that the handle <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-142"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-143">h</span></span></span><script type="math/tex" id="MathJax-Element-28">h</script> is definitely located within it (in other words, we know that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-144"><span class="MJXp-mrow" id="MJXp-Span-145"><span class="MJXp-mi" id="MJXp-Span-146">h</span><span class="MJXp-mi" id="MJXp-Span-147">a</span><span class="MJXp-mi" id="MJXp-Span-148">n</span><span class="MJXp-mi" id="MJXp-Span-149">d</span><span class="MJXp-mi" id="MJXp-Span-150">l</span><span class="MJXp-mi" id="MJXp-Span-151">e</span></span><span class="MJXp-mo" id="MJXp-Span-152" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-153">l</span><span class="MJXp-mo" id="MJXp-Span-154" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-155" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-156">h</span></span></span><script type="math/tex" id="MathJax-Element-29">\mathrm{handle}[l] \le h</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-157"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-158">h</span><span class="MJXp-mo" id="MJXp-Span-159" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mrow" id="MJXp-Span-160"><span class="MJXp-mi" id="MJXp-Span-161">h</span><span class="MJXp-mi" id="MJXp-Span-162">a</span><span class="MJXp-mi" id="MJXp-Span-163">n</span><span class="MJXp-mi" id="MJXp-Span-164">d</span><span class="MJXp-mi" id="MJXp-Span-165">l</span><span class="MJXp-mi" id="MJXp-Span-166">e</span><span class="MJXp-mo" id="MJXp-Span-167" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi" id="MJXp-Span-168">r</span><span class="MJXp-mo" id="MJXp-Span-169" style="margin-left: 0em; margin-right: 0em;">]</span></span></span></span><script type="math/tex" id="MathJax-Element-30">h < \mathrm{handle[r]}</script>).</p><p>Initially, we start with the entire list <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-170"><span class="MJXp-mo" id="MJXp-Span-171" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mn" id="MJXp-Span-172">1</span><span class="MJXp-mo" id="MJXp-Span-173" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-174">n</span><span class="MJXp-mo" id="MJXp-Span-175" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-176">1</span><span class="MJXp-mo" id="MJXp-Span-177" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-31">[1, n + 1)</script>. Now, as long as the length of the semi-interval <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-178"><span class="MJXp-mo" id="MJXp-Span-179" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-180">l</span><span class="MJXp-mo" id="MJXp-Span-181" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-182">r</span><span class="MJXp-mo" id="MJXp-Span-183" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-32">[l, r)</script> is greater than <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-184"><span class="MJXp-mn" id="MJXp-Span-185">1</span></span></span><script type="math/tex" id="MathJax-Element-33">1</script>, we still do not know exactly where our handle is located. Therefore, let's choose the midpoint of this interval <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-186"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-187">m</span><span class="MJXp-mo" id="MJXp-Span-188" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mfrac" id="MJXp-Span-189" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-190">r</span><span class="MJXp-mo" id="MJXp-Span-191">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-192">l</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mn" id="MJXp-Span-193">2</span></span></span></span></span></span></span></span><script type="math/tex" id="MathJax-Element-34">m = \frac{r - l}{2}</script> and make a query at position <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-194"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-195">m</span></span></span><script type="math/tex" id="MathJax-Element-35">m</script>. If <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-196"><span class="MJXp-mrow" id="MJXp-Span-197"><span class="MJXp-mi" id="MJXp-Span-198">h</span><span class="MJXp-mi" id="MJXp-Span-199">a</span><span class="MJXp-mi" id="MJXp-Span-200">n</span><span class="MJXp-mi" id="MJXp-Span-201">d</span><span class="MJXp-mi" id="MJXp-Span-202">l</span><span class="MJXp-mi" id="MJXp-Span-203">e</span></span><span class="MJXp-mo" id="MJXp-Span-204" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-205">m</span><span class="MJXp-mo" id="MJXp-Span-206" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-207" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-208">h</span></span></span><script type="math/tex" id="MathJax-Element-36">\mathrm{handle}[m] \le h</script>, we can definitively say that our handle lies in the semi-interval <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-209"><span class="MJXp-mo" id="MJXp-Span-210" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-211">m</span><span class="MJXp-mo" id="MJXp-Span-212" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-213">r</span><span class="MJXp-mo" id="MJXp-Span-214" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-37">[m, r)</script>. Otherwise, if <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-215"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-216">h</span><span class="MJXp-mo" id="MJXp-Span-217" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mrow" id="MJXp-Span-218"><span class="MJXp-mi" id="MJXp-Span-219">h</span><span class="MJXp-mi" id="MJXp-Span-220">a</span><span class="MJXp-mi" id="MJXp-Span-221">n</span><span class="MJXp-mi" id="MJXp-Span-222">d</span><span class="MJXp-mi" id="MJXp-Span-223">l</span><span class="MJXp-mi" id="MJXp-Span-224">e</span></span><span class="MJXp-mo" id="MJXp-Span-225" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-226">m</span><span class="MJXp-mo" id="MJXp-Span-227" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-38">h < \mathrm{handle}[m]</script>, then the handle lies in the interval <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-228"><span class="MJXp-mo" id="MJXp-Span-229" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-230">l</span><span class="MJXp-mo" id="MJXp-Span-231" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-232">m</span><span class="MJXp-mo" id="MJXp-Span-233" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-39">[l, m)</script>.</p><p>As soon as the length of the segment becomes <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-234"><span class="MJXp-mn" id="MJXp-Span-235">1</span></span></span><script type="math/tex" id="MathJax-Element-40">1</script>, we will know the exact position of the handle.</p><p>Since after each query the length of the semi-interval <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-236"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-237">n</span></span></span><script type="math/tex" id="MathJax-Element-41">n</script> becomes <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-238"><span class="MJXp-mrow" id="MJXp-Span-239"><span class="MJXp-mo" id="MJXp-Span-240" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.5em;"><span class="MJXp-right MJXp-scale5" style="font-size: 3em; margin-left: -0.18em;">⌈</span></span><span class="MJXp-mfrac" id="MJXp-Span-241" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-242">n</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mn" id="MJXp-Span-243">2</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-244" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.5em;"><span class="MJXp-right MJXp-scale5" style="font-size: 3em; margin-left: -0.18em;">⌉</span></span></span></span></span><script type="math/tex" id="MathJax-Element-42">\left\lceil \frac{n}{2} \right\rceil</script> in the worst case, we will need no more than <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-245"><span class="MJXp-mrow" id="MJXp-Span-246"><span class="MJXp-mo" id="MJXp-Span-247" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.244em;"><span class="MJXp-right MJXp-scale7" style="font-size: 1.978em; margin-left: -0.08em;">⌈</span></span><span class="MJXp-msubsup" id="MJXp-Span-248"><span class="MJXp-mi" id="MJXp-Span-249" style="margin-right: 0.05em;">log</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-250" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-251" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mrow" id="MJXp-Span-252"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-253">n</span></span><span class="MJXp-mo" id="MJXp-Span-254" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.244em;"><span class="MJXp-right MJXp-scale7" style="font-size: 1.978em; margin-left: -0.08em;">⌉</span></span></span></span></span><script type="math/tex" id="MathJax-Element-43">\left\lceil \log_2{n} \right\rceil</script> queries to reduce the segment to a length of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-255"><span class="MJXp-mn" id="MJXp-Span-256">1</span></span></span><script type="math/tex" id="MathJax-Element-44">1</script>.</p><p>To compare the responses to queries with the handle <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-257"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-258">h</span></span></span><script type="math/tex" id="MathJax-Element-45">h</script>, it is convenient to write a special function that compares them, taking into account whether lowercase letters come before uppercase letters or vice versa.</p><p>P.S.: Binary search can also be written in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-259"><span class="MJXp-mrow" id="MJXp-Span-260"><span class="MJXp-mo" id="MJXp-Span-261" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.244em;"><span class="MJXp-right MJXp-scale7" style="font-size: 1.978em; margin-left: -0.08em;">⌊</span></span><span class="MJXp-msubsup" id="MJXp-Span-262"><span class="MJXp-mi" id="MJXp-Span-263" style="margin-right: 0.05em;">log</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-264" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-265" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mrow" id="MJXp-Span-266"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-267">n</span></span><span class="MJXp-mo" id="MJXp-Span-268" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.244em;"><span class="MJXp-right MJXp-scale7" style="font-size: 1.978em; margin-left: -0.08em;">⌋</span></span></span></span></span><script type="math/tex" id="MathJax-Element-46">\left\lfloor \log_2{n} \right\rfloor</script>, but this was not required in the problem.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Solution (adedalic)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="kwd">import</span><span class="pln"> kotlin</span><span class="pun">.</span><span class="pln">system</span><span class="pun">.</span><span class="pln">exitProcess

fun main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    val </span><span class="pun">(</span><span class="pln">nString</span><span class="pun">,</span><span class="pln"> h</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> readln</span><span class="pun">().</span><span class="pln">split</span><span class="pun">(</span><span class="str">" "</span><span class="pun">)</span><span class="pln">

    fun ask</span><span class="pun">(</span><span class="pln">pos</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">):</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        println</span><span class="pun">(</span><span class="str">"? ${pos + 1}"</span><span class="pun">)</span><span class="pln">
        </span><span class="typ">System</span><span class="pun">.</span><span class="kwd">out</span><span class="pun">.</span><span class="pln">flush</span><span class="pun">()</span><span class="pln">
        val resp </span><span class="pun">=</span><span class="pln"> readln</span><span class="pun">()</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">resp </span><span class="pun">==</span><span class="pln"> </span><span class="str">"-1"</span><span class="pun">)</span><span class="pln">
            exitProcess</span><span class="pun">(</span><span class="lit">0</span><span class="pun">)</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> resp
    </span><span class="pun">}</span><span class="pln">

    fun isLower</span><span class="pun">(</span><span class="pln">s</span><span class="pun">:</span><span class="pln"> </span><span class="typ">String</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> s</span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="pln">isLowerCase</span><span class="pun">()</span><span class="pln">

    val lowerCaseFirst </span><span class="pun">=</span><span class="pln"> isLower</span><span class="pun">(</span><span class="pln">ask</span><span class="pun">(</span><span class="lit">0</span><span class="pun">))</span><span class="pln">
    fun lowerOrEqual</span><span class="pun">(</span><span class="pln">a</span><span class="pun">:</span><span class="pln"> </span><span class="typ">String</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">:</span><span class="pln"> </span><span class="typ">String</span><span class="pun">)</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="typ">Boolean</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">isLower</span><span class="pun">(</span><span class="pln">a</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> isLower</span><span class="pun">(</span><span class="pln">b</span><span class="pun">))</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> a </span><span class="pun">&lt;=</span><span class="pln"> b</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> isLower</span><span class="pun">(</span><span class="pln">a</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> lowerCaseFirst
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> l </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> r </span><span class="pun">=</span><span class="pln"> nString</span><span class="pun">.</span><span class="pln">toInt</span><span class="pun">()</span><span class="pln">
    </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">r </span><span class="pun">-</span><span class="pln"> l </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        val mid </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l </span><span class="pun">+</span><span class="pln"> r</span><span class="pun">)</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">lowerOrEqual</span><span class="pun">(</span><span class="pln">ask</span><span class="pun">(</span><span class="pln">mid</span><span class="pun">),</span><span class="pln"> h</span><span class="pun">))</span><span class="pln">
            l </span><span class="pun">=</span><span class="pln"> mid
        </span><span class="kwd">else</span><span class="pln">
            r </span><span class="pun">=</span><span class="pln"> mid
    </span><span class="pun">}</span><span class="pln">
    println</span><span class="pun">(</span><span class="str">"! ${l + 1}"</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2087/problem/E" title="Kotlin Heroes: Episode 12">2087E - Color the Arrows</a></p><p>Idea: <a class="rated-user user-red" href="https://codeforces.com/profile/BledDest" title="International Grandmaster BledDest">BledDest</a>, preparation: <a class="rated-user user-orange" href="https://codeforces.com/profile/awoo" title="Master awoo">awoo</a></p> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2087/problem/E" title="Kotlin Heroes: Episode 12">2087E - Color the Arrows</a></h3><div class="ttypography"><div class="problem-statement"><div><p>In an ideal case, the answer includes all arrows with a positive cost. Why can't this always be achieved? This is quite evident in the test case "<span class="tex-font-style-tt">&lt;&lt;&lt;&gt;&gt;&gt;</span>". It cannot be the case that the leftmost repainted arrow points to the left while the rightmost one points to the right. But what if this condition is not only necessary but also sufficient?</p><p>Let's constructively show that this is indeed the case. Suppose we want to repaint a set such that the leftmost arrow points to the right. Then the process goes as follows. We start with the rightmost arrow pointing to the left. We repaint all arrows pointing to the left, moving from right to left. Then we repaint the leftmost arrow (pointing to the right). After that, we repaint all arrows pointing to the right, moving from left to right.</p><p>The case where the rightmost arrow points to the left is handled similarly.</p><p>Thus, we need to find the best answer of the following form: the leftmost arrow points to the right or the rightmost arrow points to the left. We can consider this as two independent cases and take the maximum of their answers. Fix the leftmost arrow. It must point to the right. Then, we can take any arrows to its right, and the answer will already be valid. We take all arrows with a positive cost. Note that the leftmost arrow can be negative even in the optimal answer.</p><p>Overall complexity: <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-269"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-270">O</span><span class="MJXp-mo" id="MJXp-Span-271" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-272">n</span><span class="MJXp-mo" id="MJXp-Span-273" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-47">O(n)</script> per test case.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Solution (awoo)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="pln">fun main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> repeat</span><span class="pun">(</span><span class="pln">readLine</span><span class="pun">()!!.</span><span class="pln">toInt</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    val n </span><span class="pun">=</span><span class="pln"> readLine</span><span class="pun">()!!.</span><span class="pln">toInt</span><span class="pun">()</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> s </span><span class="pun">=</span><span class="pln"> readLine</span><span class="pun">()!!</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> a </span><span class="pun">=</span><span class="pln"> readLine</span><span class="pun">()!!.</span><span class="pln">split</span><span class="pun">(</span><span class="str">" "</span><span class="pun">).</span><span class="pln">map </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">toInt</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    
    </span><span class="kwd">var</span><span class="pln"> ans </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0.toLong</span><span class="pun">()</span><span class="pln">
    
    repeat</span><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">var</span><span class="pln"> sum </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0.toLong</span><span class="pun">()</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="kwd">in</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="kwd">until</span><span class="pln"> n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">s</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'&lt;'</span><span class="pun">)</span><span class="pln">
                ans </span><span class="pun">=</span><span class="pln"> maxOf</span><span class="pun">(</span><span class="pln">ans</span><span class="pun">,</span><span class="pln"> sum </span><span class="pun">+</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln">
            sum </span><span class="pun">+=</span><span class="pln"> maxOf</span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">],</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        a </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">reversed</span><span class="pun">()</span><span class="pln">
        s </span><span class="pun">=</span><span class="pln"> s</span><span class="pun">.</span><span class="pln">reversed</span><span class="pun">().</span><span class="pln">replace</span><span class="pun">(</span><span class="str">'&lt;'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'.'</span><span class="pun">).</span><span class="pln">replace</span><span class="pun">(</span><span class="str">'&gt;'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'&lt;'</span><span class="pun">).</span><span class="pln">replace</span><span class="pun">(</span><span class="str">'.'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'&gt;'</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    
    println</span><span class="pun">(</span><span class="pln">ans</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2087/problem/F" title="Kotlin Heroes: Episode 12">2087F - Weapon Upgrade</a></p><p>Idea: <a class="rated-user user-red" href="https://codeforces.com/profile/BledDest" title="International Grandmaster BledDest">BledDest</a>, preparation: <a class="rated-user user-violet" href="https://codeforces.com/profile/Neon" title="Candidate Master Neon">Neon</a></p> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2087/problem/F" title="Kotlin Heroes: Episode 12">2087F - Weapon Upgrade</a></h3><div class="ttypography"><div class="problem-statement"><div><p>The problem can be solved using dynamic programming. Let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-274"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-275">d</span><span class="MJXp-msubsup" id="MJXp-Span-276"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-277" style="margin-right: 0.05em;">p</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-278" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-279">s</span><span class="MJXp-mo" id="MJXp-Span-280">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-281">i</span><span class="MJXp-mo" id="MJXp-Span-282">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-283">j</span></span></span></span></span><script type="math/tex" id="MathJax-Element-48">dp_{s, i, j}</script> represent the minimum damage Monocarp can get if the current stage is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-284"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-285">s</span></span></span><script type="math/tex" id="MathJax-Element-49">s</script>, physical damage is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-286"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-287">i</span></span></span><script type="math/tex" id="MathJax-Element-50">i</script>, and elemental damage is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-288"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-289">j</span></span></span><script type="math/tex" id="MathJax-Element-51">j</script>. To make transitions, we need to calculate two values: the number of alive monsters and check if there is at least one alive monster that can be killed.</p><p>Note that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-290"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-291">i</span></span></span><script type="math/tex" id="MathJax-Element-52">i</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-292"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-293">j</span></span></span><script type="math/tex" id="MathJax-Element-53">j</script> also show the number of killed monsters, which is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-294"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-295">i</span><span class="MJXp-mo" id="MJXp-Span-296" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-297">j</span><span class="MJXp-mo" id="MJXp-Span-298" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-299">2</span></span></span><script type="math/tex" id="MathJax-Element-54">i+j-2</script>. Therefore, the number of alive monsters is equal to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-300"><span class="MJXp-mo" id="MJXp-Span-301" style="margin-left: 0.333em; margin-right: 0.333em;">min</span><span class="MJXp-mo" id="MJXp-Span-302" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-303">s</span><span class="MJXp-mo" id="MJXp-Span-304" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-305">n</span><span class="MJXp-mo" id="MJXp-Span-306" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-307" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mo" id="MJXp-Span-308" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-309">i</span><span class="MJXp-mo" id="MJXp-Span-310" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-311">j</span><span class="MJXp-mo" id="MJXp-Span-312" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-313">2</span><span class="MJXp-mo" id="MJXp-Span-314" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-55">\min(s, n) - (i + j - 2)</script>, which is the number of spawned monsters minus the number of killed ones.</p><p>Additionally, we can maintain an array <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-315"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-316">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-317">n</span><span class="MJXp-msubsup" id="MJXp-Span-318"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-319" style="margin-right: 0.05em;">t</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-320" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-321">i</span><span class="MJXp-mo" id="MJXp-Span-322">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-323">j</span></span></span></span></span><script type="math/tex" id="MathJax-Element-56">cnt_{i, j}</script> that stores the number of spawned monsters that can be killed with <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-324"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-325">i</span></span></span><script type="math/tex" id="MathJax-Element-57">i</script> physical damage and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-326"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-327">j</span></span></span><script type="math/tex" id="MathJax-Element-58">j</script> elemental damage, including those that have already been killed. Updating this array is easy. When the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-328"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-329">s</span></span></span><script type="math/tex" id="MathJax-Element-59">s</script>-th monster appears, we should increase <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-330"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-331">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-332">n</span><span class="MJXp-msubsup" id="MJXp-Span-333"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-334" style="margin-right: 0.05em;">t</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-335" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-336">i</span><span class="MJXp-mo" id="MJXp-Span-337">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-338">j</span></span></span></span></span><script type="math/tex" id="MathJax-Element-60">cnt_{i, j}</script> by <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-339"><span class="MJXp-mn" id="MJXp-Span-340">1</span></span></span><script type="math/tex" id="MathJax-Element-61">1</script> for all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-341"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-342">i</span><span class="MJXp-mo" id="MJXp-Span-343" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-msubsup" id="MJXp-Span-344"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-345" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-346" style="vertical-align: -0.4em;">s</span></span></span></span><script type="math/tex" id="MathJax-Element-62">i \ge a_s</script> or <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-347"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-348">j</span><span class="MJXp-mo" id="MJXp-Span-349" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-msubsup" id="MJXp-Span-350"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-351" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-352" style="vertical-align: -0.4em;">s</span></span></span></span><script type="math/tex" id="MathJax-Element-63">j \ge b_s</script>. Note that all monsters that were killed early can also be killed now. This means that all the killed monsters are included in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-353"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-354">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-355">n</span><span class="MJXp-msubsup" id="MJXp-Span-356"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-357" style="margin-right: 0.05em;">t</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-358" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-359">i</span><span class="MJXp-mo" id="MJXp-Span-360">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-361">j</span></span></span></span></span><script type="math/tex" id="MathJax-Element-64">cnt_{i, j}</script>. Therefore, the number of alive monsters that can be killed is equal to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-362"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-363">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-364">n</span><span class="MJXp-msubsup" id="MJXp-Span-365"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-366" style="margin-right: 0.05em;">t</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-367" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-368">i</span><span class="MJXp-mo" id="MJXp-Span-369">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-370">j</span></span></span><span class="MJXp-mo" id="MJXp-Span-371" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mo" id="MJXp-Span-372" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-373">i</span><span class="MJXp-mo" id="MJXp-Span-374" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-375">j</span><span class="MJXp-mo" id="MJXp-Span-376" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-377">2</span><span class="MJXp-mo" id="MJXp-Span-378" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-65">cnt_{i, j} - (i + j - 2)</script>.</p><p>It is also important to note that the number of stages can be up to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-379"><span class="MJXp-mn" id="MJXp-Span-380">2</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-381">n</span><span class="MJXp-mo" id="MJXp-Span-382" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-383">1</span></span></span><script type="math/tex" id="MathJax-Element-66">2n - 1</script>.</p><p>This solution works in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-384"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-385">O</span><span class="MJXp-mo" id="MJXp-Span-386" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-387"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-388" style="margin-right: 0.05em;">n</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-389" style="vertical-align: 0.5em;">3</span></span><span class="MJXp-mo" id="MJXp-Span-390" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-67">O(n^3)</script>. If you store all values of dynamic programming, you will probably get ML, so you should maintain only two "layers" of dynamic programming: for the previous value of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-391"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-392">s</span></span></span><script type="math/tex" id="MathJax-Element-68">s</script> and for the current value of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-393"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-394">s</span></span></span><script type="math/tex" id="MathJax-Element-69">s</script>.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Solution (Neon)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="kwd">const</span><span class="pln"> val N </span><span class="pun">=</span><span class="pln"> </span><span class="lit">505</span><span class="pln">
</span><span class="kwd">const</span><span class="pln"> val INF </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1e9</span><span class="pun">.</span><span class="pln">toInt</span><span class="pun">()</span><span class="pln">

fun main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  val n </span><span class="pun">=</span><span class="pln"> readln</span><span class="pun">().</span><span class="pln">toInt</span><span class="pun">()</span><span class="pln">
  val a </span><span class="pun">=</span><span class="pln"> readln</span><span class="pun">().</span><span class="pln">split</span><span class="pun">(</span><span class="str">" "</span><span class="pun">).</span><span class="pln">map </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">toInt</span><span class="pun">()</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">}</span><span class="pln">
  val b </span><span class="pun">=</span><span class="pln"> readln</span><span class="pun">().</span><span class="pln">split</span><span class="pun">(</span><span class="str">" "</span><span class="pun">).</span><span class="pln">map </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">toInt</span><span class="pun">()</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">}</span><span class="pln">
  
  val cnt </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Array</span><span class="pun">(</span><span class="pln">N</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="typ">IntArray</span><span class="pun">(</span><span class="pln">N</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
  val dp </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Array</span><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="typ">Array</span><span class="pun">(</span><span class="pln">N</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="typ">IntArray</span><span class="pun">(</span><span class="pln">N</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> INF </span><span class="pun">}</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
  dp</span><span class="pun">[</span><span class="lit">0</span><span class="pun">][</span><span class="lit">0</span><span class="pun">][</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">

  </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">t </span><span class="kwd">in</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="kwd">until</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    val ct </span><span class="pun">=</span><span class="pln"> t </span><span class="kwd">and</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
    val nt </span><span class="pun">=</span><span class="pln"> ct xor </span><span class="lit">1</span><span class="pln">
    
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">t </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="kwd">in</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="kwd">until</span><span class="pln"> N</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">j </span><span class="kwd">in</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="kwd">until</span><span class="pln"> N</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">t</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;=</span><span class="pln"> i </span><span class="pun">||</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">t</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;=</span><span class="pln"> j</span><span class="pun">)</span><span class="pln"> </span><span class="pun">++</span><span class="pln">cnt</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">];</span><span class="pln">
      </span><span class="pun">}</span><span class="pln"> 
    </span><span class="pun">}</span><span class="pln">

    dp</span><span class="pun">[</span><span class="pln">nt</span><span class="pun">].</span><span class="pln">forEach </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">fill</span><span class="pun">(</span><span class="pln">INF</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="kwd">in</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="kwd">until</span><span class="pln"> N</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">j </span><span class="kwd">in</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="kwd">until</span><span class="pln"> N</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">dp</span><span class="pun">[</span><span class="pln">ct</span><span class="pun">][</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> INF</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        val lft </span><span class="pun">=</span><span class="pln"> minOf</span><span class="pun">(</span><span class="pln">t </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> i </span><span class="pun">-</span><span class="pln"> j
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">cnt</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> i </span><span class="pun">+</span><span class="pln"> j</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
          dp</span><span class="pun">[</span><span class="pln">nt</span><span class="pun">][</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">][</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> minOf</span><span class="pun">(</span><span class="pln">dp</span><span class="pun">[</span><span class="pln">nt</span><span class="pun">][</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">][</span><span class="pln">j</span><span class="pun">],</span><span class="pln"> dp</span><span class="pun">[</span><span class="pln">ct</span><span class="pun">][</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> lft </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">
          dp</span><span class="pun">[</span><span class="pln">nt</span><span class="pun">][</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> minOf</span><span class="pun">(</span><span class="pln">dp</span><span class="pun">[</span><span class="pln">nt</span><span class="pun">][</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">],</span><span class="pln"> dp</span><span class="pun">[</span><span class="pln">ct</span><span class="pun">][</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> lft </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
          </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">t </span><span class="pun">&lt;</span><span class="pln"> n </span><span class="pun">||</span><span class="pln"> lft </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> dp</span><span class="pun">[</span><span class="pln">nt</span><span class="pun">][</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> minOf</span><span class="pun">(</span><span class="pln">dp</span><span class="pun">[</span><span class="pln">nt</span><span class="pun">][</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">],</span><span class="pln"> dp</span><span class="pun">[</span><span class="pln">ct</span><span class="pun">][</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> lft</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
      </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">

  </span><span class="kwd">var</span><span class="pln"> ans </span><span class="pun">=</span><span class="pln"> INF
  </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="kwd">in</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="kwd">until</span><span class="pln"> N</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">j </span><span class="kwd">in</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="kwd">until</span><span class="pln"> N</span><span class="pun">)</span><span class="pln"> ans </span><span class="pun">=</span><span class="pln"> minOf</span><span class="pun">(</span><span class="pln">ans</span><span class="pun">,</span><span class="pln"> dp</span><span class="pun">[</span><span class="lit">0</span><span class="pun">][</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">])</span><span class="pln">
  </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">ans </span><span class="pun">==</span><span class="pln"> INF</span><span class="pun">)</span><span class="pln"> ans </span><span class="pun">=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pln">
  println</span><span class="pun">(</span><span class="pln">ans</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2087/problem/G" title="Kotlin Heroes: Episode 12">2087G - Esports in Berland</a></p><p>Idea: <a class="rated-user user-red" href="https://codeforces.com/profile/BledDest" title="International Grandmaster BledDest">BledDest</a>, preparation: <a class="rated-user user-orange" href="https://codeforces.com/profile/adedalic" title="International Master adedalic">adedalic</a></p> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2087/problem/G" title="Kotlin Heroes: Episode 12">2087G - Esports in Berland</a></h3><div class="ttypography"><div class="problem-statement"><div><p>Suppose that Monocarp will train for exactly <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-395"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-396">k</span></span></span><script type="math/tex" id="MathJax-Element-70">k</script> days. How much can he earn?</p><p>To start, let's calculate how much Monocarp will earn, but in a slightly different way. If on the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-397"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-398">i</span></span></span><script type="math/tex" id="MathJax-Element-71">i</script>-th day (0-indexed) he competed, we will add only <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-399"><span class="MJXp-msubsup" id="MJXp-Span-400"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-401" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-402" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-72">a_i</script> to the score. If he trained, we will add exactly as much as this training will bring him in the future, namely <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-403"><span class="MJXp-mo" id="MJXp-Span-404" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-405">n</span><span class="MJXp-mo" id="MJXp-Span-406" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-407">i</span><span class="MJXp-mo" id="MJXp-Span-408" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-409">1</span><span class="MJXp-mo" id="MJXp-Span-410" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-411" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mo" id="MJXp-Span-412" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mtext" id="MJXp-Span-413">number of trainings later</span><span class="MJXp-mo" id="MJXp-Span-414" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-73">(n - i - 1) - (\text{number of trainings later})</script>. That is, for each subsequent day that is not a training day, he will receive an additional unit of money.</p><p>This makes it a bit easier to calculate, but it's still not enough. Notice that since Monocarp trains for exactly <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-415"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-416">k</span></span></span><script type="math/tex" id="MathJax-Element-74">k</script> days, regardless of which days they are, we will subtract <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-417"><span class="MJXp-mo" id="MJXp-Span-418" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-419">k</span><span class="MJXp-mo" id="MJXp-Span-420" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-421">1</span><span class="MJXp-mo" id="MJXp-Span-422" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-75">(k - 1)</script> from the contribution of the first training, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-423"><span class="MJXp-mo" id="MJXp-Span-424" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-425">k</span><span class="MJXp-mo" id="MJXp-Span-426" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-427">2</span><span class="MJXp-mo" id="MJXp-Span-428" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-76">(k - 2)</script> from the second, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-429"><span class="MJXp-mo" id="MJXp-Span-430" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-431">k</span><span class="MJXp-mo" id="MJXp-Span-432" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-433">3</span><span class="MJXp-mo" id="MJXp-Span-434" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-77">(k - 3)</script> from the third, and so on. From the last one, we will subtract <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-435"><span class="MJXp-mn" id="MJXp-Span-436">0</span></span></span><script type="math/tex" id="MathJax-Element-78">0</script>.</p><p>In other words, we will subtract exactly <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-437"><span class="MJXp-mfrac" id="MJXp-Span-438" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-439">k</span><span class="MJXp-mo" id="MJXp-Span-440">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-441">k</span><span class="MJXp-mo" id="MJXp-Span-442">−</span><span class="MJXp-mn" id="MJXp-Span-443">1</span><span class="MJXp-mo" id="MJXp-Span-444">)</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mn" id="MJXp-Span-445">2</span></span></span></span></span></span></span></span><script type="math/tex" id="MathJax-Element-79">\frac{k (k - 1)}{2}</script> from the contribution of all trainings, regardless of the choice of days. Thus, the total earnings can be expressed as <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-446"><span class="MJXp-mrow" id="MJXp-Span-447"><span class="MJXp-mi" id="MJXp-Span-448">t</span><span class="MJXp-mi" id="MJXp-Span-449">o</span><span class="MJXp-mi" id="MJXp-Span-450">t</span><span class="MJXp-mi" id="MJXp-Span-451">a</span><span class="MJXp-mi" id="MJXp-Span-452">l</span></span><span class="MJXp-mo" id="MJXp-Span-453" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-munderover" id="MJXp-Span-454"><span class=""><span class="MJXp-mo" id="MJXp-Span-455" style="margin-left: 0.111em; margin-right: 0.167em;"><span class="MJXp-largeop">∑</span></span></span><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-456" style="margin-left: 0px;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-457">i</span><span class="MJXp-mo" id="MJXp-Span-458">∉</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-459">T</span></span></span></span><span class="MJXp-mrow" id="MJXp-Span-460"><span class="MJXp-msubsup" id="MJXp-Span-461"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-462" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-463" style="vertical-align: -0.4em;">i</span></span></span><span class="MJXp-mo" id="MJXp-Span-464" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-munderover" id="MJXp-Span-465"><span class=""><span class="MJXp-mo" id="MJXp-Span-466" style="margin-left: 0.111em; margin-right: 0.167em;"><span class="MJXp-largeop">∑</span></span></span><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-467" style="margin-left: 0px;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-468">i</span><span class="MJXp-mo" id="MJXp-Span-469">∈</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-470">T</span></span></span></span><span class="MJXp-mrow" id="MJXp-Span-471"><span class="MJXp-mo" id="MJXp-Span-472" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-473">n</span><span class="MJXp-mo" id="MJXp-Span-474" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-475">i</span><span class="MJXp-mo" id="MJXp-Span-476" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-477">1</span><span class="MJXp-mo" id="MJXp-Span-478" style="margin-left: 0em; margin-right: 0em;">)</span></span><span class="MJXp-mo" id="MJXp-Span-479" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mfrac" id="MJXp-Span-480" style="vertical-align: 0.25em;"><span class="MJXp-box"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-481">k</span><span class="MJXp-mo" id="MJXp-Span-482" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-483">k</span><span class="MJXp-mo" id="MJXp-Span-484" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-485">1</span><span class="MJXp-mo" id="MJXp-Span-486" style="margin-left: 0em; margin-right: 0em;">)</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box"><span class="MJXp-mn" id="MJXp-Span-487">2</span></span></span></span></span></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-80">\mathrm{total} = \sum_{i \not\in T}{a_i} + \sum_{i \in T}{(n - i - 1)} - \frac{k (k - 1)}{2}</script> where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-488"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-489">T</span></span></span><script type="math/tex" id="MathJax-Element-81">T</script> is the set of training days.</p><p>The last step is as follows: let's say that we first receive all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-490"><span class="MJXp-msubsup" id="MJXp-Span-491"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-492" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-493" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-82">a_i</script>. And when on the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-494"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-495">i</span></span></span><script type="math/tex" id="MathJax-Element-83">i</script>-th day we decide to train, we will earn <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-496"><span class="MJXp-mo" id="MJXp-Span-497" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-498">n</span><span class="MJXp-mo" id="MJXp-Span-499" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-500">i</span><span class="MJXp-mo" id="MJXp-Span-501" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-502">1</span><span class="MJXp-mo" id="MJXp-Span-503" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-84">(n - i - 1)</script>, but we will have to "return" <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-504"><span class="MJXp-msubsup" id="MJXp-Span-505"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-506" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-507" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-85">a_i</script> back. Then the total earnings can be expressed as: <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-508"><span class="MJXp-mrow" id="MJXp-Span-509"><span class="MJXp-mi" id="MJXp-Span-510">t</span><span class="MJXp-mi" id="MJXp-Span-511">o</span><span class="MJXp-mi" id="MJXp-Span-512">t</span><span class="MJXp-mi" id="MJXp-Span-513">a</span><span class="MJXp-mi" id="MJXp-Span-514">l</span></span><span class="MJXp-mo" id="MJXp-Span-515" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-munderover" id="MJXp-Span-516"><span><span class="MJXp-over"><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-522" style="margin-right: 0px; margin-left: 0px;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-523">n</span><span class="MJXp-mo" id="MJXp-Span-524">−</span><span class="MJXp-mn" id="MJXp-Span-525">1</span></span></span><span class=""><span class="MJXp-mo" id="MJXp-Span-517" style="margin-left: 0.111em; margin-right: 0.167em;"><span class="MJXp-largeop">∑</span></span></span></span></span><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-518" style="margin-left: 0px;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-519">i</span><span class="MJXp-mo" id="MJXp-Span-520">=</span><span class="MJXp-mn" id="MJXp-Span-521">0</span></span></span></span><span class="MJXp-mrow" id="MJXp-Span-526"><span class="MJXp-msubsup" id="MJXp-Span-527"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-528" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-529" style="vertical-align: -0.4em;">i</span></span></span><span class="MJXp-mo" id="MJXp-Span-530" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-munderover" id="MJXp-Span-531"><span class=""><span class="MJXp-mo" id="MJXp-Span-532" style="margin-left: 0.111em; margin-right: 0.167em;"><span class="MJXp-largeop">∑</span></span></span><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-533" style="margin-left: 0px;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-534">i</span><span class="MJXp-mo" id="MJXp-Span-535">∈</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-536">T</span></span></span></span><span class="MJXp-mrow" id="MJXp-Span-537"><span class="MJXp-mo" id="MJXp-Span-538" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-539">n</span><span class="MJXp-mo" id="MJXp-Span-540" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-541">i</span><span class="MJXp-mo" id="MJXp-Span-542" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-543">1</span><span class="MJXp-mo" id="MJXp-Span-544" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-545"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-546" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-547" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-548" style="margin-left: 0em; margin-right: 0em;">)</span></span><span class="MJXp-mo" id="MJXp-Span-549" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mfrac" id="MJXp-Span-550" style="vertical-align: 0.25em;"><span class="MJXp-box"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-551">k</span><span class="MJXp-mo" id="MJXp-Span-552" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-553">k</span><span class="MJXp-mo" id="MJXp-Span-554" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-555">1</span><span class="MJXp-mo" id="MJXp-Span-556" style="margin-left: 0em; margin-right: 0em;">)</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box"><span class="MJXp-mn" id="MJXp-Span-557">2</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-558" style="margin-left: 0em; margin-right: 0.222em;">.</span></span></span><script type="math/tex; mode=display" id="MathJax-Element-86">\mathrm{total} = \sum_{i = 0}^{n - 1}{a_i} + \sum_{i \in T}{(n - i - 1 - a_i)} - \frac{k (k - 1)}{2}.</script></p><p>Since the first and third terms of the sum do not depend on the choice of days, to maximize <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-559"><span class="MJXp-mrow" id="MJXp-Span-560"><span class="MJXp-mi" id="MJXp-Span-561">t</span><span class="MJXp-mi" id="MJXp-Span-562">o</span><span class="MJXp-mi" id="MJXp-Span-563">t</span><span class="MJXp-mi" id="MJXp-Span-564">a</span><span class="MJXp-mi" id="MJXp-Span-565">l</span></span></span></span><script type="math/tex" id="MathJax-Element-87">\mathrm{total}</script>, it is sufficient to maximize the sum in the middle. Let's construct an array <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-566"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-567">d</span></span></span><script type="math/tex" id="MathJax-Element-88">d</script>, where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-568"><span class="MJXp-msubsup" id="MJXp-Span-569"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-570" style="margin-right: 0.05em;">d</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-571" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-572" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-573">n</span><span class="MJXp-mo" id="MJXp-Span-574" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-575">i</span><span class="MJXp-mo" id="MJXp-Span-576" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-577">1</span><span class="MJXp-mo" id="MJXp-Span-578" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-579"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-580" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-581" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-89">d_i = n - i - 1 - a_i</script>. Then, for a fixed <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-582"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-583">k</span></span></span><script type="math/tex" id="MathJax-Element-90">k</script>, we simply need to choose the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-584"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-585">k</span></span></span><script type="math/tex" id="MathJax-Element-91">k</script> maximum values in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-586"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-587">d</span></span></span><script type="math/tex" id="MathJax-Element-92">d</script>. To do this, it is enough to sort <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-588"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-589">d</span></span></span><script type="math/tex" id="MathJax-Element-93">d</script> in descending order once and take a prefix of length <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-590"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-591">k</span></span></span><script type="math/tex" id="MathJax-Element-94">k</script>.</p><p>Thus, we will construct the array <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-592"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-593">d</span></span></span><script type="math/tex" id="MathJax-Element-95">d</script>, sort it, and iterate through <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-594"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-595">k</span></span></span><script type="math/tex" id="MathJax-Element-96">k</script>, maintaining the sum of the first <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-596"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-597">k</span></span></span><script type="math/tex" id="MathJax-Element-97">k</script> elements in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-598"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-599">d</span></span></span><script type="math/tex" id="MathJax-Element-98">d</script>.</p><p>Next, we need to understand how to count the number of ways to take the optimal answer for a given <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-600"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-601">k</span></span></span><script type="math/tex" id="MathJax-Element-99">k</script>. Since we need to maximize the sum of the selected <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-602"><span class="MJXp-msubsup" id="MJXp-Span-603"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-604" style="margin-right: 0.05em;">d</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-605" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-100">d_i</script>, we should take all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-606"><span class="MJXp-msubsup" id="MJXp-Span-607"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-608" style="margin-right: 0.05em;">d</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-609" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-610" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-msubsup" id="MJXp-Span-611"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-612" style="margin-right: 0.05em;">d</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-613" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-614">k</span><span class="MJXp-mo" id="MJXp-Span-615">−</span><span class="MJXp-mn" id="MJXp-Span-616">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-101">d_i > d_{k - 1}</script>. On the other hand, we shouldn't take any <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-617"><span class="MJXp-msubsup" id="MJXp-Span-618"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-619" style="margin-right: 0.05em;">d</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-620" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-621" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-msubsup" id="MJXp-Span-622"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-623" style="margin-right: 0.05em;">d</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-624" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-625">k</span><span class="MJXp-mo" id="MJXp-Span-626">−</span><span class="MJXp-mn" id="MJXp-Span-627">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-102">d_i < d_{k - 1}</script>.</p><p>However, from those <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-628"><span class="MJXp-msubsup" id="MJXp-Span-629"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-630" style="margin-right: 0.05em;">d</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-631" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-632" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-633"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-634" style="margin-right: 0.05em;">d</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-635" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-636">k</span><span class="MJXp-mo" id="MJXp-Span-637">−</span><span class="MJXp-mn" id="MJXp-Span-638">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-103">d_i = d_{k - 1}</script>, we can freely take any subset of the required size, as this will not affect the total sum. So let's maintain the interval <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-639"><span class="MJXp-mo" id="MJXp-Span-640" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-641">l</span><span class="MJXp-mo" id="MJXp-Span-642" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-643">r</span><span class="MJXp-mo" id="MJXp-Span-644" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-104">[l, r)</script>, where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-645"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-646">l</span></span></span><script type="math/tex" id="MathJax-Element-105">l</script> is the minimum index for which <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-647"><span class="MJXp-msubsup" id="MJXp-Span-648"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-649" style="margin-right: 0.05em;">d</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-650" style="vertical-align: -0.4em;">l</span></span><span class="MJXp-mo" id="MJXp-Span-651" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-msubsup" id="MJXp-Span-652"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-653" style="margin-right: 0.05em;">d</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-654" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-655">k</span><span class="MJXp-mo" id="MJXp-Span-656">−</span><span class="MJXp-mn" id="MJXp-Span-657">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-106">d_l \le d_{k - 1}</script>, and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-658"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-659">r</span></span></span><script type="math/tex" id="MathJax-Element-107">r</script> is the minimum index for which <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-660"><span class="MJXp-msubsup" id="MJXp-Span-661"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-662" style="margin-right: 0.05em;">d</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-663" style="vertical-align: -0.4em;">r</span></span><span class="MJXp-mo" id="MJXp-Span-664" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-msubsup" id="MJXp-Span-665"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-666" style="margin-right: 0.05em;">d</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-667" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-668">k</span><span class="MJXp-mo" id="MJXp-Span-669">−</span><span class="MJXp-mn" id="MJXp-Span-670">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-108">d_r < d_{k - 1}</script>. Both <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-671"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-672">l</span></span></span><script type="math/tex" id="MathJax-Element-109">l</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-673"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-674">r</span></span></span><script type="math/tex" id="MathJax-Element-110">r</script> can be maintained on the fly while we iterate through <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-675"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-676">k</span></span></span><script type="math/tex" id="MathJax-Element-111">k</script>.</p><p>In this case, all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-677"><span class="MJXp-msubsup" id="MJXp-Span-678"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-679" style="margin-right: 0.05em;">d</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-680" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-681" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-682"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-683" style="margin-right: 0.05em;">d</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-684" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-685">k</span><span class="MJXp-mo" id="MJXp-Span-686">−</span><span class="MJXp-mn" id="MJXp-Span-687">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-112">d_i = d_{k - 1}</script> will lie within the interval <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-688"><span class="MJXp-mo" id="MJXp-Span-689" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-690">l</span><span class="MJXp-mo" id="MJXp-Span-691" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-692">r</span><span class="MJXp-mo" id="MJXp-Span-693" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-113">[l, r)</script>. Thus, we need to choose exactly <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-694"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-695">k</span><span class="MJXp-mo" id="MJXp-Span-696" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-697">l</span></span></span><script type="math/tex" id="MathJax-Element-114">k - l</script> elements from the segment of length <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-698"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-699">r</span><span class="MJXp-mo" id="MJXp-Span-700" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-701">l</span></span></span><script type="math/tex" id="MathJax-Element-115">r - l</script>, so there are exactly <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-702"><span class="MJXp-mrow" id="MJXp-Span-703"><span class="MJXp-TeXmathchoice" id="MJXp-Span-704"><span class="MJXp-mstyle" id="MJXp-Span-705"><span class="MJXp-mrow" id="MJXp-Span-706"><span class="MJXp-mo" id="MJXp-Span-707" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.083em;"><span class="MJXp-right MJXp-scale10" style="font-size: 1.333em; margin-left: 0.07em;">(</span></span></span></span></span><span class="MJXp-mfrac" id="MJXp-Span-708"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-709">r</span><span class="MJXp-mo" id="MJXp-Span-710">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-711">l</span></span><span class="MJXp-box" style="margin-top: -0.7em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-712">k</span><span class="MJXp-mo" id="MJXp-Span-713">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-714">l</span></span></span></span></span></span><span class="MJXp-TeXmathchoice" id="MJXp-Span-715"><span class="MJXp-mstyle" id="MJXp-Span-716"><span class="MJXp-mrow" id="MJXp-Span-717"><span class="MJXp-mo" id="MJXp-Span-718" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.083em;"><span class="MJXp-right MJXp-scale10" style="font-size: 1.333em; margin-left: 0.07em;">)</span></span></span></span></span></span></span></span><script type="math/tex" id="MathJax-Element-116">\binom{r - l}{k - l}</script> ways to choose.</p><p>As a result, we will iterate through <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-719"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-720">k</span></span></span><script type="math/tex" id="MathJax-Element-117">k</script> and carefully combine the answers for all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-721"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-722">k</span></span></span><script type="math/tex" id="MathJax-Element-118">k</script>, not forgetting the case <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-723"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-724">k</span><span class="MJXp-mo" id="MJXp-Span-725" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-726">0</span></span></span><script type="math/tex" id="MathJax-Element-119">k = 0</script>. For quick calculation of binomial coefficients, we will precompute all factorials and inverse factorials modulo the given module.</p><p>The complexity of the solution is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-727"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-728">O</span><span class="MJXp-mo" id="MJXp-Span-729" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-730">n</span><span class="MJXp-mi" id="MJXp-Span-731">log</span><span class="MJXp-mo" id="MJXp-Span-732" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mrow" id="MJXp-Span-733"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-734">n</span></span><span class="MJXp-mo" id="MJXp-Span-735" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-120">O(n \log{n})</script> time and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-736"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-737">O</span><span class="MJXp-mo" id="MJXp-Span-738" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-739">n</span><span class="MJXp-mo" id="MJXp-Span-740" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-121">O(n)</script> space.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Solution (adedalic)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="pln">fun main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    data </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">ModInt</span><span class="pun">(</span><span class="pln">val </span><span class="kwd">value</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        val MOD </span><span class="pun">=</span><span class="pln"> </span><span class="lit">998244353</span><span class="pln">
        </span><span class="kwd">operator</span><span class="pln"> fun plus</span><span class="pun">(</span><span class="pln">oth </span><span class="pun">:</span><span class="pln"> </span><span class="typ">ModInt</span><span class="pun">)</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="typ">ModInt</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            val cur </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="kwd">value</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> oth</span><span class="pun">.</span><span class="kwd">value</span><span class="pun">)</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> MOD
            </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">ModInt</span><span class="pun">(</span><span class="pln">cur</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">operator</span><span class="pln"> fun times</span><span class="pun">(</span><span class="pln">oth </span><span class="pun">:</span><span class="pln"> </span><span class="typ">ModInt</span><span class="pun">)</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="typ">ModInt</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            val cur </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">value</span><span class="pun">.</span><span class="pln">toLong</span><span class="pun">()</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> oth</span><span class="pun">.</span><span class="kwd">value</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> MOD
            </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">ModInt</span><span class="pun">(</span><span class="pln">cur</span><span class="pun">.</span><span class="pln">toInt</span><span class="pun">())</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        fun pow</span><span class="pun">(</span><span class="pln">k</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">)</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="typ">ModInt</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">var</span><span class="pln"> ans </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ModInt</span><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span><span class="pln">
            </span><span class="kwd">var</span><span class="pln"> a </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ModInt</span><span class="pun">(</span><span class="kwd">value</span><span class="pun">)</span><span class="pln">
            </span><span class="kwd">var</span><span class="pln"> curPw </span><span class="pun">=</span><span class="pln"> k
            </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">curPw </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">curPw </span><span class="pun">%</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">
                    ans </span><span class="pun">*=</span><span class="pln"> a
                a </span><span class="pun">*=</span><span class="pln"> a
                curPw </span><span class="pun">/=</span><span class="pln"> </span><span class="lit">2</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> ans
        </span><span class="pun">}</span><span class="pln">
        fun inverse</span><span class="pun">()</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">pow</span><span class="pun">(</span><span class="pln">MOD </span><span class="pun">-</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln">
        </span><span class="kwd">override</span><span class="pln"> fun toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="kwd">value</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    val n </span><span class="pun">=</span><span class="pln"> readln</span><span class="pun">().</span><span class="pln">toInt</span><span class="pun">()</span><span class="pln">
    val a </span><span class="pun">=</span><span class="pln"> readln</span><span class="pun">().</span><span class="pln">split</span><span class="pun">(</span><span class="str">" "</span><span class="pun">).</span><span class="pln">map </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">toInt</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

    val factorials </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="lit">1.</span><span class="pun">.</span><span class="pln">n</span><span class="pun">).</span><span class="pln">runningFold</span><span class="pun">(</span><span class="typ">ModInt</span><span class="pun">(</span><span class="lit">1</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> acc</span><span class="pun">,</span><span class="pln"> it </span><span class="pun">-&gt;</span><span class="pln"> acc </span><span class="pun">*</span><span class="pln"> </span><span class="typ">ModInt</span><span class="pun">(</span><span class="pln">it</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    val invFact </span><span class="pun">=</span><span class="pln"> factorials</span><span class="pun">.</span><span class="pln">map </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">inverse</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

    fun choose</span><span class="pun">(</span><span class="pln">n </span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">,</span><span class="pln"> k </span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">)</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="typ">ModInt</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">k </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> n </span><span class="pun">&lt;</span><span class="pln"> k</span><span class="pun">)</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">ModInt</span><span class="pun">(</span><span class="lit">0</span><span class="pun">)</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> factorials</span><span class="pun">[</span><span class="pln">n</span><span class="pun">]</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> invFact</span><span class="pun">[</span><span class="pln">k</span><span class="pun">]</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> invFact</span><span class="pun">[</span><span class="pln">n </span><span class="pun">-</span><span class="pln"> k</span><span class="pun">]</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    val sum </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">sumOf </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">toLong</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    val delta </span><span class="pun">=</span><span class="pln"> </span><span class="typ">List</span><span class="pun">(</span><span class="pln">n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> n </span><span class="pun">-</span><span class="pln"> it </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">it</span><span class="pun">]</span><span class="pln"> </span><span class="pun">}.</span><span class="pln">sortedDescending</span><span class="pun">()</span><span class="pln">

    </span><span class="kwd">var</span><span class="pln"> ansVal </span><span class="pun">=</span><span class="pln"> sum
    </span><span class="kwd">var</span><span class="pln"> ansCnt </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ModInt</span><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span><span class="pln">

    </span><span class="kwd">var</span><span class="pln"> curSum </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0L</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> lf </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> rg </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">k </span><span class="kwd">in</span><span class="pln"> </span><span class="lit">1.</span><span class="pun">.</span><span class="pln">n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        curSum </span><span class="pun">+=</span><span class="pln"> delta</span><span class="pun">[</span><span class="pln">k </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln">
        </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">delta</span><span class="pun">[</span><span class="pln">lf</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> delta</span><span class="pun">[</span><span class="pln">k </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">])</span><span class="pln">
            lf</span><span class="pun">++</span><span class="pln">
        </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">rg </span><span class="pun">&lt;</span><span class="pln"> delta</span><span class="pun">.</span><span class="pln">size </span><span class="pun">&amp;&amp;</span><span class="pln"> delta</span><span class="pun">[</span><span class="pln">rg</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&gt;=</span><span class="pln"> delta</span><span class="pun">[</span><span class="pln">k </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">])</span><span class="pln">
            rg</span><span class="pun">++</span><span class="pln">
        val curVal </span><span class="pun">=</span><span class="pln"> sum </span><span class="pun">+</span><span class="pln"> curSum </span><span class="pun">-</span><span class="pln"> k</span><span class="pun">.</span><span class="pln">toLong</span><span class="pun">()</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">(</span><span class="pln">k </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pln">
        val curCnt </span><span class="pun">=</span><span class="pln"> choose</span><span class="pun">(</span><span class="pln">rg </span><span class="pun">-</span><span class="pln"> lf</span><span class="pun">,</span><span class="pln"> k </span><span class="pun">-</span><span class="pln"> lf</span><span class="pun">)</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">ansVal </span><span class="pun">&lt;</span><span class="pln"> curVal</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            ansVal </span><span class="pun">=</span><span class="pln"> curVal
            ansCnt </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ModInt</span><span class="pun">(</span><span class="lit">0</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">ansVal </span><span class="pun">==</span><span class="pln"> curVal</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            ansCnt </span><span class="pun">+=</span><span class="pln"> curCnt
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    println</span><span class="pun">(</span><span class="str">"$ansVal $ansCnt"</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2087/problem/H" title="Kotlin Heroes: Episode 12">2087H - Nim with Special Numbers</a></p><p>Idea: <a class="rated-user user-red" href="https://codeforces.com/profile/BledDest" title="International Grandmaster BledDest">BledDest</a>, preparation: <a class="rated-user user-red" href="https://codeforces.com/profile/BledDest" title="International Grandmaster BledDest">BledDest</a></p> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2087/problem/H" title="Kotlin Heroes: Episode 12">2087H - Nim with Special Numbers</a></h3><div class="ttypography"><div class="problem-statement"><div><p>To solve this problem, we first need to understand how the values of the Grundy function look for this modification of Nim. Let the value of the Grundy function at <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-741"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-742">x</span></span></span><script type="math/tex" id="MathJax-Element-122">x</script> be denoted as <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-743"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-744">G</span><span class="MJXp-mo" id="MJXp-Span-745" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-746">x</span><span class="MJXp-mo" id="MJXp-Span-747" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-123">G(x)</script>. Let the set <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-748"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-749">S</span></span></span><script type="math/tex" id="MathJax-Element-124">S</script> consist of numbers <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-750"><span class="MJXp-msubsup" id="MJXp-Span-751"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-752" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-753" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-754" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-755"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-756" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-757" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-758" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-759" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-760" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-761"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-762" style="margin-right: 0.05em;">s</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-763" style="vertical-align: -0.4em;">k</span></span></span></span><script type="math/tex" id="MathJax-Element-125">s_1, s_2, \dots, s_k</script>, with <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-764"><span class="MJXp-msubsup" id="MJXp-Span-765"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-766" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-767" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-768" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-msubsup" id="MJXp-Span-769"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-770" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-771" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-772" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mo" id="MJXp-Span-773" style="margin-left: 0em; margin-right: 0em;">⋯</span><span class="MJXp-mo" id="MJXp-Span-774" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-msubsup" id="MJXp-Span-775"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-776" style="margin-right: 0.05em;">s</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-777" style="vertical-align: -0.4em;">k</span></span></span></span><script type="math/tex" id="MathJax-Element-126">s_1 < s_2 < \dots < s_k</script>. For all numbers from <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-778"><span class="MJXp-mn" id="MJXp-Span-779">0</span></span></span><script type="math/tex" id="MathJax-Element-127">0</script> to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-780"><span class="MJXp-msubsup" id="MJXp-Span-781"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-782" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-783" style="vertical-align: -0.4em;">1</span></span></span></span><script type="math/tex" id="MathJax-Element-128">s_1</script>, the Grundy function is equal to the number itself, since the allowed moves for them are the same as in regular Nim. Starting from the value <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-784"><span class="MJXp-msubsup" id="MJXp-Span-785"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-786" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-787" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-788" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-789">1</span></span></span><script type="math/tex" id="MathJax-Element-129">s_1 + 1</script>, the Grundy function will change, but how?</p><p>For the value <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-790"><span class="MJXp-msubsup" id="MJXp-Span-791"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-792" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-793" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-794" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-795">1</span></span></span><script type="math/tex" id="MathJax-Element-130">s_1 + 1</script>, the only possible move leads to the value <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-796"><span class="MJXp-msubsup" id="MJXp-Span-797"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-798" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-799" style="vertical-align: -0.4em;">1</span></span></span></span><script type="math/tex" id="MathJax-Element-131">s_1</script>, so <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-800"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-801">G</span><span class="MJXp-mo" id="MJXp-Span-802" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-803"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-804" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-805" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-806" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-807">1</span><span class="MJXp-mo" id="MJXp-Span-808" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-809" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-810">0</span></span></span><script type="math/tex" id="MathJax-Element-132">G(s_1 + 1) = 0</script> (except when <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-811"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-812">G</span><span class="MJXp-mo" id="MJXp-Span-813" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-814"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-815" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-816" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-817" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-818" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-819">0</span></span></span><script type="math/tex" id="MathJax-Element-133">G(s_1) = 0</script>, in which case <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-820"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-821">G</span><span class="MJXp-mo" id="MJXp-Span-822" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-823"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-824" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-825" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-826" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-827">1</span><span class="MJXp-mo" id="MJXp-Span-828" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-829" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-830">1</span></span></span><script type="math/tex" id="MathJax-Element-134">G(s_1 + 1) = 1</script>). For the value <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-831"><span class="MJXp-msubsup" id="MJXp-Span-832"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-833" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-834" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-835" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-836">2</span></span></span><script type="math/tex" id="MathJax-Element-135">s_1 + 2</script>, there are moves to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-837"><span class="MJXp-msubsup" id="MJXp-Span-838"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-839" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-840" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-841" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-842">1</span></span></span><script type="math/tex" id="MathJax-Element-136">s_1 + 1</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-843"><span class="MJXp-msubsup" id="MJXp-Span-844"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-845" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-846" style="vertical-align: -0.4em;">1</span></span></span></span><script type="math/tex" id="MathJax-Element-137">s_1</script>; among the values of the Grundy function for them, there will definitely be <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-847"><span class="MJXp-mn" id="MJXp-Span-848">0</span></span></span><script type="math/tex" id="MathJax-Element-138">0</script>, and if there is also <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-849"><span class="MJXp-mn" id="MJXp-Span-850">1</span></span></span><script type="math/tex" id="MathJax-Element-139">1</script>, then <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-851"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-852">G</span><span class="MJXp-mo" id="MJXp-Span-853" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-854"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-855" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-856" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-857" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-858">2</span><span class="MJXp-mo" id="MJXp-Span-859" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-860" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-861">2</span></span></span><script type="math/tex" id="MathJax-Element-140">G(s_1 + 2) = 2</script>, otherwise <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-862"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-863">G</span><span class="MJXp-mo" id="MJXp-Span-864" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-865"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-866" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-867" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-868" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-869">2</span><span class="MJXp-mo" id="MJXp-Span-870" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-871" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-872">1</span></span></span><script type="math/tex" id="MathJax-Element-141">G(s_1 + 2) = 1</script>. And so on; by induction, it can be shown that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-873"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-874">G</span><span class="MJXp-mo" id="MJXp-Span-875" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-876"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-877" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-878" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-879" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-880">i</span><span class="MJXp-mo" id="MJXp-Span-881" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-882" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-883">i</span></span></span><script type="math/tex" id="MathJax-Element-142">G(s_1 + i) = i</script> if <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-884"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-885">G</span><span class="MJXp-mo" id="MJXp-Span-886" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-887"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-888" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-889" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-890" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-891" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-892">i</span></span></span><script type="math/tex" id="MathJax-Element-143">G(s_1) < i</script>, or <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-893"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-894">G</span><span class="MJXp-mo" id="MJXp-Span-895" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-896"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-897" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-898" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-899" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-900">i</span><span class="MJXp-mo" id="MJXp-Span-901" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-902" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-903">i</span><span class="MJXp-mo" id="MJXp-Span-904" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-905">1</span></span></span><script type="math/tex" id="MathJax-Element-144">G(s_1 + i) = i - 1</script> otherwise. In other words, in the interval <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-906"><span class="MJXp-mo" id="MJXp-Span-907" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-msubsup" id="MJXp-Span-908"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-909" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-910" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-911" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-912">1</span><span class="MJXp-mo" id="MJXp-Span-913" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-914"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-915" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-916" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-917" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-145">[s_1 + 1, s_2]</script>, the values of the Grundy function are <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-918"><span class="MJXp-mn" id="MJXp-Span-919">0</span><span class="MJXp-mo" id="MJXp-Span-920" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-921">1</span><span class="MJXp-mo" id="MJXp-Span-922" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-923">2</span><span class="MJXp-mo" id="MJXp-Span-924" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-925" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-926" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-927">G</span><span class="MJXp-mo" id="MJXp-Span-928" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-929"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-930" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-931" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-932" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-933" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-934">1</span><span class="MJXp-mo" id="MJXp-Span-935" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-936">G</span><span class="MJXp-mo" id="MJXp-Span-937" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-938"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-939" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-940" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-941" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-942" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-943">1</span><span class="MJXp-mo" id="MJXp-Span-944" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-945">G</span><span class="MJXp-mo" id="MJXp-Span-946" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-947"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-948" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-949" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-950" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-951" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-952">2</span><span class="MJXp-mo" id="MJXp-Span-953" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-954" style="margin-left: 0em; margin-right: 0em;">…</span></span></span><script type="math/tex" id="MathJax-Element-146">0, 1, 2, \dots, G(s_1) - 1, G(s_1) + 1, G(s_1) + 2, \dots</script> The same dependency will hold for the interval <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-955"><span class="MJXp-mo" id="MJXp-Span-956" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-msubsup" id="MJXp-Span-957"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-958" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-959" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-960" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-961">1</span><span class="MJXp-mo" id="MJXp-Span-962" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-963"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-964" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-965" style="vertical-align: -0.4em;">3</span></span><span class="MJXp-mo" id="MJXp-Span-966" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-147">[s_2 + 1, s_3]</script>, and so on.</p><p>Let's start by understanding how to find and maintain the Grundy function for the numbers <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-967"><span class="MJXp-msubsup" id="MJXp-Span-968"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-969" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-970" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-971" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-972"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-973" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-974" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-975" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-976" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-977" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-978"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-979" style="margin-right: 0.05em;">s</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-980" style="vertical-align: -0.4em;">k</span></span></span></span><script type="math/tex" id="MathJax-Element-148">s_1, s_2, \dots, s_k</script>. For each such number, the value of the Grundy function depends on two parameters: the Grundy function at the previous <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-981"><span class="MJXp-msubsup" id="MJXp-Span-982"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-983" style="margin-right: 0.05em;">s</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-984" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-149">s_i</script> and the distance to it. Formally, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-985"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-986">G</span><span class="MJXp-mo" id="MJXp-Span-987" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-988"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-989" style="margin-right: 0.05em;">s</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-990" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-991">i</span><span class="MJXp-mo" id="MJXp-Span-992">+</span><span class="MJXp-mn" id="MJXp-Span-993">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-994" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-150">G(s_{i+1})</script> is computed as follows: if <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-995"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-996">G</span><span class="MJXp-mo" id="MJXp-Span-997" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-998"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-999" style="margin-right: 0.05em;">s</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1000" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1001" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1002" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mrow" id="MJXp-Span-1003"><span class="MJXp-mo" id="MJXp-Span-1004" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-msubsup" id="MJXp-Span-1005"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1006" style="margin-right: 0.05em;">s</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1007" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1008">i</span><span class="MJXp-mo" id="MJXp-Span-1009">+</span><span class="MJXp-mn" id="MJXp-Span-1010">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-1011" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-1012"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1013" style="margin-right: 0.05em;">s</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1014" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mrow" id="MJXp-Span-1015"><span class="MJXp-mo" id="MJXp-Span-1016" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span></span></span><script type="math/tex" id="MathJax-Element-151">G(s_i) < |s_{i+1} - s_i|</script>, then <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1017"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1018">G</span><span class="MJXp-mo" id="MJXp-Span-1019" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1020"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1021" style="margin-right: 0.05em;">s</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1022" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1023">i</span><span class="MJXp-mo" id="MJXp-Span-1024">+</span><span class="MJXp-mn" id="MJXp-Span-1025">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-1026" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1027" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mrow" id="MJXp-Span-1028"><span class="MJXp-mo" id="MJXp-Span-1029" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-msubsup" id="MJXp-Span-1030"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1031" style="margin-right: 0.05em;">s</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1032" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1033">i</span><span class="MJXp-mo" id="MJXp-Span-1034">+</span><span class="MJXp-mn" id="MJXp-Span-1035">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-1036" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-1037"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1038" style="margin-right: 0.05em;">s</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1039" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mrow" id="MJXp-Span-1040"><span class="MJXp-mo" id="MJXp-Span-1041" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span></span></span><script type="math/tex" id="MathJax-Element-152">G(s_{i+1}) = |s_{i+1} - s_i|</script>, otherwise <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1042"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1043">G</span><span class="MJXp-mo" id="MJXp-Span-1044" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1045"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1046" style="margin-right: 0.05em;">s</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1047" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1048">i</span><span class="MJXp-mo" id="MJXp-Span-1049">+</span><span class="MJXp-mn" id="MJXp-Span-1050">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-1051" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1052" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mrow" id="MJXp-Span-1053"><span class="MJXp-mo" id="MJXp-Span-1054" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-msubsup" id="MJXp-Span-1055"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1056" style="margin-right: 0.05em;">s</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1057" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1058">i</span><span class="MJXp-mo" id="MJXp-Span-1059">+</span><span class="MJXp-mn" id="MJXp-Span-1060">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-1061" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-1062"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1063" style="margin-right: 0.05em;">s</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1064" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mrow" id="MJXp-Span-1065"><span class="MJXp-mo" id="MJXp-Span-1066" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mo" id="MJXp-Span-1067" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-1068">1</span></span></span><script type="math/tex" id="MathJax-Element-153">G(s_{i+1}) = |s_{i+1} - s_i| - 1</script>. Thus, the dependency of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1069"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1070">G</span><span class="MJXp-mo" id="MJXp-Span-1071" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1072"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1073" style="margin-right: 0.05em;">s</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1074" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1075">i</span><span class="MJXp-mo" id="MJXp-Span-1076">+</span><span class="MJXp-mn" id="MJXp-Span-1077">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-1078" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-154">G(s_{i+1})</script> on <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1079"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1080">G</span><span class="MJXp-mo" id="MJXp-Span-1081" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1082"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1083" style="margin-right: 0.05em;">s</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1084" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1085" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-155">G(s_i)</script> can be described by something like a ternary operator with three parameters <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1086"><span class="MJXp-mo" id="MJXp-Span-1087" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1088">x</span><span class="MJXp-mo" id="MJXp-Span-1089" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1090">a</span><span class="MJXp-mo" id="MJXp-Span-1091" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1092">b</span><span class="MJXp-mo" id="MJXp-Span-1093" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-156">(x, a, b)</script>: if the input value is less than <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1094"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1095">x</span></span></span><script type="math/tex" id="MathJax-Element-157">x</script>, return <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1096"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1097">a</span></span></span><script type="math/tex" id="MathJax-Element-158">a</script>, otherwise return <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1098"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1099">b</span></span></span><script type="math/tex" id="MathJax-Element-159">b</script>. In this case, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1100"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1101">x</span><span class="MJXp-mo" id="MJXp-Span-1102" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mrow" id="MJXp-Span-1103"><span class="MJXp-mo" id="MJXp-Span-1104" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-msubsup" id="MJXp-Span-1105"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1106" style="margin-right: 0.05em;">s</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1107" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1108">i</span><span class="MJXp-mo" id="MJXp-Span-1109">+</span><span class="MJXp-mn" id="MJXp-Span-1110">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-1111" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-1112"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1113" style="margin-right: 0.05em;">s</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1114" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mrow" id="MJXp-Span-1115"><span class="MJXp-mo" id="MJXp-Span-1116" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span></span></span><script type="math/tex" id="MathJax-Element-160">x = |s_{i+1} - s_i|</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1117"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1118">a</span><span class="MJXp-mo" id="MJXp-Span-1119" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mrow" id="MJXp-Span-1120"><span class="MJXp-mo" id="MJXp-Span-1121" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-msubsup" id="MJXp-Span-1122"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1123" style="margin-right: 0.05em;">s</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1124" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1125">i</span><span class="MJXp-mo" id="MJXp-Span-1126">+</span><span class="MJXp-mn" id="MJXp-Span-1127">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-1128" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-1129"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1130" style="margin-right: 0.05em;">s</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1131" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mrow" id="MJXp-Span-1132"><span class="MJXp-mo" id="MJXp-Span-1133" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span></span></span><script type="math/tex" id="MathJax-Element-161">a = |s_{i+1} - s_i|</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1134"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1135">b</span><span class="MJXp-mo" id="MJXp-Span-1136" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mrow" id="MJXp-Span-1137"><span class="MJXp-mo" id="MJXp-Span-1138" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-msubsup" id="MJXp-Span-1139"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1140" style="margin-right: 0.05em;">s</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1141" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1142">i</span><span class="MJXp-mo" id="MJXp-Span-1143">+</span><span class="MJXp-mn" id="MJXp-Span-1144">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-1145" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-1146"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1147" style="margin-right: 0.05em;">s</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1148" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mrow" id="MJXp-Span-1149"><span class="MJXp-mo" id="MJXp-Span-1150" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mo" id="MJXp-Span-1151" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-1152">1</span></span></span><script type="math/tex" id="MathJax-Element-162">b = |s_{i+1} - s_i| - 1</script>, and the input value is the previous <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1153"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1154">G</span><span class="MJXp-mo" id="MJXp-Span-1155" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1156"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1157" style="margin-right: 0.05em;">s</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1158" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1159" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-163">G(s_i)</script>.</p><p>Now let's try to describe the dependency of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1160"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1161">G</span><span class="MJXp-mo" id="MJXp-Span-1162" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1163"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1164" style="margin-right: 0.05em;">s</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1165" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1166">i</span><span class="MJXp-mo" id="MJXp-Span-1167">+</span><span class="MJXp-mn" id="MJXp-Span-1168">2</span></span></span><span class="MJXp-mo" id="MJXp-Span-1169" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-164">G(s_{i+2})</script> on <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1170"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1171">G</span><span class="MJXp-mo" id="MJXp-Span-1172" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1173"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1174" style="margin-right: 0.05em;">s</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1175" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1176" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-165">G(s_i)</script>. This is a combination of the ternary operator describing the dependency of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1177"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1178">G</span><span class="MJXp-mo" id="MJXp-Span-1179" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1180"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1181" style="margin-right: 0.05em;">s</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1182" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1183">i</span><span class="MJXp-mo" id="MJXp-Span-1184">+</span><span class="MJXp-mn" id="MJXp-Span-1185">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-1186" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-166">G(s_{i+1})</script> on <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1187"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1188">G</span><span class="MJXp-mo" id="MJXp-Span-1189" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1190"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1191" style="margin-right: 0.05em;">s</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1192" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1193" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-167">G(s_i)</script> and the ternary operator describing the dependency of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1194"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1195">G</span><span class="MJXp-mo" id="MJXp-Span-1196" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1197"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1198" style="margin-right: 0.05em;">s</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1199" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1200">i</span><span class="MJXp-mo" id="MJXp-Span-1201">+</span><span class="MJXp-mn" id="MJXp-Span-1202">2</span></span></span><span class="MJXp-mo" id="MJXp-Span-1203" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-168">G(s_{i+2})</script> on <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1204"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1205">G</span><span class="MJXp-mo" id="MJXp-Span-1206" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1207"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1208" style="margin-right: 0.05em;">s</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1209" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1210">i</span><span class="MJXp-mo" id="MJXp-Span-1211">+</span><span class="MJXp-mn" id="MJXp-Span-1212">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-1213" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-169">G(s_{i+1})</script>. In fact, a combination of two ternary operators of this kind can also be represented as a ternary operator.</p><p>This allows us to build a segment tree for the following operation: on the segment <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1214"><span class="MJXp-mo" id="MJXp-Span-1215" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1216">l</span><span class="MJXp-mo" id="MJXp-Span-1217" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1218">r</span><span class="MJXp-mo" id="MJXp-Span-1219" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-170">[l, r]</script>, combine all the ternary operators describing the dependencies of the Grundy function values for the numbers <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1220"><span class="MJXp-msubsup" id="MJXp-Span-1221"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1222" style="margin-right: 0.05em;">s</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1223" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1224" style="margin-left: 0.333em; margin-right: 0.333em;">∈</span><span class="MJXp-mo" id="MJXp-Span-1225" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1226">l</span><span class="MJXp-mo" id="MJXp-Span-1227" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1228">r</span><span class="MJXp-mo" id="MJXp-Span-1229" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-171">s_i \in [l, r]</script> from the previous ones (or from <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1230"><span class="MJXp-mn" id="MJXp-Span-1231">0</span></span></span><script type="math/tex" id="MathJax-Element-172">0</script> for <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1232"><span class="MJXp-msubsup" id="MJXp-Span-1233"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1234" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1235" style="vertical-align: -0.4em;">1</span></span></span></span><script type="math/tex" id="MathJax-Element-173">s_1</script>). In the leaves of the segment tree, there will be individual ternary operators for the numbers <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1236"><span class="MJXp-msubsup" id="MJXp-Span-1237"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1238" style="margin-right: 0.05em;">s</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1239" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-174">s_i</script> (or dummy elements), and in the internal nodes, there will be combinations of the ternary operators from the children. Then, to compute the value of the Grundy function for the number <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1240"><span class="MJXp-msubsup" id="MJXp-Span-1241"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1242" style="margin-right: 0.05em;">s</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1243" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-175">s_i</script>, a query to the segment tree should form a ternary operator describing the dependency of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1244"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1245">G</span><span class="MJXp-mo" id="MJXp-Span-1246" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1247"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1248" style="margin-right: 0.05em;">s</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1249" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1250" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-176">G(s_i)</script> on <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1251"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1252">G</span><span class="MJXp-mo" id="MJXp-Span-1253" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-1254">0</span><span class="MJXp-mo" id="MJXp-Span-1255" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-177">G(0)</script> and provide it with the input <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1256"><span class="MJXp-mn" id="MJXp-Span-1257">0</span></span></span><script type="math/tex" id="MathJax-Element-178">0</script>.</p><p>For a number which is not in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1258"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1259">S</span></span></span><script type="math/tex" id="MathJax-Element-179">S</script>, the Grundy function can be easily computed using the largest value <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1260"><span class="MJXp-msubsup" id="MJXp-Span-1261"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1262" style="margin-right: 0.05em;">s</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1263" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-180">s_i</script> that does not exceed this number. To avoid handling unnecessary cases, we can also explicitly add <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1264"><span class="MJXp-mn" id="MJXp-Span-1265">0</span></span></span><script type="math/tex" id="MathJax-Element-181">0</script> to the set <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1266"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1267">S</span></span></span><script type="math/tex" id="MathJax-Element-182">S</script>.</p><p>When adding/removing a number from <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1268"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1269">S</span></span></span><script type="math/tex" id="MathJax-Element-183">S</script>, at most two leaves in the segment tree need to be changed, so each query is processed in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1270"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1271">O</span><span class="MJXp-mo" id="MJXp-Span-1272" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi" id="MJXp-Span-1273">log</span><span class="MJXp-mo" id="MJXp-Span-1274" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1275">A</span><span class="MJXp-mo" id="MJXp-Span-1276" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-184">O(\log A)</script> time, where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1277"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1278">A</span></span></span><script type="math/tex" id="MathJax-Element-185">A</script> is the maximum number for which we are interested in the Grundy function. Therefore, the entire solution works in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1279"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1280">O</span><span class="MJXp-mo" id="MJXp-Span-1281" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1282">A</span><span class="MJXp-mo" id="MJXp-Span-1283" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1284">q</span><span class="MJXp-mi" id="MJXp-Span-1285">log</span><span class="MJXp-mo" id="MJXp-Span-1286" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1287">A</span><span class="MJXp-mo" id="MJXp-Span-1288" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-186">O(A + q \log A)</script> time.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Solution (BledDest)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.*</span><span class="pln">

data </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Node</span><span class="pun">(</span><span class="kwd">var</span><span class="pln"> x</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">var</span><span class="pln"> a</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">var</span><span class="pln"> b</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln">

fun </span><span class="kwd">get</span><span class="pun">(</span><span class="pln">n</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Node</span><span class="pun">,</span><span class="pln"> x</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">):</span><span class="pln"> </span><span class="typ">Int</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">when</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        n</span><span class="pun">.</span><span class="pln">x </span><span class="pun">==</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pln"> </span><span class="pun">-&gt;</span><span class="pln"> x
        x </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">.</span><span class="pln">x </span><span class="pun">-&gt;</span><span class="pln"> n</span><span class="pun">.</span><span class="pln">a
        </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">-&gt;</span><span class="pln"> n</span><span class="pun">.</span><span class="pln">b
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

fun combine</span><span class="pun">(</span><span class="pln">a</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Node</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Node</span><span class="pun">):</span><span class="pln"> </span><span class="typ">Node</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">when</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        a</span><span class="pun">.</span><span class="pln">x </span><span class="pun">==</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pln"> </span><span class="pun">-&gt;</span><span class="pln"> b
        b</span><span class="pun">.</span><span class="pln">x </span><span class="pun">==</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pln"> </span><span class="pun">-&gt;</span><span class="pln"> a
        </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="typ">Node</span><span class="pun">(</span><span class="pln">a</span><span class="pun">.</span><span class="pln">x</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">get</span><span class="pun">(</span><span class="pln">b</span><span class="pun">,</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">a</span><span class="pun">),</span><span class="pln"> </span><span class="kwd">get</span><span class="pun">(</span><span class="pln">b</span><span class="pun">,</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">b</span><span class="pun">))</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

fun emptyNode</span><span class="pun">():</span><span class="pln"> </span><span class="typ">Node</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Node</span><span class="pun">(-</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

fun fromLength</span><span class="pun">(</span><span class="pln">len</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">):</span><span class="pln"> </span><span class="typ">Node</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">len </span><span class="pun">==</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> emptyNode</span><span class="pun">()</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="typ">Node</span><span class="pun">(</span><span class="pln">len</span><span class="pun">,</span><span class="pln"> len</span><span class="pun">,</span><span class="pln"> len </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">const</span><span class="pln"> val N </span><span class="pun">=</span><span class="pln"> </span><span class="lit">300003</span><span class="pln">
</span><span class="kwd">const</span><span class="pln"> val M </span><span class="pun">=</span><span class="pln"> </span><span class="lit">300001</span><span class="pln">

val S </span><span class="pun">=</span><span class="pln"> sortedSetOf</span><span class="pun">&lt;</span><span class="typ">Int</span><span class="pun">&gt;()</span><span class="pln">
val T </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Array</span><span class="pun">&lt;</span><span class="typ">Node</span><span class="pun">&gt;(</span><span class="lit">4</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> N</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> emptyNode</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

fun recalc</span><span class="pun">(</span><span class="pln">v</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    T</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> combine</span><span class="pun">(</span><span class="pln">T</span><span class="pun">[</span><span class="pln">v </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">],</span><span class="pln"> T</span><span class="pun">[</span><span class="pln">v </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">2</span><span class="pun">])</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

fun build</span><span class="pun">(</span><span class="pln">v</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">,</span><span class="pln"> l</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">,</span><span class="pln"> r</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l </span><span class="pun">==</span><span class="pln"> r </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        T</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> emptyNode</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        val m </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l </span><span class="pun">+</span><span class="pln"> r</span><span class="pun">)</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pln">
        build</span><span class="pun">(</span><span class="pln">v </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> l</span><span class="pun">,</span><span class="pln"> m</span><span class="pun">)</span><span class="pln">
        build</span><span class="pun">(</span><span class="pln">v </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> m</span><span class="pun">,</span><span class="pln"> r</span><span class="pun">)</span><span class="pln">
        recalc</span><span class="pun">(</span><span class="pln">v</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

fun upd</span><span class="pun">(</span><span class="pln">v</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">,</span><span class="pln"> l</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">,</span><span class="pln"> r</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">,</span><span class="pln"> pos</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">,</span><span class="pln"> x</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l </span><span class="pun">==</span><span class="pln"> r </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        T</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> fromLength</span><span class="pun">(</span><span class="pln">x</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        val m </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l </span><span class="pun">+</span><span class="pln"> r</span><span class="pun">)</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">pos </span><span class="pun">&lt;</span><span class="pln"> m</span><span class="pun">)</span><span class="pln"> upd</span><span class="pun">(</span><span class="pln">v </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> l</span><span class="pun">,</span><span class="pln"> m</span><span class="pun">,</span><span class="pln"> pos</span><span class="pun">,</span><span class="pln"> x</span><span class="pun">)</span><span class="pln">
        </span><span class="kwd">else</span><span class="pln"> upd</span><span class="pun">(</span><span class="pln">v </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> m</span><span class="pun">,</span><span class="pln"> r</span><span class="pun">,</span><span class="pln"> pos</span><span class="pun">,</span><span class="pln"> x</span><span class="pun">)</span><span class="pln">
        recalc</span><span class="pun">(</span><span class="pln">v</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

fun </span><span class="kwd">get</span><span class="pun">(</span><span class="pln">v</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">,</span><span class="pln"> l</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">,</span><span class="pln"> r</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">,</span><span class="pln"> L</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">,</span><span class="pln"> R</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">):</span><span class="pln"> </span><span class="typ">Node</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">L </span><span class="pun">&gt;=</span><span class="pln"> R</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> emptyNode</span><span class="pun">()</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">L </span><span class="pun">==</span><span class="pln"> l </span><span class="pun">&amp;&amp;</span><span class="pln"> R </span><span class="pun">==</span><span class="pln"> r</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> T</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]</span><span class="pln">
    val m </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l </span><span class="pun">+</span><span class="pln"> r</span><span class="pun">)</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> combine</span><span class="pun">(</span><span class="kwd">get</span><span class="pun">(</span><span class="pln">v </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> l</span><span class="pun">,</span><span class="pln"> m</span><span class="pun">,</span><span class="pln"> L</span><span class="pun">,</span><span class="pln"> minOf</span><span class="pun">(</span><span class="pln">m</span><span class="pun">,</span><span class="pln"> R</span><span class="pun">)),</span><span class="pln"> </span><span class="kwd">get</span><span class="pun">(</span><span class="pln">v </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> m</span><span class="pun">,</span><span class="pln"> r</span><span class="pun">,</span><span class="pln"> maxOf</span><span class="pun">(</span><span class="pln">L</span><span class="pun">,</span><span class="pln"> m</span><span class="pun">),</span><span class="pln"> R</span><span class="pun">))</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

fun prepare</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    build</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> M</span><span class="pun">)</span><span class="pln">
    upd</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> M</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln">
    S</span><span class="pun">.</span><span class="kwd">add</span><span class="pun">(</span><span class="lit">0</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

fun insertValue</span><span class="pun">(</span><span class="pln">x</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    val it </span><span class="pun">=</span><span class="pln"> S</span><span class="pun">.</span><span class="pln">ceiling</span><span class="pun">(</span><span class="pln">x</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">it </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        upd</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> M</span><span class="pun">,</span><span class="pln"> it</span><span class="pun">,</span><span class="pln"> it </span><span class="pun">-</span><span class="pln"> x</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    S</span><span class="pun">.</span><span class="pln">lower</span><span class="pun">(</span><span class="pln">x</span><span class="pun">)?.</span><span class="kwd">let</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> upd</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> M</span><span class="pun">,</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> x </span><span class="pun">-</span><span class="pln"> it</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    S</span><span class="pun">.</span><span class="kwd">add</span><span class="pun">(</span><span class="pln">x</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

fun eraseValue</span><span class="pun">(</span><span class="pln">x</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    upd</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> M</span><span class="pun">,</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">)</span><span class="pln">
    S</span><span class="pun">.</span><span class="kwd">remove</span><span class="pun">(</span><span class="pln">x</span><span class="pun">)</span><span class="pln">
    val it </span><span class="pun">=</span><span class="pln"> S</span><span class="pun">.</span><span class="pln">ceiling</span><span class="pun">(</span><span class="pln">x</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">it </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        val y </span><span class="pun">=</span><span class="pln"> it
        S</span><span class="pun">.</span><span class="pln">lower</span><span class="pun">(</span><span class="pln">y</span><span class="pun">)?.</span><span class="kwd">let</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> upd</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> M</span><span class="pun">,</span><span class="pln"> y</span><span class="pun">,</span><span class="pln"> y </span><span class="pun">-</span><span class="pln"> it</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

fun getGrundy</span><span class="pun">(</span><span class="pln">x</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">):</span><span class="pln"> </span><span class="typ">Int</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    val n </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">get</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> M</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> x</span><span class="pun">)</span><span class="pln">
    val it </span><span class="pun">=</span><span class="pln"> S</span><span class="pun">.</span><span class="pln">lower</span><span class="pun">(</span><span class="pln">x</span><span class="pun">)</span><span class="pln">
    val y </span><span class="pun">=</span><span class="pln"> it </span><span class="pun">?:</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> x
    val valY </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">get</span><span class="pun">(</span><span class="pln">n</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln">
    val dist </span><span class="pun">=</span><span class="pln"> x </span><span class="pun">-</span><span class="pln"> y
    </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">dist </span><span class="pun">&lt;=</span><span class="pln"> valY</span><span class="pun">)</span><span class="pln"> dist </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> dist
</span><span class="pun">}</span><span class="pln">

fun main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    val q </span><span class="pun">=</span><span class="pln"> readln</span><span class="pun">().</span><span class="pln">toInt</span><span class="pun">()</span><span class="pln">
    
    prepare</span><span class="pun">()</span><span class="pln">
    println</span><span class="pun">((</span><span class="lit">0</span><span class="pln"> </span><span class="kwd">until</span><span class="pln"> q</span><span class="pun">).</span><span class="pln">map </span><span class="pun">{</span><span class="pln">
        val </span><span class="kwd">params</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> readln</span><span class="pun">().</span><span class="pln">split</span><span class="pun">(</span><span class="str">" "</span><span class="pun">).</span><span class="pln">map </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">toInt</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
        val </span><span class="pun">(</span><span class="pln">t</span><span class="pun">,</span><span class="pln"> x</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">params</span><span class="pun">.</span><span class="pln">take</span><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">t </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">S</span><span class="pun">.</span><span class="pln">contains</span><span class="pun">(</span><span class="pln">x</span><span class="pun">))</span><span class="pln"> eraseValue</span><span class="pun">(</span><span class="pln">x</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> insertValue</span><span class="pun">(</span><span class="pln">x</span><span class="pun">)</span><span class="pln">
            </span><span class="kwd">null</span><span class="pln">
        </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            val res </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">params</span><span class="pun">.</span><span class="pln">drop</span><span class="pun">(</span><span class="lit">2</span><span class="pun">).</span><span class="pln">fold</span><span class="pun">(</span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> r</span><span class="pun">,</span><span class="pln"> y </span><span class="pun">-&gt;</span><span class="pln"> r xor getGrundy</span><span class="pun">(</span><span class="pln">y</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">res </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="str">"Second"</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="str">"First"</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}.</span><span class="pln">filterNotNull</span><span class="pun">().</span><span class="pln">joinToString</span><span class="pun">(</span><span class="str">"\n"</span><span class="pun">))</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2087/problem/I" title="Kotlin Heroes: Episode 12">2087I - Hamiltonian Partition</a></p><p>Idea: <a class="rated-user user-red" href="https://codeforces.com/profile/BledDest" title="International Grandmaster BledDest">BledDest</a>, preparation: <a class="rated-user user-red" href="https://codeforces.com/profile/BledDest" title="International Grandmaster BledDest">BledDest</a></p> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2087/problem/I" title="Kotlin Heroes: Episode 12">2087I - Hamiltonian Partition</a></h3><div class="ttypography"><div class="problem-statement"><div><p>Each Hamiltonian cycle will contain some edges from the original graph and some added edges. Let's first understand when a certain set of edges can be part of a Hamiltonian cycle.</p><p>Firstly, there should not be a pair of edges that enter or exit the same vertex. Secondly, there should not be cycles that do not include all vertices. In fact, these two requirements are sufficient — if they are met, all vertices of the graph are divided into separate paths that can be easily glued together into a Hamiltonian cycle.</p><p>This means that the edges of the given graph need to be divided into the minimum number of groups such that each group has at most one incoming/outgoing edge from each vertex, and there are no cycles (except for those which go through all vertices). However, the original graph is acyclic, so the second requirement is actually impossible to violate.</p><p>If we "split" the vertices by creating two parts and replacing each directed edge <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1289"><span class="MJXp-mo" id="MJXp-Span-1290" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1291">x</span><span class="MJXp-mo" id="MJXp-Span-1292" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1293">y</span><span class="MJXp-mo" id="MJXp-Span-1294" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-187">(x,y)</script> with an edge between vertex <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1295"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1296">x</span></span></span><script type="math/tex" id="MathJax-Element-188">x</script> in the left part and vertex <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1297"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1298">y</span></span></span><script type="math/tex" id="MathJax-Element-189">y</script> in the right part, then the requirement of "at most one incoming/outgoing edge from each vertex in each group" transforms into "no vertex is incident to more than one edge". This means that a group is a matching in a bipartite graph.</p><p>Now our task is to divide this bipartite graph into the minimum number of matchings. One might assume that the number of these matchings equals the maximum of the degrees of the vertices, and indeed this is the case, but finding such a division can be very challenging.</p><p>There is a well-known algorithm for coloring the edges of a bipartite graph with the minimum number of colors in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1299"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1300">O</span><span class="MJXp-mo" id="MJXp-Span-1301" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1302"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1303" style="margin-right: 0.05em;">n</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1304" style="vertical-align: 0.5em;">3</span></span><span class="MJXp-mo" id="MJXp-Span-1305" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-190">O(n^3)</script>, which I will describe at the end of this tutorial, but first, I will explain what to do if you do not know this algorithm.</p><p>Let's try to build the division greedily, choosing the maximum matching each time and removing it. However, not every maximum matching will suit us. For example:</p><center> <img class="tex-graphics" src="https://espresso.codeforces.com/e02b7a507a25f316b21b3f274980f672caccdf3c.png" style="max-width: 100.0%;max-height: 100.0%;"> </center><p>If we choose the matching <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1306"><span class="MJXp-mo" id="MJXp-Span-1307" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mo" id="MJXp-Span-1308" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-1309">1</span><span class="MJXp-mo" id="MJXp-Span-1310" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-1311">2</span><span class="MJXp-mo" id="MJXp-Span-1312" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1313" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-1314" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-1315">5</span><span class="MJXp-mo" id="MJXp-Span-1316" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-1317">4</span><span class="MJXp-mo" id="MJXp-Span-1318" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1319" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-191">[(1, 2), (5, 4)]</script> in this graph, the remaining edges will have to be divided into two groups.</p><p>Let's try to work around this problem. I know at least two ways to do this.</p><p><span class="tex-font-style-bf">Solution 1</span></p><p>The first method is as follows: let's try to find a matching that saturates all vertices of maximum degree (so that when it is removed, the maximum degree decreases by <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1320"><span class="MJXp-mn" id="MJXp-Span-1321">1</span></span></span><script type="math/tex" id="MathJax-Element-192">1</script>). This can be done by searching for a flow with a lower bound on some edges. Even if we use the most basic maximum flow algorithm, the solution will work in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1322"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1323">O</span><span class="MJXp-mo" id="MJXp-Span-1324" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1325"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1326" style="margin-right: 0.05em;">n</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1327" style="vertical-align: 0.5em;">4</span></span><span class="MJXp-mo" id="MJXp-Span-1328" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-193">O(n^4)</script>: we will need to find the maximum flow in the network <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1329"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1330">O</span><span class="MJXp-mo" id="MJXp-Span-1331" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1332">n</span><span class="MJXp-mo" id="MJXp-Span-1333" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-194">O(n)</script> times, the flow value is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1334"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1335">O</span><span class="MJXp-mo" id="MJXp-Span-1336" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1337">n</span><span class="MJXp-mo" id="MJXp-Span-1338" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-195">O(n)</script> and the number of edges is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1339"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1340">O</span><span class="MJXp-mo" id="MJXp-Span-1341" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1342"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1343" style="margin-right: 0.05em;">n</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1344" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1345" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-196">O(n^2)</script>. Using Dinic's algorithm, this can be sped up to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1346"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1347">O</span><span class="MJXp-mo" id="MJXp-Span-1348" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1349"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1350" style="margin-right: 0.05em;">n</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1351" style="vertical-align: 0.5em;"><span class="MJXp-mfrac" id="MJXp-Span-1352" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mn" id="MJXp-Span-1353">11</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mn" id="MJXp-Span-1354">3</span></span></span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-1355" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-197">O(n^{\frac{11}{3}})</script>.</p><p>However, this solution requires quite a bit of code, so I will describe an alternative approach.</p><p><span class="tex-font-style-bf">Solution 2</span></p><p>As planned before, we will look for a maximum matching and remove it, but before that, we will transform the graph into a regular bipartite graph (we will add new edges, possibly multiple, so that all vertices' degrees are equal to the maximum).</p><p>In a regular bipartite graph, this greedy approach will actually work: using Hall's theorem, it can be proven that there is always a perfect matching in a regular bipartite graph, and by removing a perfect matching, we reduce the degrees of all vertices (and thus the maximum degree) by <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1356"><span class="MJXp-mn" id="MJXp-Span-1357">1</span></span></span><script type="math/tex" id="MathJax-Element-198">1</script>. This solution will also work in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1358"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1359">O</span><span class="MJXp-mo" id="MJXp-Span-1360" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1361"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1362" style="margin-right: 0.05em;">n</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1363" style="vertical-align: 0.5em;">4</span></span><span class="MJXp-mo" id="MJXp-Span-1364" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-199">O(n^4)</script>.</p><p><span class="tex-font-style-bf">Model solution</span></p><p>Now let's bring up the edge coloring algorithm for a bipartite graph in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1365"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1366">O</span><span class="MJXp-mo" id="MJXp-Span-1367" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1368"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1369" style="margin-right: 0.05em;">n</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1370" style="vertical-align: 0.5em;">3</span></span><span class="MJXp-mo" id="MJXp-Span-1371" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-200">O(n^3)</script> — this is the one used in the model solution. We start with a graph that has no edges and will add them one by one while maintaining a correct coloring. We will store the coloring as a matrix <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1372"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1373">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1374">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1375">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1376">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1377">r</span></span></span><script type="math/tex" id="MathJax-Element-201">color</script> of size <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1378"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1379">n</span><span class="MJXp-mo" id="MJXp-Span-1380" style="margin-left: 0.267em; margin-right: 0.267em;">×</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1381">d</span></span></span><script type="math/tex" id="MathJax-Element-202">n \times d</script>, where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1382"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1383">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1384">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1385">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1386">o</span><span class="MJXp-msubsup" id="MJXp-Span-1387"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1388" style="margin-right: 0.05em;">r</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1389" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1390">i</span><span class="MJXp-mo" id="MJXp-Span-1391">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1392">j</span></span></span></span></span><script type="math/tex" id="MathJax-Element-203">color_{i,j}</script> is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1393"><span class="MJXp-mo" id="MJXp-Span-1394" style="margin-left: 0em; margin-right: 0.111em;">−</span><span class="MJXp-mn" id="MJXp-Span-1395">1</span></span></span><script type="math/tex" id="MathJax-Element-204">-1</script> if vertex <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1396"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1397">i</span></span></span><script type="math/tex" id="MathJax-Element-205">i</script> has no incident edge of color <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1398"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1399">j</span></span></span><script type="math/tex" id="MathJax-Element-206">j</script>, or the index of the other end of such an edge if it exists (<span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1400"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1401">d</span></span></span><script type="math/tex" id="MathJax-Element-207">d</script> is the number of colors we use to color the edges — this is simply the maximum degree of a vertex).</p><p>When we add an edge <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1402"><span class="MJXp-mo" id="MJXp-Span-1403" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1404">a</span><span class="MJXp-mo" id="MJXp-Span-1405" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1406">b</span><span class="MJXp-mo" id="MJXp-Span-1407" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-208">(a,b)</script>, where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1408"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1409">a</span></span></span><script type="math/tex" id="MathJax-Element-209">a</script> is a vertex in the left part and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1410"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1411">b</span></span></span><script type="math/tex" id="MathJax-Element-210">b</script> is a vertex in the right part, let's find a free color (a color in which no edge incident to the vertex is colored) for each of these vertices. Such a color will always be found because the number of edges incident to a vertex does not exceed <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1412"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1413">d</span></span></span><script type="math/tex" id="MathJax-Element-211">d</script>. Let's say we found such a free color <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1414"><span class="MJXp-msubsup" id="MJXp-Span-1415"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1416" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1417" style="vertical-align: -0.4em;">a</span></span></span></span><script type="math/tex" id="MathJax-Element-212">c_a</script> for vertex <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1418"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1419">a</span></span></span><script type="math/tex" id="MathJax-Element-213">a</script>, and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1420"><span class="MJXp-msubsup" id="MJXp-Span-1421"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1422" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1423" style="vertical-align: -0.4em;">b</span></span></span></span><script type="math/tex" id="MathJax-Element-214">c_b</script> for vertex <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1424"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1425">b</span></span></span><script type="math/tex" id="MathJax-Element-215">b</script>.</p><p>If <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1426"><span class="MJXp-msubsup" id="MJXp-Span-1427"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1428" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1429" style="vertical-align: -0.4em;">a</span></span><span class="MJXp-mo" id="MJXp-Span-1430" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-1431"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1432" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1433" style="vertical-align: -0.4em;">b</span></span></span></span><script type="math/tex" id="MathJax-Element-216">c_a = c_b</script>, we can immediately use this color for the edge. Otherwise, let's make color <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1434"><span class="MJXp-msubsup" id="MJXp-Span-1435"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1436" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1437" style="vertical-align: -0.4em;">a</span></span></span></span><script type="math/tex" id="MathJax-Element-217">c_a</script> for vertex <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1438"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1439">b</span></span></span><script type="math/tex" id="MathJax-Element-218">b</script> free.</p><p>Let's consider the edges having one of these two colors. Each vertex is incident to at most two such edges, and vertex <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1440"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1441">b</span></span></span><script type="math/tex" id="MathJax-Element-219">b</script> is incident to at most one such edge (since color <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1442"><span class="MJXp-msubsup" id="MJXp-Span-1443"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1444" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1445" style="vertical-align: -0.4em;">b</span></span></span></span><script type="math/tex" id="MathJax-Element-220">c_b</script> is free for this vertex). This means that vertex <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1446"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1447">b</span></span></span><script type="math/tex" id="MathJax-Element-221">b</script> is the end of a path consisting of such edges, and the colors of the edges on this path alternate.</p><p>What will happen if we recolor all edges of color <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1448"><span class="MJXp-msubsup" id="MJXp-Span-1449"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1450" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1451" style="vertical-align: -0.4em;">a</span></span></span></span><script type="math/tex" id="MathJax-Element-222">c_a</script> on this path to color <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1452"><span class="MJXp-msubsup" id="MJXp-Span-1453"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1454" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1455" style="vertical-align: -0.4em;">b</span></span></span></span><script type="math/tex" id="MathJax-Element-223">c_b</script> and vice versa? For intermediate vertices, nothing will change. For vertex <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1456"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1457">b</span></span></span><script type="math/tex" id="MathJax-Element-224">b</script>, color <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1458"><span class="MJXp-msubsup" id="MJXp-Span-1459"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1460" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1461" style="vertical-align: -0.4em;">a</span></span></span></span><script type="math/tex" id="MathJax-Element-225">c_a</script> will become free, so we can color the added edge with it. The only vertex for which something might change is the other end of this path; let's call it vertex <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1462"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1463">x</span></span></span><script type="math/tex" id="MathJax-Element-226">x</script>. For it, one color was free before, and now another has become free.</p><p>But what if vertex <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1464"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1465">x</span></span></span><script type="math/tex" id="MathJax-Element-227">x</script> is vertex <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1466"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1467">a</span></span></span><script type="math/tex" id="MathJax-Element-228">a</script>, and we changed an edge of color <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1468"><span class="MJXp-msubsup" id="MJXp-Span-1469"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1470" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1471" style="vertical-align: -0.4em;">b</span></span></span></span><script type="math/tex" id="MathJax-Element-229">c_b</script> to an edge of color <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1472"><span class="MJXp-msubsup" id="MJXp-Span-1473"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1474" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1475" style="vertical-align: -0.4em;">a</span></span></span></span><script type="math/tex" id="MathJax-Element-230">c_a</script>, and now we cannot use color <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1476"><span class="MJXp-msubsup" id="MJXp-Span-1477"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1478" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1479" style="vertical-align: -0.4em;">a</span></span></span></span><script type="math/tex" id="MathJax-Element-231">c_a</script> for it? If the graph was not bipartite, this could indeed happen (which is why this algorithm does not always find the optimal edge coloring for arbitrary graphs), but in a bipartite graph, this is impossible. If we consider the path from <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1480"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1481">b</span></span></span><script type="math/tex" id="MathJax-Element-232">b</script> to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1482"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1483">x</span></span></span><script type="math/tex" id="MathJax-Element-233">x</script>, we transition through edges of color <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1484"><span class="MJXp-msubsup" id="MJXp-Span-1485"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1486" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1487" style="vertical-align: -0.4em;">a</span></span></span></span><script type="math/tex" id="MathJax-Element-234">c_a</script> from the right part to the left, and through edges of color <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1488"><span class="MJXp-msubsup" id="MJXp-Span-1489"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1490" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1491" style="vertical-align: -0.4em;">b</span></span></span></span><script type="math/tex" id="MathJax-Element-235">c_b</script> from the left to the right. Since vertex <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1492"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1493">a</span></span></span><script type="math/tex" id="MathJax-Element-236">a</script> is in the left part, we could only reach it through an edge of color <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1494"><span class="MJXp-msubsup" id="MJXp-Span-1495"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1496" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1497" style="vertical-align: -0.4em;">a</span></span></span></span><script type="math/tex" id="MathJax-Element-237">c_a</script>—and for vertex <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1498"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1499">a</span></span></span><script type="math/tex" id="MathJax-Element-238">a</script>, this color is free, so this is impossible.</p><p>This describes the idea of the algorithm. In the implementation, it is not necessary to explicitly search for a path using something like DFS or BFS; we can simply use a while loop that keeps track of which vertex we are at and which color we need to swap for it.</p><p>Each search for such an alternating path works in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1500"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1501">O</span><span class="MJXp-mo" id="MJXp-Span-1502" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1503">n</span><span class="MJXp-mo" id="MJXp-Span-1504" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-239">O(n)</script>, and we run it at most <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1505"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1506">O</span><span class="MJXp-mo" id="MJXp-Span-1507" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1508"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1509" style="margin-right: 0.05em;">n</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1510" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1511" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-240">O(n^2)</script> times, so the solution works in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1512"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1513">O</span><span class="MJXp-mo" id="MJXp-Span-1514" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1515"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1516" style="margin-right: 0.05em;">n</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1517" style="vertical-align: 0.5em;">3</span></span><span class="MJXp-mo" id="MJXp-Span-1518" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-241">O(n^3)</script>.</p><p>In all three solutions, after dividing the edges into groups, we will also need to complete each group into a Hamiltonian cycle, but this remains as an exercise for the reader (this is one of the simplest parts of the problem).</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Solution (BledDest)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="pln">fun main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    val </span><span class="pun">(</span><span class="pln">n</span><span class="pun">,</span><span class="pln"> m</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> readLine</span><span class="pun">()!!.</span><span class="pln">split</span><span class="pun">(</span><span class="str">" "</span><span class="pun">).</span><span class="pln">map </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">toInt</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    val x </span><span class="pun">=</span><span class="pln"> </span><span class="typ">IntArray</span><span class="pun">(</span><span class="pln">m</span><span class="pun">)</span><span class="pln">
    val y </span><span class="pun">=</span><span class="pln"> </span><span class="typ">IntArray</span><span class="pun">(</span><span class="pln">m</span><span class="pun">)</span><span class="pln">
    val edgeId </span><span class="pun">=</span><span class="pln"> mutableMapOf</span><span class="pun">&lt;</span><span class="typ">Pair</span><span class="pun">&lt;</span><span class="typ">Int</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">&gt;,</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">&gt;()</span><span class="pln">
    val inDeg </span><span class="pun">=</span><span class="pln"> </span><span class="typ">IntArray</span><span class="pun">(</span><span class="pln">n</span><span class="pun">)</span><span class="pln">
    val outDeg </span><span class="pun">=</span><span class="pln"> </span><span class="typ">IntArray</span><span class="pun">(</span><span class="pln">n</span><span class="pun">)</span><span class="pln">

    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="kwd">in</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="kwd">until</span><span class="pln"> m</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        val </span><span class="pun">(</span><span class="pln">xi</span><span class="pun">,</span><span class="pln"> yi</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> readLine</span><span class="pun">()!!.</span><span class="pln">split</span><span class="pun">(</span><span class="str">" "</span><span class="pun">).</span><span class="pln">map </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">toInt</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
        x</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> xi </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
        y</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> yi </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
        edgeId</span><span class="pun">[</span><span class="typ">Pair</span><span class="pun">(</span><span class="pln">x</span><span class="pun">[</span><span class="pln">i</span><span class="pun">],</span><span class="pln"> y</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> i
        inDeg</span><span class="pun">[</span><span class="pln">y</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]]++</span><span class="pln">
        outDeg</span><span class="pun">[</span><span class="pln">x</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]]++</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">var</span><span class="pln"> c </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="kwd">in</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="kwd">until</span><span class="pln"> n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        c </span><span class="pun">=</span><span class="pln"> maxOf</span><span class="pun">(</span><span class="pln">c</span><span class="pun">,</span><span class="pln"> inDeg</span><span class="pun">[</span><span class="pln">i</span><span class="pun">],</span><span class="pln"> outDeg</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    val color </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Array</span><span class="pun">(</span><span class="pln">n </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="typ">IntArray</span><span class="pun">(</span><span class="pln">c</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="kwd">in</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="kwd">until</span><span class="pln"> m</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        val a </span><span class="pun">=</span><span class="pln"> x</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln">
        val b </span><span class="pun">=</span><span class="pln"> y</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> n
        </span><span class="kwd">var</span><span class="pln"> ca </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
        </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">color</span><span class="pun">[</span><span class="pln">a</span><span class="pun">][</span><span class="pln">ca</span><span class="pun">]</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> ca</span><span class="pun">++</span><span class="pln">
        </span><span class="kwd">var</span><span class="pln"> cb </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
        </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">color</span><span class="pun">[</span><span class="pln">b</span><span class="pun">][</span><span class="pln">cb</span><span class="pun">]</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> cb</span><span class="pun">++</span><span class="pln">
        color</span><span class="pun">[</span><span class="pln">a</span><span class="pun">][</span><span class="pln">ca</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> b
        color</span><span class="pun">[</span><span class="pln">b</span><span class="pun">][</span><span class="pln">cb</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> a
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">ca </span><span class="pun">!=</span><span class="pln"> cb</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">var</span><span class="pln"> cur </span><span class="pun">=</span><span class="pln"> b
            </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">cur </span><span class="pun">!=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                val temp </span><span class="pun">=</span><span class="pln"> color</span><span class="pun">[</span><span class="pln">cur</span><span class="pun">][</span><span class="pln">cb</span><span class="pun">]</span><span class="pln">
                color</span><span class="pun">[</span><span class="pln">cur</span><span class="pun">][</span><span class="pln">cb</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> color</span><span class="pun">[</span><span class="pln">cur</span><span class="pun">][</span><span class="pln">ca</span><span class="pun">]</span><span class="pln">
                color</span><span class="pun">[</span><span class="pln">cur</span><span class="pun">][</span><span class="pln">ca</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> temp
                cur </span><span class="pun">=</span><span class="pln"> color</span><span class="pun">[</span><span class="pln">cur</span><span class="pun">][</span><span class="pln">cb</span><span class="pun">]</span><span class="pln">
                val tempCa </span><span class="pun">=</span><span class="pln"> ca
                ca </span><span class="pun">=</span><span class="pln"> cb
                cb </span><span class="pun">=</span><span class="pln"> tempCa
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    val ans </span><span class="pun">=</span><span class="pln"> </span><span class="typ">MutableList</span><span class="pun">(</span><span class="pln">m</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="kwd">in</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="kwd">until</span><span class="pln"> n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">j </span><span class="kwd">in</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="kwd">until</span><span class="pln"> c</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">color</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                ans</span><span class="pun">[</span><span class="pln">edgeId</span><span class="pun">[</span><span class="typ">Pair</span><span class="pun">(</span><span class="pln">i</span><span class="pun">,</span><span class="pln"> color</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> n</span><span class="pun">)]!!]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> j
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    val xsAdd </span><span class="pun">=</span><span class="pln"> mutableListOf</span><span class="pun">&lt;</span><span class="typ">Int</span><span class="pun">&gt;()</span><span class="pln">
    val ysAdd </span><span class="pun">=</span><span class="pln"> mutableListOf</span><span class="pun">&lt;</span><span class="typ">Int</span><span class="pun">&gt;()</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> k </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="kwd">in</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="kwd">until</span><span class="pln"> c</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        val nxt </span><span class="pun">=</span><span class="pln"> </span><span class="typ">IntArray</span><span class="pun">(</span><span class="pln">n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
        val pre </span><span class="pun">=</span><span class="pln"> </span><span class="typ">IntArray</span><span class="pun">(</span><span class="pln">n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">j </span><span class="kwd">in</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="kwd">until</span><span class="pln"> m</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">ans</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                nxt</span><span class="pun">[</span><span class="pln">x</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> y</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]</span><span class="pln">
                pre</span><span class="pun">[</span><span class="pln">y</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> x</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        val parts </span><span class="pun">=</span><span class="pln"> mutableListOf</span><span class="pun">&lt;</span><span class="typ">Pair</span><span class="pun">&lt;</span><span class="typ">Int</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">&gt;&gt;()</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">j </span><span class="kwd">in</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="kwd">until</span><span class="pln"> n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">pre</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="kwd">var</span><span class="pln"> l </span><span class="pun">=</span><span class="pln"> j
                </span><span class="kwd">var</span><span class="pln"> r </span><span class="pun">=</span><span class="pln"> j
                </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">nxt</span><span class="pun">[</span><span class="pln">r</span><span class="pun">]</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> r </span><span class="pun">=</span><span class="pln"> nxt</span><span class="pun">[</span><span class="pln">r</span><span class="pun">]</span><span class="pln">
                parts</span><span class="pun">.</span><span class="kwd">add</span><span class="pun">(</span><span class="typ">Pair</span><span class="pun">(</span><span class="pln">l</span><span class="pun">,</span><span class="pln"> r</span><span class="pun">))</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        val p </span><span class="pun">=</span><span class="pln"> parts</span><span class="pun">.</span><span class="pln">size
        k </span><span class="pun">+=</span><span class="pln"> p
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">j </span><span class="kwd">in</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="kwd">until</span><span class="pln"> p</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            xsAdd</span><span class="pun">.</span><span class="kwd">add</span><span class="pun">(</span><span class="pln">parts</span><span class="pun">[</span><span class="pln">j</span><span class="pun">].</span><span class="pln">second</span><span class="pun">)</span><span class="pln">
            ysAdd</span><span class="pun">.</span><span class="kwd">add</span><span class="pun">(</span><span class="pln">parts</span><span class="pun">[(</span><span class="pln">j </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> p</span><span class="pun">].</span><span class="pln">first</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">j </span><span class="kwd">in</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="kwd">until</span><span class="pln"> p</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            ans </span><span class="pun">+=</span><span class="pln"> i
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    println</span><span class="pun">(</span><span class="pln">k</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="kwd">in</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="kwd">until</span><span class="pln"> k</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        println</span><span class="pun">(</span><span class="str">"$$${xsAdd[i] + 1} $$${ysAdd[i] + 1}"</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    println</span><span class="pun">(</span><span class="pln">c</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x </span><span class="kwd">in</span><span class="pln"> ans</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">print</span><span class="pun">(</span><span class="str">"${x + 1} "</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    println</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span></code></pre></div></div></div>

    </div>


        <div style="font-size: 1.1rem;line-height: 1.1rem;padding-bottom: 0.5em;">
            <img src="https://codeforces.com//codeforces.com/codeforces.org/s/62250/images/icons/paperclip-16x16.png" style="vertical-align: middle;"> <span style="padding: 0 0.35em;">Tutorial of <a href="https://codeforces.com/contest/2087" class="notice" style="text-decoration: none;">Kotlin Heroes: Episode 12</a> </span>
        </div>
        
            

  <script>
    // Make all spoilers toggleable
    document.querySelectorAll('.spoiler-title').forEach(title => {
      title.addEventListener('click', function() {
        const spoiler = this.closest('.spoiler');
        spoiler.classList.toggle('open');
      });
    });
    
    // Open all spoilers by default for easier reading
    document.querySelectorAll('.spoiler').forEach(spoiler => {
      spoiler.classList.add('open');
    });
  </script>
</body>
</html>