<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tutorial</title>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
      line-height: 1.6;
      color: #333;
      background: #fafafa;
    }
    .ttypography {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    h3 {
      color: #1a1a1a;
      border-bottom: 2px solid #eee;
      padding-bottom: 10px;
    }
    h3 a {
      color: #0066cc;
      text-decoration: none;
    }
    h3 a:hover {
      text-decoration: underline;
    }
    .spoiler {
      margin: 15px 0;
      border: 1px solid #ddd;
      border-radius: 6px;
      overflow: hidden;
    }
    .spoiler-title {
      display: block;
      padding: 12px 15px;
      background: #f0f0f0;
      cursor: pointer;
      font-weight: 600;
      user-select: none;
      border-bottom: 1px solid #ddd;
    }
    .spoiler-title:hover {
      background: #e8e8e8;
    }
    .spoiler-title::before {
      content: '▶ ';
      font-size: 0.8em;
      transition: transform 0.2s;
      display: inline-block;
    }
    .spoiler.open .spoiler-title::before {
      content: '▼ ';
    }
    .spoiler-content {
      padding: 15px;
      background: #fff;
      display: none;
    }
    .spoiler.open .spoiler-content {
      display: block;
    }
    pre, code {
      background: #f5f5f5;
      font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
      font-size: 0.85em;
    }
    pre {
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
    }
    code {
      padding: 2px 5px;
      border-radius: 3px;
    }
    p {
      margin: 10px 0;
    }
    .MathJax {
      font-size: 1.1em;
    }
  </style>
</head>
<body>
  <h1>Editorial</h1>
  <p><a href="https://codeforces.com/blog/entry/148782" target="_blank">View on Codeforces →</a></p>
  
  <div class="ttypography"><p><a href="https://codeforces.com/contest/2158/problem/A" title="Codeforces Round 1067 (Div. 2)">2158A - Suspension</a> Idea &amp; Solution: <a class="rated-user user-orange" href="https://codeforces.com/profile/kingmessi" title="Master kingmessi">kingmessi</a></p> <div class="spoiler"><b class="spoiler-title">Hint 1</b><div class="spoiler-content" style="display: block;"><p>Each red card immediately suspends a player. What is the best way to use <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.436em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.44em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2"><span class="mi" id="MathJax-Span-3" style="font-family: MathJax_Math-italic;">r</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>r</mi></math></span></span><script type="math/tex" id="MathJax-Element-1">r</script> red cards to maximize the number of distinct suspended players?</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 2</b><div class="spoiler-content" style="display: block;"><p>A player is suspended after receiving 2 yellow cards. With <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-2-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-4" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.49em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-5"><span class="mi" id="MathJax-Span-6" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>y</mi></math></span></span><script type="math/tex" id="MathJax-Element-2">y</script> yellow cards, what is the maximum number of players you can suspend using only yellows?</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 3</b><div class="spoiler-content" style="display: block;"><p>If you add the maximum suspensions from red cards and yellow cards, can this total ever exceed <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-3-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-7" style="width: 0.814em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.6em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-8"><span class="mi" id="MathJax-Span-9" style="font-family: MathJax_Math-italic;">n</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi></math></span></span><script type="math/tex" id="MathJax-Element-3">n</script>? What should happen with extra cards in that case?</p></div></div> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2158/problem/A" title="Codeforces Round 1067 (Div. 2)">2158A - Suspension</a></h3><div class="ttypography"><div class="problem-statement"><div><p>To determine the maximum number of players suspended, we adopt a greedy approach. The goal is to distribute the available cards to trigger the suspension condition for as many distinct players as possible.</p><ul> <li> <span class="tex-font-style-bf">Red Cards:</span> Since a single red card causes an immediate suspension, the most efficient use is to assign each red card to a unique player. Therefore, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-155"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-156">r</span></span></span><script type="math/tex" id="MathJax-Element-42">r</script> red cards can suspend exactly <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-157"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-158">r</span></span></span><script type="math/tex" id="MathJax-Element-43">r</script> players. </li><li> <span class="tex-font-style-bf">Yellow Cards:</span> A player requires <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-159"><span class="MJXp-mn" id="MJXp-Span-160">2</span></span></span><script type="math/tex" id="MathJax-Element-44">2</script> yellow cards to be suspended. To maximize the number of suspensions derived from yellow cards, we group them into pairs. The number of players that can be suspended using yellow cards is the integer division of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-161"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-162">y</span></span></span><script type="math/tex" id="MathJax-Element-45">y</script> by 2, denoted as <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-163"><span class="MJXp-mo" id="MJXp-Span-164" style="margin-left: 0em; margin-right: 0em;">⌊</span><span class="MJXp-mfrac" id="MJXp-Span-165" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-166">y</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mn" id="MJXp-Span-167">2</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-168" style="margin-left: 0em; margin-right: 0em;">⌋</span></span></span><script type="math/tex" id="MathJax-Element-46">\lfloor \frac{y}{2} \rfloor</script>. </li></ul><p>Combining these two, the total potential number of suspensions is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-169"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-170">r</span><span class="MJXp-mo" id="MJXp-Span-171" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mo" id="MJXp-Span-172" style="margin-left: 0em; margin-right: 0em;">⌊</span><span class="MJXp-mfrac" id="MJXp-Span-173" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-174">y</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mn" id="MJXp-Span-175">2</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-176" style="margin-left: 0em; margin-right: 0em;">⌋</span></span></span><script type="math/tex" id="MathJax-Element-47">r + \lfloor \frac{y}{2} \rfloor</script>. However, it is impossible to suspend more players than the total number of players <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-177"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-178">n</span></span></span><script type="math/tex" id="MathJax-Element-48">n</script> present in the game. If the theoretical sum is greater than <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-179"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-180">n</span></span></span><script type="math/tex" id="MathJax-Element-49">n</script>, the surplus cards can simply be distributed to players who are already being suspended (e.g., giving a yellow card to a player before they receive a red), effectively wasting the extra cards. Thus, the answer is constrained by <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-181"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-182">n</span></span></span><script type="math/tex" id="MathJax-Element-50">n</script>. Hence, the final answer is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-183"><span class="MJXp-mo" id="MJXp-Span-184" style="margin-left: 0.333em; margin-right: 0.333em;">min</span><span class="MJXp-mrow" id="MJXp-Span-185"><span class="MJXp-mo" id="MJXp-Span-186" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.5em;"><span class="MJXp-right MJXp-scale5" style="font-size: 3em; margin-left: -0.13em;">(</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-187">n</span><span class="MJXp-mo" id="MJXp-Span-188" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mtext" id="MJXp-Span-189">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-190">r</span><span class="MJXp-mo" id="MJXp-Span-191" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mrow" id="MJXp-Span-192"><span class="MJXp-mo" id="MJXp-Span-193" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.5em;"><span class="MJXp-right MJXp-scale5" style="font-size: 3em; margin-left: -0.18em;">⌊</span></span><span class="MJXp-mfrac" id="MJXp-Span-194" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-195">y</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mn" id="MJXp-Span-196">2</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-197" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.5em;"><span class="MJXp-right MJXp-scale5" style="font-size: 3em; margin-left: -0.18em;">⌋</span></span></span><span class="MJXp-mo" id="MJXp-Span-198" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.5em;"><span class="MJXp-right MJXp-scale5" style="font-size: 3em; margin-left: -0.13em;">)</span></span></span></span></span><script type="math/tex" id="MathJax-Element-51">\min\left(n, \ r + \left\lfloor \frac{y}{2} \right\rfloor\right)</script>.</p><p><span class="tex-font-style-bf">Time Complexity:</span> <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-199"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-200">O</span><span class="MJXp-mo" id="MJXp-Span-201" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-202">1</span><span class="MJXp-mo" id="MJXp-Span-203" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-52">O(1)</script> per test case.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">void</span><span class="pln"> solve</span><span class="pun">(){</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">,</span><span class="pln">y</span><span class="pun">,</span><span class="pln">r</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> y </span><span class="pun">&gt;&gt;</span><span class="pln"> r</span><span class="pun">;</span><span class="pln">
    cout </span><span class="pun">&lt;&lt;</span><span class="pln"> min</span><span class="pun">(</span><span class="pln">n</span><span class="pun">,</span><span class="pln">r</span><span class="pun">+</span><span class="pln">y</span><span class="pun">/</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"\n"</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">(){</span><span class="pln">
    ios_base</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    cout</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pun">(</span><span class="pln">t</span><span class="pun">--){</span><span class="pln">
        solve</span><span class="pun">();</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div> <div class="spoiler"><b class="spoiler-title">Bonus</b><div class="spoiler-content" style="display: block;"><p>How do you calculate the <strong>minimum</strong> number of players suspended from the game possible?</p></div></div><p><a href="https://codeforces.com/contest/2158/problem/B" title="Codeforces Round 1067 (Div. 2)">2158B - Split</a> Idea &amp; Solution: <a class="rated-user user-orange" href="https://codeforces.com/profile/kingmessi" title="Master kingmessi">kingmessi</a></p> <div class="spoiler"><b class="spoiler-title">Hint 1</b><div class="spoiler-content" style="display: block;"><p>Does the contribution of an element depend on its exact split <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-4-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-10" style="width: 3.033em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.275em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1002.17em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-11"><span class="mo" id="MathJax-Span-12" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-13" style="font-family: MathJax_Math-italic;">u</span><span class="mo" id="MathJax-Span-14" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-15" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">v</span><span class="mo" id="MathJax-Span-16" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mi>u</mi><mo>,</mo><mi>v</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-4">(u, v)</script>, or only on whether <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-5-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-17" style="width: 0.814em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.6em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-18"><span class="mi" id="MathJax-Span-19" style="font-family: MathJax_Math-italic;">u</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>u</mi></math></span></span><script type="math/tex" id="MathJax-Element-5">u</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-6-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-20" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.49em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-21"><span class="mi" id="MathJax-Span-22" style="font-family: MathJax_Math-italic;">v</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>v</mi></math></span></span><script type="math/tex" id="MathJax-Element-6">v</script> are <strong>odd</strong> or <strong>even</strong>?</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 2</b><div class="spoiler-content" style="display: block;"><p>If every distinct element contributed its maximum possible amount, what would be the upper bound of the answer?</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 3</b><div class="spoiler-content" style="display: block;"><p>Elements with frequency of the form <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-7-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;4&lt;/mn&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-23" style="width: 3.682em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.762em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1002.71em, 2.438em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-24"><span class="mn" id="MathJax-Span-25" style="font-family: MathJax_Main;">4</span><span class="mi" id="MathJax-Span-26" style="font-family: MathJax_Math-italic;">k</span><span class="mo" id="MathJax-Span-27" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-28" style="font-family: MathJax_Main; padding-left: 0.219em;">2</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.211em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>4</mn><mi>k</mi><mo>+</mo><mn>2</mn></math></span></span><script type="math/tex" id="MathJax-Element-7">4k+2</script> can be split as <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-8-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mspace width=&quot;thinmathspace&quot; /&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-29" style="width: 9.094em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.875em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1006.77em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-30"><span class="mo" id="MathJax-Span-31" style="font-family: MathJax_Main;">(</span><span class="mn" id="MathJax-Span-32" style="font-family: MathJax_Main;">2</span><span class="mi" id="MathJax-Span-33" style="font-family: MathJax_Math-italic;">k</span><span class="mo" id="MathJax-Span-34" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-35" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-36" style="font-family: MathJax_Main;">,</span><span class="mspace" id="MathJax-Span-37" style="height: 0em; vertical-align: 0em; width: 0.165em; display: inline-block; overflow: hidden;"></span><span class="mn" id="MathJax-Span-38" style="font-family: MathJax_Main; padding-left: 0.165em;">2</span><span class="mi" id="MathJax-Span-39" style="font-family: MathJax_Math-italic;">k</span><span class="mo" id="MathJax-Span-40" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-41" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-42" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mn>2</mn><mi>k</mi><mo>+</mo><mn>1</mn><mo>,</mo><mspace width="thinmathspace"></mspace><mn>2</mn><mi>k</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-8">(2k+1,\,2k+1)</script>, creating <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-9-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-43" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-44"><span class="mn" id="MathJax-Span-45" style="font-family: MathJax_Main;">0</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>0</mn></math></span></span><script type="math/tex" id="MathJax-Element-9">0</script> size imbalance. Elements with frequency of the form <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-10-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;4&lt;/mn&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-46" style="width: 1.356em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1001.03em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-47"><span class="mn" id="MathJax-Span-48" style="font-family: MathJax_Main;">4</span><span class="mi" id="MathJax-Span-49" style="font-family: MathJax_Math-italic;">k</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>4</mn><mi>k</mi></math></span></span><script type="math/tex" id="MathJax-Element-10">4k</script> can be split as <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-11-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mspace width=&quot;thinmathspace&quot; /&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-50" style="width: 9.094em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.875em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1006.77em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-51"><span class="mo" id="MathJax-Span-52" style="font-family: MathJax_Main;">(</span><span class="mn" id="MathJax-Span-53" style="font-family: MathJax_Main;">2</span><span class="mi" id="MathJax-Span-54" style="font-family: MathJax_Math-italic;">k</span><span class="mo" id="MathJax-Span-55" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mn" id="MathJax-Span-56" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-57" style="font-family: MathJax_Main;">,</span><span class="mspace" id="MathJax-Span-58" style="height: 0em; vertical-align: 0em; width: 0.165em; display: inline-block; overflow: hidden;"></span><span class="mn" id="MathJax-Span-59" style="font-family: MathJax_Main; padding-left: 0.165em;">2</span><span class="mi" id="MathJax-Span-60" style="font-family: MathJax_Math-italic;">k</span><span class="mo" id="MathJax-Span-61" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-62" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-63" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mn>2</mn><mi>k</mi><mo>−</mo><mn>1</mn><mo>,</mo><mspace width="thinmathspace"></mspace><mn>2</mn><mi>k</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-11">(2k-1,\,2k+1)</script>, creating <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-12-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-64" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1000.44em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-65"><span class="mn" id="MathJax-Span-66" style="font-family: MathJax_Main;">2</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>2</mn></math></span></span><script type="math/tex" id="MathJax-Element-12">2</script> size imbalance.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 4</b><div class="spoiler-content" style="display: block;"><p>The number of elements with odd total frequency is always even. How can these elements help correct any size imbalance?</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 5</b><div class="spoiler-content" style="display: block;"><p>In which situation does the size imbalance become impossible to fix, making the upper bound unreachable?</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 6</b><div class="spoiler-content" style="display: block;"><p>Consider the case when the number of distinct elements with frequency of the form <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-13-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;4&lt;/mn&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-67" style="width: 1.356em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1001.03em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-68"><span class="mn" id="MathJax-Span-69" style="font-family: MathJax_Main;">4</span><span class="mi" id="MathJax-Span-70" style="font-family: MathJax_Math-italic;">k</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>4</mn><mi>k</mi></math></span></span><script type="math/tex" id="MathJax-Element-13">4k</script> is <strong>odd</strong>. What happens if there exists <strong>at least one</strong> element with odd frequency? What happens if there are <strong>no</strong> elements with odd frequency?</p></div></div> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2158/problem/B" title="Codeforces Round 1067 (Div. 2)">2158B - Split</a></h3><div class="ttypography"><div class="problem-statement"><div><p>Given a subsequence of size <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-204"><span class="MJXp-mn" id="MJXp-Span-205">2</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-206">n</span></span></span><script type="math/tex" id="MathJax-Element-53">2n</script>, we must split it into two subsequences <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-207"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-208">p</span></span></span><script type="math/tex" id="MathJax-Element-54">p</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-209"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-210">q</span></span></span><script type="math/tex" id="MathJax-Element-55">q</script> of size <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-211"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-212">n</span></span></span><script type="math/tex" id="MathJax-Element-56">n</script> each. For any value with total frequency <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-213"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-214">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-215">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-216">t</span></span></span><script type="math/tex" id="MathJax-Element-57">cnt</script>, let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-217"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-218">u</span></span></span><script type="math/tex" id="MathJax-Element-58">u</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-219"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-220">v</span></span></span><script type="math/tex" id="MathJax-Element-59">v</script> be its occurrences in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-221"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-222">p</span></span></span><script type="math/tex" id="MathJax-Element-60">p</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-223"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-224">q</span></span></span><script type="math/tex" id="MathJax-Element-61">q</script>, respectively, with <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-225"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-226">u</span><span class="MJXp-mo" id="MJXp-Span-227" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-228">v</span><span class="MJXp-mo" id="MJXp-Span-229" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-230">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-231">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-232">t</span></span></span><script type="math/tex" id="MathJax-Element-62">u+v=cnt</script>. The contribution of this value is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-233"><span class="MJXp-mo" id="MJXp-Span-234" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-235">u</span><span class="MJXp-mo" id="MJXp-Span-236" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mn" id="MJXp-Span-237">2</span><span class="MJXp-mo" id="MJXp-Span-238" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-239" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mo" id="MJXp-Span-240" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-241">v</span><span class="MJXp-mo" id="MJXp-Span-242" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mn" id="MJXp-Span-243">2</span><span class="MJXp-mo" id="MJXp-Span-244" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-245" style="margin-left: 0em; margin-right: 0.222em;">,</span></span></span><script type="math/tex; mode=display" id="MathJax-Element-63"> (u \bmod 2) + (v \bmod 2), </script> so it can be <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-246"><span class="MJXp-mn" id="MJXp-Span-247">0</span></span></span><script type="math/tex" id="MathJax-Element-64">0</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-248"><span class="MJXp-mn" id="MJXp-Span-249">1</span></span></span><script type="math/tex" id="MathJax-Element-65">1</script>, or <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-250"><span class="MJXp-mn" id="MJXp-Span-251">2</span></span></span><script type="math/tex" id="MathJax-Element-66">2</script>.</p><p>Classify the distinct values as follows: <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-252"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-253">x</span><span class="MJXp-mo" id="MJXp-Span-254" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi" id="MJXp-Span-255">#</span><span class="MJXp-mo" id="MJXp-Span-256" style="margin-left: 0em; margin-right: 0em;">{</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-257">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-258">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-259">t</span><span class="MJXp-mtext" id="MJXp-Span-260">&nbsp;odd</span><span class="MJXp-mo" id="MJXp-Span-261" style="margin-left: 0em; margin-right: 0em;">}</span><span class="MJXp-mo" id="MJXp-Span-262" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mspace" id="MJXp-Span-263" style="width: 2em; height: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-264">y</span><span class="MJXp-mo" id="MJXp-Span-265" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi" id="MJXp-Span-266">#</span><span class="MJXp-mo" id="MJXp-Span-267" style="margin-left: 0em; margin-right: 0em;">{</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-268">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-269">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-270">t</span><span class="MJXp-mo" id="MJXp-Span-271" style="margin-left: 0.333em; margin-right: 0.333em;">≡</span><span class="MJXp-mn" id="MJXp-Span-272">2</span><span class="MJXp-mtext" id="MJXp-Span-273">&nbsp;</span><span class="MJXp-mo" id="MJXp-Span-274" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mtext" id="MJXp-Span-275">mod&nbsp;</span><span class="MJXp-mn" id="MJXp-Span-276">4</span><span class="MJXp-mo" id="MJXp-Span-277" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-278" style="margin-left: 0em; margin-right: 0em;">}</span><span class="MJXp-mo" id="MJXp-Span-279" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mspace" id="MJXp-Span-280" style="width: 2em; height: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-281">z</span><span class="MJXp-mo" id="MJXp-Span-282" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi" id="MJXp-Span-283">#</span><span class="MJXp-mo" id="MJXp-Span-284" style="margin-left: 0em; margin-right: 0em;">{</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-285">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-286">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-287">t</span><span class="MJXp-mo" id="MJXp-Span-288" style="margin-left: 0.333em; margin-right: 0.333em;">≡</span><span class="MJXp-mn" id="MJXp-Span-289">0</span><span class="MJXp-mtext" id="MJXp-Span-290">&nbsp;</span><span class="MJXp-mo" id="MJXp-Span-291" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mtext" id="MJXp-Span-292">mod&nbsp;</span><span class="MJXp-mn" id="MJXp-Span-293">4</span><span class="MJXp-mo" id="MJXp-Span-294" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-295" style="margin-left: 0em; margin-right: 0em;">}</span><span class="MJXp-mo" id="MJXp-Span-296" style="margin-left: 0em; margin-right: 0.222em;">.</span></span></span><script type="math/tex; mode=display" id="MathJax-Element-67"> x = \#\{cnt \text{ odd}\}, \qquad y = \#\{cnt \equiv 2 \ (\text{mod }4)\}, \qquad z = \#\{cnt \equiv 0 \ (\text{mod }4)\}. </script></p><p>The theoretical maximum possible score is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-297"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-298">x</span><span class="MJXp-mo" id="MJXp-Span-299" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-300">2</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-301">y</span><span class="MJXp-mo" id="MJXp-Span-302" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-303">2</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-304">z</span><span class="MJXp-mo" id="MJXp-Span-305" style="margin-left: 0em; margin-right: 0.222em;">.</span></span></span><script type="math/tex; mode=display" id="MathJax-Element-68"> x + 2y + 2z. </script></p><p>For values with odd <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-306"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-307">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-308">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-309">t</span></span></span><script type="math/tex" id="MathJax-Element-69">cnt</script>, exactly one of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-310"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-311">u</span></span></span><script type="math/tex" id="MathJax-Element-70">u</script> or <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-312"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-313">v</span></span></span><script type="math/tex" id="MathJax-Element-71">v</script> must be odd, so the contribution is always <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-314"><span class="MJXp-mn" id="MJXp-Span-315">1</span></span></span><script type="math/tex" id="MathJax-Element-72">1</script>. For <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-316"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-317">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-318">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-319">t</span><span class="MJXp-mo" id="MJXp-Span-320" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-321">4</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-322">k</span><span class="MJXp-mo" id="MJXp-Span-323" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-324">2</span></span></span><script type="math/tex" id="MathJax-Element-73">cnt = 4k+2</script>, choosing <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-325"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-326">u</span><span class="MJXp-mo" id="MJXp-Span-327" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-328">v</span><span class="MJXp-mo" id="MJXp-Span-329" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-330">2</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-331">k</span><span class="MJXp-mo" id="MJXp-Span-332" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-333">1</span></span></span><script type="math/tex" id="MathJax-Element-74">u = v = 2k+1</script> gives contribution <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-334"><span class="MJXp-mn" id="MJXp-Span-335">2</span></span></span><script type="math/tex" id="MathJax-Element-75">2</script> and keeps the sizes balanced. For <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-336"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-337">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-338">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-339">t</span><span class="MJXp-mo" id="MJXp-Span-340" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-341">4</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-342">k</span></span></span><script type="math/tex" id="MathJax-Element-76">cnt = 4k</script>, one of the splits with contribution <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-343"><span class="MJXp-mn" id="MJXp-Span-344">2</span></span></span><script type="math/tex" id="MathJax-Element-77">2</script> is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-345"><span class="MJXp-mo" id="MJXp-Span-346" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-347">u</span><span class="MJXp-mo" id="MJXp-Span-348" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-349">v</span><span class="MJXp-mo" id="MJXp-Span-350" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-351" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-352" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-353">2</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-354">k</span><span class="MJXp-mo" id="MJXp-Span-355" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-356">1</span><span class="MJXp-mo" id="MJXp-Span-357" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mspace" id="MJXp-Span-358" style="width: 0.167em; height: 0em;"></span><span class="MJXp-mn" id="MJXp-Span-359">2</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-360">k</span><span class="MJXp-mo" id="MJXp-Span-361" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-362">1</span><span class="MJXp-mo" id="MJXp-Span-363" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-78">(u,v) = (2k+1,\,2k-1)</script>, which creates a size imbalance of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-364"><span class="MJXp-mo" id="MJXp-Span-365" style="margin-left: 0em; margin-right: 0.111em;">±</span><span class="MJXp-mn" id="MJXp-Span-366">2</span></span></span><script type="math/tex" id="MathJax-Element-79">\pm 2</script>.</p><p>If <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-367"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-368">z</span></span></span><script type="math/tex" id="MathJax-Element-80">z</script> is even, these imbalances cancel. If <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-369"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-370">x</span><span class="MJXp-mo" id="MJXp-Span-371" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-mn" id="MJXp-Span-372">0</span></span></span><script type="math/tex" id="MathJax-Element-81">x>0</script>, we can fix any remaining imbalance using one odd-frequency value — without affecting the score. Thus, whenever <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-373"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-374">x</span><span class="MJXp-mo" id="MJXp-Span-375" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-mn" id="MJXp-Span-376">0</span></span></span><script type="math/tex" id="MathJax-Element-82">x>0</script> or <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-377"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-378">z</span></span></span><script type="math/tex" id="MathJax-Element-83">z</script> is even, the theoretical maximum is achievable: <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-379"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-380">x</span><span class="MJXp-mo" id="MJXp-Span-381" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-382">2</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-383">y</span><span class="MJXp-mo" id="MJXp-Span-384" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-385">2</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-386">z</span><span class="MJXp-mo" id="MJXp-Span-387" style="margin-left: 0em; margin-right: 0.222em;">.</span></span></span><script type="math/tex; mode=display" id="MathJax-Element-84"> x + 2y + 2z. </script></p><p>Now consider the case <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-388"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-389">x</span><span class="MJXp-mo" id="MJXp-Span-390" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-391">0</span></span></span><script type="math/tex" id="MathJax-Element-85">x=0</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-392"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-393">z</span></span></span><script type="math/tex" id="MathJax-Element-86">z</script> odd. All frequencies are even. To get contribution <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-394"><span class="MJXp-mn" id="MJXp-Span-395">2</span></span></span><script type="math/tex" id="MathJax-Element-87">2</script> from a value with <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-396"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-397">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-398">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-399">t</span><span class="MJXp-mo" id="MJXp-Span-400" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-401">4</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-402">k</span><span class="MJXp-mo" id="MJXp-Span-403" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-404">2</span></span></span><script type="math/tex" id="MathJax-Element-88">cnt = 4k+2</script>, the odd split gives size difference <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-405"><span class="MJXp-mn" id="MJXp-Span-406">0</span><span class="MJXp-TeXmathchoice" id="MJXp-Span-407"><span class="MJXp-mspace" id="MJXp-Span-408" style="width: 0.444em; height: 0em;"></span></span><span class="MJXp-mo" id="MJXp-Span-409" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi" id="MJXp-Span-410">mod</span><span class="MJXp-mspace" id="MJXp-Span-411" style="width: 0.333em; height: 0em;"></span><span class="MJXp-mn" id="MJXp-Span-412">4</span><span class="MJXp-mo" id="MJXp-Span-413" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-89">0 \pmod{4}</script>. For <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-414"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-415">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-416">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-417">t</span><span class="MJXp-mo" id="MJXp-Span-418" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-419">4</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-420">k</span></span></span><script type="math/tex" id="MathJax-Element-90">cnt = 4k</script>, any odd split gives size difference <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-421"><span class="MJXp-mn" id="MJXp-Span-422">2</span><span class="MJXp-TeXmathchoice" id="MJXp-Span-423"><span class="MJXp-mspace" id="MJXp-Span-424" style="width: 0.444em; height: 0em;"></span></span><span class="MJXp-mo" id="MJXp-Span-425" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi" id="MJXp-Span-426">mod</span><span class="MJXp-mspace" id="MJXp-Span-427" style="width: 0.333em; height: 0em;"></span><span class="MJXp-mn" id="MJXp-Span-428">4</span><span class="MJXp-mo" id="MJXp-Span-429" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-91">2 \pmod{4}</script>. Summing these over all values: <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-430"><span class="MJXp-munderover" id="MJXp-Span-431"><span class=""><span class="MJXp-mo" id="MJXp-Span-432" style="margin-left: 0.111em; margin-right: 0.167em;"><span class="MJXp-largeop">∑</span></span></span><span class=" MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-433" style="margin-left: 0px;">i</span></span></span><span class="MJXp-mo" id="MJXp-Span-434" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-435"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-436" style="margin-right: 0.05em;">u</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-437" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-438" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-439"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-440" style="margin-right: 0.05em;">v</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-441" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-442" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-443" style="margin-left: 0.333em; margin-right: 0.333em;">≡</span><span class="MJXp-mn" id="MJXp-Span-444">2</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-445">z</span><span class="MJXp-TeXmathchoice" id="MJXp-Span-446"><span class="MJXp-mspace" id="MJXp-Span-447" style="width: 1em; height: 0em;"></span></span><span class="MJXp-mo" id="MJXp-Span-448" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi" id="MJXp-Span-449">mod</span><span class="MJXp-mspace" id="MJXp-Span-450" style="width: 0.333em; height: 0em;"></span><span class="MJXp-mn" id="MJXp-Span-451">4</span><span class="MJXp-mo" id="MJXp-Span-452" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-453" style="margin-left: 0em; margin-right: 0.222em;">.</span></span></span><script type="math/tex; mode=display" id="MathJax-Element-92"> \sum_i (u_i - v_i) \equiv 2z \pmod{4}. </script> Since <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-454"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-455">z</span></span></span><script type="math/tex" id="MathJax-Element-93">z</script> is odd, this is congruent to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-456"><span class="MJXp-mn" id="MJXp-Span-457">2</span></span></span><script type="math/tex" id="MathJax-Element-94">2</script>, contradicting <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-458"><span class="MJXp-mrow" id="MJXp-Span-459"><span class="MJXp-mo" id="MJXp-Span-460" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-461">p</span><span class="MJXp-mrow" id="MJXp-Span-462"><span class="MJXp-mo" id="MJXp-Span-463" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mo" id="MJXp-Span-464" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mrow" id="MJXp-Span-465"><span class="MJXp-mo" id="MJXp-Span-466" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-467">q</span><span class="MJXp-mrow" id="MJXp-Span-468"><span class="MJXp-mo" id="MJXp-Span-469" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span></span></span><script type="math/tex" id="MathJax-Element-95">|p| = |q|</script>. Thus one value must contribute <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-470"><span class="MJXp-mn" id="MJXp-Span-471">0</span></span></span><script type="math/tex" id="MathJax-Element-96">0</script> instead of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-472"><span class="MJXp-mn" id="MJXp-Span-473">2</span></span></span><script type="math/tex" id="MathJax-Element-97">2</script>, reducing the total by <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-474"><span class="MJXp-mn" id="MJXp-Span-475">2</span></span></span><script type="math/tex" id="MathJax-Element-98">2</script>.</p><p>Therefore, when <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-476"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-477">x</span><span class="MJXp-mo" id="MJXp-Span-478" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-479">0</span></span></span><script type="math/tex" id="MathJax-Element-99">x=0</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-480"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-481">z</span></span></span><script type="math/tex" id="MathJax-Element-100">z</script> odd, the maximum score is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-482"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-483">x</span><span class="MJXp-mo" id="MJXp-Span-484" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-485">2</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-486">y</span><span class="MJXp-mo" id="MJXp-Span-487" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-488">2</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-489">z</span><span class="MJXp-mo" id="MJXp-Span-490" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-491">2.</span></span></span><script type="math/tex; mode=display" id="MathJax-Element-101"> x + 2y + 2z - 2. </script></p><p>Hence the final answer is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-492"><span class="MJXp-mrow" id="MJXp-Span-493"><span class="MJXp-mo" id="MJXp-Span-494" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.639em;"><span class="MJXp-right MJXp-scale4" style="font-size: 3.556em; margin-left: -0.278em;">{</span></span><span class="MJXp-mtable" id="MJXp-Span-495"><span><span class="MJXp-mtr" id="MJXp-Span-496" style="vertical-align: baseline;"><span class="MJXp-mtd" id="MJXp-Span-497" style="text-align: left;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-498">x</span><span class="MJXp-mo" id="MJXp-Span-499" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-500">2</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-501">y</span><span class="MJXp-mo" id="MJXp-Span-502" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-503">2</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-504">z</span><span class="MJXp-mo" id="MJXp-Span-505" style="margin-left: 0em; margin-right: 0.222em;">,</span></span><span class="MJXp-mtd" id="MJXp-Span-506" style="padding-left: 1em; text-align: left;"><span class="MJXp-mtext" id="MJXp-Span-507">if&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-508">x</span><span class="MJXp-mo" id="MJXp-Span-509" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-mn" id="MJXp-Span-510">0</span><span class="MJXp-mtext" id="MJXp-Span-511">&nbsp;or&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-512">z</span><span class="MJXp-mtext" id="MJXp-Span-513">&nbsp;is even</span><span class="MJXp-mo" id="MJXp-Span-514" style="margin-left: 0em; margin-right: 0.222em;">,</span></span></span><span class="MJXp-mtr" id="MJXp-Span-515" style="vertical-align: baseline;"><span class="MJXp-mtd" id="MJXp-Span-516" style="padding-top: 0.8em; text-align: left;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-517">x</span><span class="MJXp-mo" id="MJXp-Span-518" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-519">2</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-520">y</span><span class="MJXp-mo" id="MJXp-Span-521" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-522">2</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-523">z</span><span class="MJXp-mo" id="MJXp-Span-524" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-525">2</span><span class="MJXp-mo" id="MJXp-Span-526" style="margin-left: 0em; margin-right: 0.222em;">,</span></span><span class="MJXp-mtd" id="MJXp-Span-527" style="padding-left: 1em; padding-top: 0.8em; text-align: left;"><span class="MJXp-mtext" id="MJXp-Span-528">if&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-529">x</span><span class="MJXp-mo" id="MJXp-Span-530" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-531">0</span><span class="MJXp-mtext" id="MJXp-Span-532">&nbsp;and&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-533">z</span><span class="MJXp-mtext" id="MJXp-Span-534">&nbsp;is odd</span><span class="MJXp-mo" id="MJXp-Span-535" style="margin-left: 0em; margin-right: 0.222em;">.</span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-536" style="margin-left: 0em; margin-right: 0em;"></span></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-102"> \begin{cases} x + 2y + 2z, & \text{if } x>0 \text{ or } z \text{ is even},\\[6pt] x + 2y + 2z - 2, & \text{if } x=0 \text{ and } z \text{ is odd}. \end{cases} </script></p><p>Time complexity is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-537"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-538">O</span><span class="MJXp-mo" id="MJXp-Span-539" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-540">n</span><span class="MJXp-mo" id="MJXp-Span-541" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-103">O(n)</script> per test case.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">void</span><span class="pln"> solve</span><span class="pun">(){</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
    vector</span><span class="str">&lt;int&gt;</span><span class="pln"> a</span><span class="pun">(</span><span class="lit">2</span><span class="pun">*</span><span class="pln">n</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">i </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">2</span><span class="pun">*</span><span class="pln">n</span><span class="pun">;</span><span class="pln">i</span><span class="pun">++){</span><span class="pln">
        cin </span><span class="pun">&gt;&gt;</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    vector</span><span class="str">&lt;int&gt;</span><span class="pln"> cnt</span><span class="pun">(</span><span class="lit">2</span><span class="pun">*</span><span class="pln">n</span><span class="pun">+</span><span class="lit">1</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">auto</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">x </span><span class="pun">:</span><span class="pln"> a</span><span class="pun">)</span><span class="pln">cnt</span><span class="pun">[</span><span class="pln">x</span><span class="pun">]++;</span><span class="pln">

    </span><span class="kwd">int</span><span class="pln"> x </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln">y </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln">z </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">i </span><span class="pun">&lt;=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">*</span><span class="pln">n</span><span class="pun">;</span><span class="pln">i</span><span class="pun">++){</span><span class="pln">
        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">cnt</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="kwd">continue</span><span class="pun">;</span><span class="pln"> 
        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">cnt</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]&amp;</span><span class="lit">1</span><span class="pun">)</span><span class="pln">x</span><span class="pun">++;</span><span class="pln">         </span><span class="com">//odd elements</span><span class="pln">
        </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">cnt</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]%</span><span class="lit">4</span><span class="pun">)</span><span class="pln">y</span><span class="pun">++;</span><span class="pln">    </span><span class="com">//element of form 4*k + 2</span><span class="pln">
        </span><span class="kwd">else</span><span class="pln"> z</span><span class="pun">++;</span><span class="pln">                </span><span class="com">//element of form 4*k </span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">int</span><span class="pln"> ans </span><span class="pun">=</span><span class="pln"> x</span><span class="pun">+</span><span class="lit">2</span><span class="pun">*</span><span class="pln">y</span><span class="pun">+</span><span class="lit">2</span><span class="pun">*</span><span class="pln">z</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">if</span><span class="pun">((</span><span class="pln">z</span><span class="pun">&amp;</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> x </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln">ans </span><span class="pun">-=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln"> 
    cout </span><span class="pun">&lt;&lt;</span><span class="pln"> ans </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"\n"</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">(){</span><span class="pln">
    ios_base</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    cout</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pun">(</span><span class="pln">t</span><span class="pun">--){</span><span class="pln">
        solve</span><span class="pun">();</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2158/problem/C" title="Codeforces Round 1067 (Div. 2)">2158C - Annoying Game</a> Idea &amp; Solution: <a class="rated-user user-orange" href="https://codeforces.com/profile/kingmessi" title="Master kingmessi">kingmessi</a></p> <div class="spoiler"><b class="spoiler-title">Hint 1</b><div class="spoiler-content" style="display: block;"><p>If Alice makes a move and Bob immediately performs the opposite move on the same index (and vice versa), what happens to the array?</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 2</b><div class="spoiler-content" style="display: block;"><p>How does the parity of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-14-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-71" style="width: 0.76em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.544em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.54em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-72"><span class="mi" id="MathJax-Span-73" style="font-family: MathJax_Math-italic;">k</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi></math></span></span><script type="math/tex" id="MathJax-Element-14">k</script> affect who makes the last move and therefore who can enforce the final uncancelled change?</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 3</b><div class="spoiler-content" style="display: block;"><p>Using the cancellation idea, can the entire game be reduced to a simpler one with exactly <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-15-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mo lspace=&quot;thickmathspace&quot; rspace=&quot;thickmathspace&quot;&gt;mod&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-74" style="width: 4.602em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.466em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1003.41em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-75"><span class="mi" id="MathJax-Span-76" style="font-family: MathJax_Math-italic;">k</span><span class="mo" id="MathJax-Span-77" style="font-family: MathJax_Main; padding-left: 0.273em; padding-right: 0.273em;">mod</span><span class="mn" id="MathJax-Span-78" style="font-family: MathJax_Main;">2</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi><mo lspace="thickmathspace" rspace="thickmathspace">mod</mo><mn>2</mn></math></span></span><script type="math/tex" id="MathJax-Element-15">k \bmod 2</script> effective moves?</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 4</b><div class="spoiler-content" style="display: block;"><p>If Alice changes <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-16-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-79" style="width: 1.139em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.87em, 2.438em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-80"><span class="msubsup" id="MathJax-Span-81"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-82" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-83" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 0.932em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>a</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-16">a_i</script>, only subarrays containing <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-17-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-84" style="width: 0.436em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.327em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1000.27em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-85"><span class="mi" id="MathJax-Span-86" style="font-family: MathJax_Math-italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-17">i</script> can improve. What are the maximum-sum subarrays that <strong>end at <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-18-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-87" style="width: 0.436em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.327em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1000.27em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-88"><span class="mi" id="MathJax-Span-89" style="font-family: MathJax_Math-italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-18">i</script></strong> and <strong>start at <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-19-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-90" style="width: 0.436em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.327em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1000.27em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-91"><span class="mi" id="MathJax-Span-92" style="font-family: MathJax_Math-italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-19">i</script></strong>, and how can combining them give the best subarray passing through <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-20-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-93" style="width: 0.436em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.327em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1000.27em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-94"><span class="mi" id="MathJax-Span-95" style="font-family: MathJax_Math-italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-20">i</script>?</p></div></div> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2158/problem/C" title="Codeforces Round 1067 (Div. 2)">2158C - Annoying Game</a></h3><div class="ttypography"><div class="problem-statement"><div><p>Let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-542"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-543">S</span><span class="MJXp-mo" id="MJXp-Span-544" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-545">a</span><span class="MJXp-mo" id="MJXp-Span-546" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-104">S(a)</script> denote the maximum non-empty subarray sum of array <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-547"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-548">a</span></span></span><script type="math/tex" id="MathJax-Element-105">a</script>. We determine the final score by analyzing the game based on the parity of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-549"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-550">k</span></span></span><script type="math/tex" id="MathJax-Element-106">k</script>, assuming optimal play from both Alice and Bob.</p><p>First, consider the case where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-551"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-552">k</span></span></span><script type="math/tex" id="MathJax-Element-107">k</script> is <span class="tex-font-style-bf">even</span>. Bob has a strategy to ensure the final score is at most the initial <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-553"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-554">S</span><span class="MJXp-mo" id="MJXp-Span-555" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-556">a</span><span class="MJXp-mo" id="MJXp-Span-557" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-108">S(a)</script>. Since Bob plays the even-numbered turns, he can adopt a cancellation strategy. Immediately after Alice modifies an index <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-558"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-559">i</span></span></span><script type="math/tex" id="MathJax-Element-109">i</script> by adding <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-560"><span class="MJXp-msubsup" id="MJXp-Span-561"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-562" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-563" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-110">b_i</script>, Bob can modify the same index <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-564"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-565">i</span></span></span><script type="math/tex" id="MathJax-Element-111">i</script> by subtracting <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-566"><span class="MJXp-msubsup" id="MJXp-Span-567"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-568" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-569" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-112">b_i</script>. This ensures that after every pair of turns, the array is restored to the state it was in before Alice's turn. After <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-570"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-571">k</span></span></span><script type="math/tex" id="MathJax-Element-113">k</script> turns, the array is identical to the initial array. Thus, Bob forces the result <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-572"><span class="MJXp-mo" id="MJXp-Span-573" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-574">S</span><span class="MJXp-mo" id="MJXp-Span-575" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-576"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-577" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-578" style="vertical-align: -0.4em;"><span class="MJXp-mtext" id="MJXp-Span-579">initial</span></span></span><span class="MJXp-mo" id="MJXp-Span-580" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-114">\le S(a_{\text{initial}})</script>.</p><p>We must verify if Bob can force the score lower, or if Alice can guarantee at least <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-581"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-582">S</span><span class="MJXp-mo" id="MJXp-Span-583" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-584"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-585" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-586" style="vertical-align: -0.4em;"><span class="MJXp-mtext" id="MJXp-Span-587">initial</span></span></span><span class="MJXp-mo" id="MJXp-Span-588" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-115">S(a_{\text{initial}})</script>. Alice adopts the following strategy: Let the subarray <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-589"><span class="MJXp-mo" id="MJXp-Span-590" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-591">l</span><span class="MJXp-mo" id="MJXp-Span-592" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-593">r</span><span class="MJXp-mo" id="MJXp-Span-594" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-116">[l, r]</script> be the subarray yielding the initial maximum sum. Alice identifies an index <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-595"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-596">p</span></span></span><script type="math/tex" id="MathJax-Element-117">p</script> such that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-597"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-598">l</span><span class="MJXp-mo" id="MJXp-Span-599" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-600">p</span><span class="MJXp-mo" id="MJXp-Span-601" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-602">r</span></span></span><script type="math/tex" id="MathJax-Element-118">l \le p \le r</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-603"><span class="MJXp-msubsup" id="MJXp-Span-604"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-605" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-606" style="vertical-align: -0.4em;">p</span></span></span></span><script type="math/tex" id="MathJax-Element-119">b_p</script> is the maximum value among all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-607"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-608">b</span></span></span><script type="math/tex" id="MathJax-Element-120">b</script> in that range. In her first turn, Alice adds <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-609"><span class="MJXp-msubsup" id="MJXp-Span-610"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-611" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-612" style="vertical-align: -0.4em;">p</span></span></span></span><script type="math/tex" id="MathJax-Element-121">b_p</script> to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-613"><span class="MJXp-msubsup" id="MJXp-Span-614"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-615" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-616" style="vertical-align: -0.4em;">p</span></span></span></span><script type="math/tex" id="MathJax-Element-122">a_p</script>. For all subsequent turns, Alice adopts the cancellation strategy against Bob: if Bob modifies index <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-617"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-618">x</span></span></span><script type="math/tex" id="MathJax-Element-123">x</script>, Alice immediately modifies index <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-619"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-620">x</span></span></span><script type="math/tex" id="MathJax-Element-124">x</script> in her next turn to restore it.</p><p>This strategy ensures that just before Bob's very last move (turn <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-621"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-622">k</span></span></span><script type="math/tex" id="MathJax-Element-125">k</script>), the array has exactly one modification: <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-623"><span class="MJXp-msubsup" id="MJXp-Span-624"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-625" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-626" style="vertical-align: -0.4em;">p</span></span></span></span><script type="math/tex" id="MathJax-Element-126">a_p</script> is increased by <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-627"><span class="MJXp-msubsup" id="MJXp-Span-628"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-629" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-630" style="vertical-align: -0.4em;">p</span></span></span></span><script type="math/tex" id="MathJax-Element-127">b_p</script>. Bob must now make a move to minimize the score. To reduce the sum of the subarray <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-631"><span class="MJXp-mo" id="MJXp-Span-632" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-633">l</span><span class="MJXp-mo" id="MJXp-Span-634" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-635">r</span><span class="MJXp-mo" id="MJXp-Span-636" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-128">[l, r]</script>, Bob must choose an index <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-637"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-638">q</span></span></span><script type="math/tex" id="MathJax-Element-129">q</script> within the range <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-639"><span class="MJXp-mo" id="MJXp-Span-640" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-641">l</span><span class="MJXp-mo" id="MJXp-Span-642" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-643">r</span><span class="MJXp-mo" id="MJXp-Span-644" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-130">[l, r]</script> and subtract <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-645"><span class="MJXp-msubsup" id="MJXp-Span-646"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-647" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-648" style="vertical-align: -0.4em;">q</span></span></span></span><script type="math/tex" id="MathJax-Element-131">b_q</script>. The new sum becomes <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-649"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-650">S</span><span class="MJXp-mo" id="MJXp-Span-651" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-652"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-653" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-654" style="vertical-align: -0.4em;"><span class="MJXp-mtext" id="MJXp-Span-655">initial</span></span></span><span class="MJXp-mo" id="MJXp-Span-656" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-657" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-658"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-659" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-660" style="vertical-align: -0.4em;">p</span></span><span class="MJXp-mo" id="MJXp-Span-661" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-662"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-663" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-664" style="vertical-align: -0.4em;">q</span></span></span></span><script type="math/tex" id="MathJax-Element-132">S(a_{\text{initial}}) + b_p - b_q</script>. Since Alice chose <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-665"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-666">p</span></span></span><script type="math/tex" id="MathJax-Element-133">p</script> such that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-667"><span class="MJXp-msubsup" id="MJXp-Span-668"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-669" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-670" style="vertical-align: -0.4em;">p</span></span></span></span><script type="math/tex" id="MathJax-Element-134">b_p</script> is maximal in that range, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-671"><span class="MJXp-msubsup" id="MJXp-Span-672"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-673" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-674" style="vertical-align: -0.4em;">p</span></span><span class="MJXp-mo" id="MJXp-Span-675" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-msubsup" id="MJXp-Span-676"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-677" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-678" style="vertical-align: -0.4em;">q</span></span></span></span><script type="math/tex" id="MathJax-Element-135">b_p \ge b_q</script>. Consequently, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-679"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-680">S</span><span class="MJXp-mo" id="MJXp-Span-681" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-682"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-683" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-684" style="vertical-align: -0.4em;"><span class="MJXp-mtext" id="MJXp-Span-685">initial</span></span></span><span class="MJXp-mo" id="MJXp-Span-686" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-687" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-688"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-689" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-690" style="vertical-align: -0.4em;">p</span></span><span class="MJXp-mo" id="MJXp-Span-691" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-692"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-693" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-694" style="vertical-align: -0.4em;">q</span></span><span class="MJXp-mo" id="MJXp-Span-695" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-696">S</span><span class="MJXp-mo" id="MJXp-Span-697" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-698"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-699" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-700" style="vertical-align: -0.4em;"><span class="MJXp-mtext" id="MJXp-Span-701">initial</span></span></span><span class="MJXp-mo" id="MJXp-Span-702" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-136">S(a_{\text{initial}}) + b_p - b_q \ge S(a_{\text{initial}})</script>. Bob is forced to choose <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-703"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-704">q</span><span class="MJXp-mo" id="MJXp-Span-705" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-706">p</span></span></span><script type="math/tex" id="MathJax-Element-137">q=p</script> to simply undo Alice's first move; otherwise, the score remains strictly greater than <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-707"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-708">S</span><span class="MJXp-mo" id="MJXp-Span-709" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-710"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-711" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-712" style="vertical-align: -0.4em;"><span class="MJXp-mtext" id="MJXp-Span-713">initial</span></span></span><span class="MJXp-mo" id="MJXp-Span-714" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-138">S(a_{\text{initial}})</script>. Thus, for even <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-715"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-716">k</span></span></span><script type="math/tex" id="MathJax-Element-139">k</script>, the final score is exactly <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-717"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-718">S</span><span class="MJXp-mo" id="MJXp-Span-719" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-720"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-721" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-722" style="vertical-align: -0.4em;"><span class="MJXp-mtext" id="MJXp-Span-723">initial</span></span></span><span class="MJXp-mo" id="MJXp-Span-724" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-140">S(a_{\text{initial}})</script>.</p><p>Next, consider the case where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-725"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-726">k</span></span></span><script type="math/tex" id="MathJax-Element-141">k</script> is <span class="tex-font-style-bf">odd</span>. Alice has a strategy to maximize the result of a single independent move. She performs her desired modification on turn 1. For any subsequent move by Bob, Alice uses her next turn to cancel it. Since Alice makes the last move (turn <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-727"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-728">k</span></span></span><script type="math/tex" id="MathJax-Element-142">k</script>), she ensures all of Bob's actions are neutralized. Conversely, Bob can prevent Alice from achieving anything more than a single move by canceling Alice's actions during the first <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-729"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-730">k</span><span class="MJXp-mo" id="MJXp-Span-731" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-732">1</span></span></span><script type="math/tex" id="MathJax-Element-143">k-1</script> turns. The game reduces to Alice making exactly one move <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-733"><span class="MJXp-msubsup" id="MJXp-Span-734"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-735" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-736" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-737" style="margin-left: 0.333em; margin-right: 0.333em;">←</span><span class="MJXp-msubsup" id="MJXp-Span-738"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-739" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-740" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-741" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-742"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-743" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-744" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-144">a_i \leftarrow a_i + b_i</script> to maximize <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-745"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-746">S</span><span class="MJXp-mo" id="MJXp-Span-747" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-748">a</span><span class="MJXp-mo" id="MJXp-Span-749" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-145">S(a)</script>.</p><p>To solve this efficiently, we use prefix and suffix maximums. Let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-750"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-751">L</span><span class="MJXp-mo" id="MJXp-Span-752" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-753">i</span><span class="MJXp-mo" id="MJXp-Span-754" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-146">L[i]</script> be the maximum sum of a non-empty subarray ending at <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-755"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-756">i</span></span></span><script type="math/tex" id="MathJax-Element-147">i</script>, and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-757"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-758">R</span><span class="MJXp-mo" id="MJXp-Span-759" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-760">i</span><span class="MJXp-mo" id="MJXp-Span-761" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-148">R[i]</script> be the maximum sum of a non-empty subarray starting at <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-762"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-763">i</span></span></span><script type="math/tex" id="MathJax-Element-149">i</script>. If Alice modifies index <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-764"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-765">i</span></span></span><script type="math/tex" id="MathJax-Element-150">i</script>, the maximum sum passing through <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-766"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-767">i</span></span></span><script type="math/tex" id="MathJax-Element-151">i</script> is the sum of the maximum prefix ending at <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-768"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-769">i</span></span></span><script type="math/tex" id="MathJax-Element-152">i</script> and the maximum suffix starting at <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-770"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-771">i</span></span></span><script type="math/tex" id="MathJax-Element-153">i</script>, adjusted for modified value. Since both <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-772"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-773">L</span><span class="MJXp-mo" id="MJXp-Span-774" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-775">i</span><span class="MJXp-mo" id="MJXp-Span-776" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-154">L[i]</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-777"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-778">R</span><span class="MJXp-mo" id="MJXp-Span-779" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-780">i</span><span class="MJXp-mo" id="MJXp-Span-781" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-155">R[i]</script> include the original <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-782"><span class="MJXp-msubsup" id="MJXp-Span-783"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-784" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-785" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-156">a_i</script>, we subtract <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-786"><span class="MJXp-msubsup" id="MJXp-Span-787"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-788" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-789" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-157">a_i</script> once to avoid double counting, then add <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-790"><span class="MJXp-msubsup" id="MJXp-Span-791"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-792" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-793" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-158">b_i</script> (denoting Alice modification). The final answer is the maximum of the initial score and the best possible modified sum:</p><p><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-794"><span class="MJXp-munderover" id="MJXp-Span-795"><span class=""><span class="MJXp-mo" id="MJXp-Span-796" style="margin-left: 0.333em; margin-right: 0.333em;">max</span></span><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-797" style="margin-left: 0px;"><span class="MJXp-mn" id="MJXp-Span-798">1</span><span class="MJXp-mo" id="MJXp-Span-799">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-800">i</span><span class="MJXp-mo" id="MJXp-Span-801">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-802">n</span></span></span></span><span class="MJXp-mo" id="MJXp-Span-803" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-804">L</span><span class="MJXp-mo" id="MJXp-Span-805" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-806">i</span><span class="MJXp-mo" id="MJXp-Span-807" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-808" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-809">R</span><span class="MJXp-mo" id="MJXp-Span-810" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-811">i</span><span class="MJXp-mo" id="MJXp-Span-812" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-813" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-814"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-815" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-816" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-817" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-818"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-819" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-820" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-821" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex; mode=display" id="MathJax-Element-159"> \max_{1 \le i \le n} (L[i] + R[i] - a_i + b_i) </script></p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">void</span><span class="pln"> solve</span><span class="pun">(){</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">,</span><span class="pln">k</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n </span><span class="pun">&gt;&gt;</span><span class="pln"> k</span><span class="pun">;</span><span class="pln">
    vector</span><span class="str">&lt;int&gt;</span><span class="pln"> a</span><span class="pun">(</span><span class="pln">n</span><span class="pun">),</span><span class="pln">b</span><span class="pun">(</span><span class="pln">n</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">i</span><span class="pun">++)</span><span class="pln">cin </span><span class="pun">&gt;&gt;</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">i</span><span class="pun">++)</span><span class="pln">cin </span><span class="pun">&gt;&gt;</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
    k </span><span class="pun">&amp;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> </span><span class="com">//It can be reduced as 0/1 move game</span><span class="pln">

    vector</span><span class="pun">&lt;</span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pun">&gt;</span><span class="pln"> L</span><span class="pun">(</span><span class="pln">n</span><span class="pun">);</span><span class="pln"> </span><span class="com">//maximum sum non empty subarray ending at each position</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">i</span><span class="pun">++){</span><span class="pln">
        L</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="pun">&amp;&amp;</span><span class="pln"> L</span><span class="pun">[</span><span class="pln">i</span><span class="pun">-</span><span class="lit">1</span><span class="pun">]&gt;</span><span class="lit">0</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> L</span><span class="pun">[</span><span class="pln">i</span><span class="pun">-</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="lit">0ll</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln"> 
    </span><span class="pun">}</span><span class="pln">   

    vector</span><span class="pun">&lt;</span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pun">&gt;</span><span class="pln"> R</span><span class="pun">(</span><span class="pln">n</span><span class="pun">);</span><span class="pln"> </span><span class="com">//maximum sum non empty subarray starting at each position</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> n</span><span class="pun">-</span><span class="lit">1</span><span class="pun">;</span><span class="pln">i </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">i</span><span class="pun">--){</span><span class="pln">
        R</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i</span><span class="pun">+</span><span class="lit">1</span><span class="pun">&lt;</span><span class="pln">n </span><span class="pun">&amp;&amp;</span><span class="pln"> R</span><span class="pun">[</span><span class="pln">i</span><span class="pun">+</span><span class="lit">1</span><span class="pun">]&gt;</span><span class="lit">0</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> R</span><span class="pun">[</span><span class="pln">i</span><span class="pun">+</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="lit">0ll</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">k </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">){</span><span class="pln">
        </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> ans </span><span class="pun">=</span><span class="pln"> </span><span class="pun">*</span><span class="pln">max_element</span><span class="pun">(</span><span class="pln">L</span><span class="pun">.</span><span class="kwd">begin</span><span class="pun">(),</span><span class="pln">L</span><span class="pun">.</span><span class="kwd">end</span><span class="pun">());</span><span class="pln">
        cout </span><span class="pun">&lt;&lt;</span><span class="pln"> ans </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"\n"</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">else</span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> ans </span><span class="pun">=</span><span class="pln"> LONG_MIN</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">i</span><span class="pun">++){</span><span class="pln">
            ans </span><span class="pun">=</span><span class="pln"> max</span><span class="pun">(</span><span class="pln">ans</span><span class="pun">,</span><span class="pln">L</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]+</span><span class="pln">R</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]-</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]+</span><span class="pln">b</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        cout </span><span class="pun">&lt;&lt;</span><span class="pln"> ans </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"\n"</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">(){</span><span class="pln">
    ios_base</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    cout</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pun">(</span><span class="pln">t</span><span class="pun">--){</span><span class="pln">
        solve</span><span class="pun">();</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div> <div class="spoiler"><b class="spoiler-title">Bonus</b><div class="spoiler-content" style="display: block;"><p>How do you calculate the final score if goals of Alice and Bob were <strong>swapped</strong>?</p></div></div><p><a href="https://codeforces.com/contest/2158/problem/D" title="Codeforces Round 1067 (Div. 2)">2158D - Palindrome Flipping</a> Idea &amp; Solution: <a class="rated-user user-orange" href="https://codeforces.com/profile/kingmessi" title="Master kingmessi">kingmessi</a> and <a class="rated-user user-red" href="https://codeforces.com/profile/abc864197532" title="International Grandmaster abc864197532">abc864197532</a></p> <div class="spoiler"><b class="spoiler-title">Hint 1</b><div class="spoiler-content" style="display: block;"><p>Instead of directly transforming <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-21-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-96" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.44em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-97"><span class="mi" id="MathJax-Span-98" style="font-family: MathJax_Math-italic;">s</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi></math></span></span><script type="math/tex" id="MathJax-Element-21">s</script> into <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-22-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-99" style="width: 0.544em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.381em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1000.33em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-100"><span class="mi" id="MathJax-Span-101" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-22">t</script>, is it enough to know how to transform any string into an intermediate string?</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 2</b><div class="spoiler-content" style="display: block;"><p>If you know how to turn any string into <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-23-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-102" style="width: 1.301em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.977em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.98em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-103"><span class="msubsup" id="MathJax-Span-104"><span style="display: inline-block; position: relative; width: 0.977em; height: 0px;"><span style="position: absolute; clip: rect(3.195em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mn" id="MathJax-Span-105" style="font-family: MathJax_Main;">0</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -4.38em; left: 0.49em;"><span class="mi" id="MathJax-Span-106" style="font-size: 70.7%; font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mn>0</mn><mi>n</mi></msup></math></span></span><script type="math/tex" id="MathJax-Element-23">0^n</script> in at most <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-24-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-107" style="width: 0.814em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.6em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-108"><span class="mi" id="MathJax-Span-109" style="font-family: MathJax_Math-italic;">n</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi></math></span></span><script type="math/tex" id="MathJax-Element-24">n</script> operations, how can you use that to transform <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-25-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-110" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.44em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-111"><span class="mi" id="MathJax-Span-112" style="font-family: MathJax_Math-italic;">s</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi></math></span></span><script type="math/tex" id="MathJax-Element-25">s</script> into <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-26-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-113" style="width: 0.544em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.381em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1000.33em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-114"><span class="mi" id="MathJax-Span-115" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-26">t</script> in at most <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-27-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-116" style="width: 1.464em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.085em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1001.09em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-117"><span class="mn" id="MathJax-Span-118" style="font-family: MathJax_Main;">2</span><span class="mi" id="MathJax-Span-119" style="font-family: MathJax_Math-italic;">n</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>2</mn><mi>n</mi></math></span></span><script type="math/tex" id="MathJax-Element-27">2n</script> operations?</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 3</b><div class="spoiler-content" style="display: block;"><p>If there is at least one position <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-28-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-120" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.49em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-121"><span class="mi" id="MathJax-Span-122" style="font-family: MathJax_Math-italic;">p</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi></math></span></span><script type="math/tex" id="MathJax-Element-28">p</script> with <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-29-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-123" style="width: 5.36em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.061em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.572em, 1004.06em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-124"><span class="msubsup" id="MathJax-Span-125"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-126" style="font-family: MathJax_Math-italic;">s</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.49em;"><span class="mi" id="MathJax-Span-127" style="font-size: 70.7%; font-family: MathJax_Math-italic;">p</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-128" style="font-family: MathJax_Main; padding-left: 0.273em;">=</span><span class="msubsup" id="MathJax-Span-129" style="padding-left: 0.273em;"><span style="display: inline-block; position: relative; width: 1.788em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-130" style="font-family: MathJax_Math-italic;">s</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.49em;"><span class="texatom" id="MathJax-Span-131"><span class="mrow" id="MathJax-Span-132"><span class="mi" id="MathJax-Span-133" style="font-size: 70.7%; font-family: MathJax_Math-italic;">p</span><span class="mo" id="MathJax-Span-134" style="font-size: 70.7%; font-family: MathJax_Main;">+</span><span class="mn" id="MathJax-Span-135" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>s</mi><mi>p</mi></msub><mo>=</mo><msub><mi>s</mi><mrow class="MJX-TeXAtom-ORD"><mi>p</mi><mo>+</mo><mn>1</mn></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-29">s_p = s_{p+1}</script>. Can you grow a block of equal bits starting from <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-30-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-136" style="width: 4.927em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.736em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1003.63em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-137"><span class="mo" id="MathJax-Span-138" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-139" style="font-family: MathJax_Math-italic;">p</span><span class="mo" id="MathJax-Span-140" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-141" style="font-family: MathJax_Math-italic; padding-left: 0.165em;">p</span><span class="mo" id="MathJax-Span-142" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-143" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span><span class="mo" id="MathJax-Span-144" style="font-family: MathJax_Main;">]</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><mi>p</mi><mo>,</mo><mi>p</mi><mo>+</mo><mn>1</mn><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-30">[p, p+1]</script>?</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 4</b><div class="spoiler-content" style="display: block;"><p>How do you ensure such a position <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-31-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-145" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.49em, 2.492em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-146"><span class="mi" id="MathJax-Span-147" style="font-family: MathJax_Math-italic;">p</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi></math></span></span><script type="math/tex" id="MathJax-Element-31">p</script> in strictly alternating string after exactly one operation?</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 5</b><div class="spoiler-content" style="display: block;"><p>When trying to grow the block to the right (or left), what happens if the next bit is equal to the block's boundary bit?<br>What if it is different? Can you use flipping a palindromic block (all equal bits) to force the boundary to match the next bit?</p></div></div> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2158/problem/D" title="Codeforces Round 1067 (Div. 2)">2158D - Palindrome Flipping</a></h3><div class="ttypography"><div class="problem-statement"><div><p>We use <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-822"><span class="MJXp-mn" id="MJXp-Span-823">1</span></span></span><script type="math/tex" id="MathJax-Element-160">1</script>-based indexing and assume <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-824"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-825">n</span><span class="MJXp-mo" id="MJXp-Span-826" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mn" id="MJXp-Span-827">4</span></span></span><script type="math/tex" id="MathJax-Element-161">n\ge 4</script>. An allowed operation chooses <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-828"><span class="MJXp-mn" id="MJXp-Span-829">1</span><span class="MJXp-mo" id="MJXp-Span-830" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-831">l</span><span class="MJXp-mo" id="MJXp-Span-832" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-833">r</span><span class="MJXp-mo" id="MJXp-Span-834" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-835">n</span></span></span><script type="math/tex" id="MathJax-Element-162">1\le l<r\le n</script> such that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-836"><span class="MJXp-msubsup" id="MJXp-Span-837"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-838" style="margin-right: 0.05em;">s</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-839" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-840">l</span><span class="MJXp-mo" id="MJXp-Span-841">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-842">r</span></span></span></span></span><script type="math/tex" id="MathJax-Element-163">s_{l,r}</script> is a palindrome, and flips all its bits. To transform <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-843"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-844">s</span></span></span><script type="math/tex" id="MathJax-Element-164">s</script> into <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-845"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-846">t</span></span></span><script type="math/tex" id="MathJax-Element-165">t</script>, it is enough to show that any string can be converted to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-847"><span class="MJXp-msubsup" id="MJXp-Span-848"><span class="MJXp-mn" id="MJXp-Span-849" style="margin-right: 0.05em;">0</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-850" style="vertical-align: 0.5em;">n</span></span></span></span><script type="math/tex" id="MathJax-Element-166">0^n</script> using at most <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-851"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-852">n</span></span></span><script type="math/tex" id="MathJax-Element-167">n</script> operations. Indeed, if we find a sequence of operations turning <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-853"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-854">s</span></span></span><script type="math/tex" id="MathJax-Element-168">s</script> into <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-855"><span class="MJXp-msubsup" id="MJXp-Span-856"><span class="MJXp-mn" id="MJXp-Span-857" style="margin-right: 0.05em;">0</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-858" style="vertical-align: 0.5em;">n</span></span></span></span><script type="math/tex" id="MathJax-Element-169">0^n</script> and a (possibly different) sequence turning <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-859"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-860">t</span></span></span><script type="math/tex" id="MathJax-Element-170">t</script> into <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-861"><span class="MJXp-msubsup" id="MJXp-Span-862"><span class="MJXp-mn" id="MJXp-Span-863" style="margin-right: 0.05em;">0</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-864" style="vertical-align: 0.5em;">n</span></span></span></span><script type="math/tex" id="MathJax-Element-171">0^n</script>, then by performing the second sequence <span class="tex-font-style-underline">in reverse order</span> starting from <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-865"><span class="MJXp-msubsup" id="MJXp-Span-866"><span class="MJXp-mn" id="MJXp-Span-867" style="margin-right: 0.05em;">0</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-868" style="vertical-align: 0.5em;">n</span></span></span></span><script type="math/tex" id="MathJax-Element-172">0^n</script>, we obtain <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-869"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-870">t</span></span></span><script type="math/tex" id="MathJax-Element-173">t</script>. Thus the total number of operations needed to convert <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-871"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-872">s</span></span></span><script type="math/tex" id="MathJax-Element-174">s</script> into <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-873"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-874">t</span></span></span><script type="math/tex" id="MathJax-Element-175">t</script> is at most twice the number needed to convert a single string into <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-875"><span class="MJXp-msubsup" id="MJXp-Span-876"><span class="MJXp-mn" id="MJXp-Span-877" style="margin-right: 0.05em;">0</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-878" style="vertical-align: 0.5em;">n</span></span></span></span><script type="math/tex" id="MathJax-Element-176">0^n</script>.</p><p>We therefore focus on reducing an arbitrary string <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-879"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-880">s</span></span></span><script type="math/tex" id="MathJax-Element-177">s</script> to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-881"><span class="MJXp-msubsup" id="MJXp-Span-882"><span class="MJXp-mn" id="MJXp-Span-883" style="margin-right: 0.05em;">0</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-884" style="vertical-align: 0.5em;">n</span></span></span></span><script type="math/tex" id="MathJax-Element-178">0^n</script> using at most <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-885"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-886">n</span></span></span><script type="math/tex" id="MathJax-Element-179">n</script> operations. If <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-887"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-888">s</span></span></span><script type="math/tex" id="MathJax-Element-180">s</script> is alternating, then since <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-889"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-890">n</span><span class="MJXp-mo" id="MJXp-Span-891" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mn" id="MJXp-Span-892">4</span></span></span><script type="math/tex" id="MathJax-Element-181">n\ge 4</script>, the substring <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-893"><span class="MJXp-msubsup" id="MJXp-Span-894"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-895" style="margin-right: 0.05em;">s</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-896" style="vertical-align: -0.4em;"><span class="MJXp-mn" id="MJXp-Span-897">2</span><span class="MJXp-mo" id="MJXp-Span-898">,</span><span class="MJXp-mn" id="MJXp-Span-899">4</span></span></span></span></span><script type="math/tex" id="MathJax-Element-182">s_{2,4}</script> is either <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-900"><span class="MJXp-mn" id="MJXp-Span-901">010</span></span></span><script type="math/tex" id="MathJax-Element-183">010</script> or <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-902"><span class="MJXp-mn" id="MJXp-Span-903">101</span></span></span><script type="math/tex" id="MathJax-Element-184">101</script>, hence a palindrome. Flipping <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-904"><span class="MJXp-msubsup" id="MJXp-Span-905"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-906" style="margin-right: 0.05em;">s</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-907" style="vertical-align: -0.4em;"><span class="MJXp-mn" id="MJXp-Span-908">2</span><span class="MJXp-mo" id="MJXp-Span-909">,</span><span class="MJXp-mn" id="MJXp-Span-910">4</span></span></span></span></span><script type="math/tex" id="MathJax-Element-185">s_{2,4}</script> changes <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-911"><span class="MJXp-msubsup" id="MJXp-Span-912"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-913" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-914" style="vertical-align: -0.4em;">2</span></span></span></span><script type="math/tex" id="MathJax-Element-186">s_2</script> while leaving <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-915"><span class="MJXp-msubsup" id="MJXp-Span-916"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-917" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-918" style="vertical-align: -0.4em;">1</span></span></span></span><script type="math/tex" id="MathJax-Element-187">s_1</script> unchanged, so afterwards <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-919"><span class="MJXp-msubsup" id="MJXp-Span-920"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-921" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-922" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-923" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-924"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-925" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-926" style="vertical-align: -0.4em;">2</span></span></span></span><script type="math/tex" id="MathJax-Element-188">s_1=s_2</script>. Thus in at most one step the string becomes non-alternating.</p><p>Now assume <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-927"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-928">s</span></span></span><script type="math/tex" id="MathJax-Element-189">s</script> is non-alternating. Let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-929"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-930">p</span></span></span><script type="math/tex" id="MathJax-Element-190">p</script> be the smallest index with <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-931"><span class="MJXp-msubsup" id="MJXp-Span-932"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-933" style="margin-right: 0.05em;">s</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-934" style="vertical-align: -0.4em;">p</span></span><span class="MJXp-mo" id="MJXp-Span-935" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-936"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-937" style="margin-right: 0.05em;">s</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-938" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-939">p</span><span class="MJXp-mo" id="MJXp-Span-940">+</span><span class="MJXp-mn" id="MJXp-Span-941">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-191">s_p=s_{p+1}</script>, and initialize a block of equal bits as <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-942"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-943">L</span><span class="MJXp-mo" id="MJXp-Span-944" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-945">p</span></span></span><script type="math/tex" id="MathJax-Element-192">L=p</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-946"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-947">R</span><span class="MJXp-mo" id="MJXp-Span-948" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-949">p</span><span class="MJXp-mo" id="MJXp-Span-950" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-951">1</span></span></span><script type="math/tex" id="MathJax-Element-193">R=p+1</script>. We now expand this block until it covers the entire string.</p><p>Consider the right boundary. If <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-952"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-953">R</span><span class="MJXp-mo" id="MJXp-Span-954" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-955">n</span></span></span><script type="math/tex" id="MathJax-Element-194">R<n</script>, then:</p><p>1. If <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-956"><span class="MJXp-msubsup" id="MJXp-Span-957"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-958" style="margin-right: 0.05em;">s</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-959" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-960">R</span><span class="MJXp-mo" id="MJXp-Span-961">+</span><span class="MJXp-mn" id="MJXp-Span-962">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-963" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-964"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-965" style="margin-right: 0.05em;">s</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-966" style="vertical-align: -0.4em;">R</span></span></span></span><script type="math/tex" id="MathJax-Element-195">s_{R+1}=s_R</script>, we simply extend the block by setting <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-967"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-968">R</span><span class="MJXp-mo" id="MJXp-Span-969" style="margin-left: 0.111em; margin-right: 0.167em;">:=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-970">R</span><span class="MJXp-mo" id="MJXp-Span-971" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-972">1</span></span></span><script type="math/tex" id="MathJax-Element-196">R:=R+1</script>.</p><p>2. If <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-973"><span class="MJXp-msubsup" id="MJXp-Span-974"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-975" style="margin-right: 0.05em;">s</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-976" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-977">R</span><span class="MJXp-mo" id="MJXp-Span-978">+</span><span class="MJXp-mn" id="MJXp-Span-979">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-980" style="margin-left: 0.333em; margin-right: 0.333em;">≠</span><span class="MJXp-msubsup" id="MJXp-Span-981"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-982" style="margin-right: 0.05em;">s</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-983" style="vertical-align: -0.4em;">R</span></span></span></span><script type="math/tex" id="MathJax-Element-197">s_{R+1}\ne s_R</script>, then <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-984"><span class="MJXp-msubsup" id="MJXp-Span-985"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-986" style="margin-right: 0.05em;">s</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-987" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-988">L</span><span class="MJXp-mo" id="MJXp-Span-989">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-990">R</span></span></span></span></span><script type="math/tex" id="MathJax-Element-198">s_{L,R}</script> is a palindrome (all bits in the block are equal). Flipping <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-991"><span class="MJXp-msubsup" id="MJXp-Span-992"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-993" style="margin-right: 0.05em;">s</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-994" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-995">L</span><span class="MJXp-mo" id="MJXp-Span-996">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-997">R</span></span></span></span></span><script type="math/tex" id="MathJax-Element-199">s_{L,R}</script> toggles every bit in the block but keeps them equal, and also toggles <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-998"><span class="MJXp-msubsup" id="MJXp-Span-999"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1000" style="margin-right: 0.05em;">s</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1001" style="vertical-align: -0.4em;">R</span></span></span></span><script type="math/tex" id="MathJax-Element-200">s_R</script> while leaving <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1002"><span class="MJXp-msubsup" id="MJXp-Span-1003"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1004" style="margin-right: 0.05em;">s</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1005" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1006">R</span><span class="MJXp-mo" id="MJXp-Span-1007">+</span><span class="MJXp-mn" id="MJXp-Span-1008">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-201">s_{R+1}</script> unchanged. Thus afterwards <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1009"><span class="MJXp-msubsup" id="MJXp-Span-1010"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1011" style="margin-right: 0.05em;">s</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1012" style="vertical-align: -0.4em;">R</span></span><span class="MJXp-mo" id="MJXp-Span-1013" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-1014"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1015" style="margin-right: 0.05em;">s</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1016" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1017">R</span><span class="MJXp-mo" id="MJXp-Span-1018">+</span><span class="MJXp-mn" id="MJXp-Span-1019">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-202">s_R=s_{R+1}</script>, and the block expands to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1020"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1021">R</span><span class="MJXp-mo" id="MJXp-Span-1022" style="margin-left: 0.111em; margin-right: 0.167em;">:=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1023">R</span><span class="MJXp-mo" id="MJXp-Span-1024" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-1025">1</span></span></span><script type="math/tex" id="MathJax-Element-203">R:=R+1</script>.</p><p>A symmetric step expands the block to the left whenever <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1026"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1027">L</span><span class="MJXp-mo" id="MJXp-Span-1028" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-mn" id="MJXp-Span-1029">1</span></span></span><script type="math/tex" id="MathJax-Element-204">L>1</script>. Each operation increases the size of the block by exactly <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1030"><span class="MJXp-mn" id="MJXp-Span-1031">1</span></span></span><script type="math/tex" id="MathJax-Element-205">1</script>. After at most <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1032"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1033">n</span><span class="MJXp-mo" id="MJXp-Span-1034" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-1035">1</span></span></span><script type="math/tex" id="MathJax-Element-206">n-1</script> such expansions, the block covers all positions, so the string is constant.</p><p>If the resulting string is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1036"><span class="MJXp-msubsup" id="MJXp-Span-1037"><span class="MJXp-mn" id="MJXp-Span-1038" style="margin-right: 0.05em;">0</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1039" style="vertical-align: 0.5em;">n</span></span></span></span><script type="math/tex" id="MathJax-Element-207">0^n</script>, we are done. If it is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1040"><span class="MJXp-msubsup" id="MJXp-Span-1041"><span class="MJXp-mn" id="MJXp-Span-1042" style="margin-right: 0.05em;">1</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1043" style="vertical-align: 0.5em;">n</span></span></span></span><script type="math/tex" id="MathJax-Element-208">1^n</script>, then <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1044"><span class="MJXp-msubsup" id="MJXp-Span-1045"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1046" style="margin-right: 0.05em;">s</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1047" style="vertical-align: -0.4em;"><span class="MJXp-mn" id="MJXp-Span-1048">1</span><span class="MJXp-mo" id="MJXp-Span-1049">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1050">n</span></span></span></span></span><script type="math/tex" id="MathJax-Element-209">s_{1,n}</script> is itself a palindrome, and flipping it once produces <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1051"><span class="MJXp-msubsup" id="MJXp-Span-1052"><span class="MJXp-mn" id="MJXp-Span-1053" style="margin-right: 0.05em;">0</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1054" style="vertical-align: 0.5em;">n</span></span></span></span><script type="math/tex" id="MathJax-Element-210">0^n</script>. Thus at most <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1055"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1056">n</span></span></span><script type="math/tex" id="MathJax-Element-211">n</script> operations always suffice to reach <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1057"><span class="MJXp-msubsup" id="MJXp-Span-1058"><span class="MJXp-mn" id="MJXp-Span-1059" style="margin-right: 0.05em;">0</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1060" style="vertical-align: 0.5em;">n</span></span></span></span><script type="math/tex" id="MathJax-Element-212">0^n</script>.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">

vector</span><span class="pun">&lt;</span><span class="pln">array</span><span class="pun">&lt;</span><span class="kwd">int</span><span class="pun">,</span><span class="lit">2</span><span class="pun">&gt;&gt;</span><span class="pln"> reduce</span><span class="pun">(</span><span class="kwd">string</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">s</span><span class="pun">){</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> n </span><span class="pun">=</span><span class="pln"> s</span><span class="pun">.</span><span class="pln">size</span><span class="pun">();</span><span class="pln">
    vector</span><span class="pun">&lt;</span><span class="pln">array</span><span class="pun">&lt;</span><span class="kwd">int</span><span class="pun">,</span><span class="lit">2</span><span class="pun">&gt;&gt;</span><span class="pln"> op</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">int</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">;</span><span class="pln"> </span><span class="com">// position p such that two consecutive characters are same</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">-</span><span class="lit">1</span><span class="pun">;</span><span class="pln">i</span><span class="pun">++){</span><span class="pln">
        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">s</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> s</span><span class="pun">[</span><span class="pln">i</span><span class="pun">+</span><span class="lit">1</span><span class="pun">])</span><span class="pln">p </span><span class="pun">=</span><span class="pln"> i</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">p </span><span class="pun">==</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">){</span><span class="pln"> </span><span class="com">// string is alternating</span><span class="pln">
        op</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">({</span><span class="lit">0</span><span class="pun">,</span><span class="lit">2</span><span class="pun">});</span><span class="pln"> </span><span class="com">// substring of first three character must be palindrome</span><span class="pln">
        s</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">^=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">s</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">^=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
        p </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">char</span><span class="pln"> </span><span class="kwd">value</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> s</span><span class="pun">[</span><span class="pln">p</span><span class="pun">+</span><span class="lit">1</span><span class="pun">];</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> L </span><span class="pun">=</span><span class="pln"> p</span><span class="pun">,</span><span class="pln">R </span><span class="pun">=</span><span class="pln"> p</span><span class="pun">+</span><span class="lit">1</span><span class="pun">;</span><span class="pln"> </span><span class="com">// We maintain [L,R] such that all position in it have the same value</span><span class="pln">

    </span><span class="kwd">while</span><span class="pun">(</span><span class="pln">R</span><span class="pun">+</span><span class="lit">1</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">){</span><span class="pln">
        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">s</span><span class="pun">[</span><span class="pln">R</span><span class="pun">+</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">value</span><span class="pun">)</span><span class="pln">op</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">({</span><span class="pln">L</span><span class="pun">,</span><span class="pln">R</span><span class="pun">});</span><span class="pln">
        R</span><span class="pun">++;</span><span class="kwd">value</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> s</span><span class="pun">[</span><span class="pln">R</span><span class="pun">];</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">while</span><span class="pun">(</span><span class="pln">L</span><span class="pun">){</span><span class="pln">
        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">s</span><span class="pun">[</span><span class="pln">L</span><span class="pun">-</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">value</span><span class="pun">)</span><span class="pln">op</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">({</span><span class="pln">L</span><span class="pun">,</span><span class="pln">R</span><span class="pun">});</span><span class="pln">
        L</span><span class="pun">--;</span><span class="kwd">value</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> s</span><span class="pun">[</span><span class="pln">L</span><span class="pun">];</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">if</span><span class="pun">(</span><span class="kwd">value</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'1'</span><span class="pun">)</span><span class="pln">op</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">({</span><span class="lit">0</span><span class="pun">,</span><span class="pln">n</span><span class="pun">-</span><span class="lit">1</span><span class="pun">});</span><span class="pln"> </span><span class="com">// We want to make all zeroes</span><span class="pln">

    </span><span class="kwd">return</span><span class="pln"> op</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">void</span><span class="pln"> solve</span><span class="pun">(){</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">string</span><span class="pln"> s</span><span class="pun">,</span><span class="pln">t</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> s </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">auto</span><span class="pln"> operation_s </span><span class="pun">=</span><span class="pln"> reduce</span><span class="pun">(</span><span class="pln">s</span><span class="pun">);</span><span class="pln"> </span><span class="com">// operations to reduce s to all zeroes</span><span class="pln">
    </span><span class="kwd">auto</span><span class="pln"> </span><span class="typ">operation_t</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> reduce</span><span class="pun">(</span><span class="pln">t</span><span class="pun">);</span><span class="pln"> </span><span class="com">// operations to reduce t to all zeroes</span><span class="pln">

    reverse</span><span class="pun">(</span><span class="typ">operation_t</span><span class="pun">.</span><span class="kwd">begin</span><span class="pun">(),</span><span class="typ">operation_t</span><span class="pun">.</span><span class="kwd">end</span><span class="pun">());</span><span class="pln">

    </span><span class="kwd">int</span><span class="pln"> moves </span><span class="pun">=</span><span class="pln"> operation_s</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="typ">operation_t</span><span class="pun">.</span><span class="pln">size</span><span class="pun">();</span><span class="pln">
    cout </span><span class="pun">&lt;&lt;</span><span class="pln"> moves </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"\n"</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">auto</span><span class="pln"> </span><span class="pun">&amp;[</span><span class="pln">x</span><span class="pun">,</span><span class="pln">y</span><span class="pun">]</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> operation_s</span><span class="pun">)</span><span class="pln">cout </span><span class="pun">&lt;&lt;</span><span class="pln"> x</span><span class="pun">+</span><span class="lit">1</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">" "</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> y</span><span class="pun">+</span><span class="lit">1</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"\n"</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">auto</span><span class="pln"> </span><span class="pun">&amp;[</span><span class="pln">x</span><span class="pun">,</span><span class="pln">y</span><span class="pun">]</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="typ">operation_t</span><span class="pun">)</span><span class="pln">cout </span><span class="pun">&lt;&lt;</span><span class="pln"> x</span><span class="pun">+</span><span class="lit">1</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">" "</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> y</span><span class="pun">+</span><span class="lit">1</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"\n"</span><span class="pun">;</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">(){</span><span class="pln">
    ios_base</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    cout</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pun">(</span><span class="pln">t</span><span class="pun">--){</span><span class="pln">
        solve</span><span class="pun">();</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2158/problem/E" title="Codeforces Round 1067 (Div. 2)">2158E - Sink</a> Idea &amp; Solution: <a class="rated-user user-orange" href="https://codeforces.com/profile/kingmessi" title="Master kingmessi">kingmessi</a></p> <div class="spoiler"><b class="spoiler-title">Hint 1</b><div class="spoiler-content" style="display: block;"><p>How would you solve the problem if every value in the grid was distinct?</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 2</b><div class="spoiler-content" style="display: block;"><p>When some cells have the same value, is it natural to treat a connected component of equal valued cells as a single group?<br>For such a group, how can you decide whether this entire group <strong>needs</strong> a hole?</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 3</b><div class="spoiler-content" style="display: block;"><p>After a single query (decreasing the value of one cell), can the beauty increase by more than 1?<br>How many groups from previous grid can stop needing a hole because they now have a strictly smaller neighbour? </p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 4</b><div class="spoiler-content" style="display: block;"><p>How can you model the evolution of the grid as a graph, where edges reflect either adjacency in the grid or "time adjacency" between different versions of the same cell?</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 5</b><div class="spoiler-content" style="display: block;"><p>If a cell receives <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-32-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-148" style="width: 0.76em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.544em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.54em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-149"><span class="mi" id="MathJax-Span-150" style="font-family: MathJax_Math-italic;">k</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi></math></span></span><script type="math/tex" id="MathJax-Element-32">k</script> decreasing updates over all queries, can you model it as a chain of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-33-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-151" style="width: 2.925em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.221em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1002.17em, 2.438em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-152"><span class="mi" id="MathJax-Span-153" style="font-family: MathJax_Math-italic;">k</span><span class="mo" id="MathJax-Span-154" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-155" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.211em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi><mo>+</mo><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-33">k+1</script> nodes (one per value over time)?<br>How does connecting each new node to the latest versions of its neighbours help you maintain connected components of equal values efficiently?</p></div></div> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2158/problem/E" title="Codeforces Round 1067 (Div. 2)">2158E - Sink</a></h3><div class="ttypography"><div class="problem-statement"><div><p>We maintain the grid using a graphical representation of each cell. Initially, for every cell <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1061"><span class="MJXp-mo" id="MJXp-Span-1062" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1063">i</span><span class="MJXp-mo" id="MJXp-Span-1064" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1065">j</span><span class="MJXp-mo" id="MJXp-Span-1066" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-213">(i,j)</script> we create one node storing its initial value <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1067"><span class="MJXp-msubsup" id="MJXp-Span-1068"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1069" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1070" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1071">i</span><span class="MJXp-mo" id="MJXp-Span-1072">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1073">j</span></span></span></span></span><script type="math/tex" id="MathJax-Element-214">a_{i,j}</script>. Later, whenever a query decreases the value of a cell, we create a new node representing the updated value of that cell. Thus each cell is represented by a sequence of nodes created over time.</p><p>For every newly created node, we define its <span class="tex-font-style-bf">neighbours</span> as follows. It has up to four neighbours corresponding to the latest created nodes of its grid-adjacent cells, and it also has a neighbour equal to the immediately previous node created for the same cell (if such a node exists). Therefore each node has at most five neighbours.</p><p>We define a <span class="tex-font-style-bf">group</span> to be the connected component in this node-graph consisting of nodes that all have the same value, using adjacency defined exactly as above. That is, a group is a maximal set of nodes of equal value where every node is reachable from every other using only edges between equal-valued neighbours. We maintain these groups using a disjoint-set union structure over all created nodes.</p><p>A group of value <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1074"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1075">v</span></span></span><script type="math/tex" id="MathJax-Element-215">v</script> is declared to be <span class="tex-font-style-bf">important</span> if no node in this group has any neighbour with strictly smaller value than <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1076"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1077">v</span></span></span><script type="math/tex" id="MathJax-Element-216">v</script>. If a group is not a sink, then it is covered by some neighbour of smaller value and does not require a hole. The beauty of the grid is therefore the number of important groups.</p><p>Since queries only decrease values, the behaviour of the structure is very local. When a query decreases the value of cell <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1078"><span class="MJXp-mo" id="MJXp-Span-1079" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1080">i</span><span class="MJXp-mo" id="MJXp-Span-1081" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1082">j</span><span class="MJXp-mo" id="MJXp-Span-1083" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-217">(i,j)</script> to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1084"><span class="MJXp-msup" id="MJXp-Span-1085"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1086" style="margin-right: 0.05em;">v</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1087" style="vertical-align: 0.5em;">′</span></span></span></span><script type="math/tex" id="MathJax-Element-218">v'</script>, we create a new node storing <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1088"><span class="MJXp-msup" id="MJXp-Span-1089"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1090" style="margin-right: 0.05em;">v</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1091" style="vertical-align: 0.5em;">′</span></span></span></span><script type="math/tex" id="MathJax-Element-219">v'</script> and connect it to its at most five neighbours as described earlier. This new node may merge with some of its equal-valued neighbours, forming the new group that contains the updated cell.</p><p>Only the groups touching this new node can possibly change their status as important. There are two kinds of potential changes:</p><p>1. The new group containing the updated node might change from being non-important to an important group if, after the update, it no longer has any strictly smaller neighbour.</p><p>2. Any neighbouring group, whose value is now strictly larger than <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1092"><span class="MJXp-msup" id="MJXp-Span-1093"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1094" style="margin-right: 0.05em;">v</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1095" style="vertical-align: 0.5em;">′</span></span></span></span><script type="math/tex" id="MathJax-Element-220">v'</script>, may change from important to non-important because the updated node becomes a strictly smaller neighbour.</p><p>These checks are straightforward to perform because they involve only the few neighbours of the newly created node. Thus each update requires only constant work apart from the DSU merges.</p><p>After creating the initial <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1096"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1097">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1098">m</span></span></span><script type="math/tex" id="MathJax-Element-221">n m</script> nodes, and after processing each query, we count the groups that are important under the current node graph. This count is exactly the beauty of the grid at that moment.</p><p>Time complexity is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1099"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1100">O</span><span class="MJXp-mo" id="MJXp-Span-1101" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mo" id="MJXp-Span-1102" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1103">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1104">m</span><span class="MJXp-mo" id="MJXp-Span-1105" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1106">q</span><span class="MJXp-mo" id="MJXp-Span-1107" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1108" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1109">α</span><span class="MJXp-mo" id="MJXp-Span-1110" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1111">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1112">m</span><span class="MJXp-mo" id="MJXp-Span-1113" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1114">q</span><span class="MJXp-mo" id="MJXp-Span-1115" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1116" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-222">O((n m + q)\cdot \alpha(n m + q))</script>, where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1117"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1118">α</span></span></span><script type="math/tex" id="MathJax-Element-223">\alpha</script> is the inverse-Ackermann function.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> N </span><span class="pun">=</span><span class="pln"> </span><span class="lit">400005</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> parent</span><span class="pun">[</span><span class="pln">N</span><span class="pun">],</span><span class="pln">siz</span><span class="pun">[</span><span class="pln">N</span><span class="pun">],</span><span class="pln">important</span><span class="pun">[</span><span class="pln">N</span><span class="pun">],</span><span class="pln">val</span><span class="pun">[</span><span class="pln">N</span><span class="pun">];</span><span class="pln">
 
</span><span class="kwd">void</span><span class="pln"> make_set</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> v</span><span class="pun">,</span><span class="kwd">int</span><span class="pln"> x</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    parent</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> v</span><span class="pun">;</span><span class="pln">siz</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">important</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">val</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> x</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> find_set</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> v</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">v </span><span class="pun">==</span><span class="pln"> parent</span><span class="pun">[</span><span class="pln">v</span><span class="pun">])</span><span class="kwd">return</span><span class="pln"> v</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> parent</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> find_set</span><span class="pun">(</span><span class="pln">parent</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]);</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">void</span><span class="pln"> union_sets</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    a </span><span class="pun">=</span><span class="pln"> find_set</span><span class="pun">(</span><span class="pln">a</span><span class="pun">);</span><span class="pln">
    b </span><span class="pun">=</span><span class="pln"> find_set</span><span class="pun">(</span><span class="pln">b</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a </span><span class="pun">!=</span><span class="pln"> b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">siz</span><span class="pun">[</span><span class="pln">a</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> siz</span><span class="pun">[</span><span class="pln">b</span><span class="pun">])</span><span class="pln">swap</span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">);</span><span class="pln">
        parent</span><span class="pun">[</span><span class="pln">b</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">;</span><span class="pln">
        siz</span><span class="pun">[</span><span class="pln">a</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+=</span><span class="pln"> siz</span><span class="pun">[</span><span class="pln">b</span><span class="pun">];</span><span class="pln">
        important</span><span class="pun">[</span><span class="pln">a</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> min</span><span class="pun">(</span><span class="pln">important</span><span class="pun">[</span><span class="pln">a</span><span class="pun">],</span><span class="pln">important</span><span class="pun">[</span><span class="pln">b</span><span class="pun">]);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">,</span><span class="pln">m</span><span class="pun">;</span><span class="pln">
 
vector</span><span class="pun">&lt;</span><span class="pln">array</span><span class="pun">&lt;</span><span class="kwd">int</span><span class="pun">,</span><span class="lit">2</span><span class="pun">&gt;&gt;</span><span class="pln"> neighbours</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> r</span><span class="pun">,</span><span class="kwd">int</span><span class="pln"> c</span><span class="pun">){</span><span class="pln">
    vector</span><span class="pun">&lt;</span><span class="pln">array</span><span class="pun">&lt;</span><span class="kwd">int</span><span class="pun">,</span><span class="lit">2</span><span class="pun">&gt;&gt;</span><span class="pln"> v</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">r</span><span class="pun">)</span><span class="pln">v</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">({</span><span class="pln">r</span><span class="pun">-</span><span class="lit">1</span><span class="pun">,</span><span class="pln">c</span><span class="pun">});</span><span class="pln">
    </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">r</span><span class="pun">+</span><span class="lit">1</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">)</span><span class="pln">v</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">({</span><span class="pln">r</span><span class="pun">+</span><span class="lit">1</span><span class="pun">,</span><span class="pln">c</span><span class="pun">});</span><span class="pln">
    </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">c</span><span class="pun">)</span><span class="pln">v</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">({</span><span class="pln">r</span><span class="pun">,</span><span class="pln">c</span><span class="pun">-</span><span class="lit">1</span><span class="pun">});</span><span class="pln">
    </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">c</span><span class="pun">+</span><span class="lit">1</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> m</span><span class="pun">)</span><span class="pln">v</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">({</span><span class="pln">r</span><span class="pun">,</span><span class="pln">c</span><span class="pun">+</span><span class="lit">1</span><span class="pun">});</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> v</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">void</span><span class="pln"> solve</span><span class="pun">()</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n </span><span class="pun">&gt;&gt;</span><span class="pln"> m</span><span class="pun">;</span><span class="pln">
    vector</span><span class="pun">&lt;</span><span class="pln">vector</span><span class="str">&lt;int&gt;</span><span class="pun">&gt;</span><span class="pln"> a</span><span class="pun">(</span><span class="pln">n</span><span class="pun">,</span><span class="pln">vector</span><span class="str">&lt;int&gt;</span><span class="pun">(</span><span class="pln">m</span><span class="pun">));</span><span class="pln">  </span><span class="com">// latest value of a given cell</span><span class="pln">
    vector</span><span class="pun">&lt;</span><span class="pln">vector</span><span class="str">&lt;int&gt;</span><span class="pun">&gt;</span><span class="pln"> ls</span><span class="pun">(</span><span class="pln">n</span><span class="pun">,</span><span class="pln">vector</span><span class="str">&lt;int&gt;</span><span class="pun">(</span><span class="pln">m</span><span class="pun">));</span><span class="pln"> </span><span class="com">// latest node created for a given cell</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">i</span><span class="pun">++){</span><span class="pln">
        </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">j </span><span class="pun">&lt;</span><span class="pln"> m</span><span class="pun">;</span><span class="pln">j</span><span class="pun">++){</span><span class="pln">
            cin </span><span class="pun">&gt;&gt;</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">];</span><span class="pln">
            ls</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> m</span><span class="pun">*</span><span class="pln">i</span><span class="pun">+</span><span class="pln">j</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
 
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">i</span><span class="pun">++){</span><span class="pln">
        </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">j </span><span class="pun">&lt;</span><span class="pln"> m</span><span class="pun">;</span><span class="pln">j</span><span class="pun">++){</span><span class="pln">
            make_set</span><span class="pun">(</span><span class="pln">m</span><span class="pun">*</span><span class="pln">i</span><span class="pun">+</span><span class="pln">j</span><span class="pun">,</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">]);</span><span class="pln">
            </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">auto</span><span class="pln"> </span><span class="pun">&amp;[</span><span class="pln">p</span><span class="pun">,</span><span class="pln">q</span><span class="pun">]</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> neighbours</span><span class="pun">(</span><span class="pln">i</span><span class="pun">,</span><span class="pln">j</span><span class="pun">)){</span><span class="pln">
                </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">p</span><span class="pun">][</span><span class="pln">q</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">])</span><span class="pln">important</span><span class="pun">[</span><span class="pln">m</span><span class="pun">*</span><span class="pln">i</span><span class="pun">+</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">      
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
 
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">i</span><span class="pun">++){</span><span class="pln">
        </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">j </span><span class="pun">&lt;</span><span class="pln"> m</span><span class="pun">;</span><span class="pln">j</span><span class="pun">++){</span><span class="pln">
            </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">auto</span><span class="pln"> </span><span class="pun">&amp;[</span><span class="pln">p</span><span class="pun">,</span><span class="pln">q</span><span class="pun">]</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> neighbours</span><span class="pun">(</span><span class="pln">i</span><span class="pun">,</span><span class="pln">j</span><span class="pun">)){</span><span class="pln">
                </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">p</span><span class="pun">][</span><span class="pln">q</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">])</span><span class="pln">union_sets</span><span class="pun">(</span><span class="pln">m</span><span class="pun">*</span><span class="pln">i</span><span class="pun">+</span><span class="pln">j</span><span class="pun">,</span><span class="pln">m</span><span class="pun">*</span><span class="pln">p</span><span class="pun">+</span><span class="pln">q</span><span class="pun">);</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
 
    </span><span class="kwd">int</span><span class="pln"> ans </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">i</span><span class="pun">++){</span><span class="pln">
        </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">j </span><span class="pun">&lt;</span><span class="pln"> m</span><span class="pun">;</span><span class="pln">j</span><span class="pun">++){</span><span class="pln">
            </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">parent</span><span class="pun">[</span><span class="pln">m</span><span class="pun">*</span><span class="pln">i</span><span class="pun">+</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> m</span><span class="pun">*</span><span class="pln">i</span><span class="pun">+</span><span class="pln">j</span><span class="pun">)</span><span class="pln">ans</span><span class="pun">+=</span><span class="pln">important</span><span class="pun">[</span><span class="pln">m</span><span class="pun">*</span><span class="pln">i</span><span class="pun">+</span><span class="pln">j</span><span class="pun">];</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    
    cout </span><span class="pun">&lt;&lt;</span><span class="pln"> ans </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"\n"</span><span class="pun">;</span><span class="pln">
 
    </span><span class="kwd">int</span><span class="pln"> q</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> q</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> nd </span><span class="pun">=</span><span class="pln"> n</span><span class="pun">*</span><span class="pln">m</span><span class="pun">;</span><span class="pln">
 
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">i </span><span class="pun">&lt;</span><span class="pln"> q</span><span class="pun">;</span><span class="pln">i</span><span class="pun">++){</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> r</span><span class="pun">,</span><span class="pln">c</span><span class="pun">,</span><span class="pln">x</span><span class="pun">;</span><span class="pln">
        cin </span><span class="pun">&gt;&gt;</span><span class="pln"> r </span><span class="pun">&gt;&gt;</span><span class="pln"> c </span><span class="pun">&gt;&gt;</span><span class="pln"> x</span><span class="pun">;</span><span class="pln">
        r</span><span class="pun">--;</span><span class="pln">c</span><span class="pun">--;</span><span class="pln">
        x </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">r</span><span class="pun">][</span><span class="pln">c</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> x</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">set</span><span class="str">&lt;int&gt;</span><span class="pln"> s</span><span class="pun">;</span><span class="pln">
 
        </span><span class="kwd">int</span><span class="pln"> mn </span><span class="pun">=</span><span class="pln"> INT_MAX</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">auto</span><span class="pln"> </span><span class="pun">&amp;[</span><span class="pln">p</span><span class="pun">,</span><span class="pln">q</span><span class="pun">]</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> neighbours</span><span class="pun">(</span><span class="pln">r</span><span class="pun">,</span><span class="pln">c</span><span class="pun">)){</span><span class="pln">
            s</span><span class="pun">.</span><span class="pln">insert</span><span class="pun">(</span><span class="pln">find_set</span><span class="pun">(</span><span class="pln">ls</span><span class="pun">[</span><span class="pln">p</span><span class="pun">][</span><span class="pln">q</span><span class="pun">]));</span><span class="pln">
            mn </span><span class="pun">=</span><span class="pln"> min</span><span class="pun">(</span><span class="pln">mn</span><span class="pun">,</span><span class="pln">a</span><span class="pun">[</span><span class="pln">p</span><span class="pun">][</span><span class="pln">q</span><span class="pun">]);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        s</span><span class="pun">.</span><span class="pln">insert</span><span class="pun">(</span><span class="pln">find_set</span><span class="pun">(</span><span class="pln">ls</span><span class="pun">[</span><span class="pln">r</span><span class="pun">][</span><span class="pln">c</span><span class="pun">]));</span><span class="pln">
 
        </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">auto</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">y </span><span class="pun">:</span><span class="pln"> s</span><span class="pun">){</span><span class="pln">
            ans </span><span class="pun">-=</span><span class="pln"> important</span><span class="pun">[</span><span class="pln">y</span><span class="pun">];</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
 
        </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">auto</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">y </span><span class="pun">:</span><span class="pln"> s</span><span class="pun">){</span><span class="pln">
            </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">val</span><span class="pun">[</span><span class="pln">y</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> x</span><span class="pun">)</span><span class="pln">important</span><span class="pun">[</span><span class="pln">y</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
 
        make_set</span><span class="pun">(</span><span class="pln">nd</span><span class="pun">,</span><span class="pln">x</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">mn </span><span class="pun">&lt;</span><span class="pln"> x</span><span class="pun">)</span><span class="pln">important</span><span class="pun">[</span><span class="pln">nd</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">else</span><span class="pln"> important</span><span class="pun">[</span><span class="pln">nd</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
 
 
        </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">auto</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">y </span><span class="pun">:</span><span class="pln"> s</span><span class="pun">){</span><span class="pln">
            </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">val</span><span class="pun">[</span><span class="pln">y</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> x</span><span class="pun">){</span><span class="pln">
                union_sets</span><span class="pun">(</span><span class="pln">y</span><span class="pun">,</span><span class="pln">nd</span><span class="pun">);</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
 
        a</span><span class="pun">[</span><span class="pln">r</span><span class="pun">][</span><span class="pln">c</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> x</span><span class="pun">;</span><span class="pln">
        ls</span><span class="pun">[</span><span class="pln">r</span><span class="pun">][</span><span class="pln">c</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> nd</span><span class="pun">++;</span><span class="pln">
 
        s</span><span class="pun">.</span><span class="pln">clear</span><span class="pun">();</span><span class="pln">
        </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">auto</span><span class="pln"> </span><span class="pun">&amp;[</span><span class="pln">p</span><span class="pun">,</span><span class="pln">q</span><span class="pun">]</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> neighbours</span><span class="pun">(</span><span class="pln">r</span><span class="pun">,</span><span class="pln">c</span><span class="pun">)){</span><span class="pln">
            s</span><span class="pun">.</span><span class="pln">insert</span><span class="pun">(</span><span class="pln">find_set</span><span class="pun">(</span><span class="pln">ls</span><span class="pun">[</span><span class="pln">p</span><span class="pun">][</span><span class="pln">q</span><span class="pun">]));</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        s</span><span class="pun">.</span><span class="pln">insert</span><span class="pun">(</span><span class="pln">find_set</span><span class="pun">(</span><span class="pln">ls</span><span class="pun">[</span><span class="pln">r</span><span class="pun">][</span><span class="pln">c</span><span class="pun">]));</span><span class="pln">
 
        </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">auto</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">y </span><span class="pun">:</span><span class="pln"> s</span><span class="pun">){</span><span class="pln">
            ans </span><span class="pun">+=</span><span class="pln"> important</span><span class="pun">[</span><span class="pln">y</span><span class="pun">];</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
 
        cout </span><span class="pun">&lt;&lt;</span><span class="pln"> ans </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"\n"</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
 
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">signed</span><span class="pln"> main</span><span class="pun">(){</span><span class="pln">
    ios_base</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    cout</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pun">(</span><span class="pln">t</span><span class="pun">--)</span><span class="pln">
        solve</span><span class="pun">();</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2158/problem/F2" title="Codeforces Round 1067 (Div. 2)">2158F2 - Distinct GCDs (Hard Version)</a> Idea &amp; Solution: <a class="rated-user user-violet" href="https://codeforces.com/profile/koderkushy" title="Candidate Master koderkushy">koderkushy</a></p> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2158/problem/F2" title="Codeforces Round 1067 (Div. 2)">2158F2 - Distinct GCDs (Hard Version)</a></h3><div class="ttypography"><div class="problem-statement"><div><p>Say we are using <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1119"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1120">k</span></span></span><script type="math/tex" id="MathJax-Element-224">k</script> distinct elements denoted by <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1121"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1122">X</span><span class="MJXp-mo" id="MJXp-Span-1123" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-1124" style="margin-left: 0em; margin-right: 0em;">{</span><span class="MJXp-msubsup" id="MJXp-Span-1125"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1126" style="margin-right: 0.05em;">x</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1127" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-1128" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1129"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1130" style="margin-right: 0.05em;">x</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1131" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1132" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-1133" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-1134" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1135"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1136" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1137" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-mo" id="MJXp-Span-1138" style="margin-left: 0em; margin-right: 0em;">}</span></span></span><script type="math/tex" id="MathJax-Element-225">X = \{x_1,x_2,\dots,x_k\}</script>. What is the maximum length of an integer sequence <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1139"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1140">a</span></span></span><script type="math/tex" id="MathJax-Element-226">a</script> such that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1141"><span class="MJXp-mi" id="MJXp-Span-1142">∀</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1143">i</span></span></span><script type="math/tex" id="MathJax-Element-227">\forall i</script> <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1144"><span class="MJXp-msubsup" id="MJXp-Span-1145"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1146" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1147" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1148" style="margin-left: 0.333em; margin-right: 0.333em;">∈</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1149">X</span></span></span><script type="math/tex" id="MathJax-Element-228">a_i \in X</script> and GCDs of pairwise adjacent elements of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1150"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1151">a</span></span></span><script type="math/tex" id="MathJax-Element-229">a</script> are all distinct?</p><p>Construct an undirected complete graph with <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1152"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1153">X</span></span></span><script type="math/tex" id="MathJax-Element-230">X</script> as the set of vertices and label the edge between <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1154"><span class="MJXp-msubsup" id="MJXp-Span-1155"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1156" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1157" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-231">x_i</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1158"><span class="MJXp-msubsup" id="MJXp-Span-1159"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1160" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1161" style="vertical-align: -0.4em;">j</span></span></span></span><script type="math/tex" id="MathJax-Element-232">x_j</script> with <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1162"><span class="MJXp-mo" id="MJXp-Span-1163" style="margin-left: 0.333em; margin-right: 0.333em;">gcd</span><span class="MJXp-mo" id="MJXp-Span-1164" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1165"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1166" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1167" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1168" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1169"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1170" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1171" style="vertical-align: -0.4em;">j</span></span><span class="MJXp-mo" id="MJXp-Span-1172" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-233">\gcd(x_i, x_j)</script> for all valid <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1173"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1174">i</span><span class="MJXp-mo" id="MJXp-Span-1175" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1176">j</span></span></span><script type="math/tex" id="MathJax-Element-234">i,j</script> (loops with <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1177"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1178">i</span><span class="MJXp-mo" id="MJXp-Span-1179" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1180">j</span></span></span><script type="math/tex" id="MathJax-Element-235">i=j</script> too). If all the edge labels are distinct, an upper bound to the above question is the length of the longest path in this graph that visits any edge at most once.</p><p>For odd <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1181"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1182">k</span></span></span><script type="math/tex" id="MathJax-Element-236">k</script>, it is possible to visit all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1183"><span class="MJXp-mfrac" id="MJXp-Span-1184" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1185">k</span><span class="MJXp-mo" id="MJXp-Span-1186">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1187">k</span><span class="MJXp-mo" id="MJXp-Span-1188">+</span><span class="MJXp-mn" id="MJXp-Span-1189">1</span><span class="MJXp-mo" id="MJXp-Span-1190">)</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mn" id="MJXp-Span-1191">2</span></span></span></span></span></span></span></span><script type="math/tex" id="MathJax-Element-237">\frac{k(k+1)}{2}</script> edges and such a path is called an <a href="https://en.wikipedia.org/wiki/Eulerian_path">Eulerian tour</a>. No graph with other than zero or two odd-degree vertices can have an Euler tour as only the first and last nodes of the path may have odd degrees (and none if they coincide). Thus, for even <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1192"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1193">k</span></span></span><script type="math/tex" id="MathJax-Element-238">k</script> we need to flip the degree parity of at least <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1194"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1195">k</span><span class="MJXp-mo" id="MJXp-Span-1196" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-1197">2</span></span></span><script type="math/tex" id="MathJax-Element-239">k-2</script> vertices. The optimal way to do that is by deleting a <a href="https://en.wikipedia.org/wiki/Matching_(graph_theory)">matching</a> of size <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1198"><span class="MJXp-mfrac" id="MJXp-Span-1199" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1200">k</span><span class="MJXp-mo" id="MJXp-Span-1201">−</span><span class="MJXp-mn" id="MJXp-Span-1202">2</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mn" id="MJXp-Span-1203">2</span></span></span></span></span></span></span></span><script type="math/tex" id="MathJax-Element-240">\frac{k-2}{2}</script>. Thus the maximum length of such a path is</p><p><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-1204"><span class="MJXp-mfrac" id="MJXp-Span-1205" style="vertical-align: 0.25em;"><span class="MJXp-box"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1206">k</span><span class="MJXp-mo" id="MJXp-Span-1207" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1208">k</span><span class="MJXp-mo" id="MJXp-Span-1209" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-1210">1</span><span class="MJXp-mo" id="MJXp-Span-1211" style="margin-left: 0em; margin-right: 0em;">)</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box"><span class="MJXp-mn" id="MJXp-Span-1212">2</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-1213" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mfrac" id="MJXp-Span-1214" style="vertical-align: 0.25em;"><span class="MJXp-box"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1215">k</span><span class="MJXp-mo" id="MJXp-Span-1216" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-1217">2</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box"><span class="MJXp-mn" id="MJXp-Span-1218">2</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-1219" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mfrac" id="MJXp-Span-1220" style="vertical-align: 0.25em;"><span class="MJXp-box"><span class="MJXp-msubsup" id="MJXp-Span-1221"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1222" style="margin-right: 0.05em;">k</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1223" style="vertical-align: 0.5em;">2</span></span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box"><span class="MJXp-mn" id="MJXp-Span-1224">2</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-1225" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-1226">1</span></span></span><script type="math/tex; mode=display" id="MathJax-Element-241">\frac{k(k+1)}{2}−\frac{k-2}{2}=\frac{k^2}{2}+1</script></p><p>Constructing an Eulerian tour has a simple solution described <a href="https://cp-algorithms.com/graph/euler_path.html">here</a></p><p>Now, it remains to find <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1227"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1228">X</span></span></span><script type="math/tex" id="MathJax-Element-242">X</script> such that the edge labels are all distinct, i.e., <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1229"><span class="MJXp-mo" id="MJXp-Span-1230" style="margin-left: 0.333em; margin-right: 0.333em;">gcd</span><span class="MJXp-mo" id="MJXp-Span-1231" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1232"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1233" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1234" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1235" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1236"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1237" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1238" style="vertical-align: -0.4em;">j</span></span><span class="MJXp-mo" id="MJXp-Span-1239" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-243">\gcd(x_i,x_j)</script> are all pairwise distinct for all unordered pairs <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1240"><span class="MJXp-mo" id="MJXp-Span-1241" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1242">i</span><span class="MJXp-mo" id="MJXp-Span-1243" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1244">j</span><span class="MJXp-mo" id="MJXp-Span-1245" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-244">(i,j)</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1246"><span class="MJXp-msubsup" id="MJXp-Span-1247"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1248" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1249" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1250" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-msubsup" id="MJXp-Span-1251"><span class="MJXp-mn" id="MJXp-Span-1252" style="margin-right: 0.05em;">10</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1253" style="vertical-align: 0.5em;"><span class="MJXp-mn" id="MJXp-Span-1254">18</span></span></span></span></span><script type="math/tex" id="MathJax-Element-245">x_i \leq 10^{18}</script>. For the easy version of the problem, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1255"><span class="MJXp-msubsup" id="MJXp-Span-1256"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1257" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1258" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1259" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-1260"><span class="MJXp-mn" id="MJXp-Span-1261" style="margin-right: 0.05em;">2</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1262" style="vertical-align: 0.5em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1263">i</span><span class="MJXp-mo" id="MJXp-Span-1264">−</span><span class="MJXp-mn" id="MJXp-Span-1265">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-1266" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-msubsup" id="MJXp-Span-1267"><span class="MJXp-mn" id="MJXp-Span-1268" style="margin-right: 0.05em;">3</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1269" style="vertical-align: 0.5em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1270">k</span><span class="MJXp-mo" id="MJXp-Span-1271">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1272">i</span></span></span></span></span><script type="math/tex" id="MathJax-Element-246">x_i = 2^{i-1} \cdot 3^{k-i}</script> will suffice. For the hard version, we can improve by extending the above to higher dimensions as</p><p><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-1273"><span class="MJXp-msubsup" id="MJXp-Span-1274"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1275" style="margin-right: 0.05em;">x</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1276" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1277">i</span><span class="MJXp-mo" id="MJXp-Span-1278">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1279">j</span><span class="MJXp-mo" id="MJXp-Span-1280">⋅</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1281">M</span></span></span><span class="MJXp-mo" id="MJXp-Span-1282" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-1283"><span class="MJXp-mn" id="MJXp-Span-1284" style="margin-right: 0.05em;">2</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1285" style="vertical-align: 0.5em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1286">i</span><span class="MJXp-mo" id="MJXp-Span-1287">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1288">j</span></span></span><span class="MJXp-mo" id="MJXp-Span-1289" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-msubsup" id="MJXp-Span-1290"><span class="MJXp-mn" id="MJXp-Span-1291" style="margin-right: 0.05em;">3</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1292" style="vertical-align: 0.5em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1293">i</span></span></span><span class="MJXp-mo" id="MJXp-Span-1294" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-msubsup" id="MJXp-Span-1295"><span class="MJXp-mn" id="MJXp-Span-1296" style="margin-right: 0.05em;">5</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1297" style="vertical-align: 0.5em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1298">M</span><span class="MJXp-mo" id="MJXp-Span-1299">−</span><span class="MJXp-mn" id="MJXp-Span-1300">1</span><span class="MJXp-mo" id="MJXp-Span-1301">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1302">i</span></span></span><span class="MJXp-mo" id="MJXp-Span-1303" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-msubsup" id="MJXp-Span-1304"><span class="MJXp-mn" id="MJXp-Span-1305" style="margin-right: 0.05em;">7</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1306" style="vertical-align: 0.5em;">j</span></span><span class="MJXp-mo" id="MJXp-Span-1307" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-msubsup" id="MJXp-Span-1308"><span class="MJXp-mn" id="MJXp-Span-1309" style="margin-right: 0.05em;">11</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1310" style="vertical-align: 0.5em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1311">M</span><span class="MJXp-mo" id="MJXp-Span-1312">−</span><span class="MJXp-mn" id="MJXp-Span-1313">1</span><span class="MJXp-mo" id="MJXp-Span-1314">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1315">j</span></span></span><span class="MJXp-mtext" id="MJXp-Span-1316">&nbsp;</span><span class="MJXp-mi" id="MJXp-Span-1317">∀</span><span class="MJXp-mn" id="MJXp-Span-1318">0</span><span class="MJXp-mo" id="MJXp-Span-1319" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1320">i</span><span class="MJXp-mo" id="MJXp-Span-1321" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1322">j</span><span class="MJXp-mo" id="MJXp-Span-1323" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1324">M</span></span></span><script type="math/tex; mode=display" id="MathJax-Element-247">x_{i + j\cdot M} = 2^{i+j} \cdot 3^{i} \cdot 5^{M-1-i} \cdot 7^j \cdot 11^{M-1-j} \text{ }\forall 0\leq i,j \lt M</script></p><p>Set <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1325"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1326">M</span><span class="MJXp-mo" id="MJXp-Span-1327" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-1328">10</span></span></span><script type="math/tex" id="MathJax-Element-248">M=10</script> to get <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1329"><span class="MJXp-mrow" id="MJXp-Span-1330"><span class="MJXp-mo" id="MJXp-Span-1331" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1332">X</span><span class="MJXp-mrow" id="MJXp-Span-1333"><span class="MJXp-mo" id="MJXp-Span-1334" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mo" id="MJXp-Span-1335" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-1336">100</span></span></span><script type="math/tex" id="MathJax-Element-249">|X|=100</script> that allows us to construct <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1337"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1338">a</span></span></span><script type="math/tex" id="MathJax-Element-250">a</script> with over <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1339"><span class="MJXp-mn" id="MJXp-Span-1340">5000</span></span></span><script type="math/tex" id="MathJax-Element-251">5000</script> integers.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Solution (Python)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="kwd">from</span><span class="pln"> copy </span><span class="kwd">import</span><span class="pln"> deepcopy

</span><span class="kwd">def</span><span class="pln"> get_nums</span><span class="pun">(</span><span class="pln">k</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">=</span><span class="lit">10</span><span class="pun">):</span><span class="pln">
    nums </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">
        </span><span class="lit">2</span><span class="pun">**(</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> j</span><span class="pun">)</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="lit">3</span><span class="pun">**</span><span class="pln">i </span><span class="pun">*</span><span class="pln"> </span><span class="lit">5</span><span class="pun">**</span><span class="pln">j </span><span class="pun">*</span><span class="pln"> </span><span class="lit">7</span><span class="pun">**(</span><span class="pln">k</span><span class="pun">-</span><span class="lit">1</span><span class="pun">-</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="lit">11</span><span class="pun">**(</span><span class="pln">k</span><span class="pun">-</span><span class="lit">1</span><span class="pun">-</span><span class="pln">j</span><span class="pun">)</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> i </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="pln">k</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> j </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="pln">k</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">]</span><span class="pln">

    </span><span class="kwd">return</span><span class="pln"> nums

</span><span class="kwd">def</span><span class="pln"> eulerian_paths</span><span class="pun">(</span><span class="pln">max_k</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">100</span><span class="pun">):</span><span class="pln">
    paths </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[[],</span><span class="pln"> </span><span class="pun">[</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">],</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="lit">1</span><span class="pun">,</span><span class="lit">0</span><span class="pun">,</span><span class="lit">0</span><span class="pun">]]</span><span class="pln">

    </span><span class="kwd">for</span><span class="pln"> k </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="lit">3</span><span class="pun">,</span><span class="pln"> max_k </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">):</span><span class="pln">
        path </span><span class="pun">=</span><span class="pln"> deepcopy</span><span class="pun">(</span><span class="pln">paths</span><span class="pun">[</span><span class="pln">k </span><span class="pun">-</span><span class="pln"> </span><span class="lit">2</span><span class="pun">])</span><span class="pln">
        x</span><span class="pun">,</span><span class="pln"> y </span><span class="pun">=</span><span class="pln"> k</span><span class="pun">-</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> k</span><span class="pun">-</span><span class="lit">1</span><span class="pln">

        </span><span class="kwd">if</span><span class="pln"> k </span><span class="pun">%</span><span class="pln"> </span><span class="lit">2</span><span class="pun">:</span><span class="pln">
            path</span><span class="pun">.</span><span class="pln">extend</span><span class="pun">([</span><span class="pln">x</span><span class="pun">,</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> y</span><span class="pun">,</span><span class="pln"> y</span><span class="pun">])</span><span class="pln">
            </span><span class="kwd">for</span><span class="pln"> j </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">):</span><span class="pln">
                path</span><span class="pun">.</span><span class="pln">extend</span><span class="pun">([</span><span class="pln">j</span><span class="pun">,</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> j</span><span class="pun">+</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> y</span><span class="pun">])</span><span class="pln">
            path</span><span class="pun">.</span><span class="pln">append</span><span class="pun">(</span><span class="lit">0</span><span class="pun">)</span><span class="pln">
        </span><span class="kwd">else</span><span class="pun">:</span><span class="pln">
            path</span><span class="pun">.</span><span class="pln">extend</span><span class="pun">([</span><span class="pln">x</span><span class="pun">,</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> y</span><span class="pun">,</span><span class="pln"> y</span><span class="pun">])</span><span class="pln">
            </span><span class="kwd">for</span><span class="pln"> j </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">):</span><span class="pln">
                path</span><span class="pun">.</span><span class="pln">extend</span><span class="pun">([</span><span class="pln">j</span><span class="pun">,</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> j</span><span class="pun">+</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> y</span><span class="pun">])</span><span class="pln">
            path</span><span class="pun">.</span><span class="pln">append</span><span class="pun">(</span><span class="lit">0</span><span class="pun">)</span><span class="pln">

        paths</span><span class="pun">.</span><span class="pln">append</span><span class="pun">(</span><span class="pln">path</span><span class="pun">)</span><span class="pln">

    </span><span class="kwd">return</span><span class="pln"> paths

</span><span class="kwd">def</span><span class="pln"> path_len</span><span class="pun">(</span><span class="pln">k</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">):</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="pun">(</span><span class="pln">k</span><span class="pun">*</span><span class="pln">k</span><span class="pun">+</span><span class="pln">k</span><span class="pun">)</span><span class="com">//2 - (0 if k%2 else k//2-1)</span><span class="pln">

</span><span class="kwd">if</span><span class="pln"> __name__ </span><span class="pun">==</span><span class="pln"> </span><span class="str">"__main__"</span><span class="pun">:</span><span class="pln">
    nums </span><span class="pun">=</span><span class="pln"> get_nums</span><span class="pun">(</span><span class="lit">10</span><span class="pun">)</span><span class="pln">
    paths </span><span class="pun">=</span><span class="pln"> eulerian_paths</span><span class="pun">(</span><span class="lit">100</span><span class="pun">)</span><span class="pln">

    </span><span class="kwd">for</span><span class="pln"> i </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">101</span><span class="pun">):</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> len</span><span class="pun">(</span><span class="pln">paths</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> path_len</span><span class="pun">(</span><span class="pln">i</span><span class="pun">)</span><span class="pln">

    t </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">(</span><span class="pln">input</span><span class="pun">())</span><span class="pln">

    </span><span class="kwd">for</span><span class="pln"> _ </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="pln">t</span><span class="pun">):</span><span class="pln">
        n </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">(</span><span class="pln">input</span><span class="pun">())</span><span class="pln">

        l</span><span class="pun">,</span><span class="pln"> r </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">100</span><span class="pln">
        </span><span class="kwd">while</span><span class="pln"> l </span><span class="pun">&lt;</span><span class="pln"> r</span><span class="pun">-</span><span class="lit">1</span><span class="pun">:</span><span class="pln">
            m </span><span class="pun">=</span><span class="pln"> r </span><span class="pun">-</span><span class="pln"> </span><span class="pun">(</span><span class="pln">r</span><span class="pun">-</span><span class="pln">l</span><span class="pun">)</span><span class="com">//2</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> path_len</span><span class="pun">(</span><span class="pln">m</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">:</span><span class="pln">
                l </span><span class="pun">=</span><span class="pln"> m
            </span><span class="kwd">else</span><span class="pun">:</span><span class="pln">
                r </span><span class="pun">=</span><span class="pln"> m

        path </span><span class="pun">=</span><span class="pln"> paths</span><span class="pun">[</span><span class="pln">r</span><span class="pun">]</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> len</span><span class="pun">(</span><span class="pln">path</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&gt;=</span><span class="pln"> n

        a </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">nums</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> i </span><span class="kwd">in</span><span class="pln"> path</span><span class="pun">[:</span><span class="pln"> n</span><span class="pun">]]</span><span class="pln">
        </span><span class="kwd">print</span><span class="pun">(*</span><span class="pln">a</span><span class="pun">)</span><span class="pln">

</span></code></pre></div></div> <div class="spoiler"><b class="spoiler-title">Solution (C++)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pln"> </span><span class="str">"bits/stdc++.h"</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">


</span><span class="kwd">constexpr</span><span class="pln"> </span><span class="typ">int64_t</span><span class="pln"> poww </span><span class="pun">(</span><span class="typ">int64_t</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> </span><span class="typ">int64_t</span><span class="pln"> p</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pun">(</span><span class="pln">p </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    </span><span class="typ">int64_t</span><span class="pln"> res </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">p </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">p </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> res </span><span class="pun">*=</span><span class="pln"> a</span><span class="pun">;</span><span class="pln">
        a </span><span class="pun">*=</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> p </span><span class="pun">&gt;&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> res</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">constexpr</span><span class="pln"> </span><span class="typ">int32_t</span><span class="pln"> path_len</span><span class="pun">(</span><span class="kwd">const</span><span class="pln"> </span><span class="typ">int32_t</span><span class="pln"> n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="kwd">return</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="pun">(</span><span class="pln">n</span><span class="pun">*</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">(</span><span class="pln">n </span><span class="pun">%</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="lit">0</span><span class="pun">:</span><span class="pln"> n</span><span class="pun">/</span><span class="lit">2</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

vector nums</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0ll</span><span class="pun">);</span><span class="pln">
vector walks</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> vector</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">));</span><span class="pln">

</span><span class="kwd">void</span><span class="pln"> load_nums</span><span class="pun">(</span><span class="kwd">const</span><span class="pln"> </span><span class="typ">size_t</span><span class="pln"> p</span><span class="pun">=</span><span class="lit">10</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	nums</span><span class="pun">.</span><span class="pln">resize</span><span class="pun">(</span><span class="pln">p </span><span class="pun">*</span><span class="pln"> p</span><span class="pun">);</span><span class="pln">

	</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> p</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln">
		</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;</span><span class="pln"> p</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">j</span><span class="pun">)</span><span class="pln">
			nums</span><span class="pun">[</span><span class="pln">i </span><span class="pun">*</span><span class="pln"> </span><span class="lit">10</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> poww</span><span class="pun">(</span><span class="lit">2</span><span class="pun">,(</span><span class="pln">i</span><span class="pun">+</span><span class="pln">j</span><span class="pun">))</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> poww</span><span class="pun">(</span><span class="lit">3</span><span class="pun">,</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> poww</span><span class="pun">(</span><span class="lit">5</span><span class="pun">,</span><span class="pln">j</span><span class="pun">)</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> poww</span><span class="pun">(</span><span class="lit">7</span><span class="pun">,(</span><span class="lit">9</span><span class="pun">-</span><span class="pln">i</span><span class="pun">))</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> poww</span><span class="pun">(</span><span class="lit">11</span><span class="pun">,(</span><span class="lit">9</span><span class="pun">-</span><span class="pln">j</span><span class="pun">));</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">void</span><span class="pln"> load_walks</span><span class="pun">(</span><span class="kwd">const</span><span class="pln"> </span><span class="typ">size_t</span><span class="pln"> max_k</span><span class="pun">=</span><span class="lit">100</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	walks</span><span class="pun">.</span><span class="pln">resize</span><span class="pun">(</span><span class="pln">max_k </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
	walks</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> vector</span><span class="pun">({</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">});</span><span class="pln">
	walks</span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> vector</span><span class="pun">({</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">});</span><span class="pln">

	</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> k </span><span class="pun">=</span><span class="pln"> </span><span class="lit">3</span><span class="pun">;</span><span class="pln"> k </span><span class="pun">&lt;=</span><span class="pln"> max_k</span><span class="pun">;</span><span class="pln"> k</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">auto</span><span class="pun">&amp;</span><span class="pln"> walk </span><span class="pun">=</span><span class="pln"> walks</span><span class="pun">[</span><span class="pln">k</span><span class="pun">];</span><span class="pln">
		walk </span><span class="pun">=</span><span class="pln"> walks</span><span class="pun">[</span><span class="pln">k </span><span class="pun">-</span><span class="pln"> </span><span class="lit">2</span><span class="pun">];</span><span class="pln">
		</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> x </span><span class="pun">=</span><span class="pln"> k</span><span class="pun">-</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> y </span><span class="pun">=</span><span class="pln"> k</span><span class="pun">-</span><span class="lit">1</span><span class="pun">;</span><span class="pln">

		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">k </span><span class="pun">%</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			walk</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">x</span><span class="pun">);</span><span class="pln">
			walk</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">x</span><span class="pun">);</span><span class="pln">
			walk</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">y</span><span class="pun">);</span><span class="pln">
			walk</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">y</span><span class="pun">);</span><span class="pln">
			</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;</span><span class="pln"> x</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">+=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln">
				walk</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">j</span><span class="pun">),</span><span class="pln">
				walk</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">x</span><span class="pun">),</span><span class="pln">
				walk</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">j</span><span class="pun">+</span><span class="lit">1</span><span class="pun">),</span><span class="pln">
				walk</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">y</span><span class="pun">);</span><span class="pln">
			walk</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
		</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			walk</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">x</span><span class="pun">);</span><span class="pln">
			walk</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">x</span><span class="pun">);</span><span class="pln">
			walk</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">(</span><span class="lit">1</span><span class="pun">);</span><span class="pln">
			walk</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">y</span><span class="pun">);</span><span class="pln">
			walk</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">y</span><span class="pun">);</span><span class="pln">
			</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;</span><span class="pln"> x</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">+=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln">
				walk</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">j</span><span class="pun">),</span><span class="pln">
				walk</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">x</span><span class="pun">),</span><span class="pln">
				walk</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">j</span><span class="pun">+</span><span class="lit">1</span><span class="pun">),</span><span class="pln">
				walk</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">y</span><span class="pun">);</span><span class="pln">
			walk</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">void</span><span class="pln"> solve </span><span class="pun">(</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> kase</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">int</span><span class="pln"> l </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> r </span><span class="pun">=</span><span class="pln"> </span><span class="lit">100</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l </span><span class="pun">&lt;</span><span class="pln"> r </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    	</span><span class="kwd">int</span><span class="pln"> m </span><span class="pun">=</span><span class="pln"> r </span><span class="pun">-</span><span class="pln"> </span><span class="pun">(</span><span class="pln">r</span><span class="pun">-</span><span class="pln">l</span><span class="pun">)</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln">
    	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">path_len</span><span class="pun">(</span><span class="pln">m</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">)</span><span class="pln">
    		l </span><span class="pun">=</span><span class="pln"> m</span><span class="pun">;</span><span class="pln">
    	</span><span class="kwd">else</span><span class="pln">
    		r </span><span class="pun">=</span><span class="pln"> m</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    vector a</span><span class="pun">(</span><span class="pln">n</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0ll</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="typ">size_t</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    	a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> nums</span><span class="pun">[</span><span class="pln">walks</span><span class="pun">[</span><span class="pln">r</span><span class="pun">][</span><span class="pln">i</span><span class="pun">]];</span><span class="pln">
    	cout </span><span class="pun">&lt;&lt;</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">' '</span><span class="pln"> </span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    vector gcds</span><span class="pun">(</span><span class="pln">n</span><span class="pun">-</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0ll</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="typ">size_t</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    	gcds</span><span class="pun">[</span><span class="pln">i</span><span class="pun">-</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> gcd</span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">],</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">assert</span><span class="pun">(</span><span class="kwd">set</span><span class="pun">(</span><span class="pln">gcds</span><span class="pun">.</span><span class="kwd">begin</span><span class="pun">(),</span><span class="pln"> gcds</span><span class="pun">.</span><span class="kwd">end</span><span class="pun">()).</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> n</span><span class="pun">-</span><span class="lit">1</span><span class="pun">);</span><span class="pln">

    cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> main </span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    ios_base</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="lit">0</span><span class="pun">),</span><span class="pln"> cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">

    load_nums</span><span class="pun">();</span><span class="pln">
    load_walks</span><span class="pun">();</span><span class="pln">

    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="typ">size_t</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">101</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln">
    	</span><span class="kwd">assert</span><span class="pun">(</span><span class="pln">walks</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> path_len</span><span class="pun">(</span><span class="pln">i</span><span class="pun">));</span><span class="pln">

    </span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">;</span><span class="pln"> cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">assert</span><span class="pun">(</span><span class="pln">t </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> t</span><span class="pun">--;</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        solve</span><span class="pun">(++</span><span class="pln">i</span><span class="pun">);</span><span class="pln">

</span><span class="pun">}</span></code></pre></div></div></div>

    </div>


        <div style="font-size: 1.1rem;line-height: 1.1rem;padding-bottom: 0.5em;">
            <img src="https://codeforces.com//codeforces.com/codeforces.org/s/52448/images/icons/paperclip-16x16.png" style="vertical-align: middle;"> <span style="padding: 0 0.35em;">Tutorial of <a href="https://codeforces.com/contest/2158" class="notice" style="text-decoration: none;">Codeforces Round 1067 (Div. 2)</a> </span>
        </div>
        
            

  <script>
    // Make all spoilers toggleable
    document.querySelectorAll('.spoiler-title').forEach(title => {
      title.addEventListener('click', function() {
        const spoiler = this.closest('.spoiler');
        spoiler.classList.toggle('open');
      });
    });
    
    // Open all spoilers by default for easier reading
    document.querySelectorAll('.spoiler').forEach(spoiler => {
      spoiler.classList.add('open');
    });
  </script>
</body>
</html>