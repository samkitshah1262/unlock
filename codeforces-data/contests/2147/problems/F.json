{
  "contestId": 2147,
  "index": "F",
  "title": "Exchange Queries",
  "timeLimit": "2 seconds",
  "memoryLimit": "256 megabytes",
  "rating": 2800,
  "tags": [
    "combinatorics",
    "data structures",
    "greedy"
  ],
  "statementHtml": "<p>You are at a marketplace and there are two traders who are willing to trade on <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-1\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-2\">n</span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-1-Frame\" tabindex=\"0\" style=\"\"></span><script type=\"math/tex\" id=\"MathJax-Element-1\">n</script> different items. Each trader is represented by a permutation that signifies the relative value of the <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-3\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-4\">n</span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-2-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-2\">n</script> items for that trader. Let's denote those two permutations <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-5\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-6\">p</span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-3-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-3\">p</script> and <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-7\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-8\">s</span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-4-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-4\">s</script>. If you have an item <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-9\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-10\">i</span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-5-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-5\">i</script>, you can trade it for an item <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-11\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-12\">j</span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-6-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-6\">j</script> if either <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-13\"><span class=\"MJXp-msubsup\" id=\"MJXp-Span-14\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-15\" style=\"margin-right: 0.05em;\">p</span><span class=\"MJXp-mi MJXp-italic MJXp-script\" id=\"MJXp-Span-16\" style=\"vertical-align: -0.4em;\">i</span></span><span class=\"MJXp-mo\" id=\"MJXp-Span-17\" style=\"margin-left: 0.333em; margin-right: 0.333em;\">&gt;</span><span class=\"MJXp-msubsup\" id=\"MJXp-Span-18\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-19\" style=\"margin-right: 0.05em;\">p</span><span class=\"MJXp-mi MJXp-italic MJXp-script\" id=\"MJXp-Span-20\" style=\"vertical-align: -0.4em;\">j</span></span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-7-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-7\">p_i > p_j</script> (using the first trader) or <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-21\"><span class=\"MJXp-msubsup\" id=\"MJXp-Span-22\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-23\" style=\"margin-right: 0.05em;\">s</span><span class=\"MJXp-mi MJXp-italic MJXp-script\" id=\"MJXp-Span-24\" style=\"vertical-align: -0.4em;\">i</span></span><span class=\"MJXp-mo\" id=\"MJXp-Span-25\" style=\"margin-left: 0.333em; margin-right: 0.333em;\">&gt;</span><span class=\"MJXp-msubsup\" id=\"MJXp-Span-26\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-27\" style=\"margin-right: 0.05em;\">s</span><span class=\"MJXp-mi MJXp-italic MJXp-script\" id=\"MJXp-Span-28\" style=\"vertical-align: -0.4em;\">j</span></span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-8-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-8\">s_i > s_j</script> (using the second trader).</p>\n<p>We say that an item <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-29\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-30\">i</span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-9-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-9\">i</script> is <span class=\"tex-font-style-it\">at least as valuable as</span> an item <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-31\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-32\">j</span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-10-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-10\">j</script> if you can come to the marketplace with item <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-33\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-34\">i</span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-11-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-11\">i</script>, make some (possibly none) trades, and get item <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-35\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-36\">j</span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-12-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-12\">j</script>. Note that at any moment, you will have exactly one item on hand. Assume that the traders have infinite supplies of any item.</p>\n<p>Due to the never-ending updates in the market, traders will often reevaluate their views on the item values. You will be given <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-37\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-38\">q</span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-13-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-13\">q</script> queries; each is a swap in one of the permutations. After every update, you should print the number of pairs <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-39\"><span class=\"MJXp-mo\" id=\"MJXp-Span-40\" style=\"margin-left: 0em; margin-right: 0em;\">(</span><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-41\">i</span><span class=\"MJXp-mo\" id=\"MJXp-Span-42\" style=\"margin-left: 0em; margin-right: 0.222em;\">,</span><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-43\">j</span><span class=\"MJXp-mo\" id=\"MJXp-Span-44\" style=\"margin-left: 0em; margin-right: 0em;\">)</span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-14-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-14\">(i, j)</script> (<span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-45\"><span class=\"MJXp-mn\" id=\"MJXp-Span-46\">1</span><span class=\"MJXp-mo\" id=\"MJXp-Span-47\" style=\"margin-left: 0.333em; margin-right: 0.333em;\">≤</span><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-48\">i</span><span class=\"MJXp-mo\" id=\"MJXp-Span-49\" style=\"margin-left: 0em; margin-right: 0.222em;\">,</span><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-50\">j</span><span class=\"MJXp-mo\" id=\"MJXp-Span-51\" style=\"margin-left: 0.333em; margin-right: 0.333em;\">≤</span><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-52\">n</span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-15-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-15\">1 \\le i, j \\le n</script>) such that item <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-53\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-54\">i</span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-16-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-16\">i</script> is at least as valuable as item <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-55\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-56\">j</span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-17-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-17\">j</script>.</p>",
  "inputSpecHtml": "<p>Each test contains multiple test cases. The first line contains the number of test cases <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-57\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-58\">t</span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-18-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-18\">t</script> (<span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-59\"><span class=\"MJXp-mn\" id=\"MJXp-Span-60\">1</span><span class=\"MJXp-mo\" id=\"MJXp-Span-61\" style=\"margin-left: 0.333em; margin-right: 0.333em;\">≤</span><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-62\">t</span><span class=\"MJXp-mo\" id=\"MJXp-Span-63\" style=\"margin-left: 0.333em; margin-right: 0.333em;\">≤</span><span class=\"MJXp-msubsup\" id=\"MJXp-Span-64\"><span class=\"MJXp-mn\" id=\"MJXp-Span-65\" style=\"margin-right: 0.05em;\">10</span><span class=\"MJXp-mn MJXp-script\" id=\"MJXp-Span-66\" style=\"vertical-align: 0.5em;\">4</span></span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-19-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-19\">1 \\le t \\le 10^4</script>). The description of the test cases follows. </p><p>The first line of each test case contains two integers <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-67\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-68\">n</span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-20-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-20\">n</script> and <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-69\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-70\">q</span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-21-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-21\">q</script> (<span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-71\"><span class=\"MJXp-mn\" id=\"MJXp-Span-72\">2</span><span class=\"MJXp-mo\" id=\"MJXp-Span-73\" style=\"margin-left: 0.333em; margin-right: 0.333em;\">≤</span><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-74\">n</span><span class=\"MJXp-mo\" id=\"MJXp-Span-75\" style=\"margin-left: 0.333em; margin-right: 0.333em;\">≤</span><span class=\"MJXp-msubsup\" id=\"MJXp-Span-76\"><span class=\"MJXp-mn\" id=\"MJXp-Span-77\" style=\"margin-right: 0.05em;\">10</span><span class=\"MJXp-mn MJXp-script\" id=\"MJXp-Span-78\" style=\"vertical-align: 0.5em;\">5</span></span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-22-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-22\">2 \\le n \\le 10^5</script>, <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-79\"><span class=\"MJXp-mn\" id=\"MJXp-Span-80\">1</span><span class=\"MJXp-mo\" id=\"MJXp-Span-81\" style=\"margin-left: 0.333em; margin-right: 0.333em;\">≤</span><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-82\">q</span><span class=\"MJXp-mo\" id=\"MJXp-Span-83\" style=\"margin-left: 0.333em; margin-right: 0.333em;\">≤</span><span class=\"MJXp-msubsup\" id=\"MJXp-Span-84\"><span class=\"MJXp-mn\" id=\"MJXp-Span-85\" style=\"margin-right: 0.05em;\">10</span><span class=\"MJXp-mn MJXp-script\" id=\"MJXp-Span-86\" style=\"vertical-align: 0.5em;\">5</span></span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-23-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-23\">1 \\le q \\le 10^5</script>).</p><p>The next two lines contain the initial permutations <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-87\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-88\">p</span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-24-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-24\">p</script> and <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-89\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-90\">s</span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-25-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-25\">s</script>.</p><p>The following <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-91\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-92\">q</span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-26-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-26\">q</script> lines each contain three integers <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-93\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-94\">t</span><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-95\">p</span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-27-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-27\">tp</script>, <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-96\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-97\">i</span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-28-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-28\">i</script>, <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-98\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-99\">j</span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-29-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-29\">j</script> (<span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-100\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-101\">t</span><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-102\">p</span><span class=\"MJXp-mo\" id=\"MJXp-Span-103\" style=\"margin-left: 0.333em; margin-right: 0.333em;\">∈</span><span class=\"MJXp-mo\" id=\"MJXp-Span-104\" style=\"margin-left: 0em; margin-right: 0em;\">{</span><span class=\"MJXp-mn\" id=\"MJXp-Span-105\">1</span><span class=\"MJXp-mo\" id=\"MJXp-Span-106\" style=\"margin-left: 0em; margin-right: 0.222em;\">,</span><span class=\"MJXp-mn\" id=\"MJXp-Span-107\">2</span><span class=\"MJXp-mo\" id=\"MJXp-Span-108\" style=\"margin-left: 0em; margin-right: 0em;\">}</span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-30-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-30\">tp \\in \\{ 1, 2 \\}</script>, <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-109\"><span class=\"MJXp-mn\" id=\"MJXp-Span-110\">1</span><span class=\"MJXp-mo\" id=\"MJXp-Span-111\" style=\"margin-left: 0.333em; margin-right: 0.333em;\">≤</span><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-112\">i</span><span class=\"MJXp-mo\" id=\"MJXp-Span-113\" style=\"margin-left: 0em; margin-right: 0.222em;\">,</span><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-114\">j</span><span class=\"MJXp-mo\" id=\"MJXp-Span-115\" style=\"margin-left: 0.333em; margin-right: 0.333em;\">≤</span><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-116\">n</span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-31-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-31\">1 \\le i, j \\le n</script>, <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-117\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-118\">i</span><span class=\"MJXp-mo\" id=\"MJXp-Span-119\" style=\"margin-left: 0.333em; margin-right: 0.333em;\">≠</span><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-120\">j</span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-32-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-32\">i \\ne j</script>). If <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-121\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-122\">t</span><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-123\">p</span><span class=\"MJXp-mo\" id=\"MJXp-Span-124\" style=\"margin-left: 0.333em; margin-right: 0.333em;\">=</span><span class=\"MJXp-mn\" id=\"MJXp-Span-125\">1</span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-33-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-33\">tp=1</script>, swap <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-126\"><span class=\"MJXp-msubsup\" id=\"MJXp-Span-127\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-128\" style=\"margin-right: 0.05em;\">p</span><span class=\"MJXp-mi MJXp-italic MJXp-script\" id=\"MJXp-Span-129\" style=\"vertical-align: -0.4em;\">i</span></span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-34-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-34\">p_i</script> with <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-130\"><span class=\"MJXp-msubsup\" id=\"MJXp-Span-131\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-132\" style=\"margin-right: 0.05em;\">p</span><span class=\"MJXp-mi MJXp-italic MJXp-script\" id=\"MJXp-Span-133\" style=\"vertical-align: -0.4em;\">j</span></span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-35-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-35\">p_j</script>. If <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-134\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-135\">t</span><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-136\">p</span><span class=\"MJXp-mo\" id=\"MJXp-Span-137\" style=\"margin-left: 0.333em; margin-right: 0.333em;\">=</span><span class=\"MJXp-mn\" id=\"MJXp-Span-138\">2</span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-36-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-36\">tp=2</script>, swap <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-139\"><span class=\"MJXp-msubsup\" id=\"MJXp-Span-140\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-141\" style=\"margin-right: 0.05em;\">s</span><span class=\"MJXp-mi MJXp-italic MJXp-script\" id=\"MJXp-Span-142\" style=\"vertical-align: -0.4em;\">i</span></span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-37-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-37\">s_i</script> with <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-143\"><span class=\"MJXp-msubsup\" id=\"MJXp-Span-144\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-145\" style=\"margin-right: 0.05em;\">s</span><span class=\"MJXp-mi MJXp-italic MJXp-script\" id=\"MJXp-Span-146\" style=\"vertical-align: -0.4em;\">j</span></span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-38-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-38\">s_j</script>.</p><p>It is guaranteed that the sum of <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-147\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-148\">n</span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-39-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-39\">n</script> over all test cases does not exceed <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-149\"><span class=\"MJXp-msubsup\" id=\"MJXp-Span-150\"><span class=\"MJXp-mn\" id=\"MJXp-Span-151\" style=\"margin-right: 0.05em;\">10</span><span class=\"MJXp-mn MJXp-script\" id=\"MJXp-Span-152\" style=\"vertical-align: 0.5em;\">5</span></span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-40-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-40\">10^5</script>, and the sum of <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-153\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-154\">q</span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-41-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-41\">q</script> over all test cases does not exceed <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-155\"><span class=\"MJXp-msubsup\" id=\"MJXp-Span-156\"><span class=\"MJXp-mn\" id=\"MJXp-Span-157\" style=\"margin-right: 0.05em;\">10</span><span class=\"MJXp-mn MJXp-script\" id=\"MJXp-Span-158\" style=\"vertical-align: 0.5em;\">5</span></span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-42-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-42\">10^5</script>.</p>",
  "outputSpecHtml": "<p>For each test case, output <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-159\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-160\">q</span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-43-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-43\">q</script> lines, the <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-161\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-162\">k</span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-44-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-44\">k</script>-th of them containing a single integer&nbsp;— the number of pairs <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-163\"><span class=\"MJXp-mo\" id=\"MJXp-Span-164\" style=\"margin-left: 0em; margin-right: 0em;\">(</span><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-165\">i</span><span class=\"MJXp-mo\" id=\"MJXp-Span-166\" style=\"margin-left: 0em; margin-right: 0.222em;\">,</span><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-167\">j</span><span class=\"MJXp-mo\" id=\"MJXp-Span-168\" style=\"margin-left: 0em; margin-right: 0em;\">)</span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-45-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-45\">(i, j)</script> such that item <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-169\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-170\">i</span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-46-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-46\">i</script> is at least as valuable as item <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-171\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-172\">j</span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-47-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-47\">j</script> after the first <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-173\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-174\">k</span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-48-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-48\">k</script> updates.</p>",
  "noteHtml": "<p>In the first test case, after the first update, both permutations are the identity permutations and thus the only valid pairs are <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-175\"><span class=\"MJXp-mo\" id=\"MJXp-Span-176\" style=\"margin-left: 0em; margin-right: 0em;\">(</span><span class=\"MJXp-mn\" id=\"MJXp-Span-177\">1</span><span class=\"MJXp-mo\" id=\"MJXp-Span-178\" style=\"margin-left: 0em; margin-right: 0.222em;\">,</span><span class=\"MJXp-mn\" id=\"MJXp-Span-179\">1</span><span class=\"MJXp-mo\" id=\"MJXp-Span-180\" style=\"margin-left: 0em; margin-right: 0em;\">)</span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-49-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-49\">(1, 1)</script>, <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-181\"><span class=\"MJXp-mo\" id=\"MJXp-Span-182\" style=\"margin-left: 0em; margin-right: 0em;\">(</span><span class=\"MJXp-mn\" id=\"MJXp-Span-183\">2</span><span class=\"MJXp-mo\" id=\"MJXp-Span-184\" style=\"margin-left: 0em; margin-right: 0.222em;\">,</span><span class=\"MJXp-mn\" id=\"MJXp-Span-185\">1</span><span class=\"MJXp-mo\" id=\"MJXp-Span-186\" style=\"margin-left: 0em; margin-right: 0em;\">)</span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-50-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-50\">(2, 1)</script>, <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-187\"><span class=\"MJXp-mo\" id=\"MJXp-Span-188\" style=\"margin-left: 0em; margin-right: 0em;\">(</span><span class=\"MJXp-mn\" id=\"MJXp-Span-189\">2</span><span class=\"MJXp-mo\" id=\"MJXp-Span-190\" style=\"margin-left: 0em; margin-right: 0.222em;\">,</span><span class=\"MJXp-mn\" id=\"MJXp-Span-191\">2</span><span class=\"MJXp-mo\" id=\"MJXp-Span-192\" style=\"margin-left: 0em; margin-right: 0em;\">)</span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-51-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-51\">(2, 2)</script>, <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-193\"><span class=\"MJXp-mo\" id=\"MJXp-Span-194\" style=\"margin-left: 0em; margin-right: 0em;\">(</span><span class=\"MJXp-mn\" id=\"MJXp-Span-195\">3</span><span class=\"MJXp-mo\" id=\"MJXp-Span-196\" style=\"margin-left: 0em; margin-right: 0.222em;\">,</span><span class=\"MJXp-mn\" id=\"MJXp-Span-197\">1</span><span class=\"MJXp-mo\" id=\"MJXp-Span-198\" style=\"margin-left: 0em; margin-right: 0em;\">)</span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-52-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-52\">(3, 1)</script>, <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-199\"><span class=\"MJXp-mo\" id=\"MJXp-Span-200\" style=\"margin-left: 0em; margin-right: 0em;\">(</span><span class=\"MJXp-mn\" id=\"MJXp-Span-201\">3</span><span class=\"MJXp-mo\" id=\"MJXp-Span-202\" style=\"margin-left: 0em; margin-right: 0.222em;\">,</span><span class=\"MJXp-mn\" id=\"MJXp-Span-203\">2</span><span class=\"MJXp-mo\" id=\"MJXp-Span-204\" style=\"margin-left: 0em; margin-right: 0em;\">)</span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-53-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-53\">(3, 2)</script>, and <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-205\"><span class=\"MJXp-mo\" id=\"MJXp-Span-206\" style=\"margin-left: 0em; margin-right: 0em;\">(</span><span class=\"MJXp-mn\" id=\"MJXp-Span-207\">3</span><span class=\"MJXp-mo\" id=\"MJXp-Span-208\" style=\"margin-left: 0em; margin-right: 0.222em;\">,</span><span class=\"MJXp-mn\" id=\"MJXp-Span-209\">3</span><span class=\"MJXp-mo\" id=\"MJXp-Span-210\" style=\"margin-left: 0em; margin-right: 0em;\">)</span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-54-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-54\">(3, 3)</script>. After the second update, it is possible to get any item starting with any item. For instance, you can get item <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-211\"><span class=\"MJXp-mn\" id=\"MJXp-Span-212\">3</span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-55-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-55\">3</script> from item <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-213\"><span class=\"MJXp-mn\" id=\"MJXp-Span-214\">1</span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-56-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-56\">1</script> using the second trader since <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-215\"><span class=\"MJXp-msubsup\" id=\"MJXp-Span-216\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-217\" style=\"margin-right: 0.05em;\">s</span><span class=\"MJXp-mn MJXp-script\" id=\"MJXp-Span-218\" style=\"vertical-align: -0.4em;\">1</span></span><span class=\"MJXp-mo\" id=\"MJXp-Span-219\" style=\"margin-left: 0.333em; margin-right: 0.333em;\">=</span><span class=\"MJXp-mn\" id=\"MJXp-Span-220\">3</span><span class=\"MJXp-mo\" id=\"MJXp-Span-221\" style=\"margin-left: 0.333em; margin-right: 0.333em;\">&gt;</span><span class=\"MJXp-mn\" id=\"MJXp-Span-222\">1</span><span class=\"MJXp-mo\" id=\"MJXp-Span-223\" style=\"margin-left: 0.333em; margin-right: 0.333em;\">=</span><span class=\"MJXp-msubsup\" id=\"MJXp-Span-224\"><span class=\"MJXp-mi MJXp-italic\" id=\"MJXp-Span-225\" style=\"margin-right: 0.05em;\">s</span><span class=\"MJXp-mn MJXp-script\" id=\"MJXp-Span-226\" style=\"vertical-align: -0.4em;\">3</span></span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-57-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-57\">s_1 = 3 > 1 = s_3</script>. After the third update, it is still possible to get any item starting with any item. For instance, if you start with item <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-227\"><span class=\"MJXp-mn\" id=\"MJXp-Span-228\">2</span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-58-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-58\">2</script> and want to get item <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-229\"><span class=\"MJXp-mn\" id=\"MJXp-Span-230\">1</span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-59-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-59\">1</script>, you can first exchange your item <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-231\"><span class=\"MJXp-mn\" id=\"MJXp-Span-232\">2</span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-60-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-60\">2</script> for item <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-233\"><span class=\"MJXp-mn\" id=\"MJXp-Span-234\">3</span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-61-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-61\">3</script> using the second trader, and then exchange item <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-235\"><span class=\"MJXp-mn\" id=\"MJXp-Span-236\">3</span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-62-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-62\">3</script> for item <span class=\"MathJax_Preview\" style=\"color: inherit;\"><span class=\"MJXp-math\" id=\"MJXp-Span-237\"><span class=\"MJXp-mn\" id=\"MJXp-Span-238\">1</span></span></span><span class=\"MathJax MathJax_Processing\" id=\"MathJax-Element-63-Frame\" tabindex=\"0\"></span><script type=\"math/tex\" id=\"MathJax-Element-63\">1</script> using the first trader.</p>",
  "samples": [
    {
      "input": "23 31 2 33 2 12 1 32 1 31 1 24 23 2 4 13 1 4 21 1 32 1 3",
      "output": "6991211"
    }
  ],
  "images": [],
  "url": "https://codeforces.com/contest/2147/problem/F",
  "tutorialHtml": "<div><div class=\"ttypography\"><div class=\"problem-statement\"><div><p>Let's look at the SCCs. Clearly we have a tournament graph as a subgraph, so SCCs are in a line (and from the right one you can go to the left ones). But for us to be not able to go from left to right, all the priorities on the left must be smaller than all the priorities on the right. So there is a cut between SCCs iff numbers [$$$1$$$, $$$x$$$] take the same set of positions in both priority permutations (and, therefore, numbers [$$$x + 1$$$, $$$n$$$] too).</p><p>Let's call this situation a cut in value $$$x$$$. If we have an item with priorities ($$$p_i$$$, $$$q_i$$$) (WLOG $$$p_i \\leq q_i$$$), there can't be a cut in value $$$x$$$ for $$$p_i \\leq x &lt; q_i$$$. If we mark all the values where a cut cannot be, in all the remaining values there is a cut. So let's maintain a segment tree on values where in each position we will store how many times it is <span class=\"tex-font-style-it\">banned</span> then each item gives a $$$+1$$$ on segment. Every swap is a change of two of the segments so we can update it by removing both old segments and adding both new segments. We are interested in positions of $$$0$$$s but all the values are non-negative, so $$$0$$$s are minimums (if they exist) so we can store a segment tree on minimum with add on segment tree to find strongly connected components.</p><p>Let the sizes of the SSCs be $$$s_1, s_2, ... s_k$$$. The answer to the problem is $$$n + \\binom{n}{2} + \\sum \\binom{s_i}{2}$$$. We will enhance the segment tree to calculate this value. Maintain for every node the minimum value, the leftmost position of the minimum value, the rightmost position of the minimum value and $$$\\sum_{i = 1}^t \\binom{j_i - j_{i-1}}{2}$$$ where $$$j_0, j_1,...j_t$$$ are the positions of the minimum values. Now merging is straight-forward and the value at the root node gives the answer to the problem.</p></div></div></div></div>"
}