<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tutorial</title>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
      line-height: 1.6;
      color: #333;
      background: #fafafa;
    }
    .ttypography {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    h3 {
      color: #1a1a1a;
      border-bottom: 2px solid #eee;
      padding-bottom: 10px;
    }
    h3 a {
      color: #0066cc;
      text-decoration: none;
    }
    h3 a:hover {
      text-decoration: underline;
    }
    .spoiler {
      margin: 15px 0;
      border: 1px solid #ddd;
      border-radius: 6px;
      overflow: hidden;
    }
    .spoiler-title {
      display: block;
      padding: 12px 15px;
      background: #f0f0f0;
      cursor: pointer;
      font-weight: 600;
      user-select: none;
      border-bottom: 1px solid #ddd;
    }
    .spoiler-title:hover {
      background: #e8e8e8;
    }
    .spoiler-title::before {
      content: '▶ ';
      font-size: 0.8em;
      transition: transform 0.2s;
      display: inline-block;
    }
    .spoiler.open .spoiler-title::before {
      content: '▼ ';
    }
    .spoiler-content {
      padding: 15px;
      background: #fff;
      display: none;
    }
    .spoiler.open .spoiler-content {
      display: block;
    }
    pre, code {
      background: #f5f5f5;
      font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
      font-size: 0.85em;
    }
    pre {
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
    }
    code {
      padding: 2px 5px;
      border-radius: 3px;
    }
    p {
      margin: 10px 0;
    }
    .MathJax {
      font-size: 1.1em;
    }
  </style>
</head>
<body>
  <h1>Editorial</h1>
  <p><a href="https://codeforces.com/blog/entry/146633" target="_blank">View on Codeforces →</a></p>
  
  <div class="ttypography"><p>Thanks everybody for participating in the round!</p><h3><a href="https://codeforces.com/contest/2147/problem/A">A. Shortest Increasing Path</a></h3><p>Author: <a class="rated-user user-orange" href="https://codeforces.com/profile/BernatP" title="Master BernatP">BernatP</a> Preparation: <a class="rated-user user-orange" href="https://codeforces.com/profile/BernatP" title="Master BernatP">BernatP</a></p> <div class="spoiler"><b class="spoiler-title">Hint1</b><div class="spoiler-content" style="display: block;"><p>How big can the answer be?</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint2</b><div class="spoiler-content" style="display: block;"><p>Which coordinates can you reach in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1"><span class="MJXp-mn" id="MJXp-Span-2">2</span></span></span><script type="math/tex" id="MathJax-Element-1">2</script> or <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3"><span class="MJXp-mn" id="MJXp-Span-4">3</span></span></span><script type="math/tex" id="MathJax-Element-2">3</script> moves?</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2147/problem/A" title="Codeforces Global Round 29 (Div. 1 + Div. 2)">2147A - Shortest Increasing Path</a></h3><div class="ttypography"><div class="problem-statement"><div><p>This problem is about handling cases. </p><p>The main solution is to quickly realize that $$$x&lt;y$$$ can be done in 2 moves and $$$x&gt;y+1$$$ with $$$y&gt;1$$$ in 3. You can guess that other cases are impossible.</p><p>Using two moves, we can move to any ($$$x$$$,$$$y$$$) with $$$x&lt;y$$$ by first moving $$$x$$$ and then $$$y$$$. Using 3 moves $$$0&lt;a&lt;b&lt;c$$$ we get to ($$$a+c$$$,$$$b$$$) as follows: first to ($$$a$$$,$$$0$$$), then to ($$$a$$$, $$$b$$$), and then to ( $$$a+c$$$, $$$b$$$). Without loss of generality we can subtract $$$1$$$ from $$$a$$$ and add $$$1$$$ to $$$c$$$ anytime so we can assume $$$a=1$$$ and hence we can reach ($$$x$$$, $$$y$$$) in $$$3$$$ moves if and only if $$$x&gt;y+1$$$ and $$$y&gt;1$$$.</p><p>Now assume we can reach some ($$$x$$$, $$$y$$$) with $$$k&gt;3$$$ jumps. The last two jumps can be merged with the previous 2 jumps giving a solution with $$$k-2$$$ jumps. Hence any other case is impossible.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Code</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="com">#define</span><span class="pln"> endl </span><span class="str">'\n'</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
</span><span class="com">#define</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pln">
 
</span><span class="kwd">signed</span><span class="pln"> main</span><span class="pun">(){</span><span class="pln">
	ios_base</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
	cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
	</span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
	cin</span><span class="pun">&gt;&gt;</span><span class="pln">t</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">while</span><span class="pun">(</span><span class="pln">t</span><span class="pun">--){</span><span class="pln">
		</span><span class="kwd">int</span><span class="pln"> x</span><span class="pun">,</span><span class="pln">y</span><span class="pun">;</span><span class="pln">
		cin</span><span class="pun">&gt;&gt;</span><span class="pln">x</span><span class="pun">&gt;&gt;</span><span class="pln">y</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">if</span><span class="pun">(</span><span class="pln">x</span><span class="pun">==</span><span class="pln">y </span><span class="pun">||</span><span class="pln"> x</span><span class="pun">==</span><span class="pln">y</span><span class="pun">+</span><span class="lit">1</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> y</span><span class="pun">==</span><span class="lit">1</span><span class="pun">)</span><span class="pln">cout</span><span class="pun">&lt;&lt;-</span><span class="lit">1</span><span class="pun">&lt;&lt;</span><span class="pln">endl</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">x</span><span class="pun">&lt;</span><span class="pln">y</span><span class="pun">)</span><span class="pln">cout</span><span class="pun">&lt;&lt;</span><span class="lit">2</span><span class="pun">&lt;&lt;</span><span class="pln">endl</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">else</span><span class="pln"> cout</span><span class="pun">&lt;&lt;</span><span class="lit">3</span><span class="pun">&lt;&lt;</span><span class="pln">endl</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div><h3><a href="https://codeforces.com/contest/2147/problem/B">B. Multiple Construction</a></h3><p>Author: <a class="rated-user user-orange" href="https://codeforces.com/profile/danx" title="Master danx">danx</a> Preparation: <a class="rated-user user-orange" href="https://codeforces.com/profile/danx" title="Master danx">danx</a></p> <div class="spoiler"><b class="spoiler-title">Hint1</b><div class="spoiler-content" style="display: block;"><p>Don't over complicate, there is a simple construction</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint2</b><div class="spoiler-content" style="display: block;"><p>There is a construction where each number <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-5"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-6">x</span></span></span><script type="math/tex" id="MathJax-Element-3">x</script> is placed at distance either <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-7"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-8">x</span></span></span><script type="math/tex" id="MathJax-Element-4">x</script> or <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-9"><span class="MJXp-mn" id="MJXp-Span-10">2</span><span class="MJXp-mo" id="MJXp-Span-11" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-12">x</span></span></span><script type="math/tex" id="MathJax-Element-5">2 \cdot x</script>.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint3</b><div class="spoiler-content" style="display: block;"><p>Here is a construction where only the number <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-13"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-14">n</span></span></span><script type="math/tex" id="MathJax-Element-6">n</script> is placed at distance <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-15"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-16">n</span></span></span><script type="math/tex" id="MathJax-Element-7">n</script>. All other numbers are placed at distance <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-17"><span class="MJXp-mn" id="MJXp-Span-18">2</span><span class="MJXp-mo" id="MJXp-Span-19" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-20">x</span></span></span><script type="math/tex" id="MathJax-Element-8">2 \cdot x</script>.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint4</b><div class="spoiler-content" style="display: block;"><p>There is a construction where the first element of the array is always <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-21"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-22">n</span></span></span><script type="math/tex" id="MathJax-Element-9">n</script>.</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2147/problem/B" title="Codeforces Global Round 29 (Div. 1 + Div. 2)">2147B - Multiple Construction</a></h3><div class="ttypography"><div class="problem-statement"><div><p>There are multiple ways to solve this problem. We believe the easiest one is based on the following construction:</p><p>[ n, n-1, n-2, ..., 3, 2, 1, n, 1, 2, 3, ..., n-2, n-1 ]</p><p>It's easy to see that both occurrences of $$$n$$$ are at a distance of $$$n$$$, and all the other values appear at a distance of twice their value. In other words, we place the two $$$n$$$'s at the first position and at the $$$(n+1)$$$-th position, then we use the second $$$n$$$ as a pivot to place numbers from $$$1$$$ to $$$n-1$$$ in order.</p><p>There exist other constructions as well. For example, for $$$n$$$ odd, we can use:</p><p>[ 1, n-2, n-4, ..., 3, n, 1, 3, 5, ..., n-2, n-1, n-3, ..., 2, n, 2, ..., n-3, n-1 ]</p><p>For $$$n$$$ even, the pattern is similar but we adjust the positions of $$$n-1$$$ and $$$n-2$$$ accordingly.</p><p>A greedy algorithm also works: we go from $$$n$$$ to $$$1$$$, and try to place each number in the leftmost possible position. Note that this greedy algorithm follows the same pattern as the first construction.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Code</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">,</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">signed</span><span class="pln"> main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  ios</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="kwd">false</span><span class="pun">);</span><span class="pln"> cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="kwd">nullptr</span><span class="pun">);</span><span class="pln">
 
  cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">t</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      cout </span><span class="pun">&lt;&lt;</span><span class="pln"> i </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">" "</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    cout </span><span class="pun">&lt;&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">" "</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> i</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"\n"</span><span class="pun">;</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div><h3><a href="https://codeforces.com/contest/2147/problem/C">C. Rabbits</a></h3><p>Author: <a class="rated-user user-orange" href="https://codeforces.com/profile/misteg168" title="Master misteg168">misteg168</a> Preparation: <a class="rated-user user-orange" href="https://codeforces.com/profile/misteg168" title="Master misteg168">misteg168</a></p> <div class="spoiler"><b class="spoiler-title">Hint1</b><div class="spoiler-content" style="display: block;"><p>If we have two consecutive <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-23"><span class="MJXp-mn" id="MJXp-Span-24">1</span></span></span><script type="math/tex" id="MathJax-Element-10">1</script>'s, the rabbits on the left and right of this block are independent. We can divide our problem into multiple subproblems.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint2</b><div class="spoiler-content" style="display: block;"><p>If one of these subproblems mentioned in hint <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-25"><span class="MJXp-mn" id="MJXp-Span-26">1</span></span></span><script type="math/tex" id="MathJax-Element-11">1</script> contains two consecutive 0's, can we solve this subproblem?</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint3</b><div class="spoiler-content" style="display: block;"><p>If we don't have consecutive <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-27"><span class="MJXp-mn" id="MJXp-Span-28">0</span></span></span><script type="math/tex" id="MathJax-Element-12">0</script>'s in these subproblems mentioned in hint <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-29"><span class="MJXp-mn" id="MJXp-Span-30">1</span></span></span><script type="math/tex" id="MathJax-Element-13">1</script>, the pattern looks like <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-31"><span class="MJXp-mn" id="MJXp-Span-32">10101</span><span class="MJXp-mo" id="MJXp-Span-33" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mn" id="MJXp-Span-34">10101</span></span></span><script type="math/tex" id="MathJax-Element-14">10101 \dots 10101</script>, in which of these patterns can we place the rabbits?</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2147/problem/C" title="Codeforces Global Round 29 (Div. 1 + Div. 2)">2147C - Rabbits</a></h3><div class="ttypography"><div class="problem-statement"><div><p>The first observation is to notice that every substring "11" splits the problem into two subproblems since rabbits on opposite sides cannot interact with each other. For instance, in the string $$$0110$$$, the rabbits placed in positions $$$1$$$ and $$$4$$$ cannot interact with each other.</p><p>The second observation is that if we split the string in a way such that each subproblem does not contain two consecutive $$$1$$$'s, the string $$$101010 \dots 0101$$$ (no consecutive 0's) is solvable iff the number of 0's is even since we can match the rabbits in the following way $$$1R1L1R \dots R1L1$$$ (where $$$R$$$ means that we place a rabbit looking to the right and $$$L$$$ means that we place a rabbit looking to the left).</p><p>The last observation is that if we have two consecutive $$$0$$$'s, we can split the problem using them in a way that every subproblem looks like this alternating pattern ($$$101010 \dots 0101$$$) with an odd number of $$$0$$$'s. Thus, the only thing we need to look for is a substring with this alternating pattern that has an odd number of zeros.</p><p>We should also take care of boundary conditions. If the string starts or ends with a zero, we can ignore that position by placing the rabbit looking towards the border; these cases were present in the sample tests.</p><p>Alternatively, we can solve the problem using a dp that considers $$$dp_{i, L}$$$ = Is it possible to solve the prefix $$${0, 1, \dots, i}$$$ placing the rabbit in position $$$i$$$ looking to the left, and $$$dp_{i, R}$$$ defined in the same way.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Code</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">void</span><span class="pln"> solve</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">string</span><span class="pln"> s</span><span class="pun">;</span><span class="pln"> cin </span><span class="pun">&gt;&gt;</span><span class="pln"> s</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">bool</span><span class="pln"> ok </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">bool</span><span class="pln"> curr </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">s</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'1'</span><span class="pun">);</span><span class="pln">
	</span><span class="kwd">int</span><span class="pln"> cnt </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">s</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'0'</span><span class="pun">)</span><span class="pln">
			cnt</span><span class="pun">++;</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln">
			</span><span class="kwd">continue</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">s</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> s</span><span class="pun">[</span><span class="pln">i</span><span class="pun">-</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> s</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'0'</span><span class="pun">)</span><span class="pln">
			curr </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">s</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> s</span><span class="pun">[</span><span class="pln">i</span><span class="pun">-</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> s</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'1'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">curr </span><span class="pun">&amp;&amp;</span><span class="pln"> cnt </span><span class="pun">%</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">
				ok </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
			curr </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
			cnt </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	
	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">curr </span><span class="pun">&amp;&amp;</span><span class="pln"> cnt </span><span class="pun">%</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> s</span><span class="pun">[</span><span class="pln">n</span><span class="pun">-</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'1'</span><span class="pun">)</span><span class="pln">
		ok </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
		
	cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="pun">(</span><span class="pln">ok </span><span class="pun">?</span><span class="pln"> </span><span class="str">"YES"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">"NO"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"\n"</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	ios</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="kwd">false</span><span class="pun">);</span><span class="pln">
	cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="kwd">nullptr</span><span class="pun">);</span><span class="pln">
	
	</span><span class="kwd">int</span><span class="pln"> T</span><span class="pun">;</span><span class="pln"> cin </span><span class="pun">&gt;&gt;</span><span class="pln"> T</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">T</span><span class="pun">--)</span><span class="pln">
		solve</span><span class="pun">();</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div><h3><a href="https://codeforces.com/contest/2147/problem/D">D. Game on Array</a></h3><p>Author: <a class="rated-user user-orange" href="https://codeforces.com/profile/BernatP" title="Master BernatP">BernatP</a> Preparation: <a class="rated-user user-orange" href="https://codeforces.com/profile/BernatP" title="Master BernatP">BernatP</a></p> <div class="spoiler"><b class="spoiler-title">Hint1</b><div class="spoiler-content" style="display: block;"><p>Solve small cases.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint2</b><div class="spoiler-content" style="display: block;"><p>What happens when every value is even?</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint3</b><div class="spoiler-content" style="display: block;"><p>How can we add exactly one odd number to the solution of hint 2?</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2147/problem/D" title="Codeforces Global Round 29 (Div. 1 + Div. 2)">2147D - Game on Array</a></h3><div class="ttypography"><div class="problem-statement"><div><p>Let's separate odd and even numbers. One can intuitively see that it is bad to choose $$$x$$$ even since right after the other player can choose $$$x-1$$$ and get at least as many points as you did. This however is not true for odd numbers since after picking $$$x=1$$$ the opposite player cannot pick $$$x=0$$$.</p><p>Let the frequencies of the odd numbers (sorted) be $$$f_0 \geq f_1 \geq \ldots \geq f_k$$$. We claim that the difference in points between players will be $$$S = \sum_{i=0}^k (-1)^i f_i$$$. The following strategy gets at least $$$S$$$ points difference: if $$$k&gt;0$$$ choose $$$f_0$$$, otherwise choose any $$$x$$$. Now there are 3 cases. </p><ul> <li> If player 2 chooses $$$f_i$$$ with odd $$$i$$$ you have by induction exactly $$$S$$$ points difference at the end. </li><li> If player 2 chooses $$$f_i$$$ with even $$$i$$$ you can choose $$$f_{i-1}$$$ and by induction end up with $$$S - f_i+f_{i-1} \geq S$$$ difference at the end. </li><li> If player 2 chooses an even $$$x$$$, copy and take $$$x-1$$$. Repeat until player 2 chooses an odd $$$x$$$. During this process you will have collected some (possibly 0) $$$f_i$$$'s and after that you will also get the alternating sum of the remaining $$$f_i$$$. Assume you remove one $$$f_i$$$ from $$$f$$$ to collect $$$f_i$$$ points. If $$$i$$$ is even, all $$$f_j$$$ signs for $$$j&gt;i$$$ will be changed so you end up with $$$S + 2\sum_{j=i+1}^k(-1)^{j-(i-1)}f_j \geq S$$$. If $$$i$$$ is odd, all $$$f_j$$$ signs will be changed for $$$j\geq i$$$ so you end up with $$$S + 2\sum_{j=i}^k(-1)^{j-i}f_j \geq S$$$ which is at least $$$S$$$ in any case. </li></ul> This bound is also an upper bound since player 2 gets at least $$$-f_0 + \sum_{i=1}^k (-1)^{i-1} f_i = -S$$$ points using this same strategy.</div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Code</b><div class="spoiler-content" style="display: block;"><p><a href="https://codeforces.com/contest/2147/submission/339616059" title="Submission 339616059 by treebutton">339616059</a></p></div></div><h3><a href="https://codeforces.com/contest/2147/problem/E">E. Maximum OR Popcount</a></h3><p>Author: <a class="rated-user user-orange" href="https://codeforces.com/profile/Pablo-No" title="Master Pablo-No">Pablo-No</a> Preparation: <a class="rated-user user-orange" href="https://codeforces.com/profile/Pablo-No" title="Master Pablo-No">Pablo-No</a></p> <div class="spoiler"><b class="spoiler-title">Hint1</b><div class="spoiler-content" style="display: block;"><p>The answer is bounded by <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-35"><span class="MJXp-mn" id="MJXp-Span-36">31</span></span></span><script type="math/tex" id="MathJax-Element-15">31</script>.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint2</b><div class="spoiler-content" style="display: block;"><p>We will precalculate the minimum operations for each answer.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint3</b><div class="spoiler-content" style="display: block;"><p>How will the bitwise or look like if we want to increase the popcount from the original by increasing the number of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-37"><span class="MJXp-mn" id="MJXp-Span-38">1</span></span></span><script type="math/tex" id="MathJax-Element-16">1</script>'s.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint4</b><div class="spoiler-content" style="display: block;"><p>We can show that it is better to fill the least significant <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-39"><span class="MJXp-mn" id="MJXp-Span-40">0</span></span></span><script type="math/tex" id="MathJax-Element-17">0</script>'s first.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint5</b><div class="spoiler-content" style="display: block;"><p>What is the best way to fill a certain bit.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint6</b><div class="spoiler-content" style="display: block;"><p>The solution is a greedy algorithm.</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><div class="problemTutorial" problemcode="2147E">Tutorial is loading...</div></div></div> <div class="spoiler"><b class="spoiler-title">Code</b><div class="spoiler-content" style="display: block;"><p><a href="https://codeforces.com/contest/2147/submission/339616091" title="Submission 339616091 by treebutton">339616091</a></p></div></div> <div class="spoiler"><b class="spoiler-title">Bonus</b><div class="spoiler-content" style="display: block;"><p>Solve the problem in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-41"><span class="MJXp-mrow" id="MJXp-Span-42"><span class="MJXp-mi MJXp-cal" id="MJXp-Span-43">O</span></span><span class="MJXp-mo" id="MJXp-Span-44" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-45">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-46">b</span><span class="MJXp-mo" id="MJXp-Span-47" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-48">t</span><span class="MJXp-msubsup" id="MJXp-Span-49"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-50" style="margin-right: 0.05em;">b</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-51" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-52" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-53">q</span><span class="MJXp-mi" id="MJXp-Span-54">log</span><span class="MJXp-mo" id="MJXp-Span-55" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-56" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-57">b</span><span class="MJXp-mo" id="MJXp-Span-58" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-59" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-18">\mathcal{O}(n b + t b^2 + q \log (b))</script>.</p></div></div><h3><a href="https://codeforces.com/contest/2147/problem/F">F. Exchange Queries</a></h3><p>Author: <a class="rated-user user-orange" href="https://codeforces.com/profile/BernatP" title="Master BernatP">BernatP</a> Preparation: <a class="rated-user user-orange" href="https://codeforces.com/profile/misteg168" title="Master misteg168">misteg168</a></p> <div class="spoiler"><b class="spoiler-title">Hint1</b><div class="spoiler-content" style="display: block;"><p>Try to understand what are the SCCs.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint2</b><div class="spoiler-content" style="display: block;"><p>They are a line. Given the sizes of the SCC, find a closed formula for the answer.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint3</b><div class="spoiler-content" style="display: block;"><p>Think how to maintain the formula using data structures.</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2147/problem/F" title="Codeforces Global Round 29 (Div. 1 + Div. 2)">2147F - Exchange Queries</a></h3><div class="ttypography"><div class="problem-statement"><div><p>Let's look at the SCCs. Clearly we have a tournament graph as a subgraph, so SCCs are in a line (and from the right one you can go to the left ones). But for us to be not able to go from left to right, all the priorities on the left must be smaller than all the priorities on the right. So there is a cut between SCCs iff numbers [$$$1$$$, $$$x$$$] take the same set of positions in both priority permutations (and, therefore, numbers [$$$x + 1$$$, $$$n$$$] too).</p><p>Let's call this situation a cut in value $$$x$$$. If we have an item with priorities ($$$p_i$$$, $$$q_i$$$) (WLOG $$$p_i \leq q_i$$$), there can't be a cut in value $$$x$$$ for $$$p_i \leq x &lt; q_i$$$. If we mark all the values where a cut cannot be, in all the remaining values there is a cut. So let's maintain a segment tree on values where in each position we will store how many times it is <span class="tex-font-style-it">banned</span> then each item gives a $$$+1$$$ on segment. Every swap is a change of two of the segments so we can update it by removing both old segments and adding both new segments. We are interested in positions of $$$0$$$s but all the values are non-negative, so $$$0$$$s are minimums (if they exist) so we can store a segment tree on minimum with add on segment tree to find strongly connected components.</p><p>Let the sizes of the SSCs be $$$s_1, s_2, ... s_k$$$. The answer to the problem is $$$n + \binom{n}{2} + \sum \binom{s_i}{2}$$$. We will enhance the segment tree to calculate this value. Maintain for every node the minimum value, the leftmost position of the minimum value, the rightmost position of the minimum value and $$$\sum_{i = 1}^t \binom{j_i - j_{i-1}}{2}$$$ where $$$j_0, j_1,...j_t$$$ are the positions of the minimum values. Now merging is straight-forward and the value at the root node gives the answer to the problem.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Code</b><div class="spoiler-content" style="display: block;"><p><a href="https://codeforces.com/contest/2147/submission/339616164" title="Submission 339616164 by treebutton">339616164</a></p></div></div><h3><a href="https://codeforces.com/contest/2147/problem/G">G. Modular Tetration</a></h3><p>Author: <a class="rated-user user-orange" href="https://codeforces.com/profile/BernatP" title="Master BernatP">BernatP</a> Preparation: <a class="rated-user user-orange" href="https://codeforces.com/profile/BernatP" title="Master BernatP">BernatP</a></p> <div class="spoiler"><b class="spoiler-title">About cheaters</b><div class="spoiler-content" style="display: block;"><p>There was a lot of cheating on this problem, which is why there were many in-contest solves. Cheaters will be banned. We’re sorry if the high solve count during the contest misled anyone, but please understand that this isn’t something the authors, coordinators, or codeforces can control.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint1</b><div class="spoiler-content" style="display: block;"><p>What happens when <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-60"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-61">n</span></span></span><script type="math/tex" id="MathJax-Element-19">n</script> is big?</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint2</b><div class="spoiler-content" style="display: block;"><p><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-62"><span class="MJXp-msubsup" id="MJXp-Span-63"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-64" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-65" style="vertical-align: -0.4em;">n</span></span></span></span><script type="math/tex" id="MathJax-Element-20">b_n</script> is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-66"><span class="MJXp-msubsup" id="MJXp-Span-67"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-68" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-69" style="vertical-align: 0.5em;"><span class="MJXp-msubsup" id="MJXp-Span-70"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-71" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-72" style="vertical-align: 0.5em;">N</span></span></span></span></span></span><script type="math/tex" id="MathJax-Element-21">a^{a^N}</script> for some big <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-73"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-74">N</span></span></span><script type="math/tex" id="MathJax-Element-22">N</script>.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint3</b><div class="spoiler-content" style="display: block;"><p>Given <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-75"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-76">a</span></span></span><script type="math/tex" id="MathJax-Element-23">a</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-77"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-78">m</span></span></span><script type="math/tex" id="MathJax-Element-24">m</script> find a condition for <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-79"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-80">a</span></span></span><script type="math/tex" id="MathJax-Element-25">a</script> to be <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-81"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-82">m</span></span></span><script type="math/tex" id="MathJax-Element-26">m</script>-tetrative.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint4</b><div class="spoiler-content" style="display: block;"><p>The condition is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-83"><span class="MJXp-mi" id="MJXp-Span-84">∀</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-85">p</span><span class="MJXp-mrow" id="MJXp-Span-86"><span class="MJXp-mo" id="MJXp-Span-87" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-88">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-89">r</span><span class="MJXp-msubsup" id="MJXp-Span-90"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-91" style="margin-right: 0.05em;">d</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-92" style="vertical-align: -0.4em;">m</span></span><span class="MJXp-mo" id="MJXp-Span-93" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-94">a</span><span class="MJXp-mo" id="MJXp-Span-95" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-96" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-97">p</span><span class="MJXp-mrow" id="MJXp-Span-98"><span class="MJXp-mo" id="MJXp-Span-99" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-100">a</span></span></span><script type="math/tex" id="MathJax-Element-27">\forall p|ord_m(a), p|a</script>.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint5</b><div class="spoiler-content" style="display: block;"><p>Fix the number of values of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-101"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-102">a</span></span></span><script type="math/tex" id="MathJax-Element-28">a</script> such that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-103"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-104">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-105">r</span><span class="MJXp-msubsup" id="MJXp-Span-106"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-107" style="margin-right: 0.05em;">d</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-108" style="vertical-align: -0.4em;">m</span></span><span class="MJXp-mo" id="MJXp-Span-109" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-110">a</span><span class="MJXp-mo" id="MJXp-Span-111" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-112" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-113">k</span></span></span><script type="math/tex" id="MathJax-Element-29">ord_m(a) = k</script> and get a formula.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint6</b><div class="spoiler-content" style="display: block;"><p>If <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-114"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-115">m</span></span></span><script type="math/tex" id="MathJax-Element-30">m</script> is an odd prime power, the number above for <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-116"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-117">k</span><span class="MJXp-mrow" id="MJXp-Span-118"><span class="MJXp-mo" id="MJXp-Span-119" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-120">φ</span><span class="MJXp-mo" id="MJXp-Span-121" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-122">m</span><span class="MJXp-mo" id="MJXp-Span-123" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-31">k|\varphi(m)</script> is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-124"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-125">φ</span><span class="MJXp-mo" id="MJXp-Span-126" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-127">k</span><span class="MJXp-mo" id="MJXp-Span-128" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-32">\varphi(k)</script>.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint7</b><div class="spoiler-content" style="display: block;"><p>Manipulate the formula until it only depends on the prime divisors of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-129"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-130">φ</span><span class="MJXp-mo" id="MJXp-Span-131" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-132">m</span><span class="MJXp-mo" id="MJXp-Span-133" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-33">\varphi(m)</script> that are not in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-134"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-135">m</span></span></span><script type="math/tex" id="MathJax-Element-34">m</script>.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint8</b><div class="spoiler-content" style="display: block;"><p>Factor it to calculate it in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-136"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-137">O</span><span class="MJXp-mo" id="MJXp-Span-138" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi" id="MJXp-Span-139">log</span><span class="MJXp-mo" id="MJXp-Span-140" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-141">m</span><span class="MJXp-mo" id="MJXp-Span-142" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-35">O(\log m)</script>.</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2147/problem/G" title="Codeforces Global Round 29 (Div. 1 + Div. 2)">2147G - Modular Tetration</a></h3><div class="ttypography"><div class="problem-statement"><div><p>Suppose $$$a&gt;1$$$ and $$$\gcd(a,m) = 1$$$. Observe that the sequence $$$b$$$ is of the form $$$a^{a^N}$$$ for a very big $$$N$$$ after $$$n&gt;3$$$. So $$$b_n \equiv 1 \pmod m$$$ is equivalent to $$$a^N \equiv 0 \pmod {ord_m(a)}$$$. Since $$$N$$$ goes to infinity as $$$n$$$ increases, it is equivalent to the condition $$$\forall p| ord_m(a), p| a$$$ or $$$rad(ord_m(a))|a$$$. This implies that solutions are periodic: if $$$a$$$ is a solution, so is $$$a+m \cdot ord_m(a)$$$, hence $$$m \varphi(m)$$$ is a period. Fixing an $$$1\leq a &lt; m$$$ try to find numbers of the form $$$a+ \lambda m$$$ such that $$$rad(ord_a(m))| a+\lambda m$$$. Since $$$gcd(a,m)=1$$$, as long as $$$\gcd(ord_a(m),m) = 1$$$ we have by CRT that there exists a unique $$$\lambda$$$ modulo $$$rad(ord_m(a))$$$ that satisfies that condition. Finally, grouping solutions by their order, the density can be written as follows: $$$$$$\frac{1}{m} \sum_{x | \varphi(m), \gcd(x,m)=1} \frac{cnt(x)}{rad(x)}$$$$$$ Where $$$cnt(x)$$$ is the number of values $$$a$$$ that have order exactly $$$x$$$. The sum is over divisors of $$$\varphi(m)$$$ since orders must divide it. </p><p>We are close to a $$$O(d(m))$$$ solution. The values of $$$cnt(x)$$$ are well known for odd prime power modulos: there are $$$\varphi(x)$$$ values $$$a$$$ with order exactly $$$x$$$ modulo $$$p_i^{\alpha_i}$$$ (and powers of $$$2$$$ do not matter since the order has to be coprime with $$$m$$$). Using that $$$ord_{xy}(a) = lcm(ord_x(a), ord_y(a))$$$ one can compute $$$cnt$$$ and have a $$$O(d(m))$$$ solution. This is however not enough to pass since there are $$$T = 10000$$$ tests.</p><p>So we had that the answer is $$$\frac{1}{m} \sum_{x | \varphi(m), \gcd(x,m)=1} \frac{cnt(x)}{rad(x)}$$$ Where $$$cnt$$$ is the number of values a that have order exactly $$$x$$$. Our goal is to fix $$$rad(x)$$$ and compute $$$\sum cnt(x)$$$ over $$$x$$$'s such that $$$rad(x) = k$$$. There might be an easier way to derive it but the following works: denoting $$$q_i$$$ the primes of $$$k$$$ and $$$q_i^{\beta_i}$$$ the exponents of $$$q_i$$$ in $$$\varphi(m)$$$, $$$$$$ \sum_{x|\varphi(m), rad(x) | k} cnt(x) = \sum_{d_1| q_1^{\beta_1}, \ldots , d_t | q_t^{\beta_t}} \prod \varphi(d_i) $$$$$$ $$$$$$= \prod_i \sum_{d | q_i^{\beta_i}} \varphi(d) $$$$$$ $$$$$$= \prod q_i^{\beta_i} $$$$$$ Möbius inversion (or inclusion exclusion) gives $$$$$$\sum_{x|\varphi(m), rad(x) = k} cnt(x) = \sum_{I \subset [t]} (-1)^{t-|I|}\prod_{i \in I}q_i^{\beta_i} = \prod (q_i^{\beta_i}-1)$$$$$$ So the answer can be written as $$$$$$\frac{1}{m} \sum_{I \subset [t]}\sum_{rad(x) = \prod q_i} \frac{\prod {(q_i^{\beta_i} -1)}}{\prod q_i }$$$$$$ Which can be factored as $$$\frac{1}{m} \prod (1 + \frac{q_i^{\beta_i}-1}{q_i})$$$, the product is over all prime factors $$$q_i^{\beta_i}$$$ of $$$\varphi(m)$$$ that are not of $$$m$$$. This formula can be computed in $$$O(\log m)$$$ by factoring $$$m$$$ and $$$\varphi(m)$$$.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Code</b><div class="spoiler-content" style="display: block;"><p><a href="https://codeforces.com/contest/2147/submission/339616197" title="Submission 339616197 by treebutton">339616197</a></p></div></div><h3><a href="https://codeforces.com/contest/2147/problem/H">H. Maxflow GCD Coloring</a></h3><p>Author: <a class="rated-user user-orange" href="https://codeforces.com/profile/FelixMP" title="International Master FelixMP">FelixMP</a> Preparation: <a class="rated-user user-orange" href="https://codeforces.com/profile/FelixMP" title="International Master FelixMP">FelixMP</a></p> <div class="spoiler"><b class="spoiler-title">Hint1</b><div class="spoiler-content" style="display: block;"><p>Think of min-cut instead of max-flow.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint2</b><div class="spoiler-content" style="display: block;"><p>Can you think of a sufficient condition so that all the min-cuts between any pair of vertices are divisible by the same number?</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint3</b><div class="spoiler-content" style="display: block;"><p>In fact, the expected sufficient condition implies that all cuts of the graph (not just min-cuts) are divisible by the same number.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint4</b><div class="spoiler-content" style="display: block;"><p>The minimum number of colors is always <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-143"><span class="MJXp-mn" id="MJXp-Span-144">1</span></span></span><script type="math/tex" id="MathJax-Element-36">1</script> or <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-145"><span class="MJXp-mn" id="MJXp-Span-146">2</span></span></span><script type="math/tex" id="MathJax-Element-37">2</script>. You can check if the answer is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-147"><span class="MJXp-mn" id="MJXp-Span-148">1</span></span></span><script type="math/tex" id="MathJax-Element-38">1</script> by brute force. </p></div></div> <div class="spoiler"><b class="spoiler-title">Hint5</b><div class="spoiler-content" style="display: block;"><p>It is possible to make all cuts even in each induced subgraph using just <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-149"><span class="MJXp-mn" id="MJXp-Span-150">2</span></span></span><script type="math/tex" id="MathJax-Element-39">2</script> colors. </p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2147/problem/H" title="Codeforces Global Round 29 (Div. 1 + Div. 2)">2147H - Maxflow GCD Coloring</a></h3><div class="ttypography"><div class="problem-statement"><div><p>Check if the answer is $$$1$$$ using Gomory-Hu tree to compute the maximum flow between all pairs of vertices. If not, it is always possible to use $$$2$$$ colors by partitioning the vertices into two induced subgraphs so that each vertex is incident to an even number of edges with odd capacities. This will satisfy the condition since all the cuts will be even (and, in particular, the minimum cut between any two vertices will have an even value). </p><p>In order to find the partition, first discard all the even edges. Find a vertex with odd degree, add an edge between each pair of its neighbors, remove the vertex, and recursively solve the problem for the remaining graph. Then add the vertex back and delete the additional edges; the edge can be colored in one of the two colors so that the parity condition remains satisfied.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Code</b><div class="spoiler-content" style="display: block;"><p><a href="https://codeforces.com/contest/2147/submission/339616226" title="Submission 339616226 by treebutton">339616226</a></p></div></div><h3><a href="https://codeforces.com/contest/2147/problem/I1">I1. Longest Increasing Path (Easy Version)</a></h3><p>Author: <a class="rated-user user-orange" href="https://codeforces.com/profile/BernatP" title="Master BernatP">BernatP</a> Preparation: <a class="rated-user user-orange" href="https://codeforces.com/profile/BernatP" title="Master BernatP">BernatP</a></p> <div class="spoiler"><b class="spoiler-title">Hint1</b><div class="spoiler-content" style="display: block;"><p>The expected is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-151"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-152">n</span><span class="MJXp-mo" id="MJXp-Span-153" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-154">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-155">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-156">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-157">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-158">m</span><span class="MJXp-mo" id="MJXp-Span-159" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-160">O</span><span class="MJXp-mo" id="MJXp-Span-161" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-162">m</span><span class="MJXp-mo" id="MJXp-Span-163" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-40">n = mlogm - O(m)</script> steps using harmonic sum.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint2</b><div class="spoiler-content" style="display: block;"><p>Think of a solution in 2D (not needed but good intuition).</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint3</b><div class="spoiler-content" style="display: block;"><p>Put points as an almost regular polygon and keep doing circles around it jumping with step <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-164"><span class="MJXp-mn" id="MJXp-Span-165">1</span></span></span><script type="math/tex" id="MathJax-Element-41">1</script>, then <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-166"><span class="MJXp-mn" id="MJXp-Span-167">2</span></span></span><script type="math/tex" id="MathJax-Element-42">2</script>, then <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-168"><span class="MJXp-mn" id="MJXp-Span-169">3</span></span></span><script type="math/tex" id="MathJax-Element-43">3</script>...</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint4</b><div class="spoiler-content" style="display: block;"><p>Think how to project this solution to 1D</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><div class="problemTutorial" problemcode="2147I1">Tutorial is loading...</div></div></div> <div class="spoiler"><b class="spoiler-title">Code</b><div class="spoiler-content" style="display: block;"><p><a href="https://codeforces.com/contest/2147/submission/339616257" title="Submission 339616257 by treebutton">339616257</a></p></div></div><h3><a href="https://codeforces.com/contest/2147/problem/I2">I2. Longest Increasing Path (Hard Version)</a></h3><p>Author: <a class="rated-user user-orange" href="https://codeforces.com/profile/BernatP" title="Master BernatP">BernatP</a> Preparation: <a class="rated-user user-orange" href="https://codeforces.com/profile/BernatP" title="Master BernatP">BernatP</a></p> <div class="spoiler"><b class="spoiler-title">Hint1</b><div class="spoiler-content" style="display: block;"><p>There is a <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-170"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-171">n</span><span class="MJXp-mo" id="MJXp-Span-172" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-173">2</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-174">m</span><span class="MJXp-mo" id="MJXp-Span-175" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-176">3</span></span></span><script type="math/tex" id="MathJax-Element-44">n = 2m-3</script> solution that will be useful: given two groups of points in arithmetic progression far enough apart you can add two pivots in the middle to keep jumping from the left to the right group: ..... .. .....</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint2</b><div class="spoiler-content" style="display: block;"><p>The goal is to recursively construct a solution using smaller ones.</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2147/problem/I2" title="Codeforces Global Round 29 (Div. 1 + Div. 2)">2147I2 - Longest Increasing Path (Hard Version)</a></h3><div class="ttypography"><div class="problem-statement"><div><p>First, consider the following construction that does about $$$2m$$$ jumps: Choose $$$t$$$ and place $$$t$$$ points in arithmetic progression (we call it a <span class="tex-font-style-it">cluster</span>), then two points in the middle (called <span class="tex-font-style-it">standard pivots</span>) and another t points in another cluster to the right. If you start from the rightmost point in the left cluster, you can keep jumping between clusters using one of the pivots points. In total you do $$$4t-2$$$ jumps. The following image is with $$$t = 3$$$. </p><center> <img class="tex-graphics" src="https://espresso.codeforces.com/ad59d3c7a54f9f00e61785a4dc66f5f5151ea57c.png" style="max-width: 100.0%;max-height: 100.0%;"> </center><p>If you are standing at some vertex of a cluster but it is not the rightmost one, you can use one extra point as auxiliary to then move to another point in the cluster in 2 moves. Call those points <span class="tex-font-style-it">directional pivots</span>.</p><p>Now, given two clusters of size $$$t$$$ far away enough, by adding two standard pivots and maybe a directional pivot we will do at least $$$4t-2$$$ jumps ($$$4t$$$ if directional pivot is used) by adding at most 3 extra points.</p><p>Now suppose we are given a construction with $$$m'$$$ different points and $$$g(m')$$$ jumps. Intuitively, we can convert every point into a cluster of $$$t$$$ points $$$\epsilon$$$-distance apart from each other and for every jump in the construction, add at most 3 new points to get extra $$$4t-2$$$ jumps. That is, we can use the construction to find another construction for $$$m = tm' +3g(m')$$$ that does $$$(4t-2)g(m')$$$ jumps. </p><p>In practice, recursively compute the solution for $$$m'$$$ and scale up all points by a large enough factor $$$C$$$ and build a cluster of $$$t&gt;1$$$ points near every point in the given construction. For every jump in the given construction, now we can add two standard pivots and (if needed) a directional pivot such that for every old jump now we do at least $$$4t-2$$$ jumps.</p><p>Now for a given $$$m$$$ we want to find the best ($$$t$$$, $$$m'$$$). To do this we can run a DP. Let $$$g[m]$$$ be the maximum number of jumps we currently can do with $$$m$$$ different points.</p><p>Iterate over $$$m'$$$ and then over $$$t$$$ updating $$$$$$g[tm'+3g[m']] \geq (4t-2)g[m']$$$$$$ This takes $$$O(m \log m)$$$ since it's the harmonic sum.</p><p>Apart from this, maintain for each $$$m$$$ the value $$$t$$$ that was used. Now, when given $$$m$$$, you can instantly find the best ($$$t$$$, $$$m'$$$) according to the DP, recursively compute the answer for $$$m'$$$ and apply the clustering construction we mentioned.</p><p>This gives about $$$200k$$$ jumps if applied naively with base cases for $$$2$$$, $$$3$$$. To get the $$$300k$$$ (AC), it is needed to precompute the best possible configurations for $$$m = 2,3,4, \ldots ,7$$$. It can be done in many smarter ways, but one way is to run a naive $$$O(m^3)$$$ DP on randomly generated points in [$$$0$$$, $$$50$$$] until it finds a good enough answer.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Code</b><div class="spoiler-content" style="display: block;"><p><a href="https://codeforces.com/contest/2147/submission/339616281" title="Submission 339616281 by treebutton">339616281</a></p></div></div></div>

    </div>


        <div style="font-size: 1.1rem;line-height: 1.1rem;padding-bottom: 0.5em;">
            <img src="https://codeforces.com//codeforces.com/codeforces.org/s/52448/images/icons/paperclip-16x16.png" style="vertical-align: middle;"> <span style="padding: 0 0.35em;">Tutorial of <a href="https://codeforces.com/contest/2147" class="notice" style="text-decoration: none;">Codeforces Global Round 29 (Div. 1 + Div. 2)</a> </span>
        </div>
        
            

  <script>
    // Make all spoilers toggleable
    document.querySelectorAll('.spoiler-title').forEach(title => {
      title.addEventListener('click', function() {
        const spoiler = this.closest('.spoiler');
        spoiler.classList.toggle('open');
      });
    });
    
    // Open all spoilers by default for easier reading
    document.querySelectorAll('.spoiler').forEach(spoiler => {
      spoiler.classList.add('open');
    });
  </script>
</body>
</html>