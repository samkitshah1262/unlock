<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tutorial</title>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
      line-height: 1.6;
      color: #333;
      background: #fafafa;
    }
    .ttypography {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    h3 {
      color: #1a1a1a;
      border-bottom: 2px solid #eee;
      padding-bottom: 10px;
    }
    h3 a {
      color: #0066cc;
      text-decoration: none;
    }
    h3 a:hover {
      text-decoration: underline;
    }
    .spoiler {
      margin: 15px 0;
      border: 1px solid #ddd;
      border-radius: 6px;
      overflow: hidden;
    }
    .spoiler-title {
      display: block;
      padding: 12px 15px;
      background: #f0f0f0;
      cursor: pointer;
      font-weight: 600;
      user-select: none;
      border-bottom: 1px solid #ddd;
    }
    .spoiler-title:hover {
      background: #e8e8e8;
    }
    .spoiler-title::before {
      content: '▶ ';
      font-size: 0.8em;
      transition: transform 0.2s;
      display: inline-block;
    }
    .spoiler.open .spoiler-title::before {
      content: '▼ ';
    }
    .spoiler-content {
      padding: 15px;
      background: #fff;
      display: none;
    }
    .spoiler.open .spoiler-content {
      display: block;
    }
    pre, code {
      background: #f5f5f5;
      font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
      font-size: 0.85em;
    }
    pre {
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
    }
    code {
      padding: 2px 5px;
      border-radius: 3px;
    }
    p {
      margin: 10px 0;
    }
    .MathJax {
      font-size: 1.1em;
    }
  </style>
</head>
<body>
  <h1>Editorial</h1>
  <p><a href="https://codeforces.com/blog/entry/141155" target="_blank">View on Codeforces →</a></p>
  
  <div class="ttypography"><p>Thanks for participation!</p><p><a href="https://codeforces.com/contest/2084/problem/A">2084A - Max and Mod</a></p><p>Idea: <a class="rated-user user-red" href="https://codeforces.com/profile/zltzlt" title="International Grandmaster zltzlt">zltzlt</a></p> <div class="spoiler"><b class="spoiler-title">Hint 1</b><div class="spoiler-content" style="display: block;"><p>By observing the example, we can see that there is no solution when <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1" style="width: 0.814em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.6em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-2"><span class="mi" id="MathJax-Span-3" style="font-family: MathJax_Math-italic;">n</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi></math></span></span><script type="math/tex" id="MathJax-Element-1">n</script> is even.</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2084/problem/A" title="Teza Round 1 (Codeforces Round 1015, Div. 1 + Div. 2)">2084A - Max and Mod</a></h3><div class="ttypography"><div class="problem-statement"><div><p>When <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-867"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-868">n</span></span></span><script type="math/tex" id="MathJax-Element-162">n</script> is odd, we can construct <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-869"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-870">p</span><span class="MJXp-mo" id="MJXp-Span-871" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-872" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-873">n</span><span class="MJXp-mo" id="MJXp-Span-874" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-875">1</span><span class="MJXp-mo" id="MJXp-Span-876" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-877">2</span><span class="MJXp-mo" id="MJXp-Span-878" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-879" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-880" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-881">n</span><span class="MJXp-mo" id="MJXp-Span-882" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-883">1</span><span class="MJXp-mo" id="MJXp-Span-884" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-163">p = [n, 1, 2, \ldots, n - 1]</script>. In this case:</p><ul> <li> For <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-885"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-886">i</span><span class="MJXp-mo" id="MJXp-Span-887" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-888">2</span></span></span><script type="math/tex" id="MathJax-Element-164">i = 2</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-889"><span class="MJXp-mo" id="MJXp-Span-890" style="margin-left: 0.333em; margin-right: 0.333em;">max</span><span class="MJXp-mo" id="MJXp-Span-891" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-892"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-893" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-894" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-895" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-896"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-897" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-898" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-899" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-900" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-901">n</span></span></span><script type="math/tex" id="MathJax-Element-165">\max(p_1, p_2) = n</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-902"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-903">n</span><span class="MJXp-mo" id="MJXp-Span-904" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mn" id="MJXp-Span-905">2</span><span class="MJXp-mo" id="MJXp-Span-906" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-907">1</span></span></span><script type="math/tex" id="MathJax-Element-166">n \bmod 2 = 1</script>. </li><li> For <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-908"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-909">i</span><span class="MJXp-mo" id="MJXp-Span-910" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mn" id="MJXp-Span-911">3</span></span></span><script type="math/tex" id="MathJax-Element-167">i \geq 3</script>, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-912"><span class="MJXp-mo" id="MJXp-Span-913" style="margin-left: 0.333em; margin-right: 0.333em;">max</span><span class="MJXp-mo" id="MJXp-Span-914" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-915"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-916" style="margin-right: 0.05em;">p</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-917" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-918">i</span><span class="MJXp-mo" id="MJXp-Span-919">−</span><span class="MJXp-mn" id="MJXp-Span-920">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-921" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-922"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-923" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-924" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-925" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-926" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-927">i</span><span class="MJXp-mo" id="MJXp-Span-928" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-929">1</span></span></span><script type="math/tex" id="MathJax-Element-168">\max(p_{i - 1}, p_i) = i - 1</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-930"><span class="MJXp-mo" id="MJXp-Span-931" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-932">i</span><span class="MJXp-mo" id="MJXp-Span-933" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-934">1</span><span class="MJXp-mo" id="MJXp-Span-935" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-936" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-937">i</span><span class="MJXp-mo" id="MJXp-Span-938" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-939">i</span><span class="MJXp-mo" id="MJXp-Span-940" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-941">1</span></span></span><script type="math/tex" id="MathJax-Element-169">(i - 1) \bmod i = i - 1</script>. </li></ul><p>It can be proven that there is no solution when <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-942"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-943">n</span></span></span><script type="math/tex" id="MathJax-Element-170">n</script> is even. Clearly, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-944"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-945">n</span></span></span><script type="math/tex" id="MathJax-Element-171">n</script> cannot be placed at <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-946"><span class="MJXp-msubsup" id="MJXp-Span-947"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-948" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-949" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-950" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-951"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-952" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-953" style="vertical-align: -0.4em;">2</span></span></span></span><script type="math/tex" id="MathJax-Element-172">p_1, p_2</script>, or <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-954"><span class="MJXp-msubsup" id="MJXp-Span-955"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-956" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-957" style="vertical-align: -0.4em;">n</span></span></span></span><script type="math/tex" id="MathJax-Element-173">p_n</script>. If <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-958"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-959">n</span></span></span><script type="math/tex" id="MathJax-Element-174">n</script> is placed in position <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-960"><span class="MJXp-mn" id="MJXp-Span-961">3</span><span class="MJXp-mo" id="MJXp-Span-962" style="margin-left: 0.333em; margin-right: 0.333em;">∼</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-963">n</span><span class="MJXp-mo" id="MJXp-Span-964" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-965">1</span></span></span><script type="math/tex" id="MathJax-Element-175">3 \sim n - 1</script>, let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-966"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-967">x</span></span></span><script type="math/tex" id="MathJax-Element-176">x</script> be the position of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-968"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-969">n</span></span></span><script type="math/tex" id="MathJax-Element-177">n</script>, then we have <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-970"><span class="MJXp-mo" id="MJXp-Span-971" style="margin-left: 0.333em; margin-right: 0.333em;">max</span><span class="MJXp-mo" id="MJXp-Span-972" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-973"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-974" style="margin-right: 0.05em;">p</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-975" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-976">x</span><span class="MJXp-mo" id="MJXp-Span-977">−</span><span class="MJXp-mn" id="MJXp-Span-978">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-979" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-980"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-981" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-982" style="vertical-align: -0.4em;">x</span></span><span class="MJXp-mo" id="MJXp-Span-983" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-984" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-985" style="margin-left: 0.333em; margin-right: 0.333em;">max</span><span class="MJXp-mo" id="MJXp-Span-986" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-987"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-988" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-989" style="vertical-align: -0.4em;">x</span></span><span class="MJXp-mo" id="MJXp-Span-990" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-991"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-992" style="margin-right: 0.05em;">p</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-993" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-994">x</span><span class="MJXp-mo" id="MJXp-Span-995">+</span><span class="MJXp-mn" id="MJXp-Span-996">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-997" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-998" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-999">n</span></span></span><script type="math/tex" id="MathJax-Element-178">\max(p_{x - 1}, p_x) = \max(p_x, p_{x + 1}) = n</script>.</p><p>Thus, there must exist an even number <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1000"><span class="MJXp-mn" id="MJXp-Span-1001">2</span><span class="MJXp-mo" id="MJXp-Span-1002" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1003">i</span><span class="MJXp-mo" id="MJXp-Span-1004" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1005">n</span></span></span><script type="math/tex" id="MathJax-Element-179">2 \leq i \leq n</script> such that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1006"><span class="MJXp-mo" id="MJXp-Span-1007" style="margin-left: 0.333em; margin-right: 0.333em;">max</span><span class="MJXp-mo" id="MJXp-Span-1008" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1009"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1010" style="margin-right: 0.05em;">p</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1011" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1012">i</span><span class="MJXp-mo" id="MJXp-Span-1013">−</span><span class="MJXp-mn" id="MJXp-Span-1014">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-1015" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1016"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1017" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1018" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1019" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1020" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1021">n</span></span></span><script type="math/tex" id="MathJax-Element-180">\max(p_{i - 1}, p_i) = n</script> and it must satisfy <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1022"><span class="MJXp-mo" id="MJXp-Span-1023" style="margin-left: 0.333em; margin-right: 0.333em;">max</span><span class="MJXp-mo" id="MJXp-Span-1024" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1025"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1026" style="margin-right: 0.05em;">p</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1027" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1028">i</span><span class="MJXp-mo" id="MJXp-Span-1029">−</span><span class="MJXp-mn" id="MJXp-Span-1030">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-1031" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1032"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1033" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1034" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1035" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1036" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1037">i</span><span class="MJXp-mo" id="MJXp-Span-1038" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1039">i</span><span class="MJXp-mo" id="MJXp-Span-1040" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-1041">1</span></span></span><script type="math/tex" id="MathJax-Element-181">\max(p_{i - 1}, p_i) \bmod i = i - 1</script>. However, an even number modulo another even number can never yield an odd result, leading to a contradiction.</p><p><span class="tex-font-style-bf">Time complexity</span>: <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1042"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1043">O</span><span class="MJXp-mo" id="MJXp-Span-1044" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1045">n</span><span class="MJXp-mo" id="MJXp-Span-1046" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-182">O(n)</script> per test case.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Implementation</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="kwd">int</span><span class="pln"> T</span><span class="pun">,</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
	cin </span><span class="pun">&gt;&gt;</span><span class="pln"> T</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">T</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">n </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			cout </span><span class="pun">&lt;&lt;</span><span class="pln"> n </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">' '</span><span class="pun">;</span><span class="pln">
			</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
				cout </span><span class="pun">&lt;&lt;</span><span class="pln"> i </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">" \n"</span><span class="pun">[</span><span class="pln">i </span><span class="pun">==</span><span class="pln"> n </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">];</span><span class="pln">
			</span><span class="pun">}</span><span class="pln">
		</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"-1\n"</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	</span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2084/problem/B">2084B - MIN = GCD</a></p><p>Idea: <a class="rated-user user-red" href="https://codeforces.com/profile/zltzlt" title="International Grandmaster zltzlt">zltzlt</a></p> <div class="spoiler"><b class="spoiler-title">Hint 1</b><div class="spoiler-content" style="display: block;"><p>Consider the position of the minimum value after rearranging the sequence.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 2</b><div class="spoiler-content" style="display: block;"><p>What kind of numbers should be placed on the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-2-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo movablelimits=&quot;true&quot; form=&quot;prefix&quot;&gt;min&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-4" style="width: 2.221em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.68em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1001.68em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-5"><span class="mo" id="MathJax-Span-6" style="font-family: MathJax_Main;">min</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo movablelimits="true" form="prefix">min</mo></math></span></span><script type="math/tex" id="MathJax-Element-2">\min</script> side, and what kind should be placed on the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-3-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo movablelimits=&quot;true&quot; form=&quot;prefix&quot;&gt;gcd&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-7" style="width: 2.005em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.518em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.301em, 1001.52em, 2.546em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-8"><span class="mo" id="MathJax-Span-9" style="font-family: MathJax_Main;">gcd</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.361em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo movablelimits="true" form="prefix">gcd</mo></math></span></span><script type="math/tex" id="MathJax-Element-3">\gcd</script> side?</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2084/problem/B" title="Teza Round 1 (Codeforces Round 1015, Div. 1 + Div. 2)">2084B - MIN = GCD</a></h3><div class="ttypography"><div class="problem-statement"><div><p>For any positive integer sequence <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1047"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1048">a</span></span></span><script type="math/tex" id="MathJax-Element-183">a</script>, we always have <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1049"><span class="MJXp-mo" id="MJXp-Span-1050" style="margin-left: 0.333em; margin-right: 0.333em;">gcd</span><span class="MJXp-mo" id="MJXp-Span-1051" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1052">a</span><span class="MJXp-mo" id="MJXp-Span-1053" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1054" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mo" id="MJXp-Span-1055" style="margin-left: 0.333em; margin-right: 0.333em;">min</span><span class="MJXp-mo" id="MJXp-Span-1056" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1057">a</span><span class="MJXp-mo" id="MJXp-Span-1058" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-184">\gcd(a) \leq \min(a)</script>. Let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1059"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1060">x</span><span class="MJXp-mo" id="MJXp-Span-1061" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-1062" style="margin-left: 0.333em; margin-right: 0.333em;">min</span><span class="MJXp-mo" id="MJXp-Span-1063" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1064">a</span><span class="MJXp-mo" id="MJXp-Span-1065" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-185">x = \min(a)</script>, then <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1066"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1067">x</span></span></span><script type="math/tex" id="MathJax-Element-186">x</script> must be placed on the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1068"><span class="MJXp-mo" id="MJXp-Span-1069" style="margin-left: 0.333em; margin-right: 0.333em;">min</span><span class="MJXp-mo" id="MJXp-Span-1070" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mo" id="MJXp-Span-1071" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-msubsup" id="MJXp-Span-1072"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1073" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1074" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-1075" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1076"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1077" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1078" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1079" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-1080" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-1081" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1082"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1083" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1084" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1085" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1086" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-187">\min([a_1, a_2, \ldots, a_i])</script> side. Thus, we can conclude that:</p><p><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-1087"><span class="MJXp-mo" id="MJXp-Span-1088" style="margin-left: 0.333em; margin-right: 0.333em;">min</span><span class="MJXp-mo" id="MJXp-Span-1089" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mo" id="MJXp-Span-1090" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-msubsup" id="MJXp-Span-1091"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1092" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1093" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-1094" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1095"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1096" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1097" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1098" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-1099" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-1100" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1101"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1102" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1103" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1104" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1105" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1106" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-1107" style="margin-left: 0.333em; margin-right: 0.333em;">gcd</span><span class="MJXp-mo" id="MJXp-Span-1108" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mo" id="MJXp-Span-1109" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-msubsup" id="MJXp-Span-1110"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1111" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1112" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1113">i</span><span class="MJXp-mo" id="MJXp-Span-1114">+</span><span class="MJXp-mn" id="MJXp-Span-1115">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-1116" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1117"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1118" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1119" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1120">i</span><span class="MJXp-mo" id="MJXp-Span-1121">+</span><span class="MJXp-mn" id="MJXp-Span-1122">2</span></span></span><span class="MJXp-mo" id="MJXp-Span-1123" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-1124" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-1125" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1126"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1127" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1128" style="vertical-align: -0.4em;">n</span></span><span class="MJXp-mo" id="MJXp-Span-1129" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1130" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1131" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1132">x</span></span></span><script type="math/tex; mode=display" id="MathJax-Element-188">\min([a_1, a_2, \ldots, a_i]) = \gcd([a_{i + 1}, a_{i + 2}, \ldots, a_n]) = x</script></p><p>Now, we need to select some numbers, excluding one occurrence of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1133"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1134">x</span></span></span><script type="math/tex" id="MathJax-Element-189">x</script>, to be placed on the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1135"><span class="MJXp-mo" id="MJXp-Span-1136" style="margin-left: 0.333em; margin-right: 0.333em;">gcd</span><span class="MJXp-mo" id="MJXp-Span-1137" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mo" id="MJXp-Span-1138" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-msubsup" id="MJXp-Span-1139"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1140" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1141" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1142">i</span><span class="MJXp-mo" id="MJXp-Span-1143">+</span><span class="MJXp-mn" id="MJXp-Span-1144">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-1145" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1146"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1147" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1148" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1149">i</span><span class="MJXp-mo" id="MJXp-Span-1150">+</span><span class="MJXp-mn" id="MJXp-Span-1151">2</span></span></span><span class="MJXp-mo" id="MJXp-Span-1152" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-1153" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-1154" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1155"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1156" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1157" style="vertical-align: -0.4em;">n</span></span><span class="MJXp-mo" id="MJXp-Span-1158" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1159" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-190">\gcd([a_{i + 1}, a_{i + 2}, \ldots, a_n])</script> side, ensuring that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1160"><span class="MJXp-mo" id="MJXp-Span-1161" style="margin-left: 0.333em; margin-right: 0.333em;">gcd</span><span class="MJXp-mo" id="MJXp-Span-1162" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mo" id="MJXp-Span-1163" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-msubsup" id="MJXp-Span-1164"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1165" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1166" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1167">i</span><span class="MJXp-mo" id="MJXp-Span-1168">+</span><span class="MJXp-mn" id="MJXp-Span-1169">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-1170" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1171"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1172" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1173" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1174">i</span><span class="MJXp-mo" id="MJXp-Span-1175">+</span><span class="MJXp-mn" id="MJXp-Span-1176">2</span></span></span><span class="MJXp-mo" id="MJXp-Span-1177" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-1178" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-1179" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1180"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1181" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1182" style="vertical-align: -0.4em;">n</span></span><span class="MJXp-mo" id="MJXp-Span-1183" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1184" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1185" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1186">x</span></span></span><script type="math/tex" id="MathJax-Element-191">\gcd([a_{i + 1}, a_{i + 2}, \ldots, a_n]) = x</script>.</p><p>A greedy strategy is to place all multiples of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1187"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1188">x</span></span></span><script type="math/tex" id="MathJax-Element-192">x</script> on the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1189"><span class="MJXp-mo" id="MJXp-Span-1190" style="margin-left: 0.333em; margin-right: 0.333em;">gcd</span></span></span><script type="math/tex" id="MathJax-Element-193">\gcd</script> side after removing one occurrence of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1191"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1192">x</span></span></span><script type="math/tex" id="MathJax-Element-194">x</script>. This minimizes <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1193"><span class="MJXp-mo" id="MJXp-Span-1194" style="margin-left: 0.333em; margin-right: 0.333em;">gcd</span></span></span><script type="math/tex" id="MathJax-Element-195">\gcd</script> while ensuring it remains a multiple of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1195"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1196">x</span></span></span><script type="math/tex" id="MathJax-Element-196">x</script>.</p><p>Thus, we only need to check whether the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1197"><span class="MJXp-mo" id="MJXp-Span-1198" style="margin-left: 0.333em; margin-right: 0.333em;">gcd</span></span></span><script type="math/tex" id="MathJax-Element-197">\gcd</script> of the remaining multiples of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1199"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1200">x</span></span></span><script type="math/tex" id="MathJax-Element-198">x</script> (after removing one occurrence of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1201"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1202">x</span></span></span><script type="math/tex" id="MathJax-Element-199">x</script>) is still equal to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1203"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1204">x</span></span></span><script type="math/tex" id="MathJax-Element-200">x</script>.</p><p><span class="tex-font-style-bf">Time complexity</span>: <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1205"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1206">O</span><span class="MJXp-mo" id="MJXp-Span-1207" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1208">n</span><span class="MJXp-mo" id="MJXp-Span-1209" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi" id="MJXp-Span-1210">log</span><span class="MJXp-mo" id="MJXp-Span-1211" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1212">a</span><span class="MJXp-mo" id="MJXp-Span-1213" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-201">O(n + \log a)</script> or <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1214"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1215">O</span><span class="MJXp-mo" id="MJXp-Span-1216" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1217">n</span><span class="MJXp-mi" id="MJXp-Span-1218">log</span><span class="MJXp-mo" id="MJXp-Span-1219" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1220">a</span><span class="MJXp-mo" id="MJXp-Span-1221" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-202">O(n \log a)</script> (depending on which <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1222"><span class="MJXp-mo" id="MJXp-Span-1223" style="margin-left: 0.333em; margin-right: 0.333em;">gcd</span></span></span><script type="math/tex" id="MathJax-Element-203">\gcd</script> implementation you use) per test case.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Implementation</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">typedef</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> ll</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	ios</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
	cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
	</span><span class="kwd">int</span><span class="pln"> T</span><span class="pun">,</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
	cin </span><span class="pun">&gt;&gt;</span><span class="pln"> T</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">T</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
		vector</span><span class="str">&lt;ll&gt;</span><span class="pln"> a</span><span class="pun">(</span><span class="pln">n</span><span class="pun">);</span><span class="pln">
		</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">ll </span><span class="pun">&amp;</span><span class="pln">x </span><span class="pun">:</span><span class="pln"> a</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			cin </span><span class="pun">&gt;&gt;</span><span class="pln"> x</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="kwd">int</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> min_element</span><span class="pun">(</span><span class="pln">a</span><span class="pun">.</span><span class="kwd">begin</span><span class="pun">(),</span><span class="pln"> a</span><span class="pun">.</span><span class="kwd">end</span><span class="pun">())</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> a</span><span class="pun">.</span><span class="kwd">begin</span><span class="pun">();</span><span class="pln">
		ll g </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="pun">!=</span><span class="pln"> p </span><span class="pun">&amp;&amp;</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">p</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
				g </span><span class="pun">=</span><span class="pln"> __gcd</span><span class="pun">(</span><span class="pln">g</span><span class="pun">,</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]);</span><span class="pln">
			</span><span class="pun">}</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="pun">(</span><span class="pln">g </span><span class="pun">==</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">p</span><span class="pun">]</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="str">"Yes\n"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">"No\n"</span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	</span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2084/problem/C">2084C - You Soared Afar With Grace</a></p><p>Idea: <a class="rated-user user-red" href="https://codeforces.com/profile/CharlieV" title="International Grandmaster CharlieV">CharlieV</a></p> <div class="spoiler"><b class="spoiler-title">Hint 1</b><div class="spoiler-content" style="display: block;"><p>Will the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-4-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-10" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.76em, 2.438em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-11"><span class="msubsup" id="MathJax-Span-12"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-13" style="font-family: MathJax_Math-italic;">b</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-14" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>b</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-4">b_i</script> corresponding to a given <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-5-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-15" style="width: 1.139em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.87em, 2.438em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-16"><span class="msubsup" id="MathJax-Span-17"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-18" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-19" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 0.932em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>a</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-5">a_i</script> change?</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 2</b><div class="spoiler-content" style="display: block;"><p>Individually place each pair corresponding to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-6-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-20" style="width: 3.791em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.871em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1002.76em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-21"><span class="mo" id="MathJax-Span-22" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-23"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-24" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-25" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-26" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-27" style="padding-left: 0.165em;"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-28" style="font-family: MathJax_Math-italic;">b</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-29" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-30" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><msub><mi>a</mi><mi>i</mi></msub><mo>,</mo><msub><mi>b</mi><mi>i</mi></msub><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-6">(a_i, b_i)</script> (i.e., <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-7-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-31" style="width: 3.791em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.871em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1002.76em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-32"><span class="mo" id="MathJax-Span-33" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-34"><span style="display: inline-block; position: relative; width: 0.76em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.44em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-35" style="font-family: MathJax_Math-italic;">b</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.436em;"><span class="mi" id="MathJax-Span-36" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-37" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-38" style="padding-left: 0.165em;"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.49em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-39" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.544em;"><span class="mi" id="MathJax-Span-40" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-41" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><msub><mi>b</mi><mi>i</mi></msub><mo>,</mo><msub><mi>a</mi><mi>i</mi></msub><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-7">(b_i, a_i)</script>) at position <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-8-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-42" style="width: 5.143em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.899em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.356em, 1003.85em, 2.438em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-43"><span class="mi" id="MathJax-Span-44" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-45" style="font-family: MathJax_Main; padding-left: 0.219em;">−</span><span class="mi" id="MathJax-Span-46" style="font-family: MathJax_Math-italic; padding-left: 0.219em;">i</span><span class="mo" id="MathJax-Span-47" style="font-family: MathJax_Main; padding-left: 0.219em;">+</span><span class="mn" id="MathJax-Span-48" style="font-family: MathJax_Main; padding-left: 0.219em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.211em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi><mo>−</mo><mi>i</mi><mo>+</mo><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-8">n - i + 1</script>.</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><div class="problemTutorial" problemcode="2084C">Tutorial is loading...</div></div></div> <div class="spoiler"><b class="spoiler-title">Implementation</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> maxn </span><span class="pun">=</span><span class="pln"> </span><span class="lit">200100</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">maxn</span><span class="pun">],</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">maxn</span><span class="pun">],</span><span class="pln"> m</span><span class="pun">,</span><span class="pln"> p</span><span class="pun">[</span><span class="pln">maxn</span><span class="pun">],</span><span class="pln"> ans</span><span class="pun">[</span><span class="pln">maxn</span><span class="pun">][</span><span class="lit">2</span><span class="pun">];</span><span class="pln">

</span><span class="kwd">inline</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> work</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> y</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x </span><span class="pun">==</span><span class="pln"> y</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	ans</span><span class="pun">[++</span><span class="pln">m</span><span class="pun">][</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> x</span><span class="pun">;</span><span class="pln">
	ans</span><span class="pun">[</span><span class="pln">m</span><span class="pun">][</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> y</span><span class="pun">;</span><span class="pln">
	swap</span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">x</span><span class="pun">],</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">y</span><span class="pun">]);</span><span class="pln">
	swap</span><span class="pun">(</span><span class="pln">p</span><span class="pun">[</span><span class="pln">a</span><span class="pun">[</span><span class="pln">x</span><span class="pun">]],</span><span class="pln"> p</span><span class="pun">[</span><span class="pln">a</span><span class="pun">[</span><span class="pln">y</span><span class="pun">]]);</span><span class="pln">
	swap</span><span class="pun">(</span><span class="pln">b</span><span class="pun">[</span><span class="pln">x</span><span class="pun">],</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">y</span><span class="pun">]);</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">void</span><span class="pln"> solve</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		cin </span><span class="pun">&gt;&gt;</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
		p</span><span class="pun">[</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> i</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		cin </span><span class="pun">&gt;&gt;</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	m </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">int</span><span class="pln"> x </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">n </span><span class="pun">%</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> x</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
				cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"-1\n"</span><span class="pun">;</span><span class="pln">
				</span><span class="kwd">return</span><span class="pun">;</span><span class="pln">
			</span><span class="pun">}</span><span class="pln">
			x </span><span class="pun">=</span><span class="pln"> i</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">b</span><span class="pun">[</span><span class="pln">p</span><span class="pun">[</span><span class="pln">b</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]]]</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"-1\n"</span><span class="pun">;</span><span class="pln">
			</span><span class="kwd">return</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">n </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		work</span><span class="pun">(</span><span class="pln">x</span><span class="pun">,</span><span class="pln"> </span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		work</span><span class="pun">(</span><span class="pln">p</span><span class="pun">[</span><span class="pln">b</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]],</span><span class="pln"> n </span><span class="pun">-</span><span class="pln"> i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	cout </span><span class="pun">&lt;&lt;</span><span class="pln"> m </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> m</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		cout </span><span class="pun">&lt;&lt;</span><span class="pln"> ans</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">' '</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> ans</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	ios</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
	cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
	</span><span class="kwd">int</span><span class="pln"> T</span><span class="pun">;</span><span class="pln">
	cin </span><span class="pun">&gt;&gt;</span><span class="pln"> T</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">T</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		solve</span><span class="pun">();</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	</span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2084/problem/D">2084D - Arcology On Permafrost</a></p><p>Idea: <a class="rated-user user-red" href="https://codeforces.com/profile/zltzlt" title="International Grandmaster zltzlt">zltzlt</a></p> <div class="spoiler"><b class="spoiler-title">Hint 1</b><div class="spoiler-content" style="display: block;"><p>Treat "at most <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-9-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-49" style="width: 1.139em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.87em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-50"><span class="mi" id="MathJax-Span-51" style="font-family: MathJax_Math-italic;">m</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>m</mi></math></span></span><script type="math/tex" id="MathJax-Element-9">m</script> operations" as "exactly <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-10-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-52" style="width: 1.139em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.87em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-53"><span class="mi" id="MathJax-Span-54" style="font-family: MathJax_Math-italic;">m</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>m</mi></math></span></span><script type="math/tex" id="MathJax-Element-10">m</script> operations".</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 2</b><div class="spoiler-content" style="display: block;"><p>What is the maximum value of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-11-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-55" style="width: 2.438em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.843em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1001.73em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-56"><span class="mi" id="MathJax-Span-57" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span><span class="mo" id="MathJax-Span-58" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-59" style="font-family: MathJax_Math-italic;">a</span><span class="mo" id="MathJax-Span-60" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi><mo stretchy="false">(</mo><mi>a</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-11">f(a)</script>?</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 3</b><div class="spoiler-content" style="display: block;"><p>Ensure that the distance between each pair of identical numbers is at least <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-12-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-61" style="width: 0.76em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.544em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.54em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-62"><span class="mi" id="MathJax-Span-63" style="font-family: MathJax_Math-italic;">k</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi></math></span></span><script type="math/tex" id="MathJax-Element-12">k</script>.</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2084/problem/D" title="Teza Round 1 (Codeforces Round 1015, Div. 1 + Div. 2)">2084D - Arcology On Permafrost</a></h3><div class="ttypography"><div class="problem-statement"><div><p>Since performing the operation will never increase <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1224"><span class="MJXp-mi" id="MJXp-Span-1225">mex</span></span></span><script type="math/tex" id="MathJax-Element-204">\operatorname{mex}</script> of the sequence, we can treat "at most <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1226"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1227">m</span></span></span><script type="math/tex" id="MathJax-Element-205">m</script> operations" as "exactly <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1228"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1229">m</span></span></span><script type="math/tex" id="MathJax-Element-206">m</script> operations".</p><p>Next, we consider computing the maximum value of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1230"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1231">f</span><span class="MJXp-mo" id="MJXp-Span-1232" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1233">a</span><span class="MJXp-mo" id="MJXp-Span-1234" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-207">f(a)</script>.</p><ul> <li> First, we have <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1235"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1236">f</span><span class="MJXp-mo" id="MJXp-Span-1237" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1238">a</span><span class="MJXp-mo" id="MJXp-Span-1239" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1240" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1241">n</span><span class="MJXp-mo" id="MJXp-Span-1242" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1243">m</span><span class="MJXp-mo" id="MJXp-Span-1244" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1245">k</span></span></span><script type="math/tex" id="MathJax-Element-208">f(a) \leq n - m \cdot k</script> because after the operations, the length of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1246"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1247">a</span></span></span><script type="math/tex" id="MathJax-Element-209">a</script> becomes <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1248"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1249">n</span><span class="MJXp-mo" id="MJXp-Span-1250" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1251">m</span><span class="MJXp-mo" id="MJXp-Span-1252" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1253">k</span></span></span><script type="math/tex" id="MathJax-Element-210">n - m \cdot k</script>, and the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1254"><span class="MJXp-mi" id="MJXp-Span-1255">mex</span></span></span><script type="math/tex" id="MathJax-Element-211">\operatorname{mex}</script> of a sequence must be no more than its length. </li><li> Second, we have <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1256"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1257">f</span><span class="MJXp-mo" id="MJXp-Span-1258" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1259">a</span><span class="MJXp-mo" id="MJXp-Span-1260" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1261" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mfrac" id="MJXp-Span-1262" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1263">n</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1264">m</span><span class="MJXp-mo" id="MJXp-Span-1265">+</span><span class="MJXp-mn" id="MJXp-Span-1266">1</span></span></span></span></span></span></span></span><script type="math/tex" id="MathJax-Element-212">f(a) \leq \frac{n}{m + 1}</script>, because to ensure that all numbers in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1267"><span class="MJXp-mn" id="MJXp-Span-1268">0</span><span class="MJXp-mo" id="MJXp-Span-1269" style="margin-left: 0.333em; margin-right: 0.333em;">∼</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1270">f</span><span class="MJXp-mo" id="MJXp-Span-1271" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1272">a</span><span class="MJXp-mo" id="MJXp-Span-1273" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1274" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-1275">1</span></span></span><script type="math/tex" id="MathJax-Element-213">0 \sim f(a) - 1</script> are not completely removed, each of them must appear at least <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1276"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1277">m</span><span class="MJXp-mo" id="MJXp-Span-1278" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-1279">1</span></span></span><script type="math/tex" id="MathJax-Element-214">m + 1</script> times. </li></ul><p>We claim that the maximum value of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1280"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1281">f</span><span class="MJXp-mo" id="MJXp-Span-1282" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1283">a</span><span class="MJXp-mo" id="MJXp-Span-1284" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-215">f(a)</script> is</p><p><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-1285"><span class="MJXp-mo" id="MJXp-Span-1286" style="margin-left: 0.333em; margin-right: 0.333em;">min</span><span class="MJXp-mo" id="MJXp-Span-1287" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1288">n</span><span class="MJXp-mo" id="MJXp-Span-1289" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1290">m</span><span class="MJXp-mo" id="MJXp-Span-1291" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1292">k</span><span class="MJXp-mo" id="MJXp-Span-1293" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mrow" id="MJXp-Span-1294"><span class="MJXp-mo" id="MJXp-Span-1295" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.5em;"><span class="MJXp-right MJXp-scale5" style="font-size: 3em; margin-left: -0.18em;">⌊</span></span><span class="MJXp-mfrac" id="MJXp-Span-1296" style="vertical-align: 0.25em;"><span class="MJXp-box"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1297">n</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1298">m</span><span class="MJXp-mo" id="MJXp-Span-1299" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-1300">1</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-1301" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.5em;"><span class="MJXp-right MJXp-scale5" style="font-size: 3em; margin-left: -0.18em;">⌋</span></span></span><span class="MJXp-mo" id="MJXp-Span-1302" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex; mode=display" id="MathJax-Element-216">\min(n - m \cdot k, \left\lfloor\frac{n}{m + 1}\right\rfloor)</script></p><p>Next, we prove that this maximum value can be achieved through construction.</p><ul> <li> If <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1303"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1304">n</span><span class="MJXp-mo" id="MJXp-Span-1305" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1306">m</span><span class="MJXp-mo" id="MJXp-Span-1307" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1308">k</span><span class="MJXp-mo" id="MJXp-Span-1309" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mfrac" id="MJXp-Span-1310" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1311">n</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1312">m</span><span class="MJXp-mo" id="MJXp-Span-1313">+</span><span class="MJXp-mn" id="MJXp-Span-1314">1</span></span></span></span></span></span></span></span><script type="math/tex" id="MathJax-Element-217">n - m \cdot k < \frac{n}{m + 1}</script>, then <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1315"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1316">n</span><span class="MJXp-mo" id="MJXp-Span-1317" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mo" id="MJXp-Span-1318" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1319">m</span><span class="MJXp-mo" id="MJXp-Span-1320" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-1321">1</span><span class="MJXp-mo" id="MJXp-Span-1322" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1323" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1324">k</span></span></span><script type="math/tex" id="MathJax-Element-218">n < (m + 1) \cdot k</script>, which implies <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1325"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1326">n</span><span class="MJXp-mo" id="MJXp-Span-1327" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1328">m</span><span class="MJXp-mo" id="MJXp-Span-1329" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1330">k</span><span class="MJXp-mo" id="MJXp-Span-1331" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1332">k</span></span></span><script type="math/tex" id="MathJax-Element-219">n - m \cdot k < k</script>, meaning that the final length of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1333"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1334">a</span></span></span><script type="math/tex" id="MathJax-Element-220">a</script> is less than <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1335"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1336">k</span></span></span><script type="math/tex" id="MathJax-Element-221">k</script>. In this case, we construct <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1337"><span class="MJXp-msubsup" id="MJXp-Span-1338"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1339" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1340" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1341" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1342">i</span><span class="MJXp-mo" id="MJXp-Span-1343" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1344">k</span></span></span><script type="math/tex" id="MathJax-Element-222">a_i = i \bmod k</script>. This ensures that no matter which subarray is removed, the remaining sequence still satisfies <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1345"><span class="MJXp-msubsup" id="MJXp-Span-1346"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1347" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1348" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1349" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1350">i</span><span class="MJXp-mo" id="MJXp-Span-1351" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1352">k</span></span></span><script type="math/tex" id="MathJax-Element-223">a_i = i \bmod k</script>. After performing <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1353"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1354">m</span></span></span><script type="math/tex" id="MathJax-Element-224">m</script> deletions, we are left with <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1355"><span class="MJXp-msubsup" id="MJXp-Span-1356"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1357" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1358" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1359" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1360">i</span></span></span><script type="math/tex" id="MathJax-Element-225">a_i = i</script>. </li><li> If <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1361"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1362">n</span><span class="MJXp-mo" id="MJXp-Span-1363" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1364">m</span><span class="MJXp-mo" id="MJXp-Span-1365" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1366">k</span><span class="MJXp-mo" id="MJXp-Span-1367" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mfrac" id="MJXp-Span-1368" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1369">n</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1370">m</span><span class="MJXp-mo" id="MJXp-Span-1371">+</span><span class="MJXp-mn" id="MJXp-Span-1372">1</span></span></span></span></span></span></span></span><script type="math/tex" id="MathJax-Element-226">n - m \cdot k \geq \frac{n}{m + 1}</script>, then <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1373"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1374">n</span><span class="MJXp-mo" id="MJXp-Span-1375" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mo" id="MJXp-Span-1376" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1377">m</span><span class="MJXp-mo" id="MJXp-Span-1378" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-1379">1</span><span class="MJXp-mo" id="MJXp-Span-1380" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1381" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1382">k</span></span></span><script type="math/tex" id="MathJax-Element-227">n \geq (m + 1) \cdot k</script>, which implies <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1383"><span class="MJXp-mfrac" id="MJXp-Span-1384" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1385">n</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1386">m</span><span class="MJXp-mo" id="MJXp-Span-1387">+</span><span class="MJXp-mn" id="MJXp-Span-1388">1</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-1389" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1390">k</span></span></span><script type="math/tex" id="MathJax-Element-228">\frac{n}{m + 1} \geq k</script>. Here, we construct <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1391"><span class="MJXp-msubsup" id="MJXp-Span-1392"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1393" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1394" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1395" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1396">i</span><span class="MJXp-mo" id="MJXp-Span-1397" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mrow" id="MJXp-Span-1398"><span class="MJXp-mo" id="MJXp-Span-1399" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.5em;"><span class="MJXp-right MJXp-scale5" style="font-size: 3em; margin-left: -0.18em;">⌊</span></span><span class="MJXp-mfrac" id="MJXp-Span-1400" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1401">n</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1402">m</span><span class="MJXp-mo" id="MJXp-Span-1403">+</span><span class="MJXp-mn" id="MJXp-Span-1404">1</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-1405" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.5em;"><span class="MJXp-right MJXp-scale5" style="font-size: 3em; margin-left: -0.18em;">⌋</span></span></span></span></span><script type="math/tex" id="MathJax-Element-229">a_i = i \bmod \left\lfloor\frac{n}{m + 1}\right\rfloor</script>. This guarantees that every pair of identical numbers has a distance of at least <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1406"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1407">k</span></span></span><script type="math/tex" id="MathJax-Element-230">k</script>, and that all numbers in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1408"><span class="MJXp-mn" id="MJXp-Span-1409">0</span><span class="MJXp-mo" id="MJXp-Span-1410" style="margin-left: 0.333em; margin-right: 0.333em;">∼</span><span class="MJXp-mrow" id="MJXp-Span-1411"><span class="MJXp-mo" id="MJXp-Span-1412" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.5em;"><span class="MJXp-right MJXp-scale5" style="font-size: 3em; margin-left: -0.18em;">⌊</span></span><span class="MJXp-mfrac" id="MJXp-Span-1413" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1414">n</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1415">m</span><span class="MJXp-mo" id="MJXp-Span-1416">+</span><span class="MJXp-mn" id="MJXp-Span-1417">1</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-1418" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.5em;"><span class="MJXp-right MJXp-scale5" style="font-size: 3em; margin-left: -0.18em;">⌋</span></span></span><span class="MJXp-mo" id="MJXp-Span-1419" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-1420">1</span></span></span><script type="math/tex" id="MathJax-Element-231">0 \sim \left\lfloor\frac{n}{m + 1}\right\rfloor - 1</script> appear at least <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1421"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1422">m</span><span class="MJXp-mo" id="MJXp-Span-1423" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-1424">1</span></span></span><script type="math/tex" id="MathJax-Element-232">m + 1</script> times. Thus, each deletion can remove at most one of these numbers, ensuring that no number is completely removed after <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1425"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1426">m</span></span></span><script type="math/tex" id="MathJax-Element-233">m</script> deletions. </li></ul><p><span class="tex-font-style-bf">Time complexity</span>: <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1427"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1428">O</span><span class="MJXp-mo" id="MJXp-Span-1429" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1430">n</span><span class="MJXp-mo" id="MJXp-Span-1431" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-234">O(n)</script> per test case.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Implementation</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="kwd">int</span><span class="pln"> T</span><span class="pun">;</span><span class="pln">
	cin </span><span class="pun">&gt;&gt;</span><span class="pln"> T</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">T</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> m</span><span class="pun">,</span><span class="pln"> k</span><span class="pun">;</span><span class="pln">
		cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n </span><span class="pun">&gt;&gt;</span><span class="pln"> m </span><span class="pun">&gt;&gt;</span><span class="pln"> k</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			cout </span><span class="pun">&lt;&lt;</span><span class="pln"> i </span><span class="pun">%</span><span class="pln"> </span><span class="pun">(</span><span class="pln">n </span><span class="pun">&lt;</span><span class="pln"> </span><span class="pun">(</span><span class="pln">m </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> k </span><span class="pun">?</span><span class="pln"> k </span><span class="pun">:</span><span class="pln"> n </span><span class="pun">/</span><span class="pln"> </span><span class="pun">(</span><span class="pln">m </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">))</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">" \n"</span><span class="pun">[</span><span class="pln">i </span><span class="pun">==</span><span class="pln"> n </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">];</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	</span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2084/problem/E">2084E - Blossom</a></p><p>Idea: <a class="rated-user user-red" href="https://codeforces.com/profile/zltzlt" title="International Grandmaster zltzlt">zltzlt</a></p> <div class="spoiler"><b class="spoiler-title">Hint 1</b><div class="spoiler-content" style="display: block;"><p>Transform the calculation method of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-13-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;mex&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-64" style="width: 2.384em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.788em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.572em, 1001.79em, 2.33em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-65"><span class="mi" id="MathJax-Span-66" style="font-family: MathJax_Main;">mex</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>mex</mi></math></span></span><script type="math/tex" id="MathJax-Element-13">\operatorname{mex}</script>.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 2</b><div class="spoiler-content" style="display: block;"><p>Try to come up with an <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-14-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;O&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;/msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-67" style="width: 3.466em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.6em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1002.49em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-68"><span class="mi" id="MathJax-Span-69" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-70" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-71"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.6em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-72" style="font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -4.38em; left: 0.598em;"><span class="mn" id="MathJax-Span-73" style="font-size: 70.7%; font-family: MathJax_Main;">3</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-74" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.575em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>O</mi><mo stretchy="false">(</mo><msup><mi>n</mi><mn>3</mn></msup><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-14">O(n^3)</script> approach and then optimize it to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-15-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;O&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-75" style="width: 3.466em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.6em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1002.49em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-76"><span class="mi" id="MathJax-Span-77" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-78" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-79"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.6em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-80" style="font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -4.38em; left: 0.598em;"><span class="mn" id="MathJax-Span-81" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-82" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.575em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>O</mi><mo stretchy="false">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-15">O(n^2)</script>.</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2084/problem/E" title="Teza Round 1 (Codeforces Round 1015, Div. 1 + Div. 2)">2084E - Blossom</a></h3><div class="ttypography"><div class="problem-statement"><div><p>We transform <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1432"><span class="MJXp-mi" id="MJXp-Span-1433">mex</span><span class="MJXp-mo" id="MJXp-Span-1434" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-1435" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mo" id="MJXp-Span-1436" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-msubsup" id="MJXp-Span-1437"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1438" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1439" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1440" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1441"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1442" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1443" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1444">i</span><span class="MJXp-mo" id="MJXp-Span-1445">+</span><span class="MJXp-mn" id="MJXp-Span-1446">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-1447" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-1448" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-1449" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1450"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1451" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1452" style="vertical-align: -0.4em;">j</span></span><span class="MJXp-mo" id="MJXp-Span-1453" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1454" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-235">\operatorname{mex}([a_i, a_{i + 1}, \ldots, a_j])</script> into <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1455"><span class="MJXp-munderover" id="MJXp-Span-1456"><span><span class="MJXp-over"><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-1462" style="margin-right: 0px; margin-left: 0px;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1463">n</span><span class="MJXp-mo" id="MJXp-Span-1464">−</span><span class="MJXp-mn" id="MJXp-Span-1465">1</span></span></span><span class=""><span class="MJXp-mo" id="MJXp-Span-1457" style="margin-left: 0.111em; margin-right: 0.167em;">∑</span></span></span></span><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-1458" style="margin-left: 0px;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1459">k</span><span class="MJXp-mo" id="MJXp-Span-1460">=</span><span class="MJXp-mn" id="MJXp-Span-1461">0</span></span></span></span><span class="MJXp-mo" id="MJXp-Span-1466" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mtext" id="MJXp-Span-1467">numbers from 0 to</span><span class="MJXp-mtext" id="MJXp-Span-1468">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1469">k</span><span class="MJXp-mtext" id="MJXp-Span-1470">&nbsp;</span><span class="MJXp-mtext" id="MJXp-Span-1471">all appear in</span><span class="MJXp-mtext" id="MJXp-Span-1472">&nbsp;</span><span class="MJXp-mo" id="MJXp-Span-1473" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1474">i</span><span class="MJXp-mo" id="MJXp-Span-1475" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1476">j</span><span class="MJXp-mo" id="MJXp-Span-1477" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-1478" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-236">\sum\limits_{k = 0}^{n - 1} [\text{numbers from 0 to}\ k\ \text{all appear in}\ [i, j]]</script>.</p><p>Let there be <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1479"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1480">t</span></span></span><script type="math/tex" id="MathJax-Element-237">t</script> occurrences of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1481"><span class="MJXp-mo" id="MJXp-Span-1482" style="margin-left: 0em; margin-right: 0.111em;">−</span><span class="MJXp-mn" id="MJXp-Span-1483">1</span></span></span><script type="math/tex" id="MathJax-Element-238">-1</script> in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1484"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1485">a</span></span></span><script type="math/tex" id="MathJax-Element-239">a</script>. Since <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1486"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1487">a</span></span></span><script type="math/tex" id="MathJax-Element-240">a</script> needs to be a permutation, for each number from <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1488"><span class="MJXp-mn" id="MJXp-Span-1489">0</span></span></span><script type="math/tex" id="MathJax-Element-241">0</script> to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1490"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1491">k</span></span></span><script type="math/tex" id="MathJax-Element-242">k</script>, if it has appeared in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1492"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1493">a</span></span></span><script type="math/tex" id="MathJax-Element-243">a</script>, it must appear in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1494"><span class="MJXp-mo" id="MJXp-Span-1495" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1496">i</span><span class="MJXp-mo" id="MJXp-Span-1497" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1498">j</span><span class="MJXp-mo" id="MJXp-Span-1499" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-244">[i, j]</script>. For such a group <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1500"><span class="MJXp-mo" id="MJXp-Span-1501" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1502">i</span><span class="MJXp-mo" id="MJXp-Span-1503" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1504">j</span><span class="MJXp-mo" id="MJXp-Span-1505" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1506">k</span><span class="MJXp-mo" id="MJXp-Span-1507" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-245">(i, j, k)</script>, let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1508"><span class="MJXp-mo" id="MJXp-Span-1509" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1510">i</span><span class="MJXp-mo" id="MJXp-Span-1511" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1512">j</span><span class="MJXp-mo" id="MJXp-Span-1513" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-246">[i, j]</script> contain <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1514"><span class="MJXp-msubsup" id="MJXp-Span-1515"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1516" style="margin-right: 0.05em;">c</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1517" style="vertical-align: -0.4em;">1</span></span></span></span><script type="math/tex" id="MathJax-Element-247">c_1</script> <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1518"><span class="MJXp-mo" id="MJXp-Span-1519" style="margin-left: 0em; margin-right: 0.111em;">−</span><span class="MJXp-mn" id="MJXp-Span-1520">1</span></span></span><script type="math/tex" id="MathJax-Element-248">-1</script>s, and the number of elements in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1521"><span class="MJXp-mn" id="MJXp-Span-1522">0</span><span class="MJXp-mo" id="MJXp-Span-1523" style="margin-left: 0.333em; margin-right: 0.333em;">∼</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1524">k</span></span></span><script type="math/tex" id="MathJax-Element-249">0 \sim k</script> that have not appeared in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1525"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1526">a</span></span></span><script type="math/tex" id="MathJax-Element-250">a</script> be <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1527"><span class="MJXp-msubsup" id="MJXp-Span-1528"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1529" style="margin-right: 0.05em;">c</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1530" style="vertical-align: -0.4em;">2</span></span></span></span><script type="math/tex" id="MathJax-Element-251">c_2</script>. The contribution is:</p><p><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-1531"><span class="MJXp-mrow" id="MJXp-Span-1532"><span class="MJXp-TeXmathchoice" id="MJXp-Span-1533"><span class="MJXp-mstyle" id="MJXp-Span-1534"><span class="MJXp-mrow" id="MJXp-Span-1535"><span class="MJXp-mo" id="MJXp-Span-1536" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.319em;"><span class="MJXp-right MJXp-scale6" style="font-size: 2.274em; margin-left: -0.09em;">(</span></span></span></span></span><span class="MJXp-mfrac" id="MJXp-Span-1537"><span class="MJXp-box"><span class="MJXp-msubsup" id="MJXp-Span-1538"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1539" style="margin-right: 0.05em;">c</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1540" style="vertical-align: -0.4em;">1</span></span></span><span class="MJXp-box" style="margin-top: -0.7em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em;"></span></span><span><span class="MJXp-box"><span class="MJXp-msubsup" id="MJXp-Span-1541"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1542" style="margin-right: 0.05em;">c</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1543" style="vertical-align: -0.4em;">2</span></span></span></span></span></span></span><span class="MJXp-TeXmathchoice" id="MJXp-Span-1544"><span class="MJXp-mstyle" id="MJXp-Span-1545"><span class="MJXp-mrow" id="MJXp-Span-1546"><span class="MJXp-mo" id="MJXp-Span-1547" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.319em;"><span class="MJXp-right MJXp-scale6" style="font-size: 2.274em; margin-left: -0.09em;">)</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-1548" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-msubsup" id="MJXp-Span-1549"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1550" style="margin-right: 0.05em;">c</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1551" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1552" style="margin-left: 0.111em; margin-right: 0em;">!</span><span class="MJXp-mo" id="MJXp-Span-1553" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mo" id="MJXp-Span-1554" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1555">t</span><span class="MJXp-mo" id="MJXp-Span-1556" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-1557"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1558" style="margin-right: 0.05em;">c</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1559" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1560" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1561" style="margin-left: 0.111em; margin-right: 0em;">!</span></span></span><script type="math/tex; mode=display" id="MathJax-Element-252">\binom{c_1}{c_2} \cdot c_2! \cdot (t - c_2)!</script></p><p>As for the optimization, consider enumerating <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1562"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1563">k</span></span></span><script type="math/tex" id="MathJax-Element-253">k</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1564"><span class="MJXp-msubsup" id="MJXp-Span-1565"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1566" style="margin-right: 0.05em;">c</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1567" style="vertical-align: -0.4em;">1</span></span></span></span><script type="math/tex" id="MathJax-Element-254">c_1</script>. We need to quickly find how many intervals <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1568"><span class="MJXp-mo" id="MJXp-Span-1569" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1570">i</span><span class="MJXp-mo" id="MJXp-Span-1571" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1572">j</span><span class="MJXp-mo" id="MJXp-Span-1573" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-255">[i, j]</script> satisfy:</p><ul> <li> There are exactly <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1574"><span class="MJXp-msubsup" id="MJXp-Span-1575"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1576" style="margin-right: 0.05em;">c</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1577" style="vertical-align: -0.4em;">1</span></span></span></span><script type="math/tex" id="MathJax-Element-256">c_1</script> <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1578"><span class="MJXp-mo" id="MJXp-Span-1579" style="margin-left: 0em; margin-right: 0.111em;">−</span><span class="MJXp-mn" id="MJXp-Span-1580">1</span></span></span><script type="math/tex" id="MathJax-Element-257">-1</script>s in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1581"><span class="MJXp-mo" id="MJXp-Span-1582" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1583">i</span><span class="MJXp-mo" id="MJXp-Span-1584" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1585">j</span><span class="MJXp-mo" id="MJXp-Span-1586" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-258">[i, j]</script>; </li><li> For every number from <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1587"><span class="MJXp-mn" id="MJXp-Span-1588">0</span></span></span><script type="math/tex" id="MathJax-Element-259">0</script> to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1589"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1590">k</span></span></span><script type="math/tex" id="MathJax-Element-260">k</script>, if it appears in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1591"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1592">a</span></span></span><script type="math/tex" id="MathJax-Element-261">a</script>, its position must lie within <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1593"><span class="MJXp-mo" id="MJXp-Span-1594" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1595">i</span><span class="MJXp-mo" id="MJXp-Span-1596" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1597">j</span><span class="MJXp-mo" id="MJXp-Span-1598" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-262">[i, j]</script>. </li></ul><p>Let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1599"><span class="MJXp-msubsup" id="MJXp-Span-1600"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1601" style="margin-right: 0.05em;">d</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1602" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1603">i</span><span class="MJXp-mo" id="MJXp-Span-1604">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1605">j</span></span></span></span></span><script type="math/tex" id="MathJax-Element-263">d_{i, j}</script> be the number of intervals satisfying these conditions for <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1606"><span class="MJXp-msubsup" id="MJXp-Span-1607"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1608" style="margin-right: 0.05em;">c</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1609" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-1610" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1611">i</span></span></span><script type="math/tex" id="MathJax-Element-264">c_1 = i</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1612"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1613">k</span><span class="MJXp-mo" id="MJXp-Span-1614" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1615">j</span></span></span><script type="math/tex" id="MathJax-Element-265">k = j</script>. We enumerate each interval <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1616"><span class="MJXp-mo" id="MJXp-Span-1617" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1618">i</span><span class="MJXp-mo" id="MJXp-Span-1619" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1620">j</span><span class="MJXp-mo" id="MJXp-Span-1621" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-266">[i, j]</script>, and let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1622"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1623">x</span></span></span><script type="math/tex" id="MathJax-Element-267">x</script> be the number of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1624"><span class="MJXp-mo" id="MJXp-Span-1625" style="margin-left: 0em; margin-right: 0.111em;">−</span><span class="MJXp-mn" id="MJXp-Span-1626">1</span></span></span><script type="math/tex" id="MathJax-Element-268">-1</script>s in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1627"><span class="MJXp-mo" id="MJXp-Span-1628" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1629">i</span><span class="MJXp-mo" id="MJXp-Span-1630" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1631">j</span><span class="MJXp-mo" id="MJXp-Span-1632" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-269">[i, j]</script>, and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1633"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1634">y</span></span></span><script type="math/tex" id="MathJax-Element-270">y</script> be the minimum number of numbers that appeared in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1635"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1636">a</span></span></span><script type="math/tex" id="MathJax-Element-271">a</script> but whose positions do not lie in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1637"><span class="MJXp-mo" id="MJXp-Span-1638" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1639">i</span><span class="MJXp-mo" id="MJXp-Span-1640" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1641">j</span><span class="MJXp-mo" id="MJXp-Span-1642" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-272">[i, j]</script> (if no such number exists, then <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1643"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1644">y</span><span class="MJXp-mo" id="MJXp-Span-1645" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1646">n</span></span></span><script type="math/tex" id="MathJax-Element-273">y = n</script>). The contribution of this interval to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1647"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1648">d</span></span></span><script type="math/tex" id="MathJax-Element-274">d</script> is that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1649"><span class="MJXp-msubsup" id="MJXp-Span-1650"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1651" style="margin-right: 0.05em;">d</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1652" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1653">x</span><span class="MJXp-mo" id="MJXp-Span-1654">,</span><span class="MJXp-mn" id="MJXp-Span-1655">0</span></span></span><span class="MJXp-mo" id="MJXp-Span-1656" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1657"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1658" style="margin-right: 0.05em;">d</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1659" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1660">x</span><span class="MJXp-mo" id="MJXp-Span-1661">,</span><span class="MJXp-mn" id="MJXp-Span-1662">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-1663" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-1664" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-1665" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1666"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1667" style="margin-right: 0.05em;">d</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1668" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1669">x</span><span class="MJXp-mo" id="MJXp-Span-1670">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1671">y</span><span class="MJXp-mo" id="MJXp-Span-1672">−</span><span class="MJXp-mn" id="MJXp-Span-1673">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-275">d_{x, 0}, d_{x, 1}, \ldots, d_{x, y - 1}</script> are all added by <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1674"><span class="MJXp-mn" id="MJXp-Span-1675">1</span></span></span><script type="math/tex" id="MathJax-Element-276">1</script>.</p><p><span class="tex-font-style-bf">Time complexity</span>: <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1676"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1677">O</span><span class="MJXp-mo" id="MJXp-Span-1678" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1679"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1680" style="margin-right: 0.05em;">n</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1681" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1682" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-277">O(n^2)</script> per test case.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Implementation</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> maxn </span><span class="pun">=</span><span class="pln"> </span><span class="lit">5050</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> mod </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1000000007</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">maxn</span><span class="pun">],</span><span class="pln"> fac</span><span class="pun">[</span><span class="pln">maxn</span><span class="pun">],</span><span class="pln"> C</span><span class="pun">[</span><span class="pln">maxn</span><span class="pun">][</span><span class="pln">maxn</span><span class="pun">],</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">maxn</span><span class="pun">],</span><span class="pln"> d</span><span class="pun">[</span><span class="pln">maxn</span><span class="pun">][</span><span class="pln">maxn</span><span class="pun">];</span><span class="pln">
</span><span class="kwd">bool</span><span class="pln"> vis</span><span class="pun">[</span><span class="pln">maxn</span><span class="pun">];</span><span class="pln">

</span><span class="kwd">void</span><span class="pln"> solve</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		vis</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">j</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			d</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	fac</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		cin </span><span class="pun">&gt;&gt;</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
		fac</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1LL</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> fac</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> i </span><span class="pun">%</span><span class="pln"> mod</span><span class="pun">;</span><span class="pln">
		b</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">);</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			vis</span><span class="pun">[</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		C</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> C</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;</span><span class="pln"> i</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">j</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			C</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">C</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">][</span><span class="pln">j </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> C</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">][</span><span class="pln">j</span><span class="pun">])</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> mod</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	</span><span class="kwd">int</span><span class="pln"> mn1 </span><span class="pun">=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">int</span><span class="pln"> mn2 </span><span class="pun">=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&gt;=</span><span class="pln"> i</span><span class="pun">;</span><span class="pln"> </span><span class="pun">--</span><span class="pln">j</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">int</span><span class="pln"> x </span><span class="pun">=</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">],</span><span class="pln"> y </span><span class="pun">=</span><span class="pln"> min</span><span class="pun">(</span><span class="pln">mn1</span><span class="pun">,</span><span class="pln"> mn2</span><span class="pun">);</span><span class="pln">
			</span><span class="pun">++</span><span class="pln">d</span><span class="pun">[</span><span class="pln">x</span><span class="pun">][</span><span class="lit">0</span><span class="pun">];</span><span class="pln">
			</span><span class="pun">--</span><span class="pln">d</span><span class="pun">[</span><span class="pln">x</span><span class="pun">][</span><span class="pln">y</span><span class="pun">];</span><span class="pln">
			</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
				mn2 </span><span class="pun">=</span><span class="pln"> min</span><span class="pun">(</span><span class="pln">mn2</span><span class="pun">,</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]);</span><span class="pln">
			</span><span class="pun">}</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			mn1 </span><span class="pun">=</span><span class="pln"> min</span><span class="pun">(</span><span class="pln">mn1</span><span class="pun">,</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]);</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">n</span><span class="pun">];</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">j</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			d</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+=</span><span class="pln"> d</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">];</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	</span><span class="kwd">int</span><span class="pln"> ans </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> cnt </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		cnt </span><span class="pun">+=</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">vis</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]);</span><span class="pln">
		</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> cnt</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;=</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">n</span><span class="pun">];</span><span class="pln"> </span><span class="pun">++</span><span class="pln">j</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			ans </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">ans </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1LL</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> C</span><span class="pun">[</span><span class="pln">j</span><span class="pun">][</span><span class="pln">cnt</span><span class="pun">]</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> fac</span><span class="pun">[</span><span class="pln">cnt</span><span class="pun">]</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> mod </span><span class="pun">*</span><span class="pln"> fac</span><span class="pun">[</span><span class="pln">b</span><span class="pun">[</span><span class="pln">n</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> cnt</span><span class="pun">]</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> mod </span><span class="pun">*</span><span class="pln"> d</span><span class="pun">[</span><span class="pln">j</span><span class="pun">][</span><span class="pln">i</span><span class="pun">])</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> mod</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	cout </span><span class="pun">&lt;&lt;</span><span class="pln"> ans </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="kwd">int</span><span class="pln"> T</span><span class="pun">;</span><span class="pln">
	cin </span><span class="pun">&gt;&gt;</span><span class="pln"> T</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">T</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		solve</span><span class="pun">();</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	</span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2084/problem/F">2084F - Skyscape</a></p><p>Idea: <a class="rated-user user-red" href="https://codeforces.com/profile/zltzlt" title="International Grandmaster zltzlt">zltzlt</a> <br> Developer: <a class="rated-user user-legendary" href="https://codeforces.com/profile/244mhq" title="Legendary Grandmaster 244mhq"><span class="legendary-user-first-letter">2</span>44mhq</a></p> <div class="spoiler"><b class="spoiler-title">Hint 1</b><div class="spoiler-content" style="display: block;"><p>What kind of permutation <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-16-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-83" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.436em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1000.44em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-84"><span class="mi" id="MathJax-Span-85" style="font-family: MathJax_Math-italic;">b</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>b</mi></math></span></span><script type="math/tex" id="MathJax-Element-16">b</script> is good?</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 2</b><div class="spoiler-content" style="display: block;"><p>Consider transforming this problem into a classic greedy algorithm problem.</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2084/problem/F" title="Teza Round 1 (Codeforces Round 1015, Div. 1 + Div. 2)">2084F - Skyscape</a></h3><div class="ttypography"><div class="problem-statement"><div><p>A permutation <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1683"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1684">b</span></span></span><script type="math/tex" id="MathJax-Element-278">b</script> is considered good if and only if the ordered pairs in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1685"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1686">a</span></span></span><script type="math/tex" id="MathJax-Element-279">a</script> remain ordered pairs in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1687"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1688">b</span></span></span><script type="math/tex" id="MathJax-Element-280">b</script>. In other words, for any pair <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1689"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1690">i</span><span class="MJXp-mo" id="MJXp-Span-1691" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1692">j</span></span></span><script type="math/tex" id="MathJax-Element-281">i < j</script>, if the position of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1693"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1694">i</span></span></span><script type="math/tex" id="MathJax-Element-282">i</script> in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1695"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1696">a</span></span></span><script type="math/tex" id="MathJax-Element-283">a</script> is smaller than that of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1697"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1698">j</span></span></span><script type="math/tex" id="MathJax-Element-284">j</script>, then the position of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1699"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1700">i</span></span></span><script type="math/tex" id="MathJax-Element-285">i</script> in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1701"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1702">b</span></span></span><script type="math/tex" id="MathJax-Element-286">b</script> must also be smaller than that of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1703"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1704">j</span></span></span><script type="math/tex" id="MathJax-Element-287">j</script>.</p><ul> <li> <span class="tex-font-style-bf">Proof of necessity</span>: The operation will not turn any originally ordered pair in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1705"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1706">a</span></span></span><script type="math/tex" id="MathJax-Element-288">a</script> into an inversion. </li><li> <span class="tex-font-style-bf">Proof of sufficiency</span>: For <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1707"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1708">a</span></span></span><script type="math/tex" id="MathJax-Element-289">a</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1709"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1710">b</span></span></span><script type="math/tex" id="MathJax-Element-290">b</script> that satisfy the above condition, it is always possible to make <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1711"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1712">a</span></span></span><script type="math/tex" id="MathJax-Element-291">a</script> identical to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1713"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1714">b</span></span></span><script type="math/tex" id="MathJax-Element-292">b</script> through the following operation: <ul> <li> Iterate over <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1715"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1716">i</span><span class="MJXp-mo" id="MJXp-Span-1717" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-1718">1</span><span class="MJXp-mo" id="MJXp-Span-1719" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-1720">2</span><span class="MJXp-mo" id="MJXp-Span-1721" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-1722" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-1723" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1724">n</span></span></span><script type="math/tex" id="MathJax-Element-293">i = 1, 2, \ldots, n</script>. If <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1725"><span class="MJXp-msubsup" id="MJXp-Span-1726"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1727" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1728" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1729" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-1730"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1731" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1732" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-294">a_i = b_i</script>, skip; otherwise, let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1733"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1734">j</span></span></span><script type="math/tex" id="MathJax-Element-295">j</script> be the position of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1735"><span class="MJXp-msubsup" id="MJXp-Span-1736"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1737" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1738" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-296">b_i</script> in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1739"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1740">a</span></span></span><script type="math/tex" id="MathJax-Element-297">a</script>, and perform an operation with <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1741"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1742">l</span><span class="MJXp-mo" id="MJXp-Span-1743" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1744">i</span><span class="MJXp-mo" id="MJXp-Span-1745" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1746">r</span><span class="MJXp-mo" id="MJXp-Span-1747" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1748">j</span></span></span><script type="math/tex" id="MathJax-Element-298">l = i, r = j</script>. </li></ul> </li></ul><p>For numbers in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1749"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1750">c</span></span></span><script type="math/tex" id="MathJax-Element-299">c</script> that are not <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1751"><span class="MJXp-mn" id="MJXp-Span-1752">0</span></span></span><script type="math/tex" id="MathJax-Element-300">0</script>, if they violate the above condition, then it is clearly impossible to find a solution. Otherwise, for a number <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1753"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1754">x</span></span></span><script type="math/tex" id="MathJax-Element-301">x</script> that does not appear in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1755"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1756">c</span></span></span><script type="math/tex" id="MathJax-Element-302">c</script>, if we only consider the restrictions imposed by the numbers in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1757"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1758">c</span></span></span><script type="math/tex" id="MathJax-Element-303">c</script>, the legal range for its position in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1759"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1760">c</span></span></span><script type="math/tex" id="MathJax-Element-304">c</script> is an interval <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1761"><span class="MJXp-mo" id="MJXp-Span-1762" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-msubsup" id="MJXp-Span-1763"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1764" style="margin-right: 0.05em;">l</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1765" style="vertical-align: -0.4em;">x</span></span><span class="MJXp-mo" id="MJXp-Span-1766" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1767"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1768" style="margin-right: 0.05em;">r</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1769" style="vertical-align: -0.4em;">x</span></span><span class="MJXp-mo" id="MJXp-Span-1770" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-305">[l_x, r_x]</script>. <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1771"><span class="MJXp-msubsup" id="MJXp-Span-1772"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1773" style="margin-right: 0.05em;">l</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1774" style="vertical-align: -0.4em;">x</span></span></span></span><script type="math/tex" id="MathJax-Element-306">l_x</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1775"><span class="MJXp-msubsup" id="MJXp-Span-1776"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1777" style="margin-right: 0.05em;">r</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1778" style="vertical-align: -0.4em;">x</span></span></span></span><script type="math/tex" id="MathJax-Element-307">r_x</script> can be calculated using a Fenwick Tree or Segment Tree.</p><p>It seems that this is a classic greedy problem of "filling numbers into positions, where the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1779"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1780">i</span></span></span><script type="math/tex" id="MathJax-Element-308">i</script>-th number's position must be within the interval <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1781"><span class="MJXp-mo" id="MJXp-Span-1782" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-msubsup" id="MJXp-Span-1783"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1784" style="margin-right: 0.05em;">l</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1785" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1786" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1787"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1788" style="margin-right: 0.05em;">r</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1789" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1790" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-309">[l_i, r_i]</script>." The approach is to determine each position from left to right. For the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1791"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1792">i</span></span></span><script type="math/tex" id="MathJax-Element-310">i</script>-th position, fill the smallest number <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1793"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1794">j</span></span></span><script type="math/tex" id="MathJax-Element-311">j</script> such that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1795"><span class="MJXp-msubsup" id="MJXp-Span-1796"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1797" style="margin-right: 0.05em;">l</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1798" style="vertical-align: -0.4em;">j</span></span><span class="MJXp-mo" id="MJXp-Span-1799" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1800">i</span></span></span><script type="math/tex" id="MathJax-Element-312">l_j \leq i</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1801"><span class="MJXp-msubsup" id="MJXp-Span-1802"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1803" style="margin-right: 0.05em;">r</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1804" style="vertical-align: -0.4em;">j</span></span></span></span><script type="math/tex" id="MathJax-Element-313">r_j</script> is the minimum over all numbers <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1805"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1806">j</span></span></span><script type="math/tex" id="MathJax-Element-314">j</script> that have not been filled yet. This can be implemented with a heap.</p><p>However, we must also consider the mutual constraints between the numbers to be placed in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1807"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1808">c</span></span></span><script type="math/tex" id="MathJax-Element-315">c</script>.</p><p>In fact, we can observe that for any <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1809"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1810">x</span><span class="MJXp-mo" id="MJXp-Span-1811" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1812">y</span></span></span><script type="math/tex" id="MathJax-Element-316">x < y</script>, if <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1813"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1814">x</span></span></span><script type="math/tex" id="MathJax-Element-317">x</script>'s position in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1815"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1816">a</span></span></span><script type="math/tex" id="MathJax-Element-318">a</script> is smaller than <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1817"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1818">y</span></span></span><script type="math/tex" id="MathJax-Element-319">y</script>'s position, then <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1819"><span class="MJXp-msubsup" id="MJXp-Span-1820"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1821" style="margin-right: 0.05em;">l</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1822" style="vertical-align: -0.4em;">x</span></span><span class="MJXp-mo" id="MJXp-Span-1823" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-msubsup" id="MJXp-Span-1824"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1825" style="margin-right: 0.05em;">l</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1826" style="vertical-align: -0.4em;">y</span></span></span></span><script type="math/tex" id="MathJax-Element-320">l_x \leq l_y</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1827"><span class="MJXp-msubsup" id="MJXp-Span-1828"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1829" style="margin-right: 0.05em;">r</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1830" style="vertical-align: -0.4em;">x</span></span><span class="MJXp-mo" id="MJXp-Span-1831" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-msubsup" id="MJXp-Span-1832"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1833" style="margin-right: 0.05em;">r</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1834" style="vertical-align: -0.4em;">y</span></span></span></span><script type="math/tex" id="MathJax-Element-321">r_x \leq r_y</script>. Therefore, if we directly apply the above greedy approach (when multiple <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1835"><span class="MJXp-msubsup" id="MJXp-Span-1836"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1837" style="margin-right: 0.05em;">r</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1838" style="vertical-align: -0.4em;">j</span></span></span></span><script type="math/tex" id="MathJax-Element-322">r_j</script>'s are the smallest, fill the smallest <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1839"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1840">j</span></span></span><script type="math/tex" id="MathJax-Element-323">j</script>), the legality condition will naturally be satisfied.</p><p><span class="tex-font-style-bf">Time complexity</span>: <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1841"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1842">O</span><span class="MJXp-mo" id="MJXp-Span-1843" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1844">n</span><span class="MJXp-mi" id="MJXp-Span-1845">log</span><span class="MJXp-mo" id="MJXp-Span-1846" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1847">n</span><span class="MJXp-mo" id="MJXp-Span-1848" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-324">O(n \log n)</script> per test case.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Implementation</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> maxn </span><span class="pun">=</span><span class="pln"> </span><span class="lit">500100</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">maxn</span><span class="pun">],</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">maxn</span><span class="pun">],</span><span class="pln"> c</span><span class="pun">[</span><span class="pln">maxn</span><span class="pun">],</span><span class="pln"> p</span><span class="pun">[</span><span class="pln">maxn</span><span class="pun">],</span><span class="pln"> q</span><span class="pun">[</span><span class="pln">maxn</span><span class="pun">];</span><span class="pln">

</span><span class="kwd">struct</span><span class="pln"> node </span><span class="pun">{</span><span class="pln">
	</span><span class="kwd">int</span><span class="pln"> r</span><span class="pun">,</span><span class="pln"> x</span><span class="pun">;</span><span class="pln">
	node</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> a </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> b </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> r</span><span class="pun">(</span><span class="pln">a</span><span class="pun">),</span><span class="pln"> x</span><span class="pun">(</span><span class="pln">b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">
</span><span class="pun">};</span><span class="pln">

</span><span class="kwd">inline</span><span class="pln"> </span><span class="kwd">bool</span><span class="pln"> </span><span class="kwd">operator</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">const</span><span class="pln"> node </span><span class="pun">&amp;</span><span class="pln">a</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">const</span><span class="pln"> node </span><span class="pun">&amp;</span><span class="pln">b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="kwd">return</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">r </span><span class="pun">&gt;</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">r </span><span class="pun">||</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">.</span><span class="pln">r </span><span class="pun">==</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">r </span><span class="pun">&amp;&amp;</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">x </span><span class="pun">&gt;</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">x</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

vector</span><span class="str">&lt;node&gt;</span><span class="pln"> vc</span><span class="pun">[</span><span class="pln">maxn</span><span class="pun">];</span><span class="pln">

</span><span class="kwd">struct</span><span class="pln"> DS1 </span><span class="pun">{</span><span class="pln">
	</span><span class="kwd">int</span><span class="pln"> c</span><span class="pun">[</span><span class="pln">maxn</span><span class="pun">];</span><span class="pln">
	
	</span><span class="kwd">inline</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> init</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			c</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	
	</span><span class="kwd">inline</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> update</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> d</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> x</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">+=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="pun">&amp;</span><span class="pln"> </span><span class="pun">(-</span><span class="pln">i</span><span class="pun">)))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			c</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> max</span><span class="pun">(</span><span class="pln">c</span><span class="pun">[</span><span class="pln">i</span><span class="pun">],</span><span class="pln"> d</span><span class="pun">);</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	
	</span><span class="kwd">inline</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> query</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">int</span><span class="pln"> res </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> x</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">-=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="pun">&amp;</span><span class="pln"> </span><span class="pun">(-</span><span class="pln">i</span><span class="pun">)))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			res </span><span class="pun">=</span><span class="pln"> max</span><span class="pun">(</span><span class="pln">res</span><span class="pun">,</span><span class="pln"> c</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]);</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> res</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> T1</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">struct</span><span class="pln"> DS2 </span><span class="pun">{</span><span class="pln">
	</span><span class="kwd">int</span><span class="pln"> c</span><span class="pun">[</span><span class="pln">maxn</span><span class="pun">];</span><span class="pln">
	
	</span><span class="kwd">inline</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> init</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			c</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	
	</span><span class="kwd">inline</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> update</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> d</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> x</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">-=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="pun">&amp;</span><span class="pln"> </span><span class="pun">(-</span><span class="pln">i</span><span class="pun">)))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			c</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> min</span><span class="pun">(</span><span class="pln">c</span><span class="pun">[</span><span class="pln">i</span><span class="pun">],</span><span class="pln"> d</span><span class="pun">);</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	
	</span><span class="kwd">inline</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> query</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">int</span><span class="pln"> res </span><span class="pun">=</span><span class="pln"> n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> x</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">+=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="pun">&amp;</span><span class="pln"> </span><span class="pun">(-</span><span class="pln">i</span><span class="pun">)))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			res </span><span class="pun">=</span><span class="pln"> min</span><span class="pun">(</span><span class="pln">res</span><span class="pun">,</span><span class="pln"> c</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]);</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> res</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> T2</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">void</span><span class="pln"> solve</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		cin </span><span class="pun">&gt;&gt;</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
		p</span><span class="pun">[</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> i</span><span class="pun">;</span><span class="pln">
		q</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
		vector</span><span class="str">&lt;node&gt;</span><span class="pun">().</span><span class="pln">swap</span><span class="pun">(</span><span class="pln">vc</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		cin </span><span class="pun">&gt;&gt;</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">b</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			q</span><span class="pun">[</span><span class="pln">b</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> i</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	T1</span><span class="pun">.</span><span class="pln">init</span><span class="pun">();</span><span class="pln">
	</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">q</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">T1</span><span class="pun">.</span><span class="pln">query</span><span class="pun">(</span><span class="pln">p</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> q</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
				cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"-1\n"</span><span class="pun">;</span><span class="pln">
				</span><span class="kwd">return</span><span class="pun">;</span><span class="pln">
			</span><span class="pun">}</span><span class="pln">
			T1</span><span class="pun">.</span><span class="pln">update</span><span class="pun">(</span><span class="pln">p</span><span class="pun">[</span><span class="pln">i</span><span class="pun">],</span><span class="pln"> q</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]);</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	T1</span><span class="pun">.</span><span class="pln">init</span><span class="pun">();</span><span class="pln">
	T2</span><span class="pun">.</span><span class="pln">init</span><span class="pun">();</span><span class="pln">
	</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">q</span><span class="pun">[</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]])</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			T1</span><span class="pun">.</span><span class="pln">update</span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">],</span><span class="pln"> q</span><span class="pun">[</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]]);</span><span class="pln">
		</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			c</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> T1</span><span class="pun">.</span><span class="pln">query</span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">;</span><span class="pln"> </span><span class="pun">--</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">q</span><span class="pun">[</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]])</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			T2</span><span class="pun">.</span><span class="pln">update</span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">],</span><span class="pln"> q</span><span class="pun">[</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]]);</span><span class="pln">
		</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">int</span><span class="pln"> r </span><span class="pun">=</span><span class="pln"> T2</span><span class="pun">.</span><span class="pln">query</span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
			</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">c</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> r</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
				cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"-1\n"</span><span class="pun">;</span><span class="pln">
				</span><span class="kwd">return</span><span class="pun">;</span><span class="pln">
			</span><span class="pun">}</span><span class="pln">
			vc</span><span class="pun">[</span><span class="pln">c</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]].</span><span class="pln">emplace_back</span><span class="pun">(</span><span class="pln">r</span><span class="pun">,</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]);</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	priority_queue</span><span class="str">&lt;node&gt;</span><span class="pln"> pq</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">node u </span><span class="pun">:</span><span class="pln"> vc</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			pq</span><span class="pun">.</span><span class="pln">push</span><span class="pun">(</span><span class="pln">u</span><span class="pun">);</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">b</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">pq</span><span class="pun">.</span><span class="pln">empty</span><span class="pun">()</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> pq</span><span class="pun">.</span><span class="pln">top</span><span class="pun">().</span><span class="pln">r </span><span class="pun">&lt;</span><span class="pln"> i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
				cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"-1\n"</span><span class="pun">;</span><span class="pln">
				</span><span class="kwd">return</span><span class="pun">;</span><span class="pln">
			</span><span class="pun">}</span><span class="pln">
			b</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> pq</span><span class="pun">.</span><span class="pln">top</span><span class="pun">().</span><span class="pln">x</span><span class="pun">;</span><span class="pln">
			pq</span><span class="pun">.</span><span class="pln">pop</span><span class="pun">();</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		cout </span><span class="pun">&lt;&lt;</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">" \n"</span><span class="pun">[</span><span class="pln">i </span><span class="pun">==</span><span class="pln"> n</span><span class="pun">];</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	ios</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
	cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
	</span><span class="kwd">int</span><span class="pln"> T</span><span class="pun">;</span><span class="pln">
	cin </span><span class="pun">&gt;&gt;</span><span class="pln"> T</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">T</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		solve</span><span class="pun">();</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	</span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2084/problem/G1">2084G1 - Wish Upon a Satellite (Easy Version)</a></p><p>Idea: <a class="rated-user user-red" href="https://codeforces.com/profile/zltzlt" title="International Grandmaster zltzlt">zltzlt</a></p> <div class="spoiler"><b class="spoiler-title">Hint 1</b><div class="spoiler-content" style="display: block;"><p>What is the value of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-17-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-86" style="width: 2.33em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.734em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1001.63em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-87"><span class="mi" id="MathJax-Span-88" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span><span class="mo" id="MathJax-Span-89" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-90" style="font-family: MathJax_Math-italic;">c</span><span class="mo" id="MathJax-Span-91" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi><mo stretchy="false">(</mo><mi>c</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-17">f(c)</script>?</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 2</b><div class="spoiler-content" style="display: block;"><p>Try DP.</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2084/problem/G1" title="Teza Round 1 (Codeforces Round 1015, Div. 1 + Div. 2)">2084G1 - Wish Upon a Satellite (Easy Version)</a></h3><div class="ttypography"><div class="problem-statement"><div><p>First, we have</p><p><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-1849"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1850">f</span><span class="MJXp-mo" id="MJXp-Span-1851" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1852">c</span><span class="MJXp-mo" id="MJXp-Span-1853" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1854" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mrow" id="MJXp-Span-1855"><span class="MJXp-mo" id="MJXp-Span-1856" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.661em;"><span class="MJXp-right MJXp-scale4" style="font-size: 3.644em; margin-left: -0.278em;">{</span></span><span class="MJXp-mtable" id="MJXp-Span-1857"><span><span class="MJXp-mtr" id="MJXp-Span-1858" style="vertical-align: baseline;"><span class="MJXp-mtd" id="MJXp-Span-1859" style="text-align: left;"><span class="MJXp-mo" id="MJXp-Span-1860" style="margin-left: 0.333em; margin-right: 0.333em;">min</span><span class="MJXp-mo" id="MJXp-Span-1861" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1862"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1863" style="margin-right: 0.05em;">c</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1864" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-1865" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1866"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1867" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1868" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-mo" id="MJXp-Span-1869" style="margin-left: 0em; margin-right: 0em;">)</span></span><span class="MJXp-mtd" id="MJXp-Span-1870" style="padding-left: 1em; text-align: left;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1871">k</span><span class="MJXp-mo" id="MJXp-Span-1872" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mn" id="MJXp-Span-1873">2</span><span class="MJXp-mo" id="MJXp-Span-1874" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-1875">0</span></span></span><span class="MJXp-mtr" id="MJXp-Span-1876" style="vertical-align: baseline;"><span class="MJXp-mtd" id="MJXp-Span-1877" style="padding-top: 0.2em; text-align: left;"><span class="MJXp-mo" id="MJXp-Span-1878" style="margin-left: 0.333em; margin-right: 0.333em;">max</span><span class="MJXp-mo" id="MJXp-Span-1879" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1880"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1881" style="margin-right: 0.05em;">c</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1882" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-1883" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1884"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1885" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1886" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-mo" id="MJXp-Span-1887" style="margin-left: 0em; margin-right: 0em;">)</span></span><span class="MJXp-mtd" id="MJXp-Span-1888" style="padding-left: 1em; padding-top: 0.2em; text-align: left;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1889">k</span><span class="MJXp-mo" id="MJXp-Span-1890" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mn" id="MJXp-Span-1891">2</span><span class="MJXp-mo" id="MJXp-Span-1892" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-1893">1</span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-1894" style="margin-left: 0em; margin-right: 0em;"></span></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-325"> f(c) = \begin{cases} \min(c_1, c_k) & k \bmod 2 = 0 \\ \max(c_1, c_k) & k \bmod 2 = 1 \end{cases} </script></p><p>Symmetrically, let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1895"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1896">g</span><span class="MJXp-mo" id="MJXp-Span-1897" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1898">c</span><span class="MJXp-mo" id="MJXp-Span-1899" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-326">g(c)</script> be the result when the order of the first and second players is swapped. Then,</p><p><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-1900"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1901">g</span><span class="MJXp-mo" id="MJXp-Span-1902" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1903">c</span><span class="MJXp-mo" id="MJXp-Span-1904" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1905" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mrow" id="MJXp-Span-1906"><span class="MJXp-mo" id="MJXp-Span-1907" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.661em;"><span class="MJXp-right MJXp-scale4" style="font-size: 3.644em; margin-left: -0.278em;">{</span></span><span class="MJXp-mtable" id="MJXp-Span-1908"><span><span class="MJXp-mtr" id="MJXp-Span-1909" style="vertical-align: baseline;"><span class="MJXp-mtd" id="MJXp-Span-1910" style="text-align: left;"><span class="MJXp-mo" id="MJXp-Span-1911" style="margin-left: 0.333em; margin-right: 0.333em;">max</span><span class="MJXp-mo" id="MJXp-Span-1912" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1913"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1914" style="margin-right: 0.05em;">c</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1915" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-1916" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1917"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1918" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1919" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-mo" id="MJXp-Span-1920" style="margin-left: 0em; margin-right: 0em;">)</span></span><span class="MJXp-mtd" id="MJXp-Span-1921" style="padding-left: 1em; text-align: left;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1922">k</span><span class="MJXp-mo" id="MJXp-Span-1923" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mn" id="MJXp-Span-1924">2</span><span class="MJXp-mo" id="MJXp-Span-1925" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-1926">0</span></span></span><span class="MJXp-mtr" id="MJXp-Span-1927" style="vertical-align: baseline;"><span class="MJXp-mtd" id="MJXp-Span-1928" style="padding-top: 0.2em; text-align: left;"><span class="MJXp-mo" id="MJXp-Span-1929" style="margin-left: 0.333em; margin-right: 0.333em;">min</span><span class="MJXp-mo" id="MJXp-Span-1930" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1931"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1932" style="margin-right: 0.05em;">c</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1933" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-1934" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1935"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1936" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1937" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-mo" id="MJXp-Span-1938" style="margin-left: 0em; margin-right: 0em;">)</span></span><span class="MJXp-mtd" id="MJXp-Span-1939" style="padding-left: 1em; padding-top: 0.2em; text-align: left;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1940">k</span><span class="MJXp-mo" id="MJXp-Span-1941" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mn" id="MJXp-Span-1942">2</span><span class="MJXp-mo" id="MJXp-Span-1943" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-1944">1</span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-1945" style="margin-left: 0em; margin-right: 0em;"></span></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-327"> g(c) = \begin{cases} \max(c_1, c_k) & k \bmod 2 = 0 \\ \min(c_1, c_k) & k \bmod 2 = 1 \end{cases} </script></p><p><span class="tex-font-style-bf">Proof</span>: Consider an inductive approach. The base case <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1946"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1947">k</span><span class="MJXp-mo" id="MJXp-Span-1948" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mn" id="MJXp-Span-1949">2</span></span></span><script type="math/tex" id="MathJax-Element-328">k \leq 2</script> is evident. For <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1950"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1951">k</span><span class="MJXp-mo" id="MJXp-Span-1952" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mn" id="MJXp-Span-1953">3</span></span></span><script type="math/tex" id="MathJax-Element-329">k \geq 3</script>, consider computing <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1954"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1955">f</span><span class="MJXp-mo" id="MJXp-Span-1956" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1957">c</span><span class="MJXp-mo" id="MJXp-Span-1958" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-330">f(c)</script>. Assume <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1959"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1960">k</span></span></span><script type="math/tex" id="MathJax-Element-331">k</script> is odd. If the first player chooses <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1961"><span class="MJXp-mn" id="MJXp-Span-1962">2</span><span class="MJXp-mo" id="MJXp-Span-1963" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1964">i</span><span class="MJXp-mo" id="MJXp-Span-1965" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1966">k</span><span class="MJXp-mo" id="MJXp-Span-1967" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-1968">2</span></span></span><script type="math/tex" id="MathJax-Element-332">2 \leq i \leq k - 2</script>, the game reduces to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1969"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1970">g</span><span class="MJXp-mo" id="MJXp-Span-1971" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msup" id="MJXp-Span-1972"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1973" style="margin-right: 0.05em;">c</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1974" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-1975" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-333">g(c')</script>, and the answer is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1976"><span class="MJXp-mo" id="MJXp-Span-1977" style="margin-left: 0.333em; margin-right: 0.333em;">max</span><span class="MJXp-mo" id="MJXp-Span-1978" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1979"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1980" style="margin-right: 0.05em;">c</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1981" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-1982" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1983"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1984" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1985" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-mo" id="MJXp-Span-1986" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-334">\max(c_1, c_k)</script>. If the first player chooses <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1987"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1988">i</span><span class="MJXp-mo" id="MJXp-Span-1989" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-1990">1</span></span></span><script type="math/tex" id="MathJax-Element-335">i = 1</script> or <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1991"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1992">i</span><span class="MJXp-mo" id="MJXp-Span-1993" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1994">k</span><span class="MJXp-mo" id="MJXp-Span-1995" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-1996">1</span></span></span><script type="math/tex" id="MathJax-Element-336">i = k - 1</script>, the answer is at most <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1997"><span class="MJXp-mo" id="MJXp-Span-1998" style="margin-left: 0.333em; margin-right: 0.333em;">max</span><span class="MJXp-mo" id="MJXp-Span-1999" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-2000"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2001" style="margin-right: 0.05em;">c</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2002" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-2003" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-2004"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2005" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2006" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-mo" id="MJXp-Span-2007" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-337">\max(c_1, c_k)</script>. Other cases follow similarly.</p><p>Thus, for a permutation <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2008"><span class="MJXp-msubsup" id="MJXp-Span-2009"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2010" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2011" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-2012" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-2013"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2014" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2015" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-2016" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-2017" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-2018" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-2019"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2020" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2021" style="vertical-align: -0.4em;">n</span></span></span></span><script type="math/tex" id="MathJax-Element-338">p_1, p_2, \dots, p_n</script>, we have</p><p><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-2022"><span class="MJXp-mtable" id="MJXp-Span-2023"><span><span class="MJXp-mtr" id="MJXp-Span-2024" style="vertical-align: baseline;"><span class="MJXp-mtd" id="MJXp-Span-2025" style="text-align: right;"></span><span class="MJXp-mtd" id="MJXp-Span-2026" style="padding-left: 0em; text-align: left;"><span class="MJXp-mi" id="MJXp-Span-2027"></span><span class="MJXp-munderover" id="MJXp-Span-2028"><span><span class="MJXp-over"><span class=" MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2034" style="margin-right: 0px; margin-left: 0px;">n</span></span><span class=""><span class="MJXp-mo" id="MJXp-Span-2029" style="margin-left: 0.111em; margin-right: 0.167em;"><span class="MJXp-largeop">∑</span></span></span></span></span><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-2030" style="margin-left: 0px;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2031">i</span><span class="MJXp-mo" id="MJXp-Span-2032">=</span><span class="MJXp-mn" id="MJXp-Span-2033">1</span></span></span></span><span class="MJXp-munderover" id="MJXp-Span-2035"><span><span class="MJXp-over"><span class=" MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2041" style="margin-right: 0px; margin-left: 0px;">n</span></span><span class=""><span class="MJXp-mo" id="MJXp-Span-2036" style="margin-left: 0.111em; margin-right: 0.167em;"><span class="MJXp-largeop">∑</span></span></span></span></span><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-2037" style="margin-left: 0px;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2038">j</span><span class="MJXp-mo" id="MJXp-Span-2039">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2040">i</span></span></span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2042">f</span><span class="MJXp-mo" id="MJXp-Span-2043" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mo" id="MJXp-Span-2044" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-msubsup" id="MJXp-Span-2045"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2046" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2047" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-2048" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-2049"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2050" style="margin-right: 0.05em;">p</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2051" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2052">i</span><span class="MJXp-mo" id="MJXp-Span-2053">+</span><span class="MJXp-mn" id="MJXp-Span-2054">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-2055" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-2056" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-2057" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-2058"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2059" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2060" style="vertical-align: -0.4em;">j</span></span><span class="MJXp-mo" id="MJXp-Span-2061" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-2062" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MJXp-mtr" id="MJXp-Span-2063" style="vertical-align: baseline;"><span class="MJXp-mtd" id="MJXp-Span-2064" style="padding-top: 0.3em; text-align: right;"><span class="MJXp-mo" id="MJXp-Span-2065" style="margin-left: 0.333em; margin-right: 0.333em;">=</span></span><span class="MJXp-mtd" id="MJXp-Span-2066" style="padding-left: 0em; padding-top: 0.3em; text-align: left;"><span class="MJXp-mi" id="MJXp-Span-2067"></span><span class="MJXp-munderover" id="MJXp-Span-2068"><span><span class="MJXp-over"><span class=" MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2074" style="margin-right: 0px; margin-left: 0px;">n</span></span><span class=""><span class="MJXp-mo" id="MJXp-Span-2069" style="margin-left: 0.111em; margin-right: 0.167em;"><span class="MJXp-largeop">∑</span></span></span></span></span><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-2070" style="margin-left: 0px;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2071">i</span><span class="MJXp-mo" id="MJXp-Span-2072">=</span><span class="MJXp-mn" id="MJXp-Span-2073">1</span></span></span></span><span class="MJXp-munderover" id="MJXp-Span-2075"><span><span class="MJXp-over"><span class=" MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2081" style="margin-right: 0px; margin-left: 0px;">n</span></span><span class=""><span class="MJXp-mo" id="MJXp-Span-2076" style="margin-left: 0.111em; margin-right: 0.167em;"><span class="MJXp-largeop">∑</span></span></span></span></span><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-2077" style="margin-left: 0px;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2078">j</span><span class="MJXp-mo" id="MJXp-Span-2079">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2080">i</span></span></span></span><span class="MJXp-mstyle" id="MJXp-Span-2082"><span class="MJXp-mrow" id="MJXp-Span-2083"><span class="MJXp-mo" id="MJXp-Span-2084" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.201em;"><span class="MJXp-right MJXp-scale7" style="font-size: 1.803em; margin-left: -0.05em;">(</span></span></span></span><span class="MJXp-mo" id="MJXp-Span-2085" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2086">i</span><span class="MJXp-mo" id="MJXp-Span-2087" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mn" id="MJXp-Span-2088">2</span><span class="MJXp-mo" id="MJXp-Span-2089" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2090">j</span><span class="MJXp-mo" id="MJXp-Span-2091" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mn" id="MJXp-Span-2092">2</span><span class="MJXp-mo" id="MJXp-Span-2093" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-2094" style="margin-left: 0.333em; margin-right: 0.333em;">max</span><span class="MJXp-mo" id="MJXp-Span-2095" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-2096"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2097" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2098" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-2099" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-2100"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2101" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2102" style="vertical-align: -0.4em;">j</span></span><span class="MJXp-mo" id="MJXp-Span-2103" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-2104" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mo" id="MJXp-Span-2105" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2106">i</span><span class="MJXp-mo" id="MJXp-Span-2107" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mn" id="MJXp-Span-2108">2</span><span class="MJXp-mo" id="MJXp-Span-2109" style="margin-left: 0.333em; margin-right: 0.333em;">≠</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2110">j</span><span class="MJXp-mo" id="MJXp-Span-2111" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mn" id="MJXp-Span-2112">2</span><span class="MJXp-mo" id="MJXp-Span-2113" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-2114" style="margin-left: 0.333em; margin-right: 0.333em;">min</span><span class="MJXp-mo" id="MJXp-Span-2115" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-2116"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2117" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2118" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-2119" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-2120"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2121" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2122" style="vertical-align: -0.4em;">j</span></span><span class="MJXp-mo" id="MJXp-Span-2123" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mstyle" id="MJXp-Span-2124"><span class="MJXp-mrow" id="MJXp-Span-2125"><span class="MJXp-mo" id="MJXp-Span-2126" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.201em;"><span class="MJXp-right MJXp-scale7" style="font-size: 1.803em; margin-left: -0.05em;">)</span></span></span></span></span></span><span class="MJXp-mtr" id="MJXp-Span-2127" style="vertical-align: baseline;"><span class="MJXp-mtd" id="MJXp-Span-2128" style="padding-top: 0.3em; text-align: right;"><span class="MJXp-mo" id="MJXp-Span-2129" style="margin-left: 0.333em; margin-right: 0.333em;">=</span></span><span class="MJXp-mtd" id="MJXp-Span-2130" style="padding-left: 0em; padding-top: 0.3em; text-align: left;"><span class="MJXp-mi" id="MJXp-Span-2131"></span><span class="MJXp-munderover" id="MJXp-Span-2132"><span><span class="MJXp-over"><span class=" MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2138" style="margin-right: 0px; margin-left: 0px;">n</span></span><span class=""><span class="MJXp-mo" id="MJXp-Span-2133" style="margin-left: 0.111em; margin-right: 0.167em;"><span class="MJXp-largeop">∑</span></span></span></span></span><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-2134" style="margin-left: 0px;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2135">i</span><span class="MJXp-mo" id="MJXp-Span-2136">=</span><span class="MJXp-mn" id="MJXp-Span-2137">1</span></span></span></span><span class="MJXp-munderover" id="MJXp-Span-2139"><span><span class="MJXp-over"><span class=" MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2145" style="margin-right: 0px; margin-left: 0px;">n</span></span><span class=""><span class="MJXp-mo" id="MJXp-Span-2140" style="margin-left: 0.111em; margin-right: 0.167em;"><span class="MJXp-largeop">∑</span></span></span></span></span><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-2141" style="margin-left: 0px;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2142">j</span><span class="MJXp-mo" id="MJXp-Span-2143">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2144">i</span></span></span></span><span class="MJXp-mo" id="MJXp-Span-2146" style="margin-left: 0.333em; margin-right: 0.333em;">max</span><span class="MJXp-mo" id="MJXp-Span-2147" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-2148"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2149" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2150" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-2151" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-2152"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2153" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2154" style="vertical-align: -0.4em;">j</span></span><span class="MJXp-mo" id="MJXp-Span-2155" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-2156" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-munderover" id="MJXp-Span-2157"><span><span class="MJXp-over"><span class=" MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2163" style="margin-right: 0px; margin-left: 0px;">n</span></span><span class=""><span class="MJXp-mo" id="MJXp-Span-2158" style="margin-left: 0.111em; margin-right: 0.167em;"><span class="MJXp-largeop">∑</span></span></span></span></span><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-2159" style="margin-left: 0px;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2160">i</span><span class="MJXp-mo" id="MJXp-Span-2161">=</span><span class="MJXp-mn" id="MJXp-Span-2162">1</span></span></span></span><span class="MJXp-munderover" id="MJXp-Span-2164"><span><span class="MJXp-over"><span class=" MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2172" style="margin-right: 0px; margin-left: 0px;">n</span></span><span class=""><span class="MJXp-mo" id="MJXp-Span-2165" style="margin-left: 0.111em; margin-right: 0.167em;"><span class="MJXp-largeop">∑</span></span></span></span></span><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-2166" style="margin-left: 0px;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2167">j</span><span class="MJXp-mo" id="MJXp-Span-2168">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2169">i</span><span class="MJXp-mo" id="MJXp-Span-2170">+</span><span class="MJXp-mn" id="MJXp-Span-2171">1</span></span></span></span><span class="MJXp-mo" id="MJXp-Span-2173" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2174">i</span><span class="MJXp-mo" id="MJXp-Span-2175" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mn" id="MJXp-Span-2176">2</span><span class="MJXp-mo" id="MJXp-Span-2177" style="margin-left: 0.333em; margin-right: 0.333em;">≠</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2178">j</span><span class="MJXp-mo" id="MJXp-Span-2179" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mn" id="MJXp-Span-2180">2</span><span class="MJXp-mo" id="MJXp-Span-2181" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-2182" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mo" id="MJXp-Span-2183" style="margin-left: 0.333em; margin-right: 0.333em;">max</span><span class="MJXp-mo" id="MJXp-Span-2184" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-2185"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2186" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2187" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-2188" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-2189"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2190" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2191" style="vertical-align: -0.4em;">j</span></span><span class="MJXp-mo" id="MJXp-Span-2192" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-2193" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mo" id="MJXp-Span-2194" style="margin-left: 0.333em; margin-right: 0.333em;">min</span><span class="MJXp-mo" id="MJXp-Span-2195" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-2196"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2197" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2198" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-2199" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-2200"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2201" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2202" style="vertical-align: -0.4em;">j</span></span><span class="MJXp-mo" id="MJXp-Span-2203" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-2204" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MJXp-mtr" id="MJXp-Span-2205" style="vertical-align: baseline;"><span class="MJXp-mtd" id="MJXp-Span-2206" style="padding-top: 0.3em; text-align: right;"><span class="MJXp-mo" id="MJXp-Span-2207" style="margin-left: 0.333em; margin-right: 0.333em;">=</span></span><span class="MJXp-mtd" id="MJXp-Span-2208" style="padding-left: 0em; padding-top: 0.3em; text-align: left;"><span class="MJXp-mi" id="MJXp-Span-2209"></span><span class="MJXp-munderover" id="MJXp-Span-2210"><span><span class="MJXp-over"><span class=" MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2216" style="margin-right: 0px; margin-left: 0px;">n</span></span><span class=""><span class="MJXp-mo" id="MJXp-Span-2211" style="margin-left: 0.111em; margin-right: 0.167em;"><span class="MJXp-largeop">∑</span></span></span></span></span><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-2212" style="margin-left: 0px;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2213">i</span><span class="MJXp-mo" id="MJXp-Span-2214">=</span><span class="MJXp-mn" id="MJXp-Span-2215">1</span></span></span></span><span class="MJXp-msubsup" id="MJXp-Span-2217"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2218" style="margin-right: 0.05em;">i</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2219" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-2220" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-munderover" id="MJXp-Span-2221"><span><span class="MJXp-over"><span class=" MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2227" style="margin-right: 0px; margin-left: 0px;">n</span></span><span class=""><span class="MJXp-mo" id="MJXp-Span-2222" style="margin-left: 0.111em; margin-right: 0.167em;"><span class="MJXp-largeop">∑</span></span></span></span></span><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-2223" style="margin-left: 0px;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2224">i</span><span class="MJXp-mo" id="MJXp-Span-2225">=</span><span class="MJXp-mn" id="MJXp-Span-2226">1</span></span></span></span><span class="MJXp-munderover" id="MJXp-Span-2228"><span><span class="MJXp-over"><span class=" MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2236" style="margin-right: 0px; margin-left: 0px;">n</span></span><span class=""><span class="MJXp-mo" id="MJXp-Span-2229" style="margin-left: 0.111em; margin-right: 0.167em;"><span class="MJXp-largeop">∑</span></span></span></span></span><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-2230" style="margin-left: 0px;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2231">j</span><span class="MJXp-mo" id="MJXp-Span-2232">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2233">i</span><span class="MJXp-mo" id="MJXp-Span-2234">+</span><span class="MJXp-mn" id="MJXp-Span-2235">1</span></span></span></span><span class="MJXp-mo" id="MJXp-Span-2237" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2238">i</span><span class="MJXp-mo" id="MJXp-Span-2239" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mn" id="MJXp-Span-2240">2</span><span class="MJXp-mo" id="MJXp-Span-2241" style="margin-left: 0.333em; margin-right: 0.333em;">≠</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2242">j</span><span class="MJXp-mo" id="MJXp-Span-2243" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mn" id="MJXp-Span-2244">2</span><span class="MJXp-mo" id="MJXp-Span-2245" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mrow" id="MJXp-Span-2246"><span class="MJXp-mo" id="MJXp-Span-2247" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-msubsup" id="MJXp-Span-2248"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2249" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2250" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-2251" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-2252"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2253" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2254" style="vertical-align: -0.4em;">j</span></span><span class="MJXp-mrow" id="MJXp-Span-2255"><span class="MJXp-mo" id="MJXp-Span-2256" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span></span></span></span></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-339"> \begin{aligned} & \sum\limits_{i = 1}^n \sum\limits_{j = i}^n f([p_i, p_{i + 1}, \dots, p_j]) \\ = & \sum\limits_{i = 1}^n \sum\limits_{j = i}^n \Big( [i \bmod 2 = j \bmod 2] \max(p_i, p_j) + [i \bmod 2 \neq j \bmod 2] \min(p_i, p_j) \Big) \\ = & \sum\limits_{i = 1}^n \sum\limits_{j = i}^n \max(p_i, p_j) - \sum\limits_{i = 1}^n \sum\limits_{j = i + 1}^n [i \bmod 2 \neq j \bmod 2] (\max(p_i, p_j) - \min(p_i, p_j)) \\ = & \sum\limits_{i = 1}^n i^2 - \sum\limits_{i = 1}^n \sum\limits_{j = i + 1}^n [i \bmod 2 \neq j \bmod 2] |p_i - p_j| \end{aligned} </script></p><p>Thus, the problem reduces to minimizing the following expression:</p><p><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-2257"><span class="MJXp-munderover" id="MJXp-Span-2258"><span><span class="MJXp-over"><span class=" MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2264" style="margin-right: 0px; margin-left: 0px;">n</span></span><span class=""><span class="MJXp-mo" id="MJXp-Span-2259" style="margin-left: 0.111em; margin-right: 0.167em;"><span class="MJXp-largeop">∑</span></span></span></span></span><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-2260" style="margin-left: 0px;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2261">i</span><span class="MJXp-mo" id="MJXp-Span-2262">=</span><span class="MJXp-mn" id="MJXp-Span-2263">1</span></span></span></span><span class="MJXp-munderover" id="MJXp-Span-2265"><span><span class="MJXp-over"><span class=" MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2273" style="margin-right: 0px; margin-left: 0px;">n</span></span><span class=""><span class="MJXp-mo" id="MJXp-Span-2266" style="margin-left: 0.111em; margin-right: 0.167em;"><span class="MJXp-largeop">∑</span></span></span></span></span><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-2267" style="margin-left: 0px;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2268">j</span><span class="MJXp-mo" id="MJXp-Span-2269">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2270">i</span><span class="MJXp-mo" id="MJXp-Span-2271">+</span><span class="MJXp-mn" id="MJXp-Span-2272">1</span></span></span></span><span class="MJXp-mo" id="MJXp-Span-2274" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2275">i</span><span class="MJXp-mo" id="MJXp-Span-2276" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mn" id="MJXp-Span-2277">2</span><span class="MJXp-mo" id="MJXp-Span-2278" style="margin-left: 0.333em; margin-right: 0.333em;">≠</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2279">j</span><span class="MJXp-mo" id="MJXp-Span-2280" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mn" id="MJXp-Span-2281">2</span><span class="MJXp-mo" id="MJXp-Span-2282" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mrow" id="MJXp-Span-2283"><span class="MJXp-mo" id="MJXp-Span-2284" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-msubsup" id="MJXp-Span-2285"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2286" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2287" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-2288" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-2289"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2290" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2291" style="vertical-align: -0.4em;">j</span></span><span class="MJXp-mrow" id="MJXp-Span-2292"><span class="MJXp-mo" id="MJXp-Span-2293" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-340"> \sum\limits_{i = 1}^n \sum\limits_{j = i + 1}^n [i \bmod 2 \neq j \bmod 2] |b_i - b_j| </script></p><p>This can be further transformed into a problem involving a number line from <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2294"><span class="MJXp-mn" id="MJXp-Span-2295">1</span></span></span><script type="math/tex" id="MathJax-Element-341">1</script> to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2296"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2297">n</span></span></span><script type="math/tex" id="MathJax-Element-342">n</script>, where point <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2298"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2299">i</span></span></span><script type="math/tex" id="MathJax-Element-343">i</script> can be black, white, or undetermined. If <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2300"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2301">i</span></span></span><script type="math/tex" id="MathJax-Element-344">i</script> is at an odd index in sequence <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2302"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2303">a</span></span></span><script type="math/tex" id="MathJax-Element-345">a</script>, it is black; if even, it is white. If <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2304"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2305">i</span></span></span><script type="math/tex" id="MathJax-Element-346">i</script> does not appear in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2306"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2307">a</span></span></span><script type="math/tex" id="MathJax-Element-347">a</script>, it is undetermined. Our goal is to color the undetermined points as either black or white such that:</p><ul> <li> There are exactly <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2308"><span class="MJXp-mrow" id="MJXp-Span-2309"><span class="MJXp-mo" id="MJXp-Span-2310" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.5em;"><span class="MJXp-right MJXp-scale5" style="font-size: 3em; margin-left: -0.18em;">⌈</span></span><span class="MJXp-mfrac" id="MJXp-Span-2311" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2312">n</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mn" id="MJXp-Span-2313">2</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-2314" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.5em;"><span class="MJXp-right MJXp-scale5" style="font-size: 3em; margin-left: -0.18em;">⌉</span></span></span></span></span><script type="math/tex" id="MathJax-Element-348">\left\lceil\frac{n}{2}\right\rceil</script> black points. </li><li> The sum of distances between all pairs of differently colored points is minimized. </li></ul><p>This sum can be rewritten as: for each <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2315"><span class="MJXp-mn" id="MJXp-Span-2316">1</span><span class="MJXp-mo" id="MJXp-Span-2317" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2318">k</span><span class="MJXp-mo" id="MJXp-Span-2319" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2320">n</span></span></span><script type="math/tex" id="MathJax-Element-349">1 \leq k < n</script>, the number of black points in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2321"><span class="MJXp-mn" id="MJXp-Span-2322">1</span><span class="MJXp-mo" id="MJXp-Span-2323" style="margin-left: 0.333em; margin-right: 0.333em;">∼</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2324">k</span></span></span><script type="math/tex" id="MathJax-Element-350">1 \sim k</script> times the number of white points in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2325"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2326">k</span><span class="MJXp-mo" id="MJXp-Span-2327" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-2328">1</span><span class="MJXp-mo" id="MJXp-Span-2329" style="margin-left: 0.333em; margin-right: 0.333em;">∼</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2330">n</span></span></span><script type="math/tex" id="MathJax-Element-351">k + 1 \sim n</script>, plus the number of white points in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2331"><span class="MJXp-mn" id="MJXp-Span-2332">1</span><span class="MJXp-mo" id="MJXp-Span-2333" style="margin-left: 0.333em; margin-right: 0.333em;">∼</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2334">k</span></span></span><script type="math/tex" id="MathJax-Element-352">1 \sim k</script> times the number of black points in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2335"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2336">k</span><span class="MJXp-mo" id="MJXp-Span-2337" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-2338">1</span><span class="MJXp-mo" id="MJXp-Span-2339" style="margin-left: 0.333em; margin-right: 0.333em;">∼</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2340">n</span></span></span><script type="math/tex" id="MathJax-Element-353">k + 1 \sim n</script>.</p><p>This reformulated problem can be solved using DP. Define <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2341"><span class="MJXp-msubsup" id="MJXp-Span-2342"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2343" style="margin-right: 0.05em;">f</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2344" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2345">i</span><span class="MJXp-mo" id="MJXp-Span-2346">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2347">j</span></span></span></span></span><script type="math/tex" id="MathJax-Element-354">f_{i, j}</script> as the minimum possible sum of the above distances when <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2348"><span class="MJXp-mn" id="MJXp-Span-2349">1</span><span class="MJXp-mo" id="MJXp-Span-2350" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2351">k</span><span class="MJXp-mo" id="MJXp-Span-2352" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2353">i</span></span></span><script type="math/tex" id="MathJax-Element-355">1 \le k < i</script> after determining the colors of the first <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2354"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2355">i</span></span></span><script type="math/tex" id="MathJax-Element-356">i</script> points, with exactly <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2356"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2357">j</span></span></span><script type="math/tex" id="MathJax-Element-357">j</script> black points.</p><p>For transitions, first update <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2358"><span class="MJXp-msubsup" id="MJXp-Span-2359"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2360" style="margin-right: 0.05em;">f</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2361" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2362">i</span><span class="MJXp-mo" id="MJXp-Span-2363">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2364">j</span></span></span></span></span><script type="math/tex" id="MathJax-Element-358">f_{i, j}</script> by adding the contribution from <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2365"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2366">k</span><span class="MJXp-mo" id="MJXp-Span-2367" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2368">i</span></span></span><script type="math/tex" id="MathJax-Element-359">k = i</script>. That is to add <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2369"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2370">j</span><span class="MJXp-mo" id="MJXp-Span-2371" style="margin-left: 0.267em; margin-right: 0.267em;">×</span><span class="MJXp-mo" id="MJXp-Span-2372" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mrow" id="MJXp-Span-2373"><span class="MJXp-mo" id="MJXp-Span-2374" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.5em;"><span class="MJXp-right MJXp-scale5" style="font-size: 3em; margin-left: -0.18em;">⌊</span></span><span class="MJXp-mfrac" id="MJXp-Span-2375" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2376">n</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mn" id="MJXp-Span-2377">2</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-2378" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.5em;"><span class="MJXp-right MJXp-scale5" style="font-size: 3em; margin-left: -0.18em;">⌋</span></span></span><span class="MJXp-mo" id="MJXp-Span-2379" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mo" id="MJXp-Span-2380" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2381">i</span><span class="MJXp-mo" id="MJXp-Span-2382" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2383">j</span><span class="MJXp-mo" id="MJXp-Span-2384" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-2385" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-2386" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mo" id="MJXp-Span-2387" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2388">i</span><span class="MJXp-mo" id="MJXp-Span-2389" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2390">j</span><span class="MJXp-mo" id="MJXp-Span-2391" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-2392" style="margin-left: 0.267em; margin-right: 0.267em;">×</span><span class="MJXp-mo" id="MJXp-Span-2393" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mrow" id="MJXp-Span-2394"><span class="MJXp-mo" id="MJXp-Span-2395" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.5em;"><span class="MJXp-right MJXp-scale5" style="font-size: 3em; margin-left: -0.18em;">⌈</span></span><span class="MJXp-mfrac" id="MJXp-Span-2396" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2397">n</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mn" id="MJXp-Span-2398">2</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-2399" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.5em;"><span class="MJXp-right MJXp-scale5" style="font-size: 3em; margin-left: -0.18em;">⌉</span></span></span><span class="MJXp-mo" id="MJXp-Span-2400" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2401">j</span><span class="MJXp-mo" id="MJXp-Span-2402" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-360">j \times (\left\lfloor\frac{n}{2}\right\rfloor - (i - j)) + (i - j) \times (\left\lceil\frac{n}{2}\right\rceil - j)</script> to all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2403"><span class="MJXp-msubsup" id="MJXp-Span-2404"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2405" style="margin-right: 0.05em;">f</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2406" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2407">i</span><span class="MJXp-mo" id="MJXp-Span-2408">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2409">j</span></span></span></span></span><script type="math/tex" id="MathJax-Element-361">f_{i, j}</script>.</p><p>Then, consider whether the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2410"><span class="MJXp-mo" id="MJXp-Span-2411" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2412">i</span><span class="MJXp-mo" id="MJXp-Span-2413" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-2414">1</span><span class="MJXp-mo" id="MJXp-Span-2415" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-362">(i+1)</script>-th point is black or white:</p><ul> <li> If it can be white, then perform <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2416"><span class="MJXp-msubsup" id="MJXp-Span-2417"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2418" style="margin-right: 0.05em;">f</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2419" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2420">i</span><span class="MJXp-mo" id="MJXp-Span-2421">+</span><span class="MJXp-mn" id="MJXp-Span-2422">1</span><span class="MJXp-mo" id="MJXp-Span-2423">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2424">j</span></span></span><span class="MJXp-mo" id="MJXp-Span-2425" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-2426" style="margin-left: 0.333em; margin-right: 0.333em;">min</span><span class="MJXp-mo" id="MJXp-Span-2427" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-2428"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2429" style="margin-right: 0.05em;">f</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2430" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2431">i</span><span class="MJXp-mo" id="MJXp-Span-2432">+</span><span class="MJXp-mn" id="MJXp-Span-2433">1</span><span class="MJXp-mo" id="MJXp-Span-2434">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2435">j</span></span></span><span class="MJXp-mo" id="MJXp-Span-2436" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-2437"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2438" style="margin-right: 0.05em;">f</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2439" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2440">i</span><span class="MJXp-mo" id="MJXp-Span-2441">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2442">j</span></span></span><span class="MJXp-mo" id="MJXp-Span-2443" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-363">f_{i + 1, j} = \min(f_{i + 1, j}, f_{i, j})</script>. </li><li> If it can be black, then perform <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2444"><span class="MJXp-msubsup" id="MJXp-Span-2445"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2446" style="margin-right: 0.05em;">f</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2447" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2448">i</span><span class="MJXp-mo" id="MJXp-Span-2449">+</span><span class="MJXp-mn" id="MJXp-Span-2450">1</span><span class="MJXp-mo" id="MJXp-Span-2451">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2452">j</span><span class="MJXp-mo" id="MJXp-Span-2453">+</span><span class="MJXp-mn" id="MJXp-Span-2454">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-2455" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-2456" style="margin-left: 0.333em; margin-right: 0.333em;">min</span><span class="MJXp-mo" id="MJXp-Span-2457" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-2458"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2459" style="margin-right: 0.05em;">f</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2460" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2461">i</span><span class="MJXp-mo" id="MJXp-Span-2462">+</span><span class="MJXp-mn" id="MJXp-Span-2463">1</span><span class="MJXp-mo" id="MJXp-Span-2464">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2465">j</span><span class="MJXp-mo" id="MJXp-Span-2466">+</span><span class="MJXp-mn" id="MJXp-Span-2467">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-2468" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-2469"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2470" style="margin-right: 0.05em;">f</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2471" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2472">i</span><span class="MJXp-mo" id="MJXp-Span-2473">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2474">j</span></span></span><span class="MJXp-mo" id="MJXp-Span-2475" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-364">f_{i + 1, j + 1} = \min(f_{i + 1, j + 1}, f_{i, j})</script>. </li></ul><p>The final answer is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2476"><span class="MJXp-munderover" id="MJXp-Span-2477"><span><span class="MJXp-over"><span class=" MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2483" style="margin-right: 0px; margin-left: 0px;">n</span></span><span class=""><span class="MJXp-mo" id="MJXp-Span-2478" style="margin-left: 0.111em; margin-right: 0.167em;">∑</span></span></span></span><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-2479" style="margin-left: 0px;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2480">i</span><span class="MJXp-mo" id="MJXp-Span-2481">=</span><span class="MJXp-mn" id="MJXp-Span-2482">1</span></span></span></span><span class="MJXp-msubsup" id="MJXp-Span-2484"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2485" style="margin-right: 0.05em;">i</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2486" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-2487" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-2488"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2489" style="margin-right: 0.05em;">f</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2490" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2491">n</span><span class="MJXp-mo" id="MJXp-Span-2492">,</span><span class="MJXp-mrow" id="MJXp-Span-2493"><span class="MJXp-mo" id="MJXp-Span-2494" style="vertical-align: -0.5em;"><span class="MJXp-right MJXp-scale5" style="font-size: 3em; margin-left: -0.18em;">⌈</span></span><span class="MJXp-mfrac" id="MJXp-Span-2495" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2496">n</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mn" id="MJXp-Span-2497">2</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-2498" style="vertical-align: -0.5em;"><span class="MJXp-right MJXp-scale5" style="font-size: 3em; margin-left: -0.18em;">⌉</span></span></span></span></span></span></span><script type="math/tex" id="MathJax-Element-365">\sum\limits_{i = 1}^n i^2 - f_{n, \left\lceil\frac{n}{2}\right\rceil}</script>.</p><p><span class="tex-font-style-bf">Time complexity</span>: <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2499"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2500">O</span><span class="MJXp-mo" id="MJXp-Span-2501" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-2502"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2503" style="margin-right: 0.05em;">n</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2504" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-2505" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-366">O(n^2)</script> per test case.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Implementation</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">typedef</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> ll</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">void</span><span class="pln"> solve</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
	cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
	vector</span><span class="str">&lt;int&gt;</span><span class="pln"> a</span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">);</span><span class="pln">
	vector</span><span class="pun">&lt;</span><span class="pln"> vector</span><span class="str">&lt;ll&gt;</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> f</span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> vector</span><span class="str">&lt;ll&gt;</span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1e18</span><span class="pun">));</span><span class="pln">
	</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> x</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		cin </span><span class="pun">&gt;&gt;</span><span class="pln"> x</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			a</span><span class="pun">[</span><span class="pln">x</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> i </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		f</span><span class="pun">[</span><span class="lit">1</span><span class="pun">][</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		f</span><span class="pun">[</span><span class="lit">1</span><span class="pun">][</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;=</span><span class="pln"> i</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">j</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			f</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+=</span><span class="pln"> j </span><span class="pun">*</span><span class="pln"> </span><span class="pun">(</span><span class="pln">n </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> j</span><span class="pun">))</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> j</span><span class="pun">)</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">((</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> j</span><span class="pun">);</span><span class="pln">
			</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
				f</span><span class="pun">[</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">][</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> min</span><span class="pun">(</span><span class="pln">f</span><span class="pun">[</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">][</span><span class="pln">j</span><span class="pun">],</span><span class="pln"> f</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">]);</span><span class="pln">
			</span><span class="pun">}</span><span class="pln">
			</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
				f</span><span class="pun">[</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">][</span><span class="pln">j </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> min</span><span class="pun">(</span><span class="pln">f</span><span class="pun">[</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">][</span><span class="pln">j </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">],</span><span class="pln"> f</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">]);</span><span class="pln">
			</span><span class="pun">}</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	ll ans </span><span class="pun">=</span><span class="pln"> </span><span class="pun">-</span><span class="pln">f</span><span class="pun">[</span><span class="pln">n</span><span class="pun">][(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pun">];</span><span class="pln">
	</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		ans </span><span class="pun">+=</span><span class="pln"> i </span><span class="pun">*</span><span class="pln"> i</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	cout </span><span class="pun">&lt;&lt;</span><span class="pln"> ans </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="kwd">int</span><span class="pln"> T</span><span class="pun">;</span><span class="pln">
	cin </span><span class="pun">&gt;&gt;</span><span class="pln"> T</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">T</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		solve</span><span class="pun">();</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	</span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2084/problem/G2">2084G2 - Wish Upon a Satellite (Hard Version)</a></p><p>Idea: <a class="rated-user user-red" href="https://codeforces.com/profile/zltzlt" title="International Grandmaster zltzlt">zltzlt</a></p> <div class="spoiler"><b class="spoiler-title">Hint 1</b><div class="spoiler-content" style="display: block;"><p>Optimize the DP in G1.</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2084/problem/G2" title="Teza Round 1 (Codeforces Round 1015, Div. 1 + Div. 2)">2084G2 - Wish Upon a Satellite (Hard Version)</a></h3><div class="ttypography"><div class="problem-statement"><div><p>Please read the solution for G1 first.</p><p>Now, consider the operations we need to perform on the DP array at each step:</p><ul> <li> For all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2506"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2507">j</span></span></span><script type="math/tex" id="MathJax-Element-367">j</script>, update <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2508"><span class="MJXp-msubsup" id="MJXp-Span-2509"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2510" style="margin-right: 0.05em;">f</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2511" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2512">i</span><span class="MJXp-mo" id="MJXp-Span-2513">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2514">j</span></span></span></span></span><script type="math/tex" id="MathJax-Element-368">f_{i, j}</script> by adding <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2515"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2516">j</span><span class="MJXp-mo" id="MJXp-Span-2517" style="margin-left: 0.267em; margin-right: 0.267em;">×</span><span class="MJXp-mrow" id="MJXp-Span-2518"><span class="MJXp-mo" id="MJXp-Span-2519" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.5em;"><span class="MJXp-right MJXp-scale5" style="font-size: 3em; margin-left: -0.13em;">(</span></span><span class="MJXp-mrow" id="MJXp-Span-2520"><span class="MJXp-mo" id="MJXp-Span-2521" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.5em;"><span class="MJXp-right MJXp-scale5" style="font-size: 3em; margin-left: -0.18em;">⌊</span></span><span class="MJXp-mfrac" id="MJXp-Span-2522" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2523">n</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mn" id="MJXp-Span-2524">2</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-2525" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.5em;"><span class="MJXp-right MJXp-scale5" style="font-size: 3em; margin-left: -0.18em;">⌋</span></span></span><span class="MJXp-mo" id="MJXp-Span-2526" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mo" id="MJXp-Span-2527" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2528">i</span><span class="MJXp-mo" id="MJXp-Span-2529" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2530">j</span><span class="MJXp-mo" id="MJXp-Span-2531" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-2532" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.5em;"><span class="MJXp-right MJXp-scale5" style="font-size: 3em; margin-left: -0.13em;">)</span></span></span><span class="MJXp-mo" id="MJXp-Span-2533" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mo" id="MJXp-Span-2534" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2535">i</span><span class="MJXp-mo" id="MJXp-Span-2536" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2537">j</span><span class="MJXp-mo" id="MJXp-Span-2538" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-2539" style="margin-left: 0.267em; margin-right: 0.267em;">×</span><span class="MJXp-mrow" id="MJXp-Span-2540"><span class="MJXp-mo" id="MJXp-Span-2541" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.5em;"><span class="MJXp-right MJXp-scale5" style="font-size: 3em; margin-left: -0.13em;">(</span></span><span class="MJXp-mrow" id="MJXp-Span-2542"><span class="MJXp-mo" id="MJXp-Span-2543" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.5em;"><span class="MJXp-right MJXp-scale5" style="font-size: 3em; margin-left: -0.18em;">⌈</span></span><span class="MJXp-mfrac" id="MJXp-Span-2544" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2545">n</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mn" id="MJXp-Span-2546">2</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-2547" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.5em;"><span class="MJXp-right MJXp-scale5" style="font-size: 3em; margin-left: -0.18em;">⌉</span></span></span><span class="MJXp-mo" id="MJXp-Span-2548" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2549">j</span><span class="MJXp-mo" id="MJXp-Span-2550" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.5em;"><span class="MJXp-right MJXp-scale5" style="font-size: 3em; margin-left: -0.13em;">)</span></span></span><span class="MJXp-mo" id="MJXp-Span-2551" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-2552">2</span><span class="MJXp-msubsup" id="MJXp-Span-2553"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2554" style="margin-right: 0.05em;">j</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2555" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-2556" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mo" id="MJXp-Span-2557" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mo" id="MJXp-Span-2558" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-2559">2</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2560">i</span><span class="MJXp-mo" id="MJXp-Span-2561" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mo" id="MJXp-Span-2562" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2563">n</span><span class="MJXp-mo" id="MJXp-Span-2564" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mn" id="MJXp-Span-2565">2</span><span class="MJXp-mo" id="MJXp-Span-2566" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-2567" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2568">j</span><span class="MJXp-mo" id="MJXp-Span-2569" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2570">i</span><span class="MJXp-mo" id="MJXp-Span-2571" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mrow" id="MJXp-Span-2572"><span class="MJXp-mo" id="MJXp-Span-2573" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.5em;"><span class="MJXp-right MJXp-scale5" style="font-size: 3em; margin-left: -0.18em;">⌈</span></span><span class="MJXp-mfrac" id="MJXp-Span-2574" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2575">n</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mn" id="MJXp-Span-2576">2</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-2577" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.5em;"><span class="MJXp-right MJXp-scale5" style="font-size: 3em; margin-left: -0.18em;">⌉</span></span></span></span></span><script type="math/tex" id="MathJax-Element-369">j \times \left(\left\lfloor\frac{n}{2}\right\rfloor - (i - j)\right) + (i - j) \times \left(\left\lceil\frac{n}{2}\right\rceil - j\right) = 2j^2 + (-2i - (n \bmod 2)) j + i \cdot \left\lceil\frac{n}{2}\right\rceil</script>, which is a quadratic function of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2578"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2579">j</span></span></span><script type="math/tex" id="MathJax-Element-370">j</script>; </li><li> Perform the transition <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2580"><span class="MJXp-msubsup" id="MJXp-Span-2581"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2582" style="margin-right: 0.05em;">f</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2583" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2584">i</span><span class="MJXp-mo" id="MJXp-Span-2585">+</span><span class="MJXp-mn" id="MJXp-Span-2586">1</span><span class="MJXp-mo" id="MJXp-Span-2587">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2588">j</span></span></span><span class="MJXp-mo" id="MJXp-Span-2589" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-2590" style="margin-left: 0.333em; margin-right: 0.333em;">min</span><span class="MJXp-mo" id="MJXp-Span-2591" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-2592"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2593" style="margin-right: 0.05em;">f</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2594" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2595">i</span><span class="MJXp-mo" id="MJXp-Span-2596">+</span><span class="MJXp-mn" id="MJXp-Span-2597">1</span><span class="MJXp-mo" id="MJXp-Span-2598">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2599">j</span></span></span><span class="MJXp-mo" id="MJXp-Span-2600" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-2601"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2602" style="margin-right: 0.05em;">f</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2603" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2604">i</span><span class="MJXp-mo" id="MJXp-Span-2605">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2606">j</span></span></span><span class="MJXp-mo" id="MJXp-Span-2607" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-371">f_{i + 1, j} = \min(f_{i + 1, j}, f_{i, j})</script>; </li><li> Perform the transition <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2608"><span class="MJXp-msubsup" id="MJXp-Span-2609"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2610" style="margin-right: 0.05em;">f</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2611" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2612">i</span><span class="MJXp-mo" id="MJXp-Span-2613">+</span><span class="MJXp-mn" id="MJXp-Span-2614">1</span><span class="MJXp-mo" id="MJXp-Span-2615">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2616">j</span><span class="MJXp-mo" id="MJXp-Span-2617">+</span><span class="MJXp-mn" id="MJXp-Span-2618">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-2619" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-2620" style="margin-left: 0.333em; margin-right: 0.333em;">min</span><span class="MJXp-mo" id="MJXp-Span-2621" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-2622"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2623" style="margin-right: 0.05em;">f</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2624" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2625">i</span><span class="MJXp-mo" id="MJXp-Span-2626">+</span><span class="MJXp-mn" id="MJXp-Span-2627">1</span><span class="MJXp-mo" id="MJXp-Span-2628">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2629">j</span><span class="MJXp-mo" id="MJXp-Span-2630">+</span><span class="MJXp-mn" id="MJXp-Span-2631">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-2632" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-2633"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2634" style="margin-right: 0.05em;">f</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2635" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2636">i</span><span class="MJXp-mo" id="MJXp-Span-2637">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2638">j</span></span></span><span class="MJXp-mo" id="MJXp-Span-2639" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-372">f_{i + 1, j + 1} = \min(f_{i + 1, j + 1}, f_{i, j})</script>. </li></ul><p>We can inductively prove that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2640"><span class="MJXp-msubsup" id="MJXp-Span-2641"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2642" style="margin-right: 0.05em;">f</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2643" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2644">i</span><span class="MJXp-mo" id="MJXp-Span-2645">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2646">j</span></span></span></span></span><script type="math/tex" id="MathJax-Element-373">f_{i, j}</script> is convex downward, meaning the difference array of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2647"><span class="MJXp-msubsup" id="MJXp-Span-2648"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2649" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2650" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-374">f_i</script> is non-decreasing. Instead of maintaining <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2651"><span class="MJXp-msubsup" id="MJXp-Span-2652"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2653" style="margin-right: 0.05em;">f</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2654" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2655">i</span><span class="MJXp-mo" id="MJXp-Span-2656">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2657">j</span></span></span></span></span><script type="math/tex" id="MathJax-Element-375">f_{i, j}</script> directly, consider maintaining its difference array <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2658"><span class="MJXp-msubsup" id="MJXp-Span-2659"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2660" style="margin-right: 0.05em;">g</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2661" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2662">i</span><span class="MJXp-mo" id="MJXp-Span-2663">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2664">j</span></span></span><span class="MJXp-mo" id="MJXp-Span-2665" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-2666"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2667" style="margin-right: 0.05em;">f</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2668" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2669">i</span><span class="MJXp-mo" id="MJXp-Span-2670">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2671">j</span><span class="MJXp-mo" id="MJXp-Span-2672">+</span><span class="MJXp-mn" id="MJXp-Span-2673">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-2674" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-2675"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2676" style="margin-right: 0.05em;">f</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2677" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2678">i</span><span class="MJXp-mo" id="MJXp-Span-2679">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2680">j</span></span></span></span></span><script type="math/tex" id="MathJax-Element-376">g_{i, j} = f_{i, j + 1} - f_{i, j}</script>.</p><p>Then, the operations transform into:</p><ul> <li> For all <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2681"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2682">j</span></span></span><script type="math/tex" id="MathJax-Element-377">j</script>, add a linear function of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2683"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2684">j</span></span></span><script type="math/tex" id="MathJax-Element-378">j</script> to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2685"><span class="MJXp-msubsup" id="MJXp-Span-2686"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2687" style="margin-right: 0.05em;">g</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2688" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2689">i</span><span class="MJXp-mo" id="MJXp-Span-2690">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2691">j</span></span></span></span></span><script type="math/tex" id="MathJax-Element-379">g_{i, j}</script>; </li><li> Shift <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2692"><span class="MJXp-msubsup" id="MJXp-Span-2693"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2694" style="margin-right: 0.05em;">g</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2695" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2696">i</span><span class="MJXp-mo" id="MJXp-Span-2697">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2698">j</span></span></span></span></span><script type="math/tex" id="MathJax-Element-380">g_{i, j}</script> one position to the right; </li><li> Insert a zero into <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2699"><span class="MJXp-msubsup" id="MJXp-Span-2700"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2701" style="margin-right: 0.05em;">g</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2702" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-381">g_i</script> while keeping it sorted. </li></ul><p>To efficiently maintain <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2703"><span class="MJXp-msubsup" id="MJXp-Span-2704"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2705" style="margin-right: 0.05em;">g</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2706" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2707">i</span><span class="MJXp-mo" id="MJXp-Span-2708">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2709">j</span></span></span></span></span><script type="math/tex" id="MathJax-Element-382">g_{i, j}</script>, we use a Treap. Each node in the Treap stores the value of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2710"><span class="MJXp-msubsup" id="MJXp-Span-2711"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2712" style="margin-right: 0.05em;">g</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2713" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2714">i</span><span class="MJXp-mo" id="MJXp-Span-2715">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2716">j</span></span></span></span></span><script type="math/tex" id="MathJax-Element-383">g_{i, j}</script> along with its index <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2717"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2718">j</span></span></span><script type="math/tex" id="MathJax-Element-384">j</script>, so all operations can be rewritten as linear transformations of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2719"><span class="MJXp-mo" id="MJXp-Span-2720" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-2721"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2722" style="margin-right: 0.05em;">g</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2723" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2724">i</span><span class="MJXp-mo" id="MJXp-Span-2725">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2726">j</span></span></span><span class="MJXp-mo" id="MJXp-Span-2727" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2728">j</span><span class="MJXp-mo" id="MJXp-Span-2729" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-385">(g_{i, j}, j)</script>, which can be efficiently handled using vectors and matrices.</p><p><span class="tex-font-style-bf">Time complexity</span>: <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2730"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2731">O</span><span class="MJXp-mo" id="MJXp-Span-2732" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2733">n</span><span class="MJXp-mi" id="MJXp-Span-2734">log</span><span class="MJXp-mo" id="MJXp-Span-2735" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2736">n</span><span class="MJXp-mo" id="MJXp-Span-2737" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-386">O(n \log n)</script> per test case.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Implementation</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">typedef</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> ll</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> maxn </span><span class="pun">=</span><span class="pln"> </span><span class="lit">500100</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">maxn</span><span class="pun">];</span><span class="pln">
mt19937 rnd</span><span class="pun">(</span><span class="pln">chrono</span><span class="pun">::</span><span class="pln">steady_clock</span><span class="pun">::</span><span class="pln">now</span><span class="pun">().</span><span class="pln">time_since_epoch</span><span class="pun">().</span><span class="pln">count</span><span class="pun">());</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> p</span><span class="pun">[</span><span class="pln">maxn</span><span class="pun">],</span><span class="pln"> nt</span><span class="pun">,</span><span class="pln"> ls</span><span class="pun">[</span><span class="pln">maxn</span><span class="pun">],</span><span class="pln"> rs</span><span class="pun">[</span><span class="pln">maxn</span><span class="pun">],</span><span class="pln"> sz</span><span class="pun">[</span><span class="pln">maxn</span><span class="pun">];</span><span class="pln">
</span><span class="kwd">bool</span><span class="pln"> vis</span><span class="pun">[</span><span class="pln">maxn</span><span class="pun">];</span><span class="pln">

</span><span class="kwd">struct</span><span class="pln"> vec </span><span class="pun">{</span><span class="pln">
	ll a0</span><span class="pun">,</span><span class="pln"> a1</span><span class="pun">,</span><span class="pln"> a2</span><span class="pun">;</span><span class="pln">
	vec</span><span class="pun">(</span><span class="pln">ll a </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> ll b </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> ll c </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> a0</span><span class="pun">(</span><span class="pln">a</span><span class="pun">),</span><span class="pln"> a1</span><span class="pun">(</span><span class="pln">b</span><span class="pun">),</span><span class="pln"> a2</span><span class="pun">(</span><span class="pln">c</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> val</span><span class="pun">[</span><span class="pln">maxn</span><span class="pun">];</span><span class="pln">

</span><span class="kwd">struct</span><span class="pln"> mat </span><span class="pun">{</span><span class="pln">
	ll a00</span><span class="pun">,</span><span class="pln"> a01</span><span class="pun">,</span><span class="pln"> a02</span><span class="pun">,</span><span class="pln"> a10</span><span class="pun">,</span><span class="pln"> a11</span><span class="pun">,</span><span class="pln"> a12</span><span class="pun">,</span><span class="pln"> a20</span><span class="pun">,</span><span class="pln"> a21</span><span class="pun">,</span><span class="pln"> a22</span><span class="pun">;</span><span class="pln">
	mat</span><span class="pun">(</span><span class="pln">ll a </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> ll b </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> ll c </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> ll d </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> ll e </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> ll f </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> ll g </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> ll h </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> ll i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> a00</span><span class="pun">(</span><span class="pln">a</span><span class="pun">),</span><span class="pln"> a01</span><span class="pun">(</span><span class="pln">b</span><span class="pun">),</span><span class="pln"> a02</span><span class="pun">(</span><span class="pln">c</span><span class="pun">),</span><span class="pln"> a10</span><span class="pun">(</span><span class="pln">d</span><span class="pun">),</span><span class="pln"> a11</span><span class="pun">(</span><span class="pln">e</span><span class="pun">),</span><span class="pln"> a12</span><span class="pun">(</span><span class="pln">f</span><span class="pun">),</span><span class="pln"> a20</span><span class="pun">(</span><span class="pln">g</span><span class="pun">),</span><span class="pln"> a21</span><span class="pun">(</span><span class="pln">h</span><span class="pun">),</span><span class="pln"> a22</span><span class="pun">(</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> I</span><span class="pun">,</span><span class="pln"> tag</span><span class="pun">[</span><span class="pln">maxn</span><span class="pun">];</span><span class="pln">

</span><span class="kwd">inline</span><span class="pln"> vec </span><span class="kwd">operator</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">const</span><span class="pln"> vec </span><span class="pun">&amp;</span><span class="pln">a</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">const</span><span class="pln"> mat </span><span class="pun">&amp;</span><span class="pln">b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	vec res</span><span class="pun">;</span><span class="pln">
	res</span><span class="pun">.</span><span class="pln">a0 </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">a0 </span><span class="pun">*</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">a00 </span><span class="pun">+</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">a1 </span><span class="pun">*</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">a10 </span><span class="pun">+</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">a2 </span><span class="pun">*</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">a20</span><span class="pun">;</span><span class="pln">
	res</span><span class="pun">.</span><span class="pln">a1 </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">a0 </span><span class="pun">*</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">a01 </span><span class="pun">+</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">a1 </span><span class="pun">*</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">a11 </span><span class="pun">+</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">a2 </span><span class="pun">*</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">a21</span><span class="pun">;</span><span class="pln">
	res</span><span class="pun">.</span><span class="pln">a2 </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">a0 </span><span class="pun">*</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">a02 </span><span class="pun">+</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">a1 </span><span class="pun">*</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">a12 </span><span class="pun">+</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">a2 </span><span class="pun">*</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">a22</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">return</span><span class="pln"> res</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">inline</span><span class="pln"> mat </span><span class="kwd">operator</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">const</span><span class="pln"> mat </span><span class="pun">&amp;</span><span class="pln">a</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">const</span><span class="pln"> mat </span><span class="pun">&amp;</span><span class="pln">b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	mat res</span><span class="pun">;</span><span class="pln">
	res</span><span class="pun">.</span><span class="pln">a00 </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">a00 </span><span class="pun">*</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">a00 </span><span class="pun">+</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">a01 </span><span class="pun">*</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">a10 </span><span class="pun">+</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">a02 </span><span class="pun">*</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">a20</span><span class="pun">;</span><span class="pln">
	res</span><span class="pun">.</span><span class="pln">a01 </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">a00 </span><span class="pun">*</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">a01 </span><span class="pun">+</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">a01 </span><span class="pun">*</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">a11 </span><span class="pun">+</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">a02 </span><span class="pun">*</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">a21</span><span class="pun">;</span><span class="pln">
	res</span><span class="pun">.</span><span class="pln">a02 </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">a00 </span><span class="pun">*</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">a02 </span><span class="pun">+</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">a01 </span><span class="pun">*</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">a12 </span><span class="pun">+</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">a02 </span><span class="pun">*</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">a22</span><span class="pun">;</span><span class="pln">
	res</span><span class="pun">.</span><span class="pln">a10 </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">a10 </span><span class="pun">*</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">a00 </span><span class="pun">+</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">a11 </span><span class="pun">*</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">a10 </span><span class="pun">+</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">a12 </span><span class="pun">*</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">a20</span><span class="pun">;</span><span class="pln">
	res</span><span class="pun">.</span><span class="pln">a11 </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">a10 </span><span class="pun">*</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">a01 </span><span class="pun">+</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">a11 </span><span class="pun">*</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">a11 </span><span class="pun">+</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">a12 </span><span class="pun">*</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">a21</span><span class="pun">;</span><span class="pln">
	res</span><span class="pun">.</span><span class="pln">a12 </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">a10 </span><span class="pun">*</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">a02 </span><span class="pun">+</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">a11 </span><span class="pun">*</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">a12 </span><span class="pun">+</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">a12 </span><span class="pun">*</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">a22</span><span class="pun">;</span><span class="pln">
	res</span><span class="pun">.</span><span class="pln">a20 </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">a20 </span><span class="pun">*</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">a00 </span><span class="pun">+</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">a21 </span><span class="pun">*</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">a10 </span><span class="pun">+</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">a22 </span><span class="pun">*</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">a20</span><span class="pun">;</span><span class="pln">
	res</span><span class="pun">.</span><span class="pln">a21 </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">a20 </span><span class="pun">*</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">a01 </span><span class="pun">+</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">a21 </span><span class="pun">*</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">a11 </span><span class="pun">+</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">a22 </span><span class="pun">*</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">a21</span><span class="pun">;</span><span class="pln">
	res</span><span class="pun">.</span><span class="pln">a22 </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">a20 </span><span class="pun">*</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">a02 </span><span class="pun">+</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">a21 </span><span class="pun">*</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">a12 </span><span class="pun">+</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">a22 </span><span class="pun">*</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">a22</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">return</span><span class="pln"> res</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">inline</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> init</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> nt</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		p</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> ls</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> rs</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> sz</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
		val</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> vec</span><span class="pun">();</span><span class="pln">
		tag</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> I</span><span class="pun">;</span><span class="pln">
		vis</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	nt </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">inline</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> newnode</span><span class="pun">(</span><span class="pln">ll x</span><span class="pun">,</span><span class="pln"> ll y</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="kwd">int</span><span class="pln"> u </span><span class="pun">=</span><span class="pln"> </span><span class="pun">++</span><span class="pln">nt</span><span class="pun">;</span><span class="pln">
	p</span><span class="pun">[</span><span class="pln">u</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> rnd</span><span class="pun">();</span><span class="pln">
	ls</span><span class="pun">[</span><span class="pln">u</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> rs</span><span class="pun">[</span><span class="pln">u</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
	sz</span><span class="pun">[</span><span class="pln">u</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
	val</span><span class="pun">[</span><span class="pln">u</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> vec</span><span class="pun">(</span><span class="pln">x</span><span class="pun">,</span><span class="pln"> y</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
	tag</span><span class="pun">[</span><span class="pln">u</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> I</span><span class="pun">;</span><span class="pln">
	vis</span><span class="pun">[</span><span class="pln">u</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">return</span><span class="pln"> u</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">inline</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> pushup</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	sz</span><span class="pun">[</span><span class="pln">x</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> sz</span><span class="pun">[</span><span class="pln">ls</span><span class="pun">[</span><span class="pln">x</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> sz</span><span class="pun">[</span><span class="pln">rs</span><span class="pun">[</span><span class="pln">x</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">inline</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> pushtag</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">const</span><span class="pln"> mat </span><span class="pun">&amp;</span><span class="pln">y</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">x</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	val</span><span class="pun">[</span><span class="pln">x</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> val</span><span class="pun">[</span><span class="pln">x</span><span class="pun">]</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> y</span><span class="pun">;</span><span class="pln">
	tag</span><span class="pun">[</span><span class="pln">x</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> tag</span><span class="pun">[</span><span class="pln">x</span><span class="pun">]</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> y</span><span class="pun">;</span><span class="pln">
	vis</span><span class="pun">[</span><span class="pln">x</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">inline</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> pushdown</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">vis</span><span class="pun">[</span><span class="pln">x</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	pushtag</span><span class="pun">(</span><span class="pln">ls</span><span class="pun">[</span><span class="pln">x</span><span class="pun">],</span><span class="pln"> tag</span><span class="pun">[</span><span class="pln">x</span><span class="pun">]);</span><span class="pln">
	pushtag</span><span class="pun">(</span><span class="pln">rs</span><span class="pun">[</span><span class="pln">x</span><span class="pun">],</span><span class="pln"> tag</span><span class="pun">[</span><span class="pln">x</span><span class="pun">]);</span><span class="pln">
	vis</span><span class="pun">[</span><span class="pln">x</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
	tag</span><span class="pun">[</span><span class="pln">x</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> I</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">void</span><span class="pln"> split</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> u</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">x</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">y</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">u</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		x </span><span class="pun">=</span><span class="pln"> y </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">return</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	pushdown</span><span class="pun">(</span><span class="pln">u</span><span class="pun">);</span><span class="pln">
	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">val</span><span class="pun">[</span><span class="pln">u</span><span class="pun">].</span><span class="pln">a0 </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		x </span><span class="pun">=</span><span class="pln"> u</span><span class="pun">;</span><span class="pln">
		split</span><span class="pun">(</span><span class="pln">rs</span><span class="pun">[</span><span class="pln">u</span><span class="pun">],</span><span class="pln"> rs</span><span class="pun">[</span><span class="pln">u</span><span class="pun">],</span><span class="pln"> y</span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		y </span><span class="pun">=</span><span class="pln"> u</span><span class="pun">;</span><span class="pln">
		split</span><span class="pun">(</span><span class="pln">ls</span><span class="pun">[</span><span class="pln">u</span><span class="pun">],</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> ls</span><span class="pun">[</span><span class="pln">u</span><span class="pun">]);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	pushup</span><span class="pun">(</span><span class="pln">u</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> merge</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> y</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">x </span><span class="pun">||</span><span class="pln"> </span><span class="pun">!</span><span class="pln">y</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> x </span><span class="pun">|</span><span class="pln"> y</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	pushdown</span><span class="pun">(</span><span class="pln">x</span><span class="pun">);</span><span class="pln">
	pushdown</span><span class="pun">(</span><span class="pln">y</span><span class="pun">);</span><span class="pln">
	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">p</span><span class="pun">[</span><span class="pln">x</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> p</span><span class="pun">[</span><span class="pln">y</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		rs</span><span class="pun">[</span><span class="pln">x</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> merge</span><span class="pun">(</span><span class="pln">rs</span><span class="pun">[</span><span class="pln">x</span><span class="pun">],</span><span class="pln"> y</span><span class="pun">);</span><span class="pln">
		pushup</span><span class="pun">(</span><span class="pln">x</span><span class="pun">);</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> x</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		ls</span><span class="pun">[</span><span class="pln">y</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> merge</span><span class="pun">(</span><span class="pln">x</span><span class="pun">,</span><span class="pln"> ls</span><span class="pun">[</span><span class="pln">y</span><span class="pun">]);</span><span class="pln">
		pushup</span><span class="pun">(</span><span class="pln">y</span><span class="pun">);</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> y</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

ll f</span><span class="pun">[</span><span class="pln">maxn</span><span class="pun">],</span><span class="pln"> tot</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">void</span><span class="pln"> dfs</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> u</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">u</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	pushdown</span><span class="pun">(</span><span class="pln">u</span><span class="pun">);</span><span class="pln">
	dfs</span><span class="pun">(</span><span class="pln">ls</span><span class="pun">[</span><span class="pln">u</span><span class="pun">]);</span><span class="pln">
	f</span><span class="pun">[++</span><span class="pln">tot</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> val</span><span class="pun">[</span><span class="pln">u</span><span class="pun">].</span><span class="pln">a0</span><span class="pun">;</span><span class="pln">
	dfs</span><span class="pun">(</span><span class="pln">rs</span><span class="pun">[</span><span class="pln">u</span><span class="pun">]);</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">void</span><span class="pln"> solve</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> x</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		cin </span><span class="pun">&gt;&gt;</span><span class="pln"> x</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			a</span><span class="pun">[</span><span class="pln">x</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	init</span><span class="pun">();</span><span class="pln">
	</span><span class="kwd">int</span><span class="pln"> rt </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
	ll l </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> r </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> x </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		l </span><span class="pun">=</span><span class="pln"> r </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		rt </span><span class="pun">=</span><span class="pln"> newnode</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
		r </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">ll i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		x </span><span class="pun">+=</span><span class="pln"> l </span><span class="pun">*</span><span class="pln"> l </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="pun">(-</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> i </span><span class="pun">-</span><span class="pln"> </span><span class="pun">(</span><span class="pln">n </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">))</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> l </span><span class="pun">+</span><span class="pln"> i </span><span class="pun">*</span><span class="pln"> </span><span class="pun">((</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pun">);</span><span class="pln">
		pushtag</span><span class="pun">(</span><span class="pln">rt</span><span class="pun">,</span><span class="pln"> mat</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> i </span><span class="pun">-</span><span class="pln"> </span><span class="pun">(</span><span class="pln">n </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">));</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			pushtag</span><span class="pun">(</span><span class="pln">rt</span><span class="pun">,</span><span class="pln"> mat</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">));</span><span class="pln">
			</span><span class="pun">++</span><span class="pln">l</span><span class="pun">;</span><span class="pln">
			</span><span class="pun">++</span><span class="pln">r</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">int</span><span class="pln"> u</span><span class="pun">,</span><span class="pln"> v</span><span class="pun">;</span><span class="pln">
			split</span><span class="pun">(</span><span class="pln">rt</span><span class="pun">,</span><span class="pln"> u</span><span class="pun">,</span><span class="pln"> v</span><span class="pun">);</span><span class="pln">
			pushtag</span><span class="pun">(</span><span class="pln">v</span><span class="pun">,</span><span class="pln"> mat</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">));</span><span class="pln">
			rt </span><span class="pun">=</span><span class="pln"> merge</span><span class="pun">(</span><span class="pln">merge</span><span class="pun">(</span><span class="pln">u</span><span class="pun">,</span><span class="pln"> newnode</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> l </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> sz</span><span class="pun">[</span><span class="pln">u</span><span class="pun">])),</span><span class="pln"> v</span><span class="pun">);</span><span class="pln">
			</span><span class="pun">++</span><span class="pln">r</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	tot </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
	dfs</span><span class="pun">(</span><span class="pln">rt</span><span class="pun">);</span><span class="pln">
	ll ans </span><span class="pun">=</span><span class="pln"> </span><span class="pun">-</span><span class="pln">x</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> l</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		ans </span><span class="pun">-=</span><span class="pln"> f</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">ll i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		ans </span><span class="pun">+=</span><span class="pln"> i </span><span class="pun">*</span><span class="pln"> i</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	cout </span><span class="pun">&lt;&lt;</span><span class="pln"> ans </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	ios</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
	cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
	I</span><span class="pun">.</span><span class="pln">a00 </span><span class="pun">=</span><span class="pln"> I</span><span class="pun">.</span><span class="pln">a11 </span><span class="pun">=</span><span class="pln"> I</span><span class="pun">.</span><span class="pln">a22 </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">int</span><span class="pln"> T</span><span class="pun">;</span><span class="pln">
	cin </span><span class="pun">&gt;&gt;</span><span class="pln"> T</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">T</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		solve</span><span class="pun">();</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	</span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2084/problem/H">2084H - Turtle and Nediam 2</a></p><p>Idea: <a class="rated-user user-red" href="https://codeforces.com/profile/zltzlt" title="International Grandmaster zltzlt">zltzlt</a> <br> Developer: <a class="rated-user user-legendary" href="https://codeforces.com/profile/StarSilk" title="Legendary Grandmaster StarSilk"><span class="legendary-user-first-letter">S</span>tarSilk</a></p> <div class="spoiler"><b class="spoiler-title">Hint 1</b><div class="spoiler-content" style="display: block;"><p>Extract the longest contiguous segments in <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-18-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-92" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.49em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.518em, 1000.44em, 2.275em, -999.997em); top: -2.108em; left: 0em;"><span class="mrow" id="MathJax-Span-93"><span class="mi" id="MathJax-Span-94" style="font-family: MathJax_Math-italic;">s</span></span><span style="display: inline-block; width: 0px; height: 2.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi></math></span></span><script type="math/tex" id="MathJax-Element-18">s</script> where the values remain the same.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 2</b><div class="spoiler-content" style="display: block;"><p>According to greedy matching, an <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-19-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;O&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-95" style="width: 3.466em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.6em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1002.49em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-96"><span class="mi" id="MathJax-Span-97" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-98" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-99"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.6em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-100" style="font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -4.38em; left: 0.598em;"><span class="mn" id="MathJax-Span-101" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-102" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.575em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>O</mi><mo stretchy="false">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-19">O(n^2)</script> DP can be obtained.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 3</b><div class="spoiler-content" style="display: block;"><p>Optimize the DP from <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-20-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;O&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-103" style="width: 3.466em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.6em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.193em, 1002.49em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-104"><span class="mi" id="MathJax-Span-105" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-106" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-107"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.6em, 4.169em, -999.997em); top: -4.002em; left: 0em;"><span class="mi" id="MathJax-Span-108" style="font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -4.38em; left: 0.598em;"><span class="mn" id="MathJax-Span-109" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-110" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.575em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>O</mi><mo stretchy="false">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-20">O(n^2)</script> to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-21-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;O&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-111" style="width: 2.871em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.167em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.247em, 1002.06em, 2.6em, -999.997em); top: -2.162em; left: 0em;"><span class="mrow" id="MathJax-Span-112"><span class="mi" id="MathJax-Span-113" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-114" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-115" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-116" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.432em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-21">O(n)</script>.</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2084/problem/H" title="Teza Round 1 (Codeforces Round 1015, Div. 1 + Div. 2)">2084H - Turtle and Nediam 2</a></h3><div class="ttypography"><div class="problem-statement"><div><p>First, extract the longest contiguous segments in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2738"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2739">s</span></span></span><script type="math/tex" id="MathJax-Element-387">s</script> where the values remain the same. Suppose there are <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2740"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2741">m</span></span></span><script type="math/tex" id="MathJax-Element-388">m</script> such segments with lengths <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2742"><span class="MJXp-msubsup" id="MJXp-Span-2743"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2744" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2745" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-2746" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-2747"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2748" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2749" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-2750" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-2751" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-2752" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-2753"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2754" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2755" style="vertical-align: -0.4em;">m</span></span></span></span><script type="math/tex" id="MathJax-Element-389">a_1, a_2, \dots, a_m</script>. Then, the operations can be described as follows:</p><ul> <li> Choose an index <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2756"><span class="MJXp-mn" id="MJXp-Span-2757">1</span><span class="MJXp-mo" id="MJXp-Span-2758" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2759">i</span><span class="MJXp-mo" id="MJXp-Span-2760" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mrow" id="MJXp-Span-2761"><span class="MJXp-mo" id="MJXp-Span-2762" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2763">a</span><span class="MJXp-mrow" id="MJXp-Span-2764"><span class="MJXp-mo" id="MJXp-Span-2765" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span></span></span><script type="math/tex" id="MathJax-Element-390">1 \leq i \leq |a|</script> such that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2766"><span class="MJXp-msubsup" id="MJXp-Span-2767"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2768" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2769" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-2770" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mn" id="MJXp-Span-2771">2</span></span></span><script type="math/tex" id="MathJax-Element-391">a_i \geq 2</script> and decrease <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2772"><span class="MJXp-msubsup" id="MJXp-Span-2773"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2774" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2775" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-392">a_i</script> by 1. </li><li> Choose an index <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2776"><span class="MJXp-mn" id="MJXp-Span-2777">2</span><span class="MJXp-mo" id="MJXp-Span-2778" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2779">i</span><span class="MJXp-mo" id="MJXp-Span-2780" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mrow" id="MJXp-Span-2781"><span class="MJXp-mo" id="MJXp-Span-2782" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2783">a</span><span class="MJXp-mrow" id="MJXp-Span-2784"><span class="MJXp-mo" id="MJXp-Span-2785" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span></span></span><script type="math/tex" id="MathJax-Element-393">2 \leq i < |a|</script> such that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2786"><span class="MJXp-msubsup" id="MJXp-Span-2787"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2788" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2789" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2790">i</span><span class="MJXp-mo" id="MJXp-Span-2791">−</span><span class="MJXp-mn" id="MJXp-Span-2792">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-2793" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-2794"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2795" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2796" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-2797" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-2798">1</span></span></span><script type="math/tex" id="MathJax-Element-394">a_{i-1} = a_i = 1</script>. Remove <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2799"><span class="MJXp-msubsup" id="MJXp-Span-2800"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2801" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2802" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2803">i</span><span class="MJXp-mo" id="MJXp-Span-2804">−</span><span class="MJXp-mn" id="MJXp-Span-2805">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-395">a_{i-1}</script>. If <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2806"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2807">i</span><span class="MJXp-mo" id="MJXp-Span-2808" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mn" id="MJXp-Span-2809">3</span></span></span><script type="math/tex" id="MathJax-Element-396">i \geq 3</script>, then merge <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2810"><span class="MJXp-msubsup" id="MJXp-Span-2811"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2812" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2813" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2814">i</span><span class="MJXp-mo" id="MJXp-Span-2815">−</span><span class="MJXp-mn" id="MJXp-Span-2816">2</span></span></span></span></span><script type="math/tex" id="MathJax-Element-397">a_{i-2}</script> with <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2817"><span class="MJXp-msubsup" id="MJXp-Span-2818"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2819" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2820" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-398">a_i</script> and remove <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2821"><span class="MJXp-msubsup" id="MJXp-Span-2822"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2823" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2824" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-399">a_i</script>. </li></ul><p>First handle the corner case when <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2825"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2826">m</span><span class="MJXp-mo" id="MJXp-Span-2827" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mn" id="MJXp-Span-2828">2</span></span></span><script type="math/tex" id="MathJax-Element-400">m \leq 2</script>. It can be observed that the length of the last segment never increases, and it is independent of the preceding segments. Thus, we only need to consider the strings that can be generated from <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2829"><span class="MJXp-msubsup" id="MJXp-Span-2830"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2831" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2832" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-2833" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-2834"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2835" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2836" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-2837" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-2838" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-2839" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-2840"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2841" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2842" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2843">m</span><span class="MJXp-mo" id="MJXp-Span-2844">−</span><span class="MJXp-mn" id="MJXp-Span-2845">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-401">a_1, a_2, \ldots, a_{m-1}</script>, and the final answer is multiplied by <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2846"><span class="MJXp-msubsup" id="MJXp-Span-2847"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2848" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2849" style="vertical-align: -0.4em;">m</span></span></span></span><script type="math/tex" id="MathJax-Element-402">a_m</script>.</p><p>Now, consider counting the strings that begin with the same character as <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2850"><span class="MJXp-msubsup" id="MJXp-Span-2851"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2852" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2853" style="vertical-align: -0.4em;">1</span></span></span></span><script type="math/tex" id="MathJax-Element-403">s_1</script>. For a generated sequence of contiguous segments <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2854"><span class="MJXp-msubsup" id="MJXp-Span-2855"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2856" style="margin-right: 0.05em;">b</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2857" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-2858" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-2859"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2860" style="margin-right: 0.05em;">b</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2861" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-2862" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-2863" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-2864" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-2865"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2866" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2867" style="vertical-align: -0.4em;">k</span></span></span></span><script type="math/tex" id="MathJax-Element-404">b_1, b_2, \dots, b_k</script>, we greedily find the shortest prefix in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2868"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2869">a</span></span></span><script type="math/tex" id="MathJax-Element-405">a</script> that can generate <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2870"><span class="MJXp-msubsup" id="MJXp-Span-2871"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2872" style="margin-right: 0.05em;">b</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2873" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-2874" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-2875"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2876" style="margin-right: 0.05em;">b</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2877" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-2878" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-2879" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-2880" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-2881"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2882" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2883" style="vertical-align: -0.4em;">k</span></span></span></span><script type="math/tex" id="MathJax-Element-406">b_1, b_2, \dots, b_k</script>.</p><p>Define <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2884"><span class="MJXp-msubsup" id="MJXp-Span-2885"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2886" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2887" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-407">f_i</script> as the number of strings that can match <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2888"><span class="MJXp-msubsup" id="MJXp-Span-2889"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2890" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2891" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-408">a_i</script>.</p><p>For the transition when adding a new segment <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2892"><span class="MJXp-msubsup" id="MJXp-Span-2893"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2894" style="margin-right: 0.05em;">b</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2895" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2896">k</span><span class="MJXp-mo" id="MJXp-Span-2897">+</span><span class="MJXp-mn" id="MJXp-Span-2898">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-409">b_{k+1}</script>, iterate over indices <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2899"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2900">j</span><span class="MJXp-mo" id="MJXp-Span-2901" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2902">i</span></span></span><script type="math/tex" id="MathJax-Element-410">j > i</script> such that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2903"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2904">j</span><span class="MJXp-mo" id="MJXp-Span-2905" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mn" id="MJXp-Span-2906">2</span><span class="MJXp-mo" id="MJXp-Span-2907" style="margin-left: 0.333em; margin-right: 0.333em;">≠</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2908">i</span><span class="MJXp-mo" id="MJXp-Span-2909" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mn" id="MJXp-Span-2910">2</span></span></span><script type="math/tex" id="MathJax-Element-411">j \bmod 2 \neq i \bmod 2</script>. Let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2911"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2912">x</span></span></span><script type="math/tex" id="MathJax-Element-412">x</script> be the maximum value of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2913"><span class="MJXp-msubsup" id="MJXp-Span-2914"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2915" style="margin-right: 0.05em;">b</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2916" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2917">k</span><span class="MJXp-mo" id="MJXp-Span-2918">+</span><span class="MJXp-mn" id="MJXp-Span-2919">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-413">b_{k+1}</script> that can be generated by the previous <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2920"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2921">j</span></span></span><script type="math/tex" id="MathJax-Element-414">j</script>. Then, the maximum value that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2922"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2923">j</span></span></span><script type="math/tex" id="MathJax-Element-415">j</script> can generate for <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2924"><span class="MJXp-msubsup" id="MJXp-Span-2925"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2926" style="margin-right: 0.05em;">b</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2927" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2928">k</span><span class="MJXp-mo" id="MJXp-Span-2929">+</span><span class="MJXp-mn" id="MJXp-Span-2930">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-416">b_{k+1}</script> is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2931"><span class="MJXp-mo" id="MJXp-Span-2932" style="margin-left: 0.333em; margin-right: 0.333em;">max</span><span class="MJXp-mo" id="MJXp-Span-2933" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2934">x</span><span class="MJXp-mo" id="MJXp-Span-2935" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-2936">1</span><span class="MJXp-mo" id="MJXp-Span-2937" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-2938"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2939" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2940" style="vertical-align: -0.4em;">j</span></span><span class="MJXp-mo" id="MJXp-Span-2941" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-417">\max(x+1, a_j)</script>. Thus, if <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2942"><span class="MJXp-msubsup" id="MJXp-Span-2943"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2944" style="margin-right: 0.05em;">b</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2945" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2946">k</span><span class="MJXp-mo" id="MJXp-Span-2947">+</span><span class="MJXp-mn" id="MJXp-Span-2948">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-418">b_{k+1}</script> is matched at position <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2949"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2950">j</span></span></span><script type="math/tex" id="MathJax-Element-419">j</script>, we have <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2951"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2952">x</span><span class="MJXp-mo" id="MJXp-Span-2953" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-msubsup" id="MJXp-Span-2954"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2955" style="margin-right: 0.05em;">b</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2956" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2957">k</span><span class="MJXp-mo" id="MJXp-Span-2958">+</span><span class="MJXp-mn" id="MJXp-Span-2959">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-2960" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mo" id="MJXp-Span-2961" style="margin-left: 0.333em; margin-right: 0.333em;">max</span><span class="MJXp-mo" id="MJXp-Span-2962" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2963">x</span><span class="MJXp-mo" id="MJXp-Span-2964" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-2965">1</span><span class="MJXp-mo" id="MJXp-Span-2966" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-2967"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2968" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2969" style="vertical-align: -0.4em;">j</span></span><span class="MJXp-mo" id="MJXp-Span-2970" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-420">x < b_{k+1} \leq \max(x+1, a_j)</script>, which gives <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2971"><span class="MJXp-mo" id="MJXp-Span-2972" style="margin-left: 0.333em; margin-right: 0.333em;">max</span><span class="MJXp-mo" id="MJXp-Span-2973" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2974">x</span><span class="MJXp-mo" id="MJXp-Span-2975" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-2976">1</span><span class="MJXp-mo" id="MJXp-Span-2977" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-2978"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2979" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2980" style="vertical-align: -0.4em;">j</span></span><span class="MJXp-mo" id="MJXp-Span-2981" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-2982" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2983">x</span></span></span><script type="math/tex" id="MathJax-Element-421">\max(x+1, a_j) - x</script> possible values for <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2984"><span class="MJXp-msubsup" id="MJXp-Span-2985"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2986" style="margin-right: 0.05em;">b</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2987" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2988">k</span><span class="MJXp-mo" id="MJXp-Span-2989">+</span><span class="MJXp-mn" id="MJXp-Span-2990">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-422">b_{k+1}</script>.</p><p>Thus, the transition is as follows:</p><pre class="lstlisting"><code class="prettyprint prettyprinted" style=""><span class="kwd">for</span><span class="pln"> i </span><span class="pun">:=</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> to m </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">:</span><br><span class="pln">    x </span><span class="pun">:=</span><span class="pln"> </span><span class="lit">0</span><br><span class="pln">    </span><span class="kwd">for</span><span class="pln"> j </span><span class="pun">:=</span><span class="pln"> i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> to m </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">:</span><br><span class="pln">        </span><span class="kwd">if</span><span class="pln"> j mod </span><span class="lit">2</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> i mod </span><span class="lit">2</span><span class="pun">:</span><br><span class="pln">            f</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">:=</span><span class="pln"> f</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> f</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">(</span><span class="pln">max</span><span class="pun">(</span><span class="pln">x </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">j</span><span class="pun">])</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> x</span><span class="pun">)</span><br><span class="pln">            x </span><span class="pun">:=</span><span class="pln"> max</span><span class="pun">(</span><span class="pln">x </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">j</span><span class="pun">])</span><br></code></pre><p>The initial values are given by <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2991"><span class="MJXp-msubsup" id="MJXp-Span-2992"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2993" style="margin-right: 0.05em;">f</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2994" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-2995" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-2996"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2997" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2998" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-2999" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi" id="MJXp-Span-3000">∀</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3001">i</span><span class="MJXp-mo" id="MJXp-Span-3002" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mn" id="MJXp-Span-3003">3</span><span class="MJXp-mo" id="MJXp-Span-3004" style="margin-left: 0.267em; margin-right: 0.267em;">∧</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3005">i</span><span class="MJXp-mo" id="MJXp-Span-3006" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mn" id="MJXp-Span-3007">2</span><span class="MJXp-mo" id="MJXp-Span-3008" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-3009">1</span><span class="MJXp-mo" id="MJXp-Span-3010" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-3011"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3012" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3013" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-3014" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-3015">1</span></span></span><script type="math/tex" id="MathJax-Element-423">f_1 = a_1, \forall i \geq 3 \land i \bmod 2 = 1, f_i = 1</script>. The final answer is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3016"><span class="MJXp-msubsup" id="MJXp-Span-3017"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3018" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3019" style="vertical-align: -0.4em;">m</span></span><span class="MJXp-mo" id="MJXp-Span-3020" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-munderover" id="MJXp-Span-3021"><span><span class="MJXp-over"><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-3027" style="margin-right: 0px; margin-left: 0px;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3028">m</span><span class="MJXp-mo" id="MJXp-Span-3029">−</span><span class="MJXp-mn" id="MJXp-Span-3030">1</span></span></span><span class=""><span class="MJXp-mo" id="MJXp-Span-3022" style="margin-left: 0.111em; margin-right: 0.167em;">∑</span></span></span></span><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-3023" style="margin-left: 0px;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3024">i</span><span class="MJXp-mo" id="MJXp-Span-3025">=</span><span class="MJXp-mn" id="MJXp-Span-3026">1</span></span></span></span><span class="MJXp-mo" id="MJXp-Span-3031" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mo" id="MJXp-Span-3032" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3033">m</span><span class="MJXp-mo" id="MJXp-Span-3034" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3035">i</span><span class="MJXp-mo" id="MJXp-Span-3036" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-3037" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mn" id="MJXp-Span-3038">2</span><span class="MJXp-mo" id="MJXp-Span-3039" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-3040">1</span><span class="MJXp-mo" id="MJXp-Span-3041" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-msubsup" id="MJXp-Span-3042"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3043" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3044" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-424">a_m \cdot \sum\limits_{i = 1}^{m - 1} [(m - i) \bmod 2 = 1] f_i</script>.</p><p>Next, consider counting the strings whose first character is different from <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3045"><span class="MJXp-msubsup" id="MJXp-Span-3046"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3047" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3048" style="vertical-align: -0.4em;">1</span></span></span></span><script type="math/tex" id="MathJax-Element-425">s_1</script>. It turns out that if the resulting string starts with a different character, then in order to delete the first contiguous segment, the second segment can be at most of length <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3049"><span class="MJXp-mn" id="MJXp-Span-3050">1</span></span></span><script type="math/tex" id="MathJax-Element-426">1</script>. Therefore, after removing <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3051"><span class="MJXp-msubsup" id="MJXp-Span-3052"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3053" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3054" style="vertical-align: -0.4em;">1</span></span></span></span><script type="math/tex" id="MathJax-Element-427">a_1</script> and setting <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3055"><span class="MJXp-msubsup" id="MJXp-Span-3056"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3057" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3058" style="vertical-align: -0.4em;">2</span></span></span></span><script type="math/tex" id="MathJax-Element-428">a_2</script> to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3059"><span class="MJXp-mn" id="MJXp-Span-3060">1</span></span></span><script type="math/tex" id="MathJax-Element-429">1</script>, we can repeat the above process.</p><p>Next, we optimize the above <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3061"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3062">O</span><span class="MJXp-mo" id="MJXp-Span-3063" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-3064"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3065" style="margin-right: 0.05em;">m</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3066" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-3067" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-430">O(m^2)</script> DP.</p><p>Define <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3068"><span class="MJXp-msubsup" id="MJXp-Span-3069"><span class="MJXp-mtext" id="MJXp-Span-3070" style="margin-right: 0.05em;">nxt</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3071" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-431">\text{nxt}_i</script> as the smallest <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3072"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3073">j</span></span></span><script type="math/tex" id="MathJax-Element-432">j</script> such that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3074"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3075">j</span><span class="MJXp-mo" id="MJXp-Span-3076" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mn" id="MJXp-Span-3077">2</span><span class="MJXp-mo" id="MJXp-Span-3078" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3079">i</span><span class="MJXp-mo" id="MJXp-Span-3080" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mn" id="MJXp-Span-3081">2</span><span class="MJXp-mo" id="MJXp-Span-3082" style="margin-left: 0.267em; margin-right: 0.267em;">∧</span><span class="MJXp-msubsup" id="MJXp-Span-3083"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3084" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3085" style="vertical-align: -0.4em;">j</span></span><span class="MJXp-mo" id="MJXp-Span-3086" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mfrac" id="MJXp-Span-3087" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3088">j</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mn" id="MJXp-Span-3089">2</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-3090" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-msubsup" id="MJXp-Span-3091"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3092" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3093" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-3094" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mfrac" id="MJXp-Span-3095" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3096">i</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mn" id="MJXp-Span-3097">2</span></span></span></span></span></span></span></span><script type="math/tex" id="MathJax-Element-433">j \bmod 2 = i \bmod 2 \land a_j - \frac{j}{2} > a_i - \frac{i}{2}</script>.</p><p>For a given <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3098"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3099">i</span></span></span><script type="math/tex" id="MathJax-Element-434">i</script>, the transition works as follows:</p><ul> <li> Maintain a variable <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3100"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3101">j</span></span></span><script type="math/tex" id="MathJax-Element-435">j</script> initialized as <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3102"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3103">j</span><span class="MJXp-mo" id="MJXp-Span-3104" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3105">i</span><span class="MJXp-mo" id="MJXp-Span-3106" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-3107">1</span></span></span><script type="math/tex" id="MathJax-Element-436">j = i + 1</script>. </li><li> Perform a special transition at <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3108"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3109">j</span></span></span><script type="math/tex" id="MathJax-Element-437">j</script>. </li><li> For <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3110"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3111">j</span><span class="MJXp-mo" id="MJXp-Span-3112" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-3113">2</span><span class="MJXp-mo" id="MJXp-Span-3114" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3115">k</span><span class="MJXp-mo" id="MJXp-Span-3116" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-msubsup" id="MJXp-Span-3117"><span class="MJXp-mtext" id="MJXp-Span-3118" style="margin-right: 0.05em;">nxt</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3119" style="vertical-align: -0.4em;">j</span></span></span></span><script type="math/tex" id="MathJax-Element-438">j + 2 \leq k < \text{nxt}_j</script> such that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3120"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3121">k</span><span class="MJXp-mo" id="MJXp-Span-3122" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mn" id="MJXp-Span-3123">2</span><span class="MJXp-mo" id="MJXp-Span-3124" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3125">j</span><span class="MJXp-mo" id="MJXp-Span-3126" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mn" id="MJXp-Span-3127">2</span></span></span><script type="math/tex" id="MathJax-Element-439">k \bmod 2 = j \bmod 2</script>, update <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3128"><span class="MJXp-msubsup" id="MJXp-Span-3129"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3130" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3131" style="vertical-align: -0.4em;">k</span></span></span></span><script type="math/tex" id="MathJax-Element-440">f_k</script> by adding <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3132"><span class="MJXp-msubsup" id="MJXp-Span-3133"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3134" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3135" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-441">f_i</script> (which can be implemented using a difference array). </li><li> Set <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3136"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3137">j</span><span class="MJXp-mo" id="MJXp-Span-3138" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-3139"><span class="MJXp-mtext" id="MJXp-Span-3140" style="margin-right: 0.05em;">nxt</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3141" style="vertical-align: -0.4em;">j</span></span></span></span><script type="math/tex" id="MathJax-Element-442">j = \text{nxt}_j</script> and repeat the process. </li></ul><p>By directly simulating the transition process, it can be shown that the complexity is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3142"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3143">O</span><span class="MJXp-mrow" id="MJXp-Span-3144"><span class="MJXp-mo" id="MJXp-Span-3145" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.244em;"><span class="MJXp-right MJXp-scale7" style="font-size: 1.978em; margin-left: -0.05em;">(</span></span><span class="MJXp-mo" id="MJXp-Span-3146" style="margin-left: 0.111em; margin-right: 0.167em;">∑</span><span class="MJXp-msubsup" id="MJXp-Span-3147"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3148" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3149" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-3150" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.244em;"><span class="MJXp-right MJXp-scale7" style="font-size: 1.978em; margin-left: -0.05em;">)</span></span></span><span class="MJXp-mo" id="MJXp-Span-3151" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3152">O</span><span class="MJXp-mo" id="MJXp-Span-3153" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3154">n</span><span class="MJXp-mo" id="MJXp-Span-3155" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-443">O\left(\sum a_i\right) = O(n)</script>, since each <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3156"><span class="MJXp-msubsup" id="MJXp-Span-3157"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3158" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3159" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-444">a_i</script> is only jumped to at most <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3160"><span class="MJXp-msubsup" id="MJXp-Span-3161"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3162" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3163" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-445">a_i</script> times.</p><p>We can further optimize the DP process to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3164"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3165">O</span><span class="MJXp-mo" id="MJXp-Span-3166" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3167">m</span><span class="MJXp-mo" id="MJXp-Span-3168" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-446">O(m)</script>. Define <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3169"><span class="MJXp-msubsup" id="MJXp-Span-3170"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3171" style="margin-right: 0.05em;">g</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3172" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-447">g_i</script> as the sum of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3173"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3174">f</span></span></span><script type="math/tex" id="MathJax-Element-448">f</script>-values of all positions that can jump to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3175"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3176">i</span></span></span><script type="math/tex" id="MathJax-Element-449">i</script>. Then, the transition is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3177"><span class="MJXp-msubsup" id="MJXp-Span-3178"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3179" style="margin-right: 0.05em;">g</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-3180" style="vertical-align: -0.4em;"><span class="MJXp-msubsup" id="MJXp-Span-3181"><span class="MJXp-mtext" id="MJXp-Span-3182" style="margin-right: 0.05em;">nxt</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3183" style="vertical-align: -0.4em;">i</span></span></span></span><span class="MJXp-mo" id="MJXp-Span-3184" style="margin-left: 0.333em; margin-right: 0.333em;">←</span><span class="MJXp-msubsup" id="MJXp-Span-3185"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3186" style="margin-right: 0.05em;">g</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-3187" style="vertical-align: -0.4em;"><span class="MJXp-msubsup" id="MJXp-Span-3188"><span class="MJXp-mtext" id="MJXp-Span-3189" style="margin-right: 0.05em;">nxt</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3190" style="vertical-align: -0.4em;">i</span></span></span></span><span class="MJXp-mo" id="MJXp-Span-3191" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-3192"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3193" style="margin-right: 0.05em;">g</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3194" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-450">g_{\text{nxt}_i} \gets g_{\text{nxt}_i} + g_i</script>. Additionally, for <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3195"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3196">i</span><span class="MJXp-mo" id="MJXp-Span-3197" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-3198">2</span><span class="MJXp-mo" id="MJXp-Span-3199" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3200">k</span><span class="MJXp-mo" id="MJXp-Span-3201" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-msubsup" id="MJXp-Span-3202"><span class="MJXp-mtext" id="MJXp-Span-3203" style="margin-right: 0.05em;">nxt</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3204" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-451">i + 2 \leq k < \text{nxt}_i</script> such that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3205"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3206">k</span><span class="MJXp-mo" id="MJXp-Span-3207" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mn" id="MJXp-Span-3208">2</span><span class="MJXp-mo" id="MJXp-Span-3209" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3210">i</span><span class="MJXp-mo" id="MJXp-Span-3211" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mn" id="MJXp-Span-3212">2</span></span></span><script type="math/tex" id="MathJax-Element-452">k \bmod 2 = i \bmod 2</script>, update <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3213"><span class="MJXp-msubsup" id="MJXp-Span-3214"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3215" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3216" style="vertical-align: -0.4em;">k</span></span></span></span><script type="math/tex" id="MathJax-Element-453">f_k</script> by adding <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3217"><span class="MJXp-msubsup" id="MJXp-Span-3218"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3219" style="margin-right: 0.05em;">g</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3220" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-454">g_i</script>, and then perform a special transition for <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3221"><span class="MJXp-msubsup" id="MJXp-Span-3222"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3223" style="margin-right: 0.05em;">f</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-3224" style="vertical-align: -0.4em;"><span class="MJXp-msubsup" id="MJXp-Span-3225"><span class="MJXp-mtext" id="MJXp-Span-3226" style="margin-right: 0.05em;">nxt</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3227" style="vertical-align: -0.4em;">i</span></span></span></span></span></span><script type="math/tex" id="MathJax-Element-455">f_{\text{nxt}_i}</script>.</p><p><span class="tex-font-style-bf">Time complexity</span>: <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3228"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3229">O</span><span class="MJXp-mo" id="MJXp-Span-3230" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3231">n</span><span class="MJXp-mo" id="MJXp-Span-3232" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-456">O(n)</script> per test case.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Implementation 1</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">typedef</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> ll</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> maxn </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2000100</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">const</span><span class="pln"> ll mod </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1000000007</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">maxn</span><span class="pun">],</span><span class="pln"> m</span><span class="pun">,</span><span class="pln"> nxt</span><span class="pun">[</span><span class="pln">maxn</span><span class="pun">],</span><span class="pln"> stk</span><span class="pun">[</span><span class="pln">maxn</span><span class="pun">],</span><span class="pln"> top</span><span class="pun">;</span><span class="pln">
ll f</span><span class="pun">[</span><span class="pln">maxn</span><span class="pun">],</span><span class="pln"> d</span><span class="pun">[</span><span class="pln">maxn</span><span class="pun">];</span><span class="pln">
</span><span class="kwd">char</span><span class="pln"> s</span><span class="pun">[</span><span class="pln">maxn</span><span class="pun">];</span><span class="pln">

</span><span class="kwd">inline</span><span class="pln"> ll calc</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	top </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> m</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">-=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">top </span><span class="pun">&amp;&amp;</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">stk</span><span class="pun">[</span><span class="pln">top</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> stk</span><span class="pun">[</span><span class="pln">top</span><span class="pun">]</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> i </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="pun">--</span><span class="pln">top</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		nxt</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> stk</span><span class="pun">[</span><span class="pln">top</span><span class="pun">];</span><span class="pln">
		stk</span><span class="pun">[++</span><span class="pln">top</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> i</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	top </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> m </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">-=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">top </span><span class="pun">&amp;&amp;</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">stk</span><span class="pun">[</span><span class="pln">top</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> stk</span><span class="pun">[</span><span class="pln">top</span><span class="pun">]</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> i </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="pun">--</span><span class="pln">top</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		nxt</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> stk</span><span class="pun">[</span><span class="pln">top</span><span class="pun">];</span><span class="pln">
		stk</span><span class="pun">[++</span><span class="pln">top</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> i</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> m</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		f</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> d</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	f</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">[</span><span class="lit">1</span><span class="pun">];</span><span class="pln">
	</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">3</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> m</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">+=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		f</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	ll ans </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> m</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">3</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			d</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">d</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> d</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">2</span><span class="pun">])</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> mod</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		f</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">f</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> d</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> mod</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> x </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">j </span><span class="pun">&lt;</span><span class="pln"> m</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">int</span><span class="pln"> k </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">nxt</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> nxt</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> m</span><span class="pun">);</span><span class="pln">
			f</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">f</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> f</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> x</span><span class="pun">))</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> mod</span><span class="pun">;</span><span class="pln">
			x </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="pun">(</span><span class="pln">k </span><span class="pun">-</span><span class="pln"> j</span><span class="pun">)</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
			d</span><span class="pun">[</span><span class="pln">j </span><span class="pun">+</span><span class="pln"> </span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">d</span><span class="pun">[</span><span class="pln">j </span><span class="pun">+</span><span class="pln"> </span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> f</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> mod</span><span class="pun">;</span><span class="pln">
			d</span><span class="pun">[</span><span class="pln">k</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">d</span><span class="pun">[</span><span class="pln">k</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> f</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> mod</span><span class="pun">)</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> mod</span><span class="pun">;</span><span class="pln">
			j </span><span class="pun">=</span><span class="pln"> k</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">((</span><span class="pln">m </span><span class="pun">-</span><span class="pln"> i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			ans </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">ans </span><span class="pun">+</span><span class="pln"> f</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> mod</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	</span><span class="kwd">return</span><span class="pln"> ans </span><span class="pun">*</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">m</span><span class="pun">]</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> mod</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">void</span><span class="pln"> solve</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n </span><span class="pun">&gt;&gt;</span><span class="pln"> s</span><span class="pun">;</span><span class="pln">
	m </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(++</span><span class="pln">j</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">j </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> n </span><span class="pun">&amp;&amp;</span><span class="pln"> s</span><span class="pun">[</span><span class="pln">j </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> s</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="pun">++</span><span class="pln">j</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		a</span><span class="pun">[++</span><span class="pln">m</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> j </span><span class="pun">-</span><span class="pln"> i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">m </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		cout </span><span class="pun">&lt;&lt;</span><span class="pln"> n </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">return</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">m </span><span class="pun">==</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">1LL</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> a</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> a</span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> mod </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">return</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	ll ans </span><span class="pun">=</span><span class="pln"> calc</span><span class="pun">();</span><span class="pln">
	</span><span class="pun">--</span><span class="pln">m</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> m</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">];</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	a</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
	ans </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">ans </span><span class="pun">+</span><span class="pln"> calc</span><span class="pun">())</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> mod</span><span class="pun">;</span><span class="pln">
	cout </span><span class="pun">&lt;&lt;</span><span class="pln"> ans </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	ios</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
	cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
	</span><span class="kwd">int</span><span class="pln"> T</span><span class="pun">;</span><span class="pln">
	cin </span><span class="pun">&gt;&gt;</span><span class="pln"> T</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">T</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		solve</span><span class="pun">();</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	</span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div> <div class="spoiler"><b class="spoiler-title">Implementation 2</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">typedef</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> ll</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> maxn </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2000100</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">const</span><span class="pln"> ll mod </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1000000007</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">maxn</span><span class="pun">],</span><span class="pln"> m</span><span class="pun">,</span><span class="pln"> nxt</span><span class="pun">[</span><span class="pln">maxn</span><span class="pun">],</span><span class="pln"> stk</span><span class="pun">[</span><span class="pln">maxn</span><span class="pun">],</span><span class="pln"> top</span><span class="pun">;</span><span class="pln">
ll f</span><span class="pun">[</span><span class="pln">maxn</span><span class="pun">],</span><span class="pln"> g</span><span class="pun">[</span><span class="pln">maxn</span><span class="pun">],</span><span class="pln"> d</span><span class="pun">[</span><span class="pln">maxn</span><span class="pun">];</span><span class="pln">
</span><span class="kwd">char</span><span class="pln"> s</span><span class="pun">[</span><span class="pln">maxn</span><span class="pun">];</span><span class="pln">

</span><span class="kwd">inline</span><span class="pln"> ll calc</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	top </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> m</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">-=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">top </span><span class="pun">&amp;&amp;</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">stk</span><span class="pun">[</span><span class="pln">top</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> stk</span><span class="pun">[</span><span class="pln">top</span><span class="pun">]</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> i </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="pun">--</span><span class="pln">top</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		nxt</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> stk</span><span class="pun">[</span><span class="pln">top</span><span class="pun">];</span><span class="pln">
		stk</span><span class="pun">[++</span><span class="pln">top</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> i</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	top </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> m </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">-=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">top </span><span class="pun">&amp;&amp;</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">stk</span><span class="pun">[</span><span class="pln">top</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> stk</span><span class="pun">[</span><span class="pln">top</span><span class="pun">]</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> i </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="pun">--</span><span class="pln">top</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		nxt</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> stk</span><span class="pun">[</span><span class="pln">top</span><span class="pun">];</span><span class="pln">
		stk</span><span class="pun">[++</span><span class="pln">top</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> i</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> m</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		f</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> g</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> d</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	f</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">[</span><span class="lit">1</span><span class="pun">];</span><span class="pln">
	</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">3</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> m</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">+=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		f</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	ll ans </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> m</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">3</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			d</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">d</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> d</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">2</span><span class="pun">])</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> mod</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		f</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">f</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> d</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> mod</span><span class="pun">;</span><span class="pln">
		g</span><span class="pun">[</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">g</span><span class="pun">[</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> f</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> mod</span><span class="pun">;</span><span class="pln">
		f</span><span class="pun">[</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">f</span><span class="pun">[</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> f</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">])</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> mod</span><span class="pun">;</span><span class="pln">
		d</span><span class="pun">[</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">d</span><span class="pun">[</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> g</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> mod</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">nxt</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			g</span><span class="pun">[</span><span class="pln">nxt</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">g</span><span class="pun">[</span><span class="pln">nxt</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> g</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> mod</span><span class="pun">;</span><span class="pln">
			f</span><span class="pun">[</span><span class="pln">nxt</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">f</span><span class="pun">[</span><span class="pln">nxt</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> g</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">nxt</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">(</span><span class="pln">nxt</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">))</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> mod</span><span class="pun">;</span><span class="pln">
			d</span><span class="pun">[</span><span class="pln">nxt</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">d</span><span class="pun">[</span><span class="pln">nxt</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> g</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> mod</span><span class="pun">)</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> mod</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">((</span><span class="pln">m </span><span class="pun">-</span><span class="pln"> i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			ans </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">ans </span><span class="pun">+</span><span class="pln"> f</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> mod</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	</span><span class="kwd">return</span><span class="pln"> ans </span><span class="pun">*</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">m</span><span class="pun">]</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> mod</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">void</span><span class="pln"> solve</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n </span><span class="pun">&gt;&gt;</span><span class="pln"> s</span><span class="pun">;</span><span class="pln">
	m </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(++</span><span class="pln">j</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">j </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> n </span><span class="pun">&amp;&amp;</span><span class="pln"> s</span><span class="pun">[</span><span class="pln">j </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> s</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="pun">++</span><span class="pln">j</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		a</span><span class="pun">[++</span><span class="pln">m</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> j </span><span class="pun">-</span><span class="pln"> i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">m </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		cout </span><span class="pun">&lt;&lt;</span><span class="pln"> n </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">return</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">m </span><span class="pun">==</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">1LL</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> a</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> a</span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> mod </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">return</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	ll ans </span><span class="pun">=</span><span class="pln"> calc</span><span class="pun">();</span><span class="pln">
	</span><span class="pun">--</span><span class="pln">m</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> m</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">];</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	a</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
	ans </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">ans </span><span class="pun">+</span><span class="pln"> calc</span><span class="pun">())</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> mod</span><span class="pun">;</span><span class="pln">
	cout </span><span class="pun">&lt;&lt;</span><span class="pln"> ans </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	ios</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
	cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
	</span><span class="kwd">int</span><span class="pln"> T</span><span class="pun">;</span><span class="pln">
	cin </span><span class="pun">&gt;&gt;</span><span class="pln"> T</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">T</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		solve</span><span class="pun">();</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	</span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div></div>

    </div>


        <div style="font-size: 1.1rem;line-height: 1.1rem;padding-bottom: 0.5em;">
            <img src="https://codeforces.com//codeforces.com/codeforces.org/s/52448/images/icons/paperclip-16x16.png" style="vertical-align: middle;"> <span style="padding: 0 0.35em;">Tutorial of <a href="https://codeforces.com/contest/2084" class="notice" style="text-decoration: none;">Teza Round 1 (Codeforces Round 1015, Div. 1 + Div. 2)</a> </span>
        </div>
        
            

  <script>
    // Make all spoilers toggleable
    document.querySelectorAll('.spoiler-title').forEach(title => {
      title.addEventListener('click', function() {
        const spoiler = this.closest('.spoiler');
        spoiler.classList.toggle('open');
      });
    });
    
    // Open all spoilers by default for easier reading
    document.querySelectorAll('.spoiler').forEach(spoiler => {
      spoiler.classList.add('open');
    });
  </script>
</body>
</html>