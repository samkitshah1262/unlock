<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tutorial</title>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
      line-height: 1.6;
      color: #333;
      background: #fafafa;
    }
    .ttypography {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    h3 {
      color: #1a1a1a;
      border-bottom: 2px solid #eee;
      padding-bottom: 10px;
    }
    h3 a {
      color: #0066cc;
      text-decoration: none;
    }
    h3 a:hover {
      text-decoration: underline;
    }
    .spoiler {
      margin: 15px 0;
      border: 1px solid #ddd;
      border-radius: 6px;
      overflow: hidden;
    }
    .spoiler-title {
      display: block;
      padding: 12px 15px;
      background: #f0f0f0;
      cursor: pointer;
      font-weight: 600;
      user-select: none;
      border-bottom: 1px solid #ddd;
    }
    .spoiler-title:hover {
      background: #e8e8e8;
    }
    .spoiler-title::before {
      content: '▶ ';
      font-size: 0.8em;
      transition: transform 0.2s;
      display: inline-block;
    }
    .spoiler.open .spoiler-title::before {
      content: '▼ ';
    }
    .spoiler-content {
      padding: 15px;
      background: #fff;
      display: none;
    }
    .spoiler.open .spoiler-content {
      display: block;
    }
    pre, code {
      background: #f5f5f5;
      font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
      font-size: 0.85em;
    }
    pre {
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
    }
    code {
      padding: 2px 5px;
      border-radius: 3px;
    }
    p {
      margin: 10px 0;
    }
    .MathJax {
      font-size: 1.1em;
    }
  </style>
</head>
<body>
  <h1>Editorial</h1>
  <p><a href="https://codeforces.com/blog/entry/147164" target="_blank">View on Codeforces →</a></p>
  
  <div class="ttypography"><p><a href="https://codeforces.com/contest/2145/problem/A" title="Educational Codeforces Round 183 (Rated for Div. 2)">2145A - Candies for Nephews</a></p><p>Idea: <a class="rated-user user-violet" href="https://codeforces.com/profile/fcspartakm" title="Candidate Master fcspartakm">fcspartakm</a></p> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2145/problem/A" title="Educational Codeforces Round 183 (Rated for Div. 2)">2145A - Candies for Nephews</a></h3><div class="ttypography"><div class="problem-statement"><div><p>The problem asks you to find the minimum $$$x$$$ such that $$$n + x$$$ is divisible by $$$3$$$. You can do it in one of two following ways:</p><ul> <li> write a while-loop that increases $$$n$$$ and adds $$$1$$$ to the answer until $$$n$$$ becomes divisible by $$$3$$$; </li><li> or using the remainder of $$$n$$$ modulo $$$3$$$: if $$$n \bmod 3 = 0$$$, then $$$n$$$ is already divisible by $$$3$$$, otherwise you have to add exactly $$$3 - n \bmod 3$$$ to $$$n$$$ so that the remainder becomes equal to $$$0$$$. </li></ul></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Solution (fcspartakm)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pln"> </span><span class="str">&lt;iostream&gt;</span><span class="pln">
 
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
        cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
        cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="pun">(</span><span class="lit">3</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> n </span><span class="pun">%</span><span class="pln"> </span><span class="lit">3</span><span class="pun">)</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> endl</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2145/problem/B" title="Educational Codeforces Round 183 (Rated for Div. 2)">2145B - Deck of Cards</a></p><p>Idea: <a class="rated-user user-red" href="https://codeforces.com/profile/BledDest" title="International Grandmaster BledDest">BledDest</a></p> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2145/problem/B" title="Educational Codeforces Round 183 (Rated for Div. 2)">2145B - Deck of Cards</a></h3><div class="ttypography"><div class="problem-statement"><div><p>Note that the order of operations does not affect the remaining cards, because the remaining cards depend only on the number of cards Monocarp removed from the top and from the bottom. Therefore, we only care about the number of operations of each type (let's call them $$$a$$$, $$$b$$$ and $$$c$$$, respectively). The first $$$a$$$ and last $$$b$$$ cards will always be removed from the deck. Among the remaining cards, only the first $$$c$$$ can be deleted (if for all operations of the second type Monocarp deleted the first card) and the last $$$c$$$ (if for all operations of the second type Monocarp deleted the last card). All other cards will never be deleted. It's also important to consider the case when $$$k=n$$$, then all cards will be deleted. </p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Solution (Neon)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
 
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
  cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">t</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> k</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">string</span><span class="pln"> s</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n </span><span class="pun">&gt;&gt;</span><span class="pln"> k </span><span class="pun">&gt;&gt;</span><span class="pln"> s</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> a </span><span class="pun">=</span><span class="pln"> count</span><span class="pun">(</span><span class="pln">s</span><span class="pun">.</span><span class="kwd">begin</span><span class="pun">(),</span><span class="pln"> s</span><span class="pun">.</span><span class="kwd">end</span><span class="pun">(),</span><span class="pln"> </span><span class="str">'0'</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> b </span><span class="pun">=</span><span class="pln"> count</span><span class="pun">(</span><span class="pln">s</span><span class="pun">.</span><span class="kwd">begin</span><span class="pun">(),</span><span class="pln"> s</span><span class="pun">.</span><span class="kwd">end</span><span class="pun">(),</span><span class="pln"> </span><span class="str">'1'</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> c </span><span class="pun">=</span><span class="pln"> count</span><span class="pun">(</span><span class="pln">s</span><span class="pun">.</span><span class="kwd">begin</span><span class="pun">(),</span><span class="pln"> s</span><span class="pun">.</span><span class="kwd">end</span><span class="pun">(),</span><span class="pln"> </span><span class="str">'2'</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">string</span><span class="pln"> ans</span><span class="pun">(</span><span class="pln">n</span><span class="pun">,</span><span class="pln"> </span><span class="str">'+'</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="pun">&lt;</span><span class="pln"> a </span><span class="pun">+</span><span class="pln"> c </span><span class="pun">||</span><span class="pln"> i </span><span class="pun">&gt;=</span><span class="pln"> n </span><span class="pun">-</span><span class="pln"> b </span><span class="pun">-</span><span class="pln"> c</span><span class="pun">)</span><span class="pln"> ans</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'?'</span><span class="pun">;</span><span class="pln">
      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="pun">&lt;</span><span class="pln"> a </span><span class="pun">||</span><span class="pln"> i </span><span class="pun">&gt;=</span><span class="pln"> n </span><span class="pun">-</span><span class="pln"> b </span><span class="pun">||</span><span class="pln"> k </span><span class="pun">==</span><span class="pln"> n</span><span class="pun">)</span><span class="pln"> ans</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'-'</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    cout </span><span class="pun">&lt;&lt;</span><span class="pln"> ans </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2145/problem/C" title="Educational Codeforces Round 183 (Rated for Div. 2)">2145C - Monocarp's String</a></p><p>Idea: <a class="rated-user user-violet" href="https://codeforces.com/profile/fcspartakm" title="Candidate Master fcspartakm">fcspartakm</a></p> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2145/problem/C" title="Educational Codeforces Round 183 (Rated for Div. 2)">2145C - Monocarp's String</a></h3><div class="ttypography"><div class="problem-statement"><div><p>Let's construct the following array from the given string: replace the letter 'a' with $$$1$$$ and the letter 'b' with $$$-1$$$. Then we can say that the number of letters 'a' and 'b' is the same if the sum of the array is equal to $$$0$$$.</p><p>Calculate the current sum of the array $$$s$$$. To make the sum equal to $$$0$$$, you have to remove a segment with sum $$$s$$$.</p><p>Thus, the problem reduces to finding the shortest segment with sum $$$s$$$. This classic problem can be solved using prefix sums. Iterate over the right border of the segment and for each of them find the shortest segment with sum $$$s$$$ that ends there. So, we need to find the largest $$$l$$$ such that $$$l \le r$$$ and $$$\mathit{pref}_{r+1} - \mathit{pref}_l = s$$$. That is, $$$\mathit{pref}_l = \mathit{pref}_{r+1} - s$$$. If we go from left to right, we can maintain the largest position for each prefix sum value.</p><p>This can be stored in a structure like a map or in an array, if you notice that prefix sums can take values from $$$-n$$$ to $$$n$$$. So, we can allocate an array of size $$$2n + 1$$$ and record information about the prefix sum $$$x$$$ at position $$$x + n$$$ to avoid negative indices.</p><p>Overall complexity: $$$O(n)$$$ or $$$O(n \log n)$$$ per test case.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Solution (BledDest)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
 
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
 
</span><span class="com">#define</span><span class="pln"> </span><span class="kwd">forn</span><span class="pun">(</span><span class="pln">i</span><span class="pun">,</span><span class="pln"> n</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">(</span><span class="pln">n</span><span class="pun">);</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> 
 
</span><span class="kwd">void</span><span class="pln"> solve</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                    
    </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">string</span><span class="pln"> s</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n </span><span class="pun">&gt;&gt;</span><span class="pln"> s</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> cur </span><span class="pun">=</span><span class="pln"> count</span><span class="pun">(</span><span class="pln">s</span><span class="pun">.</span><span class="kwd">begin</span><span class="pun">(),</span><span class="pln"> s</span><span class="pun">.</span><span class="kwd">end</span><span class="pun">(),</span><span class="pln"> </span><span class="str">'a'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> count</span><span class="pun">(</span><span class="pln">s</span><span class="pun">.</span><span class="kwd">begin</span><span class="pun">(),</span><span class="pln"> s</span><span class="pun">.</span><span class="kwd">end</span><span class="pun">(),</span><span class="pln"> </span><span class="str">'b'</span><span class="pun">);</span><span class="pln">
    map</span><span class="pun">&lt;</span><span class="kwd">int</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">&gt;</span><span class="pln"> lst</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> pr </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    lst</span><span class="pun">[</span><span class="pln">pr</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> ans </span><span class="pun">=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">forn</span><span class="pun">(</span><span class="pln">i</span><span class="pun">,</span><span class="pln"> n</span><span class="pun">){</span><span class="pln">
        pr </span><span class="pun">+=</span><span class="pln"> s</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'a'</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">;</span><span class="pln">
        lst</span><span class="pun">[</span><span class="pln">pr</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> i</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">lst</span><span class="pun">.</span><span class="pln">count</span><span class="pun">(</span><span class="pln">pr </span><span class="pun">-</span><span class="pln"> cur</span><span class="pun">))</span><span class="pln">
            ans </span><span class="pun">=</span><span class="pln"> min</span><span class="pun">(</span><span class="pln">ans</span><span class="pun">,</span><span class="pln"> i </span><span class="pun">-</span><span class="pln"> lst</span><span class="pun">[</span><span class="pln">pr </span><span class="pun">-</span><span class="pln"> cur</span><span class="pun">]);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="pun">(</span><span class="pln">ans </span><span class="pun">==</span><span class="pln"> n </span><span class="pun">?</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> ans</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    ios_base</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">forn</span><span class="pun">(</span><span class="pln">i</span><span class="pun">,</span><span class="pln"> t</span><span class="pun">)</span><span class="pln"> solve</span><span class="pun">();</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2145/problem/D" title="Educational Codeforces Round 183 (Rated for Div. 2)">2145D - Inversion Value of a Permutation</a></p><p>Idea: <a class="rated-user user-red" href="https://codeforces.com/profile/BledDest" title="International Grandmaster BledDest">BledDest</a></p> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2145/problem/D" title="Educational Codeforces Round 183 (Rated for Div. 2)">2145D - Inversion Value of a Permutation</a></h3><div class="ttypography"><div class="problem-statement"><div><p>Instead of maintaining the number of subsegments in a permutation that contain at least one inversion, we will learn to construct a permutation with a given number of subsegments that <span class="tex-font-style-bf">do not</span> contain inversions: we need a permutation of length $$$n$$$ in which exactly $$$\dfrac{n \cdot (n-1)}{2} - k$$$ subsegments of length greater than $$$2$$$ do not contain inversions.</p><p>What does it mean for a subsegment of a permutation to not contain inversions? It means that it is sorted, i.e., for every pair of adjacent elements $$$i$$$ and $$$i+1$$$ belonging to this segment, the condition $$$p_i &lt; p_{i+1}$$$ holds. Conversely, if a subsegment is not sorted, there will be a pair of adjacent elements $$$i$$$ and $$$i+1$$$ belonging to the segment such that $$$p_i &gt; p_{i+1}$$$. This means that the number of subsegments without inversions actually depends only on pairs of positions where $$$p_i &gt; p_{i+1}$$$.</p><p>We can attempt to construct the desired permutation using the following dynamic programming approach: $$$dp_{i,j}$$$ represents whether there exists a permutation of $$$i$$$ elements with exactly $$$j$$$ subsegments without inversions. The transitions in this dynamic programming can be recalculated as follows: if there exists a permutation of $$$i$$$ elements with exactly $$$j$$$ subsegments without inversions, we can iterate over $$$k$$$ — the length of the next sorted block — and transition to $$$dp_{i+k, j+\frac{k(k-1)}{2}}$$$. This dynamic programming will have $$$O(n^3)$$$ states, and there will be $$$O(n)$$$ transitions from each state.</p><p>Using this dynamic programming, we can reconstruct the partition of the permutation into sorted blocks, but after that, we need to construct the permutation itself with the given lengths of the sorted blocks. For this, we can place several maximum numbers in increasing order in the first sorted block, several of the next maximum numbers in the next block, and so on. This way, we will ensure that each pair of elements from different blocks forms an inversion.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Solution (BledDest)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="pln">t </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">(</span><span class="pln">input</span><span class="pun">())</span><span class="pln">
</span><span class="kwd">for</span><span class="pln"> i </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="pln">t</span><span class="pun">):</span><span class="pln">
    n</span><span class="pun">,</span><span class="pln"> k </span><span class="pun">=</span><span class="pln"> map</span><span class="pun">(</span><span class="kwd">int</span><span class="pun">,</span><span class="pln"> input</span><span class="pun">().</span><span class="pln">split</span><span class="pun">())</span><span class="pln">
    maxk </span><span class="pun">=</span><span class="pln"> n </span><span class="pun">*</span><span class="pln"> </span><span class="pun">(</span><span class="pln">n </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="com">// 2</span><span class="pln">
    dp </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[[</span><span class="kwd">False</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> i </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="pln">maxk </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)]</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> j </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)]</span><span class="pln">
    p </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[[-</span><span class="lit">1</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> i </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="pln">maxk </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)]</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> j </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)]</span><span class="pln">
    dp</span><span class="pun">[</span><span class="lit">0</span><span class="pun">][</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">True</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> j </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="pln">n</span><span class="pun">):</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> x </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="pln">maxk </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">):</span><span class="pln">
            </span><span class="kwd">for</span><span class="pln"> y </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> n </span><span class="pun">-</span><span class="pln"> j </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">):</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> </span><span class="kwd">not</span><span class="pln"> dp</span><span class="pun">[</span><span class="pln">j</span><span class="pun">][</span><span class="pln">x</span><span class="pun">]:</span><span class="pln">
                    </span><span class="kwd">continue</span><span class="pln">
                </span><span class="kwd">add</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> y </span><span class="pun">*</span><span class="pln"> </span><span class="pun">(</span><span class="pln">y </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="com">// 2</span><span class="pln">
                dp</span><span class="pun">[</span><span class="pln">j </span><span class="pun">+</span><span class="pln"> y</span><span class="pun">][</span><span class="pln">x </span><span class="pun">+</span><span class="pln"> </span><span class="kwd">add</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">True</span><span class="pln">
                p</span><span class="pun">[</span><span class="pln">j </span><span class="pun">+</span><span class="pln"> y</span><span class="pun">][</span><span class="pln">x </span><span class="pun">+</span><span class="pln"> </span><span class="kwd">add</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> y
    k </span><span class="pun">=</span><span class="pln"> maxk </span><span class="pun">-</span><span class="pln"> k
    </span><span class="kwd">if</span><span class="pln"> dp</span><span class="pun">[</span><span class="pln">n</span><span class="pun">][</span><span class="pln">k</span><span class="pun">]:</span><span class="pln">
        ans </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[]</span><span class="pln">
        cur </span><span class="pun">=</span><span class="pln"> n
        curk </span><span class="pun">=</span><span class="pln"> k
        </span><span class="kwd">while</span><span class="pln"> cur </span><span class="pun">!=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">:</span><span class="pln">
            y </span><span class="pun">=</span><span class="pln"> p</span><span class="pun">[</span><span class="pln">cur</span><span class="pun">][</span><span class="pln">curk</span><span class="pun">]</span><span class="pln">
            ans</span><span class="pun">.</span><span class="pln">append</span><span class="pun">(</span><span class="pln">y</span><span class="pun">)</span><span class="pln">
            curk </span><span class="pun">-=</span><span class="pln"> y </span><span class="pun">*</span><span class="pln"> </span><span class="pun">(</span><span class="pln">y </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="com">// 2</span><span class="pln">
            cur </span><span class="pun">-=</span><span class="pln"> y
        res </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[]</span><span class="pln">
        cur </span><span class="pun">=</span><span class="pln"> n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> y </span><span class="kwd">in</span><span class="pln"> ans</span><span class="pun">:</span><span class="pln">
            </span><span class="kwd">for</span><span class="pln"> x </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="pln">cur </span><span class="pun">-</span><span class="pln"> y</span><span class="pun">,</span><span class="pln"> cur</span><span class="pun">):</span><span class="pln">
                res</span><span class="pun">.</span><span class="pln">append</span><span class="pun">(</span><span class="pln">x</span><span class="pun">)</span><span class="pln">
            cur </span><span class="pun">-=</span><span class="pln"> y
        </span><span class="kwd">print</span><span class="pun">(*</span><span class="pln">res</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">else</span><span class="pun">:</span><span class="pln">
        </span><span class="kwd">print</span><span class="pun">(</span><span class="lit">0</span><span class="pun">)</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2145/problem/E" title="Educational Codeforces Round 183 (Rated for Div. 2)">2145E - Predicting Popularity</a></p><p>Idea: <a class="rated-user user-orange" href="https://codeforces.com/profile/adedalic" title="International Master adedalic">adedalic</a></p> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2145/problem/E" title="Educational Codeforces Round 183 (Rated for Div. 2)">2145E - Predicting Popularity</a></h3><div class="ttypography"><div class="problem-statement"><div><p>Since the movie parameters are fixed, for each user we can calculate a certain value $$$p_i$$$&nbsp;— the minimum popularity at which the movie is suitable for this user. Specifically, $$$p_i = \max(a_i - ac, 0) + \max(d_i - dr, 0)$$$.</p><p>Now let's try to understand how to determine the final popularity of the movie $$$p$$$: </p><ul> <li> popularity $$$0$$$ can be achieved in any case; </li><li> for popularity $$$1$$$, there must be at least $$$1$$$ viewer with $$$p_i &lt; 1$$$; </li><li> for popularity $$$2$$$, the previous condition must hold, and there must be at least $$$2$$$ viewers with $$$p_i &lt; 2$$$; </li><li> for popularity $$$3$$$, the previous condition must hold, and there must be at least $$$3$$$ viewers with $$$p_i &lt; 3$$$; </li><li> ... </li><li> for popularity $$$i$$$, the previous condition must hold, and there must be at least $$$i$$$ viewers with $$$p_i &lt; i$$$; </li><li> ... </li><li> for popularity $$$n$$$, the previous condition must hold, and there must be at least $$$n$$$ viewers with $$$p_i &lt; n$$$. </li></ul><p>Thus, to find the answer to the problem, we need to find the minimum $$$p$$$ such that the condition "there are at least $$$p$$$ viewers with $$$p_i &lt; p$$$" is violated. Then we will understand that the movie will still achieve a popularity of $$$p - 1$$$, but not $$$p$$$.</p><p>In other words, if we create an array $$$cnt$$$, where $$$cnt_p$$$ is the number of viewers with $$$p_i &lt; p$$$, we need to find the smallest $$$p$$$ such that $$$cnt_p &lt; p$$$, or equivalently, $$$-p + cnt_p &lt; 0$$$. This array can be maintained in a Segment Tree.</p><p>Let's initialize all $$$cnt_p = -p$$$. When we need to add a user with some $$$p_i$$$, we simply need to add $$$1$$$ to all $$$cnt_p$$$ where $$$p &gt; p_i$$$, which is an interval addition operation in a segment tree. Similarly, to remove a user, we just add $$$-1$$$ to the same segment.</p><p>Thus, finding the answer is equivalent to searching for the leftmost negative value in the Segment Tree. If we additionally maintain the minimum on the segment in the Segment Tree, we can find the first negative value with a single "walking down on the tree": suppose we are searching for the answer at the vertex of the tree; if the minimum in the left child is less than zero, we move to it; otherwise, we move to the right child.</p><p>As a result, we can process each query in two interval additions and one "walk", each of which operates in $$$O(\log{n})$$$, so the overall complexity of the solution will be $$$O((n+q) \log{n})$$$.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Solution (adedalic)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
 
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
 
</span><span class="com">#define</span><span class="pln"> fore</span><span class="pun">(</span><span class="pln">i</span><span class="pun">,</span><span class="pln"> l</span><span class="pun">,</span><span class="pln"> r</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">(</span><span class="pln">l</span><span class="pun">);</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">(</span><span class="pln">r</span><span class="pun">);</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
</span><span class="com">#define</span><span class="pln"> sz</span><span class="pun">(</span><span class="pln">a</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">((</span><span class="pln">a</span><span class="pun">).</span><span class="pln">size</span><span class="pun">())</span><span class="pln">
 
</span><span class="com">#define</span><span class="pln"> x first
</span><span class="com">#define</span><span class="pln"> y second
 
</span><span class="kwd">typedef</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> li</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">typedef</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">double</span><span class="pln"> ld</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">typedef</span><span class="pln"> pair</span><span class="pun">&lt;</span><span class="kwd">int</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">&gt;</span><span class="pln"> pt</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">template</span><span class="pun">&lt;</span><span class="kwd">class</span><span class="pln"> A</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> B</span><span class="pun">&gt;</span><span class="pln"> ostream</span><span class="pun">&amp;</span><span class="pln"> </span><span class="kwd">operator</span><span class="pln"> </span><span class="pun">&lt;&lt;(</span><span class="pln">ostream</span><span class="pun">&amp;</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">const</span><span class="pln"> pair</span><span class="pun">&lt;</span><span class="pln">A</span><span class="pun">,</span><span class="pln"> B</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">p</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">out</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"("</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">x </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">", "</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">y </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">")"</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">template</span><span class="pun">&lt;</span><span class="kwd">class</span><span class="pln"> A</span><span class="pun">&gt;</span><span class="pln"> ostream</span><span class="pun">&amp;</span><span class="pln"> </span><span class="kwd">operator</span><span class="pln"> </span><span class="pun">&lt;&lt;(</span><span class="pln">ostream</span><span class="pun">&amp;</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">const</span><span class="pln"> vector</span><span class="pun">&lt;</span><span class="pln">A</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">v</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    fore</span><span class="pun">(</span><span class="pln">i</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> sz</span><span class="pun">(</span><span class="pln">v</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">out</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">" "</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">out</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> v</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> INF </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">(</span><span class="lit">1e9</span><span class="pun">);</span><span class="pln">
</span><span class="kwd">const</span><span class="pln"> li INF64 </span><span class="pun">=</span><span class="pln"> li</span><span class="pun">(</span><span class="lit">1e18</span><span class="pun">);</span><span class="pln">
</span><span class="kwd">const</span><span class="pln"> ld EPS </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1e-9</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> ac</span><span class="pun">,</span><span class="pln"> dr</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
vector</span><span class="str">&lt;int&gt;</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> d</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">inline</span><span class="pln"> </span><span class="kwd">bool</span><span class="pln"> read</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pun">(!(</span><span class="pln">cin </span><span class="pun">&gt;&gt;</span><span class="pln"> ac </span><span class="pun">&gt;&gt;</span><span class="pln"> dr</span><span class="pun">))</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">resize</span><span class="pun">(</span><span class="pln">n</span><span class="pun">);</span><span class="pln">
    fore </span><span class="pun">(</span><span class="pln">i</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> n</span><span class="pun">)</span><span class="pln">
        cin </span><span class="pun">&gt;&gt;</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
    d</span><span class="pun">.</span><span class="pln">resize</span><span class="pun">(</span><span class="pln">n</span><span class="pun">);</span><span class="pln">
    fore </span><span class="pun">(</span><span class="pln">i</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> n</span><span class="pun">)</span><span class="pln">
        cin </span><span class="pun">&gt;&gt;</span><span class="pln"> d</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
vector</span><span class="str">&lt;int&gt;</span><span class="pln"> </span><span class="typ">Tadd</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Tmin</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">void</span><span class="pln"> push</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> v</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">Tadd</span><span class="pun">[</span><span class="lit">2</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> v </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+=</span><span class="pln"> </span><span class="typ">Tadd</span><span class="pun">[</span><span class="pln">v</span><span class="pun">];</span><span class="pln">
    </span><span class="typ">Tadd</span><span class="pun">[</span><span class="lit">2</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> v </span><span class="pun">+</span><span class="pln"> </span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+=</span><span class="pln"> </span><span class="typ">Tadd</span><span class="pun">[</span><span class="pln">v</span><span class="pun">];</span><span class="pln">
    </span><span class="typ">Tadd</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> getmin</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> v</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Tmin</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="typ">Tadd</span><span class="pun">[</span><span class="pln">v</span><span class="pun">];</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">void</span><span class="pln"> upd</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> v</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">Tmin</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> min</span><span class="pun">(</span><span class="pln">getmin</span><span class="pun">(</span><span class="lit">2</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> v </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">),</span><span class="pln"> getmin</span><span class="pun">(</span><span class="lit">2</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> v </span><span class="pun">+</span><span class="pln"> </span><span class="lit">2</span><span class="pun">));</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">void</span><span class="pln"> init</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> v</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> l</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> r</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> r</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="typ">Tmin</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">-</span><span class="pln">l</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">return</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> mid </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l </span><span class="pun">+</span><span class="pln"> r</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&gt;&gt;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
    init</span><span class="pun">(</span><span class="lit">2</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> v </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> l</span><span class="pun">,</span><span class="pln"> mid</span><span class="pun">);</span><span class="pln">
    init</span><span class="pun">(</span><span class="lit">2</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> v </span><span class="pun">+</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> mid</span><span class="pun">,</span><span class="pln"> r</span><span class="pun">);</span><span class="pln">
    upd</span><span class="pun">(</span><span class="pln">v</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">void</span><span class="pln"> init</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">Tadd</span><span class="pun">.</span><span class="pln">assign</span><span class="pun">(</span><span class="lit">4</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    </span><span class="typ">Tmin</span><span class="pun">.</span><span class="pln">resize</span><span class="pun">(</span><span class="lit">4</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> n</span><span class="pun">);</span><span class="pln">
    init</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> n</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">void</span><span class="pln"> addVal</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> v</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> l</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> r</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> lf</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> rg</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> val</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l </span><span class="pun">==</span><span class="pln"> lf </span><span class="pun">&amp;&amp;</span><span class="pln"> r </span><span class="pun">==</span><span class="pln"> rg</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="typ">Tadd</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+=</span><span class="pln"> val</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">return</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> mid </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l </span><span class="pun">+</span><span class="pln"> r</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&gt;&gt;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
    push</span><span class="pun">(</span><span class="pln">v</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">lf </span><span class="pun">&lt;</span><span class="pln"> mid</span><span class="pun">)</span><span class="pln">
        addVal</span><span class="pun">(</span><span class="lit">2</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> v </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> l</span><span class="pun">,</span><span class="pln"> mid</span><span class="pun">,</span><span class="pln"> lf</span><span class="pun">,</span><span class="pln"> min</span><span class="pun">(</span><span class="pln">mid</span><span class="pun">,</span><span class="pln"> rg</span><span class="pun">),</span><span class="pln"> val</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">rg </span><span class="pun">&gt;</span><span class="pln"> mid</span><span class="pun">)</span><span class="pln">
        addVal</span><span class="pun">(</span><span class="lit">2</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> v </span><span class="pun">+</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> mid</span><span class="pun">,</span><span class="pln"> r</span><span class="pun">,</span><span class="pln"> max</span><span class="pun">(</span><span class="pln">lf</span><span class="pun">,</span><span class="pln"> mid</span><span class="pun">),</span><span class="pln"> rg</span><span class="pun">,</span><span class="pln"> val</span><span class="pun">);</span><span class="pln">
    upd</span><span class="pun">(</span><span class="pln">v</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> firstNeg</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> v</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> l</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> r</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> r</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pun">(</span><span class="pln">getmin</span><span class="pun">(</span><span class="pln">v</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> l</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    push</span><span class="pun">(</span><span class="pln">v</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> mid </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l </span><span class="pun">+</span><span class="pln"> r</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&gt;&gt;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> ans </span><span class="pun">=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">getmin</span><span class="pun">(</span><span class="lit">2</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> v </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln">
        ans </span><span class="pun">=</span><span class="pln"> firstNeg</span><span class="pun">(</span><span class="lit">2</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> v </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> l</span><span class="pun">,</span><span class="pln"> mid</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">else</span><span class="pln">
        ans </span><span class="pun">=</span><span class="pln"> firstNeg</span><span class="pun">(</span><span class="lit">2</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> v </span><span class="pun">+</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> mid</span><span class="pun">,</span><span class="pln"> r</span><span class="pun">);</span><span class="pln">
    upd</span><span class="pun">(</span><span class="pln">v</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> ans</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> calcDemand</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> min</span><span class="pun">(</span><span class="pln">n</span><span class="pun">,</span><span class="pln"> max</span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> ac</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> max</span><span class="pun">(</span><span class="pln">d</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> dr</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">));</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">inline</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> solve</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    init</span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">2</span><span class="pun">);</span><span class="pln">
    fore </span><span class="pun">(</span><span class="pln">i</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> calcDemand</span><span class="pun">(</span><span class="pln">i</span><span class="pun">);</span><span class="pln">
        addVal</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> p </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
 
    </span><span class="kwd">int</span><span class="pln"> m</span><span class="pun">;</span><span class="pln"> cin </span><span class="pun">&gt;&gt;</span><span class="pln"> m</span><span class="pun">;</span><span class="pln">
    fore </span><span class="pun">(</span><span class="pln">j</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> m</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> k</span><span class="pun">,</span><span class="pln"> na</span><span class="pun">,</span><span class="pln"> nd</span><span class="pun">;</span><span class="pln">
        cin </span><span class="pun">&gt;&gt;</span><span class="pln"> k </span><span class="pun">&gt;&gt;</span><span class="pln"> na </span><span class="pun">&gt;&gt;</span><span class="pln"> nd</span><span class="pun">;</span><span class="pln">
        k</span><span class="pun">--;</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> calcDemand</span><span class="pun">(</span><span class="pln">k</span><span class="pun">);</span><span class="pln">
        addVal</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> p </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">);</span><span class="pln">
        a</span><span class="pun">[</span><span class="pln">k</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> na</span><span class="pun">;</span><span class="pln">
        d</span><span class="pun">[</span><span class="pln">k</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> nd</span><span class="pun">;</span><span class="pln">
        p </span><span class="pun">=</span><span class="pln"> calcDemand</span><span class="pun">(</span><span class="pln">k</span><span class="pun">);</span><span class="pln">
        addVal</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> p </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
 
        </span><span class="kwd">int</span><span class="pln"> ans </span><span class="pun">=</span><span class="pln"> firstNeg</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">2</span><span class="pun">);</span><span class="pln">
        cout </span><span class="pun">&lt;&lt;</span><span class="pln"> ans </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
</span><span class="com">#ifdef</span><span class="pln"> _DEBUG
    freopen</span><span class="pun">(</span><span class="str">"input.txt"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"r"</span><span class="pun">,</span><span class="pln"> stdin</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> tt </span><span class="pun">=</span><span class="pln"> clock</span><span class="pun">();</span><span class="pln">
</span><span class="com">#endif</span><span class="pln">
    ios_base</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="kwd">false</span><span class="pun">);</span><span class="pln">
    cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">),</span><span class="pln"> cout</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="kwd">fixed</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> setprecision</span><span class="pun">(</span><span class="lit">15</span><span class="pun">);</span><span class="pln">
    
    </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">read</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        solve</span><span class="pun">();</span><span class="pln">
        
</span><span class="com">#ifdef</span><span class="pln"> _DEBUG
        cerr </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"TIME = "</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> clock</span><span class="pun">()</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> tt </span><span class="pun">&lt;&lt;</span><span class="pln"> endl</span><span class="pun">;</span><span class="pln">
        tt </span><span class="pun">=</span><span class="pln"> clock</span><span class="pun">();</span><span class="pln">
</span><span class="com">#endif</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2145/problem/F" title="Educational Codeforces Round 183 (Rated for Div. 2)">2145F - Long Journey</a></p><p>Idea: <a class="rated-user user-red" href="https://codeforces.com/profile/BledDest" title="International Grandmaster BledDest">BledDest</a></p> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2145/problem/F" title="Educational Codeforces Round 183 (Rated for Div. 2)">2145F - Long Journey</a></h3><div class="ttypography"><div class="problem-statement"><div><p>Note that to determine if a move forward is possible, you do not need to know the exact turn and cell numbers. Knowing the turn number's remainder when divided by $$$n$$$ is sufficient. Similarly, knowing the cell number's remainder when divided by $$$LCM(a_1, a_2, \dots, a_n)$$$ is enough. Since $$$a_i \le 10$$$, then $$$LCM(a_1, a_2, \dots, a_n) \le 2520$$$. Therefore, there are at most $$$2520n$$$ possible states. </p><p>Let's use this and calculate the dynamic programming $$$go_{i, x, y}$$$&nbsp;— the number of cells ahead we can move in $$$2^i$$$ turns, with the current turn number $$$x$$$ (mod $$$n$$$) and the current cell number $$$y$$$ (mod LCM). $$$go_{0, x, y}$$$ is $$$1$$$ if $$$(y+1) \bmod a_x \ne b_x$$$, otherwise it is $$$0$$$. The remaining values of $$$go_{i, x, y}$$$ can be computed by splitting the path into two parts of $$$2^{i-1}$$$ turns: $$$go_{i, x, y} = go_{i - 1, x, y} + go_{i - 1, x', y'}$$$, where $$$x' = (x +2^{i-1}) \bmod n$$$ and $$$y' = (y +go_{i - 1, x, y}) \bmod LCM$$$ (let's see where we end in $$$2^{i-1}$$$ turns, and then make another $$$2^{i-1}$$$ turns from there).</p><p>By computing these values, we can easily find the answer to the problem. If $$$go_{i, 0, 0} &lt; m$$$ for all $$$i$$$, then there is no path from $$$0$$$ to $$$m$$$. Otherwise, let's iterate $$$i$$$ from the largest to the smallest, maintaining the current turn number $$$s$$$ and the current position $$$p$$$. If we can make $$$2^i$$$ turns without reaching $$$m$$$ (i.e. $$$x+go_{i, s \bmod n, p \bmod LCM} &lt; m$$$), then let's apply this group of operations and update the values of $$$s$$$ and $$$p$$$. By the end, we'll be in cell $$$(m-1)$$$, ensuring a move to $$$m$$$ is always possible (otherwise, another transition using $$$go$$$ would apply). This process of finding the answer is very similar to using binary lifting for finding LCA (instead of going to LCA directly, we are trying to find a vertex for which LCA is the parent).</p><p>There are other ways to solve this problem, for example, with functional graph cycle detection or fast matrix exponentiation, but in my opinion, this approach is the easiest to implement.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Solution (Neon)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
 
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">using</span><span class="pln"> li </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> N </span><span class="pun">=</span><span class="pln"> </span><span class="lit">10</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> LOG </span><span class="pun">=</span><span class="pln"> </span><span class="lit">50</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> LCM </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2520</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
li m</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">N</span><span class="pun">],</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">N</span><span class="pun">];</span><span class="pln">
li go</span><span class="pun">[</span><span class="pln">LOG</span><span class="pun">][</span><span class="pln">N</span><span class="pun">][</span><span class="pln">LCM</span><span class="pun">];</span><span class="pln">
 
</span><span class="kwd">void</span><span class="pln"> solve</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n </span><span class="pun">&gt;&gt;</span><span class="pln"> m</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> cin </span><span class="pun">&gt;&gt;</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
  </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> cin </span><span class="pun">&gt;&gt;</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
  </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> x </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">x</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> y </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> y </span><span class="pun">&lt;</span><span class="pln"> LCM</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">y</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      go</span><span class="pun">[</span><span class="lit">0</span><span class="pun">][</span><span class="pln">x</span><span class="pun">][</span><span class="pln">y</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">((</span><span class="pln">y </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">x</span><span class="pun">])</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">x</span><span class="pun">];</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
  </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> LOG</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> x </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">x</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> y </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> y </span><span class="pun">&lt;</span><span class="pln"> LCM</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">y</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        go</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">x</span><span class="pun">][</span><span class="pln">y</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> go</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">][</span><span class="pln">x</span><span class="pun">][</span><span class="pln">y</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> go</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">][(</span><span class="pln">x </span><span class="pun">+</span><span class="pln"> </span><span class="pun">(</span><span class="lit">1LL</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)))</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> n</span><span class="pun">][(</span><span class="pln">y </span><span class="pun">+</span><span class="pln"> go</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">][</span><span class="pln">x</span><span class="pun">][</span><span class="pln">y</span><span class="pun">])</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> LCM</span><span class="pun">];</span><span class="pln">  
      </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
  </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">go</span><span class="pun">[</span><span class="pln">LOG </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">][</span><span class="lit">0</span><span class="pun">][</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> m</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> endl</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">return</span><span class="pun">;</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
  li s </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> ans </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> LOG </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> </span><span class="pun">--</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">s </span><span class="pun">+</span><span class="pln"> go</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">ans </span><span class="pun">%</span><span class="pln"> n</span><span class="pun">][</span><span class="pln">s </span><span class="pun">%</span><span class="pln"> LCM</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> m</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      s </span><span class="pun">+=</span><span class="pln"> go</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">ans </span><span class="pun">%</span><span class="pln"> n</span><span class="pun">][</span><span class="pln">s </span><span class="pun">%</span><span class="pln"> LCM</span><span class="pun">];</span><span class="pln">
      ans </span><span class="pun">+=</span><span class="pln"> </span><span class="lit">1LL</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> i</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
  cout </span><span class="pun">&lt;&lt;</span><span class="pln"> ans </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> endl</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
  cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">t</span><span class="pun">--)</span><span class="pln"> solve</span><span class="pun">();</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2145/problem/G" title="Educational Codeforces Round 183 (Rated for Div. 2)">2145G - Cost of Coloring</a></p><p>Idea: <a class="rated-user user-red" href="https://codeforces.com/profile/BledDest" title="International Grandmaster BledDest">BledDest</a></p> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><div><h3><a href="https://codeforces.com/contest/2145/problem/G" title="Educational Codeforces Round 183 (Rated for Div. 2)">2145G - Cost of Coloring</a></h3><div class="ttypography"><div class="problem-statement"><div><p>First, let's try to understand how to determine if a given coloring can be achieved, and if so, what is the minimum number of operations required. It is quite obvious that for each row and each column, at most one painting operation will be needed. Additionally, we must paint either all rows or all columns (otherwise, there will be at least one unpainted cell).</p><p>Consider the cells of color $$$k$$$. They must be painted last, and the operations that produced them must paint the entire row/column. Consider all rows and columns that consist entirely of cells of color $$$k$$$ — these are the rows and columns that were painted in color $$$k$$$. If these rows and columns are removed, the matrix should only contain cells of colors from $$$1$$$ to $$$k-1$$$ (because if there wes a cell of color $$$k$$$ that did not belong to any column or row of that color, we would not be able to paint it). Now, the same can be done with color $$$k-1$$$, then with color $$$k-2$$$, and so on.</p><p>However, as soon as we reach color $$$1$$$, the process will change slightly. We have removed all cells with colors from $$$k$$$ to $$$2$$$, so all remaining cells will be of color $$$1$$$. We do not necessarily have to paint all rows and columns in color $$$1$$$ — it is sufficient to paint <span class="tex-font-style-it">either</span> the rows <span class="tex-font-style-it">or</span> the columns. If we assign a color to each row and each column, we can leave all rows or columns of color $$$1$$$ unpainted. Consequently, the number of operations in this case will be $$$n + m - \max(x,y)$$$, where $$$x$$$ and $$$y$$$ are the number of rows and columns with color $$$1$$$.</p><p>Now, instead of colorings, let's count the number of ways to assign colors from $$$1$$$ to $$$k$$$ to all rows and columns (it is quite obvious that if we assign different colors to some row or column in two colorings, the resulting colorings will also be different, because there are always rows and columns of color $$$1$$$). We can iterate over $$$x$$$ and $$$y$$$ (the number of rows and columns of color $$$1$$$), and then add to the answer for the number of operations $$$(n+m-\max(x,y))$$$ the number of ways to choose these rows and columns (that is, $$${{n}\choose{x}} \cdot {{m}\choose{y}}$$$), multiplied by the number of ways to assign colors from $$$2$$$ to $$$k$$$ to the remaining rows and columns. It seems that this number of ways is equal to $$$(k-1)^{n+m-x-y}$$$, but this is not quite correct, because we might obtain a coloring in which some color is not assigned to any column or row. How can we solve this problem?</p><p>The model solution uses the inclusion-exclusion principle (but to apply it, the enumeration of pairs $$$(x,y)$$$ needs to be accelerated from $$$O(n^2)$$$ to $$$O(n)$$$), but there is a simpler option. Let's calculate a dynamic programming of the form $$$dp_{i,j}$$$ — the number of ways to assign $$$i$$$ objects (rows/columns) $$$j$$$ different colors from $$$(k-1)$$$ such that each color is used at least once. This dynamic programming can be computed quite easily in $$$O(n^2)$$$ as follows: the base case will be $$$dp_{0,0} = 1$$$; in the transitions, we can assign the next object either one of the previously used colors (and we will transition from $$$dp_{i,j}$$$ to $$$dp_{i+1,j}$$$ while multiplying the value by $$$j$$$), or a previously unused color (we will transition from $$$dp_{i,j}$$$ to $$$dp_{i+1,j+1}$$$ while multiplying by $$$(k-j-1)$$$). After calculating this dynamic programming, we can use $$$dp_{n+m-x-y,k-1}$$$ as the number of ways to assign colors from $$$2$$$ to $$$k$$$ to the remaining rows and columns, thus obtaining a solution in $$$O(n^2)$$$.</p></div></div></div></div></div></div> <div class="spoiler"><b class="spoiler-title">Solution (BledDest)</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
 
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> m</span><span class="pun">,</span><span class="pln"> k</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> N </span><span class="pun">=</span><span class="pln"> </span><span class="lit">4043</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> MOD </span><span class="pun">=</span><span class="pln"> </span><span class="lit">998244353</span><span class="pun">;</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> </span><span class="kwd">add</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> y</span><span class="pun">)</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    x </span><span class="pun">+=</span><span class="pln"> y</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pun">(</span><span class="pln">x </span><span class="pun">&gt;=</span><span class="pln"> MOD</span><span class="pun">)</span><span class="pln"> x </span><span class="pun">-=</span><span class="pln"> MOD</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pun">(</span><span class="pln">x </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> x </span><span class="pun">+=</span><span class="pln"> MOD</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> x</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">   
 
</span><span class="kwd">int</span><span class="pln"> </span><span class="kwd">sub</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> y</span><span class="pun">)</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">add</span><span class="pun">(</span><span class="pln">x</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="pln">y</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> mul</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> y</span><span class="pun">)</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x </span><span class="pun">*</span><span class="pln"> </span><span class="lit">1ll</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> y</span><span class="pun">)</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> MOD</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> binpow</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> y</span><span class="pun">)</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> z </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pun">(</span><span class="pln">y </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">y </span><span class="pun">%</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> z </span><span class="pun">=</span><span class="pln"> mul</span><span class="pun">(</span><span class="pln">z</span><span class="pun">,</span><span class="pln"> x</span><span class="pun">);</span><span class="pln">
        x </span><span class="pun">=</span><span class="pln"> mul</span><span class="pun">(</span><span class="pln">x</span><span class="pun">,</span><span class="pln"> x</span><span class="pun">);</span><span class="pln">
        y </span><span class="pun">/=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> z</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> fact</span><span class="pun">[</span><span class="pln">N</span><span class="pun">];</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> rfact</span><span class="pun">[</span><span class="pln">N</span><span class="pun">];</span><span class="pln">
 
</span><span class="kwd">void</span><span class="pln"> precalc_factorials</span><span class="pun">()</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    fact</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> N</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
        fact</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> mul</span><span class="pun">(</span><span class="pln">fact</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">],</span><span class="pln"> i</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> N</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
        rfact</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> binpow</span><span class="pun">(</span><span class="pln">fact</span><span class="pun">[</span><span class="pln">i</span><span class="pun">],</span><span class="pln"> MOD </span><span class="pun">-</span><span class="pln"> </span><span class="lit">2</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> choose</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> y</span><span class="pun">)</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">x </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> y </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> x </span><span class="pun">&lt;</span><span class="pln"> y</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> mul</span><span class="pun">(</span><span class="pln">fact</span><span class="pun">[</span><span class="pln">x</span><span class="pun">],</span><span class="pln"> mul</span><span class="pun">(</span><span class="pln">rfact</span><span class="pun">[</span><span class="pln">y</span><span class="pun">],</span><span class="pln"> rfact</span><span class="pun">[</span><span class="pln">x </span><span class="pun">-</span><span class="pln"> y</span><span class="pun">]));</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
vector</span><span class="str">&lt;int&gt;</span><span class="pln"> prefix_sum</span><span class="pun">(</span><span class="kwd">const</span><span class="pln"> vector</span><span class="str">&lt;int&gt;</span><span class="pun">&amp;</span><span class="pln"> a</span><span class="pun">)</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> n </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">size</span><span class="pun">();</span><span class="pln">
    vector</span><span class="str">&lt;int&gt;</span><span class="pln"> p</span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> p</span><span class="pun">[</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">add</span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">],</span><span class="pln"> p</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]);</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> p</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">int</span><span class="pln"> </span><span class="kwd">get</span><span class="pun">(</span><span class="kwd">const</span><span class="pln"> vector</span><span class="str">&lt;int&gt;</span><span class="pun">&amp;</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> i</span><span class="pun">)</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">a</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> i</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
    </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">back</span><span class="pun">();</span><span class="pln">
</span><span class="pun">}</span><span class="pln">   
 
</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    ios_base</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> m</span><span class="pun">,</span><span class="pln"> k</span><span class="pun">;</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n </span><span class="pun">&gt;&gt;</span><span class="pln"> m </span><span class="pun">&gt;&gt;</span><span class="pln"> k</span><span class="pun">;</span><span class="pln">
    precalc_factorials</span><span class="pun">();</span><span class="pln">
 
    vector</span><span class="pun">&lt;</span><span class="pln">vector</span><span class="str">&lt;int&gt;</span><span class="pun">&gt;</span><span class="pln"> A</span><span class="pun">(</span><span class="pln">k</span><span class="pun">,</span><span class="pln"> vector</span><span class="str">&lt;int&gt;</span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> m</span><span class="pun">));</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> x </span><span class="pun">&lt;</span><span class="pln"> k</span><span class="pun">;</span><span class="pln"> x</span><span class="pun">++)</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
        vector</span><span class="str">&lt;int&gt;</span><span class="pln"> by_rows</span><span class="pun">(</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
            by_rows</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> mul</span><span class="pun">(</span><span class="pln">choose</span><span class="pun">(</span><span class="pln">n</span><span class="pun">,</span><span class="pln"> i</span><span class="pun">),</span><span class="pln"> binpow</span><span class="pun">(</span><span class="pln">x</span><span class="pun">,</span><span class="pln"> n </span><span class="pun">-</span><span class="pln"> i</span><span class="pun">));</span><span class="pln">
        vector</span><span class="str">&lt;int&gt;</span><span class="pln"> pr </span><span class="pun">=</span><span class="pln"> prefix_sum</span><span class="pun">(</span><span class="pln">by_rows</span><span class="pun">);</span><span class="pln">
 
        vector</span><span class="str">&lt;int&gt;</span><span class="pln"> by_cols</span><span class="pun">(</span><span class="pln">m </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> m</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
            by_cols</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> mul</span><span class="pun">(</span><span class="pln">choose</span><span class="pun">(</span><span class="pln">m</span><span class="pun">,</span><span class="pln"> i</span><span class="pun">),</span><span class="pln"> binpow</span><span class="pun">(</span><span class="pln">x</span><span class="pun">,</span><span class="pln"> m </span><span class="pun">-</span><span class="pln"> i</span><span class="pun">));</span><span class="pln">
        vector</span><span class="str">&lt;int&gt;</span><span class="pln"> pc </span><span class="pun">=</span><span class="pln"> prefix_sum</span><span class="pun">(</span><span class="pln">by_cols</span><span class="pun">);</span><span class="pln">
 
        </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> max</span><span class="pun">(</span><span class="pln">n</span><span class="pun">,</span><span class="pln"> m</span><span class="pun">);</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
        </span><span class="pun">{</span><span class="pln">
            A</span><span class="pun">[</span><span class="pln">x</span><span class="pun">][</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> m </span><span class="pun">-</span><span class="pln"> i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">sub</span><span class="pun">(</span><span class="pln">mul</span><span class="pun">(</span><span class="kwd">get</span><span class="pun">(</span><span class="pln">pr</span><span class="pun">,</span><span class="pln"> i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">),</span><span class="pln"> </span><span class="kwd">get</span><span class="pun">(</span><span class="pln">pc</span><span class="pun">,</span><span class="pln"> i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)),</span><span class="pln"> mul</span><span class="pun">(</span><span class="kwd">get</span><span class="pun">(</span><span class="pln">pr</span><span class="pun">,</span><span class="pln"> i</span><span class="pun">),</span><span class="pln"> </span><span class="kwd">get</span><span class="pun">(</span><span class="pln">pc</span><span class="pun">,</span><span class="pln"> i</span><span class="pun">)));</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">     
    </span><span class="pun">}</span><span class="pln">
 
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> min</span><span class="pun">(</span><span class="pln">n</span><span class="pun">,</span><span class="pln"> m</span><span class="pun">);</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n </span><span class="pun">+</span><span class="pln"> m</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> ans </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;</span><span class="pln"> k</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++)</span><span class="pln">
        </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">int</span><span class="pln"> cur </span><span class="pun">=</span><span class="pln"> mul</span><span class="pun">(</span><span class="pln">choose</span><span class="pun">(</span><span class="pln">k </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> j</span><span class="pun">),</span><span class="pln"> A</span><span class="pun">[</span><span class="pln">k </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> j</span><span class="pun">][</span><span class="pln">i</span><span class="pun">]);</span><span class="pln">
            </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">j </span><span class="pun">%</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln">
                ans </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">add</span><span class="pun">(</span><span class="pln">ans</span><span class="pun">,</span><span class="pln"> cur</span><span class="pun">);</span><span class="pln">
            </span><span class="kwd">else</span><span class="pln">
                ans </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">add</span><span class="pun">(</span><span class="pln">ans</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="pln">cur</span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        cout </span><span class="pun">&lt;&lt;</span><span class="pln"> ans </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">" "</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    cout </span><span class="pun">&lt;&lt;</span><span class="pln"> endl</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div></div>

    </div>


        <div style="font-size: 1.1rem;line-height: 1.1rem;padding-bottom: 0.5em;">
            <img src="https://codeforces.com//codeforces.com/codeforces.org/s/52448/images/icons/paperclip-16x16.png" style="vertical-align: middle;"> <span style="padding: 0 0.35em;">Tutorial of <a href="https://codeforces.com/contest/2145" class="notice" style="text-decoration: none;">Educational Codeforces Round 183 (Rated for Div. 2)</a> </span>
        </div>
        
            

  <script>
    // Make all spoilers toggleable
    document.querySelectorAll('.spoiler-title').forEach(title => {
      title.addEventListener('click', function() {
        const spoiler = this.closest('.spoiler');
        spoiler.classList.toggle('open');
      });
    });
    
    // Open all spoilers by default for easier reading
    document.querySelectorAll('.spoiler').forEach(spoiler => {
      spoiler.classList.add('open');
    });
  </script>
</body>
</html>