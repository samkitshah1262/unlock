<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tutorial</title>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
      line-height: 1.6;
      color: #333;
      background: #fafafa;
    }
    .ttypography {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    h3 {
      color: #1a1a1a;
      border-bottom: 2px solid #eee;
      padding-bottom: 10px;
    }
    h3 a {
      color: #0066cc;
      text-decoration: none;
    }
    h3 a:hover {
      text-decoration: underline;
    }
    .spoiler {
      margin: 15px 0;
      border: 1px solid #ddd;
      border-radius: 6px;
      overflow: hidden;
    }
    .spoiler-title {
      display: block;
      padding: 12px 15px;
      background: #f0f0f0;
      cursor: pointer;
      font-weight: 600;
      user-select: none;
      border-bottom: 1px solid #ddd;
    }
    .spoiler-title:hover {
      background: #e8e8e8;
    }
    .spoiler-title::before {
      content: '▶ ';
      font-size: 0.8em;
      transition: transform 0.2s;
      display: inline-block;
    }
    .spoiler.open .spoiler-title::before {
      content: '▼ ';
    }
    .spoiler-content {
      padding: 15px;
      background: #fff;
      display: none;
    }
    .spoiler.open .spoiler-content {
      display: block;
    }
    pre, code {
      background: #f5f5f5;
      font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
      font-size: 0.85em;
    }
    pre {
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
    }
    code {
      padding: 2px 5px;
      border-radius: 3px;
    }
    p {
      margin: 10px 0;
    }
    .MathJax {
      font-size: 1.1em;
    }
  </style>
</head>
<body>
  <h1>Editorial</h1>
  <p><a href="https://codeforces.com/blog/entry/148981" target="_blank">View on Codeforces →</a></p>
  
  <div class="ttypography"><p><a href="https://codeforces.com/contest/2173/problem/A">2173A-Sleeping Through Classes</a> Idea &amp; Solution: <a class="rated-user user-red" href="https://codeforces.com/profile/HHH666666" title="Grandmaster HHH666666">HHH666666</a></p> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><p>From the statement we can conclude that a class can be slept through <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1"><span class="MJXp-mrow" id="MJXp-Span-2"><span class="MJXp-mtext MJXp-bold" id="MJXp-Span-3">if and only if</span></span></span></span><script type="math/tex" id="MathJax-Element-1">\textbf{if and only if}</script>:</p> <ol>   <li>The class itself is not an important class.</li>   <li>The class is not within <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5">k</span></span></span><script type="math/tex" id="MathJax-Element-2">k</script> classes after any important class.</li> </ol><p>Here's an <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-6"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-7">O</span><span class="MJXp-mo" id="MJXp-Span-8" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-9">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-10">k</span><span class="MJXp-mo" id="MJXp-Span-11" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-3">O(nk)</script> approach:</p><p>We directly simulate the process: for each important class at position <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-12"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-13">i</span></span></span><script type="math/tex" id="MathJax-Element-4">i</script>, mark positions <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-26"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-27">i</span><span class="MJXp-mo" id="MJXp-Span-28" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-29">1</span><span class="MJXp-mo" id="MJXp-Span-30" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-31">i</span><span class="MJXp-mo" id="MJXp-Span-32" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-33">2</span><span class="MJXp-mo" id="MJXp-Span-34" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-35" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-36" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-37" style="margin-left: 0.333em; margin-right: 0.333em;">min</span><span class="MJXp-mo" id="MJXp-Span-38" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-39">i</span><span class="MJXp-mo" id="MJXp-Span-40" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-41">k</span><span class="MJXp-mo" id="MJXp-Span-42" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-43">n</span><span class="MJXp-mo" id="MJXp-Span-44" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-5">i+1, i+2, \dots, \min(i+k, n)</script> as “must stay awake”. After processing all important classes, count the classes that are neither important nor marked. This <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-45"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-46">O</span><span class="MJXp-mo" id="MJXp-Span-47" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-48">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-49">k</span><span class="MJXp-mo" id="MJXp-Span-50" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-6">O(nk)</script> solution is acceptable under the constraints.</p><p>There's also an <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-51"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-52">O</span><span class="MJXp-mo" id="MJXp-Span-53" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-54">n</span><span class="MJXp-mo" id="MJXp-Span-55" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-7">O(n)</script> solution:</p><p>For each unimportant class, we only need to focus on the nearest important class before it. Thus we maintain a variable <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-56"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-57">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-58">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-59">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-60">t</span></span></span><script type="math/tex" id="MathJax-Element-8">last</script> storing the index of the most recent important class (or <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-61"><span class="MJXp-mo" id="MJXp-Span-62" style="margin-left: 0em; margin-right: 0.111em;">−</span><span class="MJXp-mi" id="MJXp-Span-63">∞</span></span></span><script type="math/tex" id="MathJax-Element-9">-\infty</script> if none seen yet), then for each <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-64"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-65">i</span></span></span><script type="math/tex" id="MathJax-Element-10">i</script> from <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-66"><span class="MJXp-mn" id="MJXp-Span-67">1</span></span></span><script type="math/tex" id="MathJax-Element-11">1</script> to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-68"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-69">n</span></span></span><script type="math/tex" id="MathJax-Element-12">n</script>, if it's an important class we let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-70"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-71">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-72">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-73">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-74">t</span><span class="MJXp-mo" id="MJXp-Span-75" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-76">i</span></span></span><script type="math/tex" id="MathJax-Element-13">last = i</script>, otherwise if <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-77"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-78">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-79">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-80">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-81">t</span><span class="MJXp-mo" id="MJXp-Span-82" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-83">k</span><span class="MJXp-mo" id="MJXp-Span-84" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-85">i</span></span></span><script type="math/tex" id="MathJax-Element-14">last + k < i</script>, the class is able to be slept through and we add <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-86"><span class="MJXp-mn" id="MJXp-Span-87">1</span></span></span><script type="math/tex" id="MathJax-Element-15">1</script> to the answer.</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">,</span><span class="pln">k</span><span class="pun">;</span><span class="kwd">string</span><span class="pln"> s</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">void</span><span class="pln"> solve</span><span class="pun">(){</span><span class="pln">
	cin</span><span class="pun">&gt;&gt;</span><span class="pln">n</span><span class="pun">&gt;&gt;</span><span class="pln">k</span><span class="pun">&gt;&gt;</span><span class="pln">s</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">int</span><span class="pln"> ans</span><span class="pun">=</span><span class="lit">0</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i</span><span class="pun">=</span><span class="lit">0</span><span class="pun">;</span><span class="pln">i</span><span class="pun">&lt;</span><span class="pln">n</span><span class="pun">;</span><span class="pln">i</span><span class="pun">++){</span><span class="pln">
		</span><span class="kwd">if</span><span class="pun">(</span><span class="pln">s</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]==</span><span class="str">'0'</span><span class="pun">){</span><span class="pln">
			</span><span class="kwd">int</span><span class="pln"> ok</span><span class="pun">=</span><span class="lit">1</span><span class="pun">;</span><span class="pln">
			</span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j</span><span class="pun">=</span><span class="pln">max</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,(</span><span class="kwd">int</span><span class="pun">)</span><span class="pln">i</span><span class="pun">-</span><span class="pln">k</span><span class="pun">);</span><span class="pln">j</span><span class="pun">&lt;</span><span class="pln">i</span><span class="pun">;</span><span class="pln">j</span><span class="pun">++){</span><span class="pln">
				</span><span class="kwd">if</span><span class="pun">(</span><span class="pln">s</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]==</span><span class="str">'1'</span><span class="pun">){</span><span class="pln">
					ok</span><span class="pun">=</span><span class="lit">0</span><span class="pun">;</span><span class="pln">
					</span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
				</span><span class="pun">}</span><span class="pln">
			</span><span class="pun">}</span><span class="pln">
			ans</span><span class="pun">+=</span><span class="pln">ok</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	cout</span><span class="pun">&lt;&lt;</span><span class="pln">ans</span><span class="pun">&lt;&lt;</span><span class="pln">endl</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">(){</span><span class="pln">
	ios_base</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="kwd">false</span><span class="pun">);</span><span class="pln">
	cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">),</span><span class="pln">cout</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
	</span><span class="kwd">int</span><span class="pln"> T</span><span class="pun">;</span><span class="pln">cin</span><span class="pun">&gt;&gt;</span><span class="pln">T</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">for</span><span class="pun">(;</span><span class="pln">T</span><span class="pun">--;)</span><span class="pln">solve</span><span class="pun">();</span><span class="pln">
	</span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2173/problem/B">2173B-Niko's Tactical Cards</a> Idea &amp; Solution: <a class="rated-user user-red" href="https://codeforces.com/profile/HHH666666" title="Grandmaster HHH666666">HHH666666</a></p> <div class="spoiler"><b class="spoiler-title">Hint 1</b><div class="spoiler-content" style="display: block;"><p>Consider a simple greedy algorithm: For each turn, choose the option that gives the higher immediate score. That is, if our current score is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-88"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-89">k</span></span></span><script type="math/tex" id="MathJax-Element-16">k</script>, it becomes <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-90"><span class="MJXp-mo" id="MJXp-Span-91" style="margin-left: 0.333em; margin-right: 0.333em;">max</span><span class="MJXp-mo" id="MJXp-Span-92" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-93">k</span><span class="MJXp-mo" id="MJXp-Span-94" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-95"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-96" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-97" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-98" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-99"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-100" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-101" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-102" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-103">k</span><span class="MJXp-mo" id="MJXp-Span-104" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-17">\max(k - a_i, b_i - k)</script> after this turn. Why doesn't the algorithm work?</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 2</b><div class="spoiler-content" style="display: block;"><p>Try to improve the algorithm in Hint 1.</p></div></div> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><p>The greedy approach in Hint 1 fails because it assumes that if we know the maximum possible score after turn <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-105"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-106">i</span></span></span><script type="math/tex" id="MathJax-Element-18">i</script> (denoted by <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-107"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-108">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-109">a</span><span class="MJXp-msubsup" id="MJXp-Span-110"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-111" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-112" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-19">max_i</script>), we can determine <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-113"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-114">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-115">a</span><span class="MJXp-msubsup" id="MJXp-Span-116"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-117" style="margin-right: 0.05em;">x</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-118" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-119">i</span><span class="MJXp-mo" id="MJXp-Span-120">+</span><span class="MJXp-mn" id="MJXp-Span-121">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-20">max_{i + 1}</script> from it. However, this assumption is wrong and here is a counterexample:</p><p><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-122"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-123">a</span><span class="MJXp-mo" id="MJXp-Span-124" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-125" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mn" id="MJXp-Span-126">2</span><span class="MJXp-mo" id="MJXp-Span-127" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-128">0</span><span class="MJXp-mo" id="MJXp-Span-129" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-130" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-131">b</span><span class="MJXp-mo" id="MJXp-Span-132" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-133" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mn" id="MJXp-Span-134">1</span><span class="MJXp-mo" id="MJXp-Span-135" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-136">0</span><span class="MJXp-mo" id="MJXp-Span-137" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-21">a = [2, 0], b = [1, 0]</script></p><p>Here <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-138"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-139">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-140">a</span><span class="MJXp-msubsup" id="MJXp-Span-141"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-142" style="margin-right: 0.05em;">x</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-143" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-144" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-145">1</span></span></span><script type="math/tex" id="MathJax-Element-22">max_1 = 1</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-146"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-147">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-148">a</span><span class="MJXp-msubsup" id="MJXp-Span-149"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-150" style="margin-right: 0.05em;">x</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-151" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-152" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-153">2</span></span></span><script type="math/tex" id="MathJax-Element-23">max_2 = 2</script>. The greedy approach takes the blue card in turn <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-154"><span class="MJXp-mn" id="MJXp-Span-155">1</span></span></span><script type="math/tex" id="MathJax-Element-24">1</script>. But to reach <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-156"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-157">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-158">a</span><span class="MJXp-msubsup" id="MJXp-Span-159"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-160" style="margin-right: 0.05em;">x</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-161" style="vertical-align: -0.4em;">2</span></span></span></span><script type="math/tex" id="MathJax-Element-25">max_2</script>, we must choose the red card in turn <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-162"><span class="MJXp-mn" id="MJXp-Span-163">1</span></span></span><script type="math/tex" id="MathJax-Element-26">1</script>, which turns our score into <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-164"><span class="MJXp-mo" id="MJXp-Span-165" style="margin-left: 0em; margin-right: 0.111em;">−</span><span class="MJXp-mn" id="MJXp-Span-166">2</span></span></span><script type="math/tex" id="MathJax-Element-27">-2</script>, and then choose the blue card in turn <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-167"><span class="MJXp-mn" id="MJXp-Span-168">2</span></span></span><script type="math/tex" id="MathJax-Element-28">2</script>. So in this example, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-169"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-170">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-171">a</span><span class="MJXp-msubsup" id="MJXp-Span-172"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-173" style="margin-right: 0.05em;">x</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-174" style="vertical-align: -0.4em;">1</span></span></span></span><script type="math/tex" id="MathJax-Element-29">max_1</script> does not give <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-175"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-176">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-177">a</span><span class="MJXp-msubsup" id="MJXp-Span-178"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-179" style="margin-right: 0.05em;">x</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-180" style="vertical-align: -0.4em;">2</span></span></span></span><script type="math/tex" id="MathJax-Element-30">max_2</script>. </p><p>We see that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-181"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-182">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-183">a</span><span class="MJXp-msubsup" id="MJXp-Span-184"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-185" style="margin-right: 0.05em;">x</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-186" style="vertical-align: -0.4em;">1</span></span></span></span><script type="math/tex" id="MathJax-Element-31">max_1</script> does not help us find <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-187"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-188">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-189">a</span><span class="MJXp-msubsup" id="MJXp-Span-190"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-191" style="margin-right: 0.05em;">x</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-192" style="vertical-align: -0.4em;">2</span></span></span></span><script type="math/tex" id="MathJax-Element-32">max_2</script> if we choose the blue card in the second turn. The reason is, if we want to maximize our score when choosing a blue card, we want our current score to be as <strong>small</strong> as possible, so we are looking for the minimum possible score. To maximize <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-193"><span class="MJXp-msubsup" id="MJXp-Span-194"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-195" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-196" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-197" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-198">k</span></span></span><script type="math/tex" id="MathJax-Element-33">b_i - k</script> we should minimize <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-199"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-200">k</span></span></span><script type="math/tex" id="MathJax-Element-34">k</script>. </p><p>From this we can see that if we have both the maximum possible score <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-201"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-202">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-203">a</span><span class="MJXp-msubsup" id="MJXp-Span-204"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-205" style="margin-right: 0.05em;">x</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-206" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-207">i</span><span class="MJXp-mo" id="MJXp-Span-208">−</span><span class="MJXp-mn" id="MJXp-Span-209">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-35">max_{i - 1}</script> and the minimum possible score <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-210"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-211">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-212">i</span><span class="MJXp-msubsup" id="MJXp-Span-213"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-214" style="margin-right: 0.05em;">n</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-215" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-216">i</span><span class="MJXp-mo" id="MJXp-Span-217">−</span><span class="MJXp-mn" id="MJXp-Span-218">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-36">min_{i - 1}</script> after turn <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-219"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-220">i</span><span class="MJXp-mo" id="MJXp-Span-221" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-222">1</span></span></span><script type="math/tex" id="MathJax-Element-37">i - 1</script>, we can determine <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-223"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-224">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-225">a</span><span class="MJXp-msubsup" id="MJXp-Span-226"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-227" style="margin-right: 0.05em;">x</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-228" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-229">i</span></span></span><span class="MJXp-mo" id="MJXp-Span-230" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-231" style="margin-left: 0.333em; margin-right: 0.333em;">max</span><span class="MJXp-mo" id="MJXp-Span-232" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-233">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-234">a</span><span class="MJXp-msubsup" id="MJXp-Span-235"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-236" style="margin-right: 0.05em;">x</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-237" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-238">i</span><span class="MJXp-mo" id="MJXp-Span-239">−</span><span class="MJXp-mn" id="MJXp-Span-240">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-241" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-242"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-243" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-244" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-245" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-246"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-247" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-248" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-249" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-250">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-251">i</span><span class="MJXp-msubsup" id="MJXp-Span-252"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-253" style="margin-right: 0.05em;">n</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-254" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-255">i</span><span class="MJXp-mo" id="MJXp-Span-256">−</span><span class="MJXp-mn" id="MJXp-Span-257">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-258" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-38">max_{i} = \max(max_{i - 1} - a_i, b_i - min_{i - 1})</script>, because these two expressions cover the best outcomes from the red and blue options respectively. Similarly, the new minimum <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-259"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-260">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-261">i</span><span class="MJXp-msubsup" id="MJXp-Span-262"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-263" style="margin-right: 0.05em;">n</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-264" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-265">i</span></span></span><span class="MJXp-mo" id="MJXp-Span-266" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-267" style="margin-left: 0.333em; margin-right: 0.333em;">min</span><span class="MJXp-mo" id="MJXp-Span-268" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-269">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-270">i</span><span class="MJXp-msubsup" id="MJXp-Span-271"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-272" style="margin-right: 0.05em;">n</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-273" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-274">i</span><span class="MJXp-mo" id="MJXp-Span-275">−</span><span class="MJXp-mn" id="MJXp-Span-276">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-277" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-278"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-279" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-280" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-281" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-282"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-283" style="margin-right: 0.05em;">b</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-284" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-285" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-286">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-287">a</span><span class="MJXp-msubsup" id="MJXp-Span-288"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-289" style="margin-right: 0.05em;">x</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-290" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-291">i</span><span class="MJXp-mo" id="MJXp-Span-292">−</span><span class="MJXp-mn" id="MJXp-Span-293">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-294" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-39">min_{i} = \min(min_{i - 1} - a_i, b_i - max_{i - 1})</script> comes from either taking the red card from the previous minimum, or the blue card from the previous maximum. And from <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-295"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-296">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-297">a</span><span class="MJXp-msubsup" id="MJXp-Span-298"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-299" style="margin-right: 0.05em;">x</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-300" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-301">i</span></span></span><span class="MJXp-mo" id="MJXp-Span-302" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-303">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-304">i</span><span class="MJXp-msubsup" id="MJXp-Span-305"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-306" style="margin-right: 0.05em;">n</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-307" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-308">i</span></span></span></span></span><script type="math/tex" id="MathJax-Element-40">max_{i}, min_{i}</script> we can move forward to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-309"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-310">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-311">a</span><span class="MJXp-msubsup" id="MJXp-Span-312"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-313" style="margin-right: 0.05em;">x</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-314" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-315">i</span><span class="MJXp-mo" id="MJXp-Span-316">+</span><span class="MJXp-mn" id="MJXp-Span-317">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-318" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-319">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-320">i</span><span class="MJXp-msubsup" id="MJXp-Span-321"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-322" style="margin-right: 0.05em;">n</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-323" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-324">i</span><span class="MJXp-mo" id="MJXp-Span-325">+</span><span class="MJXp-mn" id="MJXp-Span-326">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-41">max_{i + 1}, min_{i + 1}</script> and so on.</p><p>Thus, we start with <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-327"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-328">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-329">a</span><span class="MJXp-msubsup" id="MJXp-Span-330"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-331" style="margin-right: 0.05em;">x</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-332" style="vertical-align: -0.4em;">0</span></span><span class="MJXp-mo" id="MJXp-Span-333" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-334">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-335">i</span><span class="MJXp-msubsup" id="MJXp-Span-336"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-337" style="margin-right: 0.05em;">n</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-338" style="vertical-align: -0.4em;">0</span></span><span class="MJXp-mo" id="MJXp-Span-339" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-340">0</span></span></span><script type="math/tex" id="MathJax-Element-42">max_0 = min_0 = 0</script> and calculate each <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-341"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-342">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-343">a</span><span class="MJXp-msubsup" id="MJXp-Span-344"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-345" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-346" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-347" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-348">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-349">i</span><span class="MJXp-msubsup" id="MJXp-Span-350"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-351" style="margin-right: 0.05em;">n</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-352" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-43">max_i, min_i</script> throughout the process using the formulas above. The answer is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-353"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-354">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-355">a</span><span class="MJXp-msubsup" id="MJXp-Span-356"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-357" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-358" style="vertical-align: -0.4em;">n</span></span></span></span><script type="math/tex" id="MathJax-Element-44">max_n</script>. This runs in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-359"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-360">O</span><span class="MJXp-mo" id="MJXp-Span-361" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-362">n</span><span class="MJXp-mo" id="MJXp-Span-363" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-45">O(n)</script> time complexity.</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="com">#define</span><span class="pln"> ll </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pln">

</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> MAXN </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1e5</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">10</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">MAXN</span><span class="pun">],</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">MAXN</span><span class="pun">];</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">;</span><span class="pln"> cin </span><span class="pun">&gt;&gt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">t</span><span class="pun">--)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> cin </span><span class="pun">&gt;&gt;</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> cin </span><span class="pun">&gt;&gt;</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
        ll mx </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> mn </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            ll new_mx </span><span class="pun">=</span><span class="pln"> max</span><span class="pun">(</span><span class="pln">mx </span><span class="pun">-</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">],</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> mn</span><span class="pun">);</span><span class="pln">
            ll new_mn </span><span class="pun">=</span><span class="pln"> min</span><span class="pun">(</span><span class="pln">mn </span><span class="pun">-</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">],</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> mx</span><span class="pun">);</span><span class="pln">
            mx </span><span class="pun">=</span><span class="pln"> new_mx</span><span class="pun">,</span><span class="pln"> mn </span><span class="pun">=</span><span class="pln"> new_mn</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        cout </span><span class="pun">&lt;&lt;</span><span class="pln"> mx </span><span class="pun">&lt;&lt;</span><span class="pln"> endl</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2173/problem/C">2173C-Kanade's Perfect Multiples</a> Idea &amp; Solution: <a class="rated-user user-red" href="https://codeforces.com/profile/paulzrm" title="Grandmaster paulzrm">paulzrm</a></p> <div class="spoiler"><b class="spoiler-title">Hint 1</b><div class="spoiler-content" style="display: block;"><p>Consider the cases <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-364"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-365">n</span><span class="MJXp-mo" id="MJXp-Span-366" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-367">1</span></span></span><script type="math/tex" id="MathJax-Element-46">n = 1</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-368"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-369">n</span><span class="MJXp-mo" id="MJXp-Span-370" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-371">2</span></span></span><script type="math/tex" id="MathJax-Element-47">n = 2</script>. What do you observe?</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 2</b><div class="spoiler-content" style="display: block;"><p>Try to determine the "first" element that must belong to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-372"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-373">B</span></span></span><script type="math/tex" id="MathJax-Element-48">B</script>.</p></div></div> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><p>Assume the minimum element in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-374"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-375">A</span></span></span><script type="math/tex" id="MathJax-Element-49">A</script> is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-376"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-377">x</span></span></span><script type="math/tex" id="MathJax-Element-50">x</script>. We now prove that <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-378"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-379">x</span></span></span><script type="math/tex" id="MathJax-Element-51">x</script> must be included in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-380"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-381">B</span></span></span><script type="math/tex" id="MathJax-Element-52">B</script>.</p><p>There are no elements smaller than <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-382"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-383">x</span></span></span><script type="math/tex" id="MathJax-Element-53">x</script>, which means <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-384"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-385">x</span></span></span><script type="math/tex" id="MathJax-Element-54">x</script> has no proper divisor (other than <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-386"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-387">x</span></span></span><script type="math/tex" id="MathJax-Element-55">x</script> itself) inside <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-388"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-389">A</span></span></span><script type="math/tex" id="MathJax-Element-56">A</script>. If we do <strong>not</strong> put <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-390"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-391">x</span></span></span><script type="math/tex" id="MathJax-Element-57">x</script> into <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-392"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-393">B</span></span></span><script type="math/tex" id="MathJax-Element-58">B</script>, then the second rule would be violated.</p><p>Thus we can determine the first element of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-394"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-395">B</span></span></span><script type="math/tex" id="MathJax-Element-59">B</script>, and then check whether all its multiples <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-396"><span class="MJXp-mo" id="MJXp-Span-397" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-398">k</span></span></span><script type="math/tex" id="MathJax-Element-60">\le k</script> are contained in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-399"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-400">A</span></span></span><script type="math/tex" id="MathJax-Element-61">A</script>. We mark these multiples as "finished".</p><p>Now think greedily. We never need to process elements that are already marked "finished". Each time, we just find the smallest unfinished element in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-401"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-402">A</span></span></span><script type="math/tex" id="MathJax-Element-62">A</script>, check it, and add it to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-403"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-404">B</span></span></span><script type="math/tex" id="MathJax-Element-63">B</script> if possible.</p><p>A loose upper bound on the running time is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-405"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-406">O</span><span class="MJXp-mstyle" id="MJXp-Span-407"><span class="MJXp-mrow" id="MJXp-Span-408"><span class="MJXp-mo" id="MJXp-Span-409" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.083em;"><span class="MJXp-right MJXp-scale10" style="font-size: 1.333em; margin-left: 0.07em;">(</span></span></span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-410">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-411">d</span><span class="MJXp-mo" id="MJXp-Span-412" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-413">n</span><span class="MJXp-mo" id="MJXp-Span-414" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mi" id="MJXp-Span-415">log</span><span class="MJXp-mo" id="MJXp-Span-416" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-417">n</span><span class="MJXp-mstyle" id="MJXp-Span-418"><span class="MJXp-mrow" id="MJXp-Span-419"><span class="MJXp-mo" id="MJXp-Span-420" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.083em;"><span class="MJXp-right MJXp-scale10" style="font-size: 1.333em; margin-left: 0.07em;">)</span></span></span></span></span></span><script type="math/tex" id="MathJax-Element-64">O\bigl(n d(n) \log n\bigr)</script>, where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-421"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-422">d</span><span class="MJXp-mo" id="MJXp-Span-423" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-424">n</span><span class="MJXp-mo" id="MJXp-Span-425" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-65">d(n)</script> is the divisor function. However, this bound is rarely attained in practice: many operations are skipped thanks to the "finished" marks, so the algorithm runs much faster than this worst-case estimate.</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> mxn</span><span class="pun">=</span><span class="lit">2e5</span><span class="pun">+</span><span class="lit">5</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">set</span><span class="str">&lt;int&gt;</span><span class="pln">s</span><span class="pun">;</span><span class="pln">
map</span><span class="pun">&lt;</span><span class="kwd">int</span><span class="pun">,</span><span class="kwd">int</span><span class="pun">&gt;</span><span class="pln">u</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">,</span><span class="pln">a</span><span class="pun">[</span><span class="pln">mxn</span><span class="pun">],</span><span class="pln">k</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">void</span><span class="pln"> solve</span><span class="pun">(){</span><span class="pln">
	s</span><span class="pun">.</span><span class="pln">clear</span><span class="pun">(),</span><span class="pln">u</span><span class="pun">.</span><span class="pln">clear</span><span class="pun">();</span><span class="pln">
	cin</span><span class="pun">&gt;&gt;</span><span class="pln">n</span><span class="pun">&gt;&gt;</span><span class="pln">k</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i</span><span class="pun">=</span><span class="lit">1</span><span class="pun">;</span><span class="pln">i</span><span class="pun">&lt;=</span><span class="pln">n</span><span class="pun">;</span><span class="pln">i</span><span class="pun">++)</span><span class="pln">cin</span><span class="pun">&gt;&gt;</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">],</span><span class="pln">s</span><span class="pun">.</span><span class="pln">insert</span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]),</span><span class="pln">u</span><span class="pun">[</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]]=</span><span class="lit">1</span><span class="pun">;</span><span class="pln">
	vector</span><span class="str">&lt;int&gt;</span><span class="pln">ans</span><span class="pun">;</span><span class="pln">ans</span><span class="pun">.</span><span class="pln">clear</span><span class="pun">();</span><span class="pln">
	</span><span class="kwd">while</span><span class="pun">(</span><span class="pln">s</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()){</span><span class="pln">
		</span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">=*</span><span class="pln">s</span><span class="pun">.</span><span class="kwd">begin</span><span class="pun">();</span><span class="pln">
		ans</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">t</span><span class="pun">);</span><span class="pln">
		s</span><span class="pun">.</span><span class="pln">erase</span><span class="pun">(</span><span class="pln">s</span><span class="pun">.</span><span class="kwd">begin</span><span class="pun">());</span><span class="pln">
		</span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> cur</span><span class="pun">=</span><span class="pln">t</span><span class="pun">;</span><span class="pln">cur</span><span class="pun">&lt;=</span><span class="pln">k</span><span class="pun">;</span><span class="pln">cur</span><span class="pun">+=</span><span class="pln">t</span><span class="pun">){</span><span class="pln">
			</span><span class="kwd">if</span><span class="pun">(!</span><span class="pln">u</span><span class="pun">[</span><span class="pln">cur</span><span class="pun">]){</span><span class="pln">
				cout</span><span class="pun">&lt;&lt;</span><span class="str">"-1\n"</span><span class="pun">;</span><span class="pln">
				</span><span class="kwd">return</span><span class="pun">;</span><span class="pln">
			</span><span class="pun">}</span><span class="pln">
			</span><span class="kwd">auto</span><span class="pln"> t</span><span class="pun">=</span><span class="pln">s</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln">cur</span><span class="pun">);</span><span class="pln">
			</span><span class="kwd">if</span><span class="pun">(</span><span class="pln">t</span><span class="pun">!=</span><span class="pln">s</span><span class="pun">.</span><span class="kwd">end</span><span class="pun">())</span><span class="pln">s</span><span class="pun">.</span><span class="pln">erase</span><span class="pun">(</span><span class="pln">t</span><span class="pun">);</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	cout</span><span class="pun">&lt;&lt;</span><span class="pln">ans</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()&lt;&lt;</span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i</span><span class="pun">:</span><span class="pln">ans</span><span class="pun">)</span><span class="pln">cout</span><span class="pun">&lt;&lt;</span><span class="pln">i</span><span class="pun">&lt;&lt;</span><span class="str">' '</span><span class="pun">;</span><span class="pln">cout</span><span class="pun">&lt;&lt;</span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">(){</span><span class="pln">
	ios_base</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="kwd">false</span><span class="pun">);</span><span class="pln">
	cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">),</span><span class="pln">cout</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
	</span><span class="kwd">int</span><span class="pln"> T</span><span class="pun">=</span><span class="lit">1</span><span class="pun">;</span><span class="pln">
	cin</span><span class="pun">&gt;&gt;</span><span class="pln">T</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">for</span><span class="pun">(;</span><span class="pln">T</span><span class="pun">--;)</span><span class="pln">solve</span><span class="pun">();</span><span class="pln">
	</span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2173/problem/D">2173D-Taiga's Carry Chains</a> Idea: <a class="rated-user user-red" href="https://codeforces.com/profile/chen_zida" title="Grandmaster chen_zida">chen_zida</a> Solution: <a class="rated-user user-red" href="https://codeforces.com/profile/paulzrm" title="Grandmaster paulzrm">paulzrm</a></p> <div class="spoiler"><b class="spoiler-title">Hint 1</b><div class="spoiler-content" style="display: block;"><p>What is the answer when <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-426"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-427">k</span><span class="MJXp-mo" id="MJXp-Span-428" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mn" id="MJXp-Span-429">32</span></span></span><script type="math/tex" id="MathJax-Element-66">k \geq 32</script>?</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 2</b><div class="spoiler-content" style="display: block;"><p>We can use dynamic programming to solve it.</p></div></div> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><p>When <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-430"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-431">k</span><span class="MJXp-mo" id="MJXp-Span-432" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mn" id="MJXp-Span-433">32</span></span></span><script type="math/tex" id="MathJax-Element-67">k \geq 32</script>, we can, at each step, add the smallest <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-434"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-435">t</span></span></span><script type="math/tex" id="MathJax-Element-68">t</script> such that adding <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-436"><span class="MJXp-msubsup" id="MJXp-Span-437"><span class="MJXp-mn" id="MJXp-Span-438" style="margin-right: 0.05em;">2</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-439" style="vertical-align: 0.5em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-440">t</span></span></span></span></span><script type="math/tex" id="MathJax-Element-69">2^{t}</script> to the current <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-441"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-442">n</span></span></span><script type="math/tex" id="MathJax-Element-70">n</script> produces a carry. After <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-443"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-444">k</span></span></span><script type="math/tex" id="MathJax-Element-71">k</script> such steps, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-445"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-446">n</span></span></span><script type="math/tex" id="MathJax-Element-72">n</script> will become a power of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-447"><span class="MJXp-mn" id="MJXp-Span-448">2</span></span></span><script type="math/tex" id="MathJax-Element-73">2</script>, and the answer will be <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-449"><span class="MJXp-mi" id="MJXp-Span-450">popcount</span><span class="MJXp-mo" id="MJXp-Span-451" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-452" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-453">n</span><span class="MJXp-mo" id="MJXp-Span-454" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-455" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-456">k</span><span class="MJXp-mo" id="MJXp-Span-457" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-458">1</span></span></span><script type="math/tex" id="MathJax-Element-74">\operatorname{popcount}(n) + k - 1</script>.</p><p>Now we observe that the total number of carries in the end is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-459"><span class="MJXp-mi" id="MJXp-Span-460">popcount</span><span class="MJXp-mo" id="MJXp-Span-461" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-462" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-463">n</span><span class="MJXp-mo" id="MJXp-Span-464" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-465" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-466">k</span><span class="MJXp-mo" id="MJXp-Span-467" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi" id="MJXp-Span-468">popcount</span><span class="MJXp-mo" id="MJXp-Span-469" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-470" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msup" id="MJXp-Span-471"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-472" style="margin-right: 0.05em;">n</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-473" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-474" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-75">\operatorname{popcount}(n) + k - \operatorname{popcount}(n')</script>, where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-475"><span class="MJXp-msup" id="MJXp-Span-476"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-477" style="margin-right: 0.05em;">n</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-478" style="vertical-align: 0.5em;">′</span></span></span></span><script type="math/tex" id="MathJax-Element-76">n'</script> is the final value of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-479"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-480">n</span></span></span><script type="math/tex" id="MathJax-Element-77">n</script> after all operations. To maximize this quantity, we want to minimize the final <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-481"><span class="MJXp-mi" id="MJXp-Span-482">popcount</span><span class="MJXp-mo" id="MJXp-Span-483" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-484" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msup" id="MJXp-Span-485"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-486" style="margin-right: 0.05em;">n</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-487" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-488" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-78">\operatorname{popcount}(n')</script>.</p><p>To this end, let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-489"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-490">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-491">p</span><span class="MJXp-mo" id="MJXp-Span-492" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-493">i</span><span class="MJXp-mo" id="MJXp-Span-494" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-495" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-496">j</span><span class="MJXp-mo" id="MJXp-Span-497" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-498" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-499">c</span><span class="MJXp-mo" id="MJXp-Span-500" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-79">dp[i][j][c]</script> denote the optimal value we can obtain after processing the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-501"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-502">i</span></span></span><script type="math/tex" id="MathJax-Element-80">i</script> least significant bits, having used <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-503"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-504">j</span></span></span><script type="math/tex" id="MathJax-Element-81">j</script> operations in total, where <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-505"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-506">c</span><span class="MJXp-mo" id="MJXp-Span-507" style="margin-left: 0.333em; margin-right: 0.333em;">∈</span><span class="MJXp-mrow" id="MJXp-Span-508"><span class="MJXp-mn" id="MJXp-Span-509">0</span><span class="MJXp-mo" id="MJXp-Span-510" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-511">1</span></span></span></span><script type="math/tex" id="MathJax-Element-82">c \in {0,1}</script> indicates whether there is a carry from the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-512"><span class="MJXp-mo" id="MJXp-Span-513" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-514">i</span><span class="MJXp-mo" id="MJXp-Span-515" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-516">1</span><span class="MJXp-mo" id="MJXp-Span-517" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-83">(i-1)</script>-th bit.</p><p>For the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-518"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-519">i</span></span></span><script type="math/tex" id="MathJax-Element-84">i</script>-th least significant bit, we have two options: either select this bit (i.e., use one operation on this bit) or not select it.</p><p>Let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-520"><span class="MJXp-msubsup" id="MJXp-Span-521"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-522" style="margin-right: 0.05em;">n</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-523" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-85">n_i</script> be the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-524"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-525">i</span></span></span><script type="math/tex" id="MathJax-Element-86">i</script>-th bit of the original <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-526"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-527">n</span></span></span><script type="math/tex" id="MathJax-Element-87">n</script>, and let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-528"><span class="MJXp-msubsup" id="MJXp-Span-529"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-530" style="margin-right: 0.05em;">t</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-531" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-88">t_i</script> be the sum at this bit after adding everything in. If we select this bit, then <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-532"><span class="MJXp-msubsup" id="MJXp-Span-533"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-534" style="margin-right: 0.05em;">t</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-535" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-536" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-537">1</span><span class="MJXp-mo" id="MJXp-Span-538" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-539">c</span><span class="MJXp-mo" id="MJXp-Span-540" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-541"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-542" style="margin-right: 0.05em;">n</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-543" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-89">t_i = 1 + c + n_i</script>; otherwise, <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-544"><span class="MJXp-msubsup" id="MJXp-Span-545"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-546" style="margin-right: 0.05em;">t</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-547" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-548" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-549">c</span><span class="MJXp-mo" id="MJXp-Span-550" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-551"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-552" style="margin-right: 0.05em;">n</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-553" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-90">t_i = c + n_i</script>. From <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-554"><span class="MJXp-msubsup" id="MJXp-Span-555"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-556" style="margin-right: 0.05em;">t</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-557" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-91">t_i</script>, we can determine whether this bit produces a carry to the next position (the next carry is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-558"><span class="MJXp-msup" id="MJXp-Span-559"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-560" style="margin-right: 0.05em;">c</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-561" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-562" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-563" style="margin-left: 0em; margin-right: 0em;">⌊</span><span class="MJXp-msubsup" id="MJXp-Span-564"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-565" style="margin-right: 0.05em;">t</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-566" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mrow" id="MJXp-Span-567"><span class="MJXp-mo" id="MJXp-Span-568" style="margin-left: 0.111em; margin-right: 0.111em;">/</span></span><span class="MJXp-mn" id="MJXp-Span-569">2</span><span class="MJXp-mo" id="MJXp-Span-570" style="margin-left: 0em; margin-right: 0em;">⌋</span></span></span><script type="math/tex" id="MathJax-Element-92">c' = \lfloor t_i / 2 \rfloor</script>) and whether the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-571"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-572">i</span></span></span><script type="math/tex" id="MathJax-Element-93">i</script>-th bit of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-573"><span class="MJXp-msup" id="MJXp-Span-574"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-575" style="margin-right: 0.05em;">n</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-576" style="vertical-align: 0.5em;">′</span></span></span></span><script type="math/tex" id="MathJax-Element-94">n'</script> is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-577"><span class="MJXp-mn" id="MJXp-Span-578">1</span></span></span><script type="math/tex" id="MathJax-Element-95">1</script> or <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-579"><span class="MJXp-mn" id="MJXp-Span-580">0</span></span></span><script type="math/tex" id="MathJax-Element-96">0</script> (the resulting bit is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-581"><span class="MJXp-msubsup" id="MJXp-Span-582"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-583" style="margin-right: 0.05em;">t</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-584" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-585" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mn" id="MJXp-Span-586">2</span></span></span><script type="math/tex" id="MathJax-Element-97">t_i \bmod 2</script>), which allows us to perform the DP transition.</p><p>The time complexity is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-587"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-588">O</span><span class="MJXp-mo" id="MJXp-Span-589" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mo" id="MJXp-Span-590" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-591"><span class="MJXp-mi" id="MJXp-Span-592" style="margin-right: 0.05em;">log</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-593" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-594" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-595">n</span><span class="MJXp-msubsup" id="MJXp-Span-596"><span class="MJXp-mo" id="MJXp-Span-597" style="margin-left: 0em; margin-right: 0.05em;">)</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-598" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-599" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-98">O((\log_2 n)^2)</script>.</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="com">#define</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> inf</span><span class="pun">=</span><span class="lit">1e9</span><span class="pun">+</span><span class="lit">7</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> mxb</span><span class="pun">=</span><span class="lit">64</span><span class="pun">,</span><span class="pln">mxk</span><span class="pun">=</span><span class="lit">32</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> dp</span><span class="pun">[</span><span class="pln">mxb</span><span class="pun">+</span><span class="lit">2</span><span class="pun">][</span><span class="pln">mxk</span><span class="pun">+</span><span class="lit">2</span><span class="pun">][</span><span class="lit">2</span><span class="pun">];</span><span class="pln">
</span><span class="kwd">void</span><span class="pln"> </span><span class="typ">Min</span><span class="pun">(</span><span class="kwd">int</span><span class="pun">&amp;</span><span class="pln">x</span><span class="pun">,</span><span class="kwd">int</span><span class="pln"> y</span><span class="pun">){</span><span class="pln">x</span><span class="pun">=</span><span class="pln">min</span><span class="pun">(</span><span class="pln">x</span><span class="pun">,</span><span class="pln">y</span><span class="pun">);}</span><span class="pln">
</span><span class="kwd">void</span><span class="pln"> solve</span><span class="pun">(){</span><span class="pln">
	</span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">,</span><span class="pln">k</span><span class="pun">;</span><span class="pln">cin</span><span class="pun">&gt;&gt;</span><span class="pln">n</span><span class="pun">&gt;&gt;</span><span class="pln">k</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">int</span><span class="pln"> pc</span><span class="pun">=</span><span class="pln">__builtin_popcount</span><span class="pun">(</span><span class="pln">n</span><span class="pun">);</span><span class="pln">
	</span><span class="kwd">if</span><span class="pun">(</span><span class="pln">n</span><span class="pun">==</span><span class="lit">0</span><span class="pun">){</span><span class="pln">
		cout</span><span class="pun">&lt;&lt;</span><span class="pln">max</span><span class="pun">(</span><span class="lit">0ll</span><span class="pun">,</span><span class="pln">k</span><span class="pun">-</span><span class="lit">1</span><span class="pun">)&lt;&lt;</span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">return</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	</span><span class="kwd">if</span><span class="pun">(</span><span class="pln">k</span><span class="pun">&gt;=</span><span class="lit">32</span><span class="pun">){</span><span class="pln">
		cout</span><span class="pun">&lt;&lt;</span><span class="pln">k</span><span class="pun">+</span><span class="pln">pc</span><span class="pun">-</span><span class="lit">1</span><span class="pun">&lt;&lt;</span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">return</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	</span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i</span><span class="pun">=</span><span class="lit">0</span><span class="pun">;</span><span class="pln">i</span><span class="pun">&lt;=</span><span class="pln">mxb</span><span class="pun">;</span><span class="pln">i</span><span class="pun">++)</span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j</span><span class="pun">=</span><span class="lit">0</span><span class="pun">;</span><span class="pln">j</span><span class="pun">&lt;=</span><span class="pln">k</span><span class="pun">;</span><span class="pln">j</span><span class="pun">++)</span><span class="pln">dp</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">][</span><span class="lit">0</span><span class="pun">]=</span><span class="pln">dp</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">][</span><span class="lit">1</span><span class="pun">]=</span><span class="pln">inf</span><span class="pun">;</span><span class="pln">
	dp</span><span class="pun">[</span><span class="lit">0</span><span class="pun">][</span><span class="lit">0</span><span class="pun">][</span><span class="lit">0</span><span class="pun">]=</span><span class="lit">0</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i</span><span class="pun">=</span><span class="lit">0</span><span class="pun">;</span><span class="pln">i</span><span class="pun">&lt;</span><span class="pln">mxb</span><span class="pun">;</span><span class="pln">i</span><span class="pun">++){</span><span class="pln">
		</span><span class="kwd">int</span><span class="pln"> ni</span><span class="pun">=(</span><span class="pln">n</span><span class="pun">&gt;&gt;</span><span class="pln">i</span><span class="pun">)&amp;</span><span class="lit">1ll</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> u</span><span class="pun">=</span><span class="lit">0</span><span class="pun">;</span><span class="pln">u</span><span class="pun">&lt;=</span><span class="pln">k</span><span class="pun">;</span><span class="pln">u</span><span class="pun">++)</span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> c</span><span class="pun">=</span><span class="lit">0</span><span class="pun">;</span><span class="pln">c</span><span class="pun">&lt;=</span><span class="lit">1</span><span class="pun">;</span><span class="pln">c</span><span class="pun">++){</span><span class="pln">
			</span><span class="kwd">int</span><span class="pln"> cur</span><span class="pun">=</span><span class="pln">dp</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">u</span><span class="pun">][</span><span class="pln">c</span><span class="pun">];</span><span class="pln">
			</span><span class="kwd">if</span><span class="pun">(</span><span class="pln">cur</span><span class="pun">&gt;=</span><span class="pln">inf</span><span class="pun">)</span><span class="kwd">continue</span><span class="pun">;</span><span class="pln">
			</span><span class="pun">{</span><span class="pln">
				</span><span class="kwd">int</span><span class="pln"> sum</span><span class="pun">=</span><span class="pln">ni</span><span class="pun">+</span><span class="pln">c</span><span class="pun">,</span><span class="pln">bit</span><span class="pun">=</span><span class="pln">sum</span><span class="pun">&amp;</span><span class="lit">1</span><span class="pun">,</span><span class="pln">nc</span><span class="pun">=</span><span class="pln">sum</span><span class="pun">&gt;&gt;</span><span class="lit">1</span><span class="pun">;</span><span class="pln">
				</span><span class="typ">Min</span><span class="pun">(</span><span class="pln">dp</span><span class="pun">[</span><span class="pln">i</span><span class="pun">+</span><span class="lit">1</span><span class="pun">][</span><span class="pln">u</span><span class="pun">][</span><span class="pln">nc</span><span class="pun">],</span><span class="pln">cur</span><span class="pun">+</span><span class="pln">bit</span><span class="pun">);</span><span class="pln">		
			</span><span class="pun">}</span><span class="pln">
			</span><span class="kwd">if</span><span class="pun">(</span><span class="pln">u</span><span class="pun">+</span><span class="lit">1</span><span class="pun">&lt;=</span><span class="pln">k</span><span class="pun">){</span><span class="pln">
				</span><span class="kwd">int</span><span class="pln"> sum</span><span class="pun">=</span><span class="pln">ni</span><span class="pun">+</span><span class="lit">1</span><span class="pun">+</span><span class="pln">c</span><span class="pun">,</span><span class="pln">bit</span><span class="pun">=</span><span class="pln">sum</span><span class="pun">&amp;</span><span class="lit">1</span><span class="pun">,</span><span class="pln">nc</span><span class="pun">=</span><span class="pln">sum</span><span class="pun">&gt;&gt;</span><span class="lit">1</span><span class="pun">;</span><span class="pln">
				</span><span class="typ">Min</span><span class="pun">(</span><span class="pln">dp</span><span class="pun">[</span><span class="pln">i</span><span class="pun">+</span><span class="lit">1</span><span class="pun">][</span><span class="pln">u</span><span class="pun">+</span><span class="lit">1</span><span class="pun">][</span><span class="pln">nc</span><span class="pun">],</span><span class="pln">cur</span><span class="pun">+</span><span class="pln">bit</span><span class="pun">);</span><span class="pln">
			</span><span class="pun">}</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	</span><span class="kwd">int</span><span class="pln"> bst</span><span class="pun">=</span><span class="pln">inf</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> u</span><span class="pun">=</span><span class="lit">0</span><span class="pun">;</span><span class="pln">u</span><span class="pun">&lt;=</span><span class="pln">k</span><span class="pun">;</span><span class="pln">u</span><span class="pun">++)</span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> c</span><span class="pun">=</span><span class="lit">0</span><span class="pun">;</span><span class="pln">c</span><span class="pun">&lt;=</span><span class="lit">1</span><span class="pun">;</span><span class="pln">c</span><span class="pun">++){</span><span class="pln">
		</span><span class="kwd">int</span><span class="pln"> val</span><span class="pun">=</span><span class="pln">dp</span><span class="pun">[</span><span class="pln">mxb</span><span class="pun">][</span><span class="pln">u</span><span class="pun">][</span><span class="pln">c</span><span class="pun">];</span><span class="pln">
		</span><span class="kwd">if</span><span class="pun">(</span><span class="pln">val</span><span class="pun">&lt;</span><span class="pln">inf</span><span class="pun">)</span><span class="typ">Min</span><span class="pun">(</span><span class="pln">bst</span><span class="pun">,</span><span class="pln">val</span><span class="pun">+</span><span class="pln">c</span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	</span><span class="kwd">int</span><span class="pln"> ans</span><span class="pun">=</span><span class="pln">k</span><span class="pun">+</span><span class="pln">pc</span><span class="pun">-</span><span class="pln">bst</span><span class="pun">;</span><span class="pln">
	cout</span><span class="pun">&lt;&lt;</span><span class="pln">ans</span><span class="pun">&lt;&lt;</span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">signed</span><span class="pln"> main</span><span class="pun">(){</span><span class="pln">
	ios_base</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="kwd">false</span><span class="pun">);</span><span class="pln">
	cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">),</span><span class="pln">cout</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
	</span><span class="kwd">int</span><span class="pln"> T</span><span class="pun">;</span><span class="pln">cin</span><span class="pun">&gt;&gt;</span><span class="pln">T</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">for</span><span class="pun">(;</span><span class="pln">T</span><span class="pun">--;)</span><span class="pln">solve</span><span class="pun">();</span><span class="pln">
	</span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2173/problem/E">2173E-Shiro's Mirror Duel</a> Idea &amp; Solution: <a class="rated-user user-red" href="https://codeforces.com/profile/paulzrm" title="Grandmaster paulzrm">paulzrm</a> It's my favourite problem :-)</p> <div class="spoiler"><b class="spoiler-title">Hint 1</b><div class="spoiler-content" style="display: block;"><p><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-600"><span class="MJXp-mo" id="MJXp-Span-601" style="margin-left: 0em; margin-right: 0em;">⌊</span><span class="MJXp-mn" id="MJXp-Span-602">2.5</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-603">n</span><span class="MJXp-mo" id="MJXp-Span-604" style="margin-left: 0em; margin-right: 0em;">⌋</span></span></span><script type="math/tex" id="MathJax-Element-99">\lfloor 2.5n\rfloor</script> is the expected number of operations. We add <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-605"><span class="MJXp-mn" id="MJXp-Span-606">800</span></span></span><script type="math/tex" id="MathJax-Element-100">800</script> more to ensure that every correct solution would pass.</p></div></div> <div class="spoiler"><b class="spoiler-title">Hint 2</b><div class="spoiler-content" style="display: block;"><p>Think about how to solve it within <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-607"><span class="MJXp-mn" id="MJXp-Span-608">3</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-609">n</span></span></span><script type="math/tex" id="MathJax-Element-101">3n</script>, and how can we improve that.</p></div></div> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><p>We split the process into two phases. In the first phase, we make every pair <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-610"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-611">x</span></span></span><script type="math/tex" id="MathJax-Element-102">x</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-612"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-613">n</span><span class="MJXp-mo" id="MJXp-Span-614" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-615">x</span><span class="MJXp-mo" id="MJXp-Span-616" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-617">1</span></span></span><script type="math/tex" id="MathJax-Element-103">n - x + 1</script> symmetric; in the second phase, we turn the permutation into <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-618"><span class="MJXp-mn" id="MJXp-Span-619">1</span><span class="MJXp-mo" id="MJXp-Span-620" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-621">2</span><span class="MJXp-mo" id="MJXp-Span-622" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-623" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-624" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-625">n</span></span></span><script type="math/tex" id="MathJax-Element-104">1, 2, \dots, n</script>.</p><p>Let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-626"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-627">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-628">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-629">s</span><span class="MJXp-mo" id="MJXp-Span-630" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-631">x</span><span class="MJXp-mo" id="MJXp-Span-632" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><script type="math/tex" id="MathJax-Element-105">pos[x]</script> be the current position of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-633"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-634">x</span></span></span><script type="math/tex" id="MathJax-Element-106">x</script>. We iterate <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-635"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-636">x</span></span></span><script type="math/tex" id="MathJax-Element-107">x</script> from <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-637"><span class="MJXp-mn" id="MJXp-Span-638">1</span></span></span><script type="math/tex" id="MathJax-Element-108">1</script> to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-639"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-640">n</span></span></span><script type="math/tex" id="MathJax-Element-109">n</script> in increasing order. If <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-641"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-642">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-643">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-644">s</span><span class="MJXp-mo" id="MJXp-Span-645" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-646">x</span><span class="MJXp-mo" id="MJXp-Span-647" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-648" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-649">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-650">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-651">s</span><span class="MJXp-mo" id="MJXp-Span-652" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-653">n</span><span class="MJXp-mo" id="MJXp-Span-654" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-655">1</span><span class="MJXp-mo" id="MJXp-Span-656" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-657">x</span><span class="MJXp-mo" id="MJXp-Span-658" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-659" style="margin-left: 0.333em; margin-right: 0.333em;">≠</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-660">n</span><span class="MJXp-mo" id="MJXp-Span-661" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-662">1</span></span></span><script type="math/tex" id="MathJax-Element-110">pos[x] + pos[n + 1 - x] \neq n + 1</script>, then <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-663"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-664">x</span></span></span><script type="math/tex" id="MathJax-Element-111">x</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-665"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-666">n</span><span class="MJXp-mo" id="MJXp-Span-667" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-668">1</span><span class="MJXp-mo" id="MJXp-Span-669" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-670">x</span></span></span><script type="math/tex" id="MathJax-Element-112">n + 1 - x</script> are not symmetric. In this case, we query <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-671"><span class="MJXp-mo" id="MJXp-Span-672" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-673">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-674">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-675">s</span><span class="MJXp-mo" id="MJXp-Span-676" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-677">x</span><span class="MJXp-mo" id="MJXp-Span-678" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-679" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mspace" id="MJXp-Span-680" style="width: 0.167em; height: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-681">n</span><span class="MJXp-mo" id="MJXp-Span-682" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-683">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-684">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-685">s</span><span class="MJXp-mo" id="MJXp-Span-686" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-687">n</span><span class="MJXp-mo" id="MJXp-Span-688" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-689">1</span><span class="MJXp-mo" id="MJXp-Span-690" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-691">x</span><span class="MJXp-mo" id="MJXp-Span-692" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mo" id="MJXp-Span-693" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-694">1</span><span class="MJXp-mo" id="MJXp-Span-695" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-113">(pos[x],\, n - pos[n + 1 - x] + 1)</script>. No matter whether the interactive judge mirrors the array and then swaps or not, this operation will always make <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-696"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-697">x</span></span></span><script type="math/tex" id="MathJax-Element-114">x</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-698"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-699">n</span><span class="MJXp-mo" id="MJXp-Span-700" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-701">1</span><span class="MJXp-mo" id="MJXp-Span-702" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-703">x</span></span></span><script type="math/tex" id="MathJax-Element-115">n + 1 - x</script> symmetric. When <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-704"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-705">n</span></span></span><script type="math/tex" id="MathJax-Element-116">n</script> is odd, we should first move <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-706"><span class="MJXp-mo" id="MJXp-Span-707" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-708">n</span><span class="MJXp-mo" id="MJXp-Span-709" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-710">1</span><span class="MJXp-mo" id="MJXp-Span-711" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mrow" id="MJXp-Span-712"><span class="MJXp-mo" id="MJXp-Span-713" style="margin-left: 0.111em; margin-right: 0.111em;">/</span></span><span class="MJXp-mn" id="MJXp-Span-714">2</span></span></span><script type="math/tex" id="MathJax-Element-117">(n+1)/2</script> to the middle.</p><p>Next, we move these groups to their correct target positions in order. Suppose the target positions of a pair are <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-715"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-716">i</span></span></span><script type="math/tex" id="MathJax-Element-118">i</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-717"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-718">n</span><span class="MJXp-mo" id="MJXp-Span-719" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-720">i</span><span class="MJXp-mo" id="MJXp-Span-721" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-722">1</span></span></span><script type="math/tex" id="MathJax-Element-119">n - i + 1</script>, while it is currently at <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-723"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-724">j</span></span></span><script type="math/tex" id="MathJax-Element-120">j</script> and <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-725"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-726">n</span><span class="MJXp-mo" id="MJXp-Span-727" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-728">j</span><span class="MJXp-mo" id="MJXp-Span-729" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-730">1</span></span></span><script type="math/tex" id="MathJax-Element-121">n - j + 1</script>. We query <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-731"><span class="MJXp-mo" id="MJXp-Span-732" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-733">i</span><span class="MJXp-mo" id="MJXp-Span-734" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-735">j</span><span class="MJXp-mo" id="MJXp-Span-736" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-122">(i, j)</script>; this will surely place either the pair itself or its mirror into the correct positions.</p><p>Now we compute the expectation. Let <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-737"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-738">T</span></span></span><script type="math/tex" id="MathJax-Element-123">T</script> be the expected number of queries spent in this second phase for a single group. After we query once, with probability <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-739"><span class="MJXp-mn" id="MJXp-Span-740">1</span><span class="MJXp-mrow" id="MJXp-Span-741"><span class="MJXp-mo" id="MJXp-Span-742" style="margin-left: 0.111em; margin-right: 0.111em;">/</span></span><span class="MJXp-mn" id="MJXp-Span-743">2</span></span></span><script type="math/tex" id="MathJax-Element-124">1/2</script> the group is already correctly placed and we are done after <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-744"><span class="MJXp-mn" id="MJXp-Span-745">1</span></span></span><script type="math/tex" id="MathJax-Element-125">1</script> query; with probability <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-746"><span class="MJXp-mn" id="MJXp-Span-747">1</span><span class="MJXp-mrow" id="MJXp-Span-748"><span class="MJXp-mo" id="MJXp-Span-749" style="margin-left: 0.111em; margin-right: 0.111em;">/</span></span><span class="MJXp-mn" id="MJXp-Span-750">2</span></span></span><script type="math/tex" id="MathJax-Element-126">1/2</script> it is mirrored into another group’s target positions, in which case we have spent <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-751"><span class="MJXp-mn" id="MJXp-Span-752">1</span></span></span><script type="math/tex" id="MathJax-Element-127">1</script> query and still expect <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-753"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-754">T</span></span></span><script type="math/tex" id="MathJax-Element-128">T</script> more. Thus <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-755"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-756">T</span><span class="MJXp-mo" id="MJXp-Span-757" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-758">1</span><span class="MJXp-mo" id="MJXp-Span-759" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mfrac" id="MJXp-Span-760" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mn" id="MJXp-Span-761">1</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mn" id="MJXp-Span-762">2</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-763" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mn" id="MJXp-Span-764">1</span><span class="MJXp-mo" id="MJXp-Span-765" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mfrac" id="MJXp-Span-766" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mn" id="MJXp-Span-767">1</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mn" id="MJXp-Span-768">2</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-769" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-770">T</span><span class="MJXp-mo" id="MJXp-Span-771" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-772">1</span><span class="MJXp-mo" id="MJXp-Span-773" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-129">T = 1 + \frac{1}{2} \cdot 1 + \frac{1}{2}(T + 1)</script>, which solves to <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-774"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-775">T</span><span class="MJXp-mo" id="MJXp-Span-776" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-777">4</span></span></span><script type="math/tex" id="MathJax-Element-130">T = 4</script>.</p><p>There are <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-778"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-779">n</span><span class="MJXp-mrow" id="MJXp-Span-780"><span class="MJXp-mo" id="MJXp-Span-781" style="margin-left: 0.111em; margin-right: 0.111em;">/</span></span><span class="MJXp-mn" id="MJXp-Span-782">2</span></span></span><script type="math/tex" id="MathJax-Element-131">n/2</script> groups, so this phase needs <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-783"><span class="MJXp-mn" id="MJXp-Span-784">2</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-785">n</span></span></span><script type="math/tex" id="MathJax-Element-132">2n</script> queries in expectation. The first phase uses exactly <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-786"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-787">n</span><span class="MJXp-mrow" id="MJXp-Span-788"><span class="MJXp-mo" id="MJXp-Span-789" style="margin-left: 0.111em; margin-right: 0.111em;">/</span></span><span class="MJXp-mn" id="MJXp-Span-790">2</span></span></span><script type="math/tex" id="MathJax-Element-133">n/2</script> queries (one per group), so the total expected number of queries is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-791"><span class="MJXp-mn" id="MJXp-Span-792">5</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-793">n</span><span class="MJXp-mrow" id="MJXp-Span-794"><span class="MJXp-mo" id="MJXp-Span-795" style="margin-left: 0.111em; margin-right: 0.111em;">/</span></span><span class="MJXp-mn" id="MJXp-Span-796">2</span></span></span><script type="math/tex" id="MathJax-Element-134">5n/2</script>.</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> mxn</span><span class="pun">=</span><span class="lit">40004</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">,</span><span class="pln">a</span><span class="pun">[</span><span class="pln">mxn</span><span class="pun">],</span><span class="pln">pos</span><span class="pun">[</span><span class="pln">mxn</span><span class="pun">];</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> mirror</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x</span><span class="pun">){</span><span class="pln">
	</span><span class="kwd">return</span><span class="pln"> n</span><span class="pun">-</span><span class="pln">x</span><span class="pun">+</span><span class="lit">1</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
pair</span><span class="pun">&lt;</span><span class="kwd">int</span><span class="pun">,</span><span class="kwd">int</span><span class="pun">&gt;</span><span class="pln">ask</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x</span><span class="pun">,</span><span class="kwd">int</span><span class="pln"> y</span><span class="pun">){</span><span class="pln">
	cout</span><span class="pun">&lt;&lt;</span><span class="str">"? "</span><span class="pun">&lt;&lt;</span><span class="pln">x</span><span class="pun">&lt;&lt;</span><span class="str">' '</span><span class="pun">&lt;&lt;</span><span class="pln">y</span><span class="pun">&lt;&lt;</span><span class="pln">endl</span><span class="pun">;</span><span class="pln">
	fflush</span><span class="pun">(</span><span class="pln">stdout</span><span class="pun">);</span><span class="pln">
	</span><span class="kwd">int</span><span class="pln"> u</span><span class="pun">,</span><span class="pln">v</span><span class="pun">;</span><span class="pln">cin</span><span class="pun">&gt;&gt;</span><span class="pln">u</span><span class="pun">&gt;&gt;</span><span class="pln">v</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">return</span><span class="pln"> </span><span class="pun">{</span><span class="pln">u</span><span class="pun">,</span><span class="pln">v</span><span class="pun">};</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">void</span><span class="pln"> solve</span><span class="pun">(){</span><span class="pln">
	cin</span><span class="pun">&gt;&gt;</span><span class="pln">n</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i</span><span class="pun">=</span><span class="lit">1</span><span class="pun">;</span><span class="pln">i</span><span class="pun">&lt;=</span><span class="pln">n</span><span class="pun">;</span><span class="pln">i</span><span class="pun">++){</span><span class="pln">
		cin</span><span class="pun">&gt;&gt;</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
		pos</span><span class="pun">[</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]]=</span><span class="pln">i</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	</span><span class="kwd">if</span><span class="pun">(</span><span class="pln">n</span><span class="pun">%</span><span class="lit">2</span><span class="pun">==</span><span class="lit">1</span><span class="pun">){</span><span class="pln">
		</span><span class="kwd">int</span><span class="pln"> mid</span><span class="pun">=(</span><span class="pln">n</span><span class="pun">+</span><span class="lit">1</span><span class="pun">)/</span><span class="lit">2</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">while</span><span class="pun">(</span><span class="pln">pos</span><span class="pun">[</span><span class="pln">mid</span><span class="pun">]!=</span><span class="pln">mid</span><span class="pun">){</span><span class="pln">
			</span><span class="kwd">auto</span><span class="pln"> p</span><span class="pun">=</span><span class="pln">ask</span><span class="pun">(</span><span class="pln">mid</span><span class="pun">,</span><span class="pln">pos</span><span class="pun">[</span><span class="pln">mid</span><span class="pun">]);</span><span class="pln">
			</span><span class="kwd">int</span><span class="pln"> u</span><span class="pun">=</span><span class="pln">p</span><span class="pun">.</span><span class="pln">first</span><span class="pun">,</span><span class="pln">v</span><span class="pun">=</span><span class="pln">p</span><span class="pun">.</span><span class="pln">second</span><span class="pun">;</span><span class="pln">
			swap</span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">u</span><span class="pun">],</span><span class="pln">a</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]);</span><span class="pln">
			pos</span><span class="pun">[</span><span class="pln">a</span><span class="pun">[</span><span class="pln">u</span><span class="pun">]]=</span><span class="pln">u</span><span class="pun">,</span><span class="pln">pos</span><span class="pun">[</span><span class="pln">a</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]]=</span><span class="pln">v</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	</span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i</span><span class="pun">=</span><span class="lit">1</span><span class="pun">;</span><span class="pln">i</span><span class="pun">&lt;=</span><span class="pln">n</span><span class="pun">/</span><span class="lit">2</span><span class="pun">;</span><span class="pln">i</span><span class="pun">++){</span><span class="pln">
		</span><span class="kwd">int</span><span class="pln"> x</span><span class="pun">=</span><span class="pln">pos</span><span class="pun">[</span><span class="pln">i</span><span class="pun">],</span><span class="pln">y</span><span class="pun">=</span><span class="pln">pos</span><span class="pun">[</span><span class="pln">mirror</span><span class="pun">(</span><span class="pln">i</span><span class="pun">)];</span><span class="pln">
		</span><span class="kwd">if</span><span class="pun">(</span><span class="pln">x</span><span class="pun">+</span><span class="pln">y</span><span class="pun">!=</span><span class="pln">n</span><span class="pun">+</span><span class="lit">1</span><span class="pun">){</span><span class="com">//not mirror</span><span class="pln">
			</span><span class="kwd">auto</span><span class="pln"> p</span><span class="pun">=</span><span class="pln">ask</span><span class="pun">(</span><span class="pln">x</span><span class="pun">,</span><span class="pln">mirror</span><span class="pun">(</span><span class="pln">y</span><span class="pun">));</span><span class="pln">
			</span><span class="kwd">int</span><span class="pln"> u</span><span class="pun">=</span><span class="pln">p</span><span class="pun">.</span><span class="pln">first</span><span class="pun">,</span><span class="pln">v</span><span class="pun">=</span><span class="pln">p</span><span class="pun">.</span><span class="pln">second</span><span class="pun">;</span><span class="pln">
			swap</span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">u</span><span class="pun">],</span><span class="pln">a</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]);</span><span class="pln">
			pos</span><span class="pun">[</span><span class="pln">a</span><span class="pun">[</span><span class="pln">u</span><span class="pun">]]=</span><span class="pln">u</span><span class="pun">,</span><span class="pln">pos</span><span class="pun">[</span><span class="pln">a</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]]=</span><span class="pln">v</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	</span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i</span><span class="pun">=</span><span class="lit">1</span><span class="pun">;</span><span class="pln">i</span><span class="pun">&lt;=</span><span class="pln">n</span><span class="pun">/</span><span class="lit">2</span><span class="pun">;</span><span class="pln">i</span><span class="pun">++){</span><span class="pln">
		</span><span class="kwd">while</span><span class="pun">(</span><span class="pln">pos</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]!=</span><span class="pln">i </span><span class="kwd">or</span><span class="pln"> pos</span><span class="pun">[</span><span class="pln">mirror</span><span class="pun">(</span><span class="pln">i</span><span class="pun">)]!=</span><span class="pln">mirror</span><span class="pun">(</span><span class="pln">i</span><span class="pun">)){</span><span class="pln">
			</span><span class="kwd">if</span><span class="pun">(</span><span class="pln">pos</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]!=</span><span class="pln">i</span><span class="pun">){</span><span class="pln">
				</span><span class="kwd">auto</span><span class="pln"> p</span><span class="pun">=</span><span class="pln">ask</span><span class="pun">(</span><span class="pln">i</span><span class="pun">,</span><span class="pln">pos</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]);</span><span class="pln">
				</span><span class="kwd">int</span><span class="pln"> u</span><span class="pun">=</span><span class="pln">p</span><span class="pun">.</span><span class="pln">first</span><span class="pun">,</span><span class="pln">v</span><span class="pun">=</span><span class="pln">p</span><span class="pun">.</span><span class="pln">second</span><span class="pun">;</span><span class="pln">
				swap</span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">u</span><span class="pun">],</span><span class="pln">a</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]);</span><span class="pln">
				pos</span><span class="pun">[</span><span class="pln">a</span><span class="pun">[</span><span class="pln">u</span><span class="pun">]]=</span><span class="pln">u</span><span class="pun">,</span><span class="pln">pos</span><span class="pun">[</span><span class="pln">a</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]]=</span><span class="pln">v</span><span class="pun">;</span><span class="pln">				
			</span><span class="pun">}</span><span class="kwd">else</span><span class="pun">{</span><span class="pln">
				</span><span class="kwd">auto</span><span class="pln"> p</span><span class="pun">=</span><span class="pln">ask</span><span class="pun">(</span><span class="pln">mirror</span><span class="pun">(</span><span class="pln">i</span><span class="pun">),</span><span class="pln">pos</span><span class="pun">[</span><span class="pln">mirror</span><span class="pun">(</span><span class="pln">i</span><span class="pun">)]);</span><span class="pln">
				</span><span class="kwd">int</span><span class="pln"> u</span><span class="pun">=</span><span class="pln">p</span><span class="pun">.</span><span class="pln">first</span><span class="pun">,</span><span class="pln">v</span><span class="pun">=</span><span class="pln">p</span><span class="pun">.</span><span class="pln">second</span><span class="pun">;</span><span class="pln">
				swap</span><span class="pun">(</span><span class="pln">a</span><span class="pun">[</span><span class="pln">u</span><span class="pun">],</span><span class="pln">a</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]);</span><span class="pln">
				pos</span><span class="pun">[</span><span class="pln">a</span><span class="pun">[</span><span class="pln">u</span><span class="pun">]]=</span><span class="pln">u</span><span class="pun">,</span><span class="pln">pos</span><span class="pun">[</span><span class="pln">a</span><span class="pun">[</span><span class="pln">v</span><span class="pun">]]=</span><span class="pln">v</span><span class="pun">;</span><span class="pln">	
			</span><span class="pun">}</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	cout</span><span class="pun">&lt;&lt;</span><span class="str">"!"</span><span class="pun">&lt;&lt;</span><span class="pln">endl</span><span class="pun">;</span><span class="pln">
	fflush</span><span class="pun">(</span><span class="pln">stdout</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">(){</span><span class="pln">
	</span><span class="kwd">int</span><span class="pln"> T</span><span class="pun">=</span><span class="lit">1</span><span class="pun">;</span><span class="pln">
	cin</span><span class="pun">&gt;&gt;</span><span class="pln">T</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">for</span><span class="pun">(;</span><span class="pln">T</span><span class="pun">--;)</span><span class="pln">solve</span><span class="pun">();</span><span class="pln">
	</span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div><p><a href="https://codeforces.com/contest/2173/problem/F">2173F-Isla's Memory Thresholds</a> Idea &amp; Solution: <a class="rated-user user-red" href="https://codeforces.com/profile/paulzrm" title="Grandmaster paulzrm">paulzrm</a></p> <div class="spoiler"><b class="spoiler-title">Tutorial</b><div class="spoiler-content" style="display: block;"><p>Consider the process. First note that, because the array <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-797"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-798">a</span></span></span><script type="math/tex" id="MathJax-Element-135">a</script> is non-increasing, the length of each segment whose sum first reaches <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-799"><span class="MJXp-mo" id="MJXp-Span-800" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-801">x</span></span></span><script type="math/tex" id="MathJax-Element-136">\ge x</script> and is then cleared is nondecreasing.</p><p>We use the square-root decomposition idea. We fix a threshold <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-802"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-803">B</span></span></span><script type="math/tex" id="MathJax-Element-137">B</script> that separates “short” segments from “long” ones. For segments of length at most <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-804"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-805">B</span></span></span><script type="math/tex" id="MathJax-Element-138">B</script>, we handle them using precomputed data; for segments of length greater than <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-806"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-807">B</span></span></span><script type="math/tex" id="MathJax-Element-139">B</script>, we use a slower direct procedure.</p><p>Since there are at most <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-808"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-809">q</span></span></span><script type="math/tex" id="MathJax-Element-140">q</script> distinct values of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-810"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-811">x</span></span></span><script type="math/tex" id="MathJax-Element-141">x</script>, we can first collect all queries offline and discretize these values. Then we build a table <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-812"><span class="MJXp-mtext" id="MJXp-Span-813">f[i][len]</span></span></span><script type="math/tex" id="MathJax-Element-142">\text{f[i][len]}</script> that records the rightmost starting position of a segment of length <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-814"><span class="MJXp-mtext" id="MJXp-Span-815">len</span></span></span><script type="math/tex" id="MathJax-Element-143">\text{len}</script> whose sum is at least the <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-816"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-817">i</span></span></span><script type="math/tex" id="MathJax-Element-144">i</script>-th largest value of <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-818"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-819">x</span></span></span><script type="math/tex" id="MathJax-Element-145">x</script>.</p><p>When answering a query, we simply enumerate <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-820"><span class="MJXp-mtext" id="MJXp-Span-821">len</span><span class="MJXp-mo" id="MJXp-Span-822" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-823">1</span><span class="MJXp-mo" id="MJXp-Span-824" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-825">2</span><span class="MJXp-mo" id="MJXp-Span-826" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-827" style="margin-left: 0em; margin-right: 0em;">…</span><span class="MJXp-mo" id="MJXp-Span-828" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-829">B</span></span></span><script type="math/tex" id="MathJax-Element-146">\text{len} = 1, 2, \dots, B</script> and, starting from the current left endpoint, quickly skip over and process all segments of length <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-830"><span class="MJXp-mtext" id="MJXp-Span-831">len</span></span></span><script type="math/tex" id="MathJax-Element-147">\text{len}</script>. The time complexity for this part is <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-832"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-833">O</span><span class="MJXp-mo" id="MJXp-Span-834" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-835">B</span><span class="MJXp-mo" id="MJXp-Span-836" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-148">O(B)</script> per query.</p><p>For segments of length <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-837"><span class="MJXp-mo" id="MJXp-Span-838" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-839">B</span></span></span><script type="math/tex" id="MathJax-Element-149">> B</script>, we directly binary search the ending position of each such segment. Since every such segment has length at least <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-840"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-841">B</span></span></span><script type="math/tex" id="MathJax-Element-150">B</script>, we make at most <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-842"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-843">n</span><span class="MJXp-mrow" id="MJXp-Span-844"><span class="MJXp-mo" id="MJXp-Span-845" style="margin-left: 0.111em; margin-right: 0.111em;">/</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-846">B</span></span></span><script type="math/tex" id="MathJax-Element-151">n/B</script> jumps, so this part runs in <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-847"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-848">O</span><span class="MJXp-mstyle" id="MJXp-Span-849"><span class="MJXp-mrow" id="MJXp-Span-850"><span class="MJXp-mo" id="MJXp-Span-851" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.083em;"><span class="MJXp-right MJXp-scale10" style="font-size: 1.333em; margin-left: 0.07em;">(</span></span></span></span><span class="MJXp-mo" id="MJXp-Span-852" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-853">n</span><span class="MJXp-mrow" id="MJXp-Span-854"><span class="MJXp-mo" id="MJXp-Span-855" style="margin-left: 0.111em; margin-right: 0.111em;">/</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-856">B</span><span class="MJXp-mo" id="MJXp-Span-857" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mi" id="MJXp-Span-858">log</span><span class="MJXp-mo" id="MJXp-Span-859" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-860">n</span><span class="MJXp-mstyle" id="MJXp-Span-861"><span class="MJXp-mrow" id="MJXp-Span-862"><span class="MJXp-mo" id="MJXp-Span-863" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.083em;"><span class="MJXp-right MJXp-scale10" style="font-size: 1.333em; margin-left: 0.07em;">)</span></span></span></span></span></span><script type="math/tex" id="MathJax-Element-152">O\bigl((n/B)\log n\bigr)</script> time.</p><p>If we choose <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-864"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-865">B</span><span class="MJXp-mo" id="MJXp-Span-866" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msqrt" id="MJXp-Span-867"><span class="MJXp-surd"><span style="font-size: 134%; margin-top: 0.104em;">√</span></span><span class="MJXp-root"><span class="MJXp-rule" style="border-top: 0.08em solid;"></span><span class="MJXp-box"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-868">n</span><span class="MJXp-mi" id="MJXp-Span-869">log</span><span class="MJXp-mo" id="MJXp-Span-870" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-871">n</span></span></span></span></span></span><script type="math/tex" id="MathJax-Element-153">B = \sqrt{n\log n}</script>, the two parts balance and the total time complexity becomes <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-872"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-873">O</span><span class="MJXp-mstyle" id="MJXp-Span-874"><span class="MJXp-mrow" id="MJXp-Span-875"><span class="MJXp-mo" id="MJXp-Span-876" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.083em;"><span class="MJXp-right MJXp-scale10" style="font-size: 1.333em; margin-left: 0.07em;">(</span></span></span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-877">n</span><span class="MJXp-msqrt" id="MJXp-Span-878"><span class="MJXp-surd"><span style="font-size: 134%; margin-top: 0.104em;">√</span></span><span class="MJXp-root"><span class="MJXp-rule" style="border-top: 0.08em solid;"></span><span class="MJXp-box"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-879">n</span><span class="MJXp-mi" id="MJXp-Span-880">log</span><span class="MJXp-mo" id="MJXp-Span-881" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-882">n</span></span></span></span><span class="MJXp-mstyle" id="MJXp-Span-883"><span class="MJXp-mrow" id="MJXp-Span-884"><span class="MJXp-mo" id="MJXp-Span-885" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.083em;"><span class="MJXp-right MJXp-scale10" style="font-size: 1.333em; margin-left: 0.07em;">)</span></span></span></span></span></span><script type="math/tex" id="MathJax-Element-154">O\bigl(n\sqrt{n\log n}\bigr)</script>.</p></div></div> <div class="spoiler"><b class="spoiler-title">Solution</b><div class="spoiler-content" style="display: block;"><pre><code class="prettyprint prettyprinted" style=""><span class="com">#include</span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span class="com">#define</span><span class="pln"> ll </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> mxn</span><span class="pun">=</span><span class="lit">2e5</span><span class="pun">+</span><span class="lit">5</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> B</span><span class="pun">=</span><span class="lit">512</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> T</span><span class="pun">,</span><span class="pln">f</span><span class="pun">[</span><span class="pln">B</span><span class="pun">+</span><span class="lit">3</span><span class="pun">][</span><span class="pln">mxn</span><span class="pun">],</span><span class="pln">n</span><span class="pun">,</span><span class="pln">a</span><span class="pun">[</span><span class="pln">mxn</span><span class="pun">],</span><span class="pln">q</span><span class="pun">;</span><span class="pln">
ll sum</span><span class="pun">[</span><span class="pln">mxn</span><span class="pun">],</span><span class="pln">N</span><span class="pun">=</span><span class="lit">1000000001</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> l_</span><span class="pun">[</span><span class="pln">mxn</span><span class="pun">],</span><span class="pln">r_</span><span class="pun">[</span><span class="pln">mxn</span><span class="pun">],</span><span class="pln">x_</span><span class="pun">[</span><span class="pln">mxn</span><span class="pun">];</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> id</span><span class="pun">[</span><span class="pln">mxn</span><span class="pun">];</span><span class="pln">
</span><span class="kwd">void</span><span class="pln"> solve</span><span class="pun">(){</span><span class="pln">
	cin</span><span class="pun">&gt;&gt;</span><span class="pln">n</span><span class="pun">&gt;&gt;</span><span class="pln">q</span><span class="pun">;</span><span class="pln">
	vector</span><span class="str">&lt;int&gt;</span><span class="pln">v</span><span class="pun">;</span><span class="pln">v</span><span class="pun">.</span><span class="pln">clear</span><span class="pun">();</span><span class="pln">
	</span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i</span><span class="pun">=</span><span class="lit">1</span><span class="pun">;</span><span class="pln">i</span><span class="pun">&lt;=</span><span class="pln">n</span><span class="pun">;</span><span class="pln">i</span><span class="pun">++)</span><span class="pln">
		cin</span><span class="pun">&gt;&gt;</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">],</span><span class="pln">
		sum</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]=</span><span class="pln">sum</span><span class="pun">[</span><span class="pln">i</span><span class="pun">-</span><span class="lit">1</span><span class="pun">]+</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
	</span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i</span><span class="pun">=</span><span class="lit">1</span><span class="pun">;</span><span class="pln">i</span><span class="pun">&lt;=</span><span class="pln">q</span><span class="pun">;</span><span class="pln">i</span><span class="pun">++)</span><span class="pln">
		cin</span><span class="pun">&gt;&gt;</span><span class="pln">l_</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]&gt;&gt;</span><span class="pln">r_</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]&gt;&gt;</span><span class="pln">x_</span><span class="pun">[</span><span class="pln">i</span><span class="pun">],</span><span class="pln">
		v</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">(</span><span class="pln">x_</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]);</span><span class="pln">
	v</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
	v</span><span class="pun">.</span><span class="pln">push_back</span><span class="pun">(</span><span class="lit">1000000008</span><span class="pun">);</span><span class="pln">
	sort</span><span class="pun">(</span><span class="pln">v</span><span class="pun">.</span><span class="kwd">begin</span><span class="pun">(),</span><span class="pln">v</span><span class="pun">.</span><span class="kwd">end</span><span class="pun">());</span><span class="pln">
	v</span><span class="pun">.</span><span class="pln">erase</span><span class="pun">(</span><span class="pln">unique</span><span class="pun">(</span><span class="pln">v</span><span class="pun">.</span><span class="kwd">begin</span><span class="pun">(),</span><span class="pln">v</span><span class="pun">.</span><span class="kwd">end</span><span class="pun">()),</span><span class="pln">v</span><span class="pun">.</span><span class="kwd">end</span><span class="pun">());</span><span class="pln">
	</span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i</span><span class="pun">=</span><span class="lit">1</span><span class="pun">;</span><span class="pln">i</span><span class="pun">&lt;=</span><span class="pln">q</span><span class="pun">;</span><span class="pln">i</span><span class="pun">++)</span><span class="pln">
		id</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]=</span><span class="pln">lower_bound</span><span class="pun">(</span><span class="pln">v</span><span class="pun">.</span><span class="kwd">begin</span><span class="pun">(),</span><span class="pln">v</span><span class="pun">.</span><span class="kwd">end</span><span class="pun">(),</span><span class="pln">x_</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])-</span><span class="pln">v</span><span class="pun">.</span><span class="kwd">begin</span><span class="pun">();</span><span class="pln">
	</span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i</span><span class="pun">=</span><span class="lit">1</span><span class="pun">;</span><span class="pln">i</span><span class="pun">&lt;=</span><span class="pln">B</span><span class="pun">;</span><span class="pln">i</span><span class="pun">++){</span><span class="pln">
		</span><span class="kwd">int</span><span class="pln"> k</span><span class="pun">=</span><span class="lit">0</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j</span><span class="pun">=</span><span class="pln">n</span><span class="pun">-</span><span class="pln">i</span><span class="pun">;</span><span class="pln">j</span><span class="pun">&gt;=</span><span class="lit">0</span><span class="pun">;</span><span class="pln">j</span><span class="pun">--)</span><span class="pln">
			</span><span class="kwd">for</span><span class="pun">(;</span><span class="pln">v</span><span class="pun">[</span><span class="pln">k</span><span class="pun">]&lt;=</span><span class="pln">min</span><span class="pun">(</span><span class="pln">sum</span><span class="pun">[</span><span class="pln">j</span><span class="pun">+</span><span class="pln">i</span><span class="pun">]-</span><span class="pln">sum</span><span class="pun">[</span><span class="pln">j</span><span class="pun">],</span><span class="pln">N</span><span class="pun">);</span><span class="pln">k</span><span class="pun">++)</span><span class="pln">
				f</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">k</span><span class="pun">]=</span><span class="pln">j</span><span class="pun">+</span><span class="lit">1</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	</span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">=</span><span class="lit">1</span><span class="pun">;</span><span class="pln">t</span><span class="pun">&lt;=</span><span class="pln">q</span><span class="pun">;</span><span class="pln">t</span><span class="pun">++){</span><span class="pln">
		</span><span class="kwd">int</span><span class="pln"> l</span><span class="pun">,</span><span class="pln">r</span><span class="pun">,</span><span class="pln">x</span><span class="pun">,</span><span class="pln">cnt</span><span class="pun">=</span><span class="lit">0</span><span class="pun">;</span><span class="pln">
		l</span><span class="pun">=</span><span class="pln">l_</span><span class="pun">[</span><span class="pln">t</span><span class="pun">],</span><span class="pln">r</span><span class="pun">=</span><span class="pln">r_</span><span class="pun">[</span><span class="pln">t</span><span class="pun">],</span><span class="pln">x</span><span class="pun">=</span><span class="pln">x_</span><span class="pun">[</span><span class="pln">t</span><span class="pun">];</span><span class="pln">
		</span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i</span><span class="pun">=</span><span class="lit">1</span><span class="pun">;</span><span class="pln">i</span><span class="pun">&lt;=</span><span class="pln">B</span><span class="pun">;</span><span class="pln">i</span><span class="pun">++)</span><span class="pln">
			</span><span class="kwd">if</span><span class="pun">(</span><span class="pln">f</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">id</span><span class="pun">[</span><span class="pln">t</span><span class="pun">]]&gt;=</span><span class="pln">l</span><span class="pun">){</span><span class="pln">
				</span><span class="kwd">int</span><span class="pln"> w</span><span class="pun">=</span><span class="pln">min</span><span class="pun">(</span><span class="pln">r</span><span class="pun">-</span><span class="pln">l</span><span class="pun">+</span><span class="lit">1</span><span class="pun">,</span><span class="pln">f</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">id</span><span class="pun">[</span><span class="pln">t</span><span class="pun">]]-</span><span class="pln">l</span><span class="pun">+</span><span class="pln">i</span><span class="pun">)/</span><span class="pln">i</span><span class="pun">;</span><span class="pln">
				cnt</span><span class="pun">+=</span><span class="pln">w</span><span class="pun">;</span><span class="pln">
				l</span><span class="pun">+=</span><span class="pln">w</span><span class="pun">*</span><span class="pln">i</span><span class="pun">;</span><span class="pln">
			</span><span class="pun">}</span><span class="pln">l</span><span class="pun">--;</span><span class="pln">
		</span><span class="kwd">while</span><span class="pun">(</span><span class="lit">1</span><span class="pun">){</span><span class="pln">
			</span><span class="kwd">if</span><span class="pun">(</span><span class="pln">sum</span><span class="pun">[</span><span class="pln">r</span><span class="pun">]-</span><span class="pln">sum</span><span class="pun">[</span><span class="pln">l</span><span class="pun">]&lt;</span><span class="pln">x</span><span class="pun">){</span><span class="pln">
				cout</span><span class="pun">&lt;&lt;</span><span class="pln">cnt</span><span class="pun">&lt;&lt;</span><span class="str">' '</span><span class="pun">&lt;&lt;</span><span class="pln">sum</span><span class="pun">[</span><span class="pln">r</span><span class="pun">]-</span><span class="pln">sum</span><span class="pun">[</span><span class="pln">l</span><span class="pun">]&lt;&lt;</span><span class="str">'\n'</span><span class="pun">;</span><span class="pln">
				</span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
			</span><span class="pun">}</span><span class="pln">cnt</span><span class="pun">++;</span><span class="pln">
			</span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">=</span><span class="pln">x</span><span class="pun">,</span><span class="pln">lo</span><span class="pun">=</span><span class="pln">l</span><span class="pun">-</span><span class="lit">1</span><span class="pun">,</span><span class="pln">hi</span><span class="pun">=</span><span class="pln">n</span><span class="pun">+</span><span class="lit">1</span><span class="pun">,</span><span class="pln">md</span><span class="pun">;</span><span class="pln">
			ll req</span><span class="pun">=</span><span class="pln">sum</span><span class="pun">[</span><span class="pln">l</span><span class="pun">]+</span><span class="pln">t</span><span class="pun">;</span><span class="pln">
			</span><span class="kwd">for</span><span class="pun">(;</span><span class="pln">lo</span><span class="pun">&lt;</span><span class="pln">hi</span><span class="pun">-</span><span class="lit">1</span><span class="pun">;){</span><span class="pln">
				md</span><span class="pun">=</span><span class="pln">lo</span><span class="pun">+</span><span class="pln">hi</span><span class="pun">&gt;&gt;</span><span class="lit">1</span><span class="pun">;</span><span class="pln">
				</span><span class="kwd">if</span><span class="pun">(</span><span class="pln">sum</span><span class="pun">[</span><span class="pln">md</span><span class="pun">]&lt;</span><span class="pln">req</span><span class="pun">)</span><span class="pln">lo</span><span class="pun">=</span><span class="pln">md</span><span class="pun">;</span><span class="pln">
				</span><span class="kwd">else</span><span class="pln"> hi</span><span class="pun">=</span><span class="pln">md</span><span class="pun">;</span><span class="pln">
			</span><span class="pun">}</span><span class="pln">
			l</span><span class="pun">=</span><span class="pln">hi</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	</span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i</span><span class="pun">=</span><span class="lit">0</span><span class="pun">;</span><span class="pln">i</span><span class="pun">&lt;</span><span class="pln">max</span><span class="pun">(</span><span class="pln">n</span><span class="pun">,(</span><span class="kwd">int</span><span class="pun">)</span><span class="pln">v</span><span class="pun">.</span><span class="pln">size</span><span class="pun">())+</span><span class="lit">3</span><span class="pun">;</span><span class="pln">i</span><span class="pun">++)</span><span class="pln">sum</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]=</span><span class="lit">0</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j</span><span class="pun">=</span><span class="lit">0</span><span class="pun">;</span><span class="pln">j</span><span class="pun">&lt;</span><span class="pln">B</span><span class="pun">+</span><span class="lit">3</span><span class="pun">;</span><span class="pln">j</span><span class="pun">++)</span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i</span><span class="pun">=</span><span class="lit">0</span><span class="pun">;</span><span class="pln">i</span><span class="pun">&lt;</span><span class="pln">max</span><span class="pun">(</span><span class="pln">n</span><span class="pun">,(</span><span class="kwd">int</span><span class="pun">)</span><span class="pln">v</span><span class="pun">.</span><span class="pln">size</span><span class="pun">())+</span><span class="lit">3</span><span class="pun">;</span><span class="pln">i</span><span class="pun">++)</span><span class="pln">f</span><span class="pun">[</span><span class="pln">j</span><span class="pun">][</span><span class="pln">i</span><span class="pun">]=</span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">signed</span><span class="pln"> main</span><span class="pun">(){</span><span class="pln">
	ios_base</span><span class="pun">::</span><span class="pln">sync_with_stdio</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
	cin</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">),</span><span class="pln">cout</span><span class="pun">.</span><span class="pln">tie</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
	T</span><span class="pun">=</span><span class="lit">1</span><span class="pun">;</span><span class="pln">cin</span><span class="pun">&gt;&gt;</span><span class="pln">T</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">while</span><span class="pun">(</span><span class="pln">T</span><span class="pun">--)</span><span class="pln">solve</span><span class="pun">();</span><span class="pln">
	</span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre></div></div> <div class="spoiler"><b class="spoiler-title">Bonus</b><div class="spoiler-content" style="display: block;"><p>There exists an <span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-886"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-887">O</span><span class="MJXp-mo" id="MJXp-Span-888" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-889">n</span><span class="MJXp-msqrt" id="MJXp-Span-890"><span class="MJXp-surd"><span style="font-size: 134%; margin-top: 0.104em;">√</span></span><span class="MJXp-root"><span class="MJXp-rule" style="border-top: 0.08em solid;"></span><span class="MJXp-box"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-891">n</span></span></span></span><span class="MJXp-mo" id="MJXp-Span-892" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-155">O(n\sqrt{n})</script> solution.</p></div></div></div>

    </div>


        <div style="font-size: 1.1rem;line-height: 1.1rem;padding-bottom: 0.5em;">
            <img src="https://codeforces.com//codeforces.com/codeforces.org/s/52448/images/icons/paperclip-16x16.png" style="vertical-align: middle;"> <span style="padding: 0 0.35em;">Tutorial of <a href="https://codeforces.com/contest/2173" class="notice" style="text-decoration: none;">Codeforces Round 1068 (Div. 2)</a> </span>
        </div>
        
            

  <script>
    // Make all spoilers toggleable
    document.querySelectorAll('.spoiler-title').forEach(title => {
      title.addEventListener('click', function() {
        const spoiler = this.closest('.spoiler');
        spoiler.classList.toggle('open');
      });
    });
    
    // Open all spoilers by default for easier reading
    document.querySelectorAll('.spoiler').forEach(spoiler => {
      spoiler.classList.add('open');
    });
  </script>
</body>
</html>